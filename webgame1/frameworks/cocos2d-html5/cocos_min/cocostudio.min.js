cc.Component=cc.Class.extend({_owner:null,_name:"",_enabled:!0,ctor:function(){this._owner=null,this._name="",this._enabled=!0},init:function(){return!0},onEnter:function(){},onExit:function(){},update:function(delta){},serialize:function(reader){},isEnabled:function(){return this._enabled},setEnabled:function(enable){this._enabled=enable},getName:function(){return this._name},setName:function(name){this._name=name},setOwner:function(owner){this._owner=owner},getOwner:function(){return this._owner}}),cc.Component.create=function(){return new cc.Component},cc.ComponentContainer=cc.Class.extend({_components:null,_owner:null,ctor:function(node){this._components=null,this._owner=node},getComponent:function(name){if(!name)throw new Error("cc.ComponentContainer.getComponent(): name should be non-null");return name=name.trim(),this._components||(this._components={}),this._components[name]},add:function(component){if(!component)throw new Error("cc.ComponentContainer.add(): component should be non-null");return component.getOwner()?(cc.log("cc.ComponentContainer.add(): Component already added. It can't be added again"),!1):(null==this._components&&(this._components={},this._owner.scheduleUpdate()),this._components[component.getName()]?(cc.log("cc.ComponentContainer.add(): Component already added. It can't be added again"),!1):(component.setOwner(this._owner),this._components[component.getName()]=component,component.onEnter(),!0))},remove:function(name){if(!name)throw new Error("cc.ComponentContainer.remove(): name should be non-null");return!!this._components&&(name instanceof cc.Component?this._removeByComponent(name):(name=name.trim(),this._removeByComponent(this._components[name])))},_removeByComponent:function(component){return!!component&&(component.onExit(),component.setOwner(null),delete this._components[component.getName()],!0)},removeAll:function(){if(this._components){var locComponents=this._components;for(var selKey in locComponents){var selComponent=locComponents[selKey];selComponent.onExit(),selComponent.setOwner(null),delete locComponents[selKey]}this._owner.unscheduleUpdate(),this._components=null}},_alloc:function(){this._components={}},visit:function(delta){if(this._components){var locComponents=this._components;for(var selKey in locComponents)locComponents[selKey].update(delta)}},isEmpty:function(){return!this._components||0===this._components.length}}),ccui.LayoutComponent_ReferencePoint={BOTTOM_LEFT:0,TOP_LEFT:1,BOTTOM_RIGHT:2,TOP_RIGHT:3},ccui.LayoutComponent_PositionType={Position:0,RelativePosition:1,PreRelativePosition:2,PreRelativePositionEnable:3},ccui.LayoutComponent_SizeType={Size:0,PreSize:1,PreSizeEnable:2},ccui.LayoutComponent=cc.Component.extend({_horizontalEdge:0,_verticalEdge:0,_leftMargin:0,_rightMargin:0,_bottomMargin:0,_topMargin:0,_usingPositionPercentX:!1,_positionPercentX:0,_usingPositionPercentY:!1,_positionPercentY:0,_usingStretchWidth:!1,_usingStretchHeight:!1,_percentWidth:0,_usingPercentWidth:!1,_percentHeight:0,_usingPercentHeight:!1,_actived:!0,_isPercentOnly:!1,ctor:function(){this._name=ccui.LayoutComponent.NAME},init:function(){return!!cc.Component.prototype.init.call(this)},getPercentContentSize:function(){return cc.p(this._percentWidth,this._percentHeight)},setPercentContentSize:function(percent){this.setPercentWidth(percent.x),this.setPercentHeight(percent.y)},setUsingPercentContentSize:function(isUsed){this._usingPercentWidth=this._usingPercentHeight=isUsed},SetActiveEnable:function(enable){this._actived=enable},getUsingPercentContentSize:function(){return this._usingPercentWidth&&this._usingPercentHeight},getAnchorPosition:function(){return this._owner.getAnchorPoint()},setAnchorPosition:function(point,y){var oldRect=this._owner.getBoundingBox();this._owner.setAnchorPoint(point,y);var newRect=this._owner.getBoundingBox(),offSetX=oldRect.x-newRect.x,offSetY=oldRect.y-newRect.y,ownerPosition=this._owner.getPosition();ownerPosition.x+=offSetX,ownerPosition.y+=offSetY,this.setPosition(ownerPosition)},getPosition:function(){return this._owner.getPosition()},setPosition:function(position,y){var x,parent=this._getOwnerParent();if(null!=parent){void 0===y?(x=position.x,y=position.y):x=position;var parentSize=parent.getContentSize();0!==parentSize.width?this._positionPercentX=x/parentSize.width:(this._positionPercentX=0,this._usingPositionPercentX&&(x=0)),0!==parentSize.height?this._positionPercentY=y/parentSize.height:(this._positionPercentY=0,this._usingPositionPercentY&&(y=0)),this._owner.setPosition(x,y),this._refreshHorizontalMargin(),this._refreshVerticalMargin()}else this._owner.setPosition(position,y)},isPositionPercentXEnabled:function(){return this._usingPositionPercentX},setPositionPercentXEnabled:function(isUsed){this._usingPositionPercentX=isUsed,this._usingPositionPercentX&&(this._horizontalEdge=ccui.LayoutComponent.horizontalEdge.NONE)},getPositionPercentX:function(){return this._positionPercentX},setPositionPercentX:function(percentMargin){this._positionPercentX=percentMargin;var parent=this._getOwnerParent();null!==parent&&(this._owner.setPositionX(parent.width*this._positionPercentX),this._refreshHorizontalMargin())},isPositionPercentYEnabled:function(){return this._usingPositionPercentY},setPositionPercentYEnabled:function(isUsed){this._usingPositionPercentY=isUsed,this._usingPositionPercentY&&(this._verticalEdge=ccui.LayoutComponent.verticalEdge.NONE)},getPositionPercentY:function(){return this._positionPercentY},setPositionPercentY:function(percentMargin){this._positionPercentY=percentMargin;var parent=this._getOwnerParent();null!==parent&&(this._owner.setPositionY(parent.height*this._positionPercentY),this._refreshVerticalMargin())},getHorizontalEdge:function(){return this._horizontalEdge},setHorizontalEdge:function(hEdge){this._horizontalEdge=hEdge,this._horizontalEdge!==ccui.LayoutComponent.horizontalEdge.NONE&&(this._usingPositionPercentX=!1);var parent=this._getOwnerParent();if(null!==parent){var ownerPoint=this._owner.getPosition(),parentSize=parent.getContentSize();0!==parentSize.width?this._positionPercentX=ownerPoint.x/parentSize.width:(this._positionPercentX=0,ownerPoint.x=0,this._usingPositionPercentX&&this._owner.setPosition(ownerPoint)),this._refreshHorizontalMargin()}},getVerticalEdge:function(){return this._verticalEdge},setVerticalEdge:function(vEdge){this._verticalEdge=vEdge,this._verticalEdge!==ccui.LayoutComponent.verticalEdge.NONE&&(this._usingPositionPercentY=!1);var parent=this._getOwnerParent();if(null!==parent){var ownerPoint=this._owner.getPosition(),parentSize=parent.getContentSize();0!==parentSize.height?this._positionPercentY=ownerPoint.y/parentSize.height:(this._positionPercentY=0,ownerPoint.y=0,this._usingPositionPercentY&&this._owner.setPosition(ownerPoint)),this._refreshVerticalMargin()}},getLeftMargin:function(){return this._leftMargin},setLeftMargin:function(margin){this._leftMargin=margin},getRightMargin:function(){return this._rightMargin},setRightMargin:function(margin){this._rightMargin=margin},getTopMargin:function(){return this._topMargin},setTopMargin:function(margin){this._topMargin=margin},getBottomMargin:function(){return this._bottomMargin},setBottomMargin:function(margin){this._bottomMargin=margin},getSize:function(){return this.getOwner().getContentSize()},setSize:function(size){var parent=this._getOwnerParent();if(null!==parent){var ownerSize=size,parentSize=parent.getContentSize();0!==parentSize.width?this._percentWidth=ownerSize.width/parentSize.width:(this._percentWidth=0,this._usingPercentWidth&&(ownerSize.width=0)),0!==parentSize.height?this._percentHeight=ownerSize.height/parentSize.height:(this._percentHeight=0,this._usingPercentHeight&&(ownerSize.height=0)),this._owner.setContentSize(ownerSize),this._refreshHorizontalMargin(),this._refreshVerticalMargin()}else this._owner.setContentSize(size)},isPercentWidthEnabled:function(){return this._usingPercentWidth},setPercentWidthEnabled:function(isUsed){this._usingPercentWidth=isUsed,this._usingPercentWidth&&(this._usingStretchWidth=!1)},getSizeWidth:function(){return this._owner.width},setSizeWidth:function(width){var ownerSize=this._owner.getContentSize();ownerSize.width=width;var parent=this._getOwnerParent();if(null!==parent){var parentSize=parent.getContentSize();0!==parentSize.width?this._percentWidth=ownerSize.width/parentSize.width:(this._percentWidth=0,this._usingPercentWidth&&(ownerSize.width=0)),this._owner.setContentSize(ownerSize),this._refreshHorizontalMargin()}else this._owner.setContentSize(ownerSize)},getPercentWidth:function(){return this._percentWidth},setPercentWidth:function(percentWidth){this._percentWidth=percentWidth;var parent=this._getOwnerParent();if(null!==parent){var ownerSize=this._owner.getContentSize();ownerSize.width=parent.width*this._percentWidth,this._owner.setContentSize(ownerSize),this._refreshHorizontalMargin()}},isPercentHeightEnabled:function(){return this._usingPercentHeight},setPercentHeightEnabled:function(isUsed){this._usingPercentHeight=isUsed,this._usingPercentHeight&&(this._usingStretchHeight=!1)},getSizeHeight:function(){return this._owner.height},setSizeHeight:function(height){var ownerSize=this._owner.getContentSize();ownerSize.height=height;var parent=this._getOwnerParent();if(null!==parent){var parentSize=parent.getContentSize();0!==parentSize.height?this._percentHeight=ownerSize.height/parentSize.height:(this._percentHeight=0,this._usingPercentHeight&&(ownerSize.height=0)),this._owner.setContentSize(ownerSize),this._refreshVerticalMargin()}else this._owner.setContentSize(ownerSize)},getPercentHeight:function(){return this._percentHeight},setPercentHeight:function(percentHeight){this._percentHeight=percentHeight;var parent=this._getOwnerParent();if(null!==parent){var ownerSize=this._owner.getContentSize();ownerSize.height=parent.height*this._percentHeight,this._owner.setContentSize(ownerSize),this._refreshVerticalMargin()}},isStretchWidthEnabled:function(){return this._usingStretchWidth},setStretchWidthEnabled:function(isUsed){this._usingStretchWidth=isUsed,this._usingStretchWidth&&(this._usingPercentWidth=!1)},isStretchHeightEnabled:function(){return this._usingStretchHeight},setStretchHeightEnabled:function(isUsed){this._usingStretchHeight=isUsed,this._usingStretchHeight&&(this._usingPercentHeight=!1)},setPercentOnlyEnabled:function(enable){this._isPercentOnly=enable},setActiveEnabled:function(enable){this._actived=enable},refreshLayout:function(){if(this._actived){var parent=this._getOwnerParent();if(null!==parent){var parentSize=parent.getContentSize(),locOwner=this._owner,ownerAnchor=locOwner.getAnchorPoint(),ownerSize=locOwner.getContentSize(),ownerPosition=locOwner.getPosition();switch(this._horizontalEdge){case ccui.LayoutComponent.horizontalEdge.NONE:this._usingStretchWidth&&!this._isPercentOnly?(ownerSize.width=parentSize.width*this._percentWidth,ownerPosition.x=this._leftMargin+ownerAnchor.x*ownerSize.width):(this._usingPositionPercentX&&(ownerPosition.x=parentSize.width*this._positionPercentX),this._usingPercentWidth&&(ownerSize.width=parentSize.width*this._percentWidth));break;case ccui.LayoutComponent.horizontalEdge.LEFT:if(this._isPercentOnly)break;(this._usingPercentWidth||this._usingStretchWidth)&&(ownerSize.width=parentSize.width*this._percentWidth),ownerPosition.x=this._leftMargin+ownerAnchor.x*ownerSize.width;break;case ccui.LayoutComponent.horizontalEdge.RIGHT:if(this._isPercentOnly)break;(this._usingPercentWidth||this._usingStretchWidth)&&(ownerSize.width=parentSize.width*this._percentWidth),ownerPosition.x=parentSize.width-(this._rightMargin+(1-ownerAnchor.x)*ownerSize.width);break;case ccui.LayoutComponent.horizontalEdge.CENTER:if(this._isPercentOnly)break;this._usingStretchWidth?(ownerSize.width=parentSize.width-this._leftMargin-this._rightMargin,ownerSize.width<0&&(ownerSize.width=0),ownerPosition.x=this._leftMargin+ownerAnchor.x*ownerSize.width):(this._usingPercentWidth&&(ownerSize.width=parentSize.width*this._percentWidth),ownerPosition.x=parentSize.width*this._positionPercentX)}switch(this._verticalEdge){case ccui.LayoutComponent.verticalEdge.NONE:this._usingStretchHeight&&!this._isPercentOnly?(ownerSize.height=parentSize.height*this._percentHeight,ownerPosition.y=this._bottomMargin+ownerAnchor.y*ownerSize.height):(this._usingPositionPercentY&&(ownerPosition.y=parentSize.height*this._positionPercentY),this._usingPercentHeight&&(ownerSize.height=parentSize.height*this._percentHeight));break;case ccui.LayoutComponent.verticalEdge.BOTTOM:if(this._isPercentOnly)break;(this._usingPercentHeight||this._usingStretchHeight)&&(ownerSize.height=parentSize.height*this._percentHeight),ownerPosition.y=this._bottomMargin+ownerAnchor.y*ownerSize.height;break;case ccui.LayoutComponent.verticalEdge.TOP:if(this._isPercentOnly)break;(this._usingPercentHeight||this._usingStretchHeight)&&(ownerSize.height=parentSize.height*this._percentHeight),ownerPosition.y=parentSize.height-(this._topMargin+(1-ownerAnchor.y)*ownerSize.height);break;case ccui.LayoutComponent.verticalEdge.CENTER:if(this._isPercentOnly)break;this._usingStretchHeight?(ownerSize.height=parentSize.height-this._topMargin-this._bottomMargin,ownerSize.height<0&&(ownerSize.height=0),ownerPosition.y=this._bottomMargin+ownerAnchor.y*ownerSize.height):(this._usingPercentHeight&&(ownerSize.height=parentSize.height*this._percentHeight),ownerPosition.y=parentSize.height*this._positionPercentY)}if(locOwner.setPosition(ownerPosition),locOwner.setContentSize(ownerSize),locOwner instanceof ccui.PageView){locOwner.forceDoLayout();for(var layoutVector=locOwner.getPages(),i=0;i<layoutVector.length;i++)ccui.helper.doLayout(layoutVector[i])}else ccui.helper.doLayout(locOwner)}}},_getOwnerParent:function(){return this._owner?this._owner.getParent():null},_refreshHorizontalMargin:function(){var parent=this._getOwnerParent();if(null!==parent){var ownerPoint=this._owner.getPosition(),ownerAnchor=this._owner.getAnchorPoint(),ownerSize=this._owner.getContentSize(),parentSize=parent.getContentSize();this._leftMargin=ownerPoint.x-ownerAnchor.x*ownerSize.width,this._rightMargin=parentSize.width-(ownerPoint.x+(1-ownerAnchor.x)*ownerSize.width)}},_refreshVerticalMargin:function(){var parent=this._getOwnerParent();if(null!==parent){var ownerPoint=this._owner.getPosition(),ownerAnchor=this._owner.getAnchorPoint(),ownerSize=this._owner.getContentSize(),parentSize=parent.getContentSize();this._bottomMargin=ownerPoint.y-ownerAnchor.y*ownerSize.height,this._topMargin=parentSize.height-(ownerPoint.y+(1-ownerAnchor.y)*ownerSize.height)}}}),ccui.LayoutComponent.horizontalEdge={NONE:0,LEFT:1,RIGHT:2,CENTER:3},ccui.LayoutComponent.verticalEdge={NONE:0,BOTTOM:1,TOP:2,CENTER:3},ccui.LayoutComponent.NAME="__ui_layout",ccui.LayoutComponent.bindLayoutComponent=function(node){var layout=node.getComponent(ccui.LayoutComponent.NAME);return void 0!==layout?layout:((layout=new ccui.LayoutComponent).init(),node.addComponent(layout),node instanceof ccui.Widget||node.addEventListener&&node.addEventListener("load",function(){layout.refreshLayout()},this),layout)};var ccs=ccs||{};ccs.Class=ccs.Class||cc.Class,ccs.Class.extend=ccs.Class.extend||cc.Class.extend,ccs.Node=ccs.Node||cc.Node,ccs.Node.extend=ccs.Node.extend||cc.Node.extend,ccs.Sprite=ccs.Sprite||cc.Sprite,ccs.Sprite.extend=ccs.Sprite.extend||cc.Sprite.extend,ccs.Component=ccs.Component||cc.Component,ccs.Component.extend=ccs.Component.extend||cc.Component.extend,ccs.cocostudioVersion="v1.3.0.0",ccs.VERSION_COMBINED=.3,ccs.VERSION_CHANGE_ROTATION_RANGE=1,ccs.VERSION_COLOR_READING=1.1,ccs.MAX_VERTEXZ_VALUE=5e6,ccs.ARMATURE_MAX_CHILD=50,ccs.ARMATURE_MAX_ZORDER=100,ccs.ARMATURE_MAX_COUNT=ccs.MAX_VERTEXZ_VALUE/ccs.ARMATURE_MAX_CHILD/ccs.ARMATURE_MAX_ZORDER,ccs.AUTO_ADD_SPRITE_FRAME_NAME_PREFIX=!1,ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT=!1,ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX=!1,ccs.armatureVersion=function(){return"v1.1.0.0"},ccs.CONST_VERSION="version",ccs.CONST_VERSION_2_0=2,ccs.CONST_VERSION_COMBINED=.3,ccs.CONST_ARMATURES="armatures",ccs.CONST_ARMATURE="armature",ccs.CONST_BONE="b",ccs.CONST_DISPLAY="d",ccs.CONST_ANIMATIONS="animations",ccs.CONST_ANIMATION="animation",ccs.CONST_MOVEMENT="mov",ccs.CONST_FRAME="f",ccs.CONST_TEXTURE_ATLAS="TextureAtlas",ccs.CONST_SUB_TEXTURE="SubTexture",ccs.CONST_SKELETON="skeleton",ccs.CONST_A_NAME="name",ccs.CONST_A_DURATION="dr",ccs.CONST_A_FRAME_INDEX="fi",ccs.CONST_A_DURATION_TO="to",ccs.CONST_A_DURATION_TWEEN="drTW",ccs.CONST_A_LOOP="lp",ccs.CONST_A_MOVEMENT_SCALE="sc",ccs.CONST_A_MOVEMENT_DELAY="dl",ccs.CONST_A_DISPLAY_INDEX="dI",ccs.CONST_A_PLIST="plist",ccs.CONST_A_PARENT="parent",ccs.CONST_A_SKEW_X="kX",ccs.CONST_A_SKEW_Y="kY",ccs.CONST_A_SCALE_X="cX",ccs.CONST_A_SCALE_Y="cY",ccs.CONST_A_Z="z",ccs.CONST_A_EVENT="evt",ccs.CONST_A_SOUND="sd",ccs.CONST_A_SOUND_EFFECT="sdE",ccs.CONST_A_TWEEN_EASING="twE",ccs.CONST_A_EASING_PARAM="twEP",ccs.CONST_A_TWEEN_ROTATE="twR",ccs.CONST_A_IS_ARMATURE="isArmature",ccs.CONST_A_DISPLAY_TYPE="displayType",ccs.CONST_A_MOVEMENT="mov",ccs.CONST_A_X="x",ccs.CONST_A_Y="y",ccs.CONST_A_COCOS2DX_X="cocos2d_x",ccs.CONST_A_COCOS2DX_Y="cocos2d_y",ccs.CONST_A_WIDTH="width",ccs.CONST_A_HEIGHT="height",ccs.CONST_A_PIVOT_X="pX",ccs.CONST_A_PIVOT_Y="pY",ccs.CONST_A_COCOS2D_PIVOT_X="cocos2d_pX",ccs.CONST_A_COCOS2D_PIVOT_Y="cocos2d_pY",ccs.CONST_A_BLEND_TYPE="bd",ccs.CONST_A_BLEND_SRC="bd_src",ccs.CONST_A_BLEND_DST="bd_dst",ccs.CONST_A_ALPHA="a",ccs.CONST_A_RED="r",ccs.CONST_A_GREEN="g",ccs.CONST_A_BLUE="b",ccs.CONST_A_ALPHA_OFFSET="aM",ccs.CONST_A_RED_OFFSET="rM",ccs.CONST_A_GREEN_OFFSET="gM",ccs.CONST_A_BLUE_OFFSET="bM",ccs.CONST_A_COLOR_TRANSFORM="colorTransform",ccs.CONST_A_TWEEN_FRAME="tweenFrame",ccs.CONST_CONTOUR="con",ccs.CONST_CONTOUR_VERTEX="con_vt",ccs.CONST_FL_NAN="NaN",ccs.CONST_FRAME_DATA="frame_data",ccs.CONST_MOVEMENT_BONE_DATA="mov_bone_data",ccs.CONST_MOVEMENT_DATA="mov_data",ccs.CONST_ANIMATION_DATA="animation_data",ccs.CONST_DISPLAY_DATA="display_data",ccs.CONST_SKIN_DATA="skin_data",ccs.CONST_BONE_DATA="bone_data",ccs.CONST_ARMATURE_DATA="armature_data",ccs.CONST_CONTOUR_DATA="contour_data",ccs.CONST_TEXTURE_DATA="texture_data",ccs.CONST_VERTEX_POINT="vertex",ccs.CONST_COLOR_INFO="color",ccs.CONST_CONFIG_FILE_PATH="config_file_path",ccs.CONST_CONTENT_SCALE="content_scale",ccs.DataInfo=function(){this.asyncStruct=null,this.configFileQueue=[],this.contentScale=1,this.filename="",this.baseFilePath="",this.flashToolVersion=0,this.cocoStudioVersion=0},ccs.dataReaderHelper={ConfigType:{DragonBone_XML:0,CocoStudio_JSON:1,CocoStudio_Binary:2},_configFileList:[],_flashToolVersion:ccs.CONST_VERSION_2_0,_positionReadScale:1,_asyncRefCount:0,_asyncRefTotalCount:0,_dataQueue:null,setPositionReadScale:function(scale){this._positionReadScale=scale},getPositionReadScale:function(){return this._positionReadScale},addDataFromFile:function(filePath){if(-1===this._configFileList.indexOf(filePath)){this._configFileList.push(filePath);var basefilePath=this._initBaseFilePath(filePath),str=cc.path.extname(filePath).toLowerCase(),dataInfo=new ccs.DataInfo;dataInfo.filename=filePath,dataInfo.basefilePath=basefilePath,".xml"===str?ccs.dataReaderHelper.addDataFromXML(filePath,dataInfo):".json"===str||".exportjson"===str?ccs.dataReaderHelper.addDataFromJson(filePath,dataInfo):".csb"===str&&ccs.dataReaderHelper.addDataFromBinaryCache(filePath,dataInfo)}},addDataFromFileAsync:function(imagePath,plistPath,filePath,selector,target){if(-1===this._configFileList.indexOf(filePath)){this._asyncRefTotalCount++,this._asyncRefCount++;var self=this;cc.director.getScheduler().schedule(function(){self.addDataFromFile(filePath),self._asyncRefCount--,self._asyncCallBack(selector,target,(self._asyncRefTotalCount-self._asyncRefCount)/self._asyncRefTotalCount)},this,.1,!1,0,!1,"armatrueDataHelper")}else target&&selector&&(0===this._asyncRefTotalCount&&0===this._asyncRefCount?this._asyncCallBack(selector,target,1):this._asyncCallBack(selector,target,(this._asyncRefTotalCount-this._asyncRefCount)/this._asyncRefTotalCount))},removeConfigFile:function(configFile){for(var locFileList=this._configFileList,len=locFileList.length,it=locFileList[len],i=0;i<len;i++)locFileList[i]===configFile&&(it=i);it!==locFileList[len]&&cc.arrayRemoveObject(locFileList,configFile)},addDataFromCache:function(skeleton,dataInfo){if(skeleton){dataInfo.flashToolVersion=parseFloat(skeleton.getAttribute(ccs.CONST_VERSION));var i,armaturesXML=skeleton.querySelectorAll(ccs.CONST_SKELETON+" > "+ccs.CONST_ARMATURES+" >  "+ccs.CONST_ARMATURE),armatureDataManager=ccs.armatureDataManager;for(i=0;i<armaturesXML.length;i++){var armatureData=this.decodeArmature(armaturesXML[i],dataInfo);armatureDataManager.addArmatureData(armatureData.name,armatureData,dataInfo.filename)}var animationsXML=skeleton.querySelectorAll(ccs.CONST_SKELETON+" > "+ccs.CONST_ANIMATIONS+" >  "+ccs.CONST_ANIMATION);for(i=0;i<animationsXML.length;i++){var animationData=this.decodeAnimation(animationsXML[i],dataInfo);armatureDataManager.addAnimationData(animationData.name,animationData,dataInfo.filename)}var texturesXML=skeleton.querySelectorAll(ccs.CONST_SKELETON+" > "+ccs.CONST_TEXTURE_ATLAS+" >  "+ccs.CONST_SUB_TEXTURE);for(i=0;i<texturesXML.length;i++){var textureData=this.decodeTexture(texturesXML[i],dataInfo);armatureDataManager.addTextureData(textureData.name,textureData,dataInfo.filename)}}else cc.log("XML error  or  XML is empty.")},decodeArmature:function(armatureXML,dataInfo){var armatureData=new ccs.ArmatureData;armatureData.init(),armatureData.name=armatureXML.getAttribute(ccs.CONST_A_NAME);for(var bonesXML=armatureXML.querySelectorAll(ccs.CONST_ARMATURE+" > "+ccs.CONST_BONE),i=0;i<bonesXML.length;i++){var boneXML=bonesXML[i],parentName=boneXML.getAttribute(ccs.CONST_A_PARENT),parentXML=null;if(parentName)for(var j=0;j<bonesXML.length&&(parentXML=bonesXML[j],parentName!=bonesXML[j].getAttribute(ccs.CONST_A_NAME));j++);var boneData=this.decodeBone(boneXML,parentXML,dataInfo);armatureData.addBoneData(boneData)}return armatureData},decodeArmatureFromJSON:function(json,dataInfo){var armatureData=new ccs.ArmatureData;armatureData.init();var name=json[ccs.CONST_A_NAME];name&&(armatureData.name=name),dataInfo.cocoStudioVersion=armatureData.dataVersion=json[ccs.CONST_VERSION]||.1;for(var boneDataList=json[ccs.CONST_BONE_DATA],i=0;i<boneDataList.length;i++){var boneData=this.decodeBoneFromJson(boneDataList[i],dataInfo);armatureData.addBoneData(boneData)}return armatureData},decodeBone:function(boneXML,parentXML,dataInfo){var boneData=new ccs.BoneData;boneData.init(),boneData.name=boneXML.getAttribute(ccs.CONST_A_NAME),boneData.parentName=boneXML.getAttribute(ccs.CONST_A_PARENT)||"",boneData.zOrder=parseInt(boneXML.getAttribute(ccs.CONST_A_Z))||0;for(var displaysXML=boneXML.querySelectorAll(ccs.CONST_BONE+" > "+ccs.CONST_DISPLAY),i=0;i<displaysXML.length;i++){var displayXML=displaysXML[i],displayData=this.decodeBoneDisplay(displayXML,dataInfo);boneData.addDisplayData(displayData)}return boneData},decodeBoneFromJson:function(json,dataInfo){var boneData=new ccs.BoneData;boneData.init(),this.decodeNodeFromJson(boneData,json,dataInfo),boneData.name=json[ccs.CONST_A_NAME]||"",boneData.parentName=json[ccs.CONST_A_PARENT]||"";for(var displayDataList=json[ccs.CONST_DISPLAY_DATA]||[],i=0;i<displayDataList.length;i++){var locDisplayData=this.decodeBoneDisplayFromJson(displayDataList[i],dataInfo);boneData.addDisplayData(locDisplayData)}return boneData},decodeBoneDisplay:function(displayXML,dataInfo){var displayData=null;1===(parseFloat(displayXML.getAttribute(ccs.CONST_A_IS_ARMATURE))||0)?(displayData=new ccs.ArmatureDisplayData).displayType=ccs.DISPLAY_TYPE_ARMATURE:(displayData=new ccs.SpriteDisplayData).displayType=ccs.DISPLAY_TYPE_SPRITE;var displayName=displayXML.getAttribute(ccs.CONST_A_NAME)||"";return displayName&&(displayData.displayName=displayName),displayData},decodeBoneDisplayFromJson:function(json,dataInfo){var displayType=json[ccs.CONST_A_DISPLAY_TYPE]||ccs.DISPLAY_TYPE_SPRITE,displayData=null;switch(displayType){case ccs.DISPLAY_TYPE_SPRITE:displayData=new ccs.SpriteDisplayData,null!=(name=json[ccs.CONST_A_NAME])&&(displayData.displayName=name);var dic=(json[ccs.CONST_SKIN_DATA]||[])[0];if(dic){var skinData=displayData.skinData;skinData.x=dic[ccs.CONST_A_X]*this._positionReadScale,skinData.y=dic[ccs.CONST_A_Y]*this._positionReadScale,skinData.scaleX=null==dic[ccs.CONST_A_SCALE_X]?1:dic[ccs.CONST_A_SCALE_X],skinData.scaleY=null==dic[ccs.CONST_A_SCALE_Y]?1:dic[ccs.CONST_A_SCALE_Y],skinData.skewX=null==dic[ccs.CONST_A_SKEW_X]?1:dic[ccs.CONST_A_SKEW_X],skinData.skewY=null==dic[ccs.CONST_A_SKEW_Y]?1:dic[ccs.CONST_A_SKEW_Y],skinData.x*=dataInfo.contentScale,skinData.y*=dataInfo.contentScale}break;case ccs.DISPLAY_TYPE_ARMATURE:displayData=new ccs.ArmatureDisplayData;var name=json[ccs.CONST_A_NAME];null!=name&&(displayData.displayName=json[ccs.CONST_A_NAME]);break;case ccs.DISPLAY_TYPE_PARTICLE:displayData=new ccs.ParticleDisplayData;var plist=json[ccs.CONST_A_PLIST];null!=plist&&(dataInfo.asyncStruct?displayData.displayName=dataInfo.asyncStruct.basefilePath+plist:displayData.displayName=dataInfo.basefilePath+plist);break;default:displayData=new ccs.SpriteDisplayData}return displayData.displayType=displayType,displayData},decodeAnimation:function(animationXML,dataInfo){var aniData=new ccs.AnimationData,name=animationXML.getAttribute(ccs.CONST_A_NAME),armatureData=ccs.armatureDataManager.getArmatureData(name);aniData.name=name;for(var movementsXML=animationXML.querySelectorAll(ccs.CONST_ANIMATION+" > "+ccs.CONST_MOVEMENT),movementXML=null,i=0;i<movementsXML.length;i++){movementXML=movementsXML[i];var movementData=this.decodeMovement(movementXML,armatureData,dataInfo);aniData.addMovement(movementData)}return aniData},decodeAnimationFromJson:function(json,dataInfo){var aniData=new ccs.AnimationData;json[ccs.CONST_A_NAME]&&(aniData.name=json[ccs.CONST_A_NAME]);for(var movementDataList=json[ccs.CONST_MOVEMENT_DATA]||[],i=0;i<movementDataList.length;i++){var locMovementData=this.decodeMovementFromJson(movementDataList[i],dataInfo);aniData.addMovement(locMovementData)}return aniData},decodeMovement:function(movementXML,armatureData,dataInfo){var movementData=new ccs.MovementData;movementData.name=movementXML.getAttribute(ccs.CONST_A_NAME);var duration,durationTo,durationTween,loop,tweenEasing=0;duration=movementXML.getAttribute(ccs.CONST_A_DURATION),movementData.duration=null==duration?0:parseFloat(duration),durationTo=movementXML.getAttribute(ccs.CONST_A_DURATION_TO),movementData.durationTo=null==durationTo?0:parseFloat(durationTo),durationTween=movementXML.getAttribute(ccs.CONST_A_DURATION_TWEEN),movementData.durationTween=null==durationTween?0:parseFloat(durationTween),loop=movementXML.getAttribute(ccs.CONST_A_LOOP),movementData.loop=!loop||Boolean(parseFloat(loop));var easing=movementXML.getAttribute(ccs.CONST_A_TWEEN_EASING);easing&&(easing!=ccs.CONST_FL_NAN?(tweenEasing=null==easing?0:parseFloat(easing),movementData.tweenEasing=2===tweenEasing?ccs.TweenType.SINE_EASEINOUT:tweenEasing):movementData.tweenEasing=ccs.TweenType.LINEAR);for(var movBonesXml=movementXML.querySelectorAll(ccs.CONST_MOVEMENT+" > "+ccs.CONST_BONE),movBoneXml=null,i=0;i<movBonesXml.length;i++){var boneName=(movBoneXml=movBonesXml[i]).getAttribute(ccs.CONST_A_NAME);if(!movementData.getMovementBoneData(boneName)){var boneData=armatureData.getBoneData(boneName),parentName=boneData.parentName,parentXML=null;if(""!==parentName)for(var j=0;j<movBonesXml.length&&(parentXML=movBonesXml[j],parentName!==parentXML.getAttribute(ccs.CONST_A_NAME));j++);var moveBoneData=this.decodeMovementBone(movBoneXml,parentXML,boneData,dataInfo);movementData.addMovementBoneData(moveBoneData)}}return movementData},decodeMovementFromJson:function(json,dataInfo){var movementData=new ccs.MovementData;movementData.loop=null!=json[ccs.CONST_A_LOOP]&&json[ccs.CONST_A_LOOP],movementData.durationTween=json[ccs.CONST_A_DURATION_TWEEN]||0,movementData.durationTo=json[ccs.CONST_A_DURATION_TO]||0,movementData.duration=json[ccs.CONST_A_DURATION]||0,null==json[ccs.CONST_A_DURATION]?movementData.scale=1:movementData.scale=null==json[ccs.CONST_A_MOVEMENT_SCALE]?1:json[ccs.CONST_A_MOVEMENT_SCALE],movementData.tweenEasing=null==json[ccs.CONST_A_TWEEN_EASING]?ccs.TweenType.LINEAR:json[ccs.CONST_A_TWEEN_EASING];var name=json[ccs.CONST_A_NAME];name&&(movementData.name=name);for(var movementBoneList=json[ccs.CONST_MOVEMENT_BONE_DATA]||[],i=0;i<movementBoneList.length;i++){var locMovementBoneData=this.decodeMovementBoneFromJson(movementBoneList[i],dataInfo);movementData.addMovementBoneData(locMovementBoneData)}return movementData},decodeMovementBone:function(movBoneXml,parentXml,boneData,dataInfo){var movBoneData=new ccs.MovementBoneData;movBoneData.init();var scale,delay;movBoneXml&&(scale=parseFloat(movBoneXml.getAttribute(ccs.CONST_A_MOVEMENT_SCALE))||0,movBoneData.scale=scale,(delay=parseFloat(movBoneXml.getAttribute(ccs.CONST_A_MOVEMENT_DELAY))||0)>0&&(delay-=1),movBoneData.delay=delay);var length=0,parentTotalDuration=0,currentDuration=0,parentFrameXML=null,parentXMLList=[];if(null!=parentXml){for(var parentFramesXML=parentXml.querySelectorAll(ccs.CONST_BONE+" > "+ccs.CONST_FRAME),i=0;i<parentFramesXML.length;i++)parentXMLList.push(parentFramesXML[i]);length=parentXMLList.length}movBoneData.name=movBoneXml.getAttribute(ccs.CONST_A_NAME);for(var framesXML=movBoneXml.querySelectorAll(ccs.CONST_BONE+" > "+ccs.CONST_FRAME),j=0,totalDuration=0,ii=0;ii<framesXML.length;ii++){var frameXML=framesXML[ii];if(parentXml)for(;j<length&&(!parentFrameXML||(totalDuration<parentTotalDuration||totalDuration>=parentTotalDuration+currentDuration));)parentFrameXML=parentXMLList[j],parentTotalDuration+=currentDuration,currentDuration=parseFloat(parentFrameXML.getAttribute(ccs.CONST_A_DURATION)),j++;var boneFrameData=this.decodeFrame(frameXML,parentFrameXML,boneData,dataInfo);movBoneData.addFrameData(boneFrameData),boneFrameData.frameID=totalDuration,totalDuration+=boneFrameData.duration,movBoneData.duration=totalDuration}for(var frames=movBoneData.frameList,pi=Math.PI,i=frames.length-1;i>=0;i--)if(i>0){var difSkewX=frames[i].skewX-frames[i-1].skewX,difSkewY=frames[i].skewY-frames[i-1].skewY;(difSkewX<-pi||difSkewX>pi)&&(frames[i-1].skewX=difSkewX<0?frames[i-1].skewX-2*pi:frames[i-1].skewX+2*pi),(difSkewY<-pi||difSkewY>pi)&&(frames[i-1].skewY=difSkewY<0?frames[i-1].skewY-2*pi:frames[i-1].skewY+2*pi)}var frameData=new ccs.FrameData;return frameData.copy(movBoneData.frameList[movBoneData.frameList.length-1]),frameData.frameID=movBoneData.duration,movBoneData.addFrameData(frameData),movBoneData},decodeMovementBoneFromJson:function(json,dataInfo){var movementBoneData=new ccs.MovementBoneData;movementBoneData.init(),movementBoneData.delay=json[ccs.CONST_A_MOVEMENT_DELAY]||0;var name=json[ccs.CONST_A_NAME];name&&(movementBoneData.name=name);for(var length=(json[ccs.CONST_FRAME_DATA]||[]).length,i=0;i<length;i++){var dic=json[ccs.CONST_FRAME_DATA][i],frameData=this.decodeFrameFromJson(dic,dataInfo);movementBoneData.addFrameData(frameData),dataInfo.cocoStudioVersion<ccs.CONST_VERSION_COMBINED&&(frameData.frameID=movementBoneData.duration,movementBoneData.duration+=frameData.duration)}if(dataInfo.cocoStudioVersion<ccs.VERSION_CHANGE_ROTATION_RANGE)for(var frames=movementBoneData.frameList,pi=Math.PI,i=frames.length-1;i>=0;i--)if(i>0){var difSkewX=frames[i].skewX-frames[i-1].skewX,difSkewY=frames[i].skewY-frames[i-1].skewY;(difSkewX<-pi||difSkewX>pi)&&(frames[i-1].skewX=difSkewX<0?frames[i-1].skewX-2*pi:frames[i-1].skewX+2*pi),(difSkewY<-pi||difSkewY>pi)&&(frames[i-1].skewY=difSkewY<0?frames[i-1].skewY-2*pi:frames[i-1].skewY+2*pi)}return dataInfo.cocoStudioVersion<ccs.CONST_VERSION_COMBINED&&movementBoneData.frameList.length>0&&((frameData=new ccs.FrameData).copy(movementBoneData.frameList[movementBoneData.frameList.length-1]),movementBoneData.addFrameData(frameData),frameData.frameID=movementBoneData.duration),movementBoneData},decodeFrame:function(frameXML,parentFrameXml,boneData,dataInfo){var x=0,y=0,scale_x=0,scale_y=0,skew_x=0,skew_y=0,tweenRotate=0,duration=0,displayIndex=0,zOrder=0,tweenEasing=0,blendType=0,frameData=new ccs.FrameData;frameData.strMovement=frameXML.getAttribute(ccs.CONST_A_MOVEMENT)||"",frameData.movement=frameData.strMovement,frameData.strEvent=frameXML.getAttribute(ccs.CONST_A_EVENT)||"",frameData.event=frameData.strEvent,frameData.strSound=frameXML.getAttribute(ccs.CONST_A_SOUND)||"",frameData.sound=frameData.strSound,frameData.strSoundEffect=frameXML.getAttribute(ccs.CONST_A_SOUND_EFFECT)||"",frameData.soundEffect=frameData.strSoundEffect;var isTween=frameXML.getAttribute(ccs.CONST_A_TWEEN_FRAME);if(frameData.isTween=!(void 0!==isTween&&("false"===isTween||"0"===isTween)),dataInfo.flashToolVersion>=ccs.CONST_VERSION_2_0?((x=frameXML.getAttribute(ccs.CONST_A_COCOS2DX_X))&&(frameData.x=parseFloat(x),frameData.x*=this._positionReadScale),(y=frameXML.getAttribute(ccs.CONST_A_COCOS2DX_Y))&&(frameData.y=-parseFloat(y),frameData.y*=this._positionReadScale)):((x=frameXML.getAttribute(ccs.CONST_A_X))&&(frameData.x=parseFloat(x),frameData.x*=this._positionReadScale),(y=frameXML.getAttribute(ccs.CONST_A_Y))&&(frameData.y=-parseFloat(y),frameData.y*=this._positionReadScale)),null!=(scale_x=frameXML.getAttribute(ccs.CONST_A_SCALE_X))&&(frameData.scaleX=parseFloat(scale_x)),null!=(scale_y=frameXML.getAttribute(ccs.CONST_A_SCALE_Y))&&(frameData.scaleY=parseFloat(scale_y)),null!=(skew_x=frameXML.getAttribute(ccs.CONST_A_SKEW_X))&&(frameData.skewX=cc.degreesToRadians(parseFloat(skew_x))),null!=(skew_y=frameXML.getAttribute(ccs.CONST_A_SKEW_Y))&&(frameData.skewY=cc.degreesToRadians(-parseFloat(skew_y))),null!=(duration=frameXML.getAttribute(ccs.CONST_A_DURATION))&&(frameData.duration=parseFloat(duration)),null!=(displayIndex=frameXML.getAttribute(ccs.CONST_A_DISPLAY_INDEX))&&(frameData.displayIndex=parseFloat(displayIndex)),null!=(zOrder=frameXML.getAttribute(ccs.CONST_A_Z))&&(frameData.zOrder=parseInt(zOrder)),null!=(tweenRotate=frameXML.getAttribute(ccs.CONST_A_TWEEN_ROTATE))&&(frameData.tweenRotate=parseFloat(tweenRotate)),null!=(blendType=frameXML.getAttribute(ccs.CONST_A_BLEND_TYPE))){var blendFunc=frameData.blendFunc;switch(blendType){case ccs.BLEND_TYPE_NORMAL:blendFunc.src=cc.BLEND_SRC,blendFunc.dst=cc.BLEND_DST;break;case ccs.BLEND_TYPE_ADD:blendFunc.src=cc.SRC_ALPHA,blendFunc.dst=cc.ONE;break;case ccs.BLEND_TYPE_MULTIPLY:blendFunc.src=cc.DST_COLOR,blendFunc.dst=cc.ONE_MINUS_SRC_ALPHA;break;case ccs.BLEND_TYPE_SCREEN:blendFunc.src=cc.ONE,blendFunc.dst=cc.ONE_MINUS_DST_COLOR;break;default:frameData.blendFunc.src=cc.BLEND_SRC,frameData.blendFunc.dst=cc.BLEND_DST}}var colorTransformXML=frameXML.querySelectorAll(ccs.CONST_FRAME+" > "+ccs.CONST_A_COLOR_TRANSFORM);if(colorTransformXML&&colorTransformXML.length>0){colorTransformXML=colorTransformXML[0];var alpha,red,green,blue,alphaOffset,redOffset,greenOffset,blueOffset;alpha=parseFloat(colorTransformXML.getAttribute(ccs.CONST_A_ALPHA))||0,red=parseFloat(colorTransformXML.getAttribute(ccs.CONST_A_RED))||0,green=parseFloat(colorTransformXML.getAttribute(ccs.CONST_A_GREEN))||0,blue=parseFloat(colorTransformXML.getAttribute(ccs.CONST_A_BLUE))||0,alphaOffset=parseFloat(colorTransformXML.getAttribute(ccs.CONST_A_ALPHA_OFFSET))||0,redOffset=parseFloat(colorTransformXML.getAttribute(ccs.CONST_A_RED_OFFSET))||0,greenOffset=parseFloat(colorTransformXML.getAttribute(ccs.CONST_A_GREEN_OFFSET))||0,blueOffset=parseFloat(colorTransformXML.getAttribute(ccs.CONST_A_BLUE_OFFSET))||0,frameData.a=2.55*alphaOffset+alpha,frameData.r=2.55*redOffset+red,frameData.g=2.55*greenOffset+green,frameData.b=2.55*blueOffset+blue,frameData.isUseColorInfo=!0}var _easing=frameXML.getAttribute(ccs.CONST_A_TWEEN_EASING);if(null!=_easing&&(_easing!=ccs.CONST_FL_NAN?(tweenEasing=frameXML.getAttribute(ccs.CONST_A_TWEEN_EASING))&&(frameData.tweenEasing=2===tweenEasing?ccs.TweenType.SINE_EASEINOUT:tweenEasing):frameData.tweenEasing=ccs.TweenType.LINEAR),parentFrameXml){var helpNode=new ccs.BaseData;dataInfo.flashToolVersion>=ccs.CONST_VERSION_2_0?(helpNode.x=parseFloat(parentFrameXml.getAttribute(ccs.CONST_A_COCOS2DX_X)),helpNode.y=parseFloat(parentFrameXml.getAttribute(ccs.CONST_A_COCOS2DX_Y))):(helpNode.x=parseFloat(parentFrameXml.getAttribute(ccs.CONST_A_X)),helpNode.y=parseFloat(parentFrameXml.getAttribute(ccs.CONST_A_Y))),helpNode.skewX=parseFloat(parentFrameXml.getAttribute(ccs.CONST_A_SKEW_X)),helpNode.skewY=parseFloat(parentFrameXml.getAttribute(ccs.CONST_A_SKEW_Y)),helpNode.y=-helpNode.y,helpNode.skewX=cc.degreesToRadians(helpNode.skewX),helpNode.skewY=cc.degreesToRadians(-helpNode.skewY),ccs.TransformHelp.transformFromParent(frameData,helpNode)}return frameData},decodeFrameFromJson:function(json,dataInfo){var frameData=new ccs.FrameData;this.decodeNodeFromJson(frameData,json,dataInfo),frameData.tweenEasing=json[ccs.CONST_A_TWEEN_EASING]||ccs.TweenType.LINEAR,frameData.displayIndex=json[ccs.CONST_A_DISPLAY_INDEX];var bd_src=null==json[ccs.CONST_A_BLEND_SRC]?cc.BLEND_SRC:json[ccs.CONST_A_BLEND_SRC],bd_dst=null==json[ccs.CONST_A_BLEND_DST]?cc.BLEND_DST:json[ccs.CONST_A_BLEND_DST];frameData.blendFunc.src=bd_src,frameData.blendFunc.dst=bd_dst,frameData.isTween=null==json[ccs.CONST_A_TWEEN_FRAME]||json[ccs.CONST_A_TWEEN_FRAME];var event=json[ccs.CONST_A_EVENT];null!=event&&(frameData.strEvent=event,frameData.event=event),dataInfo.cocoStudioVersion<ccs.CONST_VERSION_COMBINED?frameData.duration=null==json[ccs.CONST_A_DURATION]?1:json[ccs.CONST_A_DURATION]:frameData.frameID=json[ccs.CONST_A_FRAME_INDEX];for(var twEPs=json[ccs.CONST_A_EASING_PARAM]||[],i=0;i<twEPs.length;i++)frameData.easingParams[i]=twEPs[i];return frameData},decodeTexture:function(textureXML,dataInfo){var textureData=new ccs.TextureData;textureData.init(),textureXML.getAttribute(ccs.CONST_A_NAME)&&(textureData.name=textureXML.getAttribute(ccs.CONST_A_NAME));var px,py;dataInfo.flashToolVersion>=ccs.CONST_VERSION_2_0?(px=parseFloat(textureXML.getAttribute(ccs.CONST_A_COCOS2D_PIVOT_X))||0,py=parseFloat(textureXML.getAttribute(ccs.CONST_A_COCOS2D_PIVOT_Y))||0):(px=parseFloat(textureXML.getAttribute(ccs.CONST_A_PIVOT_X))||0,py=parseFloat(textureXML.getAttribute(ccs.CONST_A_PIVOT_Y))||0);var width=parseFloat(textureXML.getAttribute(ccs.CONST_A_WIDTH))||0,height=parseFloat(textureXML.getAttribute(ccs.CONST_A_HEIGHT))||0,anchorPointX=px/width,anchorPointY=(height-py)/height;textureData.pivotX=anchorPointX,textureData.pivotY=anchorPointY;for(var contoursXML=textureXML.querySelectorAll(ccs.CONST_SUB_TEXTURE+" > "+ccs.CONST_CONTOUR),i=0;i<contoursXML.length;i++)textureData.addContourData(this.decodeContour(contoursXML[i],dataInfo));return textureData},decodeTextureFromJson:function(json){var textureData=new ccs.TextureData;textureData.init();var name=json[ccs.CONST_A_NAME];null!=name&&(textureData.name=name),textureData.width=json[ccs.CONST_A_WIDTH]||0,textureData.height=json[ccs.CONST_A_HEIGHT]||0,textureData.pivotX=json[ccs.CONST_A_PIVOT_X]||0,textureData.pivotY=json[ccs.CONST_A_PIVOT_Y]||0;for(var contourDataList=json[ccs.CONST_CONTOUR_DATA]||[],i=0;i<contourDataList.length;i++)textureData.contourDataList.push(this.decodeContourFromJson(contourDataList[i]));return textureData},decodeContour:function(contourXML,dataInfo){var contourData=new ccs.ContourData;contourData.init();for(var vertexDataXML,vertexDatasXML=contourXML.querySelectorAll(ccs.CONST_CONTOUR+" > "+ccs.CONST_CONTOUR_VERTEX),i=0;i<vertexDatasXML.length;i++){vertexDataXML=vertexDatasXML[i];var vertex=cc.p(0,0);vertex.x=parseFloat(vertexDataXML.getAttribute(ccs.CONST_A_X))||0,vertex.y=parseFloat(vertexDataXML.getAttribute(ccs.CONST_A_Y))||0,vertex.y=-vertex.y,contourData.vertexList.push(vertex)}return contourData},decodeContourFromJson:function(json){var contourData=new ccs.ContourData;contourData.init();for(var vertexPointList=json[ccs.CONST_VERTEX_POINT]||[],len=vertexPointList.length,i=0;i<len;i++){var dic=vertexPointList[i],vertex=cc.p(0,0);vertex.x=dic[ccs.CONST_A_X]||0,vertex.y=dic[ccs.CONST_A_Y]||0,contourData.vertexList.push(vertex)}return contourData},addDataFromJsonCache:function(dic,dataInfo){dataInfo.contentScale=null==dic[ccs.CONST_CONTENT_SCALE]?1:dic[ccs.CONST_CONTENT_SCALE];var i,armatureData,armatureDataArr=dic[ccs.CONST_ARMATURE_DATA]||[];for(i=0;i<armatureDataArr.length;i++)armatureData=this.decodeArmatureFromJSON(armatureDataArr[i],dataInfo),ccs.armatureDataManager.addArmatureData(armatureData.name,armatureData,dataInfo.filename);var animationData,animationDataArr=dic[ccs.CONST_ANIMATION_DATA]||[];for(i=0;i<animationDataArr.length;i++)animationData=this.decodeAnimationFromJson(animationDataArr[i],dataInfo),ccs.armatureDataManager.addAnimationData(animationData.name,animationData,dataInfo.filename);var textureData,textureDataArr=dic[ccs.CONST_TEXTURE_DATA]||[];for(i=0;i<textureDataArr.length;i++)textureData=this.decodeTextureFromJson(textureDataArr[i],dataInfo),ccs.armatureDataManager.addTextureData(textureData.name,textureData,dataInfo.filename);if(null==dataInfo.asyncStruct?ccs.armatureDataManager.isAutoLoadSpriteFile():dataInfo.asyncStruct.autoLoadSpriteFile){var locFilePath,locPos,locPlistPath,locImagePath,configFiles=dic[ccs.CONST_CONFIG_FILE_PATH]||[];for(i=0;i<configFiles.length;i++)locPos=(locFilePath=configFiles[i]).lastIndexOf("."),locFilePath=locFilePath.substring(0,locPos),locPlistPath=dataInfo.basefilePath+locFilePath+".plist",locImagePath=dataInfo.basefilePath+locFilePath+".png",ccs.armatureDataManager.addSpriteFrameFromFile(locPlistPath,locImagePath,dataInfo.filename)}armatureData=null,animationData=null},decodeNodeFromJson:function(node,json,dataInfo){node.x=json[ccs.CONST_A_X]*this._positionReadScale,node.y=json[ccs.CONST_A_Y]*this._positionReadScale,node.x*=dataInfo.contentScale,node.y*=dataInfo.contentScale,node.zOrder=json[ccs.CONST_A_Z],node.skewX=json[ccs.CONST_A_SKEW_X]||0,node.skewY=json[ccs.CONST_A_SKEW_Y]||0,node.scaleX=null==json[ccs.CONST_A_SCALE_X]?1:json[ccs.CONST_A_SCALE_X],node.scaleY=null==json[ccs.CONST_A_SCALE_Y]?1:json[ccs.CONST_A_SCALE_Y];var colorDic;dataInfo.cocoStudioVersion<ccs.VERSION_COLOR_READING?(colorDic=json[0])&&(node.a=null==colorDic[ccs.CONST_A_ALPHA]?255:colorDic[ccs.CONST_A_ALPHA],node.r=null==colorDic[ccs.CONST_A_RED]?255:colorDic[ccs.CONST_A_RED],node.g=null==colorDic[ccs.CONST_A_GREEN]?255:colorDic[ccs.CONST_A_GREEN],node.b=null==colorDic[ccs.CONST_A_BLUE]?255:colorDic[ccs.CONST_A_BLUE],node.isUseColorInfo=!0):(colorDic=json[ccs.CONST_COLOR_INFO]||null)&&(node.a=null==colorDic[ccs.CONST_A_ALPHA]?255:colorDic[ccs.CONST_A_ALPHA],node.r=null==colorDic[ccs.CONST_A_RED]?255:colorDic[ccs.CONST_A_RED],node.g=null==colorDic[ccs.CONST_A_GREEN]?255:colorDic[ccs.CONST_A_GREEN],node.b=null==colorDic[ccs.CONST_A_BLUE]?255:colorDic[ccs.CONST_A_BLUE],node.isUseColorInfo=!0)},clear:function(){this._configFileList=[],this._asyncRefCount=0,this._asyncRefTotalCount=0},_asyncCallBack:function(selector,target,percent){selector&&cc.isFunction(selector)&&selector.call(target,percent),target&&selector&&"string"==typeof selector&&target[selector](percent)},_initBaseFilePath:function(filePath){var path=filePath,pos=path.lastIndexOf("/");return path=pos>-1?path.substr(0,pos+1):""},addDataFromXML:function(xml,dataInfo){var xmlStr=cc.loader.getRes(xml);if(!xmlStr)throw new Error("Please load the resource first : "+xml);var skeleton=cc.saxParser.parse(xmlStr).documentElement;skeleton&&this.addDataFromCache(skeleton,dataInfo)},addDataFromJson:function(filePath,dataInfo){var fileContent=cc.loader.getRes(filePath);this.addDataFromJsonCache(fileContent,dataInfo)}},ccs.spriteFrameCacheHelper={_textureAtlasDic:{},_imagePaths:[],addSpriteFrameFromFile:function(plistPath,imagePath){cc.spriteFrameCache.addSpriteFrames(plistPath,imagePath)},getTextureAtlasWithTexture:function(texture){var textureName=texture.getName(),atlas=this._textureAtlasDic[textureName];return null==atlas&&(atlas=new cc.TextureAtlas(texture,20),this._textureAtlasDic[textureName]=atlas),atlas},clear:function(){this._textureAtlasDic={},this._imagePaths=[]}},ccs.TransformHelp=ccs.TransformHelp||ccs.Class.extend({}),ccs.TransformHelp.helpMatrix1=cc.affineTransformMake(1,0,0,1,0,0),ccs.TransformHelp.helpMatrix2=cc.affineTransformMake(1,0,0,1,0,0),ccs.TransformHelp.helpPoint1=cc.p(0,0),ccs.TransformHelp.helpPoint2=cc.p(0,0),ccs.TransformHelp.helpParentNode={},ccs.TransformHelp.transformFromParent=function(bone,parentNode){this.nodeToMatrix(bone,this.helpMatrix1),this.nodeToMatrix(parentNode,this.helpMatrix2),this.helpMatrix2=cc.affineTransformInvert(this.helpMatrix2),this.helpMatrix1=cc.affineTransformConcat(this.helpMatrix1,this.helpMatrix2),this.matrixToNode(this.helpMatrix1,bone)},ccs.TransformHelp.transformToParent=function(node,parentNode){this.nodeToMatrix(node,this.helpMatrix1),this.nodeToMatrix(parentNode,this.helpMatrix2),this.helpMatrix1=cc.affineTransformConcat(this.helpMatrix1,this.helpMatrix2),this.matrixToNode(this.helpMatrix1,node)},ccs.TransformHelp.transformFromParentWithoutScale=function(node,parentNode){for(var p in parentNode)this.helpParentNode[p]=parentNode[p];this.helpParentNode.scaleX=1,this.helpParentNode.scaleY=1,this.nodeToMatrix(node,this.helpMatrix1),this.nodeToMatrix(this.helpParentNode,this.helpMatrix2),this.helpMatrix2=cc.affineTransformInvert(this.helpMatrix2),this.helpMatrix1=cc.affineTransformConcat(this.helpMatrix1,this.helpMatrix2),this.matrixToNode(this.helpMatrix1,node)},ccs.TransformHelp.transformToParentWithoutScale=function(node,parentNode){for(var p in parentNode)this.helpParentNode[p]=parentNode[p];this.helpParentNode.scaleX=1,this.helpParentNode.scaleY=1,this.nodeToMatrix(node,this.helpMatrix1),this.nodeToMatrix(this.helpParentNode,this.helpMatrix2),this.helpMatrix1=cc.affineTransformConcat(this.helpMatrix1,this.helpMatrix2),this.matrixToNode(this.helpMatrix1,node)},ccs.TransformHelp.nodeToMatrix=function(node,matrix){if(node.skewX===-node.skewY){var sine=Math.sin(node.skewX),cosine=Math.cos(node.skewX);matrix.a=node.scaleX*cosine,matrix.b=node.scaleX*-sine,matrix.c=node.scaleY*sine,matrix.d=node.scaleY*cosine}else matrix.a=node.scaleX*Math.cos(node.skewY),matrix.b=node.scaleX*Math.sin(node.skewY),matrix.c=node.scaleY*Math.sin(node.skewX),matrix.d=node.scaleY*Math.cos(node.skewX);matrix.tx=node.x,matrix.ty=node.y},ccs.TransformHelp.matrixToNode=function(matrix,node){this.helpPoint1.x=0,this.helpPoint1.y=1,this.helpPoint1=cc.pointApplyAffineTransform(this.helpPoint1,matrix),this.helpPoint1.x-=matrix.tx,this.helpPoint1.y-=matrix.ty,this.helpPoint2.x=1,this.helpPoint2.y=0,this.helpPoint2=cc.pointApplyAffineTransform(this.helpPoint2,matrix),this.helpPoint2.x-=matrix.tx,this.helpPoint2.y-=matrix.ty,node.skewX=-(Math.atan2(this.helpPoint1.y,this.helpPoint1.x)-1.5707964),node.skewY=Math.atan2(this.helpPoint2.y,this.helpPoint2.x),node.scaleX=Math.sqrt(matrix.a*matrix.a+matrix.b*matrix.b),node.scaleY=Math.sqrt(matrix.c*matrix.c+matrix.d*matrix.d),node.x=matrix.tx,node.y=matrix.ty},ccs.TransformHelp.nodeConcat=function(target,source){target.x+=source.x,target.y+=source.y,target.skewX+=source.skewX,target.skewY+=source.skewY,target.scaleX+=source.scaleX,target.scaleY+=source.scaleY},ccs.TransformHelp.nodeSub=function(target,source){target.x-=source.x,target.y-=source.y,target.skewX-=source.skewX,target.skewY-=source.skewY,target.scaleX-=source.scaleX,target.scaleY-=source.scaleY},ccs.TweenType={CUSTOM_EASING:-1,LINEAR:0,SINE_EASEIN:1,SINE_EASEOUT:2,SINE_EASEINOUT:3,QUAD_EASEIN:4,QUAD_EASEOUT:5,QUAD_EASEINOUT:6,CUBIC_EASEIN:7,CUBIC_EASEOUT:8,CUBIC_EASEINOUT:9,QUART_EASEIN:10,QUART_EASEOUT:11,QUART_EASEINOUT:12,QUINT_EASEIN:13,QUINT_EASEOUT:14,QUINT_EASEINOUT:15,EXPO_EASEIN:16,EXPO_EASEOUT:17,EXPO_EASEINOUT:18,CIRC_EASEIN:19,CIRC_EASEOUT:20,CIRC_EASEINOUT:21,ELASTIC_EASEIN:22,ELASTIC_EASEOUT:23,ELASTIC_EASEINOUT:24,BACK_EASEIN:25,BACK_EASEOUT:26,BACK_EASEINOUT:27,BOUNCE_EASEIN:28,BOUNCE_EASEOUT:29,BOUNCE_EASEINOUT:30,TWEEN_EASING_MAX:1e4},ccs.TweenFunction=ccs.TweenFunction||ccs.Class.extend({}),ccs.DOUBLE_PI=ccs.M_PI_X_2=2*Math.PI,ccs.HALF_PI=ccs.M_PI_2=Math.PI/2,ccs.M_PI=Math.PI,ccs.TweenFunction.tweenTo=function(time,type,easingParam){var delta=0;switch(type){case ccs.TweenType.CUSTOM_EASING:delta=this.customEase(time,easingParam);break;case ccs.TweenType.LINEAR:delta=this.linear(time);break;case ccs.TweenType.SINE_EASEIN:delta=this.sineEaseIn(time);break;case ccs.TweenType.SINE_EASEOUT:delta=this.sineEaseOut(time);break;case ccs.TweenType.SINE_EASEINOUT:delta=this.sineEaseInOut(time);break;case ccs.TweenType.QUAD_EASEIN:delta=this.quadEaseIn(time);break;case ccs.TweenType.QUAD_EASEOUT:delta=this.quadEaseOut(time);break;case ccs.TweenType.QUAD_EASEINOUT:delta=this.quadEaseInOut(time);break;case ccs.TweenType.CUBIC_EASEIN:delta=this.cubicEaseIn(time);break;case ccs.TweenType.CUBIC_EASEOUT:delta=this.cubicEaseOut(time);break;case ccs.TweenType.CUBIC_EASEINOUT:delta=this.cubicEaseInOut(time);break;case ccs.TweenType.QUART_EASEIN:delta=this.quartEaseIn(time);break;case ccs.TweenType.QUART_EASEOUT:delta=this.quartEaseOut(time);break;case ccs.TweenType.QUART_EASEINOUT:delta=this.quartEaseInOut(time);break;case ccs.TweenType.QUINT_EASEIN:delta=this.quintEaseIn(time);break;case ccs.TweenType.QUINT_EASEOUT:delta=this.quintEaseOut(time);break;case ccs.TweenType.QUINT_EASEINOUT:delta=this.quintEaseInOut(time);break;case ccs.TweenType.EXPO_EASEIN:delta=this.expoEaseIn(time);break;case ccs.TweenType.EXPO_EASEOUT:delta=this.expoEaseOut(time);break;case ccs.TweenType.EXPO_EASEINOUT:delta=this.expoEaseInOut(time);break;case ccs.TweenType.CIRC_EASEIN:delta=this.circEaseIn(time);break;case ccs.TweenType.CIRC_EASEOUT:delta=this.circEaseOut(time);break;case ccs.TweenType.CIRC_EASEINOUT:delta=this.circEaseInOut(time);break;case ccs.TweenType.ELASTIC_EASEIN:period=.3;null!=easingParam&&easingParam.length>0&&(period=easingParam[0]),delta=this.elasticEaseIn(time,period);break;case ccs.TweenType.ELASTIC_EASEOUT:period=.3;null!=easingParam&&easingParam.length>0&&(period=easingParam[0]),delta=this.elasticEaseOut(time,period);break;case ccs.TweenType.ELASTIC_EASEINOUT:var period=.3;null!=easingParam&&easingParam.length>0&&(period=easingParam[0]),delta=this.elasticEaseInOut(time,period);break;case ccs.TweenType.BACK_EASEIN:delta=this.backEaseIn(time);break;case ccs.TweenType.BACK_EASEOUT:delta=this.backEaseOut(time);break;case ccs.TweenType.BACK_EASEINOUT:delta=this.backEaseInOut(time);break;case ccs.TweenType.BOUNCE_EASEIN:delta=this.bounceEaseIn(time);break;case ccs.TweenType.BOUNCE_EASEOUT:delta=this.bounceEaseOut(time);break;case ccs.TweenType.BOUNCE_EASEINOUT:delta=this.bounceEaseInOut(time);break;default:delta=this.sineEaseInOut(time)}return delta},ccs.TweenFunction.linear=function(time){return time},ccs.TweenFunction.sineEaseIn=function(time){return-1*Math.cos(time*ccs.HALF_PI)+1},ccs.TweenFunction.sineEaseOut=function(time){return Math.sin(time*ccs.HALF_PI)},ccs.TweenFunction.sineEaseInOut=function(time){return-.5*(Math.cos(ccs.M_PI*time)-1)},ccs.TweenFunction.quadEaseIn=function(time){return time*time},ccs.TweenFunction.quadEaseOut=function(time){return-1*time*(time-2)},ccs.TweenFunction.quadEaseInOut=function(time){return(time*=2)<1?.5*time*time:-.5*(--time*(time-2)-1)},ccs.TweenFunction.cubicEaseIn=function(time){return time*time*time},ccs.TweenFunction.cubicEaseOut=function(time){return(time-=1)*time*time+1},ccs.TweenFunction.cubicEaseInOut=function(time){return(time*=2)<1?.5*time*time*time:.5*((time-=2)*time*time+2)},ccs.TweenFunction.quartEaseIn=function(time){return time*time*time*time},ccs.TweenFunction.quartEaseOut=function(time){return-((time-=1)*time*time*time-1)},ccs.TweenFunction.quartEaseInOut=function(time){return(time*=2)<1?.5*time*time*time*time:-.5*((time-=2)*time*time*time-2)},ccs.TweenFunction.quintEaseIn=function(time){return time*time*time*time*time},ccs.TweenFunction.quintEaseOut=function(time){return(time-=1)*time*time*time*time+1},ccs.TweenFunction.quintEaseInOut=function(time){return(time*=2)<1?.5*time*time*time*time*time:.5*((time-=2)*time*time*time*time+2)},ccs.TweenFunction.expoEaseIn=function(time){return 0===time?0:Math.pow(2,10*(time-1))-.001},ccs.TweenFunction.expoEaseOut=function(time){return 1===time?1:1-Math.pow(2,-10*time)},ccs.TweenFunction.expoEaseInOut=function(time){return time/=.5,time=time<1?.5*Math.pow(2,10*(time-1)):.5*(2-Math.pow(2,-10*(time-1)))},ccs.TweenFunction.circEaseIn=function(time){return-1*(Math.sqrt(1-time*time)-1)},ccs.TweenFunction.circEaseOut=function(time){return time-=1,Math.sqrt(1-time*time)},ccs.TweenFunction.circEaseInOut=function(time){return(time*=2)<1?-.5*(Math.sqrt(1-time*time)-1):(time-=2,.5*(Math.sqrt(1-time*time)+1))},ccs.TweenFunction.elasticEaseIn=function(time,easingParam){var period=.3;easingParam.length>0&&(period=easingParam[0]);var newT=0;if(0===time||1===time)newT=time;else{var s=period/4;time-=1,newT=-Math.pow(2,10*time)*Math.sin((time-s)*ccs.DOUBLE_PI/period)}return newT},ccs.TweenFunction.elasticEaseOut=function(time,easingParam){var period=.3;easingParam.length>0&&(period=easingParam[0]);var newT=0;if(0===time||1===time)newT=time;else{var s=period/4;newT=Math.pow(2,-10*time)*Math.sin((time-s)*ccs.DOUBLE_PI/period)+1}return newT},ccs.TweenFunction.elasticEaseInOut=function(time,easingParam){var period=.3;easingParam.length>0&&(period=easingParam[0]);var newT=0;if(0===time||1===time)newT=time;else{time*=2,period||(period=.3*1.5);var s=period/4;newT=(time-=1)<0?-.5*Math.pow(2,10*time)*Math.sin((time-s)*ccs.DOUBLE_PI/period):Math.pow(2,-10*time)*Math.sin((time-s)*ccs.DOUBLE_PI/period)*.5+1}return newT},ccs.TweenFunction.backEaseIn=function(time){return time*time*(2.70158*time-1.70158)},ccs.TweenFunction.backEaseOut=function(time){return(time-=1)*time*(2.70158*time+1.70158)+1},ccs.TweenFunction.backEaseInOut=function(time){return(time*=2)<1?time*time*(3.5949095*time-2.5949095)/2:(time-=2)*time*(3.5949095*time+2.5949095)/2+1},ccs.bounceTime=function(time){return time<1/2.75?7.5625*time*time:time<2/2.75?7.5625*(time-=1.5/2.75)*time+.75:time<2.5/2.75?7.5625*(time-=2.25/2.75)*time+.9375:7.5625*(time-=2.625/2.75)*time+.984375},ccs.TweenFunction.bounceEaseIn=function(time){return 1-ccs.bounceTime(1-time)},ccs.TweenFunction.bounceEaseOut=function(time){return ccs.bounceTime(time)},ccs.TweenFunction.bounceEaseInOut=function(time){var newT=0;return time<.5?(time*=2,newT=.5*(1-ccs.bounceTime(1-time))):newT=.5*ccs.bounceTime(2*time-1)+.5,newT},ccs.TweenFunction.customEase=function(time,easingParam){if(easingParam.length>0){var tt=1-time;return easingParam[1]*tt*tt*tt+3*easingParam[3]*time*tt*tt+3*easingParam[5]*time*time*tt+easingParam[7]*time*time*time}return time},ccs.TweenFunction.easeIn=function(time,rate){return Math.pow(time,rate)},ccs.TweenFunction.easeOut=function(time,rate){return Math.pow(time,1/rate)},ccs.TweenFunction.easeInOut=function(time,rate){return(time*=2)<1?.5*Math.pow(time,rate):1-.5*Math.pow(2-time,rate)},ccs.TweenFunction.quadraticIn=function(time){return Math.pow(time,2)},ccs.TweenFunction.quadraticOut=function(time){return-time*(time-2)},ccs.TweenFunction.bezieratFunction=function(a,b,c,d,t){return Math.pow(1-t,3)*a+3*t*Math.pow(1-t,2)*b+3*Math.pow(t,2)*(1-t)*c+Math.pow(t,3)*d};var ENABLE_PHYSICS_DETECT=!1;ccs.fmodf=function(x,y){for(;x>y;)x-=y;return x};var CC_SAFE_RELEASE=function(obj){obj&&obj.release&&obj.release()};ccs.isSpriteContainPoint=function(sprite,point,outPoint){var p=sprite.convertToNodeSpace(point);outPoint&&(outPoint.x=p.x,outPoint.y=p.y);var s=sprite.getContentSize();return cc.rectContainsPoint(cc.rect(0,0,s.width,s.height),p)},ccs.SPRITE_CONTAIN_POINT=ccs.isSpriteContainPoint,ccs.SPRITE_CONTAIN_POINT_WITH_RETURN=ccs.isSpriteContainPoint,ccs.extBezierTo=function(t,point1,point2,point3,point4){var p=cc.p(0,0);return point3&&!point4&&(p.x=Math.pow(1-t,2)*point1.x+2*t*(1-t)*point2.x+Math.pow(t,2)*point3.x,p.y=Math.pow(1-t,2)*point1.y+2*t*(1-t)*point2.y+Math.pow(t,2)*point3.y),point4&&(p.x=point1.x*Math.pow(1-t,3)+3*t*point2.x*Math.pow(1-t,2)+3*point3.x*Math.pow(t,2)*(1-t)+point4.x*Math.pow(t,3),p.y=point1.y*Math.pow(1-t,3)+3*t*point2.y*Math.pow(1-t,2)+3*point3.y*Math.pow(t,2)*(1-t)+point4.y*Math.pow(t,3)),p},ccs.extCircleTo=function(t,center,radius,fromRadian,radianDif){var p=cc.p(0,0);return p.x=center.x+radius*Math.cos(fromRadian+radianDif*t),p.y=center.y+radius*Math.sin(fromRadian+radianDif*t),p},ccs.RelativeData=function(){this.plistFiles=[],this.armatures=[],this.animations=[],this.textures=[]},ccs.armatureDataManager={_animationDatas:{},_armatureDatas:{},_textureDatas:{},_autoLoadSpriteFile:!1,_relativeDatas:{},s_sharedArmatureDataManager:null,removeArmatureFileInfo:function(configFilePath){var data=this.getRelativeData(configFilePath);if(data){var i,obj;for(i=0;i<data.armatures.length;i++)obj=data.armatures[i],this.removeArmatureData(obj);for(i=0;i<data.animations.length;i++)obj=data.animations[i],this.removeAnimationData(obj);for(i=0;i<data.textures.length;i++)obj=data.textures[i],this.removeTextureData(obj);for(i=0;i<data.plistFiles.length;i++)obj=data.plistFiles[i],cc.spriteFrameCache.removeSpriteFramesFromFile(obj);delete this._relativeDatas[configFilePath],ccs.dataReaderHelper.removeConfigFile(configFilePath)}},addArmatureData:function(id,armatureData,configFilePath){var data=this.getRelativeData(configFilePath);data&&data.armatures.push(id),this._armatureDatas[id]=armatureData},getArmatureData:function(id){var armatureData=null;return this._armatureDatas&&(armatureData=this._armatureDatas[id]),armatureData},removeArmatureData:function(id){this._armatureDatas[id]&&delete this._armatureDatas[id]},addAnimationData:function(id,animationData,configFilePath){var data=this.getRelativeData(configFilePath);data&&data.animations.push(id),this._animationDatas[id]=animationData},getAnimationData:function(id){var animationData=null;return this._animationDatas[id]&&(animationData=this._animationDatas[id]),animationData},removeAnimationData:function(id){this._animationDatas[id]&&delete this._animationDatas[id]},addTextureData:function(id,textureData,configFilePath){var data=this.getRelativeData(configFilePath);data&&data.textures.push(id),this._textureDatas[id]=textureData},getTextureData:function(id){var textureData=null;return this._textureDatas&&(textureData=this._textureDatas[id]),textureData},removeTextureData:function(id){this._textureDatas[id]&&delete this._textureDatas[id]},addArmatureFileInfo:function(){var imagePath,plistPath,configFilePath;switch(arguments.length){case 1:configFilePath=arguments[0],this.addRelativeData(configFilePath),this._autoLoadSpriteFile=!0,ccs.dataReaderHelper.addDataFromFile(configFilePath);break;case 3:imagePath=arguments[0],plistPath=arguments[1],configFilePath=arguments[2],this.addRelativeData(configFilePath),this._autoLoadSpriteFile=!1,ccs.dataReaderHelper.addDataFromFile(configFilePath),this.addSpriteFrameFromFile(plistPath,imagePath)}},addArmatureFileInfoAsync:function(){var imagePath,plistPath,configFilePath,target,selector;switch(arguments.length){case 3:configFilePath=arguments[0],target=arguments[2],selector=arguments[1],this.addRelativeData(configFilePath),this._autoLoadSpriteFile=!0,ccs.dataReaderHelper.addDataFromFileAsync("","",configFilePath,selector,target);break;case 5:imagePath=arguments[0],plistPath=arguments[1],configFilePath=arguments[2],target=arguments[4],selector=arguments[3],this.addRelativeData(configFilePath),this._autoLoadSpriteFile=!1,ccs.dataReaderHelper.addDataFromFileAsync(imagePath,plistPath,configFilePath,selector,target),this.addSpriteFrameFromFile(plistPath,imagePath)}},addSpriteFrameFromFile:function(plistPath,imagePath,configFilePath){var data=this.getRelativeData(configFilePath);data&&data.plistFiles.push(plistPath),ccs.spriteFrameCacheHelper.addSpriteFrameFromFile(plistPath,imagePath)},isAutoLoadSpriteFile:function(){return this._autoLoadSpriteFile},getArmatureDatas:function(){return this._armatureDatas},getAnimationDatas:function(){return this._animationDatas},getTextureDatas:function(){return this._textureDatas},addRelativeData:function(configFilePath){this._relativeDatas[configFilePath]||(this._relativeDatas[configFilePath]=new ccs.RelativeData)},getRelativeData:function(configFilePath){return this._relativeDatas[configFilePath]},clear:function(){for(var key in this._relativeDatas)this.removeArmatureFileInfo(key);this._animationDatas={},this._armatureDatas={},this._textureDatas={},this._relativeDatas={},ccs.spriteFrameCacheHelper.clear(),ccs.dataReaderHelper.clear()}},ccs.BLEND_TYPE_NORMAL=0,ccs.BLEND_TYPE_LAYER=1,ccs.BLEND_TYPE_DARKEN=2,ccs.BLEND_TYPE_MULTIPLY=3,ccs.BLEND_TYPE_LIGHTEN=4,ccs.BLEND_TYPE_SCREEN=5,ccs.BLEND_TYPE_OVERLAY=6,ccs.BLEND_TYPE_HIGHLIGHT=7,ccs.BLEND_TYPE_ADD=8,ccs.BLEND_TYPE_SUBTRACT=9,ccs.BLEND_TYPE_DIFFERENCE=10,ccs.BLEND_TYPE_INVERT=11,ccs.BLEND_TYPE_ALPHA=12,ccs.BLEND_TYPE_ERASE=13,ccs.DISPLAY_TYPE_SPRITE=0,ccs.DISPLAY_TYPE_ARMATURE=1,ccs.DISPLAY_TYPE_PARTICLE=2,ccs.DISPLAY_TYPE_MAX=3,ccs.BaseData=ccs.Class.extend({x:0,y:0,zOrder:0,skewX:0,skewY:0,scaleX:1,scaleY:1,tweenRotate:0,isUseColorInfo:!1,r:255,g:255,b:255,a:255,ctor:function(){this.x=0,this.y=0,this.zOrder=0,this.skewX=0,this.skewY=0,this.scaleX=1,this.scaleY=1,this.tweenRotate=0,this.isUseColorInfo=!1,this.r=255,this.g=255,this.b=255,this.a=255},copy:function(node){this.x=node.x,this.y=node.y,this.zOrder=node.zOrder,this.scaleX=node.scaleX,this.scaleY=node.scaleY,this.skewX=node.skewX,this.skewY=node.skewY,this.tweenRotate=node.tweenRotate,this.isUseColorInfo=node.isUseColorInfo,this.r=node.r,this.g=node.g,this.b=node.b,this.a=node.a},setColor:function(color){this.r=color.r,this.g=color.g,this.b=color.b,this.a=color.a},getColor:function(){return cc.color(this.r,this.g,this.b,this.a)},subtract:function(from,to,limit){this.x=to.x-from.x,this.y=to.y-from.y,this.scaleX=to.scaleX-from.scaleX,this.scaleY=to.scaleY-from.scaleY,this.skewX=to.skewX-from.skewX,this.skewY=to.skewY-from.skewY,this.isUseColorInfo||from.isUseColorInfo||to.isUseColorInfo?(this.a=to.a-from.a,this.r=to.r-from.r,this.g=to.g-from.g,this.b=to.b-from.b,this.isUseColorInfo=!0):(this.a=this.r=this.g=this.b=0,this.isUseColorInfo=!1),limit&&(this.skewX>ccs.M_PI&&(this.skewX-=ccs.DOUBLE_PI),this.skewX<-ccs.M_PI&&(this.skewX+=ccs.DOUBLE_PI),this.skewY>ccs.M_PI&&(this.skewY-=ccs.DOUBLE_PI),this.skewY<-ccs.M_PI&&(this.skewY+=ccs.DOUBLE_PI)),to.tweenRotate&&(this.skewX+=to.tweenRotate*ccs.PI*2,this.skewY-=to.tweenRotate*ccs.PI*2)}}),ccs.DisplayData=ccs.Class.extend({displayType:ccs.DISPLAY_TYPE_MAX,displayName:"",ctor:function(){this.displayType=ccs.DISPLAY_TYPE_MAX},changeDisplayToTexture:function(displayName){var textureName=displayName,startPos=textureName.lastIndexOf(".");return-1!==startPos&&(textureName=textureName.substring(0,startPos)),textureName},copy:function(displayData){this.displayName=displayData.displayName,this.displayType=displayData.displayType}}),ccs.SpriteDisplayData=ccs.DisplayData.extend({skinData:null,ctor:function(){this.skinData=new ccs.BaseData,this.displayType=ccs.DISPLAY_TYPE_SPRITE},copy:function(displayData){ccs.DisplayData.prototype.copy.call(this,displayData),this.skinData=displayData.skinData}}),ccs.ArmatureDisplayData=ccs.DisplayData.extend({ctor:function(){this.displayName="",this.displayType=ccs.DISPLAY_TYPE_ARMATURE}}),ccs.ParticleDisplayData=ccs.DisplayData.extend({ctor:function(){this.displayType=ccs.DISPLAY_TYPE_PARTICLE}}),ccs.BoneData=ccs.BaseData.extend({displayDataList:null,name:"",parentName:"",boneDataTransform:null,ctor:function(){this.displayDataList=[],this.name="",this.parentName="",this.boneDataTransform=null},init:function(){return this.displayDataList.length=0,!0},addDisplayData:function(displayData){this.displayDataList.push(displayData)},getDisplayData:function(index){return this.displayDataList[index]}}),ccs.ArmatureData=ccs.Class.extend({boneDataDic:null,name:"",dataVersion:.1,ctor:function(){this.boneDataDic={},this.name="",this.dataVersion=.1},init:function(){return!0},addBoneData:function(boneData){this.boneDataDic[boneData.name]=boneData},getBoneDataDic:function(){return this.boneDataDic},getBoneData:function(boneName){return this.boneDataDic[boneName]}}),ccs.FrameData=ccs.BaseData.extend({duration:0,tweenEasing:0,easingParamNumber:0,easingParams:null,displayIndex:-1,movement:"",event:"",sound:"",soundEffect:"",blendFunc:null,frameID:0,isTween:!0,ctor:function(){ccs.BaseData.prototype.ctor.call(this),this.duration=1,this.tweenEasing=ccs.TweenType.LINEAR,this.easingParamNumber=0,this.easingParams=[],this.displayIndex=0,this.movement="",this.event="",this.sound="",this.soundEffect="",this.blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST),this.frameID=0,this.isTween=!0},copy:function(frameData){if(ccs.BaseData.prototype.copy.call(this,frameData),this.duration=frameData.duration,this.displayIndex=frameData.displayIndex,this.tweenEasing=frameData.tweenEasing,this.easingParamNumber=frameData.easingParamNumber,0!==this.easingParamNumber){this.easingParams.length=0;for(var i=0;i<this.easingParamNumber;i++)this.easingParams[i]=frameData.easingParams[i]}this.blendFunc=frameData.blendFunc,this.isTween=frameData.isTween}}),ccs.MovementBoneData=ccs.Class.extend({delay:0,scale:1,duration:0,frameList:null,name:"",ctor:function(){this.delay=0,this.scale=1,this.duration=0,this.frameList=[],this.name=""},init:function(){return!0},addFrameData:function(frameData){this.frameList.push(frameData)},getFrameData:function(index){return this.frameList[index]}}),ccs.MovementData=function(){this.name="",this.duration=0,this.scale=1,this.durationTo=0,this.durationTween=0,this.loop=!0,this.tweenEasing=ccs.TweenType.LINEAR,this.movBoneDataDic={}},ccs.MovementData.prototype.addMovementBoneData=function(movBoneData){this.movBoneDataDic[movBoneData.name]=movBoneData},ccs.MovementData.prototype.getMovementBoneData=function(boneName){return this.movBoneDataDic[boneName]},ccs.AnimationData=function(){this.movementDataDic={},this.movementNames=[],this.name=""},ccs.AnimationData.prototype.addMovement=function(moveData){this.movementDataDic[moveData.name]=moveData,this.movementNames.push(moveData.name)},ccs.AnimationData.prototype.getMovement=function(moveName){return this.movementDataDic[moveName]},ccs.AnimationData.prototype.getMovementCount=function(){return Object.keys(this.movementDataDic).length},ccs.ContourVertex2=function(x,y){this.x=x||0,this.y=y||0},ccs.ContourData=function(){this.vertexList=[]},ccs.ContourData.prototype.init=function(){return this.vertexList.length=0,!0},ccs.ContourData.prototype.addVertex=function(p){this.vertexList.push(p)},ccs.TextureData=function(){this.height=0,this.width=0,this.pivotX=.5,this.pivotY=.5,this.name="",this.contourDataList=[]},ccs.TextureData.prototype.init=function(){this.contourDataList.length=0},ccs.TextureData.prototype.addContourData=function(contourData){this.contourDataList.push(contourData)},ccs.TextureData.prototype.getContourData=function(index){return this.contourDataList[index]},ccs.DecorativeDisplay=ccs.Class.extend({_display:null,_colliderDetector:null,_displayData:null,ctor:function(){this._display=null,this._colliderDetector=null,this._displayData=null},init:function(){return!0},setDisplay:function(display){display._parent&&(display._parent.removeChild(display),delete display._parent),this._display=display},getDisplay:function(){return this._display},setColliderDetector:function(colliderDetector){this._colliderDetector=colliderDetector},getColliderDetector:function(){return this._colliderDetector},setDisplayData:function(displayData){this._displayData=displayData},getDisplayData:function(){return this._displayData},release:function(){this._display=null,this._displayData=null,this._colliderDetector=null}}),ccs.DecorativeDisplay.create=function(){return new ccs.DecorativeDisplay},ccs.displayFactory={addDisplay:function(bone,decoDisplay,displayData){switch(displayData.displayType){case ccs.DISPLAY_TYPE_SPRITE:this.addSpriteDisplay(bone,decoDisplay,displayData);break;case ccs.DISPLAY_TYPE_PARTICLE:this.addParticleDisplay(bone,decoDisplay,displayData);break;case ccs.DISPLAY_TYPE_ARMATURE:this.addArmatureDisplay(bone,decoDisplay,displayData)}},createDisplay:function(bone,decoDisplay){switch(decoDisplay.getDisplayData().displayType){case ccs.DISPLAY_TYPE_SPRITE:this.createSpriteDisplay(bone,decoDisplay);break;case ccs.DISPLAY_TYPE_PARTICLE:this.createParticleDisplay(bone,decoDisplay);break;case ccs.DISPLAY_TYPE_ARMATURE:this.createArmatureDisplay(bone,decoDisplay)}},_helpTransform:{a:1,b:0,c:0,d:1,tx:0,ty:0},updateDisplay:function(bone,dt,dirty){var display=bone.getDisplayRenderNode();if(display){switch(bone.getDisplayRenderNodeType()){case ccs.DISPLAY_TYPE_SPRITE:dirty&&(display._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),display.updateArmatureTransform());break;case ccs.DISPLAY_TYPE_PARTICLE:this.updateParticleDisplay(bone,display,dt);break;case ccs.DISPLAY_TYPE_ARMATURE:this.updateArmatureDisplay(bone,display,dt);break;default:var transform=bone.getNodeToArmatureTransform();display.setAdditionalTransform(transform)}if((ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT||ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX)&&dirty){var decoDisplay=bone.getDisplayManager().getCurrentDecorativeDisplay(),detector=decoDisplay.getColliderDetector();if(detector){var node=decoDisplay.getDisplay(),displayTransform=node.getNodeToParentTransform(),helpTransform=this._helpTransform;helpTransform.a=displayTransform.a,helpTransform.b=displayTransform.b,helpTransform.c=displayTransform.c,helpTransform.d=displayTransform.d,helpTransform.tx=displayTransform.tx,helpTransform.ty=displayTransform.ty;var anchorPoint=cc.pointApplyAffineTransform(node.getAnchorPointInPoints(),helpTransform);helpTransform.tx=anchorPoint.x,helpTransform.ty=anchorPoint.y;var t=cc.affineTransformConcat(helpTransform,bone.getArmature().getNodeToParentTransform());detector.updateTransform(t)}}}},addSpriteDisplay:function(bone,decoDisplay,displayData){var sdp=new ccs.SpriteDisplayData;sdp.copy(displayData),decoDisplay.setDisplayData(sdp),this.createSpriteDisplay(bone,decoDisplay)},createSpriteDisplay:function(bone,decoDisplay){var skin=null,displayData=decoDisplay.getDisplayData(),textureName=displayData.displayName,startPos=textureName.lastIndexOf(".");-1!==startPos&&(textureName=textureName.substring(0,startPos)),skin=""===textureName?new ccs.Skin:new ccs.Skin("#"+textureName+".png"),decoDisplay.setDisplay(skin),skin.setBone(bone),this.initSpriteDisplay(bone,decoDisplay,displayData.displayName,skin);var armature=bone.getArmature();armature&&(armature.getArmatureData().dataVersion>=ccs.CONST_VERSION_COMBINED?skin.setSkinData(displayData.skinData):skin.setSkinData(bone.boneData))},initSpriteDisplay:function(bone,decoDisplay,displayName,skin){var textureName=displayName,startPos=textureName.lastIndexOf(".");-1!==startPos&&(textureName=textureName.substring(0,startPos));var textureData=ccs.armatureDataManager.getTextureData(textureName);if(textureData&&skin.setAnchorPoint(cc.p(textureData.pivotX,textureData.pivotY)),(ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT||ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX)&&textureData&&textureData.contourDataList.length>0){var colliderDetector=new ccs.ColliderDetector(bone);colliderDetector.addContourDataList(textureData.contourDataList),decoDisplay.setColliderDetector(colliderDetector)}},addArmatureDisplay:function(bone,decoDisplay,displayData){var adp=new ccs.ArmatureDisplayData;adp.copy(displayData),decoDisplay.setDisplayData(adp),this.createArmatureDisplay(bone,decoDisplay)},createArmatureDisplay:function(bone,decoDisplay){var displayData=decoDisplay.getDisplayData(),armature=new ccs.Armature(displayData.displayName,bone);decoDisplay.setDisplay(armature)},updateArmatureDisplay:function(bone,armature,dt){armature&&(armature.sortAllChildren(),armature.update(dt))},addParticleDisplay:function(bone,decoDisplay,displayData){var adp=new ccs.ParticleDisplayData;adp.copy(displayData),decoDisplay.setDisplayData(adp),this.createParticleDisplay(bone,decoDisplay)},createParticleDisplay:function(bone,decoDisplay){var displayData=decoDisplay.getDisplayData(),system=new cc.ParticleSystem(displayData.displayName);system.removeFromParent(),system.cleanup(),bone.getArmature()&&system.setParent(bone.getArmature()),decoDisplay.setDisplay(system)},updateParticleDisplay:function(bone,particleSystem,dt){var node=new ccs.BaseData;ccs.TransformHelp.matrixToNode(bone.nodeToArmatureTransform(),node),particleSystem.setPosition(node.x,node.y),particleSystem.setScaleX(node.scaleX),particleSystem.setScaleY(node.scaleY),particleSystem.update(dt)}},ccs.DisplayManager=ccs.Class.extend({_decoDisplayList:null,_currentDecoDisplay:null,_displayRenderNode:null,_displayIndex:null,_forceChangeDisplay:!1,_bone:null,_visible:!0,_displayType:null,ctor:function(bone){this._decoDisplayList=[],this._currentDecoDisplay=null,this._displayRenderNode=null,this._displayIndex=null,this._forceChangeDisplay=!1,this._bone=null,this._visible=!0,this._displayType=ccs.DISPLAY_TYPE_MAX,bone&&ccs.DisplayManager.prototype.init.call(this,bone)},init:function(bone){return this._bone=bone,this.initDisplayList(bone.getBoneData()),!0},addDisplay:function(display,index){var decoDisplay,locDisplayList=this._decoDisplayList;if(index>=0&&index<locDisplayList.length?decoDisplay=locDisplayList[index]:(decoDisplay=new ccs.DecorativeDisplay,locDisplayList.push(decoDisplay)),display instanceof ccs.DisplayData)return ccs.displayFactory.addDisplay(this._bone,decoDisplay,display),void(index===this._displayIndex&&(this._displayIndex=-1,this.changeDisplayWithIndex(index,!1)));var displayData=null;if(display instanceof ccs.Skin){display.setBone(this._bone),displayData=new ccs.SpriteDisplayData,ccs.displayFactory.initSpriteDisplay(this._bone,decoDisplay,display.getDisplayName(),display);var spriteDisplayData=decoDisplay.getDisplayData();if(spriteDisplayData instanceof ccs.SpriteDisplayData)display.setSkinData(spriteDisplayData.skinData),displayData.skinData=spriteDisplayData.skinData;else{for(var find=!1,i=locDisplayList.length-2;i>=0;i--){var sdd=locDisplayList[i].getDisplayData();if(sdd instanceof ccs.SpriteDisplayData){find=!0,display.setSkinData(sdd.skinData),displayData.skinData=sdd.skinData;break}}find||display.setSkinData(new ccs.BaseData)}}else if(display instanceof cc.ParticleSystem){displayData=new ccs.ParticleDisplayData,display.removeFromParent(),display._performRecursive(cc.Node._stateCallbackType.cleanup);var armature=this._bone.getArmature();armature&&display.setParent(armature)}else display instanceof ccs.Armature?((displayData=new ccs.ArmatureDisplayData).displayName=display.getName(),display.setParentBone(this._bone)):displayData=new ccs.DisplayData;decoDisplay.setDisplay(display),decoDisplay.setDisplayData(displayData),index===this._displayIndex&&(this._displayIndex=-1,this.changeDisplayWithIndex(index,!1))},_addDisplayOther:function(decoDisplay,display){var displayData=null;if(display instanceof ccs.Skin){var skin=display;skin.setBone(this._bone),(displayData=new ccs.SpriteDisplayData).displayName=skin.getDisplayName(),ccs.displayFactory.initSpriteDisplay(this._bone,decoDisplay,skin.getDisplayName(),skin);var spriteDisplayData=decoDisplay.getDisplayData();if(spriteDisplayData instanceof ccs.SpriteDisplayData)skin.setSkinData(spriteDisplayData.skinData);else{for(var find=!1,i=this._decoDisplayList.length-2;i>=0;i--){var sdd=this._decoDisplayList[i].getDisplayData();if(sdd){find=!0,skin.setSkinData(sdd.skinData),displayData.skinData=sdd.skinData;break}}find||skin.setSkinData(new ccs.BaseData),skin.setSkinData(new ccs.BaseData)}}else display instanceof cc.ParticleSystem?(displayData=new ccs.ParticleDisplayData).displayName=display._plistFile:display instanceof ccs.Armature?((displayData=new ccs.ArmatureDisplayData).displayName=display.getName(),display.setParentBone(this._bone)):displayData=new ccs.DisplayData;decoDisplay.setDisplay(display),decoDisplay.setDisplayData(displayData)},removeDisplay:function(index){this._decoDisplayList.splice(index,1),index===this._displayIndex&&(this.setCurrentDecorativeDisplay(null),this._displayIndex=-1)},getDecorativeDisplayList:function(){return this._decoDisplayList},changeDisplayWithIndex:function(index,force){index>=this._decoDisplayList.length?cc.log("the index value is out of range"):(this._forceChangeDisplay=force,this._displayIndex!==index&&(this._displayIndex=index,index<0?this._displayRenderNode&&(this._displayRenderNode.removeFromParent(!0),this.setCurrentDecorativeDisplay(null)):this.setCurrentDecorativeDisplay(this._decoDisplayList[index])))},changeDisplayWithName:function(name,force){for(var locDisplayList=this._decoDisplayList,i=0;i<locDisplayList.length;i++)if(locDisplayList[i].getDisplayData().displayName===name){this.changeDisplayWithIndex(i,force);break}},setCurrentDecorativeDisplay:function(decoDisplay){var locCurrentDecoDisplay=this._currentDecoDisplay;(ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT||ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX)&&locCurrentDecoDisplay&&locCurrentDecoDisplay.getColliderDetector()&&locCurrentDecoDisplay.getColliderDetector().setActive(!1),this._currentDecoDisplay=decoDisplay,locCurrentDecoDisplay=this._currentDecoDisplay,(ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT||ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX)&&locCurrentDecoDisplay&&locCurrentDecoDisplay.getColliderDetector()&&locCurrentDecoDisplay.getColliderDetector().setActive(!0);var displayRenderNode=locCurrentDecoDisplay?locCurrentDecoDisplay.getDisplay():null,locRenderNode=this._displayRenderNode,locBone=this._bone;locRenderNode&&(locRenderNode instanceof ccs.Armature&&locBone.setChildArmature(null),locRenderNode.removeFromParent(!0)),this._displayRenderNode=displayRenderNode,displayRenderNode?(displayRenderNode instanceof ccs.Armature?(this._bone.setChildArmature(displayRenderNode),displayRenderNode.setParentBone(this._bone)):displayRenderNode instanceof cc.ParticleSystem&&(displayRenderNode instanceof ccs.Armature?(locBone.setChildArmature(displayRenderNode),displayRenderNode.setParentBone(locBone)):displayRenderNode instanceof cc.ParticleSystem&&displayRenderNode.resetSystem()),displayRenderNode.setColor(locBone.getDisplayedColor()),displayRenderNode.setOpacity(locBone.getDisplayedOpacity()),this._displayRenderNode.setVisible(this._visible),this._displayType=this._currentDecoDisplay.getDisplayData().displayType):this._displayType=ccs.DISPLAY_TYPE_MAX,cc.renderer.childrenOrderDirty=!0},getDisplayRenderNode:function(){return this._displayRenderNode},getDisplayRenderNodeType:function(){return this._displayType},getCurrentDisplayIndex:function(){return this._displayIndex},getCurrentDecorativeDisplay:function(){return this._currentDecoDisplay},getDecorativeDisplayByIndex:function(index){return this._decoDisplayList[index]},initDisplayList:function(boneData){if(this._decoDisplayList.length=0,boneData)for(var displayList=boneData.displayDataList,decoList=this._decoDisplayList,locBone=this._bone,i=0;i<displayList.length;i++){var displayData=displayList[i],decoDisplay=new ccs.DecorativeDisplay;decoDisplay.setDisplayData(displayData),ccs.displayFactory.createDisplay(locBone,decoDisplay),decoList.push(decoDisplay)}},containPoint:function(point,y){if(!this._visible||this._displayIndex<0)return!1;if(void 0!==y&&(point=cc.p(point,y)),this._currentDecoDisplay.getDisplayData().displayType===ccs.DISPLAY_TYPE_SPRITE){var sprite=this._currentDecoDisplay.getDisplay();return sprite=sprite.getChildByTag(0),ccs.SPRITE_CONTAIN_POINT_WITH_RETURN(sprite,point)}return!1},setVisible:function(visible){this._displayRenderNode&&(this._visible=visible,this._displayRenderNode.setVisible(visible))},isVisible:function(){return this._visible},getContentSize:function(){return this._displayRenderNode?this._displayRenderNode.getContentSize():cc.size(0,0)},getBoundingBox:function(){return this._displayRenderNode?this._displayRenderNode.getBoundingBox():cc.rect(0,0,0,0)},getAnchorPoint:function(){return this._displayRenderNode?this._displayRenderNode.getAnchorPoint():cc.p(0,0)},getAnchorPointInPoints:function(){return this._displayRenderNode?this._displayRenderNode.getAnchorPointInPoints():cc.p(0,0)},getForceChangeDisplay:function(){return this._forceChangeDisplay},release:function(){this._decoDisplayList=null,this._displayRenderNode&&(this._displayRenderNode.removeFromParent(!0),this._displayRenderNode=null)}}),ccs.DisplayManager.create=function(bone){return new ccs.DisplayManager(bone)},ccs.Skin=ccs.Sprite.extend({_skinData:null,bone:null,_skinTransform:null,_displayName:"",_armature:null,_className:"Skin",ctor:function(fileName,rect){cc.Sprite.prototype.ctor.call(this),this._skinData=null,this.bone=null,this._displayName="",this._skinTransform=cc.affineTransformIdentity(),this._armature=null,null==fileName||""===fileName?ccs.Skin.prototype.init.call(this):"#"===fileName[0]?ccs.Skin.prototype.initWithSpriteFrameName.call(this,fileName.substr(1)):ccs.Skin.prototype.initWithFile.call(this,fileName,rect)},initWithSpriteFrameName:function(spriteFrameName){if(""===spriteFrameName)return!1;var pFrame=cc.spriteFrameCache.getSpriteFrame(spriteFrameName),ret=!0;return pFrame?this.initWithSpriteFrame(pFrame):(cc.log("Can't find CCSpriteFrame with %s. Please check your .plist file",spriteFrameName),ret=!1),this._displayName=spriteFrameName,ret},initWithFile:function(fileName,rect){var ret=rect?cc.Sprite.prototype.initWithFile.call(this,fileName,rect):cc.Sprite.prototype.initWithFile.call(this,fileName);return this._displayName=fileName,ret},setSkinData:function(skinData){this._skinData=skinData,this.setScaleX(skinData.scaleX),this.setScaleY(skinData.scaleY),this.setRotationX(cc.radiansToDegrees(skinData.skewX)),this.setRotationY(cc.radiansToDegrees(-skinData.skewY)),this.setPosition(skinData.x,skinData.y),this._renderCmd.transform()},getSkinData:function(){return this._skinData},updateArmatureTransform:function(){this._renderCmd.transform()},getNodeToWorldTransform:function(){return this._renderCmd.getNodeToWorldTransform()},getNodeToWorldTransformAR:function(){return this._renderCmd.getNodeToWorldTransformAR()},setBone:function(bone){this.bone=bone;var armature=this.bone.getArmature();armature&&(this._armature=armature)},getBone:function(){return this.bone},getDisplayName:function(){return this._displayName},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new ccs.Skin.CanvasRenderCmd(this):new ccs.Skin.WebGLRenderCmd(this)}});var _p=ccs.Skin.prototype;_p.skinData,cc.defineGetterSetter(_p,"skinData",_p.getSkinData,_p.setSkinData),_p.displayName,cc.defineGetterSetter(_p,"displayName",_p.getDisplayName),_p=null,ccs.Skin.create=function(fileName,rect){return new ccs.Skin(fileName,rect)},ccs.Skin.createWithSpriteFrameName=function(spriteFrameName){return new ccs.Skin("#"+spriteFrameName)},function(){ccs.Skin.RenderCmd={_realWorldTM:null,transform:function(parentCmd,recursive){this._transform||(this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0});var node=this._node,pt=parentCmd?parentCmd._worldTransform:null,t=this._transform,wt=this._worldTransform;if((this._dirtyFlag&cc.Node._dirtyFlags.transformDirty||pt)&&(this.originTransform(),cc.affineTransformConcatIn(this._transform,node.bone.getNodeToArmatureTransform()),this._dirtyFlag&=~cc.Node._dirtyFlags.transformDirty),pt){wt.a=t.a*pt.a+t.b*pt.c,wt.b=t.a*pt.b+t.b*pt.d,wt.c=t.c*pt.a+t.d*pt.c,wt.d=t.c*pt.b+t.d*pt.d,wt.tx=t.tx*pt.a+t.ty*pt.c+pt.tx,wt.ty=t.tx*pt.b+t.ty*pt.d+pt.ty;var vertices=this._vertices;if(vertices){var lx=node._offsetPosition.x,rx=lx+node._rect.width,by=node._offsetPosition.y,ty=by+node._rect.height;vertices[0].x=lx*wt.a+ty*wt.c+wt.tx,vertices[0].y=lx*wt.b+ty*wt.d+wt.ty,vertices[1].x=lx*wt.a+by*wt.c+wt.tx,vertices[1].y=lx*wt.b+by*wt.d+wt.ty,vertices[2].x=rx*wt.a+ty*wt.c+wt.tx,vertices[2].y=rx*wt.b+ty*wt.d+wt.ty,vertices[3].x=rx*wt.a+by*wt.c+wt.tx,vertices[3].y=rx*wt.b+by*wt.d+wt.ty}}else wt.a=t.a,wt.b=t.b,wt.c=t.c,wt.d=t.d,wt.tx=t.tx,wt.ty=t.ty;var rwtm=this._realWorldTM;rwtm&&(rwtm.a=t.a,rwtm.b=t.b,rwtm.c=t.c,rwtm.d=t.d,rwtm.tx=t.tx,rwtm.ty=t.ty,cc.affineTransformConcatIn(rwtm,this._node.bone.getArmature()._renderCmd._worldTransform))},getNodeToWorldTransform:function(){return cc.affineTransformConcat(this._transform,this._node.bone.getArmature().getNodeToWorldTransform())},getNodeToWorldTransformAR:function(){var displayTransform=this._transform,node=this._node;return this._anchorPointInPoints=cc.pointApplyAffineTransform(this._anchorPointInPoints,displayTransform),displayTransform.tx=this._anchorPointInPoints.x,displayTransform.ty=this._anchorPointInPoints.y,cc.affineTransformConcat(displayTransform,node.bone.getArmature().getNodeToWorldTransform())}},ccs.Skin.CanvasRenderCmd=function(renderable){this._spriteCmdCtor(renderable),this._realWorldTM={a:1,b:0,c:0,d:1,tx:0,ty:0}};var proto=ccs.Skin.CanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype);cc.inject(ccs.Skin.RenderCmd,proto),proto.constructor=ccs.Skin.CanvasRenderCmd,proto._updateCurrentRegions=function(){var temp=this._currentRegion;this._currentRegion=this._oldRegion,this._oldRegion=temp,cc.Node.CanvasRenderCmd.RegionStatus.DirtyDouble!==this._regionFlag||this._currentRegion.isEmpty()||this._oldRegion.union(this._currentRegion),this._currentRegion.updateRegion(this.getLocalBB(),this._realWorldTM)},ccs.Skin.WebGLRenderCmd=function(renderable){this._spriteCmdCtor(renderable)},proto=ccs.Skin.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype),cc.inject(ccs.Skin.RenderCmd,proto),proto.constructor=ccs.Skin.WebGLRenderCmd}(),ccs.ANIMATION_TYPE_SINGLE_FRAME=-4,ccs.ANIMATION_TYPE_NO_LOOP=-3,ccs.ANIMATION_TYPE_TO_LOOP_FRONT=-2,ccs.ANIMATION_TYPE_TO_LOOP_BACK=-1,ccs.ANIMATION_TYPE_LOOP_FRONT=0,ccs.ANIMATION_TYPE_LOOP_BACK=1,ccs.ANIMATION_TYPE_MAX=2,ccs.ProcessBase=ccs.Class.extend({_processScale:1,_isComplete:!0,_isPause:!0,_isPlaying:!1,_currentPercent:0,_rawDuration:0,_loopType:0,_tweenEasing:0,animationInternal:null,_currentFrame:0,_durationTween:0,_nextFrameIndex:0,_curFrameIndex:null,_isLoopBack:!1,ctor:function(){this._processScale=1,this._isComplete=!0,this._isPause=!0,this._isPlaying=!1,this._currentFrame=0,this._currentPercent=0,this._durationTween=0,this._rawDuration=0,this._loopType=ccs.ANIMATION_TYPE_LOOP_BACK,this._tweenEasing=ccs.TweenType.LINEAR,this.animationInternal=1/60,this._curFrameIndex=0,this._durationTween=0,this._isLoopBack=!1},pause:function(){this._isPause=!0,this._isPlaying=!1},resume:function(){this._isPause=!1,this._isPlaying=!0},stop:function(){this._isComplete=!0,this._isPlaying=!1},play:function(durationTo,durationTween,loop,tweenEasing){this._isComplete=!1,this._isPause=!1,this._isPlaying=!0,this._currentFrame=0,this._nextFrameIndex=durationTo,this._tweenEasing=tweenEasing},update:function(dt){if(!this._isComplete&&!this._isPause&&!(this._rawDuration<=0||dt>1)){var locNextFrameIndex=void 0===this._nextFrameIndex?0:this._nextFrameIndex,locCurrentFrame=this._currentFrame;locNextFrameIndex<=0?(this._currentPercent=1,locCurrentFrame=0):(locCurrentFrame+=this._processScale*(dt/this.animationInternal),this._currentPercent=locCurrentFrame/locNextFrameIndex,locCurrentFrame=ccs.fmodf(locCurrentFrame,locNextFrameIndex)),this._currentFrame=locCurrentFrame,this.updateHandler()}},gotoFrame:function(frameIndex){var locLoopType=this._loopType;locLoopType===ccs.ANIMATION_TYPE_NO_LOOP?locLoopType=ccs.ANIMATION_TYPE_MAX:locLoopType===ccs.ANIMATION_TYPE_TO_LOOP_FRONT&&(locLoopType=ccs.ANIMATION_TYPE_LOOP_FRONT),this._loopType=locLoopType,this._curFrameIndex=frameIndex,this._nextFrameIndex=this._durationTween},getCurrentFrameIndex:function(){return this._curFrameIndex=(this._rawDuration-1)*this._currentPercent,this._curFrameIndex},updateHandler:function(){},isPause:function(){return this._isPause},isComplete:function(){return this._isComplete},getCurrentPercent:function(){return this._currentPercent},getRawDuration:function(){return this._rawDuration},getLoop:function(){return this._loopType},getTweenEasing:function(){return this._tweenEasing},getAnimationInternal:function(){return this.animationInternal},setAnimationInternal:function(animationInternal){this.animationInternal=animationInternal},getProcessScale:function(){return this._processScale},setProcessScale:function(processScale){this._processScale=processScale},isPlaying:function(){return this._isPlaying}}),(_p=ccs.ProcessBase.prototype).currentFrameIndex,cc.defineGetterSetter(_p,"currentFrameIndex",_p.getCurrentFrameIndex),_p.paused,cc.defineGetterSetter(_p,"paused",_p.isPause),_p.completed,cc.defineGetterSetter(_p,"completed",_p.isComplete),_p.currentPercent,cc.defineGetterSetter(_p,"currentPercent",_p.getCurrentPercent),_p.rawDuration,cc.defineGetterSetter(_p,"rawDuration",_p.getRawDuration),_p.loop,cc.defineGetterSetter(_p,"loop",_p.getLoop),_p.tweenEasing,cc.defineGetterSetter(_p,"tweenEasing",_p.getTweenEasing),_p.playing,cc.defineGetterSetter(_p,"playing",_p.isPlaying),_p=null,ccs.MovementEventType={start:0,complete:1,loopComplete:2},ccs.AnimationEvent=ccs.Class.extend({_arguments:null,_callFunc:null,_selectorTarget:null,ctor:function(callFunc,target,data){this._data=data,this._callFunc=callFunc,this._selectorTarget=target},call:function(){this._callFunc&&this._callFunc.apply(this._selectorTarget,this._arguments)},setArguments:function(args){this._arguments=args}}),ccs.MovementEvent=function(){this.armature=null,this.movementType=ccs.MovementEventType.start,this.movementID=""},ccs.FrameEvent=function(){this.bone=null,this.frameEventName="",this.originFrameIndex=0,this.currentFrameIndex=0},ccs.ArmatureAnimation=ccs.ProcessBase.extend({_animationData:null,_movementData:null,_armature:null,_movementID:"",_toIndex:0,_tweenList:null,_speedScale:1,_ignoreFrameEvent:!1,_frameEventQueue:null,_movementEventQueue:null,_movementList:null,_onMovementList:!1,_movementListLoop:!1,_movementIndex:0,_movementListDurationTo:-1,_movementEventCallFunc:null,_frameEventCallFunc:null,_movementEventTarget:null,_frameEventTarget:null,_movementEventListener:null,_frameEventListener:null,ctor:function(armature){ccs.ProcessBase.prototype.ctor.call(this),this._tweenList=[],this._movementList=[],this._frameEventQueue=[],this._movementEventQueue=[],this._armature=null,armature&&ccs.ArmatureAnimation.prototype.init.call(this,armature)},init:function(armature){return this._armature=armature,this._tweenList.length=0,!0},pause:function(){for(var locTweenList=this._tweenList,i=0;i<locTweenList.length;i++)locTweenList[i].pause();ccs.ProcessBase.prototype.pause.call(this)},resume:function(){for(var locTweenList=this._tweenList,i=0;i<locTweenList.length;i++)locTweenList[i].resume();ccs.ProcessBase.prototype.resume.call(this)},stop:function(){for(var locTweenList=this._tweenList,i=0;i<locTweenList.length;i++)locTweenList[i].stop();locTweenList.length=0,ccs.ProcessBase.prototype.stop.call(this)},setAnimationScale:function(animationScale){this.setSpeedScale(animationScale)},getAnimationScale:function(){return this.getSpeedScale()},setSpeedScale:function(speedScale){if(speedScale!==this._speedScale){this._speedScale=speedScale,this._processScale=this._movementData?this._speedScale*this._movementData.scale:this._speedScale;var dict=this._armature.getBoneDic();for(var key in dict){var bone=dict[key];bone.getTween().setProcessScale(this._processScale),bone.getChildArmature()&&bone.getChildArmature().getAnimation().setSpeedScale(this._processScale)}}},getSpeedScale:function(){return this._speedScale},play:function(animationName,durationTo,loop){cc.assert(this._animationData,"this.animationData can not be null"),this._movementData=this._animationData.getMovement(animationName),cc.assert(this._movementData,"this._movementData can not be null"),durationTo=void 0===durationTo?-1:durationTo,loop=void 0===loop?-1:loop,this._rawDuration=this._movementData.duration,this._movementID=animationName,this._processScale=this._speedScale*this._movementData.scale,durationTo=-1===durationTo?this._movementData.durationTo:durationTo;var durationTween=0===this._movementData.durationTween?this._rawDuration:this._movementData.durationTween,tweenEasing=this._movementData.tweenEasing;loop=loop<0?this._movementData.loop:loop,this._onMovementList=!1,ccs.ProcessBase.prototype.play.call(this,durationTo,durationTween,loop,tweenEasing),0===this._rawDuration?this._loopType=ccs.ANIMATION_TYPE_SINGLE_FRAME:(this._loopType=loop?ccs.ANIMATION_TYPE_TO_LOOP_FRONT:ccs.ANIMATION_TYPE_NO_LOOP,this._durationTween=durationTween),this._tweenList.length=0;var movementBoneData,map=this._armature.getBoneDic();for(var element in map){var bone=map[element];movementBoneData=this._movementData.movBoneDataDic[bone.getName()];var tween=bone.getTween();movementBoneData&&movementBoneData.frameList.length>0?(this._tweenList.push(tween),movementBoneData.duration=this._movementData.duration,tween.play(movementBoneData,durationTo,durationTween,loop,tweenEasing),tween.setProcessScale(this._processScale),bone.getChildArmature()&&(bone.getChildArmature().getAnimation().setSpeedScale(this._processScale),bone.getChildArmature().getAnimation().isPlaying()||bone.getChildArmature().getAnimation().playWithIndex(0))):bone.isIgnoreMovementBoneData()||(bone.getDisplayManager().changeDisplayWithIndex(-1,!1),tween.stop())}this._armature.update(0)},playByIndex:function(animationIndex,durationTo,durationTween,loop,tweenEasing){cc.log("playByIndex is deprecated. Use playWithIndex instead."),this.playWithIndex(animationIndex,durationTo,loop)},playWithIndex:function(animationIndex,durationTo,loop){var movName=this._animationData.movementNames;cc.assert(animationIndex>-1&&animationIndex<movName.length);var animationName=movName[animationIndex];this.play(animationName,durationTo,loop)},playWithNames:function(movementNames,durationTo,loop){durationTo=void 0===durationTo?-1:durationTo,loop=void 0===loop||loop,this._movementListLoop=loop,this._movementListDurationTo=durationTo,this._onMovementList=!0,this._movementIndex=0,movementNames instanceof Array?this._movementList=movementNames:this._movementList.length=0,this.updateMovementList()},playWithIndexes:function(movementIndexes,durationTo,loop){durationTo=void 0===durationTo?-1:durationTo,loop=void 0===loop||loop,this._movementList.length=0,this._movementListLoop=loop,this._movementListDurationTo=durationTo,this._onMovementList=!0,this._movementIndex=0;for(var movName=this._animationData.movementNames,i=0;i<movementIndexes.length;i++){var name=movName[movementIndexes[i]];this._movementList.push(name)}this.updateMovementList()},gotoAndPlay:function(frameIndex){if(!this._movementData||frameIndex<0||frameIndex>=this._movementData.duration)cc.log("Please ensure you have played a movement, and the frameIndex is in the range.");else{var ignoreFrameEvent=this._ignoreFrameEvent;this._ignoreFrameEvent=!0,this._isPlaying=!0,this._isComplete=this._isPause=!1,ccs.ProcessBase.prototype.gotoFrame.call(this,frameIndex),this._currentPercent=this._curFrameIndex/(this._movementData.duration-1),this._currentFrame=this._nextFrameIndex*this._currentPercent;for(var locTweenList=this._tweenList,i=0;i<locTweenList.length;i++)locTweenList[i].gotoAndPlay(frameIndex);this._armature.update(0),this._ignoreFrameEvent=ignoreFrameEvent}},gotoAndPause:function(frameIndex){this.gotoAndPlay(frameIndex),this.pause()},getMovementCount:function(){return this._animationData.getMovementCount()},update:function(dt){ccs.ProcessBase.prototype.update.call(this,dt);for(var locTweenList=this._tweenList,i=0;i<locTweenList.length;i++)locTweenList[i].update(dt);for(var event,frameEvents=this._frameEventQueue;frameEvents.length>0;)event=frameEvents.shift(),this._ignoreFrameEvent=!0,this._frameEventCallFunc&&this._frameEventCallFunc.call(this._frameEventTarget,event.bone,event.frameEventName,event.originFrameIndex,event.currentFrameIndex),this._frameEventListener&&this._frameEventListener(event.bone,event.frameEventName,event.originFrameIndex,event.currentFrameIndex),this._ignoreFrameEvent=!1;for(var movementEvents=this._movementEventQueue;movementEvents.length>0;)event=movementEvents.shift(),this._movementEventCallFunc&&this._movementEventCallFunc.call(this._movementEventTarget,event.armature,event.movementType,event.movementID),this._movementEventListener&&this._movementEventListener(event.armature,event.movementType,event.movementID)},updateHandler:function(){var locCurrentPercent=this._currentPercent;if(locCurrentPercent>=1){switch(this._loopType){case ccs.ANIMATION_TYPE_NO_LOOP:if(this._loopType=ccs.ANIMATION_TYPE_MAX,this._currentFrame=(locCurrentPercent-1)*this._nextFrameIndex,(locCurrentPercent=this._currentFrame/this._durationTween)<1){this._nextFrameIndex=this._durationTween,this.movementEvent(this._armature,ccs.MovementEventType.start,this._movementID);break}break;case ccs.ANIMATION_TYPE_MAX:case ccs.ANIMATION_TYPE_SINGLE_FRAME:locCurrentPercent=1,this._isComplete=!0,this._isPlaying=!1,this.movementEvent(this._armature,ccs.MovementEventType.complete,this._movementID),this.updateMovementList();break;case ccs.ANIMATION_TYPE_TO_LOOP_FRONT:this._loopType=ccs.ANIMATION_TYPE_LOOP_FRONT,locCurrentPercent=ccs.fmodf(locCurrentPercent,1),this._currentFrame=0===this._nextFrameIndex?0:ccs.fmodf(this._currentFrame,this._nextFrameIndex),this._nextFrameIndex=this._durationTween>0?this._durationTween:1,this.movementEvent(this,ccs.MovementEventType.start,this._movementID);break;default:this._currentFrame=ccs.fmodf(this._currentFrame,this._nextFrameIndex),this._toIndex=0,this.movementEvent(this._armature,ccs.MovementEventType.loopComplete,this._movementID)}this._currentPercent=locCurrentPercent}},getCurrentMovementID:function(){return this._isComplete?"":this._movementID},setMovementEventCallFunc:function(callFunc,target){1===arguments.length?this._movementEventListener=callFunc:2===arguments.length&&(this._movementEventTarget=target,this._movementEventCallFunc=callFunc)},setFrameEventCallFunc:function(callFunc,target){1===arguments.length?this._frameEventListener=callFunc:2===arguments.length&&(this._frameEventTarget=target,this._frameEventCallFunc=callFunc)},setUserObject:function(userObject){this._userObject=userObject},frameEvent:function(bone,frameEventName,originFrameIndex,currentFrameIndex){if(this._frameEventTarget&&this._frameEventCallFunc||this._frameEventListener){var frameEvent=new ccs.FrameEvent;frameEvent.bone=bone,frameEvent.frameEventName=frameEventName,frameEvent.originFrameIndex=originFrameIndex,frameEvent.currentFrameIndex=currentFrameIndex,this._frameEventQueue.push(frameEvent)}},movementEvent:function(armature,movementType,movementID){if(this._movementEventTarget&&this._movementEventCallFunc||this._movementEventListener){var event=new ccs.MovementEvent;event.armature=armature,event.movementType=movementType,event.movementID=movementID,this._movementEventQueue.push(event)}},updateMovementList:function(){if(this._onMovementList){var movementObj,locMovementList=this._movementList;this._movementListLoop?(movementObj=locMovementList[this._movementIndex],this.play(movementObj,movementObj.durationTo,0),++this._movementIndex>=locMovementList.length&&(this._movementIndex=0)):this._movementIndex<locMovementList.length?(movementObj=locMovementList[this._movementIndex],this.play(movementObj,movementObj.durationTo,0),this._movementIndex++):this._onMovementList=!1,this._onMovementList=!0}},setAnimationData:function(data){this._animationData!==data&&(this._animationData=data)},getAnimationData:function(){return this._animationData},getUserObject:function(){return this._userObject},isIgnoreFrameEvent:function(){return this._ignoreFrameEvent}}),(_p=ccs.ArmatureAnimation.prototype).speedScale,cc.defineGetterSetter(_p,"speedScale",_p.getSpeedScale,_p.setSpeedScale),_p.animationScale,cc.defineGetterSetter(_p,"animationScale",_p.getAnimationScale,_p.setAnimationScale),_p=null,ccs.ArmatureAnimation.create=function(armature){return new ccs.ArmatureAnimation(armature)},ccs.Tween=ccs.ProcessBase.extend({_tweenData:null,_to:null,_from:null,_between:null,_movementBoneData:null,_bone:null,_frameTweenEasing:0,_betweenDuration:0,_totalDuration:0,_toIndex:0,_fromIndex:0,_animation:null,_passLastFrame:!1,ctor:function(bone){ccs.ProcessBase.prototype.ctor.call(this),this._frameTweenEasing=ccs.TweenType.LINEAR,ccs.Tween.prototype.init.call(this,bone)},init:function(bone){return this._from=new ccs.FrameData,this._between=new ccs.FrameData,this._bone=bone,this._tweenData=this._bone.getTweenData(),this._tweenData.displayIndex=-1,this._animation=null!==this._bone&&null!==this._bone.getArmature()?this._bone.getArmature().getAnimation():null,!0},play:function(movementBoneData,durationTo,durationTween,loop,tweenEasing){ccs.ProcessBase.prototype.play.call(this,durationTo,durationTween,loop,tweenEasing),this._loopType=loop?ccs.ANIMATION_TYPE_TO_LOOP_FRONT:ccs.ANIMATION_TYPE_NO_LOOP,this._totalDuration=0,this._betweenDuration=0,this._fromIndex=this._toIndex=0;var difMovement=movementBoneData!==this._movementBoneData;this.setMovementBoneData(movementBoneData),this._rawDuration=this._movementBoneData.duration;var nextKeyFrame=this._movementBoneData.getFrameData(0);this._tweenData.displayIndex=nextKeyFrame.displayIndex,this._bone.getArmature().getArmatureData().dataVersion>=ccs.CONST_VERSION_COMBINED&&(ccs.TransformHelp.nodeSub(this._tweenData,this._bone.getBoneData()),this._tweenData.scaleX+=1,this._tweenData.scaleY+=1),0===this._rawDuration?(this._loopType=ccs.ANIMATION_TYPE_SINGLE_FRAME,0===durationTo?this.setBetween(nextKeyFrame,nextKeyFrame):this.setBetween(this._tweenData,nextKeyFrame),this._frameTweenEasing=ccs.TweenType.LINEAR):this._movementBoneData.frameList.length>1&&(this._durationTween=durationTween*this._movementBoneData.scale,loop&&0!==this._movementBoneData.delay?this.setBetween(this._tweenData,this.tweenNodeTo(this.updateFrameData(1-this._movementBoneData.delay),this._between)):difMovement&&0!==durationTo?this.setBetween(this._tweenData,nextKeyFrame):this.setBetween(nextKeyFrame,nextKeyFrame)),this.tweenNodeTo(0)},gotoAndPlay:function(frameIndex){ccs.ProcessBase.prototype.gotoFrame.call(this,frameIndex),this._totalDuration=0,this._betweenDuration=0,this._fromIndex=this._toIndex=0,this._isPlaying=!0,this._isComplete=this._isPause=!1,this._currentPercent=this._curFrameIndex/(this._rawDuration-1),this._currentFrame=this._nextFrameIndex*this._currentPercent},gotoAndPause:function(frameIndex){this.gotoAndPlay(frameIndex),this.pause()},updateHandler:function(){var locCurrentPercent=null==this._currentPercent?1:this._currentPercent,locLoopType=this._loopType;if(locCurrentPercent>=1)switch(locLoopType){case ccs.ANIMATION_TYPE_SINGLE_FRAME:locCurrentPercent=1,this._isComplete=!0,this._isPlaying=!1;break;case ccs.ANIMATION_TYPE_NO_LOOP:if(locLoopType=ccs.ANIMATION_TYPE_MAX,(locCurrentPercent=this._durationTween<=0?1:(locCurrentPercent-1)*this._nextFrameIndex/this._durationTween)>=1){locCurrentPercent=1,this._isComplete=!0,this._isPlaying=!1;break}this._nextFrameIndex=this._durationTween,this._currentFrame=locCurrentPercent*this._nextFrameIndex,this._totalDuration=0,this._betweenDuration=0,this._fromIndex=this._toIndex=0;break;case ccs.ANIMATION_TYPE_TO_LOOP_FRONT:locLoopType=ccs.ANIMATION_TYPE_LOOP_FRONT,this._nextFrameIndex=this._durationTween>0?this._durationTween:1,0!==this._movementBoneData.delay?(this._currentFrame=(1-this._movementBoneData.delay)*this._nextFrameIndex,locCurrentPercent=this._currentFrame/this._nextFrameIndex):(locCurrentPercent=0,this._currentFrame=0),this._totalDuration=0,this._betweenDuration=0,this._fromIndex=this._toIndex=0;break;case ccs.ANIMATION_TYPE_MAX:locCurrentPercent=1,this._isComplete=!0,this._isPlaying=!1;break;default:this._currentFrame=ccs.fmodf(this._currentFrame,this._nextFrameIndex)}locCurrentPercent<1&&locLoopType<ccs.ANIMATION_TYPE_TO_LOOP_BACK&&(locCurrentPercent=Math.sin(locCurrentPercent*cc.PI/2)),this._currentPercent=locCurrentPercent,this._loopType=locLoopType,locLoopType>ccs.ANIMATION_TYPE_TO_LOOP_BACK&&(locCurrentPercent=this.updateFrameData(locCurrentPercent)),this._frameTweenEasing!==ccs.TweenType.TWEEN_EASING_MAX&&this.tweenNodeTo(locCurrentPercent)},setBetween:function(from,to,limit){void 0===limit&&(limit=!0);do{if(from.displayIndex<0&&to.displayIndex>=0){this._from.copy(to),this._between.subtract(to,to,limit);break}if(to.displayIndex<0&&from.displayIndex>=0){this._from.copy(from),this._between.subtract(to,to,limit);break}this._from.copy(from),this._between.subtract(from,to,limit)}while(0);from.isTween||(this._tweenData.copy(from),this._tweenData.isTween=!0),this.arriveKeyFrame(from)},arriveKeyFrame:function(keyFrameData){if(keyFrameData){var locBone=this._bone,displayManager=locBone.getDisplayManager(),displayIndex=keyFrameData.displayIndex;displayManager.getForceChangeDisplay()||displayManager.changeDisplayWithIndex(displayIndex,!1),this._tweenData.zOrder=keyFrameData.zOrder,locBone.updateZOrder(),this._bone.setBlendFunc(keyFrameData.blendFunc);var childAramture=locBone.getChildArmature();childAramture&&""!==keyFrameData.movement&&childAramture.getAnimation().play(keyFrameData.movement)}},tweenNodeTo:function(percent,node){node||(node=this._tweenData);var locFrom=this._from,locBetween=this._between;return locFrom.isTween||(percent=0),node.x=locFrom.x+percent*locBetween.x,node.y=locFrom.y+percent*locBetween.y,node.scaleX=locFrom.scaleX+percent*locBetween.scaleX,node.scaleY=locFrom.scaleY+percent*locBetween.scaleY,node.skewX=locFrom.skewX+percent*locBetween.skewX,node.skewY=locFrom.skewY+percent*locBetween.skewY,this._bone.setTransformDirty(!0),node&&locBetween.isUseColorInfo&&this.tweenColorTo(percent,node),node},tweenColorTo:function(percent,node){var locFrom=this._from,locBetween=this._between;node.a=locFrom.a+percent*locBetween.a,node.r=locFrom.r+percent*locBetween.r,node.g=locFrom.g+percent*locBetween.g,node.b=locFrom.b+percent*locBetween.b,this._bone.updateColor()},updateFrameData:function(currentPercent){currentPercent>1&&0!==this._movementBoneData.delay&&(currentPercent=ccs.fmodf(currentPercent,1));var from,to,playedTime=(this._rawDuration-1)*currentPercent,locTotalDuration=this._totalDuration,locBetweenDuration=this._betweenDuration,locToIndex=this._toIndex;if(playedTime<locTotalDuration||playedTime>=locTotalDuration+locBetweenDuration){var frames=this._movementBoneData.frameList,length=frames.length;if(playedTime<frames[0].frameID)return from=to=frames[0],this.setBetween(from,to),this._currentPercent;if(playedTime>=frames[length-1].frameID){if(this._passLastFrame)return from=to=frames[length-1],this.setBetween(from,to),this._currentPercent;this._passLastFrame=!0}else this._passLastFrame=!1;do{if(this._fromIndex=locToIndex,from=frames[this._fromIndex],locTotalDuration=from.frameID,(locToIndex=this._fromIndex+1)>=length&&(locToIndex=0),to=frames[locToIndex],from.strEvent&&!this._animation.isIgnoreFrameEvent()&&this._animation.frameEvent(this._bone,from.strEvent,from.frameID,playedTime),playedTime===from.frameID||this._passLastFrame&&this._fromIndex===length-1)break}while(playedTime<from.frameID||playedTime>=to.frameID);locBetweenDuration=to.frameID-from.frameID,this._frameTweenEasing=from.tweenEasing,this.setBetween(from,to,!1),this._totalDuration=locTotalDuration,this._betweenDuration=locBetweenDuration,this._toIndex=locToIndex}currentPercent=0===locBetweenDuration?0:(playedTime-this._totalDuration)/this._betweenDuration;var tweenType=this._frameTweenEasing!==ccs.TweenType.LINEAR?this._frameTweenEasing:this._tweenEasing;return tweenType===ccs.TweenType.TWEEN_EASING_MAX||tweenType===ccs.TweenType.LINEAR||this._passLastFrame||(currentPercent=ccs.TweenFunction.tweenTo(currentPercent,tweenType,this._from.easingParams)),currentPercent},setAnimation:function(animation){this._animation=animation},getAnimation:function(){return this._animation},setMovementBoneData:function(data){this._movementBoneData=data}}),(_p=ccs.Tween.prototype).animation,cc.defineGetterSetter(_p,"animation",_p.getAnimation,_p.setAnimation),_p=null,ccs.Tween.create=function(bone){return new ccs.Tween(bone)},ccs.PT_RATIO=32,ccs.ColliderFilter=ccs.Class.extend({_collisionType:0,_group:0,_categoryBits:0,_groupIndex:0,_maskBits:0,ctor:function(collisionType,group){this._collisionType=collisionType||0,this._group=group||0},updateShape:function(shape){if(shape instanceof cp.Shape)shape.collision_type=this._collisionType,shape.group=this._group;else if(shape instanceof Box2D.b2FilterData){var filter=new Box2D.b2FilterData;filter.categoryBits=this._categoryBits,filter.groupIndex=this._groupIndex,filter.maskBits=this._maskBits,shape.SetFilterData(filter)}}}),ccs.ColliderBody=ccs.Class.extend({shape:null,coutourData:null,colliderFilter:null,_calculatedVertexList:null,ctor:function(contourData){this.shape=null,this.coutourData=contourData,this.colliderFilter=new ccs.ColliderFilter,ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX&&(this._calculatedVertexList=[])},getContourData:function(){return this.coutourData},setColliderFilter:function(colliderFilter){this.colliderFilter=colliderFilter},getCalculatedVertexList:function(){return this._calculatedVertexList},setB2Fixture:function(fixture){this._fixture=fixture},getB2Fixture:function(){return this._fixture},setShape:function(shape){this.shape=shape},getShape:function(){return this.shape},setContourData:function(contourData){this.coutourData=contourData},getColliderFilter:function(){return this.colliderFilter}}),ccs.ColliderDetector=ccs.Class.extend({_colliderBodyList:null,_bone:null,_body:null,_active:!1,_filter:null,helpPoint:cc.p(0,0),ctor:function(bone){this._colliderBodyList=[],this._bone=null,this._body=null,this._active=!1,this._filter=null,ccs.ColliderDetector.prototype.init.call(this,bone)},init:function(bone){return this._colliderBodyList.length=0,bone&&(this._bone=bone),this._filter=new ccs.ColliderFilter,!0},addContourData:function(contourData){var colliderBody=new ccs.ColliderBody(contourData);if(this._colliderBodyList.push(colliderBody),ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX)for(var calculatedVertexList=colliderBody.getCalculatedVertexList(),vertexList=contourData.vertexList,i=0;i<vertexList.length;i++){var newVertex=new ccs.ContourVertex2(0,0);calculatedVertexList.push(newVertex)}},addContourDataList:function(contourDataList){for(var i=0;i<contourDataList.length;i++)this.addContourData(contourDataList[i])},removeContourData:function(contourData){var i,eraseList=[],locBodyList=this._colliderBodyList;for(i=0;i<locBodyList.length;i++){var body=locBodyList[i];body&&body.getContourData()===contourData&&eraseList.push(body)}for(i=0;i<eraseList.length;i++)cc.arrayRemoveObject(locBodyList,eraseList[i])},removeAll:function(){this._colliderBodyList.length=0},setActive:function(active){if(this._active!==active){this._active=active;var locShape,locBody=this._body;if(locBody){if(this._active)for(i=0;i<this._colliderBodyList.length;i++)locShape=this._colliderBodyList[i].getShape(),locBody.space.addShape(locShape);else for(var i=0;i<this._colliderBodyList.length;i++)locShape=this._colliderBodyList[i].getShape(),locBody.space.removeShape(locShape)}}},getActive:function(){return this._active},getColliderBodyList:function(){return this._colliderBodyList},setColliderFilter:function(filter){this._filter=filter;for(var locBodyList=this._colliderBodyList,i=0;i<locBodyList.length;i++){var colliderBody=locBodyList[i];colliderBody.setColliderFilter(filter),colliderBody.getShape()&&colliderBody.getColliderFilter().updateShape(colliderBody.getShape())}},getColliderFilter:function(){return this._filter},updateTransform:function(t){if(this._active)for(var colliderBody=null,locBody=this._body,locHelpPoint=this.helpPoint,i=0;i<this._colliderBodyList.length;i++){var contourData=(colliderBody=this._colliderBodyList[i]).getContourData(),shape=null;locBody&&(shape=colliderBody.getShape());for(var vs=contourData.vertexList,cvs=colliderBody.getCalculatedVertexList(),j=0;j<vs.length;j++){if(locHelpPoint.x=vs[j].x,locHelpPoint.y=vs[j].y,locHelpPoint=cc.pointApplyAffineTransform(locHelpPoint,t),ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX){var v=cc.p(0,0);v.x=locHelpPoint.x,v.y=locHelpPoint.y,cvs[j]=v}shape&&(shape.verts[2*j]=locHelpPoint.x,shape.verts[2*j+1]=locHelpPoint.y)}if(shape)for(j=0;j<vs.length;j++){var b=shape.verts[(j+1)%shape.verts.length],n=cp.v.normalize(cp.v.perp(cp.v.sub(b,shape.verts[j])));shape.planes&&(shape.planes[j].n=n,shape.planes[j].d=cp.v.dot(n,shape.verts[j]))}}},setBody:function(body){this._body=body;for(var colliderBody,locBodyList=this._colliderBodyList,i=0;i<locBodyList.length;i++){for(var verts=[],vs=(colliderBody=locBodyList[i]).getContourData().vertexList,j=0;j<vs.length;j++){var v=vs[j];verts.push(v.x),verts.push(v.y)}var shape=new cp.PolyShape(this._body,verts,cp.vzero);shape.sensor=!0,shape.data=this._bone,this._active&&this._body.space.addShape(shape),colliderBody.setShape(shape),colliderBody.getColliderFilter().updateShape(shape)}},getBody:function(){return this._body}}),(_p=ccs.ColliderDetector.prototype).colliderFilter,cc.defineGetterSetter(_p,"colliderFilter",_p.getColliderFilter,_p.setColliderFilter),_p.active,cc.defineGetterSetter(_p,"active",_p.getActive,_p.setActive),_p.body,cc.defineGetterSetter(_p,"body",_p.getBody,_p.setBody),_p=null,ccs.ColliderDetector.create=function(bone){return new ccs.ColliderDetector(bone)},ccs.Armature=ccs.Node.extend({animation:null,armatureData:null,batchNode:null,_parentBone:null,_boneDic:null,_topBoneList:null,_armatureIndexDic:null,_offsetPoint:null,version:0,_armatureTransformDirty:!0,_body:null,_blendFunc:null,_className:"Armature",ctor:function(name,parentBone){cc.Node.prototype.ctor.call(this),this._name="",this._topBoneList=[],this._armatureIndexDic={},this._offsetPoint=cc.p(0,0),this._armatureTransformDirty=!0,this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},name&&ccs.Armature.prototype.init.call(this,name,parentBone),this._texture={}},init:function(name,parentBone){parentBone&&(this._parentBone=parentBone),this.removeAllChildren(),this.animation=new ccs.ArmatureAnimation,this.animation.init(this),this._boneDic={},this._topBoneList.length=0;var animationData,armatureDataManager=ccs.armatureDataManager;if(""!==name){animationData=armatureDataManager.getAnimationData(name),cc.assert(animationData,"AnimationData not exist!"),this.animation.setAnimationData(animationData);var armatureData=armatureDataManager.getArmatureData(name);cc.assert(armatureData,"ArmatureData not exist!"),this.armatureData=armatureData;var boneDataDic=armatureData.getBoneDataDic();for(var key in boneDataDic){var bone=this.createBone(String(key));do{var movData=animationData.getMovement(animationData.movementNames[0]);if(!movData)break;var _movBoneData=movData.getMovementBoneData(bone.getName());if(!_movBoneData||_movBoneData.frameList.length<=0)break;var frameData=_movBoneData.getFrameData(0);if(!frameData)break;bone.getTweenData().copy(frameData),bone.changeDisplayWithIndex(frameData.displayIndex,!1)}while(0)}this.update(0),this.updateOffsetPoint()}else name="new_armature",this.armatureData=new ccs.ArmatureData,this.armatureData.name=name,(animationData=new ccs.AnimationData).name=name,armatureDataManager.addArmatureData(name,this.armatureData),armatureDataManager.addAnimationData(name,animationData),this.animation.setAnimationData(animationData);return this._renderCmd.initShaderCache(),this.setCascadeOpacityEnabled(!0),this.setCascadeColorEnabled(!0),!0},visit:function(parent){this._visible&&(this._renderCmd.visit(parent&&parent._renderCmd),this._renderCmd._dirtyFlag=0)},addChild:function(child,localZOrder,tag){child instanceof ccui.Widget?cc.log("Armature doesn't support to add Widget as its child, it will be fix soon."):cc.Node.prototype.addChild.call(this,child,localZOrder,tag)},createBone:function(boneName){var existedBone=this.getBone(boneName);if(existedBone)return existedBone;var boneData=this.armatureData.getBoneData(boneName),parentName=boneData.parentName,bone=null;return parentName?(this.createBone(parentName),bone=new ccs.Bone(boneName),this.addBone(bone,parentName)):(bone=new ccs.Bone(boneName),this.addBone(bone,"")),bone.setBoneData(boneData),bone.getDisplayManager().changeDisplayWithIndex(-1,!1),bone},addBone:function(bone,parentName){cc.assert(bone,"Argument must be non-nil");var locBoneDic=this._boneDic;if(bone.getName()&&cc.assert(!locBoneDic[bone.getName()],"bone already added. It can't be added again"),parentName){var boneParent=locBoneDic[parentName];boneParent?boneParent.addChildBone(bone):this._topBoneList.push(bone)}else this._topBoneList.push(bone);bone.setArmature(this),locBoneDic[bone.getName()]=bone,this.addChild(bone)},removeBone:function(bone,recursion){cc.assert(bone,"bone must be added to the bone dictionary!"),bone.setArmature(null),bone.removeFromParent(recursion),cc.arrayRemoveObject(this._topBoneList,bone),delete this._boneDic[bone.getName()],this.removeChild(bone,!0)},getBone:function(name){return this._boneDic[name]},changeBoneParent:function(bone,parentName){cc.assert(bone,"bone must be added to the bone dictionary!");var parentBone=bone.getParentBone();if(parentBone&&(cc.arrayRemoveObject(parentBone.getChildren(),bone),bone.setParentBone(null)),parentName){var boneParent=this._boneDic[parentName];boneParent?(boneParent.addChildBone(bone),cc.arrayRemoveObject(this._topBoneList,bone)):this._topBoneList.push(bone)}},getBoneDic:function(){return this._boneDic},updateOffsetPoint:function(){var rect=this.getBoundingBox();this.setContentSize(rect);var locOffsetPoint=this._offsetPoint;locOffsetPoint.x=-rect.x,locOffsetPoint.y=-rect.y,0!==rect.width&&0!==rect.height&&this.setAnchorPoint(locOffsetPoint.x/rect.width,locOffsetPoint.y/rect.height)},getOffsetPoints:function(){return{x:this._offsetPoint.x,y:this._offsetPoint.y}},setAnimation:function(animation){this.animation=animation},getAnimation:function(){return this.animation},getArmatureTransformDirty:function(){return this._armatureTransformDirty},update:function(dt){this.animation.update(dt);for(var locTopBoneList=this._topBoneList,i=0;i<locTopBoneList.length;i++)locTopBoneList[i].update(dt);this._armatureTransformDirty=!1},onEnter:function(){cc.Node.prototype.onEnter.call(this),this.scheduleUpdate()},onExit:function(){cc.Node.prototype.onExit.call(this),this.unscheduleUpdate()},getBoundingBox:function(){for(var minX,minY,maxX,maxY=0,first=!0,boundingBox=cc.rect(0,0,0,0),locChildren=this._children,len=locChildren.length,i=0;i<len;i++){var bone=locChildren[i];if(bone){var r=bone.getDisplayManager().getBoundingBox();if(0===r.x&&0===r.y&&0===r.width&&0===r.height)continue;first?(minX=r.x,minY=r.y,maxX=r.x+r.width,maxY=r.y+r.height,first=!1):(minX=r.x<boundingBox.x?r.x:boundingBox.x,minY=r.y<boundingBox.y?r.y:boundingBox.y,maxX=r.x+r.width>boundingBox.x+boundingBox.width?r.x+r.width:boundingBox.x+boundingBox.width,maxY=r.y+r.height>boundingBox.y+boundingBox.height?r.y+r.height:boundingBox.y+boundingBox.height),boundingBox.x=minX,boundingBox.y=minY,boundingBox.width=maxX-minX,boundingBox.height=maxY-minY}}return cc.rectApplyAffineTransform(boundingBox,this.getNodeToParentTransform())},getBoneAtPoint:function(x,y){for(var locChildren=this._children,i=locChildren.length-1;i>=0;i--){var child=locChildren[i];if(child instanceof ccs.Bone&&child.getDisplayManager().containPoint(x,y))return child}return null},setParentBone:function(parentBone){this._parentBone=parentBone;var locBoneDic=this._boneDic;for(var key in locBoneDic)locBoneDic[key].setArmature(this)},getParentBone:function(){return this._parentBone},drawContour:function(){cc._drawingUtil.setDrawColor(255,255,255,255),cc._drawingUtil.setLineWidth(1);var locBoneDic=this._boneDic;for(var key in locBoneDic){var detector=locBoneDic[key].getColliderDetector();if(detector)for(var bodyList=detector.getColliderBodyList(),i=0;i<bodyList.length;i++){var vertexList=bodyList[i].getCalculatedVertexList();cc._drawingUtil.drawPoly(vertexList,vertexList.length,!0)}}},setBody:function(body){if(this._body!==body){this._body=body,this._body.data=this;for(var child,displayObject,locChildren=this._children,i=0;i<locChildren.length;i++)if((child=locChildren[i])instanceof ccs.Bone)for(var displayList=child.getDisplayManager().getDecorativeDisplayList(),j=0;j<displayList.length;j++){var detector=(displayObject=displayList[j]).getColliderDetector();detector&&detector.setBody(this._body)}}},getShapeList:function(){return this._body?this._body.shapeList:null},getBody:function(){return this._body},setBlendFunc:function(blendFunc,dst){void 0===dst?(this._blendFunc.src=blendFunc.src,this._blendFunc.dst=blendFunc.dst):(this._blendFunc.src=blendFunc,this._blendFunc.dst=dst)},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},setColliderFilter:function(filter){var locBoneDic=this._boneDic;for(var key in locBoneDic)locBoneDic[key].setColliderFilter(filter)},getArmatureData:function(){return this.armatureData},setArmatureData:function(armatureData){this.armatureData=armatureData},getBatchNode:function(){return this.batchNode},setBatchNode:function(batchNode){this.batchNode=batchNode},getVersion:function(){return this.version},setVersion:function(version){this.version=version},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new ccs.Armature.CanvasRenderCmd(this):new ccs.Armature.WebGLRenderCmd(this)}}),(_p=ccs.Armature.prototype).parentBone,cc.defineGetterSetter(_p,"parentBone",_p.getParentBone,_p.setParentBone),_p.body,cc.defineGetterSetter(_p,"body",_p.getBody,_p.setBody),_p.colliderFilter,cc.defineGetterSetter(_p,"colliderFilter",null,_p.setColliderFilter),_p=null,ccs.Armature.create=function(name,parentBone){return new ccs.Armature(name,parentBone)},ccs.Armature.RenderCmd={_updateAnchorPointInPoint:function(){var node=this._node,contentSize=node._contentSize,anchorPoint=node._anchorPoint,offsetPoint=node._offsetPoint;this._anchorPointInPoints.x=contentSize.width*anchorPoint.x-offsetPoint.x,this._anchorPointInPoints.y=contentSize.height*anchorPoint.y-offsetPoint.y,this._realAnchorPointInPoints.x=contentSize.width*anchorPoint.x,this._realAnchorPointInPoints.y=contentSize.height*anchorPoint.y,this.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getAnchorPointInPoints:function(){return cc.p(this._realAnchorPointInPoints)}},function(){ccs.Armature.CanvasRenderCmd=function(renderableObject){this._rootCtor(renderableObject),this._needDraw=!0,this._realAnchorPointInPoints=new cc.Point(0,0),this._canUseDirtyRegion=!0,this._startRenderCmd=new cc.CustomRenderCmd(this,this._startCmdCallback),this._RestoreRenderCmd=new cc.CustomRenderCmd(this,this._RestoreCmdCallback),this._startRenderCmd._canUseDirtyRegion=!0,this._RestoreRenderCmd._canUseDirtyRegion=!0,this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0}};var proto=ccs.Armature.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);cc.inject(ccs.Armature.RenderCmd,proto),proto.constructor=ccs.Armature.CanvasRenderCmd,proto._startCmdCallback=function(ctx,scaleX,scaleY){var parent=this._node._parent;this.transform(parent?parent._renderCmd:null);var wrapper=ctx||cc._renderContext;wrapper.save(),wrapper._switchToArmatureMode(!0,this._worldTransform,scaleX,scaleY)},proto.transform=function(parentCmd,recursive){this.originTransform(parentCmd,recursive);for(var locChildren=this._node._children,i=0,len=locChildren.length;i<len;i++){var selBone=locChildren[i],boneCmd=selBone._renderCmd;if(selBone&&selBone.getDisplayRenderNode){var boneType=selBone.getDisplayRenderNodeType(),selNode=selBone.getDisplayRenderNode();if(selNode&&selNode._renderCmd){var cmd=selNode._renderCmd;cmd.transform(null),boneType!==ccs.DISPLAY_TYPE_ARMATURE&&boneType!==ccs.DISPLAY_TYPE_SPRITE&&cc.affineTransformConcatIn(cmd._worldTransform,selBone._worldTransform);var flags=cc.Node._dirtyFlags,locFlag=cmd._dirtyFlag,boneFlag=boneCmd._dirtyFlag,colorDirty=boneFlag&flags.colorDirty,opacityDirty=boneFlag&flags.opacityDirty;colorDirty&&boneCmd._updateDisplayColor(this._displayedColor),opacityDirty&&boneCmd._updateDisplayOpacity(this._displayedOpacity),(colorDirty||opacityDirty)&&boneCmd._updateColor();var parentColor=selBone._renderCmd._displayedColor,parentOpacity=selBone._renderCmd._displayedOpacity;colorDirty=locFlag&flags.colorDirty,opacityDirty=locFlag&flags.opacityDirty,colorDirty&&cmd._updateDisplayColor(parentColor),opacityDirty&&cmd._updateDisplayOpacity(parentOpacity),(colorDirty||opacityDirty)&&cmd._updateColor()}}}},proto._RestoreCmdCallback=function(wrapper){this._cacheDirty=!1,wrapper._switchToArmatureMode(!1),wrapper.restore()},proto.initShaderCache=function(){},proto.setShaderProgram=function(){},proto.updateChildPosition=function(dis,bone){dis.visit()},proto.rendering=function(ctx,scaleX,scaleY){for(var locChildren=this._node._children,i=(cc.BlendFunc.ALPHA_PREMULTIPLIED,cc.BlendFunc.ALPHA_NON_PREMULTIPLIED,0),len=locChildren.length;i<len;i++){var selBone=locChildren[i];if(selBone&&selBone.getDisplayRenderNode){var selNode=selBone.getDisplayRenderNode();if(null===selNode)continue;switch(selBone._renderCmd._syncStatus(this),selBone.getDisplayRenderNodeType()){case ccs.DISPLAY_TYPE_SPRITE:selNode.visit(selBone);break;case ccs.DISPLAY_TYPE_ARMATURE:selNode._renderCmd.rendering(ctx,scaleX,scaleY);break;default:selNode.visit(selBone)}}else selBone instanceof cc.Node&&this._visitNormalChild(selBone)}},proto._visitNormalChild=function(childNode){if(childNode){var cmd=childNode._renderCmd;if(childNode._visible){cmd._curLevel=this._curLevel+1;var i,child,children=childNode._children;cmd._syncStatus(this),cmd.transform(null);var len=children.length;if(len>0){for(childNode.sortAllChildren(),i=0;i<len&&(child=children[i])._localZOrder<0;i++)child.visit(childNode);for(cc.renderer.pushRenderCommand(cmd);i<len;i++)children[i].visit(childNode)}else cc.renderer.pushRenderCommand(cmd);this._dirtyFlag=0}}},proto.visit=function(parentCmd){var node=this._node;node._visible&&(this._syncStatus(parentCmd),node.sortAllChildren(),cc.renderer.pushRenderCommand(this._startRenderCmd),this.rendering(),cc.renderer.pushRenderCommand(this._RestoreRenderCmd),this._cacheDirty=!1)}}(),function(){ccs.Armature.WebGLRenderCmd=function(renderableObject){this._rootCtor(renderableObject),this._needDraw=!0,this._parentCmd=null,this._realAnchorPointInPoints=new cc.Point(0,0),this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0}};var proto=ccs.Armature.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.inject(ccs.Armature.RenderCmd,proto),proto.constructor=ccs.Armature.WebGLRenderCmd,proto.uploadData=function(f32buffer,ui32buffer,vertexDataOffset){for(var cmd,node=this._node,parentCmd=this._parentCmd||this,locChildren=node._children,alphaPremultiplied=cc.BlendFunc.ALPHA_PREMULTIPLIED,alphaNonPremultipled=cc.BlendFunc.ALPHA_NON_PREMULTIPLIED,i=0,len=locChildren.length;i<len;i++){var selBone=locChildren[i],boneCmd=selBone._renderCmd;if(selBone&&selBone.getDisplayRenderNode){var selNode=selBone.getDisplayRenderNode();if(null===selNode)continue;switch(cmd=selNode._renderCmd,selBone.getDisplayRenderNodeType()){case ccs.DISPLAY_TYPE_SPRITE:if(selNode instanceof ccs.Skin){selNode.setShaderProgram(this._shaderProgram),this._updateColorAndOpacity(cmd,selBone),cmd.transform(parentCmd);var func=selBone.getBlendFunc();if(func.src!==alphaPremultiplied.src||func.dst!==alphaPremultiplied.dst)selNode.setBlendFunc(selBone.getBlendFunc());else{var tex=selNode.getTexture();node._blendFunc.src===alphaPremultiplied.src&&node._blendFunc.dst===alphaPremultiplied.dst&&tex&&!tex.hasPremultipliedAlpha()?selNode.setBlendFunc(alphaNonPremultipled):selNode.setBlendFunc(node._blendFunc)}cc.renderer._uploadBufferData(cmd)}break;case ccs.DISPLAY_TYPE_ARMATURE:selNode.setShaderProgram(this._shaderProgram),this._updateColorAndOpacity(cmd,selBone),cmd._parentCmd=this;default:boneCmd._syncStatus(parentCmd),cmd._syncStatus(boneCmd),cmd.uploadData?cc.renderer._uploadBufferData(cmd):cmd.rendering&&(cc.renderer._batchRendering(),cmd.rendering(cc._renderContext))}}else selBone instanceof cc.Node&&(selBone.setShaderProgram(this._shaderProgram),boneCmd._syncStatus(parentCmd),boneCmd.uploadData?cc.renderer._uploadBufferData(boneCmd):boneCmd.rendering&&(cc.renderer._batchRendering(),boneCmd.rendering(cc._renderContext)))}return this._parentCmd=null,0},proto.initShaderCache=function(){this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)},proto.setShaderProgram=function(shaderProgram){this._shaderProgram=shaderProgram},proto._updateColorAndOpacity=function(skinRenderCmd,bone){var parentColor=bone._renderCmd._displayedColor,parentOpacity=bone._renderCmd._displayedOpacity,flags=cc.Node._dirtyFlags,locFlag=skinRenderCmd._dirtyFlag,colorDirty=locFlag&flags.colorDirty,opacityDirty=locFlag&flags.opacityDirty;colorDirty&&skinRenderCmd._updateDisplayColor(parentColor),opacityDirty&&skinRenderCmd._updateDisplayOpacity(parentOpacity),(colorDirty||opacityDirty)&&skinRenderCmd._updateColor()},proto.visit=function(parentCmd){var node=this._node;if(node._visible){(parentCmd=parentCmd||this.getParentRenderCmd())&&(this._curLevel=parentCmd._curLevel+1),this._syncStatus(parentCmd),node.sortAllChildren();var child,i,renderer=cc.renderer,children=node._children,len=children.length;for(isNaN(node._customZ)&&(node._vertexZ=renderer.assignedZ,renderer.assignedZ+=renderer.assignedZStep),i=0;i<len&&(child=children[i])._localZOrder<0;i++)isNaN(child._customZ)&&(child._vertexZ=renderer.assignedZ,renderer.assignedZ+=renderer.assignedZStep);for(renderer.pushRenderCommand(this);i<len;i++)child=children[i],isNaN(child._customZ)&&(child._vertexZ=renderer.assignedZ,renderer.assignedZ+=renderer.assignedZStep);this._dirtyFlag=0}}}(),ccs.Bone=ccs.Node.extend({_boneData:null,_armature:null,_childArmature:null,_displayManager:null,ignoreMovementBoneData:!1,_tween:null,_tweenData:null,_parentBone:null,_boneTransformDirty:!1,_worldTransform:null,_blendFunc:null,blendDirty:!1,_worldInfo:null,_armatureParentBone:null,_dataVersion:0,_className:"Bone",ctor:function(name){cc.Node.prototype.ctor.call(this),this._tweenData=null,this._parentBone=null,this._armature=null,this._childArmature=null,this._boneData=null,this._tween=null,this._displayManager=null,this.ignoreMovementBoneData=!1,this._worldTransform=cc.affineTransformMake(1,0,0,1,0,0),this._boneTransformDirty=!0,this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST),this.blendDirty=!1,this._worldInfo=null,this._armatureParentBone=null,this._dataVersion=0,ccs.Bone.prototype.init.call(this,name)},init:function(name){return name&&(this._name=name),this._tweenData=new ccs.FrameData,this._tween=new ccs.Tween(this),this._displayManager=new ccs.DisplayManager(this),this._worldInfo=new ccs.BaseData,this._boneData=new ccs.BaseData,!0},setBoneData:function(boneData){cc.assert(boneData,"_boneData must not be null"),this._boneData!==boneData&&(this._boneData=boneData),this.setName(this._boneData.name),this._localZOrder=this._boneData.zOrder,this._displayManager.initDisplayList(boneData)},getBoneData:function(){return this._boneData},setArmature:function(armature){this._armature=armature,armature?(this._tween.setAnimation(this._armature.getAnimation()),this._dataVersion=this._armature.getArmatureData().dataVersion,this._armatureParentBone=this._armature.getParentBone()):this._armatureParentBone=null},getArmature:function(){return this._armature},update:function(delta){if(this._parentBone&&(this._boneTransformDirty=this._boneTransformDirty||this._parentBone.isTransformDirty()),this._armatureParentBone&&!this._boneTransformDirty&&(this._boneTransformDirty=this._armatureParentBone.isTransformDirty()),this._boneTransformDirty){var locTweenData=this._tweenData;this._dataVersion>=ccs.CONST_VERSION_COMBINED&&(ccs.TransformHelp.nodeConcat(locTweenData,this._boneData),locTweenData.scaleX-=1,locTweenData.scaleY-=1);var locWorldInfo=this._worldInfo;locWorldInfo.copy(locTweenData),locWorldInfo.x=locTweenData.x+this._position.x,locWorldInfo.y=locTweenData.y+this._position.y,locWorldInfo.scaleX=locTweenData.scaleX*this._scaleX,locWorldInfo.scaleY=locTweenData.scaleY*this._scaleY,locWorldInfo.skewX=locTweenData.skewX+this._skewX+cc.degreesToRadians(this._rotationX),locWorldInfo.skewY=locTweenData.skewY+this._skewY-cc.degreesToRadians(this._rotationY),this._parentBone?this._applyParentTransform(this._parentBone):this._armatureParentBone&&this._applyParentTransform(this._armatureParentBone),ccs.TransformHelp.nodeToMatrix(locWorldInfo,this._worldTransform),this._armatureParentBone&&cc.affineTransformConcatIn(this._worldTransform,this._armature.getNodeToParentTransform())}ccs.displayFactory.updateDisplay(this,delta,this._boneTransformDirty||this._armature.getArmatureTransformDirty());for(var i=0;i<this._children.length;i++)this._children[i].update(delta);this._boneTransformDirty=!1},_applyParentTransform:function(parent){var locWorldInfo=this._worldInfo,locParentWorldTransform=parent._worldTransform,locParentWorldInfo=parent._worldInfo,x=locWorldInfo.x,y=locWorldInfo.y;locWorldInfo.x=x*locParentWorldTransform.a+y*locParentWorldTransform.c+locParentWorldInfo.x,locWorldInfo.y=x*locParentWorldTransform.b+y*locParentWorldTransform.d+locParentWorldInfo.y,locWorldInfo.scaleX=locWorldInfo.scaleX*locParentWorldInfo.scaleX,locWorldInfo.scaleY=locWorldInfo.scaleY*locParentWorldInfo.scaleY,locWorldInfo.skewX=locWorldInfo.skewX+locParentWorldInfo.skewX,locWorldInfo.skewY=locWorldInfo.skewY+locParentWorldInfo.skewY},setBlendFunc:function(blendFunc,dst){var srcValue,dstValue,locBlendFunc=this._blendFunc;void 0===dst?(srcValue=blendFunc.src,dstValue=blendFunc.dst):(srcValue=blendFunc,dstValue=dst),locBlendFunc.src===srcValue&&locBlendFunc.dst===dstValue||(locBlendFunc.src=srcValue,locBlendFunc.dst=dstValue,this.blendDirty=!0)},updateColor:function(){var display=this._displayManager.getDisplayRenderNode();if(null!==display){var cmd=this._renderCmd;display.setColor(cc.color(cmd._displayedColor.r*this._tweenData.r/255,cmd._displayedColor.g*this._tweenData.g/255,cmd._displayedColor.b*this._tweenData.b/255)),display.setOpacity(cmd._displayedOpacity*this._tweenData.a/255)}},updateZOrder:function(){this._armature.getArmatureData().dataVersion>=ccs.CONST_VERSION_COMBINED?this.setLocalZOrder(this._tweenData.zOrder+this._boneData.zOrder):this.setLocalZOrder(this._tweenData.zOrder)},addChildBone:function(child){cc.assert(child,"Argument must be non-nil"),cc.assert(!child.parentBone,"child already added. It can't be added again"),this._children.indexOf(child)<0&&(this._children.push(child),child.setParentBone(this))},removeChildBone:function(bone,recursion){if(this._children.length>0&&-1!==this._children.getIndex(bone)){if(recursion)for(var ccbones=bone._children,i=0;i<ccbones.length;i++){var ccBone=ccbones[i];bone.removeChildBone(ccBone,recursion)}bone.setParentBone(null),bone.getDisplayManager().setCurrentDecorativeDisplay(null),cc.arrayRemoveObject(this._children,bone)}},removeFromParent:function(recursion){this._parentBone&&this._parentBone.removeChildBone(this,recursion)},setParentBone:function(parent){this._parentBone=parent},getParentBone:function(){return this._parentBone},setChildArmature:function(armature){this._childArmature!==armature&&(null==armature&&this._childArmature&&this._childArmature.setParentBone(null),this._childArmature=armature)},getChildArmature:function(){return this._childArmature},getTween:function(){return this._tween},setLocalZOrder:function(zOrder){this._localZOrder!==zOrder&&cc.Node.prototype.setLocalZOrder.call(this,zOrder)},getNodeToArmatureTransform:function(){return this._worldTransform},getNodeToWorldTransform:function(){return cc.affineTransformConcat(this._worldTransform,this._armature.getNodeToWorldTransform())},getDisplayRenderNode:function(){return this._displayManager.getDisplayRenderNode()},getDisplayRenderNodeType:function(){return this._displayManager.getDisplayRenderNodeType()},addDisplay:function(displayData,index){return index=index||0,this._displayManager.addDisplay(displayData,index)},removeDisplay:function(index){this._displayManager.removeDisplay(index)},changeDisplayByIndex:function(index,force){cc.log("changeDisplayByIndex is deprecated. Use changeDisplayWithIndex instead."),this.changeDisplayWithIndex(index,force)},changeDisplayByName:function(name,force){cc.log("changeDisplayByName is deprecated. Use changeDisplayWithName instead."),this.changeDisplayWithName(name,force)},changeDisplayWithIndex:function(index,force){this._displayManager.changeDisplayWithIndex(index,force)},changeDisplayWithName:function(name,force){this._displayManager.changeDisplayWithName(name,force)},getColliderDetector:function(){var decoDisplay=this._displayManager.getCurrentDecorativeDisplay();if(decoDisplay){var detector=decoDisplay.getColliderDetector();if(detector)return detector}return null},setColliderFilter:function(filter){for(var displayList=this._displayManager.getDecorativeDisplayList(),i=0;i<displayList.length;i++){var locDetector=displayList[i].getColliderDetector();locDetector&&locDetector.setColliderFilter(filter)}},getColliderFilter:function(){var decoDisplay=this.displayManager.getCurrentDecorativeDisplay();if(decoDisplay){var detector=decoDisplay.getColliderDetector();if(detector)return detector.getColliderFilter()}return null},setTransformDirty:function(dirty){this._boneTransformDirty=dirty},isTransformDirty:function(){return this._boneTransformDirty},getDisplayManager:function(){return this._displayManager},setIgnoreMovementBoneData:function(bool){this._ignoreMovementBoneData=bool},isIgnoreMovementBoneData:function(){return this._ignoreMovementBoneData},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},setBlendDirty:function(dirty){this._blendDirty=dirty},isBlendDirty:function(){return this._blendDirty},getTweenData:function(){return this._tweenData},getWorldInfo:function(){return this._worldInfo},getChildrenBone:function(){return this._children},nodeToArmatureTransform:function(){return this.getNodeToArmatureTransform()},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getColliderBodyList:function(){var detector=this.getColliderDetector();return detector?detector.getColliderBodyList():null},getIgnoreMovementBoneData:function(){return this.isIgnoreMovementBoneData()},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new ccs.Bone.CanvasRenderCmd(this):new ccs.Bone.WebGLRenderCmd(this)}}),(_p=ccs.Bone.prototype).boneData,cc.defineGetterSetter(_p,"boneData",_p.getBoneData,_p.setBoneData),_p.armature,cc.defineGetterSetter(_p,"armature",_p.getArmature,_p.setArmature),_p.childArmature,cc.defineGetterSetter(_p,"childArmature",_p.getChildArmature,_p.setChildArmature),_p.childrenBone,cc.defineGetterSetter(_p,"childrenBone",_p.getChildrenBone),_p.tween,cc.defineGetterSetter(_p,"tween",_p.getTween),_p.tweenData,cc.defineGetterSetter(_p,"tweenData",_p.getTweenData),_p.colliderFilter,cc.defineGetterSetter(_p,"colliderFilter",_p.getColliderFilter,_p.setColliderFilter),_p=null,ccs.Bone.create=function(name){return new ccs.Bone(name)},ccs.Bone.RenderCmd={_updateColor:function(){var node=this._node,display=node._displayManager.getDisplayRenderNode();if(null!==display){var displayCmd=display._renderCmd;display.setColor(this._displayedColor),display.setOpacity(this._displayedOpacity),displayCmd._syncDisplayColor(node._tweenData),displayCmd._syncDisplayOpacity(node._tweenData.a),displayCmd._updateColor()}},transform:function(parentCmd,recursive){this._transform||(this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0});var node=this._node,t=this._transform,wt=this._worldTransform,pt=parentCmd?parentCmd._worldTransform:null;pt&&(this.originTransform(),cc.affineTransformConcatIn(t,node._worldTransform)),pt?(wt.a=t.a*pt.a+t.b*pt.c,wt.b=t.a*pt.b+t.b*pt.d,wt.c=t.c*pt.a+t.d*pt.c,wt.d=t.c*pt.b+t.d*pt.d,wt.tx=t.tx*pt.a+t.ty*pt.c+pt.tx,wt.ty=t.tx*pt.b+t.ty*pt.d+pt.ty):(wt.a=t.a,wt.b=t.b,wt.c=t.c,wt.d=t.d,wt.tx=t.tx,wt.ty=t.ty)}},function(){ccs.Bone.CanvasRenderCmd=function(renderable){this._rootCtor(renderable),this._needDraw=!1};var proto=ccs.Bone.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);cc.inject(ccs.Bone.RenderCmd,proto),proto.constructor=ccs.Bone.CanvasRenderCmd}(),function(){if(cc.Node.WebGLRenderCmd){ccs.Bone.WebGLRenderCmd=function(renderable){this._rootCtor(renderable),this._needDraw=!1};var proto=ccs.Bone.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.inject(ccs.Bone.RenderCmd,proto),proto.constructor=ccs.Bone.WebGLRenderCmd}}(),ccs.FRAME_TYPE_MOVE=0,ccs.FRAME_TYPE_SCALE=1,ccs.FRAME_TYPE_ROTATE=2,ccs.FRAME_TYPE_TINT=3,ccs.FRAME_TYPE_FADE=4,ccs.FRAME_TYPE_MAX=5,ccs.FrameEaseType={CUSTOM:-1,LINEAR:0,SINE_EASEIN:1,SINE_EASEOUT:2,SINE_EASEINOUT:3,QUAD_EASEIN:4,QUAD_EASEOUT:5,QUAD_EASEINOUT:6,CUBIC_EASEIN:7,CUBIC_EASEOUT:8,CUBIC_EASEINOUT:9,QUART_EASEIN:10,QUART_EASEOUT:11,QUART_EASEINOUT:12,QUINT_EASEIN:13,QUINT_EASEOUT:14,QUINT_EASEINOUT:15,EXPO_EASEIN:16,EXPO_EASEOUT:17,EXPO_EASEINOUT:18,CIRC_EASEIN:19,CIRC_EASEOUT:20,CIRC_EASEINOUT:21,ELASTIC_EASEIN:22,ELASTIC_EASEOUT:23,ELASTIC_EASEINOUT:24,BACK_EASEIN:25,BACK_EASEOUT:26,BACK_EASEINOUT:27,BOUNCE_EASEIN:28,BOUNCE_EASEOUT:29,BOUNCE_EASEINOUT:30,TWEEN_EASING_MAX:1e3},ccs.ActionFrame=ccs.Class.extend({frameType:0,easingType:0,frameIndex:0,_Parameter:null,time:0,ctor:function(){this.frameType=0,this.easingType=ccs.FrameEaseType.LINEAR,this.frameIndex=0,this.time=0},getAction:function(duration,srcFrame){return cc.log("Need a definition of <getAction> for ActionFrame"),null},_getEasingAction:function(action){if(null===action)return console.error("Action cannot be null!"),null;var resultAction;switch(this.easingType){case ccs.FrameEaseType.CUSTOM:break;case ccs.FrameEaseType.LINEAR:resultAction=action;break;case ccs.FrameEaseType.SINE_EASEIN:resultAction=action.easing(cc.easeSineIn());break;case ccs.FrameEaseType.SINE_EASEOUT:resultAction=action.easing(cc.easeSineOut());break;case ccs.FrameEaseType.SINE_EASEINOUT:resultAction=action.easing(cc.easeSineInOut());break;case ccs.FrameEaseType.QUAD_EASEIN:resultAction=action.easing(cc.easeQuadraticActionIn());break;case ccs.FrameEaseType.QUAD_EASEOUT:resultAction=action.easing(cc.easeQuadraticActionOut());break;case ccs.FrameEaseType.QUAD_EASEINOUT:resultAction=action.easing(cc.easeQuadraticActionInOut());break;case ccs.FrameEaseType.CUBIC_EASEIN:resultAction=action.easing(cc.easeCubicActionIn());break;case ccs.FrameEaseType.CUBIC_EASEOUT:resultAction=action.easing(cc.easeCubicActionOut());break;case ccs.FrameEaseType.CUBIC_EASEINOUT:resultAction=action.easing(cc.easeCubicActionInOut());break;case ccs.FrameEaseType.QUART_EASEIN:resultAction=action.easing(cc.easeQuarticActionIn());break;case ccs.FrameEaseType.QUART_EASEOUT:resultAction=action.easing(cc.easeQuarticActionOut());break;case ccs.FrameEaseType.QUART_EASEINOUT:resultAction=action.easing(cc.easeQuarticActionInOut());break;case ccs.FrameEaseType.QUINT_EASEIN:resultAction=action.easing(cc.easeQuinticActionIn());break;case ccs.FrameEaseType.QUINT_EASEOUT:resultAction=action.easing(cc.easeQuinticActionOut());break;case ccs.FrameEaseType.QUINT_EASEINOUT:resultAction=action.easing(cc.easeQuinticActionInOut());break;case ccs.FrameEaseType.EXPO_EASEIN:resultAction=action.easing(cc.easeExponentialIn());break;case ccs.FrameEaseType.EXPO_EASEOUT:resultAction=action.easing(cc.easeExponentialOut());break;case ccs.FrameEaseType.EXPO_EASEINOUT:resultAction=action.easing(cc.easeExponentialInOut());break;case ccs.FrameEaseType.CIRC_EASEIN:resultAction=action.easing(cc.easeCircleActionIn());break;case ccs.FrameEaseType.CIRC_EASEOUT:resultAction=action.easing(cc.easeCircleActionOut());break;case ccs.FrameEaseType.CIRC_EASEINOUT:resultAction=action.easing(cc.easeCircleActionInOut());break;case ccs.FrameEaseType.ELASTIC_EASEIN:resultAction=action.easing(cc.easeElasticIn());break;case ccs.FrameEaseType.ELASTIC_EASEOUT:resultAction=action.easing(cc.easeElasticOut());break;case ccs.FrameEaseType.ELASTIC_EASEINOUT:resultAction=action.easing(cc.easeElasticInOut());break;case ccs.FrameEaseType.BACK_EASEIN:resultAction=action.easing(cc.easeBackIn());break;case ccs.FrameEaseType.BACK_EASEOUT:resultAction=action.easing(cc.easeBackOut());break;case ccs.FrameEaseType.BACK_EASEINOUT:resultAction=action.easing(cc.easeBackInOut());break;case ccs.FrameEaseType.BOUNCE_EASEIN:resultAction=action.easing(cc.easeBounceIn());break;case ccs.FrameEaseType.BOUNCE_EASEOUT:resultAction=action.easing(cc.easeBounceOut());break;case ccs.FrameEaseType.BOUNCE_EASEINOUT:resultAction=action.easing(cc.easeBounceInOut())}return resultAction},setEasingParameter:function(parameter){this._Parameter=[];for(var i=0;i<parameter.length;i++)this._Parameter.push(parameter[i])},setEasingType:function(easingType){this.easingType=easingType}}),ccs.ActionMoveFrame=ccs.ActionFrame.extend({_position:null,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this),this._position=cc.p(0,0),this.frameType=ccs.FRAME_TYPE_MOVE},setPosition:function(pos,y){void 0===y?(this._position.x=pos.x,this._position.y=pos.y):(this._position.x=pos,this._position.y=y)},getPosition:function(){return this._position},getAction:function(duration){return this._getEasingAction(cc.moveTo(duration,this._position))}}),ccs.ActionScaleFrame=ccs.ActionFrame.extend({_scaleX:1,_scaleY:1,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this),this._scaleX=1,this._scaleY=1,this.frameType=ccs.FRAME_TYPE_SCALE},setScaleX:function(scaleX){this._scaleX=scaleX},getScaleX:function(){return this._scaleX},setScaleY:function(scaleY){this._scaleY=scaleY},getScaleY:function(){return this._scaleY},getAction:function(duration){return this._getEasingAction(cc.scaleTo(duration,this._scaleX,this._scaleY))}}),ccs.ActionRotationFrame=ccs.ActionFrame.extend({_rotation:0,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this),this._rotation=0,this.frameType=ccs.FRAME_TYPE_ROTATE},setRotation:function(rotation){this._rotation=rotation},getRotation:function(){return this._rotation},getAction:function(duration,srcFrame){if(void 0===srcFrame)return this._getEasingAction(cc.rotateTo(duration,this._rotation));if(srcFrame instanceof cc.ActionRotationFrame){var diffRotation=this._rotation-srcFrame._rotation;return this._getEasingAction(cc.rotateBy(duration,diffRotation))}return this.getAction(duration)}}),ccs.ActionFadeFrame=ccs.ActionFrame.extend({_opacity:255,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this),this._opacity=255,this.frameType=ccs.FRAME_TYPE_FADE},setOpacity:function(opacity){this._opacity=opacity},getOpacity:function(){return this._opacity},getAction:function(duration){return this._getEasingAction(cc.fadeTo(duration,this._opacity))}}),ccs.ActionTintFrame=ccs.ActionFrame.extend({_color:null,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this),this._color=cc.color(255,255,255,255),this.frameType=ccs.FRAME_TYPE_TINT},setColor:function(color){var locColor=this._color;locColor.r=color.r,locColor.g=color.g,locColor.b=color.b},getColor:function(){var locColor=this._color;return cc.color(locColor.r,locColor.g,locColor.b,locColor.a)},getAction:function(duration){return this._getEasingAction(cc.tintTo(duration,this._color.r,this._color.g,this._color.b))}}),ccs.actionManager={_actionDic:{},initWithDictionary:function(jsonName,dic,root){for(var path=jsonName,pos=path.lastIndexOf("/"),fileName=path.substr(pos+1,path.length),actionList=dic.actionlist,locActionList=[],i=0;i<actionList.length;i++){var locAction=new ccs.ActionObject,locActionDic=actionList[i];locAction.initWithDictionary(locActionDic,root),locActionList.push(locAction)}this._actionDic[fileName]=locActionList},getActionByName:function(jsonName,actionName){var path=jsonName,pos=path.lastIndexOf("/"),fileName=path.substr(pos+1,path.length),actionList=this._actionDic[fileName];if(!actionList)return null;for(var i=0;i<actionList.length;i++){var locAction=actionList[i];if(actionName===locAction.getName())return locAction}return null},playActionByName:function(jsonName,actionName,fun){var action=this.getActionByName(jsonName,actionName);action&&action.play(fun)},stopActionByName:function(jsonName,actionName){var action=this.getActionByName(jsonName,actionName);action&&action.stop()},releaseActions:function(){this._actionDic={}},clear:function(){this._actionDic={}}},ccs.ActionNode=ccs.Class.extend({_currentFrameIndex:0,_destFrameIndex:0,_unitTime:0,_actionTag:0,_object:null,_actionSpawn:null,_action:null,_frameArray:null,_frameArrayNum:0,ctor:function(){this._currentFrameIndex=0,this._destFrameIndex=0,this._unitTime=.1,this._actionTag=0,this._object=null,this._actionSpawn=null,this._action=null,this._frameArray=[],this._frameArrayNum=ccs.FRAME_TYPE_MAX;for(var i=0;i<this._frameArrayNum;i++)this._frameArray.push([])},initWithDictionary:function(dic,root){this.setActionTag(dic.ActionTag);for(var actionFrameList=dic.actionframelist,node=ccui.helper.seekActionWidgetByActionTag(root,dic.ActionTag),positionOffset=node instanceof ccui.Widget&&!(node instanceof ccui.Layout),i=0;i<actionFrameList.length;i++){var actionFrameDic=actionFrameList[i],frameIndex=actionFrameDic.frameid,frameTweenType=actionFrameDic.tweenType;null==frameTweenType&&(frameTweenType=0);for(var frameTweenParameterNum=actionFrameDic.tweenParameter,frameTweenParameter=[],j=0;j<frameTweenParameterNum;j++){var value=actionFrameDic.tweenParameter[j];frameTweenParameter.push(value)}var actionFrame;if(void 0!==actionFrameDic.positionx){var positionX=actionFrameDic.positionx,positionY=actionFrameDic.positiony;if(positionOffset&&node.parent){var AnchorPointIn=node.parent.getAnchorPointInPoints();positionX+=AnchorPointIn.x,positionY+=AnchorPointIn.y}(actionFrame=new ccs.ActionMoveFrame).frameIndex=frameIndex,actionFrame.setEasingType(frameTweenType),actionFrame.setEasingParameter(frameTweenParameter),actionFrame.setPosition(positionX,positionY),this._frameArray[ccs.FRAME_TYPE_MOVE].push(actionFrame)}if(void 0!==actionFrameDic.scalex){var scaleX=actionFrameDic.scalex,scaleY=actionFrameDic.scaley;(actionFrame=new ccs.ActionScaleFrame).frameIndex=frameIndex,actionFrame.setEasingType(frameTweenType),actionFrame.setEasingParameter(frameTweenParameter),actionFrame.setScaleX(scaleX),actionFrame.setScaleY(scaleY),this._frameArray[ccs.FRAME_TYPE_SCALE].push(actionFrame)}if(void 0!==actionFrameDic.rotation){var rotation=actionFrameDic.rotation;(actionFrame=new ccs.ActionRotationFrame).frameIndex=frameIndex,actionFrame.setEasingType(frameTweenType),actionFrame.setEasingParameter(frameTweenParameter),actionFrame.setRotation(rotation),this._frameArray[ccs.FRAME_TYPE_ROTATE].push(actionFrame)}if(void 0!==actionFrameDic.opacity){var opacity=actionFrameDic.opacity;(actionFrame=new ccs.ActionFadeFrame).frameIndex=frameIndex,actionFrame.setEasingType(frameTweenType),actionFrame.setEasingParameter(frameTweenParameter),actionFrame.setOpacity(opacity),this._frameArray[ccs.FRAME_TYPE_FADE].push(actionFrame)}if(void 0!==actionFrameDic.colorr){var colorR=actionFrameDic.colorr,colorG=actionFrameDic.colorg,colorB=actionFrameDic.colorb;(actionFrame=new ccs.ActionTintFrame).frameIndex=frameIndex,actionFrame.setEasingType(frameTweenType),actionFrame.setEasingParameter(frameTweenParameter),actionFrame.setColor(cc.color(colorR,colorG,colorB)),this._frameArray[ccs.FRAME_TYPE_TINT].push(actionFrame)}actionFrameDic=null}this._initActionNodeFromRoot(root)},_initActionNodeFromRoot:function(root){if(root instanceof ccui.Widget){var widget=ccui.helper.seekActionWidgetByActionTag(root,this.getActionTag());widget&&this.setObject(widget)}},setUnitTime:function(time){this._unitTime=time,this._refreshActionProperty()},getUnitTime:function(){return this._unitTime},setActionTag:function(tag){this._actionTag=tag},getActionTag:function(){return this._actionTag},setObject:function(node){this._object=node},getObject:function(){return this._object},getActionNode:function(){return this._object instanceof cc.Node?this._object:null},insertFrame:function(index,frame){if(null!=frame){var frameType=frame.frameType;this._frameArray[frameType].splice(index,0,frame)}},addFrame:function(frame){if(frame){var frameType=frame.frameType;this._frameArray[frameType].push(frame)}},deleteFrame:function(frame){if(void 0!==frame){var frameType=frame.frameType,array=this._frameArray[frameType];cc.arrayRemoveObject(array,frame)}},clearAllFrame:function(){for(var i=0;i<this._frameArrayNum;i++)this._frameArray[i].length=0},_refreshActionProperty:function(){if(!this._object)return null;for(var locSpawnArray=[],i=0;i<this._frameArrayNum;i++){var locArray=this._frameArray[i];if(!(locArray.length<=0)){for(var locSequenceArray=[],j=0;j<locArray.length;j++){var locFrame=locArray[j],locAction=null;if(0!==j){var locSrcFrame=locArray[j-1],locDuration=(locFrame.frameIndex-locSrcFrame.frameIndex)*this.getUnitTime();locAction=locFrame.getAction(locDuration)}else locAction=locFrame.getAction(0);locAction&&locSequenceArray.push(locAction)}if(locSequenceArray){var locSequence=cc.sequence(locSequenceArray);null!==locSequence&&locSpawnArray.push(locSequence)}}}return this._action=null,this._actionSpawn=cc.spawn(locSpawnArray),this._actionSpawn},playAction:function(fun){this._object&&this._actionSpawn&&(this._action=fun?cc.sequence(this._actionSpawn,fun):cc.sequence(this._actionSpawn),this._runAction())},_runAction:function(){var node=this.getActionNode();null!==node&&null!==this._action&&node.runAction(this._action)},stopAction:function(){var node=this.getActionNode();null!==node&&null!==this._action&&(this._action.isDone()||node.stopAction(this._action))},getFirstFrameIndex:function(){for(var locFrameindex=99999,bFindFrame=!1,locFrameArray=this._frameArray,i=0,len=this._frameArrayNum;i<len;i++){var locArray=locFrameArray[i];if(!(locArray.length<=0)){bFindFrame=!0;var locFrameIndex=locArray[0].frameIndex;locFrameindex=locFrameindex>locFrameIndex?locFrameIndex:locFrameindex}}return bFindFrame||(locFrameindex=0),locFrameindex},getLastFrameIndex:function(){for(var locFrameindex=-1,locIsFindFrame=!1,locFrameArray=this._frameArray,i=0,len=this._frameArrayNum;i<len;i++){var locArray=locFrameArray[i];if(!(locArray.length<=0)){locIsFindFrame=!0;var locFrameIndex=locArray[locArray.length-1].frameIndex;locFrameindex=locFrameindex<locFrameIndex?locFrameIndex:locFrameindex}}return locIsFindFrame||(locFrameindex=0),locFrameindex},updateActionToTimeLine:function(time){for(var locIsFindFrame=!1,locUnitTime=this.getUnitTime(),i=0;i<this._frameArrayNum;i++){var locArray=this._frameArray[i];if(locArray)for(var j=0;j<locArray.length;j++){var locFrame=locArray[j];if(locFrame.frameIndex*locUnitTime===time){this._easingToFrame(1,1,locFrame),locIsFindFrame=!0;break}if(locFrame.frameIndex*locUnitTime>time){if(0===j)this._easingToFrame(1,1,locFrame),locIsFindFrame=!1;else{var locSrcFrame=locArray[j-1],locDuration=(locFrame.frameIndex-locSrcFrame.frameIndex)*locUnitTime,locDelaytime=time-locSrcFrame.frameIndex*locUnitTime;this._easingToFrame(locDuration,1,locSrcFrame),this._easingToFrame(locDuration,locDelaytime/locDuration,locFrame),locIsFindFrame=!0}break}}}return locIsFindFrame},_easingToFrame:function(duration,delayTime,destFrame){var action=destFrame.getAction(duration),node=this.getActionNode();null!=action&&null!=node&&(action.startWithTarget(node),action.update(delayTime))},isActionDoneOnce:function(){return!this._action||this._action.isDone()}}),ccs.ActionObject=ccs.Class.extend({_actionNodeList:null,_name:"",_loop:!1,_pause:!1,_playing:!1,_unitTime:0,_currentTime:0,_scheduler:null,_callback:null,_fTotalTime:0,ctor:function(){this._actionNodeList=[],this._name="",this._loop=!1,this._pause=!1,this._playing=!1,this._unitTime=.1,this._currentTime=0,this._fTotalTime=0,this._scheduler=cc.director.getScheduler()},setName:function(name){this._name=name},getName:function(){return this._name},setLoop:function(loop){this._loop=loop},getLoop:function(){return this._loop},setUnitTime:function(time){this._unitTime=time;for(var frameNum=this._actionNodeList.length,i=0;i<frameNum;i++)this._actionNodeList[i].setUnitTime(this._unitTime)},getUnitTime:function(){return this._unitTime},getCurrentTime:function(){return this._currentTime},setCurrentTime:function(time){this._currentTime=time},getTotalTime:function(){return this._fTotalTime},isPlaying:function(){return this._playing},initWithDictionary:function(dic,root){this.setName(dic.name),this.setLoop(dic.loop),this.setUnitTime(dic.unittime);for(var actionNodeList=dic.actionnodelist,maxLength=0,i=0;i<actionNodeList.length;i++){var actionNode=new ccs.ActionNode,actionNodeDic=actionNodeList[i];actionNode.initWithDictionary(actionNodeDic,root),actionNode.setUnitTime(this.getUnitTime()),this._actionNodeList.push(actionNode);var length=actionNode.getLastFrameIndex()-actionNode.getFirstFrameIndex();length>maxLength&&(maxLength=length)}this._fTotalTime=maxLength*this._unitTime},addActionNode:function(node){node&&(this._actionNodeList.push(node),node.setUnitTime(this._unitTime))},removeActionNode:function(node){null!=node&&cc.arrayRemoveObject(this._actionNodeList,node)},play:function(fun){this.stop(),this.updateToFrameByTime(0);for(var locActionNodeList=this._actionNodeList,frameNum=locActionNodeList.length,i=0;i<frameNum;i++)locActionNodeList[i].playAction(fun);this._loop&&this._scheduler.schedule(this.simulationActionUpdate,this,0,cc.REPEAT_FOREVER,0,!1,this.__instanceId+""),void 0!==fun&&(this._callback=fun)},pause:function(){this._pause=!0,this._playing=!1},stop:function(){for(var locActionNodeList=this._actionNodeList,i=0;i<locActionNodeList.length;i++)locActionNodeList[i].stopAction();this._scheduler.unschedule(this.simulationActionUpdate,this),this._pause=!1,this._playing=!1},updateToFrameByTime:function(time){this._currentTime=time;for(var i=0;i<this._actionNodeList.length;i++)this._actionNodeList[i].updateActionToTimeLine(time)},simulationActionUpdate:function(dt){for(var isEnd=!0,locNodeList=this._actionNodeList,i=0,len=locNodeList.length;i<len;i++)if(!locNodeList[i].isActionDoneOnce()){isEnd=!1;break}isEnd&&(null!==this._callback&&this._callback.execute(),this._loop?this.play():(this._playing=!1,this._scheduler.unschedule(this.simulationActionUpdate,this)))}}),ccs.ComAttribute=ccs.Component.extend({_jsonDict:null,_filePath:"",ctor:function(){cc.Component.prototype.ctor.call(this),this._jsonDict={},this._filePath="",this._name="CCComAttribute",ccs.ComAttribute.prototype.init.call(this)},init:function(){return this._jsonDict={},!0},setInt:function(key,value){key?this._jsonDict[key]=value:cc.log("Argument must be non-nil")},setDouble:function(key,value){key?this._jsonDict[key]=value:cc.log("Argument must be non-nil")},setFloat:function(key,value){key?this._jsonDict[key]=value:cc.log("Argument must be non-nil")},setBool:function(key,value){key?this._jsonDict[key]=value:cc.log("Argument must be non-nil")},setString:function(key,value){key?this._jsonDict[key]=value:cc.log("Argument must be non-nil")},setObject:function(key,value){key?this._jsonDict[key]=value:cc.log("Argument must be non-nil")},getInt:function(key){var ret=this._jsonDict[key];return parseInt(ret||0)},getDouble:function(key){var ret=this._jsonDict[key];return parseFloat(ret||0)},getFloat:function(key){var ret=this._jsonDict[key];return parseFloat(ret||0)},getBool:function(key){var ret=this._jsonDict[key];return Boolean(ret||!1)},getString:function(key){return this._jsonDict[key]||""},getObject:function(key){return this._jsonDict[key]},parse:function(filename){this._jsonDict=cc.loader.getRes(filename)}}),ccs.ComAttribute.create=function(){return new ccs.ComAttribute},ccs.ComAudio=ccs.Component.extend({_filePath:"",_loop:!1,ctor:function(){cc.Component.prototype.ctor.call(this),this._name="Audio",ccs.ComAudio.prototype.init.call(this)},init:function(){return!0},onExit:function(){this.stopBackgroundMusic(!0),this.stopAllEffects()},end:function(){cc.audioEngine.end()},preloadBackgroundMusic:function(pszFilePath){cc.loader.load(pszFilePath)},playBackgroundMusic:function(pszFilePath,loop){pszFilePath?cc.audioEngine.playMusic(pszFilePath,loop):cc.audioEngine.playMusic(this._filePath,this._loop)},stopBackgroundMusic:function(releaseData){cc.audioEngine.stopMusic(releaseData)},pauseBackgroundMusic:function(){cc.audioEngine.pauseMusic()},resumeBackgroundMusic:function(){cc.audioEngine.resumeMusic()},rewindBackgroundMusic:function(){cc.audioEngine.rewindMusic()},willPlayBackgroundMusic:function(){return cc.audioEngine.willPlayMusic()},isBackgroundMusicPlaying:function(){return cc.audioEngine.isMusicPlaying()},getBackgroundMusicVolume:function(){return cc.audioEngine.getMusicVolume()},setBackgroundMusicVolume:function(volume){cc.audioEngine.setMusicVolume(volume)},getEffectsVolume:function(){return cc.audioEngine.getEffectsVolume()},setEffectsVolume:function(volume){cc.audioEngine.setEffectsVolume(volume)},playEffect:function(pszFilePath,loop){return pszFilePath?cc.audioEngine.playEffect(pszFilePath,loop):cc.audioEngine.playEffect(this._filePath,this._loop)},pauseEffect:function(soundId){cc.audioEngine.pauseEffect(soundId)},pauseAllEffects:function(){cc.audioEngine.pauseAllEffects()},resumeEffect:function(soundId){cc.audioEngine.resumeEffect(soundId)},resumeAllEffects:function(){cc.audioEngine.resumeAllEffects()},stopEffect:function(soundId){cc.audioEngine.stopEffect(soundId)},stopAllEffects:function(){cc.audioEngine.stopAllEffects()},preloadEffect:function(pszFilePath){cc.loader.getRes(pszFilePath),this.setFile(pszFilePath),this.setLoop(!1)},unloadEffect:function(pszFilePath){cc.audioEngine.unloadEffect(pszFilePath)},setFile:function(pszFilePath){this._filePath=pszFilePath},setLoop:function(loop){this._loop=loop},getFile:function(){return this._filePath},isLoop:function(){return this._loop}}),ccs.ComAudio.create=function(){return new ccs.ComAudio},ccs.ComController=ccs.Component.extend({ctor:function(){cc.Component.prototype.ctor.call(this),this._name="ComController",ccs.ComController.prototype.init.call(this)},onEnter:function(){null!==this._owner&&this._owner.scheduleUpdate()},isEnabled:function(){return this._enabled},setEnabled:function(bool){this._enabled=bool}}),ccs.ComController.create=function(){return new ccs.ComController},ccs.ComRender=ccs.Component.extend({_render:null,ctor:function(node,comName){cc.Component.prototype.ctor.call(this),this._render=node,this._name=comName,this.isRenderer=!0,ccs.ComRender.prototype.init.call(this)},onEnter:function(){this._owner&&this._owner.addChild(this._render)},onExit:function(){this._owner&&(this._owner.removeChild(this._render,!0),this._render=null)},getNode:function(){return this._render},setNode:function(node){this._render=node}}),ccs.ComRender.create=function(node,comName){return new ccs.ComRender(node,comName)},ccs.objectFactory={_typeMap:{},createObject:function(className){var o=null,t=this._typeMap[className];return t&&(o=cc.isFunction(t._fun)?new t._fun:t._fun),o},registerType:function(t){this._typeMap[t._className]=t},createGUI:function(name){var object=null;"Panel"===name?name="Layout":"TextArea"===name?name="Label":"TextButton"===name&&(name="Button");var t=this._typeMap[name];return t&&t._fun&&(object=t._fun),object},removeAll:function(){this._typeMap={}}},ccs.TInfo=ccs.Class.extend({_className:"",_fun:null,ctor:function(c,f){f?(this._className=c,this._fun=f):(this._className=c._className,this._fun=c._fun),ccs.objectFactory.registerType(this)}}),ccs.sendEvent=function(event){var triggerObjArr=ccs.triggerManager.get(event);if(null!=triggerObjArr)for(var i=0;i<triggerObjArr.length;i++){var triObj=triggerObjArr[i];null!=triObj&&triObj.detect()&&triObj.done()}},ccs.registerTriggerClass=function(className,func){new ccs.TInfo(className,func)},ccs.triggerManager={_eventTriggers:{},_triggerObjs:{},_movementDispatches:[],parse:function(triggers){for(var i=0;i<triggers.length;++i){var subDict=triggers[i],triggerObj=new ccs.TriggerObj;triggerObj.serialize(subDict);for(var events=triggerObj.getEvents(),j=0;j<events.length;j++){var event=events[j];this.add(event,triggerObj)}this._triggerObjs[triggerObj.getId()]=triggerObj}},get:function(event){return this._eventTriggers[event]},getTriggerObj:function(id){return this._triggerObjs[id]},add:function(event,triggerObj){var eventTriggers=this._eventTriggers[event];eventTriggers||(eventTriggers=[]),-1===eventTriggers.indexOf(triggerObj)&&(eventTriggers.push(triggerObj),this._eventTriggers[event]=eventTriggers)},removeAll:function(){for(var key in this._eventTriggers)for(var triObjArr=this._eventTriggers[key],j=0;j<triObjArr.length;j++)triObjArr[j].removeAll();this._eventTriggers={}},remove:function(event,Obj){if(Obj)return this._removeObj(event,Obj);var bRet=!1;do{var triObjects=this._eventTriggers[event];if(!triObjects)break;for(var i=0;i<triObjects.length;i++){var triObject=triObjects[i];triObject&&triObject.removeAll()}delete this._eventTriggers[event],bRet=!0}while(0);return bRet},_removeObj:function(event,Obj){var bRet=!1;do{var triObjects=this._eventTriggers[event];if(!triObjects)break;for(var i=0;i<triObjects.length;i++){var triObject=triObjects[i];if(triObject&&triObject==Obj){triObject.removeAll(),triObjects.splice(i,1);break}}bRet=!0}while(0);return bRet},removeTriggerObj:function(id){var obj=this.getTriggerObj(id);if(!obj)return!1;for(var events=obj.getEvents(),i=0;i<events.length;i++){var event=events[i];this.remove(event,obj)}return!0},isEmpty:function(){return!this._eventTriggers||this._eventTriggers.length<=0},addArmatureMovementCallBack:function(armature,callFunc,target){if(null!=armature&&null!=target&&null!=callFunc){for(var locAmd,hasADD=!1,i=0;i<this._movementDispatches.length;i++)(locAmd=this._movementDispatches[i])&&locAmd[0]===armature&&(locAmd.addAnimationEventCallBack(callFunc,target),hasADD=!0);if(!hasADD){var newAmd=new ccs.ArmatureMovementDispatcher;armature.getAnimation().setMovementEventCallFunc(newAmd.animationEvent,newAmd),newAmd.addAnimationEventCallBack(callFunc,target),this._movementDispatches.push([armature,newAmd])}}},removeArmatureMovementCallBack:function(armature,target,callFunc){if(null!=armature&&null!=target&&null!=callFunc)for(var locAmd,i=0;i<this._movementDispatches.length;i++)(locAmd=this._movementDispatches[i])&&locAmd[0]===armature&&locAmd.removeAnimationEventCallBack(callFunc,target)},removeArmatureAllMovementCallBack:function(armature){if(null!=armature)for(var locAmd,i=0;i<this._movementDispatches.length;i++)if((locAmd=this._movementDispatches[i])&&locAmd[0]===armature){this._movementDispatches.splice(i,1);break}},removeAllArmatureMovementCallBack:function(){this._movementDispatches.length=0},version:function(){return"1.2.0.0"}},ccs.ArmatureMovementDispatcher=ccs.Class.extend({_mapEventAnimation:null,ctor:function(){this._mapEventAnimation=[]},animationEvent:function(armature,movementType,movementID){for(var locEventAni,locTarget,locFunc,i=0;i<this._mapEventAnimation.length;i++)locTarget=(locEventAni=this._mapEventAnimation[i])[0],(locFunc=locEventAni[1])&&locFunc.call(locTarget,armature,movementType,movementID)},addAnimationEventCallBack:function(callFunc,target){this._mapEventAnimation.push([target,callFunc])},removeAnimationEventCallBack:function(callFunc,target){for(var i=0;i<this._mapEventAnimation.length;i++)this._mapEventAnimation[i][0]===target&&this._mapEventAnimation.splice(i,1)}}),ccs.BaseTriggerCondition=ccs.Class.extend({ctor:function(){},init:function(){return!0},detect:function(){return!0},serialize:function(jsonVal){},removeAll:function(){}}),ccs.BaseTriggerAction=ccs.Class.extend({ctor:function(){},init:function(){return!0},done:function(){},serialize:function(jsonVal){},removeAll:function(){}}),ccs.TriggerObj=ccs.Class.extend({_cons:null,_acts:null,_id:0,_enable:!0,_vInt:null,ctor:function(){this._id=0,this._enable=!0,ccs.TriggerObj.prototype.init.call(this)},init:function(){return this._cons=[],this._acts=[],this._vInt=[],!0},detect:function(){if(!this._enable||0===this._cons.length)return!0;for(var ret=!0,obj=null,i=0;i<this._cons.length;i++)(obj=this._cons[i])&&obj.detect&&(ret=ret&&obj.detect());return ret},done:function(){if(this._enable&&0!==this._acts.length)for(var obj,i=0;i<this._acts.length;i++)(obj=this._acts[i])&&obj.done&&obj.done()},removeAll:function(){for(var obj=null,i=0;i<this._cons.length;i++)(obj=this._cons[i])&&obj.removeAll();this._cons=[];for(i=0;i<this._acts.length;i++)(obj=this._acts[i])&&obj.removeAll();this._acts=[]},serialize:function(jsonVal){this._id=jsonVal.id||0;for(var conditions=jsonVal.conditions||[],i=0;i<conditions.length;i++){var classname=(subDict=conditions[i]).classname,con=ccs.objectFactory.createObject(classname);con?(con.serialize(subDict),con.init(),this._cons.push(con)):cc.log("class named classname("+classname+") can not implement!")}for(var actions=jsonVal.actions||[],i=0;i<actions.length;i++){var classname=(subDict=actions[i]).classname,act=ccs.objectFactory.createObject(classname);act?(act.serialize(subDict),act.init(),this._acts.push(act)):cc.log("class named classname("+classname+") can not implement!")}for(var events=jsonVal.events||[],i=0;i<events.length;i++){var subDict=events[i],event=subDict.id;event<0||this._vInt.push(event)}},getId:function(){return this._id},setEnable:function(enable){this._enable=enable},getEvents:function(){return this._vInt}}),ccs.TriggerObj.create=function(){return new ccs.TriggerObj},ccs.ActionTimelineData=ccs.Class.extend({_actionTag:0,ctor:function(actionTag){this._init(actionTag)},_init:function(actionTag){return this._actionTag=actionTag,!0},setActionTag:function(actionTag){this._actionTag=actionTag},getActionTag:function(){return this._actionTag}}),ccs.AnimationInfo=function(name,start,end){this.name=name,this.startIndex=start,this.endIndex=end},ccs.ComExtensionData=ccs.Component.extend({_customProperty:null,_timelineData:null,_name:"ComExtensionData",ctor:function(){return this._customProperty="",this._timelineData=new ccs.ActionTimelineData(0),!0},setActionTag:function(actionTag){this._timelineData.setActionTag(actionTag)},getActionTag:function(){return this._timelineData.getActionTag()},setCustomProperty:function(customProperty){this._customProperty=customProperty},getCustomProperty:function(){return this._customProperty}}),ccs.ComExtensionData.create=function(){return new ccs.ComExtensionData},ccs.ActionTimelineData.create=function(actionTag){return new ccs.ActionTimelineData(actionTag)},ccs.ActionTimeline=cc.Action.extend({_timelineMap:null,_timelineList:null,_duration:0,_time:null,_timeSpeed:1,_frameInternal:1/60,_playing:!1,_currentFrame:0,_startFrame:0,_endFrame:0,_loop:null,_frameEventListener:null,_animationInfos:null,_lastFrameListener:null,ctor:function(){cc.Action.prototype.ctor.call(this),this._timelineMap={},this._timelineList=[],this._animationInfos={},this.init()},_gotoFrame:function(frameIndex){for(var size=this._timelineList.length,i=0;i<size;i++)this._timelineList[i]._gotoFrame(frameIndex)},_stepToFrame:function(frameIndex){for(var size=this._timelineList.length,i=0;i<size;i++)this._timelineList[i]._stepToFrame(frameIndex)},_emitFrameEvent:function(frame){this._frameEventListener&&this._frameEventListener(frame)},init:function(){return!0},gotoFrameAndPlay:function(startIndex,endIndex,currentFrameIndex,loop){var bool,i=0,argLen=arguments.length,num=[];for(i;i<argLen;i++)"boolean"==typeof arguments[i]?bool=arguments[i]:num.push(arguments[i]);startIndex=num[0],endIndex=void 0!==num[1]?num[1]:this._duration,currentFrameIndex=num[2]||startIndex,loop=null==bool||bool,this._startFrame=startIndex,this._endFrame=endIndex,this._currentFrame=currentFrameIndex,this._loop=loop,this._time=this._currentFrame*this._frameInternal,this.resume(),this._gotoFrame(this._currentFrame)},gotoFrameAndPause:function(startIndex){this._startFrame=this._currentFrame=startIndex,this._time=this._currentFrame*this._frameInternal,this.pause(),this._gotoFrame(this._currentFrame)},pause:function(){this._playing=!1},resume:function(){this._playing=!0},isPlaying:function(){return this._playing},setTimeSpeed:function(speed){this._timeSpeed=speed},getTimeSpeed:function(){return this._timeSpeed},setDuration:function(duration){this._duration=duration},getDuration:function(){return this._duration},getStartFrame:function(){return this._startFrame},getEndFrame:function(){return this._endFrame},setCurrentFrame:function(frameIndex){frameIndex>=this._startFrame&&frameIndex<=this._endFrame?(this._currentFrame=frameIndex,this._time=this._currentFrame*this._frameInternal):cc.log("frame index is not between start frame and end frame")},getCurrentFrame:function(){return this._currentFrame},addTimeline:function(timeline){var tag=timeline.getActionTag();this._timelineMap[tag]||(this._timelineMap[tag]=[]),-1===this._timelineMap[tag].indexOf(timeline)&&(this._timelineList.push(timeline),this._timelineMap[tag].push(timeline),timeline.setActionTimeline(this))},removeTimeline:function(timeline){var tag=timeline.getActionTag();this._timelineMap[tag]&&this._timelineMap[tag].some(function(item){if(item===timeline)return!0})&&(cc.arrayRemoveObject(this._timelineMap[tag],timeline),cc.arrayRemoveObject(this._timelineList,timeline),timeline.setActionTimeline(null))},getTimelines:function(){return this._timelineList},setFrameEventCallFunc:function(listener){this._frameEventListener=listener},clearFrameEventCallFunc:function(){this._frameEventListener=null},clone:function(){var newAction=new ccs.ActionTimeline;newAction.setDuration(this._duration),newAction.setTimeSpeed(this._timeSpeed);for(var a in this._timelineMap){var timelines=this._timelineMap[a];for(var b in timelines){var newTimeline=timelines[b].clone();newAction.addTimeline(newTimeline)}}return newAction},reverse:function(){return null},step:function(delta){if(this._playing&&0!==this._timelineMap.length&&0!==this._duration){this._time+=delta*this._timeSpeed;var endoffset=this._time-this._endFrame*this._frameInternal;endoffset<this._frameInternal?(this._currentFrame=Math.floor(this._time/this._frameInternal),this._stepToFrame(this._currentFrame),endoffset>=0&&this._lastFrameListener&&this._lastFrameListener()):(this._playing=this._loop,this._playing?this.gotoFrameAndPlay(this._startFrame,this._endFrame,this._loop):(this._time=this._endFrame*this._frameInternal,this._currentFrame!=this._endFrame&&(this._currentFrame=this._endFrame,this._stepToFrame(this._currentFrame),this._lastFrameListener&&this._lastFrameListener())))}},_foreachNodeDescendant:function(parent,callback){callback(parent);for(var children=parent.getChildren(),i=0;i<children.length;i++){var child=children[i];this._foreachNodeDescendant(child,callback)}},startWithTarget:function(target){cc.Action.prototype.startWithTarget.call(this,target);var self=this;this._foreachNodeDescendant(target,function(child){var data=child.getComponent("ComExtensionData");if(data){var actionTag=data.getActionTag();if(self._timelineMap[actionTag])for(var timelines=self._timelineMap[actionTag],i=0;i<timelines.length;i++)timelines[i].setNode(child)}})},isDone:function(){return!1},play:function(name,loop){var info=this._animationInfos[name];if(!info)return cc.log("Can't find animation info for %s",name);this.gotoFrameAndPlay(info.startIndex,info.endIndex,loop)},addAnimationInfo:function(info){this._animationInfos[info.name]=info},removeAnimationInfo:function(name){delete this._animationInfos[name]},isAnimationInfoExists:function(name){return this._animationInfos[name]},getAnimationInfo:function(name){return this._animationInfos[name]},setLastFrameCallFunc:function(listener){this._lastFrameListener=listener},clearLastFrameCallFunc:function(){this._lastFrameListener=null}}),ccs.ActionTimeline.create=function(){return new ccs.ActionTimeline},ccs.Frame=ccs.Class.extend({_frameIndex:null,_tween:null,_timeline:null,_node:null,_tweenType:null,_easingParam:null,_enterWhenPassed:null,ctor:function(){this._frameIndex=0,this._tween=!0,this._timeline=null,this._node=null,this._enterWhenPassed=!1,this._easingParam=[]},_emitEvent:function(){this._timeline&&this._timeline.getActionTimeline()._emitFrameEvent(this)},_cloneProperty:function(frame){this._frameIndex=frame.getFrameIndex(),this._tween=frame.isTween(),this._tweenType=frame.getTweenType(),this.setEasingParams(frame.getEasingParams())},setFrameIndex:function(frameIndex){this._frameIndex=frameIndex},getFrameIndex:function(){return this._frameIndex},setTimeline:function(timeline){this._timeline=timeline},getTimeline:function(timeline){return this._timeline},setNode:function(node){this._node=node},getNode:function(){return this._node},setTween:function(tween){this._tween=tween},isTween:function(){return this._tween},onEnter:function(nextFrame){},apply:function(percent){this._tween&&(this._tweenType!==ccs.FrameEaseType.TWEEN_EASING_MAX&&this._tweenType!==ccs.FrameEaseType.LINEAR&&(percent=this.tweenPercent(percent)),this._onApply(percent))},_onApply:function(percent){},clone:function(){},tweenPercent:function(percent){var func=ccs.Frame.tweenToMap[this._tweenType];return func?func(percent,this._easingParam):percent},setEasingParams:function(easingParams){if(easingParams){this._easingParam.length=0;for(var i=0;i<easingParams.length;i++)this._easingParam[i]=easingParams[i]}},getEasingParams:function(){return this._easingParam},setTweenType:function(tweenType){this._tweenType=tweenType},getTweenType:function(){return this._tweenType},isEnterWhenPassed:function(){return this._enterWhenPassed}}),ccs.Frame.tweenToMap={"-1":function(time,easingParam){if(easingParam){var tt=1-time;return easingParam[1]*tt*tt*tt+3*easingParam[3]*time*tt*tt+3*easingParam[5]*time*time*tt+easingParam[7]*time*time*time}return time},1:cc._easeSineInObj.easing,2:cc._easeSineOutObj.easing,3:cc._easeSineInOutObj.easing,4:cc._easeQuadraticActionIn.easing,5:cc._easeQuadraticActionOut.easing,6:cc._easeQuadraticActionInOut.easing,7:cc._easeCubicActionIn.easing,8:cc._easeCubicActionOut.easing,9:cc._easeCubicActionInOut.easing,10:cc._easeCubicActionIn.easing,11:cc._easeCubicActionOut.easing,12:cc._easeCubicActionInOut.easing,13:cc._easeQuinticActionIn.easing,14:cc._easeQuinticActionOut.easing,15:cc._easeQuinticActionInOut.easing,16:cc._easeExponentialInObj.easing,17:cc._easeExponentialOutObj.easing,18:cc._easeExponentialInOutObj.easing,19:cc._easeCircleActionIn.easing,20:cc._easeCircleActionOut.easing,21:cc._easeCircleActionInOut.easing,22:function(time,easingParam){var period=.3;return null!=easingParam&&(period=easingParam[0]),cc.easeElasticIn(period).easing(time)},23:function(time,easingParam){var period=.3;return null!=easingParam&&(period=easingParam[0]),cc.easeElasticOut(period).easing(time)},24:function(time,easingParam){var period=.3;return null!=easingParam&&(period=easingParam[0]),cc.easeElasticInOut(period).easing(time)},25:cc._easeBackInObj.easing,26:cc._easeBackOutObj.easing,27:cc._easeBackInOutObj.easing,28:cc._easeBounceInObj.easing,29:cc._easeBounceOutObj.easing,30:cc._easeBounceInOutObj.easing},ccs.VisibleFrame=ccs.Frame.extend({_visible:!0,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._visible=!0},onEnter:function(nextFrame){this._node&&this._node.setVisible(this._visible)},clone:function(){var frame=new ccs.VisibleFrame;return frame.setVisible(this._visible),frame._cloneProperty(this),frame},setVisible:function(visible){this._visible=visible},isVisible:function(){return this._visible}}),ccs.VisibleFrame.create=function(){return new ccs.VisibleFrame},ccs.TextureFrame=ccs.Frame.extend({_sprite:null,_textureName:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._textureName=""},setNode:function(node){ccs.Frame.prototype.setNode.call(this,node),this._sprite=node},onEnter:function(nextFrame){if(this._sprite){var spriteBlendFunc=this._sprite.getBlendFunc(),spriteFrame=cc.spriteFrameCache._spriteFrames[this._textureName];null!=spriteFrame?this._sprite.setSpriteFrame(spriteFrame):this._sprite.setTexture(this._textureName),this._sprite.getBlendFunc()!==spriteBlendFunc&&this._sprite.setBlendFunc(spriteBlendFunc)}},clone:function(){var frame=new ccs.TextureFrame;return frame.setTextureName(this._textureName),frame._cloneProperty(this),frame},setTextureName:function(textureName){this._textureName=textureName},getTextureName:function(){return this._textureName}}),ccs.TextureFrame.create=function(){return new ccs.TextureFrame},ccs.RotationFrame=ccs.Frame.extend({_rotation:null,_betwennRotation:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._rotation=0},onEnter:function(nextFrame){this._node&&(this._node.setRotation(this._rotation),this._tween&&(this._betwennRotation=nextFrame._rotation-this._rotation))},_onApply:function(percent){if(0!==this._betwennRotation){var rotation=this._rotation+percent*this._betwennRotation;this._node.setRotation(rotation)}},clone:function(){var frame=new ccs.RotationFrame;return frame.setRotation(this._rotation),frame._cloneProperty(this),frame},setRotation:function(rotation){this._rotation=rotation},getRotation:function(){return this._rotation}}),ccs.RotationFrame.create=function(){return new ccs.RotationFrame},ccs.SkewFrame=ccs.Frame.extend({_skewX:null,_skewY:null,_betweenSkewX:null,_betweenSkewY:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._skewX=0,this._skewY=0},onEnter:function(nextFrame){this._node&&(this._node.setSkewX(this._skewX),this._node.setSkewY(this._skewY),this._tween&&(this._betweenSkewX=nextFrame._skewX-this._skewX,this._betweenSkewY=nextFrame._skewY-this._skewY))},_onApply:function(percent){if(0!==this._betweenSkewX||0!==this._betweenSkewY){var skewx=this._skewX+percent*this._betweenSkewX,skewy=this._skewY+percent*this._betweenSkewY;this._node.setSkewX(skewx),this._node.setSkewY(skewy)}},clone:function(){var frame=new ccs.SkewFrame;return frame.setSkewX(this._skewX),frame.setSkewY(this._skewY),frame._cloneProperty(this),frame},setSkewX:function(skewx){this._skewX=skewx},getSkewX:function(){return this._skewX},setSkewY:function(skewy){this._skewY=skewy},getSkewY:function(){return this._skewY}}),ccs.SkewFrame.create=function(){return new ccs.SkewFrame},ccs.RotationSkewFrame=ccs.SkewFrame.extend({onEnter:function(nextFrame){this._node&&(this._node.setRotationX(this._skewX),this._node.setRotationY(this._skewY),this._tween&&(this._betweenSkewX=nextFrame._skewX-this._skewX,this._betweenSkewY=nextFrame._skewY-this._skewY))},_onApply:function(percent){if(this._node&&(0!==this._betweenSkewX||0!==this._betweenSkewY)){var skewx=this._skewX+percent*this._betweenSkewX,skewy=this._skewY+percent*this._betweenSkewY;this._node.setRotationX(skewx),this._node.setRotationY(skewy)}},clone:function(){var frame=new ccs.RotationSkewFrame;return frame.setSkewX(this._skewX),frame.setSkewY(this._skewY),frame._cloneProperty(this),frame}}),ccs.RotationSkewFrame.create=function(){return new ccs.RotationSkewFrame},ccs.PositionFrame=ccs.Frame.extend({_position:null,_betweenX:null,_betweenY:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._position=cc.p(0,0)},onEnter:function(nextFrame){this._node&&(this._node.setPosition(this._position),this._tween&&(this._betweenX=nextFrame._position.x-this._position.x,this._betweenY=nextFrame._position.y-this._position.y))},_onApply:function(percent){if(this._node&&(0!==this._betweenX||0!==this._betweenY)){var p=cc.p(0,0);p.x=this._position.x+this._betweenX*percent,p.y=this._position.y+this._betweenY*percent,this._node.setPosition(p)}},clone:function(){var frame=new ccs.PositionFrame;return frame.setPosition(this._position),frame._cloneProperty(this),frame},setPosition:function(position){this._position=position},getPosition:function(){return this._position},setX:function(x){this._position.x=x},getX:function(){return this._position.x},setY:function(y){this._position.y=y},getY:function(){return this._position.y}}),ccs.PositionFrame.create=function(){return new ccs.PositionFrame},ccs.ScaleFrame=ccs.Frame.extend({_scaleX:null,_scaleY:null,_betweenScaleX:null,_betweenScaleY:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._scaleX=1,this._scaleY=1},onEnter:function(nextFrame){this._node&&(this._node.setScaleX(this._scaleX),this._node.setScaleY(this._scaleY),this._tween&&(this._betweenScaleX=nextFrame._scaleX-this._scaleX,this._betweenScaleY=nextFrame._scaleY-this._scaleY))},_onApply:function(percent){if(this._node&&(0!==this._betweenScaleX||0!==this._betweenScaleY)){var scaleX=this._scaleX+this._betweenScaleX*percent,scaleY=this._scaleY+this._betweenScaleY*percent;this._node.setScaleX(scaleX),this._node.setScaleY(scaleY)}},clone:function(){var frame=new ccs.ScaleFrame;return frame.setScaleX(this._scaleX),frame.setScaleY(this._scaleY),frame._cloneProperty(this),frame},setScale:function(scale){this._scaleX=scale,this._scaleY=scale},setScaleX:function(scaleX){this._scaleX=scaleX},getScaleX:function(){return this._scaleX},setScaleY:function(scaleY){this._scaleY=scaleY},getScaleY:function(){return this._scaleY}}),ccs.ScaleFrame.create=function(){return new ccs.ScaleFrame},ccs.AnchorPointFrame=ccs.Frame.extend({_anchorPoint:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._anchorPoint=cc.p(0,0)},onEnter:function(nextFrame){this._node&&this._node.setAnchorPoint(this._anchorPoint)},clone:function(){var frame=new ccs.AnchorPointFrame;return frame.setAnchorPoint(this._anchorPoint),frame._cloneProperty(this),frame},setAnchorPoint:function(point){this._anchorPoint=point},getAnchorPoint:function(){return this._anchorPoint}}),ccs.AnchorPointFrame.create=function(){return new ccs.AnchorPointFrame},ccs.InnerActionType={LoopAction:0,NoLoopAction:1,SingleFrame:2},ccs.InnerActionFrame=ccs.Frame.extend({_innerActionType:null,_startFrameIndex:null,_endFrameIndex:0,_singleFrameIndex:0,_enterWithName:null,_animationName:"",ctor:function(){ccs.Frame.prototype.ctor.call(this),this._enterWithName=!1,this._innerActionType=ccs.InnerActionType.LoopAction,this._startFrameIndex=0},onEnter:function(nextFrame){if(this._node){var innerActiontimeline=this._node.getActionByTag(this._node.getTag());if(innerActiontimeline)if(ccs.InnerActionType.SingleFrame!==this._innerActionType){var innerStart=this._startFrameIndex,innerEnd=this._endFrameIndex;if(this._enterWithName)if("-- ALL --"===this._animationName)innerStart=0,innerEnd=innerActiontimeline.getDuration();else if(innerActiontimeline.isAnimationInfoExists(this._animationName)){var info=innerActiontimeline.getAnimationInfo(this._animationName);innerStart=info.startIndex,innerEnd=info.endIndex}else cc.log("Animation %s not exists!",this._animationName);var odddiff=this._timeline.getActionTimeline().getDuration()-this._frameIndex-innerEnd+innerStart;odddiff<0&&(innerEnd+=odddiff),ccs.InnerActionType.NoLoopAction===this._innerActionType?innerActiontimeline.gotoFrameAndPlay(innerStart,innerEnd,!1):ccs.InnerActionType.LoopAction===this._innerActionType&&innerActiontimeline.gotoFrameAndPlay(innerStart,innerEnd,!0)}else innerActiontimeline.gotoFrameAndPause(this._singleFrameIndex)}},setAnimationName:function(animationName){this._animationName=animationName},setSingleFrameIndex:function(frameIndex){this._singleFrameIndex=frameIndex},getSingleFrameIndex:function(){return this._startFrameIndex},setEnterWithName:function(isEnterWithName){this._enterWithName=isEnterWithName},getEnterWithName:function(){return this._enterWithName},clone:function(){var frame=new ccs.InnerActionFrame;return frame.setInnerActionType(this._innerActionType),frame.setStartFrameIndex(this._startFrameIndex),frame.setEnterWithName(this._enterWithName),frame.setAnimationName(this._animationName),frame.setSingleFrameIndex(this._singleFrameIndex),frame._cloneProperty(this),frame},setInnerActionType:function(type){this._innerActionType=type},getInnerActionType:function(){return this._innerActionType},setStartFrameIndex:function(frameIndex){this._startFrameIndex=frameIndex},getStartFrameIndex:function(){return this._startFrameIndex}}),ccs.InnerActionFrame.create=function(){return new ccs.InnerActionFrame},ccs.ColorFrame=ccs.Frame.extend({_alpha:null,_color:null,_betweenAlpha:null,_betweenRed:null,_betweenGreen:null,_betweenBlue:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._color=cc.color(255,255,255)},onEnter:function(nextFrame){if(this._node&&(this._node.setColor(this._color),this._tween)){var color=nextFrame._color;this._betweenRed=color.r-this._color.r,this._betweenGreen=color.g-this._color.g,this._betweenBlue=color.b-this._color.b}},_onApply:function(percent){if(this._node&&this._tween&&(0!==this._betweenAlpha||0!==this._betweenRed||0!==this._betweenGreen||0!==this._betweenBlue)){var color=cc.color(255,255,255);if(color.r=this._color.r+this._betweenRed*percent,color.g=this._color.g+this._betweenGreen*percent,color.b=this._color.b+this._betweenBlue*percent,this._node.setColor(color),null!==this._alpha){var alpha=this._alpha+this._betweenAlpha*percent;this._node.setOpacity(alpha)}}},clone:function(){var frame=new ccs.ColorFrame;return frame.setColor(this._color),frame._cloneProperty(this),frame},setColor:function(color){this._color=color},getColor:function(){return this._color}}),ccs.ColorFrame.create=function(){return new ccs.ColorFrame},ccs.AlphaFrame=ccs.Frame.extend({_alpha:null,_betweenAlpha:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._alpha=255},onEnter:function(nextFrame){this._node&&(this._node.setOpacity(this._alpha),this._tween&&(this._betweenAlpha=nextFrame._alpha-this._alpha))},_onApply:function(percent){if(this._node){var alpha=this._alpha+this._betweenAlpha*percent;this._node.setOpacity(alpha)}},setAlpha:function(alpha){this._alpha=alpha},getAlpha:function(){return this._alpha},clone:function(){var frame=new ccs.AlphaFrame;return frame.setAlpha(this._alpha),frame._cloneProperty(this),frame}}),ccs.EventFrame=ccs.Frame.extend({_event:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._event="",this._enterWhenPassed=!0},onEnter:function(nextFrame){this._emitEvent()},clone:function(){var frame=new ccs.EventFrame;return frame.setEvent(this._event),frame._cloneProperty(this),frame},setEvent:function(event){this._event=event},getEvent:function(){return this._event}}),ccs.EventFrame.create=function(){return new ccs.EventFrame},ccs.ZOrderFrame=ccs.Frame.extend({_zorder:0,onEnter:function(nextFrame){this._node&&this._node.setLocalZOrder(this._zorder)},clone:function(){var frame=new ccs.ZOrderFrame;return frame.setZOrder(this._zorder),frame._cloneProperty(this),frame},setZOrder:function(zorder){this._zorder=zorder},getZOrder:function(){return this._zorder}}),ccs.ZOrderFrame.create=function(){return new ccs.ZOrderFrame},ccs.BlendFuncFrame=ccs.Frame.extend({ctor:function(){this._super(),this._blendFunc=null},onEnter:function(nextFrame,currentFrameIndex){this._node&&this._blendFunc&&this._node.setBlendFunc(this._blendFunc)},clone:function(){var frame=new ccs.BlendFuncFrame;return frame.setBlendFunc(this._blendFunc),frame._cloneProperty(this),frame},setBlendFunc:function(blendFunc){blendFunc&&blendFunc.src&&blendFunc.dst&&(this._blendFunc=blendFunc)},getBlendFunc:function(){return this._blendFunc}}),ccs.BlendFuncFrame.create=function(){return new ccs.BlendFuncFrame},ccs.Timeline=ccs.Class.extend({_frames:null,_currentKeyFrame:null,_currentKeyFrameIndex:null,_fromIndex:null,_toIndex:null,_betweenDuration:null,_actionTag:null,_ActionTimeline:null,_node:null,ctor:function(){this._frames=[],this._currentKeyFrame=null,this._currentKeyFrameIndex=0,this._fromIndex=0,this._toIndex=0,this._betweenDuration=0,this._actionTag=0,this._ActionTimeline=null,this._node=null},_gotoFrame:function(frameIndex){0!==this._frames.length&&(this._binarySearchKeyFrame(frameIndex),this._apply(frameIndex))},_stepToFrame:function(frameIndex){0!==this._frames.length&&(this._updateCurrentKeyFrame(frameIndex),this._apply(frameIndex))},getFrames:function(){return this._frames},addFrame:function(frame){this._frames.push(frame),frame.setTimeline(this)},insertFrame:function(frame,index){this._frames.splice(index,0,frame),frame.setTimeline(this)},removeFrame:function(frame){cc.arrayRemoveObject(this._frames,frame),frame.setTimeline(null)},setActionTag:function(tag){this._actionTag=tag},getActionTag:function(){return this._actionTag},setNode:function(node){for(var i=0;i<this._frames.length;i++)this._frames[i].setNode(node)},getNode:function(){return this._node},setActionTimeline:function(action){this._ActionTimeline=action},getActionTimeline:function(){return this._ActionTimeline},clone:function(){var timeline=new ccs.Timeline;timeline._actionTag=this._actionTag;for(var i=0;i<this._frames.length;i++){var newFrame=this._frames[i].clone();timeline.addFrame(newFrame)}return timeline},_apply:function(frameIndex){if(this._currentKeyFrame){var currentPercent=this._betweenDuration<=0?0:(frameIndex-this._currentKeyFrameIndex)/this._betweenDuration;this._currentKeyFrame.apply(currentPercent)}},_binarySearchKeyFrame:function(frameIndex){var from=null,to=null,length=this._frames.length,needEnterFrame=!1;do{if(frameIndex<this._frames[0].getFrameIndex()){this._currentKeyFrameIndex>=this._frames[0].getFrameIndex()&&(needEnterFrame=!0),this._fromIndex=0,this._toIndex=0,from=to=this._frames[0],this._currentKeyFrameIndex=0,this._betweenDuration=this._frames[0].getFrameIndex();break}if(frameIndex>=this._frames[length-1].getFrameIndex()){this._fromIndex=length-1,this._toIndex=0,from=to=this._frames[length-1],this._currentKeyFrameIndex=this._frames[length-1].getFrameIndex(),this._betweenDuration=0;break}for(var target=-1,low=0,high=length-1,mid=0;low<=high;){if(mid=Math.ceil((low+high)/2),frameIndex>=this._frames[mid].getFrameIndex()&&frameIndex<this._frames[mid+1].getFrameIndex()){target=mid;break}this._frames[mid].getFrameIndex()>frameIndex?high=mid-1:low=mid+1}this._fromIndex=target,this._toIndex=length>1?target+1|0:0|target,from=this._frames[this._fromIndex],to=this._frames[this._toIndex],from=this._frames[target],to=this._frames[target+1],0===target&&this._currentKeyFrameIndex<from.getFrameIndex()&&(needEnterFrame=!0),this._currentKeyFrameIndex=from.getFrameIndex(),this._betweenDuration=to.getFrameIndex()-from.getFrameIndex()}while(0);(needEnterFrame||this._currentKeyFrame!=from)&&(this._currentKeyFrame=from,this._currentKeyFrame.onEnter(to))},_updateCurrentKeyFrame:function(frameIndex){if(frameIndex>60);if(frameIndex<this._currentKeyFrameIndex||frameIndex>=this._currentKeyFrameIndex+this._betweenDuration){var from=null,to=null;do{var length=this._frames.length;if(frameIndex<this._frames[0].getFrameIndex()){from=to=this._frames[0],this._currentKeyFrameIndex=0,this._betweenDuration=this._frames[0].getFrameIndex();break}if(frameIndex>=this._frames[length-1].getFrameIndex()){var lastFrameIndex=this._frames[length-1].getFrameIndex();if(this._currentKeyFrameIndex>=lastFrameIndex)return;frameIndex=lastFrameIndex}for(;;){if(this._fromIndex=this._toIndex,from=this._frames[this._fromIndex],this._currentKeyFrameIndex=from.getFrameIndex(),this._toIndex=this._fromIndex+1,this._toIndex>=length&&(this._toIndex=0),to=this._frames[this._toIndex],frameIndex===from.getFrameIndex())break;if(frameIndex>from.getFrameIndex()&&frameIndex<to.getFrameIndex())break;from.isEnterWhenPassed()&&from.onEnter(to)}this._betweenDuration=to.getFrameIndex()-from.getFrameIndex()}while(0);this._currentKeyFrame=from,this._currentKeyFrame.onEnter(to)}}}),ccs.Timeline.create=function(){return new ccs.Timeline},ccs.SkinNode=function(){var proto={},SkinNode=cc.Node.extend(proto);return SkinNode.create=function(){},SkinNode}(),ccs.BoneNode=function(){var Node=cc.Node,SkinNode=ccs.SkinNode,BlendFunc=cc.BlendFunc,type={p:cc.p,size:cc.size,rect:cc.rect},debug={log:cc.log,assert:cc.assert},BoneNode=Node.extend({_customCommand:null,_blendFunc:null,_rackColor:null,_rackLength:null,_rackWidth:null,_childBones:null,_boneSkins:null,_rootSkeleton:null,_squareVertices:null,_squareColors:null,_noMVPVertices:null,ctor:function(length){Node.prototype.ctor.call(this),null===this._squareVertices&&(this._squareVertices=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]),this._rackColor=cc.color.WHITE,this._blendFunc=BlendFunc.ALPHA_NON_PREMULTIPLIED,this._childBones=[],this._boneSkins=[],this._rackLength=void 0===length?50:length,this._rackWidth=20,this._updateVertices()},visit:function(parent){this._visit&&this._visit(parent&&parent._renderCmd)},addSkin:function(skin,display,hideOthers){var boneSkins=this._boneSkins;if(debug.assert(null!=skin,"Argument must be non-nil"),hideOthers)for(var i=0;i<boneSkins.length;i++)boneSkins[i].setVisible(!1);Node.prototype.addChild.call(this,skin),this._boneSkins.push(skin),skin.setVisible(display)},getChildBones:function(){return this._childBones},getSkins:function(){return this._boneSkins},displaySkin:function(skin,hideOthers){var boneSkin,i,boneSkins=this._boneSkins;if("string"==typeof skin)for(i=0;i<boneSkins.length;i++)skin==(boneSkin=boneSkins[i]).getName()?boneSkin.setVisible(!0):hideOthers&&boneSkin.setVisible(!1);else for(i=0;i<boneSkins.length;i++)(boneSkin=boneSkins[i])==skin?boneSkin.setVisible(!0):hideOthers&&boneSkin.setVisible(!1)},getVisibleSkins:function(){for(var boneSkin,displayingSkins=[],boneSkins=this._boneSkins,i=0;i<boneSkins.length;i++)(boneSkin=boneSkins[i]).isVisible()&&displayingSkins.push(boneSkin);return displayingSkins},getRootSkeletonNode:function(){return this._rootSkeleton},getAllSubBones:function(){for(var allBones=[],boneStack=[],childBones=this._childBones,i=0;i<childBones.length;i++)boneStack.push(childBones[i]);for(;boneStack.length>0;){var top=boneStack.pop();allBones.push(top);for(var topChildren=top.getChildBones(),j=0;j<topChildren;j++)boneStack.push(topChildren[j])}return allBones},getAllSubSkins:function(){for(var allBones=this.getAllSubBones(),allSkins=[],i=0;i<allBones.length;i++)for(var skins=allBones[i].getSkins(),j=0;j<skins.length;j++)allSkins.push(skins[i]);return allSkins},addChild:function(child,localZOrder,tag){Node.prototype.addChild.call(this,child,localZOrder,tag),this._addToChildrenListHelper(child)},removeChild:function(child,cleanup){-1!==this._children.indexOf(child)&&(Node.prototype.removeChild.call(this,child,cleanup),this._removeFromChildrenListHelper(child))},setBlendFunc:function(blendFunc){var ob=this._blendFunc;if(blendFunc&&ob.src!==blendFunc.src&&ob.dst!==blendFunc.dst){this._blendFunc=blendFunc;for(var boneSkins=this._boneSkins,i=0;i<boneSkins.length;i++)boneSkins[i].setBlendFunc(blendFunc)}},getBlendFunc:function(){return this._blendFunc},setDebugDrawLength:function(length){this._rackLength=length,this._updateVertices()},getDebugDrawLength:function(){return this._rackLength},setDebugDrawWidth:function(width){this._rackWidth=width,this._updateVertices()},getDebugDrawWidth:function(){return this._rackWidth},setDebugDrawEnabled:function(isDebugDraw){var renderCmd=this._renderCmd;renderCmd._debug!==isDebugDraw&&(renderCmd._debug=isDebugDraw,cc.renderer.childrenOrderDirty=!0,this._visible&&null!=this._rootSkeleton&&(this._rootSkeleton._subBonesDirty=!0,this._rootSkeleton._subBonesOrderDirty=!0))},isDebugDrawEnabled:function(){return this._renderCmd._debug},setDebugDrawColor:function(color){this._rackColor=color},getDebugDrawColor:function(){return this._rackColor},getVisibleSkinsRect:function(){var minx,miny,maxx,maxy=0;minx=miny=maxx=maxy;var first=!0,displayRect=type.rect(0,0,0,0);this._renderCmd._debug&&null!=this._rootSkeleton&&this._rootSkeleton._renderCmd._debug&&(maxx=this._rackWidth,maxy=this._rackLength,first=!1);for(var skin,boneSkins=this._boneSkins,i=0;i<boneSkins.length;i++){var r=(skin=boneSkins[i]).getBoundingBox();!skin.isVisible()||0===r.x&&0===r.y&&0===r.width&&0===r.height||(first?(minx=cc.rectGetMinX(r),miny=cc.rectGetMinY(r),maxx=cc.rectGetMaxX(r),maxy=cc.rectGetMaxY(r),first=!1):(minx=Math.min(cc.rectGetMinX(r),minx),miny=Math.min(cc.rectGetMinY(r),miny),maxx=Math.max(cc.rectGetMaxX(r),maxx),maxy=Math.max(cc.rectGetMaxY(r),maxy)),displayRect.setRect(minx,miny,maxx-minx,maxy-miny))}return displayRect},getBoundingBox:function(){var boundingBox=this.getVisibleSkinsRect();return cc.rectApplyAffineTransform(boundingBox,this.getNodeToParentAffineTransform())},batchBoneDrawToSkeleton:function(bone){},setLocalZOrder:function(localZOrder){Node.prototype.setLocalZOrder.call(this,localZOrder),null!=this._rootSkeleton&&(this._rootSkeleton._subBonesOrderDirty=!0)},setName:function(name){var rootSkeleton=this._rootSkeleton,oldName=this.getName();if(Node.prototype.setName.call(this,name),null!=rootSkeleton){var oIter=rootSkeleton._subBonesMap[oldName],nIter=rootSkeleton._subBonesMap[name];oIter&&!nIter&&(delete rootSkeleton._subBonesMap[oIter],rootSkeleton._subBonesMap[name]=oIter)}},setContentSize:function(contentSize){Node.prototype.setContentSize.call(this,contentSize),this._updateVertices()},setAnchorPoint:function(anchorPoint){Node.prototype.setAnchorPoint.call(this,anchorPoint),this._updateVertices()},setVisible:function(visible){this._visible!=visible&&(Node.prototype.setVisible.call(this,visible),null!=this._rootSkeleton&&(this._rootSkeleton._subBonesDirty=!0,this._rootSkeleton._subBonesOrderDirty=!0))},_addToChildrenListHelper:function(child){child instanceof BoneNode?this._addToBoneList(child):this._addToSkinList(child)},_removeFromChildrenListHelper:function(child){child instanceof BoneNode?this._removeFromBoneList(child):child instanceof SkinNode&&this._removeFromSkinList(skin)},_removeFromBoneList:function(bone){if(null!=this._rootSkeleton&&bone instanceof ccs.SkeletonNode&&bone._rootSkeleton===this._rootSkeleton){bone._rootSkeleton=null;var subBones=bone.getAllSubBones();subBones.push(bone);for(var subBone,i=0;i<subBones.length;i++)(subBone=subBones[i])._rootSkeleton=null,delete this._rootSkeleton._subBonesMap[subBone.getName()],this._rootSkeleton._subBonesDirty=!0,this._rootSkeleton._subBonesOrderDirty=!0}else this._rootSkeleton._subBonesDirty=!0,this._rootSkeleton._subBonesOrderDirty=!0;cc.arrayRemoveObject(this._childBones,bone)},_setRootSkeleton:function(rootSkeleton){this._rootSkeleton=rootSkeleton;for(var subBones=this.getAllSubBones(),i=0;i<subBones.length;i++)this._addToBoneList(subBones[i])},_addToBoneList:function(bone){if(-1===this._childBones.indexOf(bone)&&this._childBones.push(bone),null!=this._rootSkeleton&&!(bone instanceof SkinNode||bone._rootSkeleton)){var subBones=bone.getAllSubBones();subBones.push(bone);for(var subBone,i=0;i<subBones.length;i++){(subBone=subBones[i])._setRootSkeleton(this._rootSkeleton);var bonename=subBone.getName();this._rootSkeleton._subBonesMap[bonename]?(cc.log("already has a bone named %s in skeleton %s",bonename,this._rootSkeleton.getName()),this._rootSkeleton._subBonesDirty=!0,this._rootSkeleton._subBonesOrderDirty=!0):(this._rootSkeleton._subBonesMap[subBone.getName()]=subBone,this._rootSkeleton._subBonesDirty=!0,this._rootSkeleton._subBonesOrderDirty=!0)}}},_visitSkins:function(){var cmd=this._renderCmd;if(this._visible){var parentCmd=cmd.getParentRenderCmd();parentCmd&&(cmd._curLevel=parentCmd._curLevel+1);var i,child,children=this._boneSkins;cmd._syncStatus(parentCmd);var len=children.length;if(len>0){for(this.sortAllChildren(),i=0;i<len&&(child=children[i])._localZOrder<0;i++)child.visit(this);for(;i<len;i++)children[i].visit(this)}cmd._dirtyFlag=0}},_addToSkinList:function(skin){if(this._boneSkins.push(skin),skin.getBlendFunc){var blendFunc=skin.getBlendFunc();this._blendFunc.src!==blendFunc.src&&this._blendFunc.dst!==blendFunc.dst&&skin.setBlendFunc(this._blendFunc)}},_removeFromSkinList:function(skin){cc.arrayRemoveObject(this._boneSkins,skin)},sortAllChildren:function(){this._sortArray(this._childBones),this._sortArray(this._boneSkins),Node.prototype.sortAllChildren.call(this)},_sortArray:function(array){if(array){var i,j,tmp,len=array.length;for(i=1;i<len;i++){for(tmp=array[i],j=i-1;j>=0;){if(tmp._localZOrder<array[j]._localZOrder)array[j+1]=array[j];else{if(!(tmp._localZOrder===array[j]._localZOrder&&tmp.arrivalOrder<array[j].arrivalOrder))break;array[j+1]=array[j]}j--}array[j+1]=tmp}}},_updateVertices:function(){var squareVertices=this._squareVertices,anchorPointInPoints=this._renderCmd._anchorPointInPoints;if(this._rackLength!=squareVertices[2].x-anchorPointInPoints.x||squareVertices[3].y!=this._rackWidth/2-anchorPointInPoints.y){squareVertices[1].x=squareVertices[1].y=squareVertices[3].y=0,squareVertices[0].x=squareVertices[2].x=.1*this._rackLength,squareVertices[2].y=.5*this._rackWidth,squareVertices[0].y=-squareVertices[2].y,squareVertices[3].x=this._rackLength;for(var i=0;i<squareVertices.length;i++)squareVertices[i].x+=anchorPointInPoints.x,squareVertices[i].y+=anchorPointInPoints.y;this._renderCmd.updateDebugPoint(squareVertices)}},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new BoneNodeCanvasCmd(this):new BoneNodeWebGLCmd(this)}});BoneNode.create=function(length,color){return new ccui.BoneNode(length,color)};var BoneNodeCanvasCmd=function(){var BoneNodeCanvasCmd=function(node){this._rootCtor(node),this._debug=!1,this._color=cc.color.WHITE,this._drawNode=new cc.DrawNode},proto=BoneNodeCanvasCmd.prototype=Object.create(Node.CanvasRenderCmd.prototype);return proto.constructor=BoneNodeCanvasCmd,proto.updateDebugPoint=function(points){this._drawNode.clear(),this._drawNode.drawPoly(points,this._color,0,this._color)},proto.transform=function(parentCmd,recursive){var rootSkeleton=this._node._rootSkeleton;this.originTransform(parentCmd,recursive),rootSkeleton&&rootSkeleton._renderCmd._debug&&this._drawNode._renderCmd.transform(this)},BoneNodeCanvasCmd}(),BoneNodeWebGLCmd=function(){var BoneNodeWebGLCmd=function(node){this._rootCtor(node),this._debug=!1,this._color=cc.color.WHITE,this._drawNode=new cc.DrawNode},proto=BoneNodeWebGLCmd.prototype=Object.create(Node.WebGLRenderCmd.prototype);return proto.constructor=BoneNodeWebGLCmd,proto.updateDebugPoint=function(points){this._drawNode.clear(),this._drawNode.drawPoly(points,this._color,0,this._color)},proto.transform=function(parentCmd,recursive){var rootSkeleton=this._node._rootSkeleton;this.originTransform(parentCmd,recursive),rootSkeleton&&rootSkeleton._renderCmd._debug&&this._drawNode._renderCmd.transform(this)},BoneNodeWebGLCmd}();return BoneNode}(),ccs.SkeletonNode=function(){var BoneNode=ccs.BoneNode,SkeletonNode=(cc.p,cc.size,cc.rect,BoneNode.extend({_subBonesMap:null,_squareVertices:null,_squareColors:null,_noMVPVertices:null,_skinGroupMap:null,_sortedAllBonesDirty:!1,_sortedAllBones:null,_batchedBoneVetices:null,_batchedBoneColors:null,_batchedVeticesCount:null,_batchBoneCommand:null,_subOrderedAllBones:null,ctor:function(){this._squareVertices=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],this._rootSkeleton=this,BoneNode.prototype.ctor.call(this),this._subBonesMap={},this._subOrderedAllBones=[],this._skinGroupMap={},this._rackLength=this._rackWidth=20,this._updateVertices()},getBoneNode:function(boneName){var item=this._subBonesMap[boneName];return item||null},getAllSubBonesMap:function(){return this._subBonesMap},changeSkins:function(boneSkinNameMap){if("object"==typeof boneSkinNameMap){var boneSkin;for(var name in boneSkinNameMap){boneSkin=boneSkinNameMap[name];var bone=this.getBoneNode(name);null!==bone&&bone.displaySkin(boneSkin,!0)}}else{var suit=this._suitMap[boneSkinNameMap];suit&&this.changeSkins(suit,!0)}},addSkinGroup:function(groupName,boneSkinNameMap){this._skinGroupMap[groupName]=boneSkinNameMap},getBoundingBox:function(){var minx,miny,maxx,maxy=0;minx=miny=maxx=maxy;var boundingBox=this.getVisibleSkinsRect(),first=!0;0===boundingBox.x&&0===boundingBox.y&&0===boundingBox.width&&0===boundingBox.height||(minx=cc.rectGetMinX(boundingBox),miny=cc.rectGetMinY(boundingBox),maxx=cc.rectGetMaxX(boundingBox),maxy=cc.rectGetMaxY(boundingBox),first=!1);for(var bone,allBones=this.getAllSubBones(),i=0;i<allBones.length;i++){bone=allBones[i];var r=cc.rectApplyAffineTransform(bone.getVisibleSkinsRect(),bone.getNodeToParentTransform(bone.getRootSkeletonNode()));0===r.x&&0===r.y&&0===r.width&&0===r.height||(first?(minx=cc.rectGetMinX(r),miny=cc.rectGetMinY(r),maxx=cc.rectGetMaxX(r),maxy=cc.rectGetMaxY(r),first=!1):(minx=Math.min(cc.rectGetMinX(r),minx),miny=Math.min(cc.rectGetMinY(r),miny),maxx=Math.max(cc.rectGetMaxX(r),maxx),maxy=Math.max(cc.rectGetMaxY(r),maxy)))}return boundingBox.x=minx,boundingBox.y=miny,boundingBox.width=maxx-minx,boundingBox.height=maxy-miny,cc.rectApplyAffineTransform(boundingBox,this.getNodeToParentTransform())},_visit:function(parentCmd){if(this._visible){var cmd=this._renderCmd;parentCmd=parentCmd||cmd.getParentRenderCmd(),cmd._syncStatus(parentCmd);var i;if(0!==this._children.length)for(i=0;i<this._children.length;i++)this._children[i].visit(this);this._checkSubBonesDirty();var subOrderedBoneCmd,subOrderedAllBones=this._subOrderedAllBones;for(i=0;i<subOrderedAllBones.length;i++)subOrderedAllBones[i]._visitSkins();if(cmd._debug)for(i=0;i<subOrderedAllBones.length;i++)subOrderedBoneCmd=subOrderedAllBones[i]._renderCmd,cc.renderer.pushRenderCommand(subOrderedBoneCmd._drawNode._renderCmd);cmd._dirtyFlag=0}},_checkSubBonesDirty:function(){this._subBonesDirty&&(this._updateOrderedAllbones(),this._subBonesDirty=!1),this._subBonesOrderDirty&&(this._sortOrderedAllBones(),this._subBonesOrderDirty=!1)},_updateOrderedAllbones:function(){this._subOrderedAllBones.length=0;for(var bone,boneStack=[],childBones=this._childBones,i=0;i<childBones.length;i++)(bone=childBones[i]).isVisible()&&boneStack.push(bone);for(;boneStack.length>0;){var top=boneStack.pop(),topCmd=top._renderCmd;topCmd._syncStatus(topCmd.getParentRenderCmd()),this._subOrderedAllBones.push(top);for(var childbone,topChildren=top.getChildBones(),i=0;i<topChildren.length;i++)(childbone=topChildren[i]).isVisible()&&boneStack.push(childbone)}},_sortOrderedAllBones:function(){this._sortArray(this._subOrderedAllBones)},_updateVertices:function(){var squareVertices=this._squareVertices,anchorPointInPoints=this._renderCmd._anchorPointInPoints;if(this._rackLength!=squareVertices[6].x-anchorPointInPoints.x||this._rackWidth!=squareVertices[3].y-anchorPointInPoints.y){var radiusl=.5*this._rackLength,radiusw=.5*this._rackWidth,radiusl_2=.25*radiusl,radiusw_2=.25*radiusw;squareVertices[5].y=squareVertices[2].y=squareVertices[1].y=squareVertices[6].y=squareVertices[0].x=squareVertices[4].x=squareVertices[7].x=squareVertices[3].x=0,squareVertices[5].x=-radiusl,squareVertices[0].y=-radiusw,squareVertices[6].x=radiusl,squareVertices[3].y=radiusw,squareVertices[1].x=radiusl_2,squareVertices[7].y=radiusw_2,squareVertices[2].x=-radiusl_2,squareVertices[4].y=-radiusw_2;for(var i=0;i<squareVertices.length;i++)squareVertices[i].x+=anchorPointInPoints.x,squareVertices[i].y+=anchorPointInPoints.y}},_updateAllDrawBones:function(){this._subDrawBones={};for(var name in this._subBonesMap){var bone=this._subBonesMap[name];bone.isVisible()&&bone.isDebugDrawEnabled()&&this._subDrawBones.push(bone)}this._sortArray(this._sortedAllBones),this._subDrawBones=!1}}));return SkeletonNode.create=function(){return new SkeletonNode},SkeletonNode}(),ccs._load=function(){var load=function(file,type,path){var json=cc.loader.getRes(file);if(!json)return cc.log("%s does not exist",file);var ext=extname(file).toLocaleLowerCase();if("json"!==ext&&"exportjson"!==ext)return cc.log("%s load error, must be json file",file);var parse;if(type?parse=parser[type]:json.widgetTree?parse=parser.ccui:json.nodeTree?parse=parser.timeline:json.Content&&json.Content.Content?parse=parser.timeline:json.gameobjects&&(parse=parser.scene),!parse)return cc.log("Can't find the parser : %s",file),new cc.Node;var version=json.version||json.Version;if(!version&&json.armature_data)return cc.warn("%s is armature. please use:",file),cc.warn("    ccs.armatureDataManager.addArmatureFileInfoAsync(%s);",file),cc.warn("    var armature = new ccs.Armature('name');"),new cc.Node;var currentParser=getParser(parse,version);return currentParser?currentParser.parse(file,json,path)||null:(cc.log("Can't find the parser : %s",file),new cc.Node)},parser={ccui:{},timeline:{},action:{},scene:{}};load.registerParser=function(name,version,target){if(!name||!version||!target)return cc.log("register parser error");parser[name]||(parser[name]={}),parser[name][version]=target},load.getParser=function(name,version){return name&&version?parser[name]?parser[name][version]:void 0:name?parser[name]:parser};var extname=function(fileName){var arr=fileName.match(extnameReg);return arr&&arr[1]?arr[1]:null},extnameReg=/\.([^\.]+)$/,parserReg=/([^\.](\.\*)?)*$/,getParser=function(parser,version){return parser[version]?parser[version]:"*"===version?null:getParser(parser,version.replace(parserReg,"*"))};return load}(),ccs._parser=cc.Class.extend({ctor:function(){this.parsers={}},_dirnameReg:/\S*\//,_dirname:function(path){var arr=path.match(this._dirnameReg);return arr&&arr[0]?arr[0]:""},getClass:function(json){return json.classname},getNodeJson:function(json){return json.widgetTree},parse:function(file,json,resourcePath){resourcePath=resourcePath||this._dirname(file),this.pretreatment(json,resourcePath);var node=this.parseNode(this.getNodeJson(json),resourcePath,file);return node&&this.deferred(json,resourcePath,node,file),node},pretreatment:function(json,resourcePath,file){},deferred:function(json,resourcePath,node,file){},parseNode:function(json,resourcePath){var parser=this.parsers[this.getClass(json)],widget=null;return parser?widget=parser.call(this,json,resourcePath):cc.log("Can't find the parser : %s",this.getClass(json)),widget},registerParser:function(widget,parse){this.parsers[widget]=parse}}),ccs.load=function(file,path){var object={node:null,action:null};return object.node=ccs._load(file,null,path),object.action=ccs._load(file,"action",path),object.action&&-1===object.action.tag&&object.node&&(object.action.tag=object.node.tag),object},ccs.load.validate={},ccs.load.preload=!0,ccs.loadWithVisibleSize=function(file,path){var object=ccs.load(file,path),size=cc.director.getVisibleSize();return object.node&&size&&(object.node.setContentSize(size.width,size.height),ccui.helper.doLayout(object.node)),object},ccs.actionTimelineCache={createAction:function(file){return ccs._load(file,"action")}},ccs.csLoader={createNode:function(file){return ccs._load(file)}},cc.loader.register(["json"],{load:function(realUrl,url,res,cb){cc.loader.loadJson(realUrl,function(error,data){var path=cc.path;if(data&&data.Content&&data.Content.Content.UsedResources){for(var tmpUrl,normalUrl,UsedResources=data.Content.Content.UsedResources,dirname=path.dirname(url),list=[],i=0;i<UsedResources.length;i++)!ccs.load.preload&&/\.(png|jpg$)/.test(UsedResources[i])||(tmpUrl=path.join(dirname,UsedResources[i]),normalUrl=path._normalize(tmpUrl),ccs.load.validate[normalUrl]||(ccs.load.validate[normalUrl]=!0,list.push(normalUrl)));cc.loader.load(list,function(){cb(error,data)})}else cb(error,data)})}}),function(load,baseParser){var parser=new(ccs._parser.extend({getNodeJson:function(json){return json},parseNode:function(json,resourcePath){var parser=this.parsers[this.getClass(json)],node=null;return parser?node=parser.call(this,json,resourcePath):cc.log("Can't find the parser : %s",this.getClass(json)),node},deferred:function(json,resourcePath,node,file){ccs.triggerManager.parse(json.Triggers||[]),ccs.sceneReader&&(ccs.sceneReader._node=node)},setPropertyFromJsonDict:function(node,json){var x=cc.isUndefined(json.x)?0:json.x,y=cc.isUndefined(json.y)?0:json.y;node.setPosition(x,y);var bVisible=Boolean(cc.isUndefined(json.visible)?1:json.visible);node.setVisible(bVisible);var nTag=cc.isUndefined(json.objecttag)?-1:json.objecttag;node.setTag(nTag);var nZorder=cc.isUndefined(json.zorder)?0:json.zorder;node.setLocalZOrder(nZorder);var fScaleX=cc.isUndefined(json.scalex)?1:json.scalex,fScaleY=cc.isUndefined(json.scaley)?1:json.scaley;node.setScaleX(fScaleX),node.setScaleY(fScaleY);var fRotationZ=cc.isUndefined(json.rotation)?0:json.rotation;node.setRotation(fRotationZ);var sName=json.name||"";node.setName(sName)}}));parser.parseChild=function(node,objects,resourcePath){for(var i=0;i<objects.length;i++){var child,options=objects[i];options&&(child=this.parseNode(options,resourcePath)),child&&node.addChild(child)}};var componentsParser={CCSprite:function(node,component,resourcePath){var child=new cc.Sprite;loadTexture(component.fileData,resourcePath,function(path,type){if(0===type)child.setTexture(path);else if(1===type){var spriteFrame=cc.spriteFrameCache.getSpriteFrame(path);child.setSpriteFrame(spriteFrame)}});var render=new ccs.ComRender(child,"CCSprite");return node.addComponent(render),render},CCTMXTiledMap:function(node,component,resourcePath){var child=null;loadTexture(component.fileData,resourcePath,function(path,type){0===type&&(child=new cc.TMXTiledMap(path))});var render=new ccs.ComRender(child,"CCTMXTiledMap");return node.addComponent(render),render},CCParticleSystemQuad:function(node,component,resourcePath){var child=null;loadTexture(component.fileData,resourcePath,function(path,type){0===type?child=new cc.ParticleSystem(path):cc.log("unknown resourcetype on CCParticleSystemQuad!"),child.setPosition(0,0)});var render=new ccs.ComRender(child,"CCParticleSystemQuad");return node.addComponent(render),render},CCArmature:function(node,component,resourcePath){var child=null;if(loadTexture(component.fileData,resourcePath,function(path,type){if(0===type){var jsonDict=cc.loader.getRes(path);jsonDict||cc.log("Please load the resource [%s] first!",path);var name=jsonDict.armature_data[0].name;ccs.armatureDataManager.addArmatureFileInfo(path),child=new ccs.Armature(name)}}),child){var render=new ccs.ComRender(child,"CCArmature");node.addComponent(render);var actionName=component.selectedactionname;return actionName&&child.getAnimation()&&child.getAnimation().play(actionName),render}},CCComAudio:function(node,component,resourcePath){var audio=null;loadTexture(component.fileData,resourcePath,function(path,type){if(0===type){(audio=new ccs.ComAudio).preloadEffect(path);var name=component.name;name&&audio.setName(name),node.addComponent(audio)}})},CCComAttribute:function(node,component,resourcePath){var attribute=null;return loadTexture(component.fileData,resourcePath,function(path,type){0===type?(attribute=new ccs.ComAttribute,""!==path&&attribute.parse(path),node.addComponent(attribute)):cc.log("unknown resourcetype on CCComAttribute!")}),attribute},CCBackgroundAudio:function(node,component,resourcePath){var audio=null;loadTexture(component.fileData,resourcePath,function(path,type){if(0===type){(audio=new ccs.ComAudio).preloadBackgroundMusic(path),audio.setFile(path);var bLoop=Boolean(component.loop||0);audio.setLoop(bLoop);var name=component.name;name&&audio.setName(name),node.addComponent(audio),audio.playBackgroundMusic(path,bLoop)}})},GUIComponent:function(node,component,resourcePath){var widget=null;loadTexture(component.fileData,resourcePath,function(path,type){widget=ccs._load(path,"ccui")});var render=new ccs.ComRender(widget,"GUIComponent");return node.addComponent(render),render},CCScene:function(){}},loadedPlist={},loadTexture=function(json,resourcePath,cb){if(null!=json){var path=json.path,type=json.resourceType,plist=json.plist;if(!path)return;plist&&(cc.loader.getRes(resourcePath+plist)?(loadedPlist[resourcePath+plist]=!0,cc.spriteFrameCache.addSpriteFrames(resourcePath+plist)):loadedPlist[resourcePath+plist]||cc.log("%s need to be preloaded",resourcePath+plist)),0!==type?cb(path,type):cb(resourcePath+path,type)}};parser.parseComponents=function(node,json,resourcePath){node&&json&&json.forEach(function(component){var parser=componentsParser[component.classname],render=null;parser?render=parser(node,component,resourcePath):cc.log("Can't find the component parser : %s",component.classname);var name=component.name;render&&name&&render.setName(name)})},parser.registerParser("CCNode",function(options,resourcePath){var node=new cc.Node;this.setPropertyFromJsonDict(node,options),this.parseChild.call(this,node,options.gameobjects,resourcePath),this.parseComponents(node,options.components,resourcePath);var size=options.CanvasSize;return size&&node.setContentSize(cc.size(size._width,size._height)),node}),load.registerParser("scene","*",parser)}(ccs._load),function(load,baseParser){var _stack=new Array(50),parser=new(baseParser.extend({addSpriteFrame:function(textures,resourcePath){if(textures)for(var i=0;i<textures.length;i++)cc.spriteFrameCache.addSpriteFrames(resourcePath+textures[i])},pretreatment:function(json,resourcePath){this.addSpriteFrame(json.textures,resourcePath)},parseRecursive:function(json,resourcePath){var parser,curr,className,options,position,anchor,anchorPP,node,parent,children,index=1,rootNode=null;for(_stack[0]=json;index>0;)if(index--,curr=_stack[index],_stack[index]=null,curr)if(className=curr.classname,parser=this.parsers[className]){if((node=new parser.object)&&(rootNode||(rootNode=node),options=curr.options,this.generalAttributes(node,options),parser.handle(node,options,resourcePath),this.colorAttributes(node,options),parent=curr.parent,curr.parent=null,parent instanceof ccui.PageView?parent.addPage(node):parent instanceof ccui.ListView?parent.pushBackCustomItem(node):parent&&(parent instanceof ccui.Layout||(node.getPositionType()===ccui.Widget.POSITION_PERCENT&&(position=node._positionPercent,anchor=parent._anchorPoint,node._positionPercent.x=position.x+anchor.x,node._positionPercent.y=position.y+anchor.y),anchorPP=parent._renderCmd._anchorPointInPoints,node._position.x+=anchorPP.x,node._position.y+=anchorPP.y,node.setNodeDirty()),parent.addChild(node)),(children=curr.children)&&children.length>0))for(var i=children.length-1;i>=0;i--)_stack[index]=children[i],_stack[index].parent=node,index++}else cc.log("Can't find the parser : %s",className);return rootNode},parse:function(file,json,resourcePath){resourcePath=resourcePath||this._dirname(file),this.pretreatment(json,resourcePath);var node=this.parseRecursive(json.widgetTree,resourcePath);return node&&this.deferred(json,resourcePath,node,file),node},deferred:function(json,resourcePath,node,file){node&&(ccs.actionManager.initWithDictionary(file,json.animation,node),node.setContentSize(json.designWidth,json.designHeight))}}));parser.generalAttributes=function(widget,options){widget._ignoreSize=options.ignoreSize||!0,widget._sizeType=options.sizeType||0,widget._positionType=options.positionType||0,widget._sizePercent.x=options.sizePercentX||0,widget._sizePercent.y=options.sizePercentY||0,widget._positionPercent.x=options.positionPercentX||0,widget._positionPercent.y=options.positionPercentY||0;var w=0,h=0;if(options.adaptScreen){var screenSize=cc.director.getWinSize();w=screenSize.width,h=screenSize.height}else w=options.width||0,h=options.height||0;var anchorPointX=options.anchorPointX,anchorPointY=options.anchorPointY;if(widget._anchorPoint.x=isNaN(anchorPointX)?.5:anchorPointX,widget._anchorPoint.y=isNaN(anchorPointY)?.5:anchorPointY,widget.setContentSize(w,h),widget.setTag(options.tag),widget.setActionTag(options.actiontag),widget.setTouchEnabled(options.touchAble),widget._name=options.name||"default",widget._position.x=options.x||0,widget._position.y=options.y||0,widget._scaleX=options.scaleX||1,widget._scaleY=options.scaleY||1,widget._rotationX=widget._rotationY=options.rotation||0,widget._visible=options.visible||!1,widget._localZOrder=options.ZOrder||0,null!=options.layoutParameter){var layoutParameterDic=options.layoutParameter,parameter=null;switch(isNaN(layoutParameterDic.type)?2:layoutParameterDic.type){case 0:break;case 1:(parameter=new ccui.LinearLayoutParameter)._linearGravity=layoutParameterDic.gravity||0;break;case 2:(parameter=new ccui.RelativeLayoutParameter)._relativeLayoutName=layoutParameterDic.relativeName,parameter._relativeWidgetName=layoutParameterDic.relativeToName,parameter._relativeAlign=layoutParameterDic.align||0}if(null!=parameter){var margin=parameter._margin;margin.left=layoutParameterDic.marginLeft||0,margin.top=layoutParameterDic.marginTop||0,margin.right=layoutParameterDic.marginRight||0,margin.bottom=layoutParameterDic.marginDown||0,widget.setLayoutParameter(parameter)}}},parser.colorAttributes=function(widget,options){var op=null!==options.opacity?options.opacity:255;null!=op&&widget.setOpacity(op);var colorR=options.colorR,colorG=options.colorG,colorB=options.colorB;widget.setColor(cc.color(null==colorR?255:colorR,null==colorG?255:colorG,null==colorB?255:colorB)),widget.setFlippedX(options.flipX),widget.setFlippedY(options.flipY)};var getPath=function(res,type,path,cb){path&&(0===type?cb(res+path,type):cb(path,type))};parser.LayoutAttributes=function(widget,options,resourcePath){var w=0,h=0;if(options.adaptScreen){var screenSize=cc.director.getWinSize();w=screenSize.width,h=screenSize.height}else w=options.width||0,h=options.height||0;widget.setSize(cc.size(w,h)),widget.setClippingEnabled(options.clipAble);var backGroundScale9Enable=options.backGroundScale9Enable;widget.setBackGroundImageScale9Enabled(backGroundScale9Enable);var cr=options.bgColorR||0,cg=options.bgColorG||0,cb=options.bgColorB||0,scr=isNaN(options.bgStartColorR)?255:options.bgStartColorR,scg=isNaN(options.bgStartColorG)?255:options.bgStartColorG,scb=isNaN(options.bgStartColorB)?255:options.bgStartColorB,ecr=isNaN(options.bgEndColorR)?255:options.bgEndColorR,ecg=isNaN(options.bgEndColorG)?255:options.bgEndColorG,ecb=isNaN(options.bgEndColorB)?255:options.bgEndColorB,bgcv1=options.vectorX||0,bgcv2=options.vectorY||0;widget.setBackGroundColorVector(cc.p(bgcv1,bgcv2));var co=options.bgColorOpacity||0,colorType=options.colorType||0;widget.setBackGroundColorType(colorType),widget.setBackGroundColor(cc.color(scr,scg,scb),cc.color(ecr,ecg,ecb)),widget.setBackGroundColor(cc.color(cr,cg,cb)),widget.setBackGroundColorOpacity(co);var imageFileNameDic=options.backGroundImageData;if(imageFileNameDic&&getPath(resourcePath,imageFileNameDic.resourceType||0,imageFileNameDic.path,function(path,type){widget.setBackGroundImage(path,type)}),backGroundScale9Enable){var cx=options.capInsetsX||0,cy=options.capInsetsY||0,cw=isNaN(options.capInsetsWidth)?1:options.capInsetsWidth,ch=isNaN(options.capInsetsHeight)?1:options.capInsetsHeight;widget.setBackGroundImageCapInsets(cc.rect(cx,cy,cw,ch))}options.layoutType&&widget.setLayoutType(options.layoutType)},parser.ButtonAttributes=function(widget,options,resourcePath){var button=widget,scale9Enable=options.scale9Enable;button.setScale9Enabled(scale9Enable);var normalDic=options.normalData;getPath(resourcePath,normalDic.resourceType||0,normalDic.path,function(path,type){button.loadTextureNormal(path,type)});var pressedDic=options.pressedData;getPath(resourcePath,pressedDic.resourceType||0,pressedDic.path,function(path,type){button.loadTexturePressed(path,type)});var disabledDic=options.disabledData;if(getPath(resourcePath,disabledDic.resourceType||0,disabledDic.path,function(path,type){button.loadTextureDisabled(path,type)}),scale9Enable){var cx=options.capInsetsX||0,cy=options.capInsetsY||0,cw=isNaN(options.capInsetsWidth)?1:options.capInsetsWidth,ch=isNaN(options.capInsetsHeight)?1:options.capInsetsHeight;button.setCapInsets(cc.rect(cx,cy,cw,ch));var sw=options.scale9Width||0,sh=options.scale9Height||0;null!=sw&&null!=sh&&button.setSize(cc.size(sw,sh))}var text=options.text||"";if(text){button.setTitleText(text);var cr=options.textColorR,cg=options.textColorG,cb=options.textColorB,cri=null!==cr?options.textColorR:255,cgi=null!==cg?options.textColorG:255,cbi=null!==cb?options.textColorB:255;button.setTitleColor(cc.color(cri,cgi,cbi)),null!=options.fontSize&&button.setTitleFontSize(options.fontSize),options.fontName&&button.setTitleFontName(options.fontName)}},parser.CheckBoxAttributes=function(widget,options,resourcePath){var backGroundDic=options.backGroundBoxData;getPath(resourcePath,backGroundDic.resourceType||0,backGroundDic.path,function(path,type){widget.loadTextureBackGround(path,type)});var backGroundSelectedDic=options.backGroundBoxSelectedData;getPath(resourcePath,backGroundSelectedDic.resourceType||backGroundDic.resourceType,backGroundSelectedDic.path||backGroundDic.path,function(path,type){widget.loadTextureBackGroundSelected(path,type)});var frontCrossDic=options.frontCrossData;getPath(resourcePath,frontCrossDic.resourceType||0,frontCrossDic.path,function(path,type){widget.loadTextureFrontCross(path,type)});var backGroundDisabledDic=options.backGroundBoxDisabledData;getPath(resourcePath,backGroundDisabledDic.resourceType||frontCrossDic.resourceType,backGroundDisabledDic.path||frontCrossDic.path,function(path,type){widget.loadTextureBackGroundDisabled(path,type)});var frontCrossDisabledDic=options.frontCrossDisabledData;getPath(resourcePath,frontCrossDisabledDic.resourceType||0,frontCrossDisabledDic.path,function(path,type){widget.loadTextureFrontCrossDisabled(path,type)}),options.selectedState&&widget.setSelected(options.selectedState)},parser.ImageViewAttributes=function(widget,options,resourcePath){var imageFileNameDic=options.fileNameData;getPath(resourcePath,imageFileNameDic.resourceType||0,imageFileNameDic.path,function(path,type){widget.loadTexture(path,type)});var scale9Enable=!1;if(options.scale9Enable&&(scale9Enable=options.scale9Enable),widget.setScale9Enabled(scale9Enable),scale9Enable){var sw=options.scale9Width||0,sh=options.scale9Height||0;if(sw&&sh){var swf=options.scale9Width||0,shf=options.scale9Height||0;widget.setSize(cc.size(swf,shf))}var cx=options.capInsetsX||0,cy=options.capInsetsY||0,cw=isNaN(options.capInsetsWidth)?1:options.capInsetsWidth,ch=isNaN(options.capInsetsHeight)?1:options.capInsetsHeight;widget.setCapInsets(cc.rect(cx,cy,cw,ch))}},parser.TextAtlasAttributes=function(widget,options,resourcePath){var sv=options.stringValue,cmf=options.charMapFileData,iw=options.itemWidth,ih=options.itemHeight,scm=options.startCharMap;if(null!=sv&&cmf&&null!=iw&&null!=ih&&null!=scm){var cmftDic=options.charMapFileData;switch(cmftDic.resourceType||0){case 0:var cmf_tp=resourcePath+cmftDic.path;widget.setProperty(sv,cmf_tp,iw,ih,scm);break;case 1:cc.log("Wrong res type of LabelAtlas!")}}},parser.TextBMFontAttributes=function(widget,options,resourcePath){var cmftDic=options.fileNameData;switch(cmftDic.resourceType||0){case 0:var cmf_tp=resourcePath+cmftDic.path;widget.setFntFile(cmf_tp);break;case 1:cc.log("Wrong res type of LabelAtlas!")}var text=options.text||"";widget.setString(text)};var regTTF=/\.ttf$/;parser.TextAttributes=function(widget,options,resourcePath){var touchScaleChangeAble=options.touchScaleEnable;widget.setTouchScaleChangeEnabled(touchScaleChangeAble);var text=options.text||"";text&&widget._setString(text),null!=options.fontSize&&widget._setFontSize(options.fontSize);var fn=options.fontName;null!=fn&&(cc.sys.isNative?regTTF.test(fn)?widget.setFontName(cc.path.join(cc.loader.resPath,resourcePath,fn)):widget.setFontName(fn):widget._setFontName(fn.replace(regTTF,"")));var aw=options.areaWidth||0,ah=options.areaHeight||0;if(aw&&ah){var size=cc.size(options.areaWidth,options.areaHeight);widget._setTextAreaSize(size)}var ha=options.hAlignment||0;null!=ha&&widget._setTextHorizontalAlignment(ha);var va=options.vAlignment||0;null!=va&&widget._setTextVerticalAlignment(va),widget._updateUITextContentSize()},parser.ListViewAttributes=function(widget,options,resoutcePath){parser.ScrollViewAttributes(widget,options,resoutcePath);var direction=options.direction||1;widget.setDirection(direction);var gravity=options.gravity||0;widget.setGravity(gravity);var itemMargin=options.itemMargin||0;widget.setItemsMargin(itemMargin)},parser.LoadingBarAttributes=function(widget,options,resourcePath){var imageFileNameDic=options.textureData;getPath(resourcePath,imageFileNameDic.resourceType||0,imageFileNameDic.path,function(path,type){widget.loadTexture(path,type)});var scale9Enable=options.scale9Enable;if(widget.setScale9Enabled(scale9Enable),scale9Enable){var cx=options.capInsetsX||0,cy=options.capInsetsY||0,cw=isNaN(options.capInsetsWidth)?1:options.capInsetsWidth,ch=isNaN(options.capInsetsHeight)?1:options.capInsetsHeight;widget.setCapInsets(cc.rect(cx,cy,cw,ch));var width=options.width||0,height=options.height||0;widget.setSize(cc.size(width,height))}widget.setDirection(options.direction||0),widget.setPercent(options.percent||0)},parser.PageViewAttributes=parser.LayoutAttributes,parser.ScrollViewAttributes=function(widget,options,resoutcePath){parser.LayoutAttributes(widget,options,resoutcePath);var innerWidth=null!=options.innerWidth?options.innerWidth:200,innerHeight=null!=options.innerHeight?options.innerHeight:200;widget.setInnerContainerSize(cc.size(innerWidth,innerHeight));var direction=null!=options.direction?options.direction:1;widget.setDirection(direction),widget.setBounceEnabled(options.bounceEnable)},parser.SliderAttributes=function(widget,options,resourcePath){var slider=widget,barTextureScale9Enable=options.scale9Enable;slider.setScale9Enabled(barTextureScale9Enable);var bt=options.barFileName,barLength=options.length,imageFileNameDic=options.barFileNameData,imageFileType=imageFileNameDic.resourceType||0,imageFileName=imageFileNameDic.path;null!=bt?barTextureScale9Enable&&(getPath(resourcePath,imageFileType,imageFileName,function(path,type){slider.loadBarTexture(path,type)}),slider.setSize(cc.size(barLength,slider.getContentSize().height))):getPath(resourcePath,imageFileType,imageFileName,function(path,type){slider.loadBarTexture(path,type)});var normalDic=options.ballNormalData;getPath(resourcePath,normalDic.resourceType||0,normalDic.path,function(path,type){slider.loadSlidBallTextureNormal(path,type)});var pressedDic=options.ballPressedData;getPath(resourcePath,pressedDic.resourceType||normalDic.resourceType,pressedDic.path||normalDic.path,function(path,type){slider.loadSlidBallTexturePressed(path,type)});var disabledDic=options.ballDisabledData;getPath(resourcePath,disabledDic.resourceType||0,disabledDic.path,function(path,type){slider.loadSlidBallTextureDisabled(path,type)});var progressBarDic=options.progressBarData;getPath(resourcePath,progressBarDic.resourceType||0,progressBarDic.path,function(path,type){slider.loadProgressBarTexture(path,type)})},parser.TextFieldAttributes=function(widget,options,resourcePath){var ph=options.placeHolder||"";ph&&widget.setPlaceHolder(ph),widget.setString(options.text||"");var fs=options.fontSize;fs&&widget.setFontSize(fs);var fn=options.fontName;null!=fn&&(cc.sys.isNative?regTTF.test(fn)?widget.setFontName(cc.path.join(cc.loader.resPath,resourcePath,fn)):widget.setFontName(fn):widget.setFontName(fn.replace(regTTF,"")));var tsw=options.touchSizeWidth||0,tsh=options.touchSizeHeight||0;null!=tsw&&null!=tsh&&widget.setTouchSize(tsw,tsh);options.width,options.height;var maxLengthEnable=options.maxLengthEnable;if(widget.setMaxLengthEnabled(maxLengthEnable),maxLengthEnable){var maxLength=options.maxLength;widget.setMaxLength(maxLength)}var passwordEnable=options.passwordEnable;widget.setPasswordEnabled(passwordEnable),passwordEnable&&widget.setPasswordStyleText(options.passwordStyleText);var aw=options.areaWidth||0,ah=options.areaHeight||0;if(aw&&ah){var size=cc.size(aw,ah);widget.setTextAreaSize(size)}var ha=options.hAlignment||0;ha&&widget.setTextHorizontalAlignment(ha);var va=options.vAlignment||0;va&&widget.setTextVerticalAlignment(va);var r=isNaN(options.colorR)?255:options.colorR,g=isNaN(options.colorG)?255:options.colorG,b=isNaN(options.colorB)?255:options.colorB;widget.setTextColor(cc.color(r,g,b))},parser.parsers={Panel:{object:ccui.Layout,handle:parser.LayoutAttributes},Button:{object:ccui.Button,handle:parser.ButtonAttributes},CheckBox:{object:ccui.CheckBox,handle:parser.CheckBoxAttributes},ImageView:{object:ccui.ImageView,handle:parser.ImageViewAttributes},LabelAtlas:{object:ccui.TextAtlas,handle:parser.TextAtlasAttributes},LabelBMFont:{object:ccui.TextBMFont,handle:parser.TextBMFontAttributes},Label:{object:ccui.Text,handle:parser.TextAttributes},ListView:{object:ccui.ListView,handle:parser.ListViewAttributes},LoadingBar:{object:ccui.LoadingBar,handle:parser.LoadingBarAttributes},PageView:{object:ccui.PageView,handle:parser.PageViewAttributes},ScrollView:{object:ccui.ScrollView,handle:parser.ScrollViewAttributes},Slider:{object:ccui.Slider,handle:parser.SliderAttributes},TextField:{object:ccui.TextField,handle:parser.TextFieldAttributes}},load.registerParser("ccui","*",parser)}(ccs._load,ccs._parser),function(load,baseParser){var parser=new(ccs._parser.extend({getNodeJson:function(json){return json.action},parseNode:function(json,resourcePath,file){if(!json)return null;var self=this,action=new ccs.ActionTimeline;return action.setDuration(json.duration),action.setTimeSpeed(json.speed||1),json.timelines.forEach(function(timeline){var frame,parser=self.parsers[timeline.frameType];parser?frame=parser.call(self,timeline,resourcePath):cc.log("parser does not exist : %s",timeline.frameType),frame&&action.addTimeline(frame),"ColorFrame"===timeline.frameType&&action.addTimeline(self.parsers.AlphaFrame.call(self,timeline,resourcePath))}),action}}));[{name:"PositionFrame",handle:function(options){var frame=new ccs.PositionFrame,x=options.x,y=options.y;return frame.setPosition(cc.p(x,y)),frame}},{name:"VisibleFrame",handle:function(options){var frame=new ccs.VisibleFrame,visible=options.value;return frame.setVisible(visible),frame}},{name:"ScaleFrame",handle:function(options){var frame=new ccs.ScaleFrame,scalex=options.x,scaley=options.y;return frame.setScaleX(scalex),frame.setScaleY(scaley),frame}},{name:"RotationFrame",handle:function(options){var frame=new ccs.RotationFrame,rotation=options.rotation;return frame.setRotation(rotation),frame}},{name:"SkewFrame",handle:function(options){var frame=new ccs.SkewFrame,skewx=options.x,skewy=options.y;return frame.setSkewX(skewx),frame.setSkewY(skewy),frame}},{name:"RotationSkewFrame",handle:function(options){var frame=new ccs.RotationSkewFrame,skewx=options.x,skewy=options.y;return frame.setSkewX(skewx),frame.setSkewY(skewy),frame}},{name:"AnchorFrame",handle:function(options){var frame=new ccs.AnchorPointFrame,anchorx=options.x,anchory=options.y;return frame.setAnchorPoint(cc.p(anchorx,anchory)),frame}},{name:"InnerActionFrame",handle:function(options){var frame=new ccs.InnerActionFrame,type=options.innerActionType,startFrame=options.startFrame;return frame.setInnerActionType(type),frame.setStartFrameIndex(startFrame),frame}},{name:"ColorFrame",handle:function(options){var frame=new ccs.ColorFrame,red=options.red,green=options.green,blue=options.blue;frame.setColor(cc.color(red,green,blue));var alphaFrame=new ccs.AlphaFrame,alpha=options.alpha;return alphaFrame.setAlpha(alpha),frame}},{name:"AlphaFrame",handle:function(options){var frame=new ccs.AlphaFrame,alpha=options.alpha;return frame.setAlpha(alpha),frame}},{name:"TextureFrame",handle:function(options){var frame=new ccs.TextureFrame,texture=options.value;if(null!=texture){var path=texture;null==cc.spriteFrameCache.getSpriteFrame(path)&&(path=ccs.csLoader.getJsonPath()+texture),frame.setTextureName(path)}return frame}},{name:"EventFrame",handle:function(options){var frame=new ccs.EventFrame,evnt=options.value;return null!=evnt&&frame.setEvent(evnt),frame}},{name:"ZOrderFrame",handle:function(options){var frame=new ccs.ZOrderFrame,zorder=options.value;return frame.setZOrder(zorder),frame}}].forEach(function(item){parser.registerParser(item.name,function(options,resourcePath){var timeline=new ccs.Timeline;timeline.setActionTag(options.actionTag);var frames=options.frames;return frames&&frames.length&&frames.forEach(function(frameData){var frame=item.handle(frameData);frame.setFrameIndex(frameData.frameIndex),frame.setTween(frameData.tween),timeline.addFrame(frame)}),timeline})}),load.registerParser("action","0.*",parser),load.registerParser("action","1.*",parser)}(ccs._load),function(load,baseParser){var parser=new(ccs._parser.extend({getNodeJson:function(json){return json.Content.Content.Animation},parseNode:function(json,resourcePath,file){if(!json)return null;var self=this,action=new ccs.ActionTimeline;return action.setDuration(json.Duration),action.setTimeSpeed(json.Speed||1),json.Timelines.forEach(function(timeline){var frame,parser=self.parsers[timeline.Property];parser?frame=parser.call(self,timeline,resourcePath):cc.log("parser does not exist : %s",timeline.Property),frame&&action.addTimeline(frame)}),action},deferred:function(json,resourcePath,action,file){for(var animationlist=json.Content.Content.AnimationList,length=animationlist?animationlist.length:0,i=0;i<length;i++){var animationdata=animationlist[i],info={name:null,startIndex:null,endIndex:null};info.name=animationdata.Name,info.startIndex=animationdata.StartIndex,info.endIndex=animationdata.EndIndex,action.addAnimationInfo(info)}}})),loadEasingDataWithFlatBuffers=function(frame,options){var type=options.Type;frame.setTweenType(type);var points=options.Points,result=[];points&&(points.forEach(function(p){result.push(p.X),result.push(p.Y)}),frame.setEasingParams(result))};[{name:"Position",handle:function(options){var frame=new ccs.PositionFrame,x=options.X,y=options.Y;return frame.setPosition(cc.p(x,y)),frame}},{name:"VisibleForFrame",handle:function(options){var frame=new ccs.VisibleFrame,visible=options.Value;return frame.setVisible(visible),frame}},{name:"Scale",handle:function(options){var frame=new ccs.ScaleFrame,scalex=options.X,scaley=options.Y;return frame.setScaleX(scalex),frame.setScaleY(scaley),frame}},{name:"Rotation",handle:function(options){var frame=new ccs.RotationFrame,rotation=options.Rotation||options.Value||0;return frame.setRotation(rotation),frame}},{name:"Skew",handle:function(options){var frame=new ccs.SkewFrame,skewx=options.X,skewy=options.Y;return frame.setSkewX(skewx),frame.setSkewY(skewy),frame}},{name:"RotationSkew",handle:function(options){var frame=new ccs.RotationSkewFrame,skewx=options.X,skewy=options.Y;return frame.setSkewX(skewx),frame.setSkewY(skewy),frame}},{name:"Anchor",handle:function(options){var frame=new ccs.AnchorPointFrame,anchorx=options.X,anchory=options.Y;return frame.setAnchorPoint(cc.p(anchorx,anchory)),frame}},{name:"AnchorPoint",handle:function(options){var frame=new ccs.AnchorPointFrame,anchorx=options.X,anchory=options.Y;return frame.setAnchorPoint(cc.p(anchorx,anchory)),frame}},{name:"InnerAction",handle:function(options){var frame=new ccs.InnerActionFrame,type=options.InnerActionType,startFrame=options.StartFrame;return frame.setInnerActionType(type),frame.setStartFrameIndex(startFrame),frame}},{name:"CColor",handle:function(options){var frame=new ccs.ColorFrame,color=options.Color;return color||(color={}),color.R=void 0===color.R?255:color.R,color.G=void 0===color.G?255:color.G,color.B=void 0===color.B?255:color.B,frame.setColor(cc.color(color.R,color.G,color.B)),frame}},{name:"Alpha",handle:function(options){var frame=new ccs.AlphaFrame,alpha=options.Value;return frame.setAlpha(alpha),frame}},{name:"FileData",handle:function(options,resourcePath){var frame,texture,plist,path,spriteFrame;return frame=new ccs.TextureFrame,null!=(texture=options.TextureFile)&&(plist=texture.Plist,path=texture.Path,!(spriteFrame=cc.spriteFrameCache.getSpriteFrame(path))&&plist&&(cc.loader.getRes(resourcePath+plist)?(cc.spriteFrameCache.addSpriteFrames(resourcePath+plist),spriteFrame=cc.spriteFrameCache.getSpriteFrame(path)):cc.log("%s need to be preloaded",resourcePath+plist)),null==spriteFrame&&(path=resourcePath+path),frame.setTextureName(path)),frame}},{name:"FrameEvent",handle:function(options){var frame=new ccs.EventFrame,evnt=options.Value;return null!=evnt&&frame.setEvent(evnt),frame}},{name:"ZOrder",handle:function(options){var frame=new ccs.ZOrderFrame,zorder=options.Value;return frame.setZOrder(zorder),frame}},{name:"ActionValue",handle:function(options){var frame=new ccs.InnerActionFrame,innerActionType=options.InnerActionType,currentAnimationFrame=options.CurrentAniamtionName,singleFrameIndex=options.SingleFrameIndex,frameIndex=options.FrameIndex;return void 0!==frameIndex&&frame.setFrameIndex(frameIndex),frame.setInnerActionType(ccs.InnerActionType[innerActionType]),frame.setSingleFrameIndex(singleFrameIndex),frame.setEnterWithName(!0),currentAnimationFrame&&frame.setAnimationName(currentAnimationFrame),frame}},{name:"BlendFunc",handle:function(options){var frame=new ccs.BlendFuncFrame,blendFunc=options.BlendFunc;return blendFunc&&void 0!==blendFunc.Src&&void 0!==blendFunc.Dst&&frame.setBlendFunc(new cc.BlendFunc(blendFunc.Src,blendFunc.Dst)),frame}}].forEach(function(item){parser.registerParser(item.name,function(options,resourcePath){var timeline=new ccs.Timeline;timeline.setActionTag(options.ActionTag);var frames=options.Frames;return frames&&frames.length&&frames.forEach(function(frameData){var frame=item.handle(frameData,resourcePath);frame.setFrameIndex(frameData.FrameIndex);var tween=null==frameData.Tween||frameData.Tween;frame.setTween(tween);var easingData=frameData.EasingData;easingData&&loadEasingDataWithFlatBuffers(frame,easingData),timeline.addFrame(frame)}),timeline})}),load.registerParser("action","2.*",parser),load.registerParser("action","*",parser)}(ccs._load),function(load,baseParser){var loadedPlist={},parser=new(ccs._parser.extend({getNodeJson:function(json){return json.nodeTree},addSpriteFrame:function(plists,pngs,resourcePath){if(plists&&pngs&&plists.length===pngs.length)for(var i=0;i<plists.length;i++){var plist=resourcePath+plists[i];cc.loader.getRes(plist)||loadedPlist[plist]?loadedPlist[plist]=!0:cc.log("%s need to be preloaded",plist),cc.spriteFrameCache.addSpriteFrames(plist,resourcePath+pngs[i])}},pretreatment:function(json,resourcePath,file){this.addSpriteFrame(json.textures,json.texturesPng,resourcePath)}}));parser.generalAttributes=function(node,options){var width=null!=options.width?options.width:0,height=null!=options.height?options.height:0,x=null!=options.x?options.x:0,y=null!=options.y?options.y:0,scalex=null!=options.scaleX?options.scaleX:1,scaley=null!=options.scaleY?options.scaleY:1,rotation=null!=options.rotation?options.rotation:0,rotationSkewX=null!=options.rotationSkewX?options.rotationSkewX:0,rotationSkewY=null!=options.rotationSkewY?options.rotationSkewY:0,skewx=null!=options.skewX?options.skewX:0,skewy=null!=options.skewY?options.skewY:0,anchorx=null!=options.anchorPointX?options.anchorPointX:.5,anchory=null!=options.anchorPointY?options.anchorPointY:.5,alpha=null!=options.opacity?options.opacity:255,red=null!=options.colorR?options.colorR:255,green=null!=options.colorG?options.colorG:255,blue=null!=options.colorB?options.colorB:255,zorder=null!=options.colorR?options.colorR:0,tag=null!=options.tag?options.tag:0,actionTag=null!=options.actionTag?options.actionTag:0,visible=null==options.visible||options.visible;0==x&&0==y||node.setPosition(cc.p(x,y)),1!=scalex&&node.setScaleX(scalex),1!=scaley&&node.setScaleY(scaley),0!=rotation&&node.setRotation(rotation),0!=rotationSkewX&&node.setRotationX(rotationSkewX),0!=rotationSkewY&&node.setRotationY(rotationSkewY),0!=skewx&&node.setSkewX(skewx),0!=skewy&&node.setSkewY(skewy),.5==anchorx&&.5==anchory||node.setAnchorPoint(cc.p(anchorx,anchory)),0==width&&0==height||node.setContentSize(cc.size(width,height)),0!=zorder&&node.setLocalZOrder(zorder),1!=visible&&node.setVisible(visible),255!=alpha&&node.setOpacity(alpha),255==red&&255==green&&255==blue||node.setColor(cc.color(red,green,blue)),node.setTag(tag),node.setUserObject(new ccs.ActionTimelineData(actionTag))},parser.parseComponent=function(node,options){if(options)for(var i=0;i<options.length;++i){var dic=options[i],component=this.loadComponent(dic);component&&node.addComponent(component)}},parser.parseChild=function(parse,widget,options,resourcePath){for(var children=options.children,i=0;i<children.length;i++){var child=this.parseNode(children[i],resourcePath);if(child)if(widget instanceof ccui.PageView)child instanceof ccui.Layout&&widget.addPage(child);else if(widget instanceof ccui.ListView)child instanceof ccui.Widget&&widget.pushBackCustomItem(child);else{if(!(widget instanceof ccui.Layout)&&child instanceof ccui.Widget){if(child.getPositionType()===ccui.Widget.POSITION_PERCENT){var position=child.getPositionPercent(),anchor=widget.getAnchorPoint();child.setPositionPercent(cc.p(position.x+anchor.x,position.y+anchor.y))}var AnchorPointIn=widget.getAnchorPointInPoints();child.setPosition(cc.p(child.getPositionX()+AnchorPointIn.x,child.getPositionY()+AnchorPointIn.y))}widget.addChild(child)}}},parser.initNode=function(options){var node=new cc.Node;return this.generalAttributes(node,options),node},parser.initSubGraph=function(options){var node,filePath=options.fileName;return node=filePath&&""!==filePath?this.createNode(filePath):new ccs.Node,this.generalAttributes(node,options),node},parser.initSprite=function(options,resourcePath){var sprite,path=options.fileName;if(null!=path){var spriteFrame=cc.spriteFrameCache.getSpriteFrame(path);spriteFrame?sprite=ccs.Sprite.createWithSpriteFrame(spriteFrame):(path=resourcePath+path,sprite=new ccs.Sprite(path)),sprite||(sprite=new cc.Sprite,cc.log("filePath is empty. Create a sprite with no texture"))}else sprite=new ccs.Sprite;this.generalAttributes(sprite,options);var flipX=options.flipX,flipY=options.flipY;return 0!=flipX&&sprite.setFlippedX(flipX),0!=flipY&&sprite.setFlippedY(flipY),sprite},parser.initParticle=function(options,resourcePath){var filePath=options.plistFile,num=options.tmxFile,particle=new cc.ParticleSystemQuad(filePath);return particle.setTotalParticles(num),this.generalAttributes(particle,options),particle},parser.initTMXTiledMap=function(options,resourcePath){var tmxFile=options.tmxFile,tmxString=options.tmxString,path=options.resourcePath,tmx=null;return tmxFile&&""!==tmxFile?tmx=new cc.TMXTiledMap(tmxFile):tmxString&&""!==tmxString&&path&&""!==path&&(tmx=new cc.TMXTiledMap(tmxString,path)),tmx};var uiParser=load.getParser("ccui")["*"];parser.initWidget=function(options,resourcePath){var type=options.classname,parser=uiParser.parsers[type];if(!parser)return cc.log("%s parser is not found",type);var node=parser.call(uiParser,options,resourcePath);if(node){var rotationSkewX=options.rotationSkewX,rotationSkewY=options.rotationSkewY,skewx=options.skewX,skewy=options.skewY;0!=rotationSkewX&&node.setRotationX(rotationSkewX),0!=rotationSkewY&&node.setRotationY(rotationSkewY),0!=skewx&&node.setSkewX(skewx),0!=skewy&&node.setSkewY(skewy);var actionTag=options.actionTag;node.setUserObject(new ccs.ActionTimelineData(actionTag))}return node},[{name:"Node",handle:parser.initNode},{name:"SubGraph",handle:parser.initSubGraph},{name:"Sprite",handle:parser.initSprite},{name:"Particle",handle:parser.initParticle},{name:"TMXTiledMap",handle:parser.initTMXTiledMap},{name:"Widget",handle:parser.initWidget},{name:"Panel",handle:parser.initWidget},{name:"Button",handle:parser.initWidget},{name:"CheckBox",handle:parser.initWidget},{name:"ImageView",handle:parser.initWidget},{name:"LabelAtlas",handle:parser.initWidget},{name:"LabelBMFont",handle:parser.initWidget},{name:"Label",handle:parser.initWidget},{name:"ListView",handle:parser.initWidget},{name:"LoadingBar",handle:parser.initWidget},{name:"PageView",handle:parser.initWidget},{name:"ScrollView",handle:parser.initWidget},{name:"Slider",handle:parser.initWidget},{name:"TextField",handle:parser.initWidget}].forEach(function(item){parser.registerParser(item.name,function(options,parse,resourcePath){var node=item.handle.call(this,options.options);return this.parseComponent(node,options.components),this.parseChild(parse,node,options,resourcePath),node})}),load.registerParser("timeline","0.*",parser),load.registerParser("timeline","1.*",parser)}(ccs._load),function(load,baseParser){var parser=new(ccs._parser.extend({parse:function(file,json,path){var resourcePath;resourcePath=void 0!==path?path:this._dirname(file),this.pretreatment(json,resourcePath,file);var node=this.parseNode(this.getNodeJson(json),resourcePath);return this.deferred(json,resourcePath,node,file),node},getNodeJson:function(json){var content=json.Content;return content.ObjectData?content.ObjectData:content.Content.ObjectData},getClass:function(json){return json.ctype}})),getParam=function(value,dValue){return void 0===value?dValue:value};parser.generalAttributes=function(node,json){null!=json.Name&&node.setName(json.Name);var position=json.Position;null==position||null==position.X&&null==position.Y||node.setPosition(cc.p(position.X||0,position.Y||0));var scale=json.Scale;null!=scale&&(null!=scale.ScaleX&&node.setScaleX(scale.ScaleX),null!=scale.ScaleY&&node.setScaleY(scale.ScaleY));var rotationSkewX=json.RotationSkewX;null!=rotationSkewX&&node.setRotationX(rotationSkewX);var rotationSkewY=json.RotationSkewY;null!=json.RotationSkewY&&node.setRotationY(rotationSkewY);var anchor=json.AnchorPoint;null!=anchor&&(null==anchor.ScaleX&&(anchor.ScaleX=0),null==anchor.ScaleY&&(anchor.ScaleY=0),.5==anchor.ScaleX&&.5==anchor.ScaleY||node.setAnchorPoint(cc.p(anchor.ScaleX,anchor.ScaleY))),null!=json.ZOrder&&node.setLocalZOrder(json.ZOrder);var visible=getParam(json.VisibleForFrame,!0);node.setVisible(visible);var size=json.Size;size&&setContentSize(node,size),null!=json.Alpha&&node.setOpacity(json.Alpha),node.setTag(json.Tag||0);var actionTag=json.ActionTag||0,extensionData=new ccs.ComExtensionData,customProperty=json.UserData;void 0!==customProperty&&extensionData.setCustomProperty(customProperty),extensionData.setActionTag(actionTag),node.getComponent("ComExtensionData")&&node.removeComponent("ComExtensionData"),node.addComponent(extensionData),node.setCascadeColorEnabled(!0),node.setCascadeOpacityEnabled(!0),setLayoutComponent(node,json)},parser.parseChild=function(node,children,resourcePath){if(node&&children)for(var i=0;i<children.length;i++){var child=this.parseNode(children[i],resourcePath);if(child)if(node instanceof ccui.PageView)child instanceof ccui.Layout&&node.addPage(child);else if(node instanceof ccui.ListView)child instanceof ccui.Widget&&node.pushBackCustomItem(child);else{if(!(node instanceof ccui.Layout)&&child instanceof ccui.Widget&&child.getPositionType()===ccui.Widget.POSITION_PERCENT){var position=child.getPositionPercent(),anchor=node.getAnchorPoint();child.setPositionPercent(cc.p(position.x+anchor.x,position.y+anchor.y))}node.addChild(child)}}},parser.initSingleNode=function(json){var node=new cc.Node;this.generalAttributes(node,json);var color=json.CColor;return null!=color&&node.setColor(getColor(color)),node},parser.initSprite=function(json,resourcePath){var node=new cc.Sprite;loadTexture(json.FileData,resourcePath,function(path,type){if(0===type)node.setTexture(path);else if(1===type){var spriteFrame=cc.spriteFrameCache.getSpriteFrame(path);spriteFrame&&node.setSpriteFrame(spriteFrame)}});var blendData=json.BlendFunc;if(json.BlendFunc){var blendFunc=cc.BlendFunc.ALPHA_PREMULTIPLIED;void 0!==blendData.Src&&(blendFunc.src=blendData.Src),void 0!==blendData.Dst&&(blendFunc.dst=blendData.Dst),node.setBlendFunc(blendFunc)}json.FlipX&&node.setFlippedX(!0),json.FlipY&&node.setFlippedY(!0),this.generalAttributes(node,json);var color=json.CColor;return null!=color&&node.setColor(getColor(color)),node},parser.initParticle=function(json,resourcePath){var node,self=this;return loadTexture(json.FileData,resourcePath,function(path,type){cc.loader.getRes(path)||cc.log("%s need to be preloaded",path),node=new cc.ParticleSystem(path),self.generalAttributes(node,json),node.setPositionType(cc.ParticleSystem.TYPE_GROUPED),!cc.sys.isNative&&node.setDrawMode(cc.ParticleSystem.TEXTURE_MODE);var blendData=json.BlendFunc;if(json.BlendFunc){var blendFunc=cc.BlendFunc.ALPHA_PREMULTIPLIED;void 0!==blendData.Src&&(blendFunc.src=blendData.Src),void 0!==blendData.Dst&&(blendFunc.dst=blendData.Dst),node.setBlendFunc(blendFunc)}}),node},parser.widgetAttributes=function(widget,json,enableContent){widget.setCascadeColorEnabled(!0),widget.setCascadeOpacityEnabled(!0),widget.setUnifySizeEnabled(!1),widget.ignoreContentAdaptWithSize(!1),!enableContent&&setContentSize(widget,json.Size);var name=json.Name;name&&widget.setName(name);var actionTag=json.ActionTag||0;widget.setActionTag(actionTag);var extensionData=new ccs.ComExtensionData,customProperty=json.UserData;void 0!==customProperty&&extensionData.setCustomProperty(customProperty),extensionData.setActionTag(actionTag),widget.getComponent("ComExtensionData")&&widget.removeComponent("ComExtensionData"),widget.addComponent(extensionData);var rotationSkewX=json.RotationSkewX;rotationSkewX&&widget.setRotationX(rotationSkewX);var rotationSkewY=json.RotationSkewY;rotationSkewY&&widget.setRotationY(rotationSkewY),json.FlipX&&widget.setFlippedX(!0),json.FlipY&&widget.setFlippedY(!0);var zOrder=json.zOrder;null!=zOrder&&widget.setLocalZOrder(zOrder);var visible=getParam(json.VisibleForFrame,!0);widget.setVisible(visible);var alpha=json.Alpha;null!=alpha&&widget.setOpacity(alpha),widget.setTag(json.Tag||0);var touchEnabled=json.TouchEnable||!1;widget.setTouchEnabled(touchEnabled);var callBackType=json.CallBackType;null!=callBackType&&widget.setCallbackType(callBackType);var callBackName=json.CallBackName;callBackName&&widget.setCallbackName(callBackName);var position=json.Position;null!=position&&widget.setPosition(position.X||0,position.Y||0);var scale=json.Scale;if(null!=scale){var scaleX=getParam(scale.ScaleX,1),scaleY=getParam(scale.ScaleY,1);widget.setScaleX(scaleX),widget.setScaleY(scaleY)}var anchorPoint=json.AnchorPoint;null!=anchorPoint&&widget.setAnchorPoint(anchorPoint.ScaleX||0,anchorPoint.ScaleY||0);var color=json.CColor;null!=color&&widget.setColor(getColor(color)),setLayoutComponent(widget,json),bindCallback(widget,json)};var bindCallback=function(widget,json){var callBackType=json.CallBackType,callBackName=json.CallBackName,callBack=function(e){"function"==typeof widget[callBackName]&&widget[callBackName](e)};"Click"===callBackType?widget.addClickEventListener(callBack):"Touch"===callBackType?widget.addTouchEventListener(callBack):"Event"===callBackType&&widget.addCCSEventListener(callBack)},setLayoutComponent=function(widget,json){var layoutComponent=ccui.LayoutComponent.bindLayoutComponent(widget);if(layoutComponent){var positionXPercentEnabled=json.PositionPercentXEnable||json.PositionPercentXEnabled||!1,positionYPercentEnabled=json.PositionPercentYEnable||json.PositionPercentYEnabled||!1,positionXPercent=0,positionYPercent=0,PrePosition=json.PrePosition;null!=PrePosition&&(positionXPercent=PrePosition.X||0,positionYPercent=PrePosition.Y||0);var sizeXPercentEnable=json.PercentWidthEnable||json.PercentWidthEnabled||!1,sizeYPercentEnable=json.PercentHeightEnable||json.PercentHeightEnabled||!1,sizeXPercent=0,sizeYPercent=0,PreSize=json.PreSize;null!=PrePosition&&(sizeXPercent=PreSize.X||0,sizeYPercent=PreSize.Y||0);var stretchHorizontalEnabled=json.StretchWidthEnable||!1,stretchVerticalEnabled=json.StretchHeightEnable||!1,horizontalEdge=json.HorizontalEdge,verticalEdge=json.VerticalEdge,leftMargin=json.LeftMargin||0,rightMargin=json.RightMargin||0,topMargin=json.TopMargin||0,bottomMargin=json.BottomMargin||0;layoutComponent.setPositionPercentXEnabled(positionXPercentEnabled),layoutComponent.setPositionPercentYEnabled(positionYPercentEnabled),layoutComponent.setPositionPercentX(positionXPercent),layoutComponent.setPositionPercentY(positionYPercent),layoutComponent.setPercentWidthEnabled(sizeXPercentEnable),layoutComponent.setPercentHeightEnabled(sizeYPercentEnable),layoutComponent.setPercentWidth(sizeXPercent),layoutComponent.setPercentHeight(sizeYPercent),layoutComponent.setPercentWidthEnabled(sizeXPercentEnable||sizeYPercentEnable),layoutComponent.setStretchWidthEnabled(stretchHorizontalEnabled),layoutComponent.setStretchHeightEnabled(stretchVerticalEnabled);var horizontalEdgeType=ccui.LayoutComponent.horizontalEdge.NONE;"LeftEdge"===horizontalEdge?horizontalEdgeType=ccui.LayoutComponent.horizontalEdge.LEFT:"RightEdge"===horizontalEdge?horizontalEdgeType=ccui.LayoutComponent.horizontalEdge.RIGHT:"BothEdge"===horizontalEdge&&(horizontalEdgeType=ccui.LayoutComponent.horizontalEdge.CENTER),layoutComponent.setHorizontalEdge(horizontalEdgeType);var verticalEdgeType=ccui.LayoutComponent.verticalEdge.NONE;"TopEdge"===verticalEdge?verticalEdgeType=ccui.LayoutComponent.verticalEdge.TOP:"BottomEdge"===verticalEdge?verticalEdgeType=ccui.LayoutComponent.verticalEdge.BOTTOM:"BothEdge"===verticalEdge&&(verticalEdgeType=ccui.LayoutComponent.verticalEdge.CENTER),layoutComponent.setVerticalEdge(verticalEdgeType),layoutComponent.setTopMargin(topMargin),layoutComponent.setBottomMargin(bottomMargin),layoutComponent.setLeftMargin(leftMargin),layoutComponent.setRightMargin(rightMargin),layoutComponent.setVerticalEdge(verticalEdgeType),layoutComponent.setTopMargin(topMargin),layoutComponent.setBottomMargin(bottomMargin),layoutComponent.setLeftMargin(leftMargin),layoutComponent.setRightMargin(rightMargin)}},setLayoutBackground=function(layout,single,first,end){2===layout.getBackGroundColorType()?(first=first||{},end=end||{},layout.setBackGroundColor(getColor(first),getColor(end))):(single=single||{},layout.setBackGroundColor(getColor(single)))},setLayoutBackgroundVector=function(widget,vector){var x=vector.ScaleX||0,y=vector.ScaleY||0;widget.setBackGroundColorVector(cc.p(x,y))};parser.initPanel=function(json,resourcePath){var widget=new ccui.Layout;this.widgetAttributes(widget,json);var clipEnabled=json.ClipAble||!1;null!=clipEnabled&&widget.setClippingEnabled(clipEnabled);var colorType=getParam(json.ComboBoxIndex,0);widget.setBackGroundColorType(colorType);var bgColorOpacity=getParam(json.BackColorAlpha,255);null!=bgColorOpacity&&widget.setBackGroundColorOpacity(bgColorOpacity);var backGroundScale9Enabled=json.Scale9Enable;null!=backGroundScale9Enabled&&widget.setBackGroundImageScale9Enabled(backGroundScale9Enabled);var opacity=getParam(json.Alpha,255);if(widget.setOpacity(opacity),loadTexture(json.FileData,resourcePath,function(path,type){widget.setBackGroundImage(path,type)}),backGroundScale9Enabled){var scale9OriginX=json.Scale9OriginX||0,scale9OriginY=json.Scale9OriginY||0,scale9Width=json.Scale9Width||0,scale9Height=json.Scale9Height||0;widget.setBackGroundImageCapInsets(cc.rect(scale9OriginX,scale9OriginY,scale9Width,scale9Height)),setContentSize(widget,json.Size)}else widget.isIgnoreContentAdaptWithSize()||setContentSize(widget,json.Size);return setLayoutBackground(widget,json.SingleColor,json.FirstColor,json.EndColor),setLayoutBackgroundVector(widget,json.ColorVector),widget},parser.initText=function(json,resourcePath){var widget=new ccui.Text,touchScaleEnabled=json.TouchScaleChangeAble;null!=touchScaleEnabled&&widget.setTouchScaleChangeEnabled(touchScaleEnabled);var text=json.LabelText;null!=text&&widget.setString(text);var fontSize=json.FontSize;null!=fontSize&&widget.setFontSize(fontSize);var fontName=json.FontName;null!=fontName&&widget.setFontName(fontName);var areaWidth=json.AreaWidth,areaHeight=json.areaHeight;areaWidth&&areaHeight&&widget.setTextAreaSize(cc.size(areaWidth,areaHeight));var h_alignment=json.HorizontalAlignmentType||"HT_Left";switch(h_alignment){case"HT_Right":h_alignment=2;break;case"HT_Center":h_alignment=1;break;case"HT_Left":default:h_alignment=0}widget.setTextHorizontalAlignment(h_alignment);var v_alignment=json.VerticalAlignmentType||"VT_Top";switch(v_alignment){case"VT_Bottom":v_alignment=2;break;case"VT_Center":v_alignment=1;break;case"VT_Top":default:v_alignment=0}widget.setTextVerticalAlignment(v_alignment);var fontResource=json.FontResource;if(null!=fontResource){var path=fontResource.Path;null!=path&&(fontName=cc.sys.isNative?cc.path.join(cc.loader.resPath,resourcePath,path):(fontName=path.match(/([^\/]+)\.(\S+)/))?fontName[1]:"",widget.setFontName(fontName))}json.OutlineEnabled&&json.OutlineColor&&widget.enableOutline&&widget.enableOutline(getColor(json.OutlineColor),getParam(json.OutlineSize,1)),json.ShadowEnabled&&json.ShadowColor&&widget.enableShadow&&widget.enableShadow(getColor(json.ShadowColor),cc.size(getParam(json.ShadowOffsetX,2),getParam(json.ShadowOffsetY,-2)),json.ShadowBlurRadius||0);var isCustomSize=json.IsCustomSize;null!=isCustomSize&&widget.ignoreContentAdaptWithSize(!isCustomSize),widget.setUnifySizeEnabled(!1);var color=json.CColor;return json.CColor=null,widget.setTextColor(getColor(color)),this.widgetAttributes(widget,json,widget.isIgnoreContentAdaptWithSize()),json.CColor=color,widget},parser.initButton=function(json,resourcePath){var widget=new ccui.Button;loadTexture(json.NormalFileData,resourcePath,function(path,type){widget.loadTextureNormal(path,type)}),loadTexture(json.PressedFileData,resourcePath,function(path,type){widget.loadTexturePressed(path,type)}),loadTexture(json.DisabledFileData,resourcePath,function(path,type){widget.loadTextureDisabled(path,type)});var scale9Enabled=getParam(json.Scale9Enable,!1);scale9Enabled&&widget.setScale9Enabled(scale9Enabled);var text=json.ButtonText;null!=text&&widget.setTitleText(text);var fontSize=json.FontSize;null!=fontSize&&widget.setTitleFontSize(fontSize);var fontName=json.FontName;null!=fontName&&widget.setTitleFontName(fontName);var textColor=json.TextColor;null!=textColor&&widget.setTitleColor(getColor(textColor));var displaystate=getParam(json.DisplayState,!0);widget.setBright(displaystate),widget.setEnabled(displaystate);var fontResource=json.FontResource;if(null!=fontResource){var path=fontResource.Path;null!=path&&(fontName=cc.sys.isNative?cc.path.join(cc.loader.resPath,resourcePath,path):(fontName=path.match(/([^\/]+)\.(\S+)/))?fontName[1]:"",widget.setTitleFontName(fontName))}var label=widget.getTitleRenderer();if(label&&json.ShadowEnabled&&json.ShadowColor&&label.enableShadow&&label.enableShadow(getColor(json.ShadowColor),cc.size(getParam(json.ShadowOffsetX,2),getParam(json.ShadowOffsetY,-2)),json.ShadowBlurRadius||0),label&&json.OutlineEnabled&&json.OutlineColor&&label.enableStroke&&label.enableStroke(getColor(json.OutlineColor),getParam(json.OutlineSize,1)),this.widgetAttributes(widget,json),scale9Enabled){widget.setUnifySizeEnabled(!1),widget.ignoreContentAdaptWithSize(!1);var capInsets=cc.rect(json.Scale9OriginX||0,json.Scale9OriginY||0,json.Scale9Width||0,json.Scale9Height||0);widget.setCapInsets(capInsets)}return setContentSize(widget,json.Size),widget},parser.initCheckBox=function(json,resourcePath){var widget=new ccui.CheckBox;this.widgetAttributes(widget,json),[{name:"NormalBackFileData",handle:widget.loadTextureBackGround},{name:"PressedBackFileData",handle:widget.loadTextureBackGroundSelected},{name:"NodeNormalFileData",handle:widget.loadTextureFrontCross},{name:"DisableBackFileData",handle:widget.loadTextureBackGroundDisabled},{name:"NodeDisableFileData",handle:widget.loadTextureFrontCrossDisabled}].forEach(function(item){loadTexture(json[item.name],resourcePath,function(path,type){item.handle.call(widget,path,type)})});var selectedState=getParam(json.CheckedState,!1);widget.setSelected(selectedState);var displaystate=getParam(json.DisplayState,!0);return widget.setBright(displaystate),widget.setEnabled(displaystate),widget},parser.initScrollView=function(json,resourcePath){var widget=new ccui.ScrollView;this.widgetAttributes(widget,json),loadTexture(json.FileData,resourcePath,function(path,type){widget.setBackGroundImage(path,type)});var clipEnabled=json.ClipAble||!1;widget.setClippingEnabled(clipEnabled);var colorType=getParam(json.ComboBoxIndex,0);widget.setBackGroundColorType(colorType);var bgColorOpacity=json.BackColorAlpha;if(null!=bgColorOpacity&&widget.setBackGroundColorOpacity(bgColorOpacity),json.Scale9Enable){widget.setBackGroundImageScale9Enabled(!0);var scale9OriginX=json.Scale9OriginX||0,scale9OriginY=json.Scale9OriginY||0,scale9Width=json.Scale9Width||0,scale9Height=json.Scale9Height||0;widget.setBackGroundImageCapInsets(cc.rect(scale9OriginX,scale9OriginY,scale9Width,scale9Height)),setContentSize(widget,json.Size)}else widget.isIgnoreContentAdaptWithSize()||setContentSize(widget,json.Size);setLayoutBackground(widget,json.SingleColor,json.FirstColor,json.EndColor),setLayoutBackgroundVector(widget,json.ColorVector);var innerNodeSize=json.InnerNodeSize,innerSize=cc.size(innerNodeSize.Width||0,innerNodeSize.Height||0);widget.setInnerContainerSize(innerSize);var direction=0;"Vertical"===json.ScrollDirectionType&&(direction=1),"Horizontal"===json.ScrollDirectionType&&(direction=2),"Vertical_Horizontal"===json.ScrollDirectionType&&(direction=3),widget.setDirection(direction);var bounceEnabled=getParam(json.IsBounceEnabled,!1);return widget.setBounceEnabled(bounceEnabled),widget},parser.initImageView=function(json,resourcePath){var widget=new ccui.ImageView;if(loadTexture(json.FileData,resourcePath,function(path,type){widget.loadTexture(path,type)}),loadTexture(json.ImageFileData,resourcePath,function(path,type){widget.loadTexture(path,type)}),json.Scale9Enable){widget.setScale9Enabled(!0),widget.setUnifySizeEnabled(!1),widget.ignoreContentAdaptWithSize(!1);var scale9OriginX=json.Scale9OriginX||0,scale9OriginY=json.Scale9OriginY||0,scale9Width=json.Scale9Width||0,scale9Height=json.Scale9Height||0;widget.setCapInsets(cc.rect(scale9OriginX,scale9OriginY,scale9Width,scale9Height))}else setContentSize(widget,json.Size);return this.widgetAttributes(widget,json),widget},parser.initLoadingBar=function(json,resourcePath){var widget=new ccui.LoadingBar;this.widgetAttributes(widget,json),loadTexture(json.ImageFileData,resourcePath,function(path,type){widget.loadTexture(path,type)});var direction="Right_To_Left"===json.ProgressType?1:0;widget.setDirection(direction);var percent=getParam(json.ProgressInfo,80);return null!=percent&&widget.setPercent(percent),widget},parser.initSlider=function(json,resourcePath){var widget=new ccui.Slider,loader=cc.loader;this.widgetAttributes(widget,json),[{name:"BackGroundData",handle:widget.loadBarTexture},{name:"BallNormalData",handle:widget.loadSlidBallTextureNormal},{name:"BallPressedData",handle:widget.loadSlidBallTexturePressed},{name:"BallDisabledData",handle:widget.loadSlidBallTextureDisabled},{name:"ProgressBarData",handle:widget.loadProgressBarTexture}].forEach(function(item){loadTexture(json[item.name],resourcePath,function(path,type){0!==type||loader.getRes(path)||cc.log("%s need to be preloaded",path),item.handle.call(widget,path,type)})});var percent=json.PercentInfo||0;widget.setPercent(percent);var displaystate=getParam(json.DisplayState,!0);return widget.setBright(displaystate),widget.setEnabled(displaystate),widget},parser.initPageView=function(json,resourcePath){var widget=new ccui.PageView;this.widgetAttributes(widget,json),loadTexture(json.FileData,resourcePath,function(path,type){widget.setBackGroundImage(path,type)});var clipEnabled=json.ClipAble||!1;if(widget.setClippingEnabled(clipEnabled),json.Scale9Enable){widget.setBackGroundImageScale9Enabled(!0);var scale9OriginX=json.Scale9OriginX||0,scale9OriginY=json.Scale9OriginY||0,scale9Width=json.Scale9Width||0,scale9Height=json.Scale9Height||0;widget.setBackGroundImageCapInsets(cc.rect(scale9OriginX,scale9OriginY,scale9Width,scale9Height))}var colorType=getParam(json.ComboBoxIndex,0);widget.setBackGroundColorType(colorType),setLayoutBackground(widget,json.SingleColor,json.FirstColor,json.EndColor),setLayoutBackgroundVector(widget,json.ColorVector);var bgColorOpacity=json.BackColorAlpha;return null!=bgColorOpacity&&widget.setBackGroundColorOpacity(bgColorOpacity),setContentSize(widget,json.Size),widget},parser.initListView=function(json,resourcePath){var widget=new ccui.ListView;this.widgetAttributes(widget,json),loadTexture(json.FileData,resourcePath,function(path,type){widget.setBackGroundImage(path,type)});var clipEnabled=json.ClipAble||!1;widget.setClippingEnabled(clipEnabled);var colorType=getParam(json.ComboBoxIndex,0);widget.setBackGroundColorType(colorType);var bgColorOpacity=getParam(json.BackColorAlpha,255);if(json.Scale9Enable){widget.setBackGroundImageScale9Enabled(!0);var scale9OriginX=json.Scale9OriginX||0,scale9OriginY=json.Scale9OriginY||0,scale9Width=json.Scale9Width||0,scale9Height=json.Scale9Height||0;widget.setBackGroundImageCapInsets(cc.rect(scale9OriginX,scale9OriginY,scale9Width,scale9Height))}var directionType=getParam(json.DirectionType,ccui.ListView.DIR_HORIZONTAL),verticalType=getParam(json.VerticalType,"Align_Left"),horizontalType=getParam(json.HorizontalType,"Align_Top");directionType?"Vertical"===directionType&&(widget.setDirection(ccui.ScrollView.DIR_VERTICAL),""===horizontalType?widget.setGravity(ccui.ListView.GRAVITY_LEFT):"Align_Right"===horizontalType?widget.setGravity(ccui.ListView.GRAVITY_RIGHT):"Align_HorizontalCenter"===horizontalType&&widget.setGravity(ccui.ListView.GRAVITY_CENTER_HORIZONTAL)):(widget.setDirection(ccui.ScrollView.DIR_HORIZONTAL),"Align_Bottom"===verticalType?widget.setGravity(ccui.ListView.GRAVITY_BOTTOM):"Align_VerticalCenter"===verticalType?widget.setGravity(ccui.ListView.GRAVITY_CENTER_VERTICAL):widget.setGravity(ccui.ListView.GRAVITY_TOP));var bounceEnabled=getParam(json.IsBounceEnabled,!1);widget.setBounceEnabled(bounceEnabled);var itemMargin=json.ItemMargin||0;widget.setItemsMargin(itemMargin);var innerSize=json.InnerNodeSize;return null!=innerSize&&widget.setInnerContainerSize(cc.size(innerSize.Widget||0,innerSize.Height||0)),setLayoutBackground(widget,json.SingleColor,json.FirstColor,json.EndColor),setLayoutBackgroundVector(widget,json.ColorVector),null!=bgColorOpacity&&widget.setBackGroundColorOpacity(bgColorOpacity),setContentSize(widget,json.Size),widget},parser.initTextAtlas=function(json,resourcePath){var widget=new ccui.TextAtlas,stringValue=json.LabelText,itemWidth=json.CharWidth,itemHeight=json.CharHeight,startCharMap=json.StartChar;return loadTexture(json.LabelAtlasFileImage_CNB,resourcePath,function(path,type){cc.loader.getRes(path)||cc.log("%s need to be preloaded",path),0===type&&widget.setProperty(stringValue,path,itemWidth,itemHeight,startCharMap)}),this.widgetAttributes(widget,json),widget.ignoreContentAdaptWithSize(!0),widget},parser.initTextBMFont=function(json,resourcePath){var widget=new ccui.TextBMFont;this.widgetAttributes(widget,json);var text=json.LabelText;return widget.setString(text),loadTexture(json.LabelBMFontFile_CNB,resourcePath,function(path,type){cc.loader.getRes(path)||cc.log("%s need to be pre loaded",path),widget.setFntFile(path)}),widget.ignoreContentAdaptWithSize(!0),widget},parser.initTextField=function(json,resourcePath){var widget=new ccui.TextField;if(json.PasswordEnable){widget.setPasswordEnabled(!0);var passwordStyleText=json.PasswordStyleText||"*";widget.setPasswordStyleText(passwordStyleText)}var placeHolder=json.PlaceHolderText;null!=placeHolder&&widget.setPlaceHolder(placeHolder);var fontSize=json.FontSize;null!=fontSize&&widget.setFontSize(fontSize);var fontName=json.FontName;if(null!=fontName&&widget.setFontName(fontName),json.MaxLengthEnable){widget.setMaxLengthEnabled(!0);var maxLength=json.MaxLengthText||0;widget.setMaxLength(maxLength)}this.widgetAttributes(widget,json);var text=json.LabelText;null!=text&&widget.setString(text);var fontResource=json.FontResource;if(null!=fontResource){var path=fontResource.Path;null!=path&&(fontName=cc.sys.isNative?cc.path.join(cc.loader.resPath,resourcePath,path):(fontName=path.match(/([^\/]+)\.(\S+)/))?fontName[1]:"",widget.setFontName(fontName))}widget.setUnifySizeEnabled(!1),widget.ignoreContentAdaptWithSize(!1);var color=json.CColor;return null!=color&&widget.setTextColor(getColor(color)),widget.isIgnoreContentAdaptWithSize()||(setContentSize(widget,json.Size),cc.sys.isNative&&widget.getVirtualRenderer().setLineBreakWithoutSpace(!0)),widget},parser.initSimpleAudio=function(json,resourcePath){var node=new ccs.ComAudio,loop=json.Loop||!1;node.setLoop(loop),loadTexture(json.FileData,resourcePath,function(path,type){node.setFile(path)})},parser.initGameMap=function(json,resourcePath){var node=null;return loadTexture(json.FileData,resourcePath,function(path,type){0===type&&(node=new cc.TMXTiledMap(path)),parser.generalAttributes(node,json)}),node},parser.initProjectNode=function(json,resourcePath){var projectFile=json.FileData;if(null!=projectFile&&projectFile.Path){var file=resourcePath+projectFile.Path;if(cc.loader.getRes(file)){var obj=ccs.load(file,resourcePath);if(parser.generalAttributes(obj.node,json),obj.action&&obj.node){obj.action.tag=obj.node.tag;var InnerActionSpeed=json.InnerActionSpeed;void 0!==InnerActionSpeed&&obj.action.setTimeSpeed(InnerActionSpeed),obj.node.runAction(obj.action),obj.action.gotoFrameAndPause(0)}return obj.node}cc.log("%s need to be preloaded",file)}};var getFileName=function(name){if(!name)return"";var arr=name.match(/([^\/]+)\.[^\/]+$/);return arr&&arr[1]?arr[1]:""};parser.initArmature=function(json,resourcePath){var node=new ccs.Armature,isLoop=json.IsLoop,isAutoPlay=json.IsAutoPlay,currentAnimationName=json.CurrentAnimationName;return loadTexture(json.FileData,resourcePath,function(path,type){var plists,pngs,armJson=cc.loader.getRes(path);armJson?(plists=armJson.config_file_path,pngs=armJson.config_png_path,plists.forEach(function(plist,index){pngs[index]&&cc.spriteFrameCache.addSpriteFrames(plist,pngs[index])})):cc.log("%s need to be preloaded",path),ccs.armatureDataManager.addArmatureFileInfo(path),node.init(getFileName(path)),isAutoPlay?node.getAnimation().play(currentAnimationName,-1,isLoop):(node.getAnimation().play(currentAnimationName),node.getAnimation().gotoAndPause(0))}),delete json.AnchorPoint,delete json.Size,parser.generalAttributes(node,json),node.setColor(getColor(json.CColor)),node},parser.initBoneNode=function(json,resourcePath){var node=new ccs.BoneNode,length=json.Length;void 0!==length&&node.setDebugDrawLength(length);var blendFunc=json.BlendFunc;blendFunc&&void 0!==blendFunc.Src&&void 0!==blendFunc.Dst&&node.setBlendFunc(new cc.BlendFunc(blendFunc.Src,blendFunc.Dst)),parser.generalAttributes(node,json);var color=json.CColor;return!color||void 0===color.R&&void 0===color.G&&void 0===color.B||node.setColor(getColor(color)),node},parser.initSkeletonNode=function(json){var node=new ccs.SkeletonNode;parser.generalAttributes(node,json);var color=json.CColor;return!color||void 0===color.R&&void 0===color.G&&void 0===color.B||node.setColor(getColor(color)),node};var loadedPlist={},loadTexture=function(json,resourcePath,cb){if(null!=json){var type,path=json.Path;type="Default"===json.Type||"Normal"===json.Type?0:1;var plist=json.Plist;plist&&(cc.loader.getRes(resourcePath+plist)?(loadedPlist[resourcePath+plist]=!0,cc.spriteFrameCache.addSpriteFrames(resourcePath+plist)):loadedPlist[resourcePath+plist]||cc.spriteFrameCache.getSpriteFrame(path)||cc.log("%s need to be preloaded",resourcePath+plist)),0!==type?cc.spriteFrameCache.getSpriteFrame(path)?cb(path,type):cc.log("failed to get spriteFrame: %s",path):cb(resourcePath+path,type)}},getColor=function(json){if(json){var r=null!=json.R?json.R:255,g=null!=json.G?json.G:255,b=null!=json.B?json.B:255,a=null!=json.A?json.A:255;return cc.color(r,g,b,a)}},setContentSize=function(node,size){var x=size.X||0,y=size.Y||0;size&&node.setContentSize(cc.size(x,y))};[{name:"SingleNodeObjectData",handle:parser.initSingleNode},{name:"NodeObjectData",handle:parser.initSingleNode},{name:"LayerObjectData",handle:parser.initSingleNode},{name:"GameNodeObjectData",handle:parser.initSingleNode},{name:"GameLayerObjectData",handle:parser.initSingleNode},{name:"SpriteObjectData",handle:parser.initSprite},{name:"ParticleObjectData",handle:parser.initParticle},{name:"PanelObjectData",handle:parser.initPanel},{name:"TextObjectData",handle:parser.initText},{name:"ButtonObjectData",handle:parser.initButton},{name:"CheckBoxObjectData",handle:parser.initCheckBox},{name:"ScrollViewObjectData",handle:parser.initScrollView},{name:"ImageViewObjectData",handle:parser.initImageView},{name:"LoadingBarObjectData",handle:parser.initLoadingBar},{name:"SliderObjectData",handle:parser.initSlider},{name:"PageViewObjectData",handle:parser.initPageView},{name:"ListViewObjectData",handle:parser.initListView},{name:"TextAtlasObjectData",handle:parser.initTextAtlas},{name:"TextBMFontObjectData",handle:parser.initTextBMFont},{name:"TextFieldObjectData",handle:parser.initTextField},{name:"SimpleAudioObjectData",handle:parser.initSimpleAudio},{name:"GameMapObjectData",handle:parser.initGameMap},{name:"ProjectNodeObjectData",handle:parser.initProjectNode},{name:"ArmatureNodeObjectData",handle:parser.initArmature},{name:"BoneNodeObjectData",handle:parser.initBoneNode},{name:"SkeletonNodeObjectData",handle:parser.initSkeletonNode}].forEach(function(item){parser.registerParser(item.name,function(options,resourcePath){var node=item.handle.call(this,options,resourcePath);return this.parseChild(node,options.Children,resourcePath),node})}),load.registerParser("timeline","2.*",parser),load.registerParser("timeline","*",parser)}(ccs._load),function(){ccs.uiReader={_fileDesignSizes:{},widgetFromJsonFile:function(file){var json=cc.loader.getRes(file);json&&(this._fileDesignSizes[file]=cc.size(json.designWidth||0,json.designHeight||0));var version=json.Version||json.version,versionNum=ccs.uiReader.getVersionInteger(version);return!version||versionNum>=1700?(cc.warn("Not supported file types, Please try use the ccs.load"),null):ccs._load(file,"ccui")},registerTypeAndCallBack:function(classType,ins,object,callback){var parser=ccs._load.getParser("ccui")["*"],func=callback.bind(object);parser.registerParser(classType,function(options,resourcePath){var widget=new ins,uiOptions=options.options;object.setPropsFromJsonDictionary&&object.setPropsFromJsonDictionary(widget,uiOptions),this.generalAttributes(widget,uiOptions);var customProperty=uiOptions.customProperty;return customProperty=customProperty?JSON.parse(customProperty):{},func(classType,widget,customProperty),this.colorAttributes(widget,uiOptions),this.anchorPointAttributes(widget,uiOptions),this.parseChild.call(this,widget,options,resourcePath),widget})},getVersionInteger:function(version){if(!version||"string"!=typeof version)return 0;var arr=version.split(".");if(4!==arr.length)return 0;var num=0;return arr.forEach(function(n,i){num+=n*Math.pow(10,3-i)}),num},storeFileDesignSize:function(fileName,size){this._fileDesignSizes[fileName]=size},getFileDesignSize:function(fileName){return this._fileDesignSizes[fileName]},getFilePath:function(){return this._filePath},setFilePath:function(path){this._filePath=path},getParseObjectMap:function(){return ccs._load.getParser("ccui")["*"].parsers},getParseCallBackMap:function(){return ccs._load.getParser("ccui")["*"].parsers},clear:function(){}};var parser=ccs._load.getParser("ccui")["*"];ccs.imageViewReader={setPropsFromJsonDictionary:parser.ImageViewAttributes},ccs.buttonReader={setPropsFromJsonDictionary:parser.ButtonAttributes},ccs.checkBoxReader={setPropsFromJsonDictionary:parser.CheckBoxAttributes},ccs.labelAtlasReader={setPropsFromJsonDictionary:parser.TextAtlasAttributes},ccs.labelBMFontReader={setPropsFromJsonDictionary:parser.TextBMFontAttributes},ccs.labelReader={setPropsFromJsonDictionary:parser.TextAttributes},ccs.layoutReader={setPropsFromJsonDictionary:parser.LayoutAttributes},ccs.listViewReader={setPropsFromJsonDictionary:parser.ListViewAttributes},ccs.loadingBarReader={setPropsFromJsonDictionary:parser.LoadingBarAttributes},ccs.pageViewReader={setPropsFromJsonDictionary:parser.PageViewAttributes},ccs.scrollViewReader={setPropsFromJsonDictionary:parser.ScrollViewAttributes},ccs.sliderReader={setPropsFromJsonDictionary:parser.SliderAttributes},ccs.textFieldReader={setPropsFromJsonDictionary:parser.TextFieldAttributes}}(),ccs.sceneReader={_node:null,createNodeWithSceneFile:function(file){var node=ccs._load(file,"scene");return this._node=node,node},getNodeByTag:function(tag){return null==this._node?null:this._node.getTag()===tag?this._node:this._nodeByTag(this._node,tag)},_nodeByTag:function(parent,tag){if(null==parent)return null;for(var retNode=null,children=parent.getChildren(),i=0;i<children.length;i++){var child=children[i];if(child&&child.getTag()===tag){retNode=child;break}if(retNode=this._nodeByTag(child,tag))break}return retNode},version:function(){return"*"},setTarget:function(){},clear:function(){ccs.triggerManager.removeAll(),cc.audioEngine.end()}};