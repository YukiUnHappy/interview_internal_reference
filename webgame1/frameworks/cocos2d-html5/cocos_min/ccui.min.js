cc.ProtectedNode=cc.Node.extend({_protectedChildren:null,_reorderProtectedChildDirty:!1,_insertProtectedChild:function(child,z){this._reorderProtectedChildDirty=!0,this._protectedChildren.push(child),child._setLocalZOrder(z)},ctor:function(){cc.Node.prototype.ctor.call(this),this._protectedChildren=[]},visit:function(parent){if(this._visible){var i,child,j,pChild,renderer=cc.renderer,cmd=this._renderCmd,children=this._children,len=children.length,pChildren=this._protectedChildren,pLen=pChildren.length;cmd.visit(parent&&parent._renderCmd);var locGrid=this.grid;for(locGrid&&locGrid._active&&locGrid.beforeDraw(),this._reorderChildDirty&&this.sortAllChildren(),this._reorderProtectedChildDirty&&this.sortAllProtectedChildren(),i=0;i<len&&(child=children[i])._localZOrder<0;i++)child.visit(this);for(j=0;j<pLen&&((pChild=pChildren[j])&&pChild._localZOrder<0);j++)cmd._changeProtectedChild(pChild),pChild.visit(this);for(renderer.pushRenderCommand(cmd);i<len;i++)children[i].visit(this);for(;j<pLen;j++)(pChild=pChildren[j])&&(cmd._changeProtectedChild(pChild),pChild.visit(this));locGrid&&locGrid._active&&locGrid.afterDraw(this),cmd._dirtyFlag=0}},addProtectedChild:function(child,localZOrder,tag){cc.assert(null!=child,"child must be non-nil"),cc.assert(!child.parent,"child already added. It can't be added again"),localZOrder=localZOrder||child.getLocalZOrder(),tag&&child.setTag(tag),this._insertProtectedChild(child,localZOrder),child.setParent(this),child.setOrderOfArrival(cc.s_globalOrderOfArrival),this._running&&(child._performRecursive(cc.Node._stateCallbackType.onEnter),this._isTransitionFinished&&child._performRecursive(cc.Node._stateCallbackType.onEnterTransitionDidFinish)),this._cascadeColorEnabled&&this._renderCmd.setCascadeColorEnabledDirty(),this._cascadeOpacityEnabled&&this._renderCmd.setCascadeOpacityEnabledDirty()},getProtectedChildByTag:function(tag){cc.assert(tag!==cc.NODE_TAG_INVALID,"Invalid tag");for(var locChildren=this._protectedChildren,i=0,len=locChildren.length;i<len;i++)if(locChildren.getTag()===tag)return locChildren[i];return null},removeProtectedChild:function(child,cleanup){null==cleanup&&(cleanup=!0);var locChildren=this._protectedChildren;if(0!==locChildren.length){var idx=locChildren.indexOf(child);idx>-1&&(this._running&&(child._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),child._performRecursive(cc.Node._stateCallbackType.onExit)),cleanup&&child._performRecursive(cc.Node._stateCallbackType.cleanup),child.setParent(null),locChildren.splice(idx,1))}},removeProtectedChildByTag:function(tag,cleanup){cc.assert(tag!==cc.NODE_TAG_INVALID,"Invalid tag"),null==cleanup&&(cleanup=!0);var child=this.getProtectedChildByTag(tag);null==child?cc.log("cocos2d: removeChildByTag(tag = %d): child not found!",tag):this.removeProtectedChild(child,cleanup)},removeAllProtectedChildren:function(){this.removeAllProtectedChildrenWithCleanup(!0)},removeAllProtectedChildrenWithCleanup:function(cleanup){null==cleanup&&(cleanup=!0);for(var locChildren=this._protectedChildren,i=0,len=locChildren.length;i<len;i++){var child=locChildren[i];this._running&&(child._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),child._performRecursive(cc.Node._stateCallbackType.onExit)),cleanup&&child._performRecursive(cc.Node._stateCallbackType.cleanup),child.setParent(null)}locChildren.length=0},reorderProtectedChild:function(child,localZOrder){cc.assert(null!=child,"Child must be non-nil"),this._reorderProtectedChildDirty=!0,child.setOrderOfArrival(cc.s_globalOrderOfArrival++),child._setLocalZOrder(localZOrder)},sortAllProtectedChildren:function(){if(this._reorderProtectedChildDirty){var i,j,tmp,_children=this._protectedChildren,len=_children.length;for(i=1;i<len;i++){for(tmp=_children[i],j=i-1;j>=0;){if(tmp._localZOrder<_children[j]._localZOrder)_children[j+1]=_children[j];else{if(!(tmp._localZOrder===_children[j]._localZOrder&&tmp.arrivalOrder<_children[j].arrivalOrder))break;_children[j+1]=_children[j]}j--}_children[j+1]=tmp}this._reorderProtectedChildDirty=!1}},_changePosition:function(){},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ProtectedNode.CanvasRenderCmd(this):new cc.ProtectedNode.WebGLRenderCmd(this)}}),cc.ProtectedNode.create=function(){return new cc.ProtectedNode},function(){cc.ProtectedNode.RenderCmd={_updateDisplayColor:function(parentColor){var i,len,selChildren,item,node=this._node,locDispColor=this._displayedColor,locRealColor=node._realColor;if(this._cascadeColorEnabledDirty&&!node._cascadeColorEnabled){locDispColor.r=locRealColor.r,locDispColor.g=locRealColor.g,locDispColor.b=locRealColor.b;var whiteColor=new cc.Color(255,255,255,255);for(i=0,len=(selChildren=node._children).length;i<len;i++)(item=selChildren[i])&&item._renderCmd&&item._renderCmd._updateDisplayColor(whiteColor);this._cascadeColorEnabledDirty=!1}else{if(void 0===parentColor){var locParent=node._parent;parentColor=locParent&&locParent._cascadeColorEnabled?locParent.getDisplayedColor():cc.color.WHITE}if(locDispColor.r=0|locRealColor.r*parentColor.r/255,locDispColor.g=0|locRealColor.g*parentColor.g/255,locDispColor.b=0|locRealColor.b*parentColor.b/255,node._cascadeColorEnabled)for(i=0,len=(selChildren=node._children).length;i<len;i++)(item=selChildren[i])&&item._renderCmd&&(item._renderCmd._updateDisplayColor(locDispColor),item._renderCmd._updateColor());for(i=0,len=(selChildren=node._protectedChildren).length;i<len;i++)(item=selChildren[i])&&item._renderCmd&&(item._renderCmd._updateDisplayColor(locDispColor),item._renderCmd._updateColor())}this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.colorDirty^this._dirtyFlag},_updateDisplayOpacity:function(parentOpacity){var i,len,selChildren,item,node=this._node;if(this._cascadeOpacityEnabledDirty&&!node._cascadeOpacityEnabled){for(this._displayedOpacity=node._realOpacity,i=0,len=(selChildren=node._children).length;i<len;i++)(item=selChildren[i])&&item._renderCmd&&item._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else{if(void 0===parentOpacity){var locParent=node._parent;parentOpacity=255,locParent&&locParent._cascadeOpacityEnabled&&(parentOpacity=locParent.getDisplayedOpacity())}if(this._displayedOpacity=node._realOpacity*parentOpacity/255,node._cascadeOpacityEnabled)for(i=0,len=(selChildren=node._children).length;i<len;i++)(item=selChildren[i])&&item._renderCmd&&(item._renderCmd._updateDisplayOpacity(this._displayedOpacity),item._renderCmd._updateColor());for(i=0,len=(selChildren=node._protectedChildren).length;i<len;i++)(item=selChildren[i])&&item._renderCmd&&(item._renderCmd._updateDisplayOpacity(this._displayedOpacity),item._renderCmd._updateColor())}this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.opacityDirty^this._dirtyFlag},_changeProtectedChild:function(child){var cmd=child._renderCmd,dirty=cmd._dirtyFlag,flags=cc.Node._dirtyFlags;this._dirtyFlag&flags.colorDirty&&(dirty|=flags.colorDirty),this._dirtyFlag&flags.opacityDirty&&(dirty|=flags.opacityDirty);var colorDirty=dirty&flags.colorDirty,opacityDirty=dirty&flags.opacityDirty;colorDirty&&cmd._updateDisplayColor(this._displayedColor),opacityDirty&&cmd._updateDisplayOpacity(this._displayedOpacity),(colorDirty||opacityDirty)&&cmd._updateColor()}},cc.ProtectedNode.CanvasRenderCmd=function(renderable){this._rootCtor(renderable),this._cachedParent=null,this._cacheDirty=!1};var proto=cc.ProtectedNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);cc.inject(cc.ProtectedNode.RenderCmd,proto),proto.constructor=cc.ProtectedNode.CanvasRenderCmd,proto._pNodeCmdCtor=cc.ProtectedNode.CanvasRenderCmd,proto.transform=function(parentCmd,recursive){var node=this._node;node._changePosition&&node._changePosition(),this.originTransform(parentCmd,recursive);var i,len,locChildren=node._protectedChildren;if(recursive&&locChildren&&0!==locChildren.length)for(i=0,len=locChildren.length;i<len;i++)locChildren[i]._renderCmd.transform(this,recursive)},proto.pNodeTransform=proto.transform}(),function(){if(cc.Node.WebGLRenderCmd){cc.ProtectedNode.WebGLRenderCmd=function(renderable){this._rootCtor(renderable)};var proto=cc.ProtectedNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.inject(cc.ProtectedNode.RenderCmd,proto),proto.constructor=cc.ProtectedNode.WebGLRenderCmd,proto._pNodeCmdCtor=cc.ProtectedNode.WebGLRenderCmd,proto.transform=function(parentCmd,recursive){this.originTransform(parentCmd,recursive);var i,len,locChildren=this._node._protectedChildren;if(recursive&&locChildren&&0!==locChildren.length)for(i=0,len=locChildren.length;i<len;i++)locChildren[i]._renderCmd.transform(this,recursive)},proto.pNodeTransform=proto.transform}}();var ccui=ccui||{};ccui.Class=ccui.Class||cc.Class,ccui.Class.extend=ccui.Class.extend||cc.Class.extend,ccui.Node=ccui.Node||cc.Node,ccui.Node.extend=ccui.Node.extend||cc.Node.extend,ccui.ProtectedNode=ccui.ProtectedNode||cc.ProtectedNode,ccui.ProtectedNode.extend=ccui.ProtectedNode.extend||cc.ProtectedNode.extend,ccui.cocosGUIVersion="CocosGUI v1.0.0.0",ccui._FocusNavigationController=cc.Class.extend({_keyboardListener:null,_firstFocusedWidget:null,_enableFocusNavigation:!1,_keyboardEventPriority:1,enableFocusNavigation:function(flag){this._enableFocusNavigation!==flag&&(this._enableFocusNavigation=flag,flag?this._addKeyboardEventListener():this._removeKeyboardEventListener())},_setFirstFocsuedWidget:function(widget){this._firstFocusedWidget=widget},_onKeyPressed:function(keyCode,event){this._enableFocusNavigation&&this._firstFocusedWidget&&(keyCode===cc.KEY.dpadDown&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.DOWN,this._firstFocusedWidget)),keyCode===cc.KEY.dpadUp&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.UP,this._firstFocusedWidget)),keyCode===cc.KEY.dpadLeft&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.LEFT,this._firstFocusedWidget)),keyCode===cc.KEY.dpadRight&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.RIGHT,this._firstFocusedWidget)))},_addKeyboardEventListener:function(){this._keyboardListener||(this._keyboardListener=cc.EventListener.create({event:cc.EventListener.KEYBOARD,onKeyReleased:this._onKeyPressed.bind(this)}),cc.eventManager.addListener(this._keyboardListener,this._keyboardEventPriority))},_removeKeyboardEventListener:function(){this._keyboardListener&&(cc.eventManager.removeEventListener(this._keyboardListener),this._keyboardListener=null)}}),ccui.__LAYOUT_COMPONENT_NAME="__ui_layout";var EXTRA_TAG_IGNORE_TUTORIAL=1;ccui.Widget=ccui.ProtectedNode.extend({_enabled:!0,_bright:!0,_touchEnabled:!1,_brightStyle:null,_touchBeganPosition:null,_touchMovePosition:null,_touchEndPosition:null,_touchEventListener:null,_touchEventSelector:null,_name:"default",_widgetType:null,_actionTag:0,_customSize:null,_layoutParameterDictionary:null,_layoutParameterType:0,_focused:!1,_focusEnabled:!0,_ignoreSize:!1,_affectByClipping:!1,_sizeType:null,_sizePercent:null,_positionType:null,_positionPercent:null,_hit:!1,_nodes:null,_touchListener:null,_className:"Widget",_flippedX:!1,_flippedY:!1,_opacity:255,_highlight:!1,_touchEventCallback:null,_clickEventListener:null,_propagateTouchEvents:!0,_unifySize:!1,_callbackName:null,_callbackType:null,_usingLayoutComponent:!1,_inViewRect:!0,fClicked:!1,_touchSound:"",ctor:function(){cc.ProtectedNode.prototype.ctor.call(this),this._brightStyle=ccui.Widget.BRIGHT_STYLE_NONE,this._touchBeganPosition=cc.p(0,0),this._touchMovePosition=cc.p(0,0),this._touchEndPosition=cc.p(0,0),this._widgetType=ccui.Widget.TYPE_WIDGET,this._customSize=cc.size(0,0),this._layoutParameterDictionary={},this._sizeType=ccui.Widget.SIZE_ABSOLUTE,this._sizePercent=cc.p(0,0),this._positionType=ccui.Widget.POSITION_ABSOLUTE,this._positionPercent=cc.p(0,0),this._nodes=[],this.fClicked=!1,this._touchSound="",this._layoutParameterType=ccui.LayoutParameter.NONE,ccui.Widget.prototype.init.call(this)},init:function(){return this._layoutParameterDictionary={},this._initRenderer(),this.setBright(!0),this.onFocusChanged=this.onFocusChange,this.onNextFocusedWidget=null,this.setAnchorPoint(cc.p(.5,.5)),this.ignoreContentAdaptWithSize(!0),!0},onEnter:function(){var locListener=this._touchListener;locListener&&!locListener._isRegistered()&&this._touchEnabled&&cc.eventManager.addListener(locListener,this),this._usingLayoutComponent||this.updateSizeAndPosition(),this._sizeDirty&&this._onSizeChanged(),cc.ProtectedNode.prototype.onEnter.call(this)},onExit:function(){this.unscheduleUpdate(),cc.ProtectedNode.prototype.onExit.call(this)},_getOrCreateLayoutComponent:function(){var layoutComponent=this.getComponent(ccui.__LAYOUT_COMPONENT_NAME);return null==layoutComponent&&(layoutComponent=new ccui.LayoutComponent,this.addComponent(layoutComponent)),layoutComponent},getWidgetParent:function(){var widget=this.getParent();return widget instanceof ccui.Widget?widget:null},_updateContentSizeWithTextureSize:function(size){this._unifySize?this.setContentSize(size):this.setContentSize(this._ignoreSize?size:this._customSize)},_isAncestorsEnabled:function(){var parentWidget=this._getAncensterWidget(this);return null==parentWidget||!(parentWidget&&!parentWidget.isEnabled())&&parentWidget._isAncestorsEnabled()},setPropagateTouchEvents:function(isPropagate){this._propagateTouchEvents=isPropagate},isPropagateTouchEvents:function(){return this._propagateTouchEvents},setSwallowTouches:function(swallow){this._touchListener&&this._touchListener.setSwallowTouches(swallow)},isSwallowTouches:function(){return!!this._touchListener&&this._touchListener.isSwallowTouches()},_getAncensterWidget:function(node){if(null==node)return null;var parent=node.getParent();return null==parent?null:parent instanceof ccui.Widget?parent:this._getAncensterWidget(parent.getParent())},_isAncestorsVisible:function(node){if(null==node)return!0;var parent=node.getParent();return!(parent&&!parent.isVisible())&&this._isAncestorsVisible(parent)},setEnabled:function(enabled,bright){this._enabled=enabled,void 0==bright&&(bright=enabled),this.setBright(bright)},_initRenderer:function(){},setContentSize:function(contentSize,height){cc.Node.prototype.setContentSize.call(this,contentSize,height);var locWidth=this._contentSize.width,locHeight=this._contentSize.height;if(this._customSize.width=locWidth,this._customSize.height=locHeight,this._unifySize||this._ignoreSize&&(this._contentSize=this.getVirtualRendererSize()),!this._usingLayoutComponent&&this._running){var widgetParent=this.getWidgetParent(),pSize=widgetParent?widgetParent.getContentSize():this._parent.getContentSize();this._sizePercent.x=pSize.width>0?locWidth/pSize.width:0,this._sizePercent.y=pSize.height>0?locHeight/pSize.height:0}this._running?this._onSizeChanged():this._sizeDirty=!0},_setWidth:function(w){if(w!==this._contentSize.width){if(cc.Node.prototype._setWidth.call(this,w),this._customSize.width=w,this._unifySize||this._ignoreSize&&(this._contentSize=this.getVirtualRendererSize()),!this._usingLayoutComponent&&this._running){var widgetParent=this.getWidgetParent(),locWidth=widgetParent?widgetParent.width:this._parent.width;this._sizePercent.x=locWidth>0?this._customSize.width/locWidth:0}this._running?this._onSizeChanged():this._sizeDirty=!0}},_setHeight:function(h){if(h!==this._contentSize.height){if(cc.Node.prototype._setHeight.call(this,h),this._customSize.height=h,this._unifySize||this._ignoreSize&&(this._contentSize=this.getVirtualRendererSize()),!this._usingLayoutComponent&&this._running){var widgetParent=this.getWidgetParent(),locH=widgetParent?widgetParent.height:this._parent.height;this._sizePercent.y=locH>0?this._customSize.height/locH:0}this._running?this._onSizeChanged():this._sizeDirty=!0}},setSizePercent:function(percent){if(this._usingLayoutComponent){var component=this._getOrCreateLayoutComponent();return component.setUsingPercentContentSize(!0),component.setPercentContentSize(percent),void component.refreshLayout()}this._sizePercent.x=percent.x,this._sizePercent.y=percent.y;var width=this._customSize.width,height=this._customSize.height;if(this._running){var widgetParent=this.getWidgetParent();widgetParent?(width=widgetParent.width*percent.x,height=widgetParent.height*percent.y):(width=this._parent.width*percent.x,height=this._parent.height*percent.y)}this._ignoreSize?this.setContentSize(this.getVirtualRendererSize()):this.setContentSize(width,height),this._customSize.width=width,this._customSize.height=height},_setWidthPercent:function(percent){this._sizePercent.x=percent;var width=this._customSize.width;if(this._running){var widgetParent=this.getWidgetParent();width=(widgetParent?widgetParent.width:this._parent.width)*percent}this._ignoreSize?this._setWidth(this.getVirtualRendererSize().width):this._setWidth(width),this._customSize.width=width},_setHeightPercent:function(percent){this._sizePercent.y=percent;var height=this._customSize.height;if(this._running){var widgetParent=this.getWidgetParent();height=(widgetParent?widgetParent.height:this._parent.height)*percent}this._ignoreSize?this._setHeight(this.getVirtualRendererSize().height):this._setHeight(height),this._customSize.height=height},updateSizeAndPosition:function(parentSize){if(!parentSize){var widgetParent=this.getWidgetParent();parentSize=widgetParent?widgetParent.getLayoutSize():this._parent.getContentSize()}switch(this._sizeType){case ccui.Widget.SIZE_ABSOLUTE:this._ignoreSize?this.setContentSize(this.getVirtualRendererSize()):this.setContentSize(this._customSize),this._sizePercent.x=parentSize.width>0?this._customSize.width/parentSize.width:0,this._sizePercent.y=parentSize.height>0?this._customSize.height/parentSize.height:0;break;case ccui.Widget.SIZE_PERCENT:var cSize=cc.size(parentSize.width*this._sizePercent.x,parentSize.height*this._sizePercent.y);this._ignoreSize?this.setContentSize(this.getVirtualRendererSize()):this.setContentSize(cSize),this._customSize.width=cSize.width,this._customSize.height=cSize.height}this._onSizeChanged();var absPos=this.getPosition();switch(this._positionType){case ccui.Widget.POSITION_ABSOLUTE:parentSize.width<=0||parentSize.height<=0?this._positionPercent.x=this._positionPercent.y=0:(this._positionPercent.x=absPos.x/parentSize.width,this._positionPercent.y=absPos.y/parentSize.height);break;case ccui.Widget.POSITION_PERCENT:absPos=cc.p(parentSize.width*this._positionPercent.x,parentSize.height*this._positionPercent.y)}if(this._parent instanceof ccui.ImageView){var renderer=this._parent._imageRenderer;if(renderer&&!renderer._textureLoaded)return}this.setPosition(absPos)},setSizeType:function(type){this._sizeType=type,this._usingLayoutComponent&&this._getOrCreateLayoutComponent().setUsingPercentContentSize(this._sizeType===ccui.SIZE_PERCENT)},getSizeType:function(){return this._sizeType},ignoreContentAdaptWithSize:function(ignore){this._unifySize?this.setContentSize(this._customSize):this._ignoreSize!==ignore&&(this._ignoreSize=ignore,this.setContentSize(ignore?this.getVirtualRendererSize():this._customSize))},isIgnoreContentAdaptWithSize:function(){return this._ignoreSize},getCustomSize:function(){return cc.size(this._customSize)},getLayoutSize:function(){return cc.size(this._contentSize)},getSizePercent:function(){if(this._usingLayoutComponent){var component=this._getOrCreateLayoutComponent();this._sizePercent=component.getPercentContentSize()}return this._sizePercent},_getWidthPercent:function(){return this._sizePercent.x},_getHeightPercent:function(){return this._sizePercent.y},getWorldPosition:function(){return this.convertToWorldSpace(cc.p(this._anchorPoint.x*this._contentSize.width,this._anchorPoint.y*this._contentSize.height))},getVirtualRenderer:function(){return this},getVirtualRendererSize:function(){return cc.size(this._contentSize)},_onSizeChanged:function(){if(!this._usingLayoutComponent){for(var locChildren=this.getChildren(),i=0,len=locChildren.length;i<len;i++){var child=locChildren[i];child instanceof ccui.Widget&&child.updateSizeAndPosition()}this._sizeDirty=!1}},setTouchEnabled:function(enable){this._touchEnabled!==enable&&(this._touchEnabled=enable,this._touchEnabled?(this._touchListener||(this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this)})),cc.eventManager.addListener(this._touchListener,this)):cc.eventManager.removeListener(this._touchListener))},isTouchEnabled:function(){return this._touchEnabled},isHighlighted:function(){return this._highlight},setHighlighted:function(highlight){highlight!==this._highlight&&(this._highlight=highlight,this._bright?this._highlight?this.setBrightStyle(ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT):this.setBrightStyle(ccui.Widget.BRIGHT_STYLE_NORMAL):this._onPressStateChangedToDisabled())},isFocused:function(){return this._focused},setFocused:function(focus){this._focused=focus,focus&&(ccui.Widget._focusedWidget=this,ccui.Widget._focusNavigationController&&ccui.Widget._focusNavigationController._setFirstFocsuedWidget(this))},isFocusEnabled:function(){return this._focusEnabled},setFocusEnabled:function(enable){this._focusEnabled=enable},findNextFocusedWidget:function(direction,current){if(null===this.onNextFocusedWidget||null==this.onNextFocusedWidget(direction)){var isLayout=current instanceof ccui.Layout;if(this.isFocused()||isLayout){var layout=this.getParent();return null!==layout&&layout instanceof ccui.Layout?layout.findNextFocusedWidget(direction,current):isLayout?current.findNextFocusedWidget(direction,current):current}return current}var getFocusWidget=this.onNextFocusedWidget(direction);return this.dispatchFocusEvent(this,getFocusWidget),getFocusWidget},requestFocus:function(){this!==ccui.Widget._focusedWidget&&this.dispatchFocusEvent(ccui.Widget._focusedWidget,this)},getCurrentFocusedWidget:function(){return ccui.Widget._focusedWidget},onFocusChanged:null,onNextFocusedWidget:null,interceptTouchEvent:function(eventType,sender,touch){var widgetParent=this.getWidgetParent();widgetParent&&widgetParent.interceptTouchEvent(eventType,sender,touch)},onFocusChange:function(widgetLostFocus,widgetGetFocus){widgetLostFocus&&widgetLostFocus.setFocused(!1),widgetGetFocus&&widgetGetFocus.setFocused(!0)},dispatchFocusEvent:function(widgetLostFocus,widgetGetFocus){widgetLostFocus&&!widgetLostFocus.isFocused()&&(widgetLostFocus=ccui.Widget._focusedWidget),widgetGetFocus!==widgetLostFocus&&(widgetGetFocus&&widgetGetFocus.onFocusChanged&&widgetGetFocus.onFocusChanged(widgetLostFocus,widgetGetFocus),widgetLostFocus&&widgetGetFocus.onFocusChanged&&widgetLostFocus.onFocusChanged(widgetLostFocus,widgetGetFocus),cc.eventManager.dispatchEvent(new cc.EventFocus(widgetLostFocus,widgetGetFocus)))},setBright:function(bright){this._bright=bright,this._bright?(this._brightStyle=ccui.Widget.BRIGHT_STYLE_NONE,this.setBrightStyle(ccui.Widget.BRIGHT_STYLE_NORMAL)):this._onPressStateChangedToDisabled()},setBrightStyle:function(style){if(this._brightStyle!==style)switch(style=style||ccui.Widget.BRIGHT_STYLE_NORMAL,this._brightStyle=style,this._brightStyle){case ccui.Widget.BRIGHT_STYLE_NORMAL:this._onPressStateChangedToNormal();break;case ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT:this._onPressStateChangedToPressed()}},_onPressStateChangedToNormal:function(){},_onPressStateChangedToPressed:function(){},_onPressStateChangedToDisabled:function(){},_updateChildrenDisplayedRGBA:function(){this.setColor(this.getColor()),this.setOpacity(this.getOpacity())},didNotSelectSelf:function(){},onTouchBegan:function(touch,event){if(this._hit=!1,this.isVisible()&&this.isEnabled()&&this._isAncestorsEnabled()&&this._isAncestorsVisible(this)){var touchPoint=touch.getLocation();this._touchBeganPosition.x=touchPoint.x,this._touchBeganPosition.y=touchPoint.y,this.hitTest(this._touchBeganPosition)&&this.isClippingParentContainsPoint(this._touchBeganPosition)&&(this._hit=!0)}return!!this._hit&&(this.setHighlighted(!0),this._propagateTouchEvents&&this.propagateTouchEvent(ccui.Widget.TOUCH_BEGAN,this,touch),this._pushDownEvent(),!0)},propagateTouchEvent:function(event,sender,touch){var widgetParent=this.getWidgetParent();widgetParent&&widgetParent.interceptTouchEvent(event,sender,touch)},onTouchMoved:function(touch,event){var touchPoint=touch.getLocation();this._touchMovePosition.x=touchPoint.x,this._touchMovePosition.y=touchPoint.y,this.setHighlighted(this.hitTest(touchPoint)),this._propagateTouchEvents&&this.propagateTouchEvent(ccui.Widget.TOUCH_MOVED,this,touch),this._moveEvent()},onTouchEnded:function(touch,event){var touchPoint=touch.getLocation();this._touchEndPosition.x=touchPoint.x,this._touchEndPosition.y=touchPoint.y,this._propagateTouchEvents&&this.propagateTouchEvent(ccui.Widget.TOUCH_ENDED,this,touch);var highlight=this._highlight;this.setHighlighted(!1),highlight?this._releaseUpEvent():this._cancelUpEvent()},onTouchCancelled:function(touchPoint){this.setHighlighted(!1),this._cancelUpEvent()},onTouchLongClicked:function(touchPoint){this.longClickEvent()},_pushDownEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_BEGAN),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_BEGAN)},_moveEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_MOVED),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_MOVED)},_releaseUpEvent:function(){if(this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_ENDED),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_ENDED),this._clickEventListener){if(this._touchSound){var path=RES_CDN_SOUND+SND_TYPE+"sound/"+this._touchSound;AudioEngine.getInstance().playEffect(path)}else AudioEngine.getInstance().playNormaButtonSound();this.clickEventHandler(this)}},_cancelUpEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_CANCELED),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_CANCELED)},setSoundPath:function(path){this._touchSound=path},longClickEvent:function(){},clickEventHandler:function(sender){if(1!=this.fClicked){this.fClicked=!0;var v1=this.getTouchBeganPosition(),v2=this.getTouchEndPosition(),fDoTutorialStep=!1,tutorial=TutorialContextV2.getInstance(),current_scene=GameContext.getInstance().getCurrentScene();if(0==tutorial.IsCompleteAllTutorial()&&tutorial.IsLoaded()){var btn=sender;if(current_scene!=scene_PatchScene&&current_scene!=scene_TitleScene&&current_scene!=scene_SelectCharacterScene&&btn.getExtraButtonTag()!=EXTRA_TAG_IGNORE_TUTORIAL){var node=sender;if(!tutorial.IsValidTouchEvent(node.getTutorialTag(),v2))return void(this.fClicked=!1);fDoTutorialStep=!0}}Math.abs(v1.x-v2.x)>ccSize(this).width/2||Math.abs(v1.y-v2.y)>ccSize(this).height/2||(1==fDoTutorialStep&&tutorial.getCurrentTutorialStep().tagid==sender.getTutorialTag()&&MainObserver.getInstance().postNotification(NOTIFICATION_TUTORIAL,message_complete_tutorial),this._clickEventListener&&(this.fClicked=!1,this._clickEventListener(sender))),this.fClicked=!1}},addTouchEventListener:function(selector,target){void 0===target?this._touchEventCallback=selector:(this._touchEventSelector=selector,this._touchEventListener=target)},addClickEventListener:function(callback){this._clickEventListener=callback},hitTest:function(pt){var bb=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc.rectContainsPoint(bb,this.convertToNodeSpace(pt))},isClippingParentContainsPoint:function(pt){this._affectByClipping=!1;for(var parent=this.getParent(),clippingParent=null;parent;){if(parent instanceof ccui.Layout&&parent.isClippingEnabled()){this._affectByClipping=!0,clippingParent=parent;break}parent=parent.getParent()}return!this._affectByClipping||(!clippingParent||!!clippingParent.hitTest(pt)&&clippingParent.isClippingParentContainsPoint(pt))},checkChildInfo:function(handleState,sender,touchPoint){var widgetParent=this.getWidgetParent();widgetParent&&widgetParent.checkChildInfo(handleState,sender,touchPoint)},setPosition:function(pos,posY){if(!this._usingLayoutComponent&&this._running){var widgetParent=this.getWidgetParent();if(widgetParent){var pSize=widgetParent.getContentSize();pSize.width<=0||pSize.height<=0?(this._positionPercent.x=0,this._positionPercent.y=0):void 0===posY?(this._positionPercent.x=pos.x/pSize.width,this._positionPercent.y=pos.y/pSize.height):(this._positionPercent.x=pos/pSize.width,this._positionPercent.y=posY/pSize.height)}}cc.Node.prototype.setPosition.call(this,pos,posY)},setPositionX:function(x){if(this._running){var widgetParent=this.getWidgetParent();if(widgetParent){var pw=widgetParent.width;this._positionPercent.x=pw<=0?0:x/pw}}cc.Node.prototype.setPositionX.call(this,x)},setPositionY:function(y){if(this._running){var widgetParent=this.getWidgetParent();if(widgetParent){var ph=widgetParent.height;this._positionPercent.y=ph<=0?0:y/ph}}cc.Node.prototype.setPositionY.call(this,y)},setPositionPercent:function(percent){if(this._usingLayoutComponent){var component=this._getOrCreateLayoutComponent();return component.setPositionPercentX(percent.x),component.setPositionPercentY(percent.y),void component.refreshLayout()}this._setXPercent(percent.x),this._setYPercent(percent.y),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},_setXPercent:function(percent){if(this._usingLayoutComponent){var component=this._getOrCreateLayoutComponent();return component.setPositionPercentX(percent.x),void component.refreshLayout()}this._positionPercent.x=percent,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},_setYPercent:function(percent){if(this._usingLayoutComponent){var component=this._getOrCreateLayoutComponent();return component.setPositionPercentY(percent.x),void component.refreshLayout()}this._positionPercent.y=percent,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPositionPercent:function(){if(this._usingLayoutComponent){var component=this._getOrCreateLayoutComponent();this._positionPercent.x=component.getPositionPercentX(),this._positionPercent.y=component.getPositionPercentY()}return cc.p(this._positionPercent)},_getXPercent:function(){if(this._usingLayoutComponent){var component=this._getOrCreateLayoutComponent();this._positionPercent.x=component.getPositionPercentX(),this._positionPercent.y=component.getPositionPercentY()}return this._positionPercent.x},_getYPercent:function(){if(this._usingLayoutComponent){var component=this._getOrCreateLayoutComponent();this._positionPercent.x=component.getPositionPercentX(),this._positionPercent.y=component.getPositionPercentY()}return this._positionPercent.y},setPositionType:function(type){if(this._positionType=type,this._usingLayoutComponent){var component=this._getOrCreateLayoutComponent();type===ccui.POSITION_ABSOLUTE?(component.setPositionPercentXEnabled(!1),component.setPositionPercentYEnabled(!1)):(component.setPositionPercentXEnabled(!0),component.setPositionPercentYEnabled(!0))}this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPositionType:function(){return this._positionType},setFlippedX:function(flipX){var realScale=this.getScaleX();this._flippedX=flipX,this.setScaleX(realScale)},isFlippedX:function(){return this._flippedX},setFlippedY:function(flipY){var realScale=this.getScaleY();this._flippedY=flipY,this.setScaleY(realScale)},isFlippedY:function(){return this._flippedY},_adaptRenderers:function(){},isBright:function(){return this._bright},isEnabled:function(){return this._enabled},getLeftBoundary:function(){return this.getPositionX()-this._getAnchorX()*this._contentSize.width},getBottomBoundary:function(){return this.getPositionY()-this._getAnchorY()*this._contentSize.height},getRightBoundary:function(){return this.getLeftBoundary()+this._contentSize.width},getTopBoundary:function(){return this.getBottomBoundary()+this._contentSize.height},getTouchBeganPosition:function(){return cc.p(this._touchBeganPosition)},getTouchMovePosition:function(){return cc.p(this._touchMovePosition)},getTouchEndPosition:function(){return cc.p(this._touchEndPosition)},getWidgetType:function(){return this._widgetType},setLayoutParameter:function(parameter){parameter&&(this._layoutParameterDictionary[parameter.getLayoutType()]=parameter,this._layoutParameterType=parameter.getLayoutType())},getLayoutParameter:function(type){return type=type||this._layoutParameterType,this._layoutParameterDictionary[type]},getDescription:function(){return"Widget"},clone:function(){var clonedWidget=this._createCloneInstance();return clonedWidget._copyProperties(this),clonedWidget._copyClonedWidgetChildren(this),clonedWidget},_createCloneInstance:function(){return new ccui.Widget},_copyClonedWidgetChildren:function(model){for(var widgetChildren=model.getChildren(),i=0;i<widgetChildren.length;i++){var locChild=widgetChildren[i];locChild instanceof ccui.Widget&&this.addChild(locChild.clone())}},_copySpecialProperties:function(model){},_copyProperties:function(widget){this.setEnabled(widget.isEnabled()),this.setVisible(widget.isVisible()),this.setBright(widget.isBright()),this.setTouchEnabled(widget.isTouchEnabled()),this.setLocalZOrder(widget.getLocalZOrder()),this.setTag(widget.getTag()),this.setName(widget.getName()),this.setActionTag(widget.getActionTag()),this._ignoreSize=widget._ignoreSize,this.setContentSize(widget._contentSize),this._customSize.width=widget._customSize.width,this._customSize.height=widget._customSize.height,this._copySpecialProperties(widget),this._sizeType=widget.getSizeType(),this._sizePercent.x=widget._sizePercent.x,this._sizePercent.y=widget._sizePercent.y,this._positionType=widget._positionType,this._positionPercent.x=widget._positionPercent.x,this._positionPercent.y=widget._positionPercent.y,this.setPosition(widget.getPosition()),this.setAnchorPoint(widget.getAnchorPoint()),this.setScaleX(widget.getScaleX()),this.setScaleY(widget.getScaleY()),this.setRotation(widget.getRotation()),this.setRotationX(widget.getRotationX()),this.setRotationY(widget.getRotationY()),this.setFlippedX(widget.isFlippedX()),this.setFlippedY(widget.isFlippedY()),this.setColor(widget.getColor()),this.setOpacity(widget.getOpacity()),this._touchEventCallback=widget._touchEventCallback,this._touchEventListener=widget._touchEventListener,this._touchEventSelector=widget._touchEventSelector,this._clickEventListener=widget._clickEventListener,this._focused=widget._focused,this._focusEnabled=widget._focusEnabled,this._propagateTouchEvents=widget._propagateTouchEvents;for(var key in widget._layoutParameterDictionary){var parameter=widget._layoutParameterDictionary[key];parameter&&this.setLayoutParameter(parameter.clone())}},setActionTag:function(tag){this._actionTag=tag},getActionTag:function(){return this._actionTag},getLeftInParent:function(){return cc.log("getLeftInParent is deprecated. Please use getLeftBoundary instead."),this.getLeftBoundary()},getBottomInParent:function(){return cc.log("getBottomInParent is deprecated. Please use getBottomBoundary instead."),this.getBottomBoundary()},getRightInParent:function(){return cc.log("getRightInParent is deprecated. Please use getRightBoundary instead."),this.getRightBoundary()},getTopInParent:function(){return cc.log("getTopInParent is deprecated. Please use getTopBoundary instead."),this.getTopBoundary()},getTouchEndPos:function(){return cc.log("getTouchEndPos is deprecated. Please use getTouchEndPosition instead."),this.getTouchEndPosition()},getTouchMovePos:function(){return cc.log("getTouchMovePos is deprecated. Please use getTouchMovePosition instead."),this.getTouchMovePosition()},clippingParentAreaContainPoint:function(pt){cc.log("clippingParentAreaContainPoint is deprecated. Please use isClippingParentContainsPoint instead."),this.isClippingParentContainsPoint(pt)},getTouchStartPos:function(){return cc.log("getTouchStartPos is deprecated. Please use getTouchBeganPosition instead."),this.getTouchBeganPosition()},setSize:function(size){this.setContentSize(size)},getSize:function(){return this.getContentSize()},addNode:function(node,zOrder,tag){node instanceof ccui.Widget?cc.log("Please use addChild to add a Widget."):(cc.Node.prototype.addChild.call(this,node,zOrder,tag),this._nodes.push(node))},getNodeByTag:function(tag){for(var _nodes=this._nodes,i=0;i<_nodes.length;i++){var node=_nodes[i];if(node&&node.getTag()===tag)return node}return null},getNodes:function(){return this._nodes},removeNode:function(node,cleanup){cc.Node.prototype.removeChild.call(this,node,cleanup),cc.arrayRemoveObject(this._nodes,node)},_getNormalGLProgram:function(){return cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)},_getGrayGLProgram:function(){return cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR_GRAY)},removeNodeByTag:function(tag,cleanup){var node=this.getChildByTag(tag);node?this.removeChild(node,cleanup):cc.log("cocos2d: removeNodeByTag(tag = %d): child not found!",tag)},removeAllNodes:function(){for(var i=0;i<this._nodes.length;i++){var node=this._nodes[i];cc.Node.prototype.removeChild.call(this,node)}this._nodes.length=0},_findLayout:function(){cc.renderer.childrenOrderDirty=!0;for(var layout=this._parent;layout;){if(layout._doLayout){layout._doLayoutDirty=!0;break}layout=layout._parent}},isUnifySizeEnabled:function(){return this._unifySize},setUnifySizeEnabled:function(enable){this._unifySize=enable},_ccEventCallback:null,addCCSEventListener:function(callback){this._ccEventCallback=callback},setScaleX:function(scaleX){this._flippedX&&(scaleX*=-1),cc.Node.prototype.setScaleX.call(this,scaleX)},setScaleY:function(scaleY){this._flippedY&&(scaleY*=-1),cc.Node.prototype.setScaleY.call(this,scaleY)},setScale:function(scaleX,scaleY){void 0===scaleY&&(scaleY=scaleX),this.setScaleX(scaleX),this.setScaleY(scaleY)},getScaleX:function(){var originalScale=cc.Node.prototype.getScaleX.call(this);return this._flippedX&&(originalScale*=-1),originalScale},getScaleY:function(){var originalScale=cc.Node.prototype.getScaleY.call(this);return this._flippedY&&(originalScale*=-1),originalScale},getScale:function(){return this.getScaleX()!==this.getScaleY()&&cc.log("Widget#scale. ScaleX != ScaleY. Don't know which one to return"),this.getScaleX()},setCallbackName:function(callbackName){this._callbackName=callbackName},getCallbackName:function(){return this._callbackName},setCallbackType:function(callbackType){this._callbackType=callbackType},getCallbackType:function(){return this._callbackType},setLayoutComponentEnabled:function(enable){this._usingLayoutComponent=enable},isLayoutComponentEnabled:function(){return this._usingLayoutComponent},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new ccui.Widget.WebGLRenderCmd(this):new ccui.Widget.CanvasRenderCmd(this)},getExtraButtonTag:function(){return 0}});var _p=ccui.Widget.prototype;_p.xPercent,cc.defineGetterSetter(_p,"xPercent",_p._getXPercent,_p._setXPercent),_p.yPercent,cc.defineGetterSetter(_p,"yPercent",_p._getYPercent,_p._setYPercent),_p.widthPercent,cc.defineGetterSetter(_p,"widthPercent",_p._getWidthPercent,_p._setWidthPercent),_p.heightPercent,cc.defineGetterSetter(_p,"heightPercent",_p._getHeightPercent,_p._setHeightPercent),_p.widgetParent,cc.defineGetterSetter(_p,"widgetParent",_p.getWidgetParent),_p.enabled,cc.defineGetterSetter(_p,"enabled",_p.isEnabled,_p.setEnabled),_p.focused,cc.defineGetterSetter(_p,"focused",_p.isFocused,_p.setFocused),_p.sizeType,cc.defineGetterSetter(_p,"sizeType",_p.getSizeType,_p.setSizeType),_p.widgetType,cc.defineGetterSetter(_p,"widgetType",_p.getWidgetType),_p.touchEnabled,cc.defineGetterSetter(_p,"touchEnabled",_p.isTouchEnabled,_p.setTouchEnabled),_p.updateEnabled,cc.defineGetterSetter(_p,"updateEnabled",_p.isUpdateEnabled,_p.setUpdateEnabled),_p.bright,cc.defineGetterSetter(_p,"bright",_p.isBright,_p.setBright),_p.name,cc.defineGetterSetter(_p,"name",_p.getName,_p.setName),_p.actionTag,cc.defineGetterSetter(_p,"actionTag",_p.getActionTag,_p.setActionTag),_p.opacity,cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity),_p=null,ccui.Widget.create=function(){return new ccui.Widget},ccui.Widget._focusedWidget=null,ccui.Widget._focusNavigationController=null,ccui.Widget.enableDpadNavigation=function(enable){enable?(null==ccui.Widget._focusNavigationController&&(ccui.Widget._focusNavigationController=new ccui._FocusNavigationController,ccui.Widget._focusedWidget&&ccui.Widget._focusNavigationController._setFirstFocsuedWidget(ccui.Widget._focusedWidget)),ccui.Widget._focusNavigationController.enableFocusNavigation(!0)):ccui.Widget._focusNavigationController&&(ccui.Widget._focusNavigationController.enableFocusNavigation(!1),ccui.Widget._focusNavigationController=null)},ccui.Widget.getCurrentFocusedWidget=function(){return ccui.Widget._focusedWidget},ccui.Widget.BRIGHT_STYLE_NONE=-1,ccui.Widget.BRIGHT_STYLE_NORMAL=0,ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT=1,ccui.Widget.TYPE_WIDGET=0,ccui.Widget.TYPE_CONTAINER=1,ccui.Widget.LEFT=0,ccui.Widget.RIGHT=1,ccui.Widget.UP=2,ccui.Widget.DOWN=3,ccui.Widget.LOCAL_TEXTURE=0,ccui.Widget.PLIST_TEXTURE=1,ccui.Widget.TOUCH_BEGAN=0,ccui.Widget.TOUCH_MOVED=1,ccui.Widget.TOUCH_ENDED=2,ccui.Widget.TOUCH_CANCELED=3,ccui.Widget.SIZE_ABSOLUTE=0,ccui.Widget.SIZE_PERCENT=1,ccui.Widget.POSITION_ABSOLUTE=0,ccui.Widget.POSITION_PERCENT=1,cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)ccui.Widget.CanvasRenderCmd=function(renderable){this._pNodeCmdCtor(renderable),this._needDraw=!1},(proto=ccui.Widget.CanvasRenderCmd.prototype=Object.create(cc.ProtectedNode.CanvasRenderCmd.prototype)).constructor=ccui.Widget.CanvasRenderCmd,proto.visit=function(parentCmd){var node=this._node,renderer=cc.renderer;(parentCmd=parentCmd||this.getParentRenderCmd())&&(this._curLevel=parentCmd._curLevel+1),isNaN(node._customZ)&&(node._vertexZ=renderer.assignedZ,renderer.assignedZ+=renderer.assignedZStep),node._adaptRenderers(),this._syncStatus(parentCmd)},proto.transform=function(parentCmd,recursive){this._transform||(this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0});var node=this._node;if(node._visible&&node._running){if(node._adaptRenderers(),!this._usingLayoutComponent){var widgetParent=node.getWidgetParent();if(widgetParent){var parentSize=widgetParent.getContentSize();0!==parentSize.width&&0!==parentSize.height&&(node._position.x=parentSize.width*node._positionPercent.x,node._position.y=parentSize.height*node._positionPercent.y)}}this.pNodeTransform(parentCmd,recursive)}},proto.widgetTransform=proto.transform;else{ccui.Widget.WebGLRenderCmd=function(renderable){this._pNodeCmdCtor(renderable),this._needDraw=!1};var proto=ccui.Widget.WebGLRenderCmd.prototype=Object.create(cc.ProtectedNode.WebGLRenderCmd.prototype);proto.constructor=ccui.Widget.WebGLRenderCmd,proto.visit=function(parentCmd){var node=this._node,renderer=cc.renderer;(parentCmd=parentCmd||this.getParentRenderCmd())&&(this._curLevel=parentCmd._curLevel+1),isNaN(node._customZ)&&(node._vertexZ=renderer.assignedZ,renderer.assignedZ+=renderer.assignedZStep),node._adaptRenderers(),this._syncStatus(parentCmd)},proto.transform=function(parentCmd,recursive){this._transform||(this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0});var node=this._node;if(node._visible&&node._running){if(node._adaptRenderers(),!this._usingLayoutComponent){var widgetParent=node.getWidgetParent();if(widgetParent){var parentSize=widgetParent.getContentSize();0!==parentSize.width&&0!==parentSize.height&&(node._position.x=parentSize.width*node._positionPercent.x,node._position.y=parentSize.height*node._positionPercent.y)}}this.pNodeTransform(parentCmd,recursive)}},proto.widgetTransform=proto.transform}}),function(){var webgl,dataPool={_pool:{},_lengths:[],put:function(data){var length=data.length;this._pool[length]?this._pool[length].push(data):(this._pool[length]=[data],this._lengths.push(length),this._lengths.sort())},get:function(length){for(var id,i=0;i<this._lengths.length;i++)if(this._lengths[i]>=length){id=this._lengths[i];break}return id?this._pool[id].pop():void 0}},FIX_ARTIFACTS_BY_STRECHING_TEXEL=cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL,cornerId=[],simpleQuadGenerator={_rebuildQuads_base:function(sprite,spriteFrame,contentSize,isTrimmedContentSize){var l,b,r,t,vertices=sprite._vertices,wt=sprite._renderCmd._worldTransform;if(isTrimmedContentSize)l=0,b=0,r=contentSize.width,t=contentSize.height;else{var originalSize=spriteFrame._originalSize,rect=spriteFrame._rect,offset=spriteFrame._offset,scaleX=contentSize.width/originalSize.width,scaleY=contentSize.height/originalSize.height,trimmLeft=offset.x+(originalSize.width-rect.width)/2,trimmRight=offset.x-(originalSize.width-rect.width)/2,trimmedBottom=offset.y+(originalSize.height-rect.height)/2,trimmedTop=offset.y-(originalSize.height-rect.height)/2;l=trimmLeft*scaleX,b=trimmedBottom*scaleY,r=contentSize.width+trimmRight*scaleX,t=contentSize.height+trimmedTop*scaleY}vertices.length<8&&(dataPool.put(vertices),vertices=dataPool.get(8)||new Float32Array(8),sprite._vertices=vertices),webgl?(vertices[0]=l*wt.a+b*wt.c+wt.tx,vertices[1]=l*wt.b+b*wt.d+wt.ty,vertices[2]=r*wt.a+b*wt.c+wt.tx,vertices[3]=r*wt.b+b*wt.d+wt.ty,vertices[4]=l*wt.a+t*wt.c+wt.tx,vertices[5]=l*wt.b+t*wt.d+wt.ty,vertices[6]=r*wt.a+t*wt.c+wt.tx,vertices[7]=r*wt.b+t*wt.d+wt.ty):(vertices[0]=l,vertices[1]=b,vertices[2]=r,vertices[3]=b,vertices[4]=l,vertices[5]=t,vertices[6]=r,vertices[7]=t),cornerId[0]=0,cornerId[1]=2,cornerId[2]=4,cornerId[3]=6,sprite._uvsDirty&&this._calculateUVs(sprite,spriteFrame),sprite._vertCount=4},_calculateUVs:function(sprite,spriteFrame){var uvs=sprite._uvs,atlasWidth=spriteFrame._texture._pixelsWide,atlasHeight=spriteFrame._texture._pixelsHigh,textureRect=spriteFrame._rect;textureRect=cc.rectPointsToPixels(textureRect),uvs.length<8&&(dataPool.put(uvs),uvs=dataPool.get(8)||new Float32Array(8),sprite._uvs=uvs);var l,b,r,t,texelCorrect=FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0;spriteFrame._rotated?(l=(textureRect.x+texelCorrect)/atlasWidth,b=(textureRect.y+textureRect.width-texelCorrect)/atlasHeight,r=(textureRect.x+textureRect.height-texelCorrect)/atlasWidth,t=(textureRect.y+texelCorrect)/atlasHeight,uvs[0]=l,uvs[1]=t,uvs[2]=l,uvs[3]=b,uvs[4]=r,uvs[5]=t,uvs[6]=r,uvs[7]=b):(l=(textureRect.x+texelCorrect)/atlasWidth,b=(textureRect.y+textureRect.height-texelCorrect)/atlasHeight,r=(textureRect.x+textureRect.width-texelCorrect)/atlasWidth,t=(textureRect.y+texelCorrect)/atlasHeight,uvs[0]=l,uvs[1]=b,uvs[2]=r,uvs[3]=b,uvs[4]=l,uvs[5]=t,uvs[6]=r,uvs[7]=t)}},scale9QuadGenerator={x:new Array(4),y:new Array(4),_rebuildQuads_base:function(sprite,spriteFrame,contentSize,insetLeft,insetRight,insetTop,insetBottom){var leftWidth,rightWidth,topHeight,bottomHeight,vertices=sprite._vertices,wt=sprite._renderCmd._worldTransform,rect=spriteFrame._rect;leftWidth=insetLeft,rightWidth=insetRight,rect.width,topHeight=insetTop,bottomHeight=insetBottom,rect.height;var preferSize=contentSize,sizableWidth=preferSize.width-leftWidth-rightWidth,sizableHeight=preferSize.height-topHeight-bottomHeight,xScale=preferSize.width/(leftWidth+rightWidth),yScale=preferSize.height/(topHeight+bottomHeight);xScale=xScale>1?1:xScale,yScale=yScale>1?1:yScale,sizableWidth=sizableWidth<0?0:sizableWidth,sizableHeight=sizableHeight<0?0:sizableHeight;var x=this.x,y=this.y;x[0]=0,x[1]=leftWidth*xScale,x[2]=x[1]+sizableWidth,x[3]=preferSize.width,y[0]=0,y[1]=bottomHeight*yScale,y[2]=y[1]+sizableHeight,y[3]=preferSize.height,vertices.length<32&&(dataPool.put(vertices),vertices=dataPool.get(32)||new Float32Array(32),sprite._vertices=vertices);var row,col,offset=0;if(webgl)for(row=0;row<4;row++)for(col=0;col<4;col++)vertices[offset]=x[col]*wt.a+y[row]*wt.c+wt.tx,vertices[offset+1]=x[col]*wt.b+y[row]*wt.d+wt.ty,offset+=2;else for(row=0;row<4;row++)for(col=0;col<4;col++)vertices[offset]=x[col],vertices[offset+1]=y[row],offset+=2;cornerId[0]=0,cornerId[1]=6,cornerId[2]=24,cornerId[3]=30,sprite._uvsDirty&&this._calculateUVs(sprite,spriteFrame,insetLeft,insetRight,insetTop,insetBottom)},_calculateUVs:function(sprite,spriteFrame,insetLeft,insetRight,insetTop,insetBottom){var leftWidth,centerWidth,rightWidth,topHeight,centerHeight,bottomHeight,uvs=sprite._uvs,rect=spriteFrame._rect,atlasWidth=spriteFrame._texture._pixelsWide,atlasHeight=spriteFrame._texture._pixelsHigh,textureRect=spriteFrame._rect;textureRect=cc.rectPointsToPixels(textureRect),rect=cc.rectPointsToPixels(rect);var scale=cc.contentScaleFactor();leftWidth=insetLeft*scale,rightWidth=insetRight*scale,centerWidth=rect.width-leftWidth-rightWidth,topHeight=insetTop*scale,bottomHeight=insetBottom*scale,centerHeight=rect.height-topHeight-bottomHeight,uvs.length<32&&(dataPool.put(uvs),uvs=dataPool.get(32)||new Float32Array(32),sprite._uvs=uvs);var row,col,u=this.x,v=this.y,texelCorrect=FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0,offset=0;if(spriteFrame._rotated)for(u[0]=(textureRect.x+texelCorrect)/atlasWidth,u[1]=(bottomHeight+textureRect.x)/atlasWidth,u[2]=(bottomHeight+centerHeight+textureRect.x)/atlasWidth,u[3]=(textureRect.x+textureRect.height-texelCorrect)/atlasWidth,v[3]=(textureRect.y+texelCorrect)/atlasHeight,v[2]=(leftWidth+textureRect.y)/atlasHeight,v[1]=(leftWidth+centerWidth+textureRect.y)/atlasHeight,v[0]=(textureRect.y+textureRect.width-texelCorrect)/atlasHeight,row=0;row<4;row++)for(col=0;col<4;col++)uvs[offset]=u[row],uvs[offset+1]=v[3-col],offset+=2;else for(u[0]=(textureRect.x+texelCorrect)/atlasWidth,u[1]=(leftWidth+textureRect.x)/atlasWidth,u[2]=(leftWidth+centerWidth+textureRect.x)/atlasWidth,u[3]=(textureRect.x+textureRect.width-texelCorrect)/atlasWidth,v[3]=(textureRect.y+texelCorrect)/atlasHeight,v[2]=(topHeight+textureRect.y)/atlasHeight,v[1]=(topHeight+centerHeight+textureRect.y)/atlasHeight,v[0]=(textureRect.y+textureRect.height-texelCorrect)/atlasHeight,row=0;row<4;row++)for(col=0;col<4;col++)uvs[offset]=u[col],uvs[offset+1]=v[row],offset+=2}};ccui.Scale9Sprite=cc.Scale9Sprite=cc.Node.extend({_spriteFrame:null,_scale9Image:null,_insetLeft:0,_insetRight:0,_insetTop:0,_insetBottom:0,_blendFunc:null,_renderingType:1,_brightState:0,_opacityModifyRGB:!1,_rawVerts:null,_rawUvs:null,_vertices:null,_uvs:null,_vertCount:0,_quadsDirty:!0,_uvsDirty:!0,_isTriangle:!1,_isTrimmedContentSize:!1,_flippedX:!1,_flippedY:!1,_className:"Scale9Sprite",ctor:function(file,rectOrCapInsets,capInsets){if(cc.Node.prototype.ctor.call(this),this._loader=new cc.Sprite.LoadManager,this._renderCmd.setState(this._brightState),this._blendFunc=cc.BlendFunc._alphaPremultiplied(),this.setAnchorPoint(cc.p(.5,.5)),this._rawVerts=null,this._rawUvs=null,this._vertices=dataPool.get(8)||new Float32Array(8),this._uvs=dataPool.get(8)||new Float32Array(8),void 0!==file)if(file instanceof cc.SpriteFrame)this.initWithSpriteFrame(file,rectOrCapInsets);else{var frame=cc.spriteFrameCache.getSpriteFrame(file);frame?this.initWithSpriteFrame(frame,rectOrCapInsets):this.initWithFile(file,rectOrCapInsets,capInsets)}void 0===webgl&&(webgl=cc._renderType===cc.game.RENDER_TYPE_WEBGL)},getCapInsets:function(){return cc.rect(this._capInsetsInternal)},_asyncSetCapInsets:function(){this.removeEventListener("load",this._asyncSetCapInsets,this),this.setCapInsets(this._cacheCapInsets),this._cacheCapInsets=null},setCapInsets:function(capInsets){if(!this.loaded())return this._cacheCapInsets=capInsets,this.removeEventListener("load",this._asyncSetCapInsets,this),this.addEventListener("load",this._asyncSetCapInsets,this),!1;this._capInsetsInternal=capInsets,this._updateCapInsets(this._spriteFrame._rect,this._capInsetsInternal)},_updateCapInsets:function(rect,capInsets){capInsets&&rect&&!cc._rectEqualToZero(capInsets)?this._capInsetsInternal=capInsets:(rect=rect||{x:0,y:0,width:this._contentSize.width,height:this._contentSize.height},this._capInsetsInternal=cc.rect(rect.width/3,rect.height/3,rect.width/3,rect.height/3)),cc._rectEqualToZero(rect)||(this._insetLeft=this._capInsetsInternal.x,this._insetTop=this._capInsetsInternal.y,this._insetRight=rect.width-this._insetLeft-this._capInsetsInternal.width,this._insetBottom=rect.height-this._insetTop-this._capInsetsInternal.height)},initWithFile:function(file,rect,capInsets){if(file instanceof cc.Rect?(file=arguments[1],capInsets=arguments[0],rect=cc.rect(0,0,0,0)):(rect=rect||cc.rect(0,0,0,0),capInsets=capInsets||cc.rect(0,0,0,0)),!file)throw new Error("ccui.Scale9Sprite.initWithFile(): file should be non-null");var texture=cc.textureCache.getTextureForKey(file);texture||(texture=cc.textureCache.addImage(file));var locLoaded=texture.isLoaded();if(this._loader.clear(),!locLoaded)return this._loader.once(texture,function(){this.initWithFile(file,rect,capInsets),this.dispatchEvent("load")},this),!1;if(cc._rectEqualToZero(rect)){var textureSize=texture.getContentSize();rect=cc.rect(0,0,textureSize.width,textureSize.height)}return this.setTexture(texture,rect),this._updateCapInsets(rect,capInsets),!0},updateWithBatchNode:function(batchNode,originalRect,rotated,capInsets){if(!batchNode)return!1;var texture=batchNode.getTexture();return this._loader.clear(),texture.isLoaded()?(this.setTexture(texture,originalRect),this._updateCapInsets(originalRect,capInsets),!0):(this._loader.once(texture,function(){this.updateWithBatchNode(batchNode,originalRect,rotated,capInsets),this.dispatchEvent("load")},this),!1)},initWithSpriteFrame:function(spriteFrame,capInsets){this.setSpriteFrame(spriteFrame),capInsets=capInsets||cc.rect(0,0,0,0),this._updateCapInsets(spriteFrame._rect,capInsets)},initWithSpriteFrameName:function(spriteFrameName,capInsets){if(!spriteFrameName)throw new Error("ccui.Scale9Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null");capInsets=capInsets||cc.rect(0,0,0,0);var frame=cc.spriteFrameCache.getSpriteFrame(spriteFrameName);if(null==frame)return cc.log("ccui.Scale9Sprite.initWithSpriteFrameName(): can't find the sprite frame by spriteFrameName"),!1;this.setSpriteFrame(frame),capInsets=capInsets||cc.rect(0,0,0,0),this._updateCapInsets(frame._rect,capInsets)},loaded:function(){return null!==this._spriteFrame&&this._spriteFrame.textureLoaded()},setTexture:function(texture,rect){var spriteFrame=new cc.SpriteFrame(texture,rect);this.setSpriteFrame(spriteFrame)},_updateBlendFunc:function(){var blendFunc=this._blendFunc;this._spriteFrame&&this._spriteFrame._texture.hasPremultipliedAlpha()?(blendFunc.src===cc.SRC_ALPHA&&blendFunc.dst===cc.BLEND_DST&&(blendFunc.src=cc.ONE),this._opacityModifyRGB=!0):(blendFunc.src===cc.ONE&&blendFunc.dst===cc.BLEND_DST&&(blendFunc.src=cc.SRC_ALPHA),this._opacityModifyRGB=!1)},setOpacityModifyRGB:function(value){this._opacityModifyRGB!==value&&(this._opacityModifyRGB=value,this._renderCmd._setColorDirty())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setSpriteFrame:function(spriteFrame){if(spriteFrame){this._spriteFrame=spriteFrame,this._quadsDirty=!0,this._uvsDirty=!0;var self=this,onResourceDataLoaded=function(){cc.sizeEqualToSize(self._contentSize,cc.size(0,0))&&self.setContentSize(self._spriteFrame._rect),self._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty),cc.renderer.childrenOrderDirty=!0};spriteFrame.textureLoaded()?onResourceDataLoaded():(this._loader.clear(),this._loader.once(spriteFrame,function(){onResourceDataLoaded(),this.dispatchEvent("load")},this))}},setBlendFunc:function(blendFunc,dst){void 0===dst?(this._blendFunc.src=blendFunc.src||cc.BLEND_SRC,this._blendFunc.dst=blendFunc.dst||cc.BLEND_DST):(this._blendFunc.src=blendFunc||cc.BLEND_SRC,this._blendFunc.dst=dst||cc.BLEND_DST),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},setPreferredSize:function(preferredSize){preferredSize&&!cc.sizeEqualToSize(this._contentSize,preferredSize)&&this.setContentSize(preferredSize)},getPreferredSize:function(){return this.getContentSize()},setContentSize:function(width,height){void 0===height&&(height=width.height,width=width.width),width===this._contentSize.width&&height===this._contentSize.height||(cc.Node.prototype.setContentSize.call(this,width,height),this._quadsDirty=!0)},getContentSize:function(){return this._renderingType===ccui.Scale9Sprite.RenderingType.SIMPLE&&this._spriteFrame?this._spriteFrame._originalSize:cc.size(this._contentSize)},_setWidth:function(value){cc.Node.prototype._setWidth.call(this,value),this._quadsDirty=!0},_setHeight:function(value){cc.Node.prototype._setHeight.call(this,value),this._quadsDirty=!0},setState:function(state){this._brightState=state,this._renderCmd.setState(state),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getState:function(){return this._brightState},setRenderingType:function(type){this._renderingType!==type&&(this._renderingType=type,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty))},getRenderingType:function(){return this._renderingType},setInsetLeft:function(insetLeft){this._insetLeft=insetLeft,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getInsetLeft:function(){return this._insetLeft},setInsetTop:function(insetTop){this._insetTop=insetTop,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getInsetTop:function(){return this._insetTop},setInsetRight:function(insetRight){this._insetRight=insetRight,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getInsetRight:function(){return this._insetRight},setInsetBottom:function(insetBottom){this._insetBottom=insetBottom,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getInsetBottom:function(){return this._insetBottom},_rebuildQuads:function(){if(this._spriteFrame&&this._spriteFrame._textureLoaded){switch(this._updateBlendFunc(),this._isTriangle=!1,this._renderingType){case RenderingType.SIMPLE:simpleQuadGenerator._rebuildQuads_base(this,this._spriteFrame,this._contentSize,this._isTrimmedContentSize);break;case RenderingType.SLICED:scale9QuadGenerator._rebuildQuads_base(this,this._spriteFrame,this._contentSize,this._insetLeft,this._insetRight,this._insetTop,this._insetBottom);break;default:return this._quadsDirty=!1,this._uvsDirty=!1,void cc.error("Can not generate quad")}this._quadsDirty=!1,this._uvsDirty=!1}},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new ccui.Scale9Sprite.CanvasRenderCmd(this):new ccui.Scale9Sprite.WebGLRenderCmd(this)}});var _p=ccui.Scale9Sprite.prototype;cc.EventHelper.prototype.apply(_p),_p.preferredSize,cc.defineGetterSetter(_p,"preferredSize",_p.getPreferredSize,_p.setPreferredSize),_p.capInsets,cc.defineGetterSetter(_p,"capInsets",_p.getCapInsets,_p.setCapInsets),_p.insetLeft,cc.defineGetterSetter(_p,"insetLeft",_p.getInsetLeft,_p.setInsetLeft),_p.insetTop,cc.defineGetterSetter(_p,"insetTop",_p.getInsetTop,_p.setInsetTop),_p.insetRight,cc.defineGetterSetter(_p,"insetRight",_p.getInsetRight,_p.setInsetRight),_p.insetBottom,cc.defineGetterSetter(_p,"insetBottom",_p.getInsetBottom,_p.setInsetBottom),_p=null,ccui.Scale9Sprite.create=function(file,rect,capInsets){return new ccui.Scale9Sprite(file,rect,capInsets)},ccui.Scale9Sprite.createWithSpriteFrame=function(spriteFrame,capInsets){return new ccui.Scale9Sprite(spriteFrame,capInsets)},ccui.Scale9Sprite.createWithSpriteFrameName=function(spriteFrameName,capInsets){return new ccui.Scale9Sprite(spriteFrameName,capInsets)},ccui.Scale9Sprite.POSITIONS_CENTRE=0,ccui.Scale9Sprite.POSITIONS_TOP=1,ccui.Scale9Sprite.POSITIONS_LEFT=2,ccui.Scale9Sprite.POSITIONS_RIGHT=3,ccui.Scale9Sprite.POSITIONS_BOTTOM=4,ccui.Scale9Sprite.POSITIONS_TOPRIGHT=5,ccui.Scale9Sprite.POSITIONS_TOPLEFT=6,ccui.Scale9Sprite.POSITIONS_BOTTOMRIGHT=7,ccui.Scale9Sprite.state={NORMAL:0,GRAY:1};var RenderingType=ccui.Scale9Sprite.RenderingType={SIMPLE:0,SLICED:1}}(),function(){ccui.Scale9Sprite.CanvasRenderCmd=function(renderable){cc.Node.CanvasRenderCmd.call(this,renderable),this._needDraw=!0,this._state=ccui.Scale9Sprite.state.NORMAL,this._originalTexture=this._textureToRender=null};var proto=ccui.Scale9Sprite.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);proto.constructor=ccui.Scale9Sprite.CanvasRenderCmd,proto.transform=function(parentCmd,recursive){this.originTransform(parentCmd,recursive),this._node._rebuildQuads()},proto.needDraw=function(){return this._needDraw&&this._node.loaded()},proto._updateDisplayColor=function(parentColor){cc.Node.RenderCmd.prototype._updateDisplayColor.call(this,parentColor),this._originalTexture=this._textureToRender=null},proto.setState=function(state){this._state!==state&&(this._state=state,this._originalTexture=this._textureToRender=null)},proto._setColorDirty=function(){this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty)},proto.rendering=function(ctx,scaleX,scaleY){var node=this._node,locDisplayOpacity=this._displayedOpacity,alpha=locDisplayOpacity/255,locTexture=null;if(node._spriteFrame&&(locTexture=node._spriteFrame._texture),node.loaded()&&0!==locDisplayOpacity){if(null===this._textureToRender||this._originalTexture!==locTexture){this._textureToRender=this._originalTexture=locTexture,cc.Scale9Sprite.state.GRAY===this._state&&(this._textureToRender=this._textureToRender._generateGrayTexture());var color=node.getDisplayedColor();!locTexture||255===color.r&&255===color.g&&255===color.b||(this._textureToRender=this._textureToRender._generateColorTexture(color.r,color.g,color.b))}var wrapper=ctx||cc._renderContext,context=wrapper.getContext();if(wrapper.setTransform(this._worldTransform,scaleX,scaleY),wrapper.setCompositeOperation(cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(node._blendFunc)),wrapper.setGlobalAlpha(alpha),this._textureToRender){node._quadsDirty&&node._rebuildQuads();var sx,sy,sw,sh,x,y,w,h,textureWidth=this._textureToRender._pixelsWide,textureHeight=this._textureToRender._pixelsHigh,image=this._textureToRender._htmlElementObj,vertices=node._vertices,uvs=node._uvs,i=0,off=0;if(node._renderingType===cc.Scale9Sprite.RenderingType.SLICED){for(var r=0;r<3;++r)for(var c=0;c<3;++c)x=vertices[off=8*r+2*c],y=vertices[off+1],w=vertices[off+10]-x,y=-y-(h=vertices[off+11]-y),sx=uvs[off]*textureWidth,sy=uvs[off+11]*textureHeight,sw=(uvs[off+10]-uvs[off])*textureWidth,sh=(uvs[off+1]-uvs[off+11])*textureHeight,sw>0&&sh>0&&w>0&&h>0&&context.drawImage(image,sx,sy,sw,sh,x,y,w,h);cc.g_NumberOfDraws+=9}else{var quadCount=Math.floor(node._vertCount/4);for(i=0,off=0;i<quadCount;i++)x=vertices[off],y=vertices[off+1],w=vertices[off+6]-x,y=-y-(h=vertices[off+7]-y),sx=uvs[off]*textureWidth,sy=uvs[off+7]*textureHeight,sw=(uvs[off+6]-uvs[off])*textureWidth,sh=(uvs[off+1]-uvs[off+7])*textureHeight,""!==this._textureToRender._pattern?(wrapper.setFillStyle(context.createPattern(image,this._textureToRender._pattern)),context.fillRect(x,y,w,h)):sw>0&&sh>0&&w>0&&h>0&&context.drawImage(image,sx,sy,sw,sh,x,y,w,h),off+=8;cc.g_NumberOfDraws+=quadCount}}}}}(),function(){if(cc.Node.WebGLRenderCmd){ccui.Scale9Sprite.WebGLRenderCmd=function(renderable){cc.Node.WebGLRenderCmd.call(this,renderable),this._needDraw=!0,this._color=new Uint32Array(1),this._dirty=!1,this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)};var Scale9Sprite=ccui.Scale9Sprite,proto=ccui.Scale9Sprite.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);proto.constructor=ccui.Scale9Sprite.WebGLRenderCmd,proto.needDraw=function(){return this._needDraw&&this._node.loaded()},proto._uploadSliced=function(vertices,uvs,color,z,f32buffer,ui32buffer,offset){for(var off,r=0;r<3;++r)for(var c=0;c<3;++c)off=8*r+2*c,f32buffer[offset]=vertices[off],f32buffer[offset+1]=vertices[off+1],f32buffer[offset+2]=z,ui32buffer[offset+3]=color[0],f32buffer[offset+4]=uvs[off],f32buffer[offset+5]=uvs[off+1],f32buffer[offset+=6]=vertices[off+2],f32buffer[offset+1]=vertices[off+3],f32buffer[offset+2]=z,ui32buffer[offset+3]=color[0],f32buffer[offset+4]=uvs[off+2],f32buffer[offset+5]=uvs[off+3],f32buffer[offset+=6]=vertices[off+8],f32buffer[offset+1]=vertices[off+9],f32buffer[offset+2]=z,ui32buffer[offset+3]=color[0],f32buffer[offset+4]=uvs[off+8],f32buffer[offset+5]=uvs[off+9],f32buffer[offset+=6]=vertices[off+10],f32buffer[offset+1]=vertices[off+11],f32buffer[offset+2]=z,ui32buffer[offset+3]=color[0],f32buffer[offset+4]=uvs[off+10],f32buffer[offset+5]=uvs[off+11],offset+=6;return 36},proto.transform=function(parentCmd,recursive){this.originTransform(parentCmd,recursive),this._node._rebuildQuads()},proto._setColorDirty=function(){},proto.uploadData=function(f32buffer,ui32buffer,vertexDataOffset){var node=this._node;if(0===this._displayedOpacity)return 0;node._quadsDirty&&node._rebuildQuads();var opacity=this._displayedOpacity,r=this._displayedColor.r,g=this._displayedColor.g,b=this._displayedColor.b;if(node._opacityModifyRGB){var a=opacity/255;r*=a,g*=a,b*=a}this._color[0]=opacity<<24|b<<16|g<<8|r;var z=node._vertexZ,vertices=node._vertices,uvs=node._uvs,types=Scale9Sprite.RenderingType,offset=vertexDataOffset,len=0;switch(node._renderingType){case types.SIMPLE:len=this._node._vertCount;for(var i=0,srcOff=0;i<len;i++,srcOff+=2)f32buffer[offset]=vertices[srcOff],f32buffer[offset+1]=vertices[srcOff+1],f32buffer[offset+2]=z,ui32buffer[offset+3]=this._color[0],f32buffer[offset+4]=uvs[srcOff],f32buffer[offset+5]=uvs[srcOff+1],offset+=6;break;case types.SLICED:len=this._uploadSliced(vertices,uvs,this._color,z,f32buffer,ui32buffer,offset)}return len},proto.setState=function(state){state===Scale9Sprite.state.NORMAL?this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR):state===Scale9Sprite.state.GRAY&&(this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR_GRAY))}}}(),ccui.Layout=ccui.Widget.extend({_clippingEnabled:!1,_backGroundScale9Enabled:null,_backGroundImage:null,_backGroundImageFileName:null,_backGroundImageCapInsets:null,_colorType:null,_bgImageTexType:ccui.Widget.LOCAL_TEXTURE,_colorRender:null,_gradientRender:null,_color:null,_startColor:null,_endColor:null,_alongVector:null,_opacity:255,_backGroundImageTextureSize:null,_layoutType:null,_doLayoutDirty:!0,_clippingRectDirty:!0,_clippingType:null,_clippingStencil:null,_scissorRectDirty:!1,_clippingRect:null,_clippingParent:null,_className:"Layout",_backGroundImageColor:null,_finalPositionX:0,_finalPositionY:0,_backGroundImageOpacity:0,_loopFocus:!1,__passFocusToChild:!0,_isFocusPassing:!1,_isInterceptTouch:!1,ctor:function(){this._layoutType=ccui.Layout.ABSOLUTE,this._widgetType=ccui.Widget.TYPE_CONTAINER,this._clippingType=ccui.Layout.CLIPPING_SCISSOR,this._colorType=ccui.Layout.BG_COLOR_NONE,ccui.Widget.prototype.ctor.call(this),this.ignoreContentAdaptWithSize(!1),this.setContentSize(cc.size(0,0)),this.setAnchorPoint(0,0),this.onPassFocusToChild=this._findNearestChildWidgetIndex.bind(this),this._backGroundImageCapInsets=cc.rect(0,0,0,0),this._color=cc.color(255,255,255,255),this._startColor=cc.color(255,255,255,255),this._endColor=cc.color(255,255,255,255),this._alongVector=cc.p(0,-1),this._backGroundImageTextureSize=cc.size(0,0),this._clippingRect=cc.rect(0,0,0,0),this._backGroundImageColor=cc.color(255,255,255,255)},onEnter:function(){ccui.Widget.prototype.onEnter.call(this),this._clippingStencil&&this._clippingStencil._performRecursive(cc.Node._stateCallbackType.onEnter),this._doLayoutDirty=!0,this._clippingRectDirty=!0},onExit:function(){ccui.Widget.prototype.onExit.call(this),this._clippingStencil&&this._clippingStencil._performRecursive(cc.Node._stateCallbackType.onExit)},visit:function(parent){if(this._visible){this._adaptRenderers(),this._doLayout();cc.renderer;var cmd=this._renderCmd,parentCmd=parent&&parent._renderCmd;cmd.visit(parentCmd);var stencilClipping=this._clippingEnabled&&this._clippingType===ccui.Layout.CLIPPING_STENCIL,scissorClipping=this._clippingEnabled&&this._clippingType===ccui.Layout.CLIPPING_SCISSOR;stencilClipping?cmd.stencilClippingVisit(parentCmd):scissorClipping&&cmd.scissorClippingVisit(parentCmd);var i,child,j,pChild,children=this._children,len=children.length,pChildren=this._protectedChildren,pLen=pChildren.length;for(this._reorderChildDirty&&this.sortAllChildren(),this._reorderProtectedChildDirty&&this.sortAllProtectedChildren(),i=0;i<len&&(child=children[i])._localZOrder<0;i++)child.visit(this);for(j=0;j<pLen&&(pChild=pChildren[j])._localZOrder<0;j++)cmd._changeProtectedChild(pChild),pChild.visit(this);for(;i<len;i++)children[i].visit(this);for(;j<pLen;j++)pChild=pChildren[j],cmd._changeProtectedChild(pChild),pChild.visit(this);stencilClipping?cmd.postStencilVisit():scissorClipping&&cmd.postScissorVisit(),cmd._dirtyFlag=0}},setLoopFocus:function(loop){this._loopFocus=loop},isLoopFocus:function(){return this._loopFocus},setPassFocusToChild:function(pass){this.__passFocusToChild=pass},isPassFocusToChild:function(){return this.__passFocusToChild},findNextFocusedWidget:function(direction,current){if(this._isFocusPassing||this.isFocused()){var parent=this.getParent();if(this._isFocusPassing=!1,this.__passFocusToChild){var w=this._passFocusToChild(direction,current);return w instanceof ccui.Layout&&parent?(parent._isFocusPassing=!0,parent.findNextFocusedWidget(direction,this)):w}return null!=parent&&parent instanceof ccui.Layout?(parent._isFocusPassing=!0,parent.findNextFocusedWidget(direction,this)):this}if(!(current.isFocused()||current instanceof ccui.Layout))return current;if(this._layoutType===ccui.Layout.LINEAR_HORIZONTAL)switch(direction){case ccui.Widget.LEFT:return this._getPreviousFocusedWidget(direction,current);case ccui.Widget.RIGHT:return this._getNextFocusedWidget(direction,current);case ccui.Widget.DOWN:case ccui.Widget.UP:return this._isLastWidgetInContainer(this,direction)?this._isWidgetAncestorSupportLoopFocus(current,direction)?ccui.Widget.prototype.findNextFocusedWidget.call(this,direction,this):current:ccui.Widget.prototype.findNextFocusedWidget.call(this,direction,this);default:return cc.assert(0,"Invalid Focus Direction"),current}else{if(this._layoutType!==ccui.Layout.LINEAR_VERTICAL)return cc.assert(0,"Un Supported Layout type, please use VBox and HBox instead!!!"),current;switch(direction){case ccui.Widget.LEFT:case ccui.Widget.RIGHT:return this._isLastWidgetInContainer(this,direction)?this._isWidgetAncestorSupportLoopFocus(current,direction)?ccui.Widget.prototype.findNextFocusedWidget.call(this,direction,this):current:ccui.Widget.prototype.findNextFocusedWidget.call(this,direction,this);case ccui.Widget.DOWN:return this._getNextFocusedWidget(direction,current);case ccui.Widget.UP:return this._getPreviousFocusedWidget(direction,current);default:return cc.assert(0,"Invalid Focus Direction"),current}}},onPassFocusToChild:null,addChild:function(widget,zOrder,tag){widget instanceof ccui.Widget&&this._supplyTheLayoutParameterLackToChild(widget),ccui.Widget.prototype.addChild.call(this,widget,zOrder,tag),this._doLayoutDirty=!0},removeChild:function(widget,cleanup){ccui.Widget.prototype.removeChild.call(this,widget,cleanup),this._doLayoutDirty=!0},removeAllChildren:function(cleanup){ccui.Widget.prototype.removeAllChildren.call(this,cleanup),this._doLayoutDirty=!0},removeAllChildrenWithCleanup:function(cleanup){ccui.Widget.prototype.removeAllChildrenWithCleanup.call(this,cleanup),this._doLayoutDirty=!0},isClippingEnabled:function(){return this._clippingEnabled},setClippingEnabled:function(able){if(able!==this._clippingEnabled)switch(this._clippingEnabled=able,this._clippingType){case ccui.Layout.CLIPPING_SCISSOR:case ccui.Layout.CLIPPING_STENCIL:able?(this._clippingStencil=new cc.DrawNode,this._renderCmd.rebindStencilRendering(this._clippingStencil),this._running&&this._clippingStencil._performRecursive(cc.Node._stateCallbackType.onEnter),this._setStencilClippingSize(this._contentSize)):(this._running&&this._clippingStencil&&this._clippingStencil._performRecursive(cc.Node._stateCallbackType.onExit),this._clippingStencil=null)}},setClippingType:function(type){if(type!==this._clippingType){var clippingEnabled=this.isClippingEnabled();this.setClippingEnabled(!1),this._clippingType=type,this.setClippingEnabled(clippingEnabled)}},getClippingType:function(){return this._clippingType},_setStencilClippingSize:function(size){if(this._clippingEnabled){var rect=[];rect[0]=cc.p(0,0),rect[1]=cc.p(size.width,0),rect[2]=cc.p(size.width,size.height),rect[3]=cc.p(0,size.height);var green=cc.color.GREEN;this._clippingStencil.clear(),this._clippingStencil.setLocalBB&&this._clippingStencil.setLocalBB(0,0,size.width,size.height),this._clippingStencil.drawPoly(rect,4,green,0,green)}},_getClippingRect:function(){if(this._clippingRectDirty){for(var parentClippingRect,worldPos=this.convertToWorldSpace(cc.p(0,0)),t=this.getNodeToWorldTransform(),scissorWidth=this._contentSize.width*t.a,scissorHeight=this._contentSize.height*t.d,parent=this;parent;)if((parent=parent.getParent())&&parent instanceof ccui.Layout&&parent.isClippingEnabled()){this._clippingParent=parent;break}if(this._clippingParent){parentClippingRect=this._clippingParent._getClippingRect(),this._clippingRect.x=Math.max(worldPos.x,parentClippingRect.x),this._clippingRect.y=Math.max(worldPos.y,parentClippingRect.y);var right=Math.min(worldPos.x+scissorWidth,parentClippingRect.x+parentClippingRect.width),top=Math.min(worldPos.y+scissorHeight,parentClippingRect.y+parentClippingRect.height);this._clippingRect.width=Math.max(0,right-this._clippingRect.x),this._clippingRect.height=Math.max(0,top-this._clippingRect.y)}else this._clippingRect.x=worldPos.x,this._clippingRect.y=worldPos.y,this._clippingRect.width=scissorWidth,this._clippingRect.height=scissorHeight;this._clippingRectDirty=!1}return this._clippingRect},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);var locContentSize=this._contentSize;this._setStencilClippingSize(locContentSize),this._doLayoutDirty=!0,this._clippingRectDirty=!0,this._backGroundImage&&(this._backGroundImage.setPosition(.5*locContentSize.width,.5*locContentSize.height),this._backGroundScale9Enabled&&this._backGroundImage instanceof ccui.Scale9Sprite&&this._backGroundImage.setPreferredSize(locContentSize)),this._colorRender&&this._colorRender.setContentSize(locContentSize),this._gradientRender&&this._gradientRender.setContentSize(locContentSize)},setBackGroundImageScale9Enabled:function(able){this._backGroundScale9Enabled!==able&&(this.removeProtectedChild(this._backGroundImage),this._backGroundImage=null,this._backGroundScale9Enabled=able,this._addBackGroundImage(),this.setBackGroundImage(this._backGroundImageFileName,this._bgImageTexType),this.setBackGroundImageCapInsets(this._backGroundImageCapInsets))},isBackGroundImageScale9Enabled:function(){return this._backGroundScale9Enabled},setBackGroundImage:function(fileName,texType){if(fileName){texType=texType||ccui.Widget.LOCAL_TEXTURE,null===this._backGroundImage&&(this._addBackGroundImage(),this.setBackGroundImageScale9Enabled(this._backGroundScale9Enabled)),this._backGroundImageFileName=fileName,this._bgImageTexType=texType;var locBackgroundImage=this._backGroundImage;switch(this._bgImageTexType){case ccui.Widget.LOCAL_TEXTURE:locBackgroundImage.initWithFile(fileName);break;case ccui.Widget.PLIST_TEXTURE:locBackgroundImage.initWithSpriteFrameName(fileName)}this._backGroundScale9Enabled&&locBackgroundImage.setPreferredSize(this._contentSize),this._backGroundImageTextureSize=locBackgroundImage.getContentSize(),locBackgroundImage.setPosition(.5*this._contentSize.width,.5*this._contentSize.height),this._updateBackGroundImageColor()}},setBackGroundImageCapInsets:function(capInsets){if(capInsets){var locInsets=this._backGroundImageCapInsets;locInsets.x=capInsets.x,locInsets.y=capInsets.y,locInsets.width=capInsets.width,locInsets.height=capInsets.height,this._backGroundScale9Enabled&&this._backGroundImage.setCapInsets(capInsets)}},getBackGroundImageCapInsets:function(){return cc.rect(this._backGroundImageCapInsets)},_supplyTheLayoutParameterLackToChild:function(locChild){if(locChild)switch(this._layoutType){case ccui.Layout.ABSOLUTE:break;case ccui.Layout.LINEAR_HORIZONTAL:case ccui.Layout.LINEAR_VERTICAL:(layoutParameter=locChild.getLayoutParameter(ccui.LayoutParameter.LINEAR))||locChild.setLayoutParameter(new ccui.LinearLayoutParameter);break;case ccui.Layout.RELATIVE:var layoutParameter=locChild.getLayoutParameter(ccui.LayoutParameter.RELATIVE);layoutParameter||locChild.setLayoutParameter(new ccui.RelativeLayoutParameter)}},_addBackGroundImage:function(){var contentSize=this._contentSize;this._backGroundScale9Enabled?(this._backGroundImage=new ccui.Scale9Sprite,this._backGroundImage.setPreferredSize(contentSize)):this._backGroundImage=new cc.Sprite,this.addProtectedChild(this._backGroundImage,ccui.Layout.BACKGROUND_IMAGE_ZORDER,-1),this._backGroundImage.setPosition(.5*contentSize.width,.5*contentSize.height)},removeBackGroundImage:function(){this._backGroundImage&&(this.removeProtectedChild(this._backGroundImage),this._backGroundImage=null,this._backGroundImageFileName="",this._backGroundImageTextureSize.width=0,this._backGroundImageTextureSize.height=0)},setBackGroundColorType:function(type){if(this._colorType!==type){switch(this._colorType){case ccui.Layout.BG_COLOR_NONE:this._colorRender&&(this.removeProtectedChild(this._colorRender),this._colorRender=null),this._gradientRender&&(this.removeProtectedChild(this._gradientRender),this._gradientRender=null);break;case ccui.Layout.BG_COLOR_SOLID:this._colorRender&&(this.removeProtectedChild(this._colorRender),this._colorRender=null);break;case ccui.Layout.BG_COLOR_GRADIENT:this._gradientRender&&(this.removeProtectedChild(this._gradientRender),this._gradientRender=null)}switch(this._colorType=type,this._colorType){case ccui.Layout.BG_COLOR_NONE:break;case ccui.Layout.BG_COLOR_SOLID:this._colorRender=new cc.LayerColor,this._colorRender.setContentSize(this._contentSize),this._colorRender.setOpacity(this._opacity),this._colorRender.setColor(this._color),this.addProtectedChild(this._colorRender,ccui.Layout.BACKGROUND_RENDERER_ZORDER,-1);break;case ccui.Layout.BG_COLOR_GRADIENT:this._gradientRender=new cc.LayerGradient(cc.color(255,0,0,255),cc.color(0,255,0,255)),this._gradientRender.setContentSize(this._contentSize),this._gradientRender.setOpacity(this._opacity),this._gradientRender.setStartColor(this._startColor),this._gradientRender.setEndColor(this._endColor),this._gradientRender.setVector(this._alongVector),this.addProtectedChild(this._gradientRender,ccui.Layout.BACKGROUND_RENDERER_ZORDER,-1)}}},getBackGroundColorType:function(){return this._colorType},setBackGroundColor:function(color,endColor){endColor?(this._startColor.r=color.r,this._startColor.g=color.g,this._startColor.b=color.b,this._gradientRender&&this._gradientRender.setStartColor(color),this._endColor.r=endColor.r,this._endColor.g=endColor.g,this._endColor.b=endColor.b,this._gradientRender&&this._gradientRender.setEndColor(endColor)):(this._color.r=color.r,this._color.g=color.g,this._color.b=color.b,this._colorRender&&this._colorRender.setColor(color))},getBackGroundColor:function(){var tmpColor=this._color;return cc.color(tmpColor.r,tmpColor.g,tmpColor.b,tmpColor.a)},getBackGroundStartColor:function(){var tmpColor=this._startColor;return cc.color(tmpColor.r,tmpColor.g,tmpColor.b,tmpColor.a)},getBackGroundEndColor:function(){var tmpColor=this._endColor;return cc.color(tmpColor.r,tmpColor.g,tmpColor.b,tmpColor.a)},setBackGroundColorOpacity:function(opacity){switch(this._opacity=opacity,this._colorType){case ccui.Layout.BG_COLOR_NONE:break;case ccui.Layout.BG_COLOR_SOLID:this._colorRender.setOpacity(opacity);break;case ccui.Layout.BG_COLOR_GRADIENT:this._gradientRender.setOpacity(opacity)}},getBackGroundColorOpacity:function(){return this._opacity},setBackGroundColorVector:function(vector){this._alongVector.x=vector.x,this._alongVector.y=vector.y,this._gradientRender&&this._gradientRender.setVector(vector)},getBackGroundColorVector:function(){return this._alongVector},setBackGroundImageColor:function(color){this._backGroundImageColor.r=color.r,this._backGroundImageColor.g=color.g,this._backGroundImageColor.b=color.b,this._updateBackGroundImageColor()},setBackGroundImageOpacity:function(opacity){this._backGroundImageColor.a=opacity,this.getBackGroundImageColor()},getBackGroundImageColor:function(){var color=this._backGroundImageColor;return cc.color(color.r,color.g,color.b,color.a)},getBackGroundImageOpacity:function(){return this._backGroundImageColor.a},_updateBackGroundImageColor:function(){this._backGroundImage&&this._backGroundImage.setColor(this._backGroundImageColor)},getBackGroundImageTextureSize:function(){return this._backGroundImageTextureSize},setLayoutType:function(type){this._layoutType=type;for(var layoutChildrenArray=this._children,locChild=null,i=0;i<layoutChildrenArray.length;i++)(locChild=layoutChildrenArray[i])instanceof ccui.Widget&&this._supplyTheLayoutParameterLackToChild(locChild);this._doLayoutDirty=!0},getLayoutType:function(){return this._layoutType},requestDoLayout:function(){this._doLayoutDirty=!0},_doLayout:function(){if(this._doLayoutDirty){this.sortAllChildren();var executant=ccui.getLayoutManager(this._layoutType);executant&&executant._doLayout(this),this._doLayoutDirty=!1}},_getLayoutContentSize:function(){return this.getContentSize()},_getLayoutElements:function(){return this.getChildren()},_updateBackGroundImageOpacity:function(){this._backGroundImage&&this._backGroundImage.setOpacity(this._backGroundImageOpacity)},_updateBackGroundImageRGBA:function(){this._backGroundImage&&(this._backGroundImage.setColor(this._backGroundImageColor),this._backGroundImage.setOpacity(this._backGroundImageOpacity))},_getLayoutAccumulatedSize:function(){for(var locSize,children=this.getChildren(),layoutSize=cc.size(0,0),widgetCount=0,i=0,len=children.length;i<len;i++){var layout=children[i];if(null!==layout&&layout instanceof ccui.Layout)locSize=layout._getLayoutAccumulatedSize(),layoutSize.width+=locSize.width,layoutSize.height+=locSize.height;else if(layout instanceof ccui.Widget){widgetCount++;var m=layout.getLayoutParameter().getMargin();locSize=layout.getContentSize(),layoutSize.width+=locSize.width+.5*(m.right+m.left),layoutSize.height+=locSize.height+.5*(m.top+m.bottom)}}var type=this.getLayoutType();return type===ccui.Layout.LINEAR_HORIZONTAL&&(layoutSize.height=layoutSize.height-layoutSize.height/widgetCount*(widgetCount-1)),type===ccui.Layout.LINEAR_VERTICAL&&(layoutSize.width=layoutSize.width-layoutSize.width/widgetCount*(widgetCount-1)),layoutSize},_findNearestChildWidgetIndex:function(direction,baseWidget){if(null==baseWidget||baseWidget===this)return this._findFirstFocusEnabledWidgetIndex();var widgetPosition,index=0,locChildren=this.getChildren(),count=locChildren.length,distance=cc.FLT_MAX,found=0;if(direction===ccui.Widget.LEFT||direction===ccui.Widget.RIGHT||direction===ccui.Widget.DOWN||direction===ccui.Widget.UP){for(widgetPosition=this._getWorldCenterPoint(baseWidget);index<count;){var w=locChildren[index];if(w&&w instanceof ccui.Widget&&w.isFocusEnabled()){var length=w instanceof ccui.Layout?w._calculateNearestDistance(baseWidget):cc.pLength(cc.pSub(this._getWorldCenterPoint(w),widgetPosition));length<distance&&(found=index,distance=length)}index++}return found}return cc.log("invalid focus direction!"),0},_findFarthestChildWidgetIndex:function(direction,baseWidget){if(null==baseWidget||baseWidget===this)return this._findFirstFocusEnabledWidgetIndex();var index=0,locChildren=this.getChildren(),count=locChildren.length,distance=-cc.FLT_MAX,found=0;if(direction===ccui.Widget.LEFT||direction===ccui.Widget.RIGHT||direction===ccui.Widget.DOWN||direction===ccui.Widget.UP){for(var widgetPosition=this._getWorldCenterPoint(baseWidget);index<count;){var w=locChildren[index];if(w&&w instanceof ccui.Widget&&w.isFocusEnabled()){var length=w instanceof ccui.Layout?w._calculateFarthestDistance(baseWidget):cc.pLength(cc.pSub(this._getWorldCenterPoint(w),widgetPosition));length>distance&&(found=index,distance=length)}index++}return found}return cc.log("invalid focus direction!!!"),0},_calculateNearestDistance:function(baseWidget){for(var distance=cc.FLT_MAX,widgetPosition=this._getWorldCenterPoint(baseWidget),locChildren=this._children,i=0,len=locChildren.length;i<len;i++){var length,widget=locChildren[i];if(widget instanceof ccui.Layout)length=widget._calculateNearestDistance(baseWidget);else{if(!(widget instanceof ccui.Widget&&widget.isFocusEnabled()))continue;length=cc.pLength(cc.pSub(this._getWorldCenterPoint(widget),widgetPosition))}length<distance&&(distance=length)}return distance},_calculateFarthestDistance:function(baseWidget){for(var distance=-cc.FLT_MAX,widgetPosition=this._getWorldCenterPoint(baseWidget),locChildren=this._children,i=0,len=locChildren.length;i<len;i++){var length,layout=locChildren[i];if(layout instanceof ccui.Layout)length=layout._calculateFarthestDistance(baseWidget);else{if(!(layout instanceof ccui.Widget&&layout.isFocusEnabled()))continue;var wPosition=this._getWorldCenterPoint(layout);length=cc.pLength(cc.pSub(wPosition,widgetPosition))}length>distance&&(distance=length)}return distance},_findProperSearchingFunctor:function(direction,baseWidget){if(void 0!==baseWidget){var previousWidgetPosition=this._getWorldCenterPoint(baseWidget),widgetPosition=this._getWorldCenterPoint(this._findFirstNonLayoutWidget());direction===ccui.Widget.LEFT?this.onPassFocusToChild=previousWidgetPosition.x>widgetPosition.x?this._findNearestChildWidgetIndex:this._findFarthestChildWidgetIndex:direction===ccui.Widget.RIGHT?this.onPassFocusToChild=previousWidgetPosition.x>widgetPosition.x?this._findFarthestChildWidgetIndex:this._findNearestChildWidgetIndex:direction===ccui.Widget.DOWN?this.onPassFocusToChild=previousWidgetPosition.y>widgetPosition.y?this._findNearestChildWidgetIndex:this._findFarthestChildWidgetIndex:direction===ccui.Widget.UP?this.onPassFocusToChild=previousWidgetPosition.y<widgetPosition.y?this._findNearestChildWidgetIndex:this._findFarthestChildWidgetIndex:cc.log("invalid direction!")}},_findFirstNonLayoutWidget:function(){for(var locChildren=this._children,i=0,len=locChildren.length;i<len;i++){var child=locChildren[i];if(child instanceof ccui.Layout){var widget=child._findFirstNonLayoutWidget();if(widget)return widget}else if(child instanceof ccui.Widget)return child}return null},_findFirstFocusEnabledWidgetIndex:function(){for(var index=0,locChildren=this.getChildren(),count=locChildren.length;index<count;){var w=locChildren[index];if(w&&w instanceof ccui.Widget&&w.isFocusEnabled())return index;index++}return 0},_findFocusEnabledChildWidgetByIndex:function(index){var widget=this._getChildWidgetByIndex(index);return widget?widget.isFocusEnabled()?widget:(index+=1,this._findFocusEnabledChildWidgetByIndex(index)):null},_getWorldCenterPoint:function(widget){var widgetSize=widget instanceof ccui.Layout?widget._getLayoutAccumulatedSize():widget.getContentSize();return widget.convertToWorldSpace(cc.p(widgetSize.width/2,widgetSize.height/2))},_getNextFocusedWidget:function(direction,current){var nextWidget=null,locChildren=this._children,previousWidgetPos=locChildren.indexOf(current);return(previousWidgetPos+=1)<locChildren.length?(nextWidget=this._getChildWidgetByIndex(previousWidgetPos))?nextWidget.isFocusEnabled()?nextWidget instanceof ccui.Layout?(nextWidget._isFocusPassing=!0,nextWidget.findNextFocusedWidget(direction,nextWidget)):(this.dispatchFocusEvent(current,nextWidget),nextWidget):this._getNextFocusedWidget(direction,nextWidget):current:this._loopFocus?this._checkFocusEnabledChild()?(previousWidgetPos=0,(nextWidget=this._getChildWidgetByIndex(previousWidgetPos)).isFocusEnabled()?nextWidget instanceof ccui.Layout?(nextWidget._isFocusPassing=!0,nextWidget.findNextFocusedWidget(direction,nextWidget)):(this.dispatchFocusEvent(current,nextWidget),nextWidget):this._getNextFocusedWidget(direction,nextWidget)):current instanceof ccui.Layout?current:ccui.Widget._focusedWidget:this._isLastWidgetInContainer(current,direction)?this._isWidgetAncestorSupportLoopFocus(this,direction)?ccui.Widget.prototype.findNextFocusedWidget.call(this,direction,this):current instanceof ccui.Layout?current:ccui.Widget._focusedWidget:ccui.Widget.prototype.findNextFocusedWidget.call(this,direction,this)},_getPreviousFocusedWidget:function(direction,current){var nextWidget=null,locChildren=this._children,previousWidgetPos=locChildren.indexOf(current);return(previousWidgetPos-=1)>=0?(nextWidget=this._getChildWidgetByIndex(previousWidgetPos)).isFocusEnabled()?nextWidget instanceof ccui.Layout?(nextWidget._isFocusPassing=!0,nextWidget.findNextFocusedWidget(direction,nextWidget)):(this.dispatchFocusEvent(current,nextWidget),nextWidget):this._getPreviousFocusedWidget(direction,nextWidget):this._loopFocus?this._checkFocusEnabledChild()?(previousWidgetPos=locChildren.length-1,(nextWidget=this._getChildWidgetByIndex(previousWidgetPos)).isFocusEnabled()?nextWidget instanceof ccui.Layout?(nextWidget._isFocusPassing=!0,nextWidget.findNextFocusedWidget(direction,nextWidget)):(this.dispatchFocusEvent(current,nextWidget),nextWidget):this._getPreviousFocusedWidget(direction,nextWidget)):current instanceof ccui.Layout?current:ccui.Widget._focusedWidget:this._isLastWidgetInContainer(current,direction)?this._isWidgetAncestorSupportLoopFocus(this,direction)?ccui.Widget.prototype.findNextFocusedWidget.call(this,direction,this):current instanceof ccui.Layout?current:ccui.Widget._focusedWidget:ccui.Widget.prototype.findNextFocusedWidget.call(this,direction,this)},_getChildWidgetByIndex:function(index){for(var locChildren=this._children,size=locChildren.length,count=0,oldIndex=index;index<size;){var firstChild=locChildren[index];if(firstChild&&firstChild instanceof ccui.Widget)return firstChild;count++,index++}for(var begin=0;begin<oldIndex;){var child=locChildren[begin];if(child&&child instanceof ccui.Widget)return child;count++,begin++}return null},_isLastWidgetInContainer:function(widget,direction){var parent=widget.getParent();if(null==parent||!(parent instanceof ccui.Layout))return!0;var container=parent.getChildren(),index=container.indexOf(widget);if(parent.getLayoutType()===ccui.Layout.LINEAR_HORIZONTAL){if(direction===ccui.Widget.LEFT)return 0===index&&this._isLastWidgetInContainer(parent,direction);if(direction===ccui.Widget.RIGHT)return index===container.length-1&&this._isLastWidgetInContainer(parent,direction);if(direction===ccui.Widget.DOWN)return this._isLastWidgetInContainer(parent,direction);if(direction===ccui.Widget.UP)return this._isLastWidgetInContainer(parent,direction)}else{if(parent.getLayoutType()!==ccui.Layout.LINEAR_VERTICAL)return cc.log("invalid layout Type"),!1;if(direction===ccui.Widget.UP)return 0===index&&this._isLastWidgetInContainer(parent,direction);if(direction===ccui.Widget.DOWN)return index===container.length-1&&this._isLastWidgetInContainer(parent,direction);if(direction===ccui.Widget.LEFT)return this._isLastWidgetInContainer(parent,direction);if(direction===ccui.Widget.RIGHT)return this._isLastWidgetInContainer(parent,direction)}},_isWidgetAncestorSupportLoopFocus:function(widget,direction){var parent=widget.getParent();if(null==parent||!(parent instanceof ccui.Layout))return!1;if(parent.isLoopFocus()){var layoutType=parent.getLayoutType();return layoutType===ccui.Layout.LINEAR_HORIZONTAL?direction===ccui.Widget.LEFT||direction===ccui.Widget.RIGHT||this._isWidgetAncestorSupportLoopFocus(parent,direction):layoutType===ccui.Layout.LINEAR_VERTICAL?direction===ccui.Widget.DOWN||direction===ccui.Widget.UP||this._isWidgetAncestorSupportLoopFocus(parent,direction):(cc.assert(0,"invalid layout type"),!1)}return this._isWidgetAncestorSupportLoopFocus(parent,direction)},_passFocusToChild:function(direction,current){if(this._checkFocusEnabledChild()){var previousWidget=ccui.Widget.getCurrentFocusedWidget();this._findProperSearchingFunctor(direction,previousWidget);var index=this.onPassFocusToChild(direction,previousWidget),widget=this._getChildWidgetByIndex(index);return widget instanceof ccui.Layout?(widget._isFocusPassing=!0,widget.findNextFocusedWidget(direction,widget)):(this.dispatchFocusEvent(current,widget),widget)}return this},_checkFocusEnabledChild:function(){for(var locChildren=this._children,i=0,len=locChildren.length;i<len;i++){var widget=locChildren[i];if(widget&&widget instanceof ccui.Widget&&widget.isFocusEnabled())return!0}return!1},getDescription:function(){return"Layout"},_createCloneInstance:function(){return new ccui.Layout},_copyClonedWidgetChildren:function(model){ccui.Widget.prototype._copyClonedWidgetChildren.call(this,model)},_copySpecialProperties:function(layout){layout instanceof ccui.Layout&&(this.setBackGroundImageScale9Enabled(layout._backGroundScale9Enabled),this.setBackGroundImage(layout._backGroundImageFileName,layout._bgImageTexType),this.setBackGroundImageCapInsets(layout._backGroundImageCapInsets),this.setBackGroundColorType(layout._colorType),this.setBackGroundColor(layout._color),this.setBackGroundColor(layout._startColor,layout._endColor),this.setBackGroundColorOpacity(layout._opacity),this.setBackGroundColorVector(layout._alongVector),this.setLayoutType(layout._layoutType),this.setClippingEnabled(layout._clippingEnabled),this.setClippingType(layout._clippingType),this._loopFocus=layout._loopFocus,this.__passFocusToChild=layout.__passFocusToChild,this._isInterceptTouch=layout._isInterceptTouch)},forceDoLayout:function(){this.requestDoLayout(),this._doLayout()},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new ccui.Layout.WebGLRenderCmd(this):new ccui.Layout.CanvasRenderCmd(this)}}),(_p=ccui.Layout.prototype).clippingEnabled,cc.defineGetterSetter(_p,"clippingEnabled",_p.isClippingEnabled,_p.setClippingEnabled),_p.clippingType,cc.defineGetterSetter(_p,"clippingType",null,_p.setClippingType),_p.layoutType,cc.defineGetterSetter(_p,"layoutType",_p.getLayoutType,_p.setLayoutType),_p=null,ccui.Layout.create=function(){return new ccui.Layout},ccui.Layout.BG_COLOR_NONE=0,ccui.Layout.BG_COLOR_SOLID=1,ccui.Layout.BG_COLOR_GRADIENT=2,ccui.Layout.ABSOLUTE=0,ccui.Layout.LINEAR_VERTICAL=1,ccui.Layout.LINEAR_HORIZONTAL=2,ccui.Layout.RELATIVE=3,ccui.Layout.CLIPPING_STENCIL=0,ccui.Layout.CLIPPING_SCISSOR=1,ccui.Layout.BACKGROUND_IMAGE_ZORDER=-1,ccui.Layout.BACKGROUND_RENDERER_ZORDER=-2,function(){ccui.Layout.CanvasRenderCmd=function(renderable){this._pNodeCmdCtor(renderable),this._needDraw=!1,this._rendererSaveCmd=null,this._rendererClipCmd=null,this._rendererRestoreCmd=null};var proto=ccui.Layout.CanvasRenderCmd.prototype=Object.create(ccui.ProtectedNode.CanvasRenderCmd.prototype);proto.constructor=ccui.Layout.CanvasRenderCmd,proto._layoutCmdCtor=ccui.Layout.CanvasRenderCmd,proto._onRenderSaveCmd=function(ctx,scaleX,scaleY){var wrapper=ctx||cc._renderContext,context=wrapper.getContext();wrapper.save(),wrapper.save(),wrapper.setTransform(this._worldTransform,scaleX,scaleY);for(var buffer=this._node._clippingStencil._renderCmd._buffer,i=0,bufLen=buffer.length;i<bufLen;i++){var vertices=buffer[i].verts,firstPoint=vertices[0];context.beginPath(),context.moveTo(firstPoint.x,-firstPoint.y);for(var j=1,len=vertices.length;j<len;j++)context.lineTo(vertices[j].x,-vertices[j].y);context.closePath()}},proto._onRenderClipCmd=function(ctx){var wrapper=ctx||cc._renderContext,context=wrapper.getContext();wrapper.restore(),context.clip()},proto._onRenderRestoreCmd=function(ctx){var wrapper=ctx||cc._renderContext;wrapper.getContext();wrapper.restore()},proto.rebindStencilRendering=function(stencil){stencil._renderCmd.rendering=this.__stencilDraw,stencil._renderCmd._canUseDirtyRegion=!0},proto.__stencilDraw=function(ctx,scaleX,scaleY){},proto.stencilClippingVisit=proto.scissorClippingVisit=function(parentCmd){var node=this._node;node._clippingStencil&&node._clippingStencil.isVisible()&&(this._rendererSaveCmd||(this._rendererSaveCmd=new cc.CustomRenderCmd(this,this._onRenderSaveCmd),this._rendererClipCmd=new cc.CustomRenderCmd(this,this._onRenderClipCmd),this._rendererRestoreCmd=new cc.CustomRenderCmd(this,this._onRenderRestoreCmd)),cc.renderer.pushRenderCommand(this._rendererSaveCmd),node._clippingStencil.visit(this),cc.renderer.pushRenderCommand(this._rendererClipCmd))},proto.postStencilVisit=proto.postScissorVisit=function(){cc.renderer.pushRenderCommand(this._rendererRestoreCmd)},ccui.Layout.CanvasRenderCmd._getSharedCache=function(){return cc.ClippingNode._sharedCache||(cc.ClippingNode._sharedCache=document.createElement("canvas"))}}(),function(){if(ccui.ProtectedNode.WebGLRenderCmd){ccui.Layout.WebGLRenderCmd=function(renderable){this._pNodeCmdCtor(renderable),this._needDraw=!1,this._currentStencilEnabled=0,this._scissorOldState=!1,this._clippingOldRect=null,this._mask_layer_le=0,this._beforeVisitCmdStencil=null,this._afterDrawStencilCmd=null,this._afterVisitCmdStencil=null,this._beforeVisitCmdScissor=null,this._afterVisitCmdScissor=null};var proto=ccui.Layout.WebGLRenderCmd.prototype=Object.create(ccui.ProtectedNode.WebGLRenderCmd.prototype);proto.constructor=ccui.Layout.WebGLRenderCmd,proto._layoutCmdCtor=ccui.Layout.CanvasRenderCmd,proto._syncStatus=function(parentCmd){this._originSyncStatus(parentCmd),parentCmd&&parentCmd._dirtyFlag&cc.Node._dirtyFlags.transformDirty&&(this._node._clippingRectDirty=!0)},proto._onBeforeVisitStencil=function(ctx){var gl=ctx||cc._renderContext;ccui.Layout.WebGLRenderCmd._layer++;var mask_layer=1<<ccui.Layout.WebGLRenderCmd._layer,mask_layer_l=mask_layer-1;this._mask_layer_le=mask_layer|mask_layer_l,this._currentStencilEnabled=gl.isEnabled(gl.STENCIL_TEST),gl.clear(gl.DEPTH_BUFFER_BIT),gl.enable(gl.STENCIL_TEST),gl.depthMask(!1),gl.stencilFunc(gl.NEVER,mask_layer,mask_layer),gl.stencilOp(gl.REPLACE,gl.KEEP,gl.KEEP),gl.stencilMask(mask_layer),gl.clear(gl.STENCIL_BUFFER_BIT)},proto._onAfterDrawStencil=function(ctx){var gl=ctx||cc._renderContext;gl.depthMask(!0),gl.stencilFunc(gl.EQUAL,this._mask_layer_le,this._mask_layer_le),gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP)},proto._onAfterVisitStencil=function(ctx){var gl=ctx||cc._renderContext;if(ccui.Layout.WebGLRenderCmd._layer--,this._currentStencilEnabled){var mask_layer=1<<ccui.Layout.WebGLRenderCmd._layer,mask_layer_le=mask_layer|mask_layer-1;gl.stencilMask(mask_layer),gl.stencilFunc(gl.EQUAL,mask_layer_le,mask_layer_le)}else gl.disable(gl.STENCIL_TEST)},proto._onBeforeVisitScissor=function(ctx){this._node._clippingRectDirty=!0;var clippingRect=this._node._getClippingRect(),gl=ctx||cc._renderContext;this._scissorOldState=gl.isEnabled(gl.SCISSOR_TEST),this._scissorOldState?(this._clippingOldRect=cc.view.getScissorRect(),cc.rectEqualToRect(this._clippingOldRect,clippingRect)||cc.view.setScissorInPoints(clippingRect.x,clippingRect.y,clippingRect.width,clippingRect.height)):(gl.enable(gl.SCISSOR_TEST),cc.view.setScissorInPoints(clippingRect.x,clippingRect.y,clippingRect.width,clippingRect.height))},proto._onAfterVisitScissor=function(ctx){var gl=ctx||cc._renderContext;this._scissorOldState?cc.rectEqualToRect(this._clippingOldRect,this._node._clippingRect)||cc.view.setScissorInPoints(this._clippingOldRect.x,this._clippingOldRect.y,this._clippingOldRect.width,this._clippingOldRect.height):gl.disable(gl.SCISSOR_TEST)},proto.rebindStencilRendering=function(stencil){},proto.transform=function(parentCmd,recursive){var node=this._node;this.pNodeTransform(parentCmd,recursive),node._clippingStencil&&node._clippingStencil._renderCmd.transform(this,recursive)},proto.stencilClippingVisit=function(parentCmd){var node=this._node;if(node._clippingStencil&&node._clippingStencil.isVisible()){if(ccui.Layout.WebGLRenderCmd._layer+1===cc.stencilBits)return ccui.Layout.WebGLRenderCmd._visit_once=!0,void(ccui.Layout.WebGLRenderCmd._visit_once&&(cc.log("Nesting more than "+cc.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its childs."),ccui.Layout.WebGLRenderCmd._visit_once=!1));this._beforeVisitCmdStencil||(this._beforeVisitCmdStencil=new cc.CustomRenderCmd(this,this._onBeforeVisitStencil),this._afterDrawStencilCmd=new cc.CustomRenderCmd(this,this._onAfterDrawStencil),this._afterVisitCmdStencil=new cc.CustomRenderCmd(this,this._onAfterVisitStencil)),cc.renderer.pushRenderCommand(this._beforeVisitCmdStencil);var currentStack=cc.current_stack;currentStack.stack.push(currentStack.top),currentStack.top=this._stackMatrix,node._clippingStencil.visit(this),cc.renderer.pushRenderCommand(this._afterDrawStencilCmd)}},proto.postStencilVisit=function(){renderer.pushRenderCommand(cmd._afterVisitCmdStencil),cc.current_stack.top=cc.current_stack.stack.pop()},proto.scissorClippingVisit=function(parentCmd){this._beforeVisitCmdScissor||(this._beforeVisitCmdScissor=new cc.CustomRenderCmd(this,this._onBeforeVisitScissor),this._afterVisitCmdScissor=new cc.CustomRenderCmd(this,this._onAfterVisitScissor)),cc.renderer.pushRenderCommand(this._beforeVisitCmdScissor)},proto.postScissorVisit=function(){cc.renderer.pushRenderCommand(this._afterVisitCmdScissor)},ccui.Layout.WebGLRenderCmd._layer=-1,ccui.Layout.WebGLRenderCmd._visit_once=null}}(),ccui.Margin=ccui.Class.extend({left:0,top:0,right:0,bottom:0,ctor:function(margin,top,right,bottom){void 0!==margin&&void 0===top&&(this.left=margin.left,this.top=margin.top,this.right=margin.right,this.bottom=margin.bottom),void 0!==bottom&&(this.left=margin,this.top=top,this.right=right,this.bottom=bottom)},setMargin:function(l,t,r,b){this.left=l,this.top=t,this.right=r,this.bottom=b},equals:function(target){return this.left===target.left&&this.top===target.top&&this.right===target.right&&this.bottom===target.bottom}}),ccui.MarginZero=function(){return new ccui.Margin(0,0,0,0)},ccui.LayoutParameter=ccui.Class.extend({_margin:null,_layoutParameterType:null,ctor:function(){this._margin=new ccui.Margin,this._layoutParameterType=ccui.LayoutParameter.NONE},setMargin:function(margin){cc.isObject(margin)?(this._margin.left=margin.left,this._margin.top=margin.top,this._margin.right=margin.right,this._margin.bottom=margin.bottom):(this._margin.left=arguments[0],this._margin.top=arguments[1],this._margin.right=arguments[2],this._margin.bottom=arguments[3])},getMargin:function(){return this._margin},getLayoutType:function(){return this._layoutParameterType},clone:function(){var parameter=this._createCloneInstance();return parameter._copyProperties(this),parameter},_createCloneInstance:function(){return new ccui.LayoutParameter},_copyProperties:function(model){this._margin.bottom=model._margin.bottom,this._margin.left=model._margin.left,this._margin.right=model._margin.right,this._margin.top=model._margin.top}}),ccui.LayoutParameter.create=function(){return new ccui.LayoutParameter},ccui.LayoutParameter.NONE=0,ccui.LayoutParameter.LINEAR=1,ccui.LayoutParameter.RELATIVE=2,ccui.LinearLayoutParameter=ccui.LayoutParameter.extend({_linearGravity:null,ctor:function(){ccui.LayoutParameter.prototype.ctor.call(this),this._linearGravity=ccui.LinearLayoutParameter.NONE,this._layoutParameterType=ccui.LayoutParameter.LINEAR},setGravity:function(gravity){this._linearGravity=gravity},getGravity:function(){return this._linearGravity},_createCloneInstance:function(){return new ccui.LinearLayoutParameter},_copyProperties:function(model){ccui.LayoutParameter.prototype._copyProperties.call(this,model),model instanceof ccui.LinearLayoutParameter&&this.setGravity(model._linearGravity)}}),ccui.LinearLayoutParameter.create=function(){return new ccui.LinearLayoutParameter},ccui.LinearLayoutParameter.NONE=0,ccui.LinearLayoutParameter.LEFT=1,ccui.LinearLayoutParameter.TOP=2,ccui.LinearLayoutParameter.RIGHT=3,ccui.LinearLayoutParameter.BOTTOM=4,ccui.LinearLayoutParameter.CENTER_VERTICAL=5,ccui.LinearLayoutParameter.CENTER_HORIZONTAL=6,ccui.RelativeLayoutParameter=ccui.LayoutParameter.extend({_relativeAlign:null,_relativeWidgetName:"",_relativeLayoutName:"",_put:!1,ctor:function(){ccui.LayoutParameter.prototype.ctor.call(this),this._relativeAlign=ccui.RelativeLayoutParameter.NONE,this._relativeWidgetName="",this._relativeLayoutName="",this._put=!1,this._layoutParameterType=ccui.LayoutParameter.RELATIVE},setAlign:function(align){this._relativeAlign=align},getAlign:function(){return this._relativeAlign},setRelativeToWidgetName:function(name){this._relativeWidgetName=name},getRelativeToWidgetName:function(){return this._relativeWidgetName},setRelativeName:function(name){this._relativeLayoutName=name},getRelativeName:function(){return this._relativeLayoutName},_createCloneInstance:function(){return new ccui.RelativeLayoutParameter},_copyProperties:function(model){ccui.LayoutParameter.prototype._copyProperties.call(this,model),model instanceof ccui.RelativeLayoutParameter&&(this.setAlign(model._relativeAlign),this.setRelativeToWidgetName(model._relativeWidgetName),this.setRelativeName(model._relativeLayoutName))}}),ccui.RelativeLayoutParameter.create=function(){return new ccui.RelativeLayoutParameter},ccui.RelativeLayoutParameter.NONE=0,ccui.RelativeLayoutParameter.PARENT_TOP_LEFT=1,ccui.RelativeLayoutParameter.PARENT_TOP_CENTER_HORIZONTAL=2,ccui.RelativeLayoutParameter.PARENT_TOP_RIGHT=3,ccui.RelativeLayoutParameter.PARENT_LEFT_CENTER_VERTICAL=4,ccui.RelativeLayoutParameter.CENTER_IN_PARENT=5,ccui.RelativeLayoutParameter.PARENT_RIGHT_CENTER_VERTICAL=6,ccui.RelativeLayoutParameter.PARENT_LEFT_BOTTOM=7,ccui.RelativeLayoutParameter.PARENT_BOTTOM_CENTER_HORIZONTAL=8,ccui.RelativeLayoutParameter.PARENT_RIGHT_BOTTOM=9,ccui.RelativeLayoutParameter.LOCATION_ABOVE_LEFTALIGN=10,ccui.RelativeLayoutParameter.LOCATION_ABOVE_CENTER=11,ccui.RelativeLayoutParameter.LOCATION_ABOVE_RIGHTALIGN=12,ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_TOPALIGN=13,ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_CENTER=14,ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_BOTTOMALIGN=15,ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_TOPALIGN=16,ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_CENTER=17,ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_BOTTOMALIGN=18,ccui.RelativeLayoutParameter.LOCATION_BELOW_LEFTALIGN=19,ccui.RelativeLayoutParameter.LOCATION_BELOW_CENTER=20,ccui.RelativeLayoutParameter.LOCATION_BELOW_RIGHTALIGN=21,ccui.LINEAR_GRAVITY_NONE=0,ccui.LINEAR_GRAVITY_LEFT=1,ccui.LINEAR_GRAVITY_TOP=2,ccui.LINEAR_GRAVITY_RIGHT=3,ccui.LINEAR_GRAVITY_BOTTOM=4,ccui.LINEAR_GRAVITY_CENTER_VERTICAL=5,ccui.LINEAR_GRAVITY_CENTER_HORIZONTAL=6,ccui.RELATIVE_ALIGN_NONE=0,ccui.RELATIVE_ALIGN_PARENT_TOP_LEFT=1,ccui.RELATIVE_ALIGN_PARENT_TOP_CENTER_HORIZONTAL=2,ccui.RELATIVE_ALIGN_PARENT_TOP_RIGHT=3,ccui.RELATIVE_ALIGN_PARENT_LEFT_CENTER_VERTICAL=4,ccui.RELATIVE_ALIGN_PARENT_CENTER=5,ccui.RELATIVE_ALIGN_PARENT_RIGHT_CENTER_VERTICAL=6,ccui.RELATIVE_ALIGN_PARENT_LEFT_BOTTOM=7,ccui.RELATIVE_ALIGN_PARENT_BOTTOM_CENTER_HORIZONTAL=8,ccui.RELATIVE_ALIGN_PARENT_RIGHT_BOTTOM=9,ccui.RELATIVE_ALIGN_LOCATION_ABOVE_LEFT=10,ccui.RELATIVE_ALIGN_LOCATION_ABOVE_CENTER=11,ccui.RELATIVE_ALIGN_LOCATION_ABOVE_RIGHT=12,ccui.RELATIVE_ALIGN_LOCATION_LEFT_TOP=13,ccui.RELATIVE_ALIGN_LOCATION_LEFT_CENTER=14,ccui.RELATIVE_ALIGN_LOCATION_LEFT_BOTTOM=15,ccui.RELATIVE_ALIGN_LOCATION_RIGHT_TOP=16,ccui.RELATIVE_ALIGN_LOCATION_RIGHT_CENTER=17,ccui.RELATIVE_ALIGN_LOCATION_RIGHT_BOTTOM=18,ccui.RELATIVE_ALIGN_LOCATION_BELOW_TOP=19,ccui.RELATIVE_ALIGN_LOCATION_BELOW_CENTER=20,ccui.RELATIVE_ALIGN_LOCATION_BELOW_BOTTOM=21,ccui.getLayoutManager=function(type){switch(type){case ccui.Layout.LINEAR_VERTICAL:return ccui.linearVerticalLayoutManager;case ccui.Layout.LINEAR_HORIZONTAL:return ccui.linearHorizontalLayoutManager;case ccui.Layout.RELATIVE:return ccui.relativeLayoutManager}return null},ccui.linearVerticalLayoutManager={_doLayout:function(layout){for(var layoutSize=layout._getLayoutContentSize(),container=layout._getLayoutElements(),topBoundary=layoutSize.height,i=0,len=container.length;i<len;i++){var child=container[i];if(child){var layoutParameter=child.getLayoutParameter();if(layoutParameter){var childGravity=layoutParameter.getGravity(),ap=child.getAnchorPoint(),cs=child.getContentSize(),finalPosX=ap.x*cs.width,finalPosY=topBoundary-(1-ap.y)*cs.height;switch(childGravity){case ccui.LinearLayoutParameter.NONE:case ccui.LinearLayoutParameter.LEFT:break;case ccui.LinearLayoutParameter.RIGHT:finalPosX=layoutSize.width-(1-ap.x)*cs.width;break;case ccui.LinearLayoutParameter.CENTER_HORIZONTAL:finalPosX=layoutSize.width/2-cs.width*(.5-ap.x)}var mg=layoutParameter.getMargin();finalPosX+=mg.left,finalPosY-=mg.top,child.setPosition(finalPosX,finalPosY),topBoundary=child.getPositionY()-ap.y*cs.height-mg.bottom}}}}},ccui.linearHorizontalLayoutManager={_doLayout:function(layout){for(var layoutSize=layout._getLayoutContentSize(),container=layout._getLayoutElements(),leftBoundary=0,i=0,len=container.length;i<len;i++){var child=container[i];if(child){var layoutParameter=child.getLayoutParameter();if(layoutParameter){var childGravity=layoutParameter.getGravity(),ap=child.getAnchorPoint(),cs=child.getContentSize(),finalPosX=leftBoundary+ap.x*cs.width,finalPosY=layoutSize.height-(1-ap.y)*cs.height;switch(childGravity){case ccui.LinearLayoutParameter.NONE:case ccui.LinearLayoutParameter.TOP:break;case ccui.LinearLayoutParameter.BOTTOM:finalPosY=ap.y*cs.height;break;case ccui.LinearLayoutParameter.CENTER_VERTICAL:finalPosY=layoutSize.height/2-cs.height*(.5-ap.y)}var mg=layoutParameter.getMargin();finalPosX+=mg.left,finalPosY-=mg.top,child.setPosition(finalPosX,finalPosY),leftBoundary=child.getRightBoundary()+mg.right}}}}},ccui.relativeLayoutManager={_unlayoutChildCount:0,_widgetChildren:[],_widget:null,_finalPositionX:0,_finalPositionY:0,_relativeWidgetLP:null,_doLayout:function(layout){this._widgetChildren=this._getAllWidgets(layout);for(var locChildren=this._widgetChildren;this._unlayoutChildCount>0;){for(var i=0,len=locChildren.length;i<len;i++){this._widget=locChildren[i];var layoutParameter=this._widget.getLayoutParameter();if(layoutParameter){if(layoutParameter._put)continue;if(!this._calculateFinalPositionWithRelativeWidget(layout))continue;this._calculateFinalPositionWithRelativeAlign(),this._widget.setPosition(this._finalPositionX,this._finalPositionY),layoutParameter._put=!0}}this._unlayoutChildCount--}this._widgetChildren.length=0},_getAllWidgets:function(layout){var container=layout._getLayoutElements(),locWidgetChildren=this._widgetChildren;locWidgetChildren.length=0;for(var i=0,len=container.length;i<len;i++){var child=container[i];child&&child instanceof ccui.Widget&&(child.getLayoutParameter()._put=!1,this._unlayoutChildCount++,locWidgetChildren.push(child))}return locWidgetChildren},_getRelativeWidget:function(widget){var relativeWidget=null,relativeName=widget.getLayoutParameter().getRelativeToWidgetName();if(relativeName&&0!==relativeName.length)for(var locChildren=this._widgetChildren,i=0,len=locChildren.length;i<len;i++){var child=locChildren[i];if(child){var rlayoutParameter=child.getLayoutParameter();if(rlayoutParameter&&rlayoutParameter.getRelativeName()===relativeName){relativeWidget=child,this._relativeWidgetLP=rlayoutParameter;break}}}return relativeWidget},_calculateFinalPositionWithRelativeWidget:function(layout){var locWidget=this._widget,ap=locWidget.getAnchorPoint(),cs=locWidget.getContentSize();this._finalPositionX=0,this._finalPositionY=0;var relativeWidget=this._getRelativeWidget(locWidget),align=locWidget.getLayoutParameter().getAlign(),layoutSize=layout._getLayoutContentSize();switch(align){case ccui.RelativeLayoutParameter.NONE:case ccui.RelativeLayoutParameter.PARENT_TOP_LEFT:this._finalPositionX=ap.x*cs.width,this._finalPositionY=layoutSize.height-(1-ap.y)*cs.height;break;case ccui.RelativeLayoutParameter.PARENT_TOP_CENTER_HORIZONTAL:this._finalPositionX=.5*layoutSize.width-cs.width*(.5-ap.x),this._finalPositionY=layoutSize.height-(1-ap.y)*cs.height;break;case ccui.RelativeLayoutParameter.PARENT_TOP_RIGHT:this._finalPositionX=layoutSize.width-(1-ap.x)*cs.width,this._finalPositionY=layoutSize.height-(1-ap.y)*cs.height;break;case ccui.RelativeLayoutParameter.PARENT_LEFT_CENTER_VERTICAL:this._finalPositionX=ap.x*cs.width,this._finalPositionY=.5*layoutSize.height-cs.height*(.5-ap.y);break;case ccui.RelativeLayoutParameter.CENTER_IN_PARENT:this._finalPositionX=.5*layoutSize.width-cs.width*(.5-ap.x),this._finalPositionY=.5*layoutSize.height-cs.height*(.5-ap.y);break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_CENTER_VERTICAL:this._finalPositionX=layoutSize.width-(1-ap.x)*cs.width,this._finalPositionY=.5*layoutSize.height-cs.height*(.5-ap.y);break;case ccui.RelativeLayoutParameter.PARENT_LEFT_BOTTOM:this._finalPositionX=ap.x*cs.width,this._finalPositionY=ap.y*cs.height;break;case ccui.RelativeLayoutParameter.PARENT_BOTTOM_CENTER_HORIZONTAL:this._finalPositionX=.5*layoutSize.width-cs.width*(.5-ap.x),this._finalPositionY=ap.y*cs.height;break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_BOTTOM:this._finalPositionX=layoutSize.width-(1-ap.x)*cs.width,this._finalPositionY=ap.y*cs.height;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_LEFTALIGN:if(relativeWidget){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=relativeWidget.getTopBoundary()+ap.y*cs.height,this._finalPositionX=relativeWidget.getLeftBoundary()+ap.x*cs.width}break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_CENTER:if(relativeWidget){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;rbs=relativeWidget.getContentSize();this._finalPositionY=relativeWidget.getTopBoundary()+ap.y*cs.height,this._finalPositionX=relativeWidget.getLeftBoundary()+.5*rbs.width+ap.x*cs.width-.5*cs.width}break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_RIGHTALIGN:if(relativeWidget){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=relativeWidget.getTopBoundary()+ap.y*cs.height,this._finalPositionX=relativeWidget.getRightBoundary()-(1-ap.x)*cs.width}break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_TOPALIGN:if(relativeWidget){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=relativeWidget.getTopBoundary()-(1-ap.y)*cs.height,this._finalPositionX=relativeWidget.getLeftBoundary()-(1-ap.x)*cs.width}break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_CENTER:if(relativeWidget){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;rbs=relativeWidget.getContentSize();this._finalPositionX=relativeWidget.getLeftBoundary()-(1-ap.x)*cs.width,this._finalPositionY=relativeWidget.getBottomBoundary()+.5*rbs.height+ap.y*cs.height-.5*cs.height}break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_BOTTOMALIGN:if(relativeWidget){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=relativeWidget.getBottomBoundary()+ap.y*cs.height,this._finalPositionX=relativeWidget.getLeftBoundary()-(1-ap.x)*cs.width}break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_TOPALIGN:if(relativeWidget){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=relativeWidget.getTopBoundary()-(1-ap.y)*cs.height,this._finalPositionX=relativeWidget.getRightBoundary()+ap.x*cs.width}break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_CENTER:if(relativeWidget){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;var rbs=relativeWidget.getContentSize(),locationRight=relativeWidget.getRightBoundary();this._finalPositionX=locationRight+ap.x*cs.width,this._finalPositionY=relativeWidget.getBottomBoundary()+.5*rbs.height+ap.y*cs.height-.5*cs.height}break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_BOTTOMALIGN:if(relativeWidget){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=relativeWidget.getBottomBoundary()+ap.y*cs.height,this._finalPositionX=relativeWidget.getRightBoundary()+ap.x*cs.width}break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_LEFTALIGN:if(relativeWidget){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=relativeWidget.getBottomBoundary()-(1-ap.y)*cs.height,this._finalPositionX=relativeWidget.getLeftBoundary()+ap.x*cs.width}break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_CENTER:if(relativeWidget){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;rbs=relativeWidget.getContentSize();this._finalPositionY=relativeWidget.getBottomBoundary()-(1-ap.y)*cs.height,this._finalPositionX=relativeWidget.getLeftBoundary()+.5*rbs.width+ap.x*cs.width-.5*cs.width}break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_RIGHTALIGN:if(relativeWidget){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=relativeWidget.getBottomBoundary()-(1-ap.y)*cs.height,this._finalPositionX=relativeWidget.getRightBoundary()-(1-ap.x)*cs.width}}return!0},_calculateFinalPositionWithRelativeAlign:function(){var layoutParameter=this._widget.getLayoutParameter(),mg=layoutParameter.getMargin();switch(layoutParameter.getAlign()){case ccui.RelativeLayoutParameter.NONE:case ccui.RelativeLayoutParameter.PARENT_TOP_LEFT:this._finalPositionX+=mg.left,this._finalPositionY-=mg.top;break;case ccui.RelativeLayoutParameter.PARENT_TOP_CENTER_HORIZONTAL:this._finalPositionY-=mg.top;break;case ccui.RelativeLayoutParameter.PARENT_TOP_RIGHT:this._finalPositionX-=mg.right,this._finalPositionY-=mg.top;break;case ccui.RelativeLayoutParameter.PARENT_LEFT_CENTER_VERTICAL:this._finalPositionX+=mg.left;break;case ccui.RelativeLayoutParameter.CENTER_IN_PARENT:break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_CENTER_VERTICAL:this._finalPositionX-=mg.right;break;case ccui.RelativeLayoutParameter.PARENT_LEFT_BOTTOM:this._finalPositionX+=mg.left,this._finalPositionY+=mg.bottom;break;case ccui.RelativeLayoutParameter.PARENT_BOTTOM_CENTER_HORIZONTAL:this._finalPositionY+=mg.bottom;break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_BOTTOM:this._finalPositionX-=mg.right,this._finalPositionY+=mg.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_LEFTALIGN:this._finalPositionY+=mg.bottom,this._finalPositionX+=mg.left;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_RIGHTALIGN:this._finalPositionY+=mg.bottom,this._finalPositionX-=mg.right;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_CENTER:this._finalPositionY+=mg.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_TOPALIGN:this._finalPositionX-=mg.right,this._finalPositionY-=mg.top;break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_BOTTOMALIGN:this._finalPositionX-=mg.right,this._finalPositionY+=mg.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_CENTER:this._finalPositionX-=mg.right;break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_TOPALIGN:this._finalPositionX+=mg.left,this._finalPositionY-=mg.top;break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_BOTTOMALIGN:this._finalPositionX+=mg.left,this._finalPositionY+=mg.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_CENTER:this._finalPositionX+=mg.left;break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_LEFTALIGN:this._finalPositionY-=mg.top,this._finalPositionX+=mg.left;break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_RIGHTALIGN:this._finalPositionY-=mg.top,this._finalPositionX-=mg.right;break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_CENTER:this._finalPositionY-=mg.top}}},ccui.HBox=ccui.Layout.extend({ctor:function(size){ccui.Layout.prototype.ctor.call(this),this.setLayoutType(ccui.Layout.LINEAR_HORIZONTAL),size&&this.setContentSize(size)}}),ccui.HBox.create=function(size){return new ccui.HBox(size)},ccui.RelativeBox=ccui.Layout.extend({ctor:function(size){ccui.Layout.prototype.ctor.call(this),this.setLayoutType(ccui.Layout.RELATIVE),size&&this.setContentSize(size)}}),ccui.RelativeBox.create=function(size){return new ccui.RelativeBox(size)},ccui.VBox=ccui.Layout.extend({ctor:function(size){ccui.Layout.prototype.ctor.call(this),this.setLayoutType(ccui.Layout.LINEAR_VERTICAL),size&&this.setContentSize(size)},initWithSize:function(size){return!!this.init()}}),ccui.VBox.create=function(size){return new ccui.VBox(size)},ccui.helper={seekWidgetByTag:function(root,tag){if(!root)return null;if(root.getTag()===tag)return root;for(var arrayRootChildren=root.getChildren(),length=arrayRootChildren.length,i=0;i<length;i++){var child=arrayRootChildren[i],res=ccui.helper.seekWidgetByTag(child,tag);if(null!==res)return res}return null},seekWidgetByName:function(root,name){if(!root)return null;if(root.getName()===name)return root;for(var arrayRootChildren=root.getChildren(),length=arrayRootChildren.length,i=0;i<length;i++){var child=arrayRootChildren[i],res=ccui.helper.seekWidgetByName(child,name);if(null!==res)return res}return null},seekWidgetByRelativeName:function(root,name){if(!root)return null;for(var arrayRootChildren=root.getChildren(),length=arrayRootChildren.length,i=0;i<length;i++){var child=arrayRootChildren[i],layoutParameter=child.getLayoutParameter(ccui.LayoutParameter.RELATIVE);if(layoutParameter&&layoutParameter.getRelativeName()===name)return child}return null},seekActionWidgetByActionTag:function(root,tag){if(!root)return null;if(root.getActionTag()===tag)return root;for(var arrayRootChildren=root.getChildren(),i=0;i<arrayRootChildren.length;i++){var child=arrayRootChildren[i],res=ccui.helper.seekActionWidgetByActionTag(child,tag);if(null!==res)return res}return null},_activeLayout:!0,doLayout:function(rootNode){if(this._activeLayout)for(var node,children=rootNode.getChildren(),i=0,len=children.length;i<len;i++){var com=(node=children[i]).getComponent(ccui.LayoutComponent.NAME),parent=node.getParent();null!=com&&null!==parent&&com.refreshLayout&&com.refreshLayout()}},changeLayoutSystemActiveState:function(active){this._activeLayout=active},restrictCapInsetRect:function(capInsets,textureSize){var x=capInsets.x,y=capInsets.y,width=capInsets.width,height=capInsets.height;return textureSize.width<width&&(x=0,width=0),textureSize.height<height&&(y=0,height=0),cc.rect(x,y,width,height)},_createSpriteFromBase64:function(base64String,key){var texture2D=cc.textureCache.getTextureForKey(key);if(!texture2D){var image=new Image;image.src=base64String,cc.textureCache.cacheImage(key,image),texture2D=cc.textureCache.getTextureForKey(key)}return new cc.Sprite(texture2D)}},ccui.Button=ccui.Widget.extend({_buttonScale9Renderer:null,_buttonNormalSpriteFrame:null,_buttonClickedSpriteFrame:null,_buttonDisableSpriteFrame:null,_titleRenderer:null,_normalFileName:"",_clickedFileName:"",_disabledFileName:"",_prevIgnoreSize:!0,_scale9Enabled:!1,_capInsetsNormal:null,_normalTexType:ccui.Widget.LOCAL_TEXTURE,_pressedTexType:ccui.Widget.LOCAL_TEXTURE,_disabledTexType:ccui.Widget.LOCAL_TEXTURE,_normalTextureSize:null,pressedActionEnabled:!1,_titleColor:null,_zoomScale:.1,_normalTextureLoaded:!1,_pressedTextureLoaded:!1,_disabledTextureLoaded:!1,_className:"Button",_normalTextureAdaptDirty:!0,_fontName:"Thonburi",_fontSize:12,_type:0,_titlePosX:0,_buttonNormalRenderer:null,_buttonClickRenderer:null,_buttonDisableRenderer:null,ctor:function(normalImage,selectedImage,disableImage,texType){this._capInsetsNormal=cc.rect(0,0,0,0),this._normalTextureSize=cc.size(0,0),ccui.Widget.prototype.ctor.call(this),this.setTouchEnabled(!0),this._normalLoader=new cc.Sprite.LoadManager,this._clickedLoader=new cc.Sprite.LoadManager,this._disabledLoader=new cc.Sprite.LoadManager,normalImage&&this.loadTextures(normalImage,selectedImage,disableImage,texType)},_createTitleRendererIfNeeded:function(){this._titleRenderer||(this._titleRenderer=new cc.LabelTTF(""),this._titleRenderer.setAnchorPoint(.5,.5),this._titleColor=cc.color.WHITE,this._titleRenderer.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),this.addProtectedChild(this._titleRenderer,ccui.Button.TITLE_RENDERER_ZORDER,-1))},_initRenderer:function(){this._buttonScale9Renderer=new ccui.Scale9Sprite,this._buttonScale9Renderer.setRenderingType(ccui.Scale9Sprite.RenderingType.SIMPLE),this.addProtectedChild(this._buttonScale9Renderer,ccui.Button.DISABLED_RENDERER_ZORDER,-1),this._buttonNormalRenderer=new ccui.Scale9Sprite,this._buttonClickRenderer=new ccui.Scale9Sprite,this._buttonDisableRenderer=new ccui.Scale9Sprite},setScale9Enabled:function(able){if(this._scale9Enabled!==able){if(this._brightStyle=ccui.Widget.BRIGHT_STYLE_NONE,this._scale9Enabled=able,this._scale9Enabled?this._buttonScale9Renderer.setRenderingType(ccui.Scale9Sprite.RenderingType.SLICED):this._buttonScale9Renderer.setRenderingType(ccui.Scale9Sprite.RenderingType.SIMPLE),this._scale9Enabled){var ignoreBefore=this._ignoreSize;this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=ignoreBefore}else this.ignoreContentAdaptWithSize(this._prevIgnoreSize);this.setCapInsets(this._capInsetsNormal),this.setBright(this._bright),this._normalTextureAdaptDirty=!0}},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(ignore){this._unifySize?this._updateContentSize():(!this._scale9Enabled||this._scale9Enabled&&!ignore)&&(ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,ignore),this._prevIgnoreSize=ignore)},getVirtualRendererSize:function(){return this._unifySize?this._getNormalSize():!this._normalTextureLoaded&&this._titleRenderer&&this._titleRenderer.getString().length>0?this._titleRenderer.getContentSize():cc.size(this._normalTextureSize)},loadTextures:function(normal,selected,disabled,texType){this.loadTextureNormal(normal,texType),this.loadTexturePressed(selected,texType),this.loadTextureDisabled(disabled,texType)},_createSpriteFrameWithFile:function(file){var texture=cc.textureCache.getTextureForKey(file);if(texture||(texture=cc.textureCache.addImage(file)),!texture._textureLoaded)return texture;var textureSize=texture.getContentSize(),rect=cc.rect(0,0,textureSize.width,textureSize.height);return new cc.SpriteFrame(texture,rect)},_createSpriteFrameWithName:function(name){var frame=cc.spriteFrameCache.getSpriteFrame(name);return null==frame?(cc.log("ccui.Scale9Sprite.initWithSpriteFrameName(): can't find the sprite frame by spriteFrameName"),null):frame},loadTextureNormal:function(normal,texType){if(normal){texType=texType||ccui.Widget.LOCAL_TEXTURE,this._normalFileName=normal,this._normalTexType=texType;var normalSpriteFrame;switch(this._normalTexType){case ccui.Widget.LOCAL_TEXTURE:normalSpriteFrame=this._createSpriteFrameWithFile(normal);break;case ccui.Widget.PLIST_TEXTURE:"#"===normal[0]&&(normal=normal.substr(1,normal.length-1)),normalSpriteFrame=this._createSpriteFrameWithName(normal)}if(normalSpriteFrame){if(!normalSpriteFrame._textureLoaded)return this._normalLoader.clear(),void this._normalLoader.once(normalSpriteFrame,function(){this.loadTextureNormal(this._normalFileName,this._normalTexType)},this);this._normalTextureLoaded=normalSpriteFrame._textureLoaded,this._buttonNormalSpriteFrame=normalSpriteFrame,this._buttonScale9Renderer.setSpriteFrame(normalSpriteFrame),this._buttonNormalRenderer.setSpriteFrame(normalSpriteFrame),this._scale9Enabled&&this._buttonScale9Renderer.setCapInsets(this._capInsetsNormal),!this._ignoreSize&&cc.sizeEqualToSize(this._customSize,cc.size(0,0))&&(this._customSize=this._buttonScale9Renderer.getContentSize()),this._normalTextureSize=this._buttonScale9Renderer.getContentSize(),this._updateChildrenDisplayedRGBA(),this._unifySize?this._scale9Enabled&&(this._buttonScale9Renderer.setCapInsets(this._capInsetsNormal),this._updateContentSizeWithTextureSize(this._getNormalSize())):this._updateContentSizeWithTextureSize(this._normalTextureSize),this._normalTextureAdaptDirty=!0,this._findLayout()}}},loadTexturePressed:function(selected,texType){if(selected){texType=texType||ccui.Widget.LOCAL_TEXTURE,this._clickedFileName=selected,this._pressedTexType=texType;var clickedSpriteFrame;switch(this._pressedTexType){case ccui.Widget.LOCAL_TEXTURE:clickedSpriteFrame=this._createSpriteFrameWithFile(selected);break;case ccui.Widget.PLIST_TEXTURE:"#"===selected[0]&&(selected=selected.substr(1,selected.length-1)),clickedSpriteFrame=this._createSpriteFrameWithName(selected)}if(clickedSpriteFrame){if(!clickedSpriteFrame._textureLoaded)return this._clickedLoader.clear(),void this._clickedLoader.once(clickedSpriteFrame,function(){this.loadTexturePressed(this._clickedFileName,this._pressedTexType)},this);this._buttonClickRenderer.setSpriteFrame(clickedSpriteFrame),this._buttonClickedSpriteFrame=clickedSpriteFrame,this._updateChildrenDisplayedRGBA(),this._pressedTextureLoaded=!0}}},loadTextureDisabled:function(disabled,texType){if(disabled){texType=texType||ccui.Widget.LOCAL_TEXTURE,this._disabledFileName=disabled,this._disabledTexType=texType;var disabledSpriteframe;switch(this._disabledTexType){case ccui.Widget.LOCAL_TEXTURE:disabledSpriteframe=this._createSpriteFrameWithFile(disabled);break;case ccui.Widget.PLIST_TEXTURE:"#"===disabled[0]&&(disabled=disabled.substr(1,disabled.length-1)),disabledSpriteframe=this._createSpriteFrameWithName(disabled)}if(disabledSpriteframe){if(!disabledSpriteframe._textureLoaded)return this._disabledLoader.clear(),void this._disabledLoader.once(disabledSpriteframe,function(){this.loadTextureDisabled(this._disabledFileName,this._disabledTexType)},this);this._buttonDisableRenderer.setSpriteFrame(disabledSpriteframe),this._buttonDisableSpriteFrame=disabledSpriteframe,this._updateChildrenDisplayedRGBA(),this._disabledTextureLoaded=!0,this._findLayout()}}},setCapInsets:function(capInsets){this.setCapInsetsNormalRenderer(capInsets)},setCapInsetsNormalRenderer:function(capInsets){if(capInsets&&this._scale9Enabled){var x=capInsets.x,y=capInsets.y,width=capInsets.width,height=capInsets.height;this._normalTextureSize.width<width&&(x=0,width=0),this._normalTextureSize.height<height&&(y=0,height=0);var locInsets=this._capInsetsNormal;locInsets.x=x,locInsets.y=y,locInsets.width=width,locInsets.height=height,this._capInsetsNormal=locInsets,this._buttonScale9Renderer.setCapInsets(locInsets)}},getCapInsetsNormalRenderer:function(){return cc.rect(this._capInsetsNormal)},setCapInsetsPressedRenderer:function(capInsets){this.setCapInsetsNormalRenderer(capInsets)},getCapInsetsPressedRenderer:function(){return cc.rect(this._capInsetsNormal)},setCapInsetsDisabledRenderer:function(capInsets){this.setCapInsetsNormalRenderer(capInsets)},getCapInsetsDisabledRenderer:function(){return cc.rect(this._capInsetsNormal)},_onPressStateChangedToNormal:function(){if(this._buttonScale9Renderer.setSpriteFrame(this._buttonNormalSpriteFrame),this._buttonScale9Renderer.setState(ccui.Scale9Sprite.state.NORMAL),this._pressedTextureLoaded){if(this.pressedActionEnabled&&(this._buttonScale9Renderer.stopAllActions(),this._buttonScale9Renderer.setScale(1),this._titleRenderer))if(this._titleRenderer.stopAllActions(),this._unifySize){var zoomTitleAction=cc.scaleTo(ccui.Button.ZOOM_ACTION_TIME_STEP,1,1);this._titleRenderer.runAction(zoomTitleAction)}else this._titleRenderer.setScaleX(1),this._titleRenderer.setScaleY(1)}else this._buttonScale9Renderer.stopAllActions(),this._buttonScale9Renderer.setScale(1),this._scale9Enabled&&this._buttonScale9Renderer.setColor(cc.color.WHITE),this._titleRenderer&&(this._titleRenderer.stopAllActions(),this._titleRenderer.setScaleX(1),this._titleRenderer.setScaleY(1))},_onPressStateChangedToPressed:function(){if(this._buttonScale9Renderer.setState(ccui.Scale9Sprite.state.NORMAL),this._pressedTextureLoaded){if(this._buttonScale9Renderer.setSpriteFrame(this._buttonClickedSpriteFrame),this.pressedActionEnabled){this._buttonScale9Renderer.stopAllActions();var zoomAction=cc.scaleTo(ccui.Button.ZOOM_ACTION_TIME_STEP,1+this._zoomScale,1+this._zoomScale);this._buttonScale9Renderer.runAction(zoomAction),this._titleRenderer&&(this._titleRenderer.stopAllActions(),this._titleRenderer.runAction(cc.scaleTo(ccui.Button.ZOOM_ACTION_TIME_STEP,1+this._zoomScale,1+this._zoomScale)))}}else this._buttonScale9Renderer.setSpriteFrame(this._buttonClickedSpriteFrame),this._buttonScale9Renderer.stopAllActions(),this._buttonScale9Renderer.setScale(1+this._zoomScale,1+this._zoomScale),this._titleRenderer&&(this._titleRenderer.stopAllActions(),this._titleRenderer.setScaleX(1+this._zoomScale),this._titleRenderer.setScaleY(1+this._zoomScale))},_onPressStateChangedToDisabled:function(){this._disabledTextureLoaded?this._buttonScale9Renderer.setSpriteFrame(this._buttonDisableSpriteFrame):this._normalTextureLoaded&&this._buttonScale9Renderer.setState(ccui.Scale9Sprite.state.GRAY),this._buttonScale9Renderer.setScale(1)},_updateContentSize:function(){if(this._unifySize){if(this._scale9Enabled)ccui.ProtectedNode.setContentSize(this._customSize);else{var s=this._getNormalSize();ccui.ProtectedNode.setContentSize(s)}this._onSizeChanged()}else this._ignoreSize&&this.setContentSize(this.getVirtualRendererSize())},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._titleRenderer&&this._updateTitleLocation(),this._normalTextureAdaptDirty=!0},getVirtualRenderer:function(){return this._buttonScale9Renderer},getNormalRenderer:function(){return this._buttonNormalRenderer},getClickedRenderer:function(){return this._buttonClickRenderer},getDisableRenderer:function(){return this._buttonDisableRenderer},_normalTextureScaleChangedWithSize:function(){this._buttonScale9Renderer.setContentSize(this._contentSize),this._buttonScale9Renderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},_adaptRenderers:function(){this._normalTextureAdaptDirty&&(this._normalTextureScaleChangedWithSize(),this._normalTextureAdaptDirty=!1)},_updateTitleLocation:function(){this._titleRenderer.setPosition(.5*this._contentSize.width+this._titlePosX,.5*this._contentSize.height)},setPressedActionEnabled:function(enabled){this.pressedActionEnabled=enabled},setTitleText:function(text){if(text!==this.getTitleText())if(this._createTitleRendererIfNeeded(),this._titleRenderer.setString(text),this._ignoreSize){var s=this.getVirtualRendererSize();this.setContentSize(s)}else this._titleRenderer._renderCmd._updateTTF()},getTitleText:function(){return this._titleRenderer?this._titleRenderer.getString():""},setTitleColor:function(color){this._createTitleRendererIfNeeded(),this._titleRenderer.setFontFillColor(color)},getTitleColor:function(){return this._titleRenderer?this._titleRenderer._getFillStyle():cc.color.WHITE},setTitleFontSize:function(size){this._createTitleRendererIfNeeded(),this._titleRenderer.setFontSize(size),this._fontSize=size},getTitleFontSize:function(){return this._titleRenderer?this._titleRenderer.getFontSize():this._fontSize},setTitlePosX:function(pos){this._titlePosX=pos},setZoomScale:function(scale){this._zoomScale=scale},getZoomScale:function(){return this._zoomScale},getNormalTextureSize:function(){return this._normalTextureSize},setTitleFontName:function(fontName){this._createTitleRendererIfNeeded(),this._titleRenderer.setFontName(fontName),this._fontName=fontName},getTitleRenderer:function(){return this._titleRenderer},getTitleFontName:function(){return this._titleRenderer?this._titleRenderer.getFontName():this._fontName},_setTitleFont:function(font){this._titleRenderer.font=font},_getTitleFont:function(){return this._titleRenderer.font},getDescription:function(){return"Button"},_createCloneInstance:function(){return new ccui.Button},_copySpecialProperties:function(uiButton){this._prevIgnoreSize=uiButton._prevIgnoreSize,this._capInsetsNormal=uiButton._capInsetsNormal,this.setScale9Enabled(uiButton._scale9Enabled),this.loadTextureNormal(uiButton._normalFileName,uiButton._normalTexType),this.loadTexturePressed(uiButton._clickedFileName,uiButton._pressedTexType),this.loadTextureDisabled(uiButton._disabledFileName,uiButton._disabledTexType),uiButton._titleRenderer&&uiButton._titleRenderer._string&&(this.setTitleText(uiButton.getTitleText()),this.setTitleFontName(uiButton.getTitleFontName()),this.setTitleFontSize(uiButton.getTitleFontSize()),this.setTitleColor(uiButton.getTitleColor())),this.setPressedActionEnabled(uiButton.pressedActionEnabled),this.setZoomScale(uiButton._zoomScale)},_getNormalSize:function(){var titleSize;null!==this._titleRenderer&&(titleSize=this._titleRenderer.getContentSize());var imageSize=this._buttonScale9Renderer.getContentSize(),width=titleSize.width>imageSize.width?titleSize.width:imageSize.width,height=titleSize.height>imageSize.height?titleSize.height:imageSize.height;return cc.size(width,height)}}),(_p=ccui.Button.prototype).titleText,cc.defineGetterSetter(_p,"titleText",_p.getTitleText,_p.setTitleText),_p.titleFont,cc.defineGetterSetter(_p,"titleFont",_p._getTitleFont,_p._setTitleFont),_p.titleFontSize,cc.defineGetterSetter(_p,"titleFontSize",_p.getTitleFontSize,_p.setTitleFontSize),_p.titleFontName,cc.defineGetterSetter(_p,"titleFontName",_p.getTitleFontName,_p.setTitleFontName),_p.titleColor,cc.defineGetterSetter(_p,"titleColor",_p.getTitleColor,_p.setTitleColor),_p=null,ccui.Button.create=function(normalImage,selectedImage,disableImage,texType){return new ccui.Button(normalImage,selectedImage,disableImage,texType)},ccui.Button.NORMAL_RENDERER_ZORDER=-2,ccui.Button.PRESSED_RENDERER_ZORDER=-2,ccui.Button.DISABLED_RENDERER_ZORDER=-2,ccui.Button.TITLE_RENDERER_ZORDER=-1,ccui.Button.ZOOM_ACTION_TIME_STEP=.05,ccui.Button.SYSTEM=0,ccui.Button.TTF=1,ccui.CheckBox=ccui.Widget.extend({_backGroundBoxRenderer:null,_backGroundSelectedBoxRenderer:null,_frontCrossRenderer:null,_backGroundBoxDisabledRenderer:null,_frontCrossDisabledRenderer:null,_isSelected:!0,_checkBoxEventListener:null,_checkBoxEventSelector:null,_backGroundTexType:ccui.Widget.LOCAL_TEXTURE,_backGroundSelectedTexType:ccui.Widget.LOCAL_TEXTURE,_frontCrossTexType:ccui.Widget.LOCAL_TEXTURE,_backGroundDisabledTexType:ccui.Widget.LOCAL_TEXTURE,_frontCrossDisabledTexType:ccui.Widget.LOCAL_TEXTURE,_backGroundFileName:"",_backGroundSelectedFileName:"",_frontCrossFileName:"",_backGroundDisabledFileName:"",_frontCrossDisabledFileName:"",_className:"CheckBox",_zoomScale:.1,_backgroundTextureScaleX:.1,_backgroundTextureScaleY:.1,_backGroundBoxRendererAdaptDirty:!0,_backGroundSelectedBoxRendererAdaptDirty:!0,_frontCrossRendererAdaptDirty:!0,_backGroundBoxDisabledRendererAdaptDirty:!0,_frontCrossDisabledRendererAdaptDirty:!0,ctor:function(backGround,backGroundSelected,cross,backGroundDisabled,frontCrossDisabled,texType){ccui.Widget.prototype.ctor.call(this),this.setTouchEnabled(!0);for(var strNum=0,i=0;i<arguments.length;i++){var type=typeof arguments[i];"string"===type?isNaN(arguments[i]-0)?strNum++:(texType=arguments[i],arguments[i]=void 0):"number"===type&&strNum++}switch(strNum){case 2:texType=cross,cross=backGroundSelected,backGroundSelected=void 0}texType=void 0===texType?0:texType,this._isSelected=!0,this.setSelected(!1),this.loadTextures(backGround,backGroundSelected,cross,backGroundDisabled,frontCrossDisabled,texType)},_initRenderer:function(){this._backGroundBoxRenderer=new cc.Sprite,this._backGroundSelectedBoxRenderer=new cc.Sprite,this._frontCrossRenderer=new cc.Sprite,this._backGroundBoxDisabledRenderer=new cc.Sprite,this._frontCrossDisabledRenderer=new cc.Sprite,this.addProtectedChild(this._backGroundBoxRenderer,ccui.CheckBox.BOX_RENDERER_ZORDER,-1),this.addProtectedChild(this._backGroundSelectedBoxRenderer,ccui.CheckBox.BOX_SELECTED_RENDERER_ZORDER,-1),this.addProtectedChild(this._frontCrossRenderer,ccui.CheckBox.FRONT_CROSS_RENDERER_ZORDER,-1),this.addProtectedChild(this._backGroundBoxDisabledRenderer,ccui.CheckBox.BOX_DISABLED_RENDERER_ZORDER,-1),this.addProtectedChild(this._frontCrossDisabledRenderer,ccui.CheckBox.FRONT_CROSS_DISABLED_RENDERER_ZORDER,-1)},loadTextures:function(backGround,backGroundSelected,cross,backGroundDisabled,frontCrossDisabled,texType){backGround&&this.loadTextureBackGround(backGround,texType),backGroundSelected&&this.loadTextureBackGroundSelected(backGroundSelected,texType),cross&&this.loadTextureFrontCross(cross,texType),backGroundDisabled&&this.loadTextureBackGroundDisabled(backGroundDisabled,texType),frontCrossDisabled&&this.loadTextureFrontCrossDisabled(frontCrossDisabled,texType)},loadTextureBackGround:function(backGround,texType){if(backGround){texType=texType||ccui.Widget.LOCAL_TEXTURE,this._backGroundFileName=backGround,this._backGroundTexType=texType;var bgBoxRenderer=this._backGroundBoxRenderer;switch(bgBoxRenderer._textureLoaded?this._backGroundBoxRenderer.setContentSize(this._customSize):bgBoxRenderer.addEventListener("load",function(){this._updateContentSizeWithTextureSize(this._backGroundBoxRenderer.getContentSize()),this.loadTextureBackGround(this._backGroundFileName,this._backGroundTexType)},this),this._backGroundTexType){case ccui.Widget.LOCAL_TEXTURE:bgBoxRenderer.initWithFile(backGround);break;case ccui.Widget.PLIST_TEXTURE:bgBoxRenderer.initWithSpriteFrameName(backGround)}this._updateChildrenDisplayedRGBA(),this._updateContentSizeWithTextureSize(this._backGroundBoxRenderer.getContentSize()),this._backGroundBoxRendererAdaptDirty=!0,this._findLayout()}},loadTextureBackGroundSelected:function(backGroundSelected,texType){if(backGroundSelected){texType=texType||ccui.Widget.LOCAL_TEXTURE,this._backGroundSelectedFileName=backGroundSelected,this._backGroundSelectedTexType=texType;var backGroundSelectedBoxRenderer=this._backGroundSelectedBoxRenderer;switch(backGroundSelectedBoxRenderer._textureLoaded||backGroundSelectedBoxRenderer.addEventListener("load",function(){this.loadTextureBackGroundSelected(this._backGroundSelectedFileName,this._backGroundSelectedTexType)},this),this._backGroundSelectedTexType){case ccui.Widget.LOCAL_TEXTURE:backGroundSelectedBoxRenderer.initWithFile(backGroundSelected);break;case ccui.Widget.PLIST_TEXTURE:backGroundSelectedBoxRenderer.initWithSpriteFrameName(backGroundSelected)}this._updateChildrenDisplayedRGBA(),this._backGroundSelectedBoxRendererAdaptDirty=!0,this._findLayout()}},loadTextureFrontCross:function(cross,texType){if(cross){texType=texType||ccui.Widget.LOCAL_TEXTURE,this._frontCrossFileName=cross,this._frontCrossTexType=texType;var frontCrossRenderer=this._frontCrossRenderer;switch(frontCrossRenderer._textureLoaded||frontCrossRenderer.addEventListener("load",function(){this.loadTextureFrontCross(this._frontCrossFileName,this._frontCrossTexType)},this),this._frontCrossTexType){case ccui.Widget.LOCAL_TEXTURE:frontCrossRenderer.initWithFile(cross);break;case ccui.Widget.PLIST_TEXTURE:frontCrossRenderer.initWithSpriteFrameName(cross)}this._updateChildrenDisplayedRGBA(),this._frontCrossRendererAdaptDirty=!0,this._findLayout()}},loadTextureBackGroundDisabled:function(backGroundDisabled,texType){if(backGroundDisabled){texType=texType||ccui.Widget.LOCAL_TEXTURE,this._backGroundDisabledFileName=backGroundDisabled,this._backGroundDisabledTexType=texType;var backGroundBoxDisabledRenderer=this._backGroundBoxDisabledRenderer;switch(backGroundBoxDisabledRenderer._textureLoaded||backGroundBoxDisabledRenderer.addEventListener("load",function(){this.loadTextureBackGroundDisabled(this._backGroundDisabledFileName,this._backGroundDisabledTexType)},this),this._backGroundDisabledTexType){case ccui.Widget.LOCAL_TEXTURE:backGroundBoxDisabledRenderer.initWithFile(backGroundDisabled);break;case ccui.Widget.PLIST_TEXTURE:backGroundBoxDisabledRenderer.initWithSpriteFrameName(backGroundDisabled)}this._updateChildrenDisplayedRGBA(),this._backGroundBoxDisabledRendererAdaptDirty=!0,this._findLayout()}},loadTextureFrontCrossDisabled:function(frontCrossDisabled,texType){if(frontCrossDisabled){texType=texType||ccui.Widget.LOCAL_TEXTURE,this._frontCrossDisabledFileName=frontCrossDisabled,this._frontCrossDisabledTexType=texType;var frontCrossDisabledRenderer=this._frontCrossDisabledRenderer;switch(frontCrossDisabledRenderer._textureLoaded||frontCrossDisabledRenderer.addEventListener("load",function(){this.loadTextureFrontCrossDisabled(this._frontCrossDisabledFileName,this._frontCrossDisabledTexType)},this),this._frontCrossDisabledTexType){case ccui.Widget.LOCAL_TEXTURE:frontCrossDisabledRenderer.initWithFile(frontCrossDisabled);break;case ccui.Widget.PLIST_TEXTURE:frontCrossDisabledRenderer.initWithSpriteFrameName(frontCrossDisabled)}this._updateChildrenDisplayedRGBA(),this._frontCrossDisabledRendererAdaptDirty=!0,this._findLayout()}},_onPressStateChangedToNormal:function(){this._backGroundBoxRenderer.setVisible(!0),this._backGroundSelectedBoxRenderer.setVisible(!1),this._backGroundBoxDisabledRenderer.setVisible(!1),this._frontCrossDisabledRenderer.setVisible(!1),this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._frontCrossRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._isSelected&&(this._frontCrossRenderer.setVisible(!0),this._frontCrossRendererAdaptDirty=!0)},_onPressStateChangedToPressed:function(){this._backGroundSelectedFileName?(this._backGroundBoxRenderer.setVisible(!1),this._backGroundSelectedBoxRenderer.setVisible(!0),this._backGroundBoxDisabledRenderer.setVisible(!1),this._frontCrossDisabledRenderer.setVisible(!1)):(this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX+this._zoomScale,this._backgroundTextureScaleY+this._zoomScale),this._frontCrossRenderer.setScale(this._backgroundTextureScaleX+this._zoomScale,this._backgroundTextureScaleY+this._zoomScale))},_onPressStateChangedToDisabled:function(){this._backGroundDisabledFileName&&this._frontCrossDisabledFileName&&(this._backGroundBoxRenderer.setVisible(!1),this._backGroundBoxDisabledRenderer.setVisible(!0)),this._backGroundSelectedBoxRenderer.setVisible(!1),this._frontCrossRenderer.setVisible(!1),this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._frontCrossRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._isSelected&&(this._frontCrossDisabledRenderer.setVisible(!0),this._frontCrossDisabledRendererAdaptDirty=!0)},setZoomScale:function(scale){this._zoomScale=scale},getZoomScale:function(){return this._zoomScale},setSelectedState:function(selected){this.setSelected(selected)},setSelected:function(selected){selected!==this._isSelected&&(this._isSelected=selected,this._frontCrossRenderer.setVisible(this._isSelected))},getSelectedState:function(){return this.isSelected()},isSelected:function(){return this._isSelected},_selectedEvent:function(){this._checkBoxEventSelector&&(this._checkBoxEventListener?this._checkBoxEventSelector.call(this._checkBoxEventListener,this,ccui.CheckBox.EVENT_SELECTED):this._checkBoxEventSelector(this,ccui.CheckBox.EVENT_SELECTED))},_unSelectedEvent:function(){this._checkBoxEventSelector&&(this._checkBoxEventListener?this._checkBoxEventSelector.call(this._checkBoxEventListener,this,ccui.CheckBox.EVENT_UNSELECTED):this._checkBoxEventSelector(this,ccui.CheckBox.EVENT_UNSELECTED))},_releaseUpEvent:function(){ccui.Widget.prototype._releaseUpEvent.call(this),this._isSelected?(this.setSelected(!1),this._unSelectedEvent()):(this.setSelected(!0),this._selectedEvent())},addEventListenerCheckBox:function(selector,target){this.addEventListener(selector,target)},addEventListener:function(selector,target){this._checkBoxEventSelector=selector,this._checkBoxEventListener=target},getVirtualRendererSize:function(){return this._backGroundBoxRenderer.getContentSize()},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._backGroundBoxRendererAdaptDirty=!0,this._backGroundSelectedBoxRendererAdaptDirty=!0,this._frontCrossRendererAdaptDirty=!0,this._backGroundBoxDisabledRendererAdaptDirty=!0,this._frontCrossDisabledRendererAdaptDirty=!0},getVirtualRenderer:function(){return this._backGroundBoxRenderer},_backGroundTextureScaleChangedWithSize:function(){var locRenderer=this._backGroundBoxRenderer,locContentSize=this._contentSize;if(this._ignoreSize)locRenderer.setScale(1),this._backgroundTextureScaleX=this._backgroundTextureScaleY=1;else{var textureSize=locRenderer.getContentSize();if(textureSize.width<=0||textureSize.height<=0)return locRenderer.setScale(1),void(this._backgroundTextureScaleX=this._backgroundTextureScaleY=1);var scaleX=locContentSize.width/textureSize.width,scaleY=locContentSize.height/textureSize.height;this._backgroundTextureScaleX=scaleX,this._backgroundTextureScaleY=scaleY,locRenderer.setScaleX(scaleX),locRenderer.setScaleY(scaleY)}locRenderer.setPosition(.5*locContentSize.width,.5*locContentSize.height)},_backGroundSelectedTextureScaleChangedWithSize:function(){var locRenderer=this._backGroundSelectedBoxRenderer,locContentSize=this._contentSize;if(this._ignoreSize)locRenderer.setScale(1);else{var textureSize=locRenderer.getContentSize();if(textureSize.width<=0||textureSize.height<=0)return void locRenderer.setScale(1);var scaleX=locContentSize.width/textureSize.width,scaleY=locContentSize.height/textureSize.height;locRenderer.setScaleX(scaleX),locRenderer.setScaleY(scaleY)}locRenderer.setPosition(.5*locContentSize.width,.5*locContentSize.height)},_frontCrossTextureScaleChangedWithSize:function(){var locRenderer=this._frontCrossRenderer,locContentSize=this._contentSize;if(this._ignoreSize)locRenderer.setScale(1);else{var textureSize=locRenderer.getContentSize();if(textureSize.width<=0||textureSize.height<=0)return void locRenderer.setScale(1);var scaleX=locContentSize.width/textureSize.width,scaleY=locContentSize.height/textureSize.height;locRenderer.setScaleX(scaleX),locRenderer.setScaleY(scaleY)}locRenderer.setPosition(.5*locContentSize.width,.5*locContentSize.height)},_backGroundDisabledTextureScaleChangedWithSize:function(){var locRenderer=this._backGroundBoxDisabledRenderer,locContentSize=this._contentSize;if(this._ignoreSize)locRenderer.setScale(1);else{var textureSize=locRenderer.getContentSize();if(textureSize.width<=0||textureSize.height<=0)return void locRenderer.setScale(1);var scaleX=locContentSize.width/textureSize.width,scaleY=locContentSize.height/textureSize.height;locRenderer.setScaleX(scaleX),locRenderer.setScaleY(scaleY)}locRenderer.setPosition(.5*locContentSize.width,.5*locContentSize.height)},_frontCrossDisabledTextureScaleChangedWithSize:function(){var locRenderer=this._frontCrossDisabledRenderer,locContentSize=this._contentSize;if(this._ignoreSize)locRenderer.setScale(1);else{var textureSize=locRenderer.getContentSize();if(textureSize.width<=0||textureSize.height<=0)return void locRenderer.setScale(1);var scaleX=locContentSize.width/textureSize.width,scaleY=locContentSize.height/textureSize.height;locRenderer.setScaleX(scaleX),locRenderer.setScaleY(scaleY)}locRenderer.setPosition(.5*locContentSize.width,.5*locContentSize.height)},getDescription:function(){return"CheckBox"},_createCloneInstance:function(){return new ccui.CheckBox},_copySpecialProperties:function(uiCheckBox){uiCheckBox instanceof ccui.CheckBox&&(this.loadTextureBackGround(uiCheckBox._backGroundFileName,uiCheckBox._backGroundTexType),this.loadTextureBackGroundSelected(uiCheckBox._backGroundSelectedFileName,uiCheckBox._backGroundSelectedTexType),this.loadTextureFrontCross(uiCheckBox._frontCrossFileName,uiCheckBox._frontCrossTexType),this.loadTextureBackGroundDisabled(uiCheckBox._backGroundDisabledFileName,uiCheckBox._backGroundDisabledTexType),this.loadTextureFrontCrossDisabled(uiCheckBox._frontCrossDisabledFileName,uiCheckBox._frontCrossDisabledTexType),this.setSelected(uiCheckBox._isSelected),this._checkBoxEventListener=uiCheckBox._checkBoxEventListener,this._checkBoxEventSelector=uiCheckBox._checkBoxEventSelector,this._ccEventCallback=uiCheckBox._ccEventCallback,this._zoomScale=uiCheckBox._zoomScale,this._backgroundTextureScaleX=uiCheckBox._backgroundTextureScaleX,this._backgroundTextureScaleY=uiCheckBox._backgroundTextureScaleY)},_adaptRenderers:function(){this._backGroundBoxRendererAdaptDirty&&(this._backGroundTextureScaleChangedWithSize(),this._backGroundBoxRendererAdaptDirty=!1),this._backGroundSelectedBoxRendererAdaptDirty&&(this._backGroundSelectedTextureScaleChangedWithSize(),this._backGroundSelectedBoxRendererAdaptDirty=!1),this._frontCrossRendererAdaptDirty&&(this._frontCrossTextureScaleChangedWithSize(),this._frontCrossRendererAdaptDirty=!1),this._backGroundBoxDisabledRendererAdaptDirty&&(this._backGroundDisabledTextureScaleChangedWithSize(),this._backGroundBoxDisabledRendererAdaptDirty=!1),this._frontCrossDisabledRendererAdaptDirty&&(this._frontCrossDisabledTextureScaleChangedWithSize(),this._frontCrossDisabledRendererAdaptDirty=!1)}}),(_p=ccui.CheckBox.prototype).selected,cc.defineGetterSetter(_p,"selected",_p.isSelected,_p.setSelected),_p=null,ccui.CheckBox.create=function(backGround,backGroundSeleted,cross,backGroundDisabled,frontCrossDisabled,texType){return new ccui.CheckBox(backGround,backGroundSeleted,cross,backGroundDisabled,frontCrossDisabled,texType)},ccui.CheckBox.EVENT_SELECTED=0,ccui.CheckBox.EVENT_UNSELECTED=1,ccui.CheckBox.BOX_RENDERER_ZORDER=-1,ccui.CheckBox.BOX_SELECTED_RENDERER_ZORDER=-1,ccui.CheckBox.BOX_DISABLED_RENDERER_ZORDER=-1,ccui.CheckBox.FRONT_CROSS_RENDERER_ZORDER=-1,ccui.CheckBox.FRONT_CROSS_DISABLED_RENDERER_ZORDER=-1,ccui.ImageView=ccui.Widget.extend({_scale9Enabled:!1,_prevIgnoreSize:!0,_capInsets:null,_imageRenderer:null,_textureFile:"",_imageTexType:ccui.Widget.LOCAL_TEXTURE,_imageTextureSize:null,_className:"ImageView",_imageRendererAdaptDirty:!0,ctor:function(imageFileName,texType){this._capInsets=cc.rect(0,0,0,0),this._imageTextureSize=cc.size(this._capInsets.width,this._capInsets.height),ccui.Widget.prototype.ctor.call(this),texType=void 0===texType?0:texType,imageFileName?this.loadTexture(imageFileName,texType):this._imageTexType=ccui.Widget.LOCAL_TEXTURE},_initRenderer:function(){this._imageRenderer=new ccui.Scale9Sprite,this._imageRenderer.setRenderingType(ccui.Scale9Sprite.RenderingType.SIMPLE),this.addProtectedChild(this._imageRenderer,ccui.ImageView.RENDERER_ZORDER,-1)},loadTexture:function(fileName,texType){if(fileName&&(this._textureFile!=fileName||this._imageTexType!=texType)){var self=this;texType=texType||ccui.Widget.LOCAL_TEXTURE,this._textureFile=fileName,this._imageTexType=texType;var imageRenderer=self._imageRenderer;switch(imageRenderer._textureLoaded||imageRenderer.addEventListener("load",function(){!self._ignoreSize&&cc.sizeEqualToSize(self._customSize,cc.size(0,0))&&(self._customSize=self._imageRenderer.getContentSize()),self._imageTextureSize=imageRenderer.getContentSize(),self._updateChildrenDisplayedRGBA(),self._updateContentSizeWithTextureSize(self._imageTextureSize)}),self._imageTexType){case ccui.Widget.LOCAL_TEXTURE:self._scale9Enabled?(imageRenderer.initWithFile(fileName),imageRenderer.setCapInsets(self._capInsets)):imageRenderer.initWithFile(fileName);break;case ccui.Widget.PLIST_TEXTURE:self._scale9Enabled?(imageRenderer.initWithSpriteFrameName(fileName),imageRenderer.setCapInsets(self._capInsets)):imageRenderer.initWithSpriteFrameName(fileName)}!this._ignoreSize&&cc.sizeEqualToSize(this._customSize,cc.size(0,0))&&(this._customSize=this._imageRenderer.getContentSize()),self._imageTextureSize=imageRenderer.getContentSize(),this._updateChildrenDisplayedRGBA(),self._updateContentSizeWithTextureSize(self._imageTextureSize),self._imageRendererAdaptDirty=!0,self._findLayout()}},setTextureRect:function(){cc.warn("ImageView.setTextureRect  is deprecated!")},setScale9Enabled:function(able){if(this._scale9Enabled!==able){if(this._scale9Enabled=able,this._scale9Enabled?this._imageRenderer.setRenderingType(ccui.Scale9Sprite.RenderingType.SLICED):this._imageRenderer.setRenderingType(ccui.Scale9Sprite.RenderingType.SIMPLE),this._scale9Enabled){var ignoreBefore=this._ignoreSize;this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=ignoreBefore}else this.ignoreContentAdaptWithSize(this._prevIgnoreSize);this.setCapInsets(this._capInsets),this._imageRendererAdaptDirty=!0}},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(ignore){(!this._scale9Enabled||this._scale9Enabled&&!ignore)&&(ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,ignore),this._prevIgnoreSize=ignore)},setCapInsets:function(capInsets){if(capInsets){var locInsets=this._capInsets;locInsets.x=capInsets.x,locInsets.y=capInsets.y,locInsets.width=capInsets.width,locInsets.height=capInsets.height,this._scale9Enabled&&this._imageRenderer.setCapInsets(capInsets)}},getCapInsets:function(){return cc.rect(this._capInsets)},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._imageRendererAdaptDirty=!0},_adaptRenderers:function(){this._imageRendererAdaptDirty&&(this._imageTextureScaleChangedWithSize(),this._imageRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return cc.size(this._imageTextureSize)},getVirtualRenderer:function(){return this._imageRenderer},_imageTextureScaleChangedWithSize:function(){this._imageRenderer.setContentSize(this._contentSize),this._imageRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"ImageView"},_createCloneInstance:function(){return new ccui.ImageView},_copySpecialProperties:function(imageView){imageView instanceof ccui.ImageView&&(this._prevIgnoreSize=imageView._prevIgnoreSize,this._capInsets=imageView._capInsets,this.loadTexture(imageView._textureFile,imageView._imageTexType),this.setScale9Enabled(imageView._scale9Enabled))},setContentSize:function(contentSize,height){height&&(contentSize=cc.size(contentSize,height)),ccui.Widget.prototype.setContentSize.call(this,contentSize),this._imageRenderer.setContentSize(contentSize)}}),ccui.ImageView.create=function(imageFileName,texType){return new ccui.ImageView(imageFileName,texType)},ccui.ImageView.RENDERER_ZORDER=-1,ccui.LoadingBar=ccui.Widget.extend({_direction:null,_percent:100,_totalLength:0,_barRenderer:null,_renderBarTexType:ccui.Widget.LOCAL_TEXTURE,_barRendererTextureSize:null,_scale9Enabled:!1,_prevIgnoreSize:!0,_capInsets:null,_textureFile:"",_isTextureLoaded:!1,_className:"LoadingBar",_barRendererAdaptDirty:!0,ctor:function(textureName,percentage){this._direction=ccui.LoadingBar.TYPE_LEFT,this._barRendererTextureSize=cc.size(0,0),this._capInsets=cc.rect(0,0,0,0),ccui.Widget.prototype.ctor.call(this),void 0!==textureName&&this.loadTexture(textureName),void 0!==percentage&&this.setPercent(percentage)},_initRenderer:function(){this._barRenderer=new cc.Sprite,this.addProtectedChild(this._barRenderer,ccui.LoadingBar.RENDERER_ZORDER,-1),this._barRenderer.setAnchorPoint(0,.5)},setDirection:function(dir){if(this._direction!==dir)switch(this._direction=dir,this._direction){case ccui.LoadingBar.TYPE_LEFT:this._barRenderer.setAnchorPoint(0,.5),this._barRenderer.setPosition(0,.5*this._contentSize.height),this._scale9Enabled||this._barRenderer.setFlippedX(!1);break;case ccui.LoadingBar.TYPE_RIGHT:this._barRenderer.setAnchorPoint(1,.5),this._barRenderer.setPosition(this._totalLength,.5*this._contentSize.height),this._scale9Enabled||this._barRenderer.setFlippedX(!0)}},getDirection:function(){return this._direction},loadTexture:function(texture,texType){if(texture){texType=texType||ccui.Widget.LOCAL_TEXTURE,this._renderBarTexType=texType,this._textureFile=texture;var barRenderer=this._barRenderer,self=this;switch(barRenderer._textureLoaded||barRenderer.addEventListener("load",function(){self.loadTexture(self._textureFile,self._renderBarTexType),self._setPercent(self._percent)}),this._renderBarTexType){case ccui.Widget.LOCAL_TEXTURE:barRenderer.initWithFile(texture);break;case ccui.Widget.PLIST_TEXTURE:barRenderer.initWithSpriteFrameName(texture)}var bz=barRenderer.getContentSize();switch(this._barRendererTextureSize.width=bz.width,this._barRendererTextureSize.height=bz.height,this._direction){case ccui.LoadingBar.TYPE_LEFT:barRenderer.setAnchorPoint(0,.5),this._scale9Enabled||barRenderer.setFlippedX(!1);break;case ccui.LoadingBar.TYPE_RIGHT:barRenderer.setAnchorPoint(1,.5),this._scale9Enabled||barRenderer.setFlippedX(!0)}this._scale9Enabled&&barRenderer.setCapInsets(this._capInsets),this._updateChildrenDisplayedRGBA(),this._barRendererScaleChangedWithSize(),this._updateContentSizeWithTextureSize(this._barRendererTextureSize),this._barRendererAdaptDirty=!0,this._findLayout()}},setScale9Enabled:function(enabled){if(this._scale9Enabled!==enabled){if(this._scale9Enabled=enabled,this.removeProtectedChild(this._barRenderer),this._barRenderer=this._scale9Enabled?new ccui.Scale9Sprite:new cc.Sprite,this.loadTexture(this._textureFile,this._renderBarTexType),this.addProtectedChild(this._barRenderer,ccui.LoadingBar.RENDERER_ZORDER,-1),this._scale9Enabled){var ignoreBefore=this._ignoreSize;this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=ignoreBefore}else this.ignoreContentAdaptWithSize(this._prevIgnoreSize);this.setCapInsets(this._capInsets),this.setPercent(this._percent),this._barRendererAdaptDirty=!0}},isScale9Enabled:function(){return this._scale9Enabled},setCapInsets:function(capInsets){if(capInsets){var locInsets=this._capInsets;locInsets.x=capInsets.x,locInsets.y=capInsets.y,locInsets.width=capInsets.width,locInsets.height=capInsets.height,this._scale9Enabled&&this._barRenderer.setCapInsets(capInsets)}},getCapInsets:function(){return cc.rect(this._capInsets)},setPercent:function(percent){percent>100&&(percent=100),percent<0&&(percent=0),percent!==this._percent&&(this._percent=percent,this._setPercent(percent))},_setPercent:function(){var res,rect,spriteRenderer,spriteTextureRect;this._totalLength<=0||(res=this._percent/100,this._scale9Enabled?this._setScale9Scale():(spriteRenderer=this._barRenderer,spriteTextureRect=this._barRendererTextureSize,(rect=spriteRenderer.getTextureRect()).width=spriteTextureRect.width*res,spriteRenderer.setTextureRect(cc.rect(rect.x,rect.y,spriteTextureRect.width*res,spriteTextureRect.height),spriteRenderer._rectRotated)))},setContentSize:function(contentSize,height){ccui.Widget.prototype.setContentSize.call(this,contentSize,height),this._totalLength=void 0===height?contentSize.width:contentSize},getPercent:function(){return this._percent},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._barRendererAdaptDirty=!0},_adaptRenderers:function(){this._barRendererAdaptDirty&&(this._barRendererScaleChangedWithSize(),this._barRendererAdaptDirty=!1)},ignoreContentAdaptWithSize:function(ignore){(!this._scale9Enabled||this._scale9Enabled&&!ignore)&&(ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,ignore),this._prevIgnoreSize=ignore)},getVirtualRendererSize:function(){return cc.size(this._barRendererTextureSize)},getVirtualRenderer:function(){return this._barRenderer},_barRendererScaleChangedWithSize:function(){var locBarRender=this._barRenderer,locContentSize=this._contentSize;if(this._unifySize)this._totalLength=this._contentSize.width,this.setPercent(this._percent);else if(this._ignoreSize)this._scale9Enabled||(this._totalLength=this._barRendererTextureSize.width,locBarRender.setScale(1));else if(this._totalLength=locContentSize.width,this._scale9Enabled)this._setScale9Scale(),locBarRender.setScale(1);else{var textureSize=this._barRendererTextureSize;if(textureSize.width<=0||textureSize.height<=0)return void locBarRender.setScale(1);var scaleX=locContentSize.width/textureSize.width,scaleY=locContentSize.height/textureSize.height;locBarRender.setScaleX(scaleX),locBarRender.setScaleY(scaleY)}switch(this._direction){case ccui.LoadingBar.TYPE_LEFT:locBarRender.setPosition(0,.5*locContentSize.height);break;case ccui.LoadingBar.TYPE_RIGHT:locBarRender.setPosition(this._totalLength,.5*locContentSize.height)}},_setScale9Scale:function(){var width=this._percent/100*this._totalLength;this._barRenderer.setPreferredSize(cc.size(width,this._contentSize.height))},getDescription:function(){return"LoadingBar"},_createCloneInstance:function(){return new ccui.LoadingBar},_copySpecialProperties:function(loadingBar){loadingBar instanceof ccui.LoadingBar&&(this._prevIgnoreSize=loadingBar._prevIgnoreSize,this.setScale9Enabled(loadingBar._scale9Enabled),this.loadTexture(loadingBar._textureFile,loadingBar._renderBarTexType),this.setCapInsets(loadingBar._capInsets),this.setPercent(loadingBar._percent),this.setDirection(loadingBar._direction))}}),(_p=ccui.LoadingBar.prototype).direction,cc.defineGetterSetter(_p,"direction",_p.getDirection,_p.setDirection),_p.percent,cc.defineGetterSetter(_p,"percent",_p.getPercent,_p.setPercent),_p=null,ccui.LoadingBar.create=function(textureName,percentage){return new ccui.LoadingBar(textureName,percentage)},ccui.LoadingBar.TYPE_LEFT=0,ccui.LoadingBar.TYPE_RIGHT=1,ccui.LoadingBar.RENDERER_ZORDER=-1,ccui.Slider=ccui.Widget.extend({_barRenderer:null,_progressBarRenderer:null,_barTextureSize:null,_progressBarTextureSize:null,_slidBallNormalRenderer:null,_slidBallPressedRenderer:null,_slidBallDisabledRenderer:null,_slidBallRenderer:null,_barLength:0,_percent:0,_scale9Enabled:!1,_prevIgnoreSize:!0,_textureFile:"",_progressBarTextureFile:"",_slidBallNormalTextureFile:"",_slidBallPressedTextureFile:"",_slidBallDisabledTextureFile:"",_capInsetsBarRenderer:null,_capInsetsProgressBarRenderer:null,_sliderEventListener:null,_sliderEventSelector:null,_barTexType:ccui.Widget.LOCAL_TEXTURE,_progressBarTexType:ccui.Widget.LOCAL_TEXTURE,_ballNTexType:ccui.Widget.LOCAL_TEXTURE,_ballPTexType:ccui.Widget.LOCAL_TEXTURE,_ballDTexType:ccui.Widget.LOCAL_TEXTURE,_isTextureLoaded:!1,_className:"Slider",_barRendererAdaptDirty:!0,_progressBarRendererDirty:!0,_unifySize:!1,_zoomScale:.1,_sliderBallNormalTextureScaleX:1,_sliderBallNormalTextureScaleY:1,ctor:function(barTextureName,normalBallTextureName,resType){this._barTextureSize=cc.size(0,0),this._progressBarTextureSize=cc.size(0,0),this._capInsetsBarRenderer=cc.rect(0,0,0,0),this._capInsetsProgressBarRenderer=cc.rect(0,0,0,0),ccui.Widget.prototype.ctor.call(this),resType=resType||0,this.setTouchEnabled(!0),barTextureName&&this.loadBarTexture(barTextureName,resType),normalBallTextureName&&this.loadSlidBallTextures(normalBallTextureName,resType)},_initRenderer:function(){this._barRenderer=new cc.Sprite,this._progressBarRenderer=new cc.Sprite,this._progressBarRenderer.setAnchorPoint(0,.5),this.addProtectedChild(this._barRenderer,ccui.Slider.BASEBAR_RENDERER_ZORDER,-1),this.addProtectedChild(this._progressBarRenderer,ccui.Slider.PROGRESSBAR_RENDERER_ZORDER,-1),this._slidBallNormalRenderer=new cc.Sprite,this._slidBallPressedRenderer=new cc.Sprite,this._slidBallPressedRenderer.setVisible(!1),this._slidBallDisabledRenderer=new cc.Sprite,this._slidBallDisabledRenderer.setVisible(!1),this._slidBallRenderer=new cc.Node,this._slidBallRenderer.addChild(this._slidBallNormalRenderer),this._slidBallRenderer.addChild(this._slidBallPressedRenderer),this._slidBallRenderer.addChild(this._slidBallDisabledRenderer),this._slidBallRenderer.setCascadeColorEnabled(!0),this._slidBallRenderer.setCascadeOpacityEnabled(!0),this.addProtectedChild(this._slidBallRenderer,ccui.Slider.BALL_RENDERER_ZORDER,-1)},loadBarTexture:function(fileName,texType){if(fileName){texType=texType||ccui.Widget.LOCAL_TEXTURE,this._textureFile=fileName,this._barTexType=texType;var barRenderer=this._barRenderer,self=this;switch(barRenderer._textureLoaded||barRenderer.addEventListener("load",function(){self.loadBarTexture(self._textureFile,self._barTexType)}),this._barTexType){case ccui.Widget.LOCAL_TEXTURE:barRenderer.initWithFile(fileName);break;case ccui.Widget.PLIST_TEXTURE:barRenderer.initWithSpriteFrameName(fileName)}this._updateChildrenDisplayedRGBA(),this._barRendererAdaptDirty=!0,this._progressBarRendererDirty=!0,this._updateContentSizeWithTextureSize(this._barRenderer.getContentSize()),this._findLayout(),this._barTextureSize=this._barRenderer.getContentSize()}},loadProgressBarTexture:function(fileName,texType){if(fileName){texType=texType||ccui.Widget.LOCAL_TEXTURE,this._progressBarTextureFile=fileName,this._progressBarTexType=texType;var progressBarRenderer=this._progressBarRenderer,self=this;switch(progressBarRenderer._textureLoaded||progressBarRenderer.addEventListener("load",function(){self.loadProgressBarTexture(self._progressBarTextureFile,self._progressBarTexType)}),this._progressBarTexType){case ccui.Widget.LOCAL_TEXTURE:progressBarRenderer.initWithFile(fileName);break;case ccui.Widget.PLIST_TEXTURE:progressBarRenderer.initWithSpriteFrameName(fileName)}this._updateChildrenDisplayedRGBA(),this._progressBarRenderer.setAnchorPoint(cc.p(0,.5));var tz=this._progressBarRenderer.getContentSize();this._progressBarTextureSize={width:tz.width,height:tz.height},this._progressBarRendererDirty=!0,this._findLayout()}},setScale9Enabled:function(able){if(this._scale9Enabled!==able){if(this._scale9Enabled=able,this.removeProtectedChild(this._barRenderer,!0),this.removeProtectedChild(this._progressBarRenderer,!0),this._barRenderer=null,this._progressBarRenderer=null,this._scale9Enabled?(this._barRenderer=new ccui.Scale9Sprite,this._progressBarRenderer=new ccui.Scale9Sprite):(this._barRenderer=new cc.Sprite,this._progressBarRenderer=new cc.Sprite),this.loadBarTexture(this._textureFile,this._barTexType),this.loadProgressBarTexture(this._progressBarTextureFile,this._progressBarTexType),this.addProtectedChild(this._barRenderer,ccui.Slider.BASEBAR_RENDERER_ZORDER,-1),this.addProtectedChild(this._progressBarRenderer,ccui.Slider.PROGRESSBAR_RENDERER_ZORDER,-1),this._scale9Enabled){var ignoreBefore=this._ignoreSize;this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=ignoreBefore}else this.ignoreContentAdaptWithSize(this._prevIgnoreSize);this.setCapInsetsBarRenderer(this._capInsetsBarRenderer),this.setCapInsetProgressBarRenderer(this._capInsetsProgressBarRenderer),this._barRendererAdaptDirty=!0,this._progressBarRendererDirty=!0}},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(ignore){(!this._scale9Enabled||this._scale9Enabled&&!ignore)&&(ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,ignore),this._prevIgnoreSize=ignore)},setCapInsets:function(capInsets){this.setCapInsetsBarRenderer(capInsets),this.setCapInsetProgressBarRenderer(capInsets)},setCapInsetsBarRenderer:function(capInsets){if(capInsets){var locInsets=this._capInsetsBarRenderer;locInsets.x=capInsets.x,locInsets.y=capInsets.y,locInsets.width=capInsets.width,locInsets.height=capInsets.height,this._scale9Enabled&&this._barRenderer.setCapInsets(capInsets)}},getCapInsetsBarRenderer:function(){return cc.rect(this._capInsetsBarRenderer)},setCapInsetProgressBarRenderer:function(capInsets){if(capInsets){var locInsets=this._capInsetsProgressBarRenderer;locInsets.x=capInsets.x,locInsets.y=capInsets.y,locInsets.width=capInsets.width,locInsets.height=capInsets.height,this._scale9Enabled&&this._progressBarRenderer.setCapInsets(capInsets)}},getCapInsetsProgressBarRenderer:function(){return cc.rect(this._capInsetsProgressBarRenderer)},loadSlidBallTextures:function(normal,pressed,disabled,texType){this.loadSlidBallTextureNormal(normal,texType),this.loadSlidBallTexturePressed(pressed,texType),this.loadSlidBallTextureDisabled(disabled,texType)},loadSlidBallTextureNormal:function(normal,texType){if(normal){texType=texType||ccui.Widget.LOCAL_TEXTURE,this._slidBallNormalTextureFile=normal,this._ballNTexType=texType;var self=this;switch(this._slidBallNormalRenderer._textureLoaded||this._slidBallNormalRenderer.addEventListener("load",function(){self.loadSlidBallTextureNormal(self._slidBallNormalTextureFile,self._ballNTexType)}),this._ballNTexType){case ccui.Widget.LOCAL_TEXTURE:this._slidBallNormalRenderer.initWithFile(normal);break;case ccui.Widget.PLIST_TEXTURE:this._slidBallNormalRenderer.initWithSpriteFrameName(normal)}this._updateChildrenDisplayedRGBA(),this._findLayout()}},loadSlidBallTexturePressed:function(pressed,texType){if(pressed){texType=texType||ccui.Widget.LOCAL_TEXTURE,this._slidBallPressedTextureFile=pressed,this._ballPTexType=texType;var self=this;switch(this._slidBallPressedRenderer._textureLoaded||this._slidBallPressedRenderer.addEventListener("load",function(){self.loadSlidBallTexturePressed(self._slidBallPressedTextureFile,self._ballPTexType)}),this._ballPTexType){case ccui.Widget.LOCAL_TEXTURE:this._slidBallPressedRenderer.initWithFile(pressed);break;case ccui.Widget.PLIST_TEXTURE:this._slidBallPressedRenderer.initWithSpriteFrameName(pressed)}this._updateChildrenDisplayedRGBA(),this._findLayout()}},loadSlidBallTextureDisabled:function(disabled,texType){if(disabled){texType=texType||ccui.Widget.LOCAL_TEXTURE,this._slidBallDisabledTextureFile=disabled,this._ballDTexType=texType;var self=this;switch(this._slidBallDisabledRenderer._textureLoaded||this._slidBallDisabledRenderer.addEventListener("load",function(){self.loadSlidBallTextureDisabled(self._slidBallDisabledTextureFile,self._ballDTexType)}),this._ballDTexType){case ccui.Widget.LOCAL_TEXTURE:this._slidBallDisabledRenderer.initWithFile(disabled);break;case ccui.Widget.PLIST_TEXTURE:this._slidBallDisabledRenderer.initWithSpriteFrameName(disabled)}this._updateChildrenDisplayedRGBA(),this._findLayout()}},setPercent:function(percent){percent>100&&(percent=100),percent<0&&(percent=0),this._percent=percent;var res=percent/100,dis=this._barLength*res;if(this._slidBallRenderer.setPosition(dis,this._contentSize.height/2),this._scale9Enabled)this._progressBarRenderer.setPreferredSize(cc.size(dis,this._contentSize.height));else{var spriteRenderer=this._progressBarRenderer,rect=spriteRenderer.getTextureRect();spriteRenderer.setTextureRect(cc.rect(rect.x,rect.y,dis/spriteRenderer._scaleX,rect.height),spriteRenderer.isTextureRectRotated())}},hitTest:function(pt){var nsp=this._slidBallNormalRenderer.convertToNodeSpace(pt),ballSize=this._slidBallNormalRenderer.getContentSize(),ballRect=cc.rect(0,0,ballSize.width,ballSize.height);return nsp.x>=ballRect.x&&nsp.x<=ballRect.x+ballRect.width&&nsp.y>=ballRect.y&&nsp.y<=ballRect.y+ballRect.height},onTouchBegan:function(touch,event){var pass=ccui.Widget.prototype.onTouchBegan.call(this,touch,event);if(this._hit){var nsp=this.convertToNodeSpace(this._touchBeganPosition);this.setPercent(this._getPercentWithBallPos(nsp.x)),this._percentChangedEvent()}return pass},onTouchMoved:function(touch,event){var touchPoint=touch.getLocation(),nsp=this.convertToNodeSpace(touchPoint);this.setPercent(this._getPercentWithBallPos(nsp.x)),this._percentChangedEvent()},onTouchEnded:function(touch,event){ccui.Widget.prototype.onTouchEnded.call(this,touch,event)},onTouchCancelled:function(touch,event){ccui.Widget.prototype.onTouchCancelled.call(this,touch,event)},_getPercentWithBallPos:function(px){return px/this._barLength*100},addEventListenerSlider:function(selector,target){this.addEventListener(selector,target)},addEventListener:function(selector,target){this._sliderEventSelector=selector,this._sliderEventListener=target},_percentChangedEvent:function(){this._sliderEventSelector&&(this._sliderEventListener?this._sliderEventSelector.call(this._sliderEventListener,this,ccui.Slider.EVENT_PERCENT_CHANGED):this._sliderEventSelector(this,ccui.Slider.EVENT_PERCENT_CHANGED)),this._ccEventCallback&&this._ccEventCallback(this,ccui.Slider.EVENT_PERCENT_CHANGED)},getPercent:function(){return this._percent},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._barRendererAdaptDirty=!0,this._progressBarRendererDirty=!0},_adaptRenderers:function(){this._barRendererAdaptDirty&&(this._barRendererScaleChangedWithSize(),this._barRendererAdaptDirty=!1),this._progressBarRendererDirty&&(this._progressBarRendererScaleChangedWithSize(),this._progressBarRendererDirty=!1)},getVirtualRendererSize:function(){return this._barRenderer.getContentSize()},getVirtualRenderer:function(){return this._barRenderer},_barRendererScaleChangedWithSize:function(){if(this._unifySize)this._barLength=this._contentSize.width,this._barRenderer.setPreferredSize(this._contentSize);else if(this._ignoreSize)this._barRenderer.setScale(1),this._barLength=this._contentSize.width;else if(this._barLength=this._contentSize.width,this._scale9Enabled)this._barRenderer.setPreferredSize(this._contentSize),this._barRenderer.setScale(1);else{var btextureSize=this._barTextureSize;if(btextureSize.width<=0||btextureSize.height<=0)this._barRenderer.setScale(1);else{var bscaleX=this._contentSize.width/btextureSize.width,bscaleY=this._contentSize.height/btextureSize.height;this._barRenderer.setScaleX(bscaleX),this._barRenderer.setScaleY(bscaleY)}}this._barRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2),this.setPercent(this._percent)},_progressBarRendererScaleChangedWithSize:function(){if(this._unifySize)this._progressBarRenderer.setPreferredSize(this._contentSize);else if(this._ignoreSize){if(!this._scale9Enabled){var ptextureSize=this._progressBarTextureSize,pscaleX=this._contentSize.width/ptextureSize.width,pscaleY=this._contentSize.height/ptextureSize.height;this._progressBarRenderer.setScaleX(pscaleX),this._progressBarRenderer.setScaleY(pscaleY)}}else if(this._scale9Enabled)this._progressBarRenderer.setPreferredSize(this._contentSize),this._progressBarRenderer.setScale(1);else{if((ptextureSize=this._progressBarTextureSize).width<=0||ptextureSize.height<=0)return void this._progressBarRenderer.setScale(1);var pscaleX=this._contentSize.width/ptextureSize.width,pscaleY=this._contentSize.height/ptextureSize.height;this._progressBarRenderer.setScaleX(pscaleX),this._progressBarRenderer.setScaleY(pscaleY)}this._progressBarRenderer.setPosition(0,this._contentSize.height/2),this.setPercent(this._percent)},_onPressStateChangedToNormal:function(){this._slidBallNormalRenderer.setVisible(!0),this._slidBallPressedRenderer.setVisible(!1),this._slidBallDisabledRenderer.setVisible(!1),this._slidBallNormalRenderer.setScale(this._sliderBallNormalTextureScaleX,this._sliderBallNormalTextureScaleY),cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(this._slidBallNormalRenderer._renderCmd._shaderProgram=this._getNormalGLProgram())},_onPressStateChangedToPressed:function(){this._slidBallPressedTextureFile?(this._slidBallNormalRenderer.setVisible(!1),this._slidBallPressedRenderer.setVisible(!0),this._slidBallDisabledRenderer.setVisible(!1)):this._slidBallNormalRenderer.setScale(this._sliderBallNormalTextureScaleX+this._zoomScale,this._sliderBallNormalTextureScaleY+this._zoomScale),cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(this._slidBallNormalRenderer._renderCmd._shaderProgram=this._getNormalGLProgram())},_onPressStateChangedToDisabled:function(){this._slidBallDisabledTextureFile?(this._slidBallNormalRenderer.setVisible(!1),this._slidBallDisabledRenderer.setVisible(!0)):(this._slidBallNormalRenderer.setVisible(!0),cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(this._slidBallNormalRenderer._renderCmd._shaderProgram=this._getGrayGLProgram())),this._slidBallNormalRenderer.setScale(this._sliderBallNormalTextureScaleX,this._sliderBallNormalTextureScaleY),this._slidBallPressedRenderer.setVisible(!1)},setZoomScale:function(scale){this._zoomScale=scale},getZoomScale:function(){return this._zoomScale},getSlidBallNormalRenderer:function(){return this._slidBallNormalRenderer},getSlidBallPressedRenderer:function(){return this._slidBallPressedRenderer},getSlidBallDisabledRenderer:function(){return this._slidBallDisabledRenderer},getSlidBallRenderer:function(){return this._slidBallRenderer},getDescription:function(){return"Slider"},_createCloneInstance:function(){return new ccui.Slider},_copySpecialProperties:function(slider){this._prevIgnoreSize=slider._prevIgnoreSize,this.setScale9Enabled(slider._scale9Enabled),this.loadBarTexture(slider._textureFile,slider._barTexType),this.loadProgressBarTexture(slider._progressBarTextureFile,slider._progressBarTexType),this.loadSlidBallTextureNormal(slider._slidBallNormalTextureFile,slider._ballNTexType),this.loadSlidBallTexturePressed(slider._slidBallPressedTextureFile,slider._ballPTexType),this.loadSlidBallTextureDisabled(slider._slidBallDisabledTextureFile,slider._ballDTexType),this.setPercent(slider.getPercent()),this._sliderEventListener=slider._sliderEventListener,this._sliderEventSelector=slider._sliderEventSelector,this._zoomScale=slider._zoomScale,this._ccEventCallback=slider._ccEventCallback}}),(_p=ccui.Slider.prototype).percent,cc.defineGetterSetter(_p,"percent",_p.getPercent,_p.setPercent),_p=null,ccui.Slider.create=function(barTextureName,normalBallTextureName,resType){return new ccui.Slider(barTextureName,normalBallTextureName,resType)},ccui.Slider.EVENT_PERCENT_CHANGED=0,ccui.Slider.BASEBAR_RENDERER_ZORDER=-3,ccui.Slider.PROGRESSBAR_RENDERER_ZORDER=-2,ccui.Slider.BALL_RENDERER_ZORDER=-1,ccui.Text=ccui.Widget.extend({_touchScaleChangeEnabled:!1,_normalScaleValueX:1,_normalScaleValueY:1,_fontName:"Arial",_fontSize:16,_onSelectedScaleOffset:.5,_labelRenderer:null,_textAreaSize:null,_textVerticalAlignment:0,_textHorizontalAlignment:0,_className:"Text",_type:null,_labelRendererAdaptDirty:!0,ctor:function(textContent,fontName,fontSize){this._type=ccui.Text.Type.SYSTEM,this._textAreaSize=cc.size(0,0),ccui.Widget.prototype.ctor.call(this),void 0!==fontSize?(this.setFontName(fontName),this.setFontSize(fontSize),this.setString(textContent)):this.setFontName(this._fontName)},_initRenderer:function(){this._labelRenderer=new cc.LabelTTF,this.addProtectedChild(this._labelRenderer,ccui.Text.RENDERER_ZORDER,-1)},setText:function(text){cc.log("Please use the setString"),this.setString(text)},setString:function(text){text!==this._labelRenderer.getString()&&(this._labelRenderer.setString(text),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0)},_setString:function(text){text!==this._labelRenderer.getString()&&(this._labelRenderer.setString(text),this._labelRendererAdaptDirty=!0)},getStringValue:function(){return cc.log("Please use the getString"),this._labelRenderer.getString()},getString:function(){return this._labelRenderer.getString()},getStringLength:function(){return this._labelRenderer.getStringLength()},setFontSize:function(size){this._labelRenderer.setFontSize(size),this._fontSize=size,this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},_setFontSize:function(size){this._labelRenderer.setFontSize(size),this._fontSize=size,this._labelRendererAdaptDirty=!0},getFontSize:function(){return this._fontSize},setFontName:function(name){this._fontName=name,this._labelRenderer.setFontName(name),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},_setFontName:function(name){this._fontName=name,this._labelRenderer.setFontName(name),this._labelRendererAdaptDirty=!0},_updateUITextContentSize:function(){this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize())},getFontName:function(){return this._fontName},_setFont:function(font){var res=cc.LabelTTF._fontStyleRE.exec(font);res&&(this._fontSize=parseInt(res[1]),this._fontName=res[2],this._labelRenderer._setFont(font),this._labelScaleChangedWithSize())},_getFont:function(){return this._labelRenderer._getFont()},getType:function(){return this._type},setTextAreaSize:function(size){this._labelRenderer.setDimensions(size),this._ignoreSize||(this._customSize=size),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},_setTextAreaSize:function(size){this._labelRenderer.setDimensions(size),this._ignoreSize||(this._customSize=size),this._labelRendererAdaptDirty=!0},getTextAreaSize:function(){return this._labelRenderer.getDimensions()},setTextHorizontalAlignment:function(alignment){this._labelRenderer.setHorizontalAlignment(alignment),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},_setTextHorizontalAlignment:function(alignment){this._labelRenderer.setHorizontalAlignment(alignment),this._labelRendererAdaptDirty=!0},getTextHorizontalAlignment:function(){return this._labelRenderer.getHorizontalAlignment()},setTextVerticalAlignment:function(alignment){this._labelRenderer.setVerticalAlignment(alignment),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},_setTextVerticalAlignment:function(alignment){this._labelRenderer.setVerticalAlignment(alignment),this._labelRendererAdaptDirty=!0},getTextVerticalAlignment:function(){return this._labelRenderer.getVerticalAlignment()},setTouchScaleChangeEnabled:function(enable){this._touchScaleChangeEnabled=enable},isTouchScaleChangeEnabled:function(){return this._touchScaleChangeEnabled},_onPressStateChangedToNormal:function(){this._touchScaleChangeEnabled&&(this._labelRenderer.setScaleX(this._normalScaleValueX),this._labelRenderer.setScaleY(this._normalScaleValueY))},_onPressStateChangedToPressed:function(){this._touchScaleChangeEnabled&&(this._labelRenderer.setScaleX(this._normalScaleValueX+this._onSelectedScaleOffset),this._labelRenderer.setScaleY(this._normalScaleValueY+this._onSelectedScaleOffset))},_onPressStateChangedToDisabled:function(){},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._labelRendererAdaptDirty=!0},_adaptRenderers:function(){this._labelRendererAdaptDirty&&(this._labelScaleChangedWithSize(),this._labelRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return this._labelRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelRenderer},getAutoRenderSize:function(){var virtualSize=this._labelRenderer.getContentSize();return this._ignoreSize||(this._labelRenderer.setDimensions(0,0),virtualSize=this._labelRenderer.getContentSize(),this._labelRenderer.setDimensions(this._contentSize.width,this._contentSize.height)),virtualSize},_labelScaleChangedWithSize:function(){var locContentSize=this._contentSize;if(this._ignoreSize)this._labelRenderer.setDimensions(0,0),this._labelRenderer.setScale(1),this._normalScaleValueX=this._normalScaleValueY=1;else{this._labelRenderer.setDimensions(cc.size(locContentSize.width,locContentSize.height));var textureSize=this._labelRenderer.getContentSize();if(textureSize.width<=0||textureSize.height<=0)return void this._labelRenderer.setScale(1);var scaleX=locContentSize.width/textureSize.width,scaleY=locContentSize.height/textureSize.height;this._labelRenderer.setScaleX(scaleX),this._labelRenderer.setScaleY(scaleY),this._normalScaleValueX=scaleX,this._normalScaleValueY=scaleY}this._labelRenderer.setPosition(locContentSize.width/2,locContentSize.height/2)},getDescription:function(){return"Label"},enableShadow:function(shadowColor,offset,blurRadius){this._labelRenderer.enableShadow(shadowColor,offset,blurRadius)},enableOutline:function(outlineColor,outlineSize){this._labelRenderer.enableStroke(outlineColor,outlineSize)},enableGlow:function(glowColor){this._type===ccui.Text.Type.TTF&&this._labelRenderer.enableGlow(glowColor)},disableEffect:function(){this._labelRenderer.disableEffect&&this._labelRenderer.disableEffect()},_createCloneInstance:function(){return new ccui.Text},_copySpecialProperties:function(uiLabel){uiLabel instanceof ccui.Text&&(this.setFontName(uiLabel._fontName),this.setFontSize(uiLabel.getFontSize()),this.setString(uiLabel.getString()),this.setTouchScaleChangeEnabled(uiLabel.touchScaleEnabled),this.setTextAreaSize(uiLabel._textAreaSize),this.setTextHorizontalAlignment(uiLabel._labelRenderer.getHorizontalAlignment()),this.setTextVerticalAlignment(uiLabel._labelRenderer.getVerticalAlignment()),this.setContentSize(uiLabel.getContentSize()),this.setTextColor(uiLabel.getTextColor()))},_setBoundingWidth:function(value){this._textAreaSize.width=value,this._labelRenderer._setBoundingWidth(value),this._labelScaleChangedWithSize()},_setBoundingHeight:function(value){this._textAreaSize.height=value,this._labelRenderer._setBoundingHeight(value),this._labelScaleChangedWithSize()},_getBoundingWidth:function(){return this._textAreaSize.width},_getBoundingHeight:function(){return this._textAreaSize.height},_changePosition:function(){this._adaptRenderers()},setColor:function(color){cc.ProtectedNode.prototype.setColor.call(this,color),this._labelRenderer.setColor(color)},setTextColor:function(color){this._labelRenderer.setFontFillColor(color)},getTextColor:function(){return this._labelRenderer._getFillStyle()}}),(_p=ccui.Text.prototype).boundingWidth,cc.defineGetterSetter(_p,"boundingWidth",_p._getBoundingWidth,_p._setBoundingWidth),_p.boundingHeight,cc.defineGetterSetter(_p,"boundingHeight",_p._getBoundingHeight,_p._setBoundingHeight),_p.string,cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),_p.stringLength,cc.defineGetterSetter(_p,"stringLength",_p.getStringLength),_p.font,cc.defineGetterSetter(_p,"font",_p._getFont,_p._setFont),_p.fontSize,cc.defineGetterSetter(_p,"fontSize",_p.getFontSize,_p.setFontSize),_p.fontName,cc.defineGetterSetter(_p,"fontName",_p.getFontName,_p.setFontName),_p.textAlign,cc.defineGetterSetter(_p,"textAlign",_p.getTextHorizontalAlignment,_p.setTextHorizontalAlignment),_p.verticalAlign,cc.defineGetterSetter(_p,"verticalAlign",_p.getTextVerticalAlignment,_p.setTextVerticalAlignment),_p=null,ccui.Label=ccui.Text.create=function(textContent,fontName,fontSize){return new ccui.Text(textContent,fontName,fontSize)},ccui.Text.RENDERER_ZORDER=-1,ccui.Text.Type={SYSTEM:0,TTF:1},ccui.TextAtlas=ccui.Widget.extend({_labelAtlasRenderer:null,_stringValue:"",_charMapFileName:"",_itemWidth:0,_itemHeight:0,_startCharMap:"",_className:"TextAtlas",_labelAtlasRendererAdaptDirty:null,ctor:function(stringValue,charMapFile,itemWidth,itemHeight,startCharMap){ccui.Widget.prototype.ctor.call(this),void 0!==startCharMap&&this.setProperty(stringValue,charMapFile,itemWidth,itemHeight,startCharMap)},_initRenderer:function(){this._labelAtlasRenderer=new cc.LabelAtlas,this._labelAtlasRenderer.setAnchorPoint(cc.p(.5,.5)),this.addProtectedChild(this._labelAtlasRenderer,ccui.TextAtlas.RENDERER_ZORDER,-1),this._labelAtlasRenderer.addEventListener("load",function(){this._updateContentSizeWithTextureSize(this._labelAtlasRenderer.getContentSize()),this._findLayout()},this)},setProperty:function(stringValue,charMapFile,itemWidth,itemHeight,startCharMap){this._stringValue=stringValue,this._charMapFileName=charMapFile,this._itemWidth=itemWidth,this._itemHeight=itemHeight,this._startCharMap=startCharMap,this._labelAtlasRenderer.initWithString(stringValue,this._charMapFileName,this._itemWidth,this._itemHeight,this._startCharMap[0]),this._updateContentSizeWithTextureSize(this._labelAtlasRenderer.getContentSize()),this._labelAtlasRendererAdaptDirty=!0},setString:function(value){value!==this._labelAtlasRenderer.getString()&&(this._stringValue=value,this._labelAtlasRenderer.setString(value),this._updateContentSizeWithTextureSize(this._labelAtlasRenderer.getContentSize()),this._labelAtlasRendererAdaptDirty=!0)},setStringValue:function(value){cc.log("Please use the setString"),this.setString(value)},getStringValue:function(){return cc.log("Please use the getString"),this.getString()},getString:function(){return this._labelAtlasRenderer.getString()},getStringLength:function(){return this._labelAtlasRenderer.getStringLength()},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._labelAtlasRendererAdaptDirty=!0},_adaptRenderers:function(){this._labelAtlasRendererAdaptDirty&&(this._labelAtlasScaleChangedWithSize(),this._labelAtlasRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return this._labelAtlasRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelAtlasRenderer},_labelAtlasScaleChangedWithSize:function(){var locRenderer=this._labelAtlasRenderer;if(this._ignoreSize)locRenderer.setScale(1);else{var textureSize=locRenderer.getContentSize();if(textureSize.width<=0||textureSize.height<=0)return void locRenderer.setScale(1);locRenderer.setScaleX(this._contentSize.width/textureSize.width),locRenderer.setScaleY(this._contentSize.height/textureSize.height)}locRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"LabelAtlas"},_copySpecialProperties:function(labelAtlas){labelAtlas&&this.setProperty(labelAtlas._stringValue,labelAtlas._charMapFileName,labelAtlas._itemWidth,labelAtlas._itemHeight,labelAtlas._startCharMap)},_createCloneInstance:function(){return new ccui.TextAtlas}}),(_p=ccui.TextAtlas.prototype).string,cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),_p=null,ccui.TextAtlas.create=function(stringValue,charMapFile,itemWidth,itemHeight,startCharMap){return new ccui.TextAtlas(stringValue,charMapFile,itemWidth,itemHeight,startCharMap)},ccui.TextAtlas.RENDERER_ZORDER=-1,ccui.LabelBMFont=ccui.TextBMFont=ccui.Widget.extend({_labelBMFontRenderer:null,_fntFileHasInit:!1,_fntFileName:"",_stringValue:"",_className:"TextBMFont",_labelBMFontRendererAdaptDirty:!0,ctor:function(text,filename){ccui.Widget.prototype.ctor.call(this),this._loader=new cc.Sprite.LoadManager,void 0!==filename&&(this.setFntFile(filename),this.setString(text))},_initRenderer:function(){this._labelBMFontRenderer=new cc.LabelBMFont,this.addProtectedChild(this._labelBMFontRenderer,ccui.TextBMFont.RENDERER_ZORDER,-1)},setFntFile:function(fileName){if(fileName){this._fntFileName=fileName,this._fntFileHasInit=!0,this._labelBMFontRenderer.initWithString(this._stringValue,fileName),this._updateContentSizeWithTextureSize(this._labelBMFontRenderer.getContentSize()),this._labelBMFontRendererAdaptDirty=!0;var _self=this,locRenderer=_self._labelBMFontRenderer;locRenderer._textureLoaded||locRenderer.addEventListener("load",function(){_self.setFntFile(_self._fntFileName)})}},setText:function(value){cc.log("Please use the setString"),this.setString(value)},setString:function(value){this._loader.clear(),this._labelBMFontRenderer._textureLoaded?value!==this._labelBMFontRenderer.getString()&&(this._stringValue=value,this._labelBMFontRenderer.setString(value),this._fntFileHasInit&&(this._updateContentSizeWithTextureSize(this._labelBMFontRenderer.getContentSize()),this._labelBMFontRendererAdaptDirty=!0)):this._loader.add(this._labelBMFontRenderer,function(){this.setString(value)},this)},getString:function(){return this._stringValue},getStringLength:function(){return this._labelBMFontRenderer.getStringLength()},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._labelBMFontRendererAdaptDirty=!0},_adaptRenderers:function(){this._labelBMFontRendererAdaptDirty&&(this._labelBMFontScaleChangedWithSize(),this._labelBMFontRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return this._labelBMFontRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelBMFontRenderer},_labelBMFontScaleChangedWithSize:function(){var locRenderer=this._labelBMFontRenderer;if(this._ignoreSize)locRenderer.setScale(1);else{var textureSize=locRenderer.getContentSize();if(textureSize.width<=0||textureSize.height<=0)return void locRenderer.setScale(1);locRenderer.setScaleX(this._contentSize.width/textureSize.width),locRenderer.setScaleY(this._contentSize.height/textureSize.height)}locRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"TextBMFont"},_createCloneInstance:function(){return new ccui.TextBMFont},_copySpecialProperties:function(labelBMFont){this.setFntFile(labelBMFont._fntFileName),this.setString(labelBMFont._stringValue)}}),(_p=ccui.TextBMFont.prototype).string,cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),_p=null,ccui.TextBMFont.create=function(text,filename){return new ccui.TextBMFont(text,filename)},ccui.TextBMFont.RENDERER_ZORDER=-1,ccui._TextFieldRenderer=cc.TextFieldTTF.extend({_maxLengthEnabled:!1,_maxLength:0,_passwordEnabled:!1,_passwordStyleText:"",_attachWithIME:!1,_detachWithIME:!1,_insertText:!1,_deleteBackward:!1,_className:"_TextFieldRenderer",ctor:function(){cc.TextFieldTTF.prototype.ctor.call(this),this._maxLengthEnabled=!1,this._maxLength=0,this._passwordEnabled=!1,this._passwordStyleText="*",this._attachWithIME=!1,this._detachWithIME=!1,this._insertText=!1,this._deleteBackward=!1},onEnter:function(){cc.TextFieldTTF.prototype.onEnter.call(this),cc.TextFieldTTF.prototype.setDelegate.call(this,this)},onTextFieldAttachWithIME:function(sender){return this.setAttachWithIME(!0),!1},onTextFieldInsertText:function(sender,text,len){return(1!==len||"\n"!==text)&&(this.setInsertText(!0),this._maxLengthEnabled&&cc.TextFieldTTF.prototype.getCharCount.call(this)>=this._maxLength)},onTextFieldDeleteBackward:function(sender,delText,nLen){return this.setDeleteBackward(!0),!1},onTextFieldDetachWithIME:function(sender){return this.setDetachWithIME(!0),!1},insertText:function(text,len){var input_text=text;"\n"!==text&&this._maxLengthEnabled&&this.getString().length>=this._maxLength?this._passwordEnabled&&this.setPasswordText(this.getString()):(cc.TextFieldTTF.prototype.insertText.call(this,input_text,len),this._passwordEnabled&&cc.TextFieldTTF.prototype.getCharCount.call(this)>0&&this.setPasswordText(this.getString()))},deleteBackward:function(){cc.TextFieldTTF.prototype.deleteBackward.call(this),cc.TextFieldTTF.prototype.getCharCount.call(this)>0&&this._passwordEnabled&&this.setPasswordText(this._inputText)},openIME:function(){cc.TextFieldTTF.prototype.attachWithIME.call(this)},closeIME:function(){cc.TextFieldTTF.prototype.detachWithIME.call(this)},setMaxLengthEnabled:function(enable){this._maxLengthEnabled=enable},isMaxLengthEnabled:function(){return this._maxLengthEnabled},setMaxLength:function(length){this._maxLength=length},getMaxLength:function(){return this._maxLength},getCharCount:function(){return cc.TextFieldTTF.prototype.getCharCount.call(this)},setPasswordEnabled:function(enable){this._passwordEnabled=enable},isPasswordEnabled:function(){return this._passwordEnabled},setPasswordStyleText:function(styleText){if(!(styleText.length>1)){var header=styleText.charCodeAt(0);header<33||header>126||(this._passwordStyleText=styleText)}},setPasswordText:function(text){var tempStr="",text_count=text.length,max=text_count;this._maxLengthEnabled&&text_count>this._maxLength&&(max=this._maxLength);for(var i=0;i<max;++i)tempStr+=this._passwordStyleText;cc.LabelTTF.prototype.setString.call(this,tempStr)},setAttachWithIME:function(attach){this._attachWithIME=attach},getAttachWithIME:function(){return this._attachWithIME},setDetachWithIME:function(detach){this._detachWithIME=detach},getDetachWithIME:function(){return this._detachWithIME},setInsertText:function(insert){this._insertText=insert},getInsertText:function(){return this._insertText},setDeleteBackward:function(deleteBackward){this._deleteBackward=deleteBackward},getDeleteBackward:function(){return this._deleteBackward},onDraw:function(sender){return!1}}),ccui._TextFieldRenderer.create=function(placeholder,fontName,fontSize){var ret=new ccui._TextFieldRenderer;return ret&&ret.initWithString("",fontName,fontSize)?(placeholder&&ret.setPlaceHolder(placeholder),ret):null},ccui.TextField=ccui.Widget.extend({_textFieldRenderer:null,_touchWidth:0,_touchHeight:0,_useTouchArea:!1,_textFieldEventListener:null,_textFieldEventSelector:null,_passwordStyleText:"",_textFieldRendererAdaptDirty:!0,_fontName:"",_fontSize:12,_ccEventCallback:null,ctor:function(placeholder,fontName,fontSize){ccui.Widget.prototype.ctor.call(this),this.setTouchEnabled(!0),fontName&&this.setFontName(fontName),fontSize&&this.setFontSize(fontSize),placeholder&&this.setPlaceHolder(placeholder)},onEnter:function(){ccui.Widget.prototype.onEnter.call(this),this.scheduleUpdate()},_initRenderer:function(){this._textFieldRenderer=ccui._TextFieldRenderer.create("input words here","Thonburi",20),this.addProtectedChild(this._textFieldRenderer,ccui.TextField.RENDERER_ZORDER,-1)},setTouchSize:function(size){this._touchWidth=size.width,this._touchHeight=size.height},setTouchAreaEnabled:function(enable){this._useTouchArea=enable},hitTest:function(pt){if(this._useTouchArea){var nsp=this.convertToNodeSpace(pt),bb=cc.rect(-this._touchWidth*this._anchorPoint.x,-this._touchHeight*this._anchorPoint.y,this._touchWidth,this._touchHeight);return nsp.x>=bb.x&&nsp.x<=bb.x+bb.width&&nsp.y>=bb.y&&nsp.y<=bb.y+bb.height}return ccui.Widget.prototype.hitTest.call(this,pt)},getTouchSize:function(){return cc.size(this._touchWidth,this._touchHeight)},setText:function(text){cc.log("Please use the setString"),this.setString(text)},setString:function(text){null!=text&&(text=String(text),this.isMaxLengthEnabled()&&(text=text.substr(0,this.getMaxLength())),this.isPasswordEnabled()?(this._textFieldRenderer.setPasswordText(text),this._textFieldRenderer.setString(""),this._textFieldRenderer.insertText(text,text.length)):this._textFieldRenderer.setString(text),this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize()))},setPlaceHolder:function(value){this._textFieldRenderer.setPlaceHolder(value),this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},getPlaceHolder:function(){return this._textFieldRenderer.getPlaceHolder()},getPlaceHolderColor:function(){return this._textFieldRenderer.getPlaceHolderColor()},setPlaceHolderColor:function(color){this._textFieldRenderer.setColorSpaceHolder(color)},setTextColor:function(textColor){this._textFieldRenderer.setTextColor(textColor)},setFontSize:function(size){this._textFieldRenderer.setFontSize(size),this._fontSize=size,this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},getFontSize:function(){return this._fontSize},setFontName:function(name){this._textFieldRenderer.setFontName(name),this._fontName=name,this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},getFontName:function(){return this._fontName},didNotSelectSelf:function(){this._textFieldRenderer.detachWithIME()},getStringValue:function(){return cc.log("Please use the getString"),this.getString()},getString:function(){return this._textFieldRenderer.getString()},getStringLength:function(){return this._textFieldRenderer.getStringLength()},onTouchBegan:function(touchPoint,unusedEvent){var self=this,pass=ccui.Widget.prototype.onTouchBegan.call(self,touchPoint,unusedEvent);return self._hit?setTimeout(function(){self._textFieldRenderer.attachWithIME()},0):setTimeout(function(){self._textFieldRenderer.detachWithIME()},0),pass},setMaxLengthEnabled:function(enable){this._textFieldRenderer.setMaxLengthEnabled(enable)},isMaxLengthEnabled:function(){return this._textFieldRenderer.isMaxLengthEnabled()},setMaxLength:function(length){this._textFieldRenderer.setMaxLength(length),this.setString(this.getString())},getMaxLength:function(){return this._textFieldRenderer.getMaxLength()},setPasswordEnabled:function(enable){this._textFieldRenderer.setPasswordEnabled(enable)},isPasswordEnabled:function(){return this._textFieldRenderer.isPasswordEnabled()},setPasswordStyleText:function(styleText){this._textFieldRenderer.setPasswordStyleText(styleText),this._passwordStyleText=styleText,this.setString(this.getString())},getPasswordStyleText:function(){return this._passwordStyleText},update:function(dt){this.getDetachWithIME()&&(this._detachWithIMEEvent(),this.setDetachWithIME(!1)),this.getAttachWithIME()&&(this._attachWithIMEEvent(),this.setAttachWithIME(!1)),this.getInsertText()&&(this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize()),this._insertTextEvent(),this.setInsertText(!1)),this.getDeleteBackward()&&(this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize()),this._deleteBackwardEvent(),this.setDeleteBackward(!1))},getAttachWithIME:function(){return this._textFieldRenderer.getAttachWithIME()},setAttachWithIME:function(attach){this._textFieldRenderer.setAttachWithIME(attach)},getDetachWithIME:function(){return this._textFieldRenderer.getDetachWithIME()},setDetachWithIME:function(detach){this._textFieldRenderer.setDetachWithIME(detach)},getInsertText:function(){return this._textFieldRenderer.getInsertText()},setInsertText:function(insertText){this._textFieldRenderer.setInsertText(insertText)},getDeleteBackward:function(){return this._textFieldRenderer.getDeleteBackward()},setDeleteBackward:function(deleteBackward){this._textFieldRenderer.setDeleteBackward(deleteBackward)},_attachWithIMEEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_ATTACH_WITH_IME):this._textFieldEventSelector(this,ccui.TextField.EVENT_ATTACH_WITH_IME)),this._ccEventCallback&&this._ccEventCallback(this,ccui.TextField.EVENT_ATTACH_WITH_IME)},_detachWithIMEEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_DETACH_WITH_IME):this._textFieldEventSelector(this,ccui.TextField.EVENT_DETACH_WITH_IME)),this._ccEventCallback&&this._ccEventCallback(this,ccui.TextField.EVENT_DETACH_WITH_IME)},_insertTextEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_INSERT_TEXT):this._textFieldEventSelector(this,ccui.TextField.EVENT_INSERT_TEXT)),this._ccEventCallback&&this._ccEventCallback(this,ccui.TextField.EVENT_INSERT_TEXT)},_deleteBackwardEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_DELETE_BACKWARD):this._textFieldEventSelector(this,ccui.TextField.EVENT_DELETE_BACKWARD)),this._ccEventCallback&&this._ccEventCallback(this,ccui.TextField.EVENT_DELETE_BACKWARD)},addEventListenerTextField:function(selector,target){this.addEventListener(selector,target)},addEventListener:function(selector,target){this._textFieldEventSelector=selector,this._textFieldEventListener=target},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._textFieldRendererAdaptDirty=!0},_adaptRenderers:function(){this._textFieldRendererAdaptDirty&&(this._textfieldRendererScaleChangedWithSize(),this._textFieldRendererAdaptDirty=!1)},_textfieldRendererScaleChangedWithSize:function(){this._ignoreSize||this._textFieldRenderer.setDimensions(this._contentSize),this._textFieldRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getAutoRenderSize:function(){var virtualSize=this._textFieldRenderer.getContentSize();return this._ignoreSize||(this._textFieldRenderer.setDimensions(0,0),virtualSize=this._textFieldRenderer.getContentSize(),this._textFieldRenderer.setDimensions(this._contentSize.width,this._contentSize.height)),virtualSize},getVirtualRendererSize:function(){return this._textFieldRenderer.getContentSize()},getVirtualRenderer:function(){return this._textFieldRenderer},getDescription:function(){return"TextField"},attachWithIME:function(){this._textFieldRenderer.attachWithIME()},_createCloneInstance:function(){return new ccui.TextField},_copySpecialProperties:function(textField){this.setString(textField._textFieldRenderer.getString()),this.setPlaceHolder(textField.getString()),this.setFontSize(textField._textFieldRenderer.getFontSize()),this.setFontName(textField._textFieldRenderer.getFontName()),this.setMaxLengthEnabled(textField.isMaxLengthEnabled()),this.setMaxLength(textField.getMaxLength()),this.setPasswordEnabled(textField.isPasswordEnabled()),this.setPasswordStyleText(textField._passwordStyleText),this.setAttachWithIME(textField.getAttachWithIME()),this.setDetachWithIME(textField.getDetachWithIME()),this.setInsertText(textField.getInsertText()),this.setDeleteBackward(textField.getDeleteBackward()),this._ccEventCallback=textField._ccEventCallback,this._textFieldEventListener=textField._textFieldEventListener,this._textFieldEventSelector=textField._textFieldEventSelector},setTextAreaSize:function(size){this.setContentSize(size)},setTextHorizontalAlignment:function(alignment){this._textFieldRenderer.setHorizontalAlignment(alignment)},setTextVerticalAlignment:function(alignment){this._textFieldRenderer.setVerticalAlignment(alignment)},_setFont:function(font){this._textFieldRenderer._setFont(font),this._textFieldRendererAdaptDirty=!0},_getFont:function(){return this._textFieldRenderer._getFont()},_changePosition:function(){this._adaptRenderers()}}),ccui.TextField.create=function(placeholder,fontName,fontSize){return new ccui.TextField(placeholder,fontName,fontSize)},(_p=ccui.TextField.prototype).string,cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),_p.placeHolder,cc.defineGetterSetter(_p,"placeHolder",_p.getPlaceHolder,_p.setPlaceHolder),_p.font,cc.defineGetterSetter(_p,"font",_p._getFont,_p._setFont),_p.fontSize,cc.defineGetterSetter(_p,"fontSize",_p.getFontSize,_p.setFontSize),_p.fontName,cc.defineGetterSetter(_p,"fontName",_p.getFontName,_p.setFontName),_p.maxLengthEnabled,cc.defineGetterSetter(_p,"maxLengthEnabled",_p.isMaxLengthEnabled,_p.setMaxLengthEnabled),_p.maxLength,cc.defineGetterSetter(_p,"maxLength",_p.getMaxLength,_p.setMaxLength),_p.passwordEnabled,cc.defineGetterSetter(_p,"passwordEnabled",_p.isPasswordEnabled,_p.setPasswordEnabled),_p=null,ccui.TextField.EVENT_ATTACH_WITH_IME=0,ccui.TextField.EVENT_DETACH_WITH_IME=1,ccui.TextField.EVENT_INSERT_TEXT=2,ccui.TextField.EVENT_DELETE_BACKWARD=3,ccui.TextField.RENDERER_ZORDER=-1,ccui.VideoPlayer=ccui.Widget.extend({_played:!1,_playing:!1,_stopped:!0,ctor:function(path){ccui.Widget.prototype.ctor.call(this),this._EventList={},path&&this.setURL(path)},_createRenderCmd:function(){return new ccui.VideoPlayer.RenderCmd(this)},visit:function(){var cmd=this._renderCmd,container=(cmd._div,cc.container),eventManager=cc.eventManager;if(this._visible)container.appendChild(cmd._video),null===this._listener&&(this._listener=cc.eventManager.addCustomListener(cc.game.EVENT_RESIZE,function(){cmd.resize()}));else{("contains"in container?container.contains(cmd._video):container.compareDocumentPosition(cmd._video)%16)&&container.removeChild(cmd._video),eventManager.removeListener(cmd._listener),cmd._listener=null}cmd.updateStatus(),cmd.resize()},setURL:function(address){this._renderCmd.updateURL(address)},getURL:function(){return this._renderCmd._url},play:function(){var self=this,video=this._renderCmd._video;video&&(this._played=!0,video.pause(),!1===this._stopped&&!1===this._playing&&!0===this._played||(video.currentTime=0),ccui.VideoPlayer._polyfill.autoplayAfterOperation?setTimeout(function(){video.play(),self._playing=!0,self._stopped=!1},20):(video.play(),this._playing=!0,this._stopped=!1))},pause:function(){var video=this._renderCmd._video;video&&!0===this._playing&&!1===this._stopped&&(video.pause(),this._playing=!1)},resume:function(){!1===this._stopped&&!1===this._playing&&!0===this._played&&this.play()},stop:function(){var self=this,video=this._renderCmd._video;video&&(video.pause(),video.currentTime=0,this._playing=!1,this._stopped=!0),setTimeout(function(){self._dispatchEvent(ccui.VideoPlayer.EventType.STOPPED)},0)},seekTo:function(sec){var video=this._renderCmd._video;video&&(video.currentTime=sec,ccui.VideoPlayer._polyfill.autoplayAfterOperation&&this.isPlaying()&&setTimeout(function(){video.play()},20))},isPlaying:function(){return ccui.VideoPlayer._polyfill.autoplayAfterOperation&&this._playing&&setTimeout(function(){video.play()},20),this._playing},setKeepAspectRatioEnabled:function(enable){cc.log("On the web is always keep the aspect ratio")},isKeepAspectRatioEnabled:function(){return!1},setFullScreenEnabled:function(enable){var video=this._renderCmd._video;video&&(enable?cc.screen.requestFullScreen(video):cc.screen.exitFullScreen(video))},isFullScreenEnabled:function(){cc.log("Can't know status")},setEventListener:function(event,callback){this._EventList[event]=callback},removeEventListener:function(event){this._EventList[event]=null},_dispatchEvent:function(event){var callback=this._EventList[event];callback&&callback.call(this,this,this._renderCmd._video.src)},onPlayEvent:function(){var list=this._EventList[ccui.VideoPlayer.EventType.PLAYING];if(list)for(var i=0;i<list.length;i++)list[i].call(this,this,this._renderCmd._video.src)},setContentSize:function(w,h){ccui.Widget.prototype.setContentSize.call(this,w,h),void 0===h&&(h=w.height,w=w.width),this._renderCmd.changeSize(w,h)},cleanup:function(){this._renderCmd.removeDom(),this.stopAllActions(),this.unscheduleAllCallbacks()},onEnter:function(){ccui.Widget.prototype.onEnter.call(this);var list=ccui.VideoPlayer.elements;-1===list.indexOf(this)&&list.push(this)},onExit:function(){ccui.Widget.prototype.onExit.call(this);var list=ccui.VideoPlayer.elements,index=list.indexOf(this);-1!==index&&list.splice(index,1)}}),ccui.VideoPlayer.elements=[],ccui.VideoPlayer.pauseElements=[],cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,function(){for(var node,list=ccui.VideoPlayer.elements,i=0;i<list.length;i++)node=list[i],list[i]._playing&&(node.pause(),ccui.VideoPlayer.pauseElements.push(node))}),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){for(var list=ccui.VideoPlayer.pauseElements,node=list.pop();node;)node.play(),node=list.pop()}),ccui.VideoPlayer.EventType={PLAYING:"play",PAUSED:"pause",STOPPED:"stop",COMPLETED:"complete"},function(video){video._polyfill={devicePixelRatio:!1,event:"canplay",canPlayType:[]},function(){var dom=document.createElement("video");dom.canPlayType("video/ogg")&&(video._polyfill.canPlayType.push(".ogg"),video._polyfill.canPlayType.push(".ogv")),dom.canPlayType("video/mp4")&&video._polyfill.canPlayType.push(".mp4"),dom.canPlayType("video/webm")&&video._polyfill.canPlayType.push(".webm")}(),cc.sys.OS_IOS===cc.sys.os&&(video._polyfill.devicePixelRatio=!0,video._polyfill.event="progress"),cc.sys.browserType===cc.sys.BROWSER_TYPE_FIREFOX&&(video._polyfill.autoplayAfterOperation=!0);var style=document.createElement("style");style.innerHTML=".cocosVideo:-moz-full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:-webkit-full-screen{transform:matrix(1,0,0,1,0,0) !important;}",document.head.appendChild(style)}(ccui.VideoPlayer),function(polyfill){var RenderCmd=null;RenderCmd=cc._renderType===cc.game.RENDER_TYPE_WEBGL?cc.Node.WebGLRenderCmd:cc.Node.CanvasRenderCmd,ccui.VideoPlayer.RenderCmd=function(node){this._rootCtor(node),this._listener=null,this._url="",this.initStyle()};var proto=ccui.VideoPlayer.RenderCmd.prototype=Object.create(RenderCmd.prototype);proto.constructor=ccui.VideoPlayer.RenderCmd,proto.transform=function(parentCmd,recursive){this.originTransform(parentCmd,recursive),this.updateMatrix(this._worldTransform,cc.view._scaleX,cc.view._scaleY)},proto.updateStatus=function(){polyfill.devicePixelRatio=cc.view.isRetinaEnabled();var flags=cc.Node._dirtyFlags,locFlag=this._dirtyFlag;locFlag&flags.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this.updateMatrix(this._worldTransform,cc.view._scaleX,cc.view._scaleY),this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty^this._dirtyFlag),locFlag&flags.orderDirty&&(this._dirtyFlag=this._dirtyFlag&flags.orderDirty^this._dirtyFlag)},proto.resize=function(view){view=view||cc.view;var node=this._node,eventManager=cc.eventManager;node._parent&&node._visible?this.updateMatrix(this._worldTransform,view._scaleX,view._scaleY):(eventManager.removeListener(this._listener),this._listener=null)},proto.updateMatrix=function(t,scaleX,scaleY){var node=this._node;if(polyfill.devicePixelRatio){var dpr=cc.view.getDevicePixelRatio();scaleX/=dpr,scaleY/=dpr}if(!1!==this._loaded){var containerStyle=cc.game.container.style,offsetX=parseInt(containerStyle.paddingLeft),offsetY=parseInt(containerStyle.paddingBottom),cw=node._contentSize.width,ch=node._contentSize.height,matrix="matrix("+t.a*scaleX+","+t.b+","+t.c+","+t.d*scaleY+","+(offsetX+t.tx*scaleX-cw/2+cw*node._scaleX/2*scaleX)+","+-(offsetY+t.ty*scaleY-ch/2+ch*node._scaleY/2*scaleY)+")";this._video.style.transform=matrix,this._video.style["-webkit-transform"]=matrix}},proto.updateURL=function(path){var source,video,container,extname,node=this._node;if(this._url!=path){this._url=path,cc.loader.resPath&&!/^http/.test(path)&&(path=cc.path.join(cc.loader.resPath,path)),!1,("contains"in(container=cc.container)?container.contains(this._video):container.compareDocumentPosition(this._video)%16)&&container.removeChild(this._video),this._video=document.createElement("video"),video=this._video,this.bindEvent();var self=this,cb=function(){1!=self._loaded&&(self._loaded=!0,self.changeSize(),self.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),video.removeEventListener(polyfill.event,cb),video.currentTime=0,video.style.visibility="visible",video.play(),node._played||(video.pause(),video.currentTime=0))};video.addEventListener(polyfill.event,cb),video.preload="metadata",video.style.visibility="hidden",this._loaded=!1,node._played=!1,node._playing=!1,node._stopped=!0,this.initStyle(),this._node.visit(),(source=document.createElement("source")).src=path,video.appendChild(source),extname=cc.path.extname(path);for(var i=0;i<polyfill.canPlayType.length;i++)extname!==polyfill.canPlayType[i]&&((source=document.createElement("source")).src=path.replace(extname,polyfill.canPlayType[i]),video.appendChild(source))}},proto.bindEvent=function(){var self=this,node=this._node,video=this._video;video.addEventListener("ended",function(){node._renderCmd.updateMatrix(self._worldTransform,cc.view._scaleX,cc.view._scaleY),node._playing=!1,node._dispatchEvent(ccui.VideoPlayer.EventType.COMPLETED)}),video.addEventListener("play",function(){node._dispatchEvent(ccui.VideoPlayer.EventType.PLAYING)}),video.addEventListener("pause",function(){node._dispatchEvent(ccui.VideoPlayer.EventType.PAUSED)})},proto.initStyle=function(){if(this._video){var video=this._video;video.style.position="absolute",video.style.bottom="0px",video.style.left="0px",video.className="cocosVideo"}},proto.changeSize=function(w,h){var contentSize=this._node._contentSize;w=w||contentSize.width,h=h||contentSize.height;var video=this._video;video&&(0!==w&&(video.width=w),0!==h&&(video.height=h))},proto.removeDom=function(){var video=this._video;if(video){("contains"in cc.container?cc.container.contains(video):cc.container.compareDocumentPosition(video)%16)&&cc.container.removeChild(video)}}}(ccui.VideoPlayer._polyfill),ccui.RichElement=ccui.Class.extend({_type:0,_tag:0,_color:null,_opacity:0,ctor:function(tag,color,opacity){this._type=0,this._tag=tag||0,this._color=cc.color(255,255,255,255),color&&(this._color.r=color.r,this._color.g=color.g,this._color.b=color.b),this._opacity=opacity||0,this._color.a=void 0===opacity?color.a:opacity}}),ccui.RichElementText=ccui.RichElement.extend({_text:"",_fontName:"",_fontSize:0,_fontDefinition:null,ctor:function(tag,colorOrFontDef,opacity,text,fontName,fontSize){var color=colorOrFontDef;colorOrFontDef&&colorOrFontDef instanceof cc.FontDefinition&&(color=colorOrFontDef.fillStyle,fontName=colorOrFontDef.fontName,fontSize=colorOrFontDef.fontSize,this._fontDefinition=colorOrFontDef),ccui.RichElement.prototype.ctor.call(this,tag,color,opacity),this._type=ccui.RichElement.TEXT,this._text=text,this._fontName=fontName,this._fontSize=fontSize}}),ccui.RichElementText.create=function(tag,color,opacity,text,fontName,fontSize){return new ccui.RichElementText(tag,color,opacity,text,fontName,fontSize)},ccui.RichElementImage=ccui.RichElement.extend({_filePath:"",_textureRect:null,_textureType:0,ctor:function(tag,color,opacity,filePath){ccui.RichElement.prototype.ctor.call(this,tag,color,opacity),this._type=ccui.RichElement.IMAGE,this._filePath=filePath||"",this._textureRect=cc.rect(0,0,0,0),this._textureType=0}}),ccui.RichElementImage.create=function(tag,color,opacity,filePath){return new ccui.RichElementImage(tag,color,opacity,filePath)},ccui.RichElementCustomNode=ccui.RichElement.extend({_customNode:null,ctor:function(tag,color,opacity,customNode){ccui.RichElement.prototype.ctor.call(this,tag,color,opacity),this._type=ccui.RichElement.CUSTOM,this._customNode=customNode||null}}),ccui.RichElementCustomNode.create=function(tag,color,opacity,customNode){return new ccui.RichElementCustomNode(tag,color,opacity,customNode)},ccui.RichText=ccui.Widget.extend({_formatTextDirty:!1,_richElements:null,_elementRenders:null,_leftSpaceWidth:0,_verticalSpace:0,_elementRenderersContainer:null,_lineBreakOnSpace:!1,_textHorizontalAlignment:null,_textVerticalAlignment:null,ctor:function(){ccui.Widget.prototype.ctor.call(this),this._formatTextDirty=!1,this._richElements=[],this._elementRenders=[],this._leftSpaceWidth=0,this._verticalSpace=0,this._textHorizontalAlignment=cc.TEXT_ALIGNMENT_LEFT,this._textVerticalAlignment=cc.VERTICAL_TEXT_ALIGNMENT_TOP},_initRenderer:function(){this._elementRenderersContainer=new cc.Node,this._elementRenderersContainer.setAnchorPoint(.5,.5),this.addProtectedChild(this._elementRenderersContainer,0,-1)},insertElement:function(element,index){this._richElements.splice(index,0,element),this._formatTextDirty=!0},pushBackElement:function(element){this._richElements.push(element),this._formatTextDirty=!0},removeElement:function(element){cc.isNumber(element)?this._richElements.splice(element,1):cc.arrayRemoveObject(this._richElements,element),this._formatTextDirty=!0},formatText:function(){if(this._formatTextDirty){this._elementRenderersContainer.removeAllChildren(),this._elementRenders.length=0;var i,element,locRichElements=this._richElements;if(this._ignoreSize)for(this._addNewLine(),i=0;i<locRichElements.length;i++){var elementRenderer=null;switch((element=locRichElements[i])._type){case ccui.RichElement.TEXT:elementRenderer=element._fontDefinition?new cc.LabelTTF(element._text,element._fontDefinition):new cc.LabelTTF(element._text,element._fontName,element._fontSize);break;case ccui.RichElement.IMAGE:elementRenderer=new cc.Sprite(element._filePath);break;case ccui.RichElement.CUSTOM:elementRenderer=element._customNode}elementRenderer.setColor(element._color),elementRenderer.setOpacity(element._color.a),this._pushToContainer(elementRenderer)}else for(this._addNewLine(),i=0;i<locRichElements.length;i++)switch((element=locRichElements[i])._type){case ccui.RichElement.TEXT:element._fontDefinition?this._handleTextRenderer(element._text,element._fontDefinition,element._fontDefinition.fontSize,element._fontDefinition.fillStyle):this._handleTextRenderer(element._text,element._fontName,element._fontSize,element._color);break;case ccui.RichElement.IMAGE:this._handleImageRenderer(element._filePath,element._color,element._color.a);break;case ccui.RichElement.CUSTOM:this._handleCustomRenderer(element._customNode)}this.formatRenderers(),this._formatTextDirty=!1}},_handleTextRenderer:function(text,fontNameOrFontDef,fontSize,color){if(""!==text)if("\n"!==text){var textRenderer=fontNameOrFontDef instanceof cc.FontDefinition?new cc.LabelTTF(text,fontNameOrFontDef):new cc.LabelTTF(text,fontNameOrFontDef,fontSize),textRendererWidth=textRenderer.getContentSize().width;if(this._leftSpaceWidth-=textRendererWidth,this._leftSpaceWidth<0){var overstepPercent=-this._leftSpaceWidth/textRendererWidth,curText=text,leftLength=curText.length*(1-overstepPercent),leftWords=curText.substr(0,leftLength),cutWords=curText.substr(leftLength,curText.length-1),validLeftLength=leftLength>0;if(this._lineBreakOnSpace){var lastSpaceIndex=leftWords.lastIndexOf(" ");leftLength=-1===lastSpaceIndex?leftLength:lastSpaceIndex+1,cutWords=curText.substr(leftLength,curText.length-1),validLeftLength=leftLength>0&&" "!==cutWords}if(validLeftLength){var leftRenderer=null;fontNameOrFontDef instanceof cc.FontDefinition?(leftRenderer=new cc.LabelTTF(leftWords.substr(0,leftLength),fontNameOrFontDef)).setOpacity(fontNameOrFontDef.fillStyle.a):((leftRenderer=new cc.LabelTTF(leftWords.substr(0,leftLength),fontNameOrFontDef,fontSize)).setColor(color),leftRenderer.setOpacity(color.a)),this._pushToContainer(leftRenderer)}this._addNewLine(),this._handleTextRenderer(cutWords,fontNameOrFontDef,fontSize,color)}else fontNameOrFontDef instanceof cc.FontDefinition?textRenderer.setOpacity(fontNameOrFontDef.fillStyle.a):(textRenderer.setColor(color),textRenderer.setOpacity(color.a)),this._pushToContainer(textRenderer)}else this._addNewLine()},_handleImageRenderer:function(filePath,color,opacity){var imageRenderer=new cc.Sprite(filePath);this._handleCustomRenderer(imageRenderer)},_handleCustomRenderer:function(renderer){var imgSize=renderer.getContentSize();this._leftSpaceWidth-=imgSize.width,this._leftSpaceWidth<0?(this._addNewLine(),this._pushToContainer(renderer),this._leftSpaceWidth-=imgSize.width):this._pushToContainer(renderer)},_addNewLine:function(){this._leftSpaceWidth=this._customSize.width,this._elementRenders.push([])},formatRenderers:function(){var i,j,row,nextPosX,l,lineHeight,offsetX,newContentSizeHeight=0,locRenderersContainer=this._elementRenderersContainer,locElementRenders=this._elementRenders;if(this._ignoreSize){var newContentSizeWidth=0;for(row=locElementRenders[0],nextPosX=0,j=0;j<row.length;j++){(l=row[j]).setAnchorPoint(cc.p(0,0)),l.setPosition(nextPosX,0),locRenderersContainer.addChild(l,1,j),lineHeight=l.getLineHeight?l.getLineHeight():newContentSizeHeight;var iSize=l.getContentSize();newContentSizeWidth+=iSize.width,newContentSizeHeight=Math.max(Math.min(newContentSizeHeight,lineHeight),iSize.height),nextPosX+=iSize.width}if(this._textHorizontalAlignment!==cc.TEXT_ALIGNMENT_LEFT)for(offsetX=0,this._textHorizontalAlignment===cc.TEXT_ALIGNMENT_RIGHT?offsetX=this._contentSize.width-nextPosX:this._textHorizontalAlignment===cc.TEXT_ALIGNMENT_CENTER&&(offsetX=(this._contentSize.width-nextPosX)/2),j=0;j<row.length;j++)row[j].x+=offsetX;locRenderersContainer.setContentSize(newContentSizeWidth,newContentSizeHeight)}else{var maxHeights=[];for(i=0;i<locElementRenders.length;i++){row=locElementRenders[i];var maxHeight=0;for(j=0;j<row.length;j++)lineHeight=(l=row[j]).getLineHeight?l.getLineHeight():l.getContentSize().height,maxHeight=Math.max(Math.min(l.getContentSize().height,lineHeight),maxHeight);maxHeights[i]=maxHeight,newContentSizeHeight+=maxHeights[i]}var nextPosY=this._customSize.height;for(i=0;i<locElementRenders.length;i++){for(row=locElementRenders[i],nextPosX=0,nextPosY-=maxHeights[i]+this._verticalSpace,j=0;j<row.length;j++)(l=row[j]).setAnchorPoint(cc.p(0,0)),l.setPosition(cc.p(nextPosX,nextPosY)),locRenderersContainer.addChild(l,1),nextPosX+=l.getContentSize().width;if(this._textHorizontalAlignment!==cc.TEXT_ALIGNMENT_LEFT||this._textVerticalAlignment!==cc.VERTICAL_TEXT_ALIGNMENT_TOP){offsetX=0,this._textHorizontalAlignment===cc.TEXT_ALIGNMENT_RIGHT?offsetX=this._contentSize.width-nextPosX:this._textHorizontalAlignment===cc.TEXT_ALIGNMENT_CENTER&&(offsetX=(this._contentSize.width-nextPosX)/2);var offsetY=0;for(this._textVerticalAlignment===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?offsetY=this._customSize.height-newContentSizeHeight:this._textVerticalAlignment===cc.VERTICAL_TEXT_ALIGNMENT_CENTER&&(offsetY=(this._customSize.height-newContentSizeHeight)/2),j=0;j<row.length;j++)(l=row[j]).x+=offsetX,l.y-=offsetY}}locRenderersContainer.setContentSize(this._contentSize)}var length=locElementRenders.length;for(i=0;i<length;i++)locElementRenders[i].length=0;this._elementRenders.length=0,this.setContentSize(this._ignoreSize?this.getVirtualRendererSize():this._customSize),this._updateContentSizeWithTextureSize(this._contentSize),locRenderersContainer.setPosition(.5*this._contentSize.width,.5*this._contentSize.height)},_pushToContainer:function(renderer){this._elementRenders.length<=0||this._elementRenders[this._elementRenders.length-1].push(renderer)},_adaptRenderers:function(){this.formatText()},setVerticalSpace:function(space){this._verticalSpace=space},setAnchorPoint:function(pt){ccui.Widget.prototype.setAnchorPoint.call(this,pt),this._elementRenderersContainer.setAnchorPoint(pt)},_setAnchorX:function(x){ccui.Widget.prototype._setAnchorX.call(this,x),this._elementRenderersContainer._setAnchorX(x)},_setAnchorY:function(y){ccui.Widget.prototype._setAnchorY.call(this,y),this._elementRenderersContainer._setAnchorY(y)},getVirtualRendererSize:function(){return this._elementRenderersContainer.getContentSize()},ignoreContentAdaptWithSize:function(ignore){this._ignoreSize!==ignore&&(this._formatTextDirty=!0,ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,ignore))},getContentSize:function(){return this.formatText(),cc.Node.prototype.getContentSize.call(this)},_getWidth:function(){return this.formatText(),cc.Node.prototype._getWidth.call(this)},_getHeight:function(){return this.formatText(),cc.Node.prototype._getHeight.call(this)},setContentSize:function(contentSize,height){var locWidth=void 0===height?contentSize.width:contentSize,locHeight=void 0===height?contentSize.height:height;ccui.Widget.prototype.setContentSize.call(this,locWidth,locHeight),this._formatTextDirty=!0},getDescription:function(){return"RichText"},setCascadeOpacityEnabled:function(value){ccui.Widget.prototype.setCascadeOpacityEnabled.call(this,value),this._elementRenderersContainer.setCascadeOpacityEnabled(value)},setLineBreakOnSpace:function(value){this._lineBreakOnSpace=value,this._formatTextDirty=!0,this.formatText()},setTextHorizontalAlignment:function(value){value!==this._textHorizontalAlignment&&(this._textHorizontalAlignment=value,this.formatText())},setTextVerticalAlignment:function(value){value!==this._textVerticalAlignment&&(this._textVerticalAlignment=value,this.formatText())}}),ccui.RichText.create=function(){return new ccui.RichText},ccui.RichElement.TEXT=0,ccui.RichElement.IMAGE=1,ccui.RichElement.CUSTOM=2,ccui.WebView=ccui.Widget.extend({ctor:function(path){ccui.Widget.prototype.ctor.call(this),this._EventList={},path&&this.loadURL(path)},visit:function(){var cmd=this._renderCmd,div=cmd._div,container=cc.container,eventManager=cc.eventManager;if(this._visible){hasChild=!1;"contains"in container&&(hasChild=container.contains(div)),hasChild||container.appendChild(div),null===this._listener&&(this._listener=eventManager.addCustomListener(cc.game.EVENT_RESIZE,function(){cmd.resize()}))}else{var hasChild=!1;(hasChild="contains"in container?container.contains(div):container.compareDocumentPosition(div)%16)&&container.removeChild(div);var list=eventManager._listenersMap[cc.game.EVENT_RESIZE].getFixedPriorityListeners();eventManager._removeListenerInVector(list,cmd._listener),cmd._listener=null}cmd.updateStatus(),cmd.resize(cc.view)},setJavascriptInterfaceScheme:function(scheme){},loadData:function(data,MIMEType,encoding,baseURL){},loadHTMLString:function(string,baseURL){},loadURL:function(url){this._renderCmd.updateURL(url),this._dispatchEvent(ccui.WebView.EventType.LOADING)},stopLoading:function(){cc.log("Web does not support loading")},reload:function(){var iframe=this._renderCmd._iframe;if(iframe){var win=iframe.contentWindow;win&&win.location&&win.location.reload()}},canGoBack:function(){return cc.log("Web does not support query history"),!0},canGoForward:function(){return cc.log("Web does not support query history"),!0},goBack:function(){try{if(ccui.WebView._polyfill.closeHistory)return cc.log("The current browser does not support the GoBack");var iframe=this._renderCmd._iframe;if(iframe){var win=iframe.contentWindow;if(win&&win.location)try{win.history.back.call(win)}catch(error){win.history.back()}}}catch(err){cc.log(err)}},goForward:function(){try{if(ccui.WebView._polyfill.closeHistory)return cc.log("The current browser does not support the GoForward");var iframe=this._renderCmd._iframe;if(iframe){var win=iframe.contentWindow;if(win&&win.location)try{win.history.forward.call(win)}catch(error){win.history.forward()}}}catch(err){cc.log(err)}},evaluateJS:function(str){var iframe=this._renderCmd._iframe;if(iframe){var win=iframe.contentWindow;try{win.eval(str),this._dispatchEvent(ccui.WebView.EventType.JS_EVALUATED)}catch(err){console.error(err)}}},setScalesPageToFit:function(){cc.log("Web does not support zoom")},setEventListener:function(event,callback){this._EventList[event]=callback},removeEventListener:function(event){this._EventList[event]=null},_dispatchEvent:function(event){var callback=this._EventList[event];callback&&callback.call(this,this,this._renderCmd._iframe.src)},_createRenderCmd:function(){return new ccui.WebView.RenderCmd(this)},setContentSize:function(w,h){ccui.Widget.prototype.setContentSize.call(this,w,h),void 0===h&&(h=w.height,w=w.width),this._renderCmd.changeSize(w,h)},cleanup:function(){this._renderCmd.removeDom(),this.stopAllActions(),this.unscheduleAllCallbacks()}}),ccui.WebView.EventType={LOADING:"loading",LOADED:"load",ERROR:"error",JS_EVALUATED:"js"},function(){var polyfill=ccui.WebView._polyfill={devicePixelRatio:!1,enableDiv:!1};cc.sys.os===cc.sys.OS_IOS&&(polyfill.enableDiv=!0),cc.sys.isMobile?cc.sys.browserType===cc.sys.BROWSER_TYPE_FIREFOX&&(polyfill.enableBG=!0):cc.sys.browserType===cc.sys.BROWSER_TYPE_IE&&(polyfill.closeHistory=!0)}(),function(polyfill){var RenderCmd=null;RenderCmd=cc._renderType===cc.game.RENDER_TYPE_WEBGL?cc.Node.WebGLRenderCmd:cc.Node.CanvasRenderCmd,ccui.WebView.RenderCmd=function(node){this._rootCtor(node),this._div=null,this._iframe=null,polyfill.enableDiv?(this._div=document.createElement("div"),this._div.style["-webkit-overflow"]="auto",this._div.style["-webkit-overflow-scrolling"]="touch",this._iframe=document.createElement("iframe"),this._iframe.style.width="100%",this._iframe.style.height="100%",this._div.appendChild(this._iframe)):this._div=this._iframe=document.createElement("iframe"),polyfill.enableBG&&(this._div.style.background="#FFF"),this._iframe.addEventListener("load",function(){node._dispatchEvent(ccui.WebView.EventType.LOADED)}),this._iframe.addEventListener("error",function(){node._dispatchEvent(ccui.WebView.EventType.ERROR)}),this._div.style.background="#FFF",this._div.style.height="200px",this._div.style.width="300px",this._div.style.overflow="scroll",this._div.style.border="none",this._listener=null,this.initStyle()};var proto=ccui.WebView.RenderCmd.prototype=Object.create(RenderCmd.prototype);proto.constructor=ccui.WebView.RenderCmd,proto.transform=function(parentCmd,recursive){this.originTransform(parentCmd,recursive),this.updateMatrix(this._worldTransform,cc.view._scaleX,cc.view._scaleY)},proto.updateStatus=function(){polyfill.devicePixelRatio=cc.view.isRetinaEnabled();var flags=cc.Node._dirtyFlags,locFlag=this._dirtyFlag;locFlag&flags.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this.updateMatrix(this._worldTransform,cc.view._scaleX,cc.view._scaleY),this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty^this._dirtyFlag),locFlag&flags.orderDirty&&(this._dirtyFlag=this._dirtyFlag&flags.orderDirty^this._dirtyFlag)},proto.resize=function(view){view=view||cc.view;var node=this._node,eventManager=cc.eventManager;if(node._parent&&node._visible)this.updateMatrix(this._worldTransform,view._scaleX,view._scaleY);else{var list=eventManager._listenersMap[cc.game.EVENT_RESIZE].getFixedPriorityListeners();eventManager._removeListenerInVector(list,this._listener),this._listener=null}},proto.updateMatrix=function(t,scaleX,scaleY){var node=this._node;if(polyfill.devicePixelRatio){var dpr=cc.view.getDevicePixelRatio();scaleX/=dpr,scaleY/=dpr}if(!1!==this._loaded){var containerStyle=cc.game.container.style,offsetX=parseInt(containerStyle.paddingLeft),offsetY=parseInt(containerStyle.paddingBottom),cw=node._contentSize.width,ch=node._contentSize.height,matrix="matrix("+t.a*scaleX+","+t.b+","+t.c+","+t.d*scaleY+","+(offsetX+t.tx*scaleX-cw/2+cw*node._scaleX/2*scaleX)+","+-(offsetY+t.ty*scaleY-ch/2+ch*node._scaleY/2*scaleY)+")";this._div.style.transform=matrix,this._div.style["-webkit-transform"]=matrix}},proto.initStyle=function(){if(this._div){var div=this._div;div.style.position="absolute",div.style.bottom="0px",div.style.left="0px"}},proto.updateURL=function(url){var iframe=this._iframe;iframe.src=url;var self=this,cb=function(){self._loaded=!0,iframe.removeEventListener("load",cb)};iframe.addEventListener("load",cb)},proto.changeSize=function(w,h){var div=this._div;div&&(div.style.width=w+"px",div.style.height=h+"px")},proto.removeDom=function(){var div=this._div;if(div){("contains"in cc.container?cc.container.contains(div):cc.container.compareDocumentPosition(div)%16)&&cc.container.removeChild(div)}}}(ccui.WebView._polyfill),ccui.ScrollViewBar=ccui.ProtectedNode.extend({_parentScroll:null,_direction:null,_upperHalfCircle:null,_lowerHalfCircle:null,_body:null,_opacity:255,_marginFromBoundary:0,_marginForLength:0,_touching:!1,_autoHideEnabled:!0,autoHideTime:0,_autoHideRemainingTime:0,_className:"ScrollViewBar",ctor:function(parent,direction){cc.ProtectedNode.prototype.ctor.call(this),this._direction=direction,this._parentScroll=parent,this._marginFromBoundary=ccui.ScrollViewBar.DEFAULT_MARGIN,this._marginForLength=ccui.ScrollViewBar.DEFAULT_MARGIN,this.opacity=255*ccui.ScrollViewBar.DEFAULT_SCROLLBAR_OPACITY,this.autoHideTime=ccui.ScrollViewBar.DEFAULT_AUTO_HIDE_TIME,this._autoHideEnabled=!0,ccui.ScrollViewBar.prototype.init.call(this),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0)},init:function(){this._upperHalfCircle=new cc.LayerColor(DEFAULT_BAR_COLOR),this._upperHalfCircle.setContentSize(1,1),this._upperHalfCircle.setAnchorPoint(cc.p(.5,0)),this._lowerHalfCircle=new cc.LayerColor(DEFAULT_BAR_COLOR),this._lowerHalfCircle.setAnchorPoint(cc.p(.5,0)),this._lowerHalfCircle.setContentSize(1,1),this._lowerHalfCircle.setScaleY(-1),this.addProtectedChild(this._upperHalfCircle),this.addProtectedChild(this._lowerHalfCircle),this._body=new cc.LayerColor(DEFAULT_BAR_COLOR),this._body.setContentSize(1,1),this._body._rect=cc.rect(),this._body._rect.width=1,this._body._rect.height=1,this._body.setAnchorPoint(cc.p(.5,0)),this.addProtectedChild(this._body),this.setColor(ccui.ScrollViewBar.DEFAULT_COLOR),this.onScrolled(cc.p(0,0)),cc.ProtectedNode.prototype.setOpacity.call(this,0),this._autoHideRemainingTime=0,this._direction===ccui.ScrollView.DIR_HORIZONTAL&&this.setRotation(90)},setPositionFromCorner:function(positionFromCorner){this._direction===ccui.ScrollView.DIR_VERTICAL?(this._marginForLength=positionFromCorner.y,this._marginFromBoundary=positionFromCorner.x):(this._marginForLength=positionFromCorner.x,this._marginFromBoundary=positionFromCorner.y)},onEnter:function(){cc.ProtectedNode.prototype.onEnter.call(this),this.scheduleUpdate()},getPositionFromCorner:function(){return this._direction===ccui.ScrollView.DIR_VERTICAL?cc.p(this._marginFromBoundary,this._marginForLength):cc.p(this._marginForLength,this._marginFromBoundary)},setWidth:function(width){var scale=width/this._body.width;this._body.setScaleX(scale),this._upperHalfCircle.setScale(scale),this._lowerHalfCircle.setScale(-scale)},getWidth:function(){return this._body.getBoundingBox().width},setAutoHideEnabled:function(autoHideEnabled){this._autoHideEnabled=autoHideEnabled,!this._autoHideEnabled&&!this._touching&&this._autoHideRemainingTime<=0?cc.ProtectedNode.prototype.setOpacity.call(this,this.opacity):cc.ProtectedNode.prototype.setOpacity.call(this,0)},isAutoHideEnabled:function(){return this._autoHideEnabled},setOpacity:function(opacity){this._opacity=opacity},getOpacity:function(){return this._opacity},_updateLength:function(length){var ratio=length/this._body.height;this._body.setScaleY(ratio),this._upperHalfCircle.setPositionY(this._body.getPositionY()+length)},_processAutoHide:function(dt){!this._autoHideEnabled||this._autoHideRemainingTime<=0||this._touching||(this._autoHideRemainingTime-=dt,this._autoHideRemainingTime<=this.autoHideTime&&(this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime),cc.ProtectedNode.prototype.setOpacity.call(this,this._opacity*(this._autoHideRemainingTime/this.autoHideTime))))},update:function(dt){this._processAutoHide(dt)},onTouchBegan:function(){this._autoHideEnabled&&(this._touching=!0)},onTouchEnded:function(){this._autoHideEnabled&&(this._touching=!1,this._autoHideRemainingTime<=0||(this._autoHideRemainingTime=this.autoHideTime))},onScrolled:function(outOfBoundary){this._autoHideEnabled&&(this._autoHideRemainingTime=this.autoHideTime,cc.ProtectedNode.prototype.setOpacity.call(this,this.opacity));var innerContainer=this._parentScroll.getInnerContainer(),innerContainerMeasure=0,scrollViewMeasure=0,outOfBoundaryValue=0,innerContainerPosition=0;this._direction===ccui.ScrollView.DIR_VERTICAL?(innerContainerMeasure=innerContainer.height,scrollViewMeasure=this._parentScroll.height,outOfBoundaryValue=outOfBoundary.y,innerContainerPosition=-innerContainer.getPositionY()):this._direction===ccui.ScrollView.DIR_HORIZONTAL&&(innerContainerMeasure=innerContainer.width,scrollViewMeasure=this._parentScroll.width,outOfBoundaryValue=outOfBoundary.x,innerContainerPosition=-innerContainer.getPositionX());var length=this._calculateLength(innerContainerMeasure,scrollViewMeasure,outOfBoundaryValue),position=this._calculatePosition(innerContainerMeasure,scrollViewMeasure,innerContainerPosition,outOfBoundaryValue,length);this._updateLength(length),this.setPosition(position)},_calculateLength:function(innerContainerMeasure,scrollViewMeasure,outOfBoundaryValue){var denominatorValue=innerContainerMeasure;if(0!==outOfBoundaryValue){denominatorValue+=20*(outOfBoundaryValue>0?outOfBoundaryValue:-outOfBoundaryValue)}var lengthRatio=scrollViewMeasure/denominatorValue;return Math.abs(scrollViewMeasure-2*this._marginForLength)*lengthRatio},_calculatePosition:function(innerContainerMeasure,scrollViewMeasure,innerContainerPosition,outOfBoundaryValue,length){var denominatorValue=innerContainerMeasure-scrollViewMeasure;0!==outOfBoundaryValue&&(denominatorValue+=Math.abs(outOfBoundaryValue));var positionRatio=0;0!==denominatorValue&&(positionRatio=innerContainerPosition/denominatorValue,positionRatio=Math.max(positionRatio,0),positionRatio=Math.min(positionRatio,1));var position=(scrollViewMeasure-length-2*this._marginForLength)*positionRatio+this._marginForLength;return this._direction===ccui.ScrollView.DIR_VERTICAL?cc.p(this._parentScroll.width-this._marginFromBoundary,position):cc.p(position,this._marginFromBoundary)}}),(_p=ccui.ScrollViewBar.prototype).opacity,cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity),_p.autoHideEnabled,cc.defineGetterSetter(_p,"autoHideEnabled",_p.isAutoHideEnabled,_p.setAutoHideEnabled),ccui.ScrollViewBar.DEFAULT_COLOR=cc.color(52,65,87),ccui.ScrollViewBar.DEFAULT_MARGIN=20,ccui.ScrollViewBar.DEFAULT_AUTO_HIDE_TIME=.2,ccui.ScrollViewBar.DEFAULT_SCROLLBAR_OPACITY=.4,ccui.ScrollViewBar.HALF_CIRCLE_IMAGE_KEY="/__half_circle_image",ccui.ScrollViewBar.HALF_CIRCLE_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAGCAMAAADAMI+zAAAAJ1BMVEX///////////////////////////////////////////////////9Ruv0SAAAADHRSTlMABgcbbW7Hz9Dz+PmlcJP5AAAAMElEQVR4AUXHwQ2AQAhFwYcLH1H6r1djzDK3ASxUpTBeK/uTCyz7dx54b44m4p5cD1MwAooEJyk3AAAAAElFTkSuQmCC",ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT_KEY="/__body_image_height",ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAABCAMAAADdNb8LAAAAA1BMVEX///+nxBvIAAAACklEQVR4AWNABgAADQABYc2cpAAAAABJRU5ErkJggg==",ccui.ScrollView=ccui.Layout.extend({_innerContainer:null,_direction:null,_topBoundary:0,_bottomBoundary:0,_leftBoundary:0,_rightBoundary:0,_touchMoveDisplacements:null,_touchMoveTimeDeltas:null,_touchMovePreviousTimestamp:0,_touchTotalTimeThreshold:.5,_autoScrolling:!1,_autoScrollTargetDelta:null,_autoScrollAttenuate:!0,_autoScrollStartPosition:null,_autoScrollTotalTime:0,_autoScrollAccumulatedTime:0,_autoScrollCurrentlyOutOfBoundary:!1,_autoScrollBraking:!1,_autoScrollBrakingStartPosition:null,_bePressed:!1,_childFocusCancelOffset:0,bounceEnabled:!1,_outOfBoundaryAmount:null,_outOfBoundaryAmountDirty:!0,inertiaScrollEnabled:!1,_scrollBarEnabled:!0,_verticalScrollBar:null,_horizontalScrollBar:null,_scrollViewEventListener:null,_scrollViewEventSelector:null,_className:"ScrollView",ctor:function(){ccui.Layout.prototype.ctor.call(this),this.setClippingEnabled(!0),this._innerContainer.setTouchEnabled(!1),this._direction=ccui.ScrollView.DIR_NONE,this._childFocusCancelOffset=5,this.inertiaScrollEnabled=!0,this._outOfBoundaryAmount=cc.p(0,0),this._autoScrollTargetDelta=cc.p(0,0),this._autoScrollStartPosition=cc.p(0,0),this._autoScrollBrakingStartPosition=cc.p(0,0),this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[],this._touchMovePreviousTimestamp=0,this._scrollBarEnabled=!0,this._initScrollBar(),this.setTouchEnabled(!0)},onEnter:function(){ccui.Layout.prototype.onEnter.call(this),this.scheduleUpdate()},onExit:function(){cc.renderer._removeCache(this.__instanceId),ccui.Layout.prototype.onExit.call(this)},visit:function(parent){if(this._visible){this._adaptRenderers(),this._doLayout();var renderer=cc.renderer,cmd=this._renderCmd,parentCmd=parent&&parent._renderCmd;if(cmd.visit(parentCmd),renderer.pushRenderCommand(cmd),cmd instanceof ccui.ScrollView.WebGLRenderCmd){var currentID=this.__instanceId;renderer._turnToCacheMode(currentID)}var stencilClipping=this._clippingEnabled&&this._clippingType===ccui.Layout.CLIPPING_STENCIL,scissorClipping=this._clippingEnabled&&this._clippingType===ccui.Layout.CLIPPING_SCISSOR;stencilClipping?cmd.stencilClippingVisit(parentCmd):scissorClipping&&cmd.scissorClippingVisit(parentCmd);var i,child,j,pChild,children=this._children,len=children.length,pChildren=this._protectedChildren,pLen=pChildren.length;for(this._reorderChildDirty&&this.sortAllChildren(),this._reorderProtectedChildDirty&&this.sortAllProtectedChildren(),i=0;i<len;i++)(child=children[i])&&child._visible&&child.visit(this);for(j=0;j<pLen;j++)(pChild=pChildren[j])&&pChild._visible&&(cmd._changeProtectedChild(pChild),pChild.visit(this));stencilClipping?cmd.postStencilVisit():scissorClipping&&cmd.postScissorVisit(),cmd instanceof ccui.ScrollView.WebGLRenderCmd&&renderer._turnToNormalMode(),this.updateChildren(),cmd._dirtyFlag=0}},findNextFocusedWidget:function(direction,current){return this.getLayoutType()===ccui.Layout.LINEAR_VERTICAL||this.getLayoutType()===ccui.Layout.LINEAR_HORIZONTAL?this._innerContainer.findNextFocusedWidget(direction,current):ccui.Widget.prototype.findNextFocusedWidget.call(this,direction,current)},_initRenderer:function(){ccui.Layout.prototype._initRenderer.call(this),this._innerContainer=new ccui.Layout,this._innerContainer.setColor(cc.color(255,255,255)),this._innerContainer.setOpacity(255),this._innerContainer.setCascadeColorEnabled(!0),this._innerContainer.setCascadeOpacityEnabled(!0),this.addProtectedChild(this._innerContainer,1,1)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new ccui.ScrollView.WebGLRenderCmd(this):new ccui.ScrollView.CanvasRenderCmd(this)},_onSizeChanged:function(){ccui.Layout.prototype._onSizeChanged.call(this);var locSize=this._contentSize;this._topBoundary=locSize.height,this._rightBoundary=locSize.width;var innerSize=this._innerContainer.getContentSize();this._innerContainer.setContentSize(cc.size(Math.max(innerSize.width,locSize.width),Math.max(innerSize.height,locSize.height))),this._innerContainer.setPosition(0,locSize.height-this._innerContainer.getContentSize().height),this._verticalScrollBar&&this._verticalScrollBar.onScrolled(this._getHowMuchOutOfBoundary()),this._horizontalScrollBar&&this._horizontalScrollBar.onScrolled(this._getHowMuchOutOfBoundary())},setInnerContainerSize:function(size){var innerContainer=this._innerContainer,locSize=this._contentSize,innerSizeWidth=locSize.width,innerSizeHeight=locSize.height;size.width<locSize.width?cc.log("Inner width <= ScrollView width, it will be force sized!"):innerSizeWidth=size.width,size.height<locSize.height?cc.log("Inner height <= ScrollView height, it will be force sized!"):innerSizeHeight=size.height,innerContainer.setContentSize(cc.size(innerSizeWidth,innerSizeHeight));var pos=this._innerContainer.getPosition(),contAP=this._innerContainer.getAnchorPoint();0!=this._innerContainer.getLeftBoundary()&&(pos.x=contAP.x*innerSizeWidth),this._innerContainer.getTopBoundary()!=this._contentSize.height&&(pos.y=this._contentSize.height-(1-contAP.y)*innerSizeHeight),this.setInnerContainerPosition(pos),this._updateScrollBar(cc.p(0,0))},_setInnerWidth:function(width){var locW=this._contentSize.width,innerWidth=locW,container=this._innerContainer,oldInnerWidth=container.width;switch(width<locW?cc.log("Inner width <= scrollview width, it will be force sized!"):innerWidth=width,container.width=innerWidth,this._direction){case ccui.ScrollView.DIR_HORIZONTAL:case ccui.ScrollView.DIR_BOTH:if(container.getRightBoundary()<=locW){var offset=oldInnerWidth-container.width;this._scrollChildren(offset,0)}}var innerAX=container.anchorX;container.getLeftBoundary()>0&&(container.x=innerAX*innerWidth),container.getRightBoundary()<locW&&(container.x=locW-(1-innerAX)*innerWidth)},_setInnerHeight:function(height){var locH=this._contentSize.height,innerHeight=locH,container=this._innerContainer,oldInnerHeight=container.height;switch(height<locH?cc.log("Inner height <= scrollview height, it will be force sized!"):innerHeight=height,container.height=innerHeight,this._direction){case ccui.ScrollView.DIR_VERTICAL:case ccui.ScrollView.DIR_BOTH:var offset=oldInnerHeight-innerHeight;this._scrollChildren(0,offset)}var innerAY=container.anchorY;container.getLeftBoundary()>0&&(container.y=innerAY*innerHeight),container.getRightBoundary()<locH&&(container.y=locH-(1-innerAY)*innerHeight)},setInnerContainerPosition:function(position){if(position.x!==this._innerContainer.getPositionX()||position.y!==this._innerContainer.getPositionY()){if(this._innerContainer.setPosition(position),this._outOfBoundaryAmountDirty=!0,this.bounceEnabled)for(var _direction=ccui.ScrollView.MOVEDIR_TOP;_direction<ccui.ScrollView.MOVEDIR_RIGHT;++_direction)this._isOutOfBoundary(_direction)&&this._processScrollEvent(_direction,!0);this._dispatchEvent(ccui.ScrollView.EVENT_CONTAINER_MOVED)}},getInnerContainerPosition:function(){return this._innerContainer.getPosition()},getInnerContainerSize:function(){return this._innerContainer.getContentSize()},_getInnerWidth:function(){return this._innerContainer.width},_getInnerHeight:function(){return this._innerContainer.height},_isInContainer:function(widget){if(!this._clippingEnabled)return!0;var wPos=widget._position,wSize=widget._contentSize,wAnchor=widget._anchorPoint,size=this._customSize,pos=this._innerContainer._position,bottom=0,left=0;return!((bottom=wPos.y-wAnchor.y*wSize.height)>=size.height-pos.y||bottom+wSize.height<=-pos.y||(left=wPos.x-wAnchor.x*wSize.width)>=size.width-pos.x||left+wSize.width<=-pos.x)},updateChildren:function(){var child,i,l,childrenArray=this._innerContainer._children;for(i=0,l=childrenArray.length;i<l;i++)!0===(child=childrenArray[i])._inViewRect&&!1===this._isInContainer(child)?child._inViewRect=!1:!1===child._inViewRect&&!0===this._isInContainer(child)&&(child._inViewRect=!0)},addChild:function(widget,zOrder,tag){return!!widget&&(!1===this._isInContainer(widget)&&(widget._inViewRect=!1),zOrder=zOrder||widget.getLocalZOrder(),tag=tag||widget.getTag(),this._innerContainer.addChild(widget,zOrder,tag))},removeAllChildren:function(){this.removeAllChildrenWithCleanup(!0)},removeAllChildrenWithCleanup:function(cleanup){this._innerContainer.removeAllChildrenWithCleanup(cleanup)},removeChild:function(child,cleanup){return this._innerContainer.removeChild(child,cleanup)},getChildren:function(){return this._innerContainer.getChildren()},getChildrenCount:function(){return this._innerContainer.getChildrenCount()},getChildByTag:function(tag){return this._innerContainer.getChildByTag(tag)},getChildByName:function(name){return this._innerContainer.getChildByName(name)},_flattenVectorByDirection:function(vector){var result=cc.p(0,0);return result.x=this._direction===ccui.ScrollView.DIR_VERTICAL?0:vector.x,result.y=this._direction===ccui.ScrollView.DIR_HORIZONTAL?0:vector.y,result},_getHowMuchOutOfBoundary:function(addition){if(void 0===addition&&(addition=cc.p(0,0)),0===addition.x&&0===addition.y&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var outOfBoundaryAmount=cc.p(0,0);return this._innerContainer.getLeftBoundary()+addition.x>this._leftBoundary?outOfBoundaryAmount.x=this._leftBoundary-(this._innerContainer.getLeftBoundary()+addition.x):this._innerContainer.getRightBoundary()+addition.x<this._rightBoundary&&(outOfBoundaryAmount.x=this._rightBoundary-(this._innerContainer.getRightBoundary()+addition.x)),this._innerContainer.getTopBoundary()+addition.y<this._topBoundary?outOfBoundaryAmount.y=this._topBoundary-(this._innerContainer.getTopBoundary()+addition.y):this._innerContainer.getBottomBoundary()+addition.y>this._bottomBoundary&&(outOfBoundaryAmount.y=this._bottomBoundary-(this._innerContainer.getBottomBoundary()+addition.y)),0===addition.x&&0===addition.y&&(this._outOfBoundaryAmount=outOfBoundaryAmount,this._outOfBoundaryAmountDirty=!1),outOfBoundaryAmount},_isOutOfBoundary:function(dir){var outOfBoundary=this._getHowMuchOutOfBoundary();if(void 0===dir)return!this._fltEqualZero(outOfBoundary);switch(dir){case ccui.ScrollView.MOVEDIR_TOP:return outOfBoundary.y>0;case ccui.ScrollView.MOVEDIR_BOTTOM:return outOfBoundary.y<0;case ccui.ScrollView.MOVEDIR_LEFT:return outOfBoundary.x<0;case ccui.ScrollView.MOVEDIR_RIGHT:return outOfBoundary.x>0}return!1},_moveInnerContainer:function(deltaMove,canStartBounceBack){var adjustedMove=this._flattenVectorByDirection(deltaMove);this.setInnerContainerPosition(cc.pAdd(this.getInnerContainerPosition(),adjustedMove));var outOfBoundary=this._getHowMuchOutOfBoundary();this._updateScrollBar(outOfBoundary),this.bounceEnabled&&canStartBounceBack&&this._startBounceBackIfNeeded()},_updateScrollBar:function(outOfBoundary){this._verticalScrollBar&&this._verticalScrollBar.onScrolled(outOfBoundary),this._horizontalScrollBar&&this._horizontalScrollBar.onScrolled(outOfBoundary)},_calculateTouchMoveVelocity:function(){for(var totalTime=0,i=0;i<this._touchMoveTimeDeltas.length;++i)totalTime+=this._touchMoveTimeDeltas[i];if(0==totalTime||totalTime>=this._touchTotalTimeThreshold)return cc.p(0,0);for(var totalMovement=cc.p(0,0),i=0;i<this._touchMoveDisplacements.length;++i)totalMovement.x+=this._touchMoveDisplacements[i].x,totalMovement.y+=this._touchMoveDisplacements[i].y;return cc.pMult(totalMovement,1/totalTime)},setTouchTotalTimeThreshold:function(touchTotalTimeThreshold){this._touchTotalTimeThreshold=touchTotalTimeThreshold},getTouchTotalTimeThreshold:function(){return this._touchTotalTimeThreshold},_startInertiaScroll:function(touchMoveVelocity){var inertiaTotalMovement=cc.pMult(touchMoveVelocity,.7);this._startAttenuatingAutoScroll(inertiaTotalMovement,touchMoveVelocity)},_startBounceBackIfNeeded:function(){if(!this.bounceEnabled)return!1;var bounceBackAmount=this._getHowMuchOutOfBoundary();if(this._fltEqualZero(bounceBackAmount))return!1;return this._startAutoScroll(bounceBackAmount,1,!0),!0},_startAutoScrollToDestination:function(destination,timeInSec,attenuated){this._startAutoScroll(cc.pSub(destination,this._innerContainer.getPosition()),timeInSec,attenuated)},_calculateAutoScrollTimeByInitialSpeed:function(initialSpeed){return Math.sqrt(Math.sqrt(initialSpeed/5))},_startAttenuatingAutoScroll:function(deltaMove,initialVelocity){var time=this._calculateAutoScrollTimeByInitialSpeed(cc.pLength(initialVelocity));this._startAutoScroll(deltaMove,time,!0)},_startAutoScroll:function(deltaMove,timeInSec,attenuated){var adjustedDeltaMove=this._flattenVectorByDirection(deltaMove);this._autoScrolling=!0,this._autoScrollTargetDelta=adjustedDeltaMove,this._autoScrollAttenuate=attenuated,this._autoScrollStartPosition=this._innerContainer.getPosition(),this._autoScrollTotalTime=timeInSec,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._autoScrollBrakingStartPosition=cc.p(0,0);var currentOutOfBoundary=this._getHowMuchOutOfBoundary();if(!this._fltEqualZero(currentOutOfBoundary)){this._autoScrollCurrentlyOutOfBoundary=!0;var afterOutOfBoundary=this._getHowMuchOutOfBoundary(adjustedDeltaMove);(currentOutOfBoundary.x*afterOutOfBoundary.x>0||currentOutOfBoundary.y*afterOutOfBoundary.y>0)&&(this._autoScrollBraking=!0)}},stopAutoScroll:function(){this._autoScrolling=!1,this._autoScrollAttenuate=!0,this._autoScrollTotalTime=0,this._autoScrollAccumulatedTime=0},_isNecessaryAutoScrollBrake:function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.getInnerContainerPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},_getAutoScrollStopEpsilon:function(){return 1e-4},_fltEqualZero:function(point){return Math.abs(point.x)<=1e-4&&Math.abs(point.y)<=1e-4},_processAutoScrolling:function(deltaTime){var brakingFactor=this._isNecessaryAutoScrollBrake()?.05:1;this._autoScrollAccumulatedTime+=deltaTime*(1/brakingFactor);var percentage=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(percentage=(percentage-=1)*percentage*percentage*percentage*percentage+1);var newPosition=cc.pAdd(this._autoScrollStartPosition,cc.pMult(this._autoScrollTargetDelta,percentage)),reachedEnd=Math.abs(percentage-1)<=this._getAutoScrollStopEpsilon();if(this.bounceEnabled)newPosition=cc.pAdd(this._autoScrollBrakingStartPosition,cc.pMult(cc.pSub(newPosition,this._autoScrollBrakingStartPosition),brakingFactor));else{var moveDelta=cc.pSub(newPosition,this.getInnerContainerPosition()),outOfBoundary=this._getHowMuchOutOfBoundary(moveDelta);this._fltEqualZero(outOfBoundary)||(newPosition.x+=outOfBoundary.x,newPosition.y+=outOfBoundary.y,reachedEnd=!0)}reachedEnd&&(this._autoScrolling=!1,this._dispatchEvent(ccui.ScrollView.EVENT_AUTOSCROLL_ENDED)),this._moveInnerContainer(cc.pSub(newPosition,this.getInnerContainerPosition()),reachedEnd)},_jumpToDestination:function(desOrX,y){void 0===desOrX.x&&(desOrX=cc.p(desOrX,y)),this._autoScrolling=!1,this._moveInnerContainer(cc.pSub(desOrX,this.getInnerContainerPosition()),!0)},_scrollChildren:function(deltaMove){var realMove=deltaMove;if(this.bounceEnabled){outOfBoundary=this._getHowMuchOutOfBoundary();realMove.x*=0==outOfBoundary.x?1:.5,realMove.y*=0==outOfBoundary.y?1:.5}if(!this.bounceEnabled){var outOfBoundary=this._getHowMuchOutOfBoundary(realMove);realMove.x+=outOfBoundary.x,realMove.y+=outOfBoundary.y}var scrolledToLeft=!1,scrolledToRight=!1,scrolledToTop=!1,scrolledToBottom=!1;realMove.y>0?this._innerContainer.getBottomBoundary()+realMove.y>=this._bottomBoundary&&(scrolledToBottom=!0):realMove.y<0&&this._innerContainer.getTopBoundary()+realMove.y<=this._topBoundary&&(scrolledToTop=!0),realMove.x<0?this._innerContainer.getRightBoundary()+realMove.x<=this._rightBoundary&&(scrolledToRight=!0):realMove.x>0&&this._innerContainer.getLeftBoundary()+realMove.x>=this._leftBoundary&&(scrolledToLeft=!0),this._moveInnerContainer(realMove,!1),0==realMove.x&&0==realMove.y||this._processScrollingEvent(),scrolledToBottom&&this._processScrollEvent(ccui.ScrollView.MOVEDIR_BOTTOM,!1),scrolledToTop&&this._processScrollEvent(ccui.ScrollView.MOVEDIR_TOP,!1),scrolledToLeft&&this._processScrollEvent(ccui.ScrollView.MOVEDIR_LEFT,!1),scrolledToRight&&this._processScrollEvent(ccui.ScrollView.MOVEDIR_RIGHT,!1)},scrollToBottom:function(time,attenuated){this._startAutoScrollToDestination(cc.p(this._innerContainer.getPositionX(),0),time,attenuated)},scrollToTop:function(time,attenuated){this._startAutoScrollToDestination(cc.p(this._innerContainer.getPositionX(),this._contentSize.height-this._innerContainer.getContentSize().height),time,attenuated)},scrollToLeft:function(time,attenuated){this._startAutoScrollToDestination(cc.p(0,this._innerContainer.getPositionY()),time,attenuated)},scrollToRight:function(time,attenuated){this._startAutoScrollToDestination(cc.p(this._contentSize.width-this._innerContainer.getContentSize().width,this._innerContainer.getPositionY()),time,attenuated)},scrollToTopLeft:function(time,attenuated){this._direction===ccui.ScrollView.DIR_BOTH?this._startAutoScrollToDestination(cc.p(0,this._contentSize.height-this._innerContainer.getContentSize().height),time,attenuated):cc.log("Scroll direction is not both!")},scrollToTopRight:function(time,attenuated){if(this._direction===ccui.ScrollView.DIR_BOTH){var inSize=this._innerContainer.getContentSize();this._startAutoScrollToDestination(cc.p(this._contentSize.width-inSize.width,this._contentSize.height-inSize.height),time,attenuated)}else cc.log("Scroll direction is not both!")},scrollToBottomLeft:function(time,attenuated){this._direction===ccui.ScrollView.DIR_BOTH?this._startAutoScrollToDestination(cc.p(0,0),time,attenuated):cc.log("Scroll direction is not both!")},scrollToBottomRight:function(time,attenuated){this._direction===ccui.ScrollView.DIR_BOTH?this._startAutoScrollToDestination(cc.p(this._contentSize.width-this._innerContainer.getContentSize().width,0),time,attenuated):cc.log("Scroll direction is not both!")},scrollToPercentVertical:function(percent,time,attenuated){var minY=this._contentSize.height-this._innerContainer.getContentSize().height,h=-minY;this._startAutoScrollToDestination(cc.p(this._innerContainer.getPositionX(),minY+percent*h/100),time,attenuated)},scrollToPercentHorizontal:function(percent,time,attenuated){var w=this._innerContainer.getContentSize().width-this._contentSize.width;this._startAutoScrollToDestination(cc.p(-percent*w/100,this._innerContainer.getPositionY()),time,attenuated)},scrollToPercentBothDirection:function(percent,time,attenuated){if(this._direction===ccui.ScrollView.DIR_BOTH){var minY=this._contentSize.height-this._innerContainer.getContentSize().height,h=-minY,w=this._innerContainer.getContentSize().width-this._contentSize.width;this._startAutoScrollToDestination(cc.p(-percent.x*w/100,minY+percent.y*h/100),time,attenuated)}},jumpToBottom:function(){this._jumpToDestination(this._innerContainer.getPositionX(),0)},jumpToTop:function(){this._jumpToDestination(this._innerContainer.getPositionX(),this._contentSize.height-this._innerContainer.getContentSize().height)},jumpToLeft:function(){this._jumpToDestination(0,this._innerContainer.getPositionY())},jumpToRight:function(){this._jumpToDestination(this._contentSize.width-this._innerContainer.getContentSize().width,this._innerContainer.getPositionY())},jumpToTopLeft:function(){this._direction===ccui.ScrollView.DIR_BOTH?this._jumpToDestination(0,this._contentSize.height-this._innerContainer.getContentSize().height):cc.log("Scroll _direction is not both!")},jumpToTopRight:function(){if(this._direction===ccui.ScrollView.DIR_BOTH){var inSize=this._innerContainer.getContentSize();this._jumpToDestination(this._contentSize.width-inSize.width,this._contentSize.height-inSize.height)}else cc.log("Scroll _direction is not both!")},jumpToBottomLeft:function(){this._direction===ccui.ScrollView.DIR_BOTH?this._jumpToDestination(0,0):cc.log("Scroll _direction is not both!")},jumpToBottomRight:function(){this._direction===ccui.ScrollView.DIR_BOTH?this._jumpToDestination(this._contentSize.width-this._innerContainer.getContentSize().width,0):cc.log("Scroll _direction is not both!")},jumpToPercentVertical:function(percent){var minY=this._contentSize.height-this._innerContainer.getContentSize().height,h=-minY;this._jumpToDestination(this._innerContainer.getPositionX(),minY+percent*h/100)},jumpToPercentHorizontal:function(percent){var w=this._innerContainer.getContentSize().width-this._contentSize.width;this._jumpToDestination(-percent*w/100,this._innerContainer.getPositionY())},jumpToPercentBothDirection:function(percent){if(this._direction===ccui.ScrollView.DIR_BOTH){var inSize=this._innerContainer.getContentSize(),minY=this._contentSize.height-inSize.height,h=-minY,w=inSize.width-this._contentSize.width;this._jumpToDestination(-percent.x*w/100,minY+percent.y*h/100)}},_gatherTouchMove:function(delta){for(;this._touchMoveDisplacements.length>=5;)this._touchMoveDisplacements.splice(0,1),this._touchMoveTimeDeltas.splice(0,1);this._touchMoveDisplacements.push(delta);var timestamp=(new Date).getTime();this._touchMoveTimeDeltas.push((timestamp-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=timestamp},_handlePressLogic:function(touch){this._bePressed=!0,this._autoScrolling=!1,this._touchMovePreviousTimestamp=(new Date).getTime(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._verticalScrollBar&&this._verticalScrollBar.onTouchBegan(),this._horizontalScrollBar&&this._horizontalScrollBar.onTouchBegan()},_handleMoveLogic:function(touch){var touchPositionInNodeSpace=this.convertToNodeSpace(touch.getLocation()),previousTouchPositionInNodeSpace=this.convertToNodeSpace(touch.getPreviousLocation()),delta=cc.pSub(touchPositionInNodeSpace,previousTouchPositionInNodeSpace);this._scrollChildren(delta),this._gatherTouchMove(delta)},_handleReleaseLogic:function(touch){var touchPositionInNodeSpace=this.convertToNodeSpace(touch.getLocation()),previousTouchPositionInNodeSpace=this.convertToNodeSpace(touch.getPreviousLocation()),delta=cc.pSub(touchPositionInNodeSpace,previousTouchPositionInNodeSpace);if(this._gatherTouchMove(delta),this._bePressed=!1,!this._startBounceBackIfNeeded()&&this.inertiaScrollEnabled){var touchMoveVelocity=this._calculateTouchMoveVelocity();0===touchMoveVelocity.x&&0===touchMoveVelocity.y||this._startInertiaScroll(touchMoveVelocity)}this._verticalScrollBar&&this._verticalScrollBar.onTouchEnded(),this._horizontalScrollBar&&this._horizontalScrollBar.onTouchEnded()},onTouchBegan:function(touch,event){var pass=ccui.Layout.prototype.onTouchBegan.call(this,touch,event);return this._isInterceptTouch||this._hit&&this._handlePressLogic(touch),pass},onTouchMoved:function(touch,event){ccui.Layout.prototype.onTouchMoved.call(this,touch,event),this._isInterceptTouch||this._handleMoveLogic(touch)},onTouchEnded:function(touch,event){ccui.Layout.prototype.onTouchEnded.call(this,touch,event),this._isInterceptTouch||this._handleReleaseLogic(touch),this._isInterceptTouch=!1},onTouchCancelled:function(touch,event){ccui.Layout.prototype.onTouchCancelled.call(this,touch,event),this._isInterceptTouch||this._handleReleaseLogic(touch),this._isInterceptTouch=!1},update:function(dt){this._autoScrolling&&this._processAutoScrolling(dt)},interceptTouchEvent:function(event,sender,touch){if(this._touchEnabled){if(this._direction!==ccui.ScrollView.DIR_NONE){var touchPoint=touch.getLocation();switch(event){case ccui.Widget.TOUCH_BEGAN:this._isInterceptTouch=!0,this._touchBeganPosition.x=touchPoint.x,this._touchBeganPosition.y=touchPoint.y,this._handlePressLogic(touch);break;case ccui.Widget.TOUCH_MOVED:var offset=cc.pLength(cc.pSub(sender.getTouchBeganPosition(),touchPoint));this._touchMovePosition.x=touchPoint.x,this._touchMovePosition.y=touchPoint.y,offset>this._childFocusCancelOffset&&(sender.setHighlighted(!1),this._handleMoveLogic(touch));break;case ccui.Widget.TOUCH_CANCELED:case ccui.Widget.TOUCH_ENDED:this._touchEndPosition.x=touchPoint.x,this._touchEndPosition.y=touchPoint.y,this._handleReleaseLogic(touch),sender.isSwallowTouches()&&(this._isInterceptTouch=!1)}}}else ccui.Layout.prototype.interceptTouchEvent.call(this,event,sender,touch)},_processScrollEvent:function(_directionEvent,bounce){var event=0;switch(_directionEvent){case ccui.ScrollView.MOVEDIR_TOP:event=bounce?ccui.ScrollView.EVENT_BOUNCE_TOP:ccui.ScrollView.EVENT_SCROLL_TO_TOP;break;case ccui.ScrollView.MOVEDIR_BOTTOM:event=bounce?ccui.ScrollView.EVENT_BOUNCE_BOTTOM:ccui.ScrollView.EVENT_SCROLL_TO_BOTTOM;break;case ccui.ScrollView.MOVEDIR_LEFT:event=bounce?ccui.ScrollView.EVENT_BOUNCE_LEFT:ccui.ScrollView.EVENT_SCROLL_TO_LEFT;break;case ccui.ScrollView.MOVEDIR_RIGHT:event=bounce?ccui.ScrollView.EVENT_BOUNCE_RIGHT:ccui.ScrollView.EVENT_SCROLL_TO_RIGHT}this._dispatchEvent(event)},_processScrollingEvent:function(){this._dispatchEvent(ccui.ScrollView.EVENT_SCROLLING)},_dispatchEvent:function(event){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,event):this._scrollViewEventSelector(this,event)),this._ccEventCallback&&this._ccEventCallback(this,event)},addEventListenerScrollView:function(selector,target){this._scrollViewEventSelector=selector,this._scrollViewEventListener=target},addEventListener:function(selector){this._ccEventCallback=selector},setDirection:function(dir){this._direction=dir,this._scrollBarEnabled&&(this._removeScrollBar(),this._initScrollBar())},getDirection:function(){return this._direction},setBounceEnabled:function(enabled){this.bounceEnabled=enabled},isBounceEnabled:function(){return this.bounceEnabled},setInertiaScrollEnabled:function(enabled){this.inertiaScrollEnabled=enabled},isInertiaScrollEnabled:function(){return this.inertiaScrollEnabled},setScrollBarEnabled:function(enabled){this._scrollBarEnabled!==enabled&&(this._scrollBarEnabled&&this._removeScrollBar(),this._scrollBarEnabled=enabled,this._scrollBarEnabled&&this._initScrollBar())},isScrollBarEnabled:function(){return this._scrollBarEnabled},setScrollBarPositionFromCorner:function(positionFromCorner){this._direction!==ccui.ScrollView.DIR_HORIZONTAL&&this.setScrollBarPositionFromCornerForVertical(positionFromCorner),this._direction!==ccui.ScrollView.DIR_VERTICAL&&this.setScrollBarPositionFromCornerForHorizontal(positionFromCorner)},setScrollBarPositionFromCornerForVertical:function(positionFromCorner){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),cc.assert(this._direction!==ccui.ScrollView.DIR_HORIZONTAL,"Scroll view doesn't have a vertical scroll bar!"),this._verticalScrollBar.setPositionFromCorner(positionFromCorner)},getScrollBarPositionFromCornerForVertical:function(){return cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),cc.assert(this._direction!==ccui.ScrollView.DIR_HORIZONTAL,"Scroll view doesn't have a vertical scroll bar!"),this._verticalScrollBar.getPositionFromCorner()},setScrollBarPositionFromCornerForHorizontal:function(positionFromCorner){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),cc.assert(this._direction!==ccui.ScrollView.DIR_VERTICAL,"Scroll view doesn't have a horizontal scroll bar!"),this._horizontalScrollBar.setPositionFromCorner(positionFromCorner)},getScrollBarPositionFromCornerForHorizontal:function(){return cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),cc.assert(this._direction!==ccui.ScrollView.DIR_VERTICAL,"Scroll view doesn't have a horizontal scroll bar!"),this._horizontalScrollBar.getPositionFromCorner()},setScrollBarWidth:function(width){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&this._verticalScrollBar.setWidth(width),this._horizontalScrollBar&&this._horizontalScrollBar.setWidth(width)},getScrollBarWidth:function(){return cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar?this._verticalScrollBar.getWidth():this._horizontalScrollBar?this._horizontalScrollBar.getWidth():0},setScrollBarColor:function(color){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&this._verticalScrollBar.setColor(color),this._horizontalScrollBar&&this._horizontalScrollBar.setColor(color)},getScrollBarColor:function(){return cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&this._verticalScrollBar.getColor(),this._horizontalScrollBar&&this._horizontalScrollBar.getColor(),cc.color.WHITE},setScrollBarOpacity:function(opacity){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&(this._verticalScrollBar.opacity=opacity),this._horizontalScrollBar&&(this._horizontalScrollBar.opacity=opacity)},getScrollBarOpacity:function(){return cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar?this._verticalScrollBar.opacity:this._horizontalScrollBar?this._horizontalScrollBar.opacity:-1},setScrollBarAutoHideEnabled:function(autoHideEnabled){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&(this._verticalScrollBar.autoHideEnabled=autoHideEnabled),this._horizontalScrollBar&&(this._horizontalScrollBar.autoHideEnabled=autoHideEnabled)},isScrollBarAutoHideEnabled:function(){return cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar?this._verticalScrollBar.autoHideEnabled:!!this._horizontalScrollBar&&this._horizontalScrollBar.autoHideEnabled},setScrollBarAutoHideTime:function(autoHideTime){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&(this._verticalScrollBar.autoHideTime=autoHideTime),this._horizontalScrollBar&&(this._horizontalScrollBar.autoHideTime=autoHideTime)},getScrollBarAutoHideTime:function(){return cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar?this._verticalScrollBar.autoHideTime:this._horizontalScrollBar?this._horizontalScrollBar.autoHideTime:0},getInnerContainer:function(){return this._innerContainer},setLayoutType:function(type){this._innerContainer.setLayoutType(type)},getLayoutType:function(){return this._innerContainer.getLayoutType()},_doLayout:function(){this._doLayoutDirty&&(this._doLayoutDirty=!1)},getDescription:function(){return"ScrollView"},_createCloneInstance:function(){return new ccui.ScrollView},_copyClonedWidgetChildren:function(model){ccui.Layout.prototype._copyClonedWidgetChildren.call(this,model)},_copySpecialProperties:function(scrollView){scrollView instanceof ccui.ScrollView&&(ccui.Layout.prototype._copySpecialProperties.call(this,scrollView),this.setInnerContainerSize(scrollView.getInnerContainerSize()),this.setInnerContainerPosition(scrollView.getInnerContainerPosition()),this.setDirection(scrollView._direction),this._topBoundary=scrollView._topBoundary,this._bottomBoundary=scrollView._bottomBoundary,this._leftBoundary=scrollView._leftBoundary,this._rightBoundary=scrollView._rightBoundary,this._bePressed=scrollView._bePressed,this._childFocusCancelOffset=scrollView._childFocusCancelOffset,this._touchMoveDisplacements=scrollView._touchMoveDisplacements,this._touchMoveTimeDeltas=scrollView._touchMoveTimeDeltas,this._touchMovePreviousTimestamp=scrollView._touchMovePreviousTimestamp,this._autoScrolling=scrollView._autoScrolling,this._autoScrollAttenuate=scrollView._autoScrollAttenuate,this._autoScrollStartPosition=scrollView._autoScrollStartPosition,this._autoScrollTargetDelta=scrollView._autoScrollTargetDelta,this._autoScrollTotalTime=scrollView._autoScrollTotalTime,this._autoScrollAccumulatedTime=scrollView._autoScrollAccumulatedTime,this._autoScrollCurrentlyOutOfBoundary=scrollView._autoScrollCurrentlyOutOfBoundary,this._autoScrollBraking=scrollView._autoScrollBraking,this._autoScrollBrakingStartPosition=scrollView._autoScrollBrakingStartPosition,this.setBounceEnabled(scrollView.bounceEnabled),this.setInertiaScrollEnabled(scrollView.inertiaScrollEnabled),this._scrollViewEventListener=scrollView._scrollViewEventListener,this._scrollViewEventSelector=scrollView._scrollViewEventSelector,this._ccEventCallback=scrollView._ccEventCallback,this.setScrollBarEnabled(scrollView.isScrollBarEnabled()),this.isScrollBarEnabled()&&(this._direction!==ccui.ScrollView.DIR_HORIZONTAL&&this.setScrollBarPositionFromCornerForVertical(scrollView.getScrollBarPositionFromCornerForVertical()),this._direction!==ccui.ScrollView.DIR_VERTICAL&&this.setScrollBarPositionFromCornerForHorizontal(scrollView.getScrollBarPositionFromCornerForHorizontal()),this.setScrollBarWidth(scrollView.getScrollBarWidth()),this.setScrollBarColor(scrollView.getScrollBarColor()),this.setScrollBarAutoHideEnabled(scrollView.isScrollBarAutoHideEnabled()),this.setScrollBarAutoHideTime(scrollView.getScrollBarAutoHideTime())))},_initScrollBar:function(){this._direction===ccui.ScrollView.DIR_HORIZONTAL||this._verticalScrollBar||(this._verticalScrollBar=new ccui.ScrollViewBar(this,ccui.ScrollView.DIR_VERTICAL),this.addProtectedChild(this._verticalScrollBar,2)),this._direction===ccui.ScrollView.DIR_VERTICAL||this._horizontalScrollBar||(this._horizontalScrollBar=new ccui.ScrollViewBar(this,ccui.ScrollView.DIR_HORIZONTAL),this.addProtectedChild(this._horizontalScrollBar,2))},_removeScrollBar:function(){this._verticalScrollBar&&(this.removeProtectedChild(this._verticalScrollBar),this._verticalScrollBar=null),this._horizontalScrollBar&&(this.removeProtectedChild(this._horizontalScrollBar),this._horizontalScrollBar=null)},getNodeByTag:function(tag){return this._innerContainer.getNodeByTag(tag)},getNodes:function(){return this._innerContainer.getNodes()},removeNode:function(node){this._innerContainer.removeNode(node)},removeNodeByTag:function(tag){this._innerContainer.removeNodeByTag(tag)},removeAllNodes:function(){this._innerContainer.removeAllNodes()},addNode:function(node,zOrder,tag){this._innerContainer.addNode(node,zOrder,tag)}}),(_p=ccui.ScrollView.prototype).innerWidth,cc.defineGetterSetter(_p,"innerWidth",_p._getInnerWidth,_p._setInnerWidth),_p.innerHeight,cc.defineGetterSetter(_p,"innerHeight",_p._getInnerHeight,_p._setInnerHeight),_p.direction,cc.defineGetterSetter(_p,"direction",_p.getDirection,_p.setDirection),_p.touchTotalTimeThreshold,cc.defineGetterSetter(_p,"touchTotalTimeThreshold",_p.getTouchTotalTimeThreshold,_p.setTouchTotalTimeThreshold),_p=null,ccui.ScrollView.create=function(){return new ccui.ScrollView},ccui.ScrollView.DIR_NONE=0,ccui.ScrollView.DIR_VERTICAL=1,ccui.ScrollView.DIR_HORIZONTAL=2,ccui.ScrollView.DIR_BOTH=3,ccui.ScrollView.EVENT_SCROLL_TO_TOP=0,ccui.ScrollView.EVENT_SCROLL_TO_BOTTOM=1,ccui.ScrollView.EVENT_SCROLL_TO_LEFT=2,ccui.ScrollView.EVENT_SCROLL_TO_RIGHT=3,ccui.ScrollView.EVENT_SCROLLING=4,ccui.ScrollView.EVENT_BOUNCE_TOP=5,ccui.ScrollView.EVENT_BOUNCE_BOTTOM=6,ccui.ScrollView.EVENT_BOUNCE_LEFT=7,ccui.ScrollView.EVENT_BOUNCE_RIGHT=8,ccui.ScrollView.EVENT_CONTAINER_MOVED=9,ccui.ScrollView.EVENT_AUTOSCROLL_ENDED=10,ccui.ScrollView.MOVEDIR_TOP=0,ccui.ScrollView.MOVEDIR_BOTTOM=1,ccui.ScrollView.MOVEDIR_LEFT=2,ccui.ScrollView.MOVEDIR_RIGHT=3,ccui.ListView=ccui.ScrollView.extend({_model:null,_items:null,_gravity:null,_itemsMargin:0,_curSelectedIndex:0,_refreshViewDirty:!0,_listViewEventListener:null,_listViewEventSelector:null,_ccListViewEventCallback:null,_magneticAllowedOutOfBoundary:!0,_magneticType:0,_className:"ListView",ctor:function(){this._items=[],ccui.ScrollView.prototype.ctor.call(this),this._gravity=ccui.ListView.GRAVITY_CENTER_VERTICAL,this.setTouchEnabled(!0),this.setDirection(ccui.ScrollView.DIR_VERTICAL)},setItemModel:function(model){model?this._model=model:cc.log("Can't set a null to item model!")},_handleReleaseLogic:function(touch){ccui.ScrollView.prototype._handleReleaseLogic.call(this,touch),this._autoScrolling||this._startMagneticScroll()},_onItemListChanged:function(){this._outOfBoundaryAmountDirty=!0},_updateInnerContainerSize:function(){var i,length,locItems=this._items;switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:var totalHeight=((length=locItems.length)-1)*this._itemsMargin;for(i=0;i<length;i++)totalHeight+=locItems[i].getContentSize().height;this.setInnerContainerSize(cc.size(this._contentSize.width,totalHeight));break;case ccui.ScrollView.DIR_HORIZONTAL:var totalWidth=((length=locItems.length)-1)*this._itemsMargin;for(i=0;i<length;i++)totalWidth+=locItems[i].getContentSize().width;this.setInnerContainerSize(cc.size(totalWidth,this._contentSize.height))}},_remedyLayoutParameter:function(item){cc.assert(null!=item,"ListView Item can't be nil!");var linearLayoutParameter=item.getLayoutParameter(ccui.LayoutParameter.LINEAR),isLayoutParameterExists=!0;linearLayoutParameter||(linearLayoutParameter=new ccui.LinearLayoutParameter,isLayoutParameterExists=!1);var itemIndex=this.getIndex(item);switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:this._remedyVerticalLayoutParameter(linearLayoutParameter,itemIndex);break;case ccui.ScrollView.DIR_HORIZONTAL:this._remedyHorizontalLayoutParameter(linearLayoutParameter,itemIndex)}isLayoutParameterExists||item.setLayoutParameter(linearLayoutParameter)},_remedyVerticalLayoutParameter:function(layoutParameter,itemIndex){switch(cc.assert(null!=layoutParameter,"Layout parameter can't be nil!"),this._gravity){case ccui.ListView.GRAVITY_LEFT:layoutParameter.setGravity(ccui.LinearLayoutParameter.LEFT);break;case ccui.ListView.GRAVITY_RIGHT:layoutParameter.setGravity(ccui.LinearLayoutParameter.RIGHT);break;case ccui.ListView.GRAVITY_CENTER_HORIZONTAL:layoutParameter.setGravity(ccui.LinearLayoutParameter.CENTER_HORIZONTAL)}0===itemIndex?layoutParameter.setMargin(ccui.MarginZero()):layoutParameter.setMargin(new ccui.Margin(0,this._itemsMargin,0,0))},_remedyHorizontalLayoutParameter:function(layoutParameter,itemIndex){switch(cc.assert(null!=layoutParameter,"Layout parameter can't be nil!"),this._gravity){case ccui.ListView.GRAVITY_TOP:layoutParameter.setGravity(ccui.LinearLayoutParameter.TOP);break;case ccui.ListView.GRAVITY_BOTTOM:layoutParameter.setGravity(ccui.LinearLayoutParameter.BOTTOM);break;case ccui.ListView.GRAVITY_CENTER_VERTICAL:layoutParameter.setGravity(ccui.LinearLayoutParameter.CENTER_VERTICAL)}0===itemIndex?layoutParameter.setMargin(ccui.MarginZero()):layoutParameter.setMargin(new ccui.Margin(this._itemsMargin,0,0,0))},pushBackDefaultItem:function(){if(null!=this._model){var newItem=this._model.clone();this._remedyLayoutParameter(newItem),this.addChild(newItem),this._refreshViewDirty=!0}},insertDefaultItem:function(index){if(null!=this._model){var newItem=this._model.clone();this._items.splice(index,0,newItem),ccui.ScrollView.prototype.addChild.call(this,newItem),this._remedyLayoutParameter(newItem),this._refreshViewDirty=!0}},pushBackCustomItem:function(item){this._remedyLayoutParameter(item),this.addChild(item),this._refreshViewDirty=!0},addChild:function(widget,zOrder,tag){widget&&(zOrder=zOrder||widget.getLocalZOrder(),tag=tag||widget.getName(),ccui.ScrollView.prototype.addChild.call(this,widget,zOrder,tag),widget instanceof ccui.Widget&&(this._items.push(widget),this._onItemListChanged()))},removeChild:function(widget,cleanup){if(widget){var index=this._items.indexOf(widget);index>-1&&this._items.splice(index,1),this._onItemListChanged(),ccui.ScrollView.prototype.removeChild.call(this,widget,cleanup)}},removeAllChildren:function(){this.removeAllChildrenWithCleanup(!0)},removeAllChildrenWithCleanup:function(cleanup){ccui.ScrollView.prototype.removeAllChildrenWithCleanup.call(this,cleanup),this._items=[],this._onItemListChanged()},insertCustomItem:function(item,index){this._items.splice(index,0,item),this._onItemListChanged(),ccui.ScrollView.prototype.addChild.call(this,item),this._remedyLayoutParameter(item),this._refreshViewDirty=!0},removeItem:function(index){var item=this.getItem(index);null!=item&&(this.removeChild(item,!0),this._refreshViewDirty=!0)},removeLastItem:function(){this.removeItem(this._items.length-1)},removeAllItems:function(){this.removeAllChildren()},getItem:function(index){return index<0||index>=this._items.length?null:this._items[index]},getItems:function(){return this._items},getIndex:function(item){return null==item?-1:this._items.indexOf(item)},setGravity:function(gravity){this._gravity!==gravity&&(this._gravity=gravity,this._refreshViewDirty=!0)},setMagneticType:function(magneticType){this._magneticType=magneticType,this._onItemListChanged(),this._startMagneticScroll()},getMagneticType:function(){return this._magneticType},setMagneticAllowedOutOfBoundary:function(magneticAllowedOutOfBoundary){this._magneticAllowedOutOfBoundary=magneticAllowedOutOfBoundary},getMagneticAllowedOutOfBoundary:function(){return this._magneticAllowedOutOfBoundary},setItemsMargin:function(margin){this._itemsMargin!==margin&&(this._itemsMargin=margin,this._refreshViewDirty=!0)},getItemsMargin:function(){return this._itemsMargin},setDirection:function(dir){switch(dir){case ccui.ScrollView.DIR_VERTICAL:this.setLayoutType(ccui.Layout.LINEAR_VERTICAL);break;case ccui.ScrollView.DIR_HORIZONTAL:this.setLayoutType(ccui.Layout.LINEAR_HORIZONTAL);break;case ccui.ScrollView.DIR_BOTH:default:return}ccui.ScrollView.prototype.setDirection.call(this,dir)},_getHowMuchOutOfBoundary:function(addition){if(void 0===addition&&(addition=cc.p(0,0)),!this._magneticAllowedOutOfBoundary||0===this._items.length)return ccui.ScrollView.prototype._getHowMuchOutOfBoundary.call(this,addition);if(this._magneticType===ccui.ListView.MAGNETIC_NONE||this._magneticType===ccui.ListView.MAGNETIC_BOTH_END)return ccui.ScrollView.prototype._getHowMuchOutOfBoundary.call(this,addition);if(0===addition.x&&0===addition.y&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var leftBoundary=this._leftBoundary,rightBoundary=this._rightBoundary,topBoundary=this._topBoundary,bottomBoundary=this._bottomBoundary,lastItemIndex=this._items.length-1,contentSize=this.getContentSize(),firstItemAdjustment=cc.p(0,0),lastItemAdjustment=cc.p(0,0);switch(this._magneticType){case ccui.ListView.MAGNETIC_CENTER:firstItemAdjustment.x=(contentSize.width-this._items[0].width)/2,firstItemAdjustment.y=(contentSize.height-this._items[0].height)/2,lastItemAdjustment.x=(contentSize.width-this._items[lastItemIndex].width)/2,lastItemAdjustment.y=(contentSize.height-this._items[lastItemIndex].height)/2;break;case ccui.ListView.MAGNETIC_LEFT:case ccui.ListView.MAGNETIC_TOP:lastItemAdjustment.x=contentSize.width-this._items[lastItemIndex].width,lastItemAdjustment.y=contentSize.height-this._items[lastItemIndex].height;break;case ccui.ListView.MAGNETIC_RIGHT:case ccui.ListView.MAGNETIC_BOTTOM:firstItemAdjustment.x=contentSize.width-this._items[0].width,firstItemAdjustment.y=contentSize.height-this._items[0].height}leftBoundary+=firstItemAdjustment.x,rightBoundary-=lastItemAdjustment.x,topBoundary-=firstItemAdjustment.y,bottomBoundary+=lastItemAdjustment.y;var outOfBoundaryAmount=cc.p(0,0);return this._innerContainer.getLeftBoundary()+addition.x>leftBoundary?outOfBoundaryAmount.x=leftBoundary-(this._innerContainer.getLeftBoundary()+addition.x):this._innerContainer.getRightBoundary()+addition.x<rightBoundary&&(outOfBoundaryAmount.x=rightBoundary-(this._innerContainer.getRightBoundary()+addition.x)),this._innerContainer.getTopBoundary()+addition.y<topBoundary?outOfBoundaryAmount.y=topBoundary-(this._innerContainer.getTopBoundary()+addition.y):this._innerContainer.getBottomBoundary()+addition.y>bottomBoundary&&(outOfBoundaryAmount.y=bottomBoundary-(this._innerContainer.getBottomBoundary()+addition.y)),0===addition.x&&0===addition.y&&(this._outOfBoundaryAmount=outOfBoundaryAmount,this._outOfBoundaryAmountDirty=!1),outOfBoundaryAmount},_calculateItemPositionWithAnchor:function(item,itemAnchorPoint){var origin=cc.p(item.getLeftBoundary(),item.getBottomBoundary()),size=item.getContentSize();return cc.p(origin.x+size.width*itemAnchorPoint.x,origin.y+size.height*itemAnchorPoint.y)},_findClosestItem:function(targetPosition,items,itemAnchorPoint,firstIndex,distanceFromFirst,lastIndex,distanceFromLast){if(cc.assert(firstIndex>=0&&lastIndex<items.length&&firstIndex<=lastIndex,""),firstIndex===lastIndex)return items[firstIndex];if(lastIndex-firstIndex==1)return distanceFromFirst<=distanceFromLast?items[firstIndex]:items[lastIndex];var midIndex=Math.floor((firstIndex+lastIndex)/2),itemPosition=this._calculateItemPositionWithAnchor(items[midIndex],itemAnchorPoint),distanceFromMid=cc.pLength(cc.pSub(targetPosition,itemPosition));return distanceFromFirst<=distanceFromLast?this._findClosestItem(targetPosition,items,itemAnchorPoint,firstIndex,distanceFromFirst,midIndex,distanceFromMid):this._findClosestItem(targetPosition,items,itemAnchorPoint,midIndex,distanceFromMid,lastIndex,distanceFromLast)},getClosestItemToPosition:function(targetPosition,itemAnchorPoint){if(0===this._items.length)return null;var firstPosition=this._calculateItemPositionWithAnchor(this._items[0],itemAnchorPoint),distanceFromFirst=cc.pLength(cc.pSub(targetPosition,firstPosition)),lastIndex=this._items.length-1,lastPosition=this._calculateItemPositionWithAnchor(this._items[lastIndex],itemAnchorPoint),distanceFromLast=cc.pLength(cc.pSub(targetPosition,lastPosition));return this._findClosestItem(targetPosition,this._items,itemAnchorPoint,0,distanceFromFirst,lastIndex,distanceFromLast)},getClosestItemToPositionInCurrentView:function(positionRatioInView,itemAnchorPoint){var contentSize=this.getContentSize(),targetPosition=cc.pMult(this._innerContainer.getPosition(),-1);return targetPosition.x+=contentSize.width*positionRatioInView.x,targetPosition.y+=contentSize.height*positionRatioInView.y,this.getClosestItemToPosition(targetPosition,itemAnchorPoint)},getCenterItemInCurrentView:function(){return this.getClosestItemToPositionInCurrentView(cc.p(.5,.5),cc.p(.5,.5))},getLeftmostItemInCurrentView:function(){return this._direction===ccui.ScrollView.DIR_HORIZONTAL?this.getClosestItemToPositionInCurrentView(cc.p(0,.5),cc.p(.5,.5)):null},getRightmostItemInCurrentView:function(){return this._direction===ccui.ScrollView.DIR_HORIZONTAL?this.getClosestItemToPositionInCurrentView(cc.p(1,.5),cc.p(.5,.5)):null},getTopmostItemInCurrentView:function(){return this._direction===ccui.ScrollView.DIR_VERTICAL?this.getClosestItemToPositionInCurrentView(cc.p(.5,1),cc.p(.5,.5)):null},getBottommostItemInCurrentView:function(){return this._direction===ccui.ScrollView.DIR_VERTICAL?this.getClosestItemToPositionInCurrentView(cc.p(.5,0),cc.p(.5,.5)):null},_calculateItemDestination:function(positionRatioInView,item,itemAnchorPoint){var contentSize=this.getContentSize(),positionInView=cc.p(0,0);positionInView.x+=contentSize.width*positionRatioInView.x,positionInView.y+=contentSize.height*positionRatioInView.y;var itemPosition=this._calculateItemPositionWithAnchor(item,itemAnchorPoint);return cc.pMult(cc.pSub(itemPosition,positionInView),-1)},jumpToBottom:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToBottom.call(this)},jumpToTop:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToTop.call(this)},jumpToLeft:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToLeft.call(this)},jumpToRight:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToRight.call(this)},jumpToTopLeft:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToTopLeft.call(this)},jumpToTopRight:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToTopRight.call(this)},jumpToBottomLeft:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToBottomLeft.call(this)},jumpToBottomRight:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToBottomRight.call(this)},jumpToPercentVertical:function(percent){this.doLayout(),ccui.ScrollView.prototype.jumpToPercentVertical.call(this,percent)},jumpToPercentHorizontal:function(percent){this.doLayout(),ccui.ScrollView.prototype.jumpToPercentHorizontal.call(this,percent)},jumpToPercentBothDirection:function(percent){this.doLayout(),ccui.ScrollView.prototype.jumpToPercentBothDirection.call(this,percent)},jumpToItem:function(itemIndex,positionRatioInView,itemAnchorPoint){var item=this.getItem(itemIndex);if(item){this.doLayout();var destination=this._calculateItemDestination(positionRatioInView,item,itemAnchorPoint);if(!this.bounceEnabled){var delta=cc.pSub(destination,this._innerContainer.getPosition()),outOfBoundary=this._getHowMuchOutOfBoundary(delta);destination.x+=outOfBoundary.x,destination.y+=outOfBoundary.y}this._jumpToDestination(destination)}},scrollToItem:function(itemIndex,positionRatioInView,itemAnchorPoint,timeInSec){void 0===timeInSec&&(timeInSec=1);var item=this.getItem(itemIndex);if(item){var destination=this._calculateItemDestination(positionRatioInView,item,itemAnchorPoint);this._startAutoScrollToDestination(destination,timeInSec,!0)}},requestRefreshView:function(){this._refreshViewDirty=!0},refreshView:function(){this.forceDoLayout()},doLayout:function(){this._doLayout()},requestDoLayout:function(){this._refreshViewDirty=!0},_doLayout:function(){if(this._refreshViewDirty){for(var locItems=this._items,i=0;i<locItems.length;i++){var item=locItems[i];item.setLocalZOrder(i),this._remedyLayoutParameter(item)}this._updateInnerContainerSize(),this._innerContainer.forceDoLayout(),this._refreshViewDirty=!1}},addEventListenerListView:function(selector,target){this._listViewEventListener=target,this._listViewEventSelector=selector},addEventListener:function(selector){this._ccListViewEventCallback=selector},_selectedItemEvent:function(event){var eventEnum=event===ccui.Widget.TOUCH_BEGAN?ccui.ListView.ON_SELECTED_ITEM_START:ccui.ListView.ON_SELECTED_ITEM_END;this._listViewEventSelector&&(this._listViewEventListener?this._listViewEventSelector.call(this._listViewEventListener,this,eventEnum):this._listViewEventSelector(this,eventEnum)),this._ccListViewEventCallback&&this._ccListViewEventCallback(this,eventEnum)},interceptTouchEvent:function(eventType,sender,touch){if(ccui.ScrollView.prototype.interceptTouchEvent.call(this,eventType,sender,touch),this._touchEnabled&&eventType!==ccui.Widget.TOUCH_MOVED){for(var parent=sender;parent;){if(parent&&parent.getParent()===this._innerContainer){this._curSelectedIndex=this.getIndex(parent);break}parent=parent.getParent()}sender.isHighlighted()&&this._selectedItemEvent(eventType)}},getCurSelectedIndex:function(){return this._curSelectedIndex},_onSizeChanged:function(){ccui.ScrollView.prototype._onSizeChanged.call(this),this._refreshViewDirty=!0},getDescription:function(){return"ListView"},_createCloneInstance:function(){return new ccui.ListView},_copyClonedWidgetChildren:function(model){for(var arrayItems=model.getItems(),i=0;i<arrayItems.length;i++){var item=arrayItems[i];this.pushBackCustomItem(item.clone())}},_copySpecialProperties:function(listView){listView instanceof ccui.ListView&&(ccui.ScrollView.prototype._copySpecialProperties.call(this,listView),this.setItemModel(listView._model),this.setItemsMargin(listView._itemsMargin),this.setGravity(listView._gravity),this._listViewEventListener=listView._listViewEventListener,this._listViewEventSelector=listView._listViewEventSelector)},_startAttenuatingAutoScroll:function(deltaMove,initialVelocity){var adjustedDeltaMove=deltaMove;if(0!==this._items.length&&this._magneticType!==ccui.ListView.MAGNETIC_NONE){adjustedDeltaMove=this._flattenVectorByDirection(adjustedDeltaMove);var howMuchOutOfBoundary=this._getHowMuchOutOfBoundary(adjustedDeltaMove);if(0===howMuchOutOfBoundary.x&&0===howMuchOutOfBoundary.y){var magType=this._magneticType;magType===ccui.ListView.MAGNETIC_BOTH_END&&(this._direction===ccui.ScrollView.DIR_HORIZONTAL?magType=adjustedDeltaMove.x>0?ccui.ListView.MAGNETIC_LEFT:ccui.ListView.MAGNETIC_RIGHT:this._direction===ccui.ScrollView.DIR_VERTICAL&&(magType=adjustedDeltaMove.y>0?ccui.ListView.MAGNETIC_BOTTOM:ccui.ListView.MAGNETIC_TOP));var magneticAnchorPoint=this._getAnchorPointByMagneticType(magType),magneticPosition=cc.pMult(this._innerContainer.getPosition(),-1);magneticPosition.x+=this.width*magneticAnchorPoint.x,magneticPosition.y+=this.height*magneticAnchorPoint.y;var pTargetItem=this.getClosestItemToPosition(cc.pSub(magneticPosition,adjustedDeltaMove),magneticAnchorPoint),itemPosition=this._calculateItemPositionWithAnchor(pTargetItem,magneticAnchorPoint);adjustedDeltaMove=cc.pSub(magneticPosition,itemPosition)}}ccui.ScrollView.prototype._startAttenuatingAutoScroll.call(this,adjustedDeltaMove,initialVelocity)},_getAnchorPointByMagneticType:function(magneticType){switch(magneticType){case ccui.ListView.MAGNETIC_NONE:return cc.p(0,0);case ccui.ListView.MAGNETIC_BOTH_END:return cc.p(0,1);case ccui.ListView.MAGNETIC_CENTER:return cc.p(.5,.5);case ccui.ListView.MAGNETIC_LEFT:return cc.p(0,.5);case ccui.ListView.MAGNETIC_RIGHT:return cc.p(1,.5);case ccui.ListView.MAGNETIC_TOP:return cc.p(.5,1);case ccui.ListView.MAGNETIC_BOTTOM:return cc.p(.5,0)}return cc.p(0,0)},_startMagneticScroll:function(){if(0!==this._items.length&&this._magneticType!==ccui.ListView.MAGNETIC_NONE){var magneticAnchorPoint=this._getAnchorPointByMagneticType(this._magneticType),magneticPosition=cc.pMult(this._innerContainer.getPosition(),-1);magneticPosition.x+=this.width*magneticAnchorPoint.x,magneticPosition.y+=this.height*magneticAnchorPoint.y;var pTargetItem=this.getClosestItemToPosition(magneticPosition,magneticAnchorPoint);this.scrollToItem(this.getIndex(pTargetItem),magneticAnchorPoint,magneticAnchorPoint)}}}),ccui.ListView.create=function(){return new ccui.ListView},ccui.ListView.EVENT_SELECTED_ITEM=0,ccui.ListView.ON_SELECTED_ITEM_START=0,ccui.ListView.ON_SELECTED_ITEM_END=1,ccui.ListView.GRAVITY_LEFT=0,ccui.ListView.GRAVITY_RIGHT=1,ccui.ListView.GRAVITY_CENTER_HORIZONTAL=2,ccui.ListView.GRAVITY_TOP=3,ccui.ListView.GRAVITY_BOTTOM=4,ccui.ListView.GRAVITY_CENTER_VERTICAL=5,ccui.ListView.MAGNETIC_NONE=0,ccui.ListView.MAGNETIC_CENTER=1,ccui.ListView.MAGNETIC_BOTH_END=2,ccui.ListView.MAGNETIC_LEFT=3,ccui.ListView.MAGNETIC_RIGHT=4,ccui.ListView.MAGNETIC_TOP=5,ccui.ListView.MAGNETIC_BOTTOM=6,ccui.PageView=ccui.ListView.extend({_curPageIdx:0,_childFocusCancelOffset:0,_pageViewEventListener:null,_pageViewEventSelector:null,_className:"PageView",_indicator:null,_indicatorPositionAsAnchorPoint:null,ctor:function(){ccui.ListView.prototype.ctor.call(this),this._childFocusCancelOffset=5,this._indicatorPositionAsAnchorPoint=cc.p(.5,.1),this._pageViewEventListener=null,this._pageViewEventSelector=null,this.setDirection(ccui.ScrollView.DIR_HORIZONTAL),this.setMagneticType(ccui.ListView.MAGNETIC_CENTER),this.setScrollBarEnabled(!1)},addWidgetToPage:function(widget,pageIdx,forceCreate){this.insertCustomItem(widget,pageIdx)},addPage:function(page){this.pushBackCustomItem(page)},insertPage:function(page,idx){this.insertCustomItem(page,idx)},removePage:function(page){this.removeItem(this.getIndex(page))},removePageAtIndex:function(index){this.removeItem(index)},removeAllPages:function(){this.removeAllItems()},scrollToItem:function(idx){ccui.ListView.prototype.scrollToItem.call(this,idx,cc.p(.5,.5),cc.p(.5,.5))},scrollToPage:function(idx){this.scrollToItem(idx)},_doLayout:function(){if(this._refreshViewDirty){if(ccui.ListView.prototype._doLayout.call(this),this._indicator){var index=this.getIndex(this.getCenterItemInCurrentView());this._indicator.indicate(index)}this._refreshViewDirty=!1}},setDirection:function(direction){ccui.ListView.prototype.setDirection.call(this,direction),direction===ccui.ScrollView.DIR_HORIZONTAL?this._indicatorPositionAsAnchorPoint=cc.p(.5,.1):direction===ccui.ScrollView.DIR_VERTICAL&&(this._indicatorPositionAsAnchorPoint=cc.p(.1,.5)),this._indicator&&(this._indicator.setDirection(direction),this._refreshIndicatorPosition())},setCustomScrollThreshold:function(threshold){},getCustomScrollThreshold:function(){return 0},setUsingCustomScrollThreshold:function(flag){},isUsingCustomScrollThreshold:function(){return!1},_moveInnerContainer:function(deltaMove,canStartBounceBack){ccui.ListView.prototype._moveInnerContainer.call(this,deltaMove,canStartBounceBack),this._curPageIdx=this.getIndex(this.getCenterItemInCurrentView()),this._indicator&&this._indicator.indicate(this._curPageIdx)},_onItemListChanged:function(){ccui.ListView.prototype._onItemListChanged.call(this),this._indicator&&this._indicator.reset(this._items.length)},_onSizeChanged:function(){ccui.ListView.prototype._onSizeChanged.call(this),this._refreshIndicatorPosition()},_remedyLayoutParameter:function(item){item.setContentSize(this.getContentSize()),ccui.ListView.prototype._remedyLayoutParameter.call(this,item)},_refreshIndicatorPosition:function(){if(this._indicator){var contentSize=this.getContentSize(),posX=contentSize.width*this._indicatorPositionAsAnchorPoint.x,posY=contentSize.height*this._indicatorPositionAsAnchorPoint.y;this._indicator.setPosition(cc.p(posX,posY))}},_handleReleaseLogic:function(touchPoint){if(ccui.ScrollView.prototype._handleReleaseLogic.call(this,touchPoint),!(this._items.length<=0)){var touchMoveVelocity=this._flattenVectorByDirection(this._calculateTouchMoveVelocity());if(cc.pLength(touchMoveVelocity)<500)this._startMagneticScroll();else{var currentPage=this.getItem(this._curPageIdx),destination=this._calculateItemDestination(cc.p(.5,.5),currentPage,cc.p(.5,.5)),deltaToCurrentPage=cc.pSub(destination,this.getInnerContainerPosition());deltaToCurrentPage=this._flattenVectorByDirection(deltaToCurrentPage),touchMoveVelocity.x*deltaToCurrentPage.x>0||touchMoveVelocity.y*deltaToCurrentPage.y>0?this._startMagneticScroll():(touchMoveVelocity.x<0||touchMoveVelocity.y>0?++this._curPageIdx:--this._curPageIdx,this._curPageIdx=Math.min(this._curPageIdx,this._items.length),this._curPageIdx=Math.max(this._curPageIdx,0),this.scrollToItem(this._curPageIdx))}}},_getAutoScrollStopEpsilon:function(){return.001},_pageTurningEvent:function(){this._pageViewEventSelector&&(this._pageViewEventListener?this._pageViewEventSelector.call(this._pageViewEventListener,this,ccui.PageView.EVENT_TURNING):this._pageViewEventSelector(this,ccui.PageView.EVENT_TURNING)),this._ccEventCallback&&this._ccEventCallback(this,ccui.PageView.EVENT_TURNING)},addEventListenerPageView:function(selector,target){this._pageViewEventSelector=selector,this._pageViewEventListener=target},addEventListener:function(selector){this._ccEventCallback=function(ref,eventType){eventType==ccui.ScrollView.EVENT_AUTOSCROLL_ENDED&&selector(this,eventType)}},setCurrentPageIndex:function(index){this.jumpToItem(index,cc.p(.5,.5),cc.p(.5,.5))},setCurPageIndex:function(index){this.setCurrentPageIndex(index)},getCurrentPageIndex:function(){return this._curPageIdx},getCurPageIndex:function(){var widget=this.getCenterItemInCurrentView();return this.getIndex(widget)},getPages:function(){return this.getItems()},getPage:function(index){return this.getItem(index)},getDescription:function(){return"PageView"},_createCloneInstance:function(){return new ccui.PageView},_copyClonedWidgetChildren:function(model){for(var arrayPages=model.getPages(),i=0;i<arrayPages.length;i++){var page=arrayPages[i];this.addPage(page.clone())}},_copySpecialProperties:function(pageView){ccui.ListView.prototype._copySpecialProperties.call(this,pageView),this._ccEventCallback=pageView._ccEventCallback,this._pageViewEventListener=pageView._pageViewEventListener,this._pageViewEventSelector=pageView._pageViewEventSelector,this._customScrollThreshold=pageView._customScrollThreshold},setIndicatorEnabled:function(enabled){enabled!=(null!==this._indicator)&&(enabled?(this._indicator=new ccui.PageViewIndicator,this._indicator.setDirection(this.getDirection()),this.addProtectedChild(this._indicator,1e4),this.setIndicatorSelectedIndexColor(cc.color(100,100,255)),this._refreshIndicatorPosition()):(this.removeProtectedChild(this._indicator),this._indicator=null))},getIndicatorEnabled:function(){return null!==this._indicator},setIndicatorPositionAsAnchorPoint:function(positionAsAnchorPoint){this._indicatorPositionAsAnchorPoint=positionAsAnchorPoint,this._refreshIndicatorPosition()},getIndicatorPositionAsAnchorPoint:function(){return this._indicatorPositionAsAnchorPoint},setIndicatorPosition:function(position){if(this._indicator){var contentSize=this.getContentSize();this._indicatorPositionAsAnchorPoint.x=position.x/contentSize.width,this._indicatorPositionAsAnchorPoint.y=position.y/contentSize.height,this._indicator.setPosition(position)}},getIndicatorPosition:function(){return cc.assert(null!==this._indicator,""),this._indicator.getPosition()},setIndicatorSpaceBetweenIndexNodes:function(spaceBetweenIndexNodes){this._indicator&&this._indicator.setSpaceBetweenIndexNodes(spaceBetweenIndexNodes)},getIndicatorSpaceBetweenIndexNodes:function(){return cc.assert(null!==this._indicator,""),this._indicator.getSpaceBetweenIndexNodes()},setIndicatorSelectedIndexColor:function(color){this._indicator&&this._indicator.setSelectedIndexColor(color)},getIndicatorSelectedIndexColor:function(){return cc.assert(null!==this._indicator,""),this._indicator.getSelectedIndexColor()},setIndicatorIndexNodesColor:function(color){this._indicator&&this._indicator.setIndexNodesColor(color)},getIndicatorIndexNodesColor:function(){return cc.assert(null!==this._indicator,""),this._indicator.getIndexNodesColor()},setIndicatorIndexNodesScale:function(indexNodesScale){this._indicator&&(this._indicator.setIndexNodesScale(indexNodesScale),this._indicator.indicate(this._curPageIdx))},getIndicatorIndexNodesScale:function(){return cc.assert(null!==this._indicator,""),this._indicator.getIndexNodesScale()},setIndicatorIndexNodesTexture:function(texName,texType){this._indicator&&(this._indicator.setIndexNodesTexture(texName,texType),this._indicator.indicate(this._curPageIdx))}}),ccui.PageView.create=function(){return new ccui.PageView},ccui.PageView.EVENT_TURNING=0,ccui.PageView.TOUCH_DIR_LEFT=0,ccui.PageView.TOUCH_DIR_RIGHT=1,ccui.PageView.DIRECTION_LEFT=0,ccui.PageView.DIRECTION_RIGHT=1,ccui.PageViewIndicator=ccui.ProtectedNode.extend({_direction:null,_indexNodes:null,_currentIndexNode:null,_spaceBetweenIndexNodes:0,_indexNodesScale:1,_indexNodesColor:null,_useDefaultTexture:!0,_indexNodesTextureFile:"",_indexNodesTexType:ccui.Widget.LOCAL_TEXTURE,_className:"PageViewIndicator",ctor:function(){cc.ProtectedNode.prototype.ctor.call(this),this._direction=ccui.ScrollView.DIR_HORIZONTAL,this._indexNodes=[],this._spaceBetweenIndexNodes=ccui.PageViewIndicator.SPACE_BETWEEN_INDEX_NODES_DEFAULT,this._indexNodesColor=cc.color.WHITE,this._currentIndexNode=ccui.helper._createSpriteFromBase64(ccui.PageViewIndicator.CIRCLE_IMAGE,ccui.PageViewIndicator.CIRCLE_IMAGE_KEY),this._currentIndexNode.setVisible(!1),this.addProtectedChild(this._currentIndexNode,1)},setDirection:function(direction){this._direction=direction,this._rearrange()},reset:function(numberOfTotalPages){for(;this._indexNodes.length<numberOfTotalPages;)this._increaseNumberOfPages();for(;this._indexNodes.length>numberOfTotalPages;)this._decreaseNumberOfPages();this._rearrange(),this._currentIndexNode.setVisible(this._indexNodes.length>0)},indicate:function(index){index<0||index>=this._indexNodes.length||this._currentIndexNode.setPosition(this._indexNodes[index].getPosition())},_rearrange:function(){if(0!==this._indexNodes.length)for(var horizontal=this._direction===ccui.ScrollView.DIR_HORIZONTAL,indexNodeSize=this._indexNodes[0].getContentSize(),sizeValue=horizontal?indexNodeSize.width:indexNodeSize.height,numberOfItems=this._indexNodes.length,posValue=-(sizeValue*numberOfItems+this._spaceBetweenIndexNodes*(numberOfItems-1))/2+sizeValue/2,i=0;i<this._indexNodes.length;++i){var position;position=horizontal?cc.p(posValue,indexNodeSize.height/2):cc.p(indexNodeSize.width/2,-posValue),this._indexNodes[i].setPosition(position),posValue+=sizeValue+this._spaceBetweenIndexNodes}},setSpaceBetweenIndexNodes:function(spaceBetweenIndexNodes){this._spaceBetweenIndexNodes!==spaceBetweenIndexNodes&&(this._spaceBetweenIndexNodes=spaceBetweenIndexNodes,this._rearrange())},getSpaceBetweenIndexNodes:function(){return this._spaceBetweenIndexNodes},setSelectedIndexColor:function(color){this._currentIndexNode.setColor(color)},getSelectedIndexColor:function(){return this._currentIndexNode.getColor()},setIndexNodesColor:function(indexNodesColor){this._indexNodesColor=indexNodesColor;for(var i=0;i<this._indexNodes.length;++i)this._indexNodes[i].setColor(indexNodesColor)},getIndexNodesColor:function(){var locRealColor=this._indexNodesColor;return cc.color(locRealColor.r,locRealColor.g,locRealColor.b,locRealColor.a)},setIndexNodesScale:function(indexNodesScale){if(this._indexNodesScale!==indexNodesScale){this._indexNodesScale=indexNodesScale,this._currentIndexNode.setScale(indexNodesScale);for(var i=0;i<this._indexNodes.length;++i)this._indexNodes[i].setScale(this,_indexNodesScale);this._rearrange()}},getIndexNodesScale:function(){return this._indexNodesScale},setIndexNodesTexture:function(texName,texType){switch(void 0===texType&&(texType=ccui.Widget.LOCAL_TEXTURE),this._useDefaultTexture=!1,this._indexNodesTextureFile=texName,this._indexNodesTexType=texType,texType){case ccui.Widget.LOCAL_TEXTURE:this._currentIndexNode.setTexture(texName);for(i=0;i<this._indexNodes.length;++i)this._indexNodes[i].setTexture(texName);break;case ccui.Widget.PLIST_TEXTURE:this._currentIndexNode.setSpriteFrame(texName);for(var i=0;i<this._indexNodes.length;++i)this._indexNodes[i].setSpriteFrame(texName)}this._rearrange()},_increaseNumberOfPages:function(){var indexNode;if(this._useDefaultTexture)indexNode=ccui.helper._createSpriteFromBase64(ccui.PageViewIndicator.CIRCLE_IMAGE,ccui.PageViewIndicator.CIRCLE_IMAGE_KEY);else switch(indexNode=new cc.Sprite,this._indexNodesTexType){case ccui.Widget.LOCAL_TEXTURE:indexNode.initWithFile(this._indexNodesTextureFile);break;case ccui.Widget.PLIST_TEXTURE:indexNode.initWithSpriteFrameName(this._indexNodesTextureFile)}indexNode.setColor(this._indexNodesColor),indexNode.setScale(this._indexNodesScale),this.addProtectedChild(indexNode),this._indexNodes.push(indexNode)},_decreaseNumberOfPages:function(){0!==this._indexNodes.length&&(this.removeProtectedChild(this._indexNodes[0]),this._indexNodes.splice(0,1))},clear:function(){for(var i=0;i<this._indexNodes.length;++i)this.removeProtectedChild(this._indexNodes[i]);this._indexNodes.length=0,this._currentIndexNode.setVisible(!1)}}),(_p=ccui.PageViewIndicator.prototype).spaceBetweenIndexNodes,cc.defineGetterSetter(_p,"spaceBetweenIndexNodes",_p.getSpaceBetweenIndexNodes,_p.setSpaceBetweenIndexNodes),ccui.PageViewIndicator.SPACE_BETWEEN_INDEX_NODES_DEFAULT=23,ccui.PageViewIndicator.CIRCLE_IMAGE_KEY="/__circle_image",ccui.PageViewIndicator.CIRCLE_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAA8ElEQVRIx62VyRGCQBBF+6gWRCEmYDIQkhiBCgHhSclC8YqWzOV5oVzKAYZp3r1/9fpbxAIBMTsKrjx5cqVgR0wgLhCRUWOjJiPqD56xoaGPhpRZV/iSEy6crHmw5oIrF9b/lVeMofrJgjlnxlIy/wik+JB+mme8BExbBhm+5CJC2LE2LtSEQoyGWDioBA5CoRIohJtK4CYDxzNEM4GAugR1E9VjVC+SZpXvhCJCrjomESLvc17pDGX7bWmlh6UtpjPVCWy9zaJ0TD7qfm3pwERMz2trRVZk3K3BD/L34AY+dEDCniMVBkPFkT2J/b2/AIV+dRpFLOYoAAAAAElFTkSuQmCC",function(){if(ccui.ProtectedNode.CanvasRenderCmd){ccui.ScrollView.CanvasRenderCmd=function(renderable){this._layoutCmdCtor(renderable),this._dirty=!1};var proto=ccui.ScrollView.CanvasRenderCmd.prototype=Object.create(ccui.Layout.CanvasRenderCmd.prototype);proto.constructor=ccui.ScrollView.CanvasRenderCmd,proto.rendering=function(ctx){var i,len,currentID=this._node.__instanceId,locCmds=cc.renderer._cacheToCanvasCmds[currentID],scaleX=cc.view.getScaleX(),scaleY=cc.view.getScaleY(),context=ctx||cc._renderContext;for(context.computeRealOffsetY(),this._node.updateChildren(),i=0,len=locCmds.length;i<len;i++){var checkNode=locCmds[i]._node;checkNode instanceof ccui.ScrollView||(checkNode&&checkNode._parent&&!1===checkNode._parent._inViewRect||locCmds[i].rendering(context,scaleX,scaleY))}}}}(),function(){if(ccui.ProtectedNode.WebGLRenderCmd){ccui.ScrollView.WebGLRenderCmd=function(renderable){this._layoutCmdCtor(renderable),this._needDraw=!0,this._dirty=!1};var proto=ccui.ScrollView.WebGLRenderCmd.prototype=Object.create(ccui.Layout.WebGLRenderCmd.prototype);proto.constructor=ccui.ScrollView.WebGLRenderCmd,proto.rendering=function(ctx){var i,len,checkNode,cmd,currentID=this._node.__instanceId,locCmds=cc.renderer._cacheToBufferCmds[currentID],context=ctx||cc._renderContext;if(locCmds)for(this._node.updateChildren(),context.bindBuffer(gl.ARRAY_BUFFER,null),i=0,len=locCmds.length;i<len;i++)(checkNode=(cmd=locCmds[i])._node)&&checkNode._parent&&!1===checkNode._parent._inViewRect||(cmd.uploadData?cc.renderer._uploadBufferData(cmd):(cmd._batchingSize>0&&cc.renderer._batchRendering(),cmd.rendering(context)),cc.renderer._batchRendering())}}}();