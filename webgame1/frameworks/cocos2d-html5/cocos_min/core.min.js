var cc=cc||{};cc.defineGetterSetter=function(proto,prop,getter,setter,getterName,setterName){if(proto.__defineGetter__)getter&&proto.__defineGetter__(prop,getter),setter&&proto.__defineSetter__(prop,setter);else{if(!Object.defineProperty)throw new Error("browser does not support getters");var desc={enumerable:!1,configurable:!0};getter&&(desc.get=getter),setter&&(desc.set=setter),Object.defineProperty(proto,prop,desc)}if(!getterName&&!setterName)for(var hasGetter=null!=getter,hasSetter=null!=setter,props=Object.getOwnPropertyNames(proto),i=0;i<props.length;i++){var name=props[i];if((proto.__lookupGetter__?!proto.__lookupGetter__(name):!Object.getOwnPropertyDescriptor(proto,name))&&"function"==typeof proto[name]){var func=proto[name];if(hasGetter&&func===getter&&(getterName=name,!hasSetter||setterName))break;if(hasSetter&&func===setter&&(setterName=name,!hasGetter||getterName))break}}var ctor=proto.constructor;getterName&&(ctor.__getters__||(ctor.__getters__={}),ctor.__getters__[getterName]=prop),setterName&&(ctor.__setters__||(ctor.__setters__={}),ctor.__setters__[setterName]=prop)},cc.clone=function(obj){var newObj=obj.constructor?new obj.constructor:{};for(var key in obj){var copy=obj[key];"object"!=typeof copy||!copy||copy instanceof cc.Node||copy instanceof HTMLElement?newObj[key]=copy:newObj[key]=cc.clone(copy)}return newObj},cc.inject=function(srcPrototype,destPrototype){for(var key in srcPrototype)destPrototype[key]=srcPrototype[key]};var ClassManager={id:0|998*Math.random(),instanceId:0|998*Math.random(),getNewID:function(){return this.id++},getNewInstanceId:function(){return this.instanceId++}};!function(){var fnTest=/\b_super\b/;cc.Class=function(){},cc.Class.extend=function(props){var _super=this.prototype,prototype=Object.create(_super),desc={writable:!0,enumerable:!1,configurable:!0},Class;if(cc.game.config&&cc.game.config[cc.game.CONFIG_KEY.exposeClassName]){var constructor="(function "+(props._className||"Class")+" (arg0, arg1, arg2, arg3, arg4, arg5) {\n";constructor+="    this.__instanceId = ClassManager.getNewInstanceId();\n",constructor+="    if (this.ctor) {\n",constructor+="        switch (arguments.length) {\n",constructor+="        case 0: this.ctor(); break;\n",constructor+="        case 1: this.ctor(arg0); break;\n",constructor+="        case 3: this.ctor(arg0, arg1, arg2); break;\n",constructor+="        case 4: this.ctor(arg0, arg1, arg2, arg3); break;\n",constructor+="        case 5: this.ctor(arg0, arg1, arg2, arg3, arg4); break;\n",constructor+="        default: this.ctor.apply(this, arguments);\n",constructor+="        }\n",constructor+="    }\n",constructor+="})",Class=eval(constructor)}else Class=function(arg0,arg1,arg2,arg3,arg4){if(this.__instanceId=ClassManager.getNewInstanceId(),this.ctor)switch(arguments.length){case 0:this.ctor();break;case 1:this.ctor(arg0);break;case 2:this.ctor(arg0,arg1);break;case 3:this.ctor(arg0,arg1,arg2);break;case 4:this.ctor(arg0,arg1,arg2,arg3);break;case 5:this.ctor(arg0,arg1,arg2,arg3,arg4);break;default:this.ctor.apply(this,arguments)}};desc.value=ClassManager.getNewID(),Object.defineProperty(prototype,"__pid",desc),Class.prototype=prototype,desc.value=Class,Object.defineProperty(prototype,"constructor",desc),this.__getters__&&(Class.__getters__=cc.clone(this.__getters__)),this.__setters__&&(Class.__setters__=cc.clone(this.__setters__));for(var idx=0,li=arguments.length;idx<li;++idx){var prop=arguments[idx];for(var name in prop){var isFunc="function"==typeof prop[name],override="function"==typeof _super[name],hasSuperCall=fnTest.test(prop[name]);if(isFunc&&override&&hasSuperCall?(desc.value=function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);return this._super=tmp,ret}}(name,prop[name]),Object.defineProperty(prototype,name,desc)):isFunc?(desc.value=prop[name],Object.defineProperty(prototype,name,desc)):prototype[name]=prop[name],isFunc){var getter,setter,propertyName;if(this.__getters__&&this.__getters__[name]){for(var i in propertyName=this.__getters__[name],this.__setters__)if(this.__setters__[i]===propertyName){setter=i;break}cc.defineGetterSetter(prototype,propertyName,prop[name],prop[setter]?prop[setter]:prototype[setter],name,setter)}if(this.__setters__&&this.__setters__[name]){for(var i in propertyName=this.__setters__[name],this.__getters__)if(this.__getters__[i]===propertyName){getter=i;break}cc.defineGetterSetter(prototype,propertyName,prop[getter]?prop[getter]:prototype[getter],prop[name],getter,name)}}}}return Class.extend=cc.Class.extend,Class.implement=function(prop){for(var name in prop)prototype[name]=prop[name]},Class}}();var cc=cc||{};switch(cc._tmp=cc._tmp||{},cc.associateWithNative=function(jsObj,superclass){},cc.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},cc.FMT_JPG=0,cc.FMT_PNG=1,cc.FMT_TIFF=2,cc.FMT_RAWDATA=3,cc.FMT_WEBP=4,cc.FMT_UNKNOWN=5,cc.getImageFormatByData=function(imgData){return 8<imgData.length&&137===imgData[0]&&80===imgData[1]&&78===imgData[2]&&71===imgData[3]&&13===imgData[4]&&10===imgData[5]&&26===imgData[6]&&10===imgData[7]?cc.FMT_PNG:2<imgData.length&&(73===imgData[0]&&73===imgData[1]||77===imgData[0]&&77===imgData[1]||255===imgData[0]&&216===imgData[1])?cc.FMT_TIFF:cc.FMT_UNKNOWN},cc.Point=function(x,y){this.x=x||0,this.y=y||0},cc.p=function(x,y){return void 0===x?{x:0,y:0}:void 0===y?{x:x.x,y:x.y}:{x:x,y:y}},cc.pointEqualToPoint=function(point1,point2){return point1&&point2&&point1.x===point2.x&&point1.y===point2.y},cc.Size=function(width,height){this.width=width||0,this.height=height||0},cc.size=function(w,h){return void 0===w?{width:0,height:0}:void 0===h?{width:w.width,height:w.height}:{width:w,height:h}},cc.sizeEqualToSize=function(size1,size2){return size1&&size2&&size1.width===size2.width&&size1.height===size2.height},cc.Rect=function(x,y,width,height){this.x=x||0,this.y=y||0,this.width=width||0,this.height=height||0},cc.rect=function(x,y,w,h){return void 0===x?{x:0,y:0,width:0,height:0}:void 0===y?{x:x.x,y:x.y,width:x.width,height:x.height}:{x:x,y:y,width:w,height:h}},cc.rectEqualToRect=function(rect1,rect2){return rect1&&rect2&&rect1.x===rect2.x&&rect1.y===rect2.y&&rect1.width===rect2.width&&rect1.height===rect2.height},cc._rectEqualToZero=function(rect){return rect&&0===rect.x&&0===rect.y&&0===rect.width&&0===rect.height},cc.rectContainsRect=function(rect1,rect2){return!(!rect1||!rect2)&&!(rect1.x>=rect2.x||rect1.y>=rect2.y||rect1.x+rect1.width<=rect2.x+rect2.width||rect1.y+rect1.height<=rect2.y+rect2.height)},cc.rectGetMaxX=function(rect){return rect.x+rect.width},cc.rectGetMidX=function(rect){return rect.x+rect.width/2},cc.rectGetMinX=function(rect){return rect.x},cc.rectGetMaxY=function(rect){return rect.y+rect.height},cc.rectGetMidY=function(rect){return rect.y+rect.height/2},cc.rectGetMinY=function(rect){return rect.y},cc.rectContainsPoint=function(rect,point){return point.x>=cc.rectGetMinX(rect)&&point.x<=cc.rectGetMaxX(rect)&&point.y>=cc.rectGetMinY(rect)&&point.y<=cc.rectGetMaxY(rect)},cc.rectIntersectsRect=function(ra,rb){var maxax=ra.x+ra.width,maxay=ra.y+ra.height,maxbx=rb.x+rb.width,maxby=rb.y+rb.height;return!(maxax<rb.x||maxbx<ra.x||maxay<rb.y||maxby<ra.y)},cc.rectOverlapsRect=function(rectA,rectB){return!(rectA.x+rectA.width<rectB.x||rectB.x+rectB.width<rectA.x||rectA.y+rectA.height<rectB.y||rectB.y+rectB.height<rectA.y)},cc.rectUnion=function(rectA,rectB){var rect=cc.rect(0,0,0,0);return rect.x=Math.min(rectA.x,rectB.x),rect.y=Math.min(rectA.y,rectB.y),rect.width=Math.max(rectA.x+rectA.width,rectB.x+rectB.width)-rect.x,rect.height=Math.max(rectA.y+rectA.height,rectB.y+rectB.height)-rect.y,rect},cc.rectIntersection=function(rectA,rectB){var intersection=cc.rect(Math.max(cc.rectGetMinX(rectA),cc.rectGetMinX(rectB)),Math.max(cc.rectGetMinY(rectA),cc.rectGetMinY(rectB)),0,0);return intersection.width=Math.min(cc.rectGetMaxX(rectA),cc.rectGetMaxX(rectB))-cc.rectGetMinX(intersection),intersection.height=Math.min(cc.rectGetMaxY(rectA),cc.rectGetMaxY(rectB))-cc.rectGetMinY(intersection),intersection},cc.SAXParser=cc.Class.extend({_parser:null,_isSupportDOMParser:null,ctor:function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):this._isSupportDOMParser=!1},parse:function(xmlTxt){return this._parseXML(xmlTxt)},_parseXML:function(textxml){var xmlDoc;return this._isSupportDOMParser?xmlDoc=this._parser.parseFromString(textxml,"text/xml"):((xmlDoc=new ActiveXObject("Microsoft.XMLDOM")).async="false",xmlDoc.loadXML(textxml)),xmlDoc}}),cc.PlistParser=cc.SAXParser.extend({parse:function(xmlTxt){var xmlDoc=this._parseXML(xmlTxt),plist=xmlDoc.documentElement;if("plist"!==plist.tagName)return cc.warn("Not a plist file!"),{};for(var node=null,i=0,len=plist.childNodes.length;i<len&&1!==(node=plist.childNodes[i]).nodeType;i++);return xmlDoc=null,this._parseNode(node)},_parseNode:function(node){var data=null,tagName=node.tagName;if("dict"===tagName)data=this._parseDict(node);else if("array"===tagName)data=this._parseArray(node);else if("string"===tagName)if(1===node.childNodes.length)data=node.firstChild.nodeValue;else{data="";for(var i=0;i<node.childNodes.length;i++)data+=node.childNodes[i].nodeValue}else"false"===tagName?data=!1:"true"===tagName?data=!0:"real"===tagName?data=parseFloat(node.firstChild.nodeValue):"integer"===tagName&&(data=parseInt(node.firstChild.nodeValue,10));return data},_parseArray:function(node){for(var data=[],i=0,len=node.childNodes.length;i<len;i++){var child=node.childNodes[i];1===child.nodeType&&data.push(this._parseNode(child))}return data},_parseDict:function(node){for(var data={},key=null,i=0,len=node.childNodes.length;i<len;i++){var child=node.childNodes[i];1===child.nodeType&&("key"===child.tagName?key=child.firstChild.nodeValue:data[key]=this._parseNode(child))}return data}}),cc.saxParser=new cc.SAXParser,cc.plistParser=new cc.PlistParser,cc._txtLoader={load:function(realUrl,url,res,cb){cc.loader.loadTxt(realUrl,cb)}},cc.loader.register(["txt","xml","vsh","fsh","atlas","jbin","imx"],cc._txtLoader),cc._jsonLoader={load:function(realUrl,url,res,cb){cc.loader.loadJson(realUrl,cb)}},cc.loader.register(["json","ExportJson"],cc._jsonLoader),cc._jsLoader={load:function(realUrl,url,res,cb){cc.loader.loadJs(realUrl,cb)}},cc.loader.register(["js"],cc._jsLoader),cc._imgLoader={load:function(realUrl,url,res,cb){var callback;callback=cc.loader.isLoading(realUrl)?cb:function(err,img){if(err)return cb(err);cc.loader.cache[url]=img,cc.textureCache.handleLoadedTexture(url),cb(null,img)},cc.loader.loadImg(realUrl,callback)}},cc.loader.register(["png","jpg","bmp","jpeg","gif","ico","tiff","webp"],cc._imgLoader),cc._serverImgLoader={load:function(realUrl,url,res,cb){cc._imgLoader.load(res.src,url,res,cb)}},cc.loader.register(["serverImg"],cc._serverImgLoader),cc._plistLoader={load:function(realUrl,url,res,cb){cc.loader.loadTxt(realUrl,function(err,txt){if(err)return cb(err);cb(null,cc.plistParser.parse(txt))})}},cc.loader.register(["plist"],cc._plistLoader),cc._fontLoader={TYPE:{".eot":"embedded-opentype",".ttf":"truetype",".ttc":"truetype",".woff":"woff",".svg":"svg"},_loadFont:function(name,srcs,type){var doc=document,path=cc.path,TYPE=this.TYPE,fontStyle=document.createElement("style");fontStyle.type="text/css",doc.body.appendChild(fontStyle);var fontStr="";if(isNaN(name-0)?fontStr+="@font-face { font-family:"+name+"; src:":fontStr+="@font-face { font-family:'"+name+"'; src:",srcs instanceof Array)for(var i=0,li=srcs.length;i<li;i++){var src=srcs[i];type=path.extname(src).toLowerCase(),fontStr+="url('"+srcs[i]+"') format('"+TYPE[type]+"')",fontStr+=i===li-1?";":","}else fontStr+="url('"+srcs+"') format('"+TYPE[type=type.toLowerCase()]+"');";fontStyle.textContent+=fontStr+"}";var preloadDiv=document.createElement("div"),_divStyle=preloadDiv.style;_divStyle.fontFamily=name,preloadDiv.innerHTML=".",_divStyle.position="absolute",_divStyle.left="-100px",_divStyle.top="-100px",doc.body.appendChild(preloadDiv)},load:function(realUrl,url,res,cb){var type=res.type,name=res.name,srcs=res.srcs;cc.isString(res)?(type=cc.path.extname(res),name=cc.path.basename(res,type),this._loadFont(name,res,type)):this._loadFont(name,srcs),document.fonts?document.fonts.load("1em "+name).then(function(){cb(null,!0)},function(err){cb(err)}):cb(null,!0)}},cc.loader.register(["font","eot","ttf","woff","svg","ttc"],cc._fontLoader),cc._binaryLoader={load:function(realUrl,url,res,cb){cc.loader.loadBinary(realUrl,cb)}},cc._csbLoader={load:function(realUrl,url,res,cb){cc.loader.loadCsb(realUrl,cb)}},cc.loader.register(["csb"],cc._csbLoader),window.CocosEngine=cc.ENGINE_VERSION="Cocos2d-JS v3.14",cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL=0,cc.DIRECTOR_STATS_POSITION=cc.p(0,0),cc.DIRECTOR_FPS_INTERVAL=.5,cc.COCOSNODE_RENDER_SUBPIXEL=1,cc.SPRITEBATCHNODE_RENDER_SUBPIXEL=1,cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA=1,cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP=0,cc.TEXTURE_ATLAS_USE_VAO=0,cc.TEXTURE_NPOT_SUPPORT=0,cc.RETINA_DISPLAY_SUPPORT=1,cc.RETINA_DISPLAY_FILENAME_SUFFIX="-hd",cc.USE_LA88_LABELS=1,cc.SPRITE_DEBUG_DRAW=0,cc.SPRITEBATCHNODE_DEBUG_DRAW=0,cc.LABELBMFONT_DEBUG_DRAW=0,cc.LABELATLAS_DEBUG_DRAW=0,cc.DRAWNODE_TOTAL_VERTICES=2e4,cc.IS_RETINA_DISPLAY_SUPPORTED=0,cc.DEFAULT_ENGINE=cc.ENGINE_VERSION+"-canvas",cc.ENABLE_STACKABLE_ACTIONS=1,cc.ENABLE_GL_STATE_CACHE=1,cc.$=function(x){var parent=this===cc?document:this,el=x instanceof HTMLElement?x:parent.querySelector(x);return el&&(el.find=el.find||cc.$,el.hasClass=el.hasClass||function(cls){return this.className.match(new RegExp("(\\s|^)"+cls+"(\\s|$)"))},el.addClass=el.addClass||function(cls){return this.hasClass(cls)||(this.className&&(this.className+=" "),this.className+=cls),this},el.removeClass=el.removeClass||function(cls){return this.hasClass(cls)&&(this.className=this.className.replace(cls,"")),this},el.remove=el.remove||function(){return this.parentNode&&this.parentNode.removeChild(this),this},el.appendTo=el.appendTo||function(x){return x.appendChild(this),this},el.prependTo=el.prependTo||function(x){return x.childNodes[0]?x.insertBefore(this,x.childNodes[0]):x.appendChild(this),this},el.transforms=el.transforms||function(){return this.style[cc.$.trans]=cc.$.translate(this.position)+cc.$.rotate(this.rotation)+cc.$.scale(this.scale)+cc.$.skew(this.skew),this},el.position=el.position||{x:0,y:0},el.rotation=el.rotation||0,el.scale=el.scale||{x:1,y:1},el.skew=el.skew||{x:0,y:0},el.translates=function(x,y){return this.position.x=x,this.position.y=y,this.transforms(),this},el.rotate=function(x){return this.rotation=x,this.transforms(),this},el.resize=function(x,y){return this.scale.x=x,this.scale.y=y,this.transforms(),this},el.setSkew=function(x,y){return this.skew.x=x,this.skew.y=y,this.transforms(),this}),el},cc.sys.browserType){case cc.sys.BROWSER_TYPE_FIREFOX:cc.$.pfx="Moz",cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_CHROME:case cc.sys.BROWSER_TYPE_SAFARI:cc.$.pfx="webkit",cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_OPERA:cc.$.pfx="O",cc.$.hd=!1;break;case cc.sys.BROWSER_TYPE_IE:cc.$.pfx="ms",cc.$.hd=!1;break;default:cc.$.pfx="webkit",cc.$.hd=!0}cc.$.trans=cc.$.pfx+"Transform",cc.$.translate=cc.$.hd?function(a){return"translate3d("+a.x+"px, "+a.y+"px, 0) "}:function(a){return"translate("+a.x+"px, "+a.y+"px) "},cc.$.rotate=cc.$.hd?function(a){return"rotateZ("+a+"deg) "}:function(a){return"rotate("+a+"deg) "},cc.$.scale=function(a){return"scale("+a.x+", "+a.y+") "},cc.$.skew=function(a){return"skewX("+-a.x+"deg) skewY("+a.y+"deg)"},cc.$new=function(x){return cc.$(document.createElement(x))},cc.$.findpos=function(obj){for(var curleft=0,curtop=0;curleft+=obj.offsetLeft,curtop+=obj.offsetTop,obj=obj.offsetParent;);return{x:curleft,y:curtop}},cc.INVALID_INDEX=-1,cc.PI=Math.PI,cc.FLT_MAX=parseFloat("3.402823466e+38F"),cc.FLT_MIN=parseFloat("1.175494351e-38F"),cc.RAD=cc.PI/180,cc.DEG=180/cc.PI,cc.UINT_MAX=4294967295,cc.swap=function(x,y,ref){if(!cc.isObject(ref)||cc.isUndefined(ref.x)||cc.isUndefined(ref.y))cc.log(cc._LogInfos.swap);else{var tmp=ref[x];ref[x]=ref[y],ref[y]=tmp}},cc.lerp=function(a,b,r){return a+(b-a)*r},cc.rand=function(){return 16777215*Math.random()},cc.randomMinus1To1=function(){return 2*(Math.random()-.5)},cc.random0To1=Math.random,cc.degreesToRadians=function(angle){return angle*cc.RAD},cc.radiansToDegrees=function(angle){return angle*cc.DEG},cc.radiansToDegress=function(angle){return cc.log(cc._LogInfos.radiansToDegress),angle*cc.DEG},cc.REPEAT_FOREVER=Number.MAX_VALUE-1,cc.nodeDrawSetup=function(node){node._shaderProgram&&(node._shaderProgram.use(),node._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4())},cc.enableDefaultGLStates=function(){},cc.disableDefaultGLStates=function(){},cc.incrementGLDraws=function(addNumber){cc.g_NumberOfDraws+=addNumber},cc.FLT_EPSILON=1.192092896e-7,cc.contentScaleFactor=cc.IS_RETINA_DISPLAY_SUPPORTED?function(){return cc.director._contentScaleFactor}:function(){return 1},cc.pointPointsToPixels=function(points){var scale=cc.contentScaleFactor();return cc.p(points.x*scale,points.y*scale)},cc.pointPixelsToPoints=function(pixels){var scale=cc.contentScaleFactor();return cc.p(pixels.x/scale,pixels.y/scale)},cc._pointPixelsToPointsOut=function(pixels,outPoint){var scale=cc.contentScaleFactor();outPoint.x=pixels.x/scale,outPoint.y=pixels.y/scale},cc.sizePointsToPixels=function(sizeInPoints){var scale=cc.contentScaleFactor();return cc.size(sizeInPoints.width*scale,sizeInPoints.height*scale)},cc.sizePixelsToPoints=function(sizeInPixels){var scale=cc.contentScaleFactor();return cc.size(sizeInPixels.width/scale,sizeInPixels.height/scale)},cc._sizePixelsToPointsOut=function(sizeInPixels,outSize){var scale=cc.contentScaleFactor();outSize.width=sizeInPixels.width/scale,outSize.height=sizeInPixels.height/scale},cc.rectPixelsToPoints=cc.IS_RETINA_DISPLAY_SUPPORTED?function(pixel){var scale=cc.contentScaleFactor();return cc.rect(pixel.x/scale,pixel.y/scale,pixel.width/scale,pixel.height/scale)}:function(p){return p},cc.rectPointsToPixels=cc.IS_RETINA_DISPLAY_SUPPORTED?function(point){var scale=cc.contentScaleFactor();return cc.rect(point.x*scale,point.y*scale,point.width*scale,point.height*scale)}:function(p){return p},cc.ONE=1,cc.ZERO=0,cc.SRC_ALPHA=770,cc.SRC_ALPHA_SATURATE=776,cc.SRC_COLOR=768,cc.DST_ALPHA=772,cc.DST_COLOR=774,cc.ONE_MINUS_SRC_ALPHA=771,cc.ONE_MINUS_SRC_COLOR=769,cc.ONE_MINUS_DST_ALPHA=773,cc.ONE_MINUS_DST_COLOR=775,cc.ONE_MINUS_CONSTANT_ALPHA=32772,cc.ONE_MINUS_CONSTANT_COLOR=32770,cc.LINEAR=9729,cc.REPEAT=10497,cc.CLAMP_TO_EDGE=33071,cc.MIRRORED_REPEAT=33648,cc.BLEND_SRC=cc.SRC_ALPHA,cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA&&(cc.BLEND_SRC=cc.ONE)}),cc.BLEND_DST=cc.ONE_MINUS_SRC_ALPHA,cc.checkGLErrorDebug=function(){if(cc.renderMode===cc.game.RENDER_TYPE_WEBGL){var _error=cc._renderContext.getError();_error&&cc.log(cc._LogInfos.checkGLErrorDebug,_error)}},cc.ORIENTATION_PORTRAIT=1,cc.ORIENTATION_LANDSCAPE=2,cc.ORIENTATION_AUTO=3,cc.CONCURRENCY_HTTP_REQUEST_COUNT=(cc.sys.isMobile,20),cc.VERTEX_ATTRIB_FLAG_NONE=0,cc.VERTEX_ATTRIB_FLAG_POSITION=1,cc.VERTEX_ATTRIB_FLAG_COLOR=2,cc.VERTEX_ATTRIB_FLAG_TEX_COORDS=4,cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX=cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS,cc.GL_ALL=0,cc.VERTEX_ATTRIB_POSITION=0,cc.VERTEX_ATTRIB_COLOR=1,cc.VERTEX_ATTRIB_TEX_COORDS=2,cc.VERTEX_ATTRIB_MAX=7,cc.UNIFORM_PMATRIX=0,cc.UNIFORM_MVMATRIX=1,cc.UNIFORM_MVPMATRIX=2,cc.UNIFORM_TIME=3,cc.UNIFORM_SINTIME=4,cc.UNIFORM_COSTIME=5,cc.UNIFORM_RANDOM01=6,cc.UNIFORM_SAMPLER=7,cc.UNIFORM_MAX=8,cc.SHADER_POSITION_TEXTURECOLOR="ShaderPositionTextureColor",cc.SHADER_SPRITE_POSITION_TEXTURECOLOR="ShaderSpritePositionTextureColor",cc.SHADER_SPRITE_POSITION_TEXTURECOLOR_GRAY="ShaderSpritePositionTextureColorGray",cc.SHADER_POSITION_TEXTURECOLORALPHATEST="ShaderPositionTextureColorAlphaTest",cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST="ShaderSpritePositionTextureColorAlphaTest",cc.SHADER_POSITION_COLOR="ShaderPositionColor",cc.SHADER_SPRITE_POSITION_COLOR="ShaderSpritePositionColor",cc.SHADER_POSITION_TEXTURE="ShaderPositionTexture",cc.SHADER_POSITION_TEXTURE_UCOLOR="ShaderPositionTextureUColor",cc.SHADER_POSITION_TEXTUREA8COLOR="ShaderPositionTextureA8Color",cc.SHADER_POSITION_UCOLOR="ShaderPositionUColor",cc.SHADER_POSITION_LENGTHTEXTURECOLOR="ShaderPositionLengthTextureColor",cc.UNIFORM_PMATRIX_S="CC_PMatrix",cc.UNIFORM_MVMATRIX_S="CC_MVMatrix",cc.UNIFORM_MVPMATRIX_S="CC_MVPMatrix",cc.UNIFORM_TIME_S="CC_Time",cc.UNIFORM_SINTIME_S="CC_SinTime",cc.UNIFORM_COSTIME_S="CC_CosTime",cc.UNIFORM_RANDOM01_S="CC_Random01",cc.UNIFORM_SAMPLER_S="CC_Texture0",cc.UNIFORM_ALPHA_TEST_VALUE_S="CC_alpha_value",cc.ATTRIBUTE_NAME_COLOR="a_color",cc.ATTRIBUTE_NAME_POSITION="a_position",cc.ATTRIBUTE_NAME_TEX_COORD="a_texCoord",cc.ATTRIBUTE_NAME_MVMAT="a_mvMatrix",cc.ITEM_SIZE=32,cc.CURRENT_ITEM=3233828865,cc.ZOOM_ACTION_TAG=3233828866,cc.NORMAL_TAG=8801,cc.SELECTED_TAG=8802,cc.DISABLE_TAG=8803,cc.arrayVerifyType=function(arr,type){if(arr&&0<arr.length)for(var i=0;i<arr.length;i++)if(!(arr[i]instanceof type))return cc.log("element type is wrong!"),!1;return!0},cc.arrayRemoveObject=function(arr,delObj){for(var i=0,l=arr.length;i<l;i++)if(arr[i]===delObj){arr.splice(i,1);break}},cc.arrayRemoveArray=function(arr,minusArr){for(var i=0,l=minusArr.length;i<l;i++)cc.arrayRemoveObject(arr,minusArr[i])},cc.arrayAppendObjectsToIndex=function(arr,addObjs,index){return arr.splice.apply(arr,[index,0].concat(addObjs)),arr},cc.copyArray=function(arr){var i,len=arr.length,arr_clone=new Array(len);for(i=0;i<len;i+=1)arr_clone[i]=arr[i];return arr_clone},cc.Color=function(r,g,b,a){r=r||0,g=g||0,b=b||0,a=a||0,this._val=(r<<24>>>0)+(g<<16)+(b<<8)+a};var _p=cc.Color.prototype;_p._getR=function(){return(4278190080&this._val)>>>24},_p._setR=function(value){this._val=16777215&this._val|value<<24>>>0},_p._getG=function(){return(16711680&this._val)>>16},_p._setG=function(value){this._val=4278255615&this._val|value<<16},_p._getB=function(){return(65280&this._val)>>8},_p._setB=function(value){this._val=4294902015&this._val|value<<8},_p._getA=function(){return 255&this._val},_p._setA=function(value){this._val=4294967040&this._val|value},_p.r,cc.defineGetterSetter(_p,"r",_p._getR,_p._setR),_p.g,cc.defineGetterSetter(_p,"g",_p._getG,_p._setG),_p.b,cc.defineGetterSetter(_p,"b",_p._getB,_p._setB),_p.a,cc.defineGetterSetter(_p,"a",_p._getA,_p._setA),cc.color=function(r,g,b,a){return void 0===r?new cc.Color(0,0,0,255):"object"==typeof r?new cc.Color(r.r,r.g,r.b,null==r.a?255:r.a):"string"==typeof r?cc.hexToColor(r):new cc.Color(r,g,b,null==a?255:a)},cc.Color4B=function(r1,g1,b1,a1){this.r=0|r1,this.g=0|g1,this.b=0|b1,this.a=0|a1},cc.c4b=function(r,g,b,a){return new cc.Color4B(r,g,b,a)},cc.c4=cc.c4,cc.colorEqual=function(color1,color2){return color1.r===color2.r&&color1.g===color2.g&&color1.b===color2.b},cc.Acceleration=function(x,y,z,timestamp){this.x=x||0,this.y=y||0,this.z=z||0,this.timestamp=timestamp||0},cc.Vertex2F=function(x,y,arrayBuffer,offset){this._arrayBuffer=arrayBuffer||new ArrayBuffer(cc.Vertex2F.BYTES_PER_ELEMENT),this._offset=offset||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=x||0,this._view[1]=y||0},cc.Vertex2F.BYTES_PER_ELEMENT=8,_p=cc.Vertex2F.prototype,_p._getX=function(){return this._view[0]},_p._setX=function(xValue){this._view[0]=xValue},_p._getY=function(){return this._view[1]},_p._setY=function(yValue){this._view[1]=yValue},_p.x,cc.defineGetterSetter(_p,"x",_p._getX,_p._setX),_p.y,cc.defineGetterSetter(_p,"y",_p._getY,_p._setY),cc.Vertex3F=function(x,y,z,arrayBuffer,offset){this._arrayBuffer=arrayBuffer||new ArrayBuffer(cc.Vertex3F.BYTES_PER_ELEMENT),this._offset=offset||0;var locArrayBuffer=this._arrayBuffer,locOffset=this._offset;this._view=new Float32Array(locArrayBuffer,locOffset,3),this._view[0]=x||0,this._view[1]=y||0,this._view[2]=z||0},cc.Vertex3F.BYTES_PER_ELEMENT=12,_p=cc.Vertex3F.prototype,_p._getX=function(){return this._view[0]},_p._setX=function(xValue){this._view[0]=xValue},_p._getY=function(){return this._view[1]},_p._setY=function(yValue){this._view[1]=yValue},_p._getZ=function(){return this._view[2]},_p._setZ=function(zValue){this._view[2]=zValue},_p.x,cc.defineGetterSetter(_p,"x",_p._getX,_p._setX),_p.y,cc.defineGetterSetter(_p,"y",_p._getY,_p._setY),_p.z,cc.defineGetterSetter(_p,"z",_p._getZ,_p._setZ),cc.Tex2F=function(u,v,arrayBuffer,offset){this._arrayBuffer=arrayBuffer||new ArrayBuffer(cc.Tex2F.BYTES_PER_ELEMENT),this._offset=offset||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=u||0,this._view[1]=v||0},cc.Tex2F.BYTES_PER_ELEMENT=8,_p=cc.Tex2F.prototype,_p._getU=function(){return this._view[0]},_p._setU=function(xValue){this._view[0]=xValue},_p._getV=function(){return this._view[1]},_p._setV=function(yValue){this._view[1]=yValue},_p.u,cc.defineGetterSetter(_p,"u",_p._getU,_p._setU),_p.v,cc.defineGetterSetter(_p,"v",_p._getV,_p._setV),cc.Quad2=function(tl,tr,bl,br,arrayBuffer,offset){this._arrayBuffer=arrayBuffer||new ArrayBuffer(cc.Quad2.BYTES_PER_ELEMENT),this._offset=offset||0;var locArrayBuffer=this._arrayBuffer,locOffset=this._offset,locElementLen=cc.Vertex2F.BYTES_PER_ELEMENT;this._tl=tl?new cc.Vertex2F(tl.x,tl.y,locArrayBuffer,locOffset):new cc.Vertex2F(0,0,locArrayBuffer,locOffset),locOffset+=locElementLen,this._tr=tr?new cc.Vertex2F(tr.x,tr.y,locArrayBuffer,locOffset):new cc.Vertex2F(0,0,locArrayBuffer,locOffset),locOffset+=locElementLen,this._bl=bl?new cc.Vertex2F(bl.x,bl.y,locArrayBuffer,locOffset):new cc.Vertex2F(0,0,locArrayBuffer,locOffset),locOffset+=locElementLen,this._br=br?new cc.Vertex2F(br.x,br.y,locArrayBuffer,locOffset):new cc.Vertex2F(0,0,locArrayBuffer,locOffset)},cc.Quad2.BYTES_PER_ELEMENT=32,_p=cc.Quad2.prototype,_p._getTL=function(){return this._tl},_p._setTL=function(tlValue){this._tl._view[0]=tlValue.x,this._tl._view[1]=tlValue.y},_p._getTR=function(){return this._tr},_p._setTR=function(trValue){this._tr._view[0]=trValue.x,this._tr._view[1]=trValue.y},_p._getBL=function(){return this._bl},_p._setBL=function(blValue){this._bl._view[0]=blValue.x,this._bl._view[1]=blValue.y},_p._getBR=function(){return this._br},_p._setBR=function(brValue){this._br._view[0]=brValue.x,this._br._view[1]=brValue.y},_p.tl,cc.defineGetterSetter(_p,"tl",_p._getTL,_p._setTL),_p.tr,cc.defineGetterSetter(_p,"tr",_p._getTR,_p._setTR),_p.bl,cc.defineGetterSetter(_p,"bl",_p._getBL,_p._setBL),_p.br,cc.defineGetterSetter(_p,"br",_p._getBR,_p._setBR),cc.Quad3=function(bl,br,tl,tr,arrayBuffer,offset){this._arrayBuffer=arrayBuffer||new ArrayBuffer(cc.Quad3.BYTES_PER_ELEMENT),this._offset=offset||0;var locArrayBuffer=this._arrayBuffer,locOffset=this._offset,locElementLen=cc.Vertex3F.BYTES_PER_ELEMENT;this.bl=bl?new cc.Vertex3F(bl.x,bl.y,bl.z,locArrayBuffer,locOffset):new cc.Vertex3F(0,0,0,locArrayBuffer,locOffset),locOffset+=locElementLen,this.br=br?new cc.Vertex3F(br.x,br.y,br.z,locArrayBuffer,locOffset):new cc.Vertex3F(0,0,0,locArrayBuffer,locOffset),locOffset+=locElementLen,this.tl=tl?new cc.Vertex3F(tl.x,tl.y,tl.z,locArrayBuffer,locOffset):new cc.Vertex3F(0,0,0,locArrayBuffer,locOffset),locOffset+=locElementLen,this.tr=tr?new cc.Vertex3F(tr.x,tr.y,tr.z,locArrayBuffer,locOffset):new cc.Vertex3F(0,0,0,locArrayBuffer,locOffset)},cc.Quad3.BYTES_PER_ELEMENT=48,cc.V3F_C4B_T2F=function(vertices,colors,texCoords,arrayBuffer,offset){this._arrayBuffer=arrayBuffer||new ArrayBuffer(cc.V3F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=offset||0;var locArrayBuffer=this._arrayBuffer,locOffset=this._offset;this._vertices=vertices?new cc.Vertex3F(vertices.x,vertices.y,vertices.z,locArrayBuffer,locOffset):new cc.Vertex3F(0,0,0,locArrayBuffer,locOffset),locOffset+=cc.Vertex3F.BYTES_PER_ELEMENT,this._colors=colors?new cc._WebGLColor(colors.r,colors.g,colors.b,colors.a,locArrayBuffer,locOffset):new cc._WebGLColor(0,0,0,0,locArrayBuffer,locOffset),locOffset+=cc._WebGLColor.BYTES_PER_ELEMENT,this._texCoords=texCoords?new cc.Tex2F(texCoords.u,texCoords.v,locArrayBuffer,locOffset):new cc.Tex2F(0,0,locArrayBuffer,locOffset)},cc.V3F_C4B_T2F.BYTES_PER_ELEMENT=24,_p=cc.V3F_C4B_T2F.prototype,_p._getVertices=function(){return this._vertices},_p._setVertices=function(verticesValue){var locVertices=this._vertices;locVertices._view[0]=verticesValue.x,locVertices._view[1]=verticesValue.y,locVertices._view[2]=verticesValue.z},_p._getColor=function(){return this._colors},_p._setColor=function(colorValue){var locColors=this._colors;locColors._view[0]=colorValue.r,locColors._view[1]=colorValue.g,locColors._view[2]=colorValue.b,locColors._view[3]=colorValue.a},_p._getTexCoords=function(){return this._texCoords},_p._setTexCoords=function(texValue){this._texCoords._view[0]=texValue.u,this._texCoords._view[1]=texValue.v},_p.vertices,cc.defineGetterSetter(_p,"vertices",_p._getVertices,_p._setVertices),_p.colors,cc.defineGetterSetter(_p,"colors",_p._getColor,_p._setColor),_p.texCoords,cc.defineGetterSetter(_p,"texCoords",_p._getTexCoords,_p._setTexCoords),cc.V3F_C4B_T2F_Quad=function(tl,bl,tr,br,arrayBuffer,offset){this._arrayBuffer=arrayBuffer||new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),this._offset=offset||0;var locArrayBuffer=this._arrayBuffer,locOffset=this._offset,locElementLen=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._tl=tl?new cc.V3F_C4B_T2F(tl.vertices,tl.colors,tl.texCoords,locArrayBuffer,locOffset):new cc.V3F_C4B_T2F(null,null,null,locArrayBuffer,locOffset),locOffset+=locElementLen,this._bl=bl?new cc.V3F_C4B_T2F(bl.vertices,bl.colors,bl.texCoords,locArrayBuffer,locOffset):new cc.V3F_C4B_T2F(null,null,null,locArrayBuffer,locOffset),locOffset+=locElementLen,this._tr=tr?new cc.V3F_C4B_T2F(tr.vertices,tr.colors,tr.texCoords,locArrayBuffer,locOffset):new cc.V3F_C4B_T2F(null,null,null,locArrayBuffer,locOffset),locOffset+=locElementLen,this._br=br?new cc.V3F_C4B_T2F(br.vertices,br.colors,br.texCoords,locArrayBuffer,locOffset):new cc.V3F_C4B_T2F(null,null,null,locArrayBuffer,locOffset)},cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT=96,_p=cc.V3F_C4B_T2F_Quad.prototype,_p._getTL=function(){return this._tl},_p._setTL=function(tlValue){var locTl=this._tl;locTl.vertices=tlValue.vertices,locTl.colors=tlValue.colors,locTl.texCoords=tlValue.texCoords},_p._getBL=function(){return this._bl},_p._setBL=function(blValue){var locBl=this._bl;locBl.vertices=blValue.vertices,locBl.colors=blValue.colors,locBl.texCoords=blValue.texCoords},_p._getTR=function(){return this._tr},_p._setTR=function(trValue){var locTr=this._tr;locTr.vertices=trValue.vertices,locTr.colors=trValue.colors,locTr.texCoords=trValue.texCoords},_p._getBR=function(){return this._br},_p._setBR=function(brValue){var locBr=this._br;locBr.vertices=brValue.vertices,locBr.colors=brValue.colors,locBr.texCoords=brValue.texCoords},_p._getArrayBuffer=function(){return this._arrayBuffer},_p.tl,cc.defineGetterSetter(_p,"tl",_p._getTL,_p._setTL),_p.tr,cc.defineGetterSetter(_p,"tr",_p._getTR,_p._setTR),_p.bl,cc.defineGetterSetter(_p,"bl",_p._getBL,_p._setBL),_p.br,cc.defineGetterSetter(_p,"br",_p._getBR,_p._setBR),_p.arrayBuffer,cc.defineGetterSetter(_p,"arrayBuffer",_p._getArrayBuffer,null),cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad},cc.V3F_C4B_T2F_QuadCopy=function(sourceQuad){if(!sourceQuad)return cc.V3F_C4B_T2F_QuadZero();var srcTL=sourceQuad.tl,srcBL=sourceQuad.bl,srcTR=sourceQuad.tr,srcBR=sourceQuad.br;return{tl:{vertices:{x:srcTL.vertices.x,y:srcTL.vertices.y,z:srcTL.vertices.z},colors:{r:srcTL.colors.r,g:srcTL.colors.g,b:srcTL.colors.b,a:srcTL.colors.a},texCoords:{u:srcTL.texCoords.u,v:srcTL.texCoords.v}},bl:{vertices:{x:srcBL.vertices.x,y:srcBL.vertices.y,z:srcBL.vertices.z},colors:{r:srcBL.colors.r,g:srcBL.colors.g,b:srcBL.colors.b,a:srcBL.colors.a},texCoords:{u:srcBL.texCoords.u,v:srcBL.texCoords.v}},tr:{vertices:{x:srcTR.vertices.x,y:srcTR.vertices.y,z:srcTR.vertices.z},colors:{r:srcTR.colors.r,g:srcTR.colors.g,b:srcTR.colors.b,a:srcTR.colors.a},texCoords:{u:srcTR.texCoords.u,v:srcTR.texCoords.v}},br:{vertices:{x:srcBR.vertices.x,y:srcBR.vertices.y,z:srcBR.vertices.z},colors:{r:srcBR.colors.r,g:srcBR.colors.g,b:srcBR.colors.b,a:srcBR.colors.a},texCoords:{u:srcBR.texCoords.u,v:srcBR.texCoords.v}}}},cc.V3F_C4B_T2F_QuadsCopy=function(sourceQuads){if(!sourceQuads)return[];for(var retArr=[],i=0;i<sourceQuads.length;i++)retArr.push(cc.V3F_C4B_T2F_QuadCopy(sourceQuads[i]));return retArr},cc.V2F_C4B_T2F=function(vertices,colors,texCoords,arrayBuffer,offset){this._arrayBuffer=arrayBuffer||new ArrayBuffer(cc.V2F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=offset||0;var locArrayBuffer=this._arrayBuffer,locOffset=this._offset;this._vertices=vertices?new cc.Vertex2F(vertices.x,vertices.y,locArrayBuffer,locOffset):new cc.Vertex2F(0,0,locArrayBuffer,locOffset),locOffset+=cc.Vertex2F.BYTES_PER_ELEMENT,this._colors=colors?new cc._WebGLColor(colors.r,colors.g,colors.b,colors.a,locArrayBuffer,locOffset):new cc._WebGLColor(0,0,0,0,locArrayBuffer,locOffset),locOffset+=cc._WebGLColor.BYTES_PER_ELEMENT,this._texCoords=texCoords?new cc.Tex2F(texCoords.u,texCoords.v,locArrayBuffer,locOffset):new cc.Tex2F(0,0,locArrayBuffer,locOffset)},cc.V2F_C4B_T2F.BYTES_PER_ELEMENT=20,_p=cc.V2F_C4B_T2F.prototype,_p._getVertices=function(){return this._vertices},_p._setVertices=function(verticesValue){this._vertices._view[0]=verticesValue.x,this._vertices._view[1]=verticesValue.y},_p._getColor=function(){return this._colors},_p._setColor=function(colorValue){var locColors=this._colors;locColors._view[0]=colorValue.r,locColors._view[1]=colorValue.g,locColors._view[2]=colorValue.b,locColors._view[3]=colorValue.a},_p._getTexCoords=function(){return this._texCoords},_p._setTexCoords=function(texValue){this._texCoords._view[0]=texValue.u,this._texCoords._view[1]=texValue.v},_p.vertices,cc.defineGetterSetter(_p,"vertices",_p._getVertices,_p._setVertices),_p.colors,cc.defineGetterSetter(_p,"colors",_p._getColor,_p._setColor),_p.texCoords,cc.defineGetterSetter(_p,"texCoords",_p._getTexCoords,_p._setTexCoords),cc.V2F_C4B_T2F_Triangle=function(a,b,c,arrayBuffer,offset){this._arrayBuffer=arrayBuffer||new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT),this._offset=offset||0;var locArrayBuffer=this._arrayBuffer,locOffset=this._offset,locElementLen=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._a=a?new cc.V2F_C4B_T2F(a.vertices,a.colors,a.texCoords,locArrayBuffer,locOffset):new cc.V2F_C4B_T2F(null,null,null,locArrayBuffer,locOffset),locOffset+=locElementLen,this._b=b?new cc.V2F_C4B_T2F(b.vertices,b.colors,b.texCoords,locArrayBuffer,locOffset):new cc.V2F_C4B_T2F(null,null,null,locArrayBuffer,locOffset),locOffset+=locElementLen,this._c=c?new cc.V2F_C4B_T2F(c.vertices,c.colors,c.texCoords,locArrayBuffer,locOffset):new cc.V2F_C4B_T2F(null,null,null,locArrayBuffer,locOffset)},cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT=60,_p=cc.V2F_C4B_T2F_Triangle.prototype,_p._getA=function(){return this._a},_p._setA=function(aValue){var locA=this._a;locA.vertices=aValue.vertices,locA.colors=aValue.colors,locA.texCoords=aValue.texCoords},_p._getB=function(){return this._b},_p._setB=function(bValue){var locB=this._b;locB.vertices=bValue.vertices,locB.colors=bValue.colors,locB.texCoords=bValue.texCoords},_p._getC=function(){return this._c},_p._setC=function(cValue){var locC=this._c;locC.vertices=cValue.vertices,locC.colors=cValue.colors,locC.texCoords=cValue.texCoords},_p.a,cc.defineGetterSetter(_p,"a",_p._getA,_p._setA),_p.b,cc.defineGetterSetter(_p,"b",_p._getB,_p._setB),_p.c,cc.defineGetterSetter(_p,"c",_p._getC,_p._setC),cc.vertex2=function(x,y){return new cc.Vertex2F(x,y)},cc.vertex3=function(x,y,z){return new cc.Vertex3F(x,y,z)},cc.tex2=function(u,v){return new cc.Tex2F(u,v)},cc.BlendFunc=function(src1,dst1){this.src=src1,this.dst=dst1},cc.blendFuncDisable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)},cc.hexToColor=function(hex){hex=hex.replace(/^#?/,"0x");var c=parseInt(hex),r=c>>16,g=(c>>8)%256,b=c%256;return new cc.Color(r,g,b)},cc.colorToHex=function(color){var hR=color.r.toString(16),hG=color.g.toString(16),hB=color.b.toString(16);return"#"+(color.r<16?"0"+hR:hR)+(color.g<16?"0"+hG:hG)+(color.b<16?"0"+hB:hB)},cc.TEXT_ALIGNMENT_LEFT=0,cc.TEXT_ALIGNMENT_CENTER=1,cc.TEXT_ALIGNMENT_RIGHT=2,cc.VERTICAL_TEXT_ALIGNMENT_TOP=0,cc.VERTICAL_TEXT_ALIGNMENT_CENTER=1,cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM=2,cc._Dictionary=cc.Class.extend({_keyMapTb:null,_valueMapTb:null,__currId:0,ctor:function(){this._keyMapTb={},this._valueMapTb={},this.__currId=2<<(0|10*Math.random())},__getKey:function(){return this.__currId++,"key_"+this.__currId},setObject:function(value,key){if(null!=key){var keyId=this.__getKey();this._keyMapTb[keyId]=key,this._valueMapTb[keyId]=value}},objectForKey:function(key){if(null==key)return null;var locKeyMapTb=this._keyMapTb;for(var keyId in locKeyMapTb)if(locKeyMapTb[keyId]===key)return this._valueMapTb[keyId];return null},valueForKey:function(key){return this.objectForKey(key)},removeObjectForKey:function(key){if(null!=key){var locKeyMapTb=this._keyMapTb;for(var keyId in locKeyMapTb)if(locKeyMapTb[keyId]===key)return delete this._valueMapTb[keyId],void delete locKeyMapTb[keyId]}},removeObjectsForKeys:function(keys){if(null!=keys)for(var i=0;i<keys.length;i++)this.removeObjectForKey(keys[i])},allKeys:function(){var keyArr=[],locKeyMapTb=this._keyMapTb;for(var key in locKeyMapTb)keyArr.push(locKeyMapTb[key]);return keyArr},removeAllObjects:function(){this._keyMapTb={},this._valueMapTb={}},count:function(){return this.allKeys().length}}),cc.FontDefinition=function(properties){var _t=this;if(_t.fontName="Arial",_t.fontSize=12,_t.textAlign=cc.TEXT_ALIGNMENT_CENTER,_t.verticalAlign=cc.VERTICAL_TEXT_ALIGNMENT_TOP,_t.fillStyle=cc.color(255,255,255,255),_t.boundingWidth=0,_t.boundingHeight=0,_t.strokeEnabled=!1,_t.strokeStyle=cc.color(255,255,255,255),_t.lineWidth=1,_t.lineHeight="normal",_t.fontStyle="normal",_t.fontWeight="normal",_t.shadowEnabled=!1,_t.shadowOffsetX=0,_t.shadowOffsetY=0,_t.shadowBlur=0,_t.shadowOpacity=1,properties&&properties instanceof Object)for(var key in properties)_t[key]=properties[key]},cc.FontDefinition.prototype._getCanvasFontStr=function(){var lineHeight=this.lineHeight.charAt?this.lineHeight:this.lineHeight+"px";return this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px/"+lineHeight+" '"+this.fontName+"'"},cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc._WebGLColor=function(r,g,b,a,arrayBuffer,offset){this._arrayBuffer=arrayBuffer||new ArrayBuffer(cc._WebGLColor.BYTES_PER_ELEMENT),this._offset=offset||0;var locArrayBuffer=this._arrayBuffer,locOffset=this._offset;this._view=new Uint8Array(locArrayBuffer,locOffset,4),this._view[0]=r||0,this._view[1]=g||0,this._view[2]=b||0,this._view[3]=null==a?255:a,void 0===a&&(this.a_undefined=!0)},cc._WebGLColor.BYTES_PER_ELEMENT=4,(_p=cc._WebGLColor.prototype)._getR=function(){return this._view[0]},_p._setR=function(value){this._view[0]=value<0?0:value},_p._getG=function(){return this._view[1]},_p._setG=function(value){this._view[1]=value<0?0:value},_p._getB=function(){return this._view[2]},_p._setB=function(value){this._view[2]=value<0?0:value},_p._getA=function(){return this._view[3]},_p._setA=function(value){this._view[3]=value<0?0:value},cc.defineGetterSetter(_p,"r",_p._getR,_p._setR),cc.defineGetterSetter(_p,"g",_p._getG,_p._setG),cc.defineGetterSetter(_p,"b",_p._getB,_p._setB),cc.defineGetterSetter(_p,"a",_p._getA,_p._setA))}),_p=cc.color,_p._getWhite=function(){return cc.color(255,255,255)},_p._getYellow=function(){return cc.color(255,255,0)},_p._getBlue=function(){return cc.color(0,0,255)},_p._getGreen=function(){return cc.color(0,255,0)},_p._getRed=function(){return cc.color(255,0,0)},_p._getMagenta=function(){return cc.color(255,0,255)},_p._getBlack=function(){return cc.color(0,0,0)},_p._getOrange=function(){return cc.color(255,127,0)},_p._getGray=function(){return cc.color(166,166,166)},_p.WHITE,cc.defineGetterSetter(_p,"WHITE",_p._getWhite),_p.YELLOW,cc.defineGetterSetter(_p,"YELLOW",_p._getYellow),_p.BLUE,cc.defineGetterSetter(_p,"BLUE",_p._getBlue),_p.GREEN,cc.defineGetterSetter(_p,"GREEN",_p._getGreen),_p.RED,cc.defineGetterSetter(_p,"RED",_p._getRed),_p.MAGENTA,cc.defineGetterSetter(_p,"MAGENTA",_p._getMagenta),_p.BLACK,cc.defineGetterSetter(_p,"BLACK",_p._getBlack),_p.ORANGE,cc.defineGetterSetter(_p,"ORANGE",_p._getOrange),_p.GRAY,cc.defineGetterSetter(_p,"GRAY",_p._getGray),cc.BlendFunc._disable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)},cc.BlendFunc._alphaPremultiplied=function(){return new cc.BlendFunc(cc.ONE,cc.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._alphaNonPremultiplied=function(){return new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._additive=function(){return new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE)},cc.BlendFunc.DISABLE,cc.defineGetterSetter(cc.BlendFunc,"DISABLE",cc.BlendFunc._disable),cc.BlendFunc.ALPHA_PREMULTIPLIED,cc.defineGetterSetter(cc.BlendFunc,"ALPHA_PREMULTIPLIED",cc.BlendFunc._alphaPremultiplied),cc.BlendFunc.ALPHA_NON_PREMULTIPLIED,cc.defineGetterSetter(cc.BlendFunc,"ALPHA_NON_PREMULTIPLIED",cc.BlendFunc._alphaNonPremultiplied),cc.BlendFunc.ADDITIVE,cc.defineGetterSetter(cc.BlendFunc,"ADDITIVE",cc.BlendFunc._additive),cc.Touches=[],cc.TouchesIntergerDict={},cc.DENSITYDPI_DEVICE="device-dpi",cc.DENSITYDPI_HIGH="high-dpi",cc.DENSITYDPI_MEDIUM="medium-dpi",cc.DENSITYDPI_LOW="low-dpi";var __BrowserGetter={init:function(){this.html=document.getElementsByTagName("html")[0]},availWidth:function(frame){return frame&&frame!==this.html?frame.clientWidth:window.innerWidth},availHeight:function(frame){return frame&&frame!==this.html?frame.clientHeight:window.innerHeight},meta:{width:"device-width"},adaptationType:cc.sys.browserType};switch(-1<window.navigator.userAgent.indexOf("OS 8_1_")&&(__BrowserGetter.adaptationType=cc.sys.BROWSER_TYPE_MIUI),cc.sys.os===cc.sys.OS_IOS&&(__BrowserGetter.adaptationType=cc.sys.BROWSER_TYPE_SAFARI),__BrowserGetter.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:__BrowserGetter.meta["minimal-ui"]="true",__BrowserGetter.availWidth=function(frame){return frame.clientWidth},__BrowserGetter.availHeight=function(frame){return frame.clientHeight};break;case cc.sys.BROWSER_TYPE_CHROME:__BrowserGetter.__defineGetter__("target-densitydpi",function(){return cc.view._targetDensityDPI});case cc.sys.BROWSER_TYPE_SOUGOU:case cc.sys.BROWSER_TYPE_UC:__BrowserGetter.availWidth=function(frame){return frame.clientWidth},__BrowserGetter.availHeight=function(frame){return frame.clientHeight};break;case cc.sys.BROWSER_TYPE_MIUI:__BrowserGetter.init=function(view){if(!view.__resizeWithBrowserSize){var resize=function(){view.setDesignResolutionSize(view._designResolutionSize.width,view._designResolutionSize.height,view._resolutionPolicy),window.removeEventListener("resize",resize,!1)};window.addEventListener("resize",resize,!1)}}}var _scissorRect=null;cc.EGLView=cc.Class.extend({_delegate:null,_frameSize:null,_designResolutionSize:null,_originalDesignResolutionSize:null,_viewPortRect:null,_visibleRect:null,_retinaEnabled:!1,_autoFullScreen:!1,_devicePixelRatio:1,_viewName:"",_resizeCallback:null,_orientationChanging:!0,_scaleX:1,_originalScaleX:1,_scaleY:1,_originalScaleY:1,_isRotated:!1,_orientation:3,_resolutionPolicy:null,_rpExactFit:null,_rpShowAll:null,_rpNoBorder:null,_rpFixedHeight:null,_rpFixedWidth:null,_initialized:!1,_contentTranslateLeftTop:null,_frame:null,_frameZoomFactor:1,__resizeWithBrowserSize:!1,_isAdjustViewPort:!0,_targetDensityDPI:null,ctor:function(){var _t=this,d=document,_strategyer=cc.ContainerStrategy,_strategy=cc.ContentStrategy;__BrowserGetter.init(this),_t._frame=cc.container.parentNode===d.body?d.documentElement:cc.container.parentNode,_t._frameSize=cc.size(0,0),_t._initFrameSize();var w=cc._canvas.width,h=cc._canvas.height;_t._designResolutionSize=cc.size(w,h),_t._originalDesignResolutionSize=cc.size(w,h),_t._viewPortRect=cc.rect(0,0,w,h),_t._visibleRect=cc.rect(0,0,w,h),_t._contentTranslateLeftTop={left:0,top:0},_t._viewName="Cocos2dHTML5";var sys=cc.sys;_t.enableRetina(sys.os===sys.OS_IOS||sys.os===sys.OS_OSX),_t.enableAutoFullScreen(sys.isMobile&&sys.browserType!==sys.BROWSER_TYPE_BAIDU),cc.visibleRect&&cc.visibleRect.init(_t._visibleRect),_t._rpExactFit=new cc.ResolutionPolicy(_strategyer.EQUAL_TO_FRAME,_strategy.EXACT_FIT),_t._rpShowAll=new cc.ResolutionPolicy(_strategyer.PROPORTION_TO_FRAME,_strategy.SHOW_ALL),_t._rpNoBorder=new cc.ResolutionPolicy(_strategyer.EQUAL_TO_FRAME,_strategy.NO_BORDER),_t._rpFixedHeight=new cc.ResolutionPolicy(_strategyer.EQUAL_TO_FRAME,_strategy.FIXED_HEIGHT),_t._rpFixedWidth=new cc.ResolutionPolicy(_strategyer.EQUAL_TO_FRAME,_strategy.FIXED_WIDTH),_t._targetDensityDPI=cc.DENSITYDPI_HIGH},_resizeEvent:function(){var view,prevFrameW=(view=this.setDesignResolutionSize?this:cc.view)._frameSize.width,prevFrameH=view._frameSize.height,prevRotated=view._isRotated;if(view._initFrameSize(),view._isRotated!==prevRotated||view._frameSize.width!==prevFrameW||view._frameSize.height!==prevFrameH){var width=view._originalDesignResolutionSize.width,height=view._originalDesignResolutionSize.height;0<width&&view.setDesignResolutionSize(width,height,view._resolutionPolicy),cc.eventManager.dispatchCustomEvent("canvas-resize"),view._resizeCallback&&view._resizeCallback.call()}},_orientationChange:function(){cc.view._orientationChanging=!0,cc.view._resizeEvent()},setTargetDensityDPI:function(densityDPI){this._targetDensityDPI=densityDPI,this._adjustViewportMeta()},getTargetDensityDPI:function(){return this._targetDensityDPI},resizeWithBrowserSize:function(enabled){enabled?this.__resizeWithBrowserSize||(this.__resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._orientationChange)):this.__resizeWithBrowserSize&&(this.__resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._orientationChange))},setResizeCallback:function(callback){"function"!=typeof callback&&null!=callback||(this._resizeCallback=callback)},setOrientation:function(orientation){if((orientation&=cc.ORIENTATION_AUTO)&&this._orientation!==orientation){this._orientation=orientation;var designWidth=this._originalDesignResolutionSize.width,designHeight=this._originalDesignResolutionSize.height;this.setDesignResolutionSize(designWidth,designHeight,this._resolutionPolicy)}},setDocumentPixelWidth:function(width){this._setViewportMeta({width:width},!0),document.documentElement.style.width=width+"px",document.body.style.width="100%",this.setDesignResolutionSize(this._designResolutionSize.width,this._designResolutionSize.height,this._resolutionPolicy)},_initFrameSize:function(){if(1==SP_MODE){var locFrameSize=this._frameSize,w=__BrowserGetter.availWidth(this._frame),isLandscape=(h=__BrowserGetter.availHeight(this._frame))<=w;window.orientation;locFrameSize.height=(locFrameSize.width=w,h),cc.container.style["-webkit-transform"]="rotate(0deg)",cc.container.style.transform="rotate(0deg)",this._isRotated=!1}else{var h;locFrameSize=this._frameSize,w=__BrowserGetter.availWidth(this._frame),isLandscape=(h=__BrowserGetter.availHeight(this._frame))<=w;!this._orientationChanging||!cc.sys.isMobile||isLandscape&&this._orientation&cc.ORIENTATION_LANDSCAPE||!isLandscape&&this._orientation&cc.ORIENTATION_PORTRAIT?(locFrameSize.width=w,locFrameSize.height=h,cc.container.style["-webkit-transform"]="rotate(0deg)",cc.container.style.transform="rotate(0deg)",this._isRotated=!1):(locFrameSize.width=h,locFrameSize.height=w,cc.container.style["-webkit-transform"]="rotate(90deg)",cc.container.style.transform="rotate(90deg)",cc.container.style["-webkit-transform-origin"]="0px 0px 0px",cc.container.style.transformOrigin="0px 0px 0px",cc.container.style.offsetLeft=-h,this._isRotated=!0),setTimeout(function(){cc.view._orientationChanging=!1},1e3)}},_adjustSizeKeepCanvasSize:function(){var designWidth=this._originalDesignResolutionSize.width,designHeight=this._originalDesignResolutionSize.height;0<designWidth&&this.setDesignResolutionSize(designWidth,designHeight,this._resolutionPolicy)},_setViewportMeta:function(metas,overwrite){var vp=document.getElementById("cocosMetaElement");vp&&overwrite&&document.head.removeChild(vp);var content,key,pattern,elems=document.getElementsByName("viewport"),currentVP=elems?elems[0]:null;for(key in content=currentVP?currentVP.content:"",(vp=vp||document.createElement("meta")).id="cocosMetaElement",vp.name="viewport",vp.content="",metas)-1==content.indexOf(key)?content+=","+key+"="+metas[key]:overwrite&&(pattern=new RegExp(key+"s*=s*[^,]+"),content.replace(pattern,key+"="+metas[key]));/^,/.test(content)&&(content=content.substr(1)),vp.content=content,currentVP&&(currentVP.content=content),document.head.appendChild(vp)},_adjustViewportMeta:function(){this._isAdjustViewPort&&(this._setViewportMeta(__BrowserGetter.meta,!1),this._isAdjustViewPort=!1)},_setScaleXYForRenderTexture:function(){var scaleFactor=cc.contentScaleFactor();this._scaleX=scaleFactor,this._scaleY=scaleFactor},_resetScale:function(){this._scaleX=this._originalScaleX,this._scaleY=this._originalScaleY},_adjustSizeToBrowser:function(){},initialize:function(){this._initialized=!0},adjustViewPort:function(enabled){this._isAdjustViewPort=enabled},enableRetina:function(enabled){this._retinaEnabled=!!enabled},isRetinaEnabled:function(){return this._retinaEnabled},enableAutoFullScreen:function(enabled){enabled&&enabled!==this._autoFullScreen&&cc.sys.isMobile&&this._frame===document.documentElement?(SP_MODE,this._autoFullScreen=!0,cc.screen.autoFullScreen(this._frame)):this._autoFullScreen=!1},isAutoFullScreenEnabled:function(){return this._autoFullScreen},end:function(){},isOpenGLReady:function(){return cc.game.canvas&&cc._renderContext},setFrameZoomFactor:function(zoomFactor){this._frameZoomFactor=zoomFactor,this.centerWindow(),cc.director.setProjection(cc.director.getProjection())},swapBuffers:function(){},setIMEKeyboardState:function(isOpen){},setContentTranslateLeftTop:function(offsetLeft,offsetTop){this._contentTranslateLeftTop={left:offsetLeft,top:offsetTop}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},getCanvasSize:function(){return cc.size(cc._canvas.width,cc._canvas.height)},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(width,height){this._frameSize.width=width,this._frameSize.height=height,this._frame.style.width=width+"px",this._frame.style.height=height+"px",this._resizeEvent(),cc.director.setProjection(cc.director.getProjection())},centerWindow:function(){},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return cc.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return cc.p(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return cc.p(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},canSetContentScaleFactor:function(){return!0},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(resolutionPolicy){var _t=this;if(resolutionPolicy instanceof cc.ResolutionPolicy)_t._resolutionPolicy=resolutionPolicy;else{var _locPolicy=cc.ResolutionPolicy;resolutionPolicy===_locPolicy.EXACT_FIT&&(_t._resolutionPolicy=_t._rpExactFit),resolutionPolicy===_locPolicy.SHOW_ALL&&(_t._resolutionPolicy=_t._rpShowAll),resolutionPolicy===_locPolicy.NO_BORDER&&(_t._resolutionPolicy=_t._rpNoBorder),resolutionPolicy===_locPolicy.FIXED_HEIGHT&&(_t._resolutionPolicy=_t._rpFixedHeight),resolutionPolicy===_locPolicy.FIXED_WIDTH&&(_t._resolutionPolicy=_t._rpFixedWidth)}},setDesignResolutionSize:function(width,height,resolutionPolicy){if(0<width||0<height){this.setResolutionPolicy(resolutionPolicy);var policy=this._resolutionPolicy;if(policy&&policy.preApply(this),cc.sys.isMobile&&this._adjustViewportMeta(),this._orientationChanging=!0,this._initFrameSize(),policy){this._originalDesignResolutionSize.width=this._designResolutionSize.width=width,this._originalDesignResolutionSize.height=this._designResolutionSize.height=height;var result=policy.apply(this,this._designResolutionSize);if(result.scale&&2===result.scale.length&&(this._scaleX=result.scale[0],this._scaleY=result.scale[1]),result.viewport){var vp=this._viewPortRect,vb=this._visibleRect,rv=result.viewport;vp.x=rv.x,vp.y=rv.y,vp.width=rv.width,vp.height=rv.height,vb.x=-vp.x/this._scaleX,vb.y=-vp.y/this._scaleY,vb.width=cc._canvas.width/this._scaleX,vb.height=cc._canvas.height/this._scaleY,cc._renderContext.setOffset&&cc._renderContext.setOffset(vp.x,-vp.y)}var director=cc.director;director._winSizeInPoints.width=this._designResolutionSize.width,director._winSizeInPoints.height=this._designResolutionSize.height,policy.postApply(this),cc.winSize.width=director._winSizeInPoints.width,cc.winSize.height=director._winSizeInPoints.height,cc._renderType===cc.game.RENDER_TYPE_WEBGL?director.setGLDefaultValues():cc._renderType===cc.game.RENDER_TYPE_CANVAS&&(cc.renderer._allNeedDraw=!0),this._originalScaleX=this._scaleX,this._originalScaleY=this._scaleY,cc.visibleRect&&cc.visibleRect.init(this._visibleRect)}else cc.log(cc._LogInfos.EGLView_setDesignResolutionSize_2)}else cc.log(cc._LogInfos.EGLView_setDesignResolutionSize)},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(width,height,resolutionPolicy){this._setViewportMeta({width:width},!0),document.documentElement.style.width=width+"px",document.body.style.width="100%",this.setDesignResolutionSize(width,height,resolutionPolicy)},setViewPortInPoints:function(x,y,w,h){var locFrameZoomFactor=this._frameZoomFactor,locScaleX=this._scaleX,locScaleY=this._scaleY;cc._renderContext.viewport(x*locScaleX*locFrameZoomFactor+this._viewPortRect.x*locFrameZoomFactor,y*locScaleY*locFrameZoomFactor+this._viewPortRect.y*locFrameZoomFactor,w*locScaleX*locFrameZoomFactor,h*locScaleY*locFrameZoomFactor)},setScissorInPoints:function(x,y,w,h){var locFrameZoomFactor=this._frameZoomFactor,locScaleX=this._scaleX,locScaleY=this._scaleY,sx=Math.ceil(x*locScaleX*locFrameZoomFactor+this._viewPortRect.x*locFrameZoomFactor),sy=Math.ceil(y*locScaleY*locFrameZoomFactor+this._viewPortRect.y*locFrameZoomFactor),sw=Math.ceil(w*locScaleX*locFrameZoomFactor),sh=Math.ceil(h*locScaleY*locFrameZoomFactor);if(!_scissorRect){var boxArr=gl.getParameter(gl.SCISSOR_BOX);_scissorRect=cc.rect(boxArr[0],boxArr[1],boxArr[2],boxArr[3])}_scissorRect.x==sx&&_scissorRect.y==sy&&_scissorRect.width==sw&&_scissorRect.height==sh||(_scissorRect.x=sx,_scissorRect.y=sy,_scissorRect.width=sw,_scissorRect.height=sh,cc._renderContext.scissor(sx,sy,sw,sh))},isScissorEnabled:function(){return cc._renderContext.isEnabled(gl.SCISSOR_TEST)},getScissorRect:function(){if(!_scissorRect){var boxArr=gl.getParameter(gl.SCISSOR_BOX);_scissorRect=cc.rect(boxArr[0],boxArr[1],boxArr[2],boxArr[3])}var scaleX=this._scaleX,scaleY=this._scaleY;return cc.rect((_scissorRect.x-this._viewPortRect.x)/scaleX,(_scissorRect.y-this._viewPortRect.y)/scaleY,_scissorRect.width/scaleX,_scissorRect.height/scaleY)},setViewName:function(viewName){null!=viewName&&0<viewName.length&&(this._viewName=viewName)},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(tx,ty,relatedPos){var x=this._devicePixelRatio*(tx-relatedPos.left),y=this._devicePixelRatio*(relatedPos.top+relatedPos.height-ty);return this._isRotated?{x:this._viewPortRect.width-y,y:x}:{x:x,y:y}},_convertMouseToLocationInView:function(point,relatedPos){var viewport=this._viewPortRect;point.x=(this._devicePixelRatio*(point.x-relatedPos.left)-viewport.x)/this._scaleX,point.y=(this._devicePixelRatio*(relatedPos.top+relatedPos.height-point.y)-viewport.y)/this._scaleY},_convertPointWithScale:function(point){var viewport=this._viewPortRect;point.x=(point.x-viewport.x)/this._scaleX,point.y=(point.y-viewport.y)/this._scaleY},_convertTouchesWithScale:function(touches){for(var selTouch,selPoint,selPrePoint,viewport=this._viewPortRect,scaleX=this._scaleX,scaleY=this._scaleY,i=0;i<touches.length;i++)selPoint=(selTouch=touches[i])._point,selPrePoint=selTouch._prevPoint,selPoint.x=(selPoint.x-viewport.x)/scaleX,selPoint.y=(selPoint.y-viewport.y)/scaleY,selPrePoint.x=(selPrePoint.x-viewport.x)/scaleX,selPrePoint.y=(selPrePoint.y-viewport.y)/scaleY}}),cc.EGLView._getInstance=function(){return this._instance||(this._instance=this._instance||new cc.EGLView,this._instance.initialize()),this._instance},cc.ContainerStrategy=cc.Class.extend({preApply:function(view){},apply:function(view,designedResolution){},postApply:function(view){},_setupContainer:function(view,w,h){var locCanvas=cc.game.canvas,locContainer=cc.game.container;cc.sys.isMobile&&(document.body.style.width=(view._isRotated?h:w)+"px",document.body.style.height=(view._isRotated?w:h)+"px"),locContainer.style.width=locCanvas.style.width=w+"px",locContainer.style.height=locCanvas.style.height=h+"px";var devicePixelRatio=view._devicePixelRatio=1;view.isRetinaEnabled()&&(devicePixelRatio=view._devicePixelRatio=Math.min(2,window.devicePixelRatio||1)),locCanvas.width=w*devicePixelRatio,locCanvas.height=h*devicePixelRatio,cc._renderContext.resetCache&&cc._renderContext.resetCache()},_fixContainer:function(){document.body.insertBefore(cc.container,document.body.firstChild);var bs=document.body.style;bs.width=window.innerWidth+"px",bs.height=window.innerHeight+"px",bs.overflow="hidden";var contStyle=cc.container.style;contStyle.position="fixed",contStyle.left=contStyle.top="0px",document.body.scrollTop=0}}),cc.ContentStrategy=cc.Class.extend({_result:{scale:[1,1],viewport:null},_buildResult:function(containerW,containerH,contentW,contentH,scaleX,scaleY){Math.abs(containerW-contentW)<2&&(contentW=containerW),Math.abs(containerH-contentH)<2&&(contentH=containerH);var viewport=cc.rect(Math.round((containerW-contentW)/2),Math.round((containerH-contentH)/2),contentW,contentH);return cc._renderType,cc.game.RENDER_TYPE_CANVAS,this._result.scale=[scaleX,scaleY],this._result.viewport=viewport,this._result},preApply:function(view){},apply:function(view,designedResolution){return{scale:[1,1]}},postApply:function(view){}}),function(){var EqualToFrame=cc.ContainerStrategy.extend({apply:function(view){var frameH=view._frameSize.height,containerStyle=cc.container.style;this._setupContainer(view,view._frameSize.width,view._frameSize.height),view._isRotated?containerStyle.marginLeft=frameH+"px":containerStyle.margin="0px"}}),ProportionalToFrame=cc.ContainerStrategy.extend({apply:function(view,designedResolution){var containerW,containerH,frameW=view._frameSize.width,frameH=view._frameSize.height,containerStyle=cc.container.style,designW=designedResolution.width,designH=designedResolution.height,scaleX=frameW/designW,scaleY=frameH/designH;containerH=scaleX<scaleY?(containerW=frameW,designH*scaleX):(containerW=designW*scaleY,frameH);var offx=Math.round((frameW-containerW)/2),offy=Math.round((frameH-containerH)/2);containerW=frameW-2*offx,containerH=frameH-2*offy,this._setupContainer(view,containerW,containerH),view._isRotated?containerStyle.marginLeft=frameH+"px":containerStyle.margin="0px",containerStyle.paddingLeft=offx+"px",containerStyle.paddingRight=offx+"px",containerStyle.paddingTop=offy+"px",containerStyle.paddingBottom=offy+"px"}}),OriginalContainer=(EqualToFrame.extend({preApply:function(view){this._super(view),view._frame=document.documentElement},apply:function(view){this._super(view),this._fixContainer()}}),ProportionalToFrame.extend({preApply:function(view){this._super(view),view._frame=document.documentElement},apply:function(view,designedResolution){this._super(view,designedResolution),this._fixContainer()}}),cc.ContainerStrategy.extend({apply:function(view){this._setupContainer(view,cc._canvas.width,cc._canvas.height)}}));cc.ContainerStrategy.EQUAL_TO_FRAME=new EqualToFrame,cc.ContainerStrategy.PROPORTION_TO_FRAME=new ProportionalToFrame,cc.ContainerStrategy.ORIGINAL_CONTAINER=new OriginalContainer;var ExactFit=cc.ContentStrategy.extend({apply:function(view,designedResolution){var containerW=cc._canvas.width,containerH=cc._canvas.height,scaleX=containerW/designedResolution.width,scaleY=containerH/designedResolution.height;return this._buildResult(containerW,containerH,containerW,containerH,scaleX,scaleY)}}),ShowAll=cc.ContentStrategy.extend({apply:function(view,designedResolution){var contentW,contentH,containerW=cc._canvas.width,containerH=cc._canvas.height,designW=designedResolution.width,designH=designedResolution.height,scaleX=containerW/designW,scaleY=containerH/designH,scale=0;return contentH=scaleX<scaleY?(contentW=containerW,designH*(scale=scaleX)):(contentW=designW*(scale=scaleY),containerH),this._buildResult(containerW,containerH,contentW,contentH,scale,scale)}}),NoBorder=cc.ContentStrategy.extend({apply:function(view,designedResolution){var scale,contentW,contentH,containerW=cc._canvas.width,containerH=cc._canvas.height,designW=designedResolution.width,designH=designedResolution.height,scaleX=containerW/designW,scaleY=containerH/designH;return contentH=scaleX<scaleY?(contentW=designW*(scale=scaleY),containerH):(contentW=containerW,designH*(scale=scaleX)),this._buildResult(containerW,containerH,contentW,contentH,scale,scale)}}),FixedHeight=cc.ContentStrategy.extend({apply:function(view,designedResolution){var containerW=cc._canvas.width,containerH=cc._canvas.height,scale=containerH/designedResolution.height,contentW=containerW,contentH=containerH;return this._buildResult(containerW,containerH,contentW,contentH,scale,scale)},postApply:function(view){cc.director._winSizeInPoints=view.getVisibleSize()}}),FixedWidth=cc.ContentStrategy.extend({apply:function(view,designedResolution){var containerW=cc._canvas.width,containerH=cc._canvas.height,scale=containerW/designedResolution.width,contentW=containerW,contentH=containerH;return this._buildResult(containerW,containerH,contentW,contentH,scale,scale)},postApply:function(view){cc.director._winSizeInPoints=view.getVisibleSize()}});cc.ContentStrategy.EXACT_FIT=new ExactFit,cc.ContentStrategy.SHOW_ALL=new ShowAll,cc.ContentStrategy.NO_BORDER=new NoBorder,cc.ContentStrategy.FIXED_HEIGHT=new FixedHeight,cc.ContentStrategy.FIXED_WIDTH=new FixedWidth}(),cc.ResolutionPolicy=cc.Class.extend({_containerStrategy:null,_contentStrategy:null,ctor:function(containerStg,contentStg){this.setContainerStrategy(containerStg),this.setContentStrategy(contentStg)},preApply:function(view){this._containerStrategy.preApply(view),this._contentStrategy.preApply(view)},apply:function(view,designedResolution){return this._containerStrategy.apply(view,designedResolution),this._contentStrategy.apply(view,designedResolution)},postApply:function(view){this._containerStrategy.postApply(view),this._contentStrategy.postApply(view)},setContainerStrategy:function(containerStg){containerStg instanceof cc.ContainerStrategy&&(this._containerStrategy=containerStg)},setContentStrategy:function(contentStg){contentStg instanceof cc.ContentStrategy&&(this._contentStrategy=contentStg)}}),cc.ResolutionPolicy.EXACT_FIT=0,cc.ResolutionPolicy.NO_BORDER=1,cc.ResolutionPolicy.SHOW_ALL=2,cc.ResolutionPolicy.FIXED_HEIGHT=3,cc.ResolutionPolicy.FIXED_WIDTH=4,cc.ResolutionPolicy.UNKNOWN=5,cc.screen={_supportsFullScreen:!1,_preOnFullScreenChange:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){this._fn={};var i,val,valL,map=this._fnMap;for(i=0,l=map.length;i<l;i++)if((val=map[i])&&val[1]in document){for(i=0,valL=val.length;i<valL;i++)this._fn[map[0][i]]=val[i];break}this._supportsFullScreen=void 0!==this._fn.requestFullscreen,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},fullScreen:function(){return!!this._supportsFullScreen&&(void 0!==document[this._fn.fullscreenElement]&&null!==document[this._fn.fullscreenElement])},requestFullScreen:function(element,onFullScreenChange){if(this._supportsFullScreen){if(element=element||document.documentElement,onFullScreenChange){var eventName=this._fn.fullscreenchange;this._preOnFullScreenChange&&document.removeEventListener(eventName,this._preOnFullScreenChange),this._preOnFullScreenChange=onFullScreenChange,document.addEventListener(eventName,onFullScreenChange,!1)}return element[this._fn.requestFullscreen]()}},exitFullScreen:function(){return!this._supportsFullScreen||document[this._fn.exitFullscreen]()},autoFullScreen:function(element,onFullScreenChange){element=element||document.body;var touchTarget=cc.game.canvas||element,theScreen=this;this.requestFullScreen(element,onFullScreenChange),touchTarget.addEventListener(this._touchEvent,function callback(){touchTarget.removeEventListener(theScreen._touchEvent,callback),theScreen.requestFullScreen(element,onFullScreenChange)})}},cc.screen.init(),cc.visibleRect={topLeft:cc.p(0,0),topRight:cc.p(0,0),top:cc.p(0,0),bottomLeft:cc.p(0,0),bottomRight:cc.p(0,0),bottom:cc.p(0,0),center:cc.p(0,0),left:cc.p(0,0),right:cc.p(0,0),width:0,height:0,init:function(visibleRect){var w=this.width=visibleRect.width,h=this.height=visibleRect.height,l=visibleRect.x,b=visibleRect.y,t=b+h,r=l+w;this.topLeft.x=l,this.topLeft.y=t,this.topRight.x=r,this.topRight.y=t,this.top.x=l+w/2,this.top.y=t,this.bottomLeft.x=l,this.bottomLeft.y=b,this.bottomRight.x=r,this.bottomRight.y=b,this.bottom.x=l+w/2,this.bottom.y=b,this.center.x=l+w/2,this.center.y=b+h/2,this.left.x=l,this.left.y=b+h/2,this.right.x=r,this.right.y=b+h/2}},cc.UIInterfaceOrientationLandscapeLeft=-90,cc.UIInterfaceOrientationLandscapeRight=90,cc.UIInterfaceOrientationPortraitUpsideDown=180,cc.UIInterfaceOrientationPortrait=0,cc.inputManager={TOUCH_TIMEOUT:5e3,_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.p(0,0),_prevMousePoint:cc.p(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:5,_accelEnabled:!1,_accelInterval:1/30,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_getUnUsedIndex:function(){for(var temp=this._indexBitsUsed,now=cc.sys.now(),i=0;i<this._maxTouches;i++){if(!(1&temp))return this._indexBitsUsed|=1<<i,i;var touch=this._touches[i];if(now-touch._lastModified>this.TOUCH_TIMEOUT)return this._removeUsedIndexBit(i),delete this._touchesIntegerDict[touch.getID()],i;temp>>=1}return-1},_removeUsedIndexBit:function(index){if(!(index<0||index>=this._maxTouches)){var temp=1<<index;temp=~temp,this._indexBitsUsed&=temp}},_glView:null,handleTouchesBegin:function(touches){for(var selTouch,curTouch,touchID,handleTouches=[],locTouchIntDict=this._touchesIntegerDict,now=cc.sys.now(),i=0,len=touches.length;i<len;i++)if(null==locTouchIntDict[touchID=(selTouch=touches[i]).getID()]){var unusedIndex=this._getUnUsedIndex();if(-1===unusedIndex){cc.log(cc._LogInfos.inputManager_handleTouchesBegin,unusedIndex);continue}(curTouch=this._touches[unusedIndex]=new cc.Touch(selTouch._point.x,selTouch._point.y,selTouch.getID()))._lastModified=now,curTouch._setPrevPoint(selTouch._prevPoint),locTouchIntDict[touchID]=unusedIndex,handleTouches.push(curTouch)}if(0<handleTouches.length){this._glView._convertTouchesWithScale(handleTouches);var touchEvent=new cc.EventTouch(handleTouches);touchEvent._eventCode=cc.EventTouch.EventCode.BEGAN,cc.eventManager.dispatchEvent(touchEvent)}},handleTouchesMove:function(touches){for(var selTouch,index,touchID,handleTouches=[],locTouches=this._touches,now=cc.sys.now(),i=0,len=touches.length;i<len;i++)touchID=(selTouch=touches[i]).getID(),null!=(index=this._touchesIntegerDict[touchID])&&locTouches[index]&&(locTouches[index]._setPoint(selTouch._point),locTouches[index]._setPrevPoint(selTouch._prevPoint),locTouches[index]._lastModified=now,handleTouches.push(locTouches[index]));if(0<handleTouches.length){this._glView._convertTouchesWithScale(handleTouches);var touchEvent=new cc.EventTouch(handleTouches);touchEvent._eventCode=cc.EventTouch.EventCode.MOVED,cc.eventManager.dispatchEvent(touchEvent)}},handleTouchesEnd:function(touches){var handleTouches=this.getSetOfTouchesEndOrCancel(touches);if(0<handleTouches.length){this._glView._convertTouchesWithScale(handleTouches);var touchEvent=new cc.EventTouch(handleTouches);touchEvent._eventCode=cc.EventTouch.EventCode.ENDED,cc.eventManager.dispatchEvent(touchEvent)}},handleTouchesCancel:function(touches){var handleTouches=this.getSetOfTouchesEndOrCancel(touches);if(0<handleTouches.length){this._glView._convertTouchesWithScale(handleTouches);var touchEvent=new cc.EventTouch(handleTouches);touchEvent._eventCode=cc.EventTouch.EventCode.CANCELLED,cc.eventManager.dispatchEvent(touchEvent)}},getSetOfTouchesEndOrCancel:function(touches){for(var selTouch,index,touchID,handleTouches=[],locTouches=this._touches,locTouchesIntDict=this._touchesIntegerDict,i=0,len=touches.length;i<len;i++)null!=(index=locTouchesIntDict[touchID=(selTouch=touches[i]).getID()])&&locTouches[index]&&(locTouches[index]._setPoint(selTouch._point),locTouches[index]._setPrevPoint(selTouch._prevPoint),handleTouches.push(locTouches[index]),this._removeUsedIndexBit(index),delete locTouchesIntDict[touchID]);return handleTouches},getHTMLElementPosition:function(element){var docElem=document.documentElement,win=window,box=null;return{left:(box=cc.isFunction(element.getBoundingClientRect)?element.getBoundingClientRect():{left:0,top:0,width:parseInt(element.style.width),height:parseInt(element.style.height)}).left+win.pageXOffset-docElem.clientLeft,top:box.top+win.pageYOffset-docElem.clientTop,width:box.width,height:box.height}},getPreTouch:function(touch){for(var preTouch=null,locPreTouchPool=this._preTouchPool,id=touch.getID(),i=locPreTouchPool.length-1;0<=i;i--)if(locPreTouchPool[i].getID()===id){preTouch=locPreTouchPool[i];break}return preTouch||(preTouch=touch),preTouch},setPreTouch:function(touch){for(var find=!1,locPreTouchPool=this._preTouchPool,id=touch.getID(),i=locPreTouchPool.length-1;0<=i;i--)if(locPreTouchPool[i].getID()===id){locPreTouchPool[i]=touch,find=!0;break}find||(locPreTouchPool.length<=50?locPreTouchPool.push(touch):(locPreTouchPool[this._preTouchPoolPointer]=touch,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(tx,ty,pos){var locPreTouch=this._preTouchPoint,location=this._glView.convertToLocationInView(tx,ty,pos),touch=new cc.Touch(location.x,location.y);return touch._setPrevPoint(locPreTouch.x,locPreTouch.y),locPreTouch.x=location.x,locPreTouch.y=location.y,touch},getMouseEvent:function(location,pos,eventType){var locPreMouse=this._prevMousePoint;this._glView._convertMouseToLocationInView(location,pos);var mouseEvent=new cc.EventMouse(eventType);return mouseEvent.setLocation(location.x,location.y),mouseEvent._setPrevCursor(locPreMouse.x,locPreMouse.y),locPreMouse.x=location.x,locPreMouse.y=location.y,mouseEvent},getPointByEvent:function(event,pos){return null!=event.pageX?{x:event.pageX,y:event.pageY}:(pos.left-=document.body.scrollLeft,pos.top-=document.body.scrollTop,{x:event.clientX,y:event.clientY})},getTouchesByEvent:function(event,pos){for(var touch_event,touch,preLocation,touchArr=[],locView=this._glView,locPreTouch=this._preTouchPoint,length=event.changedTouches.length,i=0;i<length;i++){var location;if(touch_event=event.changedTouches[i])location=cc.sys.BROWSER_TYPE_FIREFOX===cc.sys.browserType?locView.convertToLocationInView(touch_event.pageX,touch_event.pageY,pos):locView.convertToLocationInView(touch_event.clientX,touch_event.clientY,pos),null!=touch_event.identifier?(touch=new cc.Touch(location.x,location.y,touch_event.identifier),preLocation=this.getPreTouch(touch).getLocation(),touch._setPrevPoint(preLocation.x,preLocation.y),this.setPreTouch(touch)):(touch=new cc.Touch(location.x,location.y))._setPrevPoint(locPreTouch.x,locPreTouch.y),locPreTouch.x=location.x,locPreTouch.y=location.y,touchArr.push(touch)}return touchArr},registerSystemEvent:function(element){if(!this._isRegisterEvent){this._glView=cc.view;var selfPointer=this,supportMouse="mouse"in cc.sys.capabilities,supportTouches="touches"in cc.sys.capabilities,prohibition=!1;if(cc.sys.isMobile&&(prohibition=!0),supportMouse&&(window.addEventListener("mousedown",function(){selfPointer._mousePressed=!0},!1),window.addEventListener("mouseup",function(event){if(!prohibition){var savePressed=selfPointer._mousePressed;if(selfPointer._mousePressed=!1,savePressed){var pos=selfPointer.getHTMLElementPosition(element),location=selfPointer.getPointByEvent(event,pos);if(!cc.rectContainsPoint(new cc.Rect(pos.left,pos.top,pos.width,pos.height),location)){selfPointer.handleTouchesEnd([selfPointer.getTouchByXY(location.x,location.y,pos)]);var mouseEvent=selfPointer.getMouseEvent(location,pos,cc.EventMouse.UP);mouseEvent.setButton(event.button),cc.eventManager.dispatchEvent(mouseEvent)}}}},!1),element.addEventListener("mouseout",function(event){if(selfPointer._mousePressed){if(prohibition)return;selfPointer._mousePressed=!1;var pos=selfPointer.getHTMLElementPosition(element),location=selfPointer.getPointByEvent(event,pos);selfPointer.handleTouchesEnd([selfPointer.getTouchByXY(location.x,location.y,pos)]);var mouseEvent=selfPointer.getMouseEvent(location,pos,cc.EventMouse.UP);mouseEvent.setButton(event.button),cc.eventManager.dispatchEvent(mouseEvent),event.stopPropagation(),event.preventDefault()}},!1),element.addEventListener("mousedown",function(event){if(!prohibition){selfPointer._mousePressed=!0;var pos=selfPointer.getHTMLElementPosition(element),location=selfPointer.getPointByEvent(event,pos);selfPointer.handleTouchesBegin([selfPointer.getTouchByXY(location.x,location.y,pos)]);var mouseEvent=selfPointer.getMouseEvent(location,pos,cc.EventMouse.DOWN);mouseEvent.setButton(event.button),cc.eventManager.dispatchEvent(mouseEvent),event.stopPropagation(),event.preventDefault(),element.focus()}},!1),element.addEventListener("mouseup",function(event){if(!prohibition){selfPointer._mousePressed=!1;var pos=selfPointer.getHTMLElementPosition(element),location=selfPointer.getPointByEvent(event,pos);selfPointer.handleTouchesEnd([selfPointer.getTouchByXY(location.x,location.y,pos)]);var mouseEvent=selfPointer.getMouseEvent(location,pos,cc.EventMouse.UP);mouseEvent.setButton(event.button),cc.eventManager.dispatchEvent(mouseEvent),event.stopPropagation(),event.preventDefault()}},!1),element.addEventListener("mousemove",function(event){if(!prohibition){var pos=selfPointer.getHTMLElementPosition(element),location=selfPointer.getPointByEvent(event,pos);selfPointer.handleTouchesMove([selfPointer.getTouchByXY(location.x,location.y,pos)]);var mouseEvent=selfPointer.getMouseEvent(location,pos,cc.EventMouse.MOVE);selfPointer._mousePressed?mouseEvent.setButton(event.button):mouseEvent.setButton(null),cc.eventManager.dispatchEvent(mouseEvent),event.stopPropagation(),event.preventDefault()}},!1),element.addEventListener("mousewheel",function(event){var pos=selfPointer.getHTMLElementPosition(element),location=selfPointer.getPointByEvent(event,pos),mouseEvent=selfPointer.getMouseEvent(location,pos,cc.EventMouse.SCROLL);mouseEvent.setButton(event.button),mouseEvent.setScrollData(0,event.wheelDelta),cc.eventManager.dispatchEvent(mouseEvent),event.stopPropagation(),event.preventDefault()},!1),element.addEventListener("DOMMouseScroll",function(event){var pos=selfPointer.getHTMLElementPosition(element),location=selfPointer.getPointByEvent(event,pos),mouseEvent=selfPointer.getMouseEvent(location,pos,cc.EventMouse.SCROLL);mouseEvent.setButton(event.button),mouseEvent.setScrollData(0,-120*event.detail),cc.eventManager.dispatchEvent(mouseEvent),event.stopPropagation(),event.preventDefault()},!1)),window.navigator.msPointerEnabled){var _pointerEventsMap={MSPointerDown:selfPointer.handleTouchesBegin,MSPointerMove:selfPointer.handleTouchesMove,MSPointerUp:selfPointer.handleTouchesEnd,MSPointerCancel:selfPointer.handleTouchesCancel};for(var eventName in _pointerEventsMap)!function(_pointerEvent,_touchEvent){element.addEventListener(_pointerEvent,function(event){var pos=selfPointer.getHTMLElementPosition(element);pos.left-=document.documentElement.scrollLeft,pos.top-=document.documentElement.scrollTop,_touchEvent.call(selfPointer,[selfPointer.getTouchByXY(event.clientX,event.clientY,pos)]),event.stopPropagation()},!1)}(eventName,_pointerEventsMap[eventName])}supportTouches&&(element.addEventListener("touchstart",function(event){if(event.changedTouches){var pos=selfPointer.getHTMLElementPosition(element);pos.left-=document.body.scrollLeft,pos.top-=document.body.scrollTop,selfPointer.handleTouchesBegin(selfPointer.getTouchesByEvent(event,pos)),event.stopPropagation(),event.preventDefault(),element.focus()}},!1),element.addEventListener("touchmove",function(event){if(event.changedTouches){var pos=selfPointer.getHTMLElementPosition(element);pos.left-=document.body.scrollLeft,pos.top-=document.body.scrollTop,selfPointer.handleTouchesMove(selfPointer.getTouchesByEvent(event,pos)),event.stopPropagation(),event.preventDefault()}},!1),element.addEventListener("touchend",function(event){if(event.changedTouches){var pos=selfPointer.getHTMLElementPosition(element);pos.left-=document.body.scrollLeft,pos.top-=document.body.scrollTop,selfPointer.handleTouchesEnd(selfPointer.getTouchesByEvent(event,pos)),event.stopPropagation(),event.preventDefault()}},!1),element.addEventListener("touchcancel",function(event){if(event.changedTouches){var pos=selfPointer.getHTMLElementPosition(element);pos.left-=document.body.scrollLeft,pos.top-=document.body.scrollTop,selfPointer.handleTouchesCancel(selfPointer.getTouchesByEvent(event,pos)),event.stopPropagation(),event.preventDefault()}},!1)),this._registerKeyboardEvent(),this._registerAccelerometerEvent(),this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(dt){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,cc.eventManager.dispatchEvent(new cc.EventAcceleration(this._acceleration))),this._accelCurTime+=dt}};var _p=cc.inputManager;_p.setAccelerometerEnabled=function(isEnable){var _t=this;if(_t._accelEnabled!==isEnable){_t._accelEnabled=isEnable;var scheduler=cc.director.getScheduler();_t._accelEnabled,_t._accelCurTime=0,scheduler.scheduleUpdate(_t)}},_p.setAccelerometerInterval=function(interval){this._accelInterval!==interval&&(this._accelInterval=interval)},_p._registerKeyboardEvent=function(){cc._canvas.addEventListener("keydown",function(e){cc.eventManager.dispatchEvent(new cc.EventKeyboard(e.keyCode,!0)),e.stopPropagation(),e.preventDefault()},!1),cc._canvas.addEventListener("keyup",function(e){cc.eventManager.dispatchEvent(new cc.EventKeyboard(e.keyCode,!1)),e.stopPropagation(),e.preventDefault()},!1)},_p._registerAccelerometerEvent=function(){var w=window,_t=this;_t._acceleration=new cc.Acceleration,_t._accelDeviceEvent=w.DeviceMotionEvent||w.DeviceOrientationEvent,cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ&&(_t._accelDeviceEvent=window.DeviceOrientationEvent);var _deviceEventType=_t._accelDeviceEvent===w.DeviceMotionEvent?"devicemotion":"deviceorientation",ua=navigator.userAgent;(/Android/.test(ua)||/Adr/.test(ua)&&cc.sys.browserType===cc.BROWSER_TYPE_UC)&&(_t._minus=-1),w.addEventListener(_deviceEventType,_t.didAccelerate.bind(_t),!1)},_p.didAccelerate=function(eventData){var _t=this,w=window;if(_t._accelEnabled){var x,y,z,mAcceleration=_t._acceleration;if(_t._accelDeviceEvent===window.DeviceMotionEvent){var eventAcceleration=eventData.accelerationIncludingGravity;x=_t._accelMinus*eventAcceleration.x*.1,y=_t._accelMinus*eventAcceleration.y*.1,z=.1*eventAcceleration.z}else x=eventData.gamma/90*.981,y=-eventData.beta/90*.981,z=eventData.alpha/90*.981;mAcceleration.x=x,mAcceleration.y=y,mAcceleration.z=z,mAcceleration.timestamp=eventData.timeStamp||Date.now();var tmpX=mAcceleration.x;w.orientation===cc.UIInterfaceOrientationLandscapeRight?(mAcceleration.x=-mAcceleration.y,mAcceleration.y=tmpX):w.orientation===cc.UIInterfaceOrientationLandscapeLeft?(mAcceleration.x=mAcceleration.y,mAcceleration.y=-tmpX):w.orientation===cc.UIInterfaceOrientationPortraitUpsideDown&&(mAcceleration.x=-mAcceleration.x,mAcceleration.y=-mAcceleration.y)}},delete _p,cc.AffineTransform=function(a,b,c,d,tx,ty){this.a=a,this.b=b,this.c=c,this.d=d,this.tx=tx,this.ty=ty},cc.affineTransformMake=function(a,b,c,d,tx,ty){return{a:a,b:b,c:c,d:d,tx:tx,ty:ty}},cc.pointApplyAffineTransform=function(point,transOrY,t){var x,y;return y=void 0===t?(t=transOrY,x=point.x,point.y):(x=point,transOrY),{x:t.a*x+t.c*y+t.tx,y:t.b*x+t.d*y+t.ty}},cc._pointApplyAffineTransform=function(x,y,t){return cc.pointApplyAffineTransform(x,y,t)},cc.sizeApplyAffineTransform=function(size,t){return{width:t.a*size.width+t.c*size.height,height:t.b*size.width+t.d*size.height}},cc.affineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.affineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.rectApplyAffineTransform=function(rect,anAffineTransform){var top=cc.rectGetMinY(rect),left=cc.rectGetMinX(rect),right=cc.rectGetMaxX(rect),bottom=cc.rectGetMaxY(rect),topLeft=cc.pointApplyAffineTransform(left,top,anAffineTransform),topRight=cc.pointApplyAffineTransform(right,top,anAffineTransform),bottomLeft=cc.pointApplyAffineTransform(left,bottom,anAffineTransform),bottomRight=cc.pointApplyAffineTransform(right,bottom,anAffineTransform),minX=Math.min(topLeft.x,topRight.x,bottomLeft.x,bottomRight.x),maxX=Math.max(topLeft.x,topRight.x,bottomLeft.x,bottomRight.x),minY=Math.min(topLeft.y,topRight.y,bottomLeft.y,bottomRight.y),maxY=Math.max(topLeft.y,topRight.y,bottomLeft.y,bottomRight.y);return cc.rect(minX,minY,maxX-minX,maxY-minY)},cc._rectApplyAffineTransformIn=function(rect,anAffineTransform){var top=cc.rectGetMinY(rect),left=cc.rectGetMinX(rect),right=cc.rectGetMaxX(rect),bottom=cc.rectGetMaxY(rect),topLeft=cc.pointApplyAffineTransform(left,top,anAffineTransform),topRight=cc.pointApplyAffineTransform(right,top,anAffineTransform),bottomLeft=cc.pointApplyAffineTransform(left,bottom,anAffineTransform),bottomRight=cc.pointApplyAffineTransform(right,bottom,anAffineTransform),minX=Math.min(topLeft.x,topRight.x,bottomLeft.x,bottomRight.x),maxX=Math.max(topLeft.x,topRight.x,bottomLeft.x,bottomRight.x),minY=Math.min(topLeft.y,topRight.y,bottomLeft.y,bottomRight.y),maxY=Math.max(topLeft.y,topRight.y,bottomLeft.y,bottomRight.y);return rect.x=minX,rect.y=minY,rect.width=maxX-minX,rect.height=maxY-minY,rect},cc.affineTransformTranslate=function(t,tx,ty){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx+t.a*tx+t.c*ty,ty:t.ty+t.b*tx+t.d*ty}},cc.affineTransformScale=function(t,sx,sy){return{a:t.a*sx,b:t.b*sx,c:t.c*sy,d:t.d*sy,tx:t.tx,ty:t.ty}},cc.affineTransformRotate=function(aTransform,anAngle){var fSin=Math.sin(anAngle),fCos=Math.cos(anAngle);return{a:aTransform.a*fCos+aTransform.c*fSin,b:aTransform.b*fCos+aTransform.d*fSin,c:aTransform.c*fCos-aTransform.a*fSin,d:aTransform.d*fCos-aTransform.b*fSin,tx:aTransform.tx,ty:aTransform.ty}},cc.affineTransformConcat=function(t1,t2){return{a:t1.a*t2.a+t1.b*t2.c,b:t1.a*t2.b+t1.b*t2.d,c:t1.c*t2.a+t1.d*t2.c,d:t1.c*t2.b+t1.d*t2.d,tx:t1.tx*t2.a+t1.ty*t2.c+t2.tx,ty:t1.tx*t2.b+t1.ty*t2.d+t2.ty}},cc.affineTransformConcatIn=function(t1,t2){var a=t1.a,b=t1.b,c=t1.c,d=t1.d,tx=t1.tx,ty=t1.ty;return t1.a=a*t2.a+b*t2.c,t1.b=a*t2.b+b*t2.d,t1.c=c*t2.a+d*t2.c,t1.d=c*t2.b+d*t2.d,t1.tx=tx*t2.a+ty*t2.c+t2.tx,t1.ty=tx*t2.b+ty*t2.d+t2.ty,t1},cc.affineTransformEqualToTransform=function(t1,t2){return t1.a===t2.a&&t1.b===t2.b&&t1.c===t2.c&&t1.d===t2.d&&t1.tx===t2.tx&&t1.ty===t2.ty},cc.affineTransformInvert=function(t){var determinant=1/(t.a*t.d-t.b*t.c);return{a:determinant*t.d,b:-determinant*t.b,c:-determinant*t.c,d:determinant*t.a,tx:determinant*(t.c*t.ty-t.d*t.tx),ty:determinant*(t.b*t.tx-t.a*t.ty)}},cc.affineTransformInvertOut=function(t,out){var a=t.a,b=t.b,c=t.c,d=t.d,determinant=1/(a*d-b*c);out.a=determinant*d,out.b=-determinant*b,out.c=-determinant*c,out.d=determinant*a,out.tx=determinant*(c*t.ty-d*t.tx),out.ty=determinant*(b*t.tx-a*t.ty)},cc.POINT_EPSILON=parseFloat("1.192092896e-07F"),cc.pNeg=function(point){return cc.p(-point.x,-point.y)},cc.pAdd=function(v1,v2){return cc.p(v1.x+v2.x,v1.y+v2.y)},cc.pSub=function(v1,v2){return cc.p(v1.x-v2.x,v1.y-v2.y)},cc.pMult=function(point,floatVar){return cc.p(point.x*floatVar,point.y*floatVar)},cc.pMidpoint=function(v1,v2){return cc.pMult(cc.pAdd(v1,v2),.5)},cc.pDot=function(v1,v2){return v1.x*v2.x+v1.y*v2.y},cc.pCross=function(v1,v2){return v1.x*v2.y-v1.y*v2.x},cc.pPerp=function(point){return cc.p(-point.y,point.x)},cc.pRPerp=function(point){return cc.p(point.y,-point.x)},cc.pProject=function(v1,v2){return cc.pMult(v2,cc.pDot(v1,v2)/cc.pDot(v2,v2))},cc.pRotate=function(v1,v2){return cc.p(v1.x*v2.x-v1.y*v2.y,v1.x*v2.y+v1.y*v2.x)},cc.pUnrotate=function(v1,v2){return cc.p(v1.x*v2.x+v1.y*v2.y,v1.y*v2.x-v1.x*v2.y)},cc.pLengthSQ=function(v){return cc.pDot(v,v)},cc.pDistanceSQ=function(point1,point2){return cc.pLengthSQ(cc.pSub(point1,point2))},cc.pLength=function(v){return Math.sqrt(cc.pLengthSQ(v))},cc.pDistance=function(v1,v2){return cc.pLength(cc.pSub(v1,v2))},cc.pNormalize=function(v){var n=cc.pLength(v);return 0===n?cc.p(v):cc.pMult(v,1/n)},cc.pForAngle=function(a){return cc.p(Math.cos(a),Math.sin(a))},cc.pToAngle=function(v){return Math.atan2(v.y,v.x)},cc.clampf=function(value,min_inclusive,max_inclusive){if(max_inclusive<min_inclusive){var temp=min_inclusive;min_inclusive=max_inclusive,max_inclusive=temp}return value<min_inclusive?min_inclusive:value<max_inclusive?value:max_inclusive},cc.pClamp=function(p,min_inclusive,max_inclusive){return cc.p(cc.clampf(p.x,min_inclusive.x,max_inclusive.x),cc.clampf(p.y,min_inclusive.y,max_inclusive.y))},cc.pFromSize=function(s){return cc.p(s.width,s.height)},cc.pCompOp=function(p,opFunc){return cc.p(opFunc(p.x),opFunc(p.y))},cc.pLerp=function(a,b,alpha){return cc.pAdd(cc.pMult(a,1-alpha),cc.pMult(b,alpha))},cc.pFuzzyEqual=function(a,b,variance){return a.x-variance<=b.x&&b.x<=a.x+variance&&a.y-variance<=b.y&&b.y<=a.y+variance},cc.pCompMult=function(a,b){return cc.p(a.x*b.x,a.y*b.y)},cc.pAngleSigned=function(a,b){var a2=cc.pNormalize(a),b2=cc.pNormalize(b),angle=Math.atan2(a2.x*b2.y-a2.y*b2.x,cc.pDot(a2,b2));return Math.abs(angle)<cc.POINT_EPSILON?0:angle},cc.pAngle=function(a,b){var angle=Math.acos(cc.pDot(cc.pNormalize(a),cc.pNormalize(b)));return Math.abs(angle)<cc.POINT_EPSILON?0:angle},cc.pRotateByAngle=function(v,pivot,angle){var r=cc.pSub(v,pivot),cosa=Math.cos(angle),sina=Math.sin(angle),t=r.x;return r.x=t*cosa-r.y*sina+pivot.x,r.y=t*sina+r.y*cosa+pivot.y,r},cc.pLineIntersect=function(A,B,C,D,retP){if(A.x===B.x&&A.y===B.y||C.x===D.x&&C.y===D.y)return!1;var BAx=B.x-A.x,BAy=B.y-A.y,DCx=D.x-C.x,DCy=D.y-C.y,ACx=A.x-C.x,ACy=A.y-C.y,denom=DCy*BAx-DCx*BAy;return retP.x=DCx*ACy-DCy*ACx,retP.y=BAx*ACy-BAy*ACx,0===denom?0===retP.x||0===retP.y:(retP.x=retP.x/denom,retP.y=retP.y/denom,!0)},cc.pSegmentIntersect=function(A,B,C,D){var retP=cc.p(0,0);return!!(cc.pLineIntersect(A,B,C,D,retP)&&0<=retP.x&&retP.x<=1&&0<=retP.y&&retP.y<=1)},cc.pIntersectPoint=function(A,B,C,D){var retP=cc.p(0,0);if(cc.pLineIntersect(A,B,C,D,retP)){var P=cc.p(0,0);return P.x=A.x+retP.x*(B.x-A.x),P.y=A.y+retP.x*(B.y-A.y),P}return cc.p(0,0)},cc.pSameAs=function(A,B){return null!=A&&null!=B&&(A.x===B.x&&A.y===B.y)},cc.pZeroIn=function(v){v.x=0,v.y=0},cc.pIn=function(v1,v2){v1.x=v2.x,v1.y=v2.y},cc.pMultIn=function(point,floatVar){point.x*=floatVar,point.y*=floatVar},cc.pSubIn=function(v1,v2){v1.x-=v2.x,v1.y-=v2.y},cc.pAddIn=function(v1,v2){v1.x+=v2.x,v1.y+=v2.y},cc.pNormalizeIn=function(v){cc.pMultIn(v,1/Math.sqrt(v.x*v.x+v.y*v.y))},cc.vertexLineToPolygon=function(points,stroke,vertices,offset,nuPoints){if(!((nuPoints+=offset)<=1)){var idx;stroke*=.5;for(var nuPointsMinus=nuPoints-1,i=offset;i<nuPoints;i++){idx=2*i;var perpVector,p1=cc.p(points[2*i],points[2*i+1]);if(0===i)perpVector=cc.pPerp(cc.pNormalize(cc.pSub(p1,cc.p(points[2*(i+1)],points[2*(i+1)+1]))));else if(i===nuPointsMinus)perpVector=cc.pPerp(cc.pNormalize(cc.pSub(cc.p(points[2*(i-1)],points[2*(i-1)+1]),p1)));else{var p0=cc.p(points[2*(i-1)],points[2*(i-1)+1]),p2=cc.p(points[2*(i+1)],points[2*(i+1)+1]),p2p1=cc.pNormalize(cc.pSub(p2,p1)),p0p1=cc.pNormalize(cc.pSub(p0,p1)),angle=Math.acos(cc.pDot(p2p1,p0p1));perpVector=angle<cc.degreesToRadians(70)?cc.pPerp(cc.pNormalize(cc.pMidpoint(p2p1,p0p1))):angle<cc.degreesToRadians(170)?cc.pNormalize(cc.pMidpoint(p2p1,p0p1)):cc.pPerp(cc.pNormalize(cc.pSub(p2,p0)))}perpVector=cc.pMult(perpVector,stroke),vertices[2*idx]=p1.x+perpVector.x,vertices[2*idx+1]=p1.y+perpVector.y,vertices[2*(idx+1)]=p1.x-perpVector.x,vertices[2*(idx+1)+1]=p1.y-perpVector.y}for(i=offset=0===offset?0:offset-1;i<nuPointsMinus;i++){var idx1=(idx=2*i)+2,v1=cc.vertex2(vertices[2*idx],vertices[2*idx+1]),v2=cc.vertex2(vertices[2*(idx+1)],vertices[2*(idx+1)+1]),v3=cc.vertex2(vertices[2*idx1],vertices[2*idx1]),v4=cc.vertex2(vertices[2*(idx1+1)],vertices[2*(idx1+1)+1]),fixVertexResult=!cc.vertexLineIntersect(v1.x,v1.y,v4.x,v4.y,v2.x,v2.y,v3.x,v3.y);fixVertexResult.isSuccess||(fixVertexResult.value<0||1<fixVertexResult.value)&&(fixVertexResult.isSuccess=!0),fixVertexResult.isSuccess&&(vertices[2*idx1]=v4.x,vertices[2*idx1+1]=v4.y,vertices[2*(idx1+1)]=v3.x,vertices[2*(idx1+1)+1]=v3.y)}}},cc.vertexLineIntersect=function(Ax,Ay,Bx,By,Cx,Cy,Dx,Dy){var distAB,theCos,theSin,newX;return Ax===Bx&&Ay===By||Cx===Dx&&Cy===Dy?{isSuccess:!1,value:0}:(By-=Ay,Cy-=Ay,Dx-=Ax,Dy-=Ay,newX=(Cx-=Ax)*(theCos=(Bx-=Ax)/(distAB=Math.sqrt(Bx*Bx+By*By)))+Cy*(theSin=By/distAB),Cy=Cy*theCos-Cx*theSin,Cx=newX,newX=Dx*theCos+Dy*theSin,Cy===(Dy=Dy*theCos-Dx*theSin)?{isSuccess:!1,value:0}:{isSuccess:!0,value:((Dx=newX)+(Cx-Dx)*Dy/(Dy-Cy))/distAB})},cc.vertexListIsClockwise=function(verts){for(var i=0,len=verts.length;i<len;i++){var a=verts[i],b=verts[(i+1)%len],c=verts[(i+2)%len];if(0<cc.pCross(cc.pSub(b,a),cc.pSub(c,b)))return!1}return!0},cc.CGAffineToGL=function(trans,mat){mat[2]=mat[3]=mat[6]=mat[7]=mat[8]=mat[9]=mat[11]=mat[14]=0,mat[10]=mat[15]=1,mat[0]=trans.a,mat[4]=trans.c,mat[12]=trans.tx,mat[1]=trans.b,mat[5]=trans.d,mat[13]=trans.ty},cc.GLToCGAffine=function(mat,trans){trans.a=mat[0],trans.c=mat[4],trans.tx=mat[12],trans.b=mat[1],trans.d=mat[5],trans.ty=mat[13]},cc.Touch=cc.Class.extend({_lastModified:0,_point:null,_prevPoint:null,_id:0,_startPointCaptured:!1,_startPoint:null,ctor:function(x,y,id){this.setTouchInfo(id,x,y)},getLocation:function(){return{x:this._point.x,y:this._point.y}},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocation:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getDelta:function(){return cc.pSub(this._point,this._prevPoint)},getLocationInView:function(){return{x:this._point.x,y:this._point.y}},getPreviousLocationInView:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocationInView:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getID:function(){return this._id},getId:function(){return cc.log("getId is deprecated. Please use getID instead."),this._id},setTouchInfo:function(id,x,y){this._prevPoint=this._point,this._point=cc.p(x||0,y||0),this._id=id,this._startPointCaptured||(this._startPoint=cc.p(this._point),cc.view._convertPointWithScale(this._startPoint),this._startPointCaptured=!0)},_setPoint:function(x,y){this._point.y=void 0===y?(this._point.x=x.x,x.y):(this._point.x=x,y)},_setPrevPoint:function(x,y){this._prevPoint=void 0===y?cc.p(x.x,x.y):cc.p(x||0,y||0)}}),cc.Event=cc.Class.extend({_type:0,_isStopped:!1,_currentTarget:null,_setCurrentTarget:function(target){this._currentTarget=target},ctor:function(type){this._type=type},getType:function(){return this._type},stopPropagation:function(){this._isStopped=!0},isStopped:function(){return this._isStopped},getCurrentTarget:function(){return this._currentTarget}}),cc.Event.TOUCH=0,cc.Event.KEYBOARD=1,cc.Event.ACCELERATION=2,cc.Event.MOUSE=3,cc.Event.FOCUS=4,cc.Event.CUSTOM=6,cc.EventCustom=cc.Event.extend({_eventName:null,_userData:null,ctor:function(eventName){cc.Event.prototype.ctor.call(this,cc.Event.CUSTOM),this._eventName=eventName},setUserData:function(data){this._userData=data},getUserData:function(){return this._userData},getEventName:function(){return this._eventName}}),cc.EventMouse=cc.Event.extend({_eventType:0,_button:0,_x:0,_y:0,_prevX:0,_prevY:0,_scrollX:0,_scrollY:0,ctor:function(eventType){cc.Event.prototype.ctor.call(this,cc.Event.MOUSE),this._eventType=eventType},setScrollData:function(scrollX,scrollY){this._scrollX=scrollX,this._scrollY=scrollY},getScrollX:function(){return this._scrollX},getScrollY:function(){return this._scrollY},setLocation:function(x,y){this._x=x,this._y=y},getLocation:function(){return{x:this._x,y:this._y}},getLocationInView:function(){return{x:this._x,y:cc.view._designResolutionSize.height-this._y}},_setPrevCursor:function(x,y){this._prevX=x,this._prevY=y},getDelta:function(){return{x:this._x-this._prevX,y:this._y-this._prevY}},getDeltaX:function(){return this._x-this._prevX},getDeltaY:function(){return this._y-this._prevY},setButton:function(button){this._button=button},getButton:function(){return this._button},getLocationX:function(){return this._x},getLocationY:function(){return this._y}}),cc.EventMouse.NONE=0,cc.EventMouse.DOWN=1,cc.EventMouse.UP=2,cc.EventMouse.MOVE=3,cc.EventMouse.SCROLL=4,cc.EventMouse.BUTTON_LEFT=0,cc.EventMouse.BUTTON_RIGHT=2,cc.EventMouse.BUTTON_MIDDLE=1,cc.EventMouse.BUTTON_4=3,cc.EventMouse.BUTTON_5=4,cc.EventMouse.BUTTON_6=5,cc.EventMouse.BUTTON_7=6,cc.EventMouse.BUTTON_8=7,cc.EventTouch=cc.Event.extend({_eventCode:0,_touches:null,ctor:function(arr){cc.Event.prototype.ctor.call(this,cc.Event.TOUCH),this._touches=arr||[]},getEventCode:function(){return this._eventCode},getTouches:function(){return this._touches},_setEventCode:function(eventCode){this._eventCode=eventCode},_setTouches:function(touches){this._touches=touches}}),cc.EventTouch.MAX_TOUCHES=5,cc.EventTouch.EventCode={BEGAN:0,MOVED:1,ENDED:2,CANCELLED:3},cc.EventFocus=cc.Event.extend({_widgetGetFocus:null,_widgetLoseFocus:null,ctor:function(widgetLoseFocus,widgetGetFocus){cc.Event.prototype.ctor.call(this,cc.Event.FOCUS),this._widgetGetFocus=widgetGetFocus,this._widgetLoseFocus=widgetLoseFocus}}),cc.EventListener=cc.Class.extend({_onEvent:null,_type:0,_listenerID:null,_registered:!1,_fixedPriority:0,_node:null,_paused:!0,_isEnabled:!0,ctor:function(type,listenerID,callback){this._onEvent=callback,this._type=type||0,this._listenerID=listenerID||""},_setPaused:function(paused){this._paused=paused},_isPaused:function(){return this._paused},_setRegistered:function(registered){this._registered=registered},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(fixedPriority){this._fixedPriority=fixedPriority},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(node){this._node=node},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!==this._onEvent},clone:function(){return null},setEnabled:function(enabled){this._isEnabled=enabled},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}}),cc.EventListener.UNKNOWN=0,cc.EventListener.TOUCH_ONE_BY_ONE=1,cc.EventListener.TOUCH_ALL_AT_ONCE=2,cc.EventListener.KEYBOARD=3,cc.EventListener.MOUSE=4,cc.EventListener.ACCELERATION=6,cc.EventListener.FOCUS=7,cc.EventListener.CUSTOM=8,cc._EventListenerCustom=cc.EventListener.extend({_onCustomEvent:null,ctor:function(listenerId,callback){this._onCustomEvent=callback;var selfPointer=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.CUSTOM,listenerId,function(event){null!==selfPointer._onCustomEvent&&selfPointer._onCustomEvent(event)})},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent},clone:function(){return new cc._EventListenerCustom(this._listenerID,this._onCustomEvent)}}),cc._EventListenerCustom.create=function(eventName,callback){return new cc._EventListenerCustom(eventName,callback)},cc._EventListenerMouse=cc.EventListener.extend({onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,ctor:function(){var selfPointer=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.MOUSE,cc._EventListenerMouse.LISTENER_ID,function(event){var eventType=cc.EventMouse;switch(event._eventType){case eventType.DOWN:selfPointer.onMouseDown&&selfPointer.onMouseDown(event);break;case eventType.UP:selfPointer.onMouseUp&&selfPointer.onMouseUp(event);break;case eventType.MOVE:selfPointer.onMouseMove&&selfPointer.onMouseMove(event);break;case eventType.SCROLL:selfPointer.onMouseScroll&&selfPointer.onMouseScroll(event)}})},clone:function(){var eventListener=new cc._EventListenerMouse;return eventListener.onMouseDown=this.onMouseDown,eventListener.onMouseUp=this.onMouseUp,eventListener.onMouseMove=this.onMouseMove,eventListener.onMouseScroll=this.onMouseScroll,eventListener},checkAvailable:function(){return!0}}),cc._EventListenerMouse.LISTENER_ID="__cc_mouse",cc._EventListenerMouse.create=function(){return new cc._EventListenerMouse},cc._EventListenerTouchOneByOne=cc.EventListener.extend({_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,cc._EventListenerTouchOneByOne.LISTENER_ID,null),this._claimedTouches=[]},setSwallowTouches:function(needSwallow){this.swallowTouches=needSwallow},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var eventListener=new cc._EventListenerTouchOneByOne;return eventListener.onTouchBegan=this.onTouchBegan,eventListener.onTouchMoved=this.onTouchMoved,eventListener.onTouchEnded=this.onTouchEnded,eventListener.onTouchCancelled=this.onTouchCancelled,eventListener.swallowTouches=this.swallowTouches,eventListener},checkAvailable:function(){return!!this.onTouchBegan||(cc.log(cc._LogInfos._EventListenerTouchOneByOne_checkAvailable),!1)}}),cc._EventListenerTouchOneByOne.LISTENER_ID="__cc_touch_one_by_one",cc._EventListenerTouchOneByOne.create=function(){return new cc._EventListenerTouchOneByOne},cc._EventListenerTouchAllAtOnce=cc.EventListener.extend({onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,cc._EventListenerTouchAllAtOnce.LISTENER_ID,null)},clone:function(){var eventListener=new cc._EventListenerTouchAllAtOnce;return eventListener.onTouchesBegan=this.onTouchesBegan,eventListener.onTouchesMoved=this.onTouchesMoved,eventListener.onTouchesEnded=this.onTouchesEnded,eventListener.onTouchesCancelled=this.onTouchesCancelled,eventListener},checkAvailable:function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(cc.log(cc._LogInfos._EventListenerTouchAllAtOnce_checkAvailable),!1)}}),cc._EventListenerTouchAllAtOnce.LISTENER_ID="__cc_touch_all_at_once",cc._EventListenerTouchAllAtOnce.create=function(){return new cc._EventListenerTouchAllAtOnce},cc.EventListener.create=function(argObj){cc.assert(argObj&&argObj.event,cc._LogInfos.EventListener_create);var listenerType=argObj.event;delete argObj.event;var listener=null;for(var key in listenerType===cc.EventListener.TOUCH_ONE_BY_ONE?listener=new cc._EventListenerTouchOneByOne:listenerType===cc.EventListener.TOUCH_ALL_AT_ONCE?listener=new cc._EventListenerTouchAllAtOnce:listenerType===cc.EventListener.MOUSE?listener=new cc._EventListenerMouse:listenerType===cc.EventListener.CUSTOM?(listener=new cc._EventListenerCustom(argObj.eventName,argObj.callback),delete argObj.eventName,delete argObj.callback):listenerType===cc.EventListener.KEYBOARD?listener=new cc._EventListenerKeyboard:listenerType===cc.EventListener.ACCELERATION?(listener=new cc._EventListenerAcceleration(argObj.callback),delete argObj.callback):listenerType===cc.EventListener.FOCUS&&(listener=new cc._EventListenerFocus),argObj)listener[key]=argObj[key];return listener},cc._EventListenerFocus=cc.EventListener.extend({clone:function(){var listener=new cc._EventListenerFocus;return listener.onFocusChanged=this.onFocusChanged,listener},checkAvailable:function(){return!!this.onFocusChanged||(cc.log("Invalid EventListenerFocus!"),!1)},onFocusChanged:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.FOCUS,cc._EventListenerFocus.LISTENER_ID,function(event){this.onFocusChanged&&this.onFocusChanged(event._widgetLoseFocus,event._widgetGetFocus)})}}),cc._EventListenerFocus.LISTENER_ID="__cc_focus_event",cc._EventListenerVector=cc.Class.extend({_fixedListeners:null,_sceneGraphListeners:null,gt0Index:0,ctor:function(){this._fixedListeners=[],this._sceneGraphListeners=[]},size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(listener){0===listener._getFixedPriority()?this._sceneGraphListeners.push(listener):this._fixedListeners.push(listener)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}}),cc.eventManager={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_nodePriorityMap:{},_globalZOrderNodeMap:{},_toAddedListeners:[],_toRemovedListeners:[],_dirtyNodes:[],_inDispatch:0,_isEnabled:!1,_nodePriorityIndex:0,_internalCustomListenerIDs:[cc.game.EVENT_HIDE,cc.game.EVENT_SHOW],_setDirtyForNode:function(node){null!=this._nodeListenersMap[node.__instanceId]&&this._dirtyNodes.push(node);for(var _children=node.getChildren(),i=0,len=_children.length;i<len;i++)this._setDirtyForNode(_children[i])},pauseTarget:function(node,recursive){var i,len,listeners=this._nodeListenersMap[node.__instanceId];if(listeners)for(i=0,len=listeners.length;i<len;i++)listeners[i]._setPaused(!0);if(!0===recursive){var locChildren=node.getChildren();for(i=0,len=locChildren.length;i<len;i++)this.pauseTarget(locChildren[i],!0)}},resumeTarget:function(node,recursive){var i,len,listeners=this._nodeListenersMap[node.__instanceId];if(listeners)for(i=0,len=listeners.length;i<len;i++)listeners[i]._setPaused(!1);if(this._setDirtyForNode(node),!0===recursive){var locChildren=node.getChildren();for(i=0,len=locChildren.length;i<len;i++)this.resumeTarget(locChildren[i],!0)}},_addListener:function(listener){0===this._inDispatch?this._forceAddEventListener(listener):this._toAddedListeners.push(listener)},_forceAddEventListener:function(listener){var listenerID=listener._getListenerID(),listeners=this._listenersMap[listenerID];if(listeners||(listeners=new cc._EventListenerVector,this._listenersMap[listenerID]=listeners),listeners.push(listener),0===listener._getFixedPriority()){this._setDirty(listenerID,this.DIRTY_SCENE_GRAPH_PRIORITY);var node=listener._getSceneGraphPriority();null===node&&cc.log(cc._LogInfos.eventManager__forceAddEventListener),this._associateNodeAndEventListener(node,listener),node.isRunning()&&this.resumeTarget(node)}else this._setDirty(listenerID,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(listenerID){return this._listenersMap[listenerID]},_updateDirtyFlagForSceneGraph:function(){if(0!==this._dirtyNodes.length){for(var selListeners,selListener,locDirtyNodes=this._dirtyNodes,locNodeListenersMap=this._nodeListenersMap,i=0,len=locDirtyNodes.length;i<len;i++)if(selListeners=locNodeListenersMap[locDirtyNodes[i].__instanceId])for(var j=0,listenersLen=selListeners.length;j<listenersLen;j++)(selListener=selListeners[j])&&this._setDirty(selListener._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyNodes.length=0}},_removeAllListenersInVector:function(listenerVector){if(listenerVector)for(var selListener,i=0;i<listenerVector.length;)(selListener=listenerVector[i])._setRegistered(!1),null!=selListener._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(selListener._getSceneGraphPriority(),selListener),selListener._setSceneGraphPriority(null)),0===this._inDispatch?cc.arrayRemoveObject(listenerVector,selListener):++i},_removeListenersForListenerID:function(listenerID){var i,listeners=this._listenersMap[listenerID];if(listeners){var fixedPriorityListeners=listeners.getFixedPriorityListeners(),sceneGraphPriorityListeners=listeners.getSceneGraphPriorityListeners();this._removeAllListenersInVector(sceneGraphPriorityListeners),this._removeAllListenersInVector(fixedPriorityListeners),delete this._priorityDirtyFlagMap[listenerID],this._inDispatch||(listeners.clear(),delete this._listenersMap[listenerID])}var listener,locToAddedListeners=this._toAddedListeners;for(i=0;i<locToAddedListeners.length;)(listener=locToAddedListeners[i])&&listener._getListenerID()===listenerID?cc.arrayRemoveObject(locToAddedListeners,listener):++i},_sortEventListeners:function(listenerID){var dirtyFlag=this.DIRTY_NONE,locFlagMap=this._priorityDirtyFlagMap;if(locFlagMap[listenerID]&&(dirtyFlag=locFlagMap[listenerID]),dirtyFlag!==this.DIRTY_NONE&&(locFlagMap[listenerID]=this.DIRTY_NONE,dirtyFlag&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(listenerID),dirtyFlag&this.DIRTY_SCENE_GRAPH_PRIORITY)){var rootNode=cc.director.getRunningScene();rootNode?this._sortListenersOfSceneGraphPriority(listenerID,rootNode):locFlagMap[listenerID]=this.DIRTY_SCENE_GRAPH_PRIORITY}},_sortListenersOfSceneGraphPriority:function(listenerID,rootNode){var listeners=this._getListeners(listenerID);if(listeners){var sceneGraphListener=listeners.getSceneGraphPriorityListeners();sceneGraphListener&&0!==sceneGraphListener.length&&(this._nodePriorityIndex=0,this._nodePriorityMap={},this._visitTarget(rootNode,!0),listeners.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes))}},_sortEventListenersOfSceneGraphPriorityDes:function(l1,l2){var locNodePriorityMap=cc.eventManager._nodePriorityMap,node1=l1._getSceneGraphPriority(),node2=l2._getSceneGraphPriority();return l2&&node2&&locNodePriorityMap[node2.__instanceId]?l1&&node1&&locNodePriorityMap[node1.__instanceId]?locNodePriorityMap[l2._getSceneGraphPriority().__instanceId]-locNodePriorityMap[l1._getSceneGraphPriority().__instanceId]:1:-1},_sortListenersOfFixedPriority:function(listenerID){var listeners=this._listenersMap[listenerID];if(listeners){var fixedListeners=listeners.getFixedPriorityListeners();if(fixedListeners&&0!==fixedListeners.length){fixedListeners.sort(this._sortListenersOfFixedPriorityAsc);for(var index=0,len=fixedListeners.length;index<len&&!(0<=fixedListeners[index]._getFixedPriority());)++index;listeners.gt0Index=index}}},_sortListenersOfFixedPriorityAsc:function(l1,l2){return l1._getFixedPriority()-l2._getFixedPriority()},_onUpdateListeners:function(listeners){var i,selListener,idx,fixedPriorityListeners=listeners.getFixedPriorityListeners(),sceneGraphPriorityListeners=listeners.getSceneGraphPriorityListeners(),toRemovedListeners=this._toRemovedListeners;if(sceneGraphPriorityListeners)for(i=0;i<sceneGraphPriorityListeners.length;)(selListener=sceneGraphPriorityListeners[i])._isRegistered()?++i:(cc.arrayRemoveObject(sceneGraphPriorityListeners,selListener),-1!==(idx=toRemovedListeners.indexOf(selListener))&&toRemovedListeners.splice(idx,1));if(fixedPriorityListeners)for(i=0;i<fixedPriorityListeners.length;)(selListener=fixedPriorityListeners[i])._isRegistered()?++i:(cc.arrayRemoveObject(fixedPriorityListeners,selListener),-1!==(idx=toRemovedListeners.indexOf(selListener))&&toRemovedListeners.splice(idx,1));sceneGraphPriorityListeners&&0===sceneGraphPriorityListeners.length&&listeners.clearSceneGraphListeners(),fixedPriorityListeners&&0===fixedPriorityListeners.length&&listeners.clearFixedListeners()},frameUpdateListeners:function(){var locListenersMap=this._listenersMap,locPriorityDirtyFlagMap=this._priorityDirtyFlagMap;for(var selKey in locListenersMap)locListenersMap[selKey].empty()&&(delete locPriorityDirtyFlagMap[selKey],delete locListenersMap[selKey]);var locToAddedListeners=this._toAddedListeners;if(0!==locToAddedListeners.length){for(var i=0,len=locToAddedListeners.length;i<len;i++)this._forceAddEventListener(locToAddedListeners[i]);locToAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()},_updateTouchListeners:function(event){var locInDispatch=this._inDispatch;if(cc.assert(0<locInDispatch,cc._LogInfos.EventManager__updateListeners),!(1<locInDispatch)){var listeners;(listeners=this._listenersMap[cc._EventListenerTouchOneByOne.LISTENER_ID])&&this._onUpdateListeners(listeners),(listeners=this._listenersMap[cc._EventListenerTouchAllAtOnce.LISTENER_ID])&&this._onUpdateListeners(listeners),cc.assert(1===locInDispatch,cc._LogInfos.EventManager__updateListeners_2);var locToAddedListeners=this._toAddedListeners;if(0!==locToAddedListeners.length){for(var i=0,len=locToAddedListeners.length;i<len;i++)this._forceAddEventListener(locToAddedListeners[i]);locToAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},_cleanToRemovedListeners:function(){for(var toRemovedListeners=this._toRemovedListeners,i=0;i<toRemovedListeners.length;i++){var selListener=toRemovedListeners[i],listeners=this._listenersMap[selListener._getListenerID()];if(listeners){var idx,fixedPriorityListeners=listeners.getFixedPriorityListeners(),sceneGraphPriorityListeners=listeners.getSceneGraphPriorityListeners();sceneGraphPriorityListeners&&-1!==(idx=sceneGraphPriorityListeners.indexOf(selListener))&&sceneGraphPriorityListeners.splice(idx,1),fixedPriorityListeners&&-1!==(idx=fixedPriorityListeners.indexOf(selListener))&&fixedPriorityListeners.splice(idx,1)}}toRemovedListeners.length=0},_onTouchEventCallback:function(listener,argsObj){if(!listener._isRegistered)return!1;var event=argsObj.event,selTouch=argsObj.selTouch;event._setCurrentTarget(listener._node);var removedIdx,isClaimed=!1,getCode=event.getEventCode(),eventCode=cc.EventTouch.EventCode;return getCode===eventCode.BEGAN?listener.onTouchBegan&&(isClaimed=listener.onTouchBegan(selTouch,event))&&listener._registered&&listener._claimedTouches.push(selTouch):0<listener._claimedTouches.length&&-1!==(removedIdx=listener._claimedTouches.indexOf(selTouch))&&(isClaimed=!0,getCode===eventCode.MOVED&&listener.onTouchMoved?listener.onTouchMoved(selTouch,event):getCode===eventCode.ENDED?(listener.onTouchEnded&&listener.onTouchEnded(selTouch,event),listener._registered&&listener._claimedTouches.splice(removedIdx,1)):getCode===eventCode.CANCELLED&&(listener.onTouchCancelled&&listener.onTouchCancelled(selTouch,event),listener._registered&&listener._claimedTouches.splice(removedIdx,1))),event.isStopped()?(cc.eventManager._updateTouchListeners(event),!0):!!(isClaimed&&listener._registered&&listener.swallowTouches)&&(argsObj.needsMutableSet&&argsObj.touches.splice(selTouch,1),!0)},_dispatchTouchEvent:function(event){this._sortEventListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._sortEventListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);var oneByOneListeners=this._getListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),allAtOnceListeners=this._getListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);if(null!==oneByOneListeners||null!==allAtOnceListeners){var originalTouches=event.getTouches(),mutableTouches=cc.copyArray(originalTouches),oneByOneArgsObj={event:event,needsMutableSet:oneByOneListeners&&allAtOnceListeners,touches:mutableTouches,selTouch:null};if(oneByOneListeners)for(var i=0;i<originalTouches.length;i++)if(oneByOneArgsObj.selTouch=originalTouches[i],this._dispatchEventToListeners(oneByOneListeners,this._onTouchEventCallback,oneByOneArgsObj),event.isStopped())return;allAtOnceListeners&&0<mutableTouches.length&&(this._dispatchEventToListeners(allAtOnceListeners,this._onTouchesEventCallback,{event:event,touches:mutableTouches}),event.isStopped())||this._updateTouchListeners(event)}},_onTouchesEventCallback:function(listener,callbackParams){if(!listener._registered)return!1;var eventCode=cc.EventTouch.EventCode,event=callbackParams.event,touches=callbackParams.touches,getCode=event.getEventCode();return event._setCurrentTarget(listener._node),getCode===eventCode.BEGAN&&listener.onTouchesBegan?listener.onTouchesBegan(touches,event):getCode===eventCode.MOVED&&listener.onTouchesMoved?listener.onTouchesMoved(touches,event):getCode===eventCode.ENDED&&listener.onTouchesEnded?listener.onTouchesEnded(touches,event):getCode===eventCode.CANCELLED&&listener.onTouchesCancelled&&listener.onTouchesCancelled(touches,event),!!event.isStopped()&&(cc.eventManager._updateTouchListeners(event),!0)},_associateNodeAndEventListener:function(node,listener){var listeners=this._nodeListenersMap[node.__instanceId];listeners||(listeners=[],this._nodeListenersMap[node.__instanceId]=listeners),listeners.push(listener)},_dissociateNodeAndEventListener:function(node,listener){var listeners=this._nodeListenersMap[node.__instanceId];listeners&&(cc.arrayRemoveObject(listeners,listener),0===listeners.length&&delete this._nodeListenersMap[node.__instanceId])},_dispatchEventToListeners:function(listeners,onEvent,eventOrArgs){var j,selListener,shouldStopPropagation=!1,fixedPriorityListeners=listeners.getFixedPriorityListeners(),sceneGraphPriorityListeners=listeners.getSceneGraphPriorityListeners(),i=0;if(fixedPriorityListeners&&0!==fixedPriorityListeners.length)for(;i<listeners.gt0Index;++i)if((selListener=fixedPriorityListeners[i]).isEnabled()&&!selListener._isPaused()&&selListener._isRegistered()&&onEvent(selListener,eventOrArgs)){shouldStopPropagation=!0;break}if(sceneGraphPriorityListeners&&!shouldStopPropagation)for(j=0;j<sceneGraphPriorityListeners.length;j++)if((selListener=sceneGraphPriorityListeners[j]).isEnabled()&&!selListener._isPaused()&&selListener._isRegistered()&&onEvent(selListener,eventOrArgs)){shouldStopPropagation=!0;break}if(fixedPriorityListeners&&!shouldStopPropagation)for(;i<fixedPriorityListeners.length;++i)if((selListener=fixedPriorityListeners[i]).isEnabled()&&!selListener._isPaused()&&selListener._isRegistered()&&onEvent(selListener,eventOrArgs)){shouldStopPropagation=!0;break}},_setDirty:function(listenerID,flag){var locDirtyFlagMap=this._priorityDirtyFlagMap;null==locDirtyFlagMap[listenerID]?locDirtyFlagMap[listenerID]=flag:locDirtyFlagMap[listenerID]=flag|locDirtyFlagMap[listenerID]},_visitTarget:function(node,isRootNode){var children=node.getChildren(),i=0,childrenCount=children.length,locGlobalZOrderNodeMap=this._globalZOrderNodeMap,locNodeListenersMap=this._nodeListenersMap;if(0<childrenCount){for(var child;i<childrenCount&&(child=children[i])&&child.getLocalZOrder()<0;i++)this._visitTarget(child,!1);for(null!=locNodeListenersMap[node.__instanceId]&&(locGlobalZOrderNodeMap[node.getGlobalZOrder()]||(locGlobalZOrderNodeMap[node.getGlobalZOrder()]=[]),locGlobalZOrderNodeMap[node.getGlobalZOrder()].push(node.__instanceId));i<childrenCount;i++)(child=children[i])&&this._visitTarget(child,!1)}else null!=locNodeListenersMap[node.__instanceId]&&(locGlobalZOrderNodeMap[node.getGlobalZOrder()]||(locGlobalZOrderNodeMap[node.getGlobalZOrder()]=[]),locGlobalZOrderNodeMap[node.getGlobalZOrder()].push(node.__instanceId));if(isRootNode){var globalZOrders=[];for(var selKey in locGlobalZOrderNodeMap)globalZOrders.push(selKey);globalZOrders.sort(this._sortNumberAsc);var selZOrders,j,zOrdersLen=globalZOrders.length,locNodePriorityMap=this._nodePriorityMap;for(i=0;i<zOrdersLen;i++)for(selZOrders=locGlobalZOrderNodeMap[globalZOrders[i]],j=0;j<selZOrders.length;j++)locNodePriorityMap[selZOrders[j]]=++this._nodePriorityIndex;this._globalZOrderNodeMap={}}},_sortNumberAsc:function(a,b){return a-b},addListener:function(listener,nodeOrPriority){if(cc.assert(listener&&nodeOrPriority,cc._LogInfos.eventManager_addListener_2),listener instanceof cc.EventListener){if(listener._isRegistered())return void cc.log(cc._LogInfos.eventManager_addListener_4)}else cc.assert(!cc.isNumber(nodeOrPriority),cc._LogInfos.eventManager_addListener_3),listener=cc.EventListener.create(listener);if(listener.checkAvailable()){if(cc.isNumber(nodeOrPriority)){if(0===nodeOrPriority)return void cc.log(cc._LogInfos.eventManager_addListener);listener._setSceneGraphPriority(null),listener._setFixedPriority(nodeOrPriority),listener._setRegistered(!0),listener._setPaused(!1),this._addListener(listener)}else listener._setSceneGraphPriority(nodeOrPriority),listener._setFixedPriority(0),listener._setRegistered(!0),this._addListener(listener);return listener}},addCustomListener:function(eventName,callback){var listener=new cc._EventListenerCustom(eventName,callback);return this.addListener(listener,1),listener},removeListener:function(listener){if(null!=listener){var isFound,locListener=this._listenersMap;for(var selKey in locListener){var listeners=locListener[selKey],fixedPriorityListeners=listeners.getFixedPriorityListeners(),sceneGraphPriorityListeners=listeners.getSceneGraphPriorityListeners();if((isFound=this._removeListenerInVector(sceneGraphPriorityListeners,listener))?this._setDirty(listener._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(isFound=this._removeListenerInVector(fixedPriorityListeners,listener))&&this._setDirty(listener._getListenerID(),this.DIRTY_FIXED_PRIORITY),listeners.empty()&&(delete this._priorityDirtyFlagMap[listener._getListenerID()],delete locListener[selKey]),isFound)break}if(!isFound)for(var locToAddedListeners=this._toAddedListeners,i=0,len=locToAddedListeners.length;i<len;i++){var selListener=locToAddedListeners[i];if(selListener===listener){cc.arrayRemoveObject(locToAddedListeners,selListener),selListener._setRegistered(!1);break}}}},_removeListenerInCallback:function(listeners,callback){if(null==listeners)return!1;for(var i=0,len=listeners.length;i<len;i++){var selListener=listeners[i];if(selListener._onCustomEvent===callback||selListener._onEvent===callback)return selListener._setRegistered(!1),null!=selListener._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(selListener._getSceneGraphPriority(),selListener),selListener._setSceneGraphPriority(null)),0===this._inDispatch&&cc.arrayRemoveObject(listeners,selListener),!0}return!1},_removeListenerInVector:function(listeners,listener){if(null==listeners)return!1;for(var i=0,len=listeners.length;i<len;i++){var selListener=listeners[i];if(selListener===listener)return selListener._setRegistered(!1),null!=selListener._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(selListener._getSceneGraphPriority(),selListener),selListener._setSceneGraphPriority(null)),0===this._inDispatch?cc.arrayRemoveObject(listeners,selListener):this._toRemovedListeners.push(selListener),!0}return!1},removeListeners:function(listenerType,recursive){var _t=this;if(listenerType instanceof cc.Node){delete _t._nodePriorityMap[listenerType.__instanceId],cc.arrayRemoveObject(_t._dirtyNodes,listenerType);var i,listeners=_t._nodeListenersMap[listenerType.__instanceId];if(listeners){var listenersCopy=cc.copyArray(listeners);for(i=0;i<listenersCopy.length;i++)_t.removeListener(listenersCopy[i]);listenersCopy.length=0}var locToAddedListeners=_t._toAddedListeners;for(i=0;i<locToAddedListeners.length;){var listener=locToAddedListeners[i];listener._getSceneGraphPriority()===listenerType?(listener._setSceneGraphPriority(null),listener._setRegistered(!1),locToAddedListeners.splice(i,1)):++i}if(!0===recursive){var len,locChildren=listenerType.getChildren();for(i=0,len=locChildren.length;i<len;i++)_t.removeListeners(locChildren[i],!0)}}else listenerType===cc.EventListener.TOUCH_ONE_BY_ONE?_t._removeListenersForListenerID(cc._EventListenerTouchOneByOne.LISTENER_ID):listenerType===cc.EventListener.TOUCH_ALL_AT_ONCE?_t._removeListenersForListenerID(cc._EventListenerTouchAllAtOnce.LISTENER_ID):listenerType===cc.EventListener.MOUSE?_t._removeListenersForListenerID(cc._EventListenerMouse.LISTENER_ID):listenerType===cc.EventListener.ACCELERATION?_t._removeListenersForListenerID(cc._EventListenerAcceleration.LISTENER_ID):listenerType===cc.EventListener.KEYBOARD?_t._removeListenersForListenerID(cc._EventListenerKeyboard.LISTENER_ID):cc.log(cc._LogInfos.eventManager_removeListeners)},removeCustomListeners:function(customEventName){this._removeListenersForListenerID(customEventName)},removeAllListeners:function(){var locListeners=this._listenersMap,locInternalCustomEventIDs=this._internalCustomListenerIDs;for(var selKey in locListeners)-1===locInternalCustomEventIDs.indexOf(selKey)&&this._removeListenersForListenerID(selKey)},setPriority:function(listener,fixedPriority){if(null!=listener){var locListeners=this._listenersMap;for(var selKey in locListeners){var fixedPriorityListeners=locListeners[selKey].getFixedPriorityListeners();if(fixedPriorityListeners&&-1!==fixedPriorityListeners.indexOf(listener))return null!=listener._getSceneGraphPriority()&&cc.log(cc._LogInfos.eventManager_setPriority),void(listener._getFixedPriority()!==fixedPriority&&(listener._setFixedPriority(fixedPriority),this._setDirty(listener._getListenerID(),this.DIRTY_FIXED_PRIORITY)))}}},setEnabled:function(enabled){this._isEnabled=enabled},isEnabled:function(){return this._isEnabled},dispatchEvent:function(event){if(this._isEnabled){if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,!event||!event.getType)throw new Error("event is undefined");if(event._type===cc.Event.TOUCH)return this._dispatchTouchEvent(event),void this._inDispatch--;var listenerID=function(event){var eventType=cc.Event,getType=event._type;return getType===eventType.ACCELERATION?cc._EventListenerAcceleration.LISTENER_ID:getType===eventType.CUSTOM?event._eventName:getType===eventType.KEYBOARD?cc._EventListenerKeyboard.LISTENER_ID:getType===eventType.MOUSE?cc._EventListenerMouse.LISTENER_ID:getType===eventType.FOCUS?cc._EventListenerFocus.LISTENER_ID:(getType===eventType.TOUCH&&cc.log(cc._LogInfos.__getListenerID),"")}(event);this._sortEventListeners(listenerID);var selListeners=this._listenersMap[listenerID];selListeners&&(this._dispatchEventToListeners(selListeners,this._onListenerCallback,event),this._onUpdateListeners(selListeners)),this._inDispatch--}},_onListenerCallback:function(listener,event){return event._setCurrentTarget(listener._getSceneGraphPriority()),listener._onEvent(event),event.isStopped()},dispatchCustomEvent:function(eventName,optionalUserData){var ev=new cc.EventCustom(eventName);ev.setUserData(optionalUserData),this.dispatchEvent(ev)}},cc.EventAcceleration=cc.Event.extend({_acc:null,ctor:function(acc){cc.Event.prototype.ctor.call(this,cc.Event.ACCELERATION),this._acc=acc}}),cc.EventKeyboard=cc.Event.extend({_keyCode:0,_isPressed:!1,ctor:function(keyCode,isPressed){cc.Event.prototype.ctor.call(this,cc.Event.KEYBOARD),this._keyCode=keyCode,this._isPressed=isPressed}}),cc._EventListenerAcceleration=cc.EventListener.extend({_onAccelerationEvent:null,ctor:function(callback){this._onAccelerationEvent=callback;var selfPointer=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.ACCELERATION,cc._EventListenerAcceleration.LISTENER_ID,function(event){selfPointer._onAccelerationEvent(event._acc,event)})},checkAvailable:function(){return cc.assert(this._onAccelerationEvent,cc._LogInfos._EventListenerAcceleration_checkAvailable),!0},clone:function(){return new cc._EventListenerAcceleration(this._onAccelerationEvent)}}),cc._EventListenerAcceleration.LISTENER_ID="__cc_acceleration",cc._EventListenerAcceleration.create=function(callback){return new cc._EventListenerAcceleration(callback)},cc._EventListenerKeyboard=cc.EventListener.extend({onKeyPressed:null,onKeyReleased:null,ctor:function(){var selfPointer=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.KEYBOARD,cc._EventListenerKeyboard.LISTENER_ID,function(event){event._isPressed?selfPointer.onKeyPressed&&selfPointer.onKeyPressed(event._keyCode,event):selfPointer.onKeyReleased&&selfPointer.onKeyReleased(event._keyCode,event)})},clone:function(){var eventListener=new cc._EventListenerKeyboard;return eventListener.onKeyPressed=this.onKeyPressed,eventListener.onKeyReleased=this.onKeyReleased,eventListener},checkAvailable:function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(cc.log(cc._LogInfos._EventListenerKeyboard_checkAvailable),!1)}}),cc._EventListenerKeyboard.LISTENER_ID="__cc_keyboard",cc._EventListenerKeyboard.create=function(){return new cc._EventListenerKeyboard};var GlobalVertexBuffer=function(){var GlobalVertexBuffer=function(gl,byteLength){this.gl=gl,this.vertexBuffer=gl.createBuffer(),this.size=888,this.byteLength=byteLength||3552*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,this.data=new ArrayBuffer(this.byteLength),this.dataArray=new Float32Array(this.data),gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,this.dataArray,gl.DYNAMIC_DRAW),this._dirty=!1,this._spaces={0:this.byteLength}};return GlobalVertexBuffer.prototype={constructor:GlobalVertexBuffer,allocBuffer:function(offset,size){var space=this._spaces[offset];if(space&&size<=space){if(delete this._spaces[offset],size<space){var newOffset=offset+size;this._spaces[newOffset]=space-size}return!0}return!1},requestBuffer:function(size){var key,offset;for(key in this._spaces)if(offset=parseInt(key),size<=this._spaces[key]&&this.allocBuffer(offset,size))return offset;return-1},freeBuffer:function(offset,size){var i,key,end,spaces=this._spaces;for(key in spaces){if(offset<(i=parseInt(key)))break;if(i+spaces[key]>=offset){size=size+offset-i,offset=i;break}}end=offset+size,this._spaces[end]&&(size+=this._spaces[end],delete this._spaces[end]),this._spaces[offset]=size},setDirty:function(){this._dirty=!0},update:function(){this._dirty&&(this.gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferSubData(gl.ARRAY_BUFFER,0,this.dataArray),this._dirty=!1)},updateSubData:function(offset,dataArray){this.gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferSubData(gl.ARRAY_BUFFER,offset,dataArray)},destroy:function(){this.gl.deleteBuffer(this.vertexBuffer),this.data=null,this.positions=null,this.colors=null,this.texCoords=null,this.vertexBuffer=null}},GlobalVertexBuffer}();cc.rendererCanvas={childrenOrderDirty:!0,assignedZ:0,assignedZStep:1e-4,_transformNodePool:[],_renderCmds:[],_isCacheToCanvasOn:!1,_cacheToCanvasCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),_clearFillStyle:"rgb(0, 0, 0)",_dirtyRegion:null,_allNeedDraw:!0,_enableDirtyRegion:!1,_debugDirtyRegion:!1,_canUseDirtyRegion:!1,_dirtyRegionCountThreshold:10,getRenderCmd:function(renderableObject){return renderableObject._createRenderCmd()},enableDirtyRegion:function(enabled){this._enableDirtyRegion=enabled},isDirtyRegionEnabled:function(){return this._enableDirtyRegion},setDirtyRegionCountThreshold:function(threshold){this._dirtyRegionCountThreshold=threshold},_collectDirtyRegion:function(){var i,len,locCmds=this._renderCmds,dirtyRegion=this._dirtyRegion,dirtryRegionCount=0,result=!0,localStatus=cc.Node.CanvasRenderCmd.RegionStatus;for(i=0,len=locCmds.length;i<len;i++){var cmd=locCmds[i],regionFlag=cmd._regionFlag,oldRegion=cmd._oldRegion,currentRegion=cmd._currentRegion;regionFlag>localStatus.NotDirty&&(++dirtryRegionCount>this._dirtyRegionCountThreshold&&(result=!1),result&&(!currentRegion.isEmpty()&&dirtyRegion.addRegion(currentRegion),cmd._regionFlag>localStatus.Dirty&&!oldRegion.isEmpty()&&dirtyRegion.addRegion(oldRegion)),cmd._regionFlag=localStatus.NotDirty)}return result},_beginDrawDirtyRegion:function(ctxWrapper){var ctx=ctxWrapper.getContext(),dirtyList=this._dirtyRegion.getDirtyRegions();ctx.save();var scaleX=ctxWrapper._scaleX,scaleY=ctxWrapper._scaleY;ctxWrapper.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},scaleX,scaleY),ctx.beginPath();for(var index=0,count=dirtyList.length;index<count;++index){var region=dirtyList[index];ctx.rect(region._minX,-region._maxY,region._width,region._height)}ctx.clip()},_endDrawDirtyRegion:function(ctx){ctx.restore()},_debugDrawDirtyRegion:function(ctxWrapper){if(this._debugDirtyRegion){var ctx=ctxWrapper.getContext(),dirtyList=this._dirtyRegion.getDirtyRegions(),scaleX=ctxWrapper._scaleX,scaleY=ctxWrapper._scaleY;ctxWrapper.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},scaleX,scaleY),ctx.beginPath();for(var index=0,count=dirtyList.length;index<count;++index){var region=dirtyList[index];ctx.rect(region._minX,-region._maxY,region._width,region._height)}var oldstyle=ctx.fillStyle;ctx.fillStyle="green",ctx.fill(),ctx.fillStyle=oldstyle}},rendering:function(ctxWrapper){var dirtyRegion=this._dirtyRegion=this._dirtyRegion||new cc.DirtyRegion,viewport=cc._canvas,wrapper=ctxWrapper||cc._renderContext,ctx=wrapper.getContext(),scaleX=cc.view.getScaleX(),scaleY=cc.view.getScaleY();wrapper.setViewScale(scaleX,scaleY),wrapper.computeRealOffsetY();var i,len,dirtyList=this._dirtyRegion.getDirtyRegions(),locCmds=this._renderCmds,allNeedDraw=this._allNeedDraw||!this._enableDirtyRegion||!this._canUseDirtyRegion,collectResult=!0;for(allNeedDraw||(collectResult=this._collectDirtyRegion()),(allNeedDraw=allNeedDraw||!collectResult)||this._beginDrawDirtyRegion(wrapper),ctx.setTransform(1,0,0,1,0,0),ctx.clearRect(0,0,viewport.width,viewport.height),0===this._clearColor.r&&0===this._clearColor.g&&0===this._clearColor.b||(wrapper.setFillStyle(this._clearFillStyle),wrapper.setGlobalAlpha(this._clearColor.a),ctx.fillRect(0,0,viewport.width,viewport.height)),i=0,len=locCmds.length;i<len;i++){var cmd=locCmds[i],needRendering=!1,cmdRegion=cmd._currentRegion;if(!cmdRegion||allNeedDraw)needRendering=!0;else for(var index=0,count=dirtyList.length;index<count;++index)if(dirtyList[index].intersects(cmdRegion)){needRendering=!0;break}needRendering&&cmd.rendering(wrapper,scaleX,scaleY)}allNeedDraw||(this._debugDrawDirtyRegion(wrapper),this._endDrawDirtyRegion(ctx)),dirtyRegion.clear(),this._allNeedDraw=!1},_renderingToCacheCanvas:function(ctx,instanceID,scaleX,scaleY){ctx||cc.log("The context of RenderTexture is invalid."),scaleX=cc.isUndefined(scaleX)?1:scaleX,scaleY=cc.isUndefined(scaleY)?1:scaleY,instanceID=instanceID||this._currentID;var i,len,locCmds=this._cacheToCanvasCmds[instanceID];for(ctx.computeRealOffsetY(),i=0,len=locCmds.length;i<len;i++)locCmds[i].rendering(ctx,scaleX,scaleY);this._removeCache(instanceID);var locIDs=this._cacheInstanceIds;0===locIDs.length?this._isCacheToCanvasOn=!1:this._currentID=locIDs[locIDs.length-1]},_turnToCacheMode:function(renderTextureID){this._isCacheToCanvasOn=!0,renderTextureID=renderTextureID||0,this._cacheToCanvasCmds[renderTextureID]=[],-1===this._cacheInstanceIds.indexOf(renderTextureID)&&this._cacheInstanceIds.push(renderTextureID),this._currentID=renderTextureID},_turnToNormalMode:function(){this._isCacheToCanvasOn=!1},_removeCache:function(instanceID){instanceID=instanceID||this._currentID;var cmds=this._cacheToCanvasCmds[instanceID];cmds&&(cmds.length=0,delete this._cacheToCanvasCmds[instanceID]);var locIDs=this._cacheInstanceIds;cc.arrayRemoveObject(locIDs,instanceID)},resetFlag:function(){this.childrenOrderDirty=!1,this._transformNodePool.length=0},transform:function(){var locPool=this._transformNodePool;locPool.sort(this._sortNodeByLevelAsc);for(var i=0,len=locPool.length;i<len;i++)0!==locPool[i]._dirtyFlag&&locPool[i].updateStatus();locPool.length=0},transformDirty:function(){return 0<this._transformNodePool.length},_sortNodeByLevelAsc:function(n1,n2){return n1._curLevel-n2._curLevel},pushDirtyNode:function(node){this._transformNodePool.push(node)},clear:function(){},clearRenderCommands:function(){this._renderCmds.length=0,this._cacheInstanceIds.length=0,this._isCacheToCanvasOn=!1,this._allNeedDraw=!0,this._canUseDirtyRegion=!0},pushRenderCommand:function(cmd){if(cmd.needDraw())if(cmd._canUseDirtyRegion||(this._canUseDirtyRegion=!1),this._isCacheToCanvasOn){var currentId=this._currentID,cmdList=this._cacheToCanvasCmds[currentId];-1===cmdList.indexOf(cmd)&&cmdList.push(cmd)}else-1===this._renderCmds.indexOf(cmd)&&this._renderCmds.push(cmd)}},function(){cc.CanvasContextWrapper=function(context){this._context=context,this._saveCount=0,this._currentAlpha=context.globalAlpha,this._currentCompositeOperation=context.globalCompositeOperation,this._currentFillStyle=context.fillStyle,this._currentStrokeStyle=context.strokeStyle,this._offsetX=0,this._offsetY=0,this._realOffsetY=this.height,this._armatureMode=0};var proto=cc.CanvasContextWrapper.prototype;proto.resetCache=function(){var context=this._context;this._currentAlpha=context.globalAlpha,this._currentCompositeOperation=context.globalCompositeOperation,this._currentFillStyle=context.fillStyle,this._currentStrokeStyle=context.strokeStyle,this._realOffsetY=this._context.canvas.height+this._offsetY},proto.setOffset=function(x,y){this._offsetX=x,this._offsetY=y,this._realOffsetY=this._context.canvas.height+this._offsetY},proto.computeRealOffsetY=function(){this._realOffsetY=this._context.canvas.height+this._offsetY},proto.setViewScale=function(scaleX,scaleY){this._scaleX=scaleX,this._scaleY=scaleY},proto.getContext=function(){return this._context},proto.save=function(){this._context.save(),this._saveCount++},proto.restore=function(){this._context.restore(),this._saveCount--},proto.setGlobalAlpha=function(alpha){0<this._saveCount?this._context.globalAlpha=alpha:this._currentAlpha!==alpha&&(this._currentAlpha=alpha,this._context.globalAlpha=alpha)},proto.setCompositeOperation=function(compositionOperation){0<this._saveCount?this._context.globalCompositeOperation=compositionOperation:this._currentCompositeOperation!==compositionOperation&&(this._currentCompositeOperation=compositionOperation,this._context.globalCompositeOperation=compositionOperation)},proto.setFillStyle=function(fillStyle){0<this._saveCount?this._context.fillStyle=fillStyle:this._currentFillStyle!==fillStyle&&(this._currentFillStyle=fillStyle,this._context.fillStyle=fillStyle)},proto.setStrokeStyle=function(strokeStyle){0<this._saveCount?this._context.strokeStyle=strokeStyle:this._currentStrokeStyle!==strokeStyle&&(this._currentStrokeStyle=strokeStyle,this._context.strokeStyle=strokeStyle)},proto.setTransform=function(t,scaleX,scaleY){0<this._armatureMode?(this.restore(),this.save(),this._context.transform(t.a*scaleX,-t.b*scaleY,-t.c*scaleX,t.d*scaleY,t.tx*scaleX,-t.ty*scaleY)):this._context.setTransform(t.a*scaleX,-t.b*scaleY,-t.c*scaleX,t.d*scaleY,this._offsetX+t.tx*scaleX,this._realOffsetY-t.ty*scaleY)},proto._switchToArmatureMode=function(enable,t,scaleX,scaleY){enable?(this._armatureMode++,this._context.setTransform(t.a,t.c,t.b,t.d,this._offsetX+t.tx*scaleX,this._realOffsetY-t.ty*scaleY),this.save()):(this._armatureMode--,this.restore())}}(),cc.rendererWebGL=function(){var _batchedInfo={texture:null,blendSrc:null,blendDst:null,shader:null},_batchBroken=!1,_indexBuffer=null,_vertexBuffer=null,_maxVertexSize=0,_batchingSize=0,_indexSize=0,_sizePerVertex=6,_vertexData=null,_vertexDataF32=null,_vertexDataUI32=null,_indexData=null,_prevIndexSize=0,_pureQuad=!0;function initQuadBuffer(numVertex){var gl=cc._renderContext;null===_indexBuffer&&(_vertexBuffer=gl.createBuffer(),_indexBuffer=gl.createBuffer()),function(numVertex){var gl=cc._renderContext;if(_indexBuffer){var indexCount=6*Math.ceil(numVertex/4);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,_indexBuffer),_indexData=new Uint16Array(indexCount);for(var currentQuad=0,i=0,len=indexCount;i<len;i+=6)_indexData[i]=currentQuad+0,_indexData[i+1]=currentQuad+1,_indexData[i+2]=currentQuad+2,_indexData[i+3]=currentQuad+1,_indexData[i+4]=currentQuad+2,_indexData[i+5]=currentQuad+3,currentQuad+=4;gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,_indexData,gl.DYNAMIC_DRAW)}_vertexBuffer&&(_vertexData=new ArrayBuffer(4*(numVertex*_sizePerVertex)),_vertexDataF32=new Float32Array(_vertexData),_vertexDataUI32=new Uint32Array(_vertexData),gl.bindBuffer(gl.ARRAY_BUFFER,_vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,_vertexDataF32,gl.DYNAMIC_DRAW)),_maxVertexSize=numVertex-200}(numVertex)}var VertexType={QUAD:0,TRIANGLE:1,CUSTOM:2};return{mat4Identity:null,childrenOrderDirty:!0,assignedZ:0,assignedZStep:.01,VertexType:VertexType,_transformNodePool:[],_renderCmds:[],_isCacheToBufferOn:!1,_cacheToBufferCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),init:function(){var gl=cc._renderContext;gl.disable(gl.CULL_FACE),gl.disable(gl.DEPTH_TEST),this.mat4Identity=new cc.math.Matrix4,this.mat4Identity.identity(),initQuadBuffer(2e3),cc.sys.os===cc.sys.OS_IOS&&!0},getVertexSize:function(){return _maxVertexSize},getRenderCmd:function(renderableObject){return renderableObject._createRenderCmd()},_turnToCacheMode:function(renderTextureID){this._isCacheToBufferOn=!0,renderTextureID=renderTextureID||0,this._cacheToBufferCmds[renderTextureID]?this._cacheToBufferCmds[renderTextureID].length=0:this._cacheToBufferCmds[renderTextureID]=[],-1===this._cacheInstanceIds.indexOf(renderTextureID)&&this._cacheInstanceIds.push(renderTextureID),this._currentID=renderTextureID},_turnToNormalMode:function(){this._isCacheToBufferOn=!1},_removeCache:function(instanceID){instanceID=instanceID||this._currentID;var cmds=this._cacheToBufferCmds[instanceID];cmds&&(cmds.length=0,delete this._cacheToBufferCmds[instanceID]);var locIDs=this._cacheInstanceIds;cc.arrayRemoveObject(locIDs,instanceID)},_renderingToBuffer:function(renderTextureId){renderTextureId=renderTextureId||this._currentID;var locCmds=this._cacheToBufferCmds[renderTextureId],ctx=cc._renderContext;this.rendering(ctx,locCmds),this._removeCache(renderTextureId);var locIDs=this._cacheInstanceIds;0===locIDs.length?this._isCacheToBufferOn=!1:this._currentID=locIDs[locIDs.length-1]},resetFlag:function(){this.childrenOrderDirty&&(this.childrenOrderDirty=!1),this._transformNodePool.length=0},transform:function(){var i,len,locPool=this._transformNodePool;for(locPool.sort(this._sortNodeByLevelAsc),i=0,len=locPool.length;i<len;i++)locPool[i].updateStatus();locPool.length=0},transformDirty:function(){return 0<this._transformNodePool.length},_sortNodeByLevelAsc:function(n1,n2){return n1._curLevel-n2._curLevel},pushDirtyNode:function(node){this._transformNodePool.push(node)},clearRenderCommands:function(){this._renderCmds.length=0},clear:function(){var gl=cc._renderContext;gl.clearColor(this._clearColor.r/255,this._clearColor.g/255,this._clearColor.b/255,this._clearColor.a/255),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT)},setDepthTest:function(enable){var gl=cc._renderContext;enable?(gl.clearDepth(1),gl.enable(gl.DEPTH_TEST),gl.depthFunc(gl.LEQUAL)):gl.disable(gl.DEPTH_TEST)},pushRenderCommand:function(cmd){if(cmd.rendering||cmd.uploadData)if(this._isCacheToBufferOn){var currentId=this._currentID,cmdList=this._cacheToBufferCmds[currentId];if(null==cmdList)return;-1===cmdList.indexOf(cmd)&&cmdList.push(cmd)}else-1===this._renderCmds.indexOf(cmd)&&this._renderCmds.push(cmd)},_increaseBatchingSize:function(increment,vertexType,indices){var i,curr;switch(vertexType=vertexType||VertexType.QUAD){case VertexType.QUAD:for(i=0;i<increment;i+=4)curr=_batchingSize+i,_indexData[_indexSize++]=curr+0,_indexData[_indexSize++]=curr+1,_indexData[_indexSize++]=curr+2,_indexData[_indexSize++]=curr+1,_indexData[_indexSize++]=curr+2,_indexData[_indexSize++]=curr+3;break;case VertexType.TRIANGLE:for(_pureQuad=!1,i=0;i<increment;i+=3)curr=_batchingSize+i,_indexData[_indexSize++]=curr+0,_indexData[_indexSize++]=curr+1,_indexData[_indexSize++]=curr+2;break;case VertexType.CUSTOM:_pureQuad=!1;var len=indices.length;for(i=0;i<len;i++)_indexData[_indexSize++]=_batchingSize+indices[i];break;default:return}_batchingSize+=increment},_updateBatchedInfo:function(texture,blendFunc,shaderProgram){texture&&(_batchedInfo.texture=texture),blendFunc&&(_batchedInfo.blendSrc=blendFunc.src,_batchedInfo.blendDst=blendFunc.dst),shaderProgram&&(_batchedInfo.shader=shaderProgram)},_breakBatch:function(){_batchBroken=!0},_uploadBufferData:function(cmd){_maxVertexSize<=_batchingSize&&this._batchRendering();var node=cmd._node,texture=node._texture||(node._spriteFrame?node._spriteFrame._texture:null),blendSrc=node._blendFunc.src,blendDst=node._blendFunc.dst,shader=cmd._shaderProgram;(_batchBroken||_batchedInfo.texture!==texture||_batchedInfo.blendSrc!==blendSrc||_batchedInfo.blendDst!==blendDst||_batchedInfo.shader!==shader)&&(this._batchRendering(),_batchedInfo.texture=texture,_batchedInfo.blendSrc=blendSrc,_batchedInfo.blendDst=blendDst,_batchedInfo.shader=shader,_batchBroken=!1);var len=cmd.uploadData(_vertexDataF32,_vertexDataUI32,_batchingSize*_sizePerVertex);if(0<len){var i,curr;switch(cmd.vertexType||VertexType.QUAD){case VertexType.QUAD:for(i=0;i<len;i+=4)curr=_batchingSize+i,_indexData[_indexSize++]=curr+0,_indexData[_indexSize++]=curr+1,_indexData[_indexSize++]=curr+2,_indexData[_indexSize++]=curr+1,_indexData[_indexSize++]=curr+2,_indexData[_indexSize++]=curr+3;break;case VertexType.TRIANGLE:for(_pureQuad=!1,i=0;i<len;i+=3)curr=_batchingSize+i,_indexData[_indexSize++]=curr+0,_indexData[_indexSize++]=curr+1,_indexData[_indexSize++]=curr+2;break;case VertexType.CUSTOM:_pureQuad=!1,cmd.uploadIndexData&&(_indexSize+=cmd.uploadIndexData(_indexData,_indexSize,_batchingSize));break;default:return}_batchingSize+=len}},_batchRendering:function(){if(0!==_batchingSize&&_batchedInfo.texture){var gl=cc._renderContext,texture=_batchedInfo.texture,shader=_batchedInfo.shader,uploadAll=.5*_maxVertexSize<_batchingSize;if(shader&&(shader.use(),shader._updateProjectionUniform()),cc.glBlendFunc(_batchedInfo.blendSrc,_batchedInfo.blendDst),cc.glBindTexture2DN(0,texture),gl.bindBuffer(gl.ARRAY_BUFFER,_vertexBuffer),uploadAll)gl.bufferData(gl.ARRAY_BUFFER,_vertexDataF32,gl.DYNAMIC_DRAW);else{var view=_vertexDataF32.subarray(0,_batchingSize*_sizePerVertex);gl.bufferData(gl.ARRAY_BUFFER,view,gl.DYNAMIC_DRAW)}gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),gl.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,gl.FLOAT,!1,24,0),gl.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,gl.UNSIGNED_BYTE,!0,24,12),gl.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,gl.FLOAT,!1,24,16),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,_indexBuffer),(!_prevIndexSize||!_pureQuad||_prevIndexSize<_indexSize)&&(uploadAll?gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,_indexData,gl.DYNAMIC_DRAW):gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,_indexData.subarray(0,_indexSize),gl.DYNAMIC_DRAW)),gl.drawElements(gl.TRIANGLES,_indexSize,gl.UNSIGNED_SHORT,0),cc.g_NumberOfDraws++,_pureQuad?_prevIndexSize=_indexSize:_pureQuad=!(_prevIndexSize=0),_indexSize=_batchingSize=0}},rendering:function(ctx,cmds){var i,len,cmd,locCmds=cmds||this._renderCmds,context=ctx||cc._renderContext;for(context.bindBuffer(gl.ARRAY_BUFFER,null),i=0,len=locCmds.length;i<len;++i)(cmd=locCmds[i]).needDraw()&&(cmd.uploadData?this._uploadBufferData(cmd):(0<_batchingSize&&this._batchRendering(),cmd.rendering(context)));this._batchRendering(),_batchedInfo.texture=null}}}();var Region=function(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this._width=0,this._height=0,this._area=0},regionProto=Region.prototype,regionPool=[];function regionCreate(){var region=regionPool.pop();return region||(region=new Region),region}function regionRelease(region){regionPool.push(region)}function unionArea(r1,r2){var minX=r1._minX<r2._minX?r1._minX:r2._minX,minY=r1._minY<r2._minY?r1._minY:r2._minY;return((r1._maxX>r2._maxX?r1._maxX:r2._maxX)-minX)*((r1._maxY>r2._maxY?r1._maxY:r2._maxY)-minY)}regionProto.setTo=function(minX,minY,maxX,maxY){return this._minX=minX,this._minY=minY,this._maxX=maxX,this._maxY=maxY,this.updateArea(),this},regionProto.intValues=function(){this._minX=Math.floor(this._minX),this._minY=Math.floor(this._minY),this._maxX=Math.ceil(this._maxX),this._maxY=Math.ceil(this._maxY),this.updateArea()},regionProto.updateArea=function(){this._width=this._maxX-this._minX,this._height=this._maxY-this._minY,this._area=this._width*this._height},regionProto.union=function(target){this._width<=0||this._height<=0?this.setTo(target._minX,target._minY,target._maxX,target._maxY):(this._minX>target._minX&&(this._minX=target._minX),this._minY>target._minY&&(this._minY=target._minY),this._maxX<target._maxX&&(this._maxX=target._maxX),this._maxY<target._maxY&&(this._maxY=target._maxY),this.updateArea())},regionProto.setEmpty=function(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this._width=0,this._height=0,this._area=0},regionProto.isEmpty=function(){return this._width<=0||this._height<=0},regionProto.intersects=function(target){if(this._width<=0||this._height<=0||target._width<=0||target._height<=0)return!1;var max=this._minX>target._minX?this._minX:target._minX,min=this._maxX<target._maxX?this._maxX:target._maxX;return!(min<max)&&(max=this._minY>target._minY?this._minY:target._minY)<=(min=this._maxY<target._maxY?this._maxY:target._maxY)},regionProto.updateRegion=function(bounds,matrix){if(0!=bounds.width&&0!=bounds.height){var minX,minY,maxX,maxY,m=matrix,a=m.a,b=m.b,c=m.c,d=m.d,tx=m.tx,ty=m.ty,x=bounds.x,y=bounds.y,xMax=x+bounds.width,yMax=y+bounds.height;if(1==a&&0==b&&0==c&&1==d)minX=x+tx-1,minY=y+ty-1,maxX=xMax+tx+1,maxY=yMax+ty+1;else{var x0=a*x+c*y+tx,y0=b*x+d*y+ty,x1=a*xMax+c*y+tx,y1=b*xMax+d*y+ty,x2=a*xMax+c*yMax+tx,y2=b*xMax+d*yMax+ty,x3=a*x+c*yMax+tx,y3=b*x+d*yMax+ty,tmp=0;x1<x0&&(tmp=x0,x0=x1,x1=tmp),x3<x2&&(tmp=x2,x2=x3,x3=tmp),minX=(x0<x2?x0:x2)-1,maxX=(x3<x1?x1:x3)+1,y1<y0&&(tmp=y0,y0=y1,y1=tmp),y3<y2&&(tmp=y2,y2=y3,y3=tmp),minY=(y0<y2?y0:y2)-1,maxY=(y3<y1?y1:y3)+1}this._minX=minX,this._minY=minY,this._maxX=maxX,this._maxY=maxY,this._width=maxX-minX,this._height=maxY-minY,this._area=this._width*this._height}else this.setEmpty()};var DirtyRegion=function(){this.dirtyList=[],this.hasClipRect=!1,this.clipWidth=0,this.clipHeight=0,this.clipArea=0,this.clipRectChanged=!1},dirtyRegionProto=DirtyRegion.prototype;dirtyRegionProto.setClipRect=function(width,height){this.hasClipRect=!0,this.clipRectChanged=!0,this.clipWidth=Math.ceil(width),this.clipHeight=Math.ceil(height),this.clipArea=this.clipWidth*this.clipHeight},dirtyRegionProto.addRegion=function(target){var minX=target._minX,minY=target._minY,maxX=target._maxX,maxY=target._maxY;if(this.hasClipRect&&(minX<0&&(minX=0),minY<0&&(minY=0),maxX>this.clipWidth&&(maxX=this.clipWidth),maxY>this.clipHeight&&(maxY=this.clipHeight)),maxX<=minX||maxY<=minY)return!1;if(this.clipRectChanged)return!0;var dirtyList=this.dirtyList,region=regionCreate();return dirtyList.push(region.setTo(minX,minY,maxX,maxY)),this.mergeDirtyList(dirtyList),!0},dirtyRegionProto.clear=function(){for(var dirtyList=this.dirtyList,length=dirtyList.length,i=0;i<length;i++)regionRelease(dirtyList[i]);dirtyList.length=0},dirtyRegionProto.getDirtyRegions=function(){var dirtyList=this.dirtyList;if(this.clipRectChanged){this.clipRectChanged=!1,this.clear();var region=regionCreate();dirtyList.push(region.setTo(0,0,this.clipWidth,this.clipHeight))}else for(;this.mergeDirtyList(dirtyList););var numDirty=this.dirtyList.length;if(0<numDirty)for(var i=0;i<numDirty;i++)this.dirtyList[i].intValues();return this.dirtyList},dirtyRegionProto.mergeDirtyList=function(dirtyList){var length=dirtyList.length;if(length<2)return!1;for(var hasClipRect=this.hasClipRect,bestDelta=3<length?Number.POSITIVE_INFINITY:0,mergeA=0,mergeB=0,totalArea=0,i=0;i<length-1;i++){var regionA=dirtyList[i];hasClipRect&&(totalArea+=regionA.area);for(var j=i+1;j<length;j++){var regionB=dirtyList[j],delta=unionArea(regionA,regionB)-regionA.area-regionB.area;delta<bestDelta&&(mergeA=i,mergeB=j,bestDelta=delta)}}if(hasClipRect&&.95<totalArea/this.clipArea&&(this.clipRectChanged=!0),mergeA==mergeB)return!1;var region=dirtyList[mergeB];return dirtyList[mergeA].union(region),regionRelease(region),dirtyList.splice(mergeB,1),!0},cc.Region=Region,cc.DirtyRegion=DirtyRegion,cc._tmp.PrototypeCCNode=function(){var _p=cc.Node.prototype;cc.defineGetterSetter(_p,"x",_p.getPositionX,_p.setPositionX),cc.defineGetterSetter(_p,"y",_p.getPositionY,_p.setPositionY),_p.width,cc.defineGetterSetter(_p,"width",_p._getWidth,_p._setWidth),_p.height,cc.defineGetterSetter(_p,"height",_p._getHeight,_p._setHeight),_p.anchorX,cc.defineGetterSetter(_p,"anchorX",_p._getAnchorX,_p._setAnchorX),_p.anchorY,cc.defineGetterSetter(_p,"anchorY",_p._getAnchorY,_p._setAnchorY),_p.skewX,cc.defineGetterSetter(_p,"skewX",_p.getSkewX,_p.setSkewX),_p.skewY,cc.defineGetterSetter(_p,"skewY",_p.getSkewY,_p.setSkewY),_p.zIndex,cc.defineGetterSetter(_p,"zIndex",_p.getLocalZOrder,_p.setLocalZOrder),_p.vertexZ,cc.defineGetterSetter(_p,"vertexZ",_p.getVertexZ,_p.setVertexZ),_p.rotation,cc.defineGetterSetter(_p,"rotation",_p.getRotation,_p.setRotation),_p.rotationX,cc.defineGetterSetter(_p,"rotationX",_p.getRotationX,_p.setRotationX),_p.rotationY,cc.defineGetterSetter(_p,"rotationY",_p.getRotationY,_p.setRotationY),_p.scale,cc.defineGetterSetter(_p,"scale",_p.getScale,_p.setScale),_p.scaleX,cc.defineGetterSetter(_p,"scaleX",_p.getScaleX,_p.setScaleX),_p.scaleY,cc.defineGetterSetter(_p,"scaleY",_p.getScaleY,_p.setScaleY),_p.children,cc.defineGetterSetter(_p,"children",_p.getChildren),_p.childrenCount,cc.defineGetterSetter(_p,"childrenCount",_p.getChildrenCount),_p.parent,cc.defineGetterSetter(_p,"parent",_p.getParent,_p.setParent),_p.visible,cc.defineGetterSetter(_p,"visible",_p.isVisible,_p.setVisible),_p.running,cc.defineGetterSetter(_p,"running",_p.isRunning),_p.ignoreAnchor,cc.defineGetterSetter(_p,"ignoreAnchor",_p.isIgnoreAnchorPointForPosition,_p.ignoreAnchorPointForPosition),_p.tag,_p.userData,_p.userObject,_p.arrivalOrder,_p.actionManager,cc.defineGetterSetter(_p,"actionManager",_p.getActionManager,_p.setActionManager),_p.scheduler,cc.defineGetterSetter(_p,"scheduler",_p.getScheduler,_p.setScheduler),_p.shaderProgram,cc.defineGetterSetter(_p,"shaderProgram",_p.getShaderProgram,_p.setShaderProgram),_p.opacity,cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity),_p.opacityModifyRGB,cc.defineGetterSetter(_p,"opacityModifyRGB",_p.isOpacityModifyRGB),_p.cascadeOpacity,cc.defineGetterSetter(_p,"cascadeOpacity",_p.isCascadeOpacityEnabled,_p.setCascadeOpacityEnabled),_p.color,cc.defineGetterSetter(_p,"color",_p.getColor,_p.setColor),_p.cascadeColor,cc.defineGetterSetter(_p,"cascadeColor",_p.isCascadeColorEnabled,_p.setCascadeColorEnabled)},cc.NODE_TAG_INVALID=-1,cc.s_globalOrderOfArrival=1,cc.Node=cc.Class.extend({_localZOrder:0,_globalZOrder:0,_vertexZ:0,_customZ:NaN,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:null,_normalizedPosition:null,_usingNormalizedPosition:!1,_normalizedPositionDirty:!1,_skewX:0,_skewY:0,_children:null,_visible:!0,_anchorPoint:null,_contentSize:null,_running:!1,_parent:null,_ignoreAnchorPointForPosition:!1,tag:cc.NODE_TAG_INVALID,userData:null,userObject:null,_reorderChildDirty:!1,arrivalOrder:0,_actionManager:null,_scheduler:null,_additionalTransformDirty:!1,_additionalTransform:null,_componentContainer:null,_isTransitionFinished:!1,_className:"Node",_showNode:!1,_name:"",_realOpacity:255,_realColor:null,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1,_renderCmd:null,_tutorial_tag:null,_is_pause:null,ctor:function(){var _t=this;_t._anchorPoint=cc.p(0,0),_t._contentSize=cc.size(0,0),_t._position=cc.p(0,0),_t._normalizedPosition=cc.p(0,0),_t._children=[];cc.director;_t._additionalTransform=cc.affineTransformMakeIdentity(),cc.ComponentContainer&&(_t._componentContainer=new cc.ComponentContainer(_t)),this._realColor=cc.color(255,255,255,255),this._renderCmd=this._createRenderCmd()},init:function(){return!0},attr:function(attrs){for(var key in attrs)this[key]=attrs[key]},getSkewX:function(){return this._skewX},setSkewX:function(newSkewX){this._skewX=newSkewX,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getSkewY:function(){return this._skewY},setSkewY:function(newSkewY){this._skewY=newSkewY,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setLocalZOrder:function(localZOrder){this._parent?this._parent.reorderChild(this,localZOrder):this._localZOrder=localZOrder,cc.eventManager._setDirtyForNode(this)},_setLocalZOrder:function(localZOrder){this._localZOrder=localZOrder},getLocalZOrder:function(){return this._localZOrder},getZOrder:function(){return cc.log(cc._LogInfos.Node_getZOrder),this.getLocalZOrder()},setZOrder:function(z){cc.log(cc._LogInfos.Node_setZOrder),this.setLocalZOrder(z)},setGlobalZOrder:function(globalZOrder){this._globalZOrder!==globalZOrder&&(this._globalZOrder=globalZOrder,cc.eventManager._setDirtyForNode(this))},getGlobalZOrder:function(){return this._globalZOrder},getVertexZ:function(){return this._vertexZ},setVertexZ:function(Var){this._customZ=this._vertexZ=Var},getRotation:function(){return this._rotationX!==this._rotationY&&cc.log(cc._LogInfos.Node_getRotation),this._rotationX},setRotation:function(newRotation){this._rotationX=this._rotationY=newRotation,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getRotationX:function(){return this._rotationX},setRotationX:function(rotationX){this._rotationX=rotationX,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getRotationY:function(){return this._rotationY},setRotationY:function(rotationY){this._rotationY=rotationY,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScale:function(){return this._scaleX!==this._scaleY&&cc.log(cc._LogInfos.Node_getScale),this._scaleX},setScale:function(scale,scaleY){this._scaleX=scale,this._scaleY=scaleY||0===scaleY?scaleY:scale,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX},setScaleX:function(newScaleX){this._scaleX=newScaleX,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY},setScaleY:function(newScaleY){this._scaleY=newScaleY,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setPosition:function(newPosOrxValue,yValue){var locPosition=this._position;if(void 0===yValue){if(locPosition.x===newPosOrxValue.x&&locPosition.y===newPosOrxValue.y)return;locPosition.x=newPosOrxValue.x,locPosition.y=newPosOrxValue.y}else{if(locPosition.x===newPosOrxValue&&locPosition.y===yValue)return;locPosition.x=newPosOrxValue,locPosition.y=yValue}this._usingNormalizedPosition=!1,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setNormalizedPosition:function(posOrX,y){var locPosition=this._normalizedPosition;locPosition.y=void 0===y?(locPosition.x=posOrX.x,posOrX.y):(locPosition.x=posOrX,y),this._normalizedPositionDirty=this._usingNormalizedPosition=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPosition:function(){return cc.p(this._position)},getNormalizedPosition:function(){return cc.p(this._normalizedPosition)},getPositionX:function(){return this._position.x},setPositionX:function(x){this._position.x=x,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPositionY:function(){return this._position.y},setPositionY:function(y){this._position.y=y,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getChildrenCount:function(){return this._children.length},getChildren:function(){return this._children},isVisible:function(){return this._visible},setVisible:function(visible){this._visible!==visible&&(this._visible=visible,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),cc.renderer.childrenOrderDirty=!0)},getAnchorPoint:function(){return cc.p(this._anchorPoint)},setAnchorPoint:function(point,y){var locAnchorPoint=this._anchorPoint;if(void 0===y){if(point.x===locAnchorPoint.x&&point.y===locAnchorPoint.y)return;locAnchorPoint.x=point.x,locAnchorPoint.y=point.y}else{if(point===locAnchorPoint.x&&y===locAnchorPoint.y)return;locAnchorPoint.x=point,locAnchorPoint.y=y}this._renderCmd._updateAnchorPointInPoint()},_getAnchorX:function(){return this._anchorPoint.x},_setAnchorX:function(x){this._anchorPoint.x!==x&&(this._anchorPoint.x=x,this._renderCmd._updateAnchorPointInPoint())},_getAnchorY:function(){return this._anchorPoint.y},_setAnchorY:function(y){this._anchorPoint.y!==y&&(this._anchorPoint.y=y,this._renderCmd._updateAnchorPointInPoint())},getAnchorPointInPoints:function(){return this._renderCmd.getAnchorPointInPoints()},_getWidth:function(){return this._contentSize.width},_setWidth:function(width){this._contentSize.width=width,this._renderCmd._updateAnchorPointInPoint()},_getHeight:function(){return this._contentSize.height},_setHeight:function(height){this._contentSize.height=height,this._renderCmd._updateAnchorPointInPoint()},getContentSize:function(){return cc.size(this._contentSize)},setContentSize:function(size,height){var locContentSize=this._contentSize;if(void 0===height){if(size.width===locContentSize.width&&size.height===locContentSize.height)return;locContentSize.width=size.width,locContentSize.height=size.height}else{if(size===locContentSize.width&&height===locContentSize.height)return;locContentSize.width=size,locContentSize.height=height}this._renderCmd._updateAnchorPointInPoint()},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(parent){this._parent=parent,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},ignoreAnchorPointForPosition:function(newValue){newValue!==this._ignoreAnchorPointForPosition&&(this._ignoreAnchorPointForPosition=newValue,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},getTag:function(){return this.tag},setTag:function(tag){this.tag=tag},setTutorialTag:function(tag){this._tutorial_tag=tag},getTutorialTag:function(){return this._tutorial_tag},is_pause:function(){return this._is_pause},setName:function(name){this._name=name},getName:function(){return this._name},getUserData:function(){return this.userData},setUserData:function(Var){this.userData=Var},getUserObject:function(){return this.userObject},setUserObject:function(newValue){this.userObject!==newValue&&(this.userObject=newValue)},getOrderOfArrival:function(){return this.arrivalOrder},setOrderOfArrival:function(Var){this.arrivalOrder=Var},getActionManager:function(){return this._actionManager||cc.director.getActionManager()},setActionManager:function(actionManager){this._actionManager!==actionManager&&(this.stopAllActions(),this._actionManager=actionManager)},getScheduler:function(){return this._scheduler||cc.director.getScheduler()},setScheduler:function(scheduler){this._scheduler!==scheduler&&(this.unscheduleAllCallbacks(),this._scheduler=scheduler)},boundingBox:function(){return cc.log(cc._LogInfos.Node_boundingBox),this.getBoundingBox()},getBoundingBox:function(){var rect=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc._rectApplyAffineTransformIn(rect,this.getNodeToParentTransform())},cleanup:function(){this.stopAllActions(),this.unscheduleAllCallbacks(),cc.eventManager.removeListeners(this)},getChildByTag:function(aTag){var __children=this._children;if(null!==__children)for(var i=0;i<__children.length;i++){var node=__children[i];if(node&&node.tag===aTag)return node}return null},getChildByName:function(name){if(!name)return cc.log("Invalid name"),null;for(var locChildren=this._children,i=0,len=locChildren.length;i<len;i++)if(locChildren[i]._name===name)return locChildren[i];return null},addChild:function(child,localZOrder,tag){localZOrder=void 0===localZOrder?child._localZOrder:localZOrder;var name,setTag=!1;void 0===tag?name=child._name:"string"==typeof tag?(name=tag,tag=void 0):"number"==typeof tag&&(setTag=!0,name=""),cc.assert(child,cc._LogInfos.Node_addChild_3),cc.assert(null===child._parent,"child already added. It can't be added again"),this._addChildHelper(child,localZOrder,tag,name,setTag)},_addChildHelper:function(child,localZOrder,tag,name,setTag){this._children||(this._children=[]),this._insertChild(child,localZOrder),setTag?child.setTag(tag):child.setName(name),child.setParent(this),child.setOrderOfArrival(cc.s_globalOrderOfArrival++),this._running&&(child._performRecursive(cc.Node._stateCallbackType.onEnter),this._isTransitionFinished&&child._performRecursive(cc.Node._stateCallbackType.onEnterTransitionDidFinish)),child._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._cascadeColorEnabled&&child._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty),this._cascadeOpacityEnabled&&child._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},removeFromParent:function(cleanup){this._parent&&(void 0===cleanup&&(cleanup=!0),this._parent.removeChild(this,cleanup))},removeFromParentAndCleanup:function(cleanup){cc.log(cc._LogInfos.Node_removeFromParentAndCleanup),this.removeFromParent(cleanup)},removeChild:function(child,cleanup){0!==this._children.length&&(void 0===cleanup&&(cleanup=!0),-1<this._children.indexOf(child)&&this._detachChild(child,cleanup),cc.renderer.childrenOrderDirty=!0)},removeChildByTag:function(tag,cleanup){tag===cc.NODE_TAG_INVALID&&cc.log(cc._LogInfos.Node_removeChildByTag);var child=this.getChildByTag(tag);child?this.removeChild(child,cleanup):cc.log(cc._LogInfos.Node_removeChildByTag_2,tag)},removeAllChildrenWithCleanup:function(cleanup){this.removeAllChildren(cleanup)},removeAllChildren:function(cleanup){var __children=this._children;if(null!==__children){void 0===cleanup&&(cleanup=!0);for(var i=0;i<__children.length;i++){var node=__children[i];node&&(this._running&&(node._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),node._performRecursive(cc.Node._stateCallbackType.onExit)),cleanup&&node._performRecursive(cc.Node._stateCallbackType.cleanup),node.parent=null,node._renderCmd.detachFromParent())}this._children.length=0,cc.renderer.childrenOrderDirty=!0}},_detachChild:function(child,doCleanup){this._running&&(child._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),child._performRecursive(cc.Node._stateCallbackType.onExit)),doCleanup&&child._performRecursive(cc.Node._stateCallbackType.cleanup),child.parent=null,child._renderCmd.detachFromParent(),cc.arrayRemoveObject(this._children,child)},_insertChild:function(child,z){cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0,this._children.push(child),child._setLocalZOrder(z)},setNodeDirty:function(){this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},reorderChild:function(child,zOrder){cc.assert(child,cc._LogInfos.Node_reorderChild),-1!==this._children.indexOf(child)?zOrder!==child.zIndex&&(cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0,child.arrivalOrder=cc.s_globalOrderOfArrival,cc.s_globalOrderOfArrival++,child._setLocalZOrder(zOrder),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.orderDirty)):cc.log(cc._LogInfos.Node_reorderChild_2)},sortAllChildren:function(){if(this._reorderChildDirty){var i,j,tmp,_children=this._children,len=_children.length;for(i=1;i<len;i++){for(tmp=_children[i],j=i-1;0<=j;){if(tmp._localZOrder<_children[j]._localZOrder)_children[j+1]=_children[j];else{if(!(tmp._localZOrder===_children[j]._localZOrder&&tmp.arrivalOrder<_children[j].arrivalOrder))break;_children[j+1]=_children[j]}j--}_children[j+1]=tmp}this._reorderChildDirty=!1}},draw:function(ctx){},transformAncestors:function(){null!==this._parent&&(this._parent.transformAncestors(),this._parent.transform())},onEnter:function(){this._isTransitionFinished=!1,this._running=!0,this.resume()},_performRecursive:function(callbackType){var nodeCallbackType=cc.Node._stateCallbackType;if(!(callbackType>=nodeCallbackType.max)){var children,child,curr,i,len,index=0,stack=cc.Node._performStacks[cc.Node._performing];for(stack||(stack=[],cc.Node._performStacks.push(stack)),stack.length=0,cc.Node._performing++,curr=stack[0]=this;curr;){if((children=curr._children)&&0<children.length)for(i=0,len=children.length;i<len;++i)child=children[i],stack.push(child);if((children=curr._protectedChildren)&&0<children.length)for(i=0,len=children.length;i<len;++i)child=children[i],stack.push(child);curr=stack[++index]}for(i=stack.length-1;0<=i;--i)if(curr=stack[i],stack[i]=null,curr)switch(callbackType){case nodeCallbackType.onEnter:curr.onEnter();break;case nodeCallbackType.onExit:curr.onExit();break;case nodeCallbackType.onEnterTransitionDidFinish:curr.onEnterTransitionDidFinish();break;case nodeCallbackType.cleanup:curr.cleanup();break;case nodeCallbackType.onExitTransitionDidStart:curr.onExitTransitionDidStart()}cc.Node._performing--}},onEnterTransitionDidFinish:function(){this._isTransitionFinished=!0},onExitTransitionDidStart:function(){},onExit:function(){this._running=!1,this.pause(),this.removeAllComponents()},runAction:function(action){return cc.assert(action,cc._LogInfos.Node_runAction),this.actionManager.addAction(action,this,!this._running),action},stopAllActions:function(){this.actionManager&&this.actionManager.removeAllActionsFromTarget(this)},stopAction:function(action){this.actionManager.removeAction(action)},stopActionByTag:function(tag){tag!==cc.ACTION_TAG_INVALID?this.actionManager.removeActionByTag(tag,this):cc.log(cc._LogInfos.Node_stopActionByTag)},getActionByTag:function(tag){return tag===cc.ACTION_TAG_INVALID?(cc.log(cc._LogInfos.Node_getActionByTag),null):this.actionManager.getActionByTag(tag,this)},getNumberOfRunningActions:function(){return this.actionManager.numberOfRunningActionsInTarget(this)},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(priority){this.scheduler.scheduleUpdate(this,priority,!this._running)},unscheduleUpdate:function(){this.scheduler.unscheduleUpdate(this)},schedule:function(callback,interval,repeat,delay,key){var len=arguments.length;"function"==typeof callback?1===len?(interval=0,repeat=cc.REPEAT_FOREVER,delay=0,key=this.__instanceId):2===len?"number"==typeof interval?(repeat=cc.REPEAT_FOREVER,delay=0,key=this.__instanceId):(key=interval,interval=0,repeat=cc.REPEAT_FOREVER,delay=0):3===len?("string"==typeof repeat?(key=repeat,repeat=cc.REPEAT_FOREVER):key=this.__instanceId,delay=0):4===len&&(key=this.__instanceId):1===len?(interval=0,repeat=cc.REPEAT_FOREVER,delay=0):2===len&&(repeat=cc.REPEAT_FOREVER,delay=0),cc.assert(callback,cc._LogInfos.Node_schedule),cc.assert(0<=interval,cc._LogInfos.Node_schedule_2),interval=interval||0,repeat=isNaN(repeat)?cc.REPEAT_FOREVER:repeat,delay=delay||0,this.scheduler.schedule(callback,this,interval,repeat,delay,!this._running,key)},scheduleOnce:function(callback,delay,key){void 0===key&&(key=this.__instanceId),this.schedule(callback,0,0,delay,key)},unschedule:function(callback_fn){callback_fn&&this.scheduler.unschedule(callback_fn,this)},unscheduleAllCallbacks:function(){this.scheduler.unscheduleAllForTarget(this)},resumeSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_resumeSchedulerAndActions),this.resume()},resume:function(){this.scheduler.resumeTarget(this),this.actionManager&&this.actionManager.resumeTarget(this),cc.eventManager.resumeTarget(this),this._is_pause=!1},pauseSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_pauseSchedulerAndActions),this.pause()},pause:function(){this.scheduler.pauseTarget(this),this.actionManager&&this.actionManager.pauseTarget(this),cc.eventManager.pauseTarget(this),this._is_pause=!0},setAdditionalTransform:function(additionalTransform){if(void 0===additionalTransform)return this._additionalTransformDirty=!1;this._additionalTransform=additionalTransform,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._additionalTransformDirty=!0},getParentToNodeTransform:function(){return this._renderCmd.getParentToNodeTransform()},parentToNodeTransform:function(){return this.getParentToNodeTransform()},getNodeToWorldTransform:function(){for(var t=this.getNodeToParentTransform(),p=this._parent;null!==p;p=p.parent)t=cc.affineTransformConcat(t,p.getNodeToParentTransform());return t},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getWorldToNodeTransform:function(){return cc.affineTransformInvert(this.getNodeToWorldTransform())},worldToNodeTransform:function(){return this.getWorldToNodeTransform()},convertToNodeSpace:function(worldPoint){return cc.pointApplyAffineTransform(worldPoint,this.getWorldToNodeTransform())},convertToWorldSpace:function(nodePoint){return nodePoint=nodePoint||cc.p(0,0),cc.pointApplyAffineTransform(nodePoint,this.getNodeToWorldTransform())},convertToNodeSpaceAR:function(worldPoint){return cc.pSub(this.convertToNodeSpace(worldPoint),this._renderCmd.getAnchorPointInPoints())},convertToWorldSpaceAR:function(nodePoint){nodePoint=nodePoint||cc.p(0,0);var pt=cc.pAdd(nodePoint,this._renderCmd.getAnchorPointInPoints());return this.convertToWorldSpace(pt)},_convertToWindowSpace:function(nodePoint){var worldPoint=this.convertToWorldSpace(nodePoint);return cc.director.convertToUI(worldPoint)},convertTouchToNodeSpace:function(touch){var point=touch.getLocation();return this.convertToNodeSpace(point)},convertTouchToNodeSpaceAR:function(touch){var point=cc.director.convertToGL(touch.getLocation());return this.convertToNodeSpaceAR(point)},update:function(dt){this._componentContainer&&!this._componentContainer.isEmpty()&&this._componentContainer.visit(dt)},updateTransform:function(){for(var children=this._children,i=0;i<children.length;i++)varnode=children[i]},retain:function(){},release:function(){},getComponent:function(name){return this._componentContainer?this._componentContainer.getComponent(name):null},addComponent:function(component){this._componentContainer&&this._componentContainer.add(component)},removeComponent:function(component){return!!this._componentContainer&&this._componentContainer.remove(component)},removeAllComponents:function(){this._componentContainer&&this._componentContainer.removeAll()},grid:null,visit:function(parent){if(this._visible){var renderer=cc.renderer,cmd=this._renderCmd;cmd.visit(parent&&parent._renderCmd);var i,child,children=this._children,len=children.length;if(0<len){for(this._reorderChildDirty&&this.sortAllChildren(),i=0;i<len&&(child=children[i])._localZOrder<0;i++)child.visit(this);for(renderer.pushRenderCommand(cmd);i<len;i++)children[i].visit(this)}else renderer.pushRenderCommand(cmd);cmd._dirtyFlag=0}},transform:function(parentCmd,recursive){this._renderCmd.transform(parentCmd,recursive)},nodeToParentTransform:function(){return this.getNodeToParentTransform()},getNodeToParentTransform:function(ancestor){var t=this._renderCmd.getNodeToParentTransform();if(ancestor){for(var T={a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx,ty:t.ty},p=this._parent;null!=p&&p!=ancestor;p=p.getParent())cc.affineTransformConcatIn(T,p.getNodeToParentTransform());return T}return t},getNodeToParentAffineTransform:function(ancestor){return this.getNodeToParentTransform(ancestor)},getCamera:function(){return null},getGrid:function(){return this.grid},setGrid:function(grid){this.grid=grid},getShaderProgram:function(){return this._renderCmd.getShaderProgram()},setShaderProgram:function(newShaderProgram){this._renderCmd.setShaderProgram(newShaderProgram)},getGLServerState:function(){return 0},setGLServerState:function(state){},getBoundingBoxToWorld:function(){var rect=cc.rect(0,0,this._contentSize.width,this._contentSize.height),trans=this.getNodeToWorldTransform();if(rect=cc.rectApplyAffineTransform(rect,trans),!this._children)return rect;for(var locChildren=this._children,i=0;i<locChildren.length;i++){var child=locChildren[i];if(child&&child._visible){var childRect=child._getBoundingBoxToCurrentNode(trans);childRect&&(rect=cc.rectUnion(rect,childRect))}}return rect},_getBoundingBoxToCurrentNode:function(parentTransform){var rect=cc.rect(0,0,this._contentSize.width,this._contentSize.height),trans=void 0===parentTransform?this.getNodeToParentTransform():cc.affineTransformConcat(this.getNodeToParentTransform(),parentTransform);if(rect=cc.rectApplyAffineTransform(rect,trans),!this._children)return rect;for(var locChildren=this._children,i=0;i<locChildren.length;i++){var child=locChildren[i];if(child&&child._visible){var childRect=child._getBoundingBoxToCurrentNode(trans);childRect&&(rect=cc.rectUnion(rect,childRect))}}return rect},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._renderCmd.getDisplayedOpacity()},setOpacity:function(opacity){this._realOpacity=opacity,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},updateDisplayedOpacity:function(parentOpacity){this._renderCmd._updateDisplayOpacity(parentOpacity)},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(cascadeOpacityEnabled){this._cascadeOpacityEnabled!==cascadeOpacityEnabled&&(this._cascadeOpacityEnabled=cascadeOpacityEnabled,this._renderCmd.setCascadeOpacityEnabledDirty())},getColor:function(){var locRealColor=this._realColor;return cc.color(locRealColor.r,locRealColor.g,locRealColor.b,locRealColor.a)},getDisplayedColor:function(){return this._renderCmd.getDisplayedColor()},setColor:function(color){var locRealColor=this._realColor;locRealColor.r=color.r,locRealColor.g=color.g,locRealColor.b=color.b,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},updateDisplayedColor:function(parentColor){this._renderCmd._updateDisplayColor(parentColor)},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(cascadeColorEnabled){this._cascadeColorEnabled!==cascadeColorEnabled&&(this._cascadeColorEnabled=cascadeColorEnabled,this._renderCmd.setCascadeColorEnabledDirty())},setOpacityModifyRGB:function(opacityValue){},isOpacityModifyRGB:function(){return!1},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Node.CanvasRenderCmd(this):new cc.Node.WebGLRenderCmd(this)},enumerateChildren:function(name,callback){cc.assert(name&&0!=name.length,"Invalid name"),cc.assert(null!=callback,"Invalid callback function");var length=name.length,subStrStartPos=0,subStrlength=length,searchRecursively=!1;2<length&&"/"===name[0]&&"/"===name[1]&&(searchRecursively=!0,subStrlength-=subStrStartPos=2);var searchFromParent=!1;3<length&&"/"===name[length-3]&&"."===name[length-2]&&"."===name[length-1]&&(searchFromParent=!0,subStrlength-=3);var newName=name.substr(subStrStartPos,subStrlength);searchFromParent&&(newName="[[:alnum:]]+/"+newName),searchRecursively?this.doEnumerateRecursive(this,newName,callback):this.doEnumerate(newName,callback)},doEnumerateRecursive:function(node,name,callback){var ret=!1;if(node.doEnumerate(name,callback))ret=!0;else for(var child,children=node.getChildren(),length=children.length,i=0;i<length;i++)if(child=children[i],this.doEnumerateRecursive(child,name,callback)){ret=!0;break}return ret},doEnumerate:function(name,callback){var pos=name.indexOf("/"),searchName=name,needRecursive=!1;-1!==pos&&(searchName=name.substr(0,pos),needRecursive=!0);for(var child,ret=!1,children=this._children,length=children.length,i=0;i<length;i++)if(-1!==(child=children[i])._name.indexOf(searchName))if(needRecursive){if(ret=child.doEnumerate(name,callback))break}else if(callback(child)){ret=!0;break}return ret},getChildByTutorialTag:function(tutorial_tag){for(var locChildren=this._children,i=0;i<locChildren.length;i++)if(locChildren[i]._tutorial_tag==tutorial_tag)return locChildren[i];return null}}),cc.Node.create=function(){return new cc.Node},cc.Node._stateCallbackType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,onExitTransitionDidStart:5,max:6},cc.Node._performStacks=[[]],cc.Node._performing=0,cc.assert(cc.isFunction(cc._tmp.PrototypeCCNode),cc._LogInfos.MissingFile,"BaseNodesPropertyDefine.js"),cc._tmp.PrototypeCCNode(),delete cc._tmp.PrototypeCCNode,cc.CustomRenderCmd=function(target,func){this._needDraw=!0,this._target=target,this._callback=func},cc.CustomRenderCmd.prototype.rendering=function(ctx,scaleX,scaleY){this._callback&&this._callback.call(this._target,ctx,scaleX,scaleY)},cc.CustomRenderCmd.prototype.needDraw=function(){return this._needDraw};var dirtyFlags=cc.Node._dirtyFlags={transformDirty:1,visibleDirty:2,colorDirty:4,opacityDirty:8,cacheDirty:16,orderDirty:32,textDirty:64,gradientDirty:128,textureDirty:256,contentDirty:512,COUNT:10,all:1023},ONE_DEGREE=Math.PI/180;function transformChildTree(root){var children,child,curr,parentCmd,i,len,index=1,stack=cc.Node._performStacks[cc.Node._performing];for(stack||(stack=[],cc.Node._performStacks.push(stack)),stack.length=0,cc.Node._performing++,stack[0]=root;index;)if(curr=stack[--index],stack[index]=null,curr){if((children=curr._children)&&0<children.length)for(parentCmd=curr._renderCmd,i=0,len=children.length;i<len;++i)child=children[i],stack[index]=child,index++,child._renderCmd.transform(parentCmd);var pChildren=curr._protectedChildren;if(pChildren&&0<pChildren.length)for(parentCmd=curr._renderCmd,i=0,len=pChildren.length;i<len;++i)child=pChildren[i],stack[index]=child,index++,child._renderCmd.transform(parentCmd)}cc.Node._performing--}cc.Node.RenderCmd=function(renderable){this._node=renderable,this._anchorPointInPoints={x:0,y:0},this._displayedColor=cc.color(255,255,255,255)},cc.Node.RenderCmd.prototype={constructor:cc.Node.RenderCmd,_needDraw:!1,_dirtyFlag:1,_curLevel:-1,_displayedOpacity:255,_cascadeColorEnabledDirty:!1,_cascadeOpacityEnabledDirty:!1,_transform:null,_worldTransform:null,_inverse:null,needDraw:function(){return this._needDraw},getAnchorPointInPoints:function(){return cc.p(this._anchorPointInPoints)},getDisplayedColor:function(){var tmpColor=this._displayedColor;return cc.color(tmpColor.r,tmpColor.g,tmpColor.b,tmpColor.a)},getDisplayedOpacity:function(){return this._displayedOpacity},setCascadeColorEnabledDirty:function(){this._cascadeColorEnabledDirty=!0,this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},setCascadeOpacityEnabledDirty:function(){this._cascadeOpacityEnabledDirty=!0,this.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getParentToNodeTransform:function(){return this._inverse||(this._inverse={a:1,b:0,c:0,d:1,tx:0,ty:0}),this._dirtyFlag&cc.Node._dirtyFlags.transformDirty&&cc.affineTransformInvertOut(this.getNodeToParentTransform(),this._inverse),this._inverse},detachFromParent:function(){},_updateAnchorPointInPoint:function(){var locAPP=this._anchorPointInPoints,locSize=this._node._contentSize,locAnchorPoint=this._node._anchorPoint;locAPP.x=locSize.width*locAnchorPoint.x,locAPP.y=locSize.height*locAnchorPoint.y,this.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setDirtyFlag:function(dirtyFlag){0===this._dirtyFlag&&0!==dirtyFlag&&cc.renderer.pushDirtyNode(this),this._dirtyFlag|=dirtyFlag},getParentRenderCmd:function(){return this._node&&this._node._parent&&this._node._parent._renderCmd?this._node._parent._renderCmd:null},transform:function(parentCmd,recursive){this._transform||(this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0});var node=this._node,pt=parentCmd?parentCmd._worldTransform:null,t=this._transform,wt=this._worldTransform;if(node._usingNormalizedPosition&&node._parent){var conSize=node._parent._contentSize;node._position.x=node._normalizedPosition.x*conSize.width,node._position.y=node._normalizedPosition.y*conSize.height,node._normalizedPositionDirty=!1}var hasRotation=node._rotationX||node._rotationY,hasSkew=node._skewX||node._skewY,sx=node._scaleX,sy=node._scaleY,appX=this._anchorPointInPoints.x,appY=this._anchorPointInPoints.y,a=1,b=0,c=0,d=1;if(hasRotation||hasSkew){if(t.tx=node._position.x,t.ty=node._position.y,hasRotation){var rotationRadiansX=node._rotationX*ONE_DEGREE;if(c=Math.sin(rotationRadiansX),d=Math.cos(rotationRadiansX),node._rotationY===node._rotationX)a=d,b=-c;else{var rotationRadiansY=node._rotationY*ONE_DEGREE;a=Math.cos(rotationRadiansY),b=-Math.sin(rotationRadiansY)}}if(t.a=a*=sx,t.b=b*=sx,t.c=c*=sy,t.d=d*=sy,hasSkew){var skx=Math.tan(node._skewX*ONE_DEGREE),sky=Math.tan(node._skewY*ONE_DEGREE);skx===1/0&&(skx=99999999),sky===1/0&&(sky=99999999),t.a=a+c*sky,t.b=b+d*sky,t.c=c+a*skx,t.d=d+b*skx}(appX||appY)&&(t.tx-=t.a*appX+t.c*appY,t.ty-=t.b*appX+t.d*appY,node._ignoreAnchorPointForPosition&&(t.tx+=appX,t.ty+=appY)),node._additionalTransformDirty&&cc.affineTransformConcatIn(t,node._additionalTransform),wt.ty=pt?(wt.a=t.a*pt.a+t.b*pt.c,wt.b=t.a*pt.b+t.b*pt.d,wt.c=t.c*pt.a+t.d*pt.c,wt.d=t.c*pt.b+t.d*pt.d,wt.tx=pt.a*t.tx+pt.c*t.ty+pt.tx,pt.d*t.ty+pt.ty+pt.b*t.tx):(wt.a=t.a,wt.b=t.b,wt.c=t.c,wt.d=t.d,wt.tx=t.tx,t.ty)}else t.a=sx,t.b=0,t.c=0,t.d=sy,t.tx=node._position.x,t.ty=node._position.y,(appX||appY)&&(t.tx-=t.a*appX,t.ty-=t.d*appY,node._ignoreAnchorPointForPosition&&(t.tx+=appX,t.ty+=appY)),node._additionalTransformDirty&&cc.affineTransformConcatIn(t,node._additionalTransform),wt.ty=pt?(wt.a=t.a*pt.a+t.b*pt.c,wt.b=t.a*pt.b+t.b*pt.d,wt.c=t.c*pt.a+t.d*pt.c,wt.d=t.c*pt.b+t.d*pt.d,wt.tx=t.tx*pt.a+t.ty*pt.c+pt.tx,t.tx*pt.b+t.ty*pt.d+pt.ty):(wt.a=t.a,wt.b=t.b,wt.c=t.c,wt.d=t.d,wt.tx=t.tx,t.ty);this._updateCurrentRegions&&(this._updateCurrentRegions(),this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.DirtyDouble)),recursive&&transformChildTree(node),this._cacheDirty=!0},getNodeToParentTransform:function(){return(!this._transform||this._dirtyFlag&cc.Node._dirtyFlags.transformDirty)&&this.transform(),this._transform},visit:function(parentCmd){var node=this._node,renderer=cc.renderer;(parentCmd=parentCmd||this.getParentRenderCmd())&&(this._curLevel=parentCmd._curLevel+1),isNaN(node._customZ)&&(node._vertexZ=renderer.assignedZ,renderer.assignedZ+=renderer.assignedZStep),this._syncStatus(parentCmd)},_updateDisplayColor:function(parentColor){var i,len,selChildren,item,node=this._node,locDispColor=this._displayedColor,locRealColor=node._realColor;if(this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeColorEnabledDirty&&!node._cascadeColorEnabled){locDispColor.r=locRealColor.r,locDispColor.g=locRealColor.g,locDispColor.b=locRealColor.b;var whiteColor=new cc.Color(255,255,255,255);for(i=0,len=(selChildren=node._children).length;i<len;i++)(item=selChildren[i])&&item._renderCmd&&item._renderCmd._updateDisplayColor(whiteColor);this._cascadeColorEnabledDirty=!1}else{if(void 0===parentColor){var locParent=node._parent;parentColor=locParent&&locParent._cascadeColorEnabled?locParent.getDisplayedColor():cc.color.WHITE}if(locDispColor.r=0|locRealColor.r*parentColor.r/255,locDispColor.g=0|locRealColor.g*parentColor.g/255,locDispColor.b=0|locRealColor.b*parentColor.b/255,node._cascadeColorEnabled)for(i=0,len=(selChildren=node._children).length;i<len;i++)(item=selChildren[i])&&item._renderCmd&&(item._renderCmd._updateDisplayColor(locDispColor),item._renderCmd._updateColor())}this._dirtyFlag&=~dirtyFlags.colorDirty},_updateDisplayOpacity:function(parentOpacity){var i,len,selChildren,item,node=this._node;if(this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeOpacityEnabledDirty&&!node._cascadeOpacityEnabled){for(this._displayedOpacity=node._realOpacity,i=0,len=(selChildren=node._children).length;i<len;i++)(item=selChildren[i])&&item._renderCmd&&item._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else{if(void 0===parentOpacity){var locParent=node._parent;parentOpacity=255,locParent&&locParent._cascadeOpacityEnabled&&(parentOpacity=locParent.getDisplayedOpacity())}if(this._displayedOpacity=node._realOpacity*parentOpacity/255,node._cascadeOpacityEnabled)for(i=0,len=(selChildren=node._children).length;i<len;i++)(item=selChildren[i])&&item._renderCmd&&(item._renderCmd._updateDisplayOpacity(this._displayedOpacity),item._renderCmd._updateColor())}this._dirtyFlag&=~dirtyFlags.opacityDirty},_syncDisplayColor:function(parentColor){var node=this._node,locDispColor=this._displayedColor,locRealColor=node._realColor;if(void 0===parentColor){var locParent=node._parent;parentColor=locParent&&locParent._cascadeColorEnabled?locParent.getDisplayedColor():cc.color.WHITE}locDispColor.r=0|locRealColor.r*parentColor.r/255,locDispColor.g=0|locRealColor.g*parentColor.g/255,locDispColor.b=0|locRealColor.b*parentColor.b/255},_syncDisplayOpacity:function(parentOpacity){var node=this._node;if(void 0===parentOpacity){var locParent=node._parent;parentOpacity=255,locParent&&locParent._cascadeOpacityEnabled&&(parentOpacity=locParent.getDisplayedOpacity())}this._displayedOpacity=node._realOpacity*parentOpacity/255},_updateColor:function(){},updateStatus:function(){var locFlag=this._dirtyFlag,colorDirty=locFlag&dirtyFlags.colorDirty,opacityDirty=locFlag&dirtyFlags.opacityDirty;locFlag&dirtyFlags.contentDirty&&(this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty),this._dirtyFlag&=~dirtyFlags.contentDirty),colorDirty&&this._updateDisplayColor(),opacityDirty&&this._updateDisplayOpacity(),(colorDirty||opacityDirty)&&this._updateColor(),locFlag&dirtyFlags.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag&=~dirtyFlags.transformDirty),locFlag&dirtyFlags.orderDirty&&(this._dirtyFlag&=~dirtyFlags.orderDirty)},_syncStatus:function(parentCmd){var locFlag=this._dirtyFlag,parentNode=parentCmd?parentCmd._node:null;parentNode&&parentNode._cascadeColorEnabled&&parentCmd._dirtyFlag&dirtyFlags.colorDirty&&(locFlag|=dirtyFlags.colorDirty),parentNode&&parentNode._cascadeOpacityEnabled&&parentCmd._dirtyFlag&dirtyFlags.opacityDirty&&(locFlag|=dirtyFlags.opacityDirty),parentCmd&&parentCmd._dirtyFlag&dirtyFlags.transformDirty&&(locFlag|=dirtyFlags.transformDirty);var colorDirty=(this._dirtyFlag=locFlag)&dirtyFlags.colorDirty,opacityDirty=locFlag&dirtyFlags.opacityDirty;colorDirty&&this._syncDisplayColor(),opacityDirty&&this._syncDisplayOpacity(),(colorDirty||opacityDirty)&&this._updateColor(),locFlag&dirtyFlags.transformDirty&&this.transform(parentCmd),locFlag&dirtyFlags.orderDirty&&(this._dirtyFlag&=~dirtyFlags.orderDirty)}},cc.Node.RenderCmd.prototype.originTransform=cc.Node.RenderCmd.prototype.transform,cc.Node.RenderCmd.prototype.originUpdateStatus=cc.Node.RenderCmd.prototype.updateStatus,cc.Node.RenderCmd.prototype._originSyncStatus=cc.Node.RenderCmd.prototype._syncStatus,function(){cc.Node.CanvasRenderCmd=function(renderable){this._node=renderable,this._anchorPointInPoints={x:0,y:0},this._displayedColor=cc.color(255,255,255,255),this._cachedParent=null,this._cacheDirty=!1,this._currentRegion=new cc.Region,this._oldRegion=new cc.Region,this._regionFlag=0,this._canUseDirtyRegion=!1},cc.Node.CanvasRenderCmd.RegionStatus={NotDirty:0,Dirty:1,DirtyDouble:2};var proto=cc.Node.CanvasRenderCmd.prototype=Object.create(cc.Node.RenderCmd.prototype);proto.constructor=cc.Node.CanvasRenderCmd,proto._rootCtor=cc.Node.CanvasRenderCmd,proto._notifyRegionStatus=function(status){this._needDraw&&this._regionFlag<status&&(this._regionFlag=status)};var localBB=new cc.Rect;proto.getLocalBB=function(){var node=this._node;return localBB.x=localBB.y=0,localBB.width=node._contentSize.width,localBB.height=node._contentSize.height,localBB},proto._updateCurrentRegions=function(){var temp=this._currentRegion;this._currentRegion=this._oldRegion,this._oldRegion=temp,cc.Node.CanvasRenderCmd.RegionStatus.DirtyDouble!==this._regionFlag||this._currentRegion.isEmpty()||this._oldRegion.union(this._currentRegion),this._currentRegion.updateRegion(this.getLocalBB(),this._worldTransform)},proto.setDirtyFlag=function(dirtyFlag,child){cc.Node.RenderCmd.prototype.setDirtyFlag.call(this,dirtyFlag,child),this._setCacheDirty(child),this._cachedParent&&this._cachedParent.setDirtyFlag(dirtyFlag,!0)},proto._setCacheDirty=function(){if(!1===this._cacheDirty){this._cacheDirty=!0;var cachedP=this._cachedParent;cachedP&&cachedP!==this&&cachedP._setNodeDirtyForCache&&cachedP._setNodeDirtyForCache()}},proto._setCachedParent=function(cachedParent){if(this._cachedParent!==cachedParent){this._cachedParent=cachedParent;for(var children=this._node._children,i=0,len=children.length;i<len;i++)children[i]._renderCmd._setCachedParent(cachedParent)}},proto.detachFromParent=function(){this._cachedParent=null;for(var item,selChildren=this._node._children,i=0,len=selChildren.length;i<len;i++)(item=selChildren[i])&&item._renderCmd&&item._renderCmd.detachFromParent()},proto.setShaderProgram=function(shaderProgram){},proto.getShaderProgram=function(){return null},cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc=function(blendFunc){return blendFunc?blendFunc.src===cc.SRC_ALPHA&&blendFunc.dst===cc.ONE||blendFunc.src===cc.ONE&&blendFunc.dst===cc.ONE?"lighter":blendFunc.src===cc.ZERO&&blendFunc.dst===cc.SRC_ALPHA?"destination-in":blendFunc.src===cc.ZERO&&blendFunc.dst===cc.ONE_MINUS_SRC_ALPHA?"destination-out":"source-over":"source-over"}}(),function(){cc.Node.WebGLRenderCmd=function(renderable){this._node=renderable,this._anchorPointInPoints={x:0,y:0},this._displayedColor=cc.color(255,255,255,255),this._shaderProgram=null};var proto=cc.Node.WebGLRenderCmd.prototype=Object.create(cc.Node.RenderCmd.prototype);proto.constructor=cc.Node.WebGLRenderCmd,proto._rootCtor=cc.Node.WebGLRenderCmd,proto._updateColor=function(){},proto.setShaderProgram=function(shaderProgram){this._shaderProgram=shaderProgram},proto.getShaderProgram=function(){return this._shaderProgram}}(),cc.AtlasNode=cc.Node.extend({textureAtlas:null,quadsToDraw:0,_itemsPerRow:0,_itemsPerColumn:0,_itemWidth:0,_itemHeight:0,_opacityModifyRGB:!1,_blendFunc:null,_ignoreContentScaleFactor:!1,_className:"AtlasNode",_texture:null,_textureForCanvas:null,ctor:function(tile,tileWidth,tileHeight,itemsToRender){cc.Node.prototype.ctor.call(this),this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},this._ignoreContentScaleFactor=!1,void 0!==itemsToRender&&this.initWithTileFile(tile,tileWidth,tileHeight,itemsToRender)},_createRenderCmd:function(){cc._renderType===cc.game.RENDER_TYPE_CANVAS?this._renderCmd=new cc.AtlasNode.CanvasRenderCmd(this):this._renderCmd=new cc.AtlasNode.WebGLRenderCmd(this)},updateAtlasValues:function(){cc.log(cc._LogInfos.AtlasNode_updateAtlasValues)},getColor:function(){return this._opacityModifyRGB?this._renderCmd._colorUnmodified:cc.Node.prototype.getColor.call(this)},setOpacityModifyRGB:function(value){var oldColor=this.color;this._opacityModifyRGB=value,this.setColor(oldColor)},isOpacityModifyRGB:function(){return this._opacityModifyRGB},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(src,dst){this._blendFunc=void 0===dst?src:{src:src,dst:dst}},setTextureAtlas:function(value){this.textureAtlas=value},getTextureAtlas:function(){return this.textureAtlas},getQuadsToDraw:function(){return this.quadsToDraw},setQuadsToDraw:function(quadsToDraw){this.quadsToDraw=quadsToDraw},initWithTileFile:function(tile,tileWidth,tileHeight,itemsToRender){if(!tile)throw new Error("cc.AtlasNode.initWithTileFile(): title should not be null");var texture=cc.textureCache.addImage(tile);return this.initWithTexture(texture,tileWidth,tileHeight,itemsToRender)},initWithTexture:function(texture,tileWidth,tileHeight,itemsToRender){return this._renderCmd.initWithTexture(texture,tileWidth,tileHeight,itemsToRender)},setColor:function(color){this._renderCmd.setColor(color)},setOpacity:function(opacity){this._renderCmd.setOpacity(opacity)},getTexture:function(){return this._texture},setTexture:function(texture){this._texture=texture},_setIgnoreContentScaleFactor:function(ignoreContentScaleFactor){this._ignoreContentScaleFactor=ignoreContentScaleFactor}});var _p=cc.AtlasNode.prototype;cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity),cc.defineGetterSetter(_p,"color",_p.getColor,_p.setColor),_p.texture,cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture),_p.textureAtlas,_p.quadsToDraw,cc.EventHelper.prototype.apply(_p),cc.AtlasNode.create=function(tile,tileWidth,tileHeight,itemsToRender){return new cc.AtlasNode(tile,tileWidth,tileHeight,itemsToRender)},function(){cc.AtlasNode.CanvasRenderCmd=function(renderableObject){this._rootCtor(renderableObject),this._needDraw=!1,this._colorUnmodified=cc.color.WHITE,this._textureToRender=null};var proto=cc.AtlasNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);proto.constructor=cc.AtlasNode.CanvasRenderCmd,proto.initWithTexture=function(texture,tileWidth,tileHeight,itemsToRender){var node=this._node;return node._itemWidth=tileWidth,node._itemHeight=tileHeight,node._opacityModifyRGB=!0,node._texture=texture,node._texture?(this._textureToRender=texture,this._calculateMaxItems(),node.quadsToDraw=itemsToRender,!0):(cc.log(cc._LogInfos.AtlasNode__initWithTexture),!1)},proto.setColor=function(color3){var locRealColor=this._node._realColor;locRealColor.r===color3.r&&locRealColor.g===color3.g&&locRealColor.b===color3.b||(this._colorUnmodified=color3,this._changeTextureColor())},proto._changeTextureColor=function(){var texture=this._node._texture,color=this._colorUnmodified,element=texture.getHtmlElementObj(),textureRect=cc.rect(0,0,element.width,element.height);texture===this._textureToRender?this._textureToRender=texture._generateColorTexture(color.r,color.g,color.b,textureRect):texture._generateColorTexture(color.r,color.g,color.b,textureRect,this._textureToRender.getHtmlElementObj())},proto.setOpacity=function(opacity){var node=this._node;cc.Node.prototype.setOpacity.call(node,opacity)},proto._calculateMaxItems=function(){var node=this._node,size=node._texture.getContentSize();node._itemsPerColumn=0|size.height/node._itemHeight,node._itemsPerRow=0|size.width/node._itemWidth}}(),function(){cc.AtlasNode.WebGLRenderCmd=function(renderableObject){this._rootCtor(renderableObject),this._needDraw=!0,this._textureAtlas=null,this._colorUnmodified=cc.color.WHITE,this._colorF32Array=null,this._uniformColor=null,this._matrix=new cc.math.Matrix4,this._matrix.identity(),this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE_UCOLOR),this._uniformColor=cc._renderContext.getUniformLocation(this._shaderProgram.getProgram(),"u_color")};var proto=cc.AtlasNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);proto.constructor=cc.AtlasNode.WebGLRenderCmd,proto._updateBlendFunc=function(){var node=this._node;this._textureAtlas.texture.hasPremultipliedAlpha()||(node._blendFunc.src=cc.SRC_ALPHA,node._blendFunc.dst=cc.ONE_MINUS_SRC_ALPHA)},proto._updateOpacityModifyRGB=function(){this._node._opacityModifyRGB=this._textureAtlas.texture.hasPremultipliedAlpha()},proto.rendering=function(ctx){var context=ctx||cc._renderContext,node=this._node,wt=this._worldTransform;this._matrix.mat[0]=wt.a,this._matrix.mat[4]=wt.c,this._matrix.mat[12]=wt.tx,this._matrix.mat[1]=wt.b,this._matrix.mat[5]=wt.d,this._matrix.mat[13]=wt.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),cc.glBlendFunc(node._blendFunc.src,node._blendFunc.dst),this._uniformColor&&this._colorF32Array&&(context.uniform4fv(this._uniformColor,this._colorF32Array),this._textureAtlas.drawNumberOfQuads(node.quadsToDraw,0))},proto.initWithTexture=function(texture,tileWidth,tileHeight,itemsToRender){var node=this._node;node._itemWidth=tileWidth,node._itemHeight=tileHeight,this._colorUnmodified=cc.color.WHITE,node._opacityModifyRGB=!0,node._blendFunc.src=cc.BLEND_SRC,node._blendFunc.dst=cc.BLEND_DST;var locRealColor=node._realColor;return this._colorF32Array=new Float32Array([locRealColor.r/255,locRealColor.g/255,locRealColor.b/255,node._realOpacity/255]),this._textureAtlas=new cc.TextureAtlas,this._textureAtlas.initWithTexture(texture,itemsToRender),this._textureAtlas?(this._updateBlendFunc(),this._updateOpacityModifyRGB(),this._calculateMaxItems(),node.quadsToDraw=itemsToRender,!0):(cc.log(cc._LogInfos.AtlasNode__initWithTexture),!1)},proto.setColor=function(color3){var temp=cc.color(color3.r,color3.g,color3.b),node=this._node;this._colorUnmodified=color3;var locDisplayedOpacity=this._displayedOpacity;node._opacityModifyRGB&&(temp.r=temp.r*locDisplayedOpacity/255,temp.g=temp.g*locDisplayedOpacity/255,temp.b=temp.b*locDisplayedOpacity/255),cc.Node.prototype.setColor.call(node,temp)},proto.setOpacity=function(opacity){var node=this._node;cc.Node.prototype.setOpacity.call(node,opacity),node._opacityModifyRGB&&(node.color=this._colorUnmodified)},proto._updateColor=function(){if(this._colorF32Array){var locDisplayedColor=this._displayedColor;this._colorF32Array[0]=locDisplayedColor.r/255,this._colorF32Array[1]=locDisplayedColor.g/255,this._colorF32Array[2]=locDisplayedColor.b/255,this._colorF32Array[3]=this._displayedOpacity/255}},proto.getTexture=function(){return this._textureAtlas.texture},proto.setTexture=function(texture){this._textureAtlas.texture=texture,this._updateBlendFunc(),this._updateOpacityModifyRGB()},proto._calculateMaxItems=function(){var node=this._node,selTexture=this._textureAtlas.texture,size=selTexture.getContentSize();node._ignoreContentScaleFactor&&(size=selTexture.getContentSizeInPixels()),node._itemsPerColumn=0|size.height/node._itemHeight,node._itemsPerRow=0|size.width/node._itemWidth}}(),cc._tmp.WebGLTexture2D=function(){cc.Texture2D=cc.Class.extend({_pVRHaveAlphaPremultiplied:!0,_pixelFormat:null,_pixelsWide:0,_pixelsHigh:0,_name:"",_contentSize:null,maxS:0,maxT:0,_hasPremultipliedAlpha:!1,_hasMipmaps:!1,shaderProgram:null,_textureLoaded:!1,_htmlElementObj:null,_webTextureObj:null,url:null,ctor:function(){this._contentSize=cc.size(0,0),this._pixelFormat=cc.Texture2D.defaultPixelFormat},releaseTexture:function(){this._webTextureObj&&cc._renderContext.deleteTexture(this._webTextureObj),cc.loader.release(this.url)},getPixelFormat:function(){return this._pixelFormat},getPixelsWide:function(){return this._pixelsWide},getPixelsHigh:function(){return this._pixelsHigh},getName:function(){return this._webTextureObj},getContentSize:function(){return cc.size(this._contentSize.width/cc.contentScaleFactor(),this._contentSize.height/cc.contentScaleFactor())},_getWidth:function(){return this._contentSize.width/cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},getMaxS:function(){return this.maxS},setMaxS:function(maxS){this.maxS=maxS},getMaxT:function(){return this.maxT},setMaxT:function(maxT){this.maxT=maxT},getShaderProgram:function(){return this.shaderProgram},setShaderProgram:function(shaderProgram){this.shaderProgram=shaderProgram},hasPremultipliedAlpha:function(){return this._hasPremultipliedAlpha},hasMipmaps:function(){return this._hasMipmaps},description:function(){var _t=this;return"<cc.Texture2D | Name = "+_t._name+" | Dimensions = "+_t._pixelsWide+" x "+_t._pixelsHigh+" | Coordinates = ("+_t.maxS+", "+_t.maxT+")>"},releaseData:function(data){null},keepData:function(data,length){return data},initWithData:function(data,pixelFormat,pixelsWide,pixelsHigh,contentSize){var tex2d=cc.Texture2D,gl=cc._renderContext,format=gl.RGBA,type=gl.UNSIGNED_BYTE,bytesPerRow=pixelsWide*cc.Texture2D._B[pixelFormat]/8;switch(bytesPerRow%8==0?gl.pixelStorei(gl.UNPACK_ALIGNMENT,8):bytesPerRow%4==0?gl.pixelStorei(gl.UNPACK_ALIGNMENT,4):bytesPerRow%2==0?gl.pixelStorei(gl.UNPACK_ALIGNMENT,2):gl.pixelStorei(gl.UNPACK_ALIGNMENT,1),this._webTextureObj=gl.createTexture(),cc.glBindTexture2D(this),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),pixelFormat){case tex2d.PIXEL_FORMAT_RGBA8888:format=gl.RGBA;break;case tex2d.PIXEL_FORMAT_RGB888:format=gl.RGB;break;case tex2d.PIXEL_FORMAT_RGBA4444:type=gl.UNSIGNED_SHORT_4_4_4_4;break;case tex2d.PIXEL_FORMAT_RGB5A1:type=gl.UNSIGNED_SHORT_5_5_5_1;break;case tex2d.PIXEL_FORMAT_RGB565:type=gl.UNSIGNED_SHORT_5_6_5;break;case tex2d.PIXEL_FORMAT_AI88:format=gl.LUMINANCE_ALPHA;break;case tex2d.PIXEL_FORMAT_A8:format=gl.ALPHA;break;case tex2d.PIXEL_FORMAT_I8:format=gl.LUMINANCE;break;default:cc.assert(0,cc._LogInfos.Texture2D_initWithData)}return gl.texImage2D(gl.TEXTURE_2D,0,format,pixelsWide,pixelsHigh,0,format,type,data),this._contentSize.width=contentSize.width,this._contentSize.height=contentSize.height,this._pixelsWide=pixelsWide,this._pixelsHigh=pixelsHigh,this._pixelFormat=pixelFormat,this.maxS=contentSize.width/pixelsWide,this.maxT=contentSize.height/pixelsHigh,this._hasPremultipliedAlpha=!1,this._hasMipmaps=!1,this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE),this._textureLoaded=!0},drawAtPoint:function(point){var coordinates=[0,this.maxT,this.maxS,this.maxT,0,0,this.maxS,0],gl=cc._renderContext,width=this._pixelsWide*this.maxS,height=this._pixelsHigh*this.maxT,vertices=[point.x,point.y,0,width+point.x,point.y,0,point.x,height+point.y,0,width+point.x,height+point.y,0];this._shaderProgram.use(),this._shaderProgram.setUniformsForBuiltins(),cc.glBindTexture2D(this),gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),gl.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,gl.FLOAT,!1,0,vertices),gl.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,gl.FLOAT,!1,0,coordinates),gl.drawArrays(gl.TRIANGLE_STRIP,0,4)},drawInRect:function(rect){var coordinates=[0,this.maxT,this.maxS,this.maxT,0,0,this.maxS,0],vertices=[rect.x,rect.y,rect.x+rect.width,rect.y,rect.x,rect.y+rect.height,rect.x+rect.width,rect.y+rect.height];this._shaderProgram.use(),this._shaderProgram.setUniformsForBuiltins(),cc.glBindTexture2D(this);var gl=cc._renderContext;gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),gl.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,gl.FLOAT,!1,0,vertices),gl.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,gl.FLOAT,!1,0,coordinates),gl.drawArrays(gl.TRIANGLE_STRIP,0,4)},initWithImage:function(uiImage){if(null==uiImage)return cc.log(cc._LogInfos.Texture2D_initWithImage),!1;var imageWidth=uiImage.getWidth(),imageHeight=uiImage.getHeight(),maxTextureSize=cc.configuration.getMaxTextureSize();return maxTextureSize<imageWidth||maxTextureSize<imageHeight?(cc.log(cc._LogInfos.Texture2D_initWithImage_2,imageWidth,imageHeight,maxTextureSize,maxTextureSize),!1):(this._textureLoaded=!0,this._initPremultipliedATextureWithImage(uiImage,imageWidth,imageHeight))},initWithElement:function(element){element&&(this._webTextureObj=cc._renderContext.createTexture(),this._htmlElementObj=element,this._textureLoaded=!0,this._hasPremultipliedAlpha=!0)},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(premultiplied){if(premultiplied=void 0!==premultiplied?premultiplied:this._hasPremultipliedAlpha,cc.game._rendererInitialized){if(!this._htmlElementObj){var img=cc.loader.getRes(this.url);if(!img)return;this.initWithElement(img)}if(this._htmlElementObj.width&&this._htmlElementObj.height){var gl=cc._renderContext;cc.glBindTexture2D(this),gl.pixelStorei(gl.UNPACK_ALIGNMENT,4),premultiplied&&gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,this._htmlElementObj),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE),cc.glBindTexture2D(null),premultiplied&&gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0);var pixelsWide=this._htmlElementObj.width,pixelsHigh=this._htmlElementObj.height;this._pixelsWide=this._contentSize.width=pixelsWide,this._pixelsHigh=this._contentSize.height=pixelsHigh,this._pixelFormat=cc.Texture2D.PIXEL_FORMAT_RGBA8888,this.maxS=1,this.maxT=1,this._hasPremultipliedAlpha=premultiplied,this._hasMipmaps=!1,this.dispatchEvent("load")}}},initWithString:function(text,fontName,fontSize,dimensions,hAlignment,vAlignment){return cc.log(cc._LogInfos.Texture2D_initWithString),null},initWithETCFile:function(file){return cc.log(cc._LogInfos.Texture2D_initWithETCFile_2),!1},initWithPVRFile:function(file){return cc.log(cc._LogInfos.Texture2D_initWithPVRFile_2),!1},initWithPVRTCData:function(data,level,bpp,hasAlpha,length,pixelFormat){return cc.log(cc._LogInfos.Texture2D_initWithPVRTCData_2),!1},setTexParameters:function(texParams,magFilter,wrapS,wrapT){var _t=this,gl=cc._renderContext;void 0!==magFilter&&(texParams={minFilter:texParams,magFilter:magFilter,wrapS:wrapS,wrapT:wrapT}),cc.assert(_t._pixelsWide===cc.NextPOT(_t._pixelsWide)&&_t._pixelsHigh===cc.NextPOT(_t._pixelsHigh)||texParams.wrapS===gl.CLAMP_TO_EDGE&&texParams.wrapT===gl.CLAMP_TO_EDGE,"WebGLRenderingContext.CLAMP_TO_EDGE should be used in NPOT textures"),cc.glBindTexture2D(_t),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,texParams.minFilter),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,texParams.magFilter),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,texParams.wrapS),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,texParams.wrapT)},setAntiAliasTexParameters:function(){var gl=cc._renderContext;cc.glBindTexture2D(this),this._hasMipmaps?gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_NEAREST):gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR)},setAliasTexParameters:function(){var gl=cc._renderContext;cc.glBindTexture2D(this),this._hasMipmaps?gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST_MIPMAP_NEAREST):gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST)},generateMipmap:function(){var _t=this;cc.assert(_t._pixelsWide===cc.NextPOT(_t._pixelsWide)&&_t._pixelsHigh===cc.NextPOT(_t._pixelsHigh),"Mimpap texture only works in POT textures"),cc.glBindTexture2D(_t),cc._renderContext.generateMipmap(cc._renderContext.TEXTURE_2D),_t._hasMipmaps=!0},stringForFormat:function(){return cc.Texture2D._M[this._pixelFormat]},bitsPerPixelForFormat:function(format){format=format||this._pixelFormat;var value=cc.Texture2D._B[format];return null!=value?value:(cc.log(cc._LogInfos.Texture2D_bitsPerPixelForFormat,format),-1)},_initPremultipliedATextureWithImage:function(uiImage,width,height){var tex2d=cc.Texture2D,tempData=uiImage.getData(),inPixel32=null,inPixel8=null,hasAlpha=uiImage.hasAlpha(),imageSize=cc.size(uiImage.getWidth(),uiImage.getHeight()),pixelFormat=tex2d.defaultPixelFormat,bpp=uiImage.getBitsPerComponent();hasAlpha||(pixelFormat=8<=bpp?tex2d.PIXEL_FORMAT_RGB888:(cc.log(cc._LogInfos.Texture2D__initPremultipliedATextureWithImage),tex2d.PIXEL_FORMAT_RGB565));var i,length=width*height;if(pixelFormat===tex2d.PIXEL_FORMAT_RGB565)if(hasAlpha)for(tempData=new Uint16Array(width*height),inPixel32=uiImage.getData(),i=0;i<length;++i)tempData[i]=(inPixel32[i]>>0&255)>>3<<11|(inPixel32[i]>>8&255)>>2<<5|(inPixel32[i]>>16&255)>>3<<0;else for(tempData=new Uint16Array(width*height),inPixel8=uiImage.getData(),i=0;i<length;++i)tempData[i]=(255&inPixel8[i])>>3<<11|(255&inPixel8[i])>>2<<5|(255&inPixel8[i])>>3<<0;else if(pixelFormat===tex2d.PIXEL_FORMAT_RGBA4444)for(tempData=new Uint16Array(width*height),inPixel32=uiImage.getData(),i=0;i<length;++i)tempData[i]=(inPixel32[i]>>0&255)>>4<<12|(inPixel32[i]>>8&255)>>4<<8|(inPixel32[i]>>16&255)>>4<<4|(inPixel32[i]>>24&255)>>4<<0;else if(pixelFormat===tex2d.PIXEL_FORMAT_RGB5A1)for(tempData=new Uint16Array(width*height),inPixel32=uiImage.getData(),i=0;i<length;++i)tempData[i]=(inPixel32[i]>>0&255)>>3<<11|(inPixel32[i]>>8&255)>>3<<6|(inPixel32[i]>>16&255)>>3<<1|(inPixel32[i]>>24&255)>>7<<0;else if(pixelFormat===tex2d.PIXEL_FORMAT_A8)for(tempData=new Uint8Array(width*height),inPixel32=uiImage.getData(),i=0;i<length;++i)tempData[i]=inPixel32>>24&255;if(hasAlpha&&pixelFormat===tex2d.PIXEL_FORMAT_RGB888)for(inPixel32=uiImage.getData(),tempData=new Uint8Array(width*height*3),i=0;i<length;++i)tempData[3*i]=inPixel32>>0&255,tempData[3*i+1]=inPixel32>>8&255,tempData[3*i+2]=inPixel32>>16&255;return this.initWithData(tempData,pixelFormat,width,height,imageSize),tempData!=uiImage.getData()&&(tempData=null),this._hasPremultipliedAlpha=uiImage.isPremultipliedAlpha(),!0},addLoadedEventListener:function(callback,target){this.addEventListener("load",callback,target)},removeLoadedEventListener:function(target){this.removeEventTarget("load",target)}})},cc._tmp.WebGLTextureAtlas=function(){var _p=cc.TextureAtlas.prototype;_p._setupVBO=function(){var gl=cc._renderContext;this._buffersVBO[0]=gl.createBuffer(),this._buffersVBO[1]=gl.createBuffer(),this._quadsWebBuffer=gl.createBuffer(),this._mapBuffers()},_p._mapBuffers=function(){var gl=cc._renderContext;gl.bindBuffer(gl.ARRAY_BUFFER,this._quadsWebBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._quadsArrayBuffer,gl.DYNAMIC_DRAW),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this._indices,gl.STATIC_DRAW)},_p.drawNumberOfQuads=function(n,start){var _t=this;if(start=start||0,0!==n&&_t.texture&&_t.texture.isLoaded()){var gl=cc._renderContext;cc.glBindTexture2D(_t.texture),gl.bindBuffer(gl.ARRAY_BUFFER,_t._quadsWebBuffer),_t.dirty&&(gl.bufferData(gl.ARRAY_BUFFER,_t._quadsArrayBuffer,gl.DYNAMIC_DRAW),_t.dirty=!1),gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),gl.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,gl.FLOAT,!1,24,0),gl.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,gl.UNSIGNED_BYTE,!0,24,12),gl.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,gl.FLOAT,!1,24,16),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,_t._buffersVBO[1]),cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?gl.drawElements(gl.TRIANGLE_STRIP,6*n,gl.UNSIGNED_SHORT,6*start*_t._indices.BYTES_PER_ELEMENT):gl.drawElements(gl.TRIANGLES,6*n,gl.UNSIGNED_SHORT,6*start*_t._indices.BYTES_PER_ELEMENT),cc.g_NumberOfDraws++}}},cc._tmp.WebGLTextureCache=function(){var _p=cc.textureCache;_p.handleLoadedTexture=function(url){var tex,locTexs=this._textures;cc.game._rendererInitialized||(locTexs=this._loadedTexturesBefore),(tex=locTexs[url])||((tex=locTexs[url]=new cc.Texture2D).url=url),".png"===cc.path.extname(url)?tex.handleLoadedTexture(!0):tex.handleLoadedTexture()},_p.addImage=function(url,cb,target){cc.assert(url,cc._LogInfos.Texture2D_addImage_2);var locTexs=this._textures;cc.game._rendererInitialized||(locTexs=this._loadedTexturesBefore);var tex=locTexs[url]||locTexs[cc.loader._getAliase(url)];if(tex)return tex.isLoaded()?cb&&cb.call(target,tex):tex.addEventListener("load",function(){cb&&cb.call(target,tex)},target),tex;(tex=locTexs[url]=new cc.Texture2D).url=url;return cc.loader.loadImg(cc.path.join("",url),function(err,img){if(err)return cb&&cb.call(target,err);cc.loader.cache[url]||(cc.loader.cache[url]=img),cc.textureCache.handleLoadedTexture(url);var texResult=locTexs[url];cb&&cb.call(target,texResult)}),tex},_p.addImageAsync=_p.addImage,_p=null},cc._tmp.PrototypeTexture2D=function(){var _c=cc.Texture2D;_c.PVRImagesHavePremultipliedAlpha=function(haveAlphaPremultiplied){cc.PVRHaveAlphaPremultiplied_=haveAlphaPremultiplied},_c.PIXEL_FORMAT_RGBA8888=2,_c.PIXEL_FORMAT_RGB888=3,_c.PIXEL_FORMAT_RGB565=4,_c.PIXEL_FORMAT_A8=5,_c.PIXEL_FORMAT_I8=6,_c.PIXEL_FORMAT_AI88=7,_c.PIXEL_FORMAT_RGBA4444=8,_c.PIXEL_FORMAT_RGB5A1=7,_c.PIXEL_FORMAT_PVRTC4=9,_c.PIXEL_FORMAT_PVRTC2=10,_c.PIXEL_FORMAT_DEFAULT=_c.PIXEL_FORMAT_RGBA8888,_c.defaultPixelFormat=_c.PIXEL_FORMAT_DEFAULT;var _M=cc.Texture2D._M={};_M[_c.PIXEL_FORMAT_RGBA8888]="RGBA8888",_M[_c.PIXEL_FORMAT_RGB888]="RGB888",_M[_c.PIXEL_FORMAT_RGB565]="RGB565",_M[_c.PIXEL_FORMAT_A8]="A8",_M[_c.PIXEL_FORMAT_I8]="I8",_M[_c.PIXEL_FORMAT_AI88]="AI88",_M[_c.PIXEL_FORMAT_RGBA4444]="RGBA4444",_M[_c.PIXEL_FORMAT_RGB5A1]="RGB5A1",_M[_c.PIXEL_FORMAT_PVRTC4]="PVRTC4",_M[_c.PIXEL_FORMAT_PVRTC2]="PVRTC2";var _B=cc.Texture2D._B={};_B[_c.PIXEL_FORMAT_RGBA8888]=32,_B[_c.PIXEL_FORMAT_RGB888]=24,_B[_c.PIXEL_FORMAT_RGB565]=16,_B[_c.PIXEL_FORMAT_A8]=8,_B[_c.PIXEL_FORMAT_I8]=8,_B[_c.PIXEL_FORMAT_AI88]=16,_B[_c.PIXEL_FORMAT_RGBA4444]=16,_B[_c.PIXEL_FORMAT_RGB5A1]=16,_B[_c.PIXEL_FORMAT_PVRTC4]=4,_B[_c.PIXEL_FORMAT_PVRTC2]=3;var _p=cc.Texture2D.prototype;_p.name,cc.defineGetterSetter(_p,"name",_p.getName),_p.pixelFormat,cc.defineGetterSetter(_p,"pixelFormat",_p.getPixelFormat),_p.pixelsWidth,cc.defineGetterSetter(_p,"pixelsWidth",_p.getPixelsWide),_p.pixelsHeight,cc.defineGetterSetter(_p,"pixelsHeight",_p.getPixelsHigh),_p.width,cc.defineGetterSetter(_p,"width",_p._getWidth),_p.height,cc.defineGetterSetter(_p,"height",_p._getHeight)},cc._tmp.PrototypeTextureAtlas=function(){var _p=cc.TextureAtlas.prototype;_p.totalQuads,cc.defineGetterSetter(_p,"totalQuads",_p.getTotalQuads),_p.capacity,cc.defineGetterSetter(_p,"capacity",_p.getCapacity),_p.quads,cc.defineGetterSetter(_p,"quads",_p.getQuads,_p.setQuads)},cc.ALIGN_CENTER=51,cc.ALIGN_TOP=19,cc.ALIGN_TOP_RIGHT=18,cc.ALIGN_RIGHT=50,cc.ALIGN_BOTTOM_RIGHT=34,cc.ALIGN_BOTTOM=35,cc.ALIGN_BOTTOM_LEFT=33,cc.ALIGN_LEFT=49,cc.ALIGN_TOP_LEFT=17,cc.PVRHaveAlphaPremultiplied_=!1,cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var proto={_contentSize:null,_textureLoaded:!1,_htmlElementObj:null,url:null,_pattern:null,ctor:function(){this._contentSize=cc.size(0,0),this._textureLoaded=!1,this._htmlElementObj=null,this._pattern="",this._pixelsWide=0,this._pixelsHigh=0},getPixelsWide:function(){return this._pixelsWide},getPixelsHigh:function(){return this._pixelsHigh},getContentSize:function(){var locScaleFactor=cc.contentScaleFactor();return cc.size(this._contentSize.width/locScaleFactor,this._contentSize.height/locScaleFactor)},_getWidth:function(){return this._contentSize.width/cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},initWithElement:function(element){element&&(this._htmlElementObj=element,this._pixelsWide=this._contentSize.width=element.width,this._pixelsHigh=this._contentSize.height=element.height,this._textureLoaded=!0)},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(){if(!this._textureLoaded){if(!this._htmlElementObj){var img=cc.loader.getRes(this.url);if(!img)return;this.initWithElement(img)}var locElement=this._htmlElementObj;this._pixelsWide=this._contentSize.width=locElement.width,this._pixelsHigh=this._contentSize.height=locElement.height,this.dispatchEvent("load")}},description:function(){return"<cc.Texture2D | width = "+this._contentSize.width+" height "+this._contentSize.height+">"},initWithData:function(data,pixelFormat,pixelsWide,pixelsHigh,contentSize){return!1},initWithImage:function(uiImage){return!1},initWithString:function(text,fontName,fontSize,dimensions,hAlignment,vAlignment){return!1},releaseTexture:function(){cc.loader.release(this.url)},getName:function(){return null},getMaxS:function(){return 1},setMaxS:function(maxS){},getMaxT:function(){return 1},setMaxT:function(maxT){},getPixelFormat:function(){return null},getShaderProgram:function(){return null},setShaderProgram:function(shaderProgram){},hasPremultipliedAlpha:function(){return!1},hasMipmaps:function(){return!1},releaseData:function(data){null},keepData:function(data,length){return data},drawAtPoint:function(point){},drawInRect:function(rect){},initWithETCFile:function(file){return cc.log(cc._LogInfos.Texture2D_initWithETCFile),!1},initWithPVRFile:function(file){return cc.log(cc._LogInfos.Texture2D_initWithPVRFile),!1},initWithPVRTCData:function(data,level,bpp,hasAlpha,length,pixelFormat){return cc.log(cc._LogInfos.Texture2D_initWithPVRTCData),!1},setTexParameters:function(texParams,magFilter,wrapS,wrapT){void 0!==magFilter&&(texParams={minFilter:texParams,magFilter:magFilter,wrapS:wrapS,wrapT:wrapT}),texParams.wrapS!==cc.REPEAT||texParams.wrapT!==cc.REPEAT?texParams.wrapS!==cc.REPEAT?texParams.wrapT!==cc.REPEAT?this._pattern="":this._pattern="repeat-y":this._pattern="repeat-x":this._pattern="repeat"},setAntiAliasTexParameters:function(){},setAliasTexParameters:function(){},generateMipmap:function(){},stringForFormat:function(){return""},bitsPerPixelForFormat:function(format){return-1},addLoadedEventListener:function(callback,target){this.addEventListener("load",callback,target)},removeLoadedEventListener:function(target){this.removeEventTarget("load",target)},_generateColorTexture:function(){},_generateTextureCacheForColor:function(){if(this.channelCache)return this.channelCache;var textureCache=[document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas")];return renderToCache(this._htmlElementObj,textureCache),this.channelCache=textureCache},_grayElementObj:null,_backupElement:null,_isGray:!1,_switchToGray:function(toGray){this._textureLoaded&&this._isGray!==toGray&&(this._isGray=toGray,this._isGray?(this._backupElement=this._htmlElementObj,this._grayElementObj||(this._grayElementObj=cc.Texture2D._generateGrayTexture(this._htmlElementObj)),this._htmlElementObj=this._grayElementObj):null!==this._backupElement&&(this._htmlElementObj=this._backupElement))},_generateGrayTexture:function(){if(!this._textureLoaded)return null;var grayElement=cc.Texture2D._generateGrayTexture(this._htmlElementObj),newTexture=new cc.Texture2D;return newTexture.initWithElement(grayElement),newTexture.handleLoadedTexture(),newTexture}},renderToCache=function(image,cache){var w=image.width,h=image.height;cache[0].width=w,cache[0].height=h,cache[1].width=w,cache[1].height=h,cache[2].width=w,cache[2].height=h,cache[3].width=w,cache[3].height=h;var cacheCtx=cache[3].getContext("2d");cacheCtx.drawImage(image,0,0);for(var ctx,pixels=cacheCtx.getImageData(0,0,w,h).data,rgbI=0;rgbI<4;rgbI++){for(var to=(ctx=cache[rgbI].getContext("2d")).getImageData(0,0,w,h),data=to.data,i=0;i<pixels.length;i+=4)data[i]=0===rgbI?pixels[i]:0,data[i+1]=1===rgbI?pixels[i+1]:0,data[i+2]=2===rgbI?pixels[i+2]:0,data[i+3]=pixels[i+3];ctx.putImageData(to,0,0)}image.onload=null};cc.sys._supportCanvasNewBlendModes?proto._generateColorTexture=function(r,g,b,rect,canvas){var onlyCanvas=!1;canvas?onlyCanvas=!0:canvas=document.createElement("canvas");var textureImage=this._htmlElementObj;rect||(rect=cc.rect(0,0,textureImage.width,textureImage.height)),canvas.width=rect.width,canvas.height=rect.height;var context=canvas.getContext("2d");if(context.globalCompositeOperation="source-over",context.fillStyle="rgb("+(0|r)+","+(0|g)+","+(0|b)+")",context.fillRect(0,0,rect.width,rect.height),context.globalCompositeOperation="multiply",context.drawImage(textureImage,rect.x,rect.y,rect.width,rect.height,0,0,rect.width,rect.height),context.globalCompositeOperation="destination-atop",context.drawImage(textureImage,rect.x,rect.y,rect.width,rect.height,0,0,rect.width,rect.height),onlyCanvas)return canvas;var newTexture=new cc.Texture2D;return newTexture.initWithElement(canvas),newTexture.handleLoadedTexture(),newTexture}:proto._generateColorTexture=function(r,g,b,rect,canvas){var onlyCanvas=!1;canvas?onlyCanvas=!0:canvas=document.createElement("canvas");var x,y,w,h,textureImage=this._htmlElementObj;if(rect||(rect=cc.rect(0,0,textureImage.width,textureImage.height)),x=rect.x,y=rect.y,w=rect.width,h=rect.height,w&&h){canvas.width=w,canvas.height=h;var context=canvas.getContext("2d"),tintedImgCache=cc.textureCache.getTextureColors(this);if(context.globalCompositeOperation="lighter",context.drawImage(tintedImgCache[3],x,y,w,h,0,0,w,h),0<r&&(context.globalAlpha=r/255,context.drawImage(tintedImgCache[0],x,y,w,h,0,0,w,h)),0<g&&(context.globalAlpha=g/255,context.drawImage(tintedImgCache[1],x,y,w,h,0,0,w,h)),0<b&&(context.globalAlpha=b/255,context.drawImage(tintedImgCache[2],x,y,w,h,0,0,w,h)),onlyCanvas)return canvas;var newTexture=new cc.Texture2D;return newTexture.initWithElement(canvas),newTexture.handleLoadedTexture(),newTexture}},cc.Texture2D=cc.Class.extend(proto),cc.Texture2D._generateGrayTexture=function(texture,rect,renderCanvas){if(null===texture)return null;renderCanvas=renderCanvas||document.createElement("canvas"),rect=rect||cc.rect(0,0,texture.width,texture.height),renderCanvas.width=rect.width,renderCanvas.height=rect.height;var context=renderCanvas.getContext("2d");context.drawImage(texture,rect.x,rect.y,rect.width,rect.height,0,0,rect.width,rect.height);for(var imgData=context.getImageData(0,0,rect.width,rect.height),data=imgData.data,i=0,len=data.length;i<len;i+=4)data[i]=data[i+1]=data[i+2]=.34*data[i]+.5*data[i+1]+.16*data[i+2];return context.putImageData(imgData,0,0),renderCanvas}}else cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc.assert(cc.isFunction(cc._tmp.WebGLTexture2D),cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTexture2D(),delete cc._tmp.WebGLTexture2D);cc.EventHelper.prototype.apply(cc.Texture2D.prototype),cc.assert(cc.isFunction(cc._tmp.PrototypeTexture2D),cc._LogInfos.MissingFile,"TexturesPropertyDefine.js"),cc._tmp.PrototypeTexture2D(),delete cc._tmp.PrototypeTexture2D}),cc.textureCache={_textures:{},_textureColorsCache:{},_textureKeySeq:0|1e3*Math.random(),_loadedTexturesBefore:{},_initializingRenderer:function(){var selPath,locLoadedTexturesBefore=this._loadedTexturesBefore,locTextures=this._textures;for(selPath in locLoadedTexturesBefore){var tex2d=locLoadedTexturesBefore[selPath];tex2d.handleLoadedTexture(),locTextures[selPath]=tex2d}this._loadedTexturesBefore={}},addPVRTCImage:function(filename){cc.log(cc._LogInfos.textureCache_addPVRTCImage)},addETCImage:function(filename){cc.log(cc._LogInfos.textureCache_addETCImage)},description:function(){return"<TextureCache | Number of textures = "+this._textures.length+">"},textureForKey:function(textureKeyName){return cc.log(cc._LogInfos.textureCache_textureForKey),this.getTextureForKey(textureKeyName)},getTextureForKey:function(textureKeyName){return this._textures[textureKeyName]||this._textures[cc.loader._getAliase(textureKeyName)]},getKeyByTexture:function(texture){for(var key in this._textures)if(this._textures[key]===texture)return key;return null},_generalTextureKey:function(id){return"_textureKey_"+id},getTextureColors:function(texture){var image=texture._htmlElementObj,key=this.getKeyByTexture(image);return key||(key=image instanceof HTMLImageElement?image.src:this._generalTextureKey(texture.__instanceId)),this._textureColorsCache[key]||(this._textureColorsCache[key]=texture._generateTextureCacheForColor()),this._textureColorsCache[key]},addPVRImage:function(path){cc.log(cc._LogInfos.textureCache_addPVRImage)},removeAllTextures:function(){var locTextures=this._textures;for(var selKey in locTextures)locTextures[selKey]&&locTextures[selKey].releaseTexture();this._textures={}},removeTexture:function(texture){if(texture){var locTextures=this._textures;for(var selKey in locTextures)locTextures[selKey]===texture&&(locTextures[selKey].releaseTexture(),delete locTextures[selKey])}},removeTextureForKey:function(textureKeyName){if(null!=textureKeyName){var tex=this._textures[textureKeyName];tex&&(tex.releaseTexture(),delete this._textures[textureKeyName])}},cacheImage:function(path,texture){if(texture instanceof cc.Texture2D)this._textures[path]=texture;else{var texture2d=new cc.Texture2D;texture2d.initWithElement(texture),texture2d.handleLoadedTexture(),this._textures[path]=texture2d}},addUIImage:function(image,key){if(cc.assert(image,cc._LogInfos.textureCache_addUIImage_2),key&&this._textures[key])return this._textures[key];var texture=new cc.Texture2D;return texture.initWithImage(image),null!=key?this._textures[key]=texture:cc.log(cc._LogInfos.textureCache_addUIImage),texture},dumpCachedTextureInfo:function(){var count=0,totalBytes=0,locTextures=this._textures;for(var key in locTextures){var selTexture=locTextures[key];count++,selTexture.getHtmlElementObj()instanceof HTMLImageElement?cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo,key,selTexture.getHtmlElementObj().src,selTexture.pixelsWidth,selTexture.pixelsHeight):cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_2,key,selTexture.pixelsWidth,selTexture.pixelsHeight),totalBytes+=selTexture.pixelsWidth*selTexture.pixelsHeight*4}var locTextureColorsCache=this._textureColorsCache;for(key in locTextureColorsCache){var selCanvasColorsArr=locTextureColorsCache[key];for(var selCanvasKey in selCanvasColorsArr){var selCanvas=selCanvasColorsArr[selCanvasKey];count++,cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_2,key,selCanvas.width,selCanvas.height),totalBytes+=selCanvas.width*selCanvas.height*4}}cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_3,count,totalBytes/1024,(totalBytes/1048576).toFixed(2))},_clear:function(){this._textures={},this._textureColorsCache={},this._textureKeySeq=0|1e3*Math.random(),this._loadedTexturesBefore={}}},cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var _p=cc.textureCache;_p.handleLoadedTexture=function(url){var locTexs=this._textures,tex=locTexs[url];tex||((tex=locTexs[url]=new cc.Texture2D).url=url),tex.handleLoadedTexture()},_p.addImage=function(url,cb,target){cc.assert(url,cc._LogInfos.Texture2D_addImage);var locTexs=this._textures,tex=locTexs[url]||locTexs[cc.loader._getAliase(url)];if(tex)return tex.isLoaded()?cb&&cb.call(target,tex):tex.addEventListener("load",function(){cb&&cb.call(target,tex)},target),tex;(tex=locTexs[url]=new cc.Texture2D).url=url;var basePath=cc.loader.getBasePath?cc.loader.getBasePath():cc.loader.resPath;return cc.loader.loadImg(cc.path.join(basePath||"",url),function(err,img){if(err)return cb&&cb.call(target,err);cc.loader.cache[url]||(cc.loader.cache[url]=img),cc.textureCache.handleLoadedTexture(url);var texResult=locTexs[url];cb&&cb.call(target,texResult)}),tex},_p.addImageAsync=_p.addImage,_p=null}else cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc.assert(cc.isFunction(cc._tmp.WebGLTextureCache),cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTextureCache(),delete cc._tmp.WebGLTextureCache)}),cc.TextureAtlas=cc.Class.extend({dirty:!1,texture:null,_indices:null,_buffersVBO:null,_capacity:0,_quads:null,_quadsArrayBuffer:null,_quadsWebBuffer:null,_quadsReader:null,ctor:function(fileName,capacity){this._buffersVBO=[],cc.isString(fileName)?this.initWithFile(fileName,capacity):fileName instanceof cc.Texture2D&&this.initWithTexture(fileName,capacity)},getTotalQuads:function(){return this._totalQuads},getCapacity:function(){return this._capacity},getTexture:function(){return this.texture},setTexture:function(texture){this.texture=texture},setDirty:function(dirty){this.dirty=dirty},isDirty:function(){return this.dirty},getQuads:function(){return this._quads},setQuads:function(quads){this._quads=quads},_copyQuadsToTextureAtlas:function(quads,index){if(quads)for(var i=0;i<quads.length;i++)this._setQuadToArray(quads[i],index+i)},_setQuadToArray:function(quad,index){var locQuads=this._quads;locQuads[index]?(locQuads[index].bl=quad.bl,locQuads[index].br=quad.br,locQuads[index].tl=quad.tl,locQuads[index].tr=quad.tr):locQuads[index]=new cc.V3F_C4B_T2F_Quad(quad.tl,quad.bl,quad.tr,quad.br,this._quadsArrayBuffer,index*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT)},description:function(){return"<cc.TextureAtlas | totalQuads ="+this._totalQuads+">"},_setupIndices:function(){if(0!==this._capacity)for(var locIndices=this._indices,locCapacity=this._capacity,i=0;i<locCapacity;i++)cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?(locIndices[6*i+0]=4*i+0,locIndices[6*i+1]=4*i+0,locIndices[6*i+2]=4*i+2,locIndices[6*i+3]=4*i+1,locIndices[6*i+4]=4*i+3,locIndices[6*i+5]=4*i+3):(locIndices[6*i+0]=4*i+0,locIndices[6*i+1]=4*i+1,locIndices[6*i+2]=4*i+2,locIndices[6*i+3]=4*i+3,locIndices[6*i+4]=4*i+2,locIndices[6*i+5]=4*i+1)},_setupVBO:function(){var gl=cc._renderContext;this._buffersVBO[0]=gl.createBuffer(),this._buffersVBO[1]=gl.createBuffer(),this._quadsWebBuffer=gl.createBuffer(),this._mapBuffers()},_mapBuffers:function(){var gl=cc._renderContext;gl.bindBuffer(gl.ARRAY_BUFFER,this._quadsWebBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._quadsArrayBuffer,gl.DYNAMIC_DRAW),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this._indices,gl.STATIC_DRAW)},initWithFile:function(file,capacity){var texture=cc.textureCache.addImage(file);return texture?this.initWithTexture(texture,capacity):(cc.log(cc._LogInfos.TextureAtlas_initWithFile,file),!1)},initWithTexture:function(texture,capacity){cc.assert(texture,cc._LogInfos.TextureAtlas_initWithTexture),capacity|=0,this._capacity=capacity,this._totalQuads=0,this.texture=texture,this._quads=[],this._indices=new Uint16Array(6*capacity);var quadSize=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._quadsArrayBuffer=new ArrayBuffer(quadSize*capacity),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),(!this._quads||!this._indices)&&0<capacity)return!1;for(var locQuads=this._quads,i=0;i<capacity;i++)locQuads[i]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,i*quadSize);return this._setupIndices(),this._setupVBO(),this.dirty=!0},updateQuad:function(quad,index){cc.assert(quad,cc._LogInfos.TextureAtlas_updateQuad),cc.assert(0<=index&&index<this._capacity,cc._LogInfos.TextureAtlas_updateQuad_2),this._totalQuads=Math.max(index+1,this._totalQuads),this._setQuadToArray(quad,index),this.dirty=!0},insertQuad:function(quad,index){if(cc.assert(index<this._capacity,cc._LogInfos.TextureAtlas_insertQuad_2),this._totalQuads++,this._totalQuads>this._capacity)cc.log(cc._LogInfos.TextureAtlas_insertQuad);else{var quadSize=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,startOffset=index*quadSize,moveLength=(this._totalQuads-1-index)*quadSize;this._quads[this._totalQuads-1]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*quadSize),this._quadsReader.set(this._quadsReader.subarray(startOffset,startOffset+moveLength),startOffset+quadSize),this._setQuadToArray(quad,index),this.dirty=!0}},insertQuads:function(quads,index,amount){amount=amount||quads.length,cc.assert(index+amount<=this._capacity,cc._LogInfos.TextureAtlas_insertQuads);var quadSize=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._totalQuads+=amount,this._totalQuads>this._capacity)cc.log(cc._LogInfos.TextureAtlas_insertQuad);else{var i,startOffset=index*quadSize,moveLength=(this._totalQuads-1-index-amount)*quadSize,lastIndex=this._totalQuads-1-amount;for(i=0;i<amount;i++)this._quads[lastIndex+i]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*quadSize);for(this._quadsReader.set(this._quadsReader.subarray(startOffset,startOffset+moveLength),startOffset+quadSize*amount),i=0;i<amount;i++)this._setQuadToArray(quads[i],index+i);this.dirty=!0}},insertQuadFromIndex:function(fromIndex,newIndex){if(fromIndex!==newIndex){cc.assert(0<=newIndex||newIndex<this._totalQuads,cc._LogInfos.TextureAtlas_insertQuadFromIndex),cc.assert(0<=fromIndex||fromIndex<this._totalQuads,cc._LogInfos.TextureAtlas_insertQuadFromIndex_2);var startOffset,moveLength,quadSize=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,locQuadsReader=this._quadsReader,sourceArr=locQuadsReader.subarray(fromIndex*quadSize,quadSize);newIndex<fromIndex?(startOffset=newIndex*quadSize,moveLength=(fromIndex-newIndex)*quadSize,locQuadsReader.set(locQuadsReader.subarray(startOffset,startOffset+moveLength),startOffset+quadSize),locQuadsReader.set(sourceArr,startOffset)):(startOffset=(fromIndex+1)*quadSize,moveLength=(newIndex-fromIndex)*quadSize,locQuadsReader.set(locQuadsReader.subarray(startOffset,startOffset+moveLength),startOffset-quadSize),locQuadsReader.set(sourceArr,newIndex*quadSize)),this.dirty=!0}},removeQuadAtIndex:function(index){cc.assert(index<this._totalQuads,cc._LogInfos.TextureAtlas_removeQuadAtIndex);var quadSize=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._totalQuads--,this._quads.length=this._totalQuads,index!==this._totalQuads){var startOffset=(index+1)*quadSize,moveLength=(this._totalQuads-index)*quadSize;this._quadsReader.set(this._quadsReader.subarray(startOffset,startOffset+moveLength),startOffset-quadSize)}this.dirty=!0},removeQuadsAtIndex:function(index,amount){if(cc.assert(index+amount<=this._totalQuads,cc._LogInfos.TextureAtlas_removeQuadsAtIndex),this._totalQuads-=amount,index!==this._totalQuads){var quadSize=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,srcOffset=(index+amount)*quadSize,moveLength=(this._totalQuads-index)*quadSize,dstOffset=index*quadSize;this._quadsReader.set(this._quadsReader.subarray(srcOffset,srcOffset+moveLength),dstOffset)}this.dirty=!0},removeAllQuads:function(){this._quads.length=0,this._totalQuads=0},_setDirty:function(dirty){this.dirty=dirty},resizeCapacity:function(newCapacity){if(newCapacity===this._capacity)return!0;var quadSize=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,oldCapacity=this._capacity;this._totalQuads=Math.min(this._totalQuads,newCapacity),this._capacity=0|newCapacity;var i,capacity=this._capacity,locTotalQuads=this._totalQuads;if(null===this._quads)for(this._quads=[],this._quadsArrayBuffer=new ArrayBuffer(quadSize*capacity),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),i=0;i<capacity;i++)this._quads=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,i*quadSize);else{var newQuads,newArrayBuffer,quads=this._quads;if(oldCapacity<capacity){for(newQuads=[],newArrayBuffer=new ArrayBuffer(quadSize*capacity),i=0;i<locTotalQuads;i++)newQuads[i]=new cc.V3F_C4B_T2F_Quad(quads[i].tl,quads[i].bl,quads[i].tr,quads[i].br,newArrayBuffer,i*quadSize);for(;i<capacity;i++)newQuads[i]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,newArrayBuffer,i*quadSize);this._quadsReader=new Uint8Array(newArrayBuffer),this._quads=newQuads,this._quadsArrayBuffer=newArrayBuffer}else{var count=Math.max(locTotalQuads,capacity);for(newQuads=[],newArrayBuffer=new ArrayBuffer(quadSize*capacity),i=0;i<count;i++)newQuads[i]=new cc.V3F_C4B_T2F_Quad(quads[i].tl,quads[i].bl,quads[i].tr,quads[i].br,newArrayBuffer,i*quadSize);this._quadsReader=new Uint8Array(newArrayBuffer),this._quads=newQuads,this._quadsArrayBuffer=newArrayBuffer}}if(null===this._indices)this._indices=new Uint16Array(6*capacity);else if(oldCapacity<capacity){var tempIndices=new Uint16Array(6*capacity);tempIndices.set(this._indices,0),this._indices=tempIndices}else this._indices=this._indices.subarray(0,6*capacity);return this._setupIndices(),this._mapBuffers(),this.dirty=!0},increaseTotalQuadsWith:function(amount){this._totalQuads+=amount},moveQuadsFromIndex:function(oldIndex,amount,newIndex){if(void 0===newIndex){if(newIndex=amount,amount=this._totalQuads-oldIndex,cc.assert(newIndex+(this._totalQuads-oldIndex)<=this._capacity,cc._LogInfos.TextureAtlas_moveQuadsFromIndex),0===amount)return}else if(cc.assert(newIndex+amount<=this._totalQuads,cc._LogInfos.TextureAtlas_moveQuadsFromIndex_2),cc.assert(oldIndex<this._totalQuads,cc._LogInfos.TextureAtlas_moveQuadsFromIndex_3),oldIndex===newIndex)return;var moveLength,moveStart,quadSize=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,srcOffset=oldIndex*quadSize,srcLength=amount*quadSize,locQuadsReader=this._quadsReader,sourceArr=locQuadsReader.subarray(srcOffset,srcOffset+srcLength),dstOffset=newIndex*quadSize;newIndex<oldIndex?(moveLength=(oldIndex-newIndex)*quadSize,moveStart=newIndex*quadSize,locQuadsReader.set(locQuadsReader.subarray(moveStart,moveStart+moveLength),moveStart+srcLength)):(moveLength=(newIndex-oldIndex)*quadSize,moveStart=(oldIndex+amount)*quadSize,locQuadsReader.set(locQuadsReader.subarray(moveStart,moveStart+moveLength),srcOffset)),locQuadsReader.set(sourceArr,dstOffset),this.dirty=!0},fillWithEmptyQuadsFromIndex:function(index,amount){for(var count=amount*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,clearReader=new Uint8Array(this._quadsArrayBuffer,index*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,count),i=0;i<count;i++)clearReader[i]=0},drawQuads:function(){this.drawNumberOfQuads(this._totalQuads,0)},_releaseBuffer:function(){var gl=cc._renderContext;this._buffersVBO&&(this._buffersVBO[0]&&gl.deleteBuffer(this._buffersVBO[0]),this._buffersVBO[1]&&gl.deleteBuffer(this._buffersVBO[1])),this._quadsWebBuffer&&gl.deleteBuffer(this._quadsWebBuffer)}});var _p=cc.TextureAtlas.prototype;_p.totalQuads,cc.defineGetterSetter(_p,"totalQuads",_p.getTotalQuads),_p.capacity,cc.defineGetterSetter(_p,"capacity",_p.getCapacity),_p.quads,cc.defineGetterSetter(_p,"quads",_p.getQuads,_p.setQuads),cc.TextureAtlas.create=function(fileName,capacity){return new cc.TextureAtlas(fileName,capacity)},cc.TextureAtlas.createWithTexture=cc.TextureAtlas.create,cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc.assert(cc.isFunction(cc._tmp.WebGLTextureAtlas),cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTextureAtlas(),delete cc._tmp.WebGLTextureAtlas)}),cc.assert(cc.isFunction(cc._tmp.PrototypeTextureAtlas),cc._LogInfos.MissingFile,"TexturesPropertyDefine.js"),cc._tmp.PrototypeTextureAtlas(),delete cc._tmp.PrototypeTextureAtlas,cc.Scene=cc.Node.extend({_className:"Scene",ctor:function(){cc.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(cc.director.getWinSize())}}),cc.Scene.create=function(){return new cc.Scene},cc.LoaderScene=cc.Scene.extend({_interval:null,_label:null,_className:"LoaderScene",cb:null,target:null,init:function(){var self=this,logoHeight=200,bgLayer=self._bgLayer=new cc.LayerColor(cc.color(255,255,255,255));self.addChild(bgLayer,0);var fontSize=24,lblHeight=-logoHeight/2+100;if(cc._loaderImage){var imageURL=CDN_IP+"loading.png";cc.loader.loadImg(imageURL,{isCrossOrigin:!0},function(err,img){img.width,logoHeight=img.height,self._initStage(img,cc.visibleRect.center)}),fontSize=14,lblHeight=-logoHeight/2-10}var label=self._label=new cc.LabelTTF("Loading... 0%","Arial",fontSize);return label.setPosition(cc.pAdd(cc.visibleRect.center,cc.p(0,lblHeight))),label.setColor(cc.color(0,0,0)),bgLayer.addChild(this._label,10),!0},_initStage:function(img,centerPos){var texture2d=this._texture2d=new cc.Texture2D;texture2d.initWithElement(img),texture2d.handleLoadedTexture();var logo=this._logo=new cc.Sprite(texture2d);logo.setScale(cc.contentScaleFactor()),logo.x=centerPos.x,logo.y=centerPos.y,this._bgLayer.addChild(logo,10)},onEnter:function(){cc.Node.prototype.onEnter.call(this),this.schedule(this._startLoading,.3)},onExit:function(){cc.Node.prototype.onExit.call(this);this._label.setString("Loading... 0%")},initWithResources:function(resources,cb,target){cc.isString(resources)&&(resources=[resources]),this.resources=resources||[],this.cb=cb,this.target=target},_startLoading:function(){var self=this;self.unschedule(self._startLoading);var res=self.resources;cc.loader.load(res,function(result,count,loadedCount){var percent=loadedCount/count*100|0;percent=Math.min(percent,100),self._label.setString("Loading... "+percent+"%")},function(){self.cb&&self.cb.call(self.target)})},_updateTransform:function(){this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._bgLayer._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._label._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._logo._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)}}),cc.LoaderScene.preload=function(resources,cb,target){var _cc=cc;return _cc.loaderScene||(_cc.loaderScene=new cc.LoaderScene,_cc.loaderScene.init(),cc.eventManager.addCustomListener(cc.Director.EVENT_PROJECTION_CHANGED,function(){_cc.loaderScene._updateTransform()})),_cc.loaderScene.initWithResources(resources,cb,target),cc.director.runScene(_cc.loaderScene),_cc.loaderScene},cc.Layer=cc.Node.extend({_className:"Layer",ctor:function(){cc.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(cc.winSize),this._cascadeColorEnabled=!1,this._cascadeOpacityEnabled=!1},bake:function(){this._renderCmd.bake()},unbake:function(){this._renderCmd.unbake()},isBaked:function(){return this._renderCmd._isBaked},visit:function(parent){if(this._visible){var renderer=cc.renderer,cmd=this._renderCmd;if(cmd.visit(parent&&parent._renderCmd),cmd._isBaked)renderer.pushRenderCommand(cmd),cmd._bakeSprite.visit(this);else{var i,child,children=this._children,len=children.length;if(0<len){for(this._reorderChildDirty&&this.sortAllChildren(),i=0;i<len&&(child=children[i])._localZOrder<0;i++)child.visit(this);for(renderer.pushRenderCommand(cmd);i<len;i++)children[i].visit(this)}else renderer.pushRenderCommand(cmd)}cmd._dirtyFlag=0}},addChild:function(child,localZOrder,tag){cc.Node.prototype.addChild.call(this,child,localZOrder,tag),this._renderCmd._bakeForAddChild(child)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Layer.CanvasRenderCmd(this):new cc.Layer.WebGLRenderCmd(this)}}),cc.Layer.create=function(){return new cc.Layer},cc.LayerColor=cc.Layer.extend({_blendFunc:null,_className:"LayerColor",getBlendFunc:function(){return this._blendFunc},changeWidthAndHeight:function(w,h){this.width=w,this.height=h},changeWidth:function(w){this.width=w},changeHeight:function(h){this.height=h},setOpacityModifyRGB:function(value){},isOpacityModifyRGB:function(){return!1},ctor:function(color,width,height){cc.Layer.prototype.ctor.call(this),this._blendFunc=cc.BlendFunc._alphaNonPremultiplied(),cc.LayerColor.prototype.init.call(this,color,width,height)},init:function(color,width,height){var winSize=cc.director.getWinSize();color=color||cc.color(0,0,0,255),width=void 0===width?winSize.width:width,height=void 0===height?winSize.height:height;var locRealColor=this._realColor;return locRealColor.r=color.r,locRealColor.g=color.g,locRealColor.b=color.b,this._realOpacity=color.a,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty),cc.LayerColor.prototype.setContentSize.call(this,width,height),!0},visit:function(){if(this._visible){var renderer=cc.renderer,cmd=this._renderCmd;if(cmd.visit(parent&&parent._renderCmd),cmd._isBaked)renderer.pushRenderCommand(cmd._bakeRenderCmd),cmd._bakeSprite._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),cmd._bakeSprite.visit(this);else{var i,children=this._children,len=children.length;if(0<len){for(this._reorderChildDirty&&this.sortAllChildren(),i=0;i<len&&(child=children[i],child._localZOrder<0);i++)child.visit(this);for(renderer.pushRenderCommand(cmd);i<len;i++)children[i].visit(this)}else renderer.pushRenderCommand(cmd)}cmd._dirtyFlag=0}},setBlendFunc:function(src,dst){var locBlendFunc=this._blendFunc;locBlendFunc.dst=void 0===dst?(locBlendFunc.src=src.src,src.dst):(locBlendFunc.src=src,dst),this._renderCmd.updateBlendFunc(locBlendFunc)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.LayerColor.CanvasRenderCmd(this):new cc.LayerColor.WebGLRenderCmd(this)}}),cc.LayerColor.create=function(color,width,height){return new cc.LayerColor(color,width,height)},function(){var proto=cc.LayerColor.prototype;cc.defineGetterSetter(proto,"width",proto._getWidth,proto._setWidth),cc.defineGetterSetter(proto,"height",proto._getHeight,proto._setHeight)}(),cc.LayerGradient=cc.LayerColor.extend({_endColor:null,_startOpacity:255,_endOpacity:255,_alongVector:null,_compressedInterpolation:!1,_className:"LayerGradient",_colorStops:[],ctor:function(start,end,v,stops){cc.LayerColor.prototype.ctor.call(this),this._endColor=cc.color(0,0,0,255),this._alongVector=cc.p(0,-1),this._startOpacity=255,this._endOpacity=255,stops&&stops instanceof Array?((this._colorStops=stops).splice(0,0,{p:0,color:start||cc.color.BLACK}),stops.push({p:1,color:end||cc.color.BLACK})):this._colorStops=[{p:0,color:start||cc.color.BLACK},{p:1,color:end||cc.color.BLACK}],cc.LayerGradient.prototype.init.call(this,start,end,v,stops)},init:function(start,end,v,stops){start=start||cc.color(0,0,0,255),end=end||cc.color(0,0,0,255),v=v||cc.p(0,-1);var _t=this,locEndColor=_t._endColor;return _t._startOpacity=start.a,locEndColor.r=end.r,locEndColor.g=end.g,locEndColor.b=end.b,_t._endOpacity=end.a,_t._alongVector=v,_t._compressedInterpolation=!0,cc.LayerColor.prototype.init.call(_t,cc.color(start.r,start.g,start.b,255)),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty|cc.Node._dirtyFlags.gradientDirty),!0},setContentSize:function(size,height){cc.LayerColor.prototype.setContentSize.call(this,size,height),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},_setWidth:function(width){cc.LayerColor.prototype._setWidth.call(this,width),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},_setHeight:function(height){cc.LayerColor.prototype._setHeight.call(this,height),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getStartColor:function(){return cc.color(this._realColor)},setStartColor:function(color){this.color=color;var stops=this._colorStops;if(stops&&0<stops.length){var selColor=stops[0].color;selColor.r=color.r,selColor.g=color.g,selColor.b=color.b}},setEndColor:function(color){var locColor=this._endColor;locColor.r=color.r,locColor.g=color.g,locColor.b=color.b;var stops=this._colorStops;if(stops&&0<stops.length){var selColor=stops[stops.length-1].color;selColor.r=color.r,selColor.g=color.g,selColor.b=color.b}this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},getEndColor:function(){return cc.color(this._endColor)},setStartOpacity:function(o){this._startOpacity=o;var stops=this._colorStops;stops&&0<stops.length&&(stops[0].color.a=o),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getStartOpacity:function(){return this._startOpacity},setEndOpacity:function(o){this._endOpacity=o;var stops=this._colorStops;stops&&0<stops.length&&(stops[stops.length-1].color.a=o),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getEndOpacity:function(){return this._endOpacity},setVector:function(Var){this._alongVector.x=Var.x,this._alongVector.y=Var.y,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getVector:function(){return cc.p(this._alongVector.x,this._alongVector.y)},isCompressedInterpolation:function(){return this._compressedInterpolation},setCompressedInterpolation:function(compress){this._compressedInterpolation=compress,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getColorStops:function(){return this._colorStops},setColorStops:function(colorStops){this._colorStops=colorStops,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty|cc.Node._dirtyFlags.gradientDirty)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.LayerGradient.CanvasRenderCmd(this):new cc.LayerGradient.WebGLRenderCmd(this)}}),cc.LayerGradient.create=function(start,end,v,stops){return new cc.LayerGradient(start,end,v,stops)},function(){var proto=cc.LayerGradient.prototype;proto.startColor,cc.defineGetterSetter(proto,"startColor",proto.getStartColor,proto.setStartColor),proto.endColor,cc.defineGetterSetter(proto,"endColor",proto.getEndColor,proto.setEndColor),proto.startOpacity,cc.defineGetterSetter(proto,"startOpacity",proto.getStartOpacity,proto.setStartOpacity),proto.endOpacity,cc.defineGetterSetter(proto,"endOpacity",proto.getEndOpacity,proto.setEndOpacity),proto.vector,cc.defineGetterSetter(proto,"vector",proto.getVector,proto.setVector),proto.colorStops,cc.defineGetterSetter(proto,"colorStops",proto.getColorStops,proto.setColorStops)}(),cc.LayerMultiplex=cc.Layer.extend({_enabledLayer:0,_layers:null,_className:"LayerMultiplex",ctor:function(layers){cc.Layer.prototype.ctor.call(this),layers instanceof Array?cc.LayerMultiplex.prototype.initWithLayers.call(this,layers):cc.LayerMultiplex.prototype.initWithLayers.call(this,Array.prototype.slice.call(arguments))},initWithLayers:function(layers){return 0<layers.length&&null==layers[layers.length-1]&&cc.log(cc._LogInfos.LayerMultiplex_initWithLayers),this._layers=layers,this._enabledLayer=0,this.addChild(this._layers[this._enabledLayer]),!0},switchTo:function(n){n>=this._layers.length?cc.log(cc._LogInfos.LayerMultiplex_switchTo):(this.removeChild(this._layers[this._enabledLayer],!0),this._enabledLayer=n,this.addChild(this._layers[n]))},switchToAndReleaseMe:function(n){n>=this._layers.length?cc.log(cc._LogInfos.LayerMultiplex_switchToAndReleaseMe):(this.removeChild(this._layers[this._enabledLayer],!0),this._layers[this._enabledLayer]=null,this._enabledLayer=n,this.addChild(this._layers[n]))},addLayer:function(layer){layer?this._layers.push(layer):cc.log(cc._LogInfos.LayerMultiplex_addLayer)}}),cc.LayerMultiplex.create=function(){return new cc.LayerMultiplex(Array.prototype.slice.call(arguments))},function(){cc.Layer.CanvasRenderCmd=function(renderable){this._rootCtor(renderable),this._isBaked=!1,this._bakeSprite=null,this._canUseDirtyRegion=!0,this._updateCache=2};var proto=cc.Layer.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);proto.constructor=cc.Layer.CanvasRenderCmd,proto._layerCmdCtor=cc.Layer.CanvasRenderCmd,proto._setCacheDirty=function(child){if(child&&0===this._updateCache&&(this._updateCache=2),!1===this._cacheDirty){this._cacheDirty=!0;var cachedP=this._cachedParent;cachedP&&cachedP!==this&&cachedP._setNodeDirtyForCache&&cachedP._setNodeDirtyForCache()}},proto.updateStatus=function(){var flags=cc.Node._dirtyFlags;this._dirtyFlag&flags.orderDirty&&(this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2),this._dirtyFlag&=~flags.orderDirty),this.originUpdateStatus()},proto._syncStatus=function(parentCmd){var flags=cc.Node._dirtyFlags,locFlag=this._dirtyFlag;(this._isBaked||locFlag&flags.orderDirty)&&(this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2),this._dirtyFlag&=~flags.orderDirty),this._originSyncStatus(parentCmd)},proto.transform=function(parentCmd,recursive){this._worldTransform||(this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0});var wt=this._worldTransform,a=wt.a,b=wt.b,c=wt.c,d=wt.d;wt.tx,wt.ty;this.originTransform(parentCmd,recursive),wt.a===a&&wt.b===b&&wt.c===c&&wt.d===d||0!==this._updateCache||(this._updateCache=2)},proto.bake=function(){if(!this._isBaked){this._needDraw=!0,cc.renderer.childrenOrderDirty=!0,this._isBaked=this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2);for(var children=this._node._children,i=0,len=children.length;i<len;i++)children[i]._renderCmd._setCachedParent(this);this._bakeSprite||(this._bakeSprite=new cc.BakeSprite,this._bakeSprite.setAnchorPoint(0,0))}},proto.unbake=function(){if(this._isBaked){cc.renderer.childrenOrderDirty=!0,this._needDraw=!1,this._isBaked=!1,this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2);for(var children=this._node._children,i=0,len=children.length;i<len;i++)children[i]._renderCmd._setCachedParent(null)}},proto.isBaked=function(){return this._isBaked},proto.rendering=function(){if(this._cacheDirty){var node=this._node,children=node._children,locBakeSprite=this._bakeSprite;this.transform(this.getParentRenderCmd(),!0);var boundingBox=this._getBoundingBoxForBake();boundingBox.width=0|boundingBox.width+.5,boundingBox.height=0|boundingBox.height+.5;var bakeContext=locBakeSprite.getCacheContext(),ctx=bakeContext.getContext();if(locBakeSprite.setPosition(boundingBox.x,boundingBox.y),0<this._updateCache){locBakeSprite.resetCanvasSize(boundingBox.width,boundingBox.height),bakeContext.setOffset(0-boundingBox.x,ctx.canvas.height-boundingBox.height+boundingBox.y),node.sortAllChildren(),cc.renderer._turnToCacheMode(this.__instanceId);for(var i=0,len=children.length;i<len;i++)children[i].visit(this);cc.renderer._renderingToCacheCanvas(bakeContext,this.__instanceId),locBakeSprite.transform(),this._updateCache--}this._cacheDirty=!1}},proto._bakeForAddChild=function(child){child._parent===this._node&&this._isBaked&&child._renderCmd._setCachedParent(this)},proto._getBoundingBoxForBake=function(){var rect=null,node=this._node;if(!node._children||0===node._children.length)return cc.rect(0,0,10,10);for(var trans=node.getNodeToWorldTransform(),locChildren=node._children,i=0,len=locChildren.length;i<len;i++){var child=locChildren[i];if(child&&child._visible)if(rect){var childRect=child._getBoundingBoxToCurrentNode(trans);childRect&&(rect=cc.rectUnion(rect,childRect))}else rect=child._getBoundingBoxToCurrentNode(trans)}return rect}}(),function(){cc.LayerColor.CanvasRenderCmd=function(renderable){this._layerCmdCtor(renderable),this._needDraw=!0,this._blendFuncStr="source-over",this._bakeRenderCmd=new cc.CustomRenderCmd(this,this._bakeRendering)};var proto=cc.LayerColor.CanvasRenderCmd.prototype=Object.create(cc.Layer.CanvasRenderCmd.prototype);proto.constructor=cc.LayerColor.CanvasRenderCmd,proto.unbake=function(){cc.Layer.CanvasRenderCmd.prototype.unbake.call(this),this._needDraw=!0},proto.rendering=function(ctx,scaleX,scaleY){var wrapper=ctx||cc._renderContext,context=wrapper.getContext(),node=this._node,curColor=this._displayedColor,opacity=this._displayedOpacity/255,locWidth=node._contentSize.width,locHeight=node._contentSize.height;0!==opacity&&(wrapper.setCompositeOperation(this._blendFuncStr),wrapper.setGlobalAlpha(opacity),wrapper.setFillStyle("rgba("+(0|curColor.r)+","+(0|curColor.g)+","+(0|curColor.b)+", 1)"),wrapper.setTransform(this._worldTransform,scaleX,scaleY),context.fillRect(0,0,locWidth,-locHeight),cc.g_NumberOfDraws++)},proto.updateBlendFunc=function(blendFunc){this._blendFuncStr=cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(blendFunc)},proto._updateSquareVertices=proto._updateSquareVerticesWidth=proto._updateSquareVerticesHeight=function(){},proto._bakeRendering=function(){if(this._cacheDirty){var i,node=this._node,locBakeSprite=this._bakeSprite,children=node._children,len=children.length;this.transform(this.getParentRenderCmd(),!0);var boundingBox=this._getBoundingBoxForBake();boundingBox.width=0|boundingBox.width+.5,boundingBox.height=0|boundingBox.height+.5;var bakeContext=locBakeSprite.getCacheContext(),ctx=bakeContext.getContext();if(locBakeSprite.setPosition(boundingBox.x,boundingBox.y),0<this._updateCache){var child;if(ctx.fillStyle=bakeContext._currentFillStyle,locBakeSprite.resetCanvasSize(boundingBox.width,boundingBox.height),bakeContext.setOffset(0-boundingBox.x,ctx.canvas.height-boundingBox.height+boundingBox.y),cc.renderer._turnToCacheMode(this.__instanceId),0<len){for(node.sortAllChildren(),i=0;i<len&&(child=children[i])._localZOrder<0;i++)child.visit(node);for(cc.renderer.pushRenderCommand(this);i<len;i++)children[i].visit(node)}else cc.renderer.pushRenderCommand(this);cc.renderer._renderingToCacheCanvas(bakeContext,this.__instanceId),locBakeSprite.transform(),this._updateCache--}this._cacheDirty=!1}},proto._getBoundingBoxForBake=function(){var node=this._node,rect=cc.rect(0,0,node._contentSize.width,node._contentSize.height),trans=node.getNodeToWorldTransform();if(rect=cc.rectApplyAffineTransform(rect,node.getNodeToWorldTransform()),!node._children||0===node._children.length)return rect;for(var locChildren=node._children,i=0;i<locChildren.length;i++){var child=locChildren[i];if(child&&child._visible){var childRect=child._getBoundingBoxToCurrentNode(trans);rect=cc.rectUnion(rect,childRect)}}return rect}}(),function(){cc.LayerGradient.CanvasRenderCmd=function(renderable){cc.LayerColor.CanvasRenderCmd.call(this,renderable),this._needDraw=!0,this._startPoint=cc.p(0,0),this._endPoint=cc.p(0,0),this._startStopStr=null,this._endStopStr=null};var proto=cc.LayerGradient.CanvasRenderCmd.prototype=Object.create(cc.LayerColor.CanvasRenderCmd.prototype);proto.constructor=cc.LayerGradient.CanvasRenderCmd,proto.rendering=function(ctx,scaleX,scaleY){var wrapper=ctx||cc._renderContext,context=wrapper.getContext(),node=this._node,opacity=this._displayedOpacity/255;if(0!==opacity){var locWidth=node._contentSize.width,locHeight=node._contentSize.height;wrapper.setCompositeOperation(this._blendFuncStr),wrapper.setGlobalAlpha(opacity);var gradient=context.createLinearGradient(this._startPoint.x,this._startPoint.y,this._endPoint.x,this._endPoint.y);if(node._colorStops)for(var i=0;i<node._colorStops.length;i++){var stop=node._colorStops[i];gradient.addColorStop(stop.p,this._colorStopsStr[i])}else gradient.addColorStop(0,this._startStopStr),gradient.addColorStop(1,this._endStopStr);wrapper.setFillStyle(gradient),wrapper.setTransform(this._worldTransform,scaleX,scaleY),context.fillRect(0,0,locWidth,-locHeight),cc.g_NumberOfDraws++}},proto.updateStatus=function(){var flags=cc.Node._dirtyFlags;this._dirtyFlag&flags.gradientDirty&&(this._dirtyFlag|=flags.colorDirty,this._dirtyFlag&=~flags.gradientDirty),this.originUpdateStatus()},proto._syncStatus=function(parentCmd){var flags=cc.Node._dirtyFlags;this._dirtyFlag&flags.gradientDirty&&(this._dirtyFlag|=flags.colorDirty,this._dirtyFlag&=~flags.gradientDirty),this._originSyncStatus(parentCmd)},proto._updateColor=function(){var node=this._node,contentSize=node._contentSize,tWidth=.5*contentSize.width,tHeight=.5*contentSize.height,angle=cc.pAngleSigned(cc.p(0,-1),node._alongVector),p1=cc.pRotateByAngle(cc.p(0,-1),cc.p(0,0),angle),factor=Math.min(Math.abs(1/p1.x),Math.abs(1/p1.y));this._startPoint.x=tWidth*(-p1.x*factor)+tWidth,this._startPoint.y=tHeight*(p1.y*factor)-tHeight,this._endPoint.x=tWidth*(p1.x*factor)+tWidth,this._endPoint.y=tHeight*(-p1.y*factor)-tHeight;var locStartColor=this._displayedColor,locEndColor=node._endColor,startOpacity=node._startOpacity/255,endOpacity=node._endOpacity/255;if(this._startStopStr="rgba("+Math.round(locStartColor.r)+","+Math.round(locStartColor.g)+","+Math.round(locStartColor.b)+","+startOpacity.toFixed(4)+")",this._endStopStr="rgba("+Math.round(locEndColor.r)+","+Math.round(locEndColor.g)+","+Math.round(locEndColor.b)+","+endOpacity.toFixed(4)+")",node._colorStops){this._startOpacity=0,this._endOpacity=0,this._colorStopsStr=[];for(var i=0;i<node._colorStops.length;i++){var stopColor=node._colorStops[i].color,stopOpacity=null==stopColor.a?1:stopColor.a/255;this._colorStopsStr.push("rgba("+Math.round(stopColor.r)+","+Math.round(stopColor.g)+","+Math.round(stopColor.b)+","+stopOpacity.toFixed(4)+")")}}}}(),function(){cc.Layer.WebGLRenderCmd=function(renderable){this._rootCtor(renderable),this._isBaked=!1};var proto=cc.Layer.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);proto.constructor=cc.Layer.WebGLRenderCmd,proto._layerCmdCtor=cc.Layer.WebGLRenderCmd,proto.bake=function(){},proto.unbake=function(){},proto._bakeForAddChild=function(){}}(),function(){cc.LayerColor.WebGLRenderCmd=function(renderable){this._layerCmdCtor(renderable),this._needDraw=!0,this._matrix=null,this.initData(4),this._color=new Uint32Array(1),this._vertexBuffer=null,this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_COLOR)};var proto=cc.LayerColor.WebGLRenderCmd.prototype=Object.create(cc.Layer.WebGLRenderCmd.prototype);proto.constructor=cc.LayerColor.WebGLRenderCmd,proto.initData=function(vertexCount){this._data=new ArrayBuffer(16*vertexCount),this._positionView=new Float32Array(this._data),this._colorView=new Uint32Array(this._data),this._dataDirty=!0},proto.transform=function(parentCmd,recursive){this.originTransform(parentCmd,recursive);var node=this._node,width=node._contentSize.width,height=node._contentSize.height,pos=this._positionView;pos[4]=width,pos[9]=height,pos[12]=width,pos[13]=height,pos[2].z=pos[6]=pos[10]=pos[14]=node._vertexZ,this._dataDirty=!0},proto._updateColor=function(){var color=this._displayedColor;this._color[0]=this._displayedOpacity<<24|color.b<<16|color.g<<8|color.r;for(var colors=this._colorView,i=0;i<4;i++)colors[4*i+3]=this._color[0];this._dataDirty=!0},proto.rendering=function(ctx){var gl=ctx||cc._renderContext,node=this._node;this._matrix||(this._matrix=new cc.math.Matrix4,this._matrix.identity());var wt=this._worldTransform;this._matrix.mat[0]=wt.a,this._matrix.mat[4]=wt.c,this._matrix.mat[12]=wt.tx,this._matrix.mat[1]=wt.b,this._matrix.mat[5]=wt.d,this._matrix.mat[13]=wt.ty,this._dataDirty&&(this._vertexBuffer||(this._vertexBuffer=gl.createBuffer()),gl.bindBuffer(gl.ARRAY_BUFFER,this._vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._data,gl.DYNAMIC_DRAW),this._dataDirty=!1),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),cc.glBlendFunc(node._blendFunc.src,node._blendFunc.dst),gl.bindBuffer(gl.ARRAY_BUFFER,this._vertexBuffer),gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),gl.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,gl.FLOAT,!1,16,0),gl.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,gl.UNSIGNED_BYTE,!0,16,12),gl.drawArrays(gl.TRIANGLE_STRIP,0,4)},proto.updateBlendFunc=function(blendFunc){}}(),function(){cc.LayerGradient.WebGLRenderCmd=function(renderable){cc.LayerColor.WebGLRenderCmd.call(this,renderable),this._needDraw=!0,this._clipRect=new cc.Rect,this._clippingRectDirty=!1};var proto=cc.LayerGradient.WebGLRenderCmd.prototype=Object.create(cc.LayerColor.WebGLRenderCmd.prototype);proto.constructor=cc.LayerGradient.WebGLRenderCmd,proto.updateStatus=function(){var flags=cc.Node._dirtyFlags;this._dirtyFlag&flags.gradientDirty&&(this._dirtyFlag|=flags.colorDirty,this._updateVertex(),this._dirtyFlag&=~flags.gradientDirty),this.originUpdateStatus()},proto._syncStatus=function(parentCmd){var flags=cc.Node._dirtyFlags;this._dirtyFlag&flags.gradientDirty&&(this._dirtyFlag|=flags.colorDirty,this._updateVertex(),this._dirtyFlag&=~flags.gradientDirty),this._originSyncStatus(parentCmd)},proto.transform=function(parentCmd,recursive){this.originTransform(parentCmd,recursive),this._updateVertex()},proto._updateVertex=function(){var node=this._node,stops=node._colorStops;if(stops&&!(stops.length<2)){this._clippingRectDirty=!0;var i,stopsLen=stops.length,verticesLen=2*stopsLen,contentSize=node._contentSize;this._positionView.length/4<verticesLen&&this.initData(verticesLen);var a,b,angle=Math.PI+cc.pAngleSigned(cc.p(0,-1),node._alongVector),locAnchor=cc.p(contentSize.width/2,contentSize.height/2),degrees=Math.round(cc.radiansToDegrees(angle)),transMat=cc.affineTransformMake(1,0,0,1,locAnchor.x,locAnchor.y);transMat=cc.affineTransformRotate(transMat,angle),b=degrees<90?(a=cc.p(-locAnchor.x,locAnchor.y),cc.p(locAnchor.x,locAnchor.y)):degrees<180?(a=cc.p(locAnchor.x,locAnchor.y),cc.p(locAnchor.x,-locAnchor.y)):degrees<270?(a=cc.p(locAnchor.x,-locAnchor.y),cc.p(-locAnchor.x,-locAnchor.y)):(a=cc.p(-locAnchor.x,-locAnchor.y),cc.p(-locAnchor.x,locAnchor.y));var sin=Math.sin(angle),cos=Math.cos(angle),tx=Math.abs((a.x*cos-a.y*sin)/locAnchor.x),ty=Math.abs((b.x*sin+b.y*cos)/locAnchor.y);transMat=cc.affineTransformScale(transMat,tx,ty);var pos=this._positionView;for(i=0;i<stopsLen;i++){var y=stops[i].p*contentSize.height,p0=cc.pointApplyAffineTransform(-locAnchor.x,y-locAnchor.y,transMat),offset=2*i*4;pos[offset]=p0.x,pos[offset+1]=p0.y,pos[offset+2]=node._vertexZ;var p1=cc.pointApplyAffineTransform(contentSize.width-locAnchor.x,y-locAnchor.y,transMat);pos[offset+=4]=p1.x,pos[offset+1]=p1.y,pos[offset+2]=node._vertexZ}this._dataDirty=!0}},proto._updateColor=function(){var stops=this._node._colorStops;if(stops&&!(stops.length<2)){var stopColor,offset,stopsLen=stops.length,colors=this._colorView,opacityf=this._displayedOpacity/255;for(i=0;i<stopsLen;i++)stopColor=stops[i].color,this._color[0]=stopColor.a*opacityf<<24|stopColor.b<<16|stopColor.g<<8|stopColor.r,colors[(offset=2*i*4)+3]=this._color[0],colors[(offset+=4)+3]=this._color[0];this._dataDirty=!0}},proto.rendering=function(ctx){var context=ctx||cc._renderContext,node=this._node;this._matrix||(this._matrix=new cc.math.Matrix4,this._matrix.identity());var clippingRect=this._getClippingRect();context.enable(context.SCISSOR_TEST),cc.view.setScissorInPoints(clippingRect.x,clippingRect.y,clippingRect.width,clippingRect.height);var wt=this._worldTransform;this._matrix.mat[0]=wt.a,this._matrix.mat[4]=wt.c,this._matrix.mat[12]=wt.tx,this._matrix.mat[1]=wt.b,this._matrix.mat[5]=wt.d,this._matrix.mat[13]=wt.ty,this._dataDirty&&(this._vertexBuffer||(this._vertexBuffer=gl.createBuffer()),gl.bindBuffer(gl.ARRAY_BUFFER,this._vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._data,gl.DYNAMIC_DRAW),this._dataDirty=!1),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),cc.glBlendFunc(node._blendFunc.src,node._blendFunc.dst),gl.bindBuffer(gl.ARRAY_BUFFER,this._vertexBuffer),gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),gl.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,gl.FLOAT,!1,16,0),gl.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,gl.UNSIGNED_BYTE,!0,16,12),gl.drawArrays(gl.TRIANGLE_STRIP,0,4),context.disable(context.SCISSOR_TEST)},proto._getClippingRect=function(){if(this._clippingRectDirty){var node=this._node,rect=cc.rect(0,0,node._contentSize.width,node._contentSize.height),trans=node.getNodeToWorldTransform();this._clipRect=cc._rectApplyAffineTransformIn(rect,trans)}return this._clipRect}}(),cc._tmp.PrototypeSprite=function(){var _p=cc.Sprite.prototype;cc.defineGetterSetter(_p,"opacityModifyRGB",_p.isOpacityModifyRGB,_p.setOpacityModifyRGB),cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity),cc.defineGetterSetter(_p,"color",_p.getColor,_p.setColor),_p.dirty,_p.flippedX,cc.defineGetterSetter(_p,"flippedX",_p.isFlippedX,_p.setFlippedX),_p.flippedY,cc.defineGetterSetter(_p,"flippedY",_p.isFlippedY,_p.setFlippedY),_p.offsetX,cc.defineGetterSetter(_p,"offsetX",_p._getOffsetX),_p.offsetY,cc.defineGetterSetter(_p,"offsetY",_p._getOffsetY),_p.atlasIndex,_p.texture,cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture),_p.textureRectRotated,cc.defineGetterSetter(_p,"textureRectRotated",_p.isTextureRectRotated),_p.textureAtlas,_p.batchNode,cc.defineGetterSetter(_p,"batchNode",_p.getBatchNode,_p.setBatchNode),_p.quad,cc.defineGetterSetter(_p,"quad",_p.getQuad)},cc.Sprite=cc.Node.extend({dirty:!1,atlasIndex:0,textureAtlas:null,_batchNode:null,_recursiveDirty:null,_hasChildren:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_rect:null,_rectRotated:!1,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,_opacityModifyRGB:!1,_flippedX:!1,_flippedY:!1,_textureLoaded:!1,_className:"Sprite",ctor:function(fileName,rect,rotated){cc.Node.prototype.ctor.call(this),this.setAnchorPoint(.5,.5),this._loader=new cc.Sprite.LoadManager,this._shouldBeHidden=!1,this._offsetPosition=cc.p(0,0),this._unflippedOffsetPositionFromCenter=cc.p(0,0),this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},this._rect=cc.rect(0,0,0,0),this._softInit(fileName,rect,rotated)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(callback,target){this.addEventListener("load",callback,target)},isDirty:function(){return this.dirty},setDirty:function(bDirty){this.dirty=bDirty},isTextureRectRotated:function(){return this._rectRotated},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(atlasIndex){this.atlasIndex=atlasIndex},getTextureRect:function(){return cc.rect(this._rect)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(textureAtlas){this.textureAtlas=textureAtlas},getOffsetPosition:function(){return cc.p(this._offsetPosition)},_getOffsetX:function(){return this._offsetPosition.x},_getOffsetY:function(){return this._offsetPosition.y},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(spriteFrame){return cc.assert(spriteFrame,cc._LogInfos.Sprite_initWithSpriteFrame),this.setSpriteFrame(spriteFrame)},initWithSpriteFrameName:function(spriteFrameName){cc.assert(spriteFrameName,cc._LogInfos.Sprite_initWithSpriteFrameName);var frame=cc.spriteFrameCache.getSpriteFrame(spriteFrameName);return cc.assert(frame,spriteFrameName+cc._LogInfos.Sprite_initWithSpriteFrameName1),this.initWithSpriteFrame(frame)},useBatchNode:function(batchNode){},setVertexRect:function(rect){var locRect=this._rect;locRect.x=rect.x,locRect.y=rect.y,locRect.width=rect.width,locRect.height=rect.height,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setFlippedX:function(flippedX){this._flippedX!==flippedX&&(this._flippedX=flippedX,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},setFlippedY:function(flippedY){this._flippedY!==flippedY&&(this._flippedY=flippedY,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},isFlippedX:function(){return this._flippedX},isFlippedY:function(){return this._flippedY},setOpacityModifyRGB:function(modify){this._opacityModifyRGB!==modify&&(this._opacityModifyRGB=modify,this._renderCmd._setColorDirty())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setDisplayFrameWithAnimationName:function(animationName,frameIndex){cc.assert(animationName,cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_3);var cache=cc.animationCache.getAnimation(animationName);if(cache){var animFrame=cache.getFrames()[frameIndex];animFrame?this.setSpriteFrame(animFrame.getSpriteFrame()):cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_2)}else cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName)},getBatchNode:function(){return this._batchNode},getTexture:function(){return this._texture},_softInit:function(fileName,rect,rotated){if(void 0===fileName)cc.Sprite.prototype.init.call(this);else if("string"==typeof fileName)if("#"===fileName[0]){var frameName=fileName.substr(1,fileName.length-1),spriteFrame=cc.spriteFrameCache.getSpriteFrame(frameName);spriteFrame?this.initWithSpriteFrame(spriteFrame):cc.log("%s does not exist",fileName)}else cc.Sprite.prototype.init.call(this,fileName,rect);else if("object"==typeof fileName)if(fileName instanceof cc.Texture2D)this.initWithTexture(fileName,rect,rotated);else if(fileName instanceof cc.SpriteFrame)this.initWithSpriteFrame(fileName);else if(fileName instanceof HTMLImageElement||fileName instanceof HTMLCanvasElement){var texture2d=new cc.Texture2D;texture2d.initWithElement(fileName),texture2d.handleLoadedTexture(),this.initWithTexture(texture2d)}},getQuad:function(){return null},setBlendFunc:function(src,dst){var locBlendFunc=this._blendFunc;locBlendFunc.dst=void 0===dst?(locBlendFunc.src=src.src,src.dst):(locBlendFunc.src=src,dst),this._renderCmd.updateBlendFunc(locBlendFunc)},init:function(){var _t=this;return 0<arguments.length?_t.initWithFile(arguments[0],arguments[1]):(cc.Node.prototype.init.call(_t),_t.dirty=_t._recursiveDirty=!1,_t._blendFunc.src=cc.BLEND_SRC,_t._blendFunc.dst=cc.BLEND_DST,_t.texture=null,_t._flippedX=_t._flippedY=!1,_t.anchorX=.5,_t.anchorY=.5,_t._offsetPosition.x=0,_t._offsetPosition.y=0,_t._hasChildren=!1,_t.setTextureRect(cc.rect(0,0,0,0),!1,cc.size(0,0)),!0)},initWithFile:function(filename,rect){cc.assert(filename,cc._LogInfos.Sprite_initWithFile);var tex=cc.textureCache.getTextureForKey(filename);if(tex||(tex=cc.textureCache.addImage(filename)),!tex.isLoaded())return this._loader.clear(),this._loader.once(tex,function(){this.initWithFile(filename,rect),this.dispatchEvent("load")},this),!1;if(!rect){var size=tex.getContentSize();rect=cc.rect(0,0,size.width,size.height)}return this.initWithTexture(tex,rect)},initWithTexture:function(texture,rect,rotated,counterclockwise){var _t=this;return cc.assert(0!==arguments.length,cc._LogInfos.CCSpriteBatchNode_initWithTexture),this._loader.clear(),_t._textureLoaded=texture.isLoaded(),_t._textureLoaded?(rotated=rotated||!1,texture=this._renderCmd._handleTextureForRotatedTexture(texture,rect,rotated,counterclockwise),!!cc.Node.prototype.init.call(_t)&&(_t._batchNode=null,_t._recursiveDirty=!1,_t.dirty=!1,_t._opacityModifyRGB=!0,_t._blendFunc.src=cc.BLEND_SRC,_t._blendFunc.dst=cc.BLEND_DST,_t._flippedX=_t._flippedY=!1,_t._offsetPosition.x=0,_t._offsetPosition.y=0,_t._hasChildren=!1,_t._rectRotated=rotated,rect&&(_t._rect.x=rect.x,_t._rect.y=rect.y,_t._rect.width=rect.width,_t._rect.height=rect.height),rect||(rect=cc.rect(0,0,texture.width,texture.height)),this._renderCmd._checkTextureBoundary(texture,rect,rotated),_t.setTexture(texture),_t.setTextureRect(rect,rotated),_t.setBatchNode(null),!0)):(this._loader.once(texture,function(){this.initWithTexture(texture,rect,rotated,counterclockwise),this.dispatchEvent("load")},this),!1)},setTextureRect:function(rect,rotated,untrimmedSize,needConvert){var _t=this;_t._rectRotated=rotated||!1,_t.setContentSize(untrimmedSize||rect),_t.setVertexRect(rect),_t._renderCmd._setTextureCoords(rect,needConvert);var relativeOffsetX=_t._unflippedOffsetPositionFromCenter.x,relativeOffsetY=_t._unflippedOffsetPositionFromCenter.y;_t._flippedX&&(relativeOffsetX=-relativeOffsetX),_t._flippedY&&(relativeOffsetY=-relativeOffsetY);var locRect=_t._rect;_t._offsetPosition.x=relativeOffsetX+(_t._contentSize.width-locRect.width)/2,_t._offsetPosition.y=relativeOffsetY+(_t._contentSize.height-locRect.height)/2},addChild:function(child,localZOrder,tag){cc.assert(child,cc._LogInfos.CCSpriteBatchNode_addChild_2),null==localZOrder&&(localZOrder=child._localZOrder),null==tag&&(tag=child.tag),this._renderCmd._setBatchNodeForAddChild(child)&&(cc.Node.prototype.addChild.call(this,child,localZOrder,tag),this._hasChildren=!0)},setSpriteFrame:function(newFrame){var _t=this;"string"==typeof newFrame&&(newFrame=cc.spriteFrameCache.getSpriteFrame(newFrame),cc.assert(newFrame,cc._LogInfos.Sprite_setSpriteFrame)),this._loader.clear(),this.setNodeDirty(!0);var pNewTexture=newFrame.getTexture();if(_t._textureLoaded=newFrame.textureLoaded(),this._loader.clear(),!_t._textureLoaded)return this._loader.once(pNewTexture,function(){this.setSpriteFrame(newFrame),this.dispatchEvent("load")},this),!1;var frameOffset=newFrame.getOffset();_t._unflippedOffsetPositionFromCenter.x=frameOffset.x,_t._unflippedOffsetPositionFromCenter.y=frameOffset.y,pNewTexture!==_t._texture&&(this._renderCmd._setTexture(pNewTexture),_t.setColor(_t._realColor)),_t.setTextureRect(newFrame.getRect(),newFrame.isRotated(),newFrame.getOriginalSize())},setDisplayFrame:function(newFrame){cc.log(cc._LogInfos.Sprite_setDisplayFrame),this.setSpriteFrame(newFrame)},isFrameDisplayed:function(frame){return this._renderCmd.isFrameDisplayed(frame)},displayFrame:function(){return this.getSpriteFrame()},getSpriteFrame:function(){return new cc.SpriteFrame(this._texture,cc.rectPointsToPixels(this._rect),this._rectRotated,cc.pointPointsToPixels(this._unflippedOffsetPositionFromCenter),cc.sizePointsToPixels(this._contentSize))},setBatchNode:function(spriteBatchNode){},setTexture:function(texture){if(!texture)return this._renderCmd._setTexture(null);var isFileName="string"==typeof texture;if(isFileName&&(texture=cc.textureCache.addImage(texture)),this._loader.clear(),!texture._textureLoaded)return this._loader.once(texture,function(){this.setTexture(texture),this.dispatchEvent("load")},this),!1;this._renderCmd._setTexture(texture),isFileName&&this._changeRectWithTexture(texture),this.setColor(this._realColor),this._textureLoaded=!0},_changeRectWithTexture:function(texture){var contentSize=texture._contentSize,rect=cc.rect(0,0,contentSize.width,contentSize.height);this.setTextureRect(rect)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Sprite.CanvasRenderCmd(this):new cc.Sprite.WebGLRenderCmd(this)}}),cc.Sprite.create=function(fileName,rect,rotated){return new cc.Sprite(fileName,rect,rotated)},cc.Sprite.createWithTexture=cc.Sprite.create,cc.Sprite.createWithSpriteFrameName=cc.Sprite.create,cc.Sprite.createWithSpriteFrame=cc.Sprite.create,cc.Sprite.INDEX_NOT_INITIALIZED=-1,cc.EventHelper.prototype.apply(cc.Sprite.prototype),cc.assert(cc.isFunction(cc._tmp.PrototypeSprite),cc._LogInfos.MissingFile,"SpritesPropertyDefine.js"),cc._tmp.PrototypeSprite(),delete cc._tmp.PrototypeSprite,function(){var manager=cc.Sprite.LoadManager=function(){this.list=[]};manager.prototype.add=function(source,callback,target){source&&source.addEventListener&&(source.addEventListener("load",callback,target),this.list.push({source:source,listener:callback,target:target}))},manager.prototype.once=function(source,callback,target){if(source&&source.addEventListener){var tmpCallback=function(event){source.removeEventListener("load",tmpCallback,target),callback.call(target,event)};source.addEventListener("load",tmpCallback,target),this.list.push({source:source,listener:tmpCallback,target:target})}},manager.prototype.clear=function(){for(;0<this.list.length;){var item=this.list.pop();item.source.removeEventListener("load",item.listener,item.target)}}}(),function(){cc.Sprite.CanvasRenderCmd=function(renderable){this._rootCtor(renderable),this._needDraw=!0,this._textureCoord={renderX:0,renderY:0,x:0,y:0,width:0,height:0,validRect:!1},this._blendFuncStr="source-over",this._colorized=!1,this._canUseDirtyRegion=!0,this._textureToRender=null};var proto=cc.Sprite.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);proto.constructor=cc.Sprite.CanvasRenderCmd,proto._spriteCmdCtor=cc.Sprite.CanvasRenderCmd,proto.setDirtyRecursively=function(value){},proto._setTexture=function(texture){var node=this._node;if(node._texture!==texture){node._textureLoaded=!!texture&&texture._textureLoaded;var texSize=(node._texture=texture)._contentSize,rect=cc.rect(0,0,texSize.width,texSize.height);node.setTextureRect(rect),this._updateColor()}},proto._setColorDirty=function(){this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty)},proto.isFrameDisplayed=function(frame){var node=this._node;return frame.getTexture()===node._texture&&cc.rectEqualToRect(frame.getRect(),node._rect)},proto.updateBlendFunc=function(blendFunc){this._blendFuncStr=cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(blendFunc)},proto._setBatchNodeForAddChild=function(child){return!0},proto._handleTextureForRotatedTexture=function(texture,rect,rotated,counterclockwise){if(rotated&&texture.isLoaded()){var tempElement=texture.getHtmlElementObj();tempElement=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(tempElement,rect,counterclockwise);var tempTexture=new cc.Texture2D;tempTexture.initWithElement(tempElement),tempTexture.handleLoadedTexture(),texture=tempTexture,rect.x=rect.y=0,this._node._rect=cc.rect(0,0,rect.width,rect.height)}return texture},proto._checkTextureBoundary=function(texture,rect,rotated){if(texture&&texture.url){var _x=rect.x+rect.width,_y=rect.y+rect.height;_x>texture.width&&cc.error(cc._LogInfos.RectWidth,texture.url),_y>texture.height&&cc.error(cc._LogInfos.RectHeight,texture.url)}},proto.rendering=function(ctx,scaleX,scaleY){var node=this._node,locTextureCoord=this._textureCoord,alpha=this._displayedOpacity/255,texture=this._textureToRender||node._texture;if((!texture||0!==locTextureCoord.width&&0!==locTextureCoord.height&&texture._textureLoaded)&&0!==alpha){var image,sx,sy,sw,sh,x,y,w,h,wrapper=ctx||cc._renderContext,context=wrapper.getContext(),locX=node._offsetPosition.x,locHeight=node._rect.height,locWidth=node._rect.width,locY=-node._offsetPosition.y-locHeight;if(wrapper.setTransform(this._worldTransform,scaleX,scaleY),wrapper.setCompositeOperation(this._blendFuncStr),wrapper.setGlobalAlpha(alpha),(node._flippedX||node._flippedY)&&wrapper.save(),node._flippedX&&(locX=-locX-locWidth,context.scale(-1,1)),node._flippedY&&(locY=node._offsetPosition.y,context.scale(1,-1)),sy=this._colorized?sx=0:(sx=locTextureCoord.renderX,locTextureCoord.renderY),sw=locTextureCoord.width,sh=locTextureCoord.height,x=locX,y=locY,w=locWidth,h=locHeight,texture&&texture._htmlElementObj)image=texture._htmlElementObj,""!==texture._pattern?(wrapper.setFillStyle(context.createPattern(image,texture._pattern)),context.fillRect(x,y,w,h)):context.drawImage(image,sx,sy,sw,sh,x,y,w,h);else{var contentSize=node._contentSize;if(locTextureCoord.validRect){var curColor=this._displayedColor;wrapper.setFillStyle("rgba("+curColor.r+","+curColor.g+","+curColor.b+",1)"),context.fillRect(x,y,contentSize.width*scaleX,contentSize.height*scaleY)}}(node._flippedX||node._flippedY)&&wrapper.restore(),cc.g_NumberOfDraws++}},proto._updateColor=function(){var texture=this._node._texture,rect=this._textureCoord,dColor=this._displayedColor;texture&&(255!==dColor.r||255!==dColor.g||255!==dColor.b?(this._textureToRender=texture._generateColorTexture(dColor.r,dColor.g,dColor.b,rect),this._colorized=!0):texture&&(this._textureToRender=texture,this._colorized=!1))},proto._textureLoadedCallback=function(sender){if(!this._textureLoaded){this._textureLoaded=!0;var locRect=this._rect,locRenderCmd=this._renderCmd;locRect?cc._rectEqualToZero(locRect)&&(locRect.width=sender.width,locRect.height=sender.height):locRect=cc.rect(0,0,sender.width,sender.height),this.texture=sender,this.setTextureRect(locRect,this._rectRotated);var locColor=locRenderCmd._displayedColor;255===locColor.r&&255===locColor.g&&255===locColor.b||locRenderCmd._updateColor(),this.setBatchNode(this._batchNode),this.dispatchEvent("load")}},proto._setTextureCoords=function(rect,needConvert){void 0===needConvert&&(needConvert=!0);var locTextureRect=this._textureCoord,scaleFactor=needConvert?cc.contentScaleFactor():1;locTextureRect.renderX=locTextureRect.x=0|rect.x*scaleFactor,locTextureRect.renderY=locTextureRect.y=0|rect.y*scaleFactor,locTextureRect.width=0|rect.width*scaleFactor,locTextureRect.height=0|rect.height*scaleFactor,locTextureRect.validRect=!(0===locTextureRect.width||0===locTextureRect.height||locTextureRect.x<0||locTextureRect.y<0)},cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas=function(texture,rect,counterclockwise){if(!texture)return null;if(!rect)return texture;counterclockwise=null==counterclockwise||counterclockwise;var nCanvas=document.createElement("canvas");nCanvas.width=rect.width,nCanvas.height=rect.height;var ctx=nCanvas.getContext("2d");return ctx.translate(nCanvas.width/2,nCanvas.height/2),counterclockwise?ctx.rotate(-1.5707963267948966):ctx.rotate(1.5707963267948966),ctx.drawImage(texture,rect.x,rect.y,rect.height,rect.width,-rect.height/2,-rect.width/2,rect.height,rect.width),nCanvas}}(),function(){cc.Sprite.WebGLRenderCmd=function(renderable){this._rootCtor(renderable),this._needDraw=!0,this._vertices=[{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0}],this._color=new Uint32Array(1),this._dirty=!1,this._recursiveDirty=!1,this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)};var proto=cc.Sprite.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);proto.constructor=cc.Sprite.WebGLRenderCmd,proto._spriteCmdCtor=cc.Sprite.WebGLRenderCmd,proto.updateBlendFunc=function(blendFunc){},proto.setDirtyFlag=function(dirtyFlag){cc.Node.WebGLRenderCmd.prototype.setDirtyFlag.call(this,dirtyFlag),this._dirty=!0},proto.setDirtyRecursively=function(value){this._recursiveDirty=value,this._dirty=value;for(var child,locChildren=this._node._children,l=locChildren?locChildren.length:0,i=0;i<l;i++)(child=locChildren[i])instanceof cc.Sprite&&child._renderCmd.setDirtyRecursively(value)},proto._setBatchNodeForAddChild=function(child){var node=this._node;if(node._batchNode){if(!(child instanceof cc.Sprite))return cc.log(cc._LogInfos.Sprite_addChild),!1;child.texture._webTextureObj!==node.textureAtlas.texture._webTextureObj&&cc.log(cc._LogInfos.Sprite_addChild_2),node._batchNode.appendChild(child),node._reorderChildDirty||node._setReorderChildDirtyRecursively()}return!0},proto._handleTextureForRotatedTexture=function(texture){return texture},proto.isFrameDisplayed=function(frame){var node=this._node;return cc.rectEqualToRect(frame.getRect(),node._rect)&&frame.getTexture().getName()===node._texture.getName()&&cc.pointEqualToPoint(frame.getOffset(),node._unflippedOffsetPositionFromCenter)},proto._textureLoadedCallback=function(sender){if(!this._textureLoaded){this._textureLoaded=!0;var locRect=this._rect;locRect?cc._rectEqualToZero(locRect)&&(locRect.width=sender.width,locRect.height=sender.height):locRect=cc.rect(0,0,sender.width,sender.height),this.texture=sender,this.setTextureRect(locRect,this._rectRotated),this.setBatchNode(this._batchNode),this.dispatchEvent("load"),cc.renderer.childrenOrderDirty=!0}},proto._setTextureCoords=function(rect,needConvert){void 0===needConvert&&(needConvert=!0),needConvert&&(rect=cc.rectPointsToPixels(rect));var node=this._node,tex=node._batchNode?node.textureAtlas.texture:node._texture,uvs=this._vertices;if(tex){var left,right,top,bottom,tempSwap,atlasWidth=tex.pixelsWidth,atlasHeight=tex.pixelsHeight;node._rectRotated?(bottom=cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(right=(left=(2*rect.x+1)/(2*atlasWidth))+(2*rect.height-2)/(2*atlasWidth),(top=(2*rect.y+1)/(2*atlasHeight))+(2*rect.width-2)/(2*atlasHeight)):(left=rect.x/atlasWidth,right=(rect.x+rect.height)/atlasWidth,top=rect.y/atlasHeight,(rect.y+rect.width)/atlasHeight),node._flippedX&&(tempSwap=top,top=bottom,bottom=tempSwap),node._flippedY&&(tempSwap=left,left=right,right=tempSwap),uvs[0].u=right,uvs[0].v=top,uvs[1].u=left,uvs[1].v=top,uvs[2].u=right,uvs[2].v=bottom,uvs[3].u=left):(bottom=cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(right=(left=(2*rect.x+1)/(2*atlasWidth))+(2*rect.width-2)/(2*atlasWidth),(top=(2*rect.y+1)/(2*atlasHeight))+(2*rect.height-2)/(2*atlasHeight)):(left=rect.x/atlasWidth,right=(rect.x+rect.width)/atlasWidth,top=rect.y/atlasHeight,(rect.y+rect.height)/atlasHeight),node._flippedX&&(tempSwap=left,left=right,right=tempSwap),node._flippedY&&(tempSwap=top,top=bottom,bottom=tempSwap),uvs[0].u=left,uvs[0].v=top,uvs[1].u=left,uvs[1].v=bottom,uvs[2].u=right,uvs[2].v=top,uvs[3].u=right),uvs[3].v=bottom}},proto._setColorDirty=function(){},proto._updateBlendFunc=function(){if(this._batchNode)cc.log(cc._LogInfos.Sprite__updateBlendFunc);else{var node=this._node,blendFunc=node._blendFunc;node._texture&&node._texture.hasPremultipliedAlpha()?(blendFunc.src===cc.SRC_ALPHA&&blendFunc.dst===cc.BLEND_DST&&(blendFunc.src=cc.ONE),node.opacityModifyRGB=!0):(blendFunc.src===cc.ONE&&blendFunc.dst===cc.BLEND_DST&&(blendFunc.src=cc.SRC_ALPHA),node.opacityModifyRGB=!1)}},proto._setTexture=function(texture){var node=this._node;if(node._texture!==texture){node._textureLoaded=!!texture&&texture._textureLoaded;var texSize=(node._texture=texture)._contentSize,rect=cc.rect(0,0,texSize.width,texSize.height);node.setTextureRect(rect),this._updateBlendFunc(),node._textureLoaded&&(cc.renderer.childrenOrderDirty=!0)}},proto._checkTextureBoundary=function(texture,rect,rotated){var _x,_y;texture&&texture.url&&(_y=rotated?(_x=rect.x+rect.height,rect.y+rect.width):(_x=rect.x+rect.width,rect.y+rect.height),_x>texture.width&&cc.error(cc._LogInfos.RectWidth,texture.url),_y>texture.height&&cc.error(cc._LogInfos.RectHeight,texture.url))},proto.transform=function(parentCmd,recursive){this.originTransform(parentCmd,recursive);var node=this._node,lx=node._offsetPosition.x,rx=lx+node._rect.width,by=node._offsetPosition.y,ty=by+node._rect.height,wt=this._worldTransform,wtx=wt.tx,wty=wt.ty,lxa=lx*wt.a,lxb=lx*wt.b,rxa=rx*wt.a,rxb=rx*wt.b,tyc=ty*wt.c,tyd=ty*wt.d,byc=by*wt.c,byd=by*wt.d,vertices=this._vertices;vertices[0].x=lxa+tyc+wtx,vertices[0].y=lxb+tyd+wty,vertices[1].x=lxa+byc+wtx,vertices[1].y=lxb+byd+wty,vertices[2].x=rxa+tyc+wtx,vertices[2].y=rxb+tyd+wty,vertices[3].x=rxa+byc+wtx,vertices[3].y=rxb+byd+wty},proto.needDraw=function(){var locTexture=this._node._texture;return this._needDraw&&locTexture},proto.uploadData=function(f32buffer,ui32buffer,vertexDataOffset){var node=this._node,locTexture=node._texture;if(!(locTexture&&locTexture._textureLoaded&&node._rect.width&&node._rect.height&&this._displayedOpacity))return!1;var opacity=this._displayedOpacity,r=this._displayedColor.r,g=this._displayedColor.g,b=this._displayedColor.b;if(node._opacityModifyRGB){var a=opacity/255;r*=a,g*=a,b*=a}this._color[0]=opacity<<24|b<<16|g<<8|r;var i,vertex,z=node._vertexZ,vertices=this._vertices,len=vertices.length,offset=vertexDataOffset;for(i=0;i<len;++i)vertex=vertices[i],f32buffer[offset]=vertex.x,f32buffer[offset+1]=vertex.y,f32buffer[offset+2]=z,ui32buffer[offset+3]=this._color[0],f32buffer[offset+4]=vertex.u,f32buffer[offset+5]=vertex.v,offset+=6;return len}}(),cc.SpriteBatchNode=cc.Node.extend({_blendFunc:null,_texture:null,_className:"SpriteBatchNode",ctor:function(fileImage){var texture2D;cc.Node.prototype.ctor.call(this),this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST),cc.isString(fileImage)?(texture2D=cc.textureCache.getTextureForKey(fileImage))||(texture2D=cc.textureCache.addImage(fileImage)):fileImage instanceof cc.Texture2D&&(texture2D=fileImage),texture2D&&this.initWithTexture(texture2D)},addSpriteWithoutQuad:function(child,z,aTag){return this.addChild(child,z,aTag),this},getTextureAtlas:function(){return null},setTextureAtlas:function(textureAtlas){},getDescendants:function(){return this._children},initWithFile:function(fileImage,capacity){var texture2D=cc.textureCache.getTextureForKey(fileImage);return texture2D||(texture2D=cc.textureCache.addImage(fileImage)),this.initWithTexture(texture2D,capacity)},init:function(fileImage,capacity){var texture2D=cc.textureCache.getTextureForKey(fileImage);return texture2D||(texture2D=cc.textureCache.addImage(fileImage)),this.initWithTexture(texture2D,capacity)},increaseAtlasCapacity:function(){},removeChildAtIndex:function(index,doCleanup){this.removeChild(this._children[index],doCleanup)},rebuildIndexInOrder:function(pobParent,index){return index},highestAtlasIndexInChild:function(sprite){var children=sprite.children;return children&&0!==children.length?this.highestAtlasIndexInChild(children[children.length-1]):sprite.zIndex},lowestAtlasIndexInChild:function(sprite){var children=sprite.children;return children&&0!==children.length?this.lowestAtlasIndexInChild(children[children.length-1]):sprite.zIndex},atlasIndexForChild:function(sprite){return sprite.zIndex},reorderBatch:function(reorder){this._reorderChildDirty=reorder},setBlendFunc:function(src,dst){this._blendFunc=void 0===dst?src:{src:src,dst:dst}},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},updateQuadFromSprite:function(sprite,index){cc.assert(sprite,cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite_2),sprite instanceof cc.Sprite?(sprite.dirty=!0,sprite._renderCmd.transform(this._renderCmd,!0)):cc.log(cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite)},insertQuadFromSprite:function(sprite,index){this.addChild(sprite,index)},insertChild:function(sprite,index){this.addChild(sprite,index)},appendChild:function(sprite){this.sortAllChildren();this._children[this._children.length-1]._localZOrder;this.addChild(sprite.lastLocalZOrder+1)},removeSpriteFromAtlas:function(sprite,cleanup){this.removeChild(sprite,cleanup)},initWithTexture:function(tex){return this.setTexture(tex),!0},getTexture:function(){return this._texture},setTexture:function(texture){if((this._texture=texture)._textureLoaded){var i,children=this._children,len=children.length;for(i=0;i<len;++i)children[i].setTexture(texture)}else texture.addEventListener("load",function(){var i,children=this._children,len=children.length;for(i=0;i<len;++i)children[i].setTexture(texture)},this)},setShaderProgram:function(newShaderProgram){this._renderCmd.setShaderProgram(newShaderProgram);var i,children=this._children,len=children.length;for(i=0;i<len;++i)children[i].setShaderProgram(newShaderProgram)},addChild:function(child,zOrder,tag){cc.assert(void 0!==child,cc._LogInfos.CCSpriteBatchNode_addChild_3),this._isValidChild(child)&&(zOrder=void 0===zOrder?child.zIndex:zOrder,tag=void 0===tag?child.tag:tag,cc.Node.prototype.addChild.call(this,child,zOrder,tag),this._renderCmd._shaderProgram&&(child.shaderProgram=this._renderCmd._shaderProgram))},_isValidChild:function(child){return child instanceof cc.Sprite?child.texture===this._texture||(cc.log(cc._LogInfos.Sprite_addChild_5),!1):(cc.log(cc._LogInfos.Sprite_addChild_4),!1)}});var _p=cc.SpriteBatchNode.prototype;cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture),cc.defineGetterSetter(_p,"shaderProgram",_p.getShaderProgram,_p.setShaderProgram),cc.SpriteBatchNode.create=function(fileImage){return new cc.SpriteBatchNode(fileImage)},cc.SpriteBatchNode.createWithTexture=cc.SpriteBatchNode.create,cc.BakeSprite=cc.Sprite.extend({_cacheCanvas:null,_cacheContext:null,ctor:function(){cc.Sprite.prototype.ctor.call(this);var canvasElement=document.createElement("canvas");canvasElement.width=canvasElement.height=10,this._cacheCanvas=canvasElement,this._cacheContext=new cc.CanvasContextWrapper(canvasElement.getContext("2d"));var texture=new cc.Texture2D;texture.initWithElement(canvasElement),texture.handleLoadedTexture(),this.setTexture(texture)},getCacheContext:function(){return this._cacheContext},getCacheCanvas:function(){return this._cacheCanvas},resetCanvasSize:function(sizeOrWidth,height){var locCanvas=this._cacheCanvas,locContext=this._cacheContext,strokeStyle=locContext._context.strokeStyle,fillStyle=locContext._context.fillStyle;void 0===height&&(height=sizeOrWidth.height,sizeOrWidth=sizeOrWidth.width),locCanvas.width=sizeOrWidth,locCanvas.height=height,strokeStyle!==locContext._context.strokeStyle&&(locContext._context.strokeStyle=strokeStyle),fillStyle!==locContext._context.fillStyle&&(locContext._context.fillStyle=fillStyle),this.getTexture().handleLoadedTexture(),this.setTextureRect(cc.rect(0,0,sizeOrWidth,height),!1,null,!1)}}),cc.AnimationFrame=cc.Class.extend({_spriteFrame:null,_delayPerUnit:0,_userInfo:null,ctor:function(spriteFrame,delayUnits,userInfo){this._spriteFrame=spriteFrame||null,this._delayPerUnit=delayUnits||0,this._userInfo=userInfo||null},clone:function(){var frame=new cc.AnimationFrame;return frame.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo),frame},copyWithZone:function(pZone){return cc.clone(this)},copy:function(pZone){var newFrame=new cc.AnimationFrame;return newFrame.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo),newFrame},initWithSpriteFrame:function(spriteFrame,delayUnits,userInfo){return this._spriteFrame=spriteFrame,this._delayPerUnit=delayUnits,this._userInfo=userInfo,!0},getSpriteFrame:function(){return this._spriteFrame},setSpriteFrame:function(spriteFrame){this._spriteFrame=spriteFrame},getDelayUnits:function(){return this._delayPerUnit},setDelayUnits:function(delayUnits){this._delayPerUnit=delayUnits},getUserInfo:function(){return this._userInfo},setUserInfo:function(userInfo){this._userInfo=userInfo}}),cc.AnimationFrame.create=function(spriteFrame,delayUnits,userInfo){return new cc.AnimationFrame(spriteFrame,delayUnits,userInfo)},cc.Animation=cc.Class.extend({_frames:null,_loops:0,_restoreOriginalFrame:!1,_duration:0,_delayPerUnit:0,_totalDelayUnits:0,ctor:function(frames,delay,loops){if(this._frames=[],void 0===frames)this.initWithSpriteFrames(null,0);else{var frame0=frames[0];frame0&&(frame0 instanceof cc.SpriteFrame?this.initWithSpriteFrames(frames,delay,loops):frame0 instanceof cc.AnimationFrame&&this.initWithAnimationFrames(frames,delay,loops))}},getFrames:function(){return this._frames},setFrames:function(frames){this._frames=frames},addSpriteFrame:function(frame){var animFrame=new cc.AnimationFrame;animFrame.initWithSpriteFrame(frame,1,null),this._frames.push(animFrame),this._totalDelayUnits++},addSpriteFrameWithFile:function(fileName){if("string"==typeof fileName)if("#"===fileName[0]){var frameName=fileName.substr(1,fileName.length-1),spriteFrame=cc.spriteFrameCache.getSpriteFrame(frameName);this.addSpriteFrame(spriteFrame)}else{var texture=cc.textureCache.addImage(fileName),rect=cc.rect(0,0,0,0);rect.width=texture.width,rect.height=texture.height;var frame=new cc.SpriteFrame(texture,rect);this.addSpriteFrame(frame)}},addSpriteFrameWithTexture:function(texture,rect){var pFrame=new cc.SpriteFrame(texture,rect);this.addSpriteFrame(pFrame)},initWithAnimationFrames:function(arrayOfAnimationFrames,delayPerUnit,loops){cc.arrayVerifyType(arrayOfAnimationFrames,cc.AnimationFrame),this._delayPerUnit=delayPerUnit,this._loops=void 0===loops?1:loops,this._totalDelayUnits=0;for(var locFrames=this._frames,i=locFrames.length=0;i<arrayOfAnimationFrames.length;i++){var animFrame=arrayOfAnimationFrames[i];locFrames.push(animFrame),this._totalDelayUnits+=animFrame.getDelayUnits()}return!0},clone:function(){var animation=new cc.Animation;return animation.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops),animation.setRestoreOriginalFrame(this._restoreOriginalFrame),animation},copyWithZone:function(pZone){var pCopy=new cc.Animation;return pCopy.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops),pCopy.setRestoreOriginalFrame(this._restoreOriginalFrame),pCopy},_copyFrames:function(){for(var copyFrames=[],i=0;i<this._frames.length;i++)copyFrames.push(this._frames[i].clone());return copyFrames},copy:function(pZone){return this.copyWithZone(null)},getLoops:function(){return this._loops},setLoops:function(value){this._loops=value},setRestoreOriginalFrame:function(restOrigFrame){this._restoreOriginalFrame=restOrigFrame},getRestoreOriginalFrame:function(){return this._restoreOriginalFrame},getDuration:function(){return this._totalDelayUnits*this._delayPerUnit},getDelayPerUnit:function(){return this._delayPerUnit},setDelayPerUnit:function(delayPerUnit){this._delayPerUnit=delayPerUnit},getTotalDelayUnits:function(){return this._totalDelayUnits},initWithSpriteFrames:function(frames,delay,loops){cc.arrayVerifyType(frames,cc.SpriteFrame),this._loops=void 0===loops?1:loops,this._delayPerUnit=delay||0,this._totalDelayUnits=0;var locFrames=this._frames;if(locFrames.length=0,frames){for(var i=0;i<frames.length;i++){var frame=frames[i],animFrame=new cc.AnimationFrame;animFrame.initWithSpriteFrame(frame,1,null),locFrames.push(animFrame)}this._totalDelayUnits+=frames.length}return!0},retain:function(){},release:function(){}}),cc.Animation.create=function(frames,delay,loops){return new cc.Animation(frames,delay,loops)},cc.Animation.createWithAnimationFrames=cc.Animation.create,cc.animationCache={_animations:{},addAnimation:function(animation,name){this._animations[name]=animation},removeAnimation:function(name){name&&this._animations[name]&&delete this._animations[name]},getAnimation:function(name){return this._animations[name]?this._animations[name]:null},_addAnimationsWithDictionary:function(dictionary,plist){var animations=dictionary.animations;if(animations){var version=1,properties=dictionary.properties;if(properties){version=null!=properties.format?parseInt(properties.format):version;for(var spritesheets=properties.spritesheets,spriteFrameCache=cc.spriteFrameCache,path=cc.path,i=0;i<spritesheets.length;i++)spriteFrameCache.addSpriteFrames(path.changeBasename(plist,spritesheets[i]))}switch(version){case 1:this._parseVersion1(animations);break;case 2:this._parseVersion2(animations);break;default:cc.log(cc._LogInfos.animationCache__addAnimationsWithDictionary_2)}}else cc.log(cc._LogInfos.animationCache__addAnimationsWithDictionary)},addAnimations:function(plist){cc.assert(plist,cc._LogInfos.animationCache_addAnimations_2);var dict=cc.loader.getRes(plist);dict?this._addAnimationsWithDictionary(dict,plist):cc.log(cc._LogInfos.animationCache_addAnimations)},_parseVersion1:function(animations){var frameCache=cc.spriteFrameCache;for(var key in animations){var animation,animationDict=animations[key],frameNames=animationDict.frames,delay=parseFloat(animationDict.delay)||0;if(frameNames){for(var frames=[],i=0;i<frameNames.length;i++){var spriteFrame=frameCache.getSpriteFrame(frameNames[i]);if(spriteFrame){var animFrame=new cc.AnimationFrame;animFrame.initWithSpriteFrame(spriteFrame,1,null),frames.push(animFrame)}else cc.log(cc._LogInfos.animationCache__parseVersion1_2,key,frameNames[i])}0!==frames.length?(frames.length!==frameNames.length&&cc.log(cc._LogInfos.animationCache__parseVersion1_4,key),animation=new cc.Animation(frames,delay,1),cc.animationCache.addAnimation(animation,key)):cc.log(cc._LogInfos.animationCache__parseVersion1_3,key)}else cc.log(cc._LogInfos.animationCache__parseVersion1,key)}},_parseVersion2:function(animations){var frameCache=cc.spriteFrameCache;for(var key in animations){var animationDict=animations[key],isLoop=animationDict.loop,loopsTemp=parseInt(animationDict.loops),loops=isLoop?cc.REPEAT_FOREVER:isNaN(loopsTemp)?1:loopsTemp,restoreOriginalFrame=!(!animationDict.restoreOriginalFrame||1!=animationDict.restoreOriginalFrame),frameArray=animationDict.frames;if(frameArray){for(var arr=[],i=0;i<frameArray.length;i++){var entry=frameArray[i],spriteFrameName=entry.spriteframe,spriteFrame=frameCache.getSpriteFrame(spriteFrameName);if(spriteFrame){var delayUnits=parseFloat(entry.delayUnits)||0,userInfo=entry.notification,animFrame=new cc.AnimationFrame;animFrame.initWithSpriteFrame(spriteFrame,delayUnits,userInfo),arr.push(animFrame)}else cc.log(cc._LogInfos.animationCache__parseVersion2_2,key,spriteFrameName)}var delayPerUnit=parseFloat(animationDict.delayPerUnit)||0,animation=new cc.Animation;animation.initWithAnimationFrames(arr,delayPerUnit,loops),animation.setRestoreOriginalFrame(restoreOriginalFrame),cc.animationCache.addAnimation(animation,key)}else cc.log(cc._LogInfos.animationCache__parseVersion2,key)}},_clear:function(){this._animations={}}},cc.SpriteFrame=cc.Class.extend({_offset:null,_originalSize:null,_rectInPixels:null,_rotated:!1,_rect:null,_offsetInPixels:null,_originalSizeInPixels:null,_texture:null,_textureFilename:"",_textureLoaded:!1,ctor:function(filename,rect,rotated,offset,originalSize){this._offset=cc.p(0,0),this._offsetInPixels=cc.p(0,0),this._originalSize=cc.size(0,0),this._rotated=!1,this._originalSizeInPixels=cc.size(0,0),this._textureFilename="",this._texture=null,this._textureLoaded=!1,void 0!==filename&&void 0!==rect&&(void 0===rotated||void 0===offset||void 0===originalSize?this.initWithTexture(filename,rect):this.initWithTexture(filename,rect,rotated,offset,originalSize))},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(callback,target){this.addEventListener("load",callback,target)},getRectInPixels:function(){var locRectInPixels=this._rectInPixels;return cc.rect(locRectInPixels.x,locRectInPixels.y,locRectInPixels.width,locRectInPixels.height)},setRectInPixels:function(rectInPixels){this._rectInPixels||(this._rectInPixels=cc.rect(0,0,0,0)),this._rectInPixels.x=rectInPixels.x,this._rectInPixels.y=rectInPixels.y,this._rectInPixels.width=rectInPixels.width,this._rectInPixels.height=rectInPixels.height,this._rect=cc.rectPixelsToPoints(rectInPixels)},isRotated:function(){return this._rotated},setRotated:function(bRotated){this._rotated=bRotated},getRect:function(){var locRect=this._rect;return cc.rect(locRect.x,locRect.y,locRect.width,locRect.height)},setRect:function(rect){this._rect||(this._rect=cc.rect(0,0,0,0)),this._rect.x=rect.x,this._rect.y=rect.y,this._rect.width=rect.width,this._rect.height=rect.height,this._rectInPixels=cc.rectPointsToPixels(this._rect)},getOffsetInPixels:function(){return cc.p(this._offsetInPixels)},setOffsetInPixels:function(offsetInPixels){this._offsetInPixels.x=offsetInPixels.x,this._offsetInPixels.y=offsetInPixels.y,cc._pointPixelsToPointsOut(this._offsetInPixels,this._offset)},getOriginalSizeInPixels:function(){return cc.size(this._originalSizeInPixels)},setOriginalSizeInPixels:function(sizeInPixels){this._originalSizeInPixels.width=sizeInPixels.width,this._originalSizeInPixels.height=sizeInPixels.height},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(sizeInPixels){this._originalSize.width=sizeInPixels.width,this._originalSize.height=sizeInPixels.height},getTexture:function(){if(this._texture)return this._texture;if(""===this._textureFilename)return null;var locTexture=cc.textureCache.addImage(this._textureFilename);return locTexture&&(this._textureLoaded=locTexture.isLoaded()),locTexture},setTexture:function(texture){if(this._texture!==texture){var locLoaded=texture.isLoaded();this._textureLoaded=locLoaded,this._texture=texture,locLoaded||texture.addEventListener("load",function(sender){if(this._textureLoaded=!0,this._rotated&&cc._renderType===cc.game.RENDER_TYPE_CANVAS){var tempElement=sender.getHtmlElementObj();tempElement=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(tempElement,this.getRect());var tempTexture=new cc.Texture2D;tempTexture.initWithElement(tempElement),tempTexture.handleLoadedTexture(),this.setTexture(tempTexture);var rect=this.getRect();this.setRect(cc.rect(0,0,rect.width,rect.height))}var locRect=this._rect;if(0===locRect.width&&0===locRect.height){var w=sender.width,h=sender.height;this._rect.width=w,this._rect.height=h,this._rectInPixels=cc.rectPointsToPixels(this._rect),this._originalSizeInPixels.width=this._rectInPixels.width,this._originalSizeInPixels.height=this._rectInPixels.height,this._originalSize.width=w,this._originalSize.height=h}this.dispatchEvent("load")},this)}},getOffset:function(){return cc.p(this._offset)},setOffset:function(offsets){this._offset.x=offsets.x,this._offset.y=offsets.y},clone:function(){var frame=new cc.SpriteFrame;return frame.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels),frame.setTexture(this._texture),frame},copyWithZone:function(){var copy=new cc.SpriteFrame;return copy.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels),copy.setTexture(this._texture),copy},copy:function(){return this.copyWithZone()},initWithTexture:function(texture,rect,rotated,offset,originalSize){var _x,_y;(2===arguments.length&&(rect=cc.rectPointsToPixels(rect)),offset=offset||cc.p(0,0),originalSize=originalSize||rect,rotated=rotated||!1,"string"==typeof texture?(this._texture=null,this._textureFilename=texture):texture instanceof cc.Texture2D&&this.setTexture(texture),texture=this.getTexture(),this._rectInPixels=rect,this._rect=cc.rectPixelsToPoints(rect),texture&&texture.url&&texture.isLoaded())&&(_y=rotated?(_x=rect.x+rect.height,rect.y+rect.width):(_x=rect.x+rect.width,rect.y+rect.height),_x>texture.getPixelsWide()&&cc.error(cc._LogInfos.RectWidth,texture.url),_y>texture.getPixelsHigh()&&cc.error(cc._LogInfos.RectHeight,texture.url));return this._offsetInPixels.x=offset.x,this._offsetInPixels.y=offset.y,cc._pointPixelsToPointsOut(offset,this._offset),this._originalSizeInPixels.width=originalSize.width,this._originalSizeInPixels.height=originalSize.height,cc._sizePixelsToPointsOut(originalSize,this._originalSize),this._rotated=rotated,!0}}),cc.EventHelper.prototype.apply(cc.SpriteFrame.prototype),cc.SpriteFrame.create=function(filename,rect,rotated,offset,originalSize){return new cc.SpriteFrame(filename,rect,rotated,offset,originalSize)},cc.SpriteFrame.createWithTexture=cc.SpriteFrame.create,cc.SpriteFrame._frameWithTextureForCanvas=function(texture,rect,rotated,offset,originalSize){var spriteFrame=new cc.SpriteFrame;return spriteFrame._texture=texture,spriteFrame._rectInPixels=rect,spriteFrame._rect=cc.rectPixelsToPoints(rect),spriteFrame._offsetInPixels.x=offset.x,spriteFrame._offsetInPixels.y=offset.y,cc._pointPixelsToPointsOut(spriteFrame._offsetInPixels,spriteFrame._offset),spriteFrame._originalSizeInPixels.width=originalSize.width,spriteFrame._originalSizeInPixels.height=originalSize.height,cc._sizePixelsToPointsOut(spriteFrame._originalSizeInPixels,spriteFrame._originalSize),spriteFrame._rotated=rotated,spriteFrame},cc.spriteFrameCache={_CCNS_REG1:/^\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*$/,_CCNS_REG2:/^\s*\{\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*,\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*\}\s*$/,_spriteFrames:{},_spriteFramesAliases:{},_frameConfigCache:{},_rectFromString:function(content){var result=this._CCNS_REG2.exec(content);return result?cc.rect(parseFloat(result[1]),parseFloat(result[2]),parseFloat(result[3]),parseFloat(result[4])):cc.rect(0,0,0,0)},_pointFromString:function(content){var result=this._CCNS_REG1.exec(content);return result?cc.p(parseFloat(result[1]),parseFloat(result[2])):cc.p(0,0)},_sizeFromString:function(content){var result=this._CCNS_REG1.exec(content);return result?cc.size(parseFloat(result[1]),parseFloat(result[2])):cc.size(0,0)},_getFrameConfig:function(url){var dict=cc.loader.getRes(url);return cc.assert(dict,cc._LogInfos.spriteFrameCache__getFrameConfig_2,url),cc.loader.release(url),dict._inited?this._frameConfigCache[url]=dict:(this._frameConfigCache[url]=this._parseFrameConfig(dict),this._frameConfigCache[url])},_getFrameConfigByJsonObject:function(url,jsonObject){return cc.assert(jsonObject,cc._LogInfos.spriteFrameCache__getFrameConfig_2,url),this._frameConfigCache[url]=this._parseFrameConfig(jsonObject),this._frameConfigCache[url]},_parseFrameConfig:function(dict){var tempFrames=dict.frames,tempMeta=dict.metadata||dict.meta,frames={},meta={},format=0;if(tempMeta){var tmpFormat=tempMeta.format;format=tmpFormat.length<=1?parseInt(tmpFormat):tmpFormat,meta.image=tempMeta.textureFileName||tempMeta.textureFileName||tempMeta.image}for(var key in tempFrames){var frameDict=tempFrames[key];if(frameDict){var tempFrame={};if(0==format){tempFrame.rect=cc.rect(frameDict.x,frameDict.y,frameDict.width,frameDict.height),tempFrame.rotated=!1,tempFrame.offset=cc.p(frameDict.offsetX,frameDict.offsetY);var ow=frameDict.originalWidth,oh=frameDict.originalHeight;ow&&oh||cc.log(cc._LogInfos.spriteFrameCache__getFrameConfig),ow=Math.abs(ow),oh=Math.abs(oh),tempFrame.size=cc.size(ow,oh)}else if(1==format||2==format)tempFrame.rect=this._rectFromString(frameDict.frame),tempFrame.rotated=frameDict.rotated||!1,tempFrame.offset=this._pointFromString(frameDict.offset),tempFrame.size=this._sizeFromString(frameDict.sourceSize);else if(3==format){var spriteSize=this._sizeFromString(frameDict.spriteSize),textureRect=this._rectFromString(frameDict.textureRect);spriteSize&&(textureRect=cc.rect(textureRect.x,textureRect.y,spriteSize.width,spriteSize.height)),tempFrame.rect=textureRect,tempFrame.rotated=frameDict.textureRotated||!1,tempFrame.offset=this._pointFromString(frameDict.spriteOffset),tempFrame.size=this._sizeFromString(frameDict.spriteSourceSize),tempFrame.aliases=frameDict.aliases}else{var tmpFrame=frameDict.frame,tmpSourceSize=frameDict.sourceSize;key=frameDict.filename||key,tempFrame.rect=cc.rect(tmpFrame.x,tmpFrame.y,tmpFrame.w,tmpFrame.h),tempFrame.rotated=frameDict.rotated||!1,tempFrame.offset=cc.p(0,0),tempFrame.size=cc.size(tmpSourceSize.w,tmpSourceSize.h)}frames[key]=tempFrame}}return{_inited:!0,frames:frames,meta:meta}},_addSpriteFramesByObject:function(url,jsonObject,texture){if(cc.assert(url,cc._LogInfos.spriteFrameCache_addSpriteFrames_2),jsonObject&&jsonObject.frames){var frameConfig=this._frameConfigCache[url]||this._getFrameConfigByJsonObject(url,jsonObject);this._createSpriteFrames(url,frameConfig,texture)}},_createSpriteFrames:function(url,frameConfig,texture){var frames=frameConfig.frames,meta=frameConfig.meta;if(texture)texture instanceof cc.Texture2D||(cc.isString(texture)?texture=cc.textureCache.addImage(texture):cc.assert(0,cc._LogInfos.spriteFrameCache_addSpriteFrames_3));else{var texturePath=cc.path.changeBasename(url,meta.image||".png");texture=cc.textureCache.addImage(texturePath)}var spAliases=this._spriteFramesAliases,spriteFrames=this._spriteFrames;for(var key in frames){var frame=frames[key],spriteFrame=spriteFrames[key];if(!spriteFrame){spriteFrame=new cc.SpriteFrame(texture,frame.rect,frame.rotated,frame.offset,frame.size);var aliases=frame.aliases;if(aliases)for(var i=0,li=aliases.length;i<li;i++){var alias=aliases[i];spAliases[alias]&&cc.log(cc._LogInfos.spriteFrameCache_addSpriteFrames,alias),spAliases[alias]=key}if(cc._renderType===cc.game.RENDER_TYPE_CANVAS&&spriteFrame.isRotated())if(spriteFrame.getTexture().isLoaded()){var tempElement=spriteFrame.getTexture().getHtmlElementObj();tempElement=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(tempElement,spriteFrame.getRectInPixels());var tempTexture=new cc.Texture2D;tempTexture.initWithElement(tempElement),tempTexture.handleLoadedTexture(),spriteFrame.setTexture(tempTexture),spriteFrame.setRotated(!1);var rect=spriteFrame._rect;spriteFrame.setRect(cc.rect(0,0,rect.width,rect.height))}spriteFrames[key]=spriteFrame}}},addSpriteFrames:function(url,texture){cc.assert(url,cc._LogInfos.spriteFrameCache_addSpriteFrames_2);var dict=this._frameConfigCache[url]||cc.loader.getRes(url);if(dict&&dict.frames){var frameConfig=this._frameConfigCache[url]||this._getFrameConfig(url);this._createSpriteFrames(url,frameConfig,texture)}},_checkConflict:function(dictionary){var framesDict=dictionary.frames;for(var key in framesDict)this._spriteFrames[key]&&cc.log(cc._LogInfos.spriteFrameCache__checkConflict,key)},addSpriteFrame:function(frame,frameName){this._spriteFrames[frameName]=frame},removeSpriteFrames:function(){this._spriteFrames={},this._spriteFramesAliases={}},removeSpriteFrameByName:function(name){name&&(this._spriteFramesAliases[name]&&delete this._spriteFramesAliases[name],this._spriteFrames[name]&&delete this._spriteFrames[name])},removeSpriteFramesFromFile:function(url){var spriteFrames=this._spriteFrames,aliases=this._spriteFramesAliases,cfg=this._frameConfigCache[url];if(cfg){var frames=cfg.frames;for(var key in frames)if(spriteFrames[key])for(var alias in delete spriteFrames[key],aliases)aliases[alias]===key&&delete aliases[alias]}},removeSpriteFramesFromTexture:function(texture){var spriteFrames=this._spriteFrames,aliases=this._spriteFramesAliases;for(var key in spriteFrames){var frame=spriteFrames[key];if(frame&&frame.getTexture()===texture)for(var alias in delete spriteFrames[key],aliases)aliases[alias]===key&&delete aliases[alias]}},getSpriteFrame:function(name){var frame=this._spriteFrames[name];if(!frame){var key=this._spriteFramesAliases[name];key&&((frame=this._spriteFrames[key.toString()])||delete this._spriteFramesAliases[name])}return frame},_clear:function(){this._spriteFrames={},this._spriteFramesAliases={},this._frameConfigCache={}}},cc.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:!1,_init:function(){var locValueDict=this._valueDict;locValueDict["cocos2d.x.version"]=cc.ENGINE_VERSION,locValueDict["cocos2d.x.compiled_with_profiler"]=!1,locValueDict["cocos2d.x.compiled_with_gl_state_cache"]=cc.ENABLE_GL_STATE_CACHE,this._inited=!0},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return!1},supportsS3TC:function(){return!1},supportsATITC:function(){return!1},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(searchName){return-1<this._GlExtensions.indexOf(searchName)},getValue:function(key,default_value){this._inited||this._init();var locValueDict=this._valueDict;return locValueDict[key]?locValueDict[key]:default_value},setValue:function(key,value){this._valueDict[key]=value},dumpInfo:function(){0===cc.ENABLE_GL_STATE_CACHE&&(cc.log(""),cc.log(cc._LogInfos.configuration_dumpInfo),cc.log(""))},gatherGPUInfo:function(){if(cc._renderType!==cc.game.RENDER_TYPE_CANVAS){this._inited||this._init();var gl=cc._renderContext,locValueDict=this._valueDict;locValueDict["gl.vendor"]=gl.getParameter(gl.VENDOR),locValueDict["gl.renderer"]=gl.getParameter(gl.RENDERER),locValueDict["gl.version"]=gl.getParameter(gl.VERSION),this._GlExtensions="";for(var extArr=gl.getSupportedExtensions(),i=0;i<extArr.length;i++)this._GlExtensions+=extArr[i]+" ";this._maxTextureSize=gl.getParameter(gl.MAX_TEXTURE_SIZE),locValueDict["gl.max_texture_size"]=this._maxTextureSize,this._maxTextureUnits=gl.getParameter(gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),locValueDict["gl.max_texture_units"]=this._maxTextureUnits,this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc"),locValueDict["gl.supports_PVRTC"]=this._supportsPVRTC,this._supportsNPOT=!1,locValueDict["gl.supports_NPOT"]=this._supportsNPOT,this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888"),locValueDict["gl.supports_BGRA8888"]=this._supportsBGRA8888,this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer"),locValueDict["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer,this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object"),locValueDict["gl.supports_vertex_array_object"]=this._supportsShareableVAO,cc.checkGLErrorDebug()}},loadConfigFile:function(url){this._inited||this._init();var dict=cc.loader.getRes(url);if(!dict)throw new Error("Please load the resource first : "+url);cc.assert(dict,cc._LogInfos.configuration_loadConfigFile_2,url);var getDatas=dict.data;if(getDatas)for(var selKey in getDatas)this._valueDict[selKey]=getDatas[selKey];else cc.log(cc._LogInfos.configuration_loadConfigFile,url)}},cc.g_NumberOfDraws=0,cc.Director=cc.Class.extend({_landscape:!1,_nextDeltaTimeZero:!1,_paused:!1,_purgeDirectorInNextLoop:!1,_sendCleanupToScene:!1,_animationInterval:0,_oldAnimationInterval:0,_projection:0,_contentScaleFactor:1,_deltaTime:0,_winSizeInPoints:null,_lastUpdate:null,_nextScene:null,_notificationNode:null,_openGLView:null,_scenesStack:null,_projectionDelegate:null,_runningScene:null,_totalFrames:0,_secondsPerFrame:0,_dirtyRegion:null,_scheduler:null,_actionManager:null,_eventProjectionChanged:null,_eventAfterUpdate:null,_eventAfterVisit:null,_eventAfterDraw:null,ctor:function(){var self=this;self._lastUpdate=Date.now(),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){self._lastUpdate=Date.now()})},init:function(){return this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS,this._scenesStack=[],this._projection=cc.Director.PROJECTION_DEFAULT,this._projectionDelegate=null,this._totalFrames=0,this._lastUpdate=Date.now(),this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=cc.size(0,0),this._openGLView=null,this._contentScaleFactor=1,this._scheduler=new cc.Scheduler,cc.ActionManager?this._actionManager=new cc.ActionManager:this._actionManager=null,this._eventAfterUpdate=new cc.EventCustom(cc.Director.EVENT_AFTER_UPDATE),this._eventAfterUpdate.setUserData(this),this._eventAfterVisit=new cc.EventCustom(cc.Director.EVENT_AFTER_VISIT),this._eventAfterVisit.setUserData(this),this._eventAfterDraw=new cc.EventCustom(cc.Director.EVENT_AFTER_DRAW),this._eventAfterDraw.setUserData(this),this._eventProjectionChanged=new cc.EventCustom(cc.Director.EVENT_PROJECTION_CHANGED),this._eventProjectionChanged.setUserData(this),!0},calculateDeltaTime:function(){var now=Date.now();this._nextDeltaTimeZero?(this._deltaTime=0,this._nextDeltaTimeZero=!1):this._deltaTime=(now-this._lastUpdate)/1e3,0<cc.game.config[cc.game.CONFIG_KEY.debugMode]&&.2<this._deltaTime&&(this._deltaTime=1/60),this._lastUpdate=now},convertToGL:function(uiPoint){var docElem=document.documentElement,view=cc.view,box=docElem.getBoundingClientRect();box.left+=window.pageXOffset-docElem.clientLeft,box.top+=window.pageYOffset-docElem.clientTop;var x=view._devicePixelRatio*(uiPoint.x-box.left),y=view._devicePixelRatio*(box.top+box.height-uiPoint.y);return view._isRotated?{x:view._viewPortRect.width-y,y:x}:{x:x,y:y}},convertToUI:function(glPoint){var docElem=document.documentElement,view=cc.view,box=element.getBoundingClientRect();box.left+=window.pageXOffset-docElem.clientLeft,box.top+=window.pageYOffset-docElem.clientTop;var uiPoint={x:0,y:0};return view._isRotated?(uiPoint.x=box.left+glPoint.y/view._devicePixelRatio,uiPoint.y=box.top+box.height-(view._viewPortRect.width-glPoint.x)/view._devicePixelRatio):(uiPoint.x=box.left+glPoint.x/view._devicePixelRatio,uiPoint.y=box.top+box.height-glPoint.y/view._devicePixelRatio),uiPoint},drawScene:function(){var renderer=cc.renderer;this.calculateDeltaTime(),this._paused||(this._actionManager.update(this._deltaTime),this._scheduler.update(this._deltaTime),cc.eventManager.dispatchEvent(this._eventAfterUpdate)),this._nextScene&&this.setNextScene(),this._runningScene&&(renderer.childrenOrderDirty?(cc.renderer.clearRenderCommands(),cc.renderer.assignedZ=0,this._runningScene._renderCmd._curLevel=0,this._runningScene.visit(),renderer.resetFlag()):renderer.transformDirty()&&renderer.transform()),renderer.clear(),this._notificationNode&&this._notificationNode.visit(),cc.eventManager.dispatchEvent(this._eventAfterVisit),cc.g_NumberOfDraws=0,renderer.rendering(cc._renderContext),this._totalFrames++,cc.eventManager.dispatchEvent(this._eventAfterDraw),cc.eventManager.frameUpdateListeners(),this._calculateMPF()},end:function(){this._purgeDirectorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getNotificationNode:function(){return this._notificationNode},getWinSize:function(){return cc.size(this._winSizeInPoints)},getWinSizeInPixels:function(){return cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},getVisibleSize:null,getVisibleOrigin:null,getZEye:null,pause:function(){this._paused||(this._oldAnimationInterval=this._animationInterval,this.setAnimationInterval(.25),this._paused=!0)},popScene:function(){cc.assert(this._runningScene,cc._LogInfos.Director_popScene),this._scenesStack.pop();var c=this._scenesStack.length;0===c?this.end():(this._sendCleanupToScene=!0,this._nextScene=this._scenesStack[c-1])},purgeCachedData:function(){cc.animationCache._clear(),cc.spriteFrameCache._clear(),cc.textureCache._clear()},purgeDirector:function(){this.getScheduler().unscheduleAll(),cc.eventManager&&cc.eventManager.setEnabled(!1),this._runningScene&&(this._runningScene._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),this._runningScene._performRecursive(cc.Node._stateCallbackType.onExit),this._runningScene._performRecursive(cc.Node._stateCallbackType.cleanup)),this._runningScene=null,this._nextScene=null,this._scenesStack.length=0,this.stopAnimation(),this.purgeCachedData(),cc.checkGLErrorDebug()},pushScene:function(scene){cc.assert(scene,cc._LogInfos.Director_pushScene),this._sendCleanupToScene=!1,this._scenesStack.push(scene),this._nextScene=scene},runScene:function(scene){if(cc.assert(scene,cc._LogInfos.Director_pushScene),this._runningScene){var i=this._scenesStack.length;this._nextScene=(0===i?(this._sendCleanupToScene=!0,this._scenesStack[i]=scene):(this._sendCleanupToScene=!0,this._scenesStack[i-1]=scene),scene)}else this.pushScene(scene),this.startAnimation()},resume:function(){this._paused&&(this.setAnimationInterval(this._oldAnimationInterval),this._lastUpdate=Date.now(),this._lastUpdate||cc.log(cc._LogInfos.Director_resume),this._paused=!1,this._deltaTime=0)},setContentScaleFactor:function(scaleFactor){scaleFactor!==this._contentScaleFactor&&(this._contentScaleFactor=scaleFactor)},setDepthTest:null,setClearColor:null,setDefaultValues:function(){},setNextDeltaTimeZero:function(nextDeltaTimeZero){this._nextDeltaTimeZero=nextDeltaTimeZero},setNextScene:function(){var runningIsTransition=!1,newIsTransition=!1;if(cc.TransitionScene&&(runningIsTransition=!!this._runningScene&&this._runningScene instanceof cc.TransitionScene,newIsTransition=!!this._nextScene&&this._nextScene instanceof cc.TransitionScene),!newIsTransition){var locRunningScene=this._runningScene;locRunningScene&&(locRunningScene._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),locRunningScene._performRecursive(cc.Node._stateCallbackType.onExit)),this._sendCleanupToScene&&locRunningScene&&locRunningScene._performRecursive(cc.Node._stateCallbackType.cleanup)}this._runningScene=this._nextScene,cc.renderer.childrenOrderDirty=!0,this._nextScene=null,runningIsTransition||null===this._runningScene||(this._runningScene._performRecursive(cc.Node._stateCallbackType.onEnter),this._runningScene._performRecursive(cc.Node._stateCallbackType.onEnterTransitionDidFinish))},setNotificationNode:function(node){cc.renderer.childrenOrderDirty=!0,this._notificationNode&&(this._notificationNode._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),this._notificationNode._performRecursive(cc.Node._stateCallbackType.onExit),this._notificationNode._performRecursive(cc.Node._stateCallbackType.cleanup)),(this._notificationNode=node)&&(this._notificationNode._performRecursive(cc.Node._stateCallbackType.onEnter),this._notificationNode._performRecursive(cc.Node._stateCallbackType.onEnterTransitionDidFinish))},getDelegate:function(){return this._projectionDelegate},setDelegate:function(delegate){this._projectionDelegate=delegate},setOpenGLView:null,setProjection:null,setViewport:null,getOpenGLView:null,getProjection:null,setAlphaBlending:null,isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},getAnimationInterval:function(){return this._animationInterval},isDisplayStats:function(){return!!cc.profiler&&cc.profiler.isShowingStats()},setDisplayStats:function(displayStats){cc.profiler&&(displayStats?cc.profiler.showStats():cc.profiler.hideStats())},getSecondsPerFrame:function(){return this._secondsPerFrame},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},popToRootScene:function(){this.popToSceneStackLevel(1)},popToSceneStackLevel:function(level){cc.assert(this._runningScene,cc._LogInfos.Director_popToSceneStackLevel_2);var locScenesStack=this._scenesStack,c=locScenesStack.length;if(0!==level){if(!(c<=level)){for(;level<c;){var current=locScenesStack.pop();current.running&&(current._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),current._performRecursive(cc.Node._stateCallbackType.onExit)),current._performRecursive(cc.Node._stateCallbackType.cleanup),c--}this._nextScene=locScenesStack[locScenesStack.length-1],this._sendCleanupToScene=!0}}else this.end()},getScheduler:function(){return this._scheduler},setScheduler:function(scheduler){this._scheduler!==scheduler&&(this._scheduler=scheduler)},getActionManager:function(){return this._actionManager},setActionManager:function(actionManager){this._actionManager!==actionManager&&(this._actionManager=actionManager)},getDeltaTime:function(){return this._deltaTime},_calculateMPF:function(){var now=Date.now();this._secondsPerFrame=(now-this._lastUpdate)/1e3}}),cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed",cc.Director.EVENT_AFTER_UPDATE="director_after_update",cc.Director.EVENT_AFTER_VISIT="director_after_visit",cc.Director.EVENT_AFTER_DRAW="director_after_draw",cc.DisplayLinkDirector=cc.Director.extend({invalid:!1,startAnimation:function(){this._nextDeltaTimeZero=!0,this.invalid=!1},mainLoop:function(){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):this.invalid?this.invalid&&(this._is_pause=!0):(this._is_pause=!1,this.drawScene())},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(value){this._animationInterval=value,this.invalid||(this.stopAnimation(),this.startAnimation())}}),cc.Director.sharedDirector=null,cc.Director.firstUseDirector=!0,cc.Director._getInstance=function(){return cc.Director.firstUseDirector&&(cc.Director.firstUseDirector=!1,cc.Director.sharedDirector=new cc.DisplayLinkDirector,cc.Director.sharedDirector.init()),cc.Director.sharedDirector},cc.defaultFPS=60,cc.Director.PROJECTION_2D=0,cc.Director.PROJECTION_3D=1,cc.Director.PROJECTION_CUSTOM=3,cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_2D,cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var _p=cc.Director.prototype;_p.getProjection=function(projection){return this._projection},_p.setProjection=function(projection){this._projection=projection,cc.eventManager.dispatchEvent(this._eventProjectionChanged)},_p.setDepthTest=function(){},_p.setClearColor=function(clearColor){cc.renderer._clearColor=clearColor,cc.renderer._clearFillStyle="rgb("+clearColor.r+","+clearColor.g+","+clearColor.b+")"},_p.setOpenGLView=function(openGLView){this._winSizeInPoints.width=cc._canvas.width,this._winSizeInPoints.height=cc._canvas.height,this._openGLView=openGLView||cc.view,cc.eventManager&&cc.eventManager.setEnabled(!0)},_p.getVisibleSize=function(){return this.getWinSize()},_p.getVisibleOrigin=function(){return cc.p(0,0)}}else cc.Director._fpsImage=new Image,cc.Director._fpsImage.addEventListener("load",function(){cc.Director._fpsImageLoaded=!0}),cc._fpsImage&&(cc.Director._fpsImage.src=cc._fpsImage)}),cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.DirectorDelegate=cc.Class.extend({updateProjection:function(){}});var _p=cc.Director.prototype,recursiveChild=function(node){if(node&&node._renderCmd){node._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);var i,children=node._children;for(i=0;i<children.length;i++)recursiveChild(children[i])}};cc.eventManager.addCustomListener(cc.Director.EVENT_PROJECTION_CHANGED,function(){cc.director;for(var stack=cc.director._scenesStack,i=0;i<stack.length;i++)recursiveChild(stack[i])}),_p.setProjection=function(projection){var _t=this,size=_t._winSizeInPoints;_t.setViewport();var view=_t._openGLView,ox=view._viewPortRect.x/view._scaleX,oy=view._viewPortRect.y/view._scaleY;switch(projection){case cc.Director.PROJECTION_2D:cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity();var orthoMatrix=cc.math.Matrix4.createOrthographicProjection(0,size.width,0,size.height,-1024,1024);cc.kmGLMultMatrix(orthoMatrix),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity();break;case cc.Director.PROJECTION_3D:var zeye=_t.getZEye(),matrixPerspective=new cc.math.Matrix4,matrixLookup=new cc.math.Matrix4;cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity(),matrixPerspective=cc.math.Matrix4.createPerspectiveProjection(60,size.width/size.height,.1,2*zeye),cc.kmGLMultMatrix(matrixPerspective);var eye=new cc.math.Vec3(-ox+size.width/2,-oy+size.height/2,zeye),center=new cc.math.Vec3(-ox+size.width/2,-oy+size.height/2,0),up=new cc.math.Vec3(0,1,0);matrixLookup.lookAt(eye,center,up),cc.kmGLMultMatrix(matrixLookup),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity();break;case cc.Director.PROJECTION_CUSTOM:_t._projectionDelegate&&_t._projectionDelegate.updateProjection();break;default:cc.log(cc._LogInfos.Director_setProjection)}_t._projection=projection,cc.eventManager.dispatchEvent(_t._eventProjectionChanged),cc.setProjectionMatrixDirty(),cc.renderer.childrenOrderDirty=!0},_p.setDepthTest=function(on){cc.renderer.setDepthTest(on)},_p.setClearColor=function(clearColor){cc.renderer._clearColor=clearColor},_p.setOpenGLView=function(openGLView){this._winSizeInPoints.width=cc._canvas.width,this._winSizeInPoints.height=cc._canvas.height,this._openGLView=openGLView||cc.view;var conf=cc.configuration;conf.gatherGPUInfo(),conf.dumpInfo(),this.setGLDefaultValues(),cc.eventManager&&cc.eventManager.setEnabled(!0)},_p.getVisibleSize=function(){return this._openGLView.getVisibleSize()},_p.getVisibleOrigin=function(){return this._openGLView.getVisibleOrigin()},_p.getZEye=function(){return this._winSizeInPoints.height/1.1546999375},_p.setViewport=function(){var view=this._openGLView;if(view){var locWinSizeInPoints=this._winSizeInPoints;view.setViewPortInPoints(-view._viewPortRect.x/view._scaleX,-view._viewPortRect.y/view._scaleY,locWinSizeInPoints.width,locWinSizeInPoints.height)}},_p.getOpenGLView=function(){return this._openGLView},_p.getProjection=function(){return this._projection},_p.setAlphaBlending=function(on){on?cc.glBlendFunc(cc.BLEND_SRC,cc.BLEND_DST):cc.glBlendFunc(cc._renderContext.ONE,cc._renderContext.ZERO)},_p.setGLDefaultValues=function(){this.setAlphaBlending(!0),this.setProjection(this._projection),cc._renderContext.clearColor(0,0,0,0)}}}),function(){var ListEntry=function(prev,next,callback,target,priority,paused,markedForDeletion){this.prev=prev,this.next=next,this.callback=callback,this.target=target,this.priority=priority,this.paused=paused,this.markedForDeletion=markedForDeletion},_listEntries=[];ListEntry.get=function(prev,next,callback,target,priority,paused,markedForDeletion){var result=_listEntries.pop();return result?(result.prev=prev,result.next=next,result.callback=callback,result.target=target,result.priority=priority,result.paused=paused,result.markedForDeletion=markedForDeletion):result=new ListEntry(prev,next,callback,target,priority,paused,markedForDeletion),result},ListEntry.put=function(entry){entry.prev=null,entry.next=null,entry.callback=null,entry.target=null,entry.priority=0,entry.paused=!1,entry.markedForDeletion=!1,_listEntries.length<20&&_listEntries.push(entry)};var HashUpdateEntry=function(list,entry,target,callback){this.list=list,this.entry=entry,this.target=target,this.callback=callback},_hashUpdateEntries=[];HashUpdateEntry.get=function(list,entry,target,callback){var result=_hashUpdateEntries.pop();return result?(result.list=list,result.entry=entry,result.target=target,result.callback=callback):result=new HashUpdateEntry(list,entry,target,callback),result},HashUpdateEntry.put=function(entry){entry.list=null,entry.entry=null,entry.target=null,entry.callback=null,_hashUpdateEntries.length<20&&_hashUpdateEntries.push(entry)};var HashTimerEntry=function(timers,target,timerIndex,currentTimer,currentTimerSalvaged,paused){var _t=this;_t.timers=timers,_t.target=target,_t.timerIndex=timerIndex,_t.currentTimer=currentTimer,_t.currentTimerSalvaged=currentTimerSalvaged,_t.paused=paused},_hashTimerEntries=[];HashTimerEntry.get=function(timers,target,timerIndex,currentTimer,currentTimerSalvaged,paused){var result=_hashTimerEntries.pop();return result?(result.timers=timers,result.target=target,result.timerIndex=timerIndex,result.currentTimer=currentTimer,result.currentTimerSalvaged=currentTimerSalvaged,result.paused=paused):result=new HashTimerEntry(timers,target,timerIndex,currentTimer,currentTimerSalvaged,paused),result},HashTimerEntry.put=function(entry){entry.timers=null,entry.target=null,entry.timerIndex=0,entry.currentTimer=null,entry.currentTimerSalvaged=!1,entry.paused=!1,_hashTimerEntries.length<20&&_hashTimerEntries.push(entry)};var CallbackTimer=function(){this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null,this._key=null};cc.inject({initWithCallback:function(scheduler,callback,target,seconds,repeat,delay,key){return this._scheduler=scheduler,this._target=target,this._callback=callback,key&&(this._key=key),this._elapsed=-1,this._interval=seconds,this._delay=delay,this._useDelay=0<this._delay,this._repeat=repeat,this._runForever=this._repeat===cc.REPEAT_FOREVER,!0},getInterval:function(){return this._interval},setInterval:function(interval){this._interval=interval},update:function(dt){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=dt,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},getCallback:function(){return this._callback},getKey:function(){return this._key},trigger:function(){this._target&&this._callback&&this._callback.call(this._target,this._elapsed)},cancel:function(){this._scheduler.unschedule(this._callback,this._target)}},CallbackTimer.prototype);var _timers=[];CallbackTimer.get=function(){return _timers.pop()||new CallbackTimer},CallbackTimer.put=function(timer){timer._scheduler=null,timer._elapsed=-1,timer._runForever=!1,timer._useDelay=!1,timer._timesExecuted=0,timer._repeat=0,timer._delay=0,timer._interval=0,timer._target=null,timer._callback=null,timer._key=null,_timers.length<20&&_timers.push(timer)},cc.Scheduler=cc.Class.extend({_timeScale:1,_updatesNegList:null,_updates0List:null,_updatesPosList:null,_hashForTimers:null,_arrayForTimers:null,_hashForUpdates:null,_currentTarget:null,_currentTargetSalvaged:!1,_updateHashLocked:!1,ctor:function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates={},this._hashForTimers={},this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1,this._arrayForTimers=[]},_schedulePerFrame:function(callback,target,priority,paused){var hashElement=this._hashForUpdates[target.__instanceId];if(hashElement&&hashElement.entry){if(hashElement.entry.priority===priority)return hashElement.entry.markedForDeletion=!1,void(hashElement.entry.paused=paused);if(this._updateHashLocked)return cc.log("warning: you CANNOT change update priority in scheduled function"),hashElement.entry.markedForDeletion=!1,void(hashElement.entry.paused=paused);this.unscheduleUpdate(target)}0===priority?this._appendIn(this._updates0List,callback,target,paused):priority<0?this._priorityIn(this._updatesNegList,callback,target,priority,paused):this._priorityIn(this._updatesPosList,callback,target,priority,paused)},_removeHashElement:function(element){delete this._hashForTimers[element.target.__instanceId];for(var arr=this._arrayForTimers,i=0,l=arr.length;i<l;i++)if(arr[i]===element){arr.splice(i,1);break}HashTimerEntry.put(element)},_removeUpdateFromHash:function(entry){if(element=this._hashForUpdates[entry.target.__instanceId],element){for(var list=element.list,listEntry=element.entry,i=0,l=list.length;i<l;i++)if(list[i]===listEntry){list.splice(i,1);break}delete this._hashForUpdates[element.target.__instanceId],ListEntry.put(listEntry),HashUpdateEntry.put(element)}},_priorityIn:function(ppList,callback,target,priority,paused){var listElement=ListEntry.get(null,null,callback,target,priority,paused,!1);if(ppList){for(var index2Insert=ppList.length-1,i=0;i<=index2Insert;i++)if(priority<ppList[i].priority){index2Insert=i;break}ppList.splice(i,0,listElement)}else(ppList=[]).push(listElement);return this._hashForUpdates[target.__instanceId]=HashUpdateEntry.get(ppList,listElement,target,null),ppList},_appendIn:function(ppList,callback,target,paused){var listElement=ListEntry.get(null,null,callback,target,0,paused,!1);ppList.push(listElement),this._hashForUpdates[target.__instanceId]=HashUpdateEntry.get(ppList,listElement,target,null,null)},setTimeScale:function(timeScale){this._timeScale=timeScale},getTimeScale:function(){return this._timeScale},update:function(dt){var i,list,len,entry;for(this._updateHashLocked=!0,1!==this._timeScale&&(dt*=this._timeScale),i=0,len=(list=this._updatesNegList).length;i<len;i++)(entry=list[i]).paused||entry.markedForDeletion||entry.callback(dt);for(i=0,len=(list=this._updates0List).length;i<len;i++)(entry=list[i]).paused||entry.markedForDeletion||entry.callback(dt);for(i=0,len=(list=this._updatesPosList).length;i<len;i++)(entry=list[i]).paused||entry.markedForDeletion||entry.callback(dt);var elt,arr=this._arrayForTimers;for(i=0;i<arr.length;i++){if(elt=arr[i],this._currentTarget=elt,this._currentTargetSalvaged=!1,!elt.paused)for(elt.timerIndex=0;elt.timerIndex<elt.timers.length;++elt.timerIndex)elt.currentTimer=elt.timers[elt.timerIndex],elt.currentTimerSalvaged=!1,elt.currentTimer.update(dt),elt.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&this._removeHashElement(this._currentTarget)}for(i=0,list=this._updatesNegList;i<list.length;)(entry=list[i]).markedForDeletion?this._removeUpdateFromHash(entry):i++;for(i=0,list=this._updates0List;i<list.length;)(entry=list[i]).markedForDeletion?this._removeUpdateFromHash(entry):i++;for(i=0,list=this._updatesPosList;i<list.length;)(entry=list[i]).markedForDeletion?this._removeUpdateFromHash(entry):i++;this._updateHashLocked=!1,this._currentTarget=null},scheduleCallbackForTarget:function(target,callback_fn,interval,repeat,delay,paused){this.schedule(callback_fn,target,interval,repeat,delay,paused,target.__instanceId+"")},schedule:function(callback,target,interval,repeat,delay,paused,key){if("function"!=typeof callback){var tmp=callback;callback=target,target=tmp,!0}4!==arguments.length&&5!==arguments.length||(key=delay,paused=repeat,repeat=cc.REPEAT_FOREVER,delay=0),void 0===key&&(key=target.__instanceId+""),cc.assert(target,cc._LogInfos.Scheduler_scheduleCallbackForTarget_3);var timer,i,element=this._hashForTimers[target.__instanceId];if(element?cc.assert(element.paused===paused,""):(element=HashTimerEntry.get(null,target,0,null,null,paused),this._arrayForTimers.push(element),this._hashForTimers[target.__instanceId]=element),null==element.timers)element.timers=[];else for(i=0;i<element.timers.length;i++)if(callback===(timer=element.timers[i])._callback)return cc.log(cc._LogInfos.Scheduler_scheduleCallbackForTarget,timer.getInterval().toFixed(4),interval.toFixed(4)),void(timer._interval=interval);(timer=CallbackTimer.get()).initWithCallback(this,callback,target,interval,repeat,delay,key),element.timers.push(timer)},scheduleUpdate:function(target,priority,paused){this._schedulePerFrame(function(dt){target.update(dt)},target,priority,paused)},_getUnscheduleMark:function(key,timer){switch(typeof key){case"number":case"string":return key===timer._key;case"function":return key===timer._callback}},unschedule:function(key,target){if(target&&key){var element=this._hashForTimers[target.__instanceId];if(element)for(var timers=element.timers,i=0,li=timers.length;i<li;i++){var timer=timers[i];if(this._getUnscheduleMark(key,timer))return timer!==element.currentTimer||element.currentTimerSalvaged||(element.currentTimerSalvaged=!0),timers.splice(i,1),CallbackTimer.put(timer),element.timerIndex>=i&&element.timerIndex--,void(0===timers.length&&(this._currentTarget===element?this._currentTargetSalvaged=!0:this._removeHashElement(element)))}}},unscheduleUpdate:function(target){if(target){var element=this._hashForUpdates[target.__instanceId];element&&(this._updateHashLocked?element.entry.markedForDeletion=!0:this._removeUpdateFromHash(element.entry))}},unscheduleAllForTarget:function(target){if(target){var element=this._hashForTimers[target.__instanceId];if(element){var timers=element.timers;-1<timers.indexOf(element.currentTimer)&&!element.currentTimerSalvaged&&(element.currentTimerSalvaged=!0);for(var i=0,l=timers.length;i<l;i++)CallbackTimer.put(timers[i]);timers.length=0,this._currentTarget===element?this._currentTargetSalvaged=!0:this._removeHashElement(element)}this.unscheduleUpdate(target)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(minPriority){var i,element,entry,arr=this._arrayForTimers;for(i=arr.length-1;0<=i;i--)element=arr[i],this.unscheduleAllForTarget(element.target);var temp_length=0;if(minPriority<0)for(i=0;i<this._updatesNegList.length;)temp_length=this._updatesNegList.length,(entry=this._updatesNegList[i])&&entry.priority>=minPriority&&this.unscheduleUpdate(entry.target),temp_length==this._updatesNegList.length&&i++;if(minPriority<=0)for(i=0;i<this._updates0List.length;)temp_length=this._updates0List.length,(entry=this._updates0List[i])&&this.unscheduleUpdate(entry.target),temp_length==this._updates0List.length&&i++;for(i=0;i<this._updatesPosList.length;)temp_length=this._updatesPosList.length,(entry=this._updatesPosList[i])&&entry.priority>=minPriority&&this.unscheduleUpdate(entry.target),temp_length==this._updatesPosList.length&&i++},isScheduled:function(callback,target){cc.assert(callback,"Argument callback must not be empty"),cc.assert(target,"Argument target must be non-nullptr");var element=this._hashForTimers[target.__instanceId];if(!element)return!1;if(null==element.timers)return!1;for(var timers=element.timers,i=0;i<timers.length;++i){if(callback===timers[i]._callback)return!0}return!1},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(minPriority){var element,i,li,entry,idsWithSelectors=[],locArrayForTimers=this._arrayForTimers;for(i=0,li=locArrayForTimers.length;i<li;i++)(element=locArrayForTimers[i])&&(element.paused=!0,idsWithSelectors.push(element.target));if(minPriority<0)for(i=0;i<this._updatesNegList.length;i++)(entry=this._updatesNegList[i])&&entry.priority>=minPriority&&(entry.paused=!0,idsWithSelectors.push(entry.target));if(minPriority<=0)for(i=0;i<this._updates0List.length;i++)(entry=this._updates0List[i])&&(entry.paused=!0,idsWithSelectors.push(entry.target));for(i=0;i<this._updatesPosList.length;i++)(entry=this._updatesPosList[i])&&entry.priority>=minPriority&&(entry.paused=!0,idsWithSelectors.push(entry.target));return idsWithSelectors},resumeTargets:function(targetsToResume){if(targetsToResume)for(var i=0;i<targetsToResume.length;i++)this.resumeTarget(targetsToResume[i])},pauseTarget:function(target){cc.assert(target,cc._LogInfos.Scheduler_pauseTarget);var element=this._hashForTimers[target.__instanceId];element&&(element.paused=!0);var elementUpdate=this._hashForUpdates[target.__instanceId];elementUpdate&&(elementUpdate.entry.paused=!0)},resumeTarget:function(target){cc.assert(target,cc._LogInfos.Scheduler_resumeTarget);var element=this._hashForTimers[target.__instanceId];element&&(element.paused=!1);var elementUpdate=this._hashForUpdates[target.__instanceId];elementUpdate&&(elementUpdate.entry.paused=!1)},isTargetPaused:function(target){cc.assert(target,cc._LogInfos.Scheduler_isTargetPaused);var element=this._hashForTimers[target.__instanceId];if(element)return element.paused;var elementUpdate=this._hashForUpdates[target.__instanceId];return!!elementUpdate&&elementUpdate.entry.paused},scheduleUpdateForTarget:function(target,priority,paused){this.scheduleUpdate(target,priority,paused)},unscheduleCallbackForTarget:function(target,callback){this.unschedule(callback,target)},unscheduleUpdateForTarget:function(target){this.unscheduleUpdate(target)},unscheduleAllCallbacksForTarget:function(target){this.unschedule(target.__instanceId+"",target)},unscheduleAllCallbacks:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllCallbacksWithMinPriority:function(minPriority){this.unscheduleAllWithMinPriority(minPriority)}}),cc.Scheduler.PRIORITY_SYSTEM=-2147483648,cc.Scheduler.PRIORITY_NON_SYSTEM=cc.Scheduler.PRIORITY_SYSTEM+1}(),cc.PI2=2*Math.PI,cc.DrawingPrimitiveCanvas=cc.Class.extend({_cacheArray:[],_renderContext:null,ctor:function(renderContext){this._renderContext=renderContext},drawPoint:function(point,size){size||(size=1);var locScaleX=cc.view.getScaleX(),locScaleY=cc.view.getScaleY(),newPoint=cc.p(point.x*locScaleX,point.y*locScaleY),ctx=this._renderContext.getContext();ctx.beginPath(),ctx.arc(newPoint.x,-newPoint.y,size*locScaleX,0,2*Math.PI,!1),ctx.closePath(),ctx.fill()},drawPoints:function(points,numberOfPoints,size){if(null!=points){size||(size=1);var locContext=this._renderContext.getContext(),locScaleX=cc.view.getScaleX(),locScaleY=cc.view.getScaleY();locContext.beginPath();for(var i=0,len=points.length;i<len;i++)locContext.arc(points[i].x*locScaleX,-points[i].y*locScaleY,size*locScaleX,0,2*Math.PI,!1);locContext.closePath(),locContext.fill()}},drawLine:function(origin,destination){var locContext=this._renderContext.getContext();cc.view.getScaleX(),cc.view.getScaleY();locContext.beginPath(),locContext.moveTo(origin.x,-origin.y),locContext.lineTo(destination.x,-destination.y),locContext.closePath(),locContext.stroke()},drawRect:function(origin,destination){this.drawLine(cc.p(origin.x,origin.y),cc.p(destination.x,origin.y)),this.drawLine(cc.p(destination.x,origin.y),cc.p(destination.x,destination.y)),this.drawLine(cc.p(destination.x,destination.y),cc.p(origin.x,destination.y)),this.drawLine(cc.p(origin.x,destination.y),cc.p(origin.x,origin.y))},drawSolidRect:function(origin,destination,color){var vertices=[origin,cc.p(destination.x,origin.y),destination,cc.p(origin.x,destination.y)];this.drawSolidPoly(vertices,4,color)},drawPoly:function(vertices,numOfVertices,closePolygon,fill){if(fill=fill||!1,null!=vertices){if(vertices.length<3)throw new Error("Polygon's point must greater than 2");var firstPoint=vertices[0],locContext=this._renderContext.getContext();cc.view.getScaleX(),cc.view.getScaleY();locContext.beginPath(),locContext.moveTo(firstPoint.x,-firstPoint.y);for(var i=1,len=vertices.length;i<len;i++)locContext.lineTo(vertices[i].x,-vertices[i].y);closePolygon&&locContext.closePath(),fill?locContext.fill():locContext.stroke()}},drawSolidPoly:function(polygons,numberOfPoints,color){this.setDrawColor(color.r,color.g,color.b,color.a),this.drawPoly(polygons,numberOfPoints,!0,!0)},drawCircle:function(center,radius,angle,segments,drawLineToCenter){drawLineToCenter=drawLineToCenter||!1;var locContext=this._renderContext.getContext();cc.view.getScaleX(),cc.view.getScaleY();locContext.beginPath();var endAngle=angle-2*Math.PI;locContext.arc(0|center.x,0|-center.y,radius,-angle,-endAngle,!1),drawLineToCenter&&locContext.lineTo(0|center.x,0|-center.y),locContext.stroke()},drawQuadBezier:function(origin,control,destination,segments){for(var vertices=this._cacheArray,t=vertices.length=0,i=0;i<segments;i++){var x=Math.pow(1-t,2)*origin.x+2*(1-t)*t*control.x+t*t*destination.x,y=Math.pow(1-t,2)*origin.y+2*(1-t)*t*control.y+t*t*destination.y;vertices.push(cc.p(x,y)),t+=1/segments}vertices.push(cc.p(destination.x,destination.y)),this.drawPoly(vertices,segments+1,!1,!1)},drawCubicBezier:function(origin,control1,control2,destination,segments){for(var vertices=this._cacheArray,t=vertices.length=0,i=0;i<segments;i++){var x=Math.pow(1-t,3)*origin.x+3*Math.pow(1-t,2)*t*control1.x+3*(1-t)*t*t*control2.x+t*t*t*destination.x,y=Math.pow(1-t,3)*origin.y+3*Math.pow(1-t,2)*t*control1.y+3*(1-t)*t*t*control2.y+t*t*t*destination.y;vertices.push(cc.p(x,y)),t+=1/segments}vertices.push(cc.p(destination.x,destination.y)),this.drawPoly(vertices,segments+1,!1,!1)},drawCatmullRom:function(points,segments){this.drawCardinalSpline(points,.5,segments)},drawCardinalSpline:function(config,tension,segments){cc._renderContext.setStrokeStyle("rgba(255,255,255,1)");var p,lt,points=this._cacheArray;points.length=0;for(var deltaT=1/config.length,i=0;i<segments+1;i++){var dt=i/segments;lt=1===dt?(p=config.length-1,1):(dt-deltaT*(p=0|dt/deltaT))/deltaT;var newPos=cc.CardinalSplineAt(cc.getControlPointAt(config,p-1),cc.getControlPointAt(config,p-0),cc.getControlPointAt(config,p+1),cc.getControlPointAt(config,p+2),tension,lt);points.push(newPos)}this.drawPoly(points,segments+1,!1,!1)},drawImage:function(image,sourcePoint,sourceSize,destPoint,destSize){var len=arguments.length,ctx=this._renderContext.getContext();switch(len){case 2:var height=image.height;ctx.drawImage(image,sourcePoint.x,-(sourcePoint.y+height));break;case 3:ctx.drawImage(image,sourcePoint.x,-(sourcePoint.y+sourceSize.height),sourceSize.width,sourceSize.height);break;case 5:ctx.drawImage(image,sourcePoint.x,sourcePoint.y,sourceSize.width,sourceSize.height,destPoint.x,-(destPoint.y+destSize.height),destSize.width,destSize.height);break;default:throw new Error("Argument must be non-nil")}},drawStar:function(ctx,radius,color){var wrapper=ctx||this._renderContext,context=wrapper.getContext(),colorStr="rgba("+(0|color.r)+","+(0|color.g)+","+(0|color.b);wrapper.setFillStyle(colorStr+",1)");var subRadius=radius/10;context.beginPath(),context.moveTo(-radius,radius),context.lineTo(0,subRadius),context.lineTo(radius,radius),context.lineTo(subRadius,0),context.lineTo(radius,-radius),context.lineTo(0,-subRadius),context.lineTo(-radius,-radius),context.lineTo(-subRadius,0),context.lineTo(-radius,radius),context.closePath(),context.fill();var rg=context.createRadialGradient(0,0,subRadius,0,0,radius);rg.addColorStop(0,colorStr+", 1)"),rg.addColorStop(.3,colorStr+", 0.8)"),rg.addColorStop(1,colorStr+", 0.0)"),wrapper.setFillStyle(rg),context.beginPath();var endAngle_1=cc.PI2;context.arc(0,0,radius-subRadius,0,endAngle_1,!1),context.closePath(),context.fill()},drawColorBall:function(ctx,radius,color){var wrapper=ctx||this._renderContext,context=wrapper.getContext();radius*=cc.view.getScaleX();var colorStr="rgba("+(0|color.r)+","+(0|color.g)+","+(0|color.b),subRadius=radius/10,g1=context.createRadialGradient(0,0,subRadius,0,0,radius);g1.addColorStop(0,colorStr+", 1)"),g1.addColorStop(.3,colorStr+", 0.8)"),g1.addColorStop(.6,colorStr+", 0.4)"),g1.addColorStop(1,colorStr+", 0.0)"),wrapper.setFillStyle(g1),context.beginPath();var endAngle_1=cc.PI2;context.arc(0,0,radius,0,endAngle_1,!1),context.closePath(),context.fill()},fillText:function(strText,x,y){this._renderContext.getContext().fillText(strText,x,-y)},setDrawColor:function(r,g,b,a){this._renderContext.setFillStyle("rgba("+r+","+g+","+b+","+a/255+")"),this._renderContext.setStrokeStyle("rgba("+r+","+g+","+b+","+a/255+")")},setPointSize:function(pointSize){},setLineWidth:function(width){this._renderContext.getContext().lineWidth=width*cc.view.getScaleX()}}),cc.DrawingPrimitiveWebGL=cc.Class.extend({_renderContext:null,_initialized:!1,_shader:null,_colorLocation:"u_color",_colorArray:null,_pointSizeLocation:"u_pointSize",_pointSize:-1,ctor:function(ctx){if(null==ctx&&(ctx=cc._renderContext),!ctx instanceof WebGLRenderingContext)throw new Error("Can't initialise DrawingPrimitiveWebGL. context need is WebGLRenderingContext");this._renderContext=ctx,this._colorArray=new Float32Array([1,1,1,1])},lazy_init:function(){var _t=this;_t._initialized||(_t._shader=cc.shaderCache.programForKey(cc.SHADER_POSITION_UCOLOR),_t._shader._addUniformLocation(this._colorLocation),_t._shader._addUniformLocation(this._pointSizeLocation),_t._initialized=!0)},drawInit:function(){this._initialized=!1},drawPoint:function(point){this.lazy_init();var glContext=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),glContext.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var pointBuffer=glContext.createBuffer();glContext.bindBuffer(glContext.ARRAY_BUFFER,pointBuffer),glContext.bufferData(glContext.ARRAY_BUFFER,new Float32Array([point.x,point.y]),glContext.STATIC_DRAW),glContext.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,glContext.FLOAT,!1,0,0),glContext.drawArrays(glContext.POINTS,0,1),glContext.deleteBuffer(pointBuffer),cc.incrementGLDraws(1)},drawPoints:function(points,numberOfPoints){if(points&&0!==points.length){this.lazy_init();var glContext=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),glContext.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var pointBuffer=glContext.createBuffer();glContext.bindBuffer(glContext.ARRAY_BUFFER,pointBuffer),glContext.bufferData(glContext.ARRAY_BUFFER,this._pointsToTypeArray(points),glContext.STATIC_DRAW),glContext.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,glContext.FLOAT,!1,0,0),glContext.drawArrays(glContext.POINTS,0,points.length),glContext.deleteBuffer(pointBuffer),cc.incrementGLDraws(1)}},_pointsToTypeArray:function(points){for(var typeArr=new Float32Array(2*points.length),i=0;i<points.length;i++)typeArr[2*i]=points[i].x,typeArr[2*i+1]=points[i].y;return typeArr},drawLine:function(origin,destination){this.lazy_init();var glContext=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),glContext.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var pointBuffer=glContext.createBuffer();glContext.bindBuffer(glContext.ARRAY_BUFFER,pointBuffer),glContext.bufferData(glContext.ARRAY_BUFFER,this._pointsToTypeArray([origin,destination]),glContext.STATIC_DRAW),glContext.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,glContext.FLOAT,!1,0,0),glContext.drawArrays(glContext.LINES,0,2),glContext.deleteBuffer(pointBuffer),cc.incrementGLDraws(1)},drawRect:function(origin,destination){this.drawLine(cc.p(origin.x,origin.y),cc.p(destination.x,origin.y)),this.drawLine(cc.p(destination.x,origin.y),cc.p(destination.x,destination.y)),this.drawLine(cc.p(destination.x,destination.y),cc.p(origin.x,destination.y)),this.drawLine(cc.p(origin.x,destination.y),cc.p(origin.x,origin.y))},drawSolidRect:function(origin,destination,color){var vertices=[origin,cc.p(destination.x,origin.y),destination,cc.p(origin.x,destination.y)];this.drawSolidPoly(vertices,4,color)},drawPoly:function(vertices,numOfVertices,closePolygon){this.lazy_init();var glContext=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),glContext.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var pointBuffer=glContext.createBuffer();glContext.bindBuffer(glContext.ARRAY_BUFFER,pointBuffer),glContext.bufferData(glContext.ARRAY_BUFFER,this._pointsToTypeArray(vertices),glContext.STATIC_DRAW),glContext.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,glContext.FLOAT,!1,0,0),closePolygon?glContext.drawArrays(glContext.LINE_LOOP,0,vertices.length):glContext.drawArrays(glContext.LINE_STRIP,0,vertices.length),glContext.deleteBuffer(pointBuffer),cc.incrementGLDraws(1)},drawSolidPoly:function(poli,numberOfPoints,color){this.lazy_init(),color&&this.setDrawColor(color.r,color.g,color.b,color.a);var glContext=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),glContext.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var pointBuffer=glContext.createBuffer();glContext.bindBuffer(glContext.ARRAY_BUFFER,pointBuffer),glContext.bufferData(glContext.ARRAY_BUFFER,this._pointsToTypeArray(poli),glContext.STATIC_DRAW),glContext.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,glContext.FLOAT,!1,0,0),glContext.drawArrays(glContext.TRIANGLE_FAN,0,poli.length),glContext.deleteBuffer(pointBuffer),cc.incrementGLDraws(1)},drawCircle:function(center,radius,angle,segments,drawLineToCenter){this.lazy_init();var additionalSegment=1;drawLineToCenter&&additionalSegment++;var coef=2*Math.PI/segments,vertices=new Float32Array(2*(segments+2));if(vertices){for(var i=0;i<=segments;i++){var rads=i*coef,j=radius*Math.cos(rads+angle)+center.x,k=radius*Math.sin(rads+angle)+center.y;vertices[2*i]=j,vertices[2*i+1]=k}vertices[2*(segments+1)]=center.x,vertices[2*(segments+1)+1]=center.y;var glContext=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),glContext.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var pointBuffer=glContext.createBuffer();glContext.bindBuffer(glContext.ARRAY_BUFFER,pointBuffer),glContext.bufferData(glContext.ARRAY_BUFFER,vertices,glContext.STATIC_DRAW),glContext.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,glContext.FLOAT,!1,0,0),glContext.drawArrays(glContext.LINE_STRIP,0,segments+additionalSegment),glContext.deleteBuffer(pointBuffer),cc.incrementGLDraws(1)}},drawQuadBezier:function(origin,control,destination,segments){this.lazy_init();for(var vertices=new Float32Array(2*(segments+1)),t=0,i=0;i<segments;i++)vertices[2*i]=Math.pow(1-t,2)*origin.x+2*(1-t)*t*control.x+t*t*destination.x,vertices[2*i+1]=Math.pow(1-t,2)*origin.y+2*(1-t)*t*control.y+t*t*destination.y,t+=1/segments;vertices[2*segments]=destination.x,vertices[2*segments+1]=destination.y;var glContext=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),glContext.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var pointBuffer=glContext.createBuffer();glContext.bindBuffer(glContext.ARRAY_BUFFER,pointBuffer),glContext.bufferData(glContext.ARRAY_BUFFER,vertices,glContext.STATIC_DRAW),glContext.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,glContext.FLOAT,!1,0,0),glContext.drawArrays(glContext.LINE_STRIP,0,segments+1),glContext.deleteBuffer(pointBuffer),cc.incrementGLDraws(1)},drawCubicBezier:function(origin,control1,control2,destination,segments){this.lazy_init();for(var vertices=new Float32Array(2*(segments+1)),t=0,i=0;i<segments;i++)vertices[2*i]=Math.pow(1-t,3)*origin.x+3*Math.pow(1-t,2)*t*control1.x+3*(1-t)*t*t*control2.x+t*t*t*destination.x,vertices[2*i+1]=Math.pow(1-t,3)*origin.y+3*Math.pow(1-t,2)*t*control1.y+3*(1-t)*t*t*control2.y+t*t*t*destination.y,t+=1/segments;vertices[2*segments]=destination.x,vertices[2*segments+1]=destination.y;var glContext=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),glContext.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var pointBuffer=glContext.createBuffer();glContext.bindBuffer(glContext.ARRAY_BUFFER,pointBuffer),glContext.bufferData(glContext.ARRAY_BUFFER,vertices,glContext.STATIC_DRAW),glContext.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,glContext.FLOAT,!1,0,0),glContext.drawArrays(glContext.LINE_STRIP,0,segments+1),glContext.deleteBuffer(pointBuffer),cc.incrementGLDraws(1)},drawCatmullRom:function(points,segments){this.drawCardinalSpline(points,.5,segments)},drawCardinalSpline:function(config,tension,segments){this.lazy_init();for(var p,lt,vertices=new Float32Array(2*(segments+1)),deltaT=1/config.length,i=0;i<segments+1;i++){var dt=i/segments;lt=1===dt?(p=config.length-1,1):(dt-deltaT*(p=0|dt/deltaT))/deltaT;var newPos=cc.cardinalSplineAt(cc.getControlPointAt(config,p-1),cc.getControlPointAt(config,p),cc.getControlPointAt(config,p+1),cc.getControlPointAt(config,p+2),tension,lt);vertices[2*i]=newPos.x,vertices[2*i+1]=newPos.y}var glContext=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),glContext.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var pointBuffer=glContext.createBuffer();glContext.bindBuffer(glContext.ARRAY_BUFFER,pointBuffer),glContext.bufferData(glContext.ARRAY_BUFFER,vertices,glContext.STATIC_DRAW),glContext.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,glContext.FLOAT,!1,0,0),glContext.drawArrays(glContext.LINE_STRIP,0,segments+1),glContext.deleteBuffer(pointBuffer),cc.incrementGLDraws(1)},setDrawColor:function(r,g,b,a){this._colorArray[0]=r/255,this._colorArray[1]=g/255,this._colorArray[2]=b/255,this._colorArray[3]=a/255},setPointSize:function(pointSize){this._pointSize=pointSize*cc.contentScaleFactor()},setLineWidth:function(width){this._renderContext.lineWidth&&this._renderContext.lineWidth(width)}}),cc._tmp.PrototypeLabelTTF=function(){var _p=cc.LabelTTF.prototype;cc.defineGetterSetter(_p,"color",_p.getColor,_p.setColor),cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity),_p.string,cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),_p.textAlign,cc.defineGetterSetter(_p,"textAlign",_p.getHorizontalAlignment,_p.setHorizontalAlignment),_p.verticalAlign,cc.defineGetterSetter(_p,"verticalAlign",_p.getVerticalAlignment,_p.setVerticalAlignment),_p.fontSize,cc.defineGetterSetter(_p,"fontSize",_p.getFontSize,_p.setFontSize),_p.fontName,cc.defineGetterSetter(_p,"fontName",_p.getFontName,_p.setFontName),_p.font,cc.defineGetterSetter(_p,"font",_p._getFont,_p._setFont),_p.boundingSize,_p.boundingWidth,cc.defineGetterSetter(_p,"boundingWidth",_p._getBoundingWidth,_p._setBoundingWidth),_p.boundingHeight,cc.defineGetterSetter(_p,"boundingHeight",_p._getBoundingHeight,_p._setBoundingHeight),_p.fillStyle,cc.defineGetterSetter(_p,"fillStyle",_p._getFillStyle,_p.setFontFillColor),_p.strokeStyle,cc.defineGetterSetter(_p,"strokeStyle",_p._getStrokeStyle,_p._setStrokeStyle),_p.lineWidth,cc.defineGetterSetter(_p,"lineWidth",_p._getLineWidth,_p._setLineWidth),_p.shadowOffset,_p.shadowOffsetX,cc.defineGetterSetter(_p,"shadowOffsetX",_p._getShadowOffsetX,_p._setShadowOffsetX),_p.shadowOffsetY,cc.defineGetterSetter(_p,"shadowOffsetY",_p._getShadowOffsetY,_p._setShadowOffsetY),_p.shadowOpacity,cc.defineGetterSetter(_p,"shadowOpacity",_p._getShadowOpacity,_p._setShadowOpacity),_p.shadowBlur,cc.defineGetterSetter(_p,"shadowBlur",_p._getShadowBlur,_p._setShadowBlur)},cc.LabelTTF=cc.Sprite.extend({_dimensions:null,_hAlignment:cc.TEXT_ALIGNMENT_CENTER,_vAlignment:cc.VERTICAL_TEXT_ALIGNMENT_TOP,_fontName:null,_fontSize:0,_string:"",_originalText:null,_onCacheCanvasMode:!0,_shadowEnabled:!1,_shadowOffset:null,_shadowOpacity:0,_shadowBlur:0,_shadowColor:null,_strokeEnabled:!1,_strokeColor:null,_strokeSize:0,_textFillColor:null,_strokeShadowOffsetX:0,_strokeShadowOffsetY:0,_needUpdateTexture:!1,_lineWidths:null,_className:"LabelTTF",_fontStyle:"normal",_fontWeight:"normal",_lineHeight:"normal",initWithString:function(label,fontName,fontSize,dimensions,hAlignment,vAlignment){var strInfo;return strInfo=label?label+"":"",fontSize=fontSize||16,dimensions=dimensions||cc.size(0,0),hAlignment=hAlignment||cc.TEXT_ALIGNMENT_LEFT,vAlignment=vAlignment||cc.VERTICAL_TEXT_ALIGNMENT_TOP,this._opacityModifyRGB=!1,this._dimensions=cc.size(dimensions.width,dimensions.height),this._fontName=fontName||"Arial",this._hAlignment=hAlignment,this._vAlignment=vAlignment,this._fontSize=fontSize,this._renderCmd._setFontStyle(this._fontName,fontSize,this._fontStyle,this._fontWeight),this.string=strInfo,this._renderCmd._setColorsString(),this._renderCmd._updateTexture(),this._setUpdateTextureDirty(),this._scaleX=this._scaleY=1/cc.view.getDevicePixelRatio(),!0},_setUpdateTextureDirty:function(){this._needUpdateTexture=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.textDirty)},ctor:function(text,fontName,fontSize,dimensions,hAlignment,vAlignment){cc.Sprite.prototype.ctor.call(this),this._dimensions=cc.size(0,0),this._hAlignment=cc.TEXT_ALIGNMENT_LEFT,this._vAlignment=cc.VERTICAL_TEXT_ALIGNMENT_TOP,this._opacityModifyRGB=!1,this._fontName="Arial",this._shadowEnabled=!1,this._shadowOffset=cc.p(0,0),this._shadowOpacity=0,this._shadowBlur=0,this._strokeEnabled=!1,this._strokeColor=cc.color(255,255,255,255),this._strokeSize=0,this._textFillColor=cc.color(255,255,255,255),this._strokeShadowOffsetX=0,this._strokeShadowOffsetY=0,this._needUpdateTexture=!1,this._lineWidths=[],this._renderCmd._setColorsString(),this._textureLoaded=!0,fontName&&fontName instanceof cc.FontDefinition?this.initWithStringAndTextDefinition(text,fontName):cc.LabelTTF.prototype.initWithString.call(this,text,fontName,fontSize,dimensions,hAlignment,vAlignment)},init:function(){return this.initWithString(" ",this._fontName,this._fontSize)},description:function(){return"<cc.LabelTTF | FontName ="+this._fontName+" FontSize = "+this._fontSize.toFixed(1)+">"},getLineHeight:function(){return!this._lineHeight||this._lineHeight.charAt?this._renderCmd._getFontClientHeight():this._lineHeight||this._renderCmd._getFontClientHeight()},setLineHeight:function(lineHeight){this._lineHeight=lineHeight},getString:function(){return this._string},getHorizontalAlignment:function(){return this._hAlignment},getVerticalAlignment:function(){return this._vAlignment},getDimensions:function(){return cc.size(this._dimensions)},getFontSize:function(){return this._fontSize},getFontName:function(){return this._fontName},initWithStringAndTextDefinition:function(text,textDefinition){return this._updateWithTextDefinition(textDefinition,!1),this.string=text,!0},setTextDefinition:function(theDefinition){theDefinition&&this._updateWithTextDefinition(theDefinition,!0)},getTextDefinition:function(){return this._prepareTextDefinition(!1)},enableShadow:function(a,b,c,d){null!=a.r&&null!=a.g&&null!=a.b&&null!=a.a?this._enableShadow(a,b,c):this._enableShadowNoneColor(a,b,c,d)},_enableShadowNoneColor:function(shadowOffsetX,shadowOffsetY,shadowOpacity,shadowBlur){shadowOpacity=shadowOpacity||.5,!1===this._shadowEnabled&&(this._shadowEnabled=!0);var locShadowOffset=this._shadowOffset;(locShadowOffset&&locShadowOffset.x!==shadowOffsetX||locShadowOffset._y!==shadowOffsetY)&&(locShadowOffset.x=shadowOffsetX,locShadowOffset.y=shadowOffsetY),this._shadowOpacity!==shadowOpacity&&(this._shadowOpacity=shadowOpacity),this._renderCmd._setColorsString(),this._shadowBlur!==shadowBlur&&(this._shadowBlur=shadowBlur),this._setUpdateTextureDirty()},_enableShadow:function(shadowColor,offset,blurRadius){var x,y,a,b;this._shadowColor||(this._shadowColor=cc.color(255,255,255,128)),this._shadowColor.r=shadowColor.r,this._shadowColor.g=shadowColor.g,this._shadowColor.b=shadowColor.b,x=offset.width||offset.x||0,y=offset.height||offset.y||0,a=null!=shadowColor.a?shadowColor.a/255:.5,b=blurRadius,this._enableShadowNoneColor(x,y,a,b)},_getShadowOffsetX:function(){return this._shadowOffset.x},_setShadowOffsetX:function(x){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOffset.x!==x&&(this._shadowOffset.x=x,this._setUpdateTextureDirty())},_getShadowOffsetY:function(){return this._shadowOffset._y},_setShadowOffsetY:function(y){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOffset._y!==y&&(this._shadowOffset._y=y,this._setUpdateTextureDirty())},_getShadowOffset:function(){return cc.p(this._shadowOffset.x,this._shadowOffset.y)},_setShadowOffset:function(offset){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOffset.x===offset.x&&this._shadowOffset.y===offset.y||(this._shadowOffset.x=offset.x,this._shadowOffset.y=offset.y,this._setUpdateTextureDirty())},_getShadowOpacity:function(){return this._shadowOpacity},_setShadowOpacity:function(shadowOpacity){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOpacity!==shadowOpacity&&(this._shadowOpacity=shadowOpacity,this._renderCmd._setColorsString(),this._setUpdateTextureDirty())},_getShadowBlur:function(){return this._shadowBlur},_setShadowBlur:function(shadowBlur){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowBlur!==shadowBlur&&(this._shadowBlur=shadowBlur,this._setUpdateTextureDirty())},disableShadow:function(){this._shadowEnabled&&(this._shadowEnabled=!1,this._setUpdateTextureDirty())},enableStroke:function(strokeColor,strokeSize){!1===this._strokeEnabled&&(this._strokeEnabled=!0);var locStrokeColor=this._strokeColor;locStrokeColor.r===strokeColor.r&&locStrokeColor.g===strokeColor.g&&locStrokeColor.b===strokeColor.b||(locStrokeColor.r=strokeColor.r,locStrokeColor.g=strokeColor.g,locStrokeColor.b=strokeColor.b,this._renderCmd._setColorsString()),this._strokeSize!==strokeSize&&(this._strokeSize=strokeSize||0),this._setUpdateTextureDirty()},_getStrokeStyle:function(){return this._strokeColor},_setStrokeStyle:function(strokeStyle){!1===this._strokeEnabled&&(this._strokeEnabled=!0);var locStrokeColor=this._strokeColor;locStrokeColor.r===strokeStyle.r&&locStrokeColor.g===strokeStyle.g&&locStrokeColor.b===strokeStyle.b||(locStrokeColor.r=strokeStyle.r,locStrokeColor.g=strokeStyle.g,locStrokeColor.b=strokeStyle.b,this._renderCmd._setColorsString(),this._setUpdateTextureDirty())},_getLineWidth:function(){return this._strokeSize},_setLineWidth:function(lineWidth){!1===this._strokeEnabled&&(this._strokeEnabled=!0),this._strokeSize!==lineWidth&&(this._strokeSize=lineWidth||0,this._setUpdateTextureDirty())},disableStroke:function(){this._strokeEnabled&&(this._strokeEnabled=!1,this._setUpdateTextureDirty())},setFontFillColor:function(fillColor){var locTextFillColor=this._textFillColor;locTextFillColor.r===fillColor.r&&locTextFillColor.g===fillColor.g&&locTextFillColor.b===fillColor.b||(locTextFillColor.r=fillColor.r,locTextFillColor.g=fillColor.g,locTextFillColor.b=fillColor.b,this._renderCmd._setColorsString(),this._needUpdateTexture=!0)},_getFillStyle:function(){return this._textFillColor},_updateWithTextDefinition:function(textDefinition,mustUpdateTexture){textDefinition.fontDimensions?(this._dimensions.width=textDefinition.boundingWidth,this._dimensions.height=textDefinition.boundingHeight):(this._dimensions.width=0,this._dimensions.height=0),this._hAlignment=textDefinition.textAlign,this._vAlignment=textDefinition.verticalAlign,this._fontName=textDefinition.fontName,this._fontSize=textDefinition.fontSize||12,textDefinition.lineHeight?this._lineHeight=textDefinition.lineHeight:this._lineHeight=this._fontSize,this._renderCmd._setFontStyle(textDefinition),textDefinition.shadowEnabled&&this.enableShadow(textDefinition.shadowOffsetX,textDefinition.shadowOffsetY,textDefinition.shadowOpacity,textDefinition.shadowBlur),textDefinition.strokeEnabled&&this.enableStroke(textDefinition.strokeStyle,textDefinition.lineWidth),this.setFontFillColor(textDefinition.fillStyle),mustUpdateTexture&&this._renderCmd._updateTexture();var flags=cc.Node._dirtyFlags;this._renderCmd.setDirtyFlag(flags.colorDirty|flags.opacityDirty|flags.textDirty)},_prepareTextDefinition:function(adjustForResolution){var texDef=new cc.FontDefinition;if(texDef.boundingHeight=adjustForResolution?(texDef.fontSize=this._fontSize,texDef.boundingWidth=cc.contentScaleFactor()*this._dimensions.width,cc.contentScaleFactor()*this._dimensions.height):(texDef.fontSize=this._fontSize,texDef.boundingWidth=this._dimensions.width,this._dimensions.height),texDef.fontName=this._fontName,texDef.textAlign=this._hAlignment,texDef.verticalAlign=this._vAlignment,this._strokeEnabled){texDef.strokeEnabled=!0;var locStrokeColor=this._strokeColor;texDef.strokeStyle=cc.color(locStrokeColor.r,locStrokeColor.g,locStrokeColor.b),texDef.lineWidth=this._strokeSize}else texDef.strokeEnabled=!1;this._shadowEnabled?(texDef.shadowEnabled=!0,texDef.shadowBlur=this._shadowBlur,texDef.shadowOpacity=this._shadowOpacity,texDef.shadowOffsetX=(adjustForResolution?cc.contentScaleFactor():1)*this._shadowOffset.x,texDef.shadowOffsetY=(adjustForResolution?cc.contentScaleFactor():1)*this._shadowOffset.y):texDef._shadowEnabled=!1;var locTextFillColor=this._textFillColor;return texDef.fillStyle=cc.color(locTextFillColor.r,locTextFillColor.g,locTextFillColor.b),texDef},getScale:function(){return this._scaleX!==this._scaleY&&cc.log(cc._LogInfos.Node_getScale),this._scaleX*cc.view.getDevicePixelRatio()},setScale:function(scale,scaleY){var ratio=cc.view.getDevicePixelRatio();this._scaleX=scale/ratio,this._scaleY=(scaleY||0===scaleY?scaleY:scale)/ratio,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX*cc.view.getDevicePixelRatio()},setScaleX:function(newScaleX){this._scaleX=newScaleX/cc.view.getDevicePixelRatio(),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY*cc.view.getDevicePixelRatio()},setScaleY:function(newScaleY){this._scaleY=newScaleY/cc.view.getDevicePixelRatio(),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setString:function(text){text=String(text),this._originalText!==text&&(this._originalText=text+"",this._updateString(),this._setUpdateTextureDirty(),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},_updateString:function(){this._string&&""!==this._string||this._string===this._originalText||(cc.renderer.childrenOrderDirty=!0),this._string=this._originalText},setHorizontalAlignment:function(alignment){alignment!==this._hAlignment&&(this._hAlignment=alignment,this._setUpdateTextureDirty())},setVerticalAlignment:function(verticalAlignment){verticalAlignment!==this._vAlignment&&(this._vAlignment=verticalAlignment,this._setUpdateTextureDirty())},setDimensions:function(dim,height){var width;void 0===height?(width=dim.width,height=dim.height):width=dim,width===this._dimensions.width&&height===this._dimensions.height||(this._dimensions.width=width,this._dimensions.height=height,this._updateString(),this._setUpdateTextureDirty())},_getBoundingWidth:function(){return this._dimensions.width},_setBoundingWidth:function(width){width!==this._dimensions.width&&(this._dimensions.width=width,this._updateString(),this._setUpdateTextureDirty())},_getBoundingHeight:function(){return this._dimensions.height},_setBoundingHeight:function(height){height!==this._dimensions.height&&(this._dimensions.height=height,this._updateString(),this._setUpdateTextureDirty())},setFontSize:function(fontSize){this._fontSize!==fontSize&&(this._fontSize=fontSize,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},setFontName:function(fontName){this._fontName&&this._fontName!==fontName&&(this._fontName=fontName,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFont:function(){return this._renderCmd._getFontStyle()},_setFont:function(fontStyle){var res=cc.LabelTTF._fontStyleRE.exec(fontStyle);res&&(this._fontSize=parseInt(res[1]),this._fontName=res[2],this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},getContentSize:function(){this._needUpdateTexture&&this._renderCmd._updateTTF();var ratio=cc.view.getDevicePixelRatio();return cc.size(this._contentSize.width/ratio,this._contentSize.height/ratio)},_getWidth:function(){return this._needUpdateTexture&&this._renderCmd._updateTTF(),this._contentSize.width/cc.view.getDevicePixelRatio()},_getHeight:function(){return this._needUpdateTexture&&this._renderCmd._updateTTF(),this._contentSize.height/cc.view.getDevicePixelRatio()},setTextureRect:function(rect,rotated,untrimmedSize){var _t=this;_t._rectRotated=rotated||!1,_t.setContentSize(untrimmedSize||rect),_t.setVertexRect(rect),_t._renderCmd._setTextureCoords(rect,!1);var relativeOffsetX=_t._unflippedOffsetPositionFromCenter.x,relativeOffsetY=_t._unflippedOffsetPositionFromCenter.y;_t._flippedX&&(relativeOffsetX=-relativeOffsetX),_t._flippedY&&(relativeOffsetY=-relativeOffsetY);var locRect=_t._rect;_t._offsetPosition.x=relativeOffsetX+(rect.width-locRect.width)/2,_t._offsetPosition.y=relativeOffsetY+(rect.height-locRect.height)/2},setDrawMode:function(onCacheMode){this._onCacheCanvasMode=onCacheMode},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new cc.LabelTTF.WebGLRenderCmd(this):this._onCacheCanvasMode?new cc.LabelTTF.CacheCanvasRenderCmd(this):new cc.LabelTTF.CanvasRenderCmd(this)},_setFontStyle:function(fontStyle){this._fontStyle!==fontStyle&&(this._fontStyle=fontStyle,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFontStyle:function(){return this._fontStyle},_setFontWeight:function(fontWeight){this._fontWeight!==fontWeight&&(this._fontWeight=fontWeight,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFontWeight:function(){return this._fontWeight}}),cc.assert(cc.isFunction(cc._tmp.PrototypeLabelTTF),cc._LogInfos.MissingFile,"LabelTTFPropertyDefine.js"),cc._tmp.PrototypeLabelTTF(),delete cc._tmp.PrototypeLabelTTF,cc.LabelTTF._fontStyleRE=/^(\d+)px\s+['"]?([\w\s\d]+)['"]?$/,cc.LabelTTF.create=function(text,fontName,fontSize,dimensions,hAlignment,vAlignment){return new cc.LabelTTF(text,fontName,fontSize,dimensions,hAlignment,vAlignment)},cc.LabelTTF.createWithFontDefinition=cc.LabelTTF.create,cc.LabelTTF.__labelHeightDiv=document.createElement("div"),cc.LabelTTF.__labelHeightDiv.style.fontFamily="Arial",cc.LabelTTF.__labelHeightDiv.style.position="absolute",cc.LabelTTF.__labelHeightDiv.style.left="-100px",cc.LabelTTF.__labelHeightDiv.style.top="-100px",cc.LabelTTF.__labelHeightDiv.style.lineHeight="normal",document.body?document.body.appendChild(cc.LabelTTF.__labelHeightDiv):window.addEventListener("load",function(){this.removeEventListener("load",arguments.callee,!1),document.body.appendChild(cc.LabelTTF.__labelHeightDiv)},!1),cc.LabelTTF.__getFontHeightByDiv=function(fontName,fontSize){var clientHeight,labelDiv=cc.LabelTTF.__labelHeightDiv;if(fontName instanceof cc.FontDefinition){var fontDef=fontName;if(0<(clientHeight=cc.LabelTTF.__fontHeightCache[fontDef._getCanvasFontStr()]))return clientHeight;labelDiv.innerHTML="ajghl~!",labelDiv.style.fontFamily=fontDef.fontName,labelDiv.style.fontSize=fontDef.fontSize+"px",labelDiv.style.fontStyle=fontDef.fontStyle,labelDiv.style.fontWeight=fontDef.fontWeight,clientHeight=labelDiv.clientHeight,cc.LabelTTF.__fontHeightCache[fontDef._getCanvasFontStr()]=clientHeight,labelDiv.innerHTML=""}else{if(0<(clientHeight=cc.LabelTTF.__fontHeightCache[fontName+"."+fontSize]))return clientHeight;labelDiv.innerHTML="ajghl~!",labelDiv.style.fontFamily=fontName,labelDiv.style.fontSize=fontSize+"px",clientHeight=labelDiv.clientHeight,cc.LabelTTF.__fontHeightCache[fontName+"."+fontSize]=clientHeight,labelDiv.innerHTML=""}return clientHeight},cc.LabelTTF.__fontHeightCache={},cc.LabelTTF._textAlign=["left","center","right"],cc.LabelTTF._textBaseline=["top","middle","bottom"],cc.LabelTTF.wrapInspection=!0,cc.LabelTTF._wordRex=/([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôû]+|\S)/,cc.LabelTTF._symbolRex=/^[!,.:;}\]%\?>、‘“》？。，！]/,cc.LabelTTF._lastWordRex=/([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôû]+|\S)$/,cc.LabelTTF._lastEnglish=/[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôû]+$/,cc.LabelTTF._firsrEnglish=/^[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôû]/,function(){cc.LabelTTF.RenderCmd=function(){this._fontClientHeight=18,this._fontStyleStr="",this._shadowColorStr="rgba(128, 128, 128, 0.5)",this._strokeColorStr="",this._fillColorStr="rgba(255,255,255,1)",this._labelCanvas=null,this._labelContext=null,this._lineWidths=[],this._strings=[],this._isMultiLine=!1,this._status=[],this._renderingIndex=0,this._canUseDirtyRegion=!0};var proto=cc.LabelTTF.RenderCmd.prototype;proto.constructor=cc.LabelTTF.RenderCmd,proto._labelCmdCtor=cc.LabelTTF.RenderCmd,proto._setFontStyle=function(fontNameOrFontDef,fontSize,fontStyle,fontWeight){if(fontNameOrFontDef instanceof cc.FontDefinition)this._fontStyleStr=fontNameOrFontDef._getCanvasFontStr(),this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(fontNameOrFontDef);else{var deviceFontSize=fontSize*cc.view.getDevicePixelRatio();this._fontStyleStr=fontStyle+" "+fontWeight+" "+deviceFontSize+"px '"+fontNameOrFontDef+"'",this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(fontNameOrFontDef,fontSize)}},proto._getFontStyle=function(){return this._fontStyleStr},proto._getFontClientHeight=function(){return this._fontClientHeight},proto._updateColor=function(){this._setColorsString(),this._updateTexture()},proto._setColorsString=function(){var locDisplayColor=this._displayedColor,node=this._node,locShadowColor=node._shadowColor||this._displayedColor,locStrokeColor=node._strokeColor,locFontFillColor=node._textFillColor,dr=locDisplayColor.r/255,dg=locDisplayColor.g/255,db=locDisplayColor.b/255;this._shadowColorStr="rgba("+(0|dr*locShadowColor.r)+","+(0|dg*locShadowColor.g)+","+(0|db*locShadowColor.b)+","+node._shadowOpacity+")",this._fillColorStr="rgba("+(0|dr*locFontFillColor.r)+","+(0|dg*locFontFillColor.g)+","+(0|db*locFontFillColor.b)+", 1)",this._strokeColorStr="rgba("+(0|dr*locStrokeColor.r)+","+(0|dg*locStrokeColor.g)+","+(0|db*locStrokeColor.b)+", 1)"};var localBB=new cc.Rect;proto.getLocalBB=function(){var node=this._node;localBB.x=localBB.y=0;var pixelRatio=cc.view.getDevicePixelRatio();return localBB.width=node._getWidth()*pixelRatio,localBB.height=node._getHeight()*pixelRatio,localBB},proto._updateTTF=function(){var i,strLength,node=this._node,pixelRatio=cc.view.getDevicePixelRatio(),locDimensionsWidth=node._dimensions.width*pixelRatio,locLineWidth=this._lineWidths;locLineWidth.length=0,this._isMultiLine=!1,this._measureConfig();var textWidthCache={};if(0!==locDimensionsWidth)for(this._strings=node._string.split("\n"),i=0;i<this._strings.length;i++)this._checkWarp(this._strings,i,locDimensionsWidth);else for(this._strings=node._string.split("\n"),i=0,strLength=this._strings.length;i<strLength;i++)if(this._strings[i]){var measuredWidth=this._measure(this._strings[i]);locLineWidth.push(measuredWidth),textWidthCache[this._strings[i]]=measuredWidth}else locLineWidth.push(0);1<this._strings.length&&(this._isMultiLine=!0);var locSize,locStrokeShadowOffsetX=0,locStrokeShadowOffsetY=0;if(node._strokeEnabled&&(locStrokeShadowOffsetX=locStrokeShadowOffsetY=2*node._strokeSize),node._shadowEnabled){var locOffsetSize=node._shadowOffset;locStrokeShadowOffsetX+=2*Math.abs(locOffsetSize.x),locStrokeShadowOffsetY+=2*Math.abs(locOffsetSize.y)}0===locDimensionsWidth?locSize=this._isMultiLine?cc.size(Math.ceil(Math.max.apply(Math,locLineWidth)+locStrokeShadowOffsetX),Math.ceil(this._fontClientHeight*pixelRatio*this._strings.length+locStrokeShadowOffsetY)):(!(measuredWidth=textWidthCache[node._string])&&node._string&&(measuredWidth=this._measure(node._string)),cc.size(Math.ceil((measuredWidth||0)+locStrokeShadowOffsetX),Math.ceil(this._fontClientHeight*pixelRatio+locStrokeShadowOffsetY))):locSize=0===node._dimensions.height?this._isMultiLine?cc.size(Math.ceil(locDimensionsWidth+locStrokeShadowOffsetX),Math.ceil(node.getLineHeight()*pixelRatio*this._strings.length+locStrokeShadowOffsetY)):cc.size(Math.ceil(locDimensionsWidth+locStrokeShadowOffsetX),Math.ceil(node.getLineHeight()*pixelRatio+locStrokeShadowOffsetY)):cc.size(Math.ceil(locDimensionsWidth+locStrokeShadowOffsetX),Math.ceil(node._dimensions.height*pixelRatio+locStrokeShadowOffsetY));"normal"!==node._getFontStyle()&&(locSize.width=Math.ceil(locSize.width+.3*node._fontSize)),node.setContentSize(locSize),node._strokeShadowOffsetX=locStrokeShadowOffsetX,node._strokeShadowOffsetY=locStrokeShadowOffsetY;var locAP=node._anchorPoint;this._anchorPointInPoints.x=.5*locStrokeShadowOffsetX+(locSize.width-locStrokeShadowOffsetX)*locAP.x,this._anchorPointInPoints.y=.5*locStrokeShadowOffsetY+(locSize.height-locStrokeShadowOffsetY)*locAP.y},proto._saveStatus=function(){var node=this._node,scale=cc.view.getDevicePixelRatio(),locStrokeShadowOffsetX=node._strokeShadowOffsetX,locStrokeShadowOffsetY=node._strokeShadowOffsetY,locContentSizeHeight=node._contentSize.height-locStrokeShadowOffsetY,locVAlignment=node._vAlignment,locHAlignment=node._hAlignment,dx=.5*locStrokeShadowOffsetX,dy=locContentSizeHeight+.5*locStrokeShadowOffsetY,xOffset=0,yOffset=0,OffsetYArray=[],locContentWidth=node._contentSize.width-locStrokeShadowOffsetX,lineHeight=node.getLineHeight()*scale,transformTop=(lineHeight-this._fontClientHeight*scale)/2;if(locHAlignment===cc.TEXT_ALIGNMENT_RIGHT?xOffset+=locContentWidth:locHAlignment===cc.TEXT_ALIGNMENT_CENTER?xOffset+=locContentWidth/2:xOffset+=0,this._isMultiLine){var locStrLen=this._strings.length;locVAlignment===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?yOffset=lineHeight-2*transformTop+locContentSizeHeight-lineHeight*locStrLen:locVAlignment===cc.VERTICAL_TEXT_ALIGNMENT_CENTER&&(yOffset=(lineHeight-2*transformTop)/2+(locContentSizeHeight-lineHeight*locStrLen)/2);for(var i=0;i<locStrLen;i++){var tmpOffsetY=-locContentSizeHeight+(lineHeight*i+transformTop)+yOffset;OffsetYArray.push(tmpOffsetY)}}else locVAlignment===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM||(locVAlignment===cc.VERTICAL_TEXT_ALIGNMENT_TOP?yOffset-=locContentSizeHeight:yOffset-=.5*locContentSizeHeight),OffsetYArray.push(yOffset);var tmpStatus={contextTransform:cc.p(dx,dy),xOffset:xOffset,OffsetYArray:OffsetYArray};this._status.push(tmpStatus)},proto._drawTTFInCanvas=function(context){if(context){var locStatus=this._status.pop();context.setTransform(1,0,0,1,locStatus.contextTransform.x,locStatus.contextTransform.y);var xOffset=locStatus.xOffset,yOffsetArray=locStatus.OffsetYArray;this.drawLabels(context,xOffset,yOffsetArray)}},proto._checkWarp=function(strArr,i,maxWidth){var text=strArr[i],allWidth=this._measure(text);if(maxWidth<allWidth&&1<text.length){for(var sLine,fuzzyLen=text.length*(maxWidth/allWidth)|0,tmpText=text.substr(fuzzyLen),width=allWidth-this._measure(tmpText),pushNum=0,checkWhile=0;maxWidth<width&&checkWhile++<100;)fuzzyLen*=maxWidth/width,fuzzyLen|=0,tmpText=text.substr(fuzzyLen),width=allWidth-this._measure(tmpText);for(checkWhile=0;width<maxWidth&&checkWhile++<100;){if(tmpText){var exec=cc.LabelTTF._wordRex.exec(tmpText);pushNum=exec?exec[0].length:1,sLine=tmpText}fuzzyLen+=pushNum,tmpText=text.substr(fuzzyLen),width=allWidth-this._measure(tmpText)}0===(fuzzyLen-=pushNum)&&(fuzzyLen=1,sLine=sLine.substr(1));var result,sText=text.substr(0,fuzzyLen);cc.LabelTTF.wrapInspection&&cc.LabelTTF._symbolRex.test(sLine||tmpText)&&(0===(fuzzyLen-=(result=cc.LabelTTF._lastWordRex.exec(sText))?result[0].length:0)&&(fuzzyLen=1),sLine=text.substr(fuzzyLen),sText=text.substr(0,fuzzyLen)),cc.LabelTTF._firsrEnglish.test(sLine)&&(result=cc.LabelTTF._lastEnglish.exec(sText))&&sText!==result[0]&&(fuzzyLen-=result[0].length,sLine=text.substr(fuzzyLen),sText=text.substr(0,fuzzyLen)),strArr[i]=sLine||tmpText,strArr.splice(i,0,sText)}},proto.updateStatus=function(){var flags=cc.Node._dirtyFlags;this._dirtyFlag&flags.textDirty&&this._updateTexture(),this.originUpdateStatus()},proto._syncStatus=function(parentCmd){var flags=cc.Node._dirtyFlags,locFlag=this._dirtyFlag;locFlag&flags.textDirty&&this._updateTexture(),this._originSyncStatus(parentCmd),(cc._renderType===cc.game.RENDER_TYPE_WEBGL||locFlag&flags.transformDirty)&&this.transform(parentCmd)},proto.drawLabels=function(context,xOffset,yOffsetArray){var node=this._node;if(node._shadowEnabled){var locShadowOffset=node._shadowOffset;context.shadowColor=this._shadowColorStr,context.shadowOffsetX=locShadowOffset.x,context.shadowOffsetY=-locShadowOffset.y,context.shadowBlur=node._shadowBlur}var locHAlignment=node._hAlignment,locVAlignment=node._vAlignment,locStrokeSize=node._strokeSize;context.font!==this._fontStyleStr&&(context.font=this._fontStyleStr),context.fillStyle=this._fillColorStr;var locStrokeEnabled=node._strokeEnabled;locStrokeEnabled&&(context.lineWidth=2*locStrokeSize,context.strokeStyle=this._strokeColorStr),context.textBaseline=cc.LabelTTF._textBaseline[locVAlignment],context.textAlign=cc.LabelTTF._textAlign[locHAlignment];for(var locStrLen=this._strings.length,i=0;i<locStrLen;i++){var line=this._strings[i];locStrokeEnabled&&context.strokeText(line,xOffset,yOffsetArray[i]),context.fillText(line,xOffset,yOffsetArray[i])}cc.g_NumberOfDraws++}}(),function(){cc.LabelTTF.CacheRenderCmd=function(){this._labelCmdCtor();var locCanvas=this._labelCanvas=document.createElement("canvas");locCanvas.width=1,locCanvas.height=1,this._labelContext=locCanvas.getContext("2d")},cc.LabelTTF.CacheRenderCmd.prototype=Object.create(cc.LabelTTF.RenderCmd.prototype),cc.inject(cc.LabelTTF.RenderCmd.prototype,cc.LabelTTF.CacheRenderCmd.prototype);var proto=cc.LabelTTF.CacheRenderCmd.prototype;proto.constructor=cc.LabelTTF.CacheRenderCmd,proto._cacheCmdCtor=cc.LabelTTF.CacheRenderCmd,proto._updateTexture=function(){this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.textDirty^this._dirtyFlag;var node=this._node;node._needUpdateTexture=!1;var locContentSize=node._contentSize;this._updateTTF();var width=locContentSize.width,height=locContentSize.height,locContext=this._labelContext,locLabelCanvas=this._labelCanvas;if(!node._texture){var labelTexture=new cc.Texture2D;labelTexture.initWithElement(this._labelCanvas),node.setTexture(labelTexture)}if(0===node._string.length)return locLabelCanvas.width=1,locLabelCanvas.height=locContentSize.height||1,node._texture&&node._texture.handleLoadedTexture(),node.setTextureRect(cc.rect(0,0,1,locContentSize.height)),!0;locContext.font=this._fontStyleStr;var flag=locLabelCanvas.width===width&&locLabelCanvas.height===height;return locLabelCanvas.width=width,locLabelCanvas.height=height,flag&&locContext.clearRect(0,0,width,height),this._saveStatus(),this._drawTTFInCanvas(locContext),node._texture&&node._texture.handleLoadedTexture(),node.setTextureRect(cc.rect(0,0,width,height)),!0},proto._measureConfig=function(){this._labelContext.font=this._fontStyleStr},proto._measure=function(text){return text?this._labelContext.measureText(text).width:0}}(),function(){cc.LabelTTF.CacheCanvasRenderCmd=function(renderable){this._spriteCmdCtor(renderable),this._cacheCmdCtor()};var proto=cc.LabelTTF.CacheCanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype);cc.inject(cc.LabelTTF.CacheRenderCmd.prototype,proto),proto.constructor=cc.LabelTTF.CacheCanvasRenderCmd}(),function(){cc.LabelTTF.CanvasRenderCmd=function(renderable){this._spriteCmdCtor(renderable),this._labelCmdCtor()},cc.LabelTTF.CanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype),cc.inject(cc.LabelTTF.RenderCmd.prototype,cc.LabelTTF.CanvasRenderCmd.prototype);var proto=cc.LabelTTF.CanvasRenderCmd.prototype;proto.constructor=cc.LabelTTF.CanvasRenderCmd,proto._measureConfig=function(){},proto._measure=function(text){if(text){var context=cc._renderContext.getContext();return context.font=this._fontStyleStr,context.measureText(text).width}return 0},proto._updateTexture=function(){this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.textDirty^this._dirtyFlag;var node=this._node,locContentSize=node._contentSize;this._updateTTF();var width=locContentSize.width,height=locContentSize.height;return 0===node._string.length?node.setTextureRect(cc.rect(0,0,1,locContentSize.height)):(this._saveStatus(),node.setTextureRect(cc.rect(0,0,width,height))),!0},proto.rendering=function(ctx){var scaleX=cc.view.getScaleX(),scaleY=cc.view.getScaleY(),wrapper=ctx||cc._renderContext,context=wrapper.getContext();if(context){var node=this._node;if(wrapper.computeRealOffsetY(),!(this._status.length<=0)){var locIndex=this._renderingIndex>=this._status.length?this._renderingIndex-this._status.length:this._renderingIndex,status=this._status[locIndex];this._renderingIndex=locIndex+1;var locHeight=node._rect.height,locX=node._offsetPosition.x,locY=-node._offsetPosition.y-locHeight,alpha=this._displayedOpacity/255;wrapper.setTransform(this._worldTransform,scaleX,scaleY),wrapper.setCompositeOperation(this._blendFuncStr),wrapper.setGlobalAlpha(alpha),wrapper.save(),node._flippedX&&(locX=-locX-node._rect.width,context.scale(-1,1)),node._flippedY&&(locY=node._offsetPosition.y,context.scale(1,-1));for(var xOffset=status.xOffset+status.contextTransform.x+locX*scaleX,yOffsetArray=[],locStrLen=this._strings.length,i=0;i<locStrLen;i++)yOffsetArray.push(status.OffsetYArray[i]+status.contextTransform.y+locY*scaleY);this.drawLabels(context,xOffset,yOffsetArray),wrapper.restore()}}}}(),function(){cc.LabelTTF.WebGLRenderCmd=function(renderable){this._spriteCmdCtor(renderable),this._cacheCmdCtor()};var proto=cc.LabelTTF.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype);cc.inject(cc.LabelTTF.CacheRenderCmd.prototype,proto),proto.constructor=cc.LabelTTF.WebGLRenderCmd,proto._updateColor=function(){}}(),cc.HashElement=cc.Class.extend({actions:null,target:null,actionIndex:0,currentAction:null,currentActionSalvaged:!1,paused:!1,ctor:function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.currentActionSalvaged=!1,this.paused=!1}}),cc.ActionManager=cc.Class.extend({_hashTargets:null,_arrayTargets:null,_currentTarget:null,_currentTargetSalvaged:!1,_elementPool:[],_searchElementByTarget:function(arr,target){for(var k=0;k<arr.length;k++)if(target===arr[k].target)return arr[k];return null},ctor:function(){this._hashTargets={},this._arrayTargets=[],this._currentTarget=null,this._currentTargetSalvaged=!1},_getElement:function(target,paused){var element=this._elementPool.pop();return element||(element=new cc.HashElement),element.target=target,element.paused=!!paused,element},_putElement:function(element){element.actions.length=0,element.actionIndex=0,element.currentAction=null,element.currentActionSalvaged=!1,element.paused=!1,this._elementPool.push(element)},addAction:function(action,target,paused){if(!action)throw new Error("cc.ActionManager.addAction(): action must be non-null");if(!target)throw new Error("cc.ActionManager.addAction(): action must be non-null");var element=this._hashTargets[target.__instanceId];element?element.actions||(element.actions=[]):(element=this._getElement(target,paused),this._hashTargets[target.__instanceId]=element,this._arrayTargets.push(element)),element.actions.push(action),action.startWithTarget(target)},removeAllActions:function(){for(var locTargets=this._arrayTargets,i=0;i<locTargets.length;i++){var element=locTargets[i];element&&this.removeAllActionsFromTarget(element.target,!0)}},removeAllActionsFromTarget:function(target,forceDelete){if(null!=target){var element=this._hashTargets[target.__instanceId];element&&(-1===element.actions.indexOf(element.currentAction)||element.currentActionSalvaged||(element.currentActionSalvaged=!0),element.actions.length=0,this._currentTarget!==element||forceDelete?this._deleteHashElement(element):this._currentTargetSalvaged=!0)}},removeAction:function(action){if(null!=action){var target=action.getOriginalTarget(),element=this._hashTargets[target.__instanceId];if(element){for(var i=0;i<element.actions.length;i++)if(element.actions[i]===action){element.actions.splice(i,1);break}}else cc.log(cc._LogInfos.ActionManager_removeAction)}},removeActionByTag:function(tag,target){tag===cc.ACTION_TAG_INVALID&&cc.log(cc._LogInfos.ActionManager_addAction),cc.assert(target,cc._LogInfos.ActionManager_addAction);var element=this._hashTargets[target.__instanceId];if(element)for(var limit=element.actions.length,i=0;i<limit;++i){var action=element.actions[i];if(action&&action.getTag()===tag&&action.getOriginalTarget()===target){this._removeActionAtIndex(i,element);break}}},getActionByTag:function(tag,target){tag===cc.ACTION_TAG_INVALID&&cc.log(cc._LogInfos.ActionManager_getActionByTag);var element=this._hashTargets[target.__instanceId];if(element){if(null!=element.actions)for(var i=0;i<element.actions.length;++i){var action=element.actions[i];if(action&&action.getTag()===tag)return action}cc.log(cc._LogInfos.ActionManager_getActionByTag_2,tag)}return null},numberOfRunningActionsInTarget:function(target){var element=this._hashTargets[target.__instanceId];return element&&element.actions?element.actions.length:0},pauseTarget:function(target){var element=this._hashTargets[target.__instanceId];element&&(element.paused=!0)},resumeTarget:function(target){var element=this._hashTargets[target.__instanceId];element&&(element.paused=!1)},pauseAllRunningActions:function(){for(var idsWithActions=[],locTargets=this._arrayTargets,i=0;i<locTargets.length;i++){var element=locTargets[i];element&&!element.paused&&(element.paused=!0,idsWithActions.push(element.target))}return idsWithActions},resumeTargets:function(targetsToResume){if(targetsToResume)for(var i=0;i<targetsToResume.length;i++)targetsToResume[i]&&this.resumeTarget(targetsToResume[i])},purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdate(this)},_removeActionAtIndex:function(index,element){element.actions[index]!==element.currentAction||element.currentActionSalvaged||(element.currentActionSalvaged=!0),element.actions.splice(index,1),element.actionIndex>=index&&element.actionIndex--,0===element.actions.length&&(this._currentTarget===element?this._currentTargetSalvaged=!0:this._deleteHashElement(element))},_deleteHashElement:function(element){var ret=!1;if(element&&this._hashTargets[element.target.__instanceId]){delete this._hashTargets[element.target.__instanceId];for(var targets=this._arrayTargets,i=0,l=targets.length;i<l;i++)if(targets[i]===element){targets.splice(i,1);break}this._putElement(element),ret=!0}return ret},update:function(dt){for(var locCurrTarget,locTargets=this._arrayTargets,elt=0;elt<locTargets.length;elt++){if(this._currentTarget=locTargets[elt],!(locCurrTarget=this._currentTarget).paused)for(locCurrTarget.actionIndex=0;locCurrTarget.actionIndex<(locCurrTarget.actions?locCurrTarget.actions.length:0);locCurrTarget.actionIndex++)if(locCurrTarget.currentAction=locCurrTarget.actions[locCurrTarget.actionIndex],locCurrTarget.currentAction){if(locCurrTarget.currentActionSalvaged=!1,locCurrTarget.currentAction.step(dt*(locCurrTarget.currentAction._speedMethod?locCurrTarget.currentAction._speed:1)),locCurrTarget.currentActionSalvaged)locCurrTarget.currentAction=null;else if(locCurrTarget.currentAction.isDone()){locCurrTarget.currentAction.stop();var action=locCurrTarget.currentAction;locCurrTarget.currentAction=null,this.removeAction(action)}locCurrTarget.currentAction=null}this._currentTargetSalvaged&&0===locCurrTarget.actions.length&&this._deleteHashElement(locCurrTarget)&&elt--}}}),cc.profiler=function(){var _showFPS=!1,_inited=!1,_frames=0,_frameRate=0,_lastSPF=0,_accumDt=0,_afterVisitListener=null,_FPSLabel=document.createElement("div"),_SPFLabel=document.createElement("div"),_drawsLabel=document.createElement("div"),_fps=document.createElement("div"),_levelDetCycle=10,LEVELS=[0,10,20,30],_fpsCount=[0,0,0,0],_currLevel=3,_analyseCount=0,_totalFPS=0;_fps.id="fps",_fps.style.position="absolute",_fps.style.padding="3px",_fps.style.textAlign="left",_fps.style.backgroundColor="rgb(0, 0, 34)",_fps.style.bottom=cc.DIRECTOR_STATS_POSITION.y+"0px",_fps.style.left=cc.DIRECTOR_STATS_POSITION.x+"px",_fps.style.width="45px",_fps.style.height="80px";for(var labels=[_drawsLabel,_SPFLabel,_FPSLabel],i=0;i<3;++i){var style=labels[i].style;style.color="rgb(0, 255, 255)",style.font="bold 12px Helvetica, Arial",style.lineHeight="20px",style.width="100%",_fps.appendChild(labels[i])}var afterVisit=function(){if(_lastSPF=cc.director.getSecondsPerFrame(),_frames++,(_accumDt+=cc.director.getDeltaTime())>cc.DIRECTOR_FPS_INTERVAL&&(_frameRate=_frames/_accumDt,_accumDt=_frames=0,profiler.onFrameRateChange&&function(fps){var lastId=LEVELS.length-1,i=lastId,average=0;for(_analyseCount++,_totalFPS+=fps;0<=i;i--)if(LEVELS[i]<=fps){_fpsCount[i]++;break}if(_levelDetCycle<=_analyseCount){for(average=_totalFPS/_levelDetCycle,i=lastId;0<i;i--)if(.6<=_fpsCount[i]/_levelDetCycle&&LEVELS[i]<=average){i!=_currLevel&&(_currLevel=i,profiler.onFrameRateChange&&profiler.onFrameRateChange(average.toFixed(2)));break}for(_changeCount=0,_totalFPS=_analyseCount=0,i=lastId;0<i;i--)_fpsCount[i]=0}}(_frameRate),_showFPS)){var mode=cc._renderType===cc.game.RENDER_TYPE_CANVAS?"\n canvas":"\n webgl";_SPFLabel.innerHTML=_lastSPF.toFixed(3),_FPSLabel.innerHTML=_frameRate.toFixed(1).toString()+mode,_drawsLabel.innerHTML=(0|cc.g_NumberOfDraws).toString()}},profiler={onFrameRateChange:null,getSecondsPerFrame:function(){return _lastSPF},getFrameRate:function(){return _frameRate},setProfileDuration:function(duration){!isNaN(duration)&&0<duration&&(_levelDetCycle=duration/cc.DIRECTOR_FPS_INTERVAL)},resumeProfiling:function(){cc.eventManager.addListener(_afterVisitListener,1)},stopProfiling:function(){cc.eventManager.removeListener(_afterVisitListener)},isShowingStats:function(){return _showFPS},showStats:function(){_inited||this.init(),null===_fps.parentElement&&cc.container.appendChild(_fps),_showFPS=!0},hideStats:function(){_showFPS=!1,_fps.parentElement===cc.container&&cc.container.removeChild(_fps)},init:function(){_inited||(_afterVisitListener=cc.eventManager.addCustomListener(cc.Director.EVENT_AFTER_VISIT,afterVisit),_inited=!0)}};return profiler}();