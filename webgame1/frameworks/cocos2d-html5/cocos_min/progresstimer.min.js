cc.ProgressTimer=cc.Node.extend({_type:null,_percentage:0,_sprite:null,_midPoint:null,_barChangeRate:null,_reverseDirection:!1,_className:"ProgressTimer",ctor:function(sprite){cc.Node.prototype.ctor.call(this),this._type=cc.ProgressTimer.TYPE_RADIAL,this._percentage=0,this._midPoint=cc.p(0,0),this._barChangeRate=cc.p(0,0),this._reverseDirection=!1,this._sprite=null,sprite&&this.initWithSprite(sprite)},onEnter:function(){this._super(),cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(this._renderCmd.initCmd(),this._renderCmd._updateProgress())},cleanup:function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&this._renderCmd.releaseData(),this._super()},getMidpoint:function(){return cc.p(this._midPoint.x,this._midPoint.y)},setMidpoint:function(mpoint){this._midPoint=cc.pClamp(mpoint,cc.p(0,0),cc.p(1,1))},getBarChangeRate:function(){return cc.p(this._barChangeRate.x,this._barChangeRate.y)},setBarChangeRate:function(barChangeRate){this._barChangeRate=cc.pClamp(barChangeRate,cc.p(0,0),cc.p(1,1))},getType:function(){return this._type},getPercentage:function(){return this._percentage},getSprite:function(){return this._sprite},setPercentage:function(percentage){this._percentage!==percentage&&(this._percentage=cc.clampf(percentage,0,100),this._renderCmd._updateProgress())},setOpacityModifyRGB:function(bValue){},isOpacityModifyRGB:function(){return!1},isReverseDirection:function(){return this._reverseDirection},setColor:function(color){this._sprite.color=color,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},setOpacity:function(opacity){this._sprite.opacity=opacity,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getColor:function(){return this._sprite.color},getOpacity:function(){return this._sprite.opacity},setReverseProgress:function(reverse){this._reverseDirection!==reverse&&(this._reverseDirection=reverse,this._renderCmd.resetVertexData())},setSprite:function(sprite){this._sprite!==sprite&&(this._sprite=sprite,sprite?(this.setContentSize(sprite.width,sprite.height),sprite.ignoreAnchorPointForPosition(!0)):this.setContentSize(0,0),this._renderCmd.resetVertexData())},setType:function(type){type!==this._type&&(this._type=type,this._renderCmd.resetVertexData())},setReverseDirection:function(reverse){this._reverseDirection!==reverse&&(this._reverseDirection=reverse,this._renderCmd.resetVertexData())},initWithSprite:function(sprite){return this.percentage=0,this.setAnchorPoint(.5,.5),this._type=cc.ProgressTimer.TYPE_RADIAL,this._reverseDirection=!1,this.midPoint=cc.p(.5,.5),this.barChangeRate=cc.p(1,1),this.setSprite(sprite),this._renderCmd.resetVertexData(),!0},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ProgressTimer.CanvasRenderCmd(this):new cc.ProgressTimer.WebGLRenderCmd(this)}});var _p=cc.ProgressTimer.prototype;_p.midPoint,cc.defineGetterSetter(_p,"midPoint",_p.getMidpoint,_p.setMidpoint),_p.barChangeRate,cc.defineGetterSetter(_p,"barChangeRate",_p.getBarChangeRate,_p.setBarChangeRate),_p.type,cc.defineGetterSetter(_p,"type",_p.getType,_p.setType),_p.percentage,cc.defineGetterSetter(_p,"percentage",_p.getPercentage,_p.setPercentage),_p.sprite,cc.defineGetterSetter(_p,"sprite",_p.getSprite,_p.setSprite),_p.reverseDir,cc.defineGetterSetter(_p,"reverseDir",_p.isReverseDirection,_p.setReverseDirection),cc.ProgressTimer.create=function(sprite){return new cc.ProgressTimer(sprite)},cc.ProgressTimer.TEXTURE_COORDS_COUNT=4,cc.ProgressTimer.TEXTURE_COORDS=75,cc.ProgressTimer.TYPE_RADIAL=0,cc.ProgressTimer.TYPE_BAR=1,cc.ProgressTo=cc.ActionInterval.extend({_to:0,_from:0,ctor:function(duration,percent){cc.ActionInterval.prototype.ctor.call(this),this._to=0,this._from=0,void 0!==percent&&this.initWithDuration(duration,percent)},initWithDuration:function(duration,percent){return!!cc.ActionInterval.prototype.initWithDuration.call(this,duration)&&(this._to=percent,!0)},clone:function(){var action=new cc.ProgressTo;return action.initWithDuration(this._duration,this._to),action},reverse:function(){return cc.log("cc.ProgressTo.reverse(): reverse hasn't been supported."),null},startWithTarget:function(target){cc.ActionInterval.prototype.startWithTarget.call(this,target),this._from=target.percentage},update:function(time){this.target instanceof cc.ProgressTimer&&(this.target.percentage=this._from+(this._to-this._from)*time)}}),cc.progressTo=function(duration,percent){return new cc.ProgressTo(duration,percent)},cc.ProgressTo.create=cc.progressTo,cc.ProgressFromTo=cc.ActionInterval.extend({_to:0,_from:0,ctor:function(duration,fromPercentage,toPercentage){cc.ActionInterval.prototype.ctor.call(this),this._to=0,this._from=0,void 0!==toPercentage&&this.initWithDuration(duration,fromPercentage,toPercentage)},initWithDuration:function(duration,fromPercentage,toPercentage){return!!cc.ActionInterval.prototype.initWithDuration.call(this,duration)&&(this._to=toPercentage,this._from=fromPercentage,!0)},clone:function(){var action=new cc.ProgressFromTo;return action.initWithDuration(this._duration,this._from,this._to),action},reverse:function(){return cc.progressFromTo(this._duration,this._to,this._from)},startWithTarget:function(target){cc.ActionInterval.prototype.startWithTarget.call(this,target)},update:function(time){this.target instanceof cc.ProgressTimer&&(this.target.percentage=this._from+(this._to-this._from)*time)}}),cc.progressFromTo=function(duration,fromPercentage,toPercentage){return new cc.ProgressFromTo(duration,fromPercentage,toPercentage)},cc.ProgressFromTo.create=cc.progressFromTo,function(){cc.ProgressTimer.CanvasRenderCmd=function(renderableObject){this._rootCtor(renderableObject),this._needDraw=!0,this._PI180=Math.PI/180,this._barRect=cc.rect(0,0,0,0),this._origin=cc.p(0,0),this._radius=0,this._startAngle=270,this._endAngle=270,this._counterClockWise=!1,this._canUseDirtyRegion=!0};var proto=cc.ProgressTimer.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);proto.constructor=cc.ProgressTimer.CanvasRenderCmd,proto.rendering=function(ctx,scaleX,scaleY){var wrapper=ctx||cc._renderContext,context=wrapper.getContext(),node=this._node,locSprite=node._sprite,locTextureCoord=locSprite._renderCmd._textureCoord,alpha=locSprite._renderCmd._displayedOpacity/255;if(0!==locTextureCoord.width&&0!==locTextureCoord.height&&locSprite._texture&&locTextureCoord.validRect&&0!==alpha){wrapper.setTransform(this._worldTransform,scaleX,scaleY),wrapper.setCompositeOperation(locSprite._blendFuncStr),wrapper.setGlobalAlpha(alpha);var locRect=locSprite._rect,locOffsetPosition=locSprite._offsetPosition,locX=locOffsetPosition.x,locY=-locOffsetPosition.y-locRect.height,locWidth=locRect.width,locHeight=locRect.height;if(wrapper.save(),locSprite._flippedX&&(locX=-locX-locWidth,context.scale(-1,1)),locSprite._flippedY&&(locY=locOffsetPosition.y,context.scale(1,-1)),node._type===cc.ProgressTimer.TYPE_BAR){var locBarRect=this._barRect;context.beginPath(),context.rect(locBarRect.x,locBarRect.y,locBarRect.width,locBarRect.height),context.clip(),context.closePath()}else if(node._type===cc.ProgressTimer.TYPE_RADIAL){var locOriginX=this._origin.x,locOriginY=this._origin.y;context.beginPath(),context.arc(locOriginX,locOriginY,this._radius,this._PI180*this._startAngle,this._PI180*this._endAngle,this._counterClockWise),context.lineTo(locOriginX,locOriginY),context.clip(),context.closePath()}var image=(locSprite._renderCmd._textureToRender||locSprite._texture).getHtmlElementObj();locSprite._renderCmd._colorized?context.drawImage(image,0,0,locTextureCoord.width,locTextureCoord.height,locX,locY,locWidth,locHeight):context.drawImage(image,locTextureCoord.renderX,locTextureCoord.renderY,locTextureCoord.width,locTextureCoord.height,locX,locY,locWidth,locHeight),wrapper.restore(),cc.g_NumberOfDraws++}},proto.releaseData=function(){},proto.resetVertexData=function(){},proto._updateProgress=function(){this.setDirtyFlag(cc.Node._dirtyFlags.contentDirty);var node=this._node,locSprite=node._sprite,sw=locSprite.width,sh=locSprite.height,locMidPoint=node._midPoint;if(node._type===cc.ProgressTimer.TYPE_RADIAL){this._radius=Math.round(Math.sqrt(sw*sw+sh*sh));var locStartAngle,locEndAngle,locCounterClockWise=!1,locOrigin=this._origin;locOrigin.x=sw*locMidPoint.x,locOrigin.y=-sh*locMidPoint.y,node._reverseDirection?(locEndAngle=270,locStartAngle=270-3.6*node._percentage):(locStartAngle=-90,locEndAngle=3.6*node._percentage-90),locSprite._flippedX&&(locOrigin.x-=sw*(2*node._midPoint.x),locStartAngle=-locStartAngle,locEndAngle=-locEndAngle,locStartAngle-=180,locEndAngle-=180,locCounterClockWise=!locCounterClockWise),locSprite._flippedY&&(locOrigin.y+=sh*(2*node._midPoint.y),locCounterClockWise=!locCounterClockWise,locStartAngle=-locStartAngle,locEndAngle=-locEndAngle),this._startAngle=locStartAngle,this._endAngle=locEndAngle,this._counterClockWise=locCounterClockWise}else{var locBarChangeRate=node._barChangeRate,percentageF=node._percentage/100,locBarRect=this._barRect,drewSize=cc.size(sw*(1-locBarChangeRate.x),sh*(1-locBarChangeRate.y)),drawingSize=cc.size((sw-drewSize.width)*percentageF,(sh-drewSize.height)*percentageF),currentDrawSize=cc.size(drewSize.width+drawingSize.width,drewSize.height+drawingSize.height),startPoint=cc.p(sw*locMidPoint.x,sh*locMidPoint.y),needToLeft=startPoint.x-currentDrawSize.width/2;locMidPoint.x>.5&&currentDrawSize.width/2>=sw-startPoint.x&&(needToLeft=sw-currentDrawSize.width);var needToTop=startPoint.y-currentDrawSize.height/2;locMidPoint.y>.5&&currentDrawSize.height/2>=sh-startPoint.y&&(needToTop=sh-currentDrawSize.height),locBarRect.x=0;var flipXNeed=1;locSprite._flippedX&&(locBarRect.x-=currentDrawSize.width,flipXNeed=-1),needToLeft>0&&(locBarRect.x+=needToLeft*flipXNeed),locBarRect.y=0;var flipYNeed=1;locSprite._flippedY&&(locBarRect.y+=currentDrawSize.height,flipYNeed=-1),needToTop>0&&(locBarRect.y-=needToTop*flipYNeed),locBarRect.width=currentDrawSize.width,locBarRect.height=-currentDrawSize.height}},proto._syncStatus=function(parentCmd){var node=this._node;if(node._sprite){var flags=cc.Node._dirtyFlags,locFlag=this._dirtyFlag,parentNode=parentCmd?parentCmd._node:null;parentNode&&parentNode._cascadeColorEnabled&&parentCmd._dirtyFlag&flags.colorDirty&&(locFlag|=flags.colorDirty),parentNode&&parentNode._cascadeOpacityEnabled&&parentCmd._dirtyFlag&flags.opacityDirty&&(locFlag|=flags.opacityDirty),parentCmd&&parentCmd._dirtyFlag&flags.transformDirty&&(locFlag|=flags.transformDirty),this._dirtyFlag=locFlag;var spriteCmd=node._sprite._renderCmd,spriteFlag=spriteCmd._dirtyFlag,colorDirty=spriteFlag&flags.colorDirty,opacityDirty=spriteFlag&flags.opacityDirty;colorDirty&&(spriteCmd._syncDisplayColor(),spriteCmd._dirtyFlag&=~flags.colorDirty,this._dirtyFlag&=~flags.colorDirty),opacityDirty&&(spriteCmd._syncDisplayOpacity(),spriteCmd._dirtyFlag&=~flags.opacityDirty,this._dirtyFlag&=~flags.opacityDirty),(colorDirty||opacityDirty)&&spriteCmd._updateColor(),locFlag&flags.transformDirty&&this.transform(parentCmd),locFlag&flags.orderDirty&&(this._dirtyFlag&=~flags.orderDirty)}},proto.updateStatus=function(){var node=this._node;if(node._sprite){var flags=cc.Node._dirtyFlags,locFlag=this._dirtyFlag,spriteCmd=node._sprite._renderCmd,spriteFlag=spriteCmd._dirtyFlag,colorDirty=spriteFlag&flags.colorDirty,opacityDirty=spriteFlag&flags.opacityDirty;colorDirty&&(spriteCmd._updateDisplayColor(),spriteCmd._dirtyFlag=spriteCmd._dirtyFlag&flags.colorDirty^spriteCmd._dirtyFlag,this._dirtyFlag=this._dirtyFlag&flags.colorDirty^this._dirtyFlag),opacityDirty&&(spriteCmd._updateDisplayOpacity(),spriteCmd._dirtyFlag=spriteCmd._dirtyFlag&flags.opacityDirty^spriteCmd._dirtyFlag,this._dirtyFlag=this._dirtyFlag&flags.opacityDirty^this._dirtyFlag),(colorDirty||opacityDirty)&&spriteCmd._updateColor(),locFlag&flags.transformDirty&&this.transform(this.getParentRenderCmd(),!0),locFlag&flags.contentDirty&&this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty),this._dirtyFlag=0}}}(),function(){cc.ProgressTimer.WebGLRenderCmd=function(renderableObject){this._rootCtor(renderableObject),this._needDraw=!0,this._progressDirty=!0,this._bl=cc.p(),this._tr=cc.p(),this.initCmd()};var proto=cc.ProgressTimer.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);proto.constructor=cc.ProgressTimer.WebGLRenderCmd,proto.transform=function(parentCmd,recursive){this.originTransform(parentCmd,recursive);var sp=this._node._sprite;sp._renderCmd.transform(this,recursive);var lx=sp._offsetPosition.x,rx=lx+sp._rect.width,by=sp._offsetPosition.y,ty=by+sp._rect.height,wt=this._worldTransform;this._bl.x=lx*wt.a+by*wt.c+wt.tx,this._bl.y=lx*wt.b+by*wt.d+wt.ty,this._tr.x=rx*wt.a+ty*wt.c+wt.tx,this._tr.y=rx*wt.b+ty*wt.d+wt.ty,this._updateProgressData()},proto.rendering=function(ctx){var node=this._node,context=ctx||cc._renderContext;if(0!==this._vertexDataCount&&node._sprite){this._shaderProgram.use(),this._shaderProgram._updateProjectionUniform();var blendFunc=node._sprite._blendFunc;cc.glBlendFunc(blendFunc.src,blendFunc.dst),cc.glBindTexture2D(node._sprite.texture),context.bindBuffer(context.ARRAY_BUFFER,this._vertexWebGLBuffer),context.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),context.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),context.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),this._vertexDataDirty&&(context.bufferSubData(context.ARRAY_BUFFER,0,this._float32View),this._vertexDataDirty=!1);var locVertexDataLen=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;context.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,context.FLOAT,!1,locVertexDataLen,0),context.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,context.UNSIGNED_BYTE,!0,locVertexDataLen,12),context.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,context.FLOAT,!1,locVertexDataLen,16),node._type===cc.ProgressTimer.TYPE_RADIAL?context.drawArrays(context.TRIANGLE_FAN,0,this._vertexDataCount):node._type===cc.ProgressTimer.TYPE_BAR&&(node._reverseDirection?(context.drawArrays(context.TRIANGLE_STRIP,0,this._vertexDataCount/2),context.drawArrays(context.TRIANGLE_STRIP,4,this._vertexDataCount/2),cc.g_NumberOfDraws++):context.drawArrays(context.TRIANGLE_STRIP,0,this._vertexDataCount)),cc.g_NumberOfDraws++}},proto._syncStatus=function(parentCmd){var node=this._node;if(node._sprite){var flags=cc.Node._dirtyFlags,locFlag=this._dirtyFlag,parentNode=parentCmd?parentCmd._node:null;parentNode&&parentNode._cascadeColorEnabled&&parentCmd._dirtyFlag&flags.colorDirty&&(locFlag|=flags.colorDirty),parentNode&&parentNode._cascadeOpacityEnabled&&parentCmd._dirtyFlag&flags.opacityDirty&&(locFlag|=flags.opacityDirty),parentCmd&&parentCmd._dirtyFlag&flags.transformDirty&&(locFlag|=flags.transformDirty),this._dirtyFlag=locFlag;var spriteCmd=node._sprite._renderCmd,spriteFlag=spriteCmd._dirtyFlag,colorDirty=(locFlag|spriteFlag)&flags.colorDirty,opacityDirty=(locFlag|spriteFlag)&flags.opacityDirty;colorDirty&&(spriteCmd._syncDisplayColor(),spriteCmd._dirtyFlag&=~flags.colorDirty,this._dirtyFlag&=~flags.colorDirty),opacityDirty&&(spriteCmd._syncDisplayOpacity(),spriteCmd._dirtyFlag&=~flags.opacityDirty,this._dirtyFlag&=~flags.opacityDirty),(colorDirty||opacityDirty)&&this._updateColor(),locFlag&flags.transformDirty&&this.transform(parentCmd),locFlag&flags.textureDirty&&(this._updateProgressData(),this._dirtyFlag&=~flags.textureDirty),spriteCmd._dirtyFlag=0}},proto.updateStatus=function(){var node=this._node;if(node._sprite){var flags=cc.Node._dirtyFlags,locFlag=this._dirtyFlag,spriteCmd=node._sprite._renderCmd,spriteFlag=spriteCmd._dirtyFlag,colorDirty=(locFlag|spriteFlag)&flags.colorDirty,opacityDirty=(locFlag|spriteFlag)&flags.opacityDirty;colorDirty&&(spriteCmd._updateDisplayColor(),spriteCmd._dirtyFlag=spriteCmd._dirtyFlag&flags.colorDirty^spriteCmd._dirtyFlag,this._dirtyFlag=this._dirtyFlag&flags.colorDirty^this._dirtyFlag),opacityDirty&&(spriteCmd._updateDisplayOpacity(),spriteCmd._dirtyFlag=spriteCmd._dirtyFlag&flags.opacityDirty^spriteCmd._dirtyFlag,this._dirtyFlag=this._dirtyFlag&flags.opacityDirty^this._dirtyFlag),(colorDirty||opacityDirty)&&this._updateColor(),locFlag&flags.transformDirty&&this.transform(this.getParentRenderCmd(),!0),locFlag&flags.orderDirty&&(this._dirtyFlag=this._dirtyFlag&flags.orderDirty^this._dirtyFlag),locFlag&flags.textureDirty&&(this._updateProgressData(),this._dirtyFlag=this._dirtyFlag&flags.textureDirty^this._dirtyFlag)}},proto.releaseData=function(){if(this._vertexData){var webglBuffer=this._vertexWebGLBuffer;setTimeout(function(){cc._renderContext.deleteBuffer(webglBuffer)},.1),this._vertexWebGLBuffer=null,this._vertexData=null,this._float32View=null,this._vertexArrayBuffer=null,this._vertexDataCount=0}},proto.initCmd=function(){if(!this._vertexData){this._vertexWebGLBuffer=cc._renderContext.createBuffer();var vertexDataLen=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._vertexArrayBuffer=new ArrayBuffer(8*vertexDataLen),this._float32View=new Float32Array(this._vertexArrayBuffer),this._vertexData=[];for(var i=0;i<8;i++)this._vertexData[i]=new cc.V3F_C4B_T2F(null,null,null,this._vertexArrayBuffer,i*vertexDataLen);gl.bindBuffer(gl.ARRAY_BUFFER,this._vertexWebGLBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._float32View,gl.DYNAMIC_DRAW),this._vertexDataCount=0,this._vertexDataDirty=!0,this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)}},proto.resetVertexData=function(){this._vertexDataCount=0},proto._updateProgressData=function(){var locType=this._node._type;locType===cc.ProgressTimer.TYPE_RADIAL?this._updateRadial():locType===cc.ProgressTimer.TYPE_BAR&&this._updateBar(),this._vertexDataDirty=!0},proto._updateProgress=function(){this.setDirtyFlag(cc.Node._dirtyFlags.textureDirty)},proto._updateBar=function(){var node=this._node;if(node._sprite){var alpha=node._percentage/100,locBarChangeRate=node._barChangeRate,alphaOffset=cc.pMult(cc.p(1-locBarChangeRate.x+alpha*locBarChangeRate.x,1-locBarChangeRate.y+alpha*locBarChangeRate.y),.5),min=cc.pSub(node._midPoint,alphaOffset),max=cc.pAdd(node._midPoint,alphaOffset);min.x<0&&(max.x+=-min.x,min.x=0),max.x>1&&(min.x-=max.x-1,max.x=1),min.y<0&&(max.y+=-min.y,min.y=0),max.y>1&&(min.y-=max.y-1,max.y=1);var locVertexData;this._reverseDirection?(locVertexData=this._vertexData,this._vertexDataCount||(this._vertexDataCount=8,this._textureCoordFromAlphaPoint(locVertexData[0].texCoords,0,1),this._vertexFromAlphaPoint(locVertexData[0].vertices,0,1),this._textureCoordFromAlphaPoint(locVertexData[1].texCoords,0,0),this._vertexFromAlphaPoint(locVertexData[1].vertices,0,0),this._textureCoordFromAlphaPoint(locVertexData[6].texCoords,1,1),this._vertexFromAlphaPoint(locVertexData[6].vertices,1,1),this._textureCoordFromAlphaPoint(locVertexData[7].texCoords,1,0),this._vertexFromAlphaPoint(locVertexData[7].vertices,1,0)),this._textureCoordFromAlphaPoint(locVertexData[2].texCoords,min.x,max.y),this._vertexFromAlphaPoint(locVertexData[2].vertices,min.x,max.y),this._textureCoordFromAlphaPoint(locVertexData[3].texCoords,min.x,min.y),this._vertexFromAlphaPoint(locVertexData[3].vertices,min.x,min.y),this._textureCoordFromAlphaPoint(locVertexData[4].texCoords,max.x,max.y),this._vertexFromAlphaPoint(locVertexData[4].vertices,max.x,max.y),this._textureCoordFromAlphaPoint(locVertexData[5].texCoords,max.x,min.y),this._vertexFromAlphaPoint(locVertexData[5].vertices,max.x,min.y)):(this._vertexDataCount||(this._vertexDataCount=4),locVertexData=this._vertexData,this._textureCoordFromAlphaPoint(locVertexData[0].texCoords,min.x,max.y),this._vertexFromAlphaPoint(locVertexData[0].vertices,min.x,max.y),this._textureCoordFromAlphaPoint(locVertexData[1].texCoords,min.x,min.y),this._vertexFromAlphaPoint(locVertexData[1].vertices,min.x,min.y),this._textureCoordFromAlphaPoint(locVertexData[2].texCoords,max.x,max.y),this._vertexFromAlphaPoint(locVertexData[2].vertices,max.x,max.y),this._textureCoordFromAlphaPoint(locVertexData[3].texCoords,max.x,min.y),this._vertexFromAlphaPoint(locVertexData[3].vertices,max.x,min.y)),this._updateColor()}},proto._updateRadial=function(){var node=this._node;if(node._sprite){var i,hit,locMidPoint=node._midPoint,alpha=node._percentage/100,angle=2*cc.PI*(node._reverseDirection?alpha:1-alpha),topMid=cc.p(locMidPoint.x,1),percentagePt=cc.pRotateByAngle(topMid,locMidPoint,angle),index=0;if(0===alpha)hit=topMid,index=0;else if(1===alpha)hit=topMid,index=4;else{var min_t=cc.FLT_MAX,locProTextCoordsCount=cc.ProgressTimer.TEXTURE_COORDS_COUNT;for(i=0;i<=locProTextCoordsCount;++i){var pIndex=(i+(locProTextCoordsCount-1))%locProTextCoordsCount,edgePtA=this._boundaryTexCoord(i%locProTextCoordsCount),edgePtB=this._boundaryTexCoord(pIndex);0===i?edgePtB=cc.pLerp(edgePtA,edgePtB,1-locMidPoint.x):4===i&&(edgePtA=cc.pLerp(edgePtA,edgePtB,1-locMidPoint.x));var retPoint=cc.p(0,0);if(cc.pLineIntersect(edgePtA,edgePtB,locMidPoint,percentagePt,retPoint)){if(!(0!==i&&4!==i||0<=retPoint.x&&retPoint.x<=1))continue;retPoint.y>=0&&retPoint.y<min_t&&(min_t=retPoint.y,index=i)}}hit=cc.pAdd(locMidPoint,cc.pMult(cc.pSub(percentagePt,locMidPoint),min_t))}var sameIndexCount=!0;this._vertexDataCount!==index+3&&(sameIndexCount=!1,this._vertexDataCount=index+3),this._updateColor();var locVertexData=this._vertexData;if(!sameIndexCount)for(this._textureCoordFromAlphaPoint(locVertexData[0].texCoords,locMidPoint.x,locMidPoint.y),this._vertexFromAlphaPoint(locVertexData[0].vertices,locMidPoint.x,locMidPoint.y),this._textureCoordFromAlphaPoint(locVertexData[1].texCoords,topMid.x,topMid.y),this._vertexFromAlphaPoint(locVertexData[1].vertices,topMid.x,topMid.y),i=0;i<index;i++){var alphaPoint=this._boundaryTexCoord(i);this._textureCoordFromAlphaPoint(locVertexData[i+2].texCoords,alphaPoint.x,alphaPoint.y),this._vertexFromAlphaPoint(locVertexData[i+2].vertices,alphaPoint.x,alphaPoint.y)}this._textureCoordFromAlphaPoint(locVertexData[this._vertexDataCount-1].texCoords,hit.x,hit.y),this._vertexFromAlphaPoint(locVertexData[this._vertexDataCount-1].vertices,hit.x,hit.y)}},proto._boundaryTexCoord=function(index){if(index<cc.ProgressTimer.TEXTURE_COORDS_COUNT){var locProTextCoords=cc.ProgressTimer.TEXTURE_COORDS;return this._node._reverseDirection?cc.p(locProTextCoords>>7-(index<<1)&1,locProTextCoords>>7-(1+(index<<1))&1):cc.p(locProTextCoords>>1+(index<<1)&1,locProTextCoords>>(index<<1)&1)}return cc.p(0,0)},proto._textureCoordFromAlphaPoint=function(coords,ax,ay){var locSprite=this._node._sprite;if(!locSprite)return coords.u=0,void(coords.v=0);var uvs=locSprite._renderCmd._vertices,bl=uvs[1],tr=uvs[2],min=cc.p(bl.u,bl.v),max=cc.p(tr.u,tr.v);if(locSprite.textureRectRotated){var temp=ax;ax=ay,ay=temp}coords.u=min.x*(1-ax)+max.x*ax,coords.v=min.y*(1-ay)+max.y*ay},proto._vertexFromAlphaPoint=function(vertex,ax,ay){vertex.x=this._bl.x*(1-ax)+this._tr.x*ax,vertex.y=this._bl.y*(1-ay)+this._tr.y*ay,vertex.z=this._node._vertexZ},proto._updateColor=function(){var sp=this._node._sprite;if(this._vertexDataCount&&sp){var color=this._displayedColor,spColor=sp._renderCmd._displayedColor,r=spColor.r,g=spColor.g,b=spColor.b,a=sp._renderCmd._displayedOpacity/255;sp._opacityModifyRGB&&(r*=a,g*=a,b*=a),color.r=r,color.g=g,color.b=b,color.a=sp._renderCmd._displayedOpacity;for(var locVertexData=this._vertexData,i=0,len=this._vertexDataCount;i<len;++i)locVertexData[i].colors=color;this._vertexDataDirty=!0}}}();