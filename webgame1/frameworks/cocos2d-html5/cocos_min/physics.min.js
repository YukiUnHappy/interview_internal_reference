!function(){var chipmunkAPI={_ignoreBodyRotation:!1,_body:null,_rotation:1,ctor:function(fileName,rect){if(cc.Sprite.prototype.ctor.call(this),void 0===fileName)cc.PhysicsSprite.prototype.init.call(this);else if(cc.isString(fileName))if("#"===fileName[0]){var frameName=fileName.substr(1,fileName.length-1),spriteFrame=cc.spriteFrameCache.getSpriteFrame(frameName);this.initWithSpriteFrame(spriteFrame)}else this.init(fileName,rect);else cc.isObject(fileName)&&(fileName instanceof cc.Texture2D?this.initWithTexture(fileName,rect):fileName instanceof cc.SpriteFrame&&this.initWithSpriteFrame(fileName));cc.renderer.pushRenderCommand(this._renderCmd)},visit:function(){cc.renderer.pushRenderCommand(this._renderCmd),cc.Sprite.prototype.visit.call(this)},setBody:function(body){this._body=body},getBody:function(){return this._body},getPosition:function(){var locBody=this._body;return{x:locBody.p.x,y:locBody.p.y}},getPositionX:function(){return this._body.p.x},getPositionY:function(){return this._body.p.y},setPosition:function(newPosOrxValue,yValue){void 0===yValue?(this._body.p.x=newPosOrxValue.x,this._body.p.y=newPosOrxValue.y):(this._body.p.x=newPosOrxValue,this._body.p.y=yValue)},setPositionX:function(xValue){this._body.p.x=xValue},setPositionY:function(yValue){this._body.p.y=yValue},_syncPosition:function(){var locPosition=this._position,locBody=this._body;locPosition.x===locBody.p.x&&locPosition.y===locBody.p.y||cc.Sprite.prototype.setPosition.call(this,locBody.p.x,locBody.p.y)},getRotation:function(){return this._ignoreBodyRotation?this._rotationX:-cc.radiansToDegrees(this._body.a)},setRotation:function(r){this._ignoreBodyRotation?cc.Sprite.prototype.setRotation.call(this,r):this._body.a=-cc.degreesToRadians(r)},_syncRotation:function(){var a=-cc.radiansToDegrees(this._body.a);this._rotationX!==a&&cc.Sprite.prototype.setRotation.call(this,a)},getNodeToParentTransform:function(){return this._renderCmd.getNodeToParentTransform()},isDirty:function(){return!this._body.isSleeping()},setDirty:function(){},setIgnoreBodyRotation:function(b){this._ignoreBodyRotation=b},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.PhysicsSprite.CanvasRenderCmd(this):new cc.PhysicsSprite.WebGLRenderCmd(this)}};cc.PhysicsSprite=cc.Sprite.extend(chipmunkAPI),cc.PhysicsSprite._className="PhysicsSprite";var _p=cc.PhysicsSprite.prototype;_p.body,cc.defineGetterSetter(_p,"body",_p.getBody,_p.setBody),_p.dirty,cc.defineGetterSetter(_p,"dirty",_p.isDirty,_p.setDirty),cc.PhysicsSprite.create=function(fileName,rect){return new cc.PhysicsSprite(fileName,rect)},cc.PhysicsSprite.createWithSpriteFrameName=cc.PhysicsSprite.create,cc.PhysicsSprite.createWithSpriteFrame=cc.PhysicsSprite.create}(),cc.__convertVerts=function(verts){for(var ret=[],i=0;i<verts.length/2;i++)ret[i]={x:verts[2*i],y:verts[2*i+1]};return ret},cc.ColorForBody=function(body){return body.isRogue()||body.isSleeping()?cc.color(128,128,128,128):body.nodeIdleTime>body.space.sleepTimeThreshold?cc.color(84,84,84,128):cc.color(255,0,0,128)},cc.DrawShape=function(shape,renderer){var body=shape.body,color=cc.ColorForBody(body);switch(shape.collisionCode){case cp.CircleShape.prototype.collisionCode:this.drawDot(shape.tc,Math.max(shape.r,1),color),this.drawSegment(shape.tc,cp.v.add(shape.tc,cp.v.mult(body.rot,shape.r)),1,color);break;case cp.SegmentShape.prototype.collisionCode:this.drawSegment(shape.ta,shape.tb,Math.max(shape.r,2),color);break;case cp.PolyShape.prototype.collisionCode:var line=cc.color(color.r,color.g,color.b,cc.lerp(color.a,255,.5));this.drawPoly(cc.__convertVerts(shape.tVerts),color,1,line);break;default:cc.log("cc.DrawShape(): Bad assertion in DrawShape()")}},cc.DrawConstraint=function(constraint,renderer){var a,b,body_a=constraint.a,body_b=constraint.b;if(constraint instanceof cp.PinJoint)a=body_a.local2World(constraint.anchr1),b=body_b.local2World(constraint.anchr2),this.drawDot(a,3,cc.CONSTRAINT_COLOR),this.drawDot(b,3,cc.CONSTRAINT_COLOR),this.drawSegment(a,b,1,cc.CONSTRAINT_COLOR);else if(constraint instanceof cp.SlideJoint)a=body_a.local2World(constraint.anchr1),b=body_b.local2World(constraint.anchr2),this.drawDot(a,3,cc.CONSTRAINT_COLOR),this.drawDot(b,3,cc.CONSTRAINT_COLOR),this.drawSegment(a,b,1,cc.CONSTRAINT_COLOR);else if(constraint instanceof cp.PivotJoint)a=body_a.local2World(constraint.anchr1),b=body_b.local2World(constraint.anchr2),this.drawDot(a,3,cc.CONSTRAINT_COLOR),this.drawDot(b,3,cc.CONSTRAINT_COLOR);else if(constraint instanceof cp.GrooveJoint){a=body_a.local2World(constraint.grv_a),b=body_a.local2World(constraint.grv_b);var c=body_b.local2World(constraint.anchr2);this.drawDot(c,3,cc.CONSTRAINT_COLOR),this.drawSegment(a,b,1,cc.CONSTRAINT_COLOR)}else cp.DampedSpring},cc.CONSTRAINT_COLOR=cc.color(0,255,0,128),cc.PhysicsDebugNode=cc.DrawNode.extend({_space:null,_className:"PhysicsDebugNode",ctor:function(space){cc.DrawNode.prototype.ctor.call(this),this._space=space},getSpace:function(){return this._space},setSpace:function(space){this._space=space},draw:function(context){this._space&&(this._space.eachShape(cc.DrawShape.bind(this)),this._space.eachConstraint(cc.DrawConstraint.bind(this)),cc.DrawNode.prototype.draw.call(this),this.clear())},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.PhysicsDebugNode.CanvasRenderCmd(this):new cc.PhysicsDebugNode.WebGLRenderCmd(this)}}),cc.PhysicsDebugNode.create=function(space){return new cc.PhysicsDebugNode(space)},function(){cc.PhysicsDebugNode.CanvasRenderCmd=function(renderableObject){this._rootCtor(renderableObject),this._buffer=renderableObject._buffer,this._needDraw=!0};var proto=cc.PhysicsDebugNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);proto.constructor=cc.PhysicsDebugNode.CanvasRenderCmd,proto.rendering=function(ctx,scaleX,scaleY){var node=this._node;node._space&&(node._space.eachShape(cc.DrawShape.bind(node)),node._space.eachConstraint(cc.DrawConstraint.bind(node)),cc.DrawNode.CanvasRenderCmd.prototype.rendering.call(this,ctx,scaleX,scaleY),node.clear())},proto._drawDot=cc.DrawNode.CanvasRenderCmd.prototype._drawDot,proto._drawSegment=cc.DrawNode.CanvasRenderCmd.prototype._drawSegment,proto._drawPoly=cc.DrawNode.CanvasRenderCmd.prototype._drawPoly}(),cc.PhysicsDebugNode.WebGLRenderCmd=function(renderableObject){this._rootCtor(renderableObject),this._needDraw=!0,this._matrix=new cc.math.Matrix4,this._matrix.identity()},cc.PhysicsDebugNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype),cc.PhysicsDebugNode.WebGLRenderCmd.prototype.constructor=cc.PhysicsDebugNode.WebGLRenderCmd,cc.PhysicsDebugNode.WebGLRenderCmd.prototype.rendering=function(ctx){var node=this._node;if(node._space){node._space.eachShape(cc.DrawShape.bind(node)),node._space.eachConstraint(cc.DrawConstraint.bind(node));var wt=this._worldTransform;this._matrix.mat[0]=wt.a,this._matrix.mat[4]=wt.c,this._matrix.mat[12]=wt.tx,this._matrix.mat[1]=wt.b,this._matrix.mat[5]=wt.d,this._matrix.mat[13]=wt.ty,cc.glBlendFunc(node._blendFunc.src,node._blendFunc.dst),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),node._render(),node.clear()}},function(){cc.PhysicsSprite.CanvasRenderCmd=function(renderableObject){this._spriteCmdCtor(renderableObject),this._needDraw=!0};var proto=cc.PhysicsSprite.CanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype);proto.constructor=cc.PhysicsSprite.CanvasRenderCmd,proto.rendering=function(ctx,scaleX,scaleY){var node=this._node;node._syncPosition(),node._ignoreBodyRotation||node._syncRotation(),this.transform(this.getParentRenderCmd()),cc.Sprite.CanvasRenderCmd.prototype.rendering.call(this,ctx,scaleX,scaleY)}}(),function(){cc.PhysicsSprite.WebGLRenderCmd=function(renderableObject){this._spriteCmdCtor(renderableObject),this._needDraw=!0};var proto=cc.PhysicsSprite.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype);proto.constructor=cc.PhysicsSprite.WebGLRenderCmd,proto.spUploadData=cc.Sprite.WebGLRenderCmd.prototype.uploadData,proto.uploadData=function(f32buffer,ui32buffer,vertexDataOffset){var node=this._node;return node._syncPosition(),node._ignoreBodyRotation||node._syncRotation(),this.transform(this.getParentRenderCmd(),!0),this.spUploadData(f32buffer,ui32buffer,vertexDataOffset)}}();