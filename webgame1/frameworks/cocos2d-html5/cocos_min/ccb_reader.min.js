function BlockData(selMenuHander,target){this.selMenuHander=selMenuHander,this.target=target}function BlockCCControlData(selCCControlHandler,target,controlEvents){this.selCCControlHandler=selCCControlHandler,this.target=target,this.controlEvents=controlEvents}var PROPERTY_POSITION="position",PROPERTY_CONTENTSIZE="contentSize",PROPERTY_SKEW="skew",PROPERTY_ANCHORPOINT="anchorPoint",PROPERTY_SCALE="scale",PROPERTY_ROTATION="rotation",PROPERTY_TAG="tag",PROPERTY_IGNOREANCHORPOINTFORPOSITION="ignoreAnchorPointForPosition",PROPERTY_VISIBLE="visible",ASSERT_FAIL_UNEXPECTED_PROPERTY=function(propertyName){cc.log("Unexpected property: '"+propertyName+"'!")},ASSERT_FAIL_UNEXPECTED_PROPERTYTYPE=function(propertyName){cc.log("Unexpected property type: '"+propertyName+"'!")};cc.NodeLoader=cc.Class.extend({_customProperties:null,_pt:null,_size:null,_arr2:null,ctor:function(){this._customProperties=new cc._Dictionary,this._pt=cc.p(),this._size=cc.size(),this._arr2=new Array(2),this._blockControlData={selCCControlHandler:null,target:null,controlEvents:null}},loadCCNode:function(parent,ccbReader){return this._createCCNode(parent,ccbReader)},parseProperties:function(node,parent,ccbReader){for(var numRegularProps=ccbReader.readInt(!1),propertyCount=numRegularProps+ccbReader.readInt(!1),i=0;i<propertyCount;i++){var isExtraProp=i>=numRegularProps,type=ccbReader.readInt(!1),propertyName=ccbReader.readCachedString(),setProp=!1,platform=ccbReader._data[ccbReader._currentByte++];if(platform!==CCB_PLATFORM_ALL&&platform!==CCB_PLATFORM_IOS&&platform!==CCB_PLATFORM_MAC||(setProp=!0),isExtraProp)if(node.ccbFileNode)setProp=-1!==(node=node.ccbFileNode).userObject.indexOf(propertyName);else if(node===ccbReader._animationManager.getRootNode()){var extraPropsNames=node.userObject;extraPropsNames||(extraPropsNames=[],node.userObject=extraPropsNames),extraPropsNames.push(propertyName)}switch(type){case CCB_PROPTYPE_POSITION:var position=this.parsePropTypePosition(node,parent,ccbReader,propertyName);setProp&&this.onHandlePropTypePosition(node,parent,propertyName,position,ccbReader);break;case CCB_PROPTYPE_POINT:var point=this.parsePropTypePoint(node,parent,ccbReader);setProp&&this.onHandlePropTypePoint(node,parent,propertyName,point,ccbReader);break;case CCB_PROPTYPE_POINTLOCK:var pointLock=this.parsePropTypePointLock(node,parent,ccbReader);setProp&&this.onHandlePropTypePointLock(node,parent,propertyName,pointLock,ccbReader);break;case CCB_PROPTYPE_SIZE:var size=this.parsePropTypeSize(node,parent,ccbReader);setProp&&this.onHandlePropTypeSize(node,parent,propertyName,size,ccbReader);break;case CCB_PROPTYPE_SCALELOCK:var scaleLock=this.parsePropTypeScaleLock(node,parent,ccbReader,propertyName);setProp&&this.onHandlePropTypeScaleLock(node,parent,propertyName,scaleLock,ccbReader);break;case CCB_PROPTYPE_FLOATXY:var xy=this.parsePropTypeFloatXY(node,parent,ccbReader);setProp&&this.onHandlePropTypeFloatXY(node,parent,propertyName,xy,ccbReader);break;case CCB_PROPTYPE_FLOAT:var f=this.parsePropTypeFloat(node,parent,ccbReader);setProp&&this.onHandlePropTypeFloat(node,parent,propertyName,f,ccbReader);break;case CCB_PROPTYPE_DEGREES:var degrees=this.parsePropTypeDegrees(node,parent,ccbReader,propertyName);setProp&&this.onHandlePropTypeDegrees(node,parent,propertyName,degrees,ccbReader);break;case CCB_PROPTYPE_FLOATSCALE:var floatScale=this.parsePropTypeFloatScale(node,parent,ccbReader);setProp&&this.onHandlePropTypeFloatScale(node,parent,propertyName,floatScale,ccbReader);break;case CCB_PROPTYPE_INTEGER:var integer=this.parsePropTypeInteger(node,parent,ccbReader);setProp&&this.onHandlePropTypeInteger(node,parent,propertyName,integer,ccbReader);break;case CCB_PROPTYPE_INTEGERLABELED:var integerLabeled=this.parsePropTypeIntegerLabeled(node,parent,ccbReader);setProp&&this.onHandlePropTypeIntegerLabeled(node,parent,propertyName,integerLabeled,ccbReader);break;case CCB_PROPTYPE_FLOATVAR:var floatVar=this.parsePropTypeFloatVar(node,parent,ccbReader);setProp&&this.onHandlePropTypeFloatVar(node,parent,propertyName,floatVar,ccbReader);break;case CCB_PROPTYPE_CHECK:var check=this.parsePropTypeCheck(node,parent,ccbReader,propertyName);setProp&&this.onHandlePropTypeCheck(node,parent,propertyName,check,ccbReader);break;case CCB_PROPTYPE_SPRITEFRAME:var ccSpriteFrame=this.parsePropTypeSpriteFrame(node,parent,ccbReader,propertyName);setProp&&this.onHandlePropTypeSpriteFrame(node,parent,propertyName,ccSpriteFrame,ccbReader);break;case CCB_PROPTYPE_ANIMATION:var ccAnimation=this.parsePropTypeAnimation(node,parent,ccbReader);setProp&&this.onHandlePropTypeAnimation(node,parent,propertyName,ccAnimation,ccbReader);break;case CCB_PROPTYPE_TEXTURE:var ccTexture2D=this.parsePropTypeTexture(node,parent,ccbReader);setProp&&this.onHandlePropTypeTexture(node,parent,propertyName,ccTexture2D,ccbReader);break;case CCB_PROPTYPE_BYTE:var byteValue=this.parsePropTypeByte(node,parent,ccbReader,propertyName);setProp&&this.onHandlePropTypeByte(node,parent,propertyName,byteValue,ccbReader);break;case CCB_PROPTYPE_COLOR3:var color=this.parsePropTypeColor3(node,parent,ccbReader,propertyName);setProp&&this.onHandlePropTypeColor3(node,parent,propertyName,color,ccbReader);break;case CCB_PROPTYPE_COLOR4VAR:var color4FVar=this.parsePropTypeColor4FVar(node,parent,ccbReader);setProp&&this.onHandlePropTypeColor4FVar(node,parent,propertyName,color4FVar,ccbReader);break;case CCB_PROPTYPE_FLIP:var flip=this.parsePropTypeFlip(node,parent,ccbReader);setProp&&this.onHandlePropTypeFlip(node,parent,propertyName,flip,ccbReader);break;case CCB_PROPTYPE_BLENDMODE:var blendFunc=this.parsePropTypeBlendFunc(node,parent,ccbReader);setProp&&this.onHandlePropTypeBlendFunc(node,parent,propertyName,blendFunc,ccbReader);break;case CCB_PROPTYPE_FNTFILE:var fntFile=ccbReader.getCCBRootPath()+this.parsePropTypeFntFile(node,parent,ccbReader);setProp&&this.onHandlePropTypeFntFile(node,parent,propertyName,fntFile,ccbReader);break;case CCB_PROPTYPE_FONTTTF:var fontTTF=this.parsePropTypeFontTTF(node,parent,ccbReader);setProp&&this.onHandlePropTypeFontTTF(node,parent,propertyName,fontTTF,ccbReader);break;case CCB_PROPTYPE_STRING:var stringValue=this.parsePropTypeString(node,parent,ccbReader);setProp&&this.onHandlePropTypeString(node,parent,propertyName,stringValue,ccbReader);break;case CCB_PROPTYPE_TEXT:var textValue=this.parsePropTypeText(node,parent,ccbReader);setProp&&this.onHandlePropTypeText(node,parent,propertyName,textValue,ccbReader);break;case CCB_PROPTYPE_BLOCK:var blockData=this.parsePropTypeBlock(node,parent,ccbReader);setProp&&this.onHandlePropTypeBlock(node,parent,propertyName,blockData,ccbReader);break;case CCB_PROPTYPE_BLOCKCCCONTROL:var blockCCControlData=this.parsePropTypeBlockCCControl(node,parent,ccbReader);setProp&&null!=blockCCControlData&&this.onHandlePropTypeBlockCCControl(node,parent,propertyName,blockCCControlData,ccbReader);break;case CCB_PROPTYPE_CCBFILE:var ccbFileNode=this.parsePropTypeCCBFile(node,parent,ccbReader);setProp&&this.onHandlePropTypeCCBFile(node,parent,propertyName,ccbFileNode,ccbReader);break;default:ASSERT_FAIL_UNEXPECTED_PROPERTYTYPE(type)}}},getCustomProperties:function(){return this._customProperties},_createCCNode:function(parent,ccbReader){return new cc.Node},parsePropTypePosition:function(node,parent,ccbReader,propertyName){var x=ccbReader.readFloat(),y=ccbReader.readFloat(),type=ccbReader.readInt(!1),containerSize=parent?parent._contentSize:ccbReader._animationManager._rootContainerSize;if(cc.getAbsolutePosition(x,y,type,containerSize,propertyName,this._pt),node.setPosition(this._pt),ccbReader._animatedProps.indexOf(propertyName)>-1){var baseValue=[x,y,type];ccbReader._animationManager.setBaseValue(baseValue,node,propertyName)}return this._pt},parsePropTypePoint:function(node,parent,ccbReader){return this._pt.x=ccbReader.readFloat(),this._pt.y=ccbReader.readFloat(),this._pt},parsePropTypePointLock:function(node,parent,ccbReader){return this._pt.x=ccbReader.readFloat(),this._pt.y=ccbReader.readFloat(),this._pt},parsePropTypeSize:function(node,parent,ccbReader){var width=ccbReader.readFloat(),height=ccbReader.readFloat(),type=ccbReader.readInt(!1),containerSize=parent?parent._contentSize:ccbReader._animationManager._rootContainerSize;switch(type){case CCB_SIZETYPE_ABSOLUTE:break;case CCB_SIZETYPE_RELATIVE_CONTAINER:width=containerSize.width-width,height=containerSize.height-height;break;case CCB_SIZETYPE_PERCENT:width=containerSize.width*width/100,height=containerSize.height*height/100;break;case CCB_SIZETYPE_HORIZONTAL_PERCENT:width=containerSize.width*width/100;break;case CCB_SIZETYPE_VERTICAL_PERCENT:height=containerSize.height*height/100;break;case CCB_SIZETYPE_MULTIPLY_RESOLUTION:var resolutionScale=cc.BuilderReader.getResolutionScale();width*=resolutionScale,height*=resolutionScale;break;default:cc.log("Unknown CCB type.")}return this._size.width=width,this._size.height=height,this._size},parsePropTypeScaleLock:function(node,parent,ccbReader,propertyName){var x=ccbReader.readFloat(),y=ccbReader.readFloat(),type=ccbReader.readInt(!1);if(ccbReader._animatedProps.indexOf(propertyName)>-1&&ccbReader._animationManager.setBaseValue([x,y,type],node,propertyName),type===CCB_SCALETYPE_MULTIPLY_RESOLUTION){var resolutionScale=cc.BuilderReader.getResolutionScale();x*=resolutionScale,y*=resolutionScale}return this._pt.x=x,this._pt.y=y,this._pt},parsePropTypeFloat:function(node,parent,ccbReader){return ccbReader.readFloat()},parsePropTypeDegrees:function(node,parent,ccbReader,propertyName){var degrees=ccbReader.readFloat();return ccbReader._animatedProps.indexOf(propertyName)>-1&&ccbReader._animationManager.setBaseValue(degrees,node,propertyName),degrees},parsePropTypeFloatScale:function(node,parent,ccbReader){var f=ccbReader.readFloat();return ccbReader.readInt(!1)===CCB_SCALETYPE_MULTIPLY_RESOLUTION&&(f*=cc.BuilderReader.getResolutionScale()),f},parsePropTypeInteger:function(node,parent,ccbReader){return ccbReader.readInt(!0)},parsePropTypeIntegerLabeled:function(node,parent,ccbReader){return ccbReader.readInt(!0)},parsePropTypeFloatVar:function(node,parent,ccbReader){return this._arr2[0]=ccbReader.readFloat(),this._arr2[1]=ccbReader.readFloat(),this._arr2},parsePropTypeCheck:function(node,parent,ccbReader,propertyName){var check=!!ccbReader._data[ccbReader._currentByte++];return ccbReader._animatedProps.indexOf(propertyName)>-1&&ccbReader._animationManager.setBaseValue(check,node,propertyName),check},parsePropTypeSpriteFrame:function(node,parent,ccbReader,propertyName){var spriteFrame,spriteSheet=ccbReader.readCachedString(),spriteFile=ccbReader.readCachedString();if(spriteFile){if(0===spriteSheet.length){spriteFile=ccbReader._ccbRootPath+spriteFile;var texture=cc.textureCache.addImage(spriteFile),locContentSize=texture.getContentSize(),bounds=cc.rect(0,0,locContentSize.width,locContentSize.height);spriteFrame=new cc.SpriteFrame(texture,bounds)}else{var frameCache=cc.spriteFrameCache;spriteSheet=ccbReader._ccbRootPath+spriteSheet,-1===ccbReader._loadedSpriteSheets.indexOf(spriteSheet)&&(frameCache.addSpriteFrames(spriteSheet),ccbReader._loadedSpriteSheets.push(spriteSheet)),spriteFrame=frameCache.getSpriteFrame(spriteFile)}ccbReader._animatedProps.indexOf(propertyName)>-1&&ccbReader._animationManager.setBaseValue(spriteFrame,node,propertyName)}return spriteFrame},parsePropTypeAnimation:function(node,parent,ccbReader){var animationFile=ccbReader._ccbRootPath+ccbReader.readCachedString(),animation=ccbReader.readCachedString(),ccAnimation=null;if(animation=cc.BuilderReader.lastPathComponent(animation),animationFile=cc.BuilderReader.lastPathComponent(animationFile),animation){var animationCache=cc.animationCache;animationCache.addAnimations(animationFile),ccAnimation=animationCache.getAnimation(animation)}return ccAnimation},parsePropTypeTexture:function(node,parent,ccbReader){var spriteFile=ccbReader._ccbRootPath+ccbReader.readCachedString();return spriteFile?cc.textureCache.addImage(spriteFile):null},parsePropTypeByte:function(node,parent,ccbReader,propertyName){var ret=ccbReader._data[ccbReader._currentByte++];return ccbReader._animatedProps.indexOf(propertyName)>-1&&ccbReader._animationManager.setBaseValue(ret,node,propertyName),ret},parsePropTypeColor3:function(node,parent,ccbReader,propertyName){var red=ccbReader._data[ccbReader._currentByte++],green=ccbReader._data[ccbReader._currentByte++],blue=ccbReader._data[ccbReader._currentByte++],color=cc.color(red,green,blue);return ccbReader._animatedProps.indexOf(propertyName)>-1&&ccbReader._animationManager.setBaseValue(color,node,propertyName),color},parsePropTypeColor4FVar:function(node,parent,ccbReader){var red=0|255*ccbReader.readFloat(),green=0|255*ccbReader.readFloat(),blue=0|255*ccbReader.readFloat(),alpha=ccbReader.readFloat();alpha=alpha<=1?0|255*alpha:alpha;var redVar=0|255*ccbReader.readFloat(),greenVar=0|255*ccbReader.readFloat(),blueVar=0|255*ccbReader.readFloat(),alphaVar=ccbReader.readFloat();return alphaVar=alphaVar<=1?0|255*alphaVar:alphaVar,this._arr2[0]={r:red,g:green,b:blue,a:alpha},this._arr2[1]={r:redVar,g:greenVar,b:blueVar,a:alphaVar},this._arr2},parsePropTypeFlip:function(node,parent,ccbReader){return this._arr2[0]=!!ccbReader._data[ccbReader._currentByte++],this._arr2[1]=!!ccbReader._data[ccbReader._currentByte++],this._arr2},parsePropTypeBlendFunc:function(node,parent,ccbReader){var source=ccbReader.readInt(!1),destination=ccbReader.readInt(!1);return new cc.BlendFunc(source,destination)},parsePropTypeFntFile:function(node,parent,ccbReader){return ccbReader.readCachedString()},parsePropTypeString:function(node,parent,ccbReader){return ccbReader.readCachedString()},parsePropTypeText:function(node,parent,ccbReader){return ccbReader.readCachedString()},parsePropTypeFontTTF:function(node,parent,ccbReader){return ccbReader.readCachedString()},parsePropTypeBlock:function(node,parent,ccbReader){var selectorName=ccbReader.readCachedString(),selectorTarget=ccbReader.readInt(!1);if(selectorTarget!==CCB_TARGETTYPE_NONE){var target=null;if(ccbReader._jsControlled)selectorTarget===CCB_TARGETTYPE_DOCUMENTROOT?(ccbReader.addDocumentCallbackNode(node),ccbReader.addDocumentCallbackName(selectorName),ccbReader.addDocumentCallbackControlEvents(0)):(ccbReader.addOwnerCallbackNode(node),ccbReader.addOwnerCallbackName(selectorName),ccbReader.addOwnerCallbackControlEvents(0));else if(selectorTarget===CCB_TARGETTYPE_DOCUMENTROOT?target=ccbReader._animationManager._rootNode:selectorTarget===CCB_TARGETTYPE_OWNER&&(target=ccbReader._owner),null!==target)if(selectorName.length>0){var selMenuHandler=0;if(target.onResolveCCBCCMenuItemSelector&&(selMenuHandler=target.onResolveCCBCCMenuItemSelector(target,selectorName)),0===selMenuHandler){var ccbSelectorResolver=ccbReader._ccbSelectorResolver;ccbSelectorResolver&&(selMenuHandler=ccbSelectorResolver.onResolveCCBCCMenuItemSelector(target,selectorName))}if(0!==selMenuHandler)return new BlockData(selMenuHandler,target);cc.log("Skipping selector '"+selectorName+"' since no CCBSelectorResolver is present.")}else cc.log("Unexpected empty selector.");else cc.log("Unexpected NULL target for selector.")}return null},parsePropTypeBlockCCControl:function(node,parent,ccbReader){var selectorName=ccbReader.readCachedString(),selectorTarget=ccbReader.readInt(!1),controlEvents=ccbReader.readInt(!1);if(selectorTarget!==CCB_TARGETTYPE_NONE)if(ccbReader._jsControlled)selectorTarget===CCB_TARGETTYPE_DOCUMENTROOT?(ccbReader.addDocumentCallbackNode(node),ccbReader.addDocumentCallbackName(selectorName),ccbReader.addDocumentCallbackControlEvents(controlEvents)):(ccbReader.addOwnerCallbackNode(node),ccbReader.addOwnerCallbackName(selectorName),ccbReader.addOwnerCallbackControlEvents(controlEvents));else{var target=null;if(selectorTarget===CCB_TARGETTYPE_DOCUMENTROOT?target=ccbReader._animationManager._rootNode:selectorTarget===CCB_TARGETTYPE_OWNER&&(target=ccbReader._owner),null!==target)if(selectorName.length>0){var selCCControlHandler=0;if(target.onResolveCCBCCControlSelector&&(selCCControlHandler=target.onResolveCCBCCControlSelector(target,selectorName)),0===selCCControlHandler){var ccbSelectorResolver=ccbReader._ccbSelectorResolver;null!=ccbSelectorResolver&&(selCCControlHandler=ccbSelectorResolver.onResolveCCBCCControlSelector(target,selectorName))}if(0!==selCCControlHandler)return this._blockControlData.selCCControlHandler=selCCControlHandler,this._blockControlData.target=target,this._blockControlData.controlEvents=controlEvents,this._blockControlData;cc.log("Skipping selector '"+selectorName+"' since no CCBSelectorResolver is present.")}else cc.log("Unexpected empty selector.");else cc.log("Unexpected NULL target for selector.")}return null},parsePropTypeCCBFile:function(node,parent,ccbReader){var ccbFileName=ccbReader._ccbRootPath+ccbReader.readCachedString();ccbFileName=cc.BuilderReader.deletePathExtension(ccbFileName)+".ccbi";var myCCBReader=new cc.BuilderReader(ccbReader),bytes=cc.loader.getRes(ccbFileName);if(!bytes){var realUrl=cc.loader.getUrl(ccbFileName);realUrl=hlddz.convertToDownloadURL(realUrl),bytes=cc.loader.loadBinarySync(realUrl),cc.loader.cache[ccbFileName]=bytes}myCCBReader.initWithData(bytes,ccbReader._owner),myCCBReader._animationManager.setRootContainerSize(parent._contentSize),myCCBReader.setAnimationManagers(ccbReader._animationManagers),myCCBReader._animationManager.setOwner(ccbReader._owner);var ccbFileNode=myCCBReader.readFileWithCleanUp(!1);return ccbReader.setAnimationManagers(myCCBReader._animationManagers),ccbFileNode&&-1!==myCCBReader._animationManager._autoPlaySequenceId&&myCCBReader._animationManager.runAnimations(myCCBReader._animationManager._autoPlaySequenceId,0),ccbFileNode},parsePropTypeFloatXY:function(node,parent,ccbReader){return this._pt.x=ccbReader.readFloat(),this._pt.y=ccbReader.readFloat(),this._pt},onHandlePropTypePosition:function(node,parent,propertyName,position,ccbReader){propertyName===PROPERTY_POSITION?node.setPosition(position):ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypePoint:function(node,parent,propertyName,position,ccbReader){propertyName===PROPERTY_ANCHORPOINT?node.setAnchorPoint(position):ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypePointLock:function(node,parent,propertyName,pointLock,ccbReader){ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeSize:function(node,parent,propertyName,sizeValue,ccbReader){propertyName===PROPERTY_CONTENTSIZE?node.setContentSize(sizeValue):ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeScaleLock:function(node,parent,propertyName,scaleLock,ccbReader){propertyName===PROPERTY_SCALE?node.setScale(scaleLock.x,scaleLock.y):ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeFloatXY:function(node,parent,propertyName,xy,ccbReader){if(propertyName===PROPERTY_SKEW)node._skewX=xy.x,node._skewY=xy.y;else{var nameX=propertyName+"X",nameY=propertyName+"Y";node[nameX]&&node[nameY]||ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName),node[nameX](xy.x),node[nameY](xy.y)}},onHandlePropTypeFloat:function(node,parent,propertyName,floatValue,ccbReader){this._customProperties.setObject(floatValue,propertyName)},onHandlePropTypeDegrees:function(node,parent,propertyName,degrees,ccbReader){propertyName===PROPERTY_ROTATION?node.setRotation(degrees):ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeFloatScale:function(node,parent,propertyName,floatScale,ccbReader){ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeInteger:function(node,parent,propertyName,integer,ccbReader){propertyName===PROPERTY_TAG?node.tag=integer:ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeIntegerLabeled:function(node,parent,propertyName,integerLabeled,ccbReader){ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeFloatVar:function(node,parent,propertyName,floatVar,ccbReader){ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeCheck:function(node,parent,propertyName,check,ccbReader){propertyName===PROPERTY_VISIBLE?node._visible=check:propertyName===PROPERTY_IGNOREANCHORPOINTFORPOSITION?node._ignoreAnchorPointForPosition=check:ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeSpriteFrame:function(node,parent,propertyName,spriteFrame,ccbReader){ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeAnimation:function(node,parent,propertyName,ccAnimation,ccbReader){ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeTexture:function(node,parent,propertyName,ccTexture2D,ccbReader){ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeByte:function(node,parent,propertyName,byteValue,ccbReader){ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeColor3:function(node,parent,propertyName,ccColor3B,ccbReader){ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeColor4FVar:function(node,parent,propertyName,ccColor4FVar,ccbReader){ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeFlip:function(node,parent,propertyName,flip,ccbReader){ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeBlendFunc:function(node,parent,propertyName,ccBlendFunc,ccbReader){ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeFntFile:function(node,parent,propertyName,fntFile,ccbReader){ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeString:function(node,parent,propertyName,strValue,ccbReader){this._customProperties.setObject(strValue,propertyName)},onHandlePropTypeText:function(node,parent,propertyName,textValue,ccbReader){ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeFontTTF:function(node,parent,propertyName,fontTTF,ccbReader){ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeBlock:function(node,parent,propertyName,blockData,ccbReader){ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeBlockCCControl:function(node,parent,propertyName,blockCCControlData,ccbReader){ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)},onHandlePropTypeCCBFile:function(node,parent,propertyName,ccbFileNode,ccbReader){ASSERT_FAIL_UNEXPECTED_PROPERTY(propertyName)}}),cc.NodeLoader.loader=function(){return new cc.NodeLoader},cc.NodeLoaderListener=cc.Class.extend({onNodeLoaded:function(node,nodeLoader){}}),cc.BuilderSelectorResolver=cc.Class.extend({onResolveCCBCCMenuItemSelector:function(target,selectorName){},onResolveCCBCCCallFuncSelector:function(target,selectorName){},onResolveCCBCCControlSelector:function(target,selectorName){}}),cc.BuilderScriptOwnerProtocol=cc.Class.extend({createNew:function(){}}),cc.BuilderMemberVariableAssigner=cc.Class.extend({onAssignCCBMemberVariable:function(target,memberVariableName,node){return!1},onAssignCCBCustomProperty:function(target,memberVariableName,value){return!1}});var PROPERTY_CCBFILE="ccbFile";cc.BuilderFileLoader=cc.NodeLoader.extend({_createCCNode:function(parent,ccbReader){var node=new cc.Node;return node.ccbFileNode=null,node},onHandlePropTypeCCBFile:function(node,parent,propertyName,ccbFileNode,ccbReader){propertyName===PROPERTY_CCBFILE?node.ccbFileNode=ccbFileNode:cc.NodeLoader.prototype.onHandlePropTypeCCBFile.call(this,node,parent,propertyName,ccbFileNode,ccbReader)}}),cc.BuilderFileLoader.loader=function(){return new cc.BuilderFileLoader};var PROPERTY_ENABLED="enabled",PROPERTY_SELECTED="selected",PROPERTY_CCCONTROL="ccControl";cc.ControlLoader=cc.NodeLoader.extend({_createCCNode:function(parent,ccbReander){},onHandlePropTypeBlockCCControl:function(node,parent,propertyName,blockCCControlData,ccbReader){propertyName===PROPERTY_CCCONTROL?node.addTargetWithActionForControlEvents(blockCCControlData.target,blockCCControlData.selCCControlHandler,blockCCControlData.controlEvents):cc.NodeLoader.prototype.onHandlePropTypeBlockCCControl.call(this,node,parent,propertyName,blockCCControlData,ccbReader)},onHandlePropTypeCheck:function(node,parent,propertyName,check,ccbReader){propertyName===PROPERTY_ENABLED?node.setEnabled(check):propertyName===PROPERTY_SELECTED?node.setSelected(check):cc.NodeLoader.prototype.onHandlePropTypeCheck.call(this,node,parent,propertyName,check,ccbReader)}});var PROPERTY_ZOOMONTOUCHDOWN="zoomOnTouchDown",PROPERTY_TITLE_NORMAL="title|1",PROPERTY_TITLE_HIGHLIGHTED="title|2",PROPERTY_TITLE_DISABLED="title|3",PROPERTY_TITLECOLOR_NORMAL="titleColor|1",PROPERTY_TITLECOLOR_HIGHLIGHTED="titleColor|2",PROPERTY_TITLECOLOR_DISABLED="titleColor|3",PROPERTY_TITLETTF_NORMAL="titleTTF|1",PROPERTY_TITLETTF_HIGHLIGHTED="titleTTF|2",PROPERTY_TITLETTF_DISABLED="titleTTF|3",PROPERTY_TITLETTFSIZE_NORMAL="titleTTFSize|1",PROPERTY_TITLETTFSIZE_HIGHLIGHTED="titleTTFSize|2",PROPERTY_TITLETTFSIZE_DISABLED="titleTTFSize|4",PROPERTY_LABELANCHORPOINT="labelAnchorPoint",PROPERTY_PREFEREDSIZE="preferedSize",PROPERTY_BACKGROUNDSPRITEFRAME_NORMAL="backgroundSpriteFrame|1",PROPERTY_BACKGROUNDSPRITEFRAME_HIGHLIGHTED="backgroundSpriteFrame|2",PROPERTY_BACKGROUNDSPRITEFRAME_DISABLED="backgroundSpriteFrame|3";cc.ControlButtonLoader=cc.ControlLoader.extend({_createCCNode:function(parent,ccbReader){return new cc.ControlButton},onHandlePropTypeCheck:function(node,parent,propertyName,check,ccbReader){propertyName===PROPERTY_ZOOMONTOUCHDOWN?node.zoomOnTouchDown=check:cc.ControlLoader.prototype.onHandlePropTypeCheck.call(this,node,parent,propertyName,check,ccbReader)},onHandlePropTypeString:function(node,parent,propertyName,stringValue,ccbReader){propertyName===PROPERTY_TITLE_NORMAL?node.setTitleForState(stringValue,cc.CONTROL_STATE_NORMAL):propertyName===PROPERTY_TITLE_HIGHLIGHTED?node.setTitleForState(stringValue,cc.CONTROL_STATE_HIGHLIGHTED):propertyName===PROPERTY_TITLE_DISABLED?node.setTitleForState(stringValue,cc.CONTROL_STATE_DISABLED):cc.ControlLoader.prototype.onHandlePropTypeString.call(this,node,parent,propertyName,stringValue,ccbReader)},onHandlePropTypeFontTTF:function(node,parent,propertyName,fontTTF,ccbReader){propertyName===PROPERTY_TITLETTF_NORMAL?node.setTitleTTFForState(fontTTF,cc.CONTROL_STATE_NORMAL):propertyName===PROPERTY_TITLETTF_HIGHLIGHTED?node.setTitleTTFForState(fontTTF,cc.CONTROL_STATE_HIGHLIGHTED):propertyName===PROPERTY_TITLETTF_DISABLED?node.setTitleTTFForState(fontTTF,cc.CONTROL_STATE_DISABLED):cc.ControlLoader.prototype.onHandlePropTypeFontTTF.call(this,node,parent,propertyName,fontTTF,ccbReader)},onHandlePropTypeFloatScale:function(node,parent,propertyName,floatScale,ccbReader){propertyName===PROPERTY_TITLETTFSIZE_NORMAL?node.setTitleTTFSizeForState(floatScale,cc.CONTROL_STATE_NORMAL):propertyName===PROPERTY_TITLETTFSIZE_HIGHLIGHTED?node.setTitleTTFSizeForState(floatScale,cc.CONTROL_STATE_HIGHLIGHTED):propertyName===PROPERTY_TITLETTFSIZE_DISABLED?node.setTitleTTFSizeForState(floatScale,cc.CONTROL_STATE_DISABLED):cc.ControlLoader.prototype.onHandlePropTypeFloatScale.call(this,node,parent,propertyName,floatScale,ccbReader)},onHandlePropTypePoint:function(node,parent,propertyName,point,ccbReader){propertyName===PROPERTY_LABELANCHORPOINT?node.setLabelAnchorPoint(point):cc.ControlLoader.prototype.onHandlePropTypePoint.call(this,node,parent,propertyName,point,ccbReader)},onHandlePropTypeSize:function(node,parent,propertyName,size,ccbReader){propertyName===PROPERTY_PREFEREDSIZE?node.setPreferredSize(size):cc.ControlLoader.prototype.onHandlePropTypeSize.call(this,node,parent,propertyName,size,ccbReader)},onHandlePropTypeSpriteFrame:function(node,parent,propertyName,spriteFrame,ccbReader){propertyName===PROPERTY_BACKGROUNDSPRITEFRAME_NORMAL?null!=spriteFrame&&node.setBackgroundSpriteFrameForState(spriteFrame,cc.CONTROL_STATE_NORMAL):propertyName===PROPERTY_BACKGROUNDSPRITEFRAME_HIGHLIGHTED?null!=spriteFrame&&node.setBackgroundSpriteFrameForState(spriteFrame,cc.CONTROL_STATE_HIGHLIGHTED):propertyName===PROPERTY_BACKGROUNDSPRITEFRAME_DISABLED?null!=spriteFrame&&node.setBackgroundSpriteFrameForState(spriteFrame,cc.CONTROL_STATE_DISABLED):cc.ControlLoader.prototype.onHandlePropTypeSpriteFrame.call(this,node,parent,propertyName,spriteFrame,ccbReader)},onHandlePropTypeColor3:function(node,parent,propertyName,ccColor3B,ccbReader){propertyName===PROPERTY_TITLECOLOR_NORMAL?node.setTitleColorForState(ccColor3B,cc.CONTROL_STATE_NORMAL):propertyName===PROPERTY_TITLECOLOR_HIGHLIGHTED?node.setTitleColorForState(ccColor3B,cc.CONTROL_STATE_HIGHLIGHTED):propertyName===PROPERTY_TITLECOLOR_DISABLED?node.setTitleColorForState(ccColor3B,cc.CONTROL_STATE_DISABLED):cc.ControlLoader.prototype.onHandlePropTypeColor3.call(this,node,parent,propertyName,ccColor3B,ccbReader)}}),cc.ControlButtonLoader.loader=function(){return new cc.ControlButtonLoader};var PROPERTY_CONTAINER="container",PROPERTY_DIRECTION="direction",PROPERTY_CLIPSTOBOUNDS="clipsToBounds",PROPERTY_BOUNCES="bounces",PROPERTY_SCALE="scale";cc.ScrollViewLoader=cc.NodeLoader.extend({_createCCNode:function(parent,ccbReader){return new cc.ScrollView},onHandlePropTypeSize:function(node,parent,propertyName,size,ccbReader){propertyName===PROPERTY_CONTENTSIZE?node.setViewSize(size):cc.NodeLoader.prototype.onHandlePropTypeSize.call(this,node,parent,propertyName,size,ccbReader)},onHandlePropTypeCCBFile:function(node,parent,propertyName,ccbFileNode,ccbReader){propertyName===PROPERTY_CONTAINER?(node.setContainer(ccbFileNode),node.updateInset()):cc.NodeLoader.prototype.onHandlePropTypeCCBFile.call(this,node,parent,propertyName,ccbFileNode,ccbReader)},onHandlePropTypeCheck:function(node,parent,propertyName,check,ccbReader){propertyName===PROPERTY_CLIPSTOBOUNDS?node.setClippingToBounds(check):propertyName===PROPERTY_BOUNCES?node.setBounceable(check):cc.NodeLoader.prototype.onHandlePropTypeCheck.call(this,node,parent,propertyName,check,ccbReader)},onHandlePropTypeFloat:function(node,parent,propertyName,floatValue,ccbReader){propertyName===PROPERTY_SCALE?node.setScale(floatValue):cc.NodeLoader.prototype.onHandlePropTypeFloat.call(this,node,parent,propertyName,floatValue,ccbReader)},onHandlePropTypeIntegerLabeled:function(node,parent,propertyName,integerLabeled,ccbReader){propertyName===PROPERTY_DIRECTION?node.setDirection(integerLabeled):cc.NodeLoader.prototype.onHandlePropTypeIntegerLabeled.call(this,node,parent,propertyName,integerLabeled,ccbReader)}}),cc.ScrollViewLoader.loader=function(){return new cc.ScrollViewLoader};var PROPERTY_CONTENTSIZE="contentSize",PROPERTY_SPRITEFRAME="spriteFrame",PROPERTY_COLOR="color",PROPERTY_OPACITY="opacity",PROPERTY_BLENDFUNC="blendFunc",PROPERTY_INSETLEFT="insetLeft",PROPERTY_INSETTOP="insetTop",PROPERTY_INSETRIGHT="insetRight",PROPERTY_INSETBOTTOM="insetBottom";cc.Scale9SpriteLoader=cc.NodeLoader.extend({_createCCNode:function(parent,ccbReader){var sprite=new cc.Scale9Sprite;return sprite.setAnchorPoint(0,0),sprite},onHandlePropTypeColor3:function(node,parent,propertyName,ccColor3B,ccbReader){propertyName===PROPERTY_COLOR?255===ccColor3B.r&&255===ccColor3B.g&&255===ccColor3B.b||node.setColor(ccColor3B):cc.NodeLoader.prototype.onHandlePropTypeColor3.call(this,node,parent,propertyName,ccColor3B,ccbReader)},onHandlePropTypeByte:function(node,parent,propertyName,byteValue,ccbReader){propertyName===PROPERTY_OPACITY?node.setOpacity(byteValue):cc.NodeLoader.prototype.onHandlePropTypeByte.call(this,node,parent,propertyName,byteValue,ccbReader)},onHandlePropTypeBlendFunc:function(node,parent,propertyName,ccBlendFunc,ccbReader){propertyName===PROPERTY_BLENDFUNC||cc.NodeLoader.prototype.onHandlePropTypeBlendFunc.call(this,node,parent,propertyName,ccBlendFunc,ccbReader)},onHandlePropTypeSpriteFrame:function(node,parent,propertyName,spriteFrame,ccbReader){propertyName===PROPERTY_SPRITEFRAME?node.setSpriteFrame(spriteFrame):cc.NodeLoader.prototype.onHandlePropTypeSpriteFrame.call(this,node,parent,propertyName,spriteFrame,ccbReader)},onHandlePropTypeSize:function(node,parent,propertyName,size,ccbReader){propertyName===PROPERTY_CONTENTSIZE||(propertyName===PROPERTY_PREFEREDSIZE?node.setPreferredSize(size):cc.NodeLoader.prototype.onHandlePropTypeSize.call(this,node,parent,propertyName,size,ccbReader))},onHandlePropTypeFloat:function(node,parent,propertyName,floatValue,ccbReader){propertyName===PROPERTY_INSETLEFT?node.setInsetLeft(floatValue):propertyName===PROPERTY_INSETTOP?node.setInsetTop(floatValue):propertyName===PROPERTY_INSETRIGHT?node.setInsetRight(floatValue):propertyName===PROPERTY_INSETBOTTOM?node.setInsetBottom(floatValue):cc.NodeLoader.prototype.onHandlePropTypeFloat.call(this,node,parent,propertyName,floatValue,ccbReader)}}),cc.Scale9SpriteLoader.loader=function(){return new cc.Scale9SpriteLoader};var PROPERTY_FLIP="flip",PROPERTY_DISPLAYFRAME="displayFrame",PROPERTY_COLOR="color",PROPERTY_OPACITY="opacity",PROPERTY_BLENDFUNC="blendFunc";cc.SpriteLoader=cc.NodeLoader.extend({_createCCNode:function(parent,ccbReader){return new cc.Sprite},onHandlePropTypeColor3:function(node,parent,propertyName,ccColor3B,ccbReader){propertyName===PROPERTY_COLOR?255===ccColor3B.r&&255===ccColor3B.g&&255===ccColor3B.b||node.setColor(ccColor3B):cc.NodeLoader.prototype.onHandlePropTypeColor3.call(this,node,parent,propertyName,ccColor3B,ccbReader)},onHandlePropTypeByte:function(node,parent,propertyName,byteValue,ccbReader){propertyName===PROPERTY_OPACITY?node.setOpacity(byteValue):cc.NodeLoader.prototype.onHandlePropTypeByte.call(this,node,parent,propertyName,byteValue,ccbReader)},onHandlePropTypeBlendFunc:function(node,parent,propertyName,ccbBlendFunc,ccbReader){propertyName===PROPERTY_BLENDFUNC?node.setBlendFunc(ccbBlendFunc):cc.NodeLoader.prototype.onHandlePropTypeBlendFunc.call(this,node,parent,propertyName,ccbBlendFunc,ccbReader)},onHandlePropTypeSpriteFrame:function(node,parent,propertyName,ccSpriteFrame,ccbReader){propertyName===PROPERTY_DISPLAYFRAME?ccSpriteFrame?node.setSpriteFrame(ccSpriteFrame):cc.log("ERROR: SpriteFrame is null"):cc.NodeLoader.prototype.onHandlePropTypeSpriteFrame.call(this,node,parent,propertyName,ccSpriteFrame,ccbReader)},onHandlePropTypeFlip:function(node,parent,propertyName,flip,ccbReader){propertyName===PROPERTY_FLIP?(node.setFlippedX(flip[0]),node.setFlippedY(flip[1])):cc.NodeLoader.prototype.onHandlePropTypeFlip.call(this,node,parent,propertyName,flip,ccbReader)}}),cc.SpriteLoader.loader=function(){return new cc.SpriteLoader};var PROPERTY_TOUCH_ENABLED="touchEnabled",PROPERTY_IS_TOUCH_ENABLED="isTouchEnabled",PROPERTY_ACCELEROMETER_ENABLED="accelerometerEnabled",PROPERTY_IS_ACCELEROMETER_ENABLED="isAccelerometerEnabled",PROPERTY_IS_MOUSE_ENABLED="isMouseEnabled",PROPERTY_MOUSE_ENABLED="mouseEnabled",PROPERTY_KEYBOARD_ENABLED="keyboardEnabled",PROPERTY_IS_KEYBOARD_ENABLED="isKeyboardEnabled";cc.LayerLoader=cc.NodeLoader.extend({_createCCNode:function(parent,ccbReader){var layer=new cc.Layer;return layer.setContentSize(0,0),layer},onHandlePropTypeCheck:function(node,parent,propertyName,check,ccbReader){propertyName===PROPERTY_TOUCH_ENABLED||propertyName===PROPERTY_IS_TOUCH_ENABLED||propertyName===PROPERTY_ACCELEROMETER_ENABLED||propertyName===PROPERTY_IS_ACCELEROMETER_ENABLED||propertyName===PROPERTY_MOUSE_ENABLED||propertyName===PROPERTY_IS_MOUSE_ENABLED||(propertyName===PROPERTY_KEYBOARD_ENABLED||propertyName===PROPERTY_IS_KEYBOARD_ENABLED?node.setKeyboardEnabled&&!cc.sys.isNative?node.setKeyboardEnabled(check):cc.log("The property '"+PROPERTY_IS_KEYBOARD_ENABLED+"' is not supported!"):cc.NodeLoader.prototype.onHandlePropTypeCheck.call(this,node,parent,propertyName,check,ccbReader))}}),cc.LayerLoader.loader=function(){return new cc.LayerLoader},cc.LayerColorLoader=cc.LayerLoader.extend({_createCCNode:function(parent,ccbReader){return new cc.LayerColor},onHandlePropTypeColor3:function(node,parent,propertyName,ccColor3B,ccbReader){propertyName===PROPERTY_COLOR?node.setColor(ccColor3B):cc.LayerLoader.prototype.onHandlePropTypeColor3.call(this,node,parent,propertyName,ccColor3B,ccbReader)},onHandlePropTypeByte:function(node,parent,propertyName,byteValue,ccbReader){propertyName===PROPERTY_OPACITY?node.setOpacity(byteValue):cc.LayerLoader.prototype.onHandlePropTypeByte.call(this,node,parent,propertyName,byteValue,ccbReader)},onHandlePropTypeBlendFunc:function(node,parent,propertyName,ccBlendFunc,ccbReader){propertyName===PROPERTY_BLENDFUNC?node.setBlendFunc(ccBlendFunc):cc.LayerLoader.prototype.onHandlePropTypeBlendFunc.call(this,node,parent,propertyName,ccBlendFunc,ccbReader)}}),cc.LayerColorLoader.loader=function(){return new cc.LayerColorLoader};var PROPERTY_STARTCOLOR="startColor",PROPERTY_ENDCOLOR="endColor",PROPERTY_STARTOPACITY="startOpacity",PROPERTY_ENDOPACITY="endOpacity",PROPERTY_VECTOR="vector";cc.LayerGradientLoader=cc.LayerLoader.extend({_createCCNode:function(parent,ccbReader){return new cc.LayerGradient},onHandlePropTypeColor3:function(node,parent,propertyName,ccColor3B,ccbReader){propertyName===PROPERTY_STARTCOLOR?node.setStartColor(ccColor3B):propertyName===PROPERTY_ENDCOLOR?node.setEndColor(ccColor3B):cc.LayerLoader.prototype.onHandlePropTypeColor3.call(this,node,parent,propertyName,ccColor3B,ccbReader)},onHandlePropTypeByte:function(node,parent,propertyName,byteValue,ccbReader){propertyName===PROPERTY_STARTOPACITY?node.setStartOpacity(byteValue):propertyName===PROPERTY_ENDOPACITY?node.setEndOpacity(byteValue):cc.LayerLoader.prototype.onHandlePropTypeByte.call(this,node,parent,propertyName,byteValue,ccbReader)},onHandlePropTypePoint:function(node,parent,propertyName,point,ccbReader){propertyName===PROPERTY_VECTOR?node.setVector(point):cc.LayerLoader.prototype.onHandlePropTypePoint.call(this,node,parent,propertyName,point,ccbReader)},onHandlePropTypeBlendFunc:function(node,parent,propertyName,ccBlendFunc,ccbReader){propertyName===PROPERTY_BLENDFUNC?node.setBlendFunc(ccBlendFunc):cc.LayerLoader.prototype.onHandlePropTypeBlendFunc.call(this,node,parent,propertyName,ccBlendFunc,ccbReader)}}),cc.LayerGradientLoader.loader=function(){return new cc.LayerGradientLoader},cc.MenuLoader=cc.LayerLoader.extend({_createCCNode:function(parent,ccbReader){var menu=new cc.Menu;return menu.setContentSize(0,0),menu}}),cc.MenuLoader.loader=function(){return new cc.MenuLoader};var PROPERTY_BLOCK="block",PROPERTY_ISENABLED="isEnabled";cc.MenuItemLoader=cc.NodeLoader.extend({_createCCNode:function(parent,ccbReader){return null},onHandlePropTypeBlock:function(node,parent,propertyName,blockData,ccbReader){propertyName===PROPERTY_BLOCK?null!=blockData&&node.setTarget(blockData.selMenuHander,blockData.target):cc.NodeLoader.prototype.onHandlePropTypeBlock.call(this,node,parent,propertyName,blockData,ccbReader)},onHandlePropTypeCheck:function(node,parent,propertyName,check,ccbReader){propertyName===PROPERTY_ISENABLED?node.setEnabled(check):cc.NodeLoader.prototype.onHandlePropTypeCheck.call(this,node,parent,propertyName,check,ccbReader)}});var PROPERTY_NORMALDISPLAYFRAME="normalSpriteFrame",PROPERTY_SELECTEDDISPLAYFRAME="selectedSpriteFrame",PROPERTY_DISABLEDDISPLAYFRAME="disabledSpriteFrame";cc.MenuItemImageLoader=cc.MenuItemLoader.extend({_createCCNode:function(parent,ccbReader){return new cc.MenuItemImage},onHandlePropTypeSpriteFrame:function(node,parent,propertyName,spriteFrame,ccbReader){propertyName===PROPERTY_NORMALDISPLAYFRAME?null!=spriteFrame&&node.setNormalSpriteFrame(spriteFrame):propertyName===PROPERTY_SELECTEDDISPLAYFRAME?null!=spriteFrame&&node.setSelectedSpriteFrame(spriteFrame):propertyName===PROPERTY_DISABLEDDISPLAYFRAME?null!=spriteFrame&&node.setDisabledSpriteFrame(spriteFrame):cc.MenuItemLoader.prototype.onHandlePropTypeSpriteFrame.call(this,node,parent,propertyName,spriteFrame,ccbReader)}}),cc.MenuItemImageLoader.loader=function(){return new cc.MenuItemImageLoader};var PROPERTY_FONTNAME="fontName",PROPERTY_FONTSIZE="fontSize",PROPERTY_HORIZONTALALIGNMENT="horizontalAlignment",PROPERTY_VERTICALALIGNMENT="verticalAlignment",PROPERTY_STRING="string",PROPERTY_DIMENSIONS="dimensions";cc.LabelTTFLoader=cc.NodeLoader.extend({_createCCNode:function(parent,ccbReader){return new cc.LabelTTF},onHandlePropTypeColor3:function(node,parent,propertyName,ccColor3B,ccbReader){propertyName===PROPERTY_COLOR?255===ccColor3B.r&&255===ccColor3B.g&&255===ccColor3B.b||node.setColor(ccColor3B):cc.NodeLoader.prototype.onHandlePropTypeColor3.call(this,node,parent,propertyName,ccColor3B,ccbReader)},onHandlePropTypeByte:function(node,parent,propertyName,byteValue,ccbReader){propertyName===PROPERTY_OPACITY?node.setOpacity(byteValue):cc.NodeLoader.prototype.onHandlePropTypeByte.call(this,node,parent,propertyName,byteValue,ccbReader)},onHandlePropTypeBlendFunc:function(node,parent,propertyName,ccBlendFunc,ccbReader){propertyName===PROPERTY_BLENDFUNC?node.setBlendFunc(ccBlendFunc):cc.NodeLoader.prototype.onHandlePropTypeBlendFunc.call(this,node,parent,propertyName,ccBlendFunc,ccbReader)},onHandlePropTypeFontTTF:function(node,parent,propertyName,fontTTF,ccbReader){propertyName===PROPERTY_FONTNAME?node.setFontName(fontTTF):cc.NodeLoader.prototype.onHandlePropTypeFontTTF.call(this,node,parent,propertyName,fontTTF,ccbReader)},onHandlePropTypeText:function(node,parent,propertyName,textValue,ccbReader){propertyName===PROPERTY_STRING?node.setString(textValue):cc.NodeLoader.prototype.onHandlePropTypeText.call(this,node,parent,propertyName,textValue,ccbReader)},onHandlePropTypeFloatScale:function(node,parent,propertyName,floatScale,ccbReader){propertyName===PROPERTY_FONTSIZE?node.setFontSize(floatScale):cc.NodeLoader.prototype.onHandlePropTypeFloatScale.call(this,node,parent,propertyName,floatScale,ccbReader)},onHandlePropTypeIntegerLabeled:function(node,parent,propertyName,integerLabeled,ccbReader){propertyName===PROPERTY_HORIZONTALALIGNMENT?node.setHorizontalAlignment(integerLabeled):propertyName===PROPERTY_VERTICALALIGNMENT?node.setVerticalAlignment(integerLabeled):cc.NodeLoader.prototype.onHandlePropTypeIntegerLabeled.call(this,node,parent,propertyName,integerLabeled,ccbReader)},onHandlePropTypeSize:function(node,parent,propertyName,size,ccbReader){propertyName===PROPERTY_DIMENSIONS?node.setDimensions(size):cc.NodeLoader.prototype.onHandlePropTypeSize.call(this,node,parent,propertyName,size,ccbReader)}}),cc.LabelTTFLoader.loader=function(){return new cc.LabelTTFLoader};var PROPERTY_FNTFILE="fntFile";cc.LabelBMFontLoader=cc.NodeLoader.extend({_createCCNode:function(parent,ccbReader){return new cc.LabelBMFont},onHandlePropTypeColor3:function(node,parent,propertyName,ccColor3B,ccbReader){propertyName===PROPERTY_COLOR?255===ccColor3B.r&&255===ccColor3B.g&&255===ccColor3B.b||node.setColor(ccColor3B):cc.NodeLoader.prototype.onHandlePropTypeColor3.call(this,node,parent,propertyName,ccColor3B,ccbReader)},onHandlePropTypeByte:function(node,parent,propertyName,byteValue,ccbReader){propertyName===PROPERTY_OPACITY?node.setOpacity(byteValue):cc.NodeLoader.prototype.onHandlePropTypeByte.call(this,node,parent,propertyName,byteValue,ccbReader)},onHandlePropTypeBlendFunc:function(node,parent,propertyName,ccBlendFunc,ccbReader){propertyName===PROPERTY_BLENDFUNC?node.setBlendFunc(ccBlendFunc):cc.NodeLoader.prototype.onHandlePropTypeBlendFunc.call(this,node,parent,propertyName,ccBlendFunc,ccbReader)},onHandlePropTypeFntFile:function(node,parent,propertyName,fntFile,ccbReader){propertyName===PROPERTY_FNTFILE?node.setFntFile(fntFile):cc.NodeLoader.prototype.onHandlePropTypeFntFile.call(this,node,parent,propertyName,fntFile,ccbReader)},onHandlePropTypeText:function(node,parent,propertyName,textValue,ccbReader){propertyName===PROPERTY_STRING?node.setString(textValue):cc.NodeLoader.prototype.onHandlePropTypeText.call(this,node,parent,propertyName,textValue,ccbReader)}}),cc.LabelBMFontLoader.loader=function(){return new cc.LabelBMFontLoader};var PROPERTY_EMITERMODE="emitterMode",PROPERTY_POSVAR="posVar",PROPERTY_EMISSIONRATE="emissionRate",PROPERTY_DURATION="duration",PROPERTY_TOTALPARTICLES="totalParticles",PROPERTY_LIFE="life",PROPERTY_STARTSIZE="startSize",PROPERTY_ENDSIZE="endSize",PROPERTY_STARTSPIN="startSpin",PROPERTY_ENDSPIN="endSpin",PROPERTY_ANGLE="angle",PROPERTY_GRAVITY="gravity",PROPERTY_SPEED="speed",PROPERTY_TANGENTIALACCEL="tangentialAccel",PROPERTY_RADIALACCEL="radialAccel",PROPERTY_TEXTURE="texture",PROPERTY_STARTRADIUS="startRadius",PROPERTY_ENDRADIUS="endRadius",PROPERTY_ROTATEPERSECOND="rotatePerSecond";cc.ParticleSystemLoader=cc.NodeLoader.extend({_createCCNode:function(parent,ccbReader){return new cc.ParticleSystem},onHandlePropTypeIntegerLabeled:function(node,parent,propertyName,integerLabeled,ccbReader){propertyName===PROPERTY_EMITERMODE?node.setEmitterMode(integerLabeled):cc.NodeLoader.prototype.onHandlePropTypeIntegerLabeled.call(this,node,parent,propertyName,integerLabeled,ccbReader)},onHandlePropTypePoint:function(node,parent,propertyName,point,ccbReader){propertyName===PROPERTY_POSVAR?node.setPosVar(point):propertyName===PROPERTY_GRAVITY?node.setGravity(point):cc.NodeLoader.prototype.onHandlePropTypePoint.call(this,node,parent,propertyName,point,ccbReader)},onHandlePropTypeFloat:function(node,parent,propertyName,floatValue,ccbReader){propertyName===PROPERTY_EMISSIONRATE?node.setEmissionRate(floatValue):propertyName===PROPERTY_DURATION?node.setDuration(floatValue):cc.NodeLoader.prototype.onHandlePropTypeFloat.call(this,node,parent,propertyName,floatValue,ccbReader)},onHandlePropTypeInteger:function(node,parent,propertyName,integerValue,ccbReader){propertyName===PROPERTY_TOTALPARTICLES?node.setTotalParticles(integerValue):cc.NodeLoader.prototype.onHandlePropTypeInteger.call(this,node,parent,propertyName,integerValue,ccbReader)},onHandlePropTypeFloatVar:function(node,parent,propertyName,floatVar,ccbReader){propertyName===PROPERTY_LIFE?(node.setLife(floatVar[0]),node.setLifeVar(floatVar[1])):propertyName===PROPERTY_STARTSIZE?(node.setStartSize(floatVar[0]),node.setStartSizeVar(floatVar[1])):propertyName===PROPERTY_ENDSIZE?(node.setEndSize(floatVar[0]),node.setEndSizeVar(floatVar[1])):propertyName===PROPERTY_STARTSPIN?(node.setStartSpin(floatVar[0]),node.setStartSpinVar(floatVar[1])):propertyName===PROPERTY_ENDSPIN?(node.setEndSpin(floatVar[0]),node.setEndSpinVar(floatVar[1])):propertyName===PROPERTY_ANGLE?(node.setAngle(floatVar[0]),node.setAngleVar(floatVar[1])):propertyName===PROPERTY_SPEED?(node.setSpeed(floatVar[0]),node.setSpeedVar(floatVar[1])):propertyName===PROPERTY_TANGENTIALACCEL?(node.setTangentialAccel(floatVar[0]),node.setTangentialAccelVar(floatVar[1])):propertyName===PROPERTY_RADIALACCEL?(node.setRadialAccel(floatVar[0]),node.setRadialAccelVar(floatVar[1])):propertyName===PROPERTY_STARTRADIUS?(node.setStartRadius(floatVar[0]),node.setStartRadiusVar(floatVar[1])):propertyName===PROPERTY_ENDRADIUS?(node.setEndRadius(floatVar[0]),node.setEndRadiusVar(floatVar[1])):propertyName===PROPERTY_ROTATEPERSECOND?(node.setRotatePerSecond(floatVar[0]),node.setRotatePerSecondVar(floatVar[1])):cc.NodeLoader.prototype.onHandlePropTypeFloatVar.call(this,node,parent,propertyName,floatVar,ccbReader)},onHandlePropTypeColor4FVar:function(node,parent,propertyName,ccColor4FVar,ccbReader){propertyName===PROPERTY_STARTCOLOR?(node.setStartColor(ccColor4FVar[0]),node.setStartColorVar(ccColor4FVar[1])):propertyName===PROPERTY_ENDCOLOR?(node.setEndColor(ccColor4FVar[0]),node.setEndColorVar(ccColor4FVar[1])):cc.NodeLoader.prototype.onHandlePropTypeColor4FVar.call(this,node,parent,propertyName,ccColor4FVar,ccbReader)},onHandlePropTypeBlendFunc:function(node,parent,propertyName,ccBlendFunc,ccbReader){propertyName===PROPERTY_BLENDFUNC?node.setBlendFunc(ccBlendFunc):cc.NodeLoader.prototype.onHandlePropTypeBlendFunc.call(this,node,parent,propertyName,ccBlendFunc,ccbReader)},onHandlePropTypeTexture:function(node,parent,propertyName,ccTexture2D,ccbReader){propertyName===PROPERTY_TEXTURE?node.setTexture(ccTexture2D):cc.NodeLoader.prototype.onHandlePropTypeTexture.call(this,node,parent,propertyName,ccTexture2D,ccbReader)}}),cc.ParticleSystemLoader.loader=function(){return new cc.ParticleSystemLoader},cc.NodeLoaderLibrary=cc.Class.extend({_ccNodeLoaders:null,ctor:function(){this._ccNodeLoaders={}},registerDefaultCCNodeLoaders:function(){this.registerCCNodeLoader("CCNode",cc.NodeLoader.loader()),this.registerCCNodeLoader("CCLayer",cc.LayerLoader.loader()),this.registerCCNodeLoader("CCLayerColor",cc.LayerColorLoader.loader()),this.registerCCNodeLoader("CCLayerGradient",cc.LayerGradientLoader.loader()),this.registerCCNodeLoader("CCSprite",cc.SpriteLoader.loader()),this.registerCCNodeLoader("CCLabelBMFont",cc.LabelBMFontLoader.loader()),this.registerCCNodeLoader("CCLabelTTF",cc.LabelTTFLoader.loader()),this.registerCCNodeLoader("CCScale9Sprite",cc.Scale9SpriteLoader.loader()),this.registerCCNodeLoader("CCScrollView",cc.ScrollViewLoader.loader()),this.registerCCNodeLoader("CCBFile",cc.BuilderFileLoader.loader()),this.registerCCNodeLoader("CCMenu",cc.MenuLoader.loader()),this.registerCCNodeLoader("CCMenuItemImage",cc.MenuItemImageLoader.loader()),this.registerCCNodeLoader("CCControlButton",cc.ControlButtonLoader.loader()),this.registerCCNodeLoader("CCParticleSystemQuad",cc.ParticleSystemLoader.loader())},registerCCNodeLoader:function(className,ccNodeLoader){this._ccNodeLoaders[className]=ccNodeLoader},unregisterCCNodeLoader:function(className){this._ccNodeLoaders[className]&&delete this._ccNodeLoaders[className]},getCCNodeLoader:function(className){return this._ccNodeLoaders[className]?this._ccNodeLoaders[className]:null},purge:function(releaseCCNodeLoaders){if(releaseCCNodeLoaders)for(var className in this._ccNodeLoaders)delete this._ccNodeLoaders[className];this._ccNodeLoaders={}}}),cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary=null,cc.NodeLoaderLibrary.library=function(){return new cc.NodeLoaderLibrary},cc.NodeLoaderLibrary.sharedCCNodeLoaderLibrary=function(){return null==cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary&&(cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary=new cc.NodeLoaderLibrary,cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary.registerDefaultCCNodeLoaders()),cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary},cc.NodeLoaderLibrary.purgeSharedCCNodeLoaderLibrary=function(){cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary=null},cc.NodeLoaderLibrary.newDefaultCCNodeLoaderLibrary=function(){var ccNodeLoaderLibrary=cc.NodeLoaderLibrary.library();return ccNodeLoaderLibrary.registerDefaultCCNodeLoaders(),ccNodeLoaderLibrary};var CCB_VERSION=5,CCB_PROPTYPE_POSITION=0,CCB_PROPTYPE_SIZE=1,CCB_PROPTYPE_POINT=2,CCB_PROPTYPE_POINTLOCK=3,CCB_PROPTYPE_SCALELOCK=4,CCB_PROPTYPE_DEGREES=5,CCB_PROPTYPE_INTEGER=6,CCB_PROPTYPE_FLOAT=7,CCB_PROPTYPE_FLOATVAR=8,CCB_PROPTYPE_CHECK=9,CCB_PROPTYPE_SPRITEFRAME=10,CCB_PROPTYPE_TEXTURE=11,CCB_PROPTYPE_BYTE=12,CCB_PROPTYPE_COLOR3=13,CCB_PROPTYPE_COLOR4VAR=14,CCB_PROPTYPE_FLIP=15,CCB_PROPTYPE_BLENDMODE=16,CCB_PROPTYPE_FNTFILE=17,CCB_PROPTYPE_TEXT=18,CCB_PROPTYPE_FONTTTF=19,CCB_PROPTYPE_INTEGERLABELED=20,CCB_PROPTYPE_BLOCK=21,CCB_PROPTYPE_ANIMATION=22,CCB_PROPTYPE_CCBFILE=23,CCB_PROPTYPE_STRING=24,CCB_PROPTYPE_BLOCKCCCONTROL=25,CCB_PROPTYPE_FLOATSCALE=26,CCB_PROPTYPE_FLOATXY=27,CCB_FLOAT0=0,CCB_FLOAT1=1,CCB_FLOAT_MINUS1=2,CCB_FLOAT05=3,CCB_FLOAT_INTEGER=4,CCB_FLOAT_FULL=5,CCB_PLATFORM_ALL=0,CCB_PLATFORM_IOS=1,CCB_PLATFORM_MAC=2,CCB_TARGETTYPE_NONE=0,CCB_TARGETTYPE_DOCUMENTROOT=1,CCB_TARGETTYPE_OWNER=2,CCB_KEYFRAME_EASING_INSTANT=0,CCB_KEYFRAME_EASING_LINEAR=1,CCB_KEYFRAME_EASING_CUBIC_IN=2,CCB_KEYFRAME_EASING_CUBIC_OUT=3,CCB_KEYFRAME_EASING_CUBIC_INOUT=4,CCB_KEYFRAME_EASING_ELASTIC_IN=5,CCB_KEYFRAME_EASING_ELASTIC_OUT=6,CCB_KEYFRAME_EASING_ELASTIC_INOUT=7,CCB_KEYFRAME_EASING_BOUNCE_IN=8,CCB_KEYFRAME_EASING_BOUNCE_OUT=9,CCB_KEYFRAME_EASING_BOUNCE_INOUT=10,CCB_KEYFRAME_EASING_BACK_IN=11,CCB_KEYFRAME_EASING_BACK_OUT=12,CCB_KEYFRAME_EASING_BACK_INOUT=13,CCB_POSITIONTYPE_RELATIVE_BOTTOM_LEFT=0,CCB_POSITIONTYPE_RELATIVE_TOP_LEFT=1,CCB_POSITIONTYPE_RELATIVE_TOP_RIGHT=2,CCB_POSITIONTYPE_RELATIVE_BOTTOM_RIGHT=3,CCB_POSITIONTYPE_PERCENT=4,CCB_POSITIONTYPE_MULTIPLY_RESOLUTION=5,CCB_SIZETYPE_ABSOLUTE=0,CCB_SIZETYPE_PERCENT=1,CCB_SIZETYPE_RELATIVE_CONTAINER=2,CCB_SIZETYPE_HORIZONTAL_PERCENT=3,CCB_SIZETYPE_VERTICAL_PERCENT=4,CCB_SIZETYPE_MULTIPLY_RESOLUTION=5,CCB_SCALETYPE_ABSOLUTE=0,CCB_SCALETYPE_MULTIPLY_RESOLUTION=1;cc.BuilderReader=cc.Class.extend({_jsControlled:!1,_data:null,_ccbRootPath:"",_bytes:0,_currentByte:0,_currentBit:0,_stringCache:null,_loadedSpriteSheets:null,_owner:null,_animationManager:null,_animationManagers:null,_animatedProps:null,_ccNodeLoaderLibrary:null,_ccNodeLoaderListener:null,_ccbMemberVariableAssigner:null,_ccbSelectorResolver:null,_ownerOutletNames:null,_ownerOutletNodes:null,_nodesWithAnimationManagers:null,_animationManagerForNodes:null,_ownerCallbackNames:null,_ownerCallbackNodes:null,_ownerCallbackEvents:null,_readNodeGraphFromData:!1,ctor:function(ccNodeLoaderLibrary,ccbMemberVariableAssigner,ccbSelectorResolver,ccNodeLoaderListener){if(this._stringCache=[],this._loadedSpriteSheets=[],this._currentBit=-1,this._currentByte=-1,0!==arguments.length)if(ccNodeLoaderLibrary instanceof cc.BuilderReader){var ccbReader=ccNodeLoaderLibrary;this._loadedSpriteSheets=ccbReader._loadedSpriteSheets,this._ccNodeLoaderLibrary=ccbReader._ccNodeLoaderLibrary,this._ccbMemberVariableAssigner=ccbReader._ccbMemberVariableAssigner,this._ccbSelectorResolver=ccbReader._ccbSelectorResolver,this._ccNodeLoaderListener=ccbReader._ccNodeLoaderListener,this._ownerCallbackNames=ccbReader._ownerCallbackNames,this._ownerCallbackNodes=ccbReader._ownerCallbackNodes,this._ownerCallbackEvents=ccbReader._ownerCallbackEvents,this._ownerOutletNames=ccbReader._ownerOutletNames,this._ownerOutletNodes=ccbReader._ownerOutletNodes,this._ccbRootPath=ccbReader._ccbRootPath}else this._ccNodeLoaderLibrary=ccNodeLoaderLibrary,this._ccbMemberVariableAssigner=ccbMemberVariableAssigner,this._ccbSelectorResolver=ccbSelectorResolver,this._ccNodeLoaderListener=ccNodeLoaderListener},getCCBRootPath:function(){return this._ccbRootPath},setCCBRootPath:function(rootPath){this._ccbRootPath=rootPath},initWithData:function(data,owner){return this._animationManager=new cc.BuilderAnimationManager,this._data=data,this._bytes=data.length,this._currentBit=0,this._currentByte=0,this._owner=owner,this._animationManager.setRootContainerSize(cc.director.getWinSize()),!0},_loadBinarySync:function(url){var req=this.getXMLHttpRequest(),errInfo="load "+url+" failed!";req.open("GET",url,!1);var arrayInfo=null;if(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){if(req.setRequestHeader("Accept-Charset","x-user-defined"),req.send(null),200!==req.status)return cc.log(errInfo),null;var fileContents=cc._convertResponseBodyToText(req.responseBody);fileContents&&(arrayInfo=this._stringConvertToArray(fileContents),this._fileDataCache[url]=arrayInfo)}else{if(req.overrideMimeType&&req.overrideMimeType("text/plain; charset=x-user-defined"),req.send(null),200!==req.status)return cc.log(errInfo),null;arrayInfo=this._stringConvertToArray(req.responseText),this._fileDataCache[url]=arrayInfo}return arrayInfo},readNodeGraphFromFile:function(ccbFileName,owner,parentSize,animationManager){null==parentSize?parentSize=cc.director.getWinSize():parentSize instanceof cc.BuilderAnimationManager&&(animationManager=parentSize,parentSize=cc.director.getWinSize());var data=cc.loader.getRes(ccbFileName);if(!data){var realUrl=cc.loader.getUrl(ccbFileName);data=cc.loader.loadBinarySync(realUrl),cc.loader.cache[ccbFileName]=data}return this.readNodeGraphFromData(data,owner,parentSize,animationManager)},readNodeGraphFromData:function(data,owner,parentSize){this.initWithData(data,owner);var locAnimationManager=this._animationManager;locAnimationManager.setRootContainerSize(parentSize),locAnimationManager.setOwner(owner),this._ownerOutletNames=[],this._ownerOutletNodes=[],this._ownerCallbackNames=[],this._ownerCallbackNodes=[],this._ownerCallbackEvents=[],this._animationManagers=new cc._Dictionary;var nodeGraph=this.readFileWithCleanUp(!0);if(nodeGraph&&-1!==locAnimationManager.getAutoPlaySequenceId()&&locAnimationManager.runAnimations(locAnimationManager.getAutoPlaySequenceId(),0),this._jsControlled){for(var locNodes=[],locAnimations=[],locAnimationManagers=this._animationManagers,getAllKeys=locAnimationManagers.allKeys(),i=0;i<getAllKeys.length;i++)locNodes.push(getAllKeys[i]),locAnimations.push(locAnimationManagers.objectForKey(getAllKeys[i]));this._nodesWithAnimationManagers=locNodes,this._animationManagerForNodes=locAnimations}return nodeGraph},createSceneWithNodeGraphFromFile:function(ccbFileName,owner,parentSize,animationManager){var node=this.readNodeGraphFromFile(ccbFileName,owner,parentSize,animationManager),scene=new cc.Scene;return scene.addChild(node),scene},getCCBMemberVariableAssigner:function(){return this._ccbMemberVariableAssigner},getCCBSelectorResolver:function(){return this._ccbSelectorResolver},getAnimationManager:function(){return this._animationManager},setAnimationManager:function(animationManager){this._animationManager=animationManager},getAnimatedProperties:function(){return this._animatedProps},getLoadedSpriteSheet:function(){return this._loadedSpriteSheets},getOwner:function(){return this._owner},readInt:function(signed){for(var numBits=0,data=this._data[this._currentByte],bit=!!(data&1<<this._currentBit++);!bit;)if(numBits++,bit=!!(data&1<<this._currentBit++),this._currentBit>=8&&(this._currentBit=0,this._currentByte++,data=this._data[this._currentByte],this._currentByte>this._data.length))throw new Error("out of the data bound");for(var current=0,a=numBits-1;a>=0;a--){if(bit=!!(data&1<<this._currentBit++),this._currentBit>=8&&(this._currentBit=0,this._currentByte++,data=this._data[this._currentByte],this._currentByte>this._data.length))throw new Error("out of the data bound");bit&&(current|=1<<a)}current|=1<<numBits;var num;return num=signed?current%2?0|current/2:0|-current/2:current-1,this._currentBit&&(this._currentBit=0,this._currentByte++),num},readByte:function(){var byteValue=this._data[this._currentByte];return this._currentByte++,byteValue},readBool:function(){return!!this._data[this._currentByte++]},readFloat:function(){switch(this._data[this._currentByte++]){case CCB_FLOAT0:return 0;case CCB_FLOAT1:return 1;case CCB_FLOAT_MINUS1:return-1;case CCB_FLOAT05:return.5;case CCB_FLOAT_INTEGER:return this.readInt(!0);default:return this._decodeFloat(23,8)}},_decodeFloat:function(precisionBits,exponentBits){var size=precisionBits+exponentBits+1>>3;if(this._currentByte+size>=this._data.length)throw new Error("Index out of bound");var bias=Math.pow(2,exponentBits-1)-1,signal=this._readBitsOnly(precisionBits+exponentBits,1,size),exponent=this._readBitsOnly(precisionBits,exponentBits,size),significand=0,divisor=2,curByte=0;do{for(var byteValue=this._data[this._currentByte+size-++curByte-1],startBit=precisionBits%8||8,mask=1<<startBit;mask>>=1;)byteValue&mask&&(significand+=1/divisor),divisor*=2}while(precisionBits-=startBit);return this._currentByte+=size,exponent===1+(bias<<1)?significand?NaN:signal?-1/0:1/0:(1+-2*signal)*(exponent||significand?exponent?Math.pow(2,exponent-bias)*(1+significand):Math.pow(2,1-bias)*significand:0)},_readBitsOnly:function(start,length,size){var offsetLeft=(start+length)%8,offsetRight=start%8,curByte=size-(start>>3)-1,lastByte=size+(-(start+length)>>3),diff=curByte-lastByte,sum=this._data[this._currentByte+size-curByte-1]>>offsetRight&(1<<(diff?8-offsetRight:length))-1;for(diff&&offsetLeft&&(sum+=(this._data[this._currentByte+size-lastByte-1]&(1<<offsetLeft)-1)<<(diff--<<3)-offsetRight,lastByte++);diff;)sum+=this._shl(this._data[this._currentByte+size-lastByte-1],(diff--<<3)-offsetRight),lastByte++;return sum},_shl:function(a,b){for(++b;--b;a=1073741824==(1073741824&(a%=2147483648))?2*a:2*(a-1073741824)+2147483647+1);return a},readCachedString:function(){return this._stringCache[this.readInt(!1)]},isJSControlled:function(){return this._jsControlled},getOwnerCallbackNames:function(){return this._ownerCallbackNames},getOwnerCallbackNodes:function(){return this._ownerCallbackNodes},getOwnerCallbackControlEvents:function(){return this._ownerCallbackEvents},getOwnerOutletNames:function(){return this._ownerOutletNames},getOwnerOutletNodes:function(){return this._ownerOutletNodes},getNodesWithAnimationManagers:function(){return this._nodesWithAnimationManagers},getAnimationManagersForNodes:function(){return this._animationManagerForNodes},getAnimationManagers:function(){return this._animationManagers},setAnimationManagers:function(animationManagers){this._animationManagers=animationManagers},addOwnerCallbackName:function(name){this._ownerCallbackNames.push(name)},addOwnerCallbackNode:function(node){this._ownerCallbackNodes.push(node)},addOwnerCallbackControlEvents:function(event){this._ownerCallbackEvents.push(event)},addDocumentCallbackName:function(name){this._animationManager.addDocumentCallbackName(name)},addDocumentCallbackNode:function(node){this._animationManager.addDocumentCallbackNode(node)},addDocumentCallbackControlEvents:function(controlEvents){this._animationManager.addDocumentCallbackControlEvents(controlEvents)},readFileWithCleanUp:function(cleanUp){if(!this._readHeader())return null;if(!this._readStringCache())return null;if(!this._readSequences())return null;var node=this._readNodeGraph();return this._animationManagers.setObject(this._animationManager,node),cleanUp&&this._cleanUpNodeGraph(node),node},addOwnerOutletName:function(name){this._ownerOutletNames.push(name)},addOwnerOutletNode:function(node){null!=node&&this._ownerOutletNodes.push(node)},_cleanUpNodeGraph:function(node){node.userObject=null;for(var getChildren=node.getChildren(),i=0,len=getChildren.length;i<len;i++)this._cleanUpNodeGraph(getChildren[i])},_readCallbackKeyframesForSeq:function(seq){var numKeyframes=this.readInt(!1);if(!numKeyframes)return!0;for(var channel=new cc.BuilderSequenceProperty,locJsControlled=this._jsControlled,locAnimationManager=this._animationManager,locKeyframes=channel.getKeyframes(),i=0;i<numKeyframes;i++){var time=this.readFloat(),callbackName=this.readCachedString(),callbackType=this.readInt(!1),value=[callbackName,callbackType],keyframe=new cc.BuilderKeyframe;keyframe.setTime(time),keyframe.setValue(value),locJsControlled&&locAnimationManager.getKeyframeCallbacks().push(callbackType+":"+callbackName),locKeyframes.push(keyframe)}return seq.setCallbackChannel(channel),!0},_readSoundKeyframesForSeq:function(seq){var numKeyframes=this.readInt(!1);if(!numKeyframes)return!0;for(var channel=new cc.BuilderSequenceProperty,locKeyframes=channel.getKeyframes(),i=0;i<numKeyframes;i++){var time=this.readFloat(),value=[this.readCachedString(),this.readFloat(),this.readFloat(),this.readFloat()],keyframe=new cc.BuilderKeyframe;keyframe.setTime(time),keyframe.setValue(value),locKeyframes.push(keyframe)}return seq.setSoundChannel(channel),!0},_readSequences:function(){for(var sequences=this._animationManager.getSequences(),numSeqs=this.readInt(!1),i=0;i<numSeqs;i++){var seq=new cc.BuilderSequence;if(seq.setDuration(this.readFloat()),seq.setName(this.readCachedString()),seq.setSequenceId(this.readInt(!1)),seq.setChainedSequenceId(this.readInt(!0)),!this._readCallbackKeyframesForSeq(seq))return!1;if(!this._readSoundKeyframesForSeq(seq))return!1;sequences.push(seq)}return this._animationManager.setAutoPlaySequenceId(this.readInt(!0)),!0},readKeyframe:function(type){var keyframe=new cc.BuilderKeyframe;keyframe.setTime(this.readFloat());var easingType=this.readInt(!1),easingOpt=0,value=null;if(easingType!==CCB_KEYFRAME_EASING_CUBIC_IN&&easingType!==CCB_KEYFRAME_EASING_CUBIC_OUT&&easingType!==CCB_KEYFRAME_EASING_CUBIC_INOUT&&easingType!==CCB_KEYFRAME_EASING_ELASTIC_IN&&easingType!==CCB_KEYFRAME_EASING_ELASTIC_OUT&&easingType!==CCB_KEYFRAME_EASING_ELASTIC_INOUT||(easingOpt=this.readFloat()),keyframe.setEasingType(easingType),keyframe.setEasingOpt(easingOpt),type===CCB_PROPTYPE_CHECK)value=!!this._data[this._currentByte++];else if(type===CCB_PROPTYPE_BYTE)value=this._data[this._currentByte++];else if(type===CCB_PROPTYPE_COLOR3)value=cc.color(this._data[this._currentByte++],this._data[this._currentByte++],this._data[this._currentByte++]);else if(type===CCB_PROPTYPE_FLOATXY)value=[this.readFloat(),this.readFloat()];else if(type===CCB_PROPTYPE_DEGREES)value=this.readFloat();else if(type===CCB_PROPTYPE_SCALELOCK||type===CCB_PROPTYPE_POSITION||type===CCB_PROPTYPE_FLOATXY)value=[this.readFloat(),this.readFloat()];else if(type===CCB_PROPTYPE_SPRITEFRAME){var spriteSheet=this.readCachedString(),spriteFile=this.readCachedString();if(""===spriteSheet){spriteFile=this._ccbRootPath+spriteFile;var texture=cc.textureCache.addImage(spriteFile),locContentSize=texture.getContentSize(),bounds=cc.rect(0,0,locContentSize.width,locContentSize.height);value=new cc.SpriteFrame(texture,bounds)}else{spriteSheet=this._ccbRootPath+spriteSheet;var frameCache=cc.spriteFrameCache;-1===this._loadedSpriteSheets.indexOf(spriteSheet)&&(frameCache.addSpriteFrames(spriteSheet),this._loadedSpriteSheets.push(spriteSheet)),value=frameCache.getSpriteFrame(spriteFile)}}return keyframe.setValue(value),keyframe},_readHeader:function(){if(!this._data)return!1;var magicBytes=this._readStringFromBytes(this._currentByte,4,!0);if(this._currentByte+=4,"ccbi"!==magicBytes)return!1;var version=this.readInt(!1);return version!==CCB_VERSION?(cc.log("WARNING! Incompatible ccbi file version (file: "+version+" reader: "+CCB_VERSION+")"),!1):(this._jsControlled=!!this._data[this._currentByte++],this._animationManager._jsControlled=this._jsControlled,!0)},_readStringFromBytes:function(startIndex,strLen,reverse){reverse=reverse||!1;var i,strValue="",locData=this._data;if(reverse)for(i=strLen-1;i>=0;i--)strValue+=String.fromCharCode(locData[startIndex+i]);else for(i=0;i<strLen;i++)strValue+=String.fromCharCode(locData[startIndex+i]);return strValue},_readStringCache:function(){for(var numStrings=this.readInt(!1),i=0;i<numStrings;i++)this._readStringCacheEntry();return!0},_readStringCacheEntry:function(){for(var numBytes=this._data[this._currentByte++]<<8|this._data[this._currentByte++],str="",locData=this._data,locCurrentByte=this._currentByte,i=0;i<numBytes;i++){var hexChar=locData[locCurrentByte+i].toString("16").toUpperCase();str+="%"+(hexChar=hexChar.length>1?hexChar:"0"+hexChar)}str=decodeURIComponent(str),this._currentByte+=numBytes,this._stringCache.push(str)},_readNodeGraph:function(parent){var jsControlledName,className=this.readCachedString(),locJsControlled=this._jsControlled,locActionManager=this._animationManager;locJsControlled&&(jsControlledName=this.readCachedString());var memberVarAssignmentName,memberVarAssignmentType=this.readInt(!1);memberVarAssignmentType!==CCB_TARGETTYPE_NONE&&(memberVarAssignmentName=this.readCachedString());var ccNodeLoader=this._ccNodeLoaderLibrary.getCCNodeLoader(className);ccNodeLoader||(ccNodeLoader=this._ccNodeLoaderLibrary.getCCNodeLoader("CCNode"));var node=ccNodeLoader.loadCCNode(parent,this);locActionManager.getRootNode()||locActionManager.setRootNode(node),locJsControlled&&node===locActionManager.getRootNode()&&locActionManager.setDocumentControllerName(jsControlledName);var seqs=new cc._Dictionary;this._animatedProps=[];var i,locAnimatedProps=this._animatedProps,numSequence=this.readInt(!1);for(i=0;i<numSequence;++i){for(var seqId=this.readInt(!1),seqNodeProps=new cc._Dictionary,numProps=this.readInt(!1),j=0;j<numProps;++j){var seqProp=new cc.BuilderSequenceProperty;seqProp.setName(this.readCachedString()),seqProp.setType(this.readInt(!1)),locAnimatedProps.push(seqProp.getName());for(var numKeyframes=this.readInt(!1),locKeyframes=seqProp.getKeyframes(),k=0;k<numKeyframes;++k){var keyFrame=this.readKeyframe(seqProp.getType());locKeyframes.push(keyFrame)}seqNodeProps.setObject(seqProp,seqProp.getName())}seqs.setObject(seqNodeProps,seqId)}seqs.count()>0&&locActionManager.addNode(node,seqs),ccNodeLoader.parseProperties(node,parent,this);var isCCBFileNode=!!node.ccbFileNode;if(isCCBFileNode){var embeddedNode=node.ccbFileNode;embeddedNode.setPosition(node.getPosition()),embeddedNode.setRotation(node.getRotation()),embeddedNode.setScaleX(node.getScaleX()),embeddedNode.setScaleY(node.getScaleY()),embeddedNode.setTag(node.getTag()),embeddedNode.setVisible(!0),locActionManager.moveAnimationsFromNode(node,embeddedNode),node.ccbFileNode=null,node=embeddedNode}var target=null,locMemberAssigner=null;if(memberVarAssignmentType!==CCB_TARGETTYPE_NONE)if(locJsControlled)memberVarAssignmentType===CCB_TARGETTYPE_DOCUMENTROOT?(locActionManager.addDocumentOutletName(memberVarAssignmentName),locActionManager.addDocumentOutletNode(node)):(this._ownerOutletNames.push(memberVarAssignmentName),this._ownerOutletNodes.push(node));else if(memberVarAssignmentType===CCB_TARGETTYPE_DOCUMENTROOT?target=locActionManager.getRootNode():memberVarAssignmentType===CCB_TARGETTYPE_OWNER&&(target=this._owner),!target){var assigned=!1;target.onAssignCCBMemberVariable&&(assigned=target.onAssignCCBMemberVariable(target,memberVarAssignmentName,node)),locMemberAssigner=this._ccbMemberVariableAssigner,!assigned&&null!=locMemberAssigner&&locMemberAssigner.onAssignCCBMemberVariable&&locMemberAssigner.onAssignCCBMemberVariable(target,memberVarAssignmentName,node)}if(ccNodeLoader.getCustomProperties().length>0){var customAssigned=!1;if(!locJsControlled&&null!=(target=node)&&null!=target.onAssignCCBCustomProperty){var customProperties=ccNodeLoader.getCustomProperties(),customPropKeys=customProperties.allKeys();for(i=0;i<customPropKeys.length;i++){var customPropValue=customProperties.objectForKey(customPropKeys[i]);customAssigned=target.onAssignCCBCustomProperty(target,customPropKeys[i],customPropValue),locMemberAssigner=this._ccbMemberVariableAssigner,customAssigned||null==locMemberAssigner||null==locMemberAssigner.onAssignCCBCustomProperty||(customAssigned=locMemberAssigner.onAssignCCBCustomProperty(target,customPropKeys[i],customPropValue))}}}this._animatedProps=null;var numChildren=this.readInt(!1);for(i=0;i<numChildren;i++){var child=this._readNodeGraph(node);node.addChild(child)}return isCCBFileNode||(null!=node&&node.onNodeLoaded?node.onNodeLoaded(node,ccNodeLoader):null!=this._ccNodeLoaderListener&&this._ccNodeLoaderListener.onNodeLoaded(node,ccNodeLoader)),node},_readUTF8:function(){}}),cc.BuilderReader._ccbResolutionScale=1,cc.BuilderReader.setResolutionScale=function(scale){cc.BuilderReader._ccbResolutionScale=scale},cc.BuilderReader.getResolutionScale=function(){return cc.BuilderReader._ccbResolutionScale},cc.BuilderReader.loadAsScene=function(ccbFilePath,owner,parentSize,ccbRootPath){ccbRootPath=ccbRootPath||cc.BuilderReader.getResourcePath();var getNode=cc.BuilderReader.load(ccbFilePath,owner,parentSize,ccbRootPath),scene=new cc.Scene;return scene.addChild(getNode),scene},cc.BuilderReader._controllerClassCache={},cc.BuilderReader.registerController=function(controllerName,controller){cc.BuilderReader._controllerClassCache[controllerName]=cc.Class.extend(controller)},cc.BuilderReader.load=function(ccbFilePath,owner,parentSize,ccbRootPath){ccbRootPath=ccbRootPath||cc.BuilderReader.getResourcePath();var reader=new cc.BuilderReader(cc.NodeLoaderLibrary.newDefaultCCNodeLoaderLibrary());reader.setCCBRootPath(ccbRootPath),(ccbFilePath.length<5||ccbFilePath.toLowerCase().lastIndexOf(".ccbi")!==ccbFilePath.length-5)&&(ccbFilePath+=".ccbi");var i,callbackName,callbackNode,callbackControlEvents,outletName,outletNode,node=reader.readNodeGraphFromFile(ccbFilePath,owner,parentSize);if(owner){var ownerCallbackNames=reader.getOwnerCallbackNames(),ownerCallbackNodes=reader.getOwnerCallbackNodes(),ownerCallbackControlEvents=reader.getOwnerCallbackControlEvents();for(i=0;i<ownerCallbackNames.length;i++)callbackName=ownerCallbackNames[i],callbackNode=ownerCallbackNodes[i],callbackControlEvents=ownerCallbackControlEvents[i],callbackNode instanceof cc.ControlButton?callbackNode.addTargetWithActionForControlEvents(owner,owner[callbackName],callbackControlEvents):callbackNode.setCallback(owner[callbackName],owner);var ownerOutletNames=reader.getOwnerOutletNames(),ownerOutletNodes=reader.getOwnerOutletNodes();for(i=0;i<ownerOutletNames.length;i++)outletName=ownerOutletNames[i],outletNode=ownerOutletNodes[i],owner[outletName]=outletNode}var nodesWithAnimationManagers=reader.getNodesWithAnimationManagers(),animationManagersForNodes=reader.getAnimationManagersForNodes();if(!nodesWithAnimationManagers||!animationManagersForNodes)return node;var controllerClassCache=cc.BuilderReader._controllerClassCache;for(i=0;i<nodesWithAnimationManagers.length;i++){var j,innerNode=nodesWithAnimationManagers[i],animationManager=animationManagersForNodes[i];innerNode.animationManager=animationManager;var controllerName=animationManager.getDocumentControllerName();if(controllerName){var controllerClass=controllerClassCache[controllerName];if(!controllerClass)throw new Error("Can not find controller : "+controllerName);var controller=new controllerClass;controller.controllerName=controllerName,innerNode.controller=controller,controller.rootNode=innerNode;var documentCallbackNames=animationManager.getDocumentCallbackNames(),documentCallbackNodes=animationManager.getDocumentCallbackNodes(),documentCallbackControlEvents=animationManager.getDocumentCallbackControlEvents();for(j=0;j<documentCallbackNames.length;j++)callbackName=documentCallbackNames[j],callbackNode=documentCallbackNodes[j],callbackControlEvents=documentCallbackControlEvents[j],callbackNode instanceof cc.ControlButton?callbackNode.addTargetWithActionForControlEvents(controller,controller[callbackName],callbackControlEvents):callbackNode.setCallback(controller[callbackName],controller);var documentOutletNames=animationManager.getDocumentOutletNames(),documentOutletNodes=animationManager.getDocumentOutletNodes();for(j=0;j<documentOutletNames.length;j++)outletName=documentOutletNames[j],outletNode=documentOutletNodes[j],controller[outletName]=outletNode;controller.onDidLoadFromCCB&&cc.isFunction(controller.onDidLoadFromCCB)&&controller.onDidLoadFromCCB();var keyframeCallbacks=animationManager.getKeyframeCallbacks();for(j=0;j<keyframeCallbacks.length;j++){var callbackSplit=keyframeCallbacks[j].split(":"),callbackType=callbackSplit[0],kfCallbackName=callbackSplit[1];1==callbackType?animationManager.setCallFunc(cc.callFunc(controller[kfCallbackName],controller),keyframeCallbacks[j]):2==callbackType&&owner&&animationManager.setCallFunc(cc.callFunc(owner[kfCallbackName],owner),keyframeCallbacks[j])}}}return animationManager.runAnimations(animationManager.getAutoPlaySequenceId(),0),node},cc.BuilderReader._resourcePath="",cc.BuilderReader.setResourcePath=function(rootPath){cc.BuilderReader._resourcePath=rootPath},cc.BuilderReader.getResourcePath=function(){return cc.BuilderReader._resourcePath},cc.BuilderReader.lastPathComponent=function(pathStr){var slashPos=pathStr.lastIndexOf("/");return-1!==slashPos?pathStr.substring(slashPos+1,pathStr.length-slashPos):pathStr},cc.BuilderReader.deletePathExtension=function(pathStr){var dotPos=pathStr.lastIndexOf(".");return-1!==dotPos?pathStr.substring(0,dotPos):pathStr},cc.BuilderReader.toLowerCase=function(sourceStr){return sourceStr.toLowerCase()},cc.BuilderReader.endsWith=function(sourceStr,ending){return sourceStr.length>=ending.length&&0===sourceStr.lastIndexOf(ending)},cc.BuilderReader.concat=function(stringA,stringB){return stringA+stringB},cc.loader.register(["ccbi"],cc._binaryLoader),cc.INT_VALUE=0,cc.FLOAT_VALUE=1,cc.POINTER_VALUE=2,cc.BOOL_VALUE=3,cc.UNSIGNEDCHAR_VALUE=4,cc.BuilderValue=cc.Class.extend({_value:null,_type:0,getIntValue:function(){},getFloatValue:function(){},getBoolValue:function(){},getByteValue:function(){},getPointer:function(){},getValue:function(){return this._value}}),cc.BuilderValue.create=function(value){return new cc.BuilderValue},cc.BuilderKeyframe=cc.Class.extend({_value:null,_time:0,_easingType:0,_easingOpt:0,getValue:function(){return this._value},setValue:function(value){this._value=value},getTime:function(){return this._time},setTime:function(time){this._time=time},getEasingType:function(){return this._easingType},setEasingType:function(easingType){this._easingType=easingType},getEasingOpt:function(){return this._easingOpt},setEasingOpt:function(easingOpt){this._easingOpt=easingOpt}}),cc.BuilderSequence=cc.Class.extend({_duration:0,_name:"",_sequenceId:0,_chainedSequenceId:0,_callbackChannel:null,_soundChannel:null,ctor:function(){this._name=""},getDuration:function(){return this._duration},setDuration:function(duration){this._duration=duration},getName:function(){return this._name},setName:function(name){this._name=name},getSequenceId:function(){return this._sequenceId},setSequenceId:function(sequenceId){this._sequenceId=sequenceId},getChainedSequenceId:function(){return this._chainedSequenceId},setChainedSequenceId:function(chainedSequenceId){this._chainedSequenceId=chainedSequenceId},getCallbackChannel:function(){return this._callbackChannel},setCallbackChannel:function(channel){this._callbackChannel=channel},getSoundChannel:function(){return this._soundChannel},setSoundChannel:function(channel){this._soundChannel=channel}}),cc.BuilderSequenceProperty=cc.Class.extend({_name:null,_type:0,_keyFrames:null,ctor:function(){this.init()},init:function(){this._keyFrames=[],this._name=""},getName:function(){return this._name},setName:function(name){this._name=name},getType:function(){return this._type},setType:function(type){this._type=type},getKeyframes:function(){return this._keyFrames}}),cc.getAbsolutePosition=function(x,y,type,containerSize,propName,out){var absPt=out||cc.p(0,0);if(type===CCB_POSITIONTYPE_RELATIVE_BOTTOM_LEFT)absPt.x=x,absPt.y=y;else if(type===CCB_POSITIONTYPE_RELATIVE_TOP_LEFT)absPt.x=x,absPt.y=containerSize.height-y;else if(type===CCB_POSITIONTYPE_RELATIVE_TOP_RIGHT)absPt.x=containerSize.width-x,absPt.y=containerSize.height-y;else if(type===CCB_POSITIONTYPE_RELATIVE_BOTTOM_RIGHT)absPt.x=containerSize.width-x,absPt.y=y;else if(type===CCB_POSITIONTYPE_PERCENT)absPt.x=containerSize.width*x/100,absPt.y=containerSize.height*y/100;else if(type===CCB_POSITIONTYPE_MULTIPLY_RESOLUTION){var resolutionScale=cc.BuilderReader.getResolutionScale();absPt.x=x*resolutionScale,absPt.y=y*resolutionScale}return absPt},cc.setRelativeScale=function(node,scaleX,scaleY,type,propName){if(!node)throw new Error("cc.setRelativeScale(): node should be non-null");if(type===CCB_POSITIONTYPE_MULTIPLY_RESOLUTION){var resolutionScale=cc.BuilderReader.getResolutionScale();scaleX*=resolutionScale,scaleY*=resolutionScale}node.setScale(scaleX,scaleY)},function(){var _pos=cc.p();cc.BuilderAnimationManagerDelegate=cc.Class.extend({completedAnimationSequenceNamed:function(name){}}),cc.BuilderAnimationManager=cc.Class.extend({_sequences:null,_nodeSequences:null,_baseValues:null,_autoPlaySequenceId:0,_rootNode:null,_owner:null,_rootContainerSize:null,_delegate:null,_runningSequence:null,_documentOutletNames:null,_documentOutletNodes:null,_documentCallbackNames:null,_documentCallbackNodes:null,_documentCallbackControlEvents:null,_documentControllerName:"",_lastCompletedSequenceName:"",_keyframeCallbacks:null,_keyframeCallFuncs:null,_animationCompleteCallbackFunc:null,_target:null,_jsControlled:!1,ctor:function(){this._rootContainerSize=cc.size(0,0),this.init()},init:function(){return this._sequences=[],this._nodeSequences=new cc._Dictionary,this._baseValues=new cc._Dictionary,this._documentOutletNames=[],this._documentOutletNodes=[],this._documentCallbackNames=[],this._documentCallbackNodes=[],this._documentCallbackControlEvents=[],this._keyframeCallbacks=[],this._keyframeCallFuncs={},!0},getSequences:function(){return this._sequences},setSequences:function(seqs){this._sequences=seqs},getAutoPlaySequenceId:function(){return this._autoPlaySequenceId},setAutoPlaySequenceId:function(autoPlaySequenceId){this._autoPlaySequenceId=autoPlaySequenceId},getRootNode:function(){return this._rootNode},setRootNode:function(rootNode){this._rootNode=rootNode},getOwner:function(){return this._owner},setOwner:function(owner){this._owner=owner},addDocumentCallbackNode:function(node){this._documentCallbackNodes.push(node)},addDocumentCallbackName:function(name){this._documentCallbackNames.push(name)},addDocumentCallbackControlEvents:function(controlEvents){this._documentCallbackControlEvents.push(controlEvents)},addDocumentOutletNode:function(node){this._documentOutletNodes.push(node)},addDocumentOutletName:function(name){this._documentOutletNames.push(name)},setDocumentControllerName:function(name){this._documentControllerName=name},getDocumentControllerName:function(){return this._documentControllerName},getDocumentCallbackNames:function(){return this._documentCallbackNames},getDocumentCallbackNodes:function(){return this._documentCallbackNodes},getDocumentCallbackControlEvents:function(){return this._documentCallbackControlEvents},getDocumentOutletNames:function(){return this._documentOutletNames},getDocumentOutletNodes:function(){return this._documentOutletNodes},getLastCompletedSequenceName:function(){return this._lastCompletedSequenceName},getKeyframeCallbacks:function(){return this._keyframeCallbacks},getRootContainerSize:function(){return this._rootContainerSize},setRootContainerSize:function(rootContainerSize){this._rootContainerSize=cc.size(rootContainerSize.width,rootContainerSize.height)},getDelegate:function(){return this._delegate},setDelegate:function(delegate){this._delegate=delegate},getRunningSequenceName:function(){return this._runningSequence?this._runningSequence.getName():null},getContainerSize:function(node){return node?node.getContentSize():this._rootContainerSize},addNode:function(node,seq){this._nodeSequences.setObject(seq,node)},setBaseValue:function(value,node,propName){var props=this._baseValues.objectForKey(node);props||(props=new cc._Dictionary,this._baseValues.setObject(props,node)),props.setObject(value,propName)},moveAnimationsFromNode:function(fromNode,toNode){var locBaseValues=this._baseValues,baseValue=locBaseValues.objectForKey(fromNode);null!==baseValue&&(locBaseValues.setObject(baseValue,toNode),locBaseValues.removeObjectForKey(fromNode));var locNodeSequences=this._nodeSequences,seqs=locNodeSequences.objectForKey(fromNode);null!=seqs&&(locNodeSequences.setObject(seqs,toNode),locNodeSequences.removeObjectForKey(fromNode))},getActionForCallbackChannel:function(channel){for(var lastKeyframeTime=0,actions=[],keyframes=channel.getKeyframes(),numKeyframes=keyframes.length,i=0;i<numKeyframes;++i){var keyframe=keyframes[i],timeSinceLastKeyframe=keyframe.getTime()-lastKeyframeTime;lastKeyframeTime=keyframe.getTime(),timeSinceLastKeyframe>0&&actions.push(cc.delayTime(timeSinceLastKeyframe));var keyVal=keyframe.getValue(),selectorName=keyVal[0],selectorTarget=keyVal[1];if(this._jsControlled){var callbackName=selectorTarget+":"+selectorName,callback=this._keyframeCallFuncs[callbackName];null!=callback&&actions.push(callback)}else{var target;if(selectorTarget===CCB_TARGETTYPE_DOCUMENTROOT?target=this._rootNode:selectorTarget===CCB_TARGETTYPE_OWNER&&(target=this._owner),null!=target)if(selectorName.length>0){var selCallFunc=0;null!=target.onResolveCCBCCCallFuncSelector&&(selCallFunc=target.onResolveCCBCCCallFuncSelector(target,selectorName)),0===selCallFunc?cc.log("Skipping selector '"+selectorName+"' since no CCBSelectorResolver is present."):actions.push(cc.callFunc(selCallFunc,target))}else cc.log("Unexpected empty selector.")}}return actions.length<1?null:cc.sequence(actions)},getActionForSoundChannel:function(channel){for(var lastKeyframeTime=0,actions=[],keyframes=channel.getKeyframes(),numKeyframes=keyframes.length,i=0;i<numKeyframes;++i){var keyframe=keyframes[i],timeSinceLastKeyframe=keyframe.getTime()-lastKeyframeTime;lastKeyframeTime=keyframe.getTime(),timeSinceLastKeyframe>0&&actions.push(cc.delayTime(timeSinceLastKeyframe));var keyVal=keyframe.getValue(),soundFile=cc.BuilderReader.getResourcePath()+keyVal[0],pitch=parseFloat(keyVal[1]),pan=parseFloat(keyVal[2]),gain=parseFloat(keyVal[3]);actions.push(cc.BuilderSoundEffect.create(soundFile,pitch,pan,gain))}return actions.length<1?null:cc.sequence(actions)},runAnimationsForSequenceNamed:function(name){this.runAnimationsForSequenceIdTweenDuration(this._getSequenceId(name),0)},runAnimationsForSequenceNamedTweenDuration:function(name,tweenDuration){this.runAnimationsForSequenceIdTweenDuration(this._getSequenceId(name),tweenDuration)},runAnimationsForSequenceIdTweenDuration:function(nSeqId,tweenDuration){if(-1===nSeqId)throw new Error("cc.BuilderAnimationManager.runAnimationsForSequenceIdTweenDuration(): Sequence id should not be -1");tweenDuration=tweenDuration||0,this._rootNode.stopAllActions();for(var allKeys=this._nodeSequences.allKeys(),i=0,len=allKeys.length;i<len;i++){var node=allKeys[i];node.stopAllActions();var j,seqNodeProps=this._nodeSequences.objectForKey(node).objectForKey(nSeqId),seqNodePropNames=[];if(seqNodeProps){var propKeys=seqNodeProps.allKeys();for(j=0;j<propKeys.length;j++){var propName=propKeys[j],seqProp=seqNodeProps.objectForKey(propName);seqNodePropNames.push(propName),this._setFirstFrame(node,seqProp,tweenDuration),this._runAction(node,seqProp,tweenDuration)}}var nodeBaseValues=this._baseValues.objectForKey(node);if(nodeBaseValues){var baseKeys=nodeBaseValues.allKeys();for(j=0;j<baseKeys.length;j++){var selBaseKey=baseKeys[j];if(-1===seqNodePropNames.indexOf(selBaseKey)){var value=nodeBaseValues.objectForKey(selBaseKey);null!=value&&this._setAnimatedProperty(selBaseKey,node,value,tweenDuration)}}}}var seq=this._getSequence(nSeqId),completeAction=cc.sequence(cc.delayTime(seq.getDuration()+tweenDuration),cc.callFunc(this._sequenceCompleted,this));this._rootNode.runAction(completeAction);var action;seq.getCallbackChannel()&&(action=this.getActionForCallbackChannel(seq.getCallbackChannel()))&&this._rootNode.runAction(action),seq.getSoundChannel()&&(action=this.getActionForSoundChannel(seq.getSoundChannel()))&&this._rootNode.runAction(action),this._runningSequence=this._getSequence(nSeqId)},runAnimations:function(name,tweenDuration){tweenDuration=tweenDuration||0;var nSeqId;nSeqId=cc.isString(name)?this._getSequenceId(name):name,this.runAnimationsForSequenceIdTweenDuration(nSeqId,tweenDuration)},setAnimationCompletedCallback:function(target,callbackFunc){this._target=target,this._animationCompleteCallbackFunc=callbackFunc},setCompletedAnimationCallback:function(target,callbackFunc){this.setAnimationCompletedCallback(target,callbackFunc)},setCallFunc:function(callFunc,callbackNamed){this._keyframeCallFuncs[callbackNamed]=callFunc},debug:function(){},_getBaseValue:function(node,propName){var props=this._baseValues.objectForKey(node);return props?props.objectForKey(propName):null},_getSequenceId:function(sequenceName){for(var element=null,locSequences=this._sequences,i=0,len=locSequences.length;i<len;i++)if((element=locSequences[i])&&element.getName()===sequenceName)return element.getSequenceId();return-1},_getSequence:function(sequenceId){for(var element=null,locSequences=this._sequences,i=0,len=locSequences.length;i<len;i++)if((element=locSequences[i])&&element.getSequenceId()===sequenceId)return element;return null},_getAction:function(keyframe0,keyframe1,propName,node){var getArr,type,getValueArr,x,y,duration=keyframe1.getTime()-(keyframe0?keyframe0.getTime():0);if("rotation"===propName)return cc.BuilderRotateTo.create(duration,keyframe1.getValue());if("rotationX"===propName)return cc.BuilderRotateXTo.create(duration,keyframe1.getValue());if("rotationY"===propName)return cc.BuilderRotateYTo.create(duration,keyframe1.getValue());if("opacity"===propName)return cc.fadeTo(duration,keyframe1.getValue());if("color"===propName){var selColor=keyframe1.getValue();return cc.tintTo(duration,selColor.r,selColor.g,selColor.b)}if("visible"===propName)return keyframe1.getValue()?cc.sequence(cc.delayTime(duration),cc.show()):cc.sequence(cc.delayTime(duration),cc.hide());if("displayFrame"===propName)return cc.sequence(cc.delayTime(duration),cc.BuilderSetSpriteFrame.create(keyframe1.getValue()));if("position"===propName){type=(getArr=this._getBaseValue(node,propName))[2],x=(getValueArr=keyframe1.getValue())[0],y=getValueArr[1];var containerSize=this.getContainerSize(node.getParent()),absPos=cc.getAbsolutePosition(x,y,type,containerSize,propName);return cc.moveTo(duration,absPos)}if("scale"===propName){if(getArr=this._getBaseValue(node,propName),type=getArr[2],getValueArr=keyframe1.getValue(),x=getValueArr[0],y=getValueArr[1],type===CCB_SCALETYPE_MULTIPLY_RESOLUTION){var resolutionScale=cc.BuilderReader.getResolutionScale();x*=resolutionScale,y*=resolutionScale}return cc.scaleTo(duration,x,y)}return"skew"===propName?(getValueArr=keyframe1.getValue(),x=getValueArr[0],y=getValueArr[1],cc.skewTo(duration,x,y)):(cc.log("BuilderReader: Failed to create animation for property: "+propName),null)},_setAnimatedProperty:function(propName,node,value,tweenDuration){if(tweenDuration>0){var kf1=new cc.BuilderKeyframe;kf1.setValue(value),kf1.setTime(tweenDuration),kf1.setEasingType(CCB_KEYFRAME_EASING_LINEAR);var tweenAction=this._getAction(null,kf1,propName,node);node.runAction(tweenAction)}else{var nType,x,y;if("position"===propName)nType=this._getBaseValue(node,propName)[2],x=value[0],y=value[1],cc.getAbsolutePosition(x,y,nType,this.getContainerSize(node.getParent()),propName,_pos),node._position.x=_pos.x,node._position.y=_pos.y;else if("scale"===propName)nType=this._getBaseValue(node,propName)[2],x=value[0],y=value[1],cc.setRelativeScale(node,x,y,nType,propName);else if("skew"===propName)x=value[0],y=value[1],node._skewX=x,node._skewY=y;else if("rotation"===propName)node.setRotation(value);else if("rotationX"===propName)node._rotationX=value;else if("rotationY"===propName)node._rotationY=value;else if("opacity"===propName)node._realOpacity=value;else if("displayFrame"===propName)node.setSpriteFrame(value);else if("color"===propName)255===value.r&&255===value.g&&255===value.b||node.setColor(value);else{if("visible"!==propName)return void cc.log("unsupported property name is "+propName);value=value||!1,node.setVisible(value)}node.setNodeDirty()}},_setFirstFrame:function(node,seqProp,tweenDuration){var keyframes=seqProp.getKeyframes();if(0===keyframes.length){var baseValue=this._getBaseValue(node,seqProp.getName());baseValue||cc.log("cc.BuilderAnimationManager._setFirstFrame(): No baseValue found for property"),this._setAnimatedProperty(seqProp.getName(),node,baseValue,tweenDuration)}else{var keyframe=keyframes[0];this._setAnimatedProperty(seqProp.getName(),node,keyframe.getValue(),tweenDuration)}},_getEaseAction:function(action,easingType,easingOpt){return easingType===CCB_KEYFRAME_EASING_LINEAR||easingType===CCB_KEYFRAME_EASING_INSTANT?action:easingType===CCB_KEYFRAME_EASING_CUBIC_IN?action.easing(cc.easeIn(easingOpt)):easingType===CCB_KEYFRAME_EASING_CUBIC_OUT?action.easing(cc.easeOut(easingOpt)):easingType===CCB_KEYFRAME_EASING_CUBIC_INOUT?action.easing(cc.easeInOut(easingOpt)):easingType===CCB_KEYFRAME_EASING_BACK_IN?action.easing(cc.easeBackIn()):easingType===CCB_KEYFRAME_EASING_BACK_OUT?action.easing(cc.easeBackOut()):easingType===CCB_KEYFRAME_EASING_BACK_INOUT?action.easing(cc.easeBackInOut()):easingType===CCB_KEYFRAME_EASING_BOUNCE_IN?action.easing(cc.easeBounceIn()):easingType===CCB_KEYFRAME_EASING_BOUNCE_OUT?action.easing(cc.easeBounceOut()):easingType===CCB_KEYFRAME_EASING_BOUNCE_INOUT?action.easing(cc.easeBounceInOut()):easingType===CCB_KEYFRAME_EASING_ELASTIC_IN?action.easing(cc.easeElasticIn(easingOpt)):easingType===CCB_KEYFRAME_EASING_ELASTIC_OUT?action.easing(cc.easeElasticOut(easingOpt)):easingType===CCB_KEYFRAME_EASING_ELASTIC_INOUT?action.easing(cc.easeElasticInOut(easingOpt)):(cc.log("BuilderReader: Unknown easing type "+easingType),action)},_runAction:function(node,seqProp,tweenDuration){var keyframes=seqProp.getKeyframes(),numKeyframes=keyframes.length;if(numKeyframes>1){var actions=[],timeFirst=keyframes[0].getTime()+tweenDuration;timeFirst>0&&actions.push(cc.delayTime(timeFirst));for(var i=0;i<numKeyframes-1;++i){var kf0=keyframes[i],kf1=keyframes[i+1],action=this._getAction(kf0,kf1,seqProp.getName(),node);action&&(action=this._getEaseAction(action,kf0.getEasingType(),kf0.getEasingOpt()),actions.push(action))}node.runAction(cc.sequence(actions))}},_sequenceCompleted:function(){var locRunningSequence=this._runningSequence,locRunningName=locRunningSequence.getName();this._lastCompletedSequenceName!=locRunningSequence.getName()&&(this._lastCompletedSequenceName=locRunningSequence.getName());var nextSeqId=locRunningSequence.getChainedSequenceId();this._runningSequence=null,-1!==nextSeqId&&this.runAnimations(nextSeqId,0),this._delegate&&this._delegate.completedAnimationSequenceNamed(locRunningName),this._target&&this._animationCompleteCallbackFunc&&this._animationCompleteCallbackFunc.call(this._target)}}),cc.BuilderSetSpriteFrame=cc.ActionInstant.extend({_spriteFrame:null,initWithSpriteFrame:function(spriteFrame){return this._spriteFrame=spriteFrame,!0},update:function(time){this.target.setSpriteFrame(this._spriteFrame)}}),cc.BuilderSetSpriteFrame.create=function(spriteFrame){var ret=new cc.BuilderSetSpriteFrame;return ret&&ret.initWithSpriteFrame(spriteFrame)?ret:null},cc.BuilderRotateTo=cc.ActionInterval.extend({_startAngle:0,_dstAngle:0,_diffAngle:0,initWithDuration:function(duration,angle){return!!cc.ActionInterval.prototype.initWithDuration.call(this,duration)&&(this._dstAngle=angle,!0)},update:function(time){this.target.setRotation(this._startAngle+this._diffAngle*time)},startWithTarget:function(node){cc.ActionInterval.prototype.startWithTarget.call(this,node),this._startAngle=this.target.getRotation(),this._diffAngle=this._dstAngle-this._startAngle}}),cc.BuilderRotateTo.create=function(duration,angle){var ret=new cc.BuilderRotateTo;return ret&&ret.initWithDuration(duration,angle)?ret:null},cc.BuilderRotateXTo=cc.ActionInterval.extend({}),cc.BuilderRotateXTo.create=function(duration,angle){throw new Error("rotationX has not been implemented in cocos2d-html5")},cc.BuilderRotateYTo=cc.ActionInterval.extend({}),cc.BuilderRotateYTo.create=function(duration,angle){throw new Error("rotationY has not been implemented in cocos2d-html5")},cc.BuilderSoundEffect=cc.ActionInstant.extend({init:function(file){return this._file=file,!0},update:function(dt){cc.audioEngine.playEffect(this._file)}}),cc.BuilderSoundEffect.create=function(file,pitch,pan,gain){var ret=new cc.BuilderSoundEffect;return ret&&ret.init(file)?ret:null}}();