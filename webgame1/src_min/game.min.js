var DEF_GENERAL_CACHE=[],BattleSceneLayer=GameScene.extend({_idx:0,m_game_type:null,m_field_layer:null,m_is_show_loading:!1,m_battle_loading_modallayer:null,m_ui_layer:null,m_game_pause_modallayer:null,m_battle_start_modallayer:null,loading_resource_count:0,m_main_mission_win_result_v2:null,m_main_mission_lose_result_V2:null,m_mission_game_over_result_layer:null,m_weekly_dungeon_win_result:null,m_weekly_dungeon_lose_result:null,m_marathon_win_result:null,gameObserver:null,m_show_shop:null,m_battle_cutin_warning_modal:null,m_raid_game_over_rersult_layer:null,m_world_war_npc_result_layer:null,m_battle_gnrl_img:null,m_event_dungeon_win_result:null,m_great_wall_win_result:null,m_great_wall_lose_result:null,m_mussang_tower_win_result:null,m_once_a_day_dungeon_win_result:null,m_world_war_npc_dungeon_win_result:null,m_story_hard_mode_win_result:null,m_period:null,m_first_period_idx:0,m_second_period_idx:0,m_is_prv_event_dungeon:!1,ctor:function(){this._super(scene_BattleScene),BATTLE_SCENE_MEMORY_CLEAR=!1,BATTLE_TO_SHOP=!1,BATTLE_TO_RETRY=!1,BATTLE_TO_MISSION=!1;var service=EventDungeonService.getInstance(),event_dungeon_period_idx=0;this.m_is_prv_event_dungeon=BattleContext._getInstance().getIsPrvEventDungeon(),event_dungeon_period_idx=this.m_is_prv_event_dungeon?BattleContext._getInstance().getPrvEventDungeonPeriodIdx():BattleContext._getInstance().getEventDungeonPeriodIdx();this.m_period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),this.m_first_period_idx=service.getEventDungeonFirstHalfPeriodIdx(this.m_period.event_dungeon_group_idx),this.m_second_period_idx=service.getEventDungeonSecondHalfPeriodIdx(this.m_period.event_dungeon_group_idx),this.m_main_mission_win_result_v2=net.Res_Main_Mission_Battle_Win_V2.prototype.packet,this.m_main_mission_lose_result_V2=net.Res_Main_Mission_Battle_Lose_V2.prototype.packet,this.gameObserver=MainObserver.getInstance(),this.gameObserver.addObserver(this.onNotification,this,sceneStr[scene_BattleScene]),this.m_game_type=BattleContext._getInstance().getGameType(),this.m_show_shop=!1,this.initLayoutProgress_circle(),DEF_GENERAL_CACHE=[],this.m_battle_gnrl_img=[];for(var res_idx=0;res_idx<res_effect_battle_common.length;res_idx++)this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+".atlas"),this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+".json"),res_effect_battle_common[res_idx]==RES_CDN_DEFULT+"effect/Common_fx_appear"?(this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+".png"),IS_SP_BROWSER||(this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+"2.png"),this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+"3.png"),this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+"4.png"))):res_effect_battle_common[res_idx]==RES_CDN_DEFULT+"effect/Common_fx_freeze"?(this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+".png"),IS_SP_BROWSER||this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+"2.png")):res_effect_battle_common[res_idx]==RES_CDN_DEFULT+"effect/Common_fx_snowman"?(this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+".png"),IS_SP_BROWSER||this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+"2.png")):res_effect_battle_common[res_idx]==RES_CDN_DEFULT+"effect/Hwawoong_Maid18_fx_eternal"?(this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+".png"),IS_SP_BROWSER||this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+"2.png")):res_effect_battle_common[res_idx]==RES_CDN_DEFULT+"effect/Hajin_fx_kill_fx"?(this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+".png"),IS_SP_BROWSER||this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+"2.png")):res_effect_battle_common[res_idx]==RES_CDN_DEFULT+"effect/Hina_fx_skill_death"?(this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+".png"),IS_SP_BROWSER||this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+"2.png")):res_effect_battle_common[res_idx]==RES_CDN_DEFULT+"effect/Sonkwon_Concert_fx_sing"?(this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+".png"),this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+"2.png")):res_effect_battle_common[res_idx]==RES_CDN_DEFULT+"effect/Jegalryang_VD20_fx_Chocolat_bomb"?(this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+".png"),IS_SP_BROWSER||this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+"2.png")):res_effect_battle_common[res_idx]==RES_CDN_DEFULT+"effect/Bigiot_fx_skill_cut"?(this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+".png"),IS_SP_BROWSER||this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+"2.png")):res_effect_battle_common[res_idx]==RES_CDN_DEFULT+"effect/Sonkwon_Radio_fx_Radio"?(this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+".png"),IS_SP_BROWSER||(this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+"2.png"),this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+"3.png"))):res_effect_battle_common[res_idx]==RES_CDN_DEFULT+"effect/Dragon_Fire_fx_skill1_hit"?(this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+".png"),IS_SP_BROWSER||(this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+"2.png"),this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+"3.png"))):this.m_battle_gnrl_img.push(res_effect_battle_common[res_idx]+".png");this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_skill_cut/horizontal.plist"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_skill_cut/frame_charge2.plist"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_skill_cut/frame_charge3.plist"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_skill_cut/frame.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_skill_cut/frame_light.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_skill_cut/stencil_3.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_skill_cut/img_charge_1.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_skill_cut/img_charge_2.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_skill_cut/img_charge_3.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_great_wall/img_great_wall_text.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/img_raid_gauge_skill.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/img_raid_gauge_green.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_battle/btn/btn_x2_none.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_battle/btn/btn_x2_off.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_battle/btn/btn_x2_click.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_battle/btn/btn_pause_off.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_battle/btn/btn_pause_on.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_battle/btn/btn_auto_none.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_battle/btn/btn_auto_off.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_battle/btn/btn_auto_click.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_battle/btn/btn_cutin_none.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_battle/btn/btn_cutin_off.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_battle/btn/btn_cutin_click.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_battle/btn/btn_quick1_click.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_battle/btn/btn_quick1_none.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_battle/btn/btn_quick1_off.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_battle/btn/btn_quick2_click.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_battle/btn/btn_quick2_none.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_battle/btn/btn_quick2_off.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_battle/btn/btn_quick3_click.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_battle/btn/btn_quick3_none.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_battle/btn/btn_quick3_off.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"common/font_261.png");for(var fnt_idx=0;fnt_idx<res_bmp_font.length;fnt_idx++)this.m_battle_gnrl_img.push(res_bmp_font[fnt_idx]+".fnt"),this.m_battle_gnrl_img.push(res_bmp_font[fnt_idx]+"_0.png");this.m_game_type==db.BattleGameType.DailyDungeon&&(this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_gauge_back.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_gauge_red_2.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"effect/Daily_dungeon_hit_coin.atlas"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"effect/Daily_dungeon_hit_coin.json"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"effect/Daily_dungeon_hit_coin.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"effect/Daily_dungeon_hit_heart.atlas"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"effect/Daily_dungeon_hit_heart.json"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"effect/Daily_dungeon_hit_heart.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"effect/Daily_dungeon_hit_exp.atlas"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"effect/Daily_dungeon_hit_exp.json"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"effect/Daily_dungeon_hit_exp.png")),NOT_USE_SP_MAIN_ANIMATION&&(this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_result_win_10.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_lose_09.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_win_09.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_warning_12.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_timeout_09.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_win_sakura_03.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_win_sakura_07.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_win_sakura_11.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_win_sakura_15.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_win_skip_03.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_win_skip_07.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_win_skip_11.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_win_skip_15.png")),NOT_USE_SP_BATTLE_ANIMATION&&(this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_user_lvup_15.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/img_script_dialog_01.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/angry01.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/dark.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/shine01.png"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/upset01.png")),this.m_game_type==db.BattleGameType.EventMussangBossDungeon&&this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_vs/img_vs_boss_text.png"),this.m_game_type==db.BattleGameType.WeeklyDungeon&&(this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_vs/"+MENU_VS_BATTLE_UI_WEEKLY_TEXTURE+".plist"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_vs/"+MENU_VS_BATTLE_UI_WEEKLY_TEXTURE+".png")),this.m_game_type==db.BattleGameType.EventDungeon&&(this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_vs/"+MENU_VS_BATTLE_UI_MARATHON_TEXTURE+".plist"),this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_vs/"+MENU_VS_BATTLE_UI_MARATHON_TEXTURE+".png")),this.m_game_type==db.BattleGameType.Mussang&&this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_vs/img_vs_road_text.png"),this.m_game_type==db.BattleGameType.RaidDungeon&&this.m_battle_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/img_raid_dungeon_text.png"),cc.loader.load(this.m_battle_gnrl_img,function(err,results){err?cc.log("Failed to load %s.",this.m_battle_gnrl_img):(this.m_game_type==db.BattleGameType.WeeklyDungeon&&cc.spriteFrameCache.addSpriteFrames(RES_CDN_DEFULT+"menu_vs/"+MENU_VS_BATTLE_UI_WEEKLY_TEXTURE+".plist"),this.m_game_type==db.BattleGameType.EventDungeon&&cc.spriteFrameCache.addSpriteFrames(RES_CDN_DEFULT+"menu_vs/"+MENU_VS_BATTLE_UI_MARATHON_TEXTURE+".plist"),this.removeLayerProgress_circle(),this.initLayout())}.bind(this))},onEnter:function(){cc.log("BattleLayer onEnter"),BATTLE_TO_SHOP=!1,BATTLE_TO_RETRY=!1,BATTLE_TO_MISSION=!1,this._super()},onExit:function(){if(this._super(),!BATTLE_TO_SHOP){BattleAni._getInstance().freeAnimate(),this.m_game_type==db.BattleGameType.WeeklyDungeon&&(cc.spriteFrameCache.removeSpriteFramesFromFile(RES_CDN_DEFULT+"menu_vs/"+MENU_VS_BATTLE_UI_WEEKLY_TEXTURE+".plist"),delete cc.spriteFrameCache._frameConfigCache[RES_CDN_DEFULT+"menu_vs/"+MENU_VS_BATTLE_UI_WEEKLY_TEXTURE+".plist"]),this.m_game_type==db.BattleGameType.EventDungeon&&(cc.spriteFrameCache.removeSpriteFramesFromFile(RES_CDN_DEFULT+"menu_vs/"+MENU_VS_BATTLE_UI_MARATHON_TEXTURE+".plist"),delete cc.spriteFrameCache._frameConfigCache[RES_CDN_DEFULT+"menu_vs/"+MENU_VS_BATTLE_UI_MARATHON_TEXTURE+".plist"]);try{for(var i=0;i<this.m_battle_gnrl_img.length;i++)cc.loader.release(this.m_battle_gnrl_img[i]);this.m_battle_gnrl_img=null}catch(e){}try{for(i=0;i<DEF_GENERAL_CACHE.length;i++)cc.loader.release(DEF_GENERAL_CACHE[i]);DEF_GENERAL_CACHE=[]}catch(e){}this.removeAllChildrenWithCleanup(!0),MainObserver.getInstance().removeObserver(sceneStr[scene_BattleScene]),this.m_field_layer=null,this.m_game_type=null,this.m_field_layer=null,this.m_battle_loading_modallayer=null,this.m_ui_layer=null,this.m_game_pause_modallayer=null,this.m_battle_start_modallayer=null,this.m_main_mission_win_result_v2=null,this.m_main_mission_lose_result_V2=null,this.m_mission_game_over_result_layer=null,this.m_marathon_win_result=null,this.m_battle_gnrl_img=null,this.m_weekly_dungeon_win_result=null,this.m_weekly_dungeon_lose_result=null,this.m_marathon_win_result=null,this.gameObserver=null,this.m_show_shop=null,this.m_battle_cutin_warning_modal=null,this.m_raid_game_over_rersult_layer=null,this.m_world_war_npc_result_layer=null,this.m_event_dungeon_win_result=null,this.m_great_wall_win_result=null,this.m_great_wall_lose_result=null,this.m_mussang_tower_win_result=null,this.m_once_a_day_dungeon_win_result=null,this.m_world_war_npc_dungeon_win_result=null,this.m_story_hard_mode_win_result=null,delete this.m_game_type,delete this.m_field_layer,delete this.m_battle_loading_modallayer,delete this.m_ui_layer,delete this.m_game_pause_modallayer,delete this.m_battle_start_modallayer,delete this.m_main_mission_win_result_v2,delete this.m_main_mission_lose_result_V2,delete this.m_mission_game_over_result_layer,delete this.m_marathon_win_result,delete this.gameObserver,delete this.m_battle_gnrl_img,delete this.m_weekly_dungeon_win_result,delete this.m_weekly_dungeon_lose_result,delete this.m_marathon_win_result,delete this.m_show_shop,delete this.m_battle_cutin_warning_modal,delete this.m_raid_game_over_rersult_layer,delete this.m_world_war_npc_result_layer,delete this.m_event_dungeon_win_result,delete this.m_great_wall_win_result,delete this.m_great_wall_lose_result,delete this.m_mussang_tower_win_result,delete this.m_once_a_day_dungeon_win_result,delete this.m_world_war_npc_dungeon_win_result,delete this.m_story_hard_mode_win_result,delete this._idx,delete this.m_is_show_loading,delete this.loading_resource_count;var audio=AudioEngine.getInstance();audio.stopEffectsAll(),audio.releaseResourceEffects()}},update:function(dt){},onTutorialEnter:function(step){step.tutorial_page==TUTORIAL_PAGE_1_STORY&&(this.setTutorialStep(step),step.action_type==TutorialAction.Ready&&this.popTutorialLayer())},initLayout:function(){var context=BattleContext._getInstance();return context.getGameType()==db.BattleGameType.RaidDungeon&&1==context.getRaidBossBattleSkip()?(this.createBackgroundRaidBossForBattleSkip(),void this.scheduleOnce(function(){this.gameObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.raid_boss_game_over_for_battle_skip)}.bind(this),.5,"raid_boss_game_over_for_battle_skip")):context.getGameType()==db.BattleGameType.EventRaidDungeon&&1==context.getEventRaidDungeonBattleSkip()?(this.createBackgroundEventRaidBossForBattleSkip(),void this.scheduleOnce(function(){this.gameObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.event_raid_dungeon_game_over_for_battle_skip)}.bind(this),.5,"event_raid_dungeon_game_over_for_battle_skip")):(this.m_field_layer=new BattleFieldLayer(this),this.addChild(this.m_field_layer),void(this.m_is_show_loading||(this.showBattleLoading(),this.m_is_show_loading=!0)))},createBackgroundRaidBossForBattleSkip:function(){var bg=new cc.Sprite(RES_CDN_DEFULT+"menu_raid/bg_raid_ground.png");USE_SP_RAIDBOSS_SCALE&&bg.setScale(2),bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(this)),this.addChild(bg)},createBackgroundEventRaidBossForBattleSkip:function(){var bg=new cc.Sprite(RES_CDN_DEFULT+"menu_vs/bg_vs_boss_ground.jpg");USE_SP_RAIDBOSS_SCALE&&bg.setScale(2),bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(this)),this.addChild(bg)},getBattleField:function(){return this.m_field_layer},loadingBattleUI:function(){this.m_ui_layer=new BattleUIMng(this),this.addChild(this.m_ui_layer),this.m_game_pause_modallayer=new GameModalLayer,this.m_game_pause_modallayer.setContentSize(winSize.width,640),this.addChild(this.m_game_pause_modallayer,99999),this.m_battle_start_modallayer=new GameModalLayer,this.m_battle_start_modallayer.setContentSize(winSize.width,640),this.addChild(this.m_battle_start_modallayer,99999),this.m_battle_cutin_warning_modal=new GameModalLayer,this.m_battle_cutin_warning_modal.setContentSize(winSize.width,640),this.addChild(this.m_battle_cutin_warning_modal,99999)},onNotification:function(msg){var is_timer_stop=!1,team=null;switch(null!=this.m_field_layer&&(team=this.m_field_layer.getLeftTeam()),msg){case BattleSceneFlag.battle_skill_cut_in:case BattleSceneFlag.battle_skill_cut_out:break;case BattleSceneFlag.auto_play_on_msg:this.showToastBox("","自動戦闘が活性化されました。",1);break;case BattleSceneFlag.auto_play_off_msg:this.showToastBox("","自動戦闘が非活性化されました。",1);break;case BattleSceneFlag.auto_play_limit_general_end:USE_POPUP_INTERGRATION?this.showBattlePopup_hide(res_str("label_auto_play_invalid_title"),res_str("label_auto_play_end_limit_general_1"),res_str("label_auto_play_end_limit_general_2")):this.showAutoPlayGeneralLimitPopup();break;case BattleSceneFlag.auto_play_limit_heart_end:USE_POPUP_INTERGRATION?this.showBattlePopup_hide(res_str("label_auto_play_invalid_title"),res_str("label_auto_play_end_limit_heart_1"),res_str("label_auto_play_end_limit_heart_2")):this.showAutoPlayHeartLimitPopup();break;case BattleSceneFlag.auto_play_battle_lose_end:USE_POPUP_INTERGRATION?this.showBattlePopup_hide(res_str("label_auto_play_invalid_title"),res_str("label_auto_play_end_battle_lose_1"),res_str("label_auto_play_end_battle_lose_2")):this.showAutoPlayBattleLosePopup();break;case BattleSceneFlag.menu_battle_pause:if(!TutorialContextV2.getInstance().IsCompleteAllTutorial())return!1;this.showPausePopup(),this.m_field_layer.pauseField(),this.m_ui_layer.pauseUI();break;case BattleSceneFlag.menu_battle_session_overlap_pause:this.m_field_layer.pauseField(),this.m_ui_layer.pauseUI();break;case BattleSceneFlag.menu_result_story_hard_mode_retry:this.back(!0);break;case BattleSceneFlag.menu_result_story_hard_mode_story_map:this.back(!0,!0);break;case BattleSceneFlag.menu_result_story_hard_mode_yh_mng:case BattleSceneFlag.menu_result_story_hard_mode_ok:break;case BattleSceneFlag.menu_result_story_hard_mode_next_mission:this.back(!0,!0);break;case BattleSceneFlag.menu_result_story_hard_mode_link_play:break;case BattleSceneFlag.menu_battle_resume:this.m_field_layer.resumeField();for(var mems=team.getTeamMembers(),kdx=0;kdx<mems.length;kdx++){var m=mems[kdx];m.IsAlive()&&m.getFocusState()==FOCUS_STATE.FOCUS_SKILL&&(is_timer_stop=!0)}this.m_ui_layer.resumeUI(is_timer_stop),this.hidePausePopup();break;case BattleSceneFlag.menu_battle_drop:BATTLE_SCENE_MEMORY_CLEAR=!0,this.hidePausePopup(),BattleContext._getInstance().clearFriendInfo(),this.m_game_type==db.BattleGameType.WorldWarNpcDungeon?this.showWorldWarBattleDropPopup():this.reqCancelBattleDungeonContinue(),this.m_field_layer.initFieldObject();break;case BattleSceneFlag.new_raid_boss_entrance_go:case BattleSceneFlag.new_raid_boss_dungeon_list_go:this.back(!0,!0);break;case BattleSceneFlag.new_raid_boss_dungeon_battle_retry:this.back(!0);break;case BattleSceneFlag.menu_result_story_map:this.back(!0,!0);break;case BattleSceneFlag.menu_result_retry:BATTLE_TO_RETRY=!0,this.m_field_layer.initFieldObject(),this.back(!0,!1);break;case BattleSceneFlag.menu_result_ok:break;case BattleSceneFlag.weekly_result_ok:this.back(!0,!0);break;case BattleSceneFlag.menu_result_yh_mng:break;case BattleSceneFlag.menu_result_next_mission:this.back(!0,!0);break;case BattleSceneFlag.menu_result_link_play:case BattleSceneFlag.prologue_game_over_lose:break;case BattleSceneFlag.weekly_game_over_win:this.m_ui_layer.timerStop(),this.reqWeeklyDungeonWin();break;case BattleSceneFlag.weekly_game_over_lose:this.m_ui_layer.timerStop(),this.reqWeeklyDungeonLose();break;case BattleSceneFlag.mussang_step_game_over_win:this.m_ui_layer.timerStop(),this.reqMussangStepWin();break;case BattleSceneFlag.world_war_npc_dungeon_game_over_win:this.m_ui_layer.timerStop(),this.reqWorldWarNpcDungeonWin();break;case BattleSceneFlag.world_war_npc_dungeon_game_ove_lose:this.m_ui_layer.timerStop(),this.reqWorldWarNpcDungeonLose();break;case BattleSceneFlag.world_war_npc_dungeon_game_over_timeout:this.m_ui_layer.timerStop(),this.reqWorldWarNpcDungeonTimeout();break;case BattleSceneFlag.world_war_npc_dungeon_result_ok:BattleContext._getInstance().clearWorldWarNpcBattleData(),this.back(!0);break;case BattleSceneFlag.mussang_step_game_over_lose:this.m_ui_layer.timerStop(),this.reqMussangStepLose();break;case BattleSceneFlag.mussang_tower_game_over_win:this.m_ui_layer.timerStop(),this.reqMussangTowerWin();break;case BattleSceneFlag.mussang_tower_game_over_lose:this.m_ui_layer.timerStop(),this.reqMussangTowerLose();break;case BattleSceneFlag.mussang_step_result_ok:case BattleSceneFlag.great_wall_dungeon_game_result_ok:this.back(!0,!0);break;case BattleSceneFlag.mussang_tower_game_over_result_ok:case BattleSceneFlag.mussang_tower_game_over_tomap:this.back(!0,!1);break;case BattleSceneFlag.event_once_a_day_dungeon_game_over_win:this.m_ui_layer.timerStop(),this.reqEventOnceADayDungeonWin();break;case BattleSceneFlag.event_once_a_day_dungeon_game_over_lose:this.m_ui_layer.timerStop(),this.reqEventOnceADayDungeonLose();break;case BattleSceneFlag.event_dungeon_game_over_win:this.m_ui_layer.timerStop(),this.reqEventDungeonWin();break;case BattleSceneFlag.event_dungeon_game_over_lose:this.m_ui_layer.timerStop(),this.reqEventDungeonLose();break;case BattleSceneFlag.daily_dungeon_game_over_result:this.m_ui_layer.timerStop(),this.reqDailyDungeonResult();break;case BattleSceneFlag.daily_dungeon_game_result_ok:this.back(!0,!0);break;case BattleSceneFlag.story_hard_mode_over_win:this.m_ui_layer.timerStop(),this.reqStoryHardModeWin();break;case BattleSceneFlag.story_hard_mode_over_lose:this.m_ui_layer.timerStop(),this.reqStoryHardModeLose();break;case BattleSceneFlag.story_hard_mode_over_continue:break;case BattleSceneFlag.story_hard_mode_over_continue_confirm:this.m_box.is_show()&&this.m_box.hide(),BATTLE_SCENE_MEMORY_CLEAR=!1,this.m_ui_layer.timerStop(),this.reqStoryHardModeContinue();break;case BattleSceneFlag.game_over_win:this.reqMissionWin();var tutorial=TutorialContextV2.getInstance();if(!tutorial.IsCompleteAllTutorial())tutorial.getCurrentTutorialStep().action_type==TutorialAction.Ready&&(MainObserver.getInstance().postNotification(NOTIFICATION_TUTORIAL,message_complete_tutorial),this.reqPrologueV2());break;case BattleSceneFlag.game_over_lose:this.m_ui_layer.timerStop(),this.reqMissionLose();break;case BattleSceneFlag.great_wall_dungeon_game_over_win:this.m_ui_layer.timerStop(),this.reqGreatWallDungeonWin();break;case BattleSceneFlag.great_wall_dungeon_game_over_lose:this.m_ui_layer.timerStop(),this.reqGreatWallDungeonLose();break;case BattleSceneFlag.game_over_lose_continue:break;case BattleSceneFlag.game_over_lose_continue_confirm:this.m_box.is_show()&&this.m_box.hide(),BATTLE_SCENE_MEMORY_CLEAR=!1,this.m_ui_layer.timerStop(),this.reqMissionContinue();break;case BattleSceneFlag.battle_script_occured_before:this.m_field_layer.setScriptViewReady(!0);break;case BattleSceneFlag.battle_script_occured_before_end:this.m_field_layer.scriptHideAndVSStart();break;case BattleSceneFlag.battle_script_occured_after:break;case BattleSceneFlag.prologue_script_after_skip:this.showPrologueScriptSkip();break;case BattleSceneFlag.battle_script_occured_after_end:this.m_game_type==db.BattleGameType.Mission?this.showMainMissionGameOverResultV2(!0,this.m_main_mission_win_result_v2):this.m_game_type==db.BattleGameType.StoryHardMode||(this.m_game_type,db.BattleGameType.EventDungeon);break;case BattleSceneFlag.battle_appeared_general:this.m_ui_layer.showBattleUI();break;case BattleSceneFlag.battle_vs_start:this.m_field_layer.getRightTeam().IsCutinStage()?(this.m_ui_layer.showCutinUI(!0),this.showCutinWarning(this.m_field_layer.getRightTeam().getCutinStageBossGnrlGroup())):(this.m_ui_layer.showCutinUI(!1),this.m_ui_layer.cutinTimerStop(),this.showBattleVS(msg-BattleSceneFlag.battle_vs_start)),this.m_field_layer.battleReady(msg-BattleSceneFlag.battle_vs_start),this.m_field_layer.getLeftTeam().voiceLeader();break;case BattleSceneFlag.battle_vs_stage_1:if(this.m_game_type==db.BattleGameType.Mission)(main_mission_id=this.m_field_layer.getFieldId(this.m_game_type))==YEOWA_STAGE_ID&&BattleContext._getInstance().setMissionWin(!1);this.m_field_layer.getRightTeam().IsCutinStage()?(this.m_ui_layer.showCutinUI(!0),this.m_ui_layer.cutinTimerStop(),this.showCutinWarning(this.m_field_layer.getRightTeam().getCutinStageBossGnrlGroup())):(this.m_ui_layer.showCutinUI(!1),this.m_ui_layer.cutinTimerStop(),this.showBattleVS(msg-BattleSceneFlag.battle_vs_start)),this.m_field_layer.battleReady(msg-BattleSceneFlag.battle_vs_start);break;case BattleSceneFlag.battle_vs_stage_2:if(this.m_game_type==db.BattleGameType.Mission)(main_mission_id=this.m_field_layer.getFieldId(this.m_game_type))==YEOWA_STAGE_ID&&BattleContext._getInstance().setMissionWin(!1);this.m_field_layer.getRightTeam().IsCutinStage()?(this.m_ui_layer.showCutinUI(!0),this.showCutinWarning(this.m_field_layer.getRightTeam().getCutinStageBossGnrlGroup())):(this.m_ui_layer.showCutinUI(!1),this.m_ui_layer.cutinTimerStop(),this.showBattleVS(msg-BattleSceneFlag.battle_vs_start)),this.m_field_layer.battleReady(msg-BattleSceneFlag.battle_vs_start);break;case BattleSceneFlag.battle_vs_stage_3:if(this.m_game_type==db.BattleGameType.Mission){var main_mission_id,bgm_list=[],idx=10*(main_mission_id=this.m_field_layer.getFieldId(this.m_game_type))+3;bgm_list=MasterTable.getInstance().get_Bgm(BGM_TYPE_STORY_BATTLE_BGM,bgm_list,idx);var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm_list.at(0).sound_file_name;audio.playBackgroundMusic(path,!0),main_mission_id==YEOWA_STAGE_ID&&(BattleContext._getInstance().setMissionWin(!0),this.m_ui_layer.setMissionTimeOut())}this.m_field_layer.ScreenWarning(3),this.m_field_layer.battleReady(msg-BattleSceneFlag.battle_vs_start),this.m_field_layer.getRightTeam().IsCutinStage()?(this.m_ui_layer.showCutinUI(!0),this.showCutinWarning(this.m_field_layer.getRightTeam().getCutinStageBossGnrlGroup())):(this.m_ui_layer.showCutinUI(!1),this.m_ui_layer.cutinTimerStop(),this.showBattleVS(msg-BattleSceneFlag.battle_vs_start));break;case BattleSceneFlag.battle_prologue_direct_ready:break;case BattleSceneFlag.battle_prologue_direct_start:this.m_field_layer.hideVSLayer(),this.m_field_layer.setGamePlaying();break;case BattleSceneFlag.battle_vs_hide:this.hideBattleVS(),this.m_field_layer.hideVSLayer(),this.m_game_type==db.BattleGameType.NewRaidBossDungeon?this.m_field_layer.setNewRaidDungeonSkill():(this.m_field_layer.setGamePlaying(),this.m_ui_layer.timerStart(),this.m_field_layer.resumeDureffect());break;case BattleSceneFlag.battle_start_from_dungeon_skill:this.m_field_layer.setGamePlaying(),this.m_ui_layer.timerStart(),this.m_field_layer.resumeDureffect();break;case BattleSceneFlag.battle_vs_new_stage:this.m_field_layer.newStageBattleStart();break;case BattleSceneFlag.battle_cutin_warning_show:this.showCutinWarning(this.m_field_layer.getRightTeam().getCutinStageBossGnrlGroup());break;case BattleSceneFlag.battle_cutin_complete_show:break;case BattleSceneFlag.new_raid_boss_game_over_result:this.m_ui_layer.timerStop(),this.reqNewRaidBossResult();break;case BattleSceneFlag.new_raid_boss_game_over_battle_skip:case BattleSceneFlag.new_raid_boss_get_user_damage:break;case BattleSceneFlag.raid_boss_game_over_result:this.m_ui_layer.timerStop(),this.reqRaidBossResult(!1);break;case BattleSceneFlag.raid_boss_game_over_for_battle_skip:this.reqRaidBossResult(!0);break;case BattleSceneFlag.raid_boss_get_user_damage:this.reqGetUserRaidBossDamage();break;case BattleSceneFlag.battle_cutin_limit_time_out:this.m_ui_layer.timerStop(),this.showCutinEnd(this.m_field_layer.getRightTeam().getCutinStageBossGnrlGroup(),BattleSceneFlag.battle_cutin_failed_show_end),this.m_field_layer.setBattleStateForEventDungeonCutinTimeOut();break;case BattleSceneFlag.battle_cutin_failed_away_end:break;case BattleSceneFlag.battle_cutin_complete_show_end:this.hideCutinEnd(),this.m_field_layer.setBattleStateForEventDungeonCutinClear();break;case BattleSceneFlag.battle_cutin_failed_show_end:this.hideCutinEnd(),this.m_field_layer.setBattleStateForEventDungeonAway();break;case BattleSceneFlag.battle_cutin_warning_after_new_stage:this.hideCutinWarning(),this.m_field_layer.hideVSLayer(),this.m_field_layer.setGamePlaying(),this.m_ui_layer.timerStart(),this.m_ui_layer.cutinTimerStart();break;case BattleSceneFlag.battle_show_loading:this.showBattleLoading();break;case BattleSceneFlag.battle_hide_loading:this.hideBattleLoading(),this.m_ui_layer.showBattleUI();break;case BattleSceneFlag.battle_hide_loading_none_ui:this.hideBattleLoading();break;case BattleSceneFlag.battle_ui_loading:this.loadingBattleUI();break;case BattleSceneFlag.gain_item_add_count:this.m_ui_layer.addGainItemCount();break;case BattleSceneFlag.skip_script:this.m_ui_layer.skipScript();break;case BattleSceneFlag.battle_vs_next_stage:this.m_field_layer.nextStageMoving(),this.m_ui_layer.nextStageMoving(),this.m_ui_layer.showCutinUI(!1),this.m_ui_layer.cutinTimerStop();break;case BattleSceneFlag.battle_stop_timer:this.m_ui_layer.timerStop(),this.m_field_layer.getRightTeam().IsCutinStage()&&(this.m_ui_layer.cutinTimerStop(),this.showCutinEnd(this.m_field_layer.getRightTeam().getCutinStageBossGnrlGroup(),BattleSceneFlag.battle_cutin_complete_show_end));break;case BattleSceneFlag.battle_auto_skill_change_value:this.m_field_layer.autoSkillValueChanged();break;case BattleSceneFlag.message_ok:this.m_box.is_show()&&this.m_box.hide();break;case BattleSceneFlag.disable_pvp_skill_slot:this.showToastBox("","一騎打ちではスキルを操作できません。",2);break;case BattleSceneFlag.show_not_enough_jade:this.showNotEnoughJade(!0);break;case BattleSceneFlag.menu_result_mussang_retry:BATTLE_TO_RETRY=!0,this.m_field_layer.initFieldObject(),this.back(!0,!1);break;case BattleSceneFlag.menu_result_mussang_to_map:this.m_field_layer.initFieldObject(),this.back(!0,!0);break;case BattleSceneFlag.menu_result_weekly_continue:this.m_box.is_show()&&this.m_box.hide(),this.m_ui_layer.timerStop(),this.reqWeeklyContinue();break;case BattleSceneFlag.menu_result_weekly_retry:BATTLE_TO_RETRY=!0,this.m_field_layer.initFieldObject(),this.back(!0,!1);break;case BattleSceneFlag.menu_result_weekly_to_map:this.m_field_layer.initFieldObject(),this.back(!0,!0);break;case BattleSceneFlag.menu_result_marathon_retry:this.m_field_layer.initFieldObject(),this.back(!0,!1);break;case BattleSceneFlag.menu_result_marathon_to_map:this.m_field_layer.initFieldObject(),this.back(!0,!0);break;case BattleSceneFlag.menu_result_event_dungeon_continue:this.m_box.is_show()&&this.m_box.hide(),this.m_ui_layer.timerStop(),this.reqEventDungeonContinue();break;case BattleSceneFlag.menu_result_event_dungeon_retry:BATTLE_TO_RETRY=!0,null!=this.m_field_layer&&null!=this.m_field_layer&&this.m_field_layer.initFieldObject(),this.back(!0,!1);break;case BattleSceneFlag.menu_result_event_dungeon_to_map:null!=this.m_field_layer&&null!=this.m_field_layer&&this.m_field_layer.initFieldObject(),this.back(!0,!0);break;case BattleSceneFlag.menu_result_daily_dungeon_retry:null!=this.m_field_layer&&null!=this.m_field_layer&&this.m_field_layer.initFieldObject(),this.back(!0,!1);break;case BattleSceneFlag.menu_result_daily_dungeon_to_map:case BattleSceneFlag.menu_result_event_once_a_day_dungeon_to_map:null!=this.m_field_layer&&null!=this.m_field_layer&&this.m_field_layer.initFieldObject(),this.back(!0,!0);break;case BattleSceneFlag.menu_result_great_wall_dungeon_retry:null!=this.m_field_layer&&null!=this.m_field_layer&&this.m_field_layer.initFieldObject(),this.back(!0,!1);break;case BattleSceneFlag.menu_result_great_wall_dungeon_to_map:null!=this.m_field_layer&&null!=this.m_field_layer&&this.m_field_layer.initFieldObject(),this.back(!0,!0);break;case BattleSceneFlag.menu_result_raid_boss_retry:this.onKeyBack2();break;case BattleSceneFlag.menu_result_raid_boss_call_next_level_boss:case BattleSceneFlag.menu_result_raid_boss_boss_list:msg==BattleSceneFlag.menu_result_raid_boss_call_next_level_boss?RAID_BOSS_NEXT_FLAG=!0:RAID_BOSS_NEXT_FLAG=!1;var is_exist_scene=(mng=SceneManager.getInstance()).isExistScene(scene_RaidBossEntranceScene);if(BattleContext._getInstance().getRaidBossStartTabIndex()!=RAID_BOSS_TAB_CALL&&BattleContext._getInstance().setRaidBossStartTabIndex(RAID_BOSS_TAB_LIST),is_exist_scene){mng.reservedHistoryClearToScene(scene_RaidBossEntranceScene);var scene=new RaidBossListScene;mng.replaceScene(scene,!1)}else{mng.reservedHistoryClearToScene(scene_MainHomeScene);scene=new RaidBossListScene;mng.replaceScene(scene,!1)}break;case BattleSceneFlag.menu_result_raid_boss_raid_main:(mng=SceneManager.getInstance()).reservedHistoryClearToScene(scene_MainHomeScene);scene=new RaidBossEntranceScene;mng.replaceScene(scene);break;case BattleSceneFlag.menu_result_raid_boss_event_dungeon_main:if(is_exist_scene=(mng=SceneManager.getInstance()).isExistScene(scene_MussangEntryScene)){mng.reservedHistoryClearToScene(scene_MussangEntryScene),BattleContext._getInstance().setEventDungeonPeriodIdX(this.m_first_period_idx);scene=new EventDungeonEntranceScene;mng.replaceScene(scene)}else{mng.reservedHistoryClearToScene(scene_MainHomeScene),BattleContext._getInstance().setEventDungeonPeriodIdX(this.m_first_period_idx);scene=new EventDungeonEntranceScene;mng.replaceScene(scene)}break;case BattleSceneFlag.supporter_friend_request:var req={};req.opcode=net.OP.op_friend_request,req.frnd_user_id=BattleContext._getInstance().getFriendID(),this.network_write(req);break;case BattleSceneFlag.raid_dungeon_start:this.m_ui_layer.showCutinUI(!0),this.showCutinWarning(this.m_field_layer.getRightTeam().getCutinStageBossGnrlGroup());break;case BattleSceneFlag.mussang_boss_game_over_win:this.m_ui_layer.timerStop(),this.reqEventDungeonMussangBossWin();break;case BattleSceneFlag.mussang_boss_game_over_lose:this.m_ui_layer.timerStop(),this.reqEventDungeonMussangBossLose();break;case BattleSceneFlag.menu_result_world_war_to_map:(mng=SceneManager.getInstance()).reservedHistoryClearToScene(scene_MainHomeScene);scene=new WorldWarMapScene;mng.replaceScene(scene);break;case BattleSceneFlag.menu_result_world_war_to_main:var mng;(mng=SceneManager.getInstance()).reservedHistoryClearToScene(scene_MainHomeScene);scene=new WorldWarMainScene;mng.replaceScene(scene);break;case BattleSceneFlag.event_raid_dungeon_game_over_win:case BattleSceneFlag.event_raid_dungeon_game_over_lose:case BattleSceneFlag.event_raid_dungeon_game_over_timeout:this.m_ui_layer.timerStop(),this.reqEventRaidResult(!1);break;case BattleSceneFlag.event_raid_dungeon_game_over_for_battle_skip:this.reqEventRaidResult(!0);break;case BattleSceneFlag.msg_hide_script_log:USE_UI_3RD_SCRIPT&&this.m_ui_layer.showScriptLog(!1);break;case BattleSceneFlag.event_dungeon_game_result_ok:this.back(!0,!0);break;case NOTIFY_MENU_HOME:BATTLE_TO_SHOP=!1,this._super(msg);break;case NOTIFY_MENU_OPTION:case NOTIFY_MENU_EVENT_DUNGEON_ENTRANCE:case NOTIFY_SESSION_ERROR:default:this._super(msg)}return!0},showInvalidEntranceTime:function(){this.m_box.setTitle("タイムアウト"),this.m_box.setText("時間が遅れてクリアすることができません。"),this.m_box.addButtonInfo(new MessageButtonInfo("確認",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(NOTIFICATION_SESSION_OVERLAP_MESSAGE,message_session_overlap_application_exit)}.bind(this),.01,"application_exit"),this.m_box.hide()}.bind(this))),this.m_box.show()},back:function(release,second){cc.director.isPaused()&&cc.director.resume(),this.onKeyBack(release,second)},showWorldWarBattleDropPopup:function(){1==this.m_box.is_show()&&this.m_box.hide(),this.m_box.setTitle(res_str("label_shop_buy_jade_omission_title")),this.m_box.setText(res_str("world_war_battle_pause_abandon_popup")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_field_layer.resumeField(),this.m_ui_layer.resumeUI(),this.m_box.hide()}.bind(this))),this.m_box.show()},showPausePopup:function(){this.m_is_pause||(this.m_game_pause_modallayer._contentNode=function(contentsSize,m){var layer=new cc.Layer,menu=new BattlePauseMenuLayer;return layer.setContentSize(ccSize(menu)),layer.setPosition(.5*this.getContentSize().width,.5*this.getContentSize().height),layer.ignoreAnchorPointForPosition(!1),layer.anchorX=.5,layer.anchorY=.5,layer.addChild(menu),menu.setPosition(ccCenter(layer)),layer},this.m_game_pause_modallayer.is_show()&&this.m_game_pause_modallayer.hide(),this.m_is_pause=!0,this.m_game_pause_modallayer.show())},hidePausePopup:function(){this.m_is_pause&&(this.m_game_pause_modallayer.is_show()&&this.m_game_pause_modallayer.hide(),this.m_is_pause=!1)},showEventOnceADayDungeonGameOverResult:function(is_win,res){this.m_ui_layer.showUI(!1),null==this.m_mission_game_over_result_layer&&(this.m_mission_game_over_result_layer=new BattleMissionResultLayer_V2,this.m_mission_game_over_result_layer.setGameScene(this),this.m_mission_game_over_result_layer.ignoreAnchorPointForPosition(!1),this.m_mission_game_over_result_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_mission_game_over_result_layer.setPosition(ccCenter(this)),this.addChild(this.m_mission_game_over_result_layer,100),this.m_mission_game_over_result_layer.resultData(is_win,res,db.BattleGameType.OnceADayDungeon))},showEventDungeonGameOverResult:function(is_win,res){this.m_ui_layer.showUI(!1),null==this.m_mission_game_over_result_layer&&(this.m_mission_game_over_result_layer=new BattleMissionResultLayer_V2,this.m_mission_game_over_result_layer.setGameScene(this),this.m_mission_game_over_result_layer.ignoreAnchorPointForPosition(!1),this.m_mission_game_over_result_layer.anchorX=.5,this.m_mission_game_over_result_layer.anchorY=.5,this.m_mission_game_over_result_layer.setPosition(ccCenter(this)),this.addChild(this.m_mission_game_over_result_layer,100),this.m_mission_game_over_result_layer.resultData(is_win,res,db.BattleGameType.EventDungeon))},showDailyDungeonGameOverResult:function(is_win,res){this.m_ui_layer.showUI(!1),null==this.m_mission_game_over_result_layer&&(this.m_mission_game_over_result_layer=new BattleMissionResultLayer_V2,this.m_mission_game_over_result_layer.setGameScene(this),this.m_mission_game_over_result_layer.ignoreAnchorPointForPosition(!1),this.m_mission_game_over_result_layer.anchorX=.5,this.m_mission_game_over_result_layer.anchorY=.5,this.m_mission_game_over_result_layer.setPosition(ccCenter(this)),this.addChild(this.m_mission_game_over_result_layer,100),this.m_mission_game_over_result_layer.resultData(is_win,res,db.BattleGameType.DailyDungeon))},showNewRaidBossGameOverResult:function(res,boss_dmg){null!=this.m_ui_layer&&null!=this.m_ui_layer&&this.m_ui_layer.showUI(!1),null==this.m_raid_game_over_rersult_layer&&(this.m_raid_game_over_rersult_layer=new BattleRaidBossResultLayer,this.m_raid_game_over_rersult_layer.setGameScene(this),this.m_raid_game_over_rersult_layer.ignoreAnchorPointForPosition(!1),this.m_raid_game_over_rersult_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_raid_game_over_rersult_layer.setPosition(ccCenter(this)),this.addChild(this.m_raid_game_over_rersult_layer,100),this.m_raid_game_over_rersult_layer.resultData_NewRaid(res,boss_dmg))},showRaidBossGameOverResult:function(res){null!=this.m_ui_layer&&null!=this.m_ui_layer&&this.m_ui_layer.showUI(!1),null==this.m_raid_game_over_rersult_layer&&(this.m_raid_game_over_rersult_layer=new BattleRaidBossResultLayer,this.m_raid_game_over_rersult_layer.setGameScene(this),this.m_raid_game_over_rersult_layer.ignoreAnchorPointForPosition(!1),this.m_raid_game_over_rersult_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_raid_game_over_rersult_layer.setPosition(ccCenter(this)),this.addChild(this.m_raid_game_over_rersult_layer,100),this.m_raid_game_over_rersult_layer.resultData(res))},showMussangTowerGameOverResult:function(is_win,res){this.m_ui_layer.showUI(!1),null==this.m_mission_game_over_result_layer&&(this.m_mission_game_over_result_layer=new BattleMissionResultLayer_V2,this.m_mission_game_over_result_layer.setGameScene(this),this.m_mission_game_over_result_layer.ignoreAnchorPointForPosition(!1),this.m_mission_game_over_result_layer.anchorX=.5,this.m_mission_game_over_result_layer.anchorY=.5,this.m_mission_game_over_result_layer.setPosition(ccCenter(this)),this.addChild(this.m_mission_game_over_result_layer,100),this.m_mission_game_over_result_layer.resultData(is_win,res,db.BattleGameType.TowerDungeon))},showMussangeStepGameOverResult:function(is_win,res){this.m_ui_layer.showUI(!1),null==this.m_mission_game_over_result_layer&&(this.m_mission_game_over_result_layer=new BattleMissionResultLayer_V2,this.m_mission_game_over_result_layer.setGameScene(this),this.m_mission_game_over_result_layer.ignoreAnchorPointForPosition(!1),this.m_mission_game_over_result_layer.anchorX=.5,this.m_mission_game_over_result_layer.anchorY=.5,this.m_mission_game_over_result_layer.setPosition(ccCenter(this)),this.addChild(this.m_mission_game_over_result_layer,100),this.m_mission_game_over_result_layer.resultData(is_win,res,db.BattleGameType.Mussang))},showGreatWallDungeonGameOverWinResult:function(body){this.m_ui_layer.showUI(!1),null==this.m_mission_game_over_result_layer&&(this.m_mission_game_over_result_layer=new BattleMissionResultLayer_V2,this.m_mission_game_over_result_layer.setGameScene(this),this.m_mission_game_over_result_layer.ignoreAnchorPointForPosition(!1),this.m_mission_game_over_result_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_mission_game_over_result_layer.setPosition(ccCenter(this)),this.addChild(this.m_mission_game_over_result_layer,100),this.m_mission_game_over_result_layer.resultDataWin(body))},showGreatWallDungeonGameOverLoseResult:function(body){this.m_ui_layer.showUI(!1),null==this.m_mission_game_over_result_layer&&(this.m_mission_game_over_result_layer=new BattleMissionResultLayer_V2,this.m_mission_game_over_result_layer.setGameScene(this),this.m_mission_game_over_result_layer.ignoreAnchorPointForPosition(!1),this.m_mission_game_over_result_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_mission_game_over_result_layer.setPosition(ccCenter(this)),this.addChild(this.m_mission_game_over_result_layer,100),this.m_mission_game_over_result_layer.resultDataLose(body))},showWeeklyDungeonGameOverResult:function(is_win,res){this.m_ui_layer.showUI(!1),null==this.m_mission_game_over_result_layer&&(this.m_mission_game_over_result_layer=new BattleMissionResultLayer_V2,this.m_mission_game_over_result_layer.setGameScene(this),this.m_mission_game_over_result_layer.ignoreAnchorPointForPosition(!1),this.m_mission_game_over_result_layer.anchorX=.5,this.m_mission_game_over_result_layer.anchorY=.5,this.m_mission_game_over_result_layer.setPosition(ccCenter(this)),this.addChild(this.m_mission_game_over_result_layer,100),this.m_mission_game_over_result_layer.resultData(is_win,res,db.BattleGameType.WeeklyDungeon))},showMainStoryHardMOdeGameOverResult:function(is_win,res){this.m_ui_layer.showUI(!1),null==this.m_mission_game_over_result_layer&&(this.m_mission_game_over_result_layer=new BattleMissionResultLayer_V2,this.m_mission_game_over_result_layer.setGameScene(this),this.m_mission_game_over_result_layer.ignoreAnchorPointForPosition(!1),this.m_mission_game_over_result_layer.anchorX=.5,this.m_mission_game_over_result_layer.anchorY=.5,this.m_mission_game_over_result_layer.setPosition(ccCenter(this)),this.addChild(this.m_mission_game_over_result_layer,100),this.m_mission_game_over_result_layer.resultData(is_win,res,db.BattleGameType.StoryHardMode))},showMainMissionGameOverResultV2:function(is_win,res){this.m_ui_layer.showUI(!1),TutorialContextV2.getInstance().IsCompleteAllTutorial(),null==this.m_mission_game_over_result_layer&&(this.m_mission_game_over_result_layer=new BattleMissionResultLayer_V2,this.m_mission_game_over_result_layer.setGameScene(this),this.m_mission_game_over_result_layer.ignoreAnchorPointForPosition(!1),this.m_mission_game_over_result_layer.anchorX=.5,this.m_mission_game_over_result_layer.anchorY=.5,this.m_mission_game_over_result_layer.setPosition(ccCenter(this)),this.addChild(this.m_mission_game_over_result_layer,100),this.m_mission_game_over_result_layer.resultData(is_win,res,db.BattleGameType.Mission))},showWorldWarDungeonWinGameOverResult:function(res){this.m_ui_layer.showUI(!1),null==this.m_world_war_npc_result_layer&&(this.m_world_war_npc_result_layer=new BattleWorldWarDungeonResultLayer,this.m_world_war_npc_result_layer.ignoreAnchorPointForPosition(!1),this.m_world_war_npc_result_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_world_war_npc_result_layer.setPosition(ccCenter(this)),this.addChild(this.m_world_war_npc_result_layer,100),this.m_world_war_npc_result_layer.setGamescene(this),this.m_world_war_npc_result_layer.resultData(res,0))},showWorldWarDungeonLoseGameOverResult:function(res){this.m_ui_layer.showUI(!1),null==this.m_world_war_npc_result_layer&&(this.m_world_war_npc_result_layer=new BattleWorldWarDungeonResultLayer,this.m_world_war_npc_result_layer.ignoreAnchorPointForPosition(!1),this.m_world_war_npc_result_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_world_war_npc_result_layer.setPosition(ccCenter(this)),this.addChild(this.m_world_war_npc_result_layer,100),this.m_world_war_npc_result_layer.setGamescene(this),this.m_world_war_npc_result_layer.resultData(res,1))},showWorldWarDungeonTimeoutGameOverResult:function(res){this.m_ui_layer.showUI(!1),null==this.m_world_war_npc_result_layer&&(this.m_world_war_npc_result_layer=new BattleWorldWarDungeonResultLayer,this.m_world_war_npc_result_layer.ignoreAnchorPointForPosition(!1),this.m_world_war_npc_result_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_world_war_npc_result_layer.setPosition(ccCenter(this)),this.addChild(this.m_world_war_npc_result_layer,100),this.m_world_war_npc_result_layer.setGamescene(this),this.m_world_war_npc_result_layer.resultData(res,2))},showEventDungeonMussangBossGameOverWinResult:function(is_win,body){this.m_ui_layer.showUI(!1),null==this.m_mission_game_over_result_layer&&(this.m_mission_game_over_result_layer=new BattleMissionResultLayer_V2,this.m_mission_game_over_result_layer.setGameScene(this),this.m_mission_game_over_result_layer.ignoreAnchorPointForPosition(!1),this.m_mission_game_over_result_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_mission_game_over_result_layer.setPosition(ccCenter(this)),this.addChild(this.m_mission_game_over_result_layer,100),this.m_mission_game_over_result_layer.resultDataWin_MussangBoss(body))},showEventDungeonMussangBossGameOverLoseResult:function(is_win,body){this.m_ui_layer.showUI(!1),null==this.m_mission_game_over_result_layer&&(this.m_mission_game_over_result_layer=new BattleMissionResultLayer_V2,this.m_mission_game_over_result_layer.setGameScene(this),this.m_mission_game_over_result_layer.ignoreAnchorPointForPosition(!1),this.m_mission_game_over_result_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_mission_game_over_result_layer.setPosition(ccCenter(this)),this.addChild(this.m_mission_game_over_result_layer,100),this.m_mission_game_over_result_layer.resultDataLose_MussangBoss(body))},hideGameOverResult:function(){null!=this.m_mission_game_over_result_layer&&null!=this.m_mission_game_over_result_layer.getParent()&&(this.m_mission_game_over_result_layer.removeFromParentAndCleanup(!0),this.m_mission_game_over_result_layer=null)},showCutinEnd:function(gnrl_group,noti_msg){this.m_battle_cutin_warning_modal._contentNode=function(contentsSize,m){this.m_battle_start_modallayer.getContentSize();var layer=new cc.Layer,warning=new BattleCutinWarningLayer(gnrl_group,!1);return layer.setContentSize(ccSize(warning)),layer.setPosition(.5*this.getContentSize()),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),layer.addChild(warning),warning.setPosition(ccCenter(layer)),warning.showCutinStageEnd(noti_msg),layer}.bind(this),this.m_battle_cutin_warning_modal.is_show()&&this.m_battle_cutin_warning_modal.hide(),this.m_battle_cutin_warning_modal.show()},hideCutinEnd:function(){this.m_battle_cutin_warning_modal.is_show()&&this.m_battle_cutin_warning_modal.hide()},showCutinWarning:function(gnrl_group){this.m_battle_cutin_warning_modal._contentNode=function(contentsSize,m){this.m_battle_start_modallayer.getContentSize();var layer=new cc.Layer,warning=new BattleCutinWarningLayer(gnrl_group,!0);return layer.setContentSize(ccSize(warning)),layer.setPosition(.5*this.getContentSize()),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),layer.addChild(warning),warning.setPosition(ccCenter(layer)),layer}.bind(this),this.m_battle_cutin_warning_modal.is_show()&&this.m_battle_cutin_warning_modal.hide(),this.m_battle_cutin_warning_modal.show()},hideCutinWarning:function(){this.m_battle_cutin_warning_modal.is_show()&&this.m_battle_cutin_warning_modal.hide()},showBattleVS:function(num){this.m_battle_start_modallayer._contentNode=function(contentsSize,m){var layer=new cc.Layer,vs=new BattleVSLayer;return layer.setContentSize(ccSize(vs)),layer.setPosition(.5*this.getContentSize().width,.5*this.getContentSize().height),layer.ignoreAnchorPointForPosition(!1),layer.anchorX=.5,layer.anchorY=.5,layer.addChild(vs),vs.setPosition(ccCenter(layer)),vs.setStageNum(num),vs.startAnimation(),layer},this.m_battle_start_modallayer.is_show()&&this.m_battle_start_modallayer.hide(),this.m_battle_start_modallayer.show(),this.m_battle_start_modallayer.maskVisible()},hideBattleVS:function(){this.m_battle_start_modallayer.is_show()&&this.m_battle_start_modallayer.hide()},showBattleLoading:function(){null==this.m_battle_loading_modallayer&&(this.m_battle_loading_modallayer=new BattleLoadingLayer,this.addChild(this.m_battle_loading_modallayer)),this.m_battle_loading_modallayer.isVisible()||this.m_battle_loading_modallayer.setVisible(!0)},hideBattleLoading:function(){this.m_battle_loading_modallayer.isVisible()&&(this.m_battle_loading_modallayer.hide(),this.m_battle_loading_modallayer.setVisible(!1)),this.m_field_layer.getLeftTeam().battleAppear(),this.m_field_layer.getRightTeam().battleAppear()},reqWeeklyDungeonWin:function(){GameDefault.getInstance().getUserWeeklyTroopsNum().done(function(rVal){var troops_num=rVal,context=BattleContext._getInstance(),difficulty=context.getWeeklyDungeonDifficulty(),req={};req.opcode=net.OP.op_weekly_dungeon_battle_win,req.weekly_idx=difficulty.weekly_idx,req.weekly_difficulty_id=difficulty.weekly_difficulty.dungeon_idx,req.drop_items=context.getDungeonDropItemCount(),req.troops_num=troops_num,req.cmplt_task_ids=BattleWeeklyDungeonTaskManager.getInstance().completeTaskCheck(),this.network_write(req)}.bind(this))},reqWeeklyDungeonLose:function(){var difficulty=BattleContext._getInstance().getWeeklyDungeonDifficulty(),req={};req.opcode=net.OP.op_weekly_dungeon_battle_lose,req.weekly_idx=difficulty.weekly_idx,req.weekly_difficulty_id=difficulty.weekly_difficulty.dungeon_idx,this.network_write(req)},reqMussangStepWin:function(){GameDefault.getInstance().getUserMussangTroopsNum().done(function(mussang_troops){var context=BattleContext._getInstance(),req={};req.mussang_id=context.getMussangId(),req.opcode=net.OP.op_mussang_step_battle_win,req.period_group_idx=context.getMussangPeriodGroupIdx(),req.troops_num=mussang_troops;var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent)}.bind(this))},reqMussangStepLose:function(){var context=BattleContext._getInstance(),req={};req.opcode=net.OP.op_mussang_step_battle_lose,req.mussang_id=context.getMussangId(),req.period_group_idx=context.getMussangPeriodGroupIdx(),this.network_write(req)},reqWorldWarNpcDungeonWin:function(){var dungeon=BattleContext._getInstance().getWorldWarNpcBattleData(),req={};req.opcode=net.OP.op_world_war_move_battle_win,req.world_war_period_idx=dungeon.period.world_war_period_idx,req.event_type=dungeon.event_type,req.world_war_cell_info_idx=dungeon.world_war_cell_info_idx,req.world_war_npc_idx=dungeon.npc_troops.world_war_npc_idx,req.npc_troops_num=dungeon.npc_troops.troops_num,req.troops_num=dungeon.troops.troops_num;var mems=this.m_field_layer.getLeftTeam().getTeamMembers();req.gnrl_hp=[];for(var idx=0;idx<mems.length;idx++){var g=mems[idx].getGeneral(),p={};p.gnrl_id=g.gnrl_id,p.gnrl_num=g.gnrl_num,p.remain_hp=g.remain_hp_rate,p.dead_yn=p.remain_hp<=0?"y":"n",req.gnrl_hp.push_back(p)}this.network_write(req)},reqWorldWarNpcDungeonLose:function(){var dungeon=BattleContext._getInstance().getWorldWarNpcBattleData(),req={};req.opcode=net.OP.op_world_war_move_battle_lose,req.world_war_period_idx=dungeon.period.world_war_period_idx,req.event_type=dungeon.event_type,req.world_war_cell_info_idx=dungeon.world_war_cell_info_idx,req.world_war_npc_idx=dungeon.npc_troops.world_war_npc_idx,req.npc_troops_num=dungeon.npc_troops.troops_num,req.troops_num=dungeon.troops.troops_num;var npc_mems=this.m_field_layer.getRightTeam().getTeamMembers();req.npc_generals=[];for(var idx=0;idx<npc_mems.length;idx++){var g=npc_mems[idx].getGeneral(),npc={};npc.world_war_npc_idx=dungeon.npc_troops.world_war_npc_idx,npc.troops_num=dungeon.npc_troops.troops_num,npc.gnrl_id=g.gnrl_id,npc.position=g.position,npc.remain_hp=g.remain_hp_rate,npc.dead_yn=npc.remain_hp<=0?"y":"n",req.npc_generals.push(npc)}this.network_write(req)},reqWorldWarNpcDungeonTimeout:function(){for(var dungeon=BattleContext._getInstance().getWorldWarNpcBattleData(),mems=this.m_field_layer.getLeftTeam().getTeamMembers(),sum_enemy_team_life=0,enemy_mems=this.m_field_layer.getRightTeam().getTeamMembers(),midx=0;midx<enemy_mems.length;midx++){sum_enemy_team_life+=enemy_mems[midx].getGeneral().remain_hp_rate}if(sum_enemy_team_life<=0)this.reqWorldWarNpcDungeonWin();else{for(var sum_our_team_life=0,mem_idx=0;mem_idx<mems.length;mem_idx++){sum_our_team_life+=mems[mem_idx].getGeneral().remain_hp_rate}if(sum_our_team_life<=0)this.reqWorldWarNpcDungeonLose();else{var req={};req.opcode=net.OP.op_world_war_move_battle_time_out,req.world_war_period_idx=dungeon.period.world_war_period_idx,req.event_type=dungeon.event_type,req.world_war_cell_info_idx=dungeon.world_war_cell_info_idx,req.world_war_npc_idx=dungeon.npc_troops.world_war_npc_idx,req.npc_troops_num=dungeon.npc_troops.troops_num,req.troops_num=dungeon.troops.troops_num,req.gnrl_hp=[],req.npc_generals=[];for(var npc_mems=this.m_field_layer.getRightTeam().getTeamMembers(),idx=0;idx<mems.length;idx++){var g=mems[idx].getGeneral(),p={};p.gnrl_id=g.gnrl_id,p.gnrl_num=g.gnrl_num,p.remain_hp=g.remain_hp_rate,p.dead_yn=p.remain_hp<=0?"y":"n",req.gnrl_hp.push_back(p)}for(idx=0;idx<npc_mems.length;idx++){g=npc_mems[idx].getGeneral();var npc={};npc.world_war_npc_idx=dungeon.npc_troops.world_war_npc_idx,npc.troops_num=dungeon.npc_troops.troops_num,npc.gnrl_id=g.gnrl_id,npc.position=g.position,npc.remain_hp=g.remain_hp_rate,npc.dead_yn=npc.remain_hp<=0?"y":"n",req.npc_generals.push_back(npc)}this.network_write(req)}}},reqEventRaidWin:function(boss_num,dmg){GameDefault.getInstance().getUserEventRaidDungeonTroopsNum().done(function(troops_num){var netservice=new NetService,req={},context=BattleContext._getInstance();GameDefault.getInstance();req.opcode=net.OP.op_event_raid_dungeon_battle_win,req.event_dungeon_period_idx=context.getEventDungeonPeriodIdx(),req.event_raid_dungeon_idx=context.getEventRaidDungeonData().event_raid_dungeon_idx,req.boss_num=boss_num,req.troops_num=troops_num,req.event_raid_dungeon_num=netservice.get_Event_Raid_Dungeon_num(),req.damage=parseInt(dmg),this.network_write(req)}.bind(this))},reqEventRaidlose:function(boss_num,dmg){GameDefault.getInstance().getUserEventRaidDungeonTroopsNum().done(function(troops_num){var netservice=new NetService,req={},context=BattleContext._getInstance();GameDefault.getInstance();req.opcode=net.OP.op_event_raid_dungeon_battle_lose,req.event_dungeon_period_idx=context.getEventDungeonPeriodIdx(),req.event_raid_dungeon_idx=context.getEventRaidDungeonData().event_raid_dungeon_idx,req.boss_num=boss_num,req.troops_num=troops_num,req.event_raid_dungeon_num=netservice.get_Event_Raid_Dungeon_num(),req.damage=parseInt(dmg),this.network_write(req)}.bind(this))},reqEventRaidResult:function(is_skip){var dmg=0,netservice=new NetService,context=BattleContext._getInstance(),Info=(GameDefault.getInstance(),netservice.get_Event_Raid_Dungeon_Info());if(1==is_skip)for(var idx=0;idx<Info.event_raid_boss_info.boss_damage.length;idx++)Info.event_raid_boss_info.boss_damage[idx].multiple_type==context.getEventRaidDungeonBattleTicket()&&(dmg=Info.event_raid_boss_info.boss_damage[idx].damage);else{var right_team=this.getBattleField().getRightTeam().getTeamMembers(),boss=null;for(idx=0;idx<right_team.length;idx++)right_team[idx].getGeneral().is_zoom&&(boss=right_team[idx]);null!=boss&&(dmg=this.getBattleField().getLeftTeam().getEventRaidDungeonAccumLife()>=boss.getMaxHealthPoint()?boss.getMaxHealthPoint():this.getBattleField().getLeftTeam().getEventRaidDungeonAccumLife())}this.reqEventRaidWin(Info.event_raid_boss_info.boss_num,dmg)},reqEventRaidTimeout:function(){GameDefault.getInstance().getUserEventRaidDungeonTroopsNum().done(function(troops_num){for(var netservice=new NetService,accum_damage=0,req={},context=BattleContext._getInstance(),right_team=(GameDefault.getInstance(),this.getBattleField().getRightTeam().getTeamMembers()),boss=null,idx=0;idx<right_team.length;idx++)right_team[idx].getGeneral().is_zoom&&(boss=right_team[idx]);null!=boss&&(accum_damage=this.getBattleField().getLeftTeam().getEventRaidDungeonAccumLife()>=boss.getMaxHealthPoint()?boss.getMaxHealthPoint():this.getBattleField().getLeftTeam().getEventRaidDungeonAccumLife());var res=netservice.get_Event_Raid_Dungeon_Info();req.opcode=net.OP.op_event_raid_dungeon_battle_lose,req.event_dungeon_period_idx=context.getEventDungeonPeriodIdx(),req.event_raid_dungeon_idx=context.getEventRaidDungeonData().event_raid_dungeon_idx,req.boss_num=res.event_raid_boss_info.boss_num,req.troops_num=troops_num,req.event_raid_dungeon_num=netservice.get_Event_Raid_Dungeon_num(),req.damage=parseInt(accum_damage),this.network_write(req)}.bind(this))},reqGreatWallDungeonWin:function(){GameDefault.getInstance().getUserGreatWallTroopsNum().done(function(troops_num){var context=BattleContext._getInstance(),gw_service=GreatWallService.getInstance(),req={};req.opcode=net.OP.op_great_wall_dungeon_battle_win,req.troops_gnrl_battle_result=[];var great_wall_dungeon_period_idx=gw_service.getCurrentGreatWallPeriodIdx();if(0<great_wall_dungeon_period_idx){var dungeon=context.getGreatWallDungeonData();req.great_wall_dungeon_period_idx=great_wall_dungeon_period_idx,req.great_wall_dungeon_group_idx=dungeon.great_wall_dungeon_group_idx,req.great_wall_dungeon_idx=dungeon.great_wall_dungeon_idx,req.troops_num=troops_num;for(var mems=this.m_field_layer.getLeftTeam().getTeamMembers(),idx=0;idx<mems.length;idx++){var g=mems[idx].getGeneral(),p={};p.great_wall_dungeon_period_idx=great_wall_dungeon_period_idx,p.remain_hp_rate=g.remain_hp_rate,p.remain_hp_rate<=0&&(g.is_dead=!0),p.dead_yn=g.is_dead?"y":"n",p.gnrl_id=g.gnrl_id,p.gnrl_num=g.gnrl_num,p.remain_skill_count=g.remain_skill_count,req.troops_gnrl_battle_result.push_back(p)}this.network_write(req)}}.bind(this))},reqGreatWallDungeonLose:function(){GameDefault.getInstance().getUserGreatWallTroopsNum().done(function(troops_num){var context=BattleContext._getInstance(),great_wall_dungeon_period_idx=GreatWallService.getInstance().getCurrentGreatWallPeriodIdx();if(0<great_wall_dungeon_period_idx){var dungeon=context.getGreatWallDungeonData(),req={};req.opcode=net.OP.op_great_wall_dungeon_battle_lose,req.npc_gnrl_battle_result=[],req.great_wall_dungeon_period_idx=great_wall_dungeon_period_idx,req.great_wall_dungeon_group_idx=dungeon.great_wall_dungeon_group_idx,req.great_wall_dungeon_idx=dungeon.great_wall_dungeon_idx,req.troops_num=troops_num,req.troops_gnrl_battle_result=[];for(var npc_mems=this.m_field_layer.getRightTeam().getTeamMembers(),idx=0;idx<npc_mems.length;idx++){var g=npc_mems[idx].getGeneral(),npc={};npc.great_wall_dungeon_period_idx=great_wall_dungeon_period_idx,npc.great_wall_dungeon_group_idx=dungeon.great_wall_dungeon_group_idx,npc.great_wall_dungeon_idx=dungeon.great_wall_dungeon_idx,npc.position=g.position,npc.remain_hp_rate=g.remain_hp_rate,npc.dead_yn=g.is_dead?"y":"n",req.npc_gnrl_battle_result.push_back(npc)}var mems=this.m_field_layer.getLeftTeam().getTeamMembers();for(idx=0;idx<mems.length;idx++){g=mems[idx].getGeneral();var p={};p.great_wall_dungeon_period_idx=great_wall_dungeon_period_idx,p.remain_hp_rate=g.remain_hp_rate,p.dead_yn=g.is_dead?"y":"n",p.gnrl_id=g.gnrl_id,p.gnrl_num=g.gnrl_num,p.remain_skill_count=g.remain_skill_count,req.troops_gnrl_battle_result.push_back(p)}this.network_write(req)}}.bind(this))},reqNewRaidBossResult:function(){GameDefault.getInstance().getUserTroopsNum().done(function(troops_num){var dungeon=BattleContext._getInstance().getBattleNewRaidBossDungeonData(),req={};req.opcode=net.OP.op_new_raid_boss_dungeon_battle_result,req.discovered_user_id=dungeon.dungeon.discovered_user_id,req.new_raid_boss_period_idx=dungeon.dungeon.new_raid_boss_period_idx,req.new_raid_boss_dungeon_info_idx=dungeon.dungeon.new_raid_boss_dungeon_info_idx,req.boss_num=dungeon.dungeon.boss_num,req.troops_num=troops_num,req.boss_damage_list=[];for(var dmg_info=this.m_field_layer.getRightTeam().getNewRaidBossDamageInfo(),dmg_info_keys=dmg_info.keys(),key_idx=0;key_idx<dmg_info_keys.length;key_idx++){var dmg={};dmg.boss_npc_idx=dmg_info_keys[key_idx],dmg.damage=dmg_info.at(dmg_info_keys[key_idx]),req.boss_damage_list.push_back(dmg)}this.network_write(req)}.bind(this))},reqRaidBossResult:function(is_skip){GameDefault.getInstance().getUserRaidBossTroopsNum();GameDefault.getInstance().getUserRaidBossTroopsNum().done(function(num){var context=BattleContext._getInstance(),dungeon=context.getRaidDungeonData(),req={};req.opcode=net.OP.op_raid_boss_battle_result,req.discovered_user_id=dungeon.data.discovered_user_id,req.raid_boss_period_idx=dungeon.data.raid_boss_period_idx,req.raid_boss_num=dungeon.data.raid_boss_num,req.troops_num=num;var dmg=0;(dmg=1==is_skip?context.getUserRaidBossBeforeDamage():this.getBattleField().getLeftTeam().getEventDungeonCutinAccumDamage())>dungeon.data.remain_hp&&(dmg=dungeon.data.remain_hp),req.damage=dmg,req.battle_win_yn=req.damage>=dungeon.data.remain_hp?"y":"n",this.network_write(req)}.bind(this))},reqGetUserRaidBossDamage:function(){var req={};req.opcode=net.OP.op_get_user_raid_boss_damage;var raid_boss_battle_info=BattleContext._getInstance().getRaidBossData();req.raid_boss_info_idx=raid_boss_battle_info.raid_boss_info_idx,req.boss_level=raid_boss_battle_info.boss_level,this.network_write(req)},reqDailyDungeonResult:function(){var context=BattleContext._getInstance(),defer=GameDefault.getInstance().getUserDailyDungeonTroopsNum(),troops_num=1;defer.done(function(rVal){troops_num=rVal});for(var dungeon=context.getDailyDungeonData(),team_total_life=this.m_field_layer.getRightTeam().getTeamTotalLifePoint(),team_cur_life=this.m_field_layer.getRightTeam().getCurrentTeamTotalLifePoint(),per=(team_total_life-team_cur_life)/team_total_life*1e4,accum_damage_type=1,m=MasterTable.getInstance(),accum_dmg_list=m.get_DailyDungeonAccumDamageInfoList(dungeon.daily_dungeon.daily_dungeon_accum_damage_info_idx),idx=0;idx<accum_dmg_list.length;idx++){var ac=accum_dmg_list[idx];if(ac.min_damage<=per&&per<=ac.max_damage){accum_damage_type=ac.accum_damage_type;break}}var is_dungeon_clear=0==team_cur_life,req={};if(req.opcode=net.OP.op_daily_dungeon_battle_result,req.daily_dungeon_idx=dungeon.daily_dungeon.daily_dungeon_idx,req.daily_dungeon_period_idx=dungeon.daily_dungeon_period.daily_dungeon_period_idx,req.accum_damage_type=accum_damage_type,req.troops_num=troops_num,req.dungeon_clear_yn=is_dungeon_clear?"y":"n",req.damage_percent=per/100,is_dungeon_clear){var clear_time_bonus=m.get_DailyDungeonClearTimeBonusList(dungeon.daily_dungeon.daily_dungeon_clear_time_bonus_idx),remain_time=this.m_ui_layer.getCurTime(),cost_time=dungeon.daily_dungeon.limit_time-parseInt(remain_time);for(idx=0;idx<clear_time_bonus.length;idx++){var t=clear_time_bonus[idx];if(cost_time>=t.clear_time_min&&cost_time<=t.clear_time_max){req.clear_time_type=t.clear_time_type;break}}}else req.clear_time_type=0;this.network_write(req)},reqEventOnceADayDungeonWin:function(){var dungeon=BattleContext._getInstance().getEventOnceADayDungeonData();GameDefault.getInstance().getUserOnceADayDungeonTroopsNum().done(function(rVal){troops_num=rVal;var req={};req.opcode=net.OP.op_event_once_a_day_dungeon_battle_win,req.event_dungeon_once_a_day_idx=dungeon.dungeon.event_dungeon_once_a_day_idx,req.event_dungeon_period_idx=dungeon.period.event_dungeon_period_idx,req.troops_num=troops_num,this.network_write(req)}.bind(this))},reqEventOnceADayDungeonLose:function(){var dungeon=BattleContext._getInstance().getEventOnceADayDungeonData();GameDefault.getInstance().getUserOnceADayDungeonTroopsNum().done(function(rVal){troops_num=rVal;var req={};req.opcode=net.OP.op_event_once_a_day_dungeon_battle_lose,req.event_dungeon_once_a_day_idx=dungeon.dungeon.event_dungeon_once_a_day_idx,req.event_dungeon_period_idx=dungeon.period.event_dungeon_period_idx,req.troops_num=troops_num,this.network_write(req)}.bind(this))},reqEventDungeonWin:function(){var context=BattleContext._getInstance(),m=MasterManager.getInstance(),dungeon=context.getEventDungeonData();this.m_is_show_script=this.m_ui_layer.IsEventDungeonScriptShow(dungeon.event_dungeon.event_dungeon_idx,2),GameDefault.getInstance().getUserEventDungeonTroopsNum().done(function(rVal){troops_num=rVal;var req={};req.opcode=net.OP.op_event_dungeon_battle_win,req.event_dungeon_idx=dungeon.event_dungeon.event_dungeon_idx,req.event_dungeon_period_idx=dungeon.event_dungeon_period.event_dungeon_period_idx,req.troops_num=troops_num,req.frnd_user_id=context.getFriendID();var cutin_stage=context.getEventDungeonCutinStage();if(req.cutin_stage=cutin_stage,0!=req.cutin_stage){var info=m.get_EventDungeonCutinInfo(dungeon.event_dungeon_cutin_info_idx);req.damage_accum_type_bonus_idx=info.event_dungeon_cutin_damage_accum_info_idx;var damage_accum_info_list=MasterTable.getInstance().get_EventDungeonCutinDamageAccumTypeBonusList(info.event_dungeon_cutin_damage_accum_info_idx),max_life=this.m_field_layer.getRightTeam().getEventDungeonCutinBossMaxLife(),accum_dmg=this.m_field_layer.getLeftTeam().getEventDungeonCutinAccumDamage();max_life<accum_dmg&&(accum_dmg=max_life);for(var i=0;i<damage_accum_info_list.length;i++){var data=damage_accum_info_list[i];if(accum_dmg>=data.damage_min_value&&accum_dmg<=data.damage_max_value){req.damage_accum_type=data.damage_accum_type;break}}2e9<accum_dmg&&(accum_dmg=2e9),req.damage_accum_point=accum_dmg}else req.damage_accum_type_bonus_idx=0,req.damage_accum_type=0,req.damage_accum_point=0;req.cmplt_task_ids=BattleEventDungeonTaskManager.getInstance().completeTaskCheck(),this.network_write(req)}.bind(this))},reqEventDungeonLose:function(){var dungeon=BattleContext._getInstance().getEventDungeonData(),req={};req.opcode=net.OP.op_event_dungeon_battle_lose,req.event_dungeon_idx=dungeon.event_dungeon.event_dungeon_idx,req.event_dungeon_period_idx=dungeon.event_dungeon_period.event_dungeon_period_idx,this.network_write(req)},reqEventDungeonContinue:function(){var context=BattleContext._getInstance(),dungeon=context.getEventDungeonData();GameDefault.getInstance().getUserEventDungeonTroopsNum().done(function(rVal){troops_num=rVal;var req={};req.opcode=net.OP.op_event_dungeon_battle_continue,req.event_dungeon_idx=dungeon.event_dungeon.event_dungeon_idx,req.frnd_user_id=context.getFriendID(),req.event_dungeon_period_idx=dungeon.event_dungeon_period.event_dungeon_period_idx,req.troops_num=troops_num;var cutin_stage=context.getEventDungeonCutinStage();req.cutin_stage=cutin_stage,0!=req.cutin_stage&&(req.event_dungeon_cutin_info_idx=dungeon.event_dungeon_cutin_info_idx),this.network_write(req)}.bind(this))},reqMussangTowerWin:function(){var context=BattleContext._getInstance(),period={};MussangService().getCurrentMussangTowerPeriod(period),GameDefault.getInstance().getUserTowerDungeonTroopsNum().done(function(rVal){troops_num=rVal;var dungeon=context.getMussangTowerDungeonData(),mussang_tower_period_idx=period.period_idx,req={};req.opcode=net.OP.op_mussang_tower_battle_win,req.mussang_tower_period_idx=mussang_tower_period_idx,req.mussang_tower_idx=dungeon.mussang_tower.mussang_tower_id,req.troops_num=troops_num,req.cmplt_task_ids=BattleTowerTaskManager._getInstance().clearTaskCheck(),this.network_write(req)}.bind(this))},reqMussangTowerLose:function(){var context=BattleContext._getInstance(),period={};MussangService().getCurrentMussangTowerPeriod(period),GameDefault.getInstance().getUserTowerDungeonTroopsNum().done(function(rVal){troops_num=rVal;var dungeon=context.getMussangTowerDungeonData(),mussang_tower_period_idx=period.period_idx,req={};req.opcode=net.OP.op_mussang_tower_battle_lose,req.mussang_tower_period_idx=mussang_tower_period_idx,req.mussang_tower_idx=dungeon.mussang_tower.mussang_tower_id,req.troops_num=troops_num,this.network_write(req)}.bind(this))},reqStoryHardModeWin:function(){var context=BattleContext._getInstance();BattleService.getInstance();if(1==USE_LOCAL_STORAGE_TROOPS_OFF){troops_num=GameDefault.getInstance().getUserTroopsNum();var main_story_hard_mode_mission_idx=context.getStoryHardModeMissionId(),req={};req.opcode=net.OP.op_main_story_hard_mode_mission_battle_win,req.main_story_hard_mode_mission_idx=main_story_hard_mode_mission_idx,req.troops_num=troops_num,req.frnd_user_id=context.getFriendID(),req.drop_items=context.getDungeonDropItemCount(),req.cmplt_task_ids=BattleStoryHardModeMissionTaskManager._getInstance().clearTaskCheck(),this.network_write(req)}else{GameDefault.getInstance().getUserTroopsNum().done(function(rVal){troops_num=rVal;var main_story_hard_mode_mission_idx=context.getStoryHardModeMissionId(),req={};req.opcode=net.OP.op_main_story_hard_mode_mission_battle_win,req.main_story_hard_mode_mission_idx=main_story_hard_mode_mission_idx,req.troops_num=troops_num,req.frnd_user_id=context.getFriendID(),req.drop_items=context.getDungeonDropItemCount(),req.cmplt_task_ids=BattleStoryHardModeMissionTaskManager._getInstance().clearTaskCheck(),this.network_write(req)}.bind(this))}},reqStoryHardModeLose:function(){var main_story_hard_mode_mission_idx=BattleContext._getInstance().getStoryHardModeMissionId(),req=net.Req_Main_Story_Hard_Mode_Mission_Battle_Lose.prototype.packet;req.opcode=net.Req_Main_Story_Hard_Mode_Mission_Battle_Lose.prototype.ID,req.main_story_hard_mode_mission_idx=main_story_hard_mode_mission_idx;var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent)},reqStoryHardModeContinue:function(){var context=BattleContext._getInstance(),main_story_hard_mode_mission_idx=context.getStoryHardModeMissionId();GameDefault.getInstance().getUserStoryHardModeTroopsNum().done(function(data){var troops_num=data,req={};req.opcode=net.OP.op_main_story_hard_mode_mission_battle_continue,req.main_story_hard_mode_mission_idx=main_story_hard_mode_mission_idx,req.troops_num=troops_num,req.frnd_user_id=context.getFriendID(),this.network_write(req)}.bind(this))},reqMissionWin:function(){cc.log("Debug BattleScene reqMissionWin");var context=BattleContext._getInstance(),service=BattleService.getInstance();1==USE_LOCAL_STORAGE_TROOPS_OFF?troops_num=GameDefault.getInstance().getUserTroopsNum():GameDefault.getInstance().getUserTroopsNum().done(function(rVal){troops_num=rVal});var mission_id=context.getMissionID();this.m_is_show_script=this.m_ui_layer.IsShowScript(mission_id,2);var req={};req.opcode=net.OP.op_main_mission_battle_win_v2,req.mission_id=mission_id,req.troops_num=troops_num,req.frnd_user_id=context.getFriendID(),req.drop_items=context.getDungeonDropItemCount(),battle_mission=$.extend({},database.BattleMainMission),service.getMainMissionAndNpc(mission_id,battle_mission);for(var stage_npc_keys,gnrl_wipeout=0,boss_wipeout=0,keyCnt=(stage_npc_keys=battle_mission.stage_npc.keys()).length,j=0;j<keyCnt;j++)for(var npc=battle_mission.stage_npc.at(stage_npc_keys[j]),cnt=npc.length,i=0;i<cnt;i++)npc[i].is_zoom?boss_wipeout++:gnrl_wipeout++;req.boss_wipeout_count=boss_wipeout,req.gnrl_wipeout_count=gnrl_wipeout,req.cmplt_task_ids=BattleMissionTaskManager._getInstance().clearTaskCheck();var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent)},reqMissionLose:function(){var mission_id=BattleContext._getInstance().getMissionID(),req=net.Req_Main_Mission_Battle_Lose_V2.prototype.packet;req.opcode=net.Req_Main_Mission_Battle_Lose_V2.prototype.ID,req.mission_id=mission_id;var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent)},reqWeeklyContinue:function(){var difficulty=BattleContext._getInstance().getWeeklyDungeonDifficulty(),weekly_idx=difficulty.weekly_idx,weekly_difficulty_idx=difficulty.weekly_difficulty.dungeon_idx;GameDefault.getInstance().getUserWeeklyTroopsNum().done(function(rVal){var troops_num=rVal,req={};req.opcode=net.OP.op_weekly_dungeon_battle_continue,req.weekly_idx=weekly_idx,req.weekly_difficulty_id=weekly_difficulty_idx,req.troops_num=troops_num,this.network_write(req)}.bind(this))},reqMissionContinue:function(){var context=BattleContext._getInstance(),mission_id=context.getMissionID();if(1==USE_LOCAL_STORAGE_TROOPS_OFF){var troops_num=GameDefault.getInstance().getUserTroopsNum(),req={};req.opcode=net.OP.op_main_mission_battle_continue,req.mission_id=mission_id,req.troops_num=troops_num,req.frnd_user_id=context.getFriendID(),this.network_write(req)}else{GameDefault.getInstance().getUserTroopsNum().done(function(data){var troops_num=data,req={};req.opcode=net.OP.op_main_mission_battle_continue,req.mission_id=mission_id,req.troops_num=troops_num,req.frnd_user_id=context.getFriendID(),this.network_write(req)}.bind(this))}},showPrologueScriptSkip:function(){this.m_box.setTitle("プロローグ"),this.m_box.setText("プロローグをスキップしますか。"),this.m_box.addButtonInfo(new MessageButtonInfo("取消",MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo("確認",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(){this.m_ui_layer.showScript(!1),this.gameObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.battle_script_occured_after_end)},.1,"battle_script_occured_after_end"),this.m_box.hide()}.bind(this))),this.m_box.is_show()||this.m_box.show()},resumeScene:function(){},pauseScene:function(){},onKeyBack:function(release,second){GameScene.prototype.onKeyBack(release,second)},setTotalLoadResourceCount:function(count){null==this.m_battle_loading_modallayer?this.loading_resource_count=count:(this.loading_resource_count=count,this.m_battle_loading_modallayer.setTotalLoadingResourceCount(count))},addLoadedResourceCount:function(count){null!=this.m_battle_loading_modallayer&&this.m_battle_loading_modallayer.addCompleteResourceLoaded(count)},showAutoPlayLimit:function(){this.m_box.setTitle("自動戦闘"),this.m_box.setText("自動戦闘を全部使用しました。"),this.m_box.setText("\n"),this.m_box.setText("翡翠 10個を使用して 100回充電しますか。"),this.m_box.addButtonInfo(new MessageButtonInfo("取消",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo("確認",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(){this.reqAutoPlayContinue()},.1,"reqAutoPlayContinue"),this.m_box.hide()}.bind(this))),this.m_box.show()},reqAutoPlayContinue:function(){},reqPrologueV2:function(){if(!UserService.getInstance().IsPrologueComplete()){var req={};req.opcode=net.OP.op_user_prologue_v2_complete,this.network_write(req,!1)}},showSkillCutIn:function(gnrl){AudioEngine.getInstance().pauseEffectsAll(),this.m_field_layer.getLeftTeam().skillCutPauseTeam(gnrl),this.m_field_layer.getRightTeam().skillCutPauseTeam(gnrl)},showSkillCutOut:function(gnrl){this.m_field_layer.getLeftTeam().skillCutResumeTeam(gnrl)},resumeSkillEnd:function(gnrl){this.m_field_layer.getLeftTeam().skillEndResumeTeam(gnrl),this.m_field_layer.getRightTeam().skillEndResumeTeam(gnrl)},reqCancelBattleDungeonContinue:function(){var req={};req.opcode=net.OP.op_cancel_battle_dungeon_continue,this.network_write(req)},dailyDungeonTimeLimitComplete:function(){this.m_field_layer.dailyDungeonTimeOverComplete()},newRaidBossDungeonTimeLimitComplete:function(){this.m_field_layer.setTimeOutForNewRaidBossDungeon()},raidDungeonTimeLimitComplete:function(){this.m_field_layer.setTimeOutForRaidDungeon()},worldWarNpcDungeonTimeLimitComplete:function(){this.m_field_layer.setTimeOutForWorldWarNpcDungeon()},MussangBossDungeonTimeLimitComplete:function(){this.m_field_layer.setTimeOutForMussangBoss()},EventRaidTimeLimitComplete:function(){this.m_field_layer.setTimeOutForEventRaidDungeon()},reqEventDungeonMussangBossWin:function(){GameDefault.getInstance().getUserEventMussangBossTroopsNum().done(function(rVal){troops_num=rVal;var data=BattleContext._getInstance().getEventMussangBossData(),req={};req.opcode=net.OP.op_event_dungeon_mussang_boss_battle_win,req.troops_num=troops_num,req.boss_dungeon_idx=data.boss_dungeon_idx,req.event_dungeon_period_idx=data.event_dungeon_period_idx,req.win_yn="y",req.damage_hp=this.getBattleField().getLeftTeam().getEventDungeonMusssangBossAccumDamage(),NetService().set_User_Mussang_Boss_Hp(req.boss_dungeon_idx,req.damage_hp,req.win_yn),NetService().clearBattleDungeonContinue(),this.network_write(req)}.bind(this))},reqEventDungeonMussangBossLose:function(){GameDefault.getInstance().getUserEventMussangBossTroopsNum().done(function(rVal){troops_num=rVal;var data=BattleContext._getInstance().getEventMussangBossData(),req={};req.opcode=net.OP.op_event_dungeon_mussang_boss_battle_lose,req.boss_dungeon_idx=data.boss_dungeon_idx,req.event_dungeon_period_idx=data.event_dungeon_period_idx,req.win_yn="n",req.troops_num=troops_num,req.damage_hp=this.getBattleField().getLeftTeam().getEventDungeonMusssangBossAccumDamage(),NetService().set_User_Mussang_Boss_Hp(req.boss_dungeon_idx,req.damage_hp,req.win_yn),NetService().clearBattleDungeonContinue(),this.network_write(req)}.bind(this))},showEventRaidWinGameOverResult:function(res){null!=this.m_ui_layer&&null!=this.m_ui_layer&&this.m_ui_layer.showUI(!1),null==this.m_mission_game_over_result_layer&&(this.m_mission_game_over_result_layer=new BattleMissionResultLayer_V2,this.m_mission_game_over_result_layer.setGameScene(this),this.m_mission_game_over_result_layer.ignoreAnchorPointForPosition(!1),this.m_mission_game_over_result_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_mission_game_over_result_layer.setPosition(ccCenter(this)),this.addChild(this.m_mission_game_over_result_layer,100),this.m_mission_game_over_result_layer.resultDataWin_RaidDungeon(res))},showEventRaidLoseGameOverResult:function(res){null!=this.m_ui_layer&&null!=this.m_ui_layer&&this.m_ui_layer.showUI(!1),null==this.m_mission_game_over_result_layer&&(this.m_mission_game_over_result_layer=new BattleMissionResultLayer_V2,this.m_mission_game_over_result_layer.setGameScene(this),this.m_mission_game_over_result_layer.ignoreAnchorPointForPosition(!1),this.m_mission_game_over_result_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_mission_game_over_result_layer.setPosition(ccCenter(this)),this.addChild(this.m_mission_game_over_result_layer,100),this.m_mission_game_over_result_layer.resultDataLose_RaidDungeon(res))},goNewRaidBossBattleReady:function(res){NewRaidBossService.getInstance().SetCurrentBoss(res.user_new_raid_boss),this.gameObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.new_raid_boss_dungeon_battle_retry)},onNetworkEvent:function(opcode,state,body){this._super(opcode,state,body),cc.log("BattleSceneLayer::onNetworkEvent - opcode is "+opcode);new NetService;var res=body;if(4==state)try{switch(opcode){case net.OP.op_main_mission_battle_win_v2:if(this.m_main_mission_win_result_v2=body,this.m_field_layer.setBattleGameOver(),this.m_is_show_script?this.m_ui_layer.showScript(!0):this.showMainMissionGameOverResultV2(!0,this.m_main_mission_win_result_v2),this.m_is_show_script=!1,"y"==body.is_user_level_up)0!=MasterManager.getInstance().get_UserLevel(body.user_level).help_call_index&&GameDefault.getInstance().setUserLevelupShowHelpLevel(body.user_level);break;case net.OP.op_main_mission_battle_lose_v2:this.m_main_mission_lose_result_V2=body,(empty_win=$.extend({},net.Res_Main_Mission_Battle_Win_V2.prototype.packet)).mission_id=body.mission_id,this.showMainMissionGameOverResultV2(!1,empty_win);break;case net.OP.op_main_story_hard_mode_mission_battle_win:if(this.m_story_hard_mode_win_result=body,this.m_field_layer.setBattleGameOver(),this.m_is_show_script?this.m_ui_layer.showScript(!0):this.showMainStoryHardMOdeGameOverResult(!0,this.m_story_hard_mode_win_result),"y"==body.is_user_level_up)0!=MasterManager.getInstance().get_UserLevel(body.user_level).help_call_index&&GameDefault.getInstance().setUserLevelupShowHelpLevel(body.user_level);break;case net.OP.op_main_story_hard_mode_mission_battle_lose:(empty_win=$.extend({},net.Res_Main_Story_Hard_Mode_Mission_Battle_Win.prototype.packet)).main_story_hard_mode_mission_idx=body.main_story_hard_mode_mission_idx,this.showMainStoryHardMOdeGameOverResult(!1,empty_win);break;case net.OP.op_event_dungeon_battle_win:if(this.m_field_layer.setBattleGameOver(),this.m_is_show_script?this.m_ui_layer.showScript(!0):this.showEventDungeonGameOverResult(!0,body),"y"==body.is_user_level_up)0!=MasterManager.getInstance().get_UserLevel(body.user_level).help_call_index&&GameDefault.getInstance().setUserLevelupShowHelpLevel(body.user_level);break;case net.OP.op_event_dungeon_battle_lose:(empty_win=$.extend({},net.Res_Event_Dungeon_Battle_Win.prototype.packet)).event_dungeon_idx=body.event_dungeon_idx,empty_win.event_dungeon_period_idx=body.event_dungeon_period_idx,this.showEventDungeonGameOverResult(!1,empty_win);break;case net.OP.op_main_mission_battle_continue:case net.OP.op_main_story_hard_mode_mission_battle_continue:case net.OP.op_event_dungeon_battle_continue:this.m_field_layer.battleContinue(),this.m_ui_layer.showUI(!0),this.m_ui_layer.battleContinue(),this.hideGameOverResult();break;case net.OP.op_weekly_dungeon_battle_continue:this.m_ui_layer.showUI(!0),this.m_ui_layer.battleContinue(),this.m_field_layer.battleContinue(),this.hideGameOverResult();break;case net.OP.op_weekly_dungeon_battle_win:if(this.showWeeklyDungeonGameOverResult(!0,body),"y"==body.is_user_level_up)0!=MasterManager.getInstance().get_UserLevel(body.user_level).help_call_index&&GameDefault.getInstance().setUserLevelupShowHelpLevel(body.user_level);break;case net.OP.op_event_once_a_day_dungeon_battle_win:this.showEventOnceADayDungeonGameOverResult(!0,body);break;case net.OP.op_event_once_a_day_dungeon_battle_lose:(empty_win={}).event_dungeon_period_idx=body.event_dungeon_period_idx,empty_win.event_dungeon_once_a_day_idx=body.event_dungeon_once_a_day_idx,empty_win.troops_num=body.troops_num,this.showEventOnceADayDungeonGameOverResult(!1,empty_win);break;case net.OP.op_weekly_dungeon_battle_lose:(empty_win={}).weekly_idx=body.weekly_idx,empty_win.weekly_difficulty_id=body.weekly_difficulty_id,this.showWeeklyDungeonGameOverResult(!1,empty_win);break;case net.OP.op_great_wall_dungeon_battle_win:this.showGreatWallDungeonGameOverWinResult(body);break;case net.OP.op_great_wall_dungeon_battle_lose:this.showGreatWallDungeonGameOverLoseResult(body);break;case net.OP.op_world_war_move_battle_win:this.showWorldWarDungeonWinGameOverResult(body);break;case net.OP.op_world_war_move_battle_lose:this.showWorldWarDungeonLoseGameOverResult(body);break;case net.OP.op_world_war_move_battle_time_out:this.showWorldWarDungeonTimeoutGameOverResult(body);break;case net.OP.op_mussang_step_battle_win:this.showMussangeStepGameOverResult(!0,body);break;case net.OP.op_mussang_step_battle_lose:(empty_win={}).mussang_id=body.mussang_id,this.showMussangeStepGameOverResult(!1,empty_win);break;case net.OP.op_mussang_tower_battle_win:this.showMussangTowerGameOverResult(!0,body);break;case net.OP.op_mussang_tower_battle_lose:var empty_win;(empty_win={}).mussang_tower_idx=body.mussang_tower_idx,this.showMussangTowerGameOverResult(!1,empty_win);case net.OP.op_daily_dungeon_battle_result:if(this.showDailyDungeonGameOverResult(!0,body),"y"==res.is_user_level_up)0!=MasterManager.getInstance().get_UserLevel(res.user_level).help_call_index&&GameDefault.getInstance().setUserLevelupShowHelpLevel(res.user_level);break;case net.OP.op_cancel_battle_dungeon_continue:var context=BattleContext._getInstance();if(context.setBattleDungeonContinue(!1),NetService().get_battle_dungeon_continue().battle_dungeon_type=0,this.m_game_type==db.BattleGameType.Mission)context.clearFriendInfo();else if(this.m_game_type==db.BattleGameType.StoryHardMode)context.clearFriendInfo();else if(this.m_game_type==db.BattleGameType.WeeklyDungeon);else if(this.m_game_type==db.BattleGameType.Mussang);else if(this.m_game_type==db.BattleGameType.EventDungeon){var dungeon=context.getEventDungeonData();context.clearEventDungeon(),context.setEventDungeonPeriodIdX(dungeon.event_dungeon_period.event_dungeon_period_idx)}else this.m_game_type==db.BattleGameType.RaidDungeon?context.clearRaidBoss():this.m_game_type==db.BattleGameType.NewRaidBossDungeon?context.clearNewRaidBoss():this.m_game_type==db.BattleGameType.GreatWallDungeon?context.clearGreatWallDungeon():this.m_game_type==db.BattleGameType.DailyDungeon?context.clearDailyDungeon():this.m_game_type==db.BattleGameType.TowerDungeon?context.clearMussangTowerDungeon():this.m_game_type==db.BattleGameType.OnceADayDungeon?context.clearEventOnceADayDungeon():this.m_game_type==db.BattleGameType.EventMussangBossDungeon||(this.m_game_type,db.BattleGameType.EventRaidDungeon);this.m_isPushScene?SceneManager.getInstance().popScene():this.m_game_type==db.BattleGameType.TowerDungeon?this.back(!0):this.m_game_type==db.BattleGameType.EventMussangBossDungeon?this.back(!0):this.m_game_type==db.BattleGameType.EventRaidDungeon?this.back(!0):this.m_game_type==db.BattleGameType.NewRaidBossDungeon?this.back(!0):(this.m_game_type==db.BattleGameType.RaidDungeon&&BattleContext._getInstance().getRaidBossStartTabIndex()!=RAID_BOSS_TAB_CALL&&BattleContext._getInstance().setRaidBossStartTabIndex(RAID_BOSS_TAB_LIST),this.back(!0,!0));break;case net.OP.op_friend_request:this.m_mission_game_over_result_layer.friendBoxHide(),body.error_type==net.ERROR.NET_E_FRIEND_REQUEST_SUCCESS?this.m_mission_game_over_result_layer.winAfterProgress():body.error_type==net.ERROR.NET_E_FRIEND_REQUEST_ALREADY_FRIEND?USE_POPUP_INTERGRATION?this.showBattlePopup(res_str("label_notification"),res_str("label_already_friend_text")):this.showAlreadyFriend():body.error_type==net.ERROR.NET_E_FRIEND_REQUEST_ACCEPT_WAITING?USE_POPUP_INTERGRATION?this.showBattlePopup(res_str("label_notification"),res_str("label_wait_friend_accept")):this.showWaitFriendAccept():body.error_type==net.ERROR.NET_E_FRIEND_REQUEST_ALREADY_REQUEST?USE_POPUP_INTERGRATION?this.showBattlePopup(res_str("label_notification"),res_str("label_wait_friend_request")):this.showWaitFriendRequest():body.error_type==net.ERROR.NET_E_FRIEND_REQUEST_FRIEND_BOUND_OVER||body.error_type==net.ERROR.NET_E_FRIEND_REQUEST_FRIEND_ACCEPT_OVER?USE_POPUP_INTERGRATION?this.showBattlePopup(res_str("label_friend_request_failed_title"),res_str("label_friend_request_failed_text_4")):this.showFriendNotAccept():body.error_type==net.ERROR.NET_E_FRIEND_REQUEST_USER_REQUEST_OVER&&(USE_POPUP_INTERGRATION?this.showBattlePopup(res_str("label_friend_request_failed_title"),res_str("label_friend_request_failed_text_1"),res_str("label_friend_request_failed_text_2")):this.showIsMaxFrndRequest());break;case net.OP.op_raid_boss_shared:if(body.error==net.ERROR.NET_E_SHARED_FRIENDS_IS_NOBODY)this.m_raid_game_over_rersult_layer.reshowRaidBossSharedPopup(),(msg=[]).push(MasterManager.getInstance().get_LanguageData("label_raid_boss_shared_friends_is_nobody_error_msg")),this.showMsgBox(msg),msg=null;else(msg=[]).push(MasterManager.getInstance().get_LanguageData("label_raid_boss_shared_complete")),this.showMsgBox(msg),msg=null;break;case net.OP.op_new_raid_boss_dungeon_help:if(res.error!=net.ERROR.NET_E_SUCCESS){if(res.error==net.ERROR.NET_E_ALREADY_SHARED)(msg=[]).push(res_str("new_raidboss_support_call_done_error")),this.showMsgBox(msg);else if(res.error==net.ERROR.NET_E_SHARED_FRIENDS_IS_NOBODY){this.m_raid_game_over_rersult_layer.reShowNewRaidBossSharedPopup(),(msg=[]).push(res_str("new_raidboss_support_pop_up_friend_cannot_text_1")),msg.push(res_str("new_raidboss_support_pop_up_friend_cannot_text_2")),this.showMsgBox(msg)}else if(res.error==net.ERROR.NET_E_BAD_PARAMETER){var msg;(msg=[]).push("Bad Parameter [Need String Key]"),this.showMsgBox(msg)}}else(msg=[]).push(MasterManager.getInstance().get_LanguageData("label_raid_boss_shared_complete")),this.showMsgBox(msg),msg=null;break;case net.OP.op_raid_boss_battle_result:this.showRaidBossGameOverResult(body);break;case net.OP.op_new_raid_boss_dungeon_battle_result:var dmg_info=this.m_field_layer.getRightTeam().getNewRaidBossDamageInfo(),dmg_info_keys=dmg_info.keys(),boss=body.boss_data_list.findIndex(function(s){return 0!=s.boss_yn}),boss_damage=0;if(-1!=boss)for(var key_idx=0;key_idx<dmg_info_keys.length;key_idx++)body.boss_data_list[boss].boss_idx==dmg_info_keys[key_idx]&&(boss_damage=dmg_info.at(dmg_info_keys[key_idx]));this.showNewRaidBossGameOverResult(res,boss_damage);break;case net.OP.op_get_user_raid_boss_damage:BattleContext._getInstance().setUserRaidBossBeforeDamage(res.damage);var scene=new RaidBossBattleReadyScene;SceneManager.getInstance().replaceScene(scene);break;case net.OP.op_get_user_event_dungeon_craft_shop_material:case net.OP.op_get_user_event_dungeon_box_gacha_info:var mng=SceneManager.getInstance();mng.isExistScene(scene_MussangEntryScene)?mng.reservedHistoryClearToScene(scene_MussangEntryScene):mng.reservedHistoryClearToScene(scene_MainHomeScene);break;case net.OP.op_event_dungeon_mussang_boss_battle_win:this.showEventDungeonMussangBossGameOverWinResult(!0,body);break;case net.OP.op_event_dungeon_mussang_boss_battle_lose:this.showEventDungeonMussangBossGameOverLoseResult(!1,body);break;case net.OP.op_event_raid_dungeon_battle_win:this.showEventRaidWinGameOverResult(body);break;case net.OP.op_event_raid_dungeon_battle_lose:break;case net.OP.op_new_raid_boss_call:res.error!=net.ERROR.NET_E_SUCCESS?res.error==net.ERROR.NET_E_NOT_FOUND_USER_ID||res.error==net.ERROR.NET_E_ALREADY_EXIST_DATA||res.error==net.ERROR.NET_E_LACK_KEY||(res.error,net.ERROR.NET_E_ALREADY_BATTLE_START_GNRL):this.goNewRaidBossBattleReady(res);break;case net.OP.op_result:}}catch(e){console.log(e)}else cc.log("Json file load error opcode: "+opcode+" state: "+state)},showBattlePopup:function(){for(var val=arguments,msg=[],i=1;i<val.length;i++)msg.push(val[i]);if(this.m_box.setTitle(val[0]),0<msg.length)for(i=0;i<msg.length;i++)i==msg.length-1?this.m_box.setText(msg[i]):(this.m_box.setText(msg[i]),this.m_box.setText("\n"));this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(),this.m_mission_game_over_result_layer.winAfterProgress()}.bind(this))),this.m_box.show()},showIsMaxFrndRequest:function(){this.m_box.setTitle(res_str("label_friend_request_failed_title")),this.m_box.setText(res_str("label_friend_request_failed_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_friend_request_failed_text_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(),this.m_mission_game_over_result_layer.winAfterProgress()}.bind(this))),this.m_box.show()},showAlreadyFriend:function(){this.m_box.setTitle(res_str("label_notification")),this.m_box.setText(res_str("label_already_friend_text")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(),this.m_mission_game_over_result_layer.winAfterProgress()}.bind(this))),this.m_box.show()},showWaitFriendAccept:function(){this.m_box.setTitle(res_str("label_notification")),this.m_box.setText(res_str("label_wait_friend_accept")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(),this.m_mission_game_over_result_layer.winAfterProgress()}.bind(this))),this.m_box.show()},showWaitFriendRequest:function(){this.m_box.setTitle(res_str("label_notification")),this.m_box.setText(res_str("label_wait_friend_request")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(),this.m_mission_game_over_result_layer.winAfterProgress()}.bind(this))),this.m_box.show()},showFriendNotAccept:function(){this.m_box.setTitle(res_str("label_friend_request_failed_title")),this.m_box.setText(res_str("label_friend_request_failed_text_4")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(),this.m_mission_game_over_result_layer.winAfterProgress()}.bind(this))),this.m_box.show()},showBattlePopup_hide:function(){this.m_box.is_show()&&this.m_box.hide();for(var val=arguments,msg=[],i=1;i<val.length;i++)msg.push(val[i]);this.showMsgBox(val[0],msg),msg=null},showAutoPlayGeneralLimitPopup:function(){this.m_box.setTitle(res_str("label_auto_play_invalid_title")),this.m_box.setText(res_str("label_auto_play_end_limit_general_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_auto_play_end_limit_general_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.is_show()||this.m_box.show()},showAutoPlayHeartLimitPopup:function(){this.m_box.setTitle(res_str("label_auto_play_invalid_title")),this.m_box.setText(res_str("label_auto_play_end_limit_heart_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_auto_play_end_limit_heart_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.is_show()||this.m_box.show()},showAutoPlayBattleLosePopup:function(){this.m_box.setTitle(res_str("label_auto_play_invalid_title")),this.m_box.setText(res_str("label_auto_play_end_battle_lose_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_auto_play_end_battle_lose_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.is_show()||this.m_box.show()}}),BattleMissionTaskManager=cc.Class.extend({m_mission_id:0,m_main_mission:null,m_death_general_list:[],m_troops_general_list:[],m_active_skill_use_count:0,m_mission_clear_count:0,m_battle_clear_time:0,m_chain_combo_count:0,m_start_battle_gnrl_count:0,m_with_friend_buf:!1,m_with_friend_call:!1,m_force_type_list:[],ctor:function(){},onExit:function(){this.removeAllChildrenWithCleanup(!0)},setMissionID:function(mission_id){this.cleanMissionTask(),this.m_mission_id=mission_id,this.m_main_mission=$.extend({},database.BattleMainMission);var service=BattleService.getInstance();service.getMainMissionAndNpc(this.m_mission_id,this.m_main_mission),this.m_mission_clear_count=service.getMissionWinCount(this.m_mission_id)},cleanMissionTask:function(){this.m_death_general_list.length=0,this.m_troops_general_list.length=0,this.m_active_skill_use_count=0,this.m_with_friend_call=!1,this.m_with_friend_buf=!1,this.m_mission_clear_count=0,this.m_battle_clear_time=0,this.m_chain_combo_count=0,this.m_start_battle_gnrl_count=0,this.m_force_type_list.length=0,this.m_mission_id=0,this.m_main_mission=$.extend({},database.BattleMainMission)},removeDeathGeneral:function(_gnrl_group_id){if(0!=this.m_mission_id){var found=this.m_death_general_list.findIndex(function(gnrl_group_id){return gnrl_group_id==_gnrl_group_id});this.m_death_general_list.splice(found,1)}},addDeathGeneral:function(gnrl_group_id){0!=this.m_mission_id&&(-1==this.m_death_general_list.indexOf(gnrl_group_id)&&this.m_death_general_list.push(gnrl_group_id))},addTroopsGeneral:function(gnrl_group_id){0!=this.m_mission_id&&(-1==this.m_troops_general_list.indexOf(gnrl_group_id)&&this.m_troops_general_list.push(gnrl_group_id))},addArmServiceType:function(arm_type){0!=this.m_mission_id&&(-1==this.m_force_type_list.indexOf(arm_type)&&this.m_force_type_list.push(arm_type))},addActiveSkillUseCount:function(){0!=this.m_mission_id&&(this.m_active_skill_use_count+=1)},addMIssionClearCount:function(){0!=this.m_mission_id&&(this.m_mission_clear_count+=1)},setFriendCall:function(){0!=this.m_mission_id&&(this.m_with_friend_call=!0)},clearFriendCall:function(){0!=this.m_mission_id&&(this.m_with_friend_call=!1)},setFriendBuf:function(){0!=this.m_mission_id&&(this.m_with_friend_buf=!0)},setClearTime:function(clear_time){0!=this.m_mission_id&&(this.m_battle_clear_time=clear_time)},setStartBattleGeneralCount:function(gnrl_count){0!=gnrl_count&&(this.m_start_battle_gnrl_count=gnrl_count)},clearTaskCheckMainMission:function(){for(var ids=[],i=0;i<this.m_main_mission.task_list.length;i++){var task=this.m_main_mission.task_list[i];if(!task.is_cleared)switch(task.task_type.task_type){case database.TaskActionType.Enable_Death_Generals:this.m_death_general_list.length<=task.task.gnrl_dead_count&&ids.push(task.task.task_id);break;case database.TaskActionType.Clear_Time:this.m_battle_clear_time<=task.task.battle_second&&ids.push(task.task.task_id);break;case database.TaskActionType.Skill_Use_Count:this.m_active_skill_use_count>=task.task.skill_use_count&&ids.push(task.task.task_id);break;case database.TaskActionType.Start_Members_Count:this.m_start_battle_gnrl_count==task.task.troops_gnrl_count&&ids.push(task.task.task_id);break;case database.TaskActionType.With_Friend_Buf:(this.m_with_friend_buf||this.m_with_friend_call)&&ids.push(task.task.task_id);break;case database.TaskActionType.With_Friend_Call:this.m_with_friend_buf&&this.m_with_friend_call&&ids.push(task.task.task_id);break;case database.TaskActionType.Force_Type:for(var isEquals=!0,j=0;j<this.m_force_type_list.length;j++){if(this.m_force_type_list[j]!=task.task.fight_type_count){isEquals=!1;break}}isEquals&&ids.push(task.task.task_id);break;case database.TaskActionType.Chain_Combo_Count:this.m_chain_combo_count>=task.task.combo_count&&ids.push(task.task.task_id);break;case database.TaskActionType.Mission_Clear_Count:this.m_mission_clear_count>=task.task.accum_win_count&&ids.push(task.task.task_id);break;case database.TaskActionType.Nouse_Active_Skill:0==this.m_active_skill_use_count&&ids.push(task.task.task_id);break;case database.TaskActionType.Include_General_Group:var isExist=!1;for(j=0;j<this.m_troops_general_list.length;j++){if(this.m_troops_general_list[j]==task.task.gnrl_group){isExist=!0;break}}var isAlive=!1;if(isExist){isAlive=!0;for(var k=0;k<this.m_death_general_list.length;k++){if(this.m_death_general_list[k]==task.task.gnrl_group){isAlive=!1;break}}}isExist&&isAlive&&ids.push(task.task.task_id)}}return ids},clearTaskCheck:function(){if(0!=this.m_mission_id)return this.clearTaskCheckMainMission()}});BattleMissionTaskManager._getInstance=function(){return this._instance||(this._instance=this._instance||new BattleMissionTaskManager),this._instance};var BattleStoryHardModeMissionTaskManager=cc.Class.extend({m_main_story_hard_mode_mission_idx:0,m_mission:null,m_death_general_list:[],m_troops_general_list:[],m_active_skill_use_count:0,m_mission_clear_count:0,m_battle_clear_time:0,m_start_battle_gnrl_count:0,m_with_friend_buf:!1,m_with_friend_call:!1,m_force_type_list:[],ctor:function(){cc.log("BattleStoryHardModeMissionTaskManager Ctor")},onExit:function(){this.removeAllChildrenWithCleanup(!0)},setMainStoryHardModeMissionId:function(main_story_hard_mode_mission_idx){this.m_mission=$.extend({},database.BattleStoryHardModeMission),this.clearMissionTask(),this.m_main_story_hard_mode_mission_idx=main_story_hard_mode_mission_idx,BattleService.getInstance().getStoryHardModeMissionAndNpc(this.m_main_story_hard_mode_mission_idx,this.m_mission),this.m_mission_clear_count=this.m_mission.victory_count},clearMissionTask:function(){this.m_death_general_list=[],this.m_troops_general_list=[],this.m_active_skill_use_count=0,this.m_with_friend_call=!1,this.m_with_friend_buf=!1,this.m_mission_clear_count=0,this.m_battle_clear_time=0,this.m_start_battle_gnrl_count=0,this.m_force_type_list=[],this.m_main_story_hard_mode_mission_idx=0,this.m_mission.main_story_hard_mode_mission_idx=0,this.m_mission.mission.main_story_hard_mode_mission_idx=0,this.m_mission.stage_npc=[],this.m_mission.task_list=[],this.m_mission=$.extend({},database.BattleStoryHardModeMission)},removeDeathGeneral:function(gnrl_group_id){0!=this.m_main_story_hard_mode_mission_idx&&(-1==this.m_death_general_list.indexOf(gnrl_group_id)&&this.m_death_general_list.push(gnrl_group_id))},addDeathGeneral:function(gnrl_group_id){0!=this.m_main_story_hard_mode_mission_idx&&(-1==this.m_death_general_list.indexOf(gnrl_group_id)&&this.m_death_general_list.push(gnrl_group_id))},addTroopsGeneral:function(gnrl_group_id){0!=this.m_main_story_hard_mode_mission_idx&&(-1==this.m_troops_general_list.indexOf(gnrl_group_id)&&this.m_troops_general_list.push(gnrl_group_id))},addActiveSkillUseCount:function(){0!=this.m_main_story_hard_mode_mission_idx&&(this.m_active_skill_use_count+=1)},addMIssionClearCount:function(){0!=this.m_main_story_hard_mode_mission_idx&&(this.m_mission_clear_count+=1)},addArmServiceType:function(arm_type){0!=this.m_main_story_hard_mode_mission_idx&&(-1==this.m_force_type_list.indexOf(arm_type)&&this.m_force_type_list.push(arm_type))},setFriendCall:function(){0!=this.m_main_story_hard_mode_mission_idx&&(this.m_with_friend_call=!0)},clearFriendCall:function(){0!=this.m_main_story_hard_mode_mission_idx&&(this.m_with_friend_call=!1)},setFriendBuf:function(){0!=this.m_main_story_hard_mode_mission_idx&&(this.m_with_friend_buf=!0)},setStartBattleGeneralCount:function(gnrl_count){0!=gnrl_count&&(this.m_start_battle_gnrl_count=gnrl_count)},setClearTime:function(clear_time){0!=this.m_main_story_hard_mode_mission_idx&&(this.m_battle_clear_time=clear_time)},clearTaskCheckStoryHardModeMission:function(){for(var task_ids=[],i=0;i<this.m_mission.task_list.length;i++){var task=this.m_mission.task_list[i];if(!task.is_cleared)switch(task.task_type.task_type){case database.TaskActionType.Enable_Death_Generals:this.m_death_general_list.length<=task.task.gnrl_dead_count&&task_ids.push_back(task.task.task_id);break;case database.TaskActionType.Clear_Time:this.m_battle_clear_time<=task.task.battle_second&&task_ids.push_back(task.task.task_id);break;case database.TaskActionType.Skill_Use_Count:this.m_active_skill_use_count>=task.task.skill_use_count&&task_ids.push_back(task.task.task_id);break;case database.TaskActionType.Start_Members_Count:this.m_start_battle_gnrl_count==task.task.troops_gnrl_count&&task_ids.push_back(task.task.task_id);break;case database.TaskActionType.With_Friend_Buf:case database.TaskActionType.With_Friend_Call:(this.m_with_friend_buf||this.m_with_friend_call)&&task_ids.push_back(task.task.task_id);break;case database.TaskActionType.Force_Type:for(var is_equals=!0,j=0;j<this.m_force_type_list.length;j++){if(this.m_force_type_list[j]!=task.task.fight_type_count){is_equals=!1;break}}is_equals&&task_ids.push_back(task.task.task_id);break;case database.TaskActionType.Mission_Clear_Count:this.m_mission_clear_count>=task.task.accum_win_count&&task_ids.push_back(task.task.task_id);break;case database.TaskActionType.Nouse_Active_Skill:0==this.m_active_skill_use_count&&task_ids.push_back(task.task.task_id);break;case database.TaskActionType.Include_General_Group:var is_exist=!1;-1==this.m_troops_general_list.indexOf(task.task.gnrl_group)&&(is_exist=!0);var is_alive=!1;if(is_exist)-1==this.m_death_general_list.indexOf(task.task.gnrl_group)&&(is_alive=!0);is_exist&&is_alive&&task_ids.push_back(task.task.task_id)}}return task_ids},clearTaskCheck:function(){if(0!=this.m_main_story_hard_mode_mission_idx)return this.clearTaskCheckStoryHardModeMission()}});BattleStoryHardModeMissionTaskManager._getInstance=function(){return this._instance||(this._instance=this._instance||new BattleStoryHardModeMissionTaskManager),this._instance};var BattleEventDungeonTaskManager=cc.Class.extend({m_event_dungeon:null,m_death_general_list:[],m_battle_clear_time:0,m_with_friend_buf:!1,ctor:function(){this.m_event_dungeon=new database.BattleEventDungeon,this.m_battle_clear_time=0,this.m_with_friend_buf=!1},onExit:function(){this.removeAllChildrenWithCleanup(!0)},setEventDungeonData:function(data){this.clearEventDungeonTask(),this.m_event_dungeon=$.extend({},data)},clearEventDungeonTask:function(){this.m_death_general_list=[],this.m_with_friend_buf=!1,this.m_battle_clear_time=0},addDeathGeneral:function(gnrl_group){0!=this.m_event_dungeon.event_dungeon_idx&&(-1==this.m_death_general_list.indexOf(gnrl_group)&&this.m_death_general_list.push(gnrl_group))},removeDeathGeneral:function(gnrl_group){if(0!=this.m_event_dungeon.event_dungeon_idx){var found=this.m_death_general_list.findIndex(function(gnrl_group_id){return gnrl_group_id==gnrl_group});this.m_death_general_list.splice(found,1)}},setClearTime:function(clear_time){0!=this.m_event_dungeon.event_dungeon_idx&&(this.m_battle_clear_time=clear_time)},setFriendBuff:function(){0!=this.m_event_dungeon.event_dungeon_idx&&(this.m_with_friend_buf=!0)},completeTaskCheck:function(){if(0!=this.m_event_dungeon.event_dungeon_idx)return this.completeTaskCheckEventDungeon()},completeTaskCheckEventDungeon:function(){for(var task_ids=[],idx=0;idx<this.m_event_dungeon.task_list.length;idx++){if(!this.m_event_dungeon.task_list[idx].is_complete)switch(this.m_event_dungeon.task_list[idx].task_define.task_type){case database.TaskActionType.Enable_Death_Generals:this.m_death_general_list.length<=this.m_event_dungeon.task_list[idx].task_define.value1&&task_ids.push_back(this.m_event_dungeon.task_list[idx].num);break;case database.TaskActionType.Clear_Time:this.m_battle_clear_time<=this.m_event_dungeon.task_list[idx].task_define.value1&&task_ids.push_back(this.m_event_dungeon.task_list[idx].num);break;case database.TaskActionType.With_Friend_Buf:this.m_with_friend_buf&&task_ids.push_back(this.m_event_dungeon.task_list[idx].num);break;case database.TaskActionType.Mission_Clear_Count:task_ids.push_back(this.m_event_dungeon.task_list[idx].num);break;case database.TaskActionType.No_With_Friend_Buff:this.m_with_friend_buf||task_ids.push_back(this.m_event_dungeon.task_list[idx].num)}}return task_ids}});BattleEventDungeonTaskManager.getInstance=function(){return this._instance||(this._instance=this._instance||new BattleEventDungeonTaskManager),this._instance};var BattleWeeklyDungeonTaskManager=cc.Class.extend({m_dungeon:null,m_death_general_list:[],m_battle_clear_time:0,m_with_friend_buf:!1,m_active_skill_use_count:0,ctor:function(){this.m_dungeon=new database.BattleWeeklyDungeonDifficulty,this.m_death_general_list=[],this.m_battle_clear_time=0,this.m_with_friend_buf=!1,this.m_active_skill_use_count=0},onExit:function(){this.removeAllChildrenWithCleanup(!0)},setWeeklyDungeonData:function(data){this.clearWeeklyDungeonTask(),this.m_dungeon=$.extend({},data)},clearWeeklyDungeonTask:function(){this.m_death_general_list=[],this.m_with_friend_buf=!1,this.m_active_skill_use_count=0,this.m_battle_clear_time=0},addActiveSkillUseCount:function(){0!=this.m_dungeon.weekly_idx&&(this.m_active_skill_use_count+=1)},addDeathGeneral:function(gnrl_group){0!=this.m_dungeon.weekly_idx&&(-1==this.m_death_general_list.indexOf(gnrl_group)&&this.m_death_general_list.push(gnrl_group))},removeDeathGeneral:function(gnrl_group){if(0!=this.m_dungeon.weekly_idx){var found=this.m_death_general_list.findIndex(function(gnrl_group_id){return gnrl_group_id==gnrl_group});this.m_death_general_list.splice(found,1)}},setClearTime:function(clear_time){0!=this.m_dungeon.weekly_idx&&(this.m_battle_clear_time=clear_time)},setFriendBuff:function(){0!=this.m_dungeon.weekly_idx&&(this.m_with_friend_buf=!0)},completeTaskCheck:function(){if(0!=this.m_dungeon.weekly_idx)return this.completeTaskCheckWeeklyDungeon()},completeTaskCheckWeeklyDungeon:function(){for(var task_ids=[],idx=0;idx<this.m_dungeon.task_list.length;idx++){if(!this.m_dungeon.task_list[idx].is_complete)switch(this.m_dungeon.task_list[idx].task_define.task_type){case database.TaskActionType.Enable_Death_Generals:this.m_death_general_list.size()<=this.m_dungeon.task_list[idx].task_define.value1&&task_ids.push_back(this.m_dungeon.task_list[idx].num);break;case database.TaskActionType.Clear_Time:this.m_battle_clear_time<=this.m_dungeon.task_list[idx].task_define.value1&&task_ids.push_back(this.m_dungeon.task_list[idx].num);break;case database.TaskActionType.Mission_Clear_Count:task_ids.push_back(this.m_dungeon.task_list[idx].num);break;case database.TaskActionType.Skill_Use_Count_Fixed:this.m_active_skill_use_count==this.m_dungeon.task_list[idx].task_define.value1&&task_ids.push_back(this.m_dungeon.task_list[idx].num);break;case database.TaskActionType.No_With_Friend_Buff:}}return task_ids}});BattleWeeklyDungeonTaskManager.getInstance=function(){return this._instance||(this._instance=this._instance||new BattleWeeklyDungeonTaskManager),this._instance};var BattleLoadingLayer=cc.Layer.extend({m_bar:null,m_label:null,total_resource_count:0,current_loaded_count:0,ctor:function(){return this._super(),winSize=cc.director.getWinSize(),this.initLayout(),!0},onExit:function(){BATTLE_TO_SHOP||(this._super(),this.removeAllChildrenWithCleanup(!0))},hide:function(){AudioEngine.getInstance().stopBackgroundMusic()},initLayout:function(){var loadingLayer=new LoadingLayerV2(7);loadingLayer.setPosition(cc.p(winSize.width/2,winSize.height/2)),this.addChild(loadingLayer);var bar_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero());bar_bg.setAnchorPoint(.5,0),bar_bg.setPosition(winSize.width/2,80),bar_bg.setContentSize(480,16),this.addChild(bar_bg),this.m_bar=cc.Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green.png"),this.m_bar.setAnchorPoint(0,.5),this.m_bar.setPosition(3,bar_bg.getContentSize().height/2),bar_bg.addChild(this.m_bar),this.m_label=cmLabel.getLabel("0%",LABEL_FONT_INDEX.FONT_143),this.m_label.enableOutline(cc.color(0,0,0),1),this.m_label.anchorX=.5,this.m_label.anchorY=.5,this.m_label.setPosition(cc.p(bar_bg.getContentSize().width/2,bar_bg.getContentSize().height/2)),bar_bg.addChild(this.m_label);var loading=new cc.Sprite(res.s_cm_img_text_loading);loading.setAnchorPoint(.5,0),loading.setPosition(winSize.width/2,106),this.addChild(loading)},updateProgressBar:function(){if(null!=this.m_bar){var per=this.current_loaded_count/this.total_resource_count,_per=474*per;this.m_bar.setScaleX(_per);var perNum=parseInt(100*per);this.m_label.setString(perNum+"%"),this.current_loaded_count>=this.total_resource_count&&(this.m_bar.setScaleX(474),this.m_label.setString("100%"))}},setTotalLoadingResourceCount:function(count){this.total_resource_count=count,this.current_loaded_count=0,this.updateProgressBar()},addTotalLoadingResourceCount:function(count){this.total_resource_count+=count,this.updateProgressBar()},addCompleteResourceLoaded:function(count){this.current_loaded_count+=count,this.current_loaded_count>this.total_resource_count&&(this.current_loaded_count=this.total_resource_count),this.updateProgressBar()}}),BattleUIMng=cc.Layer.extend({winSize:null,m_base_layer:null,m_script_node:null,m_script_node_v2:null,m_event_dungeon_script_node:null,m_event_dungeon_script_node_v2:null,m_2x_circle:null,m_2x_normal:null,m_2x_new_btn:null,m_2x_new_off_btn:null,m_is_2x_time_scale:!1,m_game_speed_btns:null,m_autobtn_click_count:0,m_autobtn_click:!1,m_speed_btn1:null,m_speed_btn2:null,m_speed_btn3:null,m_auto_circle:null,m_auto_normal:null,m_auto_new_btn:null,m_auto_new_off_btn:null,m_is_auto_skill:!1,m_auto_play_circle:null,m_auto_play_normal:null,m_auto_play_btn:null,m_auto_play_count_off:null,m_auto_play_count_on:null,m_treasuer_gain_count:null,m_stage_gauge_node:null,is_run_stage:!1,run_stage_delta_time:0,m_battle_scene:null,m_stage_title:null,m_hard_stage_title:null,m_hard_stage_mission:null,m_hard_story_num:null,m_weekly_dungeon:null,m_mussang:null,m_event_dungeon:null,m_daily_dungeon:null,m_raid_boss_dungeon:null,m_great_wall_dungeon:null,m_once_a_day_dungeon:null,m_event_mussangboss_dungeon:null,m_world_war_npc_dungeon:null,m_story_hard_mode_dungeon:null,m_new_raid_boss_dungeon:null,m_gain_item_count:0,m_skill_slots:null,m_is_end_script:!1,m_is_reserved_friend:!1,m_friend_skill_slot:null,m_friend_slot:null,is_pause_ui:!1,m_game_type:null,left_used_skill_message:null,right_used_skill_message:null,recycled_skill_message:null,m_skill_cut_layer_v2:null,m_skill_cut_modal:null,m_is_skill_pause:!1,m_timer:null,m_boss_life_gauge:null,m_raid_boss_life_gauge:null,m_new_raid_boss_life_gauge:null,m_new_raid_boss_life_gauge_list:null,battleObserver:null,m_Mussang_Boss_Life_Gauge:null,stage_mission:null,story_num_mission:null,stage_weekly:null,difficulty_weekly:null,stage_event:null,difficulty_event:null,stage_daily:null,difficulty_daily:null,stage_mussang:null,relation_prologue:null,pause_btn_off:null,pause_btn:null,m_skill_cutin_normal:null,m_skill_cutin_btn:null,m_skill_cutin_btn_off:null,m_cutin_timer:null,m_cutin_accum_damage:null,m_cutin_info_container:null,m_cutin_boss_name:null,m_treasure_box:null,m_counter_label:null,m_gnrl_img:null,m_fast_extra_time_speed_normal:null,m_fast_extra_time_speed_btn:null,m_game_speed_type:1,m_event_raid_accum_damage:null,ctor:function(scene){return this._super(),this.winSize=cc.director.getWinSize(),this.battleObserver=MainObserver.getInstance(),this.m_battle_scene=scene,this.m_skill_slots=new Array,this.right_used_skill_message=new Array,this.m_game_speed_btns=[],this.m_new_raid_boss_life_gauge_list=new Map,this.init(),!0},onExit:function(){if(!BATTLE_TO_SHOP&&(this._super(),1==BATTLE_SCENE_MEMORY_CLEAR)){if(null!=this.m_gnrl_img){for(var idx=0;idx<this.m_gnrl_img.length;idx++)DEF_GENERAL_CACHE.push(this.m_gnrl_img[i]);this.m_gnrl_img=null}this.removeAllChildren(),this.removeAllChildrenWithCleanup(!0),this.stage_mission=null,this.story_num_mission=null,this.stage_weekly=null,this.difficulty_weekly=null,this.stage_event=null,this.difficulty_event=null,this.stage_daily=null,this.difficulty_daily=null,this.stage_mussang=null,this.relation_prologue=null,this.pause_btn_off=null,this.pause_btn=null,this.m_timer=null,this.m_base_layer=null,this.m_script_node=null,this.m_event_dungeon_script_node=null,this.m_2x_circle=null,this.m_2x_normal=null,this.m_2x_new_btn=null,this.m_speed_btn1=null,this.m_speed_btn2=null,this.m_speed_btn3=null,this.m_2x_new_off_btn=null,this.m_auto_circle._skeleton.data=null,this.m_auto_circle=null,this.m_auto_normal=null,this.m_auto_new_btn=null,this.m_auto_new_off_btn=null,this.m_auto_play_circle=null,this.m_auto_play_normal=null,this.m_auto_play_btn=null,this.m_auto_play_count_off=null,this.m_auto_play_count_on=null,this.m_treasuer_gain_count=null,this.m_stage_gauge_node=null,this.m_battle_scene=null,this.m_stage_title=null,this.m_hard_stage_title=null,this.m_hard_stage_mission=null,this.m_hard_story_num=null,this.m_weekly_dungeon=null,this.m_mussang=null,this.m_event_dungeon=null,this.m_daily_dungeon=null,this.m_raid_boss_dungeon=null,this.m_great_wall_dungeon=null,this.m_once_a_day_dungeon=null,this.m_event_mussangboss_dungeon=null,this.m_world_war_npc_dungeon=null,this.m_story_hard_mode_dungeon=null,this.m_new_raid_boss_dungeon=null,this.m_skill_slots=null,this.m_friend_skill_slot=null,this.m_friend_slot=null,this.m_game_type=null,this.left_used_skill_message=null,this.right_used_skill_message=null,this.recycled_skill_message=null,this.m_skill_cut_layer_v2=null,this.m_skill_cut_modal=null,this.m_boss_life_gauge=null,this.m_raid_boss_life_gauge=null,this.m_new_raid_boss_life_gauge=null,this.m_new_raid_boss_life_gauge_list=null,this.m_Mussang_Boss_Life_Gauge=null,this.battleObserver=null,this.m_skill_cutin_normal=null,this.m_skill_cutin_btn=null,this.m_skill_cutin_btn_off=null,this.m_cutin_timer=null,this.m_cutin_accum_damage=null,this.m_cutin_info_container=null,this.m_cutin_boss_name=null,this.m_treasure_box=null,this.m_counter_label=null,this.m_game_speed_btns=null,this.m_fast_extra_time_speed_normal=null,this.m_fast_extra_time_speed_btn=null,this.m_event_raid_accum_damage=null,delete this.m_gnrl_img,delete this.stage_mission,delete this.story_num_mission,delete this.stage_weekly,delete this.difficulty_weekly,delete this.stage_event,delete this.difficulty_event,delete this.stage_daily,delete this.difficulty_daily,delete this.stage_mussang,delete this.relation_prologue,delete this.pause_btn_off,delete this.pause_btn,delete this.m_timer,delete this.m_base_layer,delete this.m_script_node,delete this.m_event_dungeon_script_node,delete this.m_2x_circle,delete this.m_2x_normal,delete this.m_2x_new_btn,delete this.m_speed_btn1,delete this.m_speed_btn2,delete this.m_speed_btn3,delete this.m_2x_new_off_btn,delete this.m_auto_circle,delete this.m_auto_normal,delete this.m_auto_new_btn,delete this.m_auto_new_off_btn,delete this.m_auto_play_circle,delete this.m_auto_play_normal,delete this.m_auto_play_btn,delete this.m_auto_play_count_off,delete this.m_auto_play_count_on,delete this.m_treasuer_gain_count,delete this.m_stage_gauge_node,delete this.m_battle_scene,delete this.m_stage_title,delete this.m_hard_stage_title,delete this.m_hard_stage_mission,delete this.m_hard_story_num,delete this.m_weekly_dungeon,delete this.m_mussang,delete this.m_event_dungeon,delete this.m_daily_dungeon,delete this.m_raid_boss_dungeon,delete this.m_great_wall_dungeon,delete this.m_once_a_day_dungeon,delete this.m_event_mussangboss_dungeon,delete this.m_world_war_npc_dungeon,delete this.m_story_hard_mode_dungeon,delete this.m_new_raid_boss_dungeon,delete this.m_skill_slots,delete this.m_friend_skill_slot,delete this.m_friend_slot,delete this.m_game_type,delete this.left_used_skill_message,delete this.right_used_skill_message,delete this.recycled_skill_message,delete this.m_skill_cut_layer_v2,delete this.m_skill_cut_modal,delete this.m_boss_life_gauge,delete this.m_raid_boss_life_gauge,delete this.m_new_raid_boss_life_gauge,delete this.m_new_raid_boss_life_gauge_list,delete this.m_Mussang_Boss_Life_Gauge,delete this.battleObserver,delete this.m_skill_cutin_normal,delete this.m_skill_cutin_btn,delete this.m_skill_cutin_btn_off,delete this.m_cutin_timer,delete this.m_cutin_accum_damage,delete this.m_cutin_info_container,delete this.m_cutin_boss_name,delete this.m_treasure_box,delete this.m_counter_label,delete this.m_game_speed_btns,delete this.m_fast_extra_time_speed_normal,delete this.m_fast_extra_time_speed_btn,delete this.winSize,delete this.m_game_speed_type,delete this.m_is_2x_time_scale,delete this.m_autobtn_click_count,delete this.m_autobtn_click,delete this.m_is_auto_skill,delete this.is_run_stage,delete this.run_stage_delta_time,delete this.m_gain_item_count,delete this.m_is_end_script,delete this.m_is_reserved_friend,delete this.is_pause_ui,delete this.m_is_skill_pause,delete this.m_event_raid_accum_damage}},init:function(){this.recycled_skill_message=new Array,this.left_used_skill_message=new Array,this.initLayout()},autobtnClick:function(dt){this.m_auto_new_btn.setVisible(!1),this.m_auto_new_off_btn.setVisible(!0),this.m_auto_new_off_btn.setTouchEnabled(!0)},autoOffbtnClick:function(dt){this.m_auto_new_btn.setVisible(!0),this.m_auto_new_off_btn.setVisible(!1),this.m_auto_new_btn.setTouchEnabled(!0)},skillCutinbtnClick:function(dt){this.m_skill_cutin_btn.setVisible(!1),this.m_skill_cutin_btn_off.setVisible(!0),this.m_skill_cutin_btn_off.setTouchEnabled(!0)},skillCutinOffbtnClick:function(dt){this.m_skill_cutin_btn.setVisible(!0),this.m_auto_new_off_btn.setVisible(!1),this.m_skill_cutin_btn.setTouchEnabled(!0)},m2xbtnClick:function(dt){this.m_2x_new_btn.setVisible(!1),this.m_2x_new_off_btn.setVisible(!0),this.m_2x_new_off_btn.setTouchEnabled(!0)},m2xOffbtnClick:function(dt){this.m_2x_new_btn.setVisible(!0),this.m_2x_new_off_btn.setVisible(!1),this.m_2x_new_btn.setTouchEnabled(!0)},initLayout:function(){var service=BattleService.getInstance(),context=BattleContext._getInstance();if(this.m_game_type=context.getGameType(),this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(.5,.5),this.setPosition(this.winSize.width/2,this.winSize.height/2),this.m_autobtn_click=!1,this.m_base_layer=new cc.Layer,this.m_base_layer.setVisible(!1),this.addChild(this.m_base_layer),this.m_game_type==db.BattleGameType.Mission){var m_main_mission_service=$.extend({},database.BattleMainMission),mission_id=context.getMissionID();service.getMainMissionAndNpc(mission_id,m_main_mission_service);var title_num=m_main_mission_service.mission.main_story_id,act_title_num=m_main_mission_service.mission.main_mission_num,title=title_num+"M";this.m_stage_title=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/mission_stage_numb.fnt",title,cc.TEXT_ALIGNMENT_LEFT),this.m_stage_title.anchorX=0,this.m_stage_title.anchorY=1,this.m_stage_title.setPosition(13,this.winSize.height-5),this.m_base_layer.addChild(this.m_stage_title);var img_act_title="#img_act_title_"+title_num+".png";this.stage_mission=new cc.Sprite(img_act_title),this.stage_mission.anchorX=0,this.stage_mission.anchorY=1,this.stage_mission.setPosition(13+this.m_stage_title.getContentSize().width+10,this.winSize.height-5),this.m_base_layer.addChild(this.stage_mission);var num=act_title_num+" J";this.story_num_mission=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/mission_stage_numb.fnt",num,cc.TEXT_ALIGNMENT_LEFT),this.story_num_mission.anchorX=0,this.story_num_mission.anchorY=1,this.story_num_mission.setPosition(13+this.m_stage_title.getContentSize().width+10+this.stage_mission.getContentSize().width+10,this.winSize.height-5),this.m_base_layer.addChild(this.story_num_mission),this.createTreasureBox(),this.createStageGauge(),this.createTimerLabel()}else if(this.m_game_type==db.BattleGameType.StoryHardMode){this.m_story_hard_mode_dungeon=$.extend({},database.BattleStoryHardModeMission);var main_story_hard_mode_mission_idx=context.getStoryHardModeMissionId();service.getStoryHardModeMissionAndNpc(main_story_hard_mode_mission_idx,this.m_story_hard_mode_dungeon);var story=MasterManager.getInstance().get_MainStoryHardMode(1,this.m_story_hard_mode_dungeon.mission.difficult,this.m_story_hard_mode_dungeon.mission.main_story_id),page=cmString(res_str("label_story_page_title"),story.main_story_id),stage=cmString(res_str("label_story_stage"),this.m_story_hard_mode_dungeon.mission.mission_num);this.m_stage_title=cmLabelEx.getLabel(cmString("%s %s %s",page,story.name,stage),LABEL_FONT_INDEX.FONT_2071,!1,!0,2,cc.color.BLACK),this.m_stage_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_stage_title.setPosition(15,winSize.height-15),this.m_base_layer.addChild(this.m_stage_title),this.createTreasureBox(),this.createStageGauge(),this.createTimerLabel()}else if(this.m_game_type==db.BattleGameType.WeeklyDungeon){this.m_weekly_dungeon=context.getWeeklyDungeonDifficulty();var dungeon=context.getWeeklyDungeonData(),label_path="#img_vs_day_text_"+leadingZeros(dungeon.weekly_dungeon.img_num,2)+".png";switch(this.stage_weekly=new cc.Sprite("#img_vs_day_text_"+leadingZeros(dungeon.weekly_dungeon.img_num,2)+".png"),this.stage_weekly.setAnchorPoint(0,1),this.stage_weekly.setPosition(13,this.winSize.height-5),this.m_base_layer.addChild(this.stage_weekly),this.m_weekly_dungeon.weekly_difficulty.difficulty_type){case 1:label_path="#img_vs_day_text_easy.png";break;case 2:label_path="#img_vs_day_text_normal.png";break;case 3:label_path="#img_vs_day_text_hard.png";break;case 4:label_path="#img_vs_day_text_hard2.png";break;default:label_path=""}if(0!=label_path.length&&(this.difficulty_weekly=new cc.Sprite(label_path),this.difficulty_weekly.setAnchorPoint(0,1),this.difficulty_weekly.setPosition(13+ccWidth(this.stage_weekly)+5,this.winSize.height-5),this.m_base_layer.addChild(this.difficulty_weekly),"y"==this.m_weekly_dungeon.weekly_difficulty.two_times_yn)){var twice_label=new cc.Sprite("#img_vs_day_text_x2.png");twice_label.setAnchorPoint(ANCHOR_TOP_LEFT()),twice_label.setPosition(13+ccWidth(this.stage_weekly)+5+ccWidth(this.difficulty_weekly)+5,this.winSize.height-5),this.m_base_layer.addChild(twice_label)}this.createTreasureBox(),this.createStageGauge(),this.createTimerLabel()}else if(this.m_game_type==db.BattleGameType.EventDungeon){this.m_event_dungeon=context.getEventDungeonData();for(var period=MasterManager.getInstance().get_EventDungeonPeriod(this.m_event_dungeon.event_dungeon_period.event_dungeon_period_idx),gnrl_img=[],idx=1;idx<=EVENT_CUT_BOSS_NUM;idx++)gnrl_img.push(RES_CDN_DEFULT+"menu_eventvs_"+this.m_event_dungeon.event_dungeon_period.event_dungeon_period_idx+"/img_eventvs_cut_boss_10_"+idx+".png"),gnrl_img.push(RES_CDN_DEFULT+"menu_eventvs_"+this.m_event_dungeon.event_dungeon_period.event_dungeon_period_idx+"/img_eventvs_cut_boss_33_"+idx+".png");this.m_event_dungeon.event_dungeon.event_dungeon_idx==PRESENT_DUNGEON_IDX?gnrl_img.push(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_vs_event_dungeon_text_present.png",this.m_event_dungeon.event_dungeon_period.event_dungeon_period_idx)):gnrl_img.push(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_vs_event_dungeon_text.png",this.m_event_dungeon.event_dungeon_period.event_dungeon_period_idx)),cc.loader.load(gnrl_img,function(err,results){err?cc.log("Failed to load %s.",gnrl_img):(this.m_event_dungeon.event_dungeon.event_dungeon_idx==PRESENT_DUNGEON_IDX?(this.stage_event=new cc.Sprite(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_vs_event_dungeon_text_present.png",this.m_event_dungeon.event_dungeon_period.event_dungeon_period_idx)),this.stage_event.setAnchorPoint(ANCHOR_TOP_LEFT()),this.stage_event.setPosition(13,this.winSize.height-5),this.m_base_layer.addChild(this.stage_event)):(this.stage_event=new cc.Sprite(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_vs_event_dungeon_text.png",this.m_event_dungeon.event_dungeon_period.event_dungeon_period_idx)),this.stage_event.setAnchorPoint(ANCHOR_TOP_LEFT()),this.stage_event.setPosition(13,this.winSize.height-5),this.m_base_layer.addChild(this.stage_event),this.difficulty_event=new cc.Sprite("#img_vs_marathon_text_"+this.m_event_dungeon.event_dungeon.bg_type+".png"),this.difficulty_event.setAnchorPoint(ANCHOR_TOP_LEFT()),this.difficulty_event.setPosition(13+ccWidth(this.stage_event)+5,this.winSize.height-5),this.m_base_layer.addChild(this.difficulty_event)),this.createStageGauge(),this.createTimerLabel(),0!=this.m_event_dungeon.cutin_stage&&(this.createTreasureBox(),this.m_treasure_box.setVisible(!1),this.createCutinTimerLabel(),this.createCutinAccumDamage()))}.bind(this))}else if(this.m_game_type==db.BattleGameType.OnceADayDungeon){this.m_once_a_day_dungeon=context.getEventOnceADayDungeonData();var stage_type="";stage_type=this.m_once_a_day_dungeon.dungeon.dungeon_type==EVENT_DUNGEON_SUB_TYPE_ONCE_A_DAY?"img_vs_event_dungeon_text_daily":"img_vs_event_dungeon_text_oneday",(stage=new cc.Sprite(RES_CDN_DEFULT+cmString("menu_eventvs_%d/%s.png",this.m_once_a_day_dungeon.period.event_dungeon_group_idx,stage_type))).setAnchorPoint(ANCHOR_TOP_LEFT()),stage.setPosition(13,this.winSize.height-5),this.m_base_layer.addChild(stage),this.createStageGauge(),this.createTimerLabel()}else if(this.m_game_type==db.BattleGameType.GreatWallDungeon){this.m_great_wall_dungeon=context.getGreatWallDungeonData(),(stage=new cc.Sprite(RES_CDN_DEFULT+"menu_great_wall/img_great_wall_text.png")).setAnchorPoint(ANCHOR_TOP_LEFT()),stage.setPosition(13,this.winSize.height-5),this.m_base_layer.addChild(stage),this.m_stage_title=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/mission_stage_numb.fnt",cmString("%d",this.m_great_wall_dungeon.great_wall_dungeon.step),cc.TEXT_ALIGNMENT_LEFT),this.m_stage_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_stage_title.setPosition(13+ccWidth(stage)+10,this.winSize.height-5),this.m_base_layer.addChild(this.m_stage_title),this.createTimerLabel()}else if(this.m_game_type==db.BattleGameType.WorldWarNpcDungeon)this.m_world_war_npc_dungeon=context.getWorldWarNpcBattleData(),this.createTimerLabel();else if(this.m_game_type==db.BattleGameType.DailyDungeon)USE_SP_DAILY_SCALE?(this.m_daily_dungeon=context.getDailyDungeonData(),this.stage_daily=new cc.Sprite(RES_CDN_DEFULT+cmString("menu_dailyvs/img_vs_daily_dungeon_text_%d.png",this.m_daily_dungeon.daily_dungeon.bg_type)),this.stage_daily.setAnchorPoint(0,1),this.stage_daily.setPosition(13,this.winSize.height-5),this.stage_daily.setScale(2)):(this.m_daily_dungeon=context.getDailyDungeonData(),this.stage_daily=new cc.Sprite(RES_CDN_DEFULT+cmString("menu_dailyvs/img_vs_daily_dungeon_text_%d.png",this.m_daily_dungeon.daily_dungeon.bg_type)),this.stage_daily.setAnchorPoint(0,1),this.stage_daily.setPosition(13,this.winSize.height-5)),this.m_base_layer.addChild(this.stage_daily),this.createTimerLabel(),this.createBossLifeGauge();else if(this.m_game_type==db.BattleGameType.Mussang){var mussang_id=context.getMussangId();this.m_mussang=$.extend({},database.BattleMussang),service.getMasterMussangStepStageNpc(mussang_id,this.m_mussang);var m_type=MasterManager.getInstance().get_MussangType(this.m_mussang.mussang.mussang_type);this.stage_mussang=new cc.Sprite(RES_CDN_DEFULT+"menu_vs/img_vs_road_text.png"),this.stage_mussang.setAnchorPoint(0,1),this.stage_mussang.setPosition(13,this.winSize.height-5),this.m_base_layer.addChild(this.stage_mussang),this.m_stage_title=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/mission_stage_numb.fnt",m_type.name+" "+this.m_mussang.mussang_step,cc.TEXT_ALIGNMENT_LEFT),this.m_stage_title.setAnchorPoint(0,1),this.m_stage_title.setPosition(13+ccWidth(this.stage_mussang)+10,this.winSize.height-5),this.m_base_layer.addChild(this.m_stage_title),this.createStageGauge(),this.createTimerLabel()}else if(this.m_game_type==db.BattleGameType.TowerDungeon){this.m_mussang_tower_dungeon=context.getMussangTowerDungeonData(),(stage=new cc.Sprite(RES_CDN_DEFULT+"menu_tower/img_vs_tower_text.png")).setContentSize(cc.size(82,24)),stage.setAnchorPoint(ANCHOR_TOP_LEFT()),stage.setPosition(13,this.winSize.height-5),this.m_base_layer.addChild(stage),this.m_stage_title=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/mission_stage_numb.fnt",cmString("%d",this.m_mussang_tower_dungeon.mussang_tower.step),cc.TEXT_ALIGNMENT_LEFT),this.m_stage_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_stage_title.setPosition(13+ccWidth(stage)+10,this.winSize.height-5),this.m_base_layer.addChild(this.m_stage_title);var stage_title_2=new cc.Sprite(RES_CDN_DEFULT+"menu_tower/img_vs_tower_text_2.png");stage_title_2.setAnchorPoint(ANCHOR_TOP_LEFT()),stage_title_2.setPosition(ccPosX(this.m_stage_title)+ccWidth(this.m_stage_title),this.winSize.height-5),this.m_base_layer.addChild(stage_title_2),this.createTimerLabel()}else if(this.m_game_type==db.BattleGameType.Prologue);else if(this.m_game_type==db.BattleGameType.RaidDungeon){this.m_raid_boss_dungeon=context.getRaidDungeonData(),(stage=new cc.Sprite(RES_CDN_DEFULT+"menu_raid/img_raid_dungeon_text.png")).setAnchorPoint(ANCHOR_TOP_LEFT()),stage.setPosition(13,this.winSize.height-5),this.m_base_layer.addChild(stage),this.createRaidBossLifeGuage(),this.createTimerLabel()}else if(this.m_game_type==db.BattleGameType.NewRaidBossDungeon){this.m_new_raid_boss_dungeon=context.getBattleNewRaidBossDungeonData();var stage_str="";1==this.m_new_raid_boss_dungeon.dungeon_data.difficult?stage_str=cmString("%s%s",this.m_new_raid_boss_dungeon.dungeon_data.boss_name,res_str("new_raidboss_main_mode_button_easy")):2==this.m_new_raid_boss_dungeon.dungeon_data.difficult&&(stage_str=cmString("%s%s",this.m_new_raid_boss_dungeon.dungeon_data.boss_name,res_str("new_raidboss_main_mode_button_hard"))),this.m_stage_title=cmLabelEx.getLabel(stage_str,LABEL_FONT_INDEX.FONT_2071,!1,!0,2,cc.color(0,0,0,255)),this.m_stage_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_stage_title.setPosition(13,winSize.height-5),this.m_base_layer.addChild(this.m_stage_title),this.createNewRaidBossLifeGauge(),this.createTimerLabel()}else if(this.m_game_type==db.BattleGameType.EventMussangBossDungeon){(stage=new cc.Sprite(RES_CDN_DEFULT+"menu_vs/img_vs_boss_text.png")).setAnchorPoint(ANCHOR_TOP_LEFT()),stage.setPosition(13,winSize.height-5),this.m_base_layer.addChild(stage),this.createTimerLabel()}else if(this.m_game_type==db.BattleGameType.EventRaidDungeon){period=NetService().get_Event_Raid_Dungeon_Period_idx();(stage=new cc.Sprite(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_vs_event_dungeon_raid_text.png",period))).setAnchorPoint(ANCHOR_TOP_LEFT()),stage.setPosition(13,winSize.height-5),this.m_base_layer.addChild(stage),this.createTimerLabel(),this.createEventRaidAccumDamage()}if(this.m_game_type!=db.BattleGameType.Prologue&&(this.relation_prologue=new cc.Sprite("#img_battletech.png"),this.relation_prologue.anchorX=0,this.relation_prologue.anchorY=0,this.relation_prologue.setPosition(6,500),this.m_base_layer.addChild(this.relation_prologue)),this.pause_btn_off=new cc.Sprite(RES_CDN_DEFULT+"menu_battle/btn/btn_pause_off.png"),this.pause_btn_off.setVisible(!1),this.m_base_layer.addChild(this.pause_btn_off),this.pause_btn=new ccui.Button,this.pause_btn.loadTextures(RES_CDN_DEFULT+"menu_battle/btn/btn_pause_off.png",RES_CDN_DEFULT+"menu_battle/btn/btn_pause_on.png",""),this.pause_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_battle_pause)}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.pause_btn.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),this.pause_btn.anchorX=.5,this.pause_btn.anchorY=.5,this.pause_btn.setPosition(this.winSize.width-10-.5*ccWidth(this.pause_btn_off),this.winSize.height-10-.5*ccHeight(this.pause_btn_off)),this.m_base_layer.addChild(this.pause_btn),this.m_game_type==db.BattleGameType.Prologue&&this.pause_btn.setVisible(!1),this.createTimeScaleBtn(),this.createAutoSkillBtn(),this.m_game_type==db.BattleGameType.Mission){mission_id=context.getMissionID();this.m_script_node_v2=new BattleStoryScriptLayerV2,this.m_script_node_v2._scriptViewComplete=this.scriptViewCompleteV2.bind(this),this.m_script_node_v2.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_script_node_v2.setVisible(!1),this.addChild(this.m_script_node_v2),this.m_script_node_v2.loadScript(mission_id,1)&&this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.battle_script_occured_before)}else if(this.m_game_type==db.BattleGameType.StoryHardMode);else if(this.m_game_type==db.BattleGameType.EventDungeon){dungeon=context.getEventDungeonData();var user_data=NetService().get_User_info();USE_UI_3RD_SCRIPT?(this.m_event_dungeon_script_node_v2=new BattleEventDungeonScriptLayerV2(user_data),(this.m_event_dungeon_script_node_v2._scriptViewComplete=this).m_event_dungeon_script_node_v2.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_event_dungeon_script_node_v2.setVisible(!1),this.addChild(this.m_event_dungeon_script_node_v2),this.m_event_dungeon_script_node_v2.loadScript(dungeon.event_dungeon.event_dungeon_idx,1)&&this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.battle_script_occured_before)):(this.m_event_dungeon_script_node=new BattleEventDungeonScriptLayer(user_data),(this.m_event_dungeon_script_node._scriptViewComplete=this).m_event_dungeon_script_node.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_event_dungeon_script_node.setVisible(!1),this.addChild(this.m_event_dungeon_script_node),this.m_event_dungeon_script_node.loadScript(dungeon.event_dungeon.event_dungeon_idx,1)&&this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.battle_script_occured_before))}else this.m_game_type==db.BattleGameType.OnceADayDungeon||this.m_game_type==db.BattleGameType.DailyDungeon||this.m_game_type==db.BattleGameType.GreatWallDungeon||this.m_game_type==db.BattleGameType.TowerDungeon||this.m_game_type==db.BattleGameType.WeeklyDungeon||this.m_game_type==db.BattleGameType.EventMussangBossDungeon||this.m_game_type==db.BattleGameType.WorldWarNpcDungeon||this.m_game_type==db.BattleGameType.RaidDungeon||this.m_game_type==db.BattleGameType.EventRaidDungeon||this.m_game_type==db.BattleGameType.NewRaidBossDungeon||(this.m_game_type,db.BattleGameType.Mussang);this.m_skill_cut_layer_v2=new BattleSkillCutLayerV2,(this.m_skill_cut_layer_v2._callback_hide=this).m_skill_cut_modal=new GameModalLayer,this.m_skill_cut_modal.setContentSize(this.winSize.width,640),this.addChild(this.m_skill_cut_modal,99999)},eventDungeonCutinTimeOutCallback:function(){this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.battle_cutin_limit_time_out)},setTimerStop:function(is_stop){},cutinTimerStart:function(){null!=this.m_cutin_timer&&this.m_cutin_timer.timerStart(this.m_is_2x_time_scale?BATTLE_TIME_SCALE_2X:BATTLE_TIME_SCALE_1X)},cutinTimerStop:function(){null!=this.m_cutin_timer&&this.m_cutin_timer.timerStop()},getCutinCurTime:function(){return null!=this.m_cutin_timer?this.m_cutin_timer.getTime():0},getCurTime:function(){return null!=this.m_timer?this.m_timer.getTime():0},timerStart:function(){if(null!=this.m_timer){if(this.m_timer.timerStart(this.m_is_2x_time_scale?BATTLE_TIME_SCALE_2X:BATTLE_TIME_SCALE_1X),null!=this.m_friend_slot)5==(left_team=this.m_battle_scene.getBattleField().getLeftTeam()).getAliveMemberCount()||this.m_is_skill_pause||this.m_is_reserved_friend&&this.insertFriendGeneral_V2(this.m_friend_slot);for(var left_team=this.m_battle_scene.getBattleField().getLeftTeam(),right_team=this.m_battle_scene.getBattleField().getRightTeam(),general_members=left_team.getTeamMembers(),idx=0;idx<general_members.length;idx++)general_members[idx].set_Start_Skill_DeltaTime(!0);var right_team_members=right_team.getTeamMembers();for(idx=0;idx<right_team_members.length;idx++)right_team_members[idx].set_Start_Skill_DeltaTime(!0)}},pauseUI:function(){this.is_pause_ui=!0,null!=this.m_timer&&(this.m_timer.setPause(),BattleContext._getInstance().getMissionWin()&&this.m_timer.setMissiontimerStop()),this.m_game_type==db.BattleGameType.EventDungeon&&null!=this.m_cutin_timer&&this.m_cutin_timer.isVisible()&&this.m_cutin_timer.setPause(),null!=this.m_skill_cut_layer_v2&&this.m_skill_cut_layer_v2.pause()},createNewRaidBossLifeGauge:function(){for(var winSize=ccSize(this),boss_count=0,i=this.m_new_raid_boss_dungeon.dungeon.boss_data_list.length-1;0<=i;--i)0<this.m_new_raid_boss_dungeon.dungeon.boss_data_list[i].remain_hp&&boss_count++;var offset_y=.5*winSize.height;1<boss_count&&(offset_y=.5*winSize.height+167*(boss_count-1)/2);var npc_list=this.m_new_raid_boss_dungeon.stage_npc.at(this.m_new_raid_boss_dungeon.current_stage);for(i=0;i<this.m_new_raid_boss_dungeon.dungeon.boss_data_list.length;i++){var boss=this.m_new_raid_boss_dungeon.dungeon.boss_data_list.at(i);if(0<boss.remain_hp){var found_gnrl=npc_list.findIndex(function(g){return g.npc_id==boss.boss_idx});if(-1!=found_gnrl){var bar=new BattleNewRaidbossLifeGaugeBar;bar.setNewRaidBossData(boss),bar.setNewRaidBossGeneralData(npc_list[found_gnrl]),bar.setPosition(winSize.width,offset_y),this.m_base_layer.addChild(bar),offset_y-=167,this.m_new_raid_boss_life_gauge_list.insert(boss.boss_idx,bar)}}}},createRaidBossLifeGuage:function(){this.m_raid_boss_life_gauge=new BattleRaidBossLifeGaugeBar,this.m_raid_boss_life_gauge.setPosition(.5*this.winSize.width,this.winSize.height-10),this.m_raid_boss_life_gauge.setRaidBossData(this.m_raid_boss_dungeon.data),this.m_raid_boss_life_gauge.setPercentageLife(this.m_raid_boss_dungeon.data.remain_hp),this.m_base_layer.addChild(this.m_raid_boss_life_gauge)},createMussangBossLifgGuage:function(){var data,netservice=new NetService;data=netservice.get_User_Mussang_Boss_info(),this.m_Mussang_Boss_Life_Gauge=new BattleEventDungeonMussangBossLifeGaugeBar,this.m_Mussang_Boss_Life_Gauge.setPosition(.5*this.winSize.width,this.winSize.height-10),this.m_Mussang_Boss_Life_Gauge.setEventDungeonMussangBossData(data);var list_idx=netservice.get_User_Mussang_Boss_list_Cnt();this.m_Mussang_Boss_Life_Gauge.setPercentageLife(data.user_mussang_boss_npc_info[list_idx].remain_hp),this.m_base_layer.addChild(this.m_Mussang_Boss_Life_Gauge)},createBossLifeGauge:function(){if(this.m_boss_life_gauge=new BattleBossGaugeNode,this.m_game_type==db.BattleGameType.RaidDungeon){var boss_info=BattleContext._getInstance().getRaidDungeonData().data;this.m_boss_life_gauge.setPosition(.5*this.winSize.width,this.winSize.height-64);var max_life=boss_info.max_hp,per=boss_info.remain_hp/max_life*100;this.m_boss_life_gauge.setPercentageLife(per)}else this.m_boss_life_gauge.setPosition(.5*this.winSize.width,this.winSize.height-34);this.m_base_layer.addChild(this.m_boss_life_gauge)},createCutinTimerLabel:function(){var cutin_info;this.m_cutin_timer=new BattleUITimer,cutin_info=MasterManager.getInstance().get_EventDungeonCutinInfo(this.m_event_dungeon.event_dungeon_cutin_info_idx),this.m_cutin_timer.setStartTime(cutin_info.limit_time,TIME_INC_TYPE.TIME_DEC),this.m_cutin_timer._complete_callback=this.eventDungeonCutinTimeOutCallback.bind(this),this.m_cutin_timer.setPosition(.5*ccWidth(this),ccHeight(this)-45),this.m_cutin_timer.setVisible(!1),this.m_cutin_timer.setTimerFontSize(24),this.m_cutin_timer.timerStop(),this.m_base_layer.addChild(this.m_cutin_timer)},addGainItemCount:function(){if(this.m_gain_item_count++,null!=this.m_treasuer_gain_count){this.m_treasuer_gain_count.setString("+"+this.m_gain_item_count),this.m_treasuer_gain_count.stopAllActions(),this.m_treasuer_gain_count.setScale(1);var scaleUp=cc.scaleTo(.15,1.5),scaleDown=cc.scaleTo(.2,1),seq=cc.sequence(scaleUp,scaleDown);this.m_treasuer_gain_count.runAction(seq),0<this.m_gain_item_count&&this.m_treasuer_gain_count.setVisible(!0)}},skipScript:function(){this.m_base_layer.setVisible(!0),this.m_game_type==db.BattleGameType.Mission?this.m_script_node_v2.setVisible(!1):this.m_game_type==db.BattleGameType.StoryHardMode||(this.m_game_type==db.BattleGameType.EventDungeon?this.m_event_dungeon_script_node_v2.setVisible(!1):this.m_game_type==db.BattleGameType.DailyDungeon||this.m_game_type==db.BattleGameType.GreatWallDungeon||(this.m_game_type,db.BattleGameType.TowerDungeon))},changeAutoSkill:function(isAuto){this.m_is_auto_skill=isAuto,this.m_auto_circle.setVisible(this.m_is_auto_skill);var icon_name=this.m_is_auto_skill?RES_CDN_DEFULT+"menu_battle/btn/btn_auto_none.png":RES_CDN_DEFULT+"menu_battle/btn/btn_auto_off.png",frame1_texture=cc.textureCache.getTextureForKey(icon_name),frame1=new cc.SpriteFrame(frame1_texture,cc.rect(0,0,frame1_texture.getContentSize().width,frame1_texture.getContentSize().height));this.m_auto_normal.setSpriteFrame(frame1),frame1=frame1_texture=icon_name=null},createTreasureBox:function(){this.m_game_type==db.BattleGameType.EventDungeon&&0!=this.m_event_dungeon.cutin_stage?this.m_treasure_box=new cc.Sprite("#img_treasure_box_2.png"):this.m_treasure_box=new cc.Sprite("#img_treasure_box.png"),this.m_treasure_box.setAnchorPoint(ANCHOR_MIDDLE()),this.m_treasure_box.setPosition(this.winSize.width-290,this.winSize.height-39),this.m_base_layer.addChild(this.m_treasure_box),this.m_treasuer_gain_count=cmLabel.getLabel("+0",LABEL_FONT_INDEX.FONT_241),this.m_treasuer_gain_count.enableOutline(cc.color.BLACK,1),this.m_treasuer_gain_count.anchorX=.5,this.m_treasuer_gain_count.anchorY=.5,this.m_treasuer_gain_count.setPosition(80,20),this.m_treasure_box.addChild(this.m_treasuer_gain_count)},createStageGauge:function(){this.m_stage_gauge_node=new BattleStageGaugeNode,this.m_stage_gauge_node.anchorX=.5,this.m_stage_gauge_node.anchorY=0,this.m_stage_gauge_node.setPosition(.5*this.winSize.width,621),this.m_base_layer.addChild(this.m_stage_gauge_node)},createEventRaidAccumDamage:function(){this.m_event_raid_accum_damage=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_cutin_damage.fnt","",cc.TEXT_ALIGNMENT_CENTER),this.m_event_raid_accum_damage.setAnchorPoint(ANCHOR_MIDDLE()),this.m_event_raid_accum_damage.setPosition(.5*this.winSize.width,this.winSize.height-70),this.m_event_raid_accum_damage.setString("0"),this.m_base_layer.addChild(this.m_event_raid_accum_damage)},createTimerLabel:function(){var winSize=ccSize(this);if(this.m_timer=new BattleUITimer,this.m_game_type==db.BattleGameType.DailyDungeon)this.m_timer.setStartTime(this.m_daily_dungeon.daily_dungeon.limit_time,TIME_INC_TYPE.TIME_DEC),this.m_timer._complete_callback=this.dailyDungeonTimeOutCallback.bind(this),this.m_timer.setPosition(.5*winSize.width,579),this.m_base_layer.addChild(this.m_timer);else if(this.m_game_type==db.BattleGameType.RaidDungeon){null==this.m_raid_boss_life_gauge&&this.createRaidBossLifeGuage();var limit_time=BattleContext._getInstance().getRaidDungeonData().limit_time;this.m_timer.setStartTime(limit_time,TIME_INC_TYPE.TIME_DEC),this.m_timer._complete_callback=this.raidDungeonTimeoutCallback.bind(this),this.m_timer.setPosition(ccCenter(this.m_raid_boss_life_gauge).x,-56),this.m_raid_boss_life_gauge.addChild(this.m_timer)}else if(this.m_game_type==db.BattleGameType.NewRaidBossDungeon){limit_time=BattleContext._getInstance().getBattleNewRaidBossDungeonData().limit_time;this.m_timer.setStartTime(limit_time,TIME_INC_TYPE.TIME_DEC),this.m_timer._complete_callback=this.newRaidBossDungeonTimeoutCallback.bind(this),this.m_timer.setPosition(.5*winSize.width,winSize.height-20),this.m_base_layer.addChild(this.m_timer)}else if(this.m_game_type==db.BattleGameType.GreatWallDungeon||this.m_game_type==db.BattleGameType.TowerDungeon)this.m_timer.setStartTime(0,TIME_INC_TYPE.TIME_INC),this.m_timer.setPosition(.5*ccWidth(this),ccHeight(this)-15),this.m_base_layer.addChild(this.m_timer);else if(this.m_game_type==db.BattleGameType.WorldWarNpcDungeon){limit_time=MasterManager.getInstance().get_WorldWarCountFunc(1).value;this.m_timer.setStartTime(limit_time,TIME_INC_TYPE.TIME_DEC),this.m_timer.setPosition(.5*ccWidth(this),ccHeight(this)-15),this.m_timer._complete_callback=this.worldWarNpcDungeonTimeoutCallback.bind(this),this.m_base_layer.addChild(this.m_timer)}else if(this.m_game_type==db.BattleGameType.EventMussangBossDungeon){null==this.m_Mussang_Boss_Life_Gauge&&this.createMussangBossLifgGuage();limit_time=BattleContext._getInstance().getEventDungeonMussangBossLimitTime();this.m_timer.setStartTime(limit_time,TIME_INC_TYPE.TIME_DEC),this.m_timer._complete_callback=this.MussangBossTimeOutCallBack.bind(this),this.m_timer.setPosition(.5*ccWidth(this),ccHeight(this)-90),this.m_base_layer.addChild(this.m_timer)}else if(this.m_game_type==db.BattleGameType.EventRaidDungeon){var event_raid_dungeon_idx=NetService().get_Event_Raid_Dungeon_idx();limit_time=MasterManager.getInstance().get_EventRaidDungeon(event_raid_dungeon_idx).limit_time;this.m_timer.setStartTime(limit_time,TIME_INC_TYPE.TIME_DEC),this.m_timer._complete_callback=this.EventRaidTimeOutCallBack.bind(this),this.m_timer.setPosition(.5*ccWidth(this),ccHeight(this)-20),this.m_base_layer.addChild(this.m_timer)}else this.m_timer.setStartTime(0,TIME_INC_TYPE.TIME_INC),this.m_timer.setPosition(.5*ccWidth(this),ccHeight(this)-45),this.m_base_layer.addChild(this.m_timer),this.m_game_type==db.BattleGameType.Mission&&(this.m_timer._complete_callback=this.raidDungeonTimeoutCallback.bind(this))},raidDungeonTimeoutCallback:function(){this.m_battle_scene.raidDungeonTimeLimitComplete()},newRaidBossDungeonTimeoutCallback:function(){this.m_battle_scene.newRaidBossDungeonTimeLimitComplete()},worldWarNpcDungeonTimeoutCallback:function(){this.m_battle_scene.worldWarNpcDungeonTimeLimitComplete()},MussangBossTimeOutCallBack:function(){this.m_battle_scene.MussangBossDungeonTimeLimitComplete()},EventRaidTimeOutCallBack:function(){this.m_battle_scene.EventRaidTimeLimitComplete()},setMissionTimeOut:function(){this.m_timer.setMissiontimerStart()},createCutinAccumDamage:function(){this.m_cutin_info_container=new cc.Node,this.m_cutin_info_container.setPosition(.5*this.winSize.width,this.winSize.height-95),this.m_base_layer.addChild(this.m_cutin_info_container),this.m_cutin_info_container.setVisible(!1),this.m_cutin_accum_damage=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_cutin_damage.fnt","",cc.TEXT_ALIGNMENT_CENTER),this.m_cutin_accum_damage.setAnchorPoint(ANCHOR_MIDDLE()),this.m_cutin_accum_damage.setPosition(ZERO()),this.m_cutin_accum_damage.setString("D 0"),this.m_cutin_info_container.addChild(this.m_cutin_accum_damage);for(var period=MasterManager.getInstance().get_EventDungeonPeriod(this.m_event_dungeon.event_dungeon_period.event_dungeon_period_idx),list=this.m_event_dungeon.stage_npc.at(this.m_event_dungeon.cutin_stage),idx=0;idx<list.length;idx++){var npc=list[idx];if(npc.is_zoom&&npc.is_cutin_npc){var size=ccSize(this.m_cutin_accum_damage);this.m_cutin_boss_name=new cc.Sprite(RES_CDN_DEFULT+"menu_eventvs_"+period.event_dungeon_point_period_idx+"/img_eventvs_cut_boss_"+npc.general.gnrl_group+"_"+this.m_event_dungeon.event_dungeon.bg_type+".png"),this.m_cutin_boss_name.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_cutin_boss_name.setPosition(.5*-size.width-20,0),this.m_cutin_info_container.addChild(this.m_cutin_boss_name);break}}},dailyDungeonTimeOutCallback:function(){this.m_battle_scene.dailyDungeonTimeLimitComplete()},change2XGameSpeed:function(is2xSpeed){this.m_is_2x_time_scale=is2xSpeed,this.m_2x_circle.setVisible(this.m_is_2x_time_scale);var icon_name=this.m_is_2x_time_scale?RES_CDN_DEFULT+"menu_battle/btn/btn_x2_none.png":RES_CDN_DEFULT+"menu_battle/btn/btn_x2_off.png",frame1_texture=cc.textureCache.getTextureForKey(icon_name),frame1=new cc.SpriteFrame(frame1_texture,cc.rect(0,0,frame1_texture.getContentSize().width,frame1_texture.getContentSize().height));this.m_2x_normal.setSpriteFrame(frame1),this.m_battle_scene.getBattleField().setBattleTimeScale(this.m_is_2x_time_scale?BATTLE_TIME_SCALE_2X:BATTLE_TIME_SCALE_1X),null!=this.m_timer&&this.m_timer.setTimeScale(this.m_is_2x_time_scale?BATTLE_TIME_SCALE_2X:BATTLE_TIME_SCALE_1X),null!=this.m_cutin_timer&&this.m_cutin_timer.setTimeScale(this.m_is_2x_time_scale?BATTLE_TIME_SCALE_2X:BATTLE_TIME_SCALE_1X),frame1=frame1_texture=icon_name=null},showScript:function(isShow){if(this.m_game_type==db.BattleGameType.Mission){if(this.m_base_layer.setVisible(!isShow),this.m_script_node_v2.setVisible(isShow),isShow&&(USE_UI_3RD_SCRIPT?this.m_script_node_v2.typingBattleScript():this.m_script_node.typingBattleScript(),!USE_SCRIPT_BGM)){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/BGM_story_loop.mp3";audio.m_bgmPath!=path&&audio.playBackgroundMusic(path,!0)}}else if(this.m_game_type==db.BattleGameType.StoryHardMode);else if(this.m_game_type==db.BattleGameType.EventDungeon){if(this.m_base_layer.setVisible(!isShow),USE_UI_3RD_SCRIPT?this.m_event_dungeon_script_node_v2.setVisible(isShow):this.m_event_dungeon_script_node.setVisible(isShow),isShow&&(USE_UI_3RD_SCRIPT?this.m_event_dungeon_script_node_v2.typingBattleScript():this.m_event_dungeon_script_node.typingBattleScript(),!USE_SCRIPT_BGM)){audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/BGM_event_dungeon_script_"+this.m_event_dungeon.event_dungeon.event_dungeon_period_idx+".mp3";audio.m_bgmPath!=path&&audio.playBackgroundMusic(path,!0)}}else this.m_game_type==db.BattleGameType.OnceADayDungeon||this.m_game_type==db.BattleGameType.DailyDungeon||this.m_game_type==db.BattleGameType.GreatWallDungeon||this.m_game_type==db.BattleGameType.EventMussangBossDungeon||this.m_game_type==db.BattleGameType.WorldWarNpcDungeon||(this.m_game_type,db.BattleGameType.NewRaidBossDungeon)},showBattleUI:function(){this.changeBattleGameSpeed(this.m_game_speed_type),this.m_game_type==db.BattleGameType.Mission?USE_UI_3RD_SCRIPT&&(null!=this.m_script_node_v2?this.m_script_node_v2.IsReady()?this.showScript(!0):this.showScript(!1):this.m_base_layer.setVisible(!0)):this.m_game_type==db.BattleGameType.EventDungeon?USE_UI_3RD_SCRIPT&&(null!=this.m_event_dungeon_script_node_v2?this.m_event_dungeon_script_node_v2.IsReady()?this.showScript(!0):this.showScript(!1):this.m_base_layer.setVisible(!0)):this.m_base_layer.setVisible(!0);for(var members=this.m_battle_scene.getBattleField().getLeftTeam().getTeamMembers(),i=0,len=members.length;i<len;i++)members[i]._cbEventListenerUIMng=this,1!=members[i].getGeneral().general.gnrl_type&&(members[i]._addSkillMessage=this,members[i]._addSkillMessage_LR=BattleMessageDirection.Left);members=null;var members2=this.m_battle_scene.getBattleField().getRightTeam().getTeamMembers();for(i=0,len=members2.length;i<len;i++)if(members2[i]._cbEventListenerUIMng=this,members2[i]._addSkillMessage=this,members2[i]._addSkillMessage_LR=BattleMessageDirection.Right,this.m_game_type==db.BattleGameType.RaidDungeon)members2[i].getGeneral().is_zoom&&null!=this.m_raid_boss_life_gauge&&this.m_raid_boss_life_gauge.setRaidBossGeneral(members2[i]);else if(this.m_game_type==db.BattleGameType.EventMussangBossDungeon)members2[i].getGeneral().is_zoom&&null!=this.m_Mussang_Boss_Life_Gauge&&this.m_Mussang_Boss_Life_Gauge.setRaidBossGeneral(members2[i]);else if(this.m_game_type==db.BattleGameType.NewRaidBossDungeon)for(var keys=this.m_new_raid_boss_life_gauge_list.keys(),idx=0;idx<keys.length;idx++){this.m_new_raid_boss_life_gauge_list.at(keys[idx]).setNewRaidBossBattleGeneral(members2[i])}members2=null;for(var ms=this.m_battle_scene.getBattleField().getRightTeam().getAllNpcTeamMembers(),length=(i=0,ms.size());i<length;i++){var s=ms.at(i);if(null==s);else try{for(var k=0;k<s.length;k++){var m=s[k];m._cbEventListenerUIMng=this,m._addSkillMessage=this,m._addSkillMessage_LR=BattleMessageDirection.Right,m=null}}catch(e){}s=null}ms=null;var friend_gnrl_id=-1,members3=this.m_battle_scene.getBattleField().getLeftTeam().getTeamMembers(),slot_count=members3.length,offset_x=.5*this.winSize.width-110*slot_count*.5;for(i=1;i<=5;i++){var pos=i;if(null!=(gnrl=this.find_func(members3,pos))&&0<gnrl.getGeneral().active_skill.length){var slot=new BattleSkillSlot(gnrl,!1);slot._cbBattleState=this,slot.anchorX=0,slot.anchorY=0,this.m_game_type==db.BattleGameType.GreatWallDungeon?slot.setSlotPosition(cc.p(offset_x,31)):slot.setSlotPosition(cc.p(offset_x,21)),this.m_base_layer.addChild(slot),this.m_skill_slots.push_back(slot),offset_x+=slot.getContentSize().width,this.m_game_type==db.BattleGameType.Prologue&&slot.setVisible(!1),slot=null}gnrl=null}var context=BattleContext._getInstance();if(this.m_game_type==db.BattleGameType.Mission||this.m_game_type==db.BattleGameType.EventDungeon||this.m_game_type==db.BattleGameType.StoryHardMode){var gnrl=this.m_battle_scene.getBattleField().getLeftTeam().getFriendGeneral();""!=context.getFriendID()&&null!=gnrl&&(this.m_friend_slot=new BattleFriendSlot(gnrl),this.m_friend_slot.setSlotPosition(cc.p(this.winSize.width-10,4)),(this.m_friend_slot._insertFriendGeneral=this).m_base_layer.addChild(this.m_friend_slot),5==members3.length?this.m_is_reserved_friend=!1:this.m_is_reserved_friend=!0,friend_gnrl_id=gnrl.getGeneral().general.gnrl_id),gnrl=null}context=slot_count=members3=null;var gnrl_id_list=new Array,members4=this.m_battle_scene.getBattleField().getLeftTeam().getTeamMembers();for(i=0,len=members4.length;i<len;i++){var bg=members4[i].getGeneral();1==bg.general.gnrl_type&&gnrl_id_list.push_back(members4[i].getGeneral().general.gnrl_id),bg=null}if(members4=null,-1!=friend_gnrl_id){var fg=MasterManager.getInstance().get_General(friend_gnrl_id);1==fg.gnrl_type&&gnrl_id_list.push_back(friend_gnrl_id),fg=null}this.m_skill_cut_layer_v2.setSkillGeneralList(gnrl_id_list),gnrl_id_list=null},resumeUI:function(_stop_timer){null==_stop_timer&&(_stop_timer=!1),this.is_pause_ui=!1,1!=_stop_timer&&(null==this.m_timer||this.m_is_skill_pause||(this.m_timer.setResume(),BattleContext._getInstance().getMissionWin()&&this.m_timer.setMissiontimerStart()),this.m_game_type==db.BattleGameType.EventDungeon&&null!=this.m_cutin_timer&&this.m_cutin_timer.isVisible()&&this.m_cutin_timer.setResume()),null!=this.m_skill_cut_layer_v2&&this.m_skill_cut_layer_v2.resume()},showCutinUI:function(is_show){this.m_game_type==db.BattleGameType.EventDungeon&&(null!=this.m_timer&&this.m_timer.setVisible(!is_show),null!=this.m_cutin_timer&&this.m_cutin_timer.setVisible(is_show),null!=this.m_cutin_info_container&&this.m_cutin_info_container.setVisible(is_show),is_show&&null!=this.m_treasure_box&&this.m_treasure_box.setVisible(!0))},updateCutinAccumDamage:function(){if(this.m_battle_scene.getBattleField().getRightTeam().IsCutinStage()){if(null!=this.m_cutin_accum_damage){var dmg=this.m_battle_scene.getBattleField().getLeftTeam().getEventDungeonCutinAccumDamage();(max_life=this.m_battle_scene.getBattleField().getRightTeam().getEventDungeonCutinBossMaxLife())<dmg&&0!=max_life&&(dmg=max_life),this.m_cutin_accum_damage.setString("D "+dmg)}if(null!=this.m_cutin_boss_name){var size=ccSize(this.m_cutin_accum_damage);this.m_cutin_boss_name.setPositionX(.5*-size.width-20)}}else if(this.m_game_type==db.BattleGameType.EventRaidDungeon&&null!=this.m_event_raid_accum_damage){var max_life;dmg=this.m_battle_scene.getBattleField().getLeftTeam().getEventRaidDungeonAccumLife();(max_life=parseInt(this.m_battle_scene.getBattleField().getRightTeam().getEventRaidDungeonBossMaxLife()))<dmg&&0!=max_life&&(dmg=max_life),this.m_event_raid_accum_damage.setString(""+dmg)}},updateBossLifeGauge:function(team_type,gnrl){if(team_type==BattleGeneral_TeamType.Right)if(this.m_game_type==db.BattleGameType.DailyDungeon&&gnrl.getGeneral().is_zoom){var max_life=gnrl.getMaxHealthPoint(),per=(cur_life=gnrl.getCurrentLifePoint())/max_life*100;this.m_boss_life_gauge.setPercentageLife(per,!0)}else if(this.m_game_type==db.BattleGameType.RaidDungeon&&gnrl.getGeneral().is_zoom)this.m_raid_boss_life_gauge.setPercentageLife(gnrl.getCurrentLifePoint());else if(this.m_game_type==db.BattleGameType.EventMussangBossDungeon&&gnrl.getGeneral().is_zoom)this.m_Mussang_Boss_Life_Gauge.setPercentageLife(gnrl.getCurrentLifePoint());else if(this.m_game_type==db.BattleGameType.NewRaidBossDungeon){for(var boss_idx=gnrl.getGeneral().npc_id,keys=this.m_new_raid_boss_life_gauge_list.keys(),gauge=-1,idx=0;idx<keys.length;idx++){boss_idx==this.m_new_raid_boss_life_gauge_list.at(keys[idx]).m_boss_data.boss_idx&&(gauge=idx)}if(-1!=gauge){var add_life_count=gnrl.getRemainAddLifeCount(),cur_life=(max_life=gnrl.getMaxHealthPoint(),gnrl.getCurrentLifePoint());this.m_new_raid_boss_life_gauge_list.at(keys[gauge]).setPercentageLife(add_life_count,cur_life,max_life)}}},showSkillCutInV2:function(gnrl,charge_count){var is_show=!1;return this.m_skill_cut_modal._contentNode=function(contentsSize,m){var layer=new cc.Layer;return this.m_skill_cut_layer_v2._parent=null,is_show=this.m_skill_cut_layer_v2.showSkillCutGeneral2(gnrl,charge_count),this.m_skill_cut_layer_v2.setPosition(ccCenter(layer)),layer.addChild(this.m_skill_cut_layer_v2),layer}.bind(this),this.m_skill_cut_modal.is_show()||this.m_skill_cut_modal.show(),is_show},showSkillStart:function(gnrl){this.m_battle_scene.showSkillCutIn(gnrl),this.m_is_skill_pause=!0,null!=this.m_timer&&(this.m_timer.setPause(),BattleContext._getInstance().getMissionWin()&&this.m_timer.setMissiontimerStop()),this.m_game_type==db.BattleGameType.EventDungeon&&null!=this.m_cutin_timer&&this.m_cutin_timer.isVisible()&&this.m_cutin_timer.setPause(),this.hideAllTooltips(),this.showSkillSlotIndicator(!1)},skillEndResume:function(gnrl){(null!=gnrl&&this.m_battle_scene.resumeSkillEnd(gnrl),null!=this.m_timer&&(this.m_timer.setResume(),BattleContext._getInstance().getMissionWin()&&this.m_timer.setMissiontimerStart()),this.m_game_type==db.BattleGameType.EventDungeon&&null!=this.m_cutin_timer&&this.m_cutin_timer.isVisible()&&this.m_cutin_timer.setResume(),this.m_is_skill_pause=!1,this.hideAllTooltips(),this.showSkillSlotIndicator(!0),null!=this.m_friend_slot)&&(5==this.m_battle_scene.getBattleField().getLeftTeam().getAliveMemberCount()||this.m_is_skill_pause||this.m_is_reserved_friend&&this.insertFriendGeneral_V2(this.m_friend_slot))},showSkillSlotIndicator:function(is_show){},insertFriendGeneral_V2:function(slot){var team=this.m_battle_scene.getBattleField().getLeftTeam();if(!team.IsAllDead())if(5==team.getAliveMemberCount())this.m_is_reserved_friend=!1;else if(team.enableInsertFriend()&&!this.m_is_skill_pause){if(this.m_battle_scene.getBattleField().getBattleState()!=BattleState.GamePlaying)return;!team.IsInsertedFriend()&&this.m_is_reserved_friend&&(slot.setVisible(!1),team.insertFriendGeneral(),this.m_is_reserved_friend=!1,this.addFriendSkillSlot())}},addFriendSkillSlot:function(){cc.log("Debug UiMng addFriendSkillSlot");var gnrl=this.m_battle_scene.getBattleField().getLeftTeam().getFriendGeneral();if(0<gnrl.getGeneral().active_skill.length){null!=gnrl&&(null==this.m_friend_skill_slot&&(this.m_friend_skill_slot=new BattleSkillSlot(gnrl,!0),this.m_friend_skill_slot.retain(),this.m_friend_skill_slot._cbBattleState=this,gnrl._cbEventListenerUIMng=this,gnrl.initSkillCooltime()),this.m_base_layer.addChild(this.m_friend_skill_slot),this.m_skill_slots.push_back(this.m_friend_skill_slot));for(var slot_count=this.m_skill_slots.size(),offset_x=.5*this.winSize.width-110*slot_count*.5,i=0;i<slot_count;i++){this.m_skill_slots.at(i).setSlotPosition(cc.p(offset_x+110*i,21))}}},hideAllTooltips:function(){for(var i=0;i<this.m_skill_slots.size();i++){this.m_skill_slots.at(i).hideTooltip()}null!=this.m_friend_skill_slot&&this.m_friend_skill_slot.hideTooltip(),null!=this.m_friend_slot&&this.m_friend_slot.hideTooltip()},EventListenerFromGeneral:function(action,evt){switch(action){case EventCode.EVT_UI_MNG_START:break;case EventCode.EVT_UI_MNG_DEATH:for(var gnrl=evt.dataValue1,i=0;i<this.m_skill_slots.size();i++){var s=this.m_skill_slots.at(i);if(s.IsEqualsGeneral(gnrl)){s.skillEnable(!1);break}}gnrl.getTeamType()==BattleGeneral_TeamType.Left&&(this.m_is_reserved_friend=!0,this.m_is_reserved_friend&&!this.m_is_skill_pause&&this.insertFriendGeneral_V2(this.m_friend_slot));break;case EventCode.EVT_UI_MNG_HITTED:this.updateBossLifeGauge(evt.intValue,evt.dataValue1),this.updateCutinAccumDamage();break;case EventCode.EVT_UI_MNG_SKILL_START:3!=this.m_game_speed_type?this.showSkillCutInV2(evt.dataValue1,evt.intValue)&&this.showSkillStart(evt.dataValue1):(this.showSkillStart(evt.dataValue1),this.hideSkillEnd(evt.dataValue1));break;case EventCode.EVT_UI_MNG_SKILL_END:this.skillEndResume(evt.dataValue1)}},createAutoSkillBtn:function(){this.m_is_auto_skill=GameDefault.getInstance().getUserAutoSkill();var pNode=new cc.Node;this.m_auto_normal=new cc.Sprite(this.m_is_auto_skill?RES_CDN_DEFULT+"menu_battle/btn/btn_auto_none.png":RES_CDN_DEFULT+"menu_battle/btn/btn_auto_off.png"),this.m_auto_normal.anchorX=.5,this.m_auto_normal.anchorY=.5,this.m_auto_circle=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/auto.json",RES_CDN_DEFULT+"effect/auto.atlas",1),this.m_auto_circle.anchorX=.5,this.m_auto_circle.anchorY=.5,this.m_auto_circle.setPosition(0,0),this.m_auto_circle.setAnimation(0,"fx_1",!0),this.m_auto_new_btn=new ccui.Button,this.m_auto_new_btn.loadTextures(RES_CDN_DEFULT+"menu_battle/btn/btn_auto_none.png",RES_CDN_DEFULT+"menu_battle/btn/btn_auto_click.png",""),this.m_auto_new_btn.anchorX=.5,this.m_auto_new_btn.anchorY=.5,this.m_auto_new_btn.setPosition(0,0),this.m_auto_new_btn.setVisible(!1),this.m_auto_new_btn.setTouchEnabled(!1),this.m_auto_new_off_btn=new ccui.Button,this.m_auto_new_off_btn.loadTextures(RES_CDN_DEFULT+"menu_battle/btn/btn_auto_off.png",RES_CDN_DEFULT+"menu_battle/btn/btn_auto_click.png",""),this.m_auto_new_off_btn.anchorX=.5,this.m_auto_new_off_btn.anchorY=.5,this.m_auto_new_off_btn.setPosition(0,0),this.m_auto_new_off_btn.setVisible(!1),this.m_auto_new_off_btn.setTouchEnabled(!1),1==this.m_is_auto_skill?(this.m_auto_new_btn.setVisible(!0),this.m_auto_new_btn.setTouchEnabled(!0),this.m_auto_new_off_btn.setVisible(!1),this.m_auto_new_off_btn.setTouchEnabled(!1)):(this.m_auto_new_btn.setVisible(!1),this.m_auto_new_btn.setTouchEnabled(!1),this.m_auto_new_off_btn.setVisible(!0),this.m_auto_new_off_btn.setTouchEnabled(!0)),this.m_auto_new_btn.addClickEventListener(function(){(this.m_auto_new_btn.setTouchEnabled(!1),BattleContext._getInstance().getGameType()!=db.BattleGameType.Prologue)&&(GameDefault.getInstance().setUserAutoSkill(!this.m_is_auto_skill),this.changeAutoSkill(!this.m_is_auto_skill),MainObserver.getInstance().postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.battle_auto_skill_change_value),this.scheduleOnce(this.autobtnClick,.1))}.bind(this)),this.m_auto_new_off_btn.addClickEventListener(function(){(this.m_auto_new_off_btn.setTouchEnabled(!1),BattleContext._getInstance().getGameType()!=db.BattleGameType.Prologue)&&(GameDefault.getInstance().setUserAutoSkill(!this.m_is_auto_skill),this.changeAutoSkill(!this.m_is_auto_skill),MainObserver.getInstance().postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.battle_auto_skill_change_value),this.scheduleOnce(this.autoOffbtnClick,.1))}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||(this.m_auto_new_btn.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),this.m_auto_new_off_btn.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS)),pNode.setPosition(this.winSize.width-175,this.winSize.height-10-.5*ccHeight(this.m_auto_new_btn)),pNode.addChild(this.m_auto_new_btn),pNode.addChild(this.m_auto_new_off_btn),pNode.addChild(this.m_auto_circle),this.m_base_layer.addChild(pNode),this.m_game_type==db.BattleGameType.Prologue&&(this.m_is_auto_skill=!0),this.changeAutoSkill(this.m_is_auto_skill),this.m_game_type==db.BattleGameType.Prologue&&(pNode.setVisible(!1),null!=this.m_auto_play_count_off&&this.m_auto_play_count_off.setVisible(!1))},showUI:function(isShow){this.m_base_layer.setVisible(isShow)},createTimeScaleBtn:function(){this.m_game_speed_type=GameDefault.getInstance().getUserBattleGameSpeed(),this.m_is_2x_time_scale=1<this.m_game_speed_type;var pNode=new cc.Node;this.m_speed_btn1=new ccui.Button,this.m_speed_btn1.loadTextures(RES_CDN_DEFULT+"menu_battle/btn/btn_quick1_none.png",RES_CDN_DEFULT+"menu_battle/btn/btn_quick1_none.png",""),this.m_speed_btn1.setAnchorPoint(ANCHOR_MIDDLE()),this.m_speed_btn1.setPosition(ZERO()),pNode.addChild(this.m_speed_btn1),this.m_speed_btn1.addClickEventListener(function(sender){this.m_game_speed_type++,3<this.m_game_speed_type&&(this.m_game_speed_type=1),this.changeBattleGameSpeed(this.m_game_speed_type),GameDefault.getInstance().setUserBattleGameSpeed(this.m_game_speed_type)}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_speed_btn1.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),this.m_game_speed_btns.push_back(this.m_speed_btn1),this.m_speed_btn2=new ccui.Button,this.m_speed_btn2.loadTextures(RES_CDN_DEFULT+"menu_battle/btn/btn_quick2_none.png",RES_CDN_DEFULT+"menu_battle/btn/btn_quick2_none.png",""),this.m_speed_btn2.setAnchorPoint(ANCHOR_MIDDLE()),this.m_speed_btn2.setPosition(ZERO()),pNode.addChild(this.m_speed_btn2),this.m_speed_btn2.addClickEventListener(function(sender){this.m_game_speed_type++,3<this.m_game_speed_type&&(this.m_game_speed_type=1),this.changeBattleGameSpeed(this.m_game_speed_type),GameDefault.getInstance().setUserBattleGameSpeed(this.m_game_speed_type)}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_speed_btn2.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),this.m_game_speed_btns.push_back(this.m_speed_btn2),this.m_speed_btn3=new ccui.Button,this.m_speed_btn3.loadTextures(RES_CDN_DEFULT+"menu_battle/btn/btn_quick3_none.png",RES_CDN_DEFULT+"menu_battle/btn/btn_quick3_none.png",""),this.m_speed_btn3.setAnchorPoint(ANCHOR_MIDDLE()),this.m_speed_btn3.setPosition(ZERO()),pNode.addChild(this.m_speed_btn3),this.m_speed_btn3.addClickEventListener(function(sender){this.m_game_speed_type++,3<this.m_game_speed_type&&(this.m_game_speed_type=1),this.changeBattleGameSpeed(this.m_game_speed_type),GameDefault.getInstance().setUserBattleGameSpeed(this.m_game_speed_type)}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_speed_btn3.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),this.m_game_speed_btns.push_back(this.m_speed_btn3),pNode.setPosition(this.winSize.width-107,this.winSize.height-10-29),this.m_base_layer.addChild(pNode),this.m_game_type==db.BattleGameType.Prologue&&pNode.setVisible(!1)},hideSkillCutInV2:function(gnrl){this.m_skill_cut_modal.is_show()&&this.m_skill_cut_modal.hide(),this.hideSkillEnd(gnrl)},hideSkillEnd:function(gnrl){null!=gnrl&&this.m_battle_scene.showSkillCutOut(gnrl)},scriptViewCompleteV2:function(){this.m_base_layer.setVisible(!0),this.m_script_node_v2.setVisible(!1),this.m_is_end_script?this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.battle_script_occured_after_end):this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.battle_script_occured_before_end)},scriptViewComplete:function(node){this.m_base_layer.setVisible(!0),this.m_script_node.setVisible(!1),this.m_is_end_script?this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.battle_script_occured_after_end):this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.battle_script_occured_before_end)},changeBattleGameSpeed:function(speed_type){this.m_game_speed_type=speed_type;for(var i=0;i<this.m_game_speed_btns.size();i++)this.m_game_speed_btns.at(i).setVisible(i+1==this.m_game_speed_type);this.m_is_2x_time_scale=1<this.m_game_speed_type,this.m_battle_scene.getBattleField().setBattleTimeScale(this.m_is_2x_time_scale?BATTLE_TIME_SCALE_2X:BATTLE_TIME_SCALE_1X),null!=this.m_timer&&this.m_timer.setTimeScale(this.m_is_2x_time_scale?BATTLE_TIME_SCALE_2X:BATTLE_TIME_SCALE_1X),null!=this.m_cutin_timer&&this.m_cutin_timer.setTimeScale(this.m_is_2x_time_scale?BATTLE_TIME_SCALE_2X:BATTLE_TIME_SCALE_1X)},scriptEventDungeonCompleteV2:function(){this.m_base_layer.setVisible(!0),this.m_event_dungeon_script_node_v2.setVisible(!1),this.m_is_end_script?this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.battle_script_occured_after_end):this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.battle_script_occured_before_end)},scriptEventDungeonComplete:function(node){this.m_base_layer.setVisible(!0),this.m_event_dungeon_script_node.setVisible(!1),this.m_is_end_script?this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.battle_script_occured_after_end):this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.battle_script_occured_before_end)},recycledSkillMessage:function(direction){if(!this.recycled_skill_message.empty()){for(var found=0,found_is=!1,i=0;i<this.recycled_skill_message.size();i++){if(found=i,this.recycled_skill_message.at(i).getBattleMessageDirection()==direction){found_is=!0;break}}if(1==found_is){var msg=this.recycled_skill_message.at(found);return this.recycled_skill_message.erase(found),msg}msg=new BattleSkillMessage;return this.m_base_layer.addChild(msg),msg.setBattleMessageDirection(direction),msg}msg=new BattleSkillMessage;return this.m_base_layer.addChild(msg),msg.setBattleMessageDirection(direction),msg},addSkillMessageLeftTeam:function(skill){if(this.m_game_type!=db.BattleGameType.Prologue){var msg=this.recycledSkillMessage(BattleMessageDirection.Left);msg.showSkillMessage(BattleMessageDirection.Left,skill);var mSize=ccSize(msg);msg.setPosition(0,175);for(var i=0;i<this.left_used_skill_message.size();i++){var m=this.left_used_skill_message.at(i),ease=cc.moveBy(.2,cc.p(0,mSize.height)).clone().easing(cc.easeInOut(3));m.runAction(ease)}ease=cc.moveBy(.2,cc.p(mSize.width,0)).clone().easing(cc.easeInOut(3));msg.runAction(ease),this.left_used_skill_message.push_back(msg),msg.startFadeOut(this.cbSkiiMessage)}},cbSkiiMessage:function(msg){ccSize(msg);var dir=msg.getBattleMessageDirection();if(dir==BattleMessageDirection.Left)msg.setPositionX(0),(found=this.left_used_skill_message.findNum(msg))!=this.left_used_skill_message.end()&&(this.left_used_skill_message.erase(found),this.recycled_skill_message.push_back(msg));else if(dir==BattleMessageDirection.Right){var found;msg.setPositionX(this.winSize.width),(found=this.right_used_skill_message.findNum(msg))!=this.right_used_skill_message.end()&&(this.right_used_skill_message.erase(found),this.recycled_skill_message.push_back(msg))}},addSkillMessageRightTeam:function(skill){if(this.m_game_type!=db.BattleGameType.Prologue){var msg=this.recycledSkillMessage(BattleMessageDirection.Right);msg.showSkillMessage(BattleMessageDirection.Right,skill);var mSize=msg.getContentSize();msg.setPosition(this.winSize.width,175);for(var i=0;i<this.right_used_skill_message.size();i++){var m=this.right_used_skill_message.at(i),ease=cc.moveBy(.2,cc.p(0,mSize.height)).clone().easing(cc.easeInOut(3));m.runAction(ease)}ease=cc.moveBy(.2,cc.p(-mSize.width,0)).clone().easing(cc.easeInOut(3));msg.runAction(ease),this.right_used_skill_message.push_back(msg),msg.startFadeOut(this.cbSkiiMessage)}},find_func:function(members,pos){for(var i=0,len=members.length;i<len;i++){var m=members[i];if(m.getBattlePosition()==pos)return m}return null},getBattleState:function(){return this.m_battle_scene.getBattleField().getBattleState()},nextStageMoving:function(){this.is_run_stage||(this.is_run_stage=!0,this.run_stage_delta_time=0,this.schedule(this.moving,.05),null!=this.m_timer&&this.m_timer.setPause()),this.hideAllTooltips()},moving:function(dt){if(!this.is_pause_ui){var is_fast_move=3==this.m_game_speed_type,delta_time=is_fast_move?.75:1.5;if(this.is_run_stage){this.run_stage_delta_time+=is_fast_move?dt*BATTLE_TIME_SCALE_2X:this.m_is_2x_time_scale?dt*BATTLE_TIME_SCALE_2X:dt*BATTLE_TIME_SCALE_1X;var cur=50*(this.m_stage_gauge_node.getCurrentStage()-1),per=this.run_stage_delta_time/delta_time*50+cur;this.run_stage_delta_time>delta_time?(this.is_run_stage=!1,null!=this.m_timer&&this.m_timer.setResume(),this.run_stage_delta_time=0,this.m_stage_gauge_node.setStageMove(per,!0),this.unschedule(this.moving),this.hideAllTooltips(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.battle_vs_new_stage)):this.m_stage_gauge_node.setStageMove(per,!1)}}},timerStop:function(){if(null!=this.m_timer){this.m_timer.timerStop(),this.m_game_type==db.BattleGameType.Mission?BattleMissionTaskManager._getInstance().setClearTime(this.m_timer.getTime()):this.m_game_type==db.BattleGameType.StoryHardMode?BattleStoryHardModeMissionTaskManager._getInstance().setClearTime(this.m_timer.getTime()):this.m_game_type==db.BattleGameType.WeeklyDungeon?BattleWeeklyDungeonTaskManager.getInstance().setClearTime(this.m_timer.getTime()):this.m_game_type==db.BattleGameType.EventDungeon?BattleEventDungeonTaskManager.getInstance().setClearTime(this.m_timer.getTime()):this.m_game_type==db.BattleGameType.TowerDungeon&&BattleTowerTaskManager._getInstance().setClearTime(this.m_timer.getTime());for(var left_team=this.m_battle_scene.getBattleField().getLeftTeam(),right_team=this.m_battle_scene.getBattleField().getRightTeam(),general_members=left_team.getTeamMembers(),idx=0;idx<general_members.length;idx++)general_members[idx].set_Start_Skill_DeltaTime(!1);var right_team_members=right_team.getTeamMembers();for(idx=0;idx<right_team_members.length;idx++)right_team_members[idx].set_Start_Skill_DeltaTime(!1)}},IsEventDungeonScriptShow:function(event_dungeon_idx,occured_type){return this.m_is_end_script=2==occured_type,USE_UI_3RD_SCRIPT?this.m_event_dungeon_script_node_v2.loadScript(event_dungeon_idx,occured_type):this.m_event_dungeon_script_node.loadScript(event_dungeon_idx,occured_type)},IsShowScript:function(mission_id,occured_type){return this.m_is_end_script=2==occured_type,USE_UI_3RD_SCRIPT?this.m_script_node_v2.loadScript(mission_id,occured_type):this.m_script_node.loadScript(mission_id,occured_type)},battleContinue:function(){if(this.m_is_reserved_friend=!1,null!=this.m_friend_slot){this.m_friend_slot.setVisible(!0);this.m_battle_scene.getBattleField().getLeftTeam().getTeamMembers();this.m_is_reserved_friend=!0}if(null!=this.m_friend_skill_slot){for(var remove=null,idx=0;idx<this.m_skill_slots.size();idx++)this.m_skill_slots.at(idx)==this.m_friend_skill_slot&&(remove=idx);null!=remove&&(null!=this.m_friend_skill_slot.getParent()&&this.m_friend_skill_slot.removeFromParent(),this.m_skill_slots.erase(remove)),this.m_friend_skill_slot=null}var winSize_Base=ccSize(this.m_base_layer),slot_count=this.m_skill_slots.size(),offset_x=.5*winSize_Base.width-110*slot_count*.5;for(idx=0;idx<this.m_skill_slots.size();idx++){var s=this.m_skill_slots.at(idx);s.getBattlePosition();s.setSlotPosition(cc.p(offset_x,21)),offset_x+=ccWidth(s),s.skillEnable(!0)}this.changeBattleGameSpeed(this.m_game_speed_type)},showScriptLog:function(is_show){USE_UI_3RD_SCRIPT&&(this.m_game_type==db.BattleGameType.Mission?this.m_script_node_v2.showScriptLog(is_show):this.m_game_type==db.BattleGameType.EventDungeon?this.m_event_dungeon_script_node_v2.showScriptLog(is_show):(this.m_game_type,db.BattleGameType.StoryHardMode))}}),BattleBossGaugeNode=cc.Node.extend({m_fill_bar:null,m_gauge_label:null,m_percent_list:[],m_is_gauging:!1,_lifeBarAdjustEnd:null,ctor:function(){this._super(),this.m_percent_list=[],this.init()},onExit:function(){this._super(),this.removeAllChildrenWithCleanup(!0),this.m_fill_bar=null,this.m_gauge_label=null,this.m_percent_list=null,this._lifeBarAdjustEnd=null,delete this.m_fill_bar,delete this.m_gauge_label,delete this.m_percent_list,delete this.m_is_gauging,delete this._lifeBarAdjustEnd},init:function(){var bar_bg=new cc.Sprite(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_gauge_back.png");bar_bg.setAnchorPoint(.5,.5),bar_bg.setPosition(0,0),this.addChild(bar_bg);var bSize=bar_bg.getContentSize();return this.m_fill_bar=new cc.ProgressTimer(new cc.Sprite(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_gauge_red_2.png")),this.m_fill_bar.anchorX=.5,this.m_fill_bar.anchorY=.5,this.m_fill_bar.midPoint=cc.p(0,.5),this.m_fill_bar.barChangeRate=cc.p(1,0),this.m_fill_bar.x=bSize.width/2,this.m_fill_bar.y=bSize.height/2,this.m_fill_bar.type=cc.ProgressTimer.TYPE_BAR,this.m_fill_bar.percentage=100,bar_bg.addChild(this.m_fill_bar),this.m_gauge_label=cmLabel.getLabel("100.0%",LABEL_FONT_INDEX.FONT_201),this.m_gauge_label.setAnchorPoint(.5,.5),this.m_gauge_label.setPosition(bSize.width/2,bSize.height/2),bar_bg.addChild(this.m_gauge_label),!0},setPercentageLife:function(percent,animate){if(animate){if(percent=cc.clampf(percent,0,100),this.m_percent_list.push(percent),!this.m_is_gauging){var from=this.m_fill_bar.getPercentage(),to=this.m_percent_list.shift(),duration=Math.abs(from-to)/300,ease=cc.progressFromTo(duration,from,to).clone().easing(cc.easeExponentialIn()),cb=cc.callFunc(this.cbPercentProgressEnded.bind(this)),seq=cc.sequence(ease,cb);this.m_fill_bar.runAction(seq);var str=percent.toFixed(1)+"%";this.m_gauge_label.setString(str)}}else{this.m_percent_list.length=0;str=(this.m_fill_bar.percentage=percent).toFixed(1)+"%";this.m_gauge_label.setString(str)}},cbPercentProgressEnded:function(){if(this.m_is_gauging=!1,0!=this.m_percent_list.length){var from=this.m_fill_bar.getPercentage(),to=this.m_percent_list.shift(),duration=Math.abs(from-to)/300,ease=cc.progressFromTo(duration,from,to).clone().easing(cc.easeExponentialIn()),cb=cc.callFunc(this.cbPercentProgressEnded.bind(this)),seq=cc.sequence(ease,cb);this.m_fill_bar.runAction(seq),this.m_is_gauging=!0}}}),SCALE_DURATION=.3,MOVE_DURATION=.5,MOVE_DISTANCE=120,BattleDamage=cc.Node.extend({_call_func:null,m_damage_type:null,m_damage_label:null,m_sub_label:null,ctor:function(damage_type){this._super(),this.init(damage_type)},onExit:function(){BATTLE_TO_SHOP||(this._super(),this.removeChild(this.m_damage_label),this.m_damage_label=null,this.removeChild(this.m_sub_label),this.m_sub_label=null,this._call_func=null,this.m_sub_label=null,delete this.m_sub_label,delete this.m_damage_label,delete this._call_func,delete this.m_sub_label)},init:function(damage_type){return this.m_damage_type=damage_type,this.m_damage_type==database.DamageType.Normal?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_damage.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.Bomb_Explosion?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_halloween.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.Bomb_Explosion_Xmas?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_xmas.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.Bomb_Tamatebako_Damage?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_tamatebako.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.Reflect_Damage?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_reflex.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.Counter_Damage?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_counter.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.Critical?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_damage_critical.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.Defence?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_damage.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.Miss?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_damage.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.Dot_Poison?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_poison.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.Dot_Electric?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_shock.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.Dot_Bleeding||this.m_damage_type==database.DamageType.Dot_Burning?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_blood.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.Dot_Freeze?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_freeze.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.Heal?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_cure.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.Reborn_Heal?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_cure.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Fire?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_battletech_1.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Water?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_battletech_2.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Wind?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_battletech_3.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Light?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_battletech_4.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Dark?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_battletech_5.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementAdv_Weak?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_battletech_6.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.SkillCharge_1?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_charge_1.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.SkillCharge_2?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_charge_2.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.SkillCharge_3?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_charge_3.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Fire_SkillCharge_1?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/skill_charge_1_element_1.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Fire_SkillCharge_2?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/skill_charge_2_element_1.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Fire_SkillCharge_3?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/skill_charge_3_element_1.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Water_SkillCharge_1?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/skill_charge_1_element_2.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Water_SkillCharge_2?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/skill_charge_2_element_2.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Water_SkillCharge_3?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/skill_charge_3_element_2.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Wind_SkillCharge_1?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/skill_charge_1_element_3.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Wind_SkillCharge_2?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/skill_charge_2_element_3.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Wind_SkillCharge_3?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/skill_charge_3_element_3.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Light_SkillCharge_1?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/skill_charge_1_element_4.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Light_SkillCharge_2?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/skill_charge_2_element_4.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Light_SkillCharge_3?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/skill_charge_3_element_4.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Dark_SkillCharge_1?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/skill_charge_1_element_5.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Dark_SkillCharge_2?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/skill_charge_2_element_5.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Dark_SkillCharge_3?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/skill_charge_3_element_5.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Weak_SkillCharge_1?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/skill_charge_1_element_6.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Weak_SkillCharge_2?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/skill_charge_2_element_6.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.ElementType_Weak_SkillCharge_3?this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/skill_charge_3_element_6.fnt","",cc.TEXT_ALIGNMENT_CENTER):this.m_damage_type==database.DamageType.Enermy_Max_Life_Damage&&(this.m_damage_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"menu_battle/text/battle_Enermy_Max_Life_Dummy.fnt","",cc.TEXT_ALIGNMENT_CENTER)),this.m_damage_label.setAnchorPoint(.5,.5),this.m_damage_label.setPosition(0,0),this.addChild(this.m_damage_label),this.m_damage_type==database.DamageType.Critical?(this.m_sub_label=new cc.Sprite("#img_critical.png"),this.m_sub_label.setAnchorPoint(.5,.5),this.m_sub_label.setPosition(0,70),this.addChild(this.m_sub_label)):this.m_damage_type==database.DamageType.Defence?(this.m_sub_label=new cc.Sprite("#img_defense.png"),this.m_sub_label.setAnchorPoint(.5,.5),this.m_sub_label.setPosition(0,50),this.addChild(this.m_sub_label)):this.m_damage_type==database.DamageType.Miss?(this.m_sub_label=new cc.Sprite("#img_miss.png"),this.m_sub_label.setAnchorPoint(.5,.5),this.m_sub_label.setPosition(0,0),this.addChild(this.m_sub_label)):this.m_damage_type==database.DamageType.Reborn_Heal?(this.m_sub_label=new cc.Sprite("#img_revival.png"),this.m_sub_label.setAnchorPoint(.5,.5),this.m_sub_label.setPosition(0,50),this.addChild(this.m_sub_label)):this.m_damage_type==database.DamageType.Counter_Damage?(this.m_sub_label=new cc.Sprite("#img_counter.png"),this.m_sub_label.setAnchorPoint(.5,.5),this.m_sub_label.setPosition(0,50),this.addChild(this.m_sub_label)):this.m_damage_type==database.DamageType.Reflect_Damage&&(this.m_sub_label=new cc.Sprite("#img_reflex.png"),this.m_sub_label.setAnchorPoint(.5,.5),this.m_sub_label.setPosition(0,50),this.addChild(this.m_sub_label)),!0},setLabelString:function(text){this.m_damage_label.setString(text)},startFadeOut:function(delay,fadeout){},resetLabel:function(){this.setScale(0),this.m_damage_label.opacity=0,null!=this.m_sub_label&&(this.m_sub_label.opacity=0)},playAnimation:function(){if(this.resetLabel(),this.setVisible(!0),this.m_damage_type==database.DamageType.Defence||this.m_damage_type==database.DamageType.Critical||this.m_damage_type==database.DamageType.Reborn_Heal||this.m_damage_type==database.DamageType.Counter_Damage||this.m_damage_type==database.DamageType.Reflect_Damage){var ease_scale=cc.scaleTo(SCALE_DURATION,1).clone().easing(cc.easeElasticOut()),move=cc.moveBy(MOVE_DURATION,cc.p(0,MOVE_DISTANCE)),cb=cc.callFunc(this.cbPlayAnimationEnd,this),seq=cc.sequence(ease_scale,move,cb);this.runAction(seq),seq=cb=move=null;var fadein=cc.fadeIn(SCALE_DURATION),fadeout=cc.fadeOut(MOVE_DURATION),seq_damage=cc.sequence(fadein,fadeout);if(this.m_damage_label.runAction(seq_damage),seq_damage=fadeout=fadein=null,null!=this.m_sub_label){var fadein_sub=cc.fadeIn(SCALE_DURATION),fadeout_sub=cc.fadeOut(MOVE_DURATION),seq_sub=cc.sequence(fadein_sub,fadeout_sub);this.m_sub_label.runAction(seq_sub),seq_sub=fadeout_sub=fadein_sub=null}}else if(this.m_damage_type==database.DamageType.Miss){ease_scale=cc.scaleTo(SCALE_DURATION,1).clone().easing(cc.easeElasticOut()),move=cc.moveBy(MOVE_DURATION,cc.p(0,MOVE_DISTANCE)),cb=cc.callFunc(this.cbPlayAnimationEnd,this),seq=cc.sequence(ease_scale,move,cb);if(this.runAction(seq),seq=cb=move=null,this.m_damage_label.setString(""),null!=this.m_sub_label){fadein=cc.fadeIn(SCALE_DURATION),fadeout=cc.fadeOut(MOVE_DURATION),seq_damage=cc.sequence(fadein,fadeout);this.m_sub_label.runAction(seq_damage),seq_damage=fadeout=fadein=null}}else if(this.m_damage_type==database.DamageType.Dot_Poison||this.m_damage_type==database.DamageType.Dot_Electric||this.m_damage_type==database.DamageType.Dot_Bleeding||this.m_damage_type==database.DamageType.Dot_Freeze||this.m_damage_type==database.DamageType.Heal||this.m_damage_type==database.DamageType.Dot_Burning){ease_scale=cc.scaleTo(SCALE_DURATION,1).clone().easing(cc.easeElasticOut()),move=cc.moveBy(MOVE_DURATION,cc.p(0,MOVE_DISTANCE)),cb=cc.callFunc(this.cbPlayAnimationEnd),seq=cc.sequence(ease_scale,move,cb);this.runAction(seq),seq=cb=move=null;fadein=cc.fadeIn(SCALE_DURATION),fadeout=cc.fadeOut(MOVE_DURATION),seq_damage=cc.sequence(fadein,fadeout);this.m_damage_label.runAction(seq_damage),seq_damage=fadeout=fadein=null}else{ease_scale=cc.scaleTo(SCALE_DURATION,1).clone().easing(cc.easeElasticOut()),move=cc.moveBy(MOVE_DURATION,cc.p(0,MOVE_DISTANCE)),cb=cc.callFunc(this.cbPlayAnimationEnd),seq=cc.sequence(ease_scale,move,cb);this.runAction(seq),seq=cb=move=null;fadein=cc.fadeIn(.3),fadeout=cc.fadeOut(.5),seq_damage=cc.sequence(fadein,fadeout);this.m_damage_label.runAction(seq_damage),seq_damage=fadeout=fadein=null}},cbPlayAnimationEnd:function(){null!=this._call_func&&this._call_func.cbDamageShowEnded(this)}}),BattleDurabilityThumb=cc.Node.extend({m_thumb_icon:null,m_effect:null,ctor:function(){this._super(),this.init()},onExit:function(){BATTLE_TO_SHOP||(this._super(),this.removeChild(this.m_thumb_icon),this.removeAllChildrenWithCleanup(!0),this.m_thumb_icon=null,this.m_effect=null,delete this.m_effect)},init:function(){return this.initLayout(),!0},initLayout:function(){if(this.setAnchorPoint(0,0),this.setPosition(0,0),USE_ACTIVE_PASSIVE_ICON)this.m_thumb_icon=new cc.Sprite(RES_CDN_DEFULT+"icon/active/active_10001.png"),this.m_thumb_icon.setAnchorPoint(0,0),this.m_thumb_icon.setPosition(0,0),this.m_thumb_icon.setScale(.4),this.addChild(this.m_thumb_icon),this.setContentSize(24,24);else{this.m_thumb_icon=new cc.Sprite("#active_10001.png"),this.m_thumb_icon.setAnchorPoint(0,0),this.m_thumb_icon.setPosition(0,0),this.m_thumb_icon.setScale(.4),this.addChild(this.m_thumb_icon);var s=this.m_thumb_icon.getContentSize();this.setContentSize(.4*s.width,.4*s.height),s=null}},setBattleDurabilityEffect:function(effect){this.m_effect=effect,this.updateLayout()},updateLayout:function(){if(null!=this.m_effect&&null!=this.m_effect&&""!=this.m_effect.icon_name&&"0"!=this.m_effect.icon_name&&null!=this.m_effect.icon_name){if(cc.log("this.m_effect.icon_name : "+this.m_effect.icon_name),this.m_effect.icon_name.includes("trans_")){var icon_name=this.m_effect.icon_name.replace("trans_","");if(USE_ACTIVE_PASSIVE_ICON)this.m_thumb_icon.setTexture(RES_CDN_DEFULT+"icon/passive/"+icon_name);else{var frame=cc.spriteFrameCache.getSpriteFrame(icon_name);this.m_thumb_icon.setSpriteFrame(frame)}}else if(USE_ACTIVE_PASSIVE_ICON)this.m_effect.icon_name.includes("passive_")?this.m_thumb_icon.setTexture(RES_CDN_DEFULT+"icon/passive/"+this.m_effect.icon_name):this.m_thumb_icon.setTexture(RES_CDN_DEFULT+"icon/active/"+this.m_effect.icon_name);else{frame=cc.spriteFrameCache.getSpriteFrame(this.m_effect.icon_name);this.m_thumb_icon.setSpriteFrame(frame)}frame=null}},getBattleDurabilityEffect:function(){try{return this.m_effect}catch(e){cc.log("getBattleDurabilityEffect : "+e)}}}),BattleGeneralInfoBar=cc.Node.extend({m_fill_bar:null,m_middle_bar:null,_lifeBarAdjustEnd:null,m_element_type:null,m_general:null,m_percent_list:null,m_buff_list:null,m_buff_used:null,m_buff_recycled:null,fill_bar_name:null,m_is_left_team:!1,m_is_gauging:!1,ctor:function(){this._super(),this.m_buff_list=new Array,this.m_buff_used=new Array,this.m_buff_recycled=new Array,this.m_percent_list=new Array},onExit:function(){BATTLE_TO_SHOP||(this._super(),this.removeAllChildrenWithCleanup(!0),this.m_fill_bar=null,this.m_middle_bar=null,this._lifeBarAdjustEnd=null,this.m_element_type=null,this.m_general=null,this.m_percent_list=null,this.m_buff_list=null,this.m_buff_used=null,this.m_buff_recycled=null,this.fill_bar_name=null,delete this.m_fill_bar,delete this.m_middle_bar,delete this._lifeBarAdjustEnd,delete this.m_element_type,delete this.m_general,delete this.m_percent_list,delete this.m_buff_list,delete this.m_buff_used,delete this.m_buff_recycled,delete this.fill_bar_name,delete this.m_is_left_team,delete this.m_is_gauging)},create:function(gnrl,is_left_team){var node=new BattleGeneralInfoBar;return null!=node&&node.init(gnrl,is_left_team)?node:node=null},init:function(gnrl,is_left_team){return this.m_general=gnrl,this.m_is_left_team=is_left_team,this.initLayout(),!0},initLayout:function(){this.m_general.getGeneral();var bar_bg=new cc.Sprite("#img_battle_gauge.png");bar_bg.setAnchorPoint(.5,.5),bar_bg.setPosition(0,0),this.addChild(bar_bg);var bSize=bar_bg.getContentSize();this.m_middle_bar=new cc.ProgressTimer(new cc.Sprite("#img_battle_gauge_normal.png")),this.m_middle_bar.anchorX=1,this.m_middle_bar.anchorY=.5,this.m_middle_bar.midPoint=cc.p(0,.5),this.m_middle_bar.barChangeRate=cc.p(1,0),this.m_middle_bar.x=bSize.width-3,this.m_middle_bar.y=.5*bSize.height,this.m_middle_bar.type=cc.ProgressTimer.TYPE_BAR,this.m_middle_bar.percentage=100,bar_bg.addChild(this.m_middle_bar),this.m_is_left_team?this.fill_bar_name="#img_battle_gauge_me.png":this.fill_bar_name="#img_battle_gauge_you.png",this.m_fill_bar=new cc.ProgressTimer(new cc.Sprite(this.fill_bar_name)),this.m_fill_bar.anchorX=1,this.m_fill_bar.anchorY=.5,this.m_fill_bar.midPoint=cc.p(0,.5),this.m_fill_bar.barChangeRate=cc.p(1,0),this.m_fill_bar.x=bSize.width-3,this.m_fill_bar.y=.5*bSize.height,this.m_fill_bar.type=cc.ProgressTimer.TYPE_BAR,this.m_fill_bar.percentage=100,bar_bg.addChild(this.m_fill_bar),this.m_element_type=new cc.Sprite("#img_battletech_"+this.m_general.getGeneral().general.element_type+".png"),this.m_element_type.setAnchorPoint(.5,.5),this.m_element_type.setPosition(-39,0),this.addChild(this.m_element_type)},setPercentageLife:function(percent,animate){if(animate){if(percent=cc.clampf(percent,0,100),this.m_percent_list.push_back(percent),!this.m_is_gauging){var from=this.m_fill_bar.getPercentage(),to=this.m_percent_list.pop_front(),duration=Math.abs(from-to)/300,ease=cc.progressFromTo(duration,from,to).clone().easing(cc.easeExponentialIn()),cb=cc.callFunc(this.cbPercentProgressEnded,this),seq=cc.sequence(ease,cb);this.m_fill_bar.runAction(seq)}}else this.m_percent_list.clear(),this.m_fill_bar.percentage=percent,this.m_middle_bar.setPercentage(percent)},cbPercentProgressEnded:function(){if(this.m_is_gauging=!1,this.m_percent_list.empty()){from=this.m_middle_bar.getPercentage(),to=this.m_fill_bar.getPercentage(),duration=Math.abs(from-to)/300,ease=cc.progressFromTo(duration,from,to).clone().easing(cc.easeExponentialIn()),cb=cc.callFunc(this.cbAdjustProgressEnded.bind(this)),seq=cc.sequence(ease,cb);this.m_middle_bar.runAction(seq)}else{var from=this.m_fill_bar.getPercentage(),to=this.m_percent_list.pop_front(),duration=Math.abs(from-to)/300,ease=cc.progressFromTo(duration,from,to).clone().easing(cc.easeExponentialIn()),cb=cc.callFunc(this.cbPercentProgressEnded.bind(this)),seq=cc.sequence(ease,cb);this.m_fill_bar.runAction(seq),this.m_is_gauging=!0}},cbAdjustProgressEnded:function(){null!=this._lifeBarAdjustEnd&&this._lifeBarAdjustEnd.lifeBarAdjustEnd(null)},addDurabilityEffect:function(eff){if(this.m_buff_list.push_back(eff),""!=eff.icon_name&&"0"!=eff.icon_name){for(var Create_Icon=!0,idx=0;idx<this.m_buff_used.length;idx++){var buff;(buff=$.extend({},this.m_buff_used[idx])).m_effect.icon_name==eff.icon_name&&(Create_Icon=!1)}if(1==Create_Icon)(buff=this.recycledDurabilityEffect(eff)).setBattleDurabilityEffect(eff),this.m_buff_used.push_back(buff);this.updateIcons()}},removeDurabilityEffect:function(eff){for(var Cnt=0,idx=0;idx<this.m_buff_list.length;idx++){var buff=$.extend({},this.m_buff_list[idx]);eff.icon_name==buff.icon_name&&++Cnt}for(var found_eff=0,found_eff_is=!1,i=0;i<this.m_buff_list.size();i++){var e=this.m_buff_list.at(i);if(found_eff=i,eff.gnrl_id==e.gnrl_id&&eff.effect_id==e.effect_id){found_eff_is=!0;break}}1==found_eff_is&&this.m_buff_list.erase(found_eff);var found_thumb=0,found_thumb_is=!1;for(i=0;i<this.m_buff_used.size();i++){var node=this.m_buff_used.at(i);if(found_thumb=i,eff.gnrl_id==node.getBattleDurabilityEffect().gnrl_id&&eff.icon_name==node.getBattleDurabilityEffect().icon_name){found_thumb_is=!0;break}}if(1==found_thumb_is&&1==Cnt){var thumb=this.m_buff_used.at(found_thumb);thumb.setVisible(!1),this.m_buff_used.erase(found_thumb),this.m_buff_recycled.push_back(thumb)}this.updateIcons()},updateIcons:function(){for(var i=0;i<this.m_buff_used.size();i++){var col=i%4,row=Math.floor(i/4),thumb=this.m_buff_used.at(i),offset_x=(thumb.getContentSize().width+2)*col-20,offset_y=(thumb.getContentSize().height+2)*row+10;thumb.setPosition(offset_x,offset_y)}},recycledDurabilityEffect:function(eff){var buff;return this.m_buff_recycled.empty()?((buff=new BattleDurabilityThumb).setVisible(!0),this.addChild(buff)):(buff=this.m_buff_recycled.pop_back()).setVisible(!0),buff}}),BattleDropItem=cc.Node.extend({m_callback:null,m_target_pos:cc.p(0,0),m_box:null,m_is_flying:!1,m_is_cutin:!1,ctor:function(target_pos,func){this._super(),this.init(target_pos,func)},onExit:function(){BATTLE_TO_SHOP||(this._super(),this.removeChild(this.m_box),this.m_callback=null,this.m_target_pos=null,this.m_box=null,delete this.m_is_flying,delete this.m_is_cutin)},init:function(target_pos,func,is_cutin){return this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(0,0),this.setContentSize(0,0),this.m_target_pos=target_pos,this.m_callback=func,this.m_is_cutin=is_cutin,this.m_is_cutin?this.m_box=new cc.Sprite("#img_treasure2.png"):this.m_box=new cc.Sprite("#img_treasure.png"),this.addChild(this.m_box),!0},takeUp:function(){this.m_is_flying||(this.stopAllActions(),this.flyingItem())},dropItem:function(){if(this.m_is_cutin){(cur_pos=this.getPosition()).x=.5*winSize.width,cur_pos.y=.5*winSize.height;var height=200,jump=cc.jumpTo(.7,cur_pos,height,1),delay=cc.delayTime(2.2),cb=cc.callFunc(this.cbDropItem,this),seq=cc.sequence(jump,delay,cb);this.runAction(seq),seq=cb=delay=jump=cur_pos=null}else{var cur_pos=this.getPosition(),rand=parseInt(300*Math.random()-150),drop_pos=cc.p(rand,0);if(cur_pos.x=cur_pos.x+drop_pos.x,cur_pos.y=cur_pos.y+drop_pos.y,cur_pos.x>winSize.width){var x=cur_pos.x-winSize.width;cur_pos.x=winSize.width-x}height=parseInt(50*Math.random()+50),jump=cc.jumpTo(.3,cur_pos,height,1),cb=cc.callFunc(this.cbDropItem,this),seq=cc.sequence(jump,cb);this.runAction(seq),seq=cb=jump=drop_pos=rand=cur_pos=null}},cbDropItem:function(){var delay=cc.delayTime(.5),cb=cc.callFunc(this.flyingItem,this),seq=cc.sequence(delay,cb);this.runAction(seq),seq=cb=delay=null},flyingItem:function(){var moveup=cc.moveBy(.1,cc.p(0,20)),scaleup=cc.scaleTo(.1,1.3),spawn1=cc.spawn(moveup,scaleup),delay=cc.delayTime(.3),fadeout=cc.fadeOut(.3),scaledown=cc.scaleTo(.3,.3),spawn2=cc.spawn(fadeout,scaledown),seq=cc.sequence(spawn1,delay,spawn2);this.m_box.runAction(seq),seq=spawn2=scaledown=fadeout=delay=spawn1=scaleup=moveup=null;delay=cc.delayTime(.4);var move=cc.moveTo(.3,this.m_target_pos),ease=move.clone().easing(cc.easeExponentialInOut()),cb=cc.callFunc(this.cbFlyingItemEnded,this);seq=cc.sequence(delay,ease,cb);this.runAction(seq),seq=cb=ease=move=delay=null,this.m_is_flying=!0},cbFlyingItemEnded:function(){this.m_is_flying=!1,null!=this.m_callback&&this.m_callback(this)}}),BattleFriendSlot=cc.Layer.extend({_insertFriendGeneral:null,m_general:null,m_origin_pos:cc.p(0,0),m_friend_icon:null,tooltip_box:null,tooltip_content:null,tooltip_title:null,is_pressed:!1,is_long_pressed:!1,m_is_enable_tooltip:!1,ctor:function(gnrl){this._super(),this.init(gnrl)},init:function(gnrl){return this.m_general=gnrl,this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(1,0),this.initLayout(),!0},onExit:function(){BATTLE_TO_SHOP||(this._super(),1==BATTLE_SCENE_MEMORY_CLEAR&&(this.removeAllChildren(),this.removeAllChildrenWithCleanup(!0),this._insertFriendGeneral=null,this.m_general=null,this.m_origin_pos=null,this.m_friend_icon=null,this.tooltip_box=null,this.tooltip_content=null,this.tooltip_title=null,delete this._insertFriendGeneral,delete this.m_general,delete this.m_origin_pos,delete this.m_friend_icon,delete this.tooltip_box,delete this.tooltip_content,delete this.tooltip_title,delete this.is_pressed,delete this.is_long_pressed,delete this.m_is_enable_tooltip))},initLayout:function(){var g=this.m_general.getGeneral(),bgSize=cc.size(110,110);this.setContentSize(bgSize);var bg_frame=new cc.Sprite(RES_CDN_CARD_CARD_IMG_NTP+"img_card_frame_"+g.general.element_type+"_"+g.general.rare_type+".png");DISABLE_SPB_TP&&bg_frame.setContentSize(98,98),bg_frame.setAnchorPoint(.5,.5),bg_frame.setPosition(bgSize.width/2,bgSize.height/2),this.addChild(bg_frame,10),this.m_friend_icon=new cc.Sprite(RES_CDN_CARD_MEDIUM_NTP+"m_"+g.general.gnrl_id+".png"),IS_SP_BROWSER&&(DISABLE_SPB_TP&&this.m_friend_icon.setContentSize(48,48),this.m_friend_icon.setScale(2)),this.m_friend_icon.setAnchorPoint(.5,.5),this.m_friend_icon.setPosition(bgSize.width/2,bgSize.height/2),this.addChild(this.m_friend_icon,0);var force_type=new cc.Sprite(RES_CDN_CARD_CARD_IMG_NTP+"img_card_arm_service_"+g.general.element_type+"_"+g.general.arm_service_type+".png");if(DISABLE_SPB_TP&&force_type.setContentSize(38,37),force_type.setAnchorPoint(0,1),force_type.setPosition(cc.p(0,98)),bg_frame.addChild(force_type),1<g.general.gnrl_class){var rare_type=g.general.rare_type;2==rare_type?rare_type=1:4==rare_type&&(rare_type=3);var star_unique=new cc.Sprite(RES_CDN_CARD_CARD_IMG_NTP+"img_card_unique_"+rare_type+"_"+g.general.gnrl_class+".png");DISABLE_SPB_TP&&star_unique.setContentSize(28,16),star_unique.setAnchorPoint(1,0),star_unique.setPosition(98,28),bg_frame.addChild(star_unique)}if(0!=g.limit_step_id){var limit_img=new cc.Sprite(RES_CDN_CARD_CARD_IMG_NTP+"img_card_limit_"+g.limit_step_id+".png");DISABLE_SPB_TP&&limit_img.setContentSize(19,21),limit_img.setAnchorPoint(0,0),limit_img.setPosition(1,0),bg_frame.addChild(limit_img)}var gj_icon=new cc.Sprite("#img_gj_text.png");if(gj_icon.setAnchorPoint(.5,.5),gj_icon.setPosition(49,0),bg_frame.addChild(gj_icon),99999!=g.general.active_skill_id&&0!=g.general.active_skill_id){this.tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.tooltip_box.anchorX=.5,this.tooltip_box.anchorY=0,this.tooltip_box.setPosition(-30,bgSize.height+10),this.tooltip_box.setVisible(!1),this.addChild(this.tooltip_box,20);var title=g.general.name+"のスキル";this.tooltip_title=cmLabel.getLabel(title,LABEL_FONT_INDEX.FONT_1810),this.tooltip_title.setAnchorPoint(0,1),this.tooltip_box.addChild(this.tooltip_title);var active=MasterManager.getInstance().get_ActiveSkill(g.general.active_skill_id);this.tooltip_content=cmLabel.getLabel(active.content,LABEL_FONT_INDEX.FONT_181),this.tooltip_content.setAnchorPoint(0,1),this.tooltip_content.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.tooltip_content.setTextAreaSize(cc.size(250,0)),this.tooltip_content.ignoreContentAdaptWithSize(!1),this.tooltip_box.addChild(this.tooltip_content);var tSize=this.tooltip_title.getContentSize(),cSize=this.tooltip_content.getContentSize(),t_width=cSize.width+40,t_height=cSize.height+35+tSize.height;this.tooltip_box.setPreferredSize(cc.size(t_width,t_height)),this.tooltip_title.setPosition(cc.p(15,this.tooltip_box.getContentSize().height-15)),this.tooltip_content.setPosition(cc.p(15,this.tooltip_box.getContentSize().height-20-tSize.height)),this.m_is_enable_tooltip=!0}else this.m_is_enable_tooltip=!1;var touch_btn=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(1,1,1,1)));touch_btn.anchorX=.5,touch_btn.anchorY=.5,touch_btn.x=bgSize.width/2,touch_btn.y=bgSize.height/2;var t_touch_btn_size=cc.size(110,110);touch_btn.setPreferredSize(t_touch_btn_size),this.addChild(touch_btn),touch_btn.addTargetWithActionForControlEvents(this,this.onTouchSlot,cc.CONTROL_EVENT_TOUCH_DOWN),touch_btn.addTargetWithActionForControlEvents(this,this.onTouchSlot,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),touch_btn.addTargetWithActionForControlEvents(this,this.onTouchSlot,cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE),touch_btn.addTargetWithActionForControlEvents(this,this.onTouchSlot,cc.CONTROL_EVENT_TOUCH_CANCEL)},setSlotPosition:function(pos){this.setPosition(pos),this.m_origin_pos=pos},onTouchSlot:function(sender,_event){if(this.isVisible()&&this.m_is_enable_tooltip)if(_event==cc.CONTROL_EVENT_TOUCH_DOWN){this.is_pressed=!0;var delay=cc.delayTime(.3),cb=cc.callFunc(this.cbLongPress,this),seq=cc.sequence(delay,cb);this.tooltip_box.runAction(seq)}else if(_event==cc.CONTROL_EVENT_TOUCH_CANCEL||_event==cc.CONTROL_EVENT_TOUCH_UP_INSIDE||_event==cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE){if(AudioEngine.getInstance().playNormaButtonSound(),this.is_long_pressed)return this.is_long_pressed=!1,this.is_pressed=!1,void this.showTooltip(!1);null!=this._insertFriendGeneral&&this._insertFriendGeneral.insertFriendGeneral_V2(this),this.is_long_pressed=!1,this.is_pressed=!1,this.showTooltip(!1)}else _event==cc.CONTROL_EVENT_TOUCH_DRAG_ENTER&&this.IsShowTooltip()&&this.showTooltip(!1)},IsShowTooltip:function(){return!!this.m_is_enable_tooltip&&this.tooltip_box.isVisible()},showTooltip:function(isShow){if(this.m_is_enable_tooltip&&isShow){var anchor=this.tooltip_box.getAnchorPoint();if(1==anchor.x&&0==anchor.y){var pos=this.absolutePosition(this.tooltip_box),size=ccSize(this.tooltip_box);if(pos.x+size.width>winSize.width){var bg_size=ccSize(this.m_friend_icon);this.tooltip_box.anchorX=1,this.tooltip_box.anchorY=0,this.tooltip_box.x=bg_size.width}}}this.tooltip_box.setVisible(isShow)},absolutePosition:function(target){for(var ret=target.getPosition(),cn=target;null!=cn.getParent()&&!(cn=cn.getParent()).getContentSize().equals(winSize);)ret+=cn.getPosition();return ret},cbLongPress:function(){this.is_pressed&&(this.is_long_pressed=!0,this.showTooltip(!0))},hideTooltip:function(){this.is_pressed=!1,this.is_long_pressed=!1,this.showTooltip(!1)}}),BattleVSLayer_Layer=cc.Layer.extend({init:function(){return this._super(),!0}}),BattleVSLayer=cc.Layer.extend({m_label_bg:null,m_label:null,m_move_node:null,battleObserver:null,ctor:function(){this._super(),this.battleObserver=MainObserver.getInstance(),this.initLayout()},onExit:function(){BATTLE_TO_SHOP||(this._super(),this.removeAllChildrenWithCleanup(!0),this.m_label_bg=null,this.m_label=null,this.m_move_node=null,this.battleObserver=null,delete this.m_label_bg,delete this.m_label,delete this.m_move_node,delete this.battleObserver)},initLayout:function(){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(.5,.5);var size=this.getContentSize();this.m_label_bg=new cc.Sprite("#img_battle_bar.png"),this.m_label_bg.setAnchorPoint(.5,.5),this.m_label_bg.setPosition(cc.p(-460,.5*size.height)),this.addChild(this.m_label_bg),this.m_move_node=new BattleVSLayer_Layer,this.m_move_node.ignoreAnchorPointForPosition(!1),this.m_move_node.setAnchorPoint(0,.5),this.m_move_node.setContentSize(cc.size(0,0)),this.m_move_node.setPosition(cc.p(size.width,.5*size.height)),this.addChild(this.m_move_node);var offset_x=0;this.m_label=new cc.Sprite("#img_act_title_large_1.png"),this.m_label.setAnchorPoint(0,.5),this.m_label.setPosition(cc.p(offset_x,0)),this.m_move_node.addChild(this.m_label),offset_x+=this.m_label.getContentSize().width,this.m_move_node.setContentSize(cc.size(offset_x,0))},setStageNum:function(stage_num){if(0<stage_num){var snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_battle_start.mp3";AudioEngine.getInstance().playEffect(snd);var frame=cc.spriteFrameCache.getSpriteFrame("img_act_title_large_"+stage_num+".png");this.m_label.setPositionX(0),this.m_label.setSpriteFrame(frame),this.m_move_node.setContentSize(cc.size(this.m_label.getContentSize().width,0))}},startAnimation:function(){this.lazyInitialize();var size=this.getContentSize(),time_scale=3==GameDefault.getInstance().getUserBattleGameSpeed()?.5:1,m1=cc.p(.5*size.width,this.m_label_bg.getPositionY()),ease01=cc.moveTo(.3*time_scale,m1).clone().easing(cc.easeExponentialInOut()),fadein=cc.fadeIn(.3*time_scale),spawn01=cc.spawn(ease01,fadein),delay=cc.delayTime(1.5*time_scale),m2=cc.p(size.width+.5*this.m_label_bg.getContentSize().width,this.m_label_bg.getPositionY()),ease02=cc.moveTo(.3*time_scale,m2).clone().easing(cc.easeExponentialInOut()),ease_fade=cc.fadeOut(.3*time_scale).clone().easing(cc.easeExponentialIn()),spawn02=cc.spawn(ease02,ease_fade),cb=cc.callFunc(this.cbStartAnimationEnded,this),seq=cc.sequence(spawn01,delay,spawn02,cb);this.m_label_bg.runAction(seq),this.m_move_node.setPositionX(size.width);m1=cc.p(.5*(size.width-this.m_move_node.getContentSize().width),this.m_move_node.getPositionY()),ease01=cc.moveTo(.3*time_scale,m1).clone().easing(cc.easeExponentialInOut()),delay=cc.delayTime(1.5*time_scale),m2=cc.p(-this.m_move_node.getContentSize().width,this.m_move_node.getPositionY()),ease02=cc.moveTo(.3*time_scale,m2).clone().easing(cc.easeExponentialInOut()),seq=cc.sequence(ease01,delay,ease02);this.m_move_node.runAction(seq);fadein=cc.fadeIn(.3*time_scale),delay=cc.delayTime(1.5*time_scale),ease_fade=cc.fadeOut(.3*time_scale).clone().easing(cc.easeExponentialIn()),seq=cc.sequence(fadein,delay,ease_fade);this.m_label.runAction(seq);var path=RES_CDN_SOUND+SND_TYPE+"sound/battle_vs.mp3";AudioEngine.getInstance().playEffect(path);var schedule_time=1.8*time_scale;this.scheduleOnce(function(){var snd=RES_CDN_SOUND+SND_TYPE+"sound/battle_vs2.mp3";AudioEngine.getInstance().playEffect(snd)},schedule_time*time_scale,"battle_vs")},cbStartAnimationEnded:function(){this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.battle_vs_hide)},lazyInitialize:function(){var size=this.getContentSize();this.m_label_bg.setPosition(cc.p(.5*-this.m_label_bg.getContentSize().width,.5*size.height)),this.m_label_bg.setOpacity(0),this.m_move_node.setPositionX(size.width),null!=this.m_label&&this.m_label.setOpacity(0)}}),BattleStageGaugeNode=cc.Layer.extend({m_bar:null,m_knob:null,m_current_stage:1,ctor:function(){this._super(),this.init()},onExit:function(){BATTLE_TO_SHOP||(this._super(),this.removeChild(this.m_bar),this.removeChild(this.m_knob),this.removeAllChildrenWithCleanup(!0),this.m_bar=null,this.m_knob=null,delete this.m_bar,delete this.m_knob,delete this.m_current_stage)},init:function(){return this.m_current_stage=1,this.initLayout(),!0},initLayout:function(){this.ignoreAnchorPointForPosition(!1),this.setContentSize(0,0);var bar_bg=new cc.Sprite("#img_progress_gauge.png");bar_bg.setAnchorPoint(.5,.5),bar_bg.setPosition(0,0),this.addChild(bar_bg),this.m_bar=new cc.ProgressTimer(new cc.Sprite("#img_progress_gauge_yellow.png")),this.m_bar.anchorX=.5,this.m_bar.anchorY=.5,this.m_bar.x=0,this.m_bar.y=0,this.m_bar.midPoint=cc.p(0,.5),this.m_bar.barChangeRate=cc.p(1,0),this.m_bar.type=cc.ProgressTimer.TYPE_BAR,this.m_bar.percentage=0,this.addChild(this.m_bar);var mask=new cc.Sprite("#img_progress_text.png");mask.setAnchorPoint(.5,.5),mask.setPosition(0,0),this.addChild(mask),this.m_knob=new cc.Sprite("#img_progress_yh.png"),this.m_knob.setAnchorPoint(.5,.5),this.m_knob.setPosition(cc.p(.5*-bar_bg.getContentSize().width,0)),this.addChild(this.m_knob)},setStageMove:function(percent,isEnd){var per=cc.clampf(percent,0,100);if(this.m_current_stage<3){this.m_bar.percentage=per;var size=this.m_bar.getContentSize();this.m_knob.setPositionX(-.5*size.width+size.width*per/100),isEnd&&this.m_current_stage++}},getCurrentStage:function(){return this.m_current_stage}}),BattleEventDungeonScriptLayer_SubLayer=cc.Layer.extend({init:function(){return this._super(),!0}}),BattleEventDungeonScriptLayerV2=cc.Layer.extend({_scriptViewComplete:null,m_label:null,m_script_list:null,m_script_index:0,m_bg_frame:null,m_name_label:null,m_finger:null,m_left_hero:null,m_middle_hero:null,m_right_hero:null,m_left_emotion:null,m_middle_emotion:null,m_right_emotion:null,m_user_info:null,m_script_bg:null,m_script_cover:null,m_attack_cover:null,m_cliper:null,m_stencil_node:null,m_is_complete:!1,m_is_doing_transition_scene:!1,m_is_doing_attack_scene:!1,m_hero_left_script:null,m_hero_middle_script:null,m_hero_right_script:null,m_hero_left_script_texture:null,m_hero_middle_script_texture:null,m_hero_right_script_texture:null,m_use_Add_Scale:1,m_script_type:SCRIPT_TYPE.EVENT,m_script_delta_time:0,m_touch_delay_time:0,m_log_box:null,m_show_btn:null,m_auto_forward_btns:[],m_front_particle:null,m_back_particle:null,m_script_Index_label:null,m_bg_script_name:null,ctor:function(user_info){this._super();cc.director.getWinSize();this.m_script_list=[],this.m_auto_forward_btns=[],this.m_script_type=SCRIPT_TYPE.EVENT,USE_SP_CARD_SCRIPT_BODY_SCALE?this.m_use_Add_Scale=2:this.m_use_Add_Scale=1,this.init(user_info)},onExit:function(){BATTLE_TO_SHOP||(this._super(),this.removeAllChildrenWithCleanup(!0),this._scriptViewComplete=null,this.m_label=null,this.m_script_list=null,this.m_bg_frame=null,this.m_name_label=null,this.m_finger=null,this.m_left_hero=null,this.m_middle_hero=null,this.m_right_hero=null,this.m_left_emotion=null,this.m_middle_emotion=null,this.m_right_emotion=null,this.m_user_info=null,this.m_script_bg=null,this.m_script_cover=null,this.m_attack_cover=null,this.m_cliper=null,this.m_stencil_node=null,this.battleObserver=null,this.m_hero_left_script=null,this.m_hero_middle_script=null,this.m_hero_right_script=null,this.m_hero_left_script_texture=null,this.m_hero_middle_script_texture=null,this.m_hero_right_script_texture=null,this.m_script_type=null,this.m_log_box=null,this.m_show_btn=null,this.m_auto_forward_btns=null,this.m_front_particle=null,this.m_back_particle=null,this.m_script_Index_label=null,this.m_bg_script_name=null)},init:function(user_info){BattleAni._getInstance().Is_loaded()||BattleAni._getInstance().loadAnimate(),this.m_user_info=user_info,this.ignoreAnchorPointForPosition(!1),this.setContentSize(winSize),this.setAnchorPoint(0,0),this.setPosition(0,0),this.m_script_bg=new cc.Sprite(RES_CDN_DEFULT+"card_script_bg/116.jpg"),USE_SP_SCRIPT_BG_SCALE&&this.m_script_bg.setScale(2),this.m_script_bg.setAnchorPoint(.5,.5),this.m_script_bg.setPosition(winSize.width/2,winSize.height/2),this.addChild(this.m_script_bg),this.m_left_hero=new cc.Sprite,this.m_left_hero.setAnchorPoint(.5,0),this.m_left_hero.setPosition(.5*ccWidth(this.m_left_hero)*(1.4*this.m_use_Add_Scale),0),this.m_left_hero.setScale(1.4*this.m_use_Add_Scale),this.addChild(this.m_left_hero);var l_size=ccSize(this.m_left_hero);this.m_left_emotion=new cc.Sprite,this.m_left_emotion.setAnchorPoint(.5,.5),this.m_left_emotion.setPosition(.5*l_size.width,l_size.height-70),this.m_left_hero.addChild(this.m_left_emotion,-1),this.m_middle_hero=new cc.Sprite,this.m_middle_hero.setAnchorPoint(.5,0),this.m_middle_hero.setPosition(.5*winSize.width,0),this.m_middle_hero.setScale(1.4*this.m_use_Add_Scale),this.addChild(this.m_middle_hero);var m_size=ccSize(this.m_middle_hero);this.m_middle_emotion=new cc.Sprite,this.m_middle_emotion.setAnchorPoint(.5,.5),this.m_middle_emotion.setPosition(.5*m_size.width,m_size.height-70),this.m_middle_hero.addChild(this.m_middle_emotion,-1),this.m_right_hero=new cc.Sprite,this.m_right_hero.setAnchorPoint(.5,0),this.m_right_hero.setPosition(winSize.width-.5*ccWidth(this.m_right_hero)*(1.4*this.m_use_Add_Scale),0),this.m_right_hero.setScale(1.4*this.m_use_Add_Scale),this.addChild(this.m_right_hero);var r_size=ccSize(this.m_right_hero);this.m_right_emotion=new cc.Sprite,this.m_right_emotion.setAnchorPoint(.5,.5),this.m_right_emotion.setPosition(.5*r_size.width,r_size.height-70),this.m_right_hero.addChild(this.m_right_emotion,-1);var boxSize=cc.size(winSize.width,212);this.m_bg_frame=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_script.png",cc.Rect(40,40,44,40)),this.m_bg_frame.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bg_frame.setPreferredSize(boxSize),this.m_bg_frame.setPosition(.5*winSize.width,0),this.addChild(this.m_bg_frame),this.m_bg_script_name=new cc.Node,this.m_bg_script_name.setAnchorPoint(ZERO()),this.m_bg_script_name.setPosition(77,154),this.m_bg_script_name.setVisible(!1),this.m_bg_frame.addChild(this.m_bg_script_name);var ic_mark=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_txtmark.png");if(ic_mark.setAnchorPoint(ZERO()),ic_mark.setPosition(0,4),this.m_bg_script_name.addChild(ic_mark),this.m_name_label=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_2871,!1,!0,2,cc.color(0,0,0)),this.m_name_label.setAnchorPoint(ZERO()),this.m_name_label.setPosition(ccWidth(ic_mark)+7,-9),this.m_bg_script_name.addChild(this.m_name_label),this.m_finger=new cc.Sprite,IS_SP_BROWSER?(this.m_finger.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_finger.setPosition(boxSize.width-7,7)):(this.m_finger.setAnchorPoint(ANCHOR_MIDDLE()),this.m_finger.setPosition(boxSize.width-58,55)),this.m_bg_frame.addChild(this.m_finger),NOT_USE_SP_BATTLE_ANIMATION){this.m_finger.setScale(2),this.m_finger.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/img_script_dialog_01.png");var scaleTo_1=new cc.ScaleTo(.2,2.03,2.03),scaleTo_2=new cc.ScaleTo(.2,1.97,1.97),sequence=new cc.Sequence(scaleTo_1,scaleTo_2);repeat=new cc.RepeatForever(sequence);this.m_finger.runAction(repeat),repeat=sequence=scaleTo_2=scaleTo_1=null}else{var animate=BattleAni._getInstance().getAnimate(BattleAni_.EffectFinger),repeat=animate.repeatForever();this.m_finger.runAction(repeat),repeat=animate=null}this.m_label=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_2471,!1,!0,2,cc.color(0,0,0)),this.m_label.setAnchorPoint(0,1),this.m_label.setPosition(98,this.m_bg_frame.getContentSize().height-72),this.m_label.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_label.setTextHorizontalAlignment(cc.TEXT_ALIGNMENT_LEFT),this.m_bg_frame.addChild(this.m_label);var touch_button_sc9=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.rect(1,0,1,0)),touch_button=new cc.ControlButton(touch_button_sc9);touch_button.setAnchorPoint(0,0),touch_button.setPreferredSize(winSize),touch_button.setPosition(0,0),this.addChild(touch_button),touch_button.addTargetWithActionForControlEvents(this,this.onTouchTalkBox,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),this.m_script_cover=new cc.Sprite(RES_CDN_DEFULT+"card_script_bg/116.jpg"),USE_SP_SCRIPT_BG_SCALE&&this.m_script_cover.setScale(2),this.m_script_cover.setAnchorPoint(.5,.5),this.m_script_cover.setPosition(winSize.width/2,winSize.height/2),this.m_script_cover.opacity=0,this.addChild(this.m_script_cover);var container=new BattleEventDungeonScriptLayer_SubLayer;container.ignoreAnchorPointForPosition(!1),container.setContentSize(winSize),container.setAnchorPoint(0,0),container.setPosition(0,0),this.addChild(container),this.m_cliper=new cc.ClippingNode,this.m_cliper.setAnchorPoint(0,0),this.m_cliper.alphaThreshold=.5,this.m_cliper.setPosition(0,0),container.addChild(this.m_cliper),this.m_stencil_node=new cc.Node,this.m_stencil_node.setAnchorPoint(0,0),this.m_stencil_node.setPosition(winSize.width,0),this.m_cliper.stencil=this.m_stencil_node;var spot=new cc.Sprite(RES_CDN_DEFULT+"card_script_bg/116.jpg");return USE_SP_SCRIPT_BG_SCALE&&spot.setScale(2),spot.setAnchorPoint(0,0),spot.setPosition(0,0),this.m_stencil_node.addChild(spot),this.m_stencil_node.setContentSize(spot.getContentSize()),this.m_attack_cover=new cc.Sprite(res.attack_1),this.m_attack_cover.setAnchorPoint(.5,.5),this.m_attack_cover.setPosition(winSize.width/2,winSize.height/2),this.m_cliper.addChild(this.m_attack_cover),this.m_log_box=new GameModalLayer,this.addChild(this.m_log_box,99999),this.initMenu(),this.schedule(this.update,.5),!0},onEnter:function(){this._super()},onExit:function(){this._super(),this.unschedule(this.update)},reset:function(){this.m_script_index=0,this.m_is_complete=!1,this.m_script_list.length=0,this.m_script_list=[],this.m_left_hero.setVisible(!1),this.m_left_hero.setOpacity(0),this.m_middle_hero.setVisible(!1),this.m_middle_hero.setOpacity(0),this.m_right_hero.setVisible(!1),this.m_right_hero.setOpacity(0)},loadScript:function(event_dungeon_idx,occure_type,_callback){var m=MasterTable.getInstance(),dungeon=BattleContext._getInstance().getEventDungeonData();if(0!=GameDefault.getInstance().getOptionStory()&&null==_callback&&null!=dungeon&&dungeon.is_complete)return!1;if(this.reset(),this.m_script_list=m.get_EventDungeonScript(event_dungeon_idx,occure_type,this.m_script_list),0==this.m_script_list.length)return!1;var resource_list=[];this.m_hero_left_script=[],this.m_hero_middle_script=[],this.m_hero_right_script=[],this.m_hero_left_script_texture=[],this.m_hero_middle_script_texture=[],this.m_hero_right_script_texture=[];for(var idx=0;idx<this.m_script_list.length;idx++){if(this.m_script_list[idx].voice,"0"!=this.m_script_list[idx].r_filename)if(-1==resource_list.indexOf(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].r_filename+".png")&&resource_list.push(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].r_filename+".png"),0!=this.m_hero_right_script.length)-1==this.m_hero_right_script.indexOf(this.m_script_list[idx].r_filename)&&(this.m_hero_right_script.push(this.m_script_list[idx].r_filename),this.m_hero_right_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].r_filename+".png")));else this.m_hero_right_script.push(this.m_script_list[idx].r_filename),this.m_hero_right_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].r_filename+".png"));if("0"!=this.m_script_list[idx].m_filename)if(-1==resource_list.indexOf(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].m_filename+".png")&&resource_list.push(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].m_filename+".png"),0!=this.m_hero_middle_script.length)-1==this.m_hero_middle_script.indexOf(this.m_script_list[idx].m_filename)&&(this.m_hero_middle_script.push(this.m_script_list[idx].m_filename),this.m_hero_middle_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].m_filename+".png")));else this.m_hero_middle_script.push(this.m_script_list[idx].m_filename),this.m_hero_middle_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].m_filename+".png"));if("0"!=this.m_script_list[idx].l_filename)if(-1==resource_list.indexOf(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].l_filename+".png")&&resource_list.push(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].l_filename+".png"),0!=this.m_hero_left_script.length)-1==this.m_hero_left_script.indexOf(this.m_script_list[idx].l_filename)&&(this.m_hero_left_script.push(this.m_script_list[idx].l_filename),this.m_hero_left_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].l_filename+".png")));else this.m_hero_left_script.push(this.m_script_list[idx].l_filename),this.m_hero_left_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].l_filename+".png"));if("0"!=this.m_script_list[idx].bg_num)-1==resource_list.indexOf(RES_CDN_DEFULT+"card_script_bg/"+this.m_script_list[idx].bg_num+".jpg")&&resource_list.push(RES_CDN_DEFULT+"card_script_bg/"+this.m_script_list[idx].bg_num+".jpg")}return resourceLoader(resource_list,function(){null!=_callback&&_callback()}.bind(this)),!0},updateBG:function(bg_num){var body_img=RES_CDN_DEFULT+"card_script_bg/"+bg_num+".jpg";resourceLoader(body_img,function(){var frame2_texture=cc.textureCache.addImage(body_img),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_script_bg.setSpriteFrame(frame2)}.bind(this))},updateScript:function(script){var winSize=cc.director.getWinSize(),audio=AudioEngine.getInstance();if(0<script.bg_num&&this.updateBG(script.bg_num),this.updateName(script.name),"0"==script.l_filename)if(USE_SCRIPT_FADE){if(0!=this.m_script_index){if("0"!=this.m_script_list[this.m_script_index-1].l_filename){this.m_left_hero.setOpacity(255);var fadeout=new cc.FadeOut(APPEAR_DURATION);this.m_left_hero.runAction(fadeout)}}}else this.m_left_hero.setVisible(!1);else{this.m_left_hero.setVisible(!0),this.m_left_hero.opacity=255;var body_l_check=this.m_hero_left_script.indexOf(script.l_filename);if(-1!=body_l_check){var frame2_texture_left=this.m_hero_left_script_texture[body_l_check],frame2_left=new cc.SpriteFrame(frame2_texture_left,cc.rect(0,0,frame2_texture_left.getContentSize().width,frame2_texture_left.getContentSize().height));this.m_left_hero.setSpriteFrame(frame2_left)}1==script.onoff||4==script.onoff?this.m_left_hero.setColor(cc.color(255,255,255)):0!=script.onoff&&2!=script.onoff&&3!=script.onoff||this.m_left_hero.setColor(cc.color(166,166,166)),this.m_left_hero.setPosition(.5*this.m_left_hero.getContentSize().width*(1.4*this.m_use_Add_Scale),0),this.m_left_hero.isRunning()&&(this.m_left_hero.stopAllActions(),this.m_left_hero.setPosition(.5*this.m_left_hero.getContentSize().width*(1.4*this.m_use_Add_Scale),0),this.m_left_hero.setOpacity(255),this.m_left_hero.setScale(1.4*this.m_use_Add_Scale)),this.appearHero(HERO_LEFT,script.l_appear_type,this.m_left_hero),this.heroEmotion(script.l_emotion,this.m_left_hero,this.m_left_emotion),1==script.l_reverse?this.m_left_hero.setFlippedX(!0):this.m_left_hero.setFlippedX(!1)}if("0"==script.m_filename)if(USE_SCRIPT_FADE){if(0!=this.m_script_index){if("0"!=this.m_script_list[this.m_script_index-1].m_filename){this.m_middle_hero.setOpacity(255);fadeout=new cc.FadeOut(APPEAR_DURATION);this.m_middle_hero.runAction(fadeout)}}}else this.m_middle_hero.setVisible(!1);else{this.m_middle_hero.setVisible(!0),this.m_middle_hero.setOpacity(255);var body_m_check=this.m_hero_middle_script.indexOf(script.m_filename);if(-1!=body_m_check){var frame2_texture_middle=this.m_hero_middle_script_texture[body_m_check],frame2_middle=new cc.SpriteFrame(frame2_texture_middle,cc.rect(0,0,frame2_texture_middle.getContentSize().width,frame2_texture_middle.getContentSize().height));this.m_middle_hero.setSpriteFrame(frame2_middle)}3==script.onoff||4==script.onoff?this.m_middle_hero.setColor(cc.color(255,255,255)):0!=script.onoff&&1!=script.onoff&&2!=script.onoff||this.m_middle_hero.setColor(cc.color(166,166,166)),this.m_middle_hero.setPosition(.5*winSize.width,0),this.m_middle_hero.isRunning()&&(this.m_middle_hero.stopAllActions(),this.m_middle_hero.setPosition(.5*winSize.width,0),this.m_middle_hero.setOpacity(255),this.m_middle_hero.setScale(1.4*this.m_use_Add_Scale)),this.appearHero(HERO_CENTER,script.m_appear_type,this.m_middle_hero),this.heroEmotion(script.m_emotion,this.m_middle_hero,this.m_middle_emotion)}if("0"==script.r_filename)if(USE_SCRIPT_FADE){if(0!=this.m_script_index){if("0"!=this.m_script_list[this.m_script_index-1].r_filename){this.m_right_hero.setOpacity(255);fadeout=new cc.FadeOut(APPEAR_DURATION);this.m_right_hero.runAction(fadeout)}}}else this.m_right_hero.setVisible(!1);else{this.m_right_hero.setVisible(!0),this.m_right_hero.setOpacity(255);var body_r_check=this.m_hero_right_script.indexOf(script.r_filename);if(-1!=body_r_check){var frame2_texture_right=this.m_hero_right_script_texture[body_r_check],frame2_right=new cc.SpriteFrame(frame2_texture_right,cc.rect(0,0,frame2_texture_right.getContentSize().width,frame2_texture_right.getContentSize().height));this.m_right_hero.setSpriteFrame(frame2_right)}2==script.onoff||4==script.onoff?this.m_right_hero.setColor(cc.color(255,255,255)):0!=script.onoff&&1!=script.onoff&&3!=script.onoff||this.m_right_hero.setColor(cc.color(166,166,166)),this.m_right_hero.setPosition(winSize.width-.5*ccWidth(this.m_right_hero)*(1.4*this.m_use_Add_Scale),0),this.m_right_hero.isRunning()&&(this.m_right_hero.stopAllActions(),this.m_right_hero.setPosition(winSize.width-.5*ccWidth(this.m_right_hero)*(1.4*this.m_use_Add_Scale),0),this.m_right_hero.opacity=255,this.m_right_hero.setScale(1.4*this.m_use_Add_Scale)),this.appearHero(HERO_RIGHT,script.r_appear_type,this.m_right_hero),this.heroEmotion(script.r_emotion,this.m_right_hero,this.m_right_emotion),1==script.r_reverse?this.m_right_hero.setFlippedX(!0):this.m_right_hero.setFlippedX(!1)}var nickname=this.m_user_info.nickname;if(1==script.name_type){this.m_label.setString(cmString(script.content,nickname));var line=SCRIPTCOUNT(cmString(script.content,nickname),39);this.m_label.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_label.setTextAreaSize(cc.size(950,22*line+50)),this.m_label.ignoreContentAdaptWithSize(!1)}else{this.m_label.setString(script.content);line=SCRIPTCOUNT(script.content,39);this.m_label.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_label.setTextAreaSize(cc.size(950,22*line+50)),this.m_label.ignoreContentAdaptWithSize(!1)}if(USE_SCRIPT_BGM&&null!=script.bgm&&null!=script.bgm)if("0"==script.bgm);else if("1"==script.bgm)audio.stopBackgroundMusic();else{var b_path=RES_CDN_SOUND+SND_TYPE+"sound/"+script.bgm+".mp3";audio.m_bgmPath!=b_path&&audio.playBackgroundMusic(b_path,!0)}if("0"!=script.sound){var path=RES_CDN_SOUND+SND_TYPE+"voice_etc/"+script.sound+".mp3";audio.playVoice(path)}this.isRunning()&&(this.stopAllActions(),this.setPosition(0,0)),this.m_script_index++,this.m_script_index>=this.m_script_list.length&&(this.m_script_index=this.m_script_list.length-1,this.m_is_complete=!0)},typingBattleScript:function(){if(this.m_is_complete)null!=this._scriptViewComplete&&(AudioEngine.getInstance().stopBackgroundMusic(),this._scriptViewComplete.scriptEventDungeonCompleteV2(this));else if(this.m_script_index<this.m_script_list.length){var script=this.m_script_list[this.m_script_index];if(script.scene_type==SCENE_TYPE_ATTACK)return void this.startAttackEffect(script.scene_desc);if(script.scene_type==SCENE_TYPE_TRANSITION){this.m_is_doing_transition_scene=!0;var fadeout=cc.fadeIn(1),cb=cc.callFunc(this.cbMiddleSceneTransition,this),seq=cc.sequence(fadeout,cb);return void this.m_script_cover.runAction(seq)}if(script.scene_type==SCENE_TYPE_SHAKE)script.scene_desc;this.updateScript(script)}},startAttackEffect:function(scene_desc){this.m_is_doing_attack_scene=!0;var body_img=RES_CDN_DEFULT+"uieffect_2/attack_"+scene_desc+".png",frame2_texture=cc.textureCache.addImage(body_img),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));if(this.m_attack_cover.setSpriteFrame(frame2),scene_desc==ATTACK_TYPE_CUT?this.m_stencil_node.setPosition(0,winSize.height):scene_desc==ATTACK_TYPE_STRING?this.m_stencil_node.setPosition(0,-winSize.height):scene_desc==ATTACK_TYPE_FIST?this.m_stencil_node.setPosition(0,0):scene_desc==ATTACK_TYPE_ARROW?this.m_stencil_node.setPosition(winSize.width,0):scene_desc==ATTACK_TYPE_UP_DOWN&&this.m_stencil_node.setPosition(0,winSize.height),scene_desc==ATTACK_TYPE_FIST){this.m_attack_cover.opacity=0;var fadein=cc.fadeIn(ATTACK_DURATION),delay=cc.delayTime(.5),cb=cc.callFunc(this.cbMiddleAttackEffect,this),seq=cc.sequence(fadein,delay,cb);this.m_attack_cover.runAction(seq)}else{this.m_attack_cover.opacity=255;var ease=cc.moveTo(ATTACK_DURATION,cc.p(0,0)).clone().easing(cc.easeOut(ATTACK_DURATION-.1));delay=cc.delayTime(.5),cb=cc.callFunc(this.cbMiddleAttackEffect,this),seq=cc.sequence(ease,delay,cb);this.m_stencil_node.runAction(seq)}},cbMiddleAttackEffect:function(){var fade=cc.fadeOut(APPEAR_DURATION),cb=cc.callFunc(this.cbEndAttackEffect,this),seq=cc.sequence(fade,cb);this.m_attack_cover.runAction(seq),this.m_script_index++,this.m_script_index>=this.m_script_list.length&&(this.m_script_index=this.m_script_list.length-1,this.m_is_complete=!0),this.typingBattleScript()},cbEndAttackEffect:function(){this.m_is_doing_attack_scene=!1},cbMiddleSceneTransition:function(){var fadein=cc.fadeOut(1),cb=cc.callFunc(this.cbEndSceneTransition,this),seq=cc.sequence(fadein,cb);this.m_script_cover.runAction(seq),this.m_script_index++,this.m_script_index>=this.m_script_list.length&&(this.m_script_index=this.m_script_list.length-1,this.m_is_complete=!0),this.typingBattleScript()},cbEndSceneTransition:function(){this.m_is_doing_transition_scene=!1},appearHero:function(heroSide,type,hero){if(type==APPEAR_TYPE_FADE_IN){hero.setOpacity(0);var fadein=new cc.FadeIn(APPEAR_DURATION);hero.runAction(fadein)}else if(type==APPEAR_TYPE_SHAKE){var shake=new Shake(APPEAR_DURATION,15);hero.runAction(shake)}else if(type==APPEAR_TYPE_BOMB){hero.setScale(3*this.m_use_Add_Scale);var scale=new cc.ScaleTo(.1,1.4*this.m_use_Add_Scale),ease=new cc.EaseBounceOut(scale);hero.runAction(ease)}else{if(1==this.ActorAppearOfCondition(heroSide)){hero.setOpacity(0);fadein=new cc.FadeIn(APPEAR_DURATION);hero.runAction(fadein)}}},heroEmotion:function(type,hero,emotion){if(0==type)emotion.setVisible(!1);else{var n_size=hero.getContentSize();if(emotion.setVisible(!0),emotion.setPosition(.5*n_size.width,n_size.height*this.m_use_Add_Scale-70+35),emotion.isRunning()&&emotion.stopAllActions(),NOT_USE_SP_BATTLE_ANIMATION){if(type-1==1){emotion.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/upset01.png");var fadeout=new cc.FadeOut(.5),fadein=new cc.FadeIn(.5),sequence=new cc.Sequence(fadeout,fadein);repeat=new cc.RepeatForever(sequence);emotion.runAction(repeat),repeat=sequence=fadein=fadeout=null}else if(type-1==2){emotion.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/angry01.png");var scaleTo_1=new cc.ScaleTo(.3,1,1),scaleTo_2=new cc.ScaleTo(.3,1.05,1.05);sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);emotion.runAction(repeat),repeat=sequence=scaleTo_2=scaleTo_1=null}else if(type-1==3){emotion.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/shine01.png");fadeout=new cc.FadeOut(.2),fadein=new cc.FadeIn(.2),sequence=new cc.Sequence(fadein,fadeout),repeat=new cc.RepeatForever(sequence);emotion.runAction(repeat),repeat=sequence=fadein=fadeout=null}else if(type-1==4){emotion.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/dark.png");scaleTo_1=new cc.ScaleTo(.3,1,1),scaleTo_2=new cc.ScaleTo(.3,1.03,1.03),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);emotion.runAction(repeat),repeat=sequence=scaleTo_2=scaleTo_1=null}}else{var animate=BattleAni._getInstance().getAnimate(BattleAni_.EffectEmotion_1+(type-1)),repeat=animate.repeatForever();emotion.runAction(repeat),repeat=animate=null}}},IsReady:function(){return 0!=this.m_script_list.length},updateName:function(name){"0"==name?(this.m_name_label.setString(""),this.m_name_label.setVisible(!1),this.m_bg_script_name.setVisible(!1)):("1"==name?this.m_name_label.setString(this.m_user_info.nickname):this.m_name_label.setString(name),this.m_name_label.setVisible(!0),this.m_bg_script_name.setVisible(!0))},onTouchTalkBox:function(sender,_event){this.isVisible()&&!this.m_show_btn.isVisible()&&(this.m_is_doing_transition_scene||this.m_is_doing_attack_scene||this.m_touch_delay_time<.4||(this.m_touch_delay_time=0,this.typingBattleScript()))},initMenu:function(){var winSize=cc.director.getWinSize();this.m_show_btn=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_story_look_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_story_look_on.png",""),this.m_show_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_show_btn.setPosition(winSize.width-15,winSize.height-10),this.m_show_btn.setVisible(!1),this.addChild(this.m_show_btn),this.m_show_btn.addClickEventListener(function(){this.showScript(!0)}.bind(this)),this.m_btn_container=new cc.Node,this.m_btn_container.setPosition(winSize.width-15,winSize.height-10),this.m_btn_container.setVisible(!1),this.addChild(this.m_btn_container);var menu_offset_y=0;this.m_auto_icon=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_story_auto.png"),this.m_auto_icon.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_auto_icon.setPosition(10,620),this.m_auto_icon.setVisible(!1),this.addChild(this.m_auto_icon);var option=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_story_option_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_story_option_on.png","");option.setAnchorPoint(ANCHOR_TOP_RIGHT()),option.setPosition(0,menu_offset_y),this.m_btn_container.addChild(option),option.addClickEventListener(function(){this.openOption()}.bind(this)),menu_offset_y-=68;var hide=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_story_hide_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_story_hide_on.png","");hide.setAnchorPoint(ANCHOR_TOP_RIGHT()),hide.setPosition(0,menu_offset_y),this.m_btn_container.addChild(hide),hide.addClickEventListener(function(){this.setStatus(STATUS_LOVE_CG.NONE),this.showScript(!1)}.bind(this)),menu_offset_y-=68;var log=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_story_log_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_story_log_on.png","");log.setAnchorPoint(ANCHOR_TOP_RIGHT()),log.setPosition(0,menu_offset_y),this.m_btn_container.addChild(log),log.addClickEventListener(function(){this.setStatus(STATUS_LOVE_CG.NONE),this.showScriptLog(!0)}.bind(this)),menu_offset_y-=68;var auto_start=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_story_auto_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_story_auto_on.png","");auto_start.setAnchorPoint(ANCHOR_TOP_RIGHT()),auto_start.setPosition(0,menu_offset_y),this.m_btn_container.addChild(auto_start),auto_start.addClickEventListener(function(){this.setAutoForward(STATUS_LOVE_CG.AUTO_FORWARD)}.bind(this)),this.m_auto_forward_btns.push(auto_start);var auto_stop=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_story_auto_none.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_story_auto_on.png","");auto_stop.setAnchorPoint(ANCHOR_TOP_RIGHT()),auto_stop.setPosition(0,menu_offset_y),auto_stop.setVisible(!1),this.m_btn_container.addChild(auto_stop),auto_stop.addClickEventListener(function(){this.setAutoForward(STATUS_LOVE_CG.NONE)}.bind(this)),this.m_auto_forward_btns.push(auto_stop),this.m_auto_effect=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/auto.json",RES_CDN_DEFULT+"effect/auto.atlas",1),this.m_auto_effect.setAnchorPoint(ANCHOR_MIDDLE()),this.m_auto_effect.setPosition(-30,menu_offset_y-30),this.m_btn_container.addChild(this.m_auto_effect,100),this.m_auto_effect.setVisible(!1),this.m_auto_effect.setAnimation(0,"fx_1",!0),menu_offset_y-=68;var skip=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_story_skip_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_story_skip_on.png","");skip.setAnchorPoint(ANCHOR_TOP_RIGHT()),skip.setPosition(0,menu_offset_y),this.m_btn_container.addChild(skip),skip.addClickEventListener(function(){if(null!=this._scriptViewComplete){var audio=AudioEngine.getInstance();audio.stopBackgroundMusic(),audio.bgm_path="",this._scriptViewComplete.scriptEventDungeonCompleteV2(this)}}.bind(this)),menu_offset_y-=68,this.m_btn_container.setVisible(!0)},showScript:function(isShow){this.m_bg_frame.setVisible(isShow),this.m_btn_container.setVisible(isShow),isShow?this.m_show_btn.setVisible(!1):this.m_show_btn.setVisible(!0)},update:function(dt){if(this.m_touch_delay_time+=dt,this.m_script_delta_time+=dt,this.m_status==STATUS_LOVE_CG.NONE);else if(this.m_status==STATUS_LOVE_CG.AUTO_FORWARD&&this.m_script_delta_time>AUTO_FORWARD_TIME){if(this.m_script_delta_time=0,this.m_is_complete)return void this.setAutoForward(STATUS_LOVE_CG.NONE);this.typingBattleScript()}},setAutoForward:function(_status){this.setStatus(_status),this.m_script_delta_time=0,_status==STATUS_LOVE_CG.AUTO_FORWARD?(this.m_auto_forward_btns[0].setVisible(!1),this.m_auto_forward_btns[1].setVisible(!0),this.m_is_complete&&(this.m_script_index--,this.m_script_index=Math.max(this.m_script_index,0)),this.m_script_type==SCRIPT_TYPE.EVENT&&this.typingBattleScript()):(this.m_auto_forward_btns[0].setVisible(!0),this.m_auto_forward_btns[1].setVisible(!1))},setStatus:function(_status){this.m_status!=_status&&(_status==STATUS_LOVE_CG.NONE?(this.m_finger.isVisible()||this.m_finger.setVisible(!0),this.m_auto_icon.setVisible(!1),this.m_auto_forward_btns[0].setVisible(!0),this.m_auto_forward_btns[1].setVisible(!1),this.m_auto_effect.setVisible(!1)):(this.m_finger.isVisible()&&this.m_finger.setVisible(!1),_status==STATUS_LOVE_CG.AUTO_FORWARD&&(this.m_auto_icon.setVisible(!0),this.m_auto_effect.setVisible(!0))),this.m_status=_status)},openOption:function(){this.setStatus(STATUS_LOVE_CG.NONE),MainObserver.getInstance().postNotification(NOTIFY_MENU_OPTION)},showScriptLog:function(is_show){if(is_show){if(this.m_script_type==SCRIPT_TYPE.ANIMATION);else if(this.m_script_type==SCRIPT_TYPE.EVENT){for(var list=[],i=0;i<this.m_script_list.length&&(list.push(this.m_script_list[i]),this.m_is_complete||i!=this.m_script_index-1);i++);this.m_log_box.setContentSize(ccSize(this)),this.m_log_box._contentNode=function(contentsSize,m){var layer=new cc.Layer,log=new LoveContentCGLogLayerV2;return log.setAnchorPoint(ANCHOR_MIDDLE()),log.setScriptData(list,this.m_script_type),log.setPosition(ccCenter(layer)),log.m_tableView.scrollBarEnable(5<log.numberOfCellsInTableView()),layer.addChild(log),layer}.bind(this),this.m_log_box.is_show()&&this.m_log_box.hide(),this.m_log_box.show()}}else this.m_log_box.is_show()&&this.m_log_box.hide()},ActorAppearOfCondition:function(heroSide){var script,rValue=0;if(script=this.m_script_list[this.m_script_index],0<this.m_script_index){var prev_script,prev_hero,current_hero;prev_script=this.m_script_list[this.m_script_index-1],heroSide==HERO_LEFT?(prev_hero=prev_script.l_filename,current_hero=script.l_filename):heroSide==HERO_CENTER?(prev_hero=prev_script.m_filename,current_hero=script.m_filename):heroSide==HERO_RIGHT&&(prev_hero=prev_script.r_filename,current_hero=script.r_filename),rValue=prev_hero==current_hero?0:1}return rValue}}),BattleMissionResultGetItem_V2=cc.Node.extend({m_item:null,m_item_frame:null,m_item_box:null,m_item_icon:null,m_item_open_effect:null,m_item_count_box:null,m_item_count:null,tooltip_box:null,tooltip_title:null,tooltip_content:null,tooltip_btn:null,m_callbock:null,m_cancel:null,ctor:function(item,callbock,cancel){this._super(),this.m_callbock=callbock,this.m_cancel=cancel,this.m_item=$.extend({},database.BattleGainItem),this.init(item)},onExit:function(){this._super(),this.removeAllChildrenWithCleanup(!0),this.removeAllChildren(this.m_item_open_effect),this.m_item_open_effect.removeAllChildrenWithCleanup(!0),this.m_item_open_effect=null,this.removeChild(this.m_item_icon),this.m_item_icon=null,this.m_item=null,this.m_item_frame=null,this.m_item_box=null,this.m_item_open_effect=null,this.m_item_count_box=null,this.m_item_count=null,this.tooltip_box=null,this.tooltip_title=null,this.tooltip_content=null,this.tooltip_btn=null,this.m_callbock=null,this.m_cancel=null},init:function(item,callbock,cancel){return this.m_item=item,this.initLayout(),this.initTooltipBox(),!0},initLayout:function(){this.setAnchorPoint(0,0),this.m_item_frame=new ccui.Button(RES_CDN_DEFULT+"icon/img_icon_frame.png",RES_CDN_DEFULT+"icon/img_icon_frame.png");var size=this.m_item_frame.getContentSize();switch(this.setContentSize(size),this.m_item_frame.setAnchorPoint(.5,.5),this.m_item_frame.setPosition(size.width/2,size.height/2),this.addChild(this.m_item_frame),this.m_item_frame.addTouchEventListener(this.onToolTipTouch,this),this.m_item_frame.setSwallowTouches(!1),this.m_item_box=cc.Sprite.create("#img_treasure_box.png"),this.m_item_box.setAnchorPoint(.5,.5),this.m_item_box.setPosition(size.width/2,size.height/2),this.m_item_frame.addChild(this.m_item_box),this.m_item.item_type){case database.BattleGainItemType.General:this.createGeneral();break;case database.BattleGainItemType.EventPoint:this.createGainItemEventPoint();break;case database.BattleGainItemType.Equipment:this.createEquipment();break;case database.BattleGainItemType.SpecialPoint:this.createGainItemSpecialPoint();break;case database.BattleGainItemType.GnrlPiece:this.createGnrlPiece();break;case database.BattleGainItemType.NewEquipmentMakeMaterial:case database.BattleGainItemType.NewEquipmentEnhanceMaterial:case database.BattleGainItemType.NewEquipmentSmeltMaterial:case database.BattleGainItemType.NewEquipmentEnchantTicket:this.createNewEquipMaterial();break;case database.BattleGainItemType.NewRaidBossPoint:this.createNewRaidBossPoint();break;default:this.createGainItem()}var campaign_list={},mt=MasterTable.getInstance(),game_type=BattleContext._getInstance().getGameType();if(game_type==db.BattleGameType.DailyDungeon?campaign_list=mt.get_RewardCampaignUiList(CAMPAIGN_DUNGEON_TYPE_DAILY):game_type==db.BattleGameType.WeeklyDungeon?campaign_list=mt.get_RewardCampaignUiList(CAMPAIGN_DUNGEON_TYPE_WEEKLY):game_type==db.BattleGameType.EventDungeon?this.m_item.item_type!=database.BattleGainItemType.EventPoint&&this.m_item.item_type!=database.BattleGainItemType.SpecialPoint&&this.m_item.item_type!=database.BattleGainItemType.CraftMtrl&&this.m_item.item_type!=database.BattleGainItemType.RebirthMtrl||0==this.m_item.gnrl_group||(campaign_list=mt.get_RewardCampaignUiList(CAMPAIGN_DUNGEON_TYPE_EVENT_DUNGEON)):game_type==db.BattleGameType.TowerDungeon&&(campaign_list=mt.get_RewardCampaignUiList(CAMPAIGN_DUNGEON_TYPE_MUSSANG_TOWER)),0<campaign_list.length)for(var i=0;i<campaign_list.length;i++){var campaign=campaign_list[i];if(null!=campaign.dugeon_type&&0!=campaign.dugeon_type&&campaign.position_type==CAMPAIGN_POSITION_TYPE_RESULT_REARD_ICON&&9876543!=this.m_item.gnrl_group&&1234567!=this.m_item.gnrl_group){var icon_height=49;if(this.m_item_icon.height<60&&(icon_height=54),campaign.event_type==CAMPAIGN_EVENT_TYPE_DAILY_DUNGEON_ONLY_GOLD){if(this.m_item.item_type==database.BattleGainItemType.Gold)(icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("common/%s",campaign.image_name))).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),icon.setPosition(30,icon_height),this.m_item_icon.addChild(icon),icon=null}else if(campaign.event_type==CAMPAIGN_EVENT_TYPE_HEART_DOUBLE){if(this.m_item.item_type==database.BattleGainItemType.Heart)(icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("common/%s",campaign.image_name))).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),icon.setPosition(30,icon_height),this.m_item_icon.addChild(icon),icon=null}else if(campaign.event_type==CAMPAIGN_EVENT_TYPE_USER_EXP_DOUBLE){if(this.m_item.item_type==database.BattleGainItemType.UserExp)(icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("common/%s",campaign.image_name))).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),icon.setPosition(30,icon_height),this.m_item_icon.addChild(icon),icon=null}else{var icon;(icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("common/%s",campaign.image_name))).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),icon.setPosition(30,icon_height),this.m_item_icon.addChild(icon),icon=null}}}this.m_item_icon.setVisible(!1),this.m_item_icon.opacity=0,null!=this.m_item_count&&(this.m_item_count.opacity=0),this.m_item_open_effect=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Reward.json",RES_CDN_DEFULT+"effect/Reward.atlas",1),this.m_item_open_effect.setPosition(size.width/2,size.height/2),this.m_item_open_effect.setVisible(!1),this.addChild(this.m_item_open_effect),campaign=null},openBox:function(){var hide=cc.fadeOut(.5),cb=new cc.CallFunc(this.cbOpenBox,this),run=new cc.Sequence(hide,cb);this.m_item_box.runAction(run),null!=this.m_item_open_effect&&(this.m_item_open_effect.setVisible(!0),this.m_item_open_effect.setAnimation(0,"fx_1",!1)),this.m_item_icon.setVisible(!0),this.delayFadeIn(this.m_item_icon,.3,.5),null!=this.m_item_count&&this.delayFadeIn(this.m_item_count,.3,.5),null!=this.m_item_count_box&&this.delayFadeIn(this.m_item_count_box,.3,.5)},cbOpenBox:function(){null!=this.m_item_count_box&&this.m_item_count_box.setVisible(!0)},createCountLabel:function(general){if(null!=this.m_item_icon){var frame_size=this.m_item_frame.getContentSize();this.m_item_icon.getContentSize();this.m_item_count_box=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_valuebox.png"),this.m_item_count_box.setAnchorPoint(.5,.5),this.m_item_count_box.setPosition(.5*frame_size.width,-2),this.m_item_frame.addChild(this.m_item_count_box),this.m_item_count=cmLabel.getLabel(Number(this.m_item.item_count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_161),this.m_item_count.setAnchorPoint(.5,.5),this.m_item_count.setPosition(cc.p(this.m_item_count_box.getContentSize().width/2,this.m_item_count_box.getContentSize().height/2)),this.m_item_count_box.addChild(this.m_item_count),this.m_item_count.setVisible(!0),this.m_item_count_box.setVisible(!1)}},createEquipment:function(){var info={};EquipmentService.getInstance().getUserEquipmentInfoInternal(this.m_item.equipment,info,[]);var equip_info={};equip_info.equip_id=info.equip_id,equip_info.equip_rare_type=info.equip_rare_type,equip_info.equip_parts_type=info.equip_parts_type,equip_info.arm_service_type=info.arm_service_type,equip_info.equip_type=info.equip_type,equip_info.level=info.level,equip_info.step=info.equip_step,equip_info.is_equip="y"==info.equip_yn,equip_info.is_lock="y"==info.lock_yn,equip_info.image=info.image,equip_info.equip_group=info.equip_group,equip_info.property_img=info.property_img,equip_info.frame_id=info.frame_id,equip_info.symbol_id=info.symbol_id,equip_info.symbol_name_id=info.symbol_name_id,equip_info.is_same_gnrl_group=!1,equip_info.gnrl_group=info.gnrl_group,this.m_item_icon=CardEquipment.getInstance().createCardEquipment(equip_info,EQUIPMENT_CARD_TYPE.type_card_small),this.m_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_icon.setPosition(ccCenter(this)),this.addChild(this.m_item_icon),MasterManager.getInstance().get_EquipmentItem(this.m_item.equipment.equipment_item_idx).equipment_type==EQUIPMENT_TYPE_EXP&&this.createCountLabel(),equip_info=null},createGainItemSpecialPoint:function(){var icon_name="#"+cmString("img_reward_%d_%02d.png",this.m_item.item_level,this.m_item.item_id);this.m_item_icon=cc.Sprite.create(icon_name),this.m_item_icon.setAnchorPoint(.5,.5),this.m_item_icon.setPosition(cc.p(this.width/2,this.height/2)),this.addChild(this.m_item_icon),this.createCountLabel()},createGeneral:function(){var info={};info.gnrl_id=this.m_item.item_id,this.m_item_icon=(new Card).createCard(info,CARD_TYPE.type_card_thumb),this.m_item_icon.setAnchorPoint(.5,.5),this.m_item_icon.setPosition(cc.p(this.width/2-10,this.height/2-11)),this.addChild(this.m_item_icon),this.createCountLabel(1),info=null},createGnrlPiece:function(){var icon_name=cmString("#img_reward_%d_%02d_n.png",this.m_item.item_id,this.m_item.gnrl_group);this.m_item_icon=cc.Sprite.create(icon_name),this.m_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_icon.setPosition(ccCenter(this)),this.m_item_icon.setScale(.428),this.addChild(this.m_item_icon),this.createCountLabel()},createGainItemEventPoint:function(){var icon_name="#img_reward_"+this.m_item.item_level+"_"+(this.m_item.item_id<10?"0"+this.m_item.item_id:this.m_item.item_id)+".png";this.m_item_icon=cc.Sprite.create(icon_name),this.m_item_icon.setAnchorPoint(.5,.5),this.m_item_icon.setPosition(cc.p(this.width/2,this.height/2)),this.addChild(this.m_item_icon),this.createCountLabel()},createGainItem:function(){var icon_name="#img_reward_"+(this.m_item.item_id<10?"0"+this.m_item.item_id:this.m_item.item_id)+".png";this.m_item_icon=cc.Sprite.create(icon_name),this.m_item_icon.setAnchorPoint(.5,.5),this.m_item_icon.setPosition(cc.p(this.width/2,this.height/2)),this.addChild(this.m_item_icon),this.createCountLabel()},createNewEquipMaterial:function(){var icon_name=cmString("#img_reward_%02d_%d_n.png",this.m_item.item_id,this.m_item.item_level);this.m_item_icon=cc.Sprite.create(icon_name),this.m_item_icon.setAnchorPoint(.5,.5),this.m_item_icon.setScale(.43),this.m_item_icon.setPosition(cc.p(this.width/2,this.height/2)),this.addChild(this.m_item_icon),this.createCountLabel()},createNewRaidBossPoint:function(){var icon_name=cmString("#img_reward_%02d_%d_n.png",this.m_item.item_id,this.m_item.gnrl_group);this.m_item_icon=cc.Sprite.create(icon_name),this.m_item_icon.setAnchorPoint(.5,.5),this.m_item_icon.setScale(.43),this.m_item_icon.setPosition(cc.p(this.width/2,this.height/2)),this.addChild(this.m_item_icon),this.createCountLabel()},delayFadeIn:function(node,delay_time,fade_dration){var delay=cc.delayTime(delay_time),fadein=cc.fadeIn(fade_dration),seq=cc.sequence(delay,fadein);node.runAction(seq)},initTooltipBox:function(){var thisSize=ccSize(this);null==this.tooltip_box&&(this.tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.tooltip_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.tooltip_box.setPosition(65,thisSize.height+5),this.tooltip_box.setVisible(!1),this.addChild(this.tooltip_box),this.tooltip_box.setGlobalZOrder(1e6)),null==this.tooltip_title&&(this.tooltip_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1810),this.tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_box.addChild(this.tooltip_title),this.tooltip_title.setGlobalZOrder(100001)),null==this.tooltip_content&&(this.tooltip_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.tooltip_content.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_box.addChild(this.tooltip_content),this.tooltip_content.setGlobalZOrder(100002))},onToolTipTouch:function(sender,_type){_type==ccui.Widget.TOUCH_BEGAN?this.showTooltip():_type==ccui.Widget.TOUCH_MOVED||this.hideTooltip()},onTouchItem:function(sender,_event){_event==cc.CONTROL_EVENT_TOUCH_DOWN?this.showTooltip():this.hideTooltip()},showTooltip:function(){if(this.m_item_icon.isVisible()){this.tooltip_box.setVisible(!1);var m=MasterManager.getInstance(),m2=MasterTable.getInstance();if(this.m_item.item_type==database.BattleGainItemType.General){var gnrl=m.get_General(this.m_item.item_id);if(null==(tooltip=m2.get_TooltipGeneral(this.m_item.item_id)).content||0==tooltip.content.length){this.tooltip_title.setString(gnrl.name),this.tooltip_title.setAnchorPoint(.5,.5),this.tooltip_content.setString("");var tSize=this.tooltip_title.getContentSize();(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(64,tSize.width+20),bSize.height=Math.max(54,bSize.height+10),this.tooltip_box.setContentSize(bSize),this.tooltip_title.setPosition(bSize.width/2,bSize.height/2)}else{this.tooltip_title.setString(gnrl.name),this.tooltip_title.setAnchorPoint(0,1),this.tooltip_content.setString(tooltip.content);tSize=this.tooltip_title.getContentSize();var cSize=this.tooltip_content.getContentSize();(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(tSize.width+20,cSize.width+20),bSize.height=Math.max(64,bSize.height+cSize.height+5),this.tooltip_box.setContentSize(bSize),this.tooltip_title.setPosition(10,bSize.height-10),this.tooltip_content.setPosition(10,bSize.height-15-tSize.height)}}else if(this.m_item.item_type==database.BattleGainItemType.Equipment){var equip=m.get_EquipmentItem(this.m_item.equipment.equipment_item_idx);if(null==(tooltip=m2.get_TooltipInfo(4,this.m_item.equipment.equipment_item_idx)).content||0==tooltip.content.length){this.tooltip_title.setString(equip.name),this.tooltip_title.setAnchorPoint(ANCHOR_MIDDLE()),this.tooltip_content.setString("");tSize=this.tooltip_title.getContentSize();(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(64,tSize.width+20),bSize.height=Math.max(54,bSize.height+10),this.tooltip_box.setContentSize(bSize),this.tooltip_title.setPosition(bSize.width/2,bSize.height/2)}else{this.tooltip_title.setString(equip.name),this.tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_content.setString(tooltip.content);tSize=this.tooltip_title.getContentSize(),cSize=this.tooltip_content.getContentSize();(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(tSize.width+20,cSize.width+20),bSize.height=Math.max(64,bSize.height+cSize.height+5),this.tooltip_box.setContentSize(bSize),this.tooltip_title.setPosition(10,bSize.height-10),this.tooltip_content.setPosition(10,bSize.height-15-tSize.height)}}else if(this.m_item.item_type==database.BattleGainItemType.EventPoint){var service=EventDungeonService.getInstance(),period=m.get_EventDungeonPeriod(this.m_item.item_level),unit=m.get_EventPointUnitType(period.event_point_unit_type),first_period_idx=service.getEventDungeonFirstHalfPeriodIdx(period.event_dungeon_group_idx),second_period_idx=service.getEventDungeonSecondHalfPeriodIdx(period.event_dungeon_group_idx),middle_period_idx=service.getEventDungeonMiddleHalfPeriodIdx(period.event_dungeon_group_idx),period_type=0;this.m_item.item_level==first_period_idx?period_type=1:this.m_item.item_level==second_period_idx?period_type=3:this.m_item.item_level==middle_period_idx&&(period_type=2);var tooltip=m2.get_TooltipInfo(1,period_type);if(this.tooltip_title.setString(unit.name),null==tooltip.content||0==tooltip.content.length){this.tooltip_title.setAnchorPoint(ANCHOR_MIDDLE()),this.tooltip_content.setString("");tSize=this.tooltip_title.getContentSize();(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(64,tSize.width+20),bSize.height=Math.max(54,bSize.height+10),this.tooltip_box.setContentSize(bSize),this.tooltip_title.setPosition(bSize.width/2,bSize.height/2)}else{this.tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_content.setString(tooltip.content);tSize=this.tooltip_title.getContentSize(),cSize=this.tooltip_content.getContentSize();(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(tSize.width+20,cSize.width+20),bSize.height=Math.max(64,bSize.height+cSize.height+5),this.tooltip_box.setContentSize(bSize),this.tooltip_title.setPosition(10,bSize.height-10),this.tooltip_content.setPosition(10,bSize.height-15-tSize.height)}}else{var bonus=m.get_BonusType(this.m_item.item_id);tooltip=m2.get_TooltipItem(this.m_item.item_id);if(this.m_item.item_type==database.BattleGainItemType.HeroNaming&&(tooltip=m2.get_TooltipNaming(this.m_item.item_level)),null==tooltip.content||0==tooltip.content.length){var name="";name=bonus.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_MAKE_MATERIAL?m.get_NewEquipmentMakeMaterial(this.m_item.item_level).name:bonus.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_SMELT_MATERIAL?m.get_NewEquipmentSmeltMaterial(this.m_item.item_level).name:bonus.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_ENHANCE_MATERIAL?m.get_NewEquipmentEnhanceMaterial(this.m_item.item_level).name:bonus.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_ENCHANT_TICKET?m.get_NewEquipmentEnchantTicket(this.m_item.item_level).name:bonus.name,this.tooltip_title.setString(name),this.tooltip_title.setAnchorPoint(.5,.5),null==tooltip.content&&(tooltip.content=""),this.tooltip_content.setString(tooltip.content);tSize=this.tooltip_title.getContentSize();(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(64,tSize.width+20),bSize.height=Math.max(54,bSize.height+10),this.tooltip_box.setContentSize(bSize),this.tooltip_title.setPosition(bSize.width/2,bSize.height/2)}else{this.tooltip_title.setString(bonus.name),this.tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_content.setString(tooltip.content);var bSize;tSize=this.tooltip_title.getContentSize(),cSize=this.tooltip_content.getContentSize();(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(tSize.width+20,cSize.width+20),bSize.height=Math.max(64,bSize.height+cSize.height+5),this.tooltip_box.setContentSize(bSize),this.tooltip_title.setPosition(10,bSize.height-10),this.tooltip_content.setPosition(10,bSize.height-15-tSize.height)}}if(this.tooltip_box){cc.director.getVisibleSize(),this.tooltip_box.getPosition(),this.tooltip_box.getBoundingBox();var world_pos=this.tooltip_box.getParent().getParent().getParent().convertToWorldSpace(this.getPosition()),container_pos=this.tooltip_box.getParent().getParent().getPosition();world_pos.x=world_pos.x+this.tooltip_box.x+container_pos.x+this.getContentSize().width/2,world_pos.y=world_pos.y+this.tooltip_box.y+container_pos.y,null!=this.m_callbock&&this.m_callbock(world_pos,Object.assign({},this.tooltip_box),this.tooltip_title.getString(),this.tooltip_content.getString())}}},hideTooltip:function(){null!=this.tooltip_box&&this.tooltip_box.setVisible(!1),null!=this.m_cancel&&this.m_cancel()}}),BattleMissionTaskNode_V2=cc.Node.extend({m_task_list:null,m_tower_task_list:null,m_weekly_task_list:null,m_event_task_list:null,m_story_hard_mode_task_list:null,m_icon:null,m_count_bg:null,m_flower:null,m_complete:null,m_task_title:null,m_task_contents:null,m_reward_count:null,ctor:function(){this.m_task_list=[],this.m_tower_task_list=[],this.m_weekly_task_list=[],this.m_event_task_list=[],this.m_story_hard_mode_task_list=[],this._super(),this.init()},onExit:function(){this._super(),this.removeAllChildrenWithCleanup(!0)},init:function(){this.setAnchorPoint(0,0);var size=cc.size(470,78);this.setContentSize(size);var box=new cc.Scale9Sprite(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",cc.Rect(40,40,10,10));box.setPosition(0,0),box.setAnchorPoint(0,0),box.setPreferredSize(size),this.addChild(box),this.m_task_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2013),this.m_task_title.setAnchorPoint(0,0),this.m_task_title.setPosition(58,43),box.addChild(this.m_task_title),this.m_task_contents=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_task_contents.setAnchorPoint(0,0),this.m_task_contents.setPosition(58,16),box.addChild(this.m_task_contents);var icon_box=new cc.Sprite(RES_CDN_DEFULT+"icon/img_icon_frame.png");return icon_box.setAnchorPoint(1,.5),icon_box.setPosition(size.width-4,.5*size.height),box.addChild(icon_box),this.m_icon=new cc.Sprite("#img_reward_01.png"),this.m_icon.setAnchorPoint(.5,.5),this.m_icon.setPosition(icon_box.width/2,icon_box.height/2),icon_box.addChild(this.m_icon),this.m_count_bg=new cc.Sprite(RES_CDN_DEFULT+"icon/img_icon_valuebox.png"),this.m_count_bg.setAnchorPoint(.5,.5),this.m_count_bg.setPosition(.5*this.m_icon.width,2),this.m_icon.addChild(this.m_count_bg),this.m_reward_count=cmLabel.getLabel("0",LABEL_FONT_INDEX.FONT_143),this.m_reward_count.setAnchorPoint(.5,.5),this.m_reward_count.setPosition(this.m_count_bg.width/2,this.m_count_bg.height/2),this.m_count_bg.addChild(this.m_reward_count),this.m_flower=new cc.Sprite(RES_CDN_DEFULT+"menu_quest/img_story_sakura_on.png"),this.m_flower.setAnchorPoint(0,.5),this.m_flower.setPosition(14,39),box.addChild(this.m_flower),this.m_complete=new cc.Sprite(RES_CDN_DEFULT+"menu_quest/img_story_complete.png"),this.m_complete.setAnchorPoint(.5,.5),this.m_complete.setPosition(size.width/2,size.height/2),IS_SP_BROWSER&&this.m_complete.setScale(2),box.addChild(this.m_complete),!0},setTaskData:function(task_list,type){var i=0;if(type==db.BattleGameType.Mission){for(i=0;i<task_list.size();i++)this.m_task_list.push($.extend({},task_list.at(i)));this.showTasks()}else if(type==db.BattleGameType.StoryHardMode){for(i=0;i<task_list.size();i++)this.m_story_hard_mode_task_list.push($.extend({},task_list.at(i)));this.showStoryHardModeTasks()}else if(type==db.BattleGameType.WeeklyDungeon){for(i=0;i<task_list.size();i++)this.m_weekly_task_list.push($.extend({},task_list.at(i)));this.showWeeklyTasks()}else if(type==db.BattleGameType.EventDungeon){for(i=0;i<task_list.size();i++)this.m_event_task_list.push($.extend({},task_list.at(i)));this.showEventTasks()}else if(type==db.BattleGameType.TowerDungeon){for(i=0;i<task_list.size();i++)this.m_tower_task_list.push($.extend({},task_list.at(i)));this.showTowerTasks()}},showTasks:function(){if(0<this.m_task_list.length){var content,task=this.m_task_list.shift();if(this.m_task_title.setString(task.task.name),task.task_type.task_type==database.TaskActionType.Mission_Clear_Count){var clear_count=task.mission_clear_count;clear_count>task.task.accum_win_count&&(clear_count=task.task.accum_win_count),content=task.task.content+"( "+clear_count+"/"+task.task.accum_win_count}else content=task.task.content;this.m_task_contents.setString(content);var icon_name="",b_icon_size=!1,b_texture=!1;if(task.bonus_type==BONUS_TYPE_YUNHEE_FIX||task.bonus_type==BONUS_TYPE_JIN_FIX){var gnrl=MasterManager.getInstance().get_General(task.bonus_value);icon_name=gnrl.gnrl_type==GENERAL_TYPE_MATERIAL||gnrl.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL?"m_"+gnrl.bone_id+".png":"m_"+gnrl.gnrl_id+".png",b_icon_size=!0}else if(task.bonus_type==BONUS_TYPE_LOVE_ITEM)icon_name="img_reward_love_item_"+(task.bonus_value<10?"0"+task.bonus_value:task.bonus_value)+".png";else if(task.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||task.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT)icon_name="img_reward_yh.png";else if(task.bonus_type==BONUS_TYPE_EQUIPMENT){var equip=MasterManager.getInstance().get_EquipmentItem(task.min_value);DISABLE_SPB_TP?(icon_name=RES_CDN_MENU_EQUIP_NTP+cmString("%s.png",equip.reward_img),b_texture=!0):icon_name=cmString("%s.png",equip.reward_img),b_icon_size=!0}else icon_name="img_reward_"+(task.bonus_type<10?"0"+task.bonus_type:task.bonus_type)+".png";if(""!=icon_name){if(cc.log("BattleMissionTaskNode icon_name = "+icon_name),0==b_texture){var frame=cc.spriteFrameCache.getSpriteFrame(icon_name);this.m_icon.setSpriteFrame(frame)}else this.m_icon.setTexture(icon_name);USE_SP_EQUIPMENT_ICON_SCALE&&(DISABLE_SPB_TP||(task.bonus_type==BONUS_TYPE_EQUIPMENT?(this.m_icon.setScale(2),this.m_count_bg.setScale(.5),this.m_count_bg.setPosition(20,2),this.m_icon.setPosition(60,60)):(this.m_icon.setScale(1),this.m_count_bg.setScale(1),this.m_count_bg.setPosition(34,2),this.m_icon.setPosition(34,34)))),1==b_icon_size?(this.m_icon.setScale(DEF_TUMB_SCALE),IS_SP_BROWSER?(this.m_count_bg.setScale(.8),this.m_count_bg.setPosition(.5*this.m_icon.width,2)):(this.m_count_bg.setScale(1.6),this.m_count_bg.setPosition(.5*this.m_icon.width+4,2))):(this.m_icon.setScale(1),this.m_count_bg.setScale(1),this.m_count_bg.setPosition(.5*this.m_icon.width,2));var count=0;count=task.bonus_type==BONUS_TYPE_LOVE_ITEM?1:task.bonus_type==BONUS_TYPE_YUNHEE_FIX||task.bonus_type==BONUS_TYPE_JIN_FIX?1:task.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||task.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT?1:task.bonus_value,this.m_reward_count.setString(count+"")}if(task.is_cleared){frame=RES_CDN_DEFULT+"menu_quest/img_story_sakura_on.png";var frame2_texture=cc.textureCache.addImage(frame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_flower.setSpriteFrame(frame2);var comFrame=RES_CDN_DEFULT+"menu_quest/img_story_complete.png";frame2_texture=cc.textureCache.addImage(comFrame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_complete.setSpriteFrame(frame2)}else{frame=RES_CDN_DEFULT+"menu_quest/img_story_sakura_off.png",frame2_texture=cc.textureCache.addImage(frame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_flower.setSpriteFrame(frame2);comFrame=RES_CDN_DEFULT+"menu_quest/img_story_fail.png",frame2_texture=cc.textureCache.addImage(comFrame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_complete.setSpriteFrame(frame2)}var size=ccSize(this),movein=cc.moveBy(.5,cc.p(-size.width,0)),delay=cc.delayTime(2),moveout=cc.moveBy(.5,cc.p(size.width,0)),delay2=cc.delayTime(.3),cb=cc.callFunc(this.cbShowTasks.bind(this)),seq=cc.sequence(movein,delay,moveout,delay2,cb);this.runAction(seq)}},cbShowTasks:function(){0<this.m_task_list.length&&this.showTasks()},showEventTasks:function(){if(0<this.m_event_task_list.length){MasterTable.getInstance();var content,task=this.m_event_task_list.shift();if(this.m_task_title.setString(task.task_define.name),parseInt(task.task_define.task_type)==database.TaskActionType.Mission_Clear_Count){var clear_count=task.clear_count;clear_count>task.task_define.value1&&(clear_count=task.task_define.value1),content=cmString(res_str("label_battle_task_content_win_count"),task.task_define.content,clear_count,task.task_define.value1)}else content=task.task_define.content;this.m_task_contents.setString(content);var icon_name="",b_icon_size=!1;if(task.task.bonus_type==BONUS_TYPE_YUNHEE_FIX){var gnrl=MasterManager.getInstance().get_General(task.task.min_value);icon_name=gnrl.gnrl_type==GENERAL_TYPE_MATERIAL||gnrl.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL?"m_"+gnrl.bone_id+".png":"m_"+gnrl.gnrl_id+".png",b_icon_size=!0}else icon_name=task.task.bonus_type==BONUS_TYPE_LOVE_ITEM?"img_reward_love_item_"+(task.task.bonus_type<10?"0"+task.task.bonus_type:task.task.bonus_type)+".png":"img_reward_"+(task.task.bonus_type<10?"0"+task.task.bonus_type:task.task.bonus_type)+".png";if(""!=icon_name){if(cc.log("BattleMissionTaskNode icon_name = "+icon_name),DISABLE_SPB_TP&&task.task.bonus_type==BONUS_TYPE_YUNHEE_FIX)this.m_icon.setTexture(icon_name),this.m_icon.setContentSize(49,49),this.m_icon.setScale(DEF_TUMB_SCALE);else{var frame=cc.spriteFrameCache.getSpriteFrame(icon_name);this.m_icon.setSpriteFrame(frame),1==b_icon_size&&this.m_icon.setContentSize(60,60)}var count=0;count=task.task.bonus_type==BONUS_TYPE_YUNHEE_FIX||task.task.bonus_type==BONUS_TYPE_JIN_FIX?1:task.task.min_value,this.m_reward_count.setString(Number(count).toLocaleString("en"))}if(task.is_complete){frame=RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_on.png";var frame2_texture=cc.textureCache.addImage(frame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_flower.setSpriteFrame(frame2);var comFrame=RES_CDN_DEFULT+"menu_quest/img_story_complete.png";frame2_texture=cc.textureCache.addImage(comFrame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_complete.setSpriteFrame(frame2)}else{frame=RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_off.png",frame2_texture=cc.textureCache.addImage(frame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_flower.setSpriteFrame(frame2);comFrame=RES_CDN_DEFULT+"menu_quest/img_story_fail.png",frame2_texture=cc.textureCache.addImage(comFrame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_complete.setSpriteFrame(frame2)}var size=ccSize(this),movein=cc.moveBy(.5,cc.p(-size.width,0)),delay=cc.delayTime(2),moveout=cc.moveBy(.5,cc.p(size.width,0)),delay2=cc.delayTime(.3),cb=cc.callFunc(this.cbShowEventTasks.bind(this)),seq=cc.sequence(movein,delay,moveout,delay2,cb);this.runAction(seq)}},cbShowEventTasks:function(){0<this.m_event_task_list.length&&this.showEventTasks()},showWeeklyTasks:function(){if(0<this.m_weekly_task_list.length){var content,task=this.m_weekly_task_list.shift();if(this.m_task_title.setString(task.task_define.name),parseInt(task.task_define.task_type)==database.TaskActionType.Mission_Clear_Count){var clear_count=task.clear_count;clear_count>task.task_define.value1&&(clear_count=task.task_define.value1),content=cmString(res_str("label_battle_task_content_win_count"),task.task_define.content,clear_count,task.task_define.value1)}else content=task.task_define.content;this.m_task_contents.setString(content);var icon_name="",b_icon_size=!1;if(task.task.bonus_type==BONUS_TYPE_YUNHEE_FIX){var gnrl=MasterManager.getInstance().get_General(task.task.min_value);icon_name=gnrl.gnrl_type==GENERAL_TYPE_MATERIAL||gnrl.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL?"m_"+gnrl.bone_id+".png":"m_"+gnrl.gnrl_id+".png",b_icon_size=!0}else icon_name=task.task.bonus_type==BONUS_TYPE_LOVE_ITEM?"img_reward_love_item_"+(task.task.bonus_type<10?"0"+task.task.bonus_type:task.task.bonus_type)+".png":"img_reward_"+(task.task.bonus_type<10?"0"+task.task.bonus_type:task.task.bonus_type)+".png";if(""!=icon_name){if(cc.log("BattleMissionTaskNode icon_name = "+icon_name),DISABLE_SPB_TP&&task.task.bonus_type==BONUS_TYPE_YUNHEE_FIX)this.m_icon.setTexture(icon_name),this.m_icon.setContentSize(49,49),this.m_icon.setScale(DEF_TUMB_SCALE);else{var frame=cc.spriteFrameCache.getSpriteFrame(icon_name);this.m_icon.setSpriteFrame(frame),1==b_icon_size&&this.m_icon.setContentSize(60,60)}var count=0;count=task.task.bonus_type==BONUS_TYPE_YUNHEE_FIX||task.task.bonus_type==BONUS_TYPE_JIN_FIX?1:task.task.min_value,this.m_reward_count.setString(Number(count).toLocaleString("en"))}if(task.is_complete){frame=RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_on.png";var frame2_texture=cc.textureCache.addImage(frame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_flower.setSpriteFrame(frame2);var comFrame=RES_CDN_DEFULT+"menu_quest/img_story_complete.png";frame2_texture=cc.textureCache.addImage(comFrame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_complete.setSpriteFrame(frame2)}else{frame=RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_off.png",frame2_texture=cc.textureCache.addImage(frame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_flower.setSpriteFrame(frame2);comFrame=RES_CDN_DEFULT+"menu_quest/img_story_fail.png",frame2_texture=cc.textureCache.addImage(comFrame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_complete.setSpriteFrame(frame2)}var size=ccSize(this),movein=cc.moveBy(.5,cc.p(-size.width,0)),delay=cc.delayTime(2),moveout=cc.moveBy(.5,cc.p(size.width,0)),delay2=cc.delayTime(.3),cb=cc.callFunc(this.cbShowWeeklyTasks.bind(this)),seq=cc.sequence(movein,delay,moveout,delay2,cb);this.runAction(seq)}},cbShowWeeklyTasks:function(){0<this.m_weekly_task_list.length&&this.showWeeklyTasks()},showStoryHardModeTasks:function(){if(0<this.m_story_hard_mode_task_list.length){var content,task=this.m_story_hard_mode_task_list.shift();if(this.m_task_title.setString(task.task.name),parseInt(task.task_type.task_type)==database.TaskActionType.Mission_Clear_Count){var clear_count=task.mission_clear_count;clear_count>task.task.accum_win_count&&(clear_count=task.task.accum_win_count),content=cmString(res_str("label_battle_task_content_win_count"),task.task.content,clear_count,task.task.accum_win_count)}else content=task.task.content;this.m_task_contents.setString(content);var icon_name="",item_count=0,b_icon_size=!1;if(task.mission_task.bonus_type==BONUS_TYPE_LOVE_ITEM)icon_name="img_reward_love_item_"+(task.mission_task.bonus_type<10?"0"+task.mission_task.bonus_type:task.mission_task.bonus_type)+".png",item_count=task.mission_task.min_value;else if(task.mission_task.bonus_type==BONUS_TYPE_YUNHEE_FIX){var gnrl=MasterManager.getInstance().get_General(task.mission_task.min_value);icon_name=gnrl.gnrl_type==GENERAL_TYPE_MATERIAL||gnrl.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL?"m_"+gnrl.bone_id+".png":"m_"+gnrl.gnrl_id+".png",item_count=task.mission_task.max_value,b_icon_size=!0}else item_count=(icon_name=task.mission_task.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||task.mission_task.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT?"img_reward_yh.png":"img_reward_"+(task.mission_task.bonus_type<10?"0"+task.mission_task.bonus_type:task.mission_task.bonus_type)+".png",task.mission_task.min_value);if(""!=icon_name){if(DISABLE_SPB_TP&&task.mission_task.bonus_type==BONUS_TYPE_YUNHEE_FIX)this.m_icon.setTexture(icon_name),this.m_icon.setContentSize(49,49),this.m_icon.setScale(DEF_TUMB_SCALE);else{var frame=cc.spriteFrameCache.getSpriteFrame(icon_name);this.m_icon.setSpriteFrame(frame),1==b_icon_size&&this.m_icon.setContentSize(60,60)}this.m_reward_count.setString(Number(item_count).toLocaleString("en"))}if(task.is_cleared){frame=RES_CDN_DEFULT+"menu_quest/img_story_sakura_on.png";var frame2_texture=cc.textureCache.addImage(frame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_flower.setSpriteFrame(frame2);var comFrame=RES_CDN_DEFULT+"menu_quest/img_story_complete.png";frame2_texture=cc.textureCache.addImage(comFrame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_complete.setSpriteFrame(frame2)}else{frame=RES_CDN_DEFULT+"menu_quest/img_story_sakura_off.png",frame2_texture=cc.textureCache.addImage(frame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_flower.setSpriteFrame(frame2);comFrame=RES_CDN_DEFULT+"menu_quest/img_story_fail.png",frame2_texture=cc.textureCache.addImage(comFrame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_complete.setSpriteFrame(frame2)}var size=ccSize(this),movein=cc.moveBy(.5,cc.p(-size.width,0)),delay=cc.delayTime(2),moveout=cc.moveBy(.5,cc.p(size.width,0)),delay2=cc.delayTime(.3),cb=cc.callFunc(this.cbShowStoryHardModeTasks.bind(this)),seq=cc.sequence(movein,delay,moveout,delay2,cb);this.runAction(seq)}},cbShowStoryHardModeTasks:function(){0<this.m_story_hard_mode_task_list.length&&this.showStoryHardModeTasks()},showTowerTasks:function(){if(0<this.m_tower_task_list.length){var content,task=this.m_tower_task_list.shift();if(this.m_task_title.setString(task.task.name),task.task_type.task_type==database.TaskActionType.Mission_Clear_Count){var clear_count=task.step_clear_count;clear_count>task.task.accum_win_count&&(clear_count=task.task.accum_win_count),content=task.content+"( "+clear_count+"/"+task.task.accum_win_count}else content=task.task.content;this.m_task_contents.setString(content);var icon_name="",b_icon_size=!1,b_texture=!1;if(task.bonus_type==BONUS_TYPE_YUNHEE_FIX||task.bonus_type==BONUS_TYPE_JIN_FIX){var gnrl=MasterManager.getInstance().get_General(task.bonus_value);icon_name=gnrl.gnrl_type==GENERAL_TYPE_MATERIAL||gnrl.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL?"m_"+gnrl.bone_id+".png":"m_"+gnrl.gnrl_id+".png",b_icon_size=!0}else if(task.bonus_type==BONUS_TYPE_LOVE_ITEM)icon_name="img_reward_love_item_"+(task.bonus_value<10?"0"+task.bonus_value:task.bonus_value)+".png";else if(task.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||task.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT)icon_name="img_reward_yh.png";else if(task.bonus_type==BONUS_TYPE_EQUIPMENT){var equip=MasterManager.getInstance().get_EquipmentItem(task.min_value);DISABLE_SPB_TP?(icon_name=RES_CDN_MENU_EQUIP_NTP+cmString("%s.png",equip.reward_img),b_texture=!0):icon_name=cmString("%s.png",equip.reward_img),b_icon_size=!0}else icon_name="img_reward_"+(task.bonus_type<10?"0"+task.bonus_type:task.bonus_type)+".png";if(""!=icon_name){if(cc.log("BattleMissionTaskNode icon_name = "+icon_name),0==b_texture){var frame=cc.spriteFrameCache.getSpriteFrame(icon_name);this.m_icon.setSpriteFrame(frame)}else this.m_icon.setTexture(icon_name);USE_SP_EQUIPMENT_ICON_SCALE&&(task.bonus_type==BONUS_TYPE_EQUIPMENT?(this.m_icon.setScale(2),this.m_count_bg.setScale(.5),this.m_count_bg.setPosition(20,2),this.m_icon.setPosition(60,60)):(this.m_icon.setScale(1),this.m_count_bg.setScale(1),this.m_count_bg.setPosition(34,2),this.m_icon.setPosition(34,34))),1==b_icon_size&&this.m_icon.setContentSize(60,60);var count=0;count=task.bonus_type==BONUS_TYPE_LOVE_ITEM?task.max_value:task.bonus_type==BONUS_TYPE_YUNHEE_FIX||task.bonus_type==BONUS_TYPE_JIN_FIX?task.max_value:task.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||task.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT?task.max_value:task.bonus_type==BONUS_TYPE_EQUIPMENT?task.max_value:task.min_value,this.m_reward_count.setString(Number(count).toLocaleString("en"))}if(task.is_cleared){frame=RES_CDN_DEFULT+"menu_quest/img_story_sakura_on.png";var frame2_texture=cc.textureCache.addImage(frame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_flower.setSpriteFrame(frame2);var comFrame=RES_CDN_DEFULT+"menu_quest/img_story_complete.png";frame2_texture=cc.textureCache.addImage(comFrame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_complete.setSpriteFrame(frame2)}else{frame=RES_CDN_DEFULT+"menu_quest/img_story_sakura_off.png",frame2_texture=cc.textureCache.addImage(frame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_flower.setSpriteFrame(frame2);comFrame=RES_CDN_DEFULT+"menu_quest/img_story_fail.png",frame2_texture=cc.textureCache.addImage(comFrame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_complete.setSpriteFrame(frame2)}var size=ccSize(this),movein=cc.moveBy(.5,cc.p(-size.width,0)),delay=cc.delayTime(2),moveout=cc.moveBy(.5,cc.p(size.width,0)),delay2=cc.delayTime(.3),cb=cc.callFunc(this.cbShowTowerTasks.bind(this)),seq=cc.sequence(movein,delay,moveout,delay2,cb);this.runAction(seq)}},cbShowTowerTasks:function(){0<this.m_tower_task_list.length&&this.showTowerTasks()}}),BattleOverRollProgressBar=cc.Node.extend({_fillProgressEvent:null,_emptyProgressEvent:null,_endProgressEvent:null,m_fill:null,m_final_percent:0,m_empty_img:null,ctor:function(){this._super(),this._fillProgressEvent=null,this._emptyProgressEvent=null,this._endProgressEvent=null},onExit:function(){BATTLE_TO_SHOP||(this._super(),this.removeAllChildrenWithCleanup(!0))},create:function(empty,fill){var empty_img=""!=empty?cc.Sprite.create(empty):null,fill_img=""!=fill?new cc.ProgressTimer(cc.Sprite.create(fill)):null;this.start_init(empty_img,fill_img)},start_init:function(empty,fill){if(this.m_fill=fill,null!=(this.m_empty_img=empty)){var size=this.m_empty_img.getContentSize();this.setContentSize(size),this.m_empty_img.setAnchorPoint(.5,.5),this.m_empty_img.setPosition(size.width/2,size.height/2),this.addChild(this.m_empty_img)}if(null!=this.m_fill){size=this.m_fill.getContentSize();null!=empty&&(size=this.m_empty_img.getContentSize()),this.setContentSize(size),this.m_fill.anchorX=.5,this.m_fill.anchorY=.5,this.m_fill.x=size.width/2,this.m_fill.y=size.height/2,this.m_fill.midPoint=cc.p(0,.5),this.m_fill.barChangeRate=cc.p(1,0),this.m_fill.type=cc.ProgressTimer.TYPE_BAR,this.m_fill.percentage=0,this.addChild(this.m_fill)}},setPercent:function(percent,isAnimated){if(this.m_final_percent=percent,isAnimated)if(100<=this.m_final_percent){var from=this.m_fill.getPercentage(),timer=(to=100,cc.progressFromTo(PROGRESS_DURATION,from,to)),cb=cc.callFunc(this.increaseCallback,this),seq=cc.sequence(timer,cb);this.m_fill.runAction(seq)}else{var p=this.m_final_percent;from=this.m_fill.getPercentage(),to=p%100,timer=cc.progressFromTo(PROGRESS_DURATION,from,to),cb=cc.callFunc(this.increaseEndCallback,this),seq=cc.sequence(timer,cb);this.m_fill.runAction(seq)}else if((p=Math.abs(this.m_final_percent))<=100)this.m_fill.percentage=p;else{var to=p%100;this.m_fill.percentage=to}},increaseCallback:function(){if(100<=this.m_final_percent&&(this.m_final_percent=this.m_final_percent-100),100<=this.m_final_percent){var from=0,to=100,timer=cc.progressFromTo(PROGRESS_DURATION,from,to),cb=cc.callFunc(this.increaseCallback,this),seq=cc.sequence(timer,cb);this.m_fill.runAction(seq),null!=this._fillProgressEvent&&this._fillProgressEvent(this)}else{from=0,to=this.m_final_percent%100,timer=cc.progressFromTo(PROGRESS_DURATION,from,to),cb=cc.callFunc(this.increaseEndCallback,this),seq=cc.sequence(timer,cb);this.m_fill.runAction(seq),null!=this._fillProgressEvent&&this._fillProgressEvent(this)}},getPercent:function(){return this.m_fill.getPercentage()},increaseEndCallback:function(){null!=this._endProgressEvent&&this._endProgressEvent(this)},stopOverRoll:function(){this.m_fill.stopAllActions(),this.m_fill.percentage=100}}),BattlePauseMenuLayer_SubLayer=cc.Layer.extend({ctor:function(){return this._super(),!0}}),BattlePauseMenuLayer=cc.Layer.extend({m_pause_layer:null,m_option_layer:null,m_bgm_on_off:!1,m_effect_sound_on_off:!1,m_modal_box:null,m_debug_log_box:null,m_gameObserver:null,ctor:function(){this._super(),this.init()},onExit:function(){BATTLE_TO_SHOP||(this._super(),this.removeAllChildrenWithCleanup(!0),this.m_pause_layer=null,this.m_option_layer=null,this.m_modal_box=null,this.m_debug_log_box=null,this.m_gameObserver=null,delete this.m_pause_layer,delete this.m_option_layer,delete this.m_modal_box,delete this.m_debug_log_box,delete this.m_gameObserver,delete this.m_bgm_on_off,delete this.m_effect_sound_on_off)},init:function(){return this.initLayout(),!0},initLayout:function(){this.m_gameObserver=MainObserver.getInstance(),this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(.5,.5),this.m_pause_layer=new BattlePauseMenuLayer_SubLayer,this.m_pause_layer.ignoreAnchorPointForPosition(!1),this.m_pause_layer.setAnchorPoint(.5,.5),this.m_pause_layer.setPosition(this.width/2,this.height/2),this.addChild(this.m_pause_layer);var size=this.m_pause_layer.getContentSize(),resume=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);resume.setFont(LABEL_FONT_INDEX.FONT_301),resume.setString("続ける"),resume.setAnchorPoint(.5,.5),resume.setPosition(.5*size.width,.5*size.height+100),this.m_pause_layer.addChild(resume),resume.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_battle_resume)});var option=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);option.setFont(LABEL_FONT_INDEX.FONT_301),option.setString("オプション"),option.setAnchorPoint(.5,.5),option.setPosition(size.width/2,size.height/2),this.m_pause_layer.addChild(option),option.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_OPTION)});var btn,drop=new LabelButton("btn_07_off.png","btn_07_on.png","btn_07_none.png",ccui.Widget.PLIST_TEXTURE);(drop.setFont(LABEL_FONT_INDEX.FONT_301),drop.setString("戦闘放棄"),drop.setAnchorPoint(.5,.5),drop.setPosition(.5*size.width,.5*size.height-100),this.m_pause_layer.addChild(drop),drop.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_battle_drop)}),BattleContext._getInstance().getGameType()==db.BattleGameType.WorldWarNpcDungeon&&drop.setEnabled(!1),TEST_DAMAGE_LOG_SHOW)&&((btn=new LabelButton("btn_01_off.png","btn_01_on.png","",ccui.Widget.PLIST_TEXTURE)).setFont(LABEL_FONT_INDEX.FONT_241),btn.setString("DAMAGE"),btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),btn.setPosition(size.width-10,size.height-10),this.m_pause_layer.addChild(btn),btn.addClickEventListener(function(sender){this.showDebugBox()}.bind(this)));TEST_GENERAL_LOG_SHOW&&((btn=new LabelButton("btn_01_off.png","btn_01_on.png","",ccui.Widget.PLIST_TEXTURE)).setFont(LABEL_FONT_INDEX.FONT_241),btn.setString("DEBUG"),btn.setAnchorPoint(ANCHOR_TOP_LEFT()),btn.setPosition(10,size.height-10),this.m_pause_layer.addChild(btn),btn.addClickEventListener(function(sender){this.showGeneralDebugBox()}.bind(this)));this.m_modal_box=new GameMessageBox,this.addChild(this.m_modal_box),this.m_debug_log_box=new GameModalLayer,this.addChild(this.m_debug_log_box,99999)},showDebugBox:function(){this.m_debug_log_box.setContentSize(ccSize(this)),this.m_debug_log_box._contentNode=function(contentSize,m){var layer=new BattleDebugLayer,btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);return btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),btn.setPosition(ccWidth(layer)-2,ccHeight(layer)-2),layer.addChild(btn),btn.addClickEventListener(function(sender){this.hideDebugBox()}.bind(this)),layer}.bind(this),this.m_debug_log_box.show()},hideDebugBox:function(){this.m_debug_log_box.is_show()&&this.m_debug_log_box.hide()},showGeneralDebugBox:function(){this.m_debug_log_box.setContentSize(ccSize(this)),this.m_debug_log_box._contentNode=function(contentSize,m){var layer=new BattleGeneralDebugLayer,btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);return btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),btn.setPosition(ccWidth(layer)-2,ccHeight(layer)-2),layer.addChild(btn),btn.addClickEventListener(function(sender){this.hideDebugBox()}.bind(this)),layer}.bind(this),this.m_debug_log_box.show()}}),BattleResultGeneral_V2=cc.Node.extend({m_exp:null,current_level:0,m_gnrl_level:null,m_position_label:null,m_levelup_skeleton:null,m_game_type:null,m_exp_bar:null,m_general:null,ctor:function(){this._super(),this.init()},onExit:function(){BATTLE_TO_SHOP||(this._super(),this.removeChild(this.m_levelup_skeleton),this.removeAllChildrenWithCleanup(!0),this.m_levelup_skeleton=null,this.m_exp=null,this.m_gnrl_level=null,this.m_position_label=null,this.m_game_type=null,this.m_exp_bar=null,this.m_general=null,delete this.m_levelup_skeleton,delete this.m_exp,delete this.current_level,delete this.m_gnrl_level,delete this.m_position_label,delete this.m_game_type,delete this.m_exp_bar,delete this.m_general)},init:function(){BATTLE_SCENE_MEMORY_CLEAR=!0,this.m_game_type=BattleContext._getInstance().getGameType();var size=cc.size(98,98);this.m_game_type==db.BattleGameType.GreatWallDungeon?size=cc.size(98,128):this.m_game_type==db.BattleGameType.WorldWarNpcDungeon&&(size=cc.size(98,113)),this.setContentSize(size),this.setAnchorPoint(0,0);var box_frame=null;return this.m_game_type==db.BattleGameType.GreatWallDungeon?(box_frame=new cc.Sprite(RES_CDN_DEFULT+"icon/img_icon_frame_6.png")).setContentSize(98,128):this.m_game_type==db.BattleGameType.WorldWarNpcDungeon?(box_frame=new cc.Sprite(RES_CDN_DEFULT+"icon/img_icon_frame_7.png")).setContentSize(98,113):(box_frame=new cc.Sprite(RES_CDN_DEFULT+"icon/img_icon_frame_2.png")).setContentSize(98,98),box_frame.setAnchorPoint(.5,.5),box_frame.setPosition(size.width/2,size.height/2),this.addChild(box_frame),this.m_position_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_282),this.m_position_label.setAnchorPoint(.5,.5),this.m_position_label.setPosition(box_frame.getContentSize().width/2,box_frame.getContentSize().height/2),box_frame.addChild(this.m_position_label),!0},setData:function(gnrl,exp,pos){this.m_general=gnrl,this.m_exp=exp;var position_name=new Array;position_name.push_back("前衛"),position_name.push_back("中衛"),position_name.push_back("中衛"),position_name.push_back("後衛"),position_name.push_back("後衛");var position=pos-1;this.m_position_label.setString(position_name.at(position));var size=this.getContentSize();if(0<this.m_general.gnrl_id){this.current_level=this.m_general.gnrl_level;var gnrl_exp=this.m_general.exp,m=MasterManager.getInstance(),next_level=this.current_level+1,max_level=this.m_general.general.max_level;if(3<=this.m_general.general.gnrl_class)(max_level=m.get_GeneralLimit(this.m_general.limit_step_id).ext_level_id)<next_level&&(next_level=max_level);else max_level<next_level&&(next_level=max_level);var next_exp=m.get_GeneralLevelupExpV2(this.m_general.general.level_exp_group,next_level);this.m_general.exp>next_exp.accm_exp&&(next_level<max_level?(max_level<(next_level+=1)&&(next_level=max_level),next_exp=m.get_GeneralLevelupExpV2(this.m_general.general.level_exp_group,next_level)):gnrl_exp=next_exp.accm_exp);var icon_name,per=(next_exp.need_exp-(next_exp.accm_exp-gnrl_exp))/next_exp.need_exp*100;if(this.m_exp_bar=new BattleOverRollProgressBar,this.m_exp_bar.create("#img_battle_gauge.png","#img_battle_gauge_me2.png"),this.m_exp_bar.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_exp_bar.setPosition(.5*size.width,-5),this.m_exp_bar.setPercent(per,!1),this.m_exp_bar._fillProgressEvent=this.fillProgressEvent.bind(this),this.m_exp_bar._endProgressEvent=this.endProgressEvent.bind(this),this.addChild(this.m_exp_bar),this.current_level<max_level){var gain_exp=exp.gnrl_exp,exp_level=(m.get_GeneralLevelupExpV2(this.m_general.general.level_exp_group,exp.gnrl_level),exp.gnrl_level+1);max_level<exp_level&&(exp_level=max_level),gain_exp>(next_exp=m.get_GeneralLevelupExpV2(this.m_general.general.level_exp_group,exp_level)).accm_exp&&(exp_level<max_level?(max_level<(exp_level+=1)&&(exp_level=max_level),next_exp=m.get_GeneralLevelupExpV2(this.m_general.general.level_exp_group,exp_level)):gain_exp=next_exp.accm_exp);var next_per=(next_exp.need_exp-(next_exp.accm_exp-gain_exp))/next_exp.need_exp*100,grade=exp.gnrl_level-this.current_level;0<grade&&(next_per+=100*grade),this.m_exp_bar.setPercent(next_per,!0)}if(this.m_game_type==db.BattleGameType.GreatWallDungeon||this.m_game_type==db.BattleGameType.WorldWarNpcDungeon){this.m_exp_bar.setVisible(!1);var frame_path="",bar_bg_offset_y=0;if(this.m_game_type==db.BattleGameType.GreatWallDungeon){frame_path=RES_CDN_CARD_CARD_IMG_NTP+"img_card_frame_great_wall.png",bar_bg_offset_y=16;var gw_bg=cc.Sprite.create(frame_path);DISABLE_SPB_TP&&gw_bg.setContentSize(98,34)}else if(this.m_game_type==db.BattleGameType.WorldWarNpcDungeon){frame_path=RES_CDN_CARD_CARD_IMG_NTP+"img_card_frame_world.png",bar_bg_offset_y=1;gw_bg=cc.Sprite.create(frame_path);DISABLE_SPB_TP&&gw_bg.setContentSize(98,19)}else cc.log("m_game_type error : "+this.m_game_type);gw_bg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),gw_bg.setPosition(.5*size.width,0),this.addChild(gw_bg);var gwSize=ccSize(gw_bg),bar_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero());bar_bg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bar_bg.setPreferredSize(cc.size(98,12)),bar_bg.setPosition(.5*gwSize.width,bar_bg_offset_y),gw_bg.addChild(bar_bg);var life_bar=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green.png",RectZero());life_bar.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),life_bar.setPosition(3,6),bar_bg.addChild(life_bar);var service=GeneralService.getInstance();this.m_general.rare_type=this.m_general.general.rare_type;var max_life=service.getMaxHPGeneral2(this.m_general),cur_life=max_life*this.m_general.remain_hp_rate/1e4,min_life=0;this.m_general.is_dead||(cur_life<0&&(cur_life=1),min_life=1);per=cc.clampf(cur_life/max_life*92,min_life,92);if(life_bar.setPreferredSize(cc.size(per,6)),this.m_game_type==db.BattleGameType.GreatWallDungeon){var skill_count=cmLabel.getLabel(cmString("%d",this.m_general.remain_skill_count),LABEL_FONT_INDEX.FONT_144);skill_count.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),skill_count.setTextHorizontalAlignment(cc.TEXT_ALIGNMENT_RIGHT),skill_count.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),skill_count.setPosition(gwSize.width-4,0),gw_bg.addChild(skill_count)}}icon_name=this.m_general.general.gnrl_type==GENERAL_TYPE_MATERIAL||this.m_general.general.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL?RES_CDN_CARD_MEDIUM_NTP+"m_"+this.m_general.general.bone_id+".png":RES_CDN_CARD_MEDIUM_NTP+"m_"+this.m_general.general.gnrl_id+".png";var card=null;if(IS_SP_BROWSER){(card=cc.Sprite.create(RES_CDN_DEFULT+"temp_img.png")).setContentSize(98,98),card.setAnchorPoint(.5,.5),this.addChild(card);var card2=cc.Sprite.create(icon_name);card2.setAnchorPoint(.5,.5),this.m_game_type==db.BattleGameType.WorldWarNpcDungeon?card2.setPosition(size.width/2,size.height/2-7):card2.setPosition(size.width/2,size.height/2),card2.setScale(2),card.addChild(card2)}else(card=cc.Sprite.create(icon_name)).setAnchorPoint(.5,.5),this.addChild(card);this.m_game_type==db.BattleGameType.GreatWallDungeon?card.setPosition(ccCenter(size).x,ccCenter(size).y+15):this.m_game_type==db.BattleGameType.WorldWarNpcDungeon?card.setPosition(ccCenter(size).x,ccCenter(size).y+7):card.setPosition(size.width/2,size.height/2);var lv_str,rare_bg=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_frame_"+this.m_general.general.element_type+"_"+this.m_general.general.rare_type+".png");if(DISABLE_SPB_TP&&(rare_bg.setContentSize(98,98),rare_bg.setScale(.5)),rare_bg.setAnchorPoint(.5,.5),rare_bg.setPosition(card.getContentSize().width/2,card.getContentSize().height/2),card.addChild(rare_bg),this.m_general.general.arm_service_type!=ARMSERVICETYPE_NONE){var arm_service_img=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_arm_service_"+this.m_general.general.element_type+"_"+this.m_general.general.arm_service_type+".png");DISABLE_SPB_TP&&arm_service_img.setContentSize(38,37),arm_service_img.setAnchorPoint(0,0),arm_service_img.setPosition(0,61),rare_bg.addChild(arm_service_img)}if(1<this.m_general.general.gnrl_class){var rare_type=this.m_general.general.rare_type;2==rare_type?rare_type=1:4==rare_type&&(rare_type=3);var star_unique=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_unique_"+rare_type+"_"+this.m_general.general.gnrl_class+".png");DISABLE_SPB_TP&&star_unique.setContentSize(28,16),star_unique.setAnchorPoint(1,0),star_unique.setPosition(rare_bg.getContentSize().width,28),rare_bg.addChild(star_unique)}if(lv_str="L"+this.m_general.gnrl_level,this.m_gnrl_level=cmLabel.createWithBMFont(RES_CDN_DEFULT+"card_card_img/card_lv_text2.fnt",lv_str,cc.TEXT_ALIGNMENT_CENTER),this.m_gnrl_level.setAnchorPoint(0,0),this.m_gnrl_level.setPosition(0,1),rare_bg.addChild(this.m_gnrl_level),0!=this.m_general.limit_step_id){var limit_img=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_limit_"+this.m_general.limit_step_id+".png");DISABLE_SPB_TP&&limit_img.setContentSize(19,21),limit_img.setAnchorPoint(0,0),limit_img.setPosition(0,18),rare_bg.addChild(limit_img)}var cost=cmLabel.createWithBMFont(RES_CDN_DEFULT+"card_card_img/card_cost_text.fnt","C"+this.m_general.general.cost,cc.TEXT_ALIGNMENT_RIGHT);cost.setAnchorPoint(1,1),cost.setPosition(rare_bg.getContentSize().width-2,rare_bg.getContentSize().height-2),rare_bg.addChild(cost)}this.m_levelup_skeleton=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Levelup.json",RES_CDN_DEFULT+"effect/Levelup.atlas"),this.m_levelup_skeleton.setScale(1),this.m_levelup_skeleton.setPosition(size.width/2,size.height/2),this.m_levelup_skeleton.setVisible(!1),this.addChild(this.m_levelup_skeleton)},endProgressEvent:function(bar){if(100<=bar.getPercent()){var m=MasterManager.getInstance(),max_level=this.m_general.general.max_level;if(3<=this.m_general.general.gnrl_class)max_level=m.get_GeneralLimit(this.m_general.limit_step_id).ext_level_id;if(this.current_level<max_level){this.current_level++,this.m_gnrl_level.setString("L"+this.current_level),this.m_gnrl_level.setScale(1);var scaleup=cc.scaleTo(.1,1.2),scaledown=cc.scaleTo(.1,1),seq=cc.sequence(scaleup,scaledown);this.m_gnrl_level.runAction(seq)}else this.m_gnrl_level.setString("LM")}},fillProgressEvent:function(bar){var m=MasterManager.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_level_up.mp3";AudioEngine.getInstance().playEffect(path);var max_level=this.m_general.general.max_level;3<=this.m_general.general.gnrl_class&&(max_level=m.get_GeneralLimit(this.m_general.limit_step_id).ext_level_id);if(this.current_level<max_level?(this.current_level++,this.m_gnrl_level.setString("L"+this.current_level),this.current_level>=max_level&&bar.stopOverRoll()):(this.m_gnrl_level.setString("LM"),bar.stopOverRoll()),"object"==$.type(this.m_levelup_skeleton)&&null!=this.m_levelup_skeleton&&null!=this.m_levelup_skeleton)try{this.m_levelup_skeleton.isVisible()||this.m_levelup_skeleton.setVisible(!0),this.m_levelup_skeleton.setAnimation(0,"fx_1",!1)}catch(e){cc.log(e)}}}),BattleSkillMessage=cc.Layer.extend({_cb_fade_func:null,skill_icon:null,skill_name:null,skill_bg:null,active_skill:null,current_direction:BattleMessageDirection.Left,ctor:function(){this._super(),this.init()},onExit:function(){BATTLE_TO_SHOP||(this._super(),1==BATTLE_SCENE_MEMORY_CLEAR&&(this.removeChild(this.skill_bg),this.removeChild(this.skill_icon),this.removeChild(this.skill_name),this._cb_fade_func=null,this.skill_icon=null,this.skill_name=null,this.skill_bg=null,this.active_skill=null,delete this._cb_fade_func,delete this.skill_icon,delete this.skill_name,delete this.skill_bg,delete this.active_skill,delete this.current_direction))},init:function(){return this.ignoreAnchorPointForPosition(!1),this.anchorX=0,this.anchorY=.5,this.setContentSize(0,0),this.initLayout(),!0},initLayout:function(){this.current_direction=BattleMessageDirection.Left;this.skill_bg=new cc.Sprite("#img_skill_message.png"),this.skill_bg.anchorX=0,this.skill_bg.anchorY=.5,this.skill_bg.setPosition(42,0),this.addChild(this.skill_bg),USE_ACTIVE_PASSIVE_ICON?this.skill_icon=new cc.Sprite(RES_CDN_DEFULT+"icon/active/active_10001.png"):this.skill_icon=new cc.Sprite("#active_10001.png"),this.skill_icon.setScale(.75),this.skill_icon.anchorX=0,this.skill_icon.anchorY=.5,this.skill_icon.setPosition(12,0),this.addChild(this.skill_icon),this.skill_name=cmLabel.getLabel("skill name",LABEL_FONT_INDEX.FONT_165),this.skill_name.anchorX=0,this.skill_name.anchorY=.5,this.skill_name.setPosition(65,0),this.addChild(this.skill_name),this.displayUpdate()},setBattleMessageDirection:function(direction){this.current_direction=direction,this.displayUpdate()},displayUpdate:function(){if(this.current_direction==BattleMessageDirection.Left){this.anchorX=1,this.anchorY=.5;var msg_offset=12,bg_offset=30;this.skill_bg.anchorX=0,this.skill_bg.anchorY=.5,this.skill_bg.setPosition(bg_offset,0),this.skill_icon.anchorX=0,this.skill_icon.anchorY=.5,this.skill_icon.setPosition(msg_offset,0),this.skill_name.anchorX=0,this.skill_name.anchorY=.5,this.skill_name.setPosition(53+msg_offset,0);var width=bg_offset+this.skill_bg.getContentSize().width,height=54;this.setContentSize(width,height)}else if(this.current_direction==BattleMessageDirection.Right){this.anchorX=0,this.anchorY=.5;msg_offset=12,width=(bg_offset=30)+this.skill_bg.getContentSize().width,height=54;this.setContentSize(width,height),this.skill_bg.anchorX=1,this.skill_bg.anchorY=.5,this.skill_bg.setFlippedX(!0),this.skill_bg.setPosition(width-bg_offset,0),this.skill_icon.anchorX=1,this.skill_icon.anchorY=.5,this.skill_icon.setPosition(width-msg_offset,0),this.skill_name.anchorX=1,this.skill_name.anchorY=.5,this.skill_name.setPosition(width-(53+msg_offset),0)}},showSkillMessage:function(direction,skill){if(this.lazyInitialze(),this.active_skill=$.extend({},skill),USE_ACTIVE_PASSIVE_ICON)cc.log("skill icon : "+check_icon),this.skill_icon.setTexture(RES_CDN_DEFULT+"icon/active/active_"+(skill.skill_group<10?"0"+skill.skill_group:skill.skill_group)+".png");else{var check_icon="active_"+(skill.skill_group<10?"0"+skill.skill_group:skill.skill_group)+".png";cc.log("skill icon : "+check_icon);var icon_frame=cc.spriteFrameCache.getSpriteFrame("active_"+(skill.skill_group<10?"0"+skill.skill_group:skill.skill_group)+".png");this.skill_icon.setSpriteFrame(icon_frame)}this.skill_name.setString(skill.name),this.current_direction!=direction&&(this.current_direction=direction,this.displayUpdate())},lazyInitialze:function(){this.skill_icon.opacity=255,this.skill_bg.opacity=255,this.skill_name.opacity=255},startFadeOut:function(_cb_func){this._cb_fade_func=_cb_func;var delay=cc.delayTime(5),fadeout=cc.fadeOut(1),seq=cc.sequence(delay,fadeout);this.skill_icon.runAction(seq);delay=cc.delayTime(5),fadeout=cc.fadeOut(1),seq=cc.sequence(delay,fadeout);this.skill_bg.runAction(seq);delay=cc.delayTime(5),fadeout=cc.fadeOut(1);var cb=cc.callFunc(this.cbStartFadeOut);seq=cc.sequence(delay,fadeout,cb);this.skill_name.runAction(seq)},cbStartFadeOut:function(){null!=this._cb_fade_func&&this._cb_fade_func(this),this._cb_fade_func=null},getBattleMessageDirection:function(){return this.current_direction}}),BattleSkillCutLayerV2=cc.Layer.extend({_callback_close:null,_callback_hide:null,m_gnrl_id:0,m_dim_bg:null,m_cliper:null,m_stencil:null,m_skill_frame:null,m_skill_frame_cover:null,m_gnrl_outer_body_list:null,m_gnrl_inner_body_list:null,m_skill_charge_list:null,m_skill_name:null,m_skill_frame_light:null,m_particle:null,m_particle_charge_2:null,m_particle_charge_3:null,m_general:null,m_is_cut_playing:!1,m_skill_charge_count:0,winSize:null,ctor:function(){this._super(),this.winSize=cc.director.getWinSize(),this.m_gnrl_inner_body_list=new Map,this.m_skill_charge_list=new Map,this.init()},onExit:function(){BATTLE_TO_SHOP||this._super()},init:function(){this.ignoreAnchorPointForPosition(!1),this.m_dim_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal_2.png",cc.Rect(1,1,1,1)),this.m_dim_bg.setPreferredSize(this.winSize),this.m_dim_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_dim_bg.setPosition(ccCenter(this.winSize)),this.addChild(this.m_dim_bg,LAYER_Z_ORDER.ZORDER_DIM),this.m_dim_bg.setVisible(!1),this.m_cliper=new cc.ClippingNode,this.m_cliper.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_cliper.setAlphaThreshold(.5),this.m_cliper.setPosition(0,0),this.addChild(this.m_cliper,LAYER_Z_ORDER.ZORDER_CLIPPER),this.m_skill_frame=new cc.Scale9Sprite(RES_CDN_DEFULT+"menu_skill_cut/frame.png"),this.m_skill_frame.setAnchorPoint(ANCHOR_MIDDLE()),this.m_skill_frame.setPreferredSize(cc.size(this.winSize.width,410)),this.m_skill_frame.setPosition(ccCenter(this.winSize)),this.m_cliper.addChild(this.m_skill_frame,LAYER_Z_ORDER.ZORDER_SKILL_FRAME),this.m_skill_frame_light=new cc.Sprite(RES_CDN_DEFULT+"menu_skill_cut/frame_light.png"),this.m_skill_frame_light.setAnchorPoint(ANCHOR_MIDDLE()),this.m_skill_frame_light.setScale(2),this.m_skill_frame_light.setPosition(ccCenter(this.winSize)),this.m_cliper.addChild(this.m_skill_frame_light,LAYER_Z_ORDER.ZORDER_SKILL_FRAME_LIGHT),this.m_stencil=new cc.Scale9Sprite(RES_CDN_DEFULT+"menu_skill_cut/stencil_3.png"),this.m_stencil.anchorX=.5,this.m_stencil.anchorY=.5,this.m_stencil.setPreferredSize(cc.size(this.winSize.width,354)),this.m_stencil.setPosition(ccCenter(this.winSize)),this.m_cliper.setStencil(this.m_stencil),this.m_stencil.setVisible(!1),this.m_skill_frame_cover=new cc.Scale9Sprite(RES_CDN_DEFULT+"menu_skill_cut/frame.png"),this.m_skill_frame_cover.anchorX=.5,this.m_skill_frame_cover.anchorY=.5,this.m_skill_frame_cover.setPreferredSize(cc.size(this.winSize.width,410)),this.m_skill_frame_cover.setPosition(ccCenter(this.winSize)),this.m_skill_frame_cover.setVisible(!1),this.addChild(this.m_skill_frame_cover,LAYER_Z_ORDER.ZORDER_BODY_FRAME_COVER),this.m_skill_frame_cover.setBlendFunc(cc.ONE,cc.ONE_MINUS_SRC_COLOR);for(var i=1;i<=3;i++){var charge=new cc.Sprite(RES_CDN_DEFULT+"menu_skill_cut/img_charge_"+i+".png");1==USE_SP_SKILLCUT_CHARGE&&charge.setScale(2),charge.anchorX=0,charge.anchorY=0,charge.setPosition(this.winSize.width,.5*this.winSize.height+205),this.addChild(charge,LAYER_Z_ORDER.ZORDER_SKILL_CHARGE),this.m_skill_charge_list.insert(i,charge)}return!0},setSkillGeneralList:function(gnrl_list){for(var m=MasterManager.getInstance(),i=0;i<gnrl_list.size();i++){var gnrl_id=gnrl_list.at(i),gnrl=m.get_General(gnrl_id);if(0==this.m_gnrl_inner_body_list.find(gnrl.gnrl_group)){var img="";img=gnrl.gnrl_group<10?RES_CDN_DEFULT+"menu_skill_cut/0"+gnrl.gnrl_group+".png":RES_CDN_DEFULT+"menu_skill_cut/"+gnrl.gnrl_group+".png";var body=new cc.Sprite(img);null!=body&&(body.anchorX=0,body.anchorY=0,USE_SP_SKILLCUT_CHARGE?body.setScale(2):body.setScale(1.43),body.setPosition(this.winSize.width,0),this.m_cliper.addChild(body,LAYER_Z_ORDER.ZORDER_BODY),this.m_gnrl_inner_body_list.insert(gnrl.gnrl_group,body))}}},showSkillCutGeneral2:function(gnrl,charge_count){return!this.m_is_cut_playing&&(this.m_skill_charge_count=charge_count,this.m_general=gnrl,this.m_is_cut_playing=!0,this.scheduleOnce(function(){this.showSkillCutGeneral(this.m_general.getGeneral().general.gnrl_id)},FIRST_CUT_IN_DELAY_TIME,"showSkillCutGeneral"),!0)},showSkillCutGeneral:function(gnrl_id){this.m_gnrl_id=gnrl_id;var m=MasterManager.getInstance(),m2=MasterTable.getInstance(),gnrl=m.get_General(gnrl_id),active_skill=m.get_ActiveSkill(gnrl.active_skill_id),cut_info_master=m2.get_SkillCutInfoByGnrlGroup(gnrl.gnrl_group),cut_info=$.extend({},cut_info_master),rgb_begin=(""+cut_info.begin_color).split(","),rgb_end=(""+cut_info.end_color).split(","),end_color=cc.color(rgb_end[0],rgb_end[1],rgb_end[2],1),voice=MasterTable.getInstance().get_Voice(gnrl_id,voice_skill_use,{}).voice;if(voice&&""!=voice&&"0"!=voice){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3";audio.playVoice(path)}this.m_skill_frame.opacity=128,this.m_skill_frame.setScaleY(1.5);var fadein=cc.fadeTo(1*DIM_FADE_TIME,255),scalein=cc.scaleTo(1*DIM_FADE_TIME,1,1),easein=cc.spawn(fadein,scalein).clone().easing(cc.easeExponentialOut()),delay=cc.delayTime(1*BODY_DELAY_TIME+BODY_OUT_DELAY),fadeout=cc.fadeTo(1*DIM_FADE_TIME,64),scaleout=cc.scaleTo(1*DIM_FADE_TIME,1,.05),easeout=cc.spawn(fadeout,scaleout).clone().easing(cc.easeExponentialIn()),seq=cc.sequence(easein,delay,easeout);this.m_skill_frame.runAction(seq),this.m_skill_frame_light.setScale(2,3);scalein=cc.scaleTo(DIM_FADE_TIME,2,2);if(this.m_skill_frame_light.runAction(scalein),this.m_skill_frame_light.setColor(end_color),this.m_particle=new cc.ParticleSystem(RES_CDN_DEFULT+"menu_skill_cut/horizontal.plist"),(startColor=this.m_particle.startColor).b=rgb_begin[2],startColor.g=rgb_begin[1],startColor.r=rgb_begin[0],this.m_particle.startColor=startColor,(encColor=this.m_particle.endColor).b=rgb_end[2],encColor.g=rgb_end[1],encColor.r=rgb_end[0],this.m_particle.endColor=encColor,this.m_particle.setPosition(0,.5*this.winSize.height),this.m_particle.isAutoRemoveOnFinish(),this.m_cliper.addChild(this.m_particle,LAYER_Z_ORDER.ZORDER_SKILL_FRAME_PARTICLE),2==this.m_skill_charge_count)this.m_particle_charge_2=new cc.ParticleSystem(RES_CDN_DEFULT+"menu_skill_cut/frame_charge2.plist"),(startColor=this.m_particle_charge_2.startColor).b=rgb_begin[2],startColor.g=rgb_begin[1],startColor.r=rgb_begin[0],this.m_particle_charge_2.startColor=startColor,(encColor=this.m_particle_charge_2.endColor).b=rgb_end[2],encColor.g=rgb_end[1],encColor.r=rgb_end[0],this.m_particle_charge_2.endColor=encColor,this.m_particle_charge_2.setPosition(0,.5*this.winSize.height),this.m_particle_charge_2.isAutoRemoveOnFinish(),this.m_cliper.addChild(this.m_particle_charge_2,LAYER_Z_ORDER.ZORDER_SKILL_FRAME_PARTICLE);else if(3==this.m_skill_charge_count){var startColor,encColor;this.m_particle_charge_2=new cc.ParticleSystem(RES_CDN_DEFULT+"menu_skill_cut/frame_charge2.plist"),(startColor=this.m_particle_charge_2.startColor).b=rgb_begin[2],startColor.g=rgb_begin[1],startColor.r=rgb_begin[0],this.m_particle_charge_2.startColor=startColor,(encColor=this.m_particle_charge_2.endColor).b=rgb_end[2],encColor.g=rgb_end[1],encColor.r=rgb_end[0],this.m_particle_charge_2.endColor=encColor,this.m_particle_charge_2.setPosition(0,.5*this.winSize.height),this.m_particle_charge_2.isAutoRemoveOnFinish(),this.m_cliper.addChild(this.m_particle_charge_2,LAYER_Z_ORDER.ZORDER_SKILL_FRAME_PARTICLE),this.m_particle_charge_3=new cc.ParticleSystem(RES_CDN_DEFULT+"menu_skill_cut/frame_charge3.plist"),(startColor=this.m_particle_charge_3.startColor).b=rgb_begin[2],startColor.g=rgb_begin[1],startColor.r=rgb_begin[0],this.m_particle_charge_3.startColor=startColor,(encColor=this.m_particle_charge_3.endColor).b=rgb_end[2],encColor.g=rgb_end[1],encColor.r=rgb_end[0],this.m_particle_charge_3.endColor=encColor,this.m_particle_charge_3.setPosition(0,.5*this.winSize.height),this.m_particle_charge_3.isAutoRemoveOnFinish(),this.m_cliper.addChild(this.m_particle_charge_3,LAYER_Z_ORDER.ZORDER_SKILL_FRAME_PARTICLE)}this.m_stencil.setVisible(!0),this.m_stencil.setScaleY(1.5);easein=(scalein=cc.scaleTo(1*DIM_FADE_TIME,1,1)).clone().easing(cc.easeExponentialOut()),delay=cc.delayTime(1*BODY_DELAY_TIME+BODY_OUT_DELAY),easeout=(scaleout=cc.scaleTo(1*DIM_FADE_TIME,1,.05)).clone().easing(cc.easeExponentialIn()),seq=cc.sequence(easein,delay,easeout);this.m_stencil.runAction(seq),this.m_skill_frame_cover.setVisible(!0),this.m_skill_frame_cover.setScaleY(1.5);easein=(scalein=cc.scaleTo(1*DIM_FADE_TIME,1,1)).clone().easing(cc.easeExponentialOut()),delay=cc.delayTime(1*BODY_DELAY_TIME+BODY_OUT_DELAY),easeout=(scaleout=cc.scaleTo(1*DIM_FADE_TIME,1,.05)).clone().easing(cc.easeExponentialIn()),seq=cc.sequence(easein,delay,easeout);this.m_skill_frame_cover.runAction(seq);for(var inner_body_list_key=this.m_gnrl_inner_body_list.keys(),i=0;i<inner_body_list_key.length;i++){var b=inner_body_list_key[i],body=this.m_gnrl_inner_body_list.at(b);if(b==gnrl.gnrl_group){body.setVisible(!0),body.setPosition(this.winSize.width,cut_info.body_y);var first_delay=cc.delayTime(1*BODY_FIRST_DELAY),move=(easein=(movein=cc.moveTo(1*BODY_MOVE_TIME,cc.p(cut_info.body_x,cut_info.body_y))).clone().easing(cc.easeExponentialOut()),cc.moveBy(1*BODY_DELAY_TIME,cc.p(-20,0))),cb=(easeout=(moveout=cc.moveBy(1*BODY_MOVE_TIME,cc.p(-ccWidth(body),0))).clone().easing(cc.easeExponentialIn()),cc.callFunc(this.cbShowSkillCutGeneral,this));seq=cc.sequence(first_delay,easein,move,easeout,cb);body.runAction(seq)}else body.setVisible(!1)}null!=this.m_skill_name&&(this.removeChild(this.m_skill_name),this.m_skill_name=null),this.m_skill_name=cmLabel.createWithTTF("",FONT_NAME_RGKNOW,80),this.m_skill_name.setColor(cc.color(255,255,255)),this.m_skill_name.setSkewX(13),this.m_skill_name.anchorX=1,this.m_skill_name.anchorY=0,this.m_skill_name.setPosition(0,0),this.m_skill_name.enableShadow(cc.color(0,0,0),cc.p(7,-7)),this.addChild(this.m_skill_name,LAYER_Z_ORDER.ZORDER_SKILL_NAME),this.m_skill_name.setPosition(0,0),this.m_skill_name.setString(active_skill.name),cc.log("############################# active_skill.name = "+active_skill.name+"############################"),cmLabel.autoSizeFit(this.m_skill_name,winSize.width-80,70);first_delay=cc.delayTime(1*BODY_FIRST_DELAY);var movein=cc.moveTo(1*BODY_MOVE_TIME,cc.p(this.winSize.width-60,0)),moveout=(delay=cc.delayTime(1*BODY_DELAY_TIME),cc.moveTo(1*BODY_MOVE_TIME,cc.p(2.5*this.winSize.width,0)));seq=cc.sequence(first_delay,movein,delay,moveout);this.m_skill_name.runAction(seq);var skill_charge_list_keys=this.m_skill_charge_list.keys();for(i=0;i<skill_charge_list_keys.length;i++){var c=skill_charge_list_keys[i],charge=this.m_skill_charge_list.at(c);if(c==this.m_skill_charge_count){charge.setVisible(!0),charge.setPositionX(this.winSize.width);var y=charge.getPositionY();first_delay=cc.delayTime(1*BODY_FIRST_DELAY),movein=cc.moveTo(1*BODY_MOVE_TIME,cc.p(0,y)),delay=cc.delayTime(1*BODY_DELAY_TIME),moveout=cc.moveTo(1*BODY_MOVE_TIME,cc.p(2.5*-this.winSize.width,y)),seq=cc.sequence(first_delay,movein,delay,moveout);charge.runAction(seq)}else charge.setVisible(!1)}},cbShowSkillCutGeneral:function(){this.m_dim_bg.setVisible(!1),this.m_stencil.setVisible(!1),this.m_skill_frame_cover.setVisible(!1),null!=this.m_general&&null!=this._callback_hide&&(null!=this.m_particle&&(this.m_cliper.removeChild(this.m_particle),this.m_particle=null),null!=this.m_particle_charge_2&&(this.m_cliper.removeChild(this.m_particle_charge_2),this.m_particle_charge_2=null),null!=this.m_particle_charge_3&&(this.m_cliper.removeChild(this.m_particle_charge_3),this.m_particle_charge_3=null),this._callback_hide.hideSkillCutInV2(this.m_general)),null!=this.m_skill_name&&this.m_skill_name.setString(""),this.m_is_cut_playing=!1}}),BattleSkillSlot=cc.Layer.extend({_cbBattleState:null,m_skill_icon:null,m_enable_indi_skeleton:null,m_skill_charge_indi_skeleton:null,m_skill_timer:null,m_touch_effect:null,m_origin_pos:cc.p(0,0),m_damage_effect:null,m_is_first_skill_enable_check:!1,m_general:null,m_is_enable_skill:!0,m_is_friend_skill:!1,is_pressed:!1,m_is_excute:!1,is_long_pressed:!1,tooltip_box:null,tooltip_title:null,tooltip_content:null,m_life_bar:null,m_game_type:db.BattleGameType.Mission,m_current_charget_count:INIT_SKILL_CHARGE_BUFF,m_charge_icon:null,m_remain_skill_count_label:null,m_remain_skill_count:0,m_durability_icons:[],m_durabilty_icons_name:[],ctor:function(gnrl,is_friend){this._super(),this.m_durability_icons=[],this.init(gnrl,is_friend)},create:function(gnrl,is_friend){var node=new BattleSkillSlot;return null!=node&&node.init(gnrl,is_friend)?(node.autorelease(),node):node=null},init:function(gnrl,is_friend){return this.m_is_friend_skill=is_friend,this.m_general=gnrl,this.m_is_enable_skill=!0,this.m_is_excute=!1,this.initLayout(),!0},onExit:function(){BATTLE_TO_SHOP||(this._super(),1==BATTLE_SCENE_MEMORY_CLEAR&&(this.removeChild(this.m_enable_indi_skeleton),this.removeChild(this.m_skill_charge_indi_skeleton),this.removeChild(this.m_skill_timer),this.removeAllChildrenWithCleanup(!0),this.m_enable_indi_skeleton=null,this.m_skill_charge_indi_skeleton=null,this.m_skill_timer=null))},initLayout:function(){var general;this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_game_type=BattleContext._getInstance().getGameType(),general=this.m_general.getGeneral();MasterManager.getInstance();var bg_frame=new cc.Sprite(RES_CDN_CARD_CARD_IMG_NTP+"img_card_frame_"+general.general.element_type+"_"+general.general.rare_type+".png");DISABLE_SPB_TP&&bg_frame.setContentSize(98,98),bg_frame.anchorX=.5,bg_frame.anchorY=.5;var bgSize=cc.p(110,110),bgSize2=cc.size(110,200);if(this.setContentSize(bgSize2),bg_frame.x=bgSize.x/2,bg_frame.y=bgSize.y/2,this.addChild(bg_frame,10),this.m_skill_icon=new cc.Sprite(RES_CDN_CARD_MEDIUM_NTP+"m_"+general.general.gnrl_id+".png"),IS_SP_BROWSER&&this.m_skill_icon.setScale(2),this.m_is_friend_skill){var skill_cover=new cc.Sprite("#img_gj_text.png");skill_cover.anchorX=.5,skill_cover.anchorY=.5,skill_cover.setPosition(.5*ccWidth(bg_frame),0),bg_frame.addChild(skill_cover)}this.m_skill_icon.anchorX=.5,this.m_skill_icon.anchorY=.5,this.m_skill_icon.x=bgSize.x/2,this.m_skill_icon.y=bgSize.y/2,this.addChild(this.m_skill_icon,0);ccSize(this.m_skill_icon);IS_SP_BROWSER&&cc.size(98,98);var force_type=new cc.Sprite(RES_CDN_CARD_CARD_IMG_NTP+"img_card_arm_service_"+general.general.element_type+"_"+general.general.arm_service_type+".png");if(DISABLE_SPB_TP&&force_type.setContentSize(38,37),force_type.anchorX=0,force_type.anchorY=1,force_type.setPosition(0,ccHeight(bg_frame)),bg_frame.addChild(force_type),1<general.general.gnrl_class){var rare_type=general.general.rare_type;2==rare_type?rare_type=1:4==rare_type&&(rare_type=3);var star_unique=new cc.Sprite(RES_CDN_CARD_CARD_IMG_NTP+"img_card_unique_"+rare_type+"_"+general.general.gnrl_class+".png");star_unique.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),star_unique.setPosition(ccWidth(bg_frame),28),bg_frame.addChild(star_unique)}if(0!=general.limit_step_id){var limit_img=new cc.Sprite(RES_CDN_CARD_CARD_IMG_NTP+"img_card_limit_"+general.limit_step_id+".png");DISABLE_SPB_TP&&limit_img.setContentSize(19,21),limit_img.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),limit_img.setPosition(1,0),bg_frame.addChild(limit_img)}this.m_enable_indi_skeleton=sp.SkeletonAnimation.createWithJsonFile(RES_CDN_DEFULT+"effect/Skill_active.json",RES_CDN_DEFULT+"effect/Skill_active.atlas",1),this.m_enable_indi_skeleton.x=bgSize.x/2,this.m_enable_indi_skeleton.y=bgSize.y/2,this.m_enable_indi_skeleton.setVisible(!1),this.addChild(this.m_enable_indi_skeleton,11),this.m_enable_indi_skeleton.setAnimation(0,"fx_1",!0),this.m_skill_timer=new cc.ProgressTimer(new cc.Sprite("#img_battle_progress_mask.png")),this.m_skill_timer.setColor(cc.color(166,166,166)),this.m_skill_timer.anchorX=.5,this.m_skill_timer.anchorY=.5,this.m_skill_timer.x=.5*bgSize.x,this.m_skill_timer.y=.5*bgSize.y,this.m_skill_timer.setType(cc.ProgressTimer.TYPE_RADIAL),this.m_skill_timer.setPercentage(0),this.m_skill_timer.setReverseProgress(!0),this.addChild(this.m_skill_timer,5),this.m_skill_charge_indi_skeleton=sp.SkeletonAnimation.createWithJsonFile(RES_CDN_DEFULT+"effect/Skill_charge.json",RES_CDN_DEFULT+"effect/Skill_charge.atlas",1),this.m_skill_charge_indi_skeleton.anchorX=.5,this.m_skill_charge_indi_skeleton.anchorY=.5,this.m_skill_charge_indi_skeleton.x=bgSize.x/2,this.m_skill_charge_indi_skeleton.y=bgSize.y/2,this.addChild(this.m_skill_charge_indi_skeleton,12),this.m_touch_effect=new cc.Sprite,this.m_touch_effect.anchorX=.5,this.m_touch_effect.anchorY=.5,this.m_touch_effect.x=bgSize.x/2,this.m_touch_effect.y=bgSize.y/2,this.addChild(this.m_touch_effect,15),this.m_damage_effect=new cc.Sprite("#img_hit.png"),this.m_damage_effect.anchorX=.5,this.m_damage_effect.anchorY=.5,this.m_damage_effect.x=bgSize.x/2,this.m_damage_effect.y=bgSize.y/2,this.m_damage_effect.opacity=0,this.addChild(this.m_damage_effect,6);var as=general.active_skill[0].skill;this.tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.tooltip_box.anchorX=.5,this.tooltip_box.anchorY=0,this.tooltip_box.setPosition(0,bgSize.y+10),this.tooltip_box.setVisible(!1),this.addChild(this.tooltip_box,20),this.tooltip_title=cmLabel.getLabel(as.name,LABEL_FONT_INDEX.FONT_1810),this.tooltip_title.anchorX=0,this.tooltip_title.anchorY=1,this.tooltip_box.addChild(this.tooltip_title),this.tooltip_content=cmLabel.getLabel(as.content,LABEL_FONT_INDEX.FONT_181),this.tooltip_content.anchorX=0,this.tooltip_content.anchorY=1,this.tooltip_content.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.tooltip_content.setTextAreaSize(cc.size(250,0)),this.tooltip_content.ignoreContentAdaptWithSize(!1),this.tooltip_box.addChild(this.tooltip_content);var tSize=cc.size(this.tooltip_title.getContentSize().width,this.tooltip_title.getContentSize().height),cSize=cc.size(this.tooltip_content.getContentSize().width,this.tooltip_content.getContentSize().height),t_width=cSize.width+40,t_height=cSize.height+35+tSize.height,t_size=cc.size(t_width,t_height);this.tooltip_box.setPreferredSize(t_size),this.tooltip_title.setPosition(15,this.tooltip_box.getContentSize().height-15),this.tooltip_content.setPosition(15,this.tooltip_box.getContentSize().height-20-tSize.height),((((((this.m_general._shakeSkillSlot=this).m_general._skillCooltimeProc_V2=this).m_general._skillTeamCooltimeProc=this).m_general._updateLifeBar=this).m_general._updateDurabilityEffectList=this).m_general._skillEnable=this).m_general._getIconCnt=this;var bgRect=bg_frame.getBoundingBox();if(this.m_charge_icon=new cc.Sprite,DISABLE_SPB_TP&&(this.m_charge_icon._contentSize.width=98,this.m_charge_icon._contentSize.height=40),this.m_charge_icon.anchorX=.5,this.m_charge_icon.anchorY=0,this.m_charge_icon.setPosition(bgRect.x+.5*bgRect.width,0),this.addChild(this.m_charge_icon,13),this.m_game_type==db.BattleGameType.GreatWallDungeon){var gnrl_data=this.m_general.getGeneral();this.m_remain_skill_count=gnrl_data.remain_skill_count;var gw_bg=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_frame_great_wall.png");DISABLE_SPB_TP&&gw_bg.setContentSize(98,38),gw_bg.setAnchorPoint(ANCHOR_MIDDLE_TOP()),gw_bg.setPosition(.5*bgSize.x,8),this.addChild(gw_bg,20),(gauge_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero())).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),gauge_bg.setPosition(.5*ccWidth(gw_bg),16),gauge_bg.setPreferredSize(cc.size(98,16)),gw_bg.addChild(gauge_bg,20),this.m_life_bar=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green.png",RectZero()),this.m_life_bar.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_life_bar.setPosition(3,8),gauge_bg.addChild(this.m_life_bar),this.updateLifeBar(),this.m_remain_skill_count_label=cmLabel.getLabel(cmString("%d",this.m_remain_skill_count),LABEL_FONT_INDEX.FONT_144),this.m_remain_skill_count_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_remain_skill_count_label.setTextHorizontalAlignment(cc.TEXT_ALIGNMENT_RIGHT),this.m_remain_skill_count_label.setPosition(ccWidth(gw_bg)-4,0),gw_bg.addChild(this.m_remain_skill_count_label),0==this.m_general.getGeneral().remain_skill_count&&this.skillEnable(!1)}else{var gauge_bg;(gauge_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero())).anchorX=.5,gauge_bg.anchorY=1,gauge_bg.setPosition(.5*bgSize.x,0);var t_gauge_bg_size=cc.size(98,16);gauge_bg.setPreferredSize(t_gauge_bg_size),this.addChild(gauge_bg,20),this.m_life_bar=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green_war.png",RectZero()),this.m_life_bar.anchorX=0,this.m_life_bar.anchorY=.5,this.m_life_bar.setPosition(3,8),gauge_bg.addChild(this.m_life_bar),this.updateLifeBar()}var touch_btn=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(1,1,1,1)));touch_btn.anchorX=.5,touch_btn.anchorY=.5,touch_btn.x=bgSize.x/2,touch_btn.y=bgSize.y/2;var t_touch_btn_size=cc.size(110,110);touch_btn.setPreferredSize(t_touch_btn_size),this.addChild(touch_btn),touch_btn.addTargetWithActionForControlEvents(this,this.onTouchSlot,cc.CONTROL_EVENT_TOUCH_DOWN),touch_btn.addTargetWithActionForControlEvents(this,this.onTouchSlot,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),touch_btn.addTargetWithActionForControlEvents(this,this.onTouchSlot,cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE),touch_btn.addTargetWithActionForControlEvents(this,this.onTouchSlot,cc.CONTROL_EVENT_TOUCH_CANCEL)},setSlotPosition:function(pos){this.setPosition(pos),this.m_origin_pos=pos,this.m_skill_timer&&this.m_skill_timer._renderCmd.resetVertexData()},IsAbsoluteVisible:function(){for(var cn=this,isVisible=!0;null!=cn.getParent();){if(!cn.isVisible()){isVisible=!1;break}cn=cn.getParent()}return isVisible},onTouchSlot:function(sender,_event){if(this.IsAbsoluteVisible())if(_event==cc.CONTROL_EVENT_TOUCH_DOWN){this.is_pressed=!0;var delay=cc.delayTime(.3),cb=cc.callFunc(this.cbLongPress,this),seq=cc.sequence(delay,cb);this.tooltip_box.runAction(seq)}else if(_event==cc.CONTROL_EVENT_TOUCH_CANCEL||_event==cc.CONTROL_EVENT_TOUCH_UP_INSIDE||_event==cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE){if(null!=this._cbBattleState&&this._cbBattleState.getBattleState()==BattleState.GamePlaying&&this.m_is_enable_skill){if(this.is_long_pressed)return this.is_long_pressed=!1,this.is_pressed=!1,void this.showTooltip(!1);this.m_general.IsSkillEanble()&&(this.m_general.preparedSkill(),this.touchBtnZoom(),this.m_current_charget_count=INIT_SKILL_CHARGE_BUFF)}this.is_long_pressed=!1,this.is_pressed=!1,this.showTooltip(!1)}else _event==cc.CONTROL_EVENT_TOUCH_DRAG_ENTER&&this.IsShowTooltip()&&this.showTooltip(!1)},touchBtnZoom:function(){var zoomout=cc.scaleTo(.1,.85),zoomin=cc.scaleTo(.1,1);if(IS_SP_BROWSER)zoomin=cc.scaleTo(.1,2);this.m_skill_icon.runAction(cc.sequence(zoomout,zoomin)),this.m_touch_effect.setVisible(!0);var animate=BattleAni._getInstance().getAnimate(BattleAni_.EffectSakura),cb=cc.callFunc(this.cbSakuraEnded,this);this.m_touch_effect.runAction(cc.sequence(animate,cb))},cbSakuraEnded:function(){this.m_touch_effect.setVisible(!1)},skillEnable:function(isEnable){if(this.m_is_enable_skill=isEnable,this.m_is_enable_skill?(this.m_skill_icon.setColor(cc.color(255,255,255)),this.m_enable_indi_skeleton.setVisible(!0),this.m_current_charget_count>INIT_SKILL_CHARGE_BUFF&&(this.m_charge_icon.setVisible(!0),this.m_enable_indi_skeleton.setVisible(!0))):(this.m_skill_timer.setPercentage(0),this.m_enable_indi_skeleton.setVisible(!1),this.m_skill_icon.setColor(cc.color(100,100,100)),this.showTooltip(!1),this.m_charge_icon.setVisible(!1)),this.m_game_type==db.BattleGameType.GreatWallDungeon){var gnrl=this.m_general.getGeneral();this.m_remain_skill_count!=gnrl.remain_skill_count&&(this.m_remain_skill_count=gnrl.remain_skill_count,this.m_remain_skill_count_label.setString(cmString("%d",this.m_remain_skill_count)))}},shakeSkillSlot:function(duration,strength){this.m_damage_effect.isRunning()&&this.m_damage_effect.stopAllActions(),this.m_damage_effect.opacity=0;var fadein=cc.fadeIn(.1),fadeout=cc.fadeOut(.3),seq=cc.sequence(fadein,fadeout);this.m_damage_effect.runAction(seq)},skillTeamCooltimeProc:function(isComplete,remain_time){if(this.m_is_enable_skill)if(this.m_enable_indi_skeleton.isVisible()&&this.m_enable_indi_skeleton.setVisible(!1),isComplete)this.m_general.IsAlive()?(this.m_skill_timer.setPercentage(0),this.m_enable_indi_skeleton.setVisible(!0)):this.skillEnable(!1),this.m_is_first_skill_enable_check=!0;else{remain_time<0&&(remain_time=0);var per=remain_time/TEAM_SKILL_COOLTIME*100;this.m_skill_timer.setPercentage(per)}},skillCooltimeProc_V2:function(remain_time,charge_count){if(!this.m_is_enable_skill)return this.m_charge_icon.setVisible(!1),void this.m_enable_indi_skeleton.setVisible(!1);var is_indicator=charge_count>INIT_SKILL_CHARGE_BUFF;if(this.m_enable_indi_skeleton.setVisible(is_indicator),is_indicator){if(this.m_current_charget_count!=charge_count){var is_prepared=this.m_general.getGeneral().active_skill[0].is_prepared;if(this.animation="fx_"+charge_count,this.m_enable_indi_skeleton.setAnimation(0,this.animation,!0),is_prepared||(this.m_current_charget_count=charge_count),this.m_current_charget_count>INIT_SKILL_CHARGE_BUFF){if(this.m_current_charget_count>=MAX_SKILL_CHARGE_BUFF&&(this.m_current_charget_count=MAX_SKILL_CHARGE_BUFF),IS_SP_BROWSER){var frame=cc.spriteFrameCache.getSpriteFrame("img_card_charge_"+this.m_current_charget_count+".png");this.m_charge_icon.setSpriteFrame(frame)}else{frame=cc.spriteFrameCache.getSpriteFrame("img_card_charge_"+this.m_current_charget_count+".png");this.m_charge_icon.setSpriteFrame(frame)}null==this.m_skill_charge_indi_skeleton||is_prepared||this.m_skill_charge_indi_skeleton.setAnimation(0,"fx_1",!1)}}this.m_charge_icon.setVisible(!0)}else this.m_charge_icon.setVisible(!1);if(charge_count>INIT_SKILL_CHARGE_BUFF&&(this.m_is_first_skill_enable_check=!0),this.m_game_type==db.BattleGameType.GreatWallDungeon){var gnrl=this.m_general.getGeneral();this.m_remain_skill_count!=gnrl.remain_skill_count&&(this.m_remain_skill_count=gnrl.remain_skill_count,this.m_remain_skill_count_label.setString(cmString("%d",this.m_remain_skill_count)))}if(this.m_general.IsAlive()){remain_time<0&&(remain_time=0);var per=remain_time/this.m_general.getGeneral().active_skill[0].skill.cool_time*100;this.m_skill_timer.setPercentage(per)}else this.skillEnable(!1)},getBattlePosition:function(){return this.m_general.getGeneral().position},IsEqualsGeneral:function(gnrl){return gnrl==this.m_general},showTooltip:function(isShow){if(isShow){var anchor=this.tooltip_box.getAnchorPoint();if(1==anchor.x&&0==anchor.y){var pos=this.absolutePosition(this.tooltip_box),size=ccSize(this.tooltip_box);if(pos.x+size.width>winSize.width){var bg_size=ccSize(this.m_skill_icon);this.tooltip_box.anchorX=1,this.tooltip_box.anchorY=0,this.tooltip_box.x=bg_size.width}}}this.tooltip_box.setVisible(isShow)},absolutePosition:function(target){for(var ret=target.getPosition(),cn=target,retX=0,retY=0;null!=cn.getParent()&&!(cn=cn.getParent()).getContentSize().equals(winSize);)retX=ret.x+cn.getPosition().x,retY=ret.y+cn.getPosition().y,ret=cc.p(retX,retY);return ret},cbLongPress:function(){this.is_pressed&&(this.is_long_pressed=!0,this.showTooltip(!0))},IsShowTooltip:function(){return this.tooltip_box.isVisible()},hideTooltip:function(){this.is_pressed=!1,this.is_long_pressed=!1,this.showTooltip(!1)},updateLifeBar:function(){var total_life=this.m_general.getMaxHealthPoint(),cur_life=this.m_general.getCurrentLifePoint(),rate=cur_life/total_life,width=(rate=cc.clampf(rate,0,1))*LIFE_GAUGE_WIDTH;this.m_life_bar.setPreferredSize(cc.size(width,10)),cur_life<=0?this.m_life_bar.setVisible(!1):this.m_life_bar.setVisible(!0)},updateDurabilityEffectIcon:function(list){var bgSize=ccSize(this),frameSize=ccSize(this.m_skill_icon);IS_SP_BROWSER&&(frameSize=cc.size(98,98));for(var offset_x=.5*(bgSize.width-frameSize.width),offset_y=frameSize.height+10,icon_idx=0;icon_idx<this.m_durability_icons.length;icon_idx++){(icon=this.m_durability_icons[icon_idx]).setVisible(!1),this.removeChild(icon),icon=null}this.m_durability_icons=[],this.m_durabilty_icons_name=[];for(var i=0;i<list.size();i++){for(var Input_IconName=!0,list_d=list.at(i),idx=0;idx<this.m_durabilty_icons_name.length;idx++){var Icon_Name=this.m_durabilty_icons_name[idx];Icon_Name==list_d.icon_name&&(Input_IconName=!1),Icon_Name=null}1==Input_IconName&&this.m_durabilty_icons_name.push_back(list_d.icon_name),list_d=null}var icon_order=0;for(i=0;i<this.m_durabilty_icons_name.length;i++){var d=this.m_durabilty_icons_name[i];if("0"!=d&&null!=d&&null!=d&&""!=d){var step=parseInt(icon_order/3),remain=parseInt(icon_order%3);if(0<step&&0==remain&&(offset_x=.5*(bgSize.width-frameSize.width),offset_y+=31),d.includes("trans_")){var icon_name=d.replace("trans_","");if(USE_ACTIVE_PASSIVE_ICON){var icon=new cc.Sprite(RES_CDN_DEFULT+"icon/passive/"+icon_name);cc.log("########BattleSkillSlot icon Name = "+icon_name),icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),icon.setPosition(offset_x,offset_y),icon.setScale(.5),this.addChild(icon),this.m_durability_icons.push_back(icon)}else{icon=new cc.Sprite("#"+icon_name);cc.log("########BattleSkillSlot icon Name = "+icon_name),icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),icon.setPosition(offset_x,offset_y),icon.setScale(.5),this.addChild(icon),this.m_durability_icons.push_back(icon)}}else if(USE_ACTIVE_PASSIVE_ICON)if(d.includes("passive_")){icon=new cc.Sprite(RES_CDN_DEFULT+"icon/passive/"+d);cc.log("########BattleSkillSlot icon Name = "+d),icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),icon.setPosition(offset_x,offset_y),icon.setScale(.5),this.addChild(icon),this.m_durability_icons.push_back(icon)}else{icon=new cc.Sprite(RES_CDN_DEFULT+"icon/active/"+d);cc.log("########BattleSkillSlot icon Name = "+d),icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),icon.setPosition(offset_x,offset_y),icon.setScale(.5),this.addChild(icon),this.m_durability_icons.push_back(icon)}else{icon=new cc.Sprite("#"+d);cc.log("########BattleSkillSlot icon Name = "+d),icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),icon.setPosition(offset_x,offset_y),icon.setScale(.5),this.addChild(icon),this.m_durability_icons.push_back(icon)}offset_x+=31,icon_order+=1}}},getBufIconCnt:function(count){for(var idx=0;idx<this.m_durability_icons.length;idx++)this.m_durability_icons[idx].isVisible()&&0}}),BattleStoryScriptLayerV2=cc.Layer.extend({_scriptViewComplete:null,m_label:null,m_script_list:null,m_script_index:0,m_bg_frame:null,m_bg_script_name:null,m_name_label:null,m_finger:null,m_left_hero:null,m_middle_hero:null,m_right_hero:null,m_left_emotion:null,m_middle_emotion:null,m_right_emotion:null,m_user_info:null,m_script_bg:null,m_script_cover:null,m_attack_cover:null,m_cliper:null,m_stencil_node:null,m_is_complete:!1,m_is_doing_transition_scene:!1,m_is_doing_attack_scene:!1,battleObserver:null,m_hero_left_script:null,m_hero_middle_script:null,m_hero_right_script:null,m_hero_left_script_texture:null,m_hero_middle_script_texture:null,m_hero_right_script_texture:null,winSize:null,m_resource_list:null,m_body_img:null,m_bg_mask:null,m_use_Add_Scale:1,m_btn_container:null,m_show_btn:null,m_auto_forward_btns:[],m_auto_effect:null,m_ff_effect:null,m_auto_icon:null,m_status:null,m_script_type:SCRIPT_TYPE.MISSION,m_script_delta_time:0,m_touch_delay_time:0,m_log_box:null,m_front_particle:null,m_back_particle:null,m_script_Index_label:null,ctor:function(){return this._super(),this.m_script_list=[],this.m_auto_forward_btns=[],this.winSize=cc.director.getWinSize(),this.battleObserver=MainObserver.getInstance(),this.m_script_type=SCRIPT_TYPE.MISSION,this.init(),USE_SP_CARD_SCRIPT_BODY_SCALE?this.m_use_Add_Scale=2:this.m_use_Add_Scale=1,!0},onExit:function(){if(!BATTLE_TO_SHOP){if(this._super(),this.unschedule(this.update),null!=this.m_resource_list&&null!=this.m_resource_list)for(var i=0;i<this.m_resource_list.length;i++)cc.loader.release(this.m_resource_list[i]);null!=this.m_body_img&&null!=this.m_body_img&&cc.loader.release(this.m_body_img),this.removeAllChildrenWithCleanup(!0),this._scriptViewComplete=null,this.m_label=null,this.m_script_list=null,this.m_bg_frame=null,this.m_bg_script_name=null,this.m_name_label=null,this.m_finger=null,this.m_left_hero=null,this.m_middle_hero=null,this.m_right_hero=null,this.m_left_emotion=null,this.m_middle_emotion=null,this.m_right_emotion=null,this.m_user_info=null,this.m_script_bg=null,this.m_script_cover=null,this.m_attack_cover=null,this.m_cliper=null,this.m_stencil_node=null,this.battleObserver=null,this.m_hero_left_script=null,this.m_hero_middle_script=null,this.m_hero_right_script=null,this.m_hero_left_script_texture=null,this.m_hero_middle_script_texture=null,this.m_hero_right_script_texture=null,this.winSize=null,this.m_resource_list=null,this.m_body_img=null,this.m_bg_mask=null,this.m_btn_container=null,this.m_show_btn=null,this.m_auto_forward_btns=null,this.m_auto_effect=null,this.m_ff_effect=null,this.m_auto_icon=null,this.m_status=null,this.m_script_type=null,this.m_log_box=null,this.m_front_particle=null,this.m_back_particle=null,this.m_script_Index_label=null,delete this._scriptViewComplete,delete this.m_label,delete this.m_script_list,delete this.m_bg_frame,delete this.m_bg_script_name,delete this.m_name_label,delete this.m_finger,delete this.m_left_hero,delete this.m_middle_hero,delete this.m_right_hero,delete this.m_left_emotion,delete this.m_middle_emotion,delete this.m_right_emotion,delete this.m_user_info,delete this.m_script_bg,delete this.m_script_cover,delete this.m_attack_cover,delete this.m_cliper,delete this.m_stencil_node,delete this.battleObserver,delete this.m_hero_left_script,delete this.m_hero_middle_script,delete this.m_hero_right_script,delete this.m_hero_left_script_texture,delete this.m_hero_middle_script_texture,delete this.m_hero_right_script_texture,delete this.winSize,delete this.m_script_index,delete this.m_is_complete,delete this.m_is_doing_transition_scene,delete this.m_is_doing_attack_scene,delete this.m_bg_mask,delete this.m_btn_container,delete this.m_show_btn,delete this.m_auto_forward_btns,delete this.m_auto_effect,delete this.m_ff_effect,delete this.m_auto_icon,delete this.m_status,delete this.m_script_type,delete this.m_log_box,delete this.m_front_particle,delete this.m_back_particle,delete this.m_script_Index_label,delete this.m_script_delta_time,delete this.m_touch_delay_time}},init:function(){BattleAni._getInstance().Is_loaded()||BattleAni._getInstance().loadAnimate(),this.m_user_info=NetService().get_User_info(),this.ignoreAnchorPointForPosition(!1),this.setContentSize(this.winSize),this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setPosition(ZERO()),this.m_script_bg=cc.Sprite.create(RES_CDN_DEFULT+"card_script_bg/116.jpg"),USE_SP_SCRIPT_BG_SCALE&&this.m_script_bg.setScale(2),this.m_script_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_script_bg.setPosition(ccCenter(this.winSize)),this.addChild(this.m_script_bg),this.m_left_hero=new cc.Sprite,this.m_left_hero.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_left_hero.setPosition(.5*ccWidth(this.m_left_hero)*(1.4*this.m_use_Add_Scale),0),this.m_left_hero.setScale(1.4*this.m_use_Add_Scale),this.addChild(this.m_left_hero);var l_size=ccSize(this.m_left_hero);this.m_left_emotion=new cc.Sprite,this.m_left_emotion.setAnchorPoint(ANCHOR_MIDDLE()),this.m_left_emotion.setPosition(.5*l_size.width,l_size.height-70),this.m_left_hero.addChild(this.m_left_emotion,-1),this.m_middle_hero=new cc.Sprite,this.m_middle_hero.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_middle_hero.setPosition(.5*this.winSize.width,0),this.m_middle_hero.setScale(1.4*this.m_use_Add_Scale),this.addChild(this.m_middle_hero);var m_size=ccSize(this.m_middle_hero);this.m_middle_emotion=new cc.Sprite,this.m_middle_emotion.setAnchorPoint(ANCHOR_MIDDLE()),this.m_middle_emotion.setPosition(.5*m_size.width,m_size.height-70),this.m_middle_hero.addChild(this.m_middle_emotion,-1),this.m_right_hero=new cc.Sprite,this.m_right_hero.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_right_hero.setPosition(this.winSize.width-.5*ccWidth(this.m_right_hero)*(1.4*this.m_use_Add_Scale),0),this.m_right_hero.setScale(1.4*this.m_use_Add_Scale),this.addChild(this.m_right_hero);var r_size=ccSize(this.m_right_hero);this.m_right_emotion=new cc.Sprite,this.m_right_emotion.setAnchorPoint(ANCHOR_MIDDLE()),this.m_right_emotion.setPosition(.5*r_size.width,r_size.height-70),this.m_right_hero.addChild(this.m_right_emotion,-1);var boxSize=cc.size(this.winSize.width,212);this.m_bg_frame=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_script.png",cc.Rect(40,40,44,40)),this.m_bg_frame.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bg_frame.setPreferredSize(boxSize),this.m_bg_frame.setPosition(.5*winSize.width,0),this.addChild(this.m_bg_frame),this.m_bg_script_name=new cc.Node,this.m_bg_script_name.setAnchorPoint(ZERO()),this.m_bg_script_name.setPosition(77,154),this.m_bg_script_name.setVisible(!1),this.m_bg_frame.addChild(this.m_bg_script_name);var ic_mark=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_txtmark.png");if(ic_mark.setAnchorPoint(ZERO()),ic_mark.setPosition(0,4),this.m_bg_script_name.addChild(ic_mark),this.m_name_label=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_2871,!1,!0,2,cc.color(0,0,0)),this.m_name_label.setAnchorPoint(ZERO()),this.m_name_label.setPosition(ccWidth(ic_mark)+7,-9),this.m_bg_script_name.addChild(this.m_name_label),this.m_finger=new cc.Sprite,IS_SP_BROWSER?(this.m_finger.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_finger.setPosition(boxSize.width-7,7)):(this.m_finger.setAnchorPoint(ANCHOR_MIDDLE()),this.m_finger.setPosition(boxSize.width-58,55)),this.m_bg_frame.addChild(this.m_finger),NOT_USE_SP_BATTLE_ANIMATION){this.m_finger.setScale(2),this.m_finger.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/img_script_dialog_01.png");var scaleTo_1=new cc.ScaleTo(.2,2.03,2.03),scaleTo_2=new cc.ScaleTo(.2,1.97,1.97),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);this.m_finger.runAction(repeat),repeat=sequence=scaleTo_2=scaleTo_1=null}else{var animate=BattleAni._getInstance().getAnimate(BattleAni_.EffectFinger);this.m_finger.runAction(animate.repeatForever()),animate=null}this.m_label=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_2471,!1,!0,2,cc.color(0,0,0)),this.m_label.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_label.setPosition(98,ccHeight(this.m_bg_frame)-72),this.m_label.setTextAreaSize(cc.size(boxSize.width-200,boxSize.height)),this.m_label.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_label.setTextHorizontalAlignment(cc.TEXT_ALIGNMENT_LEFT),this.m_label.ignoreContentAdaptWithSize(!1),this.m_bg_frame.addChild(this.m_label);var touch_button=new cc.ControlButton(new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(1,1,1,1)));touch_button.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),touch_button.setPreferredSize(this.winSize),touch_button.setPosition(ZERO()),this.addChild(touch_button),touch_button.addTargetWithActionForControlEvents(this,this.onTouchTalkBox,cc.CONTROL_EVENT_TOUCH_DOWN),this.m_script_cover=new cc.Sprite(RES_CDN_DEFULT+"card_script_bg/116.jpg"),USE_SP_SCRIPT_BG_SCALE&&this.m_script_cover.setScale(2),this.m_script_cover.setAnchorPoint(ANCHOR_MIDDLE()),this.m_script_cover.setPosition(ccCenter(this.winSize)),this.m_script_cover.setOpacity(0),this.addChild(this.m_script_cover);var container=new cc.Layer;container.ignoreAnchorPointForPosition(!1),container.setContentSize(this.winSize),container.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),container.setPosition(ZERO()),this.addChild(container),this.m_cliper=new cc.ClippingNode,this.m_cliper.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_cliper.setAlphaThreshold(.5),this.m_cliper.setPosition(ZERO()),container.addChild(this.m_cliper),this.m_stencil_node=new cc.Node,this.m_stencil_node.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_stencil_node.setPosition(this.winSize.width,0),this.m_cliper.setStencil(this.m_stencil_node);var spot=new cc.Sprite(RES_CDN_DEFULT+"card_script_bg/116.jpg");return USE_SP_SCRIPT_BG_SCALE&&spot.setScale(2),spot.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),spot.setPosition(ZERO()),this.m_stencil_node.addChild(spot),this.m_stencil_node.setContentSize(ccSize(spot)),this.m_attack_cover=new cc.Sprite(RES_CDN_DEFULT+"uieffect_2/attack_1.png"),this.m_attack_cover.setAnchorPoint(ANCHOR_MIDDLE()),this.m_attack_cover.setPosition(ccCenter(this.winSize)),this.m_cliper.addChild(this.m_attack_cover),this.m_log_box=new GameModalLayer,this.addChild(this.m_log_box,99999),this.initMenu(),this.schedule(this.update,.5),DEV_TEST_SCRIPT&&(this.m_script_Index_label=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_2075,!1,!0,2,cc.color(0,0,0)),this.m_script_Index_label.setAnchorPoint(ZERO()),this.m_script_Index_label.setPosition(20,20),this.m_script_Index_label.setVisible(!0),this.addChild(this.m_script_Index_label)),!0},onEnter:function(){this._super()},reset:function(){this.m_script_index=0,this.m_is_complete=!1,this.m_script_list.length=0,this.m_left_hero.setVisible(!1),this.m_left_hero.setOpacity(0),this.m_middle_hero.setVisible(!1),this.m_middle_hero.setOpacity(0),this.m_right_hero.setVisible(!1),this.m_right_hero.setOpacity(0)},loadScript:function(main_mission_id,occured_type){var mission={};if(BattleService.getInstance().getMainMissionInfo(main_mission_id,mission),0!=GameDefault.getInstance().getOptionStory()&&"y"==mission.complete_yn)return!1;this.reset();var m=MasterTable.getInstance();this.m_script_list=m.get_MainMissionScript(main_mission_id,occured_type,this.m_script_list),null!=this.m_resource_list&&null!=this.m_resource_list||(this.m_resource_list=[]),this.m_hero_left_script=[],this.m_hero_middle_script=[],this.m_hero_right_script=[],this.m_hero_left_script_texture=[],this.m_hero_middle_script_texture=[],this.m_hero_right_script_texture=[];for(var idx=0;idx<this.m_script_list.length;idx++){if(this.m_script_list[idx].voice,"0"!=this.m_script_list[idx].r_filename)if(this.m_resource_list.push(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].r_filename+".png"),0!=this.m_hero_right_script.length)-1==this.m_hero_right_script.indexOf(this.m_script_list[idx].r_filename)&&(this.m_hero_right_script.push(this.m_script_list[idx].r_filename),this.m_hero_right_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].r_filename+".png")));else this.m_hero_right_script.push(this.m_script_list[idx].r_filename),this.m_hero_right_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].r_filename+".png"));if("0"!=this.m_script_list[idx].m_filename)if(this.m_resource_list.push(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].m_filename+".png"),0!=this.m_hero_middle_script.length)-1==this.m_hero_middle_script.indexOf(this.m_script_list[idx].m_filename)&&(this.m_hero_middle_script.push(this.m_script_list[idx].m_filename),this.m_hero_middle_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].m_filename+".png")));else this.m_hero_middle_script.push(this.m_script_list[idx].m_filename),this.m_hero_middle_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].m_filename+".png"));if("0"!=this.m_script_list[idx].l_filename)if(this.m_resource_list.push(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].l_filename+".png"),0!=this.m_hero_left_script.length)-1==this.m_hero_left_script.indexOf(this.m_script_list[idx].m_filename)&&(this.m_hero_left_script.push(this.m_script_list[idx].l_filename),this.m_hero_left_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].l_filename+".png")));else this.m_hero_left_script.push(this.m_script_list[idx].l_filename),this.m_hero_left_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].l_filename+".png"));"0"!=this.m_script_list[idx].bg_num&&this.m_resource_list.push(RES_CDN_DEFULT+"card_script_bg/"+this.m_script_list[idx].bg_num+".jpg")}return resourceLoader(this.m_resource_list,function(){cc.log("resourceLoader")}.bind(this)),0!=this.m_script_list.length},updateScript:function(script){var audio=AudioEngine.getInstance();if(0<script.bg_num&&this.updateBG(script.bg_num),this.updateName(script.name),"0"==script.name?(this.m_name_label.setVisible(!1),this.m_bg_script_name.setVisible(!1)):(this.m_name_label.setVisible(!0),this.m_bg_script_name.setVisible(!0)),"0"==script.l_filename)if(USE_SCRIPT_FADE){if(0!=this.m_script_index){if("0"!=this.m_script_list[this.m_script_index-1].l_filename){this.m_left_hero.setOpacity(255);var fadeout=new cc.FadeOut(APPEAR_DURATION);this.m_left_hero.runAction(fadeout)}}}else this.m_left_hero.setVisible(!1);else{this.m_left_hero.setVisible(!0),this.m_left_hero.setOpacity(255);var body_l_check=this.m_hero_left_script.indexOf(script.l_filename);if(-1!=body_l_check){var frame2_texture_left=this.m_hero_left_script_texture[body_l_check],frame2_left=new cc.SpriteFrame(frame2_texture_left,cc.rect(0,0,frame2_texture_left.getContentSize().width,frame2_texture_left.getContentSize().height));this.m_left_hero.setSpriteFrame(frame2_left)}1==script.onoff||4==script.onoff?this.m_left_hero.setColor(cc.color(255,255,255)):0!=script.onoff&&2!=script.onoff&&3!=script.onoff||this.m_left_hero.setColor(cc.color(166,166,166)),this.m_left_hero.setPosition(.5*ccWidth(this.m_left_hero)*(1.4*this.m_use_Add_Scale),0),this.m_left_hero.isRunning()&&(this.m_left_hero.stopAllActions(),this.m_left_hero.setPosition(.5*ccWidth(this.m_left_hero)*(1.4*this.m_use_Add_Scale),0),this.m_left_hero.setScale(1.4*this.m_use_Add_Scale),this.m_left_hero.setOpacity(255)),this.appearHero(HERO_LEFT,script.l_appear_type,this.m_left_hero),this.heroEmotion(script.l_emotion,this.m_left_hero,this.m_left_emotion),1==script.l_reverse?this.m_left_hero.setFlippedX(!0):this.m_left_hero.setFlippedX(!1)}if("0"==script.m_filename)if(USE_SCRIPT_FADE){if(0!=this.m_script_index){if("0"!=this.m_script_list[this.m_script_index-1].m_filename){this.m_middle_hero.setOpacity(255);fadeout=new cc.FadeOut(APPEAR_DURATION);this.m_middle_hero.runAction(fadeout)}}}else this.m_middle_hero.setVisible(!1);else{this.m_middle_hero.setVisible(!0),this.m_middle_hero.setOpacity(255);var body_m_check=this.m_hero_middle_script.indexOf(script.m_filename);if(-1!=body_m_check){var frame2_texture_middle=this.m_hero_middle_script_texture[body_m_check],frame2_middle=new cc.SpriteFrame(frame2_texture_middle,cc.rect(0,0,frame2_texture_middle.getContentSize().width,frame2_texture_middle.getContentSize().height));this.m_middle_hero.setSpriteFrame(frame2_middle)}3==script.onoff||4==script.onoff?this.m_middle_hero.setColor(cc.color(255,255,255)):0!=script.onoff&&1!=script.onoff&&2!=script.onoff||this.m_middle_hero.setColor(cc.color(166,166,166)),this.m_middle_hero.setPosition(.5*this.winSize.width,0),this.m_middle_hero.isRunning()&&(this.m_middle_hero.stopAllActions(),this.m_middle_hero.setPosition(.5*this.winSize.width,0),this.m_middle_hero.setScale(1.4*this.m_use_Add_Scale),this.m_middle_hero.setOpacity(255)),this.appearHero(HERO_CENTER,script.m_appear_type,this.m_middle_hero),this.heroEmotion(script.m_emotion,this.m_middle_hero,this.m_middle_emotion)}if("0"==script.r_filename)if(USE_SCRIPT_FADE){if(0!=this.m_script_index){if("0"!=this.m_script_list[this.m_script_index-1].r_filename){this.m_right_hero.setOpacity(255);fadeout=new cc.FadeOut(APPEAR_DURATION);this.m_right_hero.runAction(fadeout)}}}else this.m_right_hero.setVisible(!1);else{this.m_right_hero.setVisible(!0),this.m_right_hero.setOpacity(255);var body_r_check=this.m_hero_right_script.indexOf(script.r_filename);if(-1!=body_r_check){var frame2_texture_right=this.m_hero_right_script_texture[body_r_check],frame2_right=new cc.SpriteFrame(frame2_texture_right,cc.rect(0,0,frame2_texture_right.getContentSize().width,frame2_texture_right.getContentSize().height));this.m_right_hero.setSpriteFrame(frame2_right)}2==script.onoff||4==script.onoff?this.m_right_hero.setColor(cc.color(255,255,255)):0!=script.onoff&&1!=script.onoff&&3!=script.onoff||this.m_right_hero.setColor(cc.color(166,166,166)),this.m_right_hero.setPosition(this.winSize.width-.5*ccWidth(this.m_right_hero)*(1.4*this.m_use_Add_Scale),0),this.m_right_hero.isRunning()&&(this.m_right_hero.stopAllActions(),this.m_right_hero.setPosition(this.winSize.width-.5*ccWidth(this.m_right_hero)*(1.4*this.m_use_Add_Scale),0),this.m_right_hero.setScale(1.4*this.m_use_Add_Scale),this.m_right_hero.setOpacity(255)),this.appearHero(HERO_RIGHT,script.r_appear_type,this.m_right_hero),this.heroEmotion(script.r_emotion,this.m_right_hero,this.m_right_emotion),1==script.r_reverse?this.m_right_hero.setFlippedX(!0):this.m_right_hero.setFlippedX(!1)}if(0<script.count){var nickname=this.m_user_info.nickname;if(1==script.count){this.m_label.setString(cmString(script.content,nickname));var line=SCRIPTCOUNT(cmString(script.content,nickname),39);this.m_label.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_label.setTextAreaSize(cc.size(950,22*line+25)),this.m_label.ignoreContentAdaptWithSize(!1)}else 2==script.count||3==script.count||script.count}else{this.m_label.setString(script.content);line=SCRIPTCOUNT(script.content,39);this.m_label.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_label.setTextAreaSize(cc.size(950,22*line+25)),this.m_label.ignoreContentAdaptWithSize(!1)}if(USE_SCRIPT_BGM&&null!=script.bgm&&null!=script.bgm)if("0"==script.bgm);else if("1"==script.bgm)audio.stopBackgroundMusic();else{var b_path=RES_CDN_SOUND+SND_TYPE+"sound/"+script.bgm+".mp3";audio.m_bgmPath!=b_path&&audio.playBackgroundMusic(b_path,!0)}if("0"!=script.sound){var path=RES_CDN_SOUND+SND_TYPE+"voice_etc/"+script.sound+".mp3";audio.playVoice(path)}this.isRunning()&&(this.stopAllActions(),this.setPosition(ZERO())),this.m_script_index++,this.m_script_index>=this.m_script_list.length&&(this.m_script_index=this.m_script_list.length-1,this.m_is_complete=!0)},typingBattleScript:function(){if(this.m_is_complete){if(null!=this._scriptViewComplete){BattleContext._getInstance();AudioEngine.getInstance().stopBackgroundMusic(),this._scriptViewComplete(this)}}else if(this.m_script_index<this.m_script_list.length){var script=this.m_script_list[this.m_script_index];if(DEV_TEST_SCRIPT&&this.m_script_Index_label.setString(cmString("%d/%d",this.m_script_index+1,this.m_script_list.length)),script.scene_type==SCENE_TYPE_ATTACK)return void this.startAttackEffect(script.scene_desc);if(script.scene_type==SCENE_TYPE_TRANSITION){this.m_is_doing_transition_scene=!0;var fadeout=cc.fadeIn(1),cb=cc.callFunc(this.cbMiddleSceneTransition.bind(this)),seq=cc.sequence(fadeout,cb);return void this.m_script_cover.runAction(seq)}if(script.scene_type==SCENE_TYPE_SHAKE)script.scene_desc;this.updateScript(script)}},startAttackEffect:function(scene_desc){this.m_is_doing_attack_scene=!0;var body_img=RES_CDN_DEFULT+"uieffect_2/attack_"+scene_desc+".png",frame2_texture=cc.textureCache.addImage(body_img),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));if(this.m_attack_cover.setSpriteFrame(frame2),scene_desc==ATTACK_TYPE_CUT?this.m_stencil_node.setPosition(0,this.winSize.height):scene_desc==ATTACK_TYPE_STRING?this.m_stencil_node.setPosition(0,-this.winSize.height):scene_desc==ATTACK_TYPE_FIST?this.m_stencil_node.setPosition(ZERO()):scene_desc==ATTACK_TYPE_ARROW?this.m_stencil_node.setPosition(this.winSize.width,0):scene_desc==ATTACK_TYPE_UP_DOWN&&this.m_stencil_node.setPosition(0,this.winSize.height),scene_desc==ATTACK_TYPE_FIST){this.m_attack_cover.setOpacity(0);var fadein=new cc.FadeIn(ATTACK_DURATION),delay=new cc.DelayTime(.5),cb=new cc.CallFunc(this.cbMiddleAttackEffect.bind(this)),seq=new cc.Sequence(fadein,delay,cb);this.m_attack_cover.runAction(seq)}else{this.m_attack_cover.setOpacity(255);var ease=new cc.MoveTo(ATTACK_DURATION,cc.p(0,0)).clone().easing(cc.easeOut(ATTACK_DURATION-.1));delay=cc.delayTime(.5),cb=cc.callFunc(this.cbMiddleAttackEffect.bind(this)),seq=cc.sequence(ease,delay,cb);this.m_stencil_node.runAction(seq)}},cbMiddleAttackEffect:function(){var fade=cc.fadeOut(APPEAR_DURATION),cb=cc.callFunc(this.cbEndAttackEffect.bind(this)),seq=cc.sequence(fade,cb);this.m_attack_cover.runAction(seq),this.m_script_index++,this.m_script_index>=this.m_script_list.length&&(this.m_script_index=this.m_script_list.length-1,this.m_is_complete=!0),this.typingBattleScript()},cbEndAttackEffect:function(){this.m_is_doing_attack_scene=!1},cbMiddleSceneTransition:function(){var fadein=cc.fadeOut(1),cb=cc.callFunc(this.cbEndSceneTransition.bind(this)),seq=cc.sequence(fadein,cb);this.m_script_cover.runAction(seq),this.m_script_index++,this.m_script_index>=this.m_script_list.length&&(this.m_script_index=this.m_script_list.length-1,this.m_is_complete=!0),this.typingBattleScript()},cbEndSceneTransition:function(){this.m_is_doing_transition_scene=!1},appearHero:function(heroSide,type,hero){if(type==APPEAR_TYPE_FADE_IN){hero.setOpacity(0);var fadein=new cc.FadeIn(APPEAR_DURATION);hero.runAction(fadein)}else if(type==APPEAR_TYPE_SHAKE){var shake=new Shake(APPEAR_DURATION,15);hero.runAction(shake)}else if(type==APPEAR_TYPE_BOMB){hero.setScale(3*this.m_use_Add_Scale);var scale=new cc.ScaleTo(.1,1.4*this.m_use_Add_Scale),ease=new cc.EaseBounceOut(scale);hero.runAction(ease)}else{if(1==this.ActorAppearOfCondition(heroSide)){hero.setOpacity(0);fadein=new cc.FadeIn(APPEAR_DURATION);hero.runAction(fadein)}}},heroEmotion:function(type,hero,emotion){if(0==type)emotion.setVisible(!1);else{var n_size=ccSize(hero);if(emotion.setVisible(!0),emotion.setPosition(.5*n_size.width,n_size.height-70+35),emotion.isRunning()&&emotion.stopAllActions(),NOT_USE_SP_BATTLE_ANIMATION){if(type-1==1){emotion.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/upset01.png");var fadeout=new cc.FadeOut(.5),fadein=new cc.FadeIn(.5),sequence=new cc.Sequence(fadeout,fadein);repeat=new cc.RepeatForever(sequence);emotion.runAction(repeat),repeat=sequence=fadein=fadeout=null}else if(type-1==2){emotion.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/angry01.png");var scaleTo_1=new cc.ScaleTo(.3,1,1),scaleTo_2=new cc.ScaleTo(.3,1.05,1.05);sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);emotion.runAction(repeat),repeat=sequence=scaleTo_2=scaleTo_1=null}else if(type-1==3){emotion.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/shine01.png");fadeout=new cc.FadeOut(.2),fadein=new cc.FadeIn(.2),sequence=new cc.Sequence(fadein,fadeout),repeat=new cc.RepeatForever(sequence);emotion.runAction(repeat),repeat=sequence=fadein=fadeout=null}else if(type-1==4){emotion.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/dark.png");scaleTo_1=new cc.ScaleTo(.3,1,1),scaleTo_2=new cc.ScaleTo(.3,1.03,1.03),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);emotion.runAction(repeat),repeat=sequence=scaleTo_2=scaleTo_1=null}}else{var animate=BattleAni._getInstance().getAnimate(BattleAni_.EffectEmotion_1+(type-1)),repeat=animate.repeatForever();emotion.runAction(repeat),repeat=animate=null}}},IsReady:function(){return 0!=this.m_script_list.length},onTouchTalkBox:function(sender,_event){this.isVisible()&&!this.m_show_btn.isVisible()&&(this.m_is_doing_transition_scene||this.m_is_doing_attack_scene||this.m_touch_delay_time<.4||(this.m_touch_delay_time=0,this.typingBattleScript()))},updateBG:function(bg_num){this.m_body_img=RES_CDN_DEFULT+"card_script_bg/"+bg_num+".jpg",resourceLoader(this.m_body_img,function(){var frame2_texture=cc.textureCache.addImage(this.m_body_img),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_script_bg.setSpriteFrame(frame2)}.bind(this))},updateName:function(name){"0"==name?this.m_name_label.setString(""):"1"==name?this.m_name_label.setString(this.m_user_info.nickname):this.m_name_label.setString(name)},initMenu:function(){var winSize=cc.director.getWinSize();this.m_show_btn=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_story_look_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_story_look_on.png",""),this.m_show_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_show_btn.setPosition(winSize.width-15,winSize.height-10),this.m_show_btn.setVisible(!1),this.addChild(this.m_show_btn),this.m_show_btn.addClickEventListener(function(){this.showScript(!0)}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_show_btn.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),this.m_btn_container=new cc.Node,this.m_btn_container.setPosition(winSize.width-15,winSize.height-10),this.m_btn_container.setVisible(!0),this.addChild(this.m_btn_container);var menu_offset_y=0;this.m_auto_icon=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_story_auto.png"),this.m_auto_icon.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_auto_icon.setPosition(10,620),this.m_auto_icon.setVisible(!1),this.addChild(this.m_auto_icon);var option=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_story_option_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_story_option_on.png","");option.setAnchorPoint(ANCHOR_TOP_RIGHT()),option.setPosition(0,menu_offset_y),this.m_btn_container.addChild(option),option.addClickEventListener(function(){this.openOption()}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||option.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),menu_offset_y-=68;var hide=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_story_hide_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_story_hide_on.png","");hide.setAnchorPoint(ANCHOR_TOP_RIGHT()),hide.setPosition(0,menu_offset_y),this.m_btn_container.addChild(hide),hide.addClickEventListener(function(){this.setStatus(STATUS_LOVE_CG.NONE),this.showScript(!1)}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||hide.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),menu_offset_y-=68;var log=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_story_log_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_story_log_on.png","");log.setAnchorPoint(ANCHOR_TOP_RIGHT()),log.setPosition(0,menu_offset_y),this.m_btn_container.addChild(log),log.addClickEventListener(function(){this.setStatus(STATUS_LOVE_CG.NONE),this.showScriptLog(!0)}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||log.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),menu_offset_y-=68;var auto_start=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_story_auto_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_story_auto_on.png","");auto_start.setAnchorPoint(ANCHOR_TOP_RIGHT()),auto_start.setPosition(0,menu_offset_y),this.m_btn_container.addChild(auto_start),auto_start.addClickEventListener(function(){this.setAutoForward(STATUS_LOVE_CG.AUTO_FORWARD)}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||auto_start.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),this.m_auto_forward_btns.push(auto_start);var auto_stop=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_story_auto_none.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_story_auto_on.png","");auto_stop.setAnchorPoint(ANCHOR_TOP_RIGHT()),auto_stop.setPosition(0,menu_offset_y),auto_stop.setVisible(!1),this.m_btn_container.addChild(auto_stop),auto_stop.addClickEventListener(function(){this.setAutoForward(STATUS_LOVE_CG.NONE)}.bind(this)),this.m_auto_forward_btns.push(auto_stop),TutorialContextV2.getInstance().IsCompleteAllTutorial()||auto_stop.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),this.m_auto_effect=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/auto.json",RES_CDN_DEFULT+"effect/auto.atlas",1),this.m_auto_effect.setAnchorPoint(ANCHOR_MIDDLE()),this.m_auto_effect.setPosition(-30,menu_offset_y-30),this.m_btn_container.addChild(this.m_auto_effect,100),this.m_auto_effect.setVisible(!1),this.m_auto_effect.setAnimation(0,"fx_1",!0),menu_offset_y-=68;var skip=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_story_skip_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_story_skip_on.png","");skip.setAnchorPoint(ANCHOR_TOP_RIGHT()),skip.setPosition(0,menu_offset_y),this.m_btn_container.addChild(skip),skip.addClickEventListener(function(){var audio;TutorialContextV2.getInstance().IsCompleteAllTutorial()?null!=this._scriptViewComplete&&((audio=AudioEngine.getInstance()).stopBackgroundMusic(),audio.bgm_path="",this._scriptViewComplete(this)):this.m_is_complete?null!=this._scriptViewComplete&&((audio=AudioEngine.getInstance()).stopBackgroundMusic(),audio.bgm_path="",this._scriptViewComplete(this)):MainObserver.getInstance().postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.prologue_script_after_skip)}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||skip.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),menu_offset_y-=68,this.m_btn_container.setVisible(!0)},showScript:function(isShow){this.m_bg_frame.setVisible(isShow),this.m_btn_container.setVisible(isShow),isShow?this.m_show_btn.setVisible(!1):this.m_show_btn.setVisible(!0)},update:function(dt){if(this.m_touch_delay_time+=dt,this.m_script_delta_time+=dt,this.m_status==STATUS_LOVE_CG.NONE);else if(this.m_status==STATUS_LOVE_CG.AUTO_FORWARD&&this.m_script_delta_time>AUTO_FORWARD_TIME){if(this.m_script_delta_time=0,this.m_is_complete)return void this.setAutoForward(STATUS_LOVE_CG.NONE);this.typingBattleScript()}},setAutoForward:function(_status){this.setStatus(_status),this.m_script_delta_time=0,_status==STATUS_LOVE_CG.AUTO_FORWARD?(this.m_auto_forward_btns[0].setVisible(!1),this.m_auto_forward_btns[1].setVisible(!0),this.m_is_complete&&(this.m_script_index--,this.m_script_index=Math.max(this.m_script_index,0)),this.m_script_type==SCRIPT_TYPE.MISSION&&this.typingBattleScript()):(this.m_auto_forward_btns[0].setVisible(!0),this.m_auto_forward_btns[1].setVisible(!1))},setStatus:function(_status){this.m_status!=_status&&(_status==STATUS_LOVE_CG.NONE?(this.m_finger.isVisible()||this.m_finger.setVisible(!0),this.m_auto_icon.setVisible(!1),this.m_auto_forward_btns[0].setVisible(!0),this.m_auto_forward_btns[1].setVisible(!1),this.m_auto_effect.setVisible(!1)):(this.m_finger.isVisible()&&this.m_finger.setVisible(!1),_status==STATUS_LOVE_CG.AUTO_FORWARD&&(this.m_auto_icon.setVisible(!0),this.m_auto_effect.setVisible(!0))),this.m_status=_status)},openOption:function(){this.setStatus(STATUS_LOVE_CG.NONE),MainObserver.getInstance().postNotification(NOTIFY_MENU_OPTION)},showScriptLog:function(is_show){if(is_show){if(this.m_script_type==SCRIPT_TYPE.ANIMATION);else if(this.m_script_type==SCRIPT_TYPE.MISSION){for(var list=[],i=0;i<this.m_script_list.length&&(list.push(this.m_script_list[i]),this.m_is_complete||i!=this.m_script_index-1);i++);this.m_log_box.setContentSize(ccSize(this)),this.m_log_box._contentNode=function(contentsSize,m){var layer=new cc.Layer,log=new LoveContentCGLogLayerV2;return log.setAnchorPoint(ANCHOR_MIDDLE()),log.setScriptData(list,this.m_script_type),log.setPosition(ccCenter(layer)),log.m_tableView.scrollBarEnable(5<log.numberOfCellsInTableView()),layer.addChild(log),layer}.bind(this),this.m_log_box.is_show()&&this.m_log_box.hide(),this.m_log_box.show()}}else this.m_log_box.is_show()&&this.m_log_box.hide()},ActorAppearOfCondition:function(heroSide){var script,rValue=0;if(script=this.m_script_list[this.m_script_index],0<this.m_script_index){var prev_script,prev_hero,current_hero;prev_script=this.m_script_list[this.m_script_index-1],heroSide==HERO_LEFT?(prev_hero=prev_script.l_filename,current_hero=script.l_filename):heroSide==HERO_CENTER?(prev_hero=prev_script.m_filename,current_hero=script.m_filename):heroSide==HERO_RIGHT&&(prev_hero=prev_script.r_filename,current_hero=script.r_filename),rValue=prev_hero==current_hero?0:1}return rValue}}),BattleFxNode=cc.Node.extend({_spineStart:null,_spineEnd:null,_spineEvent:null,_throwingEnd:null,_spineComplete:null,m_part:[],m_is_moving:!1,m_prev_pos:cc.p(0,0),m_is_bezier:!1,m_target_general:null,m_skill_info:null,m_base_general:null,m_map_damage:null,m_target_enemy:null,m_is_missile:!1,missile_duration:0,missile_flight_delta_time:0,missile_start_pos:cc.p(0,0),missile_target_pos:cc.p(0,0),missile_velocity:0,m_collision_delta:0,m_reserved_remove:!1,m_trans_type:database.BattleEffectTrans.None,m_effect_id:0,is_pause:!1,is_collision_enable:0,m_skeleton:null,_effectStartListener:null,_effectCompleteListener:null,_effectEndListener:null,_effectEventListener:null,m_async_callback:null,m_total_texture_count:0,m_part_skin:null,m_part_bone:null,m_cur_time_scale:1,m_is_loop:!1,m_shader_type:TransShaderType.None,m_trans_cb_func:null,m_trans_cg_func_num:0,m_ordering_offset:0,m_fx_or_eff:0,m_durability_effect:null,ctor:function(part,ef){return this._super(),this.m_part=part,this.m_fx_or_eff=ef,this.init(),this},onExit:function(){BATTLE_TO_SHOP||(this._super(),this.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_skeleton),this.m_skeleton=null,this.m_part=null,this._spineStart=null,this._spineEnd=null,this._spineEvent=null,this._throwingEnd=null,this._spineComplete=null,this.m_prev_pos=null,this.m_target_general=null,this.m_skill_info=null,this.m_base_general=null,this.m_target_enemy=null,this._effectStartListener=null,this._effectCompleteListener=null,this._effectEndListener=null,this._effectEventListener=null,this.m_async_callback=null,this.m_part_skin=null,this.m_part_bone=null,this.m_trans_cb_func=null,this.m_durability_effect=null,this.m_prev_pos=null,this.m_map_damage=null,this.missile_start_pos=null,this.missile_target_pos=null,delete this.m_skeleton,delete this.m_part,delete this._spineStart,delete this._spineEnd,delete this._spineEvent,delete this._throwingEnd,delete this._spineComplete,delete this.m_prev_pos,delete this.m_target_general,delete this.m_skill_info,delete this.m_base_general,delete this.m_target_enemy,delete this._effectStartListener,delete this._effectCompleteListener,delete this._effectEndListener,delete this._effectEventListener,delete this.m_async_callback,delete this.m_part_skin,delete this.m_part_bone,delete this.m_trans_cb_func,delete this.m_durability_effect,delete this.m_prev_pos,delete this.m_map_damage,delete this.missile_start_pos,delete this.missile_target_pos,delete this.m_is_moving,delete this.m_is_bezier,delete this.m_is_missile,delete this.missile_duration,delete this.missile_flight_delta_time,delete this.missile_velocity,delete this.m_collision_delta,delete this.m_reserved_remove,delete this.m_trans_type,delete this.m_effect_id,delete this.is_pause,delete this.is_collision_enable,delete this.m_total_texture_count,delete this.m_cur_time_scale,delete this.m_is_loop,delete this.m_shader_type,delete this.m_trans_cg_func_num,delete this.m_ordering_offset,delete this.m_fx_or_eff)},fxClear:function(){this.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_skeleton),this.m_skeleton=null,this.m_part=null,this._spineStart=null,this._spineEnd=null,this._spineEvent=null,this._throwingEnd=null,this._spineComplete=null,this.m_prev_pos=null,this.m_target_general=null,this.m_skill_info=null,this.m_base_general=null,this.m_target_enemy=null,this._effectStartListener=null,this._effectCompleteListener=null,this._effectEndListener=null,this._effectEventListener=null,this.m_async_callback=null,this.m_part_skin=null,this.m_part_bone=null,this.m_trans_cb_func=null,this.m_durability_effect=null},getOrderingOffsetY:function(){return this.m_ordering_offset},setOrderingOffsetY:function(offset_y){this.m_ordering_offset=offset_y},runTransShader:function(shader_type,duration,callback,callback_num){switch(shader_type){case TransShaderType.None:BattleShaderCache.getInstance().defaultShader(this.m_skeleton);break;case TransShaderType.Blood:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_BLOOD_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.Hit_White:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_HIT_WHITE_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.Hit_Red:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_HIT_RED_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.Hit_Green:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_HIT_GREEN_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.Hit_Blue:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_HIT_BLUE_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.Ice:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_ICE_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.Frozen:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_FROZEN_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.Poison:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_POISON_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.Stone:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_STONE_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.Hold:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_HOLD_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.Sepia:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_SEPIA_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.Banish:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_BANISH_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.Vanish:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_VANISH_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.Electronic:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_SHOCK_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.Bleeding:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_BLOOD_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.Buring:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_BURNING_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.FireElement:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_FIRE_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.WaterElement:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_WATER_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.TreeElement:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_TREE_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.LightElement:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_LIGHT_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.DarkElement:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_DARK_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.Golden:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_GOLDEN_FSH,SHADER_DEFAULT_VSH);break;case TransShaderType.InvisibleElement:BattleShaderCache.getInstance().openShader(this.m_skeleton,SHADER_INVISIBLE_FSH,SHADER_DEFAULT_VSH)}if(this.m_shader_type=shader_type,0<duration){this.m_trans_cb_func=callback,this.m_trans_cg_func_num=callback_num,this.stopActionByTag(989898);var delay=cc.delayTime(duration),cb=cc.callFunc(this._cbTransShaderComplete,this),seq=cc.sequence(delay,cb);seq.setTag(989898),this.runAction(seq)}},_cbTransShaderComplete:function(){if(this.runTransShader(TransShaderType.None,0,null,0),null!=this.m_trans_cb_func)switch(this.m_trans_cg_func_num){case 1:this.m_trans_cb_func.cbUnfocusTransShaderCallback(this);break;case 2:this.m_trans_cb_func.cbTransShaderCallback(this);break;default:this.runTransShader(TransShaderType.None,0,null,0)}this.m_trans_cb_func=null,this.m_trans_cg_func_num=0},isEqualsFxId:function(fx_id){return null!=this.m_part&&this.m_part.fx_id==fx_id},getPart:function(){return this.m_part},getFxID:function(){return null!=this.m_part&&this.m_part.fx_id},getSkillInfo:function(){return this.m_skill_info},setTargetGeneral:function(gnrl){this.m_target_general=gnrl},getTargetGeneral:function(){return this.m_target_general},getFxLayerType:function(){return this.m_part.fx_layer},setReserveRemove:function(isRemove){this.m_reserved_remove=isRemove},IsReservedRemove:function(){return this.m_reserved_remove},setEffectTransType:function(type){this.m_trans_type=type},getEffectTransType:function(){return this.m_trans_type},init:function(){try{this.m_skeleton=new sp.SkeletonAnimation(this.m_part.fx_bone,this.m_part.fx_atlas,.32),this.m_skeleton.setStartListener(this.effectStartListener.bind(this)),this.m_skeleton.setEndListener(this.effectEndListener.bind(this)),this.m_skeleton.setCompleteListener(this.effectCompleteListener.bind(this)),this.m_skeleton.setEventListener(function(traceIndex,event){var entry=this.m_skeleton.getState().getCurrent(traceIndex);this.fxEventListener(entry,event,this)}.bind(this)),this.addChild(this.m_skeleton),(((this._effectStartListener=this)._effectEventListener=this)._effectEndListener=this)._effectCompleteListener=this}catch(e){cc.log(e)}},setFlipX:function(flipX){null!=this.m_skeleton&&(this.m_skeleton._skeleton.flipX=flipX)},effectStartListener:function(trackIndex){this.fxStartListener(trackIndex,this)},effectCompleteListener:function(trackEntry,loopCount){this.fxCompleteListener(this)},effectEndListener:function(trackIndex){this.fxEndListener(this)},is_exist:function(animation){for(var ani_count=this.m_skeleton._skeleton.data.animations.length,ani=this.m_skeleton._skeleton.data.animations,i=0;i<ani_count;i++)if(ani[i].name==animation)return!0;return!1},runFXAnimation:function(fx,is_loop){var fx_name="fx_"+fx;if(null!=this.m_skeleton)if(this.m_skeleton.setSlotsToSetupPose(),this.is_exist(fx_name)){switch(fx){case FX_Animation.FX_GRADE_0:this.m_skeleton.setAnimation(0,"fx_0",is_loop);break;case FX_Animation.FX_GRADE_1:this.m_skeleton.setAnimation(0,"fx_1",is_loop);break;case FX_Animation.FX_GRADE_2:this.m_skeleton.setAnimation(0,"fx_2",is_loop);break;case FX_Animation.FX_GRADE_3:this.m_skeleton.setAnimation(0,"fx_3",is_loop);break;case FX_Animation.FX_GRADE_4:this.m_skeleton.setAnimation(0,"fx_4",is_loop);break;case FX_Animation.FX_GRADE_5:this.m_skeleton.setAnimation(0,"fx_5",is_loop);break;case FX_Animation.FX_GRADE_6:this.m_skeleton.setAnimation(0,"fx_6",is_loop)}this.m_is_loop=is_loop}else fx==FX_Animation.FX_END?this.m_skeleton.setAnimation(0,"fx_end",is_loop):this.m_skeleton.setAnimation(0,"effect_1",is_loop)},setFXTimeScale:function(timescale){this.m_cur_time_scale=timescale},isEqualsFxId:function(fx_id){return null!=this.m_part&&this.m_part.fx_id==fx_id},fxStartListener:function(trackIndex,node){0==this.m_fx_or_eff&&null!=this._spineStart&&this._spineStart.fxStartListener(trackIndex,node.m_skeleton)},fxCompleteListener:function(node){null!=this._spineComplete&&(0==this.m_fx_or_eff?this._spineComplete.fxCompleteListener(node):this._spineComplete.commonFxCompleteListener(node))},fxEndListener:function(node){0==this.m_fx_or_eff&&null!=this._spineEnd&&this._spineEnd.fxEndListener(node)},fxEventListener:function(entry,evt,node){0==this.m_fx_or_eff&&null!=this._spineEvent&&this._spineEvent.fxEventListener(node,entry,evt)},throwToTarget:function(base_gnrl,target_gnrl,velocity,is_bezier){var target_pos;if(this.m_base_general=base_gnrl,this.m_target_general=target_gnrl,null!=this.m_target_general){var ab_pos=this.m_target_general.absolutePosition(this.m_target_general.getParent()),hit_pos=this.m_target_general.hitPoint(3);target_pos=cc.p(ab_pos.x+hit_pos.x,ab_pos.y+hit_pos.y)}else target_pos=target_gnrl.getPosition();var pos=this.getPosition(),is_2x_speed=1<GameDefault.getInstance().getUserBattleGameSpeed();if(this.m_is_bezier=is_bezier){var subX=pos.x-target_pos.x,subY=pos.y-target_pos.y,sub=cc.p(subX,subY),x=.5*sub.x,y=.5*Math.abs(sub.y)+this.m_part.curved_height,config=[cc.p(pos.x,pos.y),cc.p(pos.x-x,pos.y+y),cc.p(target_pos.x,target_pos.y)],duration=(cc.pDistance(config[0],config[1])+cc.pDistance(config[1],config[2]))/velocity;is_2x_speed&&(duration/=BATTLE_TIME_SCALE_2X);var move=cc.bezierTo(duration,config),cb=cc.callFunc(this.cbthrowToTargetEnded,this),seq=cc.sequence(move,cb);this.runAction(seq)}else{duration=cc.pDistance(pos,target_pos)/velocity;is_2x_speed&&(duration/=BATTLE_TIME_SCALE_2X);var moveto=cc.moveTo(duration,target_pos);cb=cc.callFunc(this.cbthrowToTargetEnded,this),seq=cc.sequence(moveto,cb);this.runAction(seq)}this.m_prev_pos=this.getPosition(),this.m_is_moving||(this.m_is_moving=!0,this.schedule(this.angleUpdate,.01))},cbthrowToTargetEnded:function(){try{this.m_skeleton.clearTracks(0)}catch(e){}null!=this._throwingEnd&&this._throwingEnd.throwingFxEndListener(this),this.m_is_moving=!1,this.unschedule(this.angleUpdate),this.m_target_general=null},angleUpdate:function(dt){var zeroPos=cc.p(0,0);if(this.m_prev_pos==zeroPos)this.m_prev_pos=this.getPosition();else{var cur_pos=this.getPosition(),diffX=cur_pos.x-this.m_prev_pos.x,diffY=cur_pos.y-this.m_prev_pos.y,diff=cc.p(diffX,diffY);if(diff!=zeroPos){var angle=Math.atan2(diff.y,diff.x)*(180/Math.PI);cur_pos.x>this.m_prev_pos.x||(angle-=180),this.setRotation(-angle)}this.m_prev_pos=this.getPosition()}},setBattleSkill:function(skill){this.m_skill_info=skill},setMissileData:function(base,dmg_list,target_enemy){this.m_is_missile=!0,this.m_base_general=base,this.m_map_damage=dmg_list,this.m_target_enemy=target_enemy},clearMissileData:function(){this.m_is_missile=!1,this.m_map_damage=[],this.m_base_general=null,this.m_target_enemy=[]},throwingMissile:function(velocity,target_pos){var pos=this.getPosition(),duration=cc.pDistance(pos,target_pos)/velocity;this.missile_duration=duration,this.missile_target_pos=target_pos,this.missile_start_pos=this.getPosition(),this.missile_velocity=velocity,this.missile_flight_delta_time=0,this.m_collision_delta=0,this.m_is_moving||(this.m_is_moving=!0,this.schedule(this.collisionUpdate,.01))},cbThrowingMissileEnded:function(){null!=this._throwingEnd&&this._throwingEnd.throwingFxEndListener(this),this.clearMissileData(),this.m_is_moving&&(this.m_is_moving=!1,this.unschedule(this.collisionUpdate)),this.missile_duration=0,this.missile_target_pos=ZERO(),this.missile_start_pos=ZERO(),this.missile_velocity=0,this.missile_flight_delta_time=0},collisionUpdate:function(dt){if(!this.is_pause){1<GameDefault.getInstance().getUserBattleGameSpeed()&&(dt*=BATTLE_TIME_SCALE_2X),this.missile_flight_delta_time+=dt;var move_x=0;move_x=this.missile_start_pos.x<=this.missile_target_pos.x?this.missile_velocity*dt:-this.missile_velocity*dt,this.setPositionX(this.getPositionX()+move_x),this.missile_flight_delta_time>=this.missile_duration&&this.cbThrowingMissileEnded();var box,cur_pos=this.getPosition();if(box=this.missile_start_pos.x<=this.missile_target_pos.x?cc.rect(cur_pos.x-500,0,650,winSize.height):cc.rect(cur_pos.x,0,650,winSize.height),this.is_collision_enable&&!this.m_map_damage.empty()&&(this.m_collision_delta-=dt,this.m_collision_delta<0)){for(var i=0;i<this.m_target_enemy.length;i++){var t=this.m_target_enemy[i];if("object"==typeof t){var p=t.absolutePosition(t.getParent());if(cc.rectContainsPoint(box,p)){var gnrl_id=t.getGeneral().general.gnrl_id,position=t.getBattlePosition(),a_map_damage=[];a_map_damage[0]=[gnrl_id,position];var found=this.m_map_damage.find(a_map_damage[0]),found_value=this.m_map_damage.at(a_map_damage[0]);if(1==found){var damage_list=found_value;if(0!=damage_list.length){var damage=damage_list.shift();t.addDamage(this.m_base_general,damage)&&t.beginHit(2),0!=damage_list.length?this.m_map_damage.erase_value(found_value):this.m_map_damage.insert(a_map_damage[0],damage_list)}}}}}this.m_collision_delta=COLLISION_TIME}}},setEffectId:function(effect_id){this.m_effect_id=effect_id},getEffectId:function(){return this.m_effect_id},setCollisionEnable:function(is_enable){this.is_collision_enable=is_enable},setDurabilityEffect:function(dur){this.m_durability_effect=dur},getDurabilityEffect:function(){return this.m_durability_effect},absolutePosition:function(parent){for(var ret=this.getPosition(),cn=this,retX=0,retY=0;cn.getParent()!=parent&&null!=(cn=cn.getParent());)retX=ret.x+cn.getPosition().x,retY=ret.y+cn.getPosition().y,ret=cc.p(retX,retY);return ret},absolutePosition2:function(parent){var ret=this.getPosition();return ret}}),BattleMissionResultLayer_V2=cc.Layer.extend({m_friend_box:null,m_win_lose_layer:null,m_result_layer:null,m_is_win:!1,m_main_mission_result_v2:null,m_weekly_dungeon_result:null,m_mussang_step_result:null,m_marathon_dungeon_result:null,m_event_dungeon_result:null,m_daily_dungeon_result:null,m_great_wall_dungeon_win:null,m_great_wall_dungeon_lose:null,m_raid_boss_result:null,m_mussang_tower_result_win:null,m_once_a_day_result_win:null,m_user_level:null,m_user_name:null,m_user_gold:null,m_user_key:null,m_user_exp:null,m_user_formation_point:null,m_user_level_count:0,m_user_exp_bar:null,m_gain_items:null,m_partner_gnrl:null,m_bp:null,enable_touch_partner:!1,m_skeletonNode:!1,m_game_type:db.BattleGameType.Mission,m_game_scene:null,m_btn_list:null,m_message_box:null,m_debug_log_box:null,m_voice_id:0,m_is_voice_playing:!1,m_voice_playing_delta:0,m_partnerInfo:null,battleObserver:null,m_firework_position:null,m_gold_max_count:0,m_gold_count:0,m_gold_label:null,m_shared_modal_layer:null,m_raid_warning_modal_layer:null,m_gnrl_img:null,m_img_scale:1,m_scroll_arrow_left:null,m_scroll_arrow_right:null,m_scroll_view:null,m_scroll_container:null,m_mussang_boss_win:null,m_mussang_boss_lose:null,m_event_raid_battle_win:null,m_event_raid_battle_lose:null,m_story_hard_mode_result:null,m_weekly_dungeon_skip_result:null,m_event_dungeon_skip_result:null,m_story_dungeon_skip_result:null,m_is_skip:!1,m_lose:null,ctor:function(){this._super(),winSize=cc.director.getWinSize(),this.battleObserver=MainObserver.getInstance(),this.m_btn_list=[],this.m_gain_items=[],this.init()},init:function(){BATTLE_SCENE_MEMORY_CLEAR=!0,this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE()),this.m_game_type=BattleContext._getInstance().getGameType();var listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1});listener.onTouchBegan=function(touch,event){var winSize=cc.director.getWinSize(),pos=touch.getLocation(),rect=cc.rect(winSize.width-400,0,400,winSize.height);return cc.rectContainsPoint(rect,pos)}.bind(this),listener.onTouchEnded=function(touch,event){this.enable_touch_partner&&this.m_is_win&&this.partnerAnimation()}.bind(this),cc.eventManager.addListener(listener,this);var winSize=ccSize(this),modalSize=cc.size(winSize.width,640);return this.m_message_box=new GameMessageBox,this.m_message_box.setContentSize(modalSize),this.addChild(this.m_message_box,99999),this.m_friend_box=new GameModalLayer,this.m_friend_box.setContentSize(modalSize),this.addChild(this.m_friend_box,99998),this.m_debug_log_box=new GameModalLayer,this.m_debug_log_box.setContentSize(modalSize),this.addChild(this.m_debug_log_box,99998),this.m_shared_modal_layer=new GameModalLayer,this.m_shared_modal_layer.setContentSize(modalSize),this.addChild(this.m_shared_modal_layer,99998),this.m_raid_warning_modal_layer=new GameModalLayer,this.m_raid_warning_modal_layer.setContentSize(modalSize),this.addChild(this.m_raid_warning_modal_layer,99998),this.scheduleUpdate(),!0},onEnter:function(){this._super();var audio=AudioEngine.getInstance();audio.stopBackgroundMusic(),audio.m_bgmPath=""},onExit:function(){if(!BATTLE_TO_SHOP){if(this._super(),null!=this.m_gnrl_img){for(var idx=0;idx<this.m_gnrl_img.length;idx++)if(1==USE_PARTNER_GNRL_LOADING)if(0<SAVE_NOW_PARTNER_GNRL.res_img.length){for(var check_release=!1,jdx=0;jdx<SAVE_NOW_PARTNER_GNRL.res_img.length;jdx++)SAVE_NOW_PARTNER_GNRL.res_img[jdx]==this.m_gnrl_img[idx]&&(check_release=!0);0==check_release&&cc.loader.release(this.m_gnrl_img[idx])}else cc.loader.release(this.m_gnrl_img[idx]);else cc.loader.release(this.m_gnrl_img[idx]);this.m_gnrl_img=null}null==this.m_result_layer&&null==this.m_result_layer||this.m_result_layer.removeAllChildren(!0),this.removeAllChildren(!0),this.removeAllChildrenWithCleanup(!0),this.m_friend_box=null,this.m_win_lose_layer=null,this.m_result_layer=null,this.m_is_win=null,this.m_main_mission_result_v2=null,this.m_weekly_dungeon_result=null,this.m_mussang_step_result=null,this.m_marathon_dungeon_result=null,this.m_event_dungeon_result=null,this.m_daily_dungeon_result=null,this.m_great_wall_dungeon_win=null,this.m_great_wall_dungeon_lose=null,this.m_raid_boss_result=null,this.m_mussang_tower_result_win=null,this.m_once_a_day_result_win=null,this.m_mussang_boss_win=null,this.m_mussang_boss_lose=null,this.m_event_raid_battle_win=null,this.m_event_raid_battle_lose=null,this.m_weekly_dungeon_skip_result=null,this.m_event_dungeon_skip_result=null,this.m_user_level=null,this.m_user_name=null,this.m_user_gold=null,this.m_user_key=null,this.m_user_exp=null,this.m_user_formation_point=null,this.m_user_level_count=null,this.m_user_exp_bar=null,this.m_gain_items=null,this.m_partner_gnrl=null,this.m_bp=null,this.enable_touch_partner=null,this.m_skeletonNode=null,this.m_game_type=null,this.m_game_scene=null,this.m_btn_list=null,this.m_message_box=null,this.m_debug_log_box=null,this.m_voice_id=null,this.m_is_voice_playing=null,this.m_voice_playing_delta=null,this.m_partnerInfo=null,this.battleObserver=null,this.m_firework_position=null,this.m_gold_max_count=null,this.m_gold_count=null,this.m_gold_label=null,this.m_shared_modal_layer=null,this.m_raid_warning_modal_layer=null,this.m_img_scale=null,this.m_scroll_arrow_left=null,this.m_scroll_arrow_right=null,this.m_scroll_view=null,this.m_scroll_container=null}},goldCount:function(){this.m_gold_max_count<49?this.m_gold_count>=this.m_gold_max_count?(this.m_gold_count=this.m_gold_max_count,this.m_gold_label.setString("+"+Math.abs(this.m_gold_count)),this.unschedule(this.goldCount)):(this.m_gold_count++,this.m_gold_label.setString("+"+Math.abs(this.m_gold_count))):this.m_gold_count>=this.m_gold_max_count?(this.m_gold_count=this.m_gold_max_count,this.m_gold_label.setString("+"+Math.abs(this.m_gold_count)),this.unschedule(this.goldCount)):(this.m_gold_count+=parseInt(this.m_gold_max_count/49),this.m_gold_label.setString("+"+Math.abs(this.m_gold_count)))},setGameScene:function(scene){this.m_game_scene=scene},resultDataWin:function(body){this.m_is_win=!0,this.m_great_wall_dungeon_win=body,this.makeSuccess()},resultDataLose:function(body){this.m_is_win=!1,this.m_great_wall_dungeon_lose=body,this.makeFailed()},resultDataWin_MussangBoss:function(res){this.m_is_win=!0,this.m_mussang_boss_win=res,this.makeSuccess()},resultDataLose_MussangBoss:function(res){this.m_is_win=!1,this.m_mussang_boss_lose=res;this.makeFailed()},resultDataWin_RaidDungeon:function(res){if("y"==res.die_yn)this.m_is_win=!0,this.m_event_raid_battle_win=res,this.makeSuccess();else{this.m_is_win=!1,this.m_event_raid_battle_win=res;var context=BattleContext._getInstance();context.getEventRaidTimeOut()?this.makeTimeout():this.makeFailed(),context.setEventRaidTimeOut(!1)}},resultDataLose_RaidDungeon:function(res){this.m_is_win=!1,this.m_event_raid_battle_lose=res;var context=BattleContext._getInstance();context.getEventRaidTimeOut()?this.makeTimeout():this.makeFailed(),context.setEventRaidTimeOut(!1)},resultDataWeekly_Dungeon_Battle_Skip:function(res){this.m_is_win=!0,this.m_is_skip=!0,this.m_weekly_dungeon_skip_result=res,this.makeResultMissionReward(),this.voicePlay(voice_battle_win_leader)},resultDataEvent_Dungeon_Battle_Skip:function(res){this.m_is_win=!0,this.m_is_skip=!0,this.m_event_dungeon_skip_result=res,this.makeResultMissionReward(),this.voicePlay(voice_battle_win_leader)},resultDataStory_Dungeon_Battle_Skip:function(res){this.m_is_win=!0,this.m_is_skip=!0,this.m_story_dungeon_skip_result=res,this.makeResultMissionReward(),this.voicePlay(voice_battle_win_leader)},resultData:function(is_win,res,battle_type){var req={};req.opcode=net.OP.op_get_user_item;var mainScene=SceneManager.getInstance().getMainScene();switch(GameClient().write(req,mainScene.onNetworkEvent,mainScene),battle_type){case db.BattleGameType.Mission:this.m_main_mission_result_v2=res;break;case db.BattleGameType.StoryHardMode:this.m_story_hard_mode_result=res;break;case db.BattleGameType.DailyDungeon:this.m_daily_dungeon_result=res;break;case db.BattleGameType.EventDungeon:this.m_event_dungeon_result=res;break;case db.BattleGameType.Mussang:this.m_mussang_step_result=res;break;case db.BattleGameType.WeeklyDungeon:this.m_weekly_dungeon_result=res;break;case db.BattleGameType.RaidDungeon:this.m_raid_boss_result=res;break;case db.BattleGameType.TowerDungeon:if(this.m_mussang_tower_result_win=res,1==is_win){var next_mussang_tower_id=MussangService().getNextChallengeMussangTowerId(this.m_mussang_tower_result_win.mussang_tower_idx);GameContext.getInstance().setMussangTowerId(next_mussang_tower_id)}else GameContext.getInstance().setMussangTowerId(this.m_mussang_tower_result_win.mussang_tower_idx);break;case db.BattleGameType.OnceADayDungeon:this.m_once_a_day_result_win=res}if(this.m_is_win=is_win,battle_type==db.BattleGameType.Mission){var is_mission_win=BattleContext._getInstance().getMissionWin();res.mission_id==YEOWA_STAGE_ID&&is_mission_win&&(this.m_is_win=!0)}this.m_is_win?this.makeSuccess():this.makeFailed()},makeSuccess:function(){var audio=AudioEngine.getInstance();this.m_win_lose_layer=new cc.Layer,this.m_win_lose_layer.ignoreAnchorPointForPosition(!1),this.m_win_lose_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_win_lose_layer.setPosition(ccCenter(this)),this.addChild(this.m_win_lose_layer,0);var dim=new cc.LayerColor(cc.color.BLACK);dim.ignoreAnchorPointForPosition(!1),dim.setAnchorPoint(ANCHOR_MIDDLE()),dim.setPosition(ccCenter(this.m_win_lose_layer)),dim.setOpacity(0),this.m_win_lose_layer.addChild(dim);var fadein=new cc.FadeTo(.3,128);dim.runAction(fadein);var win=cc.Sprite.create();if(win.setAnchorPoint(ANCHOR_MIDDLE()),win.setPosition(ccCenter(this.m_win_lose_layer)),this.m_win_lose_layer.addChild(win),this.m_game_type==db.BattleGameType.Mission)if(10103==this.m_main_mission_result_v2.mission_id){var path=RES_CDN_SOUND+SND_TYPE+"sound/SE_battle_lose.mp3";if(audio.playEffect(path),NOT_USE_SP_BATTLE_ANIMATION){win.setScale(3),win.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_lose_09.png");delay1=new cc.DelayTime(.3);var scaleTo_1=new cc.ScaleTo(.3,3,3),scaleTo_2=new cc.ScaleTo(.3,2,2),sequence=new cc.Sequence(scaleTo_1,scaleTo_2);cb=new cc.CallFunc(this.cbMakeWinLose,this),seq=new cc.Sequence(delay1,sequence,cb);win.runAction(seq),seq=cb=sequence=scaleTo_2=scaleTo_1=delay1=null}else{var delay1=new cc.DelayTime(.3),ani=BattleAni._getInstance().getAnimate(BattleAni_.EffectResultLose),cb=new cc.CallFunc(this.cbMakeWinLose,this),seq=new cc.Sequence(delay1,ani,cb);win.runAction(seq),seq=cb=ani=delay1=null}}else{path=RES_CDN_SOUND+SND_TYPE+"sound/SE_battle_win.mp3";if(audio.playEffect(path),NOT_USE_SP_BATTLE_ANIMATION){win.setScale(2),win.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_win_09.png");scaleTo_1=new cc.ScaleTo(.7,2.03,2.03),scaleTo_2=new cc.ScaleTo(.7,1.97,1.97),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),delay1=new cc.DelayTime(.3),cb=new cc.CallFunc(this.cbMakeSuccssImpactStar,this),seq=new cc.Sequence(delay1,sequence,cb);win.runAction(seq),seq=cb=delay1=sequence=scaleTo_2=scaleTo_1=null}else{var delay1=new cc.DelayTime(.3),cb=(ani=BattleAni._getInstance().getAnimate(BattleAni_.EffectResultWin),new cc.CallFunc(this.cbMakeSuccssImpactStar,this)),seq=new cc.Sequence(delay1,ani,cb);win.runAction(seq),seq=cb=ani=delay1=null}this.playFireworks(1)}else{path=RES_CDN_SOUND+SND_TYPE+"sound/SE_battle_win.mp3";if(audio.playEffect(path),NOT_USE_SP_BATTLE_ANIMATION){win.setScale(2),win.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_win_09.png");scaleTo_1=new cc.ScaleTo(.7,2.03,2.03),scaleTo_2=new cc.ScaleTo(.7,1.97,1.97),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),delay1=new cc.DelayTime(.3),cb=new cc.CallFunc(this.cbMakeSuccssImpactStar,this),seq=new cc.Sequence(delay1,sequence,cb);win.runAction(seq),seq=cb=delay1=sequence=scaleTo_2=scaleTo_1=null}else{delay1=new cc.DelayTime(.3),ani=BattleAni._getInstance().getAnimate(BattleAni_.EffectResultWin),cb=new cc.CallFunc(this.cbMakeSuccssImpactStar,this),seq=new cc.Sequence(delay1,ani,cb);win.runAction(seq),seq=cb=ani=delay1=null}this.playFireworks(1)}},makeFailed:function(){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_battle_lose.mp3";audio.playEffect(path);var size=ccSize(this),texture=new cc.RenderTexture(size.width+1,size.height,cc.Texture2D.PIXEL_FORMAT_RGBA8888);texture.begin(),this.m_game_scene.visit(),texture.end(),this.m_win_lose_layer=new cc.Layer,this.m_win_lose_layer.ignoreAnchorPointForPosition(!1),this.m_win_lose_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_win_lose_layer.setPosition(ccCenter(this)),this.addChild(this.m_win_lose_layer,0);var fail_bg=cc.Sprite.create(texture.getSprite().getTexture());fail_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),fail_bg.setPosition(ZERO()),fail_bg.setFlippedY(!0),this.m_win_lose_layer.addChild(fail_bg),BattleShaderCache.getInstance().openShader(fail_bg,SHADER_GRAY_SCALE_FSH,SHADER_DEFAULT_ORIGIN_VSH),fail_bg.setOpacity(0);var btn,fadein=new cc.FadeIn(1);if(fail_bg.runAction(fadein),this.m_lose=cc.Sprite.create(),this.m_lose.setAnchorPoint(ANCHOR_MIDDLE()),this.m_lose.setPosition(ccCenter(this.m_win_lose_layer)),this.m_win_lose_layer.addChild(this.m_lose),NOT_USE_SP_BATTLE_ANIMATION){this.m_lose.setScale(3),this.m_lose.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_lose_09.png");delay1=new cc.DelayTime(.3),delay2=new cc.DelayTime(1.5);var scaleTo_1=new cc.ScaleTo(.3,3,3),scaleTo_2=new cc.ScaleTo(.3,2,2),sequence=new cc.Sequence(scaleTo_1,scaleTo_2);cb=new cc.CallFunc(this.cbMakeWinLose,this),seq=new cc.Sequence(delay1,sequence,delay2,cb);this.m_lose.runAction(seq),seq=cb=sequence=scaleTo_2=scaleTo_1=delay2=delay1=null}else{var delay1=new cc.DelayTime(.3),ani=BattleAni._getInstance().getAnimate(BattleAni_.EffectResultLose),delay2=new cc.DelayTime(1.5),cb=new cc.CallFunc(this.cbMakeWinLose,this),seq=new cc.Sequence(delay1,ani,delay2,cb);this.m_lose.runAction(seq),seq=cb=ani=delay2=delay1=null}TEST_DAMAGE_LOG_SHOW&&((btn=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE)).setFont(LABEL_FONT_INDEX.FONT_241),btn.setString("DAMAGE"),btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),btn.setPosition(winSize.width-10,winSize.height-10),this.m_win_lose_layer.addChild(btn),btn.addClickEventListener(function(sender){this.showDebugBox()}.bind(this)));TEST_GENERAL_LOG_SHOW&&((btn=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE)).setFont(LABEL_FONT_INDEX.FONT_241),btn.setString("DEBUG"),btn.setAnchorPoint(ANCHOR_TOP_LEFT()),btn.setPosition(10,winSize.height-10),this.m_win_lose_layer.addChild(btn),btn.addClickEventListener(function(sender){this.showGeneralDebugBox()}.bind(this)))},makeTimeout:function(){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_battle_lose.mp3";audio.playEffect(path);var winSize=cc.director.getWinSize(),texture=new cc.RenderTexture(winSize.width+1,winSize.height,cc.Texture2D.PIXEL_FORMAT_RGBA8888);texture.begin(),this.m_game_scene.visit(),texture.end(),this.m_win_lose_layer=new cc.Layer,this.m_win_lose_layer.ignoreAnchorPointForPosition(!1),this.m_win_lose_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_win_lose_layer.setPosition(ccCenter(this)),this.addChild(this.m_win_lose_layer,0);var fail_bg=cc.Sprite.create(texture.getSprite().getTexture());fail_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),fail_bg.setPosition(ZERO()),fail_bg.setFlippedY(!0),this.m_win_lose_layer.addChild(fail_bg),BattleShaderCache.getInstance().openShader(fail_bg,SHADER_GRAY_SCALE_FSH,SHADER_DEFAULT_ORIGIN_VSH),fail_bg.setOpacity(0);var fadein=new cc.FadeIn(1);fail_bg.runAction(fadein);var m_timeout=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/ui_fx_timeout.json",RES_CDN_DEFULT+"effect/ui_fx_timeout.atlas",1);m_timeout.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),m_timeout.setPosition(winSize.width/2,winSize.height/2),m_timeout.setVisible(!0),this.m_win_lose_layer.addChild(m_timeout),m_timeout.setAnimation(0,"fx_1",!1),m_timeout.setCompleteListener(this.spineCompleteListener.bind(this))},spineCompleteListener:function(trackIndex,loopCount){this.cbMakeWinLose()},cbMakeSuccssImpactStar:function(){if(this.m_game_type==db.BattleGameType.Mission){var task_count=0;mission=$.extend({},database.BattleMainMission),BattleService.getInstance().getMainMissionAndNpc(this.m_main_mission_result_v2.mission_id,mission);for(var i=mission.task_list.length-1;0<=i;--i)1==mission.task_list[i].is_cleared&&task_count++;if((star=cc.Sprite.create()).setAnchorPoint(ANCHOR_MIDDLE()),star.setPosition(.5*ccWidth(this.m_win_lose_layer),.5*ccHeight(this.m_win_lose_layer)-150),this.m_win_lose_layer.addChild(star),NOT_USE_SP_BATTLE_ANIMATION){star.setScale(2),star.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_win_sakura_03.png");delay=new cc.DelayTime(1.2),cb=new cc.CallFunc(this.cbMakeWinLose,this),seq=new cc.Sequence(delay,cb);star.runAction(seq),seq=cb=delay=null;for(i=0;i<task_count;i++){var res_string=RES_CDN_DEFULT+cmString("uieffect_2/uieffect_sprite/effect_war_win_sakura_%02d.png",7+4*i);(star_sub=cc.Sprite.create(res_string)).setAnchorPoint(ANCHOR_MIDDLE()),star_sub.setScale(2),star_sub.setOpacity(0),star_sub.setPosition(.5*ccWidth(this.m_win_lose_layer),.5*ccHeight(this.m_win_lose_layer)-150),this.m_win_lose_layer.addChild(star_sub);delay=new cc.DelayTime(.1+.4*i);var fadein=cc.fadeIn(.1),scaleTo_1=new cc.ScaleTo(.1,2.03,2.03),scaleTo_2=new cc.ScaleTo(.2,2,2),sequence=new cc.Sequence(delay,fadein,scaleTo_1,scaleTo_2);star_sub.runAction(sequence),sequence=scaleTo_2=scaleTo_1=fadein=delay=null}}else{var ani=BattleAni._getInstance().getAnimate(BattleAni_.EffectResultStar_0+task_count),delay=new cc.DelayTime(1.2),cb=new cc.CallFunc(this.cbMakeWinLose,this),seq=new cc.Sequence(ani,delay,cb);star.runAction(seq),seq=cb=delay=ani=null}}else if(this.m_game_type==db.BattleGameType.StoryHardMode){var mission=$.extend({},database.BattleStoryHardModeMission);BattleService.getInstance().getStoryHardModeMissionAndNpc(this.m_story_hard_mode_result.main_story_hard_mode_mission_idx,mission);for(task_count=0,i=mission.task_list.length-1;0<=i;--i)1==mission.task_list[i].is_cleared&&task_count++;if((star=cc.Sprite.create()).setAnchorPoint(ANCHOR_MIDDLE()),star.setPosition(.5*ccWidth(this.m_win_lose_layer),.5*ccHeight(this.m_win_lose_layer)-150),this.m_win_lose_layer.addChild(star),NOT_USE_SP_BATTLE_ANIMATION){star.setScale(2),star.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_win_sakura_03.png");delay=new cc.DelayTime(1.2),cb=new cc.CallFunc(this.cbMakeWinLose,this),seq=new cc.Sequence(delay,cb);star.runAction(seq),seq=cb=delay=null;for(i=0;i<task_count;i++){res_string=RES_CDN_DEFULT+cmString("uieffect_2/uieffect_sprite/effect_war_win_sakura_%02d.png",7+4*i);(star_sub=cc.Sprite.create(res_string)).setAnchorPoint(ANCHOR_MIDDLE()),star_sub.setScale(2),star_sub.setOpacity(0),star_sub.setPosition(.5*ccWidth(this.m_win_lose_layer),.5*ccHeight(this.m_win_lose_layer)-150),this.m_win_lose_layer.addChild(star_sub);delay=new cc.DelayTime(.1+.4*i),fadein=cc.fadeIn(.1),scaleTo_1=new cc.ScaleTo(.1,2.03,2.03),scaleTo_2=new cc.ScaleTo(.2,2,2),sequence=new cc.Sequence(delay,fadein,scaleTo_1,scaleTo_2);star_sub.runAction(sequence),sequence=scaleTo_2=scaleTo_1=fadein=delay=null}}else{ani=BattleAni._getInstance().getAnimate(BattleAni_.EffectResultStar_0+task_count);var delay=new cc.DelayTime(1.2),cb=new cc.CallFunc(this.cbMakeWinLose,this),seq=new cc.Sequence(ani,delay,cb);star.runAction(seq),seq=cb=delay=ani=null}}else if(this.m_game_type==db.BattleGameType.TowerDungeon){task_count=0;var dungeon=BattleContext._getInstance().getMussangTowerDungeonData();for(i=dungeon.task_list.length-1;0<=i;--i){var found=this.m_mussang_tower_result_win.cmplt_task_ids.find(function(ss){return ss==dungeon.task_list[i].task_id});1!=dungeon.task_list[i].is_cleared&&null==found||task_count++}if((star=cc.Sprite.create()).setAnchorPoint(ANCHOR_MIDDLE()),star.setPosition(.5*ccWidth(this.m_win_lose_layer),.5*ccHeight(this.m_win_lose_layer)-150),this.m_win_lose_layer.addChild(star),NOT_USE_SP_BATTLE_ANIMATION){star.setScale(2),star.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_win_sakura_03.png");delay=new cc.DelayTime(1.2),cb=new cc.CallFunc(this.cbMakeWinLose,this),seq=new cc.Sequence(delay,cb);star.runAction(seq),seq=cb=delay=null;for(i=0;i<task_count;i++){res_string=RES_CDN_DEFULT+cmString("uieffect_2/uieffect_sprite/effect_war_win_sakura_%02d.png",7+4*i);(star_sub=cc.Sprite.create(res_string)).setAnchorPoint(ANCHOR_MIDDLE()),star_sub.setScale(2),star_sub.setOpacity(0),star_sub.setPosition(.5*ccWidth(this.m_win_lose_layer),.5*ccHeight(this.m_win_lose_layer)-150),this.m_win_lose_layer.addChild(star_sub);delay=new cc.DelayTime(.1+.4*i),fadein=cc.fadeIn(.1),scaleTo_1=new cc.ScaleTo(.1,2.03,2.03),scaleTo_2=new cc.ScaleTo(.2,2,2),sequence=new cc.Sequence(delay,fadein,scaleTo_1,scaleTo_2);star_sub.runAction(sequence),sequence=scaleTo_2=scaleTo_1=fadein=delay=null}}else{ani=BattleAni._getInstance().getAnimate(BattleAni_.EffectResultStar_0+task_count);var delay=new cc.DelayTime(1.2);cb=new cc.CallFunc(this.cbMakeWinLose,this),seq=new cc.Sequence(ani,delay,cb);star.runAction(seq),seq=cb=delay=ani=null}}else if(this.m_game_type==db.BattleGameType.WeeklyDungeon)if(0!=this.m_weekly_dungeon_result.task_list.length){for(task_count=0,i=this.m_weekly_dungeon_result.task_list.length-1;0<=i;--i)"y"==this.m_weekly_dungeon_result.task_list[i].complete_yn&&task_count++;if((star=cc.Sprite.create()).setAnchorPoint(ANCHOR_MIDDLE()),star.setPosition(.5*ccWidth(this.m_win_lose_layer),.5*ccHeight(this.m_win_lose_layer)-150),this.m_win_lose_layer.addChild(star),NOT_USE_SP_BATTLE_ANIMATION){star.setScale(2),star.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_win_skip_03.png");delay=new cc.DelayTime(1.2),cb=new cc.CallFunc(this.cbMakeWinLose,this),seq=new cc.Sequence(delay,cb);star.runAction(seq),seq=cb=delay=null;for(i=0;i<task_count;i++){res_string=RES_CDN_DEFULT+cmString("uieffect_2/uieffect_sprite/effect_war_win_skip_%02d.png",7+4*i);(star_sub=cc.Sprite.create(res_string)).setAnchorPoint(ANCHOR_MIDDLE()),star_sub.setScale(2),star_sub.setOpacity(0),star_sub.setPosition(.5*ccWidth(this.m_win_lose_layer),.5*ccHeight(this.m_win_lose_layer)-150),this.m_win_lose_layer.addChild(star_sub);delay=new cc.DelayTime(.1+.4*i),fadein=cc.fadeIn(.1),scaleTo_1=new cc.ScaleTo(.1,2.03,2.03),scaleTo_2=new cc.ScaleTo(.2,2,2),sequence=new cc.Sequence(delay,fadein,scaleTo_1,scaleTo_2);star_sub.runAction(sequence),sequence=scaleTo_2=scaleTo_1=fadein=delay=null}}else{ani=BattleAni._getInstance().getAnimate(BattleAni_.EffectResultStarSkip_0+task_count),delay=new cc.DelayTime(1.2),cb=new cc.CallFunc(this.cbMakeWinLose,this),seq=new cc.Sequence(ani,delay,cb);star.runAction(seq),seq=cb=delay=ani=null}}else this.scheduleOnce(function(){this.cbMakeWinLose()}.bind(this),2.5,"success_impact_star");else if(this.m_game_type==db.BattleGameType.EventDungeon)if(0!=this.m_event_dungeon_result.task_list.length){for(task_count=0,i=this.m_event_dungeon_result.task_list.length-1;0<=i;--i)"y"==this.m_event_dungeon_result.task_list[i].complete_yn&&task_count++;var star;if((star=cc.Sprite.create()).setAnchorPoint(ANCHOR_MIDDLE()),star.setPosition(.5*ccWidth(this.m_win_lose_layer),.5*ccHeight(this.m_win_lose_layer)-150),this.m_win_lose_layer.addChild(star),NOT_USE_SP_BATTLE_ANIMATION){star.setScale(2),star.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_win_skip_03.png");delay=new cc.DelayTime(1.2),cb=new cc.CallFunc(this.cbMakeWinLose,this),seq=new cc.Sequence(delay,cb);star.runAction(seq),seq=cb=delay=null;for(i=0;i<task_count;i++){var star_sub;res_string=RES_CDN_DEFULT+cmString("uieffect_2/uieffect_sprite/effect_war_win_skip_%02d.png",7+4*i);(star_sub=cc.Sprite.create(res_string)).setAnchorPoint(ANCHOR_MIDDLE()),star_sub.setScale(2),star_sub.setOpacity(0),star_sub.setPosition(.5*ccWidth(this.m_win_lose_layer),.5*ccHeight(this.m_win_lose_layer)-150),this.m_win_lose_layer.addChild(star_sub);delay=new cc.DelayTime(.1+.4*i),fadein=cc.fadeIn(.1),scaleTo_1=new cc.ScaleTo(.1,2.03,2.03),scaleTo_2=new cc.ScaleTo(.2,2,2),sequence=new cc.Sequence(delay,fadein,scaleTo_1,scaleTo_2);star_sub.runAction(sequence),sequence=scaleTo_2=scaleTo_1=fadein=delay=null}}else{ani=BattleAni._getInstance().getAnimate(BattleAni_.EffectResultStarSkip_0+task_count),delay=new cc.DelayTime(1.2),cb=new cc.CallFunc(this.cbMakeWinLose,this),seq=new cc.Sequence(ani,delay,cb);star.runAction(seq),seq=cb=delay=ani=null}}else this.scheduleOnce(function(){this.cbMakeWinLose()}.bind(this),2.5,"success_impact_star");else this.scheduleOnce(function(){this.cbMakeWinLose()}.bind(this),2.5,"success_impact_star")},cbMakeWinLose:function(){if(this.m_is_win)if(this.m_game_type==db.BattleGameType.Mission||this.m_game_type==db.BattleGameType.EventDungeon||this.m_game_type==db.BattleGameType.EventRaidDungeon||this.m_game_type==db.BattleGameType.StoryHardMode){var helper_type=BattleContext._getInstance().getHelperType();helper_type==HELPTER_TYPE_FRIEND||0==helper_type?this.winAfterProgress():this.showFriendBox()}else this.winAfterProgress();else if(this.appearButtons(),this.m_game_type==db.BattleGameType.RaidDungeon)this.m_raid_boss_result.raid_boss_info.discovered_user_id==m_user_id&&this.m_raid_boss_result.raid_boss_info.shared_type==database.Raid_Boss_Shared_Type.Raid_Boss_Shared_Type_None&&this.showRaidBossSharedPopup(this.m_raid_boss_result.raid_boss_info);else if(this.m_game_type==db.BattleGameType.EventRaidDungeon){var winSize=ccSize(this);if(1==BattleContext._getInstance().getEventRaidDungeonBattleSkip()){var move=new cc.MoveTo(.3,cc.p(.5*winSize.width,.5*winSize.height+120));this.m_lose.runAction(move);var dmg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_damage.png",RectZero());dmg_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),dmg_box.setPosition(ZERO()),dmg_box.setPreferredSize(cc.size(winSize.width,90)),this.m_win_lose_layer.addChild(dmg_box);var max_damage_1=Number(this.m_event_raid_battle_win.maxdamage).toLocaleString("en"),max_damage=new cmMultiLabel;max_damage.addLabel("与えたダメージ（最大ダメージ）",LABEL_FONT_INDEX.FONT_301),max_damage.addLabel(cmString("%s",max_damage_1),LABEL_FONT_INDEX.FONT_302),max_damage.setLabel(),max_damage.setAnchorPoint(ANCHOR_MIDDLE()),max_damage.setPosition(ccCenter(dmg_box).x-200,ccCenter(dmg_box).y),dmg_box.addChild(max_damage)}}},showFriendBox:function(){this.m_friend_box.setContentSize(ccSize(this)),this.m_friend_box._contentNode=function(contentSize,m){return this.getFriendBoxLayer()}.bind(this),this.m_friend_box.show()},getFriendBoxLayer:function(){var helper=BattleContext._getInstance().getBattleHelperInfo(),g=MasterManager.getInstance().get_General(helper.partner_gnrl_id),layer=new cc.Layer,mask_bg=cc.Sprite.create(RES_CDN_DEFULT+"common/img_mask.png");mask_bg.setPosition(ccCenter(this)),layer.addChild(mask_bg);var size=cc.size(630,370),bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));bg.setPreferredSize(size),bg.setPosition(ccCenter(layer)),layer.addChild(bg);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_3.png");navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(bg).x,ccHeight(bg)-11),bg.addChild(navi);var label_title=cmLabel.getLabel("フレンド申請",LABEL_FONT_INDEX.FONT_261);label_title.setAnchorPoint(ANCHOR_MIDDLE()),label_title.setPosition(ccCenter(navi).x,ccCenter(navi).y+3),navi.addChild(label_title);var box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",cc.Rect(20,20,20,20));box.setAnchorPoint(ANCHOR_MIDDLE()),box.setPosition(ccCenter(bg).x,ccCenter(bg).y+30),box.setContentSize(444,124),bg.addChild(box);var card={};card.gnrl_id=helper.partner_gnrl_id,card.level=helper.partner_gnrl_lv,card.limit_step_id=helper.partner_gnrl_limit_step_id;var gnrl_icon=(new Card).createCard(card,CARD_TYPE.type_common_card);gnrl_icon.setAnchorPoint(ZERO()),gnrl_icon.setPosition(12,13),box.addChild(gnrl_icon);var frnd_name=cmLabel.getLabel(helper.nickname,LABEL_FONT_INDEX.FONT_2013);if(frnd_name.setAnchorPoint(ZERO()),frnd_name.setPosition(221,89),box.addChild(frnd_name),""!=helper.naming&&null!=helper.naming&&null!=helper.naming){var frnd_naming=cmLabel.getLabel(helper.naming,LABEL_FONT_INDEX.FONT_2011);frnd_naming.setAnchorPoint(ZERO()),frnd_naming.setPosition(119,15),box.addChild(frnd_naming)}var helper_type_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_friend/img_friend_text_1.png");helper_type_icon.setAnchorPoint(ZERO()),helper_type_icon.setPosition(115,88),box.addChild(helper_type_icon);var gnrl_name=cmLabel.getLabel(g.name,LABEL_FONT_INDEX.FONT_2011);gnrl_name.setAnchorPoint(ZERO()),gnrl_name.setPosition(119,39),box.addChild(gnrl_name);var text_label=cmLabel.getLabel("このサポーターにフレンド申請しますか。",LABEL_FONT_INDEX.FONT_241);text_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),text_label.setPosition(ccCenter(bg).x,92),bg.addChild(text_label);var btn_ok=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);btn_ok.setFont(LABEL_FONT_INDEX.FONT_241),btn_ok.setString("はい"),btn_ok.setAnchorPoint(ZERO()),btn_ok.setPosition(ccCenter(bg).x+16,16),btn_ok.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.supporter_friend_request)}),bg.addChild(btn_ok);var btn_no=new LabelButton("btn_08_off.png","btn_08_on.png","",ccui.Widget.PLIST_TEXTURE);return btn_no.setFont(LABEL_FONT_INDEX.FONT_241),btn_no.setString("いいえ"),btn_no.setAnchorPoint(ZERO()),btn_no.setPosition(ccCenter(bg).x-ccWidth(btn_ok)-16,16),btn_no.addClickEventListener(function(sender){this.winAfterProgress(),this.m_friend_box.hide()}.bind(this)),bg.addChild(btn_no),layer},friendBoxHide:function(){this.m_friend_box.is_show()&&this.m_friend_box.hide()},winAfterProgress:function(){this.m_win_lose_layer.setVisible(!1),this.makeResultMissionReward(),this.voicePlay(voice_battle_win_leader)},makeResultMissionReward:function(){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_acclamation.mp3";this.m_is_skip||audio.playEffect(path);var m=MasterTable.getInstance(),mt=MasterManager.getInstance(),partner_id=(ccSize(this),0);if(this.m_gnrl_img=[],1==USE_PARTNER_GNRL_LOADING){var partner_yunhee=GameDefault.getInstance().GetPartnerYunheeLoad();if(1==partner_yunhee.load)for(var tdx=0;tdx<partner_yunhee.gnrl_img.length;tdx++)this.m_gnrl_img.push(partner_yunhee.gnrl_img[tdx]);this.m_bp=partner_yunhee.position,partner_id=partner_yunhee.partner_id}else{var generalService=GeneralService.getInstance(),partner_gnrl=new db.UserGeneralInfo,partner_key=GameContext.getInstance().getUserGeneralPartner(),gnrl_key=new net.User_General_Key;gnrl_key.gnrl_id=partner_key.gnrl_id,gnrl_key.gnrl_num=partner_key.gnrl_num,generalService.getUserGnrlDisplayClassInfo(gnrl_key,partner_gnrl),partner_id=partner_gnrl.class_type>=AVAIL_EVOLUTION_CLASS_TYPE_LIMIT&&0!=partner_gnrl.display_class&&partner_gnrl.class_type!=partner_gnrl.display_class?partner_gnrl.gnrl_id-1e3*(partner_gnrl.class_type-partner_gnrl.display_class):partner_gnrl.gnrl_id;var morph=m.get_MorphData(partner_id);this.m_bp=mt.get_BodyPosition(partner_id);var gnrl=mt.get_General(morph.gnrl_id);if("y"==morph.is_morph){var stading_files=StandingMultiplePngList[morph.gnrl_id];if(null==stading_files)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".png");else for(var idx=0;idx<stading_files.length;idx++)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+stading_files[idx]+".png");this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".atlas"),this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".json")}else{var general=mt.get_General(partner_id);if(general.gnrl_type==GENERAL_TYPE_YUNHEE){if(mt.get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var str=getCardBody_ImageStr(general.gnrl_id);this.m_gnrl_img.push(str)}else{str=getCardBody_ImageStr(general.gnrl_id);this.m_gnrl_img.push(str)}}else{str=getCardBody_ImageStr(partner_id);this.m_gnrl_img.push(str)}}}this.m_gnrl_img.push(RES_CDN_DEFULT+"common/bg_sub_3.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_formation/img_formation_point.png"),cc.loader.load(this.m_gnrl_img,function(err,results){err||this.resourceLoader_start(partner_id)}.bind(this))},resourceLoader_start:function(partner_id){var m=MasterTable.getInstance(),mt=MasterManager.getInstance(),winSize=ccSize(this),morph=m.get_MorphData(partner_id),gnrl=mt.get_General(morph.gnrl_id);if(this.m_result_layer=new cc.Layer,this.m_result_layer.ignoreAnchorPointForPosition(!1),this.m_result_layer.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_result_layer.setPosition(ZERO()),this.addChild(this.m_result_layer),this.m_game_type==db.BattleGameType.EventMussangBossDungeon){var bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/bg_raid_result.jpg");USE_SP_RAIDBOSS_SCALE&&bg.setScale(2),bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(winSize)),this.m_result_layer.addChild(bg)}else{(bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub_3.png")).setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(winSize)),USE_SP_COMMON_SUB_BG_SCALE&&bg.setScale(2),this.m_result_layer.addChild(bg)}if("y"==morph.is_morph){var standing_atlas=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".atlas",standing_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".json";this.m_skeletonNode=new sp.SkeletonAnimation(standing_json,standing_atlas),this.m_skeletonNode.setScale(.1),this.m_skeletonNode.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_skeletonNode.setPosition(MAIN_POS(this,this.m_bp.posx,this.m_bp.posy)),this.m_result_layer.addChild(this.m_skeletonNode),this.m_skeletonNode.setMix("basic","active",.1),this.m_skeletonNode.setMix("active","basic",.1),this.m_skeletonNode.setAnimation(0,"active",!1),this.m_skeletonNode.addAnimation(0,"basic",!0)}else{var general=mt.get_General(partner_id);if(this.m_img_scale=1,general.gnrl_type==GENERAL_TYPE_YUNHEE){if(mt.get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id)}else{img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id)}}else{img_str=getCardBody_ImageStr(partner_id);this.m_img_scale=getCardBody_Scale(partner_id)}this.m_partner_gnrl=cc.Sprite.create(img_str),this.m_partner_gnrl.setScale(this.m_img_scale),this.m_partner_gnrl.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_partner_gnrl.setPosition(MAIN_POS(this,this.m_bp.posx+ccWidth(this.m_partner_gnrl)*this.m_img_scale,this.m_bp.posy)),this.m_result_layer.addChild(this.m_partner_gnrl);var move=new cc.MoveTo(.5,MAIN_POS(this,this.m_bp.posx,this.m_bp.posy)),ease=new cc.EaseExponentialOut(move);this.m_partner_gnrl.runAction(ease)}var title_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_main/bg_state_title.png");title_bg.setAnchorPoint(ANCHOR_TOP_LEFT()),title_bg.setPosition(0,ccHeight(this)),this.m_result_layer.addChild(title_bg);var result_title=cc.Sprite.create("#img_result_text.png");result_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),result_title.setPosition(30,66),title_bg.addChild(result_title);var result_win=new cc.Sprite;if(result_win.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),result_win.setPosition(.5*winSize.width,442),this.m_result_layer.addChild(result_win),this.m_game_type==db.BattleGameType.Mission){if(this.m_is_skip){if(null!=this.m_story_dungeon_skip_result&&this.m_story_dungeon_skip_result.mission_id!=YEOWA_STAGE_ID)if(NOT_USE_SP_BATTLE_ANIMATION){result_win.setScale(2),result_win.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_result_win_10.png");var scaleTo_1=new cc.ScaleTo(.7,2,2.01),scaleTo_2=new cc.ScaleTo(.7,2,1.99),sequence=new cc.Sequence(scaleTo_1,scaleTo_2);repeat=new cc.RepeatForever(sequence);result_win.runAction(repeat),repeat=sequence=scaleTo_2=scaleTo_1=null}else{var ani=BattleAni._getInstance().getAnimate(BattleAni_.EffectWinText),repeat=new cc.RepeatForever(ani);result_win.runAction(repeat),repeat=ani=null}}else if(null!=this.m_main_mission_result_v2&&this.m_main_mission_result_v2.mission_id!=YEOWA_STAGE_ID)if(NOT_USE_SP_BATTLE_ANIMATION){result_win.setScale(2),result_win.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_result_win_10.png");scaleTo_1=new cc.ScaleTo(.7,2,2.01),scaleTo_2=new cc.ScaleTo(.7,2,1.99),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);result_win.runAction(repeat),repeat=sequence=scaleTo_2=scaleTo_1=null}else{ani=BattleAni._getInstance().getAnimate(BattleAni_.EffectWinText);var repeat=new cc.RepeatForever(ani);result_win.runAction(repeat),repeat=ani=null}}else if(NOT_USE_SP_BATTLE_ANIMATION){result_win.setScale(2),result_win.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_result_win_10.png");scaleTo_1=new cc.ScaleTo(.7,2,2.01),scaleTo_2=new cc.ScaleTo(.7,2,1.99),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);result_win.runAction(repeat),repeat=sequence=scaleTo_2=scaleTo_1=null}else{ani=BattleAni._getInstance().getAnimate(BattleAni_.EffectWinText),repeat=new cc.RepeatForever(ani);result_win.runAction(repeat),repeat=ani=null}var user_info=BattleContext._getInstance().getBeforeBattleUserInfo();100<user_info.user_level&&(user_info.user_level=100),this.m_user_level_count=user_info.user_level;var max_width=0,str_lv="LV "+cmString(user_info.user_level.toString());if(this.m_user_level=cmLabel.getLabel(str_lv,LABEL_FONT_INDEX.FONT_261),this.m_user_level.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_user_level.setPosition(LP(this,20,456)),this.m_result_layer.addChild(this.m_user_level),max_width=60,cmLabel.autoSizeFit(this.m_user_level,max_width,26),this.m_user_name=cmLabel.getLabel(user_info.nickname,LABEL_FONT_INDEX.FONT_143),this.m_user_name.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_user_name.setPosition(LP(this,221,456)),this.m_result_layer.addChild(this.m_user_name),max_width=140,cmLabel.autoSizeFit(this.m_user_name,max_width,14),this.m_game_type==db.BattleGameType.Mission){var mission=null,story=null,mission_id=0;mission_id=this.m_is_skip?this.m_story_dungeon_skip_result.mission_id:this.m_main_mission_result_v2.mission_id,mission=mt.get_MainMission(mission_id),story=mt.get_MainStory(mission.main_scene_id,mission.main_story_id);var mission_name_str="";if(mission_name_str=mission_id==YEOWA_STAGE_ID?cmString("%s %s",mission.name,story.story_name):cmString("%s %s %s",mission.name,story.story_name,res_str("label_battle_result_win")),(mission_name=cmLabel.getLabel(mission_name_str,LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),mission_name.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),mission_name.setPosition(LP(winSize,20,500)),this.m_result_layer.addChild(mission_name),max_width=320,cmLabel.autoSizeFit(mission_name,max_width,24),0!=(campaign=MasterTable.getInstance().get_RewardCampaignUi(CAMPAIGN_DUNGEON_TYPE_STORY,CAMPAIGN_POSITION_TYPE_RESULT_TEXT)).dugeon_type&&null!=campaign.dugeon_type)if(0==campaign.value)(icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("common/%s",campaign.image_name))).setAnchorPoint(ZERO()),icon.setPosition(LP(this,10,530)),this.m_result_layer.addChild(icon);else if(mission.main_story_id<=campaign.value)(icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("common/%s",campaign.image_name))).setAnchorPoint(ZERO()),icon.setPosition(LP(this,10,530)),this.m_result_layer.addChild(icon)}else if(this.m_game_type==db.BattleGameType.StoryHardMode){var campaign,icon,main_story_hard_mode_mission_idx=this.m_story_hard_mode_result.main_story_hard_mode_mission_idx,page=(mission=mt.get_MainStoryHardModeMission(main_story_hard_mode_mission_idx),story=mt.get_MainStoryHardMode(1,mission.difficult,mission.main_story_id),cmString(res_str("label_story_page_title"),story.main_story_id)),stage=cmString(res_str("label_story_stage"),mission.mission_num);mission_name_str=cmString("%s %s %s %s",page,story.name,stage,res_str("label_battle_result_win"));if((mission_name=cmLabel.getLabel(mission_name_str,LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),mission_name.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),mission_name.setPosition(LP(winSize,20,500)),this.m_result_layer.addChild(mission_name),max_width=320,cmLabel.autoSizeFit(mission_name,max_width,24),0!=(campaign=MasterTable.getInstance().get_RewardCampaignUi(CAMPAIGN_DUNGEON_TYPE_STORY_HARD_MODE,CAMPAIGN_POSITION_TYPE_RESULT_TEXT)).dugeon_type&&null!=campaign.dugeon_type)if(0==campaign.value)(icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("new_common/%s",campaign.image_name))).setAnchorPoint(ZERO()),icon.setPosition(LP(this,10,530)),this.m_result_layer.addChild(icon);else if(mission.main_story_id<=campaign.value)(icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("common/%s",campaign.image_name))).setAnchorPoint(ZERO()),icon.setPosition(LP(this,10,530)),this.m_result_layer.addChild(icon)}else if(this.m_game_type==db.BattleGameType.WeeklyDungeon){var weekly_dungeon=BattleContext._getInstance().getWeeklyDungeonData(),str="{0} {1}".format(weekly_dungeon.weekly_dungeon.name,mt.get_LanguageData("label_battle_result_win"));(mission_name=cmLabel.getLabel(str,LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),mission_name.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),mission_name.setPosition(LP(winSize,20,500)),this.m_result_layer.addChild(mission_name),max_width=320,cmLabel.autoSizeFit(mission_name,max_width,24)}else if(this.m_game_type==db.BattleGameType.Mussang){var mussang=$.extend({},database.BattleMussang);BattleService.getInstance().getMasterMussangStepStageNpc(this.m_mussang_step_result.mussang_id,mussang);var m_type=mt.get_MussangType(mussang.mussang.mussang_type);str="{0} {1} {2}".format(m_type.name,mussang.mussang.mussang_step,mt.get_LanguageData("label_battle_result_win"));(mission_name=cmLabel.getLabel(str,LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),mission_name.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),mission_name.setPosition(LP(winSize,20,500)),this.m_result_layer.addChild(mission_name),max_width=320,cmLabel.autoSizeFit(mission_name,max_width,24)}else if(this.m_game_type==db.BattleGameType.TowerDungeon){var dungeon=BattleContext._getInstance().getMussangTowerDungeonData();(mission_name=cmLabel.getLabel(cmString(res_str("label_mussang_tower_result_win_title"),dungeon.mussang_tower.step),LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),mission_name.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),mission_name.setPosition(LP(winSize,20,500)),this.m_result_layer.addChild(mission_name),max_width=320,cmLabel.autoSizeFit(mission_name,max_width,24)}else if(this.m_game_type==db.BattleGameType.EventDungeon){var event_dungeon_idx=0;event_dungeon_idx=this.m_is_skip?this.m_event_dungeon_skip_result.event_dungeon_idx:this.m_event_dungeon_result.event_dungeon_idx;var diff_str="";if(46e3==(dungeon=mt.get_EventDungeon(event_dungeon_idx)).event_dungeon_idx){str="{0} {1}".format(dungeon.name,mt.get_LanguageData("label_battle_result_win"));(mission_name=cmLabel.getLabel(str,LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),mission_name.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),mission_name.setPosition(LP(winSize,20,500)),this.m_result_layer.addChild(mission_name),max_width=320,cmLabel.autoSizeFit(mission_name,max_width,24)}else{var difficulty=MasterManager.getInstance().get_EventDungeonDifficultyType(dungeon.event_dungeon_difficulty_type);diff_str="y"==dungeon.two_times_yn?cmString("[%s x2]",difficulty.name):cmString("[%s]",difficulty.name);str="{0} {1} {2}".format(dungeon.name,mt.get_LanguageData("label_battle_result_win"),diff_str);(mission_name=cmLabel.getLabel(str,LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),mission_name.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),mission_name.setPosition(LP(winSize,20,500)),this.m_result_layer.addChild(mission_name),max_width=320,cmLabel.autoSizeFit(mission_name,max_width,24)}}else if(this.m_game_type==db.BattleGameType.OnceADayDungeon){dungeon=mt.get_EventDungeonOnceADay(this.m_once_a_day_result_win.event_dungeon_once_a_day_idx);(mission_name=cmLabel.getLabel(cmString("%s %s",dungeon.name,res_str("label_battle_result_win")),LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),mission_name.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),mission_name.setPosition(LP(winSize,20,500)),this.m_result_layer.addChild(mission_name),max_width=320,cmLabel.autoSizeFit(mission_name,max_width,24)}else if(this.m_game_type==db.BattleGameType.GreatWallDungeon){dungeon=mt.get_GreatWallDungeon(this.m_great_wall_dungeon_win.great_wall_dungeon_idx,this.m_great_wall_dungeon_win.great_wall_dungeon_group_idx);(mission_name=cmLabel.getLabel(cmString(res_str("label_great_wall_result_step_title"),dungeon.step,res_str("label_battle_result_win")),LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),mission_name.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),mission_name.setPosition(LP(winSize,20,500)),this.m_result_layer.addChild(mission_name)}else if(this.m_game_type==db.BattleGameType.DailyDungeon){dungeon=mt.get_DailyDungeon(this.m_daily_dungeon_result.daily_dungeon_idx),str="{0} {1}".format(dungeon.name,mt.get_LanguageData("label_battle_result_win"));(mission_name=cmLabel.getLabel(str,LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),mission_name.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),mission_name.setPosition(LP(winSize,20,500)),this.m_result_layer.addChild(mission_name)}else if(this.m_game_type==db.BattleGameType.RaidDungeon){var mission_name,raid_boss_info=MasterManager.getInstance().get_RaidBossInfo(this.m_raid_boss_result.raid_boss_info.raid_boss_info_idx);(mission_name=cmLabel.getLabel(cmString("%s %s",raid_boss_info.name,MasterManager.getInstance().get_LanguageData("Label_battle_result_win")),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),mission_name.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),mission_name.setPosition(LP(this,20,500)),this.m_result_layer.addChild(mission_name)}else if(this.m_game_type==db.BattleGameType.EventMussangBossDungeon);var a_before_lv=mt.get_UserLevel(user_info.user_level),a_next_lv=mt.get_UserLevel(user_info.user_level+1),cur_per=parseFloat((a_next_lv.need_exp-(a_next_lv.accm_exp-user_info.user_exp))/a_next_lv.need_exp*100).toFixed(2);this.m_user_exp_bar=new BattleOverRollProgressBar,this.m_user_exp_bar.create(RES_CDN_DEFULT+"menu_main/bg_state_name_energy_mask_2.png",RES_CDN_DEFULT+"menu_main/bg_state_name_energy.png"),this.m_user_exp_bar._fillProgressEvent=this.userLevelUpFillProgressEvent.bind(this),this.m_user_exp_bar._endProgressEvent=this.userLevelUpEndProgressEvent.bind(this),this.m_user_exp_bar.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_user_exp_bar.setPosition(LP(this,20,441)),this.m_user_exp_bar.setPercent(parseInt(cur_per),!1),this.m_result_layer.addChild(this.m_user_exp_bar);var next_per=0;if(this.m_user_exp=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_143,!1),this.m_user_exp.enableOutline(cc.color.BLACK,1),this.m_user_exp.setAnchorPoint(ANCHOR_MIDDLE()),this.m_user_exp.setPosition(.5*ccWidth(this.m_user_exp_bar),.5*ccHeight(this.m_user_exp_bar)),this.m_user_exp_bar.addChild(this.m_user_exp),a_before_lv.user_level<100){var n_per=UserService.getInstance().getUserLevelPrcnt();n_per=parseFloat(100*n_per).toFixed(2);var exp_str=parseInt(n_per)+"%";this.m_user_exp.setString(exp_str),next_per=1*n_per;var grade=0;this.m_game_type==db.BattleGameType.Mission?((grade=0)<(grade=this.m_is_skip?this.m_story_dungeon_skip_result.user_level-user_info.user_level:this.m_main_mission_result_v2.user_level-user_info.user_level)&&(next_per=Math.abs(next_per+100*grade)),this.m_user_exp_bar.setPercent(next_per,!0)):this.m_game_type==db.BattleGameType.StoryHardMode?(0<(grade=this.m_story_hard_mode_result.user_level-user_info.user_level)&&(next_per=Math.abs(next_per+100*grade)),this.m_user_exp_bar.setPercent(next_per,!0)):this.m_game_type==db.BattleGameType.WeeklyDungeon?((grade=0)<(grade=this.m_is_skip?this.m_weekly_dungeon_skip_result.user_level-user_info.user_level:this.m_weekly_dungeon_result.user_level-user_info.user_level)&&(next_per=Math.abs(next_per+100*grade)),this.m_user_exp_bar.setPercent(next_per,!0)):this.m_game_type==db.BattleGameType.EventDungeon?((grade=0)<(grade=this.m_is_skip?this.m_event_dungeon_skip_result.user_level-user_info.user_level:this.m_event_dungeon_result.user_level-user_info.user_level)&&(next_per=Math.abs(next_per+100*grade)),this.m_user_exp_bar.setPercent(next_per,!0)):this.m_game_type==db.BattleGameType.DailyDungeon?(0<(grade=this.m_daily_dungeon_result.user_level-user_info.user_level)&&(next_per=Math.abs(next_per+100*grade)),this.m_user_exp_bar.setPercent(next_per,!0)):this.m_game_type==db.BattleGameType.Mussang||this.m_game_type==db.BattleGameType.RaidDungeon||this.m_game_type==db.BattleGameType.GreatWallDungeon||this.m_game_type==db.BattleGameType.TowerDungeon||(this.m_game_type==db.BattleGameType.OnceADayDungeon?(0<(grade=this.m_once_a_day_result_win.user_level-user_info.user_level)&&(next_per=Math.abs(next_per+100*grade)),this.m_user_exp_bar.setPercent(next_per,!0)):this.m_game_type==db.BattleGameType.EventMussangBossDungeon||(this.m_game_type,db.BattleGameType.EventRaidDungeon))}var formation_point_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero());formation_point_box.setPreferredSize(cc.size(70,38)),formation_point_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),formation_point_box.setPosition(LP(this,420,409)),this.m_result_layer.addChild(formation_point_box),formation_point_box.setVisible(!1);var fSize=ccSize(formation_point_box),formation_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_formation/img_formation_point.png");formation_icon.setAnchorPoint(ANCHOR_MIDDLE()),formation_icon.setPosition(0,.5*fSize.height),formation_point_box.addChild(formation_icon);var formation_point=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2211);if(formation_point.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),formation_point.setPosition(fSize.width-10,.5*fSize.height),formation_point_box.addChild(formation_point),this.m_game_type==db.BattleGameType.Mission)this.countingLabelCallback();else if(this.m_game_type==db.BattleGameType.StoryHardMode)this.countingLabelCallback(null);else if(this.m_game_type==db.BattleGameType.WeeklyDungeon)this.countingLabelCallback(null);else if(this.m_game_type==db.BattleGameType.EventDungeon)this.countingLabelCallback(null);else if(this.m_game_type==db.BattleGameType.Mussang)this.countingLabelCallback(null);else if(this.m_game_type==db.BattleGameType.DailyDungeon)this.countingLabelCallback(null);else if(this.m_game_type==db.BattleGameType.RaidDungeon)this.countingLabelCallback(null);else if(this.m_game_type==db.BattleGameType.GreatWallDungeon)this.countingLabelCallback(null);else if(this.m_game_type==db.BattleGameType.TowerDungeon)this.countingLabelCallback(null);else if(this.m_game_type==db.BattleGameType.OnceADayDungeon)this.countingLabelCallback(null);else if(this.m_game_type==db.BattleGameType.EventMussangBossDungeon){var event_dungeon_Period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),boss_list=MasterTable.getInstance().get_EventDungeonMussangDungeonList(event_dungeon_Period_idx),eventdungeon_period_idx=boss_list.at(0).event_dungeon_period_idx,dungeon_info=mt.get_EventDungeonMussangBossInfo(this.m_mussang_boss_win.boss_dungeon_idx,eventdungeon_period_idx),npc_info=mt.get_EventDungeonMussangBossNpcInfo(boss_list.at(0).boss_dungeon_idx,1),npc_general=mt.get_NpcGeneral(npc_info.npc1_id),hero=$.extend({},database.BattleGeneral);BattleService.getInstance().setNpcGeneralData(hero,npc_general);var mussangboss_name=dungeon_info.mussang_boss_name,boss_name=cmLabel.getLabel(cmString(res_str("lavel_event_dungeon_mussang_boss_name"),mussangboss_name),LABEL_FONT_INDEX.FONT_201);switch(boss_name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),boss_name.setPosition(144,498),this.m_result_layer.addChild(boss_name),hero.general.element_type){case ELEMENT_TYPE_FIRE:boss_name.setColor(cc.color(220,36,36));break;case ELEMENT_TYPE_WATER:boss_name.setColor(cc.color(77,134,241));break;case ELEMENT_TYPE_WIND:boss_name.setColor(cc.color(79,193,44));break;case ELEMENT_TYPE_DARK:boss_name.setColor(cc.color(225,206,77));break;case ELEMENT_TYPE_LIGHT:boss_name.setColor(cc.color(204,67,209))}ccSize(boss_name);var element_icon=cc.Sprite.create(cmString("#img_battletech_%d.png",parseInt(hero.general.element_type)));element_icon.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),element_icon.setPosition(126,495),this.m_result_layer.addChild(element_icon,100),this.countingLabelCallback(null)}else this.m_game_type==db.BattleGameType.EventRaidDungeon&&this.countingLabelCallback(null);var btn,key_bound_increase=NetService().get_User_Plus_Key_Bound();if(this.m_game_type==db.BattleGameType.Mission){if(user_level_mission=this.m_is_skip?(is_user_level_up=this.m_story_dungeon_skip_result.is_user_level_up,this.m_story_dungeon_skip_result.user_level):(is_user_level_up=this.m_main_mission_result_v2.is_user_level_up,this.m_main_mission_result_v2.user_level),"y"==is_user_level_up){var b=mt.get_UserLevel(user_info.user_level),n=mt.get_UserLevel(user_level_mission),offset_x=208;(title=cmLabel.getLabel(mt.get_LanguageData("label_mission_result_gain_key"),LABEL_FONT_INDEX.FONT_2013)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(LP(this,offset_x,412)),this.m_result_layer.addChild(title),offset_x+=70,(before=cmLabel.getLabel("{0}".format(Number(b.key_bound+key_bound_increase)),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),before.setPosition(LP(this,offset_x,412)),this.m_result_layer.addChild(before),offset_x+=ccWidth(before)+5,(arrow=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_arrow_3.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),arrow.setPosition(LP(this,offset_x,415)),this.m_result_layer.addChild(arrow),offset_x+=ccWidth(arrow)+5,(after=cmLabel.getLabel("{0}".format(Number(n.key_bound+key_bound_increase)),LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),after.setPosition(LP(this,offset_x,412)),this.m_result_layer.addChild(after),offset_x+=ccWidth(after)+40,gain_formation_point=this.m_is_skip?this.m_story_dungeon_skip_result.gain_formation_point:this.m_main_mission_result_v2.gain_formation_point,formation_point_box.setVisible(!0),formation_point_box.setPosition(LP(this,offset_x,412)),formation_point.setString("+{0}".format(Number(gain_formation_point)))}}else if(this.m_game_type==db.BattleGameType.StoryHardMode){var is_user_level_up="y"==this.m_story_hard_mode_result.is_user_level_up,user_level_mission=this.m_story_hard_mode_result.user_level;if(is_user_level_up){b=mt.get_UserLevel(user_info.user_level),n=mt.get_UserLevel(user_level_mission),offset_x=208;(title=cmLabel.getLabel(mt.get_LanguageData("label_mission_result_gain_key"),LABEL_FONT_INDEX.FONT_2013)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(LP(this,offset_x,412)),this.m_result_layer.addChild(title),offset_x+=70,(before=cmLabel.getLabel("{0}".format(Number(b.key_bound+key_bound_increase)),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),before.setPosition(LP(this,offset_x,412)),this.m_result_layer.addChild(before),offset_x+=ccWidth(before)+5,(arrow=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_arrow_3.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),arrow.setPosition(LP(this,offset_x,415)),this.m_result_layer.addChild(arrow),offset_x+=ccWidth(arrow)+5,(after=cmLabel.getLabel("{0}".format(Number(n.key_bound+key_bound_increase)),LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),after.setPosition(LP(this,offset_x,412)),this.m_result_layer.addChild(after),offset_x+=ccWidth(after)+40;var gain_formation_point=this.m_story_hard_mode_result.gain_formation_point;formation_point_box.setVisible(!0),formation_point_box.setPosition(LP(this,offset_x,412)),formation_point.setString("+{0}".format(Number(gain_formation_point)))}}else if(this.m_game_type==db.BattleGameType.WeeklyDungeon){var user_level_weekly;if(gain_formation_point=this.m_is_skip?(is_user_level_up=this.m_weekly_dungeon_skip_result.is_user_level_up,user_level_weekly=this.m_weekly_dungeon_skip_result.user_level,this.m_weekly_dungeon_skip_result.gain_formation_point):(is_user_level_up=this.m_weekly_dungeon_result.is_user_level_up,user_level_weekly=this.m_weekly_dungeon_result.user_level,this.m_weekly_dungeon_result.gain_formation_point),"y"==is_user_level_up){offset_x=208,b=mt.get_UserLevel(user_info.user_level),n=mt.get_UserLevel(user_level_weekly);(title=cmLabel.getLabel(mt.get_LanguageData("label_mission_result_gain_key"),LABEL_FONT_INDEX.FONT_2013)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(LP(this,offset_x,412)),this.m_result_layer.addChild(title),offset_x+=70,(before=cmLabel.getLabel("{0}".format(Number(b.key_bound+key_bound_increase)),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),before.setPosition(LP(this,offset_x,412)),this.m_result_layer.addChild(before),offset_x+=ccWidth(before)+5,(arrow=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_arrow_3.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),arrow.setPosition(LP(this,offset_x,415)),this.m_result_layer.addChild(arrow),offset_x+=ccWidth(arrow)+5,(after=cmLabel.getLabel("{0}".format(Number(n.key_bound+key_bound_increase)),LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),after.setPosition(LP(this,offset_x,412)),this.m_result_layer.addChild(after),offset_x+=ccWidth(after)+40,formation_point_box.setVisible(!0),formation_point_box.setPosition(LP(this,offset_x,412)),formation_point.setString("+{0}".format(Number(gain_formation_point)))}}else if(this.m_game_type==db.BattleGameType.EventDungeon){var user_level;if(gain_formation_point=this.m_is_skip?(is_user_level_up=this.m_event_dungeon_skip_result.is_user_level_up,user_level=this.m_event_dungeon_skip_result.user_level,this.m_event_dungeon_skip_result.gain_formation_point):(is_user_level_up=this.m_event_dungeon_result.is_user_level_up,user_level=this.m_event_dungeon_result.user_level,this.m_event_dungeon_result.gain_formation_point),"y"==is_user_level_up){offset_x=208,b=mt.get_UserLevel(user_info.user_level),n=mt.get_UserLevel(user_level);(title=cmLabel.getLabel(mt.get_LanguageData("label_mission_result_gain_key"),LABEL_FONT_INDEX.FONT_2013)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(LP(this,offset_x,412)),this.m_result_layer.addChild(title),offset_x+=70,(before=cmLabel.getLabel("{0}".format(Number(b.key_bound+key_bound_increase)),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),before.setPosition(LP(this,offset_x,412)),this.m_result_layer.addChild(before),offset_x+=ccWidth(before)+5,(arrow=new cc.Sprite(RES_CDN_DEFULT+"menu_yh/img_yh_arrow_3.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),arrow.setPosition(LP(this,offset_x,415)),this.m_result_layer.addChild(arrow),offset_x+=ccWidth(arrow)+5,(after=cmLabel.getLabel("{0}".format(Number(n.key_bound+key_bound_increase)),LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),after.setPosition(LP(this,offset_x,412)),this.m_result_layer.addChild(after),offset_x+=ccWidth(after)+40,formation_point_box.setVisible(!0),formation_point_box.setPosition(LP(this,offset_x,412)),formation_point.setString("+{0}".format(Number(gain_formation_point)))}}else if(this.m_game_type==db.BattleGameType.OnceADayDungeon){if("y"==this.m_once_a_day_result_win.is_user_level_up){offset_x=208,b=mt.get_UserLevel(user_info.user_level),n=mt.get_UserLevel(this.m_once_a_day_result_win.user_level);(title=cmLabel.getLabel(res_str("label_mission_result_gain_key"),LABEL_FONT_INDEX.FONT_2013)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(LP(this,offset_x,412)),this.m_result_layer.addChild(title),offset_x+=70,(before=cmLabel.getLabel("{0}".format(Number(b.key_bound+key_bound_increase)),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),before.setPosition(LP(this,offset_x,412)),this.m_result_layer.addChild(before),offset_x+=ccWidth(before)+5,(arrow=new cc.Sprite(RES_CDN_DEFULT+"menu_yh/img_yh_arrow_3.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),arrow.setPosition(LP(this,offset_x,415)),this.m_result_layer.addChild(arrow),offset_x+=ccWidth(arrow)+5,(after=cmLabel.getLabel("{0}".format(Number(b.key_bound+key_bound_increase)),LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),after.setPosition(LP(offset_x,412)),this.m_result_layer.addChild(after),offset_x+=ccWidth(after)+40,formation_point_box.setVisible(!0),formation_point_box.setPosition(LP(offset_x,412)),formation_point.setString("+{0}".format(Number(this.m_once_a_day_result_win.gain_formation_point)))}}else if(this.m_game_type==db.BattleGameType.DailyDungeon){if("y"==this.m_daily_dungeon_result.is_user_level_up){var title,before,arrow,after;offset_x=208,b=mt.get_UserLevel(user_info.user_level),n=mt.get_UserLevel(this.m_daily_dungeon_result.user_level);(title=cmLabel.getLabel(mt.get_LanguageData("label_mission_result_gain_key"),LABEL_FONT_INDEX.FONT_2013)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(LP(this,winSize,offset_x,412)),this.m_result_layer.addChild(title),offset_x+=70,(before=cmLabel.getLabel(""+(b.key_bound+key_bound_increase),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),before.setPosition(LP(this,winSize,offset_x,412)),this.m_result_layer.addChild(before),offset_x+=before.getContentSize().width+5,(arrow=new cc.Sprite(RES_CDN_DEFULT+"menu_yh/img_yh_arrow_3.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),arrow.setPosition(LP(this,winSize,offset_x,415)),this.m_result_layer.addChild(arrow),offset_x+=arrow.getContentSize().width+5,(after=cmLabel.getLabel(""+(n.key_bound+key_bound_increase),LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),after.setPosition(LP(this,winSize,offset_x,412)),this.m_result_layer.addChild(after),offset_x+=after.getContentSize().width+40,formation_point_box.setVisible(!0),formation_point_box.setPosition(LP(this,winSize,offset_x,412)),formation_point.setString(""+this.m_daily_dungeon_result.gain_formation_point)}}else this.m_game_type==db.BattleGameType.Mussang||this.m_game_type==db.BattleGameType.RaidDungeon||this.m_game_type==db.BattleGameType.GreatWallDungeon||this.m_game_type==db.BattleGameType.TowerDungeon||(this.m_game_type,db.BattleGameType.EventMussangBossDungeon);TEST_DAMAGE_LOG_SHOW&&((btn=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE)).setFont(LABEL_FONT_INDEX.FONT_241),btn.setString("DAMAGE"),btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),btn.setPosition(winSize.width-10,winSize.height-10),this.m_result_layer.addChild(btn),btn.addClickEventListener(function(sender){this.showDebugBox()}.bind(this)));TEST_GENERAL_LOG_SHOW&&((btn=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE)).setFont(LABEL_FONT_INDEX.FONT_241),btn.setString("DEBUG"),btn.setAnchorPoint(ANCHOR_TOP_LEFT()),btn.setPosition(10,winSize.height-10),this.m_result_layer.addChild(btn),btn.addClickEventListener(function(sender){this.showGeneralDebugBox()}.bind(this)))},appearGeneral:function(){if(this.m_game_type!=db.BattleGameType.GreatWallDungeon){var title=new cc.Sprite("#img_result_text_exp.png");title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(LP(winSize,20,370)),this.m_result_layer.addChild(title)}var pos_list=new Array;if(this.m_game_type==db.BattleGameType.GreatWallDungeon){var pos_list_array=cc.p(348,202);pos_list.push_back(pos_list_array),pos_list_array=cc.p(228,282),pos_list.push_back(pos_list_array),pos_list_array=cc.p(228,142),pos_list.push_back(pos_list_array),pos_list_array=cc.p(108,282),pos_list.push_back(pos_list_array),pos_list_array=cc.p(108,142),pos_list.push_back(pos_list_array)}else{pos_list_array=cc.p(348,202);pos_list.push_back(pos_list_array),pos_list_array=cc.p(228,262),pos_list.push_back(pos_list_array),pos_list_array=cc.p(228,142),pos_list.push_back(pos_list_array),pos_list_array=cc.p(108,262),pos_list.push_back(pos_list_array),pos_list_array=cc.p(108,142),pos_list.push_back(pos_list_array)}var context=BattleContext._getInstance();if(this.m_game_type==db.BattleGameType.Mission)for(var gnrl_list=context.getBeforeBattleGeneralList(),i=0;i<5;i++){for(var is_exist=!1,pos=i+1,j=0;j<gnrl_list.size();j++){if(pos==(g=gnrl_list.at(j)).position){if(this.m_is_skip){for(var found=0,found_is=!1,j2=0;j2<this.m_story_dungeon_skip_result.gnrl_exp.length;j2++){var exp=this.m_story_dungeon_skip_result.gnrl_exp[j2];if(found=j2,g.gnrl_num==exp.gnrl_num&&g.gnrl_id==exp.gnrl_id){found_is=!0;break}}if(1==found_is)(gnrl=new BattleResultGeneral_V2).setData(g,this.m_story_dungeon_skip_result.gnrl_exp[found],g.position),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl)}else{for(found=0,found_is=!1,j2=0;j2<this.m_main_mission_result_v2.gnrl_exp.length;j2++){exp=this.m_main_mission_result_v2.gnrl_exp[j2];if(found=j2,g.gnrl_num==exp.gnrl_num&&g.gnrl_id==exp.gnrl_id){found_is=!0;break}}if(1==found_is)(gnrl=new BattleResultGeneral_V2).setData(g,this.m_main_mission_result_v2.gnrl_exp[found],g.position),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl)}is_exist=!0;break}}if(!is_exist){var g=new BattleGeneral(0);exp=net.User_General_Exp;g.gnrl_id=0,(gnrl=new BattleResultGeneral_V2).setData(g,exp,pos),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl),gnrl=g=null}}else if(this.m_game_type==db.BattleGameType.StoryHardMode)for(gnrl_list=context.getBeforeBattleGeneralList(),i=0;i<5;i++){for(is_exist=!1,pos=i+1,j=0;j<gnrl_list.size();j++){if(pos==(g=gnrl_list.at(j)).position){for(found=0,found_is=!1,j2=0;j2<this.m_story_hard_mode_result.gnrl_exp.length;j2++){exp=this.m_story_hard_mode_result.gnrl_exp[j2];if(found=j2,g.gnrl_num==exp.gnrl_num&&g.gnrl_id==exp.gnrl_id){found_is=!0;break}}if(1==found_is)(gnrl=new BattleResultGeneral_V2).setData(g,this.m_story_hard_mode_result.gnrl_exp[found],g.position),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl);is_exist=!0;break}}if(!is_exist){g=new BattleGeneral(0),exp=net.User_General_Exp;g.gnrl_id=0,(gnrl=new BattleResultGeneral_V2).setData(g,exp,pos),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl),gnrl=g=null}}else if(this.m_game_type==db.BattleGameType.WeeklyDungeon)for(gnrl_list=context.getBeforeBattleGeneralList(),i=0;i<5;i++){for(is_exist=!1,pos=i+1,j=0;j<gnrl_list.size();j++){if(pos==(g=gnrl_list.at(j)).position){(exp=net.User_General_Exp).gnrl_id=g.gnrl_id,exp.gnrl_num=g.gnrl_num,exp.gnrl_level=g.gnrl_level,exp.gnrl_exp=g.exp,(gnrl=new BattleResultGeneral_V2).setData(g,exp,g.position),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl),is_exist=!0;break}}if(!is_exist){g=new BattleGeneral(0),exp=net.User_General_Exp;g.gnrl_id=0,(gnrl=new BattleResultGeneral_V2).setData(g,exp,pos),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl),gnrl=g=null}}else if(this.m_game_type==db.BattleGameType.EventDungeon)for(gnrl_list=context.getBeforeBattleGeneralList(),i=0;i<5;i++){for(is_exist=!1,pos=i+1,j=0;j<gnrl_list.size();j++){if(pos==(g=gnrl_list.at(j)).position){if(this.m_is_skip){for(found=0,found_is=!1,j2=0;j2<this.m_event_dungeon_skip_result.gnrl_exp.length;j2++){exp=this.m_event_dungeon_skip_result.gnrl_exp[j2];if(found=j2,g.gnrl_num==exp.gnrl_num&&g.gnrl_id==exp.gnrl_id){found_is=!0;break}}if(1==found_is)(gnrl=new BattleResultGeneral_V2).setData(g,this.m_event_dungeon_skip_result.gnrl_exp[found],g.position),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl)}else{for(found=0,found_is=!1,j2=0;j2<this.m_event_dungeon_result.gnrl_exp.length;j2++){exp=this.m_event_dungeon_result.gnrl_exp[j2];if(found=j2,g.gnrl_num==exp.gnrl_num&&g.gnrl_id==exp.gnrl_id){found_is=!0;break}}if(1==found_is)(gnrl=new BattleResultGeneral_V2).setData(g,this.m_event_dungeon_result.gnrl_exp[found],g.position),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl)}is_exist=!0;break}}if(!is_exist){g=new BattleGeneral(0),exp=net.User_General_Exp;g.gnrl_id=0,(gnrl=new BattleResultGeneral_V2).setData(g,exp,pos),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl),gnrl=g=null}}else if(this.m_game_type==db.BattleGameType.OnceADayDungeon)for(gnrl_list=context.getBeforeBattleGeneralList(),i=0;i<5;i++){for(is_exist=!1,pos=i+1,j=0;j<gnrl_list.size();j++){if(pos==(g=gnrl_list.at(j)).position){for(found=0,found_is=!1,j2=0;j2<this.m_once_a_day_result_win.gnrl_exp.length;j2++){exp=this.m_once_a_day_result_win.gnrl_exp[j2];if(found=j2,g.gnrl_num==exp.gnrl_num&&g.gnrl_id==exp.gnrl_id){found_is=!0;break}}if(1==found_is)(gnrl=new BattleResultGeneral_V2).setData(g,this.m_once_a_day_result_win.gnrl_exp[found],g.position),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl);is_exist=!0;break}}if(!is_exist){g=new BattleGeneral(0),exp=net.User_General_Exp;g.gnrl_id=0,(gnrl=new BattleResultGeneral_V2).setData(g,exp,pos),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl),gnrl=g=null}}else if(this.m_game_type==db.BattleGameType.DailyDungeon)for(gnrl_list=context.getBeforeBattleGeneralList(),i=0;i<5;i++){for(is_exist=!1,pos=i+1,j=0;j<gnrl_list.size();j++){if(pos==(g=gnrl_list.at(j)).position){for(found=0,found_is=!1,j2=0;j2<this.m_daily_dungeon_result.gnrl_exp.length;j2++){exp=this.m_daily_dungeon_result.gnrl_exp[j2];if(found=j2,g.gnrl_num==exp.gnrl_num&&g.gnrl_id==exp.gnrl_id){found_is=!0;break}}if(1==found_is)(gnrl=new BattleResultGeneral_V2).setData(g,this.m_daily_dungeon_result.gnrl_exp[found],g.position),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl);is_exist=!0;break}}if(!is_exist){g=new BattleGeneral(0),exp=net.User_General_Exp;g.gnrl_id=0,(gnrl=new BattleResultGeneral_V2).setData(g,exp,pos),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl),gnrl=g=null}}else if(this.m_game_type==db.BattleGameType.Mussang)for(gnrl_list=context.getBeforeBattleGeneralList(),i=0;i<5;i++){for(is_exist=!1,pos=i+1,j=0;j<gnrl_list.size();j++){if(pos==(g=gnrl_list.at(j)).position){(exp=net.User_General_Exp).gnrl_id=g.gnrl_id,exp.gnrl_num=g.gnrl_num,exp.gnrl_level=g.gnrl_level,exp.gnrl_exp=g.exp,(gnrl=new BattleResultGeneral_V2).setData(g,exp,g.position),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl),is_exist=!0;break}}if(!is_exist){g=new BattleGeneral(0),exp=net.User_General_Exp;g.gnrl_id=0,(gnrl=new BattleResultGeneral_V2).setData(g,exp,pos),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl),gnrl=g=null}}else if(this.m_game_type==db.BattleGameType.TowerDungeon)for(gnrl_list=context.getBeforeBattleGeneralList(),i=0;i<5;i++){for(is_exist=!1,pos=i+1,j=0;j<gnrl_list.size();j++){if(pos==(g=gnrl_list.at(j)).position){(exp=net.User_General_Exp).gnrl_id=g.gnrl_id,exp.gnrl_num=g.gnrl_num,exp.gnrl_level=g.gnrl_level,exp.gnrl_exp=g.exp,(gnrl=new BattleResultGeneral_V2).setData(g,exp,g.position),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl),is_exist=!0;break}}if(!is_exist){g=new BattleGeneral(0),exp=net.User_General_Exp;g.gnrl_id=0,(gnrl=new BattleResultGeneral_V2).setData(g,exp,pos),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl),gnrl=g=null}}else if(this.m_game_type==db.BattleGameType.RaidDungeon)for(gnrl_list=context.getBeforeBattleGeneralList(),i=0;i<5;i++){for(is_exist=!1,pos=i+1,j=0;j<gnrl_list.size();j++){if(pos==(g=gnrl_list.at(j)).position){(exp=net.User_General_Exp).gnrl_id=g.gnrl_id,exp.gnrl_num=g.gnrl_num,exp.gnrl_level=g.gnrl_level,exp.gnrl_exp=g.exp,(gnrl=new BattleResultGeneral_V2).setData(g,exp,g.position),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl),is_exist=!0;break}}if(!is_exist){g=new BattleGeneral(0),exp=net.User_General_Exp;g.gnrl_id=0,(gnrl=new BattleResultGeneral_V2).setData(g,exp,pos),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl),gnrl=g=null}}else if(this.m_game_type==db.BattleGameType.GreatWallDungeon){gnrl_list=[];var before_gnrl_list=context.getBeforeBattleGeneralList();GameDefault.getInstance().getUserGreatWallTroopsNum().done(function(data){var troops_num=data;GreatWallService.getInstance().getGreatWallTroopsGenerals(troops_num,gnrl_list);for(var gIndx=0;gIndx<before_gnrl_list.length;gIndx++){for(var g=before_gnrl_list[gIndx],found=0,found_is=!1,gJdx=0;gJdx<gnrl_list.length;gJdx++){if((gnrl=gnrl_list[gJdx]).gnrl_id==g.gnrl_id&&gnrl.gnrl_num==g.gnrl_num){found_is=!0,found=gJdx;break}}0!=found_is?(g.remain_hp_rate=gnrl_list[found].remain_hp_rate,g.is_dead=gnrl_list[found].is_dead,g.remain_skill_count=gnrl_list[found].remain_skill_count,g.use_skill_count=gnrl_list[found].use_skill_count):(g.remain_hp_rate=0,g.is_dead=!0)}for(var i=0;i<5;i++){for(var is_exist=!1,pos=i+1,j=0;j<before_gnrl_list.length;j++){if(pos==(g=before_gnrl_list.at(j)).position){(exp={}).gnrl_id=g.gnrl_id,exp.gnrl_num=g.gnrl_num,exp.gnrl_level=g.gnrl_level,exp.gnrl_exp=g.exp,(gnrl=new BattleResultGeneral_V2).setData(g,exp,g.position),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl),is_exist=!0;break}}if(!is_exist){g=new BattleGeneral(0);var gnrl,exp=net.User_General_Exp;g.gnrl_id=0,(gnrl=new BattleResultGeneral_V2).setData(g,exp,pos),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl),gnrl=g=null}}}.bind(this))}else if(this.m_game_type==db.BattleGameType.EventMussangBossDungeon)for(gnrl_list=context.getBeforeBattleGeneralList(),i=0;i<5;i++){is_exist=!1,pos=i+1;for(var idx=0;idx<gnrl_list.length;idx++){if(pos==(g=$.extend({},gnrl_list[idx])).position){(exp=net.User_General_Exp).gnrl_id=g.gnrl_id,exp.gnrl_num=g.gnrl_num,exp.gnrl_level=g.gnrl_level,exp.gnrl_exp=g.exp,(gnrl=new BattleResultGeneral_V2).setData(g,exp,g.position),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl),is_exist=!0;break}}if(!is_exist){g=new BattleGeneral(0),exp=net.User_General_Exp;g.gnrl_id=0,(gnrl=new BattleResultGeneral_V2).setData(g,exp,pos),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl),gnrl=g=null}}else if(this.m_game_type==db.BattleGameType.EventRaidDungeon)for(gnrl_list=context.getBeforeBattleGeneralList(),i=0;i<5;i++){for(is_exist=!1,pos=i+1,idx=0;idx<gnrl_list.length;idx++){if(pos==(g=$.extend({},gnrl_list[idx])).position){(exp=net.User_General_Exp).gnrl_id=g.gnrl_id,exp.gnrl_num=g.gnrl_num,exp.gnrl_level=g.gnrl_level,exp.gnrl_exp=g.exp,(gnrl=new BattleResultGeneral_V2).setData(g,exp,g.position),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl),is_exist=!0;break}}if(!is_exist){var gnrl;g=new BattleGeneral(0),exp=net.User_General_Exp;g.gnrl_id=0,(gnrl=new BattleResultGeneral_V2).setData(g,exp,pos),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl),gnrl=g=null}}},appearGainBonus:function(){var mt=MasterManager.getInstance(),title=new cc.Sprite("#img_result_text_reward.png");title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(LP(winSize,20,88)),this.m_result_layer.addChild(title);var gain_item_list=new Array,drop_bonus_items=new Array;this.m_game_type==db.BattleGameType.Mission?drop_bonus_items=this.m_is_skip?this.m_story_dungeon_skip_result.drop_bonus_items:this.m_main_mission_result_v2.drop_bonus_items:this.m_game_type==db.BattleGameType.StoryHardMode?drop_bonus_items=this.m_story_hard_mode_result.drop_bonus_items:this.m_game_type==db.BattleGameType.WeeklyDungeon?drop_bonus_items=this.m_is_skip?this.m_weekly_dungeon_skip_result.bonus_items:this.m_weekly_dungeon_result.bonus_items:this.m_game_type==db.BattleGameType.Mussang?drop_bonus_items=this.m_mussang_step_result.bonus_items:this.m_game_type==db.BattleGameType.EventDungeon?drop_bonus_items=this.m_is_skip?this.m_event_dungeon_skip_result.bonus_items:this.m_event_dungeon_result.bonus_items:this.m_game_type==db.BattleGameType.OnceADayDungeon?drop_bonus_items=this.m_once_a_day_result_win.bonus_items:this.m_game_type==db.BattleGameType.DailyDungeon?drop_bonus_items=this.m_daily_dungeon_result.bonus_items:this.m_game_type==db.BattleGameType.RaidDungeon||(this.m_game_type==db.BattleGameType.GreatWallDungeon?drop_bonus_items=this.m_great_wall_dungeon_win.bonus_items:this.m_game_type==db.BattleGameType.TowerDungeon?drop_bonus_items=this.m_mussang_tower_result_win.drop_bonus_items:this.m_game_type==db.BattleGameType.EventMussangBossDungeon?drop_bonus_items=this.m_mussang_boss_win.drop_bonus_items:this.m_game_type==db.BattleGameType.EventRaidDungeon&&(drop_bonus_items=this.m_event_raid_battle_win.bonus_items));for(var i=0;i<drop_bonus_items.length;i++){(item=$.extend({},database.BattleGainItem)).init();var b=drop_bonus_items[i];item.item_type=database.BattleGainItemType.None,item.item_id=0,item.item_level=0,item.item_count="";for(var is_exist_item=!1,jjdx=0;jjdx<gain_item_list.length;jjdx++)if(b.bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX){if(gain_item_list[jjdx].item_id==b.bonus_idx){gain_item_list[jjdx].item_count++,is_exist_item=!0;break}}else if(b.bonus_type==BONUS_TYPE_EQUIPMENT){if(mt.get_EquipmentItem(b.equipment.equipment_item_idx).equipment_type==EQUIPMENT_TYPE_EXP)if(this.m_game_type==db.BattleGameType.GreatWallDungeon){if(null!=gain_item_list[jjdx].equipment)try{if(gain_item_list[jjdx].equipment.equipment_item_idx==b.equipment.equipment_item_idx){gain_item_list[jjdx].item_count++,is_exist_item=!0;break}}catch(e){cc.log("EQUIPMENT_TYPE_EXP_GreatWallDungeon");break}}else if(this.m_game_type==db.BattleGameType.TowerDungeon)try{if(gain_item_list[jjdx].equipment.equipment_item_idx==b.equipment.equipment_item_idx){gain_item_list[jjdx].item_count++,is_exist_item=!0;break}}catch(e){cc.log("EQUIPMENT_TYPE_EXP_TowerDungeon");break}}else if(b.bonus_type==BONUS_TYPE_EVENT_POINT&&0<b.castle_id){if(gain_item_list[jjdx].item_id==b.bonus_type&&0<gain_item_list[jjdx].gnrl_group){gain_item_list[jjdx].item_count+=b.bonus_num,is_exist_item=!0;break}}else if(b.bonus_type==BONUS_TYPE_EVENT_DUNGEON_SPECIAL_POINT&&0<b.castle_id){if(gain_item_list[jjdx].item_id==b.bonus_type&&0<gain_item_list[jjdx].gnrl_group){gain_item_list[jjdx].item_count+=b.bonus_num,is_exist_item=!0;break}}else if(b.bonus_type>=BONUS_TYPE_CHRISTMAS_SANTA&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_SNOWMAN){if(gain_item_list[jjdx].item_id==b.bonus_type){gain_item_list[jjdx].item_count+=b.bonus_num,is_exist_item=!0;break}}else if(b.bonus_type==BONUS_TYPE_GOLD&&0<b.castle_id){if(gain_item_list[jjdx].item_id==b.bonus_type&&gain_item_list[jjdx].gnrl_group==b.castle_id){gain_item_list[jjdx].item_count+=b.bonus_idx,is_exist_item=!0;break}}else if(b.bonus_type==BONUS_TYPE_USER_EXP&&9876543==b.castle_id){if(gain_item_list[jjdx].item_id==b.bonus_type&&gain_item_list[jjdx].gnrl_group==b.castle_id){gain_item_list[jjdx].item_count+=b.bonus_idx,is_exist_item=!0;break}}else if(b.bonus_type==BONUS_TYPE_HEART&&9876543==b.castle_id){if(gain_item_list[jjdx].item_id==b.bonus_type&&gain_item_list[jjdx].gnrl_group==b.castle_id){gain_item_list[jjdx].item_count+=b.bonus_idx,is_exist_item=!0;break}}else if(b.bonus_type>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&b.bonus_type<=BONUS_TYPE_CRAFT_SHOP_SECOND_UNIQUE){if(gain_item_list[jjdx].item_id==b.bonus_type&&0<gain_item_list[jjdx].gnrl_group){gain_item_list[jjdx].item_count+=b.bonus_idx,is_exist_item=!0;break}}else if(b.bonus_type==BONUS_TYPE_GNRL_PIECE){if(gain_item_list[jjdx].item_id==b.bonus_type&&gain_item_list[jjdx].gnrl_group==b.bonus_idx){gain_item_list[jjdx].item_count+=b.bonus_level,is_exist_item=!0;break}}else if(gain_item_list[jjdx].item_id==b.bonus_type){gain_item_list[jjdx].item_count+=b.bonus_idx,is_exist_item=!0;break}is_exist_item||(b.bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX?(item.item_type=database.BattleGainItemType.General,item.item_id=b.bonus_idx,item.item_level=b.bonus_level,item.item_count=1):b.bonus_type==BONUS_TYPE_HEART?(item.item_type=database.BattleGainItemType.Heart,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.gnrl_group=parseInt(b.castle_id)):b.bonus_type==BONUS_TYPE_JADE?(item.item_type=database.BattleGainItemType.Jade,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx)):b.bonus_type==BONUS_TYPE_GOLD?(item.item_type=database.BattleGainItemType.Gold,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.gnrl_group=b.castle_id):b.bonus_type>=BONUS_TYPE_HWANDAN_1&&b.bonus_type<=BONUS_TYPE_HWANDAN_7?(item.item_type=database.BattleGainItemType.Hwandan,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.item_level=b.bonus_level):b.bonus_type==BONUS_TYPE_EVENT_POINT?(item.item_type=database.BattleGainItemType.EventPoint,item.item_id=b.bonus_type,item.item_count=b.bonus_num,this.m_game_type==db.BattleGameType.OnceADayDungeon?item.item_level=this.m_once_a_day_result_win.event_dungeon_period_idx:this.m_is_skip?item.item_level=this.m_event_dungeon_skip_result.event_dungeon_period_idx:item.item_level=this.m_event_dungeon_result.event_dungeon_period_idx,item.gnrl_group=b.castle_id):b.bonus_type==BONUS_TYPE_EVENT_DUNGEON_SPECIAL_POINT?(item.item_type=database.BattleGainItemType.SpecialPoint,item.item_id=b.bonus_type,item.item_count=b.bonus_num,this.m_game_type==db.BattleGameType.OnceADayDungeon?null!=this.m_once_a_day_result_win&&null!=this.m_once_a_day_result_win?item.item_level=this.m_once_a_day_result_win.event_dungeon_period_idx:item.item_level=0:this.m_is_skip?null!=this.m_event_dungeon_skip_result?item.item_level=this.m_event_dungeon_skip_result.event_dungeon_period_idx:item.item_level=0:null!=this.m_event_dungeon_result?item.item_level=this.m_event_dungeon_result.event_dungeon_period_idx:item.item_level=0,item.gnrl_group=b.castle_id):b.bonus_type==BONUS_TYPE_EVOLVE_STONE?(item.item_type=database.BattleGainItemType.EvolveStone,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.gnrl_group=b.castle_id):b.bonus_type>=BONUS_TYPE_ATTK_POINT&&b.bonus_type<=BONUS_TYPE_CRI_DMG_POINT?(item.item_type=database.BattleGainItemType.FormationPropertyPoint,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.item_level=b.bonus_level,item.gnrl_group=b.castle_id):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER?(item.item_type=database.BattleGainItemType.ForceTypeEvolveMtrl,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.item_level=b.bonus_level,item.gnrl_group=b.castle_id):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE?(item.item_type=database.BattleGainItemType.ForceTypeEvolveMtrl,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.item_level=b.bonus_level,item.gnrl_group=b.castle_id):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW?(item.item_type=database.BattleGainItemType.ForceTypeEvolveMtrl,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.item_level=b.bonus_level,item.gnrl_group=b.castle_id):b.bonus_type==BONUS_TYPE_EVOLVE_ORB?(item.item_type=database.BattleGainItemType.EvolveOrb,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.item_level=b.bonus_level,item.gnrl_group=b.castle_id):b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE?(item.item_type=database.BattleGainItemType.LoveItem,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.item_level=b.bonus_level,item.gnrl_group=b.castle_id):b.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE?(item.item_type=database.BattleGainItemType.LoveItem,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.item_level=b.bonus_level,item.gnrl_group=b.castle_id):b.bonus_type==BONUS_TYPE_USER_EXP?(item.item_type=database.BattleGainItemType.UserExp,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.gnrl_group=b.castle_id):b.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||b.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL?(item.item_type=database.BattleGainItemType.LimitOverMtrl,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.gnrl_group=b.castle_id):b.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL?(item.item_type=database.BattleGainItemType.MagicKeyPiece,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.gnrl_group=b.castle_id):b.bonus_type>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&b.bonus_type<=BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND?(item.item_type=database.BattleGainItemType.CraftMtrl,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.gnrl_group=b.castle_id):b.bonus_type==BONUS_TYPE_EQUIPMENT?(item.item_type=database.BattleGainItemType.Equipment,item.item_id=b.bonus_idx,item.item_count=1,item.equipment=b.equipment):b.bonus_type==BONUS_TYPE_NAMING?(item.item_type=database.BattleGainItemType.HeroNaming,item.item_id=b.bonus_type,item.item_level=b.bonus_idx,item.item_count=1):b.bonus_type==BONUS_TYPE_JADE_RANDOM_BOX||b.bonus_type==BONUS_TYPE_GOLD_RANDOM_BOX||b.bonus_type==BONUS_TYPE_LOVE_ITEM_RANDOM_BOX||b.bonus_type==BONUS_TYPE_RARE_HWANDAN_RANDOM_BOX||b.bonus_type==BONUS_TYPE_EXP_CARD_RANDOM_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_GIFT_BOX||b.bonus_type==BONUS_TYPE_SWORD_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_SPEAR_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_ARCHER_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_RANDOM_BOX||b.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_GIFT_BOX||b.bonus_type==BONUS_TYPE_EVENTDUNGEON_PRESENT_GIFT_BOX||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_1||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_2||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_3||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_4?(item.item_type=database.BattleGainItemType.RandomBox,item.item_id=b.bonus_type,item.item_count=b.bonus_idx):b.bonus_type==BONUS_TYPE_SR_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_R_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_HR_RARE_TYPE_ENGAGE?(item.item_type=database.BattleGainItemType.GachaTicket,item.item_id=b.bonus_type,item.item_count=b.bonus_idx):b.bonus_type>=BONUS_TYPE_CHRISTMAS_RIBBON&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_APPLE?(item.item_type=database.BattleGainItemType.ETC,item.item_id=b.bonus_type,item.item_count=b.bonus_idx,item.gnrl_group=b.castle_id):b.bonus_type>=BONUS_TYPE_CHRISTMAS_SANTA&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_SNOWMAN?(item.item_type=database.BattleGainItemType.ETC,item.item_id=b.bonus_type,item.item_count=b.bonus_num,item.gnrl_group=b.castle_id):b.bonus_type>=BONUS_TYPE_REBIRTH_MTRL_TYPE_1&&b.bonus_type<=BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type>=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1&&b.bonus_type<=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6?(item.item_type=database.BattleGainItemType.RebirthMtrl,item.item_id=b.bonus_type,item.item_count=b.bonus_idx,item.gnrl_group=b.castle_id):b.bonus_type==BONUS_TYPE_GREAT_WALL_TICKET?(item.item_type=database.BattleGainItemType.GreatWallTicket,item.item_id=b.bonus_type,item.item_count=b.bonus_idx):b.bonus_type==BONUS_TYPE_JADE_PIECE?(item.item_type=database.BattleGainItemType.JadePiece,item.item_id=b.bonus_type,item.item_count=b.bonus_idx):b.bonus_type==BONUS_TYPE_RAID_TICKET?(item.item_type=database.BattleGainItemType.RaidTicket,item.item_id=b.bonus_type,item.item_count=b.bonus_idx):b.bonus_type==BONUS_TYPE_RAID_HELP_TICKET?(item.item_type=database.BattleGainItemType.RaidHelpTicket,item.item_id=b.bonus_type,item.item_count=b.bonus_idx):b.bonus_type==BONUS_TYPE_SKIP_TICKET?(item.item_type=database.BattleGainItemType.SkipTicket,item.item_id=b.bonus_type,item.item_count=b.bonus_idx):b.bonus_type==BONUS_TYPE_WORLD_WAR_UNIQUE_EQUIPMENT_TICKET?(item.item_type=database.BattleGainItemType.ETC,item.item_id=b.bonus_type,item.item_count=b.bonus_idx):b.bonus_type==BONUS_TYPE_FORMATION_POINT?(item.item_type=database.BattleGainItemType.ETC,item.item_id=b.bonus_type,item.item_count=b.bonus_idx):b.bonus_type>=BONUS_TYPE_ATTK_POINT&&b.bonus_type<=BONUS_TYPE_CRI_DMG_POINT?(item.item_type=database.BattleGainItemType.FormationPropertyPoint,item.item_id=b.bonus_type,item.item_count=b.bonus_idx):b.bonus_type==BONUS_TYPE_SSR_GACHA_TICKET?(item.item_type=database.BattleGainItemType.GachaTicket,item.item_id=b.bonus_type,item.item_count=b.bonus_idx):b.bonus_type==BONUS_TYPE_GNRL_PIECE?(item.item_type=database.BattleGainItemType.GnrlPiece,item.item_id=b.bonus_type,item.gnrl_group=b.bonus_idx,item.item_count=b.bonus_level):(item.item_type=database.BattleGainItemType.ETC,item.item_id=b.bonus_type,item.item_count=b.bonus_idx),gain_item_list.push_back(item))}var viewSize=cc.size(420,468);this.m_game_type!=db.BattleGameType.EventDungeon&&this.m_game_type!=db.BattleGameType.WeeklyDungeon||(viewSize=cc.size(720,468));var container_width=72*gain_item_list.size();container_width<viewSize.width&&(container_width=viewSize.width),this.m_scroll_container=new cc.Layer,this.m_scroll_container.ignoreAnchorPointForPosition(!1),this.m_scroll_container.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_scroll_container.setContentSize(container_width,468),this.m_scroll_container.setPosition(ZERO()),this.m_scroll_arrow_left=new cc.Sprite(RES_CDN_DEFULT+"common/img_scroll_arrow.png"),this.m_scroll_arrow_left.setFlippedX(!0),this.m_scroll_arrow_left.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_scroll_arrow_left.setPosition(LP(this,20,1+.5*viewSize.height-178)),this.m_result_layer.addChild(this.m_scroll_arrow_left),this.m_scroll_arrow_right=new cc.Sprite(RES_CDN_DEFULT+"common/img_scroll_arrow.png"),this.m_scroll_arrow_right.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_scroll_arrow_right.setPosition(LP(this,20+viewSize.width,1+.5*viewSize.height-178)),this.m_result_layer.addChild(this.m_scroll_arrow_right),this.m_scroll_container.scrollViewDidScroll=function(view){if(view==this.m_scroll_view){var viewSize=view.getViewSize(),container_width=view.getContainer().getContentSize().width;if(viewSize.width>=container_width)null!=this.m_scroll_arrow_left&&null!=this.m_scroll_arrow_left&&this.m_scroll_arrow_left.setVisible(!1),this.m_scroll_arrow_right.setVisible(!1);else{var offset=view.getContentOffset(),diff=viewSize.width-container_width;0<=offset.x?(null!=this.m_scroll_arrow_left&&null!=this.m_scroll_arrow_left&&this.m_scroll_arrow_left.setVisible(!1),null!=this.m_scroll_arrow_right&&null!=this.m_scroll_arrow_right&&this.m_scroll_arrow_right.setVisible(!0)):offset.x<=diff?(null!=this.m_scroll_arrow_left&&null!=this.m_scroll_arrow_left&&this.m_scroll_arrow_left.setVisible(!0),null!=this.m_scroll_arrow_right&&null!=this.m_scroll_arrow_right&&this.m_scroll_arrow_right.setVisible(!1)):(null!=this.m_scroll_arrow_left&&null!=this.m_scroll_arrow_left&&this.m_scroll_arrow_left.setVisible(!0),null!=this.m_scroll_arrow_right&&null!=this.m_scroll_arrow_right&&this.m_scroll_arrow_right.setVisible(!0))}}}.bind(this),this.m_scroll_container.scrollViewDidZoom=function(){},this.m_scroll_view=new cc.ScrollView(viewSize,this.m_scroll_container),this.m_scroll_view.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_scroll_view.setDirection(cc.SCROLLVIEW_DIRECTION_HORIZONTAL),this.m_scroll_view.setDelegate(this.m_scroll_container),this.m_scroll_view.setPosition(LP(this,20,-30)),this.m_result_layer.addChild(this.m_scroll_view),this.m_scroll_view.setContentOffset(cc.p(0,0),!1);for(var offset_x=2,j=0;j<gain_item_list.size();j++){var item,d=gain_item_list.at(j);(item=new BattleMissionResultGetItem_V2(d,this.addTooltip.bind(this),this.removeTooltip.bind(this))).setPosition(offset_x,50),this.m_scroll_container.addChild(item),this.m_gain_items.push_back(item),offset_x+=72}switch(this.m_game_type){case db.BattleGameType.Mission:case db.BattleGameType.WeeklyDungeon:case db.BattleGameType.TowerDungeon:case db.BattleGameType.EventDungeon:case db.BattleGameType.StoryHardMode:this.gainItemAppear(this.m_game_type,!0);break;case db.BattleGameType.Mussang:case db.BattleGameType.OnceADayDungeon:case db.BattleGameType.DailyDungeon:case db.BattleGameType.GreatWallDungeon:case db.BattleGameType.EventMussangBossDungeon:case db.BattleGameType.EventRaidDungeon:this.gainItemAppear(this.m_game_type,!1);break;case db.BattleGameType.RaidDungeon:}},appearTasks:function(){if(!this.m_is_skip){var service=BattleService.getInstance(),context=(MasterTable.getInstance(),BattleContext._getInstance());if(this.m_game_type==db.BattleGameType.Mission){var mission=database.BattleMainMission,mission_id=this.m_main_mission_result_v2.mission_id;service.getMainMissionAndNpc(mission_id,mission),mission.victory_count=service.getMissionWinCount(mission_id);for(var task_list=new Array,i=0;i<mission.task_list.length;i++){for(var t=mission.task_list[i],found_is=!1,j2=0;j2<this.m_main_mission_result_v2.cmplt_task_ids.length;j2++){var task_id=this.m_main_mission_result_v2.cmplt_task_ids[j2];if(j2,t.task_id==task_id){found_is=!0;break}}1==found_is&&task_list.push_back(t)}if(!task_list.empty())(task=new BattleMissionTaskNode_V2).setPosition(winSize.width,100),this.m_result_layer.addChild(task,999),task.setTaskData(task_list,db.BattleGameType.Mission)}else if(this.m_game_type==db.BattleGameType.StoryHardMode){mission=$.extend({},database.BattleStoryHardModeMission);service.getStoryHardModeMissionAndNpc(this.m_story_hard_mode_result.main_story_hard_mode_mission_idx,mission);for(this.m_story_hard_mode_result.win_count,task_list=new Array,i=0;i<mission.task_list.length;i++){for(t=mission.task_list[i],found_is=!1,j2=0;j2<this.m_story_hard_mode_result.cmplt_task_ids.length;j2++){task_id=this.m_story_hard_mode_result.cmplt_task_ids[j2];if(j2,t.task_id==task_id){found_is=!0;break}}1==found_is&&task_list.push_back(t)}if(!task_list.empty())(task=new BattleMissionTaskNode_V2).setPosition(winSize.width,100),this.m_result_layer.addChild(task,999),task.setTaskData(task_list,db.BattleGameType.StoryHardMode)}else if(this.m_game_type==db.BattleGameType.WeeklyDungeon){task_list=new Array;var dungeon=context.getWeeklyDungeonDifficulty();for(i=0;i<dungeon.task_list.length;i++)if(!dungeon.task_list[i].is_complete){for(found_is=!1,j2=0;j2<this.m_weekly_dungeon_result.task_list.length;j2++)if(j2,this.m_weekly_dungeon_result.task_list[j2].weekly_idx==dungeon.task_list[i].dungeon_idx&&this.m_weekly_dungeon_result.task_list[j2].num==dungeon.task_list[i].num){found_is=!0;break}1==found_is&&"y"==this.m_weekly_dungeon_result.task_list[j2].complete_yn&&(dungeon.task_list[i].is_complete=!0,task_list.push_back(dungeon.task_list[i]))}if(!task_list.empty())(task=new BattleMissionTaskNode_V2).setPosition(winSize.width,100),this.m_result_layer.addChild(task,999),task.setTaskData(task_list,db.BattleGameType.WeeklyDungeon)}else if(this.m_game_type==db.BattleGameType.EventDungeon){for(task_list=new Array,dungeon=context.getEventDungeonData(),i=0;i<dungeon.task_list.length;i++)if(!dungeon.task_list[i].is_complete){for(found_is=!1,j2=0;j2<this.m_event_dungeon_result.task_list.length;j2++)if(j2,this.m_event_dungeon_result.task_list[j2].event_dungeon_id==dungeon.task_list[i].event_dungeon_idx&&this.m_event_dungeon_result.task_list[j2].num==dungeon.task_list[i].num){found_is=!0;break}1==found_is&&"y"==this.m_event_dungeon_result.task_list[j2].complete_yn&&(dungeon.task_list[i].is_complete=!0,task_list.push_back(dungeon.task_list[i]))}if(!task_list.empty())(task=new BattleMissionTaskNode_V2).setPosition(winSize.width,100),this.m_result_layer.addChild(task,999),task.setTaskData(task_list,db.BattleGameType.EventDungeon)}else if(this.m_game_type==db.BattleGameType.TowerDungeon){var task;for(dungeon=BattleContext._getInstance().getMussangTowerDungeonData(),task_list=new Array,i=0;i<dungeon.task_list.length;i++){for(t=dungeon.task_list[i],found_is=!1,j2=0;j2<this.m_mussang_tower_result_win.cmplt_task_ids.length;j2++){task_id=this.m_mussang_tower_result_win.cmplt_task_ids[j2];if(j2,t.task.task_id==task_id){found_is=!0;break}}1==found_is&&(t.is_cleared=!0,task_list.push_back(t))}if(!task_list.empty())(task=new BattleMissionTaskNode_V2).setPosition(winSize.width,100),this.m_result_layer.addChild(task,999),task.setTaskData(task_list,db.BattleGameType.TowerDungeon)}}},addTooltip:function(world_pos,tooltip,title,content){if(null!=this.m_tooltip_box)return!1;this.m_tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.m_tooltip_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_tooltip_box.setPosition(world_pos),this.m_tooltip_box.setVisible(!0),this.addChild(this.m_tooltip_box);var tooltip_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1810);tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_tooltip_box.addChild(tooltip_title);var tooltip_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181);if(tooltip_content.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_tooltip_box.addChild(tooltip_content),tooltip_title.setString(title),tooltip_content.setString(content),""!=content){var tSize=ccSize(tooltip_title),cSize=ccSize(tooltip_content);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(tSize.width+20,cSize.width+20),bSize.height=Math.max(64,bSize.height+cSize.height+5),this.m_tooltip_box.setContentSize(tooltip._contentSize),this.m_tooltip_box.setPreferredSize(bSize),tooltip_title.setPosition(10,bSize.height-10),tooltip_content.setPosition(10,bSize.height-15-tSize.height);var offset=world_pos.x-bSize.width/2;if(offset<0){var new_pos=cc.p(world_pos.x+Math.abs(offset),world_pos.y);this.m_tooltip_box.setPosition(new_pos),tooltip_title.setPosition(10,bSize.height-10),tooltip_content.setPosition(10,bSize.height-15-tSize.height)}}else{tooltip_title.setAnchorPoint(ANCHOR_MIDDLE());var bSize;tSize=ccSize(tooltip_title);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(64,tSize.width+20),bSize.height=Math.max(54,bSize.height+10),this.m_tooltip_box.setPreferredSize(bSize),tooltip_title.setPosition(ccCenter(bSize))}},removeTooltip:function(){this.removeChild(this.m_tooltip_box),this.m_tooltip_box=null},createBtnOnceADayDungeon:function(container){var btn,offset_x=0;BattleContext._getInstance().IsBattleDungeonContinue()?((btn=this.createButton(res_str("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearEventOnceADayDungeon(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn)):(this.m_is_win?((btn=this.createButton(res_str("label_confirm"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearEventOnceADayDungeon(),context.setEventDungeonPeriodIdX(this.m_once_a_day_result_win.event_dungeon_period_idx),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.event_dungeon_game_result_ok),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0)):((btn=this.createButton(res_str("label_confirm"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearEventOnceADayDungeon(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_event_once_a_day_dungeon_to_map),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x+333,0)),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn))},createBtnsStoryHardMode:function(container){var mt=MasterManager.getInstance(),offset_x=0;if(BattleContext._getInstance().IsBattleDungeonContinue()){if(this.m_is_win)(btn=this.createButton(res_str("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),btn.setTutorialTag(TUTORIAL_TAG_PAGE_1_RESULT_MAIN),this.m_btn_list.push_back(btn);else container.setPosition(.5*winSize.width+111,-100),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_continue"))).addClickEventListener(function(sender){this.checkStoryHardModeContinue()}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn)}else{var btn;if(this.m_is_win)(btn=this.createButton(mt.get_LanguageData("btn_battle_result_next_mission"))).addClickEventListener(function(sender){if(TutorialContextV2.getInstance().IsCompleteAllTutorial()){var context=BattleContext._getInstance();context.clearFriendInfo();var next_main_story_hard_mode_mission_idx,main_story_hard_mode_mission_idx=this.m_story_hard_mode_result.main_story_hard_mode_mission_idx;0<(next_main_story_hard_mode_mission_idx=MissionService.getInstance().getNextStoryHardModeMissionId(main_story_hard_mode_mission_idx))?(context.showNextMissionPopup(!0),context.setStoryHardModeMissionId(next_main_story_hard_mode_mission_idx),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_story_hard_mode_next_mission)):this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_story_hard_mode_story_map),this.setEnableBtns(!1)}}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn);else(btn=this.createButton(mt.get_LanguageData("btn_battle_result_continue"))).addClickEventListener(function(sender){this.checkStoryHardModeContinue()}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn);(btn=this.createButton(mt.get_LanguageData("btn_combat_result_retry"))).addClickEventListener(function(sender){if(TutorialContextV2.getInstance().IsCompleteAllTutorial()){var context=BattleContext._getInstance(),frnd_user_id=context.getFriendID();context.removeFriend(frnd_user_id),context.clearForRetry(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_story_hard_mode_retry),this.setEnableBtns(!1)}}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_mission"))).addClickEventListener(function(sender){TutorialContextV2.getInstance().IsCompleteAllTutorial()&&(BattleContext._getInstance().clearFriendInfo(),PUSH_SCENE_MAP=!0,this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_story_hard_mode_story_map),this.setEnableBtns(!1))}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.setStoryHardModeMissionId(0),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn)}},createBtnsMission:function(container){var mt=MasterManager.getInstance(),offset_x=0;if(this.m_is_skip)(btn=this.createButton(mt.get_LanguageData("btn_battle_result_next_mission"))).addClickEventListener(function(sender){if(TutorialContextV2.getInstance().IsCompleteAllTutorial()){var context=BattleContext._getInstance();context.clearFriendInfo();var next_mission_id,mission_id=this.m_story_dungeon_skip_result.mission_id;0<(next_mission_id=MissionService.getInstance().getNextMissionId(mission_id))?(context.showNextMissionPopup(!0),context.setMissionID(next_mission_id),MainObserver.getInstance().postNotification(FriendSelectSkipEnum.battle_skip_next_mission)):MainObserver.getInstance().postNotification(FriendSelectSkipEnum.battle_skip_story_map)}}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_combat_result_retry"))).addClickEventListener(function(sender){BattleContext._getInstance().clearForRetry(),MainObserver.getInstance().postNotification(FriendSelectSkipEnum.battle_skip_retry)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_mission"))).addClickEventListener(function(sender){if(TutorialContextV2.getInstance().IsCompleteAllTutorial()){BattleContext._getInstance();MainObserver.getInstance().postNotification(FriendSelectSkipEnum.battle_skip_story_map)}}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),MainObserver.getInstance().postNotification(NOTIFY_MENU_HOME),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn);else if(BattleContext._getInstance().IsBattleDungeonContinue()){if(this.m_is_win)(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,btn.setTutorialTag(TUTORIAL_TAG_PAGE_1_RESULT_MAIN),this.m_btn_list.push_back(btn);else container.setPosition(.5*winSize.width+111,-100),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_continue"))).addClickEventListener(function(sender){this.checkMissionContinue()}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,btn.setTutorialTag(TUTORIAL_TAG_PAGE_1_RESULT_MAIN),this.m_btn_list.push_back(btn)}else{var btn;if(this.m_is_win)(btn=this.createButton(mt.get_LanguageData("btn_battle_result_next_mission"))).addClickEventListener(function(sender){if(TutorialContextV2.getInstance().IsCompleteAllTutorial()){var context=BattleContext._getInstance();context.clearFriendInfo();var next_mission_id,mission_id=this.m_main_mission_result_v2.mission_id;0<(next_mission_id=MissionService.getInstance().getNextMissionId(mission_id))?(context.showNextMissionPopup(!0),context.setMissionID(next_mission_id),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_next_mission)):this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_story_map),this.setEnableBtns(!1)}}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn);else(btn=this.createButton(mt.get_LanguageData("btn_battle_result_continue"))).addClickEventListener(function(sender){this.checkMissionContinue()}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn);(btn=this.createButton(mt.get_LanguageData("btn_combat_result_retry"))).addClickEventListener(function(sender){if(TutorialContextV2.getInstance().IsCompleteAllTutorial()){var context=BattleContext._getInstance(),frnd_user_id=context.getFriendID();context.removeFriend(frnd_user_id),context.clearForRetry(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_retry),this.setEnableBtns(!1)}}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_mission"))).addClickEventListener(function(sender){TutorialContextV2.getInstance().IsCompleteAllTutorial()&&(BattleContext._getInstance().clearFriendInfo(),PUSH_SCENE_MAP=!0,this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_story_map),this.setEnableBtns(!1))}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){BattleContext._getInstance().clear(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,btn.setTutorialTag(TUTORIAL_TAG_PAGE_1_RESULT_MAIN),this.m_btn_list.push_back(btn)}},createBtnGreatWallDungeon:function(container){var btn,offset_x=0,winSize=ccSize(this);MasterTable.getInstance();BattleContext._getInstance().IsBattleDungeonContinue()?(this.m_is_win?(btn=this.createButton(res_str("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearGreatWallDungeon(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)):(container.setPosition(.5*winSize.width,-100),(btn=this.createButton(res_str("btn_battle_result_home"))).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn.addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearGreatWallDungeon(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this))),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn)):(this.m_is_win?(btn=this.createButton(res_str("label_confirm"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearGreatWallDungeon(),context.clearMussangStep(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_great_wall_dungeon_to_map),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)):(container.setPosition(.5*winSize.width+111,-100),(btn=this.createButton(res_str("btn_battle_result_mission"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearGreatWallDungeon(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_great_wall_dungeon_to_map),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn),(btn=this.createButton(res_str("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearGreatWallDungeon(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this))),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn))},createBtnMussangTower:function(container){var btn,mt=MasterManager.getInstance(),offset_x=0;BattleContext._getInstance().IsBattleDungeonContinue()?(this.m_is_win?(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearMussangTowerDungeon(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)):(container.setPosition(.5*winSize.width,-100),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn.addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearMussangTowerDungeon(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this))),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn)):(this.m_is_win?(btn=this.createButton(mt.get_LanguageData("label_confirm"))).addClickEventListener(function(sender){BattleContext._getInstance().clearMussangTowerDungeon(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.mussang_tower_game_over_result_ok),this.setEnableBtns(!1)}.bind(this)):((btn=this.createButton(mt.get_LanguageData("btn_battle_result_mission"))).addClickEventListener(function(sender){BattleContext._getInstance().clearMussangTowerDungeon(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.mussang_tower_game_over_tomap),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearMussangTowerDungeon(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1)}.bind(this))),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn))},createBtnsMussang:function(container){var btn,mt=MasterManager.getInstance(),offset_x=0;BattleContext._getInstance().IsBattleDungeonContinue()?(this.m_is_win?(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearMussangStep(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)):(container.setPosition(.5*winSize.width,-100),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn.addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearMussangStep(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this))),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn)):(this.m_is_win?(btn=this.createButton(mt.get_LanguageData("label_confirm"))).addClickEventListener(function(sender){BattleContext._getInstance().clearMussangStep(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.mussang_step_result_ok),this.setEnableBtns(!1)}.bind(this)):((btn=this.createButton(mt.get_LanguageData("btn_combat_result_retry"))).addClickEventListener(function(sender){BattleContext._getInstance().clearForRetry(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_mussang_retry),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_mission"))).addClickEventListener(function(sender){BattleContext._getInstance().clearMussangStep(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_mussang_to_map),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearMussangStep(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1)}.bind(this))),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn))},createBtnsWeekly:function(container){var btn,offset_x=0,mt=MasterManager.getInstance();this.m_is_skip?((btn=this.createButton(mt.get_LanguageData("btn_combat_result_retry"))).addClickEventListener(function(sender){BattleContext._getInstance().clearForRetry(),MainObserver.getInstance().postNotification(FriendSelectSkipEnum.battle_skip_retry)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("label_confirm"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clearWeeklyDungeon(),context.clearForRetry();SceneManager.getInstance().getRunningScene();MainObserver.getInstance().postNotification(FriendSelectSkipEnum.battle_skip_confirm)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn)):(BattleContext._getInstance().IsBattleDungeonContinue()?(this.m_is_win||(container.setPosition(.5*winSize.width+111,-100),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_continue"))).addClickEventListener(function(sender){this.checkWeeklyContinue()}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn)),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearWeeklyDungeon(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this))):this.m_is_win?((btn=this.createButton(mt.get_LanguageData("btn_combat_result_retry"))).addClickEventListener(function(sender){BattleContext._getInstance().clearForRetry(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_weekly_retry),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("label_confirm"))).addClickEventListener(function(sender){BattleContext._getInstance().clearWeeklyDungeon(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.weekly_result_ok),this.setEnableBtns(!1)}.bind(this))):((btn=this.createButton(mt.get_LanguageData("btn_battle_result_continue"))).addClickEventListener(function(sender){this.checkWeeklyContinue()}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_combat_result_retry"))).addClickEventListener(function(sender){BattleContext._getInstance().clearForRetry(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_weekly_retry),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_mission"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearWeeklyDungeon(),PUSH_SCENE_MAP=!0,this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_weekly_to_map),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearWeeklyDungeon(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1)}.bind(this))),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn))},createBtnDailyDungeon:function(container){var btn,offset_x=0,is_battle_dungeon_continue=BattleContext._getInstance().IsBattleDungeonContinue(),mt=MasterManager.getInstance();is_battle_dungeon_continue?((btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearDailyDungeon(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn)):((btn=this.createButton(mt.get_LanguageData("label_confirm"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearDailyDungeon(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_daily_dungeon_to_map),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn))},createBtnRaidBoss:function(container){var offset_x=0,is_battle_dungeon_continue=BattleContext._getInstance().IsBattleDungeonContinue(),mt=MasterManager.getInstance(),context=BattleContext._getInstance();if(is_battle_dungeon_continue)if(this.m_is_win){(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){context.clear(),context.clearRaidBoss(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push(btn)}else{var btn,winSize=ccSize(this);container.setPosition(.5*winSize.width,-100),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn.addClickEventListener(function(sender){context.clear(),context.clearRaidBoss(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push(btn)}else this.m_is_win?(btn=this.createButton(mt.get_LanguageData("label_raid_boss_btn_boss_list"))).addClickEventListener(function(sender){context.clearRaidBoss(),context.clearEventDungeon(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_raid_boss_boss_list),this.setEnableBtns(!1)}.bind(this)):(offset_x=277.5,(btn=this.createButton(mt.get_LanguageData("btn_combat_result_retry"))).addClickEventListener(function(sender){context.setRaidBossData(this.m_raid_boss_result.raid_boss_info),context.clearForRetry(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_raid_boss_retry),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push(btn),(btn=this.createButton(mt.get_LanguageData("label_raid_boss_btn_boss_list"))).addClickEventListener(function(sender){context.clearRaidBoss(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_raid_boss_boss_list),this.setEnableBtns(!1)}.bind(this))),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push(btn),(btn=this.createButton(mt.get_LanguageData("label_raid_boss_btn_raid_main"))).addClickEventListener(function(sender){context.clearRaidBoss(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_raid_boss_raid_main),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push(btn),(btn=this.createButton(mt.get_LanguageData("label_raid_boss_btn_event"))).addClickEventListener(function(sender){context.clearRaidBoss(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_EVENT_DUNGEON_ENTRANCE),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push(btn),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){context.clear(),context.clearRaidBoss(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push(btn)},createBtnEventdungeon:function(container){var mt=MasterManager.getInstance(),offset_x=0;if(this.m_is_skip){(btn=this.createButton(mt.get_LanguageData("btn_combat_result_retry"))).addClickEventListener(function(sender){BattleContext._getInstance().clearForRetry(),MainObserver.getInstance().postNotification(FriendSelectSkipEnum.battle_skip_retry)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("label_confirm"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clearForRetry(),context.clearEventDungeon(),MainObserver.getInstance().postNotification(FriendSelectSkipEnum.battle_skip_confirm)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn)}else{var ed=mt.get_EventDungeon(this.m_event_dungeon_result.event_dungeon_idx);if(BattleContext._getInstance().IsBattleDungeonContinue())if(this.m_is_win){(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearEventDungeon(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn)}else{if("y"==ed.continue_yn)container.setPosition(.5*winSize.width+111,-100),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_continue"))).addClickEventListener(function(sender){this.checkEventDungeonContinue()}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn);else container.setPosition(.5*winSize.width+55.5,-100);(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearEventDungeon(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn)}else if(this.m_is_win){(btn=this.createButton(mt.get_LanguageData("btn_combat_result_retry"))).addClickEventListener(function(sender){var context=BattleContext._getInstance(),frnd_user_id=context.getFriendID();context.removeFriend(frnd_user_id),context.clearForRetry(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_event_dungeon_retry),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("label_confirm"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clearEventDungeon(),context.clearFriendInfo(),context.setEventDungeonPeriodIdX(this.m_event_dungeon_result.event_dungeon_period_idx),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.event_dungeon_game_result_ok),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn)}else{var btn;if("y"==ed.continue_yn)container.setPosition(.5*winSize.width+222,-100),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_continue"))).addClickEventListener(function(sender){this.checkEventDungeonContinue()}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn);else container.setPosition(.5*winSize.width+166.5,-100);(btn=this.createButton(mt.get_LanguageData("btn_combat_result_retry"))).addClickEventListener(function(sender){var context=BattleContext._getInstance(),frnd_user_id=context.getFriendID();context.removeFriend(frnd_user_id),context.clearForRetry(),context.clearFriendInfo(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_event_dungeon_retry),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_mission"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearEventDungeon(),PUSH_SCENE_MAP=!0,this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_event_dungeon_to_map),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearEventDungeon(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn)}}},createBtnMussangBoss:function(container){var winSize=ccSize(this),mt=MasterManager.getInstance(),offset_x=0,is_battle_dungeon_continue=BattleContext._getInstance().IsBattleDungeonContinue();if(container.setPosition(winSize.width-10,-100),1==is_battle_dungeon_continue)this.m_is_win,(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn);else if(this.m_is_win){for(var Is_enable_btn=!1,dungeon_info=(new NetService).get_User_Mussang_Boss_info(),idx=0;idx<dungeon_info.user_mussang_boss_infos.length;idx++){var dungeon=dungeon_info.user_mussang_boss_infos[idx],mt_dungeon_info=(mt=MasterManager.getInstance()).get_EventDungeonMussangBossInfo(dungeon.boss_dungeon_idx,dungeon.event_dungeon_period_idx),period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),dungeon_list=MasterTable.getInstance().get_EventDungeonMussangDungeonList(period_idx),mussang_boss_max_level=0;if(dungeon_list.forEach(function(dungeon){dungeon.boss_level>mussang_boss_max_level&&(mussang_boss_max_level=dungeon.boss_level)}),mt_dungeon_info.boss_level==mussang_boss_max_level&&mt_dungeon_info.event_dungeon_period_idx==period_idx){Is_enable_btn=!0;break}}if(!Is_enable_btn)(btn=this.createButton(mt.get_LanguageData("label_event_dungeon_mussang_boss_move_mussang_boss_lobby"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_event_dungeon_retry),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),btn.setEnabled(!Is_enable_btn),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn);(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x+=btn.getContentSize().width,this.m_btn_list.push_back(btn)}else{var btn;(btn=this.createButton(mt.get_LanguageData("label_event_dungeon_mussang_boss_move_mussang_boss_lobby"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_event_dungeon_retry),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("label_event_dungeon_mussang_boss_entrance_event_dungeon_scene"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_event_dungeon_to_map),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=btn.getContentSize().width,this.m_btn_list.push_back(btn)}},createBtnEventRaid:function(container){var btn,winSize=ccSize(this),offset_x=0,is_battle_dungeon_continue=BattleContext._getInstance().IsBattleDungeonContinue();(container.setPosition(winSize.width-10,-100),1==is_battle_dungeon_continue)?(this.m_is_win,(btn=this.createButton(res_str("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.setBattleDungeonContinue(!1),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn)):(this.m_is_win,(btn=this.createButton(res_str("label_event_dungeon_mussang_boss_move_mussang_boss_lobby"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_event_dungeon_retry),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn),(btn=this.createButton(res_str("label_event_dungeon_mussang_boss_entrance_event_dungeon_scene"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_event_dungeon_to_map),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn),(btn=this.createButton(res_str("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn))},createButton:function(btn_label){var btn=new ccui.Button;btn.loadTextures("btn_01_off.png","btn_01_on.png","",ccui.Widget.PLIST_TEXTURE),btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT());var label=cmLabel.getLabel(btn_label,LABEL_FONT_INDEX.FONT_241);return label.setAnchorPoint(ANCHOR_MIDDLE()),label.setPosition(btn.getContentSize().width/2,btn.getContentSize().height/2),btn.addChild(label),btn},appearButtons:function(){var container=new cc.Node;if(this.m_is_win?(container.setPosition(winSize.width-10,-100),this.m_result_layer.addChild(container,999)):(this.m_game_type==db.BattleGameType.RaidDungeon?container.setPosition(.5*winSize.width,-100):this.m_game_type==db.BattleGameType.TowerDungeon?container.setPosition(.5*winSize.width+111,-100):this.m_game_type==db.BattleGameType.EventRaidDungeon?container.setPosition(.5*winSize.width+222,-60):container.setPosition(.5*winSize.width+222,-100),this.m_win_lose_layer.addChild(container,9999)),this.m_game_type==db.BattleGameType.Mission?this.createBtnsMission(container):this.m_game_type==db.BattleGameType.StoryHardMode?this.createBtnsStoryHardMode(container):this.m_game_type==db.BattleGameType.WeeklyDungeon?this.createBtnsWeekly(container):this.m_game_type==db.BattleGameType.Mussang?this.createBtnsMussang(container):this.m_game_type==db.BattleGameType.EventDungeon?this.createBtnEventdungeon(container):this.m_game_type==db.BattleGameType.OnceADayDungeon?this.createBtnOnceADayDungeon(container):this.m_game_type==db.BattleGameType.DailyDungeon?this.createBtnDailyDungeon(container):this.m_game_type==db.BattleGameType.RaidDungeon?this.createBtnRaidBoss(container):this.m_game_type==db.BattleGameType.GreatWallDungeon?this.createBtnGreatWallDungeon(container):this.m_game_type==db.BattleGameType.TowerDungeon?this.createBtnMussangTower(container):this.m_game_type==db.BattleGameType.EventMussangBossDungeon?this.createBtnMussangBoss(container):this.m_game_type==db.BattleGameType.EventRaidDungeon&&this.createBtnEventRaid(container),this.m_is_win){var delay=cc.delayTime(2.5),move=cc.moveBy(.5,cc.p(0,110)),cb=cc.callFunc(this.cbAppearButtons,this),seq=cc.sequence(delay,move,cb);container.runAction(seq)}else{delay=cc.delayTime(1),move=null;move=this.m_game_type==db.BattleGameType.EventRaidDungeon?cc.moveBy(.5,cc.p(0,200)):cc.moveBy(.5,cc.p(0,110));cb=cc.callFunc(this.cbAppearButtons,this),seq=cc.sequence(delay,move,cb);container.runAction(seq)}this.enable_touch_partner=!0},cbAppearButtons:function(){if(this.m_is_win){var tutorial=TutorialContextV2.getInstance();if(!tutorial.IsCompleteAllTutorial())tutorial.getCurrentTutorialStep().action_type==TutorialAction.Ready&&MainObserver.getInstance().postNotification(NOTIFICATION_TUTORIAL,message_complete_tutorial)}},playFireworks:function(d){this.m_firework_position=new Array;var firework_position_list=cc.p((winSize.width-960)/2+930,500);this.m_firework_position.push_back(firework_position_list),firework_position_list=cc.p((winSize.width-960)/2+110,210),this.m_firework_position.push_back(firework_position_list),firework_position_list=cc.p((winSize.width-960)/2+570,470),this.m_firework_position.push_back(firework_position_list),firework_position_list=cc.p((winSize.width-960)/2+910,150),this.m_firework_position.push_back(firework_position_list),firework_position_list=cc.p((winSize.width-960)/2+680,250),this.m_firework_position.push_back(firework_position_list),this.m_firework_position.shuffle();for(var pos=cc.p(0,0),i=0;i<this.m_firework_position.size();i++){var x=parseInt(30*Math.random())-15,y=parseInt(30*Math.random())-15;(pos=this.m_firework_position.at(i)).x+=x,pos.y+=y;var delay_time=100*Math.random()/1e3+.35*i+d,str="play_fireworks_"+i;this.scheduleOnce(function(){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/hit_power_blow.mp3";audio.playEffect(path);var x=parseInt(30*Math.random())-15,y=parseInt(30*Math.random())-15;if((pos=this.m_firework_position.pop_front()).x+=x,pos.y+=y,0==NOT_USE_SP_FIREWORKS_EFF_ANIMATION){var fire=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Fireworks.json",RES_CDN_DEFULT+"effect/Fireworks.atlas",1);fire.setPosition(pos),this.m_win_lose_layer.addChild(fire),fire.setAnimation(0,"fx_1",!1),fire.setCompleteListener(function(traceIndex,loopCount){fire.setVisible(!1)})}}.bind(this),delay_time,str)}},userLevelUpFillProgressEvent:function(bar){this.m_user_level_count++,this.m_user_level.setString("Lv "+this.m_user_level_count);var levelup_effect=new cc.Sprite;levelup_effect.setAnchorPoint(ANCHOR_MIDDLE());var size=this.m_user_exp_bar.getContentSize();if(levelup_effect.setPosition(.5*size.width,size.height),this.m_user_exp_bar.addChild(levelup_effect,3),NOT_USE_SP_BATTLE_ANIMATION){levelup_effect.setScale(2),levelup_effect.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_user_lvup_15.png");var scaleTo_1=new cc.ScaleTo(.2,2.03,2.03),scaleTo_2=new cc.ScaleTo(.2,1.97,1.97),sequence=(remove=new cc.RemoveSelf(!0),new cc.Sequence(scaleTo_1,scaleTo_2,scaleTo_1,scaleTo_2,remove));levelup_effect.runAction(sequence),sequence=remove=scaleTo_2=scaleTo_1=null}else{var ani=BattleAni._getInstance().getAnimate(BattleAni_.EffectUserLevelUp),remove=new cc.RemoveSelf(!0),seq=new cc.Sequence(ani,remove);levelup_effect.runAction(seq),seq=remove=ani=null}},userLevelUpEndProgressEvent:function(bar){this.m_user_exp.setVisible(!0),this.m_user_exp_bar.setPercent(parseInt(this.m_user_exp.getString()),!1)},countingLabelCallback:function(node){if(this.m_is_skip){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_acclamation.mp3";audio.playEffect(path)}this.appearGeneral(),this.appearGainBonus(),this.appearButtons()},voicePlay:function(voice_type){var duration,partner_id=GeneralService.getInstance().getUserTroopsPartnerId(),voice_list=MasterTable.getInstance().get_Voice(partner_id,voice_type,{}),voice=voice_list.voice;if(duration=voice_list.duration,voice&&""!=voice){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3";audio.playVoice(path),this.m_is_voice_playing=!0,this.m_voice_playing_delta=duration}},partnerAnimation:function(){if(null!=this.m_partner_gnrl){this.m_partner_gnrl.isRunning()&&(this.m_partner_gnrl.stopAllActions(),this.m_partner_gnrl.setPosition(MAIN_POS(this,this.m_bp.posx,this.m_bp.posy)));var s1=new cc.ScaleTo(.1,this.m_img_scale+.03,this.m_img_scale-.03),s2=new cc.ScaleTo(.2,this.m_img_scale-.03,this.m_img_scale+.03),s3=new cc.ScaleTo(.15,this.m_img_scale+.02,this.m_img_scale-.02),s4=new cc.ScaleTo(.8,this.m_img_scale,this.m_img_scale),e4=new cc.EaseElasticOut(s4),seq=new cc.Sequence(s1,s2,s3,e4);this.m_partner_gnrl.runAction(seq)}else null!=this.m_skeletonNode&&(this.m_skeletonNode.setAnimation(0,"active",!1),this.m_skeletonNode.addAnimation(0,"basic",!0),this.m_skeletonNode.setAnimation(1,"emo_basic",!0));this.m_is_voice_playing||this.voicePlay(voice_main_body_touch)},setEnableBtns:function(isEnable){if(null!=this.m_btn_list)for(var i=0;i<this.m_btn_list.length;i++){this.m_btn_list[i].setEnabled(isEnable)}},checkWeeklyContinue:function(){var mt=MasterManager.getInstance(),need_jade_count=NEED_JADE_TO_CONTINUE;if(NetService().get_UserItemInfo_V2().jade_cnt<need_jade_count)this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.show_not_enough_jade);else{this.m_message_box.setTitle(mt.get_LanguageData("label_battle_continue_title"));var box="翡翠"+need_jade_count+"個を消費し続けますか。";this.m_message_box.setText(box),this.m_message_box.setText("\n"),this.m_message_box.addButtonInfo(new MessageButtonInfo("いいえ",MessageBoxButtonType.ButtonTypeRed,0,function(){this.setEnableBtns(!0),this.m_message_box.hide()}.bind(this))),this.m_message_box.addButtonInfo(new MessageButtonInfo("はい",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(){this.setEnableBtns(!1),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_weekly_continue)},0,"continue_confirm"),this.m_message_box.hide()}.bind(this))),this.m_message_box.show(),this.setEnableBtns(!1)}},checkEventDungeonContinue:function(){var mt=MasterManager.getInstance(),need_jade_count=NEED_JADE_TO_CONTINUE;if(NetService().get_UserItemInfo_V2().jade_cnt<need_jade_count)this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.show_not_enough_jade);else{this.m_message_box.setTitle(mt.get_LanguageData("label_battle_continue_title"));var box="翡翠"+need_jade_count+"個を消費し続けますか。";this.m_message_box.setText(box),this.m_message_box.setText("\n"),this.m_message_box.addButtonInfo(new MessageButtonInfo("いいえ",MessageBoxButtonType.ButtonTypeRed,0,function(){this.setEnableBtns(!0),this.m_message_box.hide()}.bind(this))),this.m_message_box.addButtonInfo(new MessageButtonInfo("はい",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(){this.setEnableBtns(!1),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_event_dungeon_continue)},0,"continue_confirm"),this.m_message_box.hide()}.bind(this))),this.m_message_box.show(),this.setEnableBtns(!1)}},checkStoryHardModeContinue:function(){var need_jade_count=NEED_JADE_TO_CONTINUE;if(NetService().get_UserItemInfo_V2().jade_cnt<need_jade_count)this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.show_not_enough_jade);else{this.m_message_box.setTitle(res_str("label_battle_continue_title"));var box="翡翠"+NEED_JADE_TO_CONTINUE+"個を消費し続けますか。";this.m_message_box.setText(box),this.m_message_box.setText("\n"),this.m_message_box.addButtonInfo(new MessageButtonInfo("いいえ",MessageBoxButtonType.ButtonTypeRed,0,function(){this.setEnableBtns(!0),this.m_message_box.hide()}.bind(this))),this.m_message_box.addButtonInfo(new MessageButtonInfo("はい",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(){this.setEnableBtns(!1),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.story_hard_mode_over_continue_confirm)},0,"story_hard_mode_over_continue_confirm"),this.m_message_box.hide()}.bind(this))),this.m_message_box.show(),this.setEnableBtns(!1)}},checkMissionContinue:function(){if(NetService().get_UserItemInfo_V2().jade_cnt<NEED_JADE_TO_CONTINUE)this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.show_not_enough_jade);else{this.m_message_box.setTitle(res_str("label_battle_continue_title"));var box="翡翠"+NEED_JADE_TO_CONTINUE+"個を消費し続けますか。";this.m_message_box.setText(box),this.m_message_box.setText("\n"),this.m_message_box.addButtonInfo(new MessageButtonInfo("いいえ",MessageBoxButtonType.ButtonTypeRed,0,function(){this.setEnableBtns(!0),this.m_message_box.hide()}.bind(this))),this.m_message_box.addButtonInfo(new MessageButtonInfo("はい",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(){this.setEnableBtns(!1),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.game_over_lose_continue_confirm)},0,"continue_confirm"),this.m_message_box.hide()}.bind(this))),this.m_message_box.show(),this.setEnableBtns(!1)}},update:function(dt){this.m_is_voice_playing&&(this.m_voice_playing_delta-=dt,this.m_voice_playing_delta<0&&(this.m_is_voice_playing=!1,this.m_voice_playing_delta=0))},showDebugBox:function(){this.m_debug_log_box.setContentSize(ccSize(this)),this.m_debug_log_box._contentNode=function(contentSize,m){var layer=new BattleDebugLayer,btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);return btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),btn.setPosition(ccWidth(layer)-2,ccHeight(layer)-2),layer.addChild(btn),btn.addClickEventListener(function(sender){this.hideDebugBox()}.bind(this)),layer}.bind(this),this.m_debug_log_box.show()},showGeneralDebugBox:function(){this.m_debug_log_box.setContentSize(ccSize(this)),this.m_debug_log_box._contentNode=function(contentSize,m){var layer=new BattleGeneralDebugLayer,btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);return btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),btn.setPosition(ccWidth(layer)-2,ccHeight(layer)-2),layer.addChild(btn),btn.addClickEventListener(function(sender){this.hideDebugBox()}.bind(this)),layer}.bind(this),this.m_debug_log_box.show()},hideDebugBox:function(){this.m_debug_log_box.is_show()&&this.m_debug_log_box.hide()},showRaidBossSharedPopup:function(boss){this.m_shared_modal_layer._contentNode=function(contentSize,m){var layer=new cc.Layer,popup=new RaidBossSharedPopupLayer;return popup.setRaidBossData(boss),popup._callback_close_popup=this.hideRaidBossSharedPopup.bind(this),popup._callback_shared=this.reqRaidBossShared.bind(this),layer.setContentSize(popup.getContentSize()),layer.setPosition(this.getContentSize().width/2,this.getContentSize().height/2),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),layer.addChild(popup),popup.setPosition(ccCenter(layer)),this.m_shared_modal_layer.setContentSize(layer.getContentSize()),layer},this.m_shared_modal_layer.is_show()||this.m_shared_modal_layer.show()},hideRaidBossSharedPopup:function(){this.m_shared_modal_layer.is_show()&&this.m_shared_modal_layer.hide()},reqRaidBossShared:function(boss,shared_type){var req={};req.opcode=net.OP.op_raid_boss_shared,req.discovered_user_id=boss.discovered_user_id,req.raid_boss_period_idx=boss.raid_boss_period_idx,req.raid_boss_num=boss.raid_boss_num,req.shared_type=shared_type;var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent),this.hideRaidBossSharedPopup()},gainItemAppear:function(game_type,appear_task){this.scheduleOnce(function(){if(game_type==db.BattleGameType.EventDungeon&&USE_EVENT_DUNGEON_ACHIEVEMENT){var event_dungeon_period_idx=0;if(!BattleContext._getInstance().getIsPrvEventDungeon()){event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();var period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),req={};req.opcode=net.OP.op_user_event_dungeon_achv_list,req.event_dungeon_period_idx=period.event_dungeon_group_idx,SceneManager.getInstance().getRunningScene().network_write(req)}}if(0<this.m_gain_items.size()){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_battle_item_get.mp3";audio.playEffect(path)}for(var i=0;i<this.m_gain_items.size();i++){this.m_gain_items.at(i).openBox()}1==appear_task&&this.appearTasks()},1.5,"open_box")}}),BattleRaidBossResultLayer=cc.Layer.extend({m_win_lose_layer:null,m_result_layer:null,m_is_win:!1,m_raid_boss_result:null,m_new_raid_boss_result:null,m_partner_gnrl:null,m_bp:null,enable_touch_partner:!1,m_skeletonNode:null,m_game_type:db.BattleGameType.RaidDungeon,m_game_scene:null,m_debug_log_box:null,m_voice_id:0,m_is_voice_playing:!1,m_voice_playing_delta:0,m_partnerInfo:null,m_shared_modal_layer:null,m_btn_list:null,m_lose:null,m_new_raid_boss_last_damage:0,m_gnrl_img:null,m_img_scale:1,battleObserver:null,m_msg_box:null,m_scroll_arrow_left:null,m_scroll_arrow_right:null,m_gain_items:null,m_scroll_view:null,m_scroll_container:null,ctor:function(){this._super(),this.m_btn_list=[],this.m_gain_items=[],this.battleObserver=MainObserver.getInstance(),this.init()},init:function(){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var winSize=cc.director.getWinSize();this.m_game_type=BattleContext._getInstance().getGameType();var listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1});listener.onTouchBegan=function(touch,event){var winSize=cc.director.getWinSize(),pos=touch.getLocation(),rect=cc.rect(winSize.width-400,0,400,winSize.height);return cc.rectContainsPoint(rect,pos)}.bind(this),listener.onTouchEnded=function(touch,event){this.enable_touch_partner&&this.m_is_win&&this.partnerAnimation()}.bind(this),cc.eventManager.addListener(listener,this);var modalSize=cc.size(winSize.width,640);return this.m_debug_log_box=new GameModalLayer,this.addChild(this.m_debug_log_box,99999),this.m_shared_modal_layer=new GameModalLayer,this.m_shared_modal_layer.setContentSize(modalSize),this.addChild(this.m_shared_modal_layer,99999),this.m_msg_box=new GameMessageBox,this.addChild(this.m_msg_box,1e5),this.scheduleUpdate(),!0},onEnter:function(){this._super(),AudioEngine.getInstance().stopBackgroundMusic()},onExit:function(){if(this._super(),null!=this.m_gnrl_img)if(1==USE_PARTNER_GNRL_LOADING)if(0<SAVE_NOW_PARTNER_GNRL.res_img.length)for(var idx=0;idx<this.m_gnrl_img.length;idx++){for(var check_release=!1,jdx=0;jdx<SAVE_NOW_PARTNER_GNRL.res_img.length;jdx++)SAVE_NOW_PARTNER_GNRL.res_img[jdx]==this.m_gnrl_img[idx]&&(check_release=!0);0==check_release&&cc.loader.release(this.m_gnrl_img[idx])}else for(idx=0;idx<this.m_gnrl_img.length;idx++)cc.loader.release(this.m_gnrl_img[idx]);else{for(idx=0;idx<this.m_gnrl_img.length;idx++)cc.loader.release(this.m_gnrl_img[idx]);this.m_gnrl_img=null}this.removeAllChildren(!0),this.removeAllChildrenWithCleanup(!0)},resultData_NewRaid:function(res,boss_dmg){this.m_is_win="y"==res.raid_boss_clear_yn,this.m_new_raid_boss_result=res,this.m_new_raid_boss_last_damage=boss_dmg,this.m_is_win?this.makeSuccess():this.makeFailed()},resultData:function(res){"y"==res.battle_win_yn?this.m_is_win=!0:this.m_is_win=!1,this.m_raid_boss_result=res,this.m_is_win?this.makeSuccess():this.makeFailed()},setGameScene:function(scene){this.m_game_scene=scene},update:function(dt){this.m_is_voice_playing&&(this.m_voice_playing_delta-=dt,this.m_voice_playing_delta<0&&(this.m_is_voice_playing=!1,this.m_voice_playing_delta=0))},makeSuccess:function(){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_battle_win.mp3";audio.playEffect(path);var mt=MasterManager.getInstance(),context=BattleContext._getInstance(),winSize=cc.director.getWinSize();this.m_win_lose_layer=new cc.Layer,this.m_win_lose_layer.ignoreAnchorPointForPosition(!1),this.m_win_lose_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_win_lose_layer.setPosition(ccCenter(this)),this.addChild(this.m_win_lose_layer,0);var dim=new cc.LayerColor(cc.color.BLACK);dim.ignoreAnchorPointForPosition(!1),dim.setAnchorPoint(ANCHOR_MIDDLE()),dim.setPosition(ccCenter(this.m_win_lose_layer)),dim.setOpacity(0),this.m_win_lose_layer.addChild(dim);var fadein=new cc.FadeTo(.3,128);dim.runAction(fadein);var win=cc.Sprite.create();if(win.setAnchorPoint(ANCHOR_MIDDLE()),win.setPosition(ccCenter(this.m_win_lose_layer)),this.m_win_lose_layer.addChild(win),NOT_USE_SP_BATTLE_ANIMATION){win.setScale(2),win.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_win_09.png");var scaleTo_1=new cc.ScaleTo(.7,2.03,2.03),scaleTo_2=new cc.ScaleTo(.7,1.97,1.97),sequence=new cc.Sequence(scaleTo_1,scaleTo_2);delay1=new cc.DelayTime(.3),cb=new cc.CallFunc(this.cbMakeSuccssImpactStar,this),seq=new cc.Sequence(delay1,sequence,cb);win.runAction(seq),seq=cb=delay1=sequence=scaleTo_2=scaleTo_1=null}else{var delay1=new cc.DelayTime(.3),ani=BattleAni._getInstance().getAnimate(BattleAni_.EffectResultWin),cb=new cc.CallFunc(this.cbMakeSuccssImpactStar,this),seq=new cc.Sequence(delay1,ani,cb);win.runAction(seq),seq=cb=ani=delay1=null}var dmg_box_str="",dmg_box_height=0,is_battle_skip=context.getRaidBossBattleSkip();dmg_box_height=1==is_battle_skip?(dmg_box_str=RES_CDN_DEFULT+"menu_raid/img_raid_damage.png",90):(dmg_box_str=RES_CDN_DEFULT+"menu_raid/img_raid_damage_2.png",129);var dmg_box=cc.Scale9Sprite.create(dmg_box_str,RectZero());if(dmg_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),dmg_box.setPosition(ZERO()),dmg_box.setPreferredSize(cc.size(winSize.width,dmg_box_height)),this.m_win_lose_layer.addChild(dmg_box),this.m_game_type==db.BattleGameType.RaidDungeon){var str=cmString(mt.get_LanguageData("label_raid_boss_result_total_damage"),this.m_raid_boss_result.accum_damage_point.toLocaleString("en"));if((accum_damage=cmLabel.getLabel(str,LABEL_FONT_INDEX.FONT_281)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),accum_damage.setPosition(ccCenter(dmg_box).x,12),dmg_box.addChild(accum_damage),1==is_battle_skip){var max_current_damage=cmLabel.getLabel(cmString(res_str("label_raid_boss_result_before_damage"),this.m_raid_boss_result.damage.toLocaleString("en")),LABEL_FONT_INDEX.FONT_281);max_current_damage.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),max_current_damage.setPosition(ccPosX(accum_damage),48),dmg_box.addChild(max_current_damage)}else{var max_damage_value=context.getUserRaidBossBeforeDamage();this.m_raid_boss_result.damage>max_damage_value&&(max_damage_value=this.m_raid_boss_result.damage);var max_damage=cmLabel.getLabel(cmString(res_str("label_raid_boss_result_max_damage"),max_damage_value.toLocaleString("en")),LABEL_FONT_INDEX.FONT_281);max_damage.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),max_damage.setPosition(ccPosX(accum_damage),48),dmg_box.addChild(max_damage);var str2=cmString(mt.get_LanguageData("label_raid_boss_result_current_damage"),parseInt(this.m_raid_boss_result.damage).toLocaleString("en"));if((current_damage=cmLabel.getLabel(str2,LABEL_FONT_INDEX.FONT_281)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),current_damage.setPosition(ccPosX(accum_damage),83),dmg_box.addChild(current_damage),this.m_raid_boss_result.damage>context.getUserRaidBossBeforeDamage()){context.setUserRaidBossBeforeDamage(this.m_raid_boss_result.damage);var new_record_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_result_font.png");new_record_img.setAnchorPoint(ZERO()),new_record_img.setPosition(10,ccHeight(dmg_box)),dmg_box.addChild(new_record_img)}}}else if(this.m_game_type==db.BattleGameType.NewRaidBossDungeon){var max_hp=0,found_boss=this.m_new_raid_boss_result.boss_data_list.findIndex(function(s){return 0!=s.boss_yn});if(-1!=found_boss){var boss_idx=this.m_new_raid_boss_result.boss_data_list[found_boss].boss_idx;max_hp=MasterManager.getInstance().get_NewRaidBossNpcGroup(boss_idx).added_life*this.m_new_raid_boss_result.boss_data_list[found_boss].max_hp+this.m_new_raid_boss_result.boss_data_list[found_boss].max_hp}var accum_damage;this.m_new_raid_boss_result.accum_damage;(accum_damage=cmLabel.getLabel(cmString(res_str("label_raid_boss_result_total_damage"),Number(parseInt(this.m_new_raid_boss_result.accum_damage)).toLocaleString("en")),LABEL_FONT_INDEX.FONT_281)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),accum_damage.setPosition(ccCenter(dmg_box).x,22),dmg_box.addChild(accum_damage);var current_damage;this.m_new_raid_boss_last_damage;(current_damage=cmLabel.getLabel(cmString(res_str("label_raid_boss_result_current_damage"),Number(parseInt(this.m_new_raid_boss_last_damage)).toLocaleString("en")),LABEL_FONT_INDEX.FONT_281)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),current_damage.setPosition(ccPosX(accum_damage),73),dmg_box.addChild(current_damage)}this.playFireworks(1)},makeFailed:function(){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_battle_lose.mp3";audio.playEffect(path);var size=ccSize(this),texture=new cc.RenderTexture(size.width+1,size.height,cc.Texture2D.PIXEL_FORMAT_RGBA8888);texture.begin(),this.m_game_scene.visit(),texture.end(),this.m_win_lose_layer=new cc.Layer,this.m_win_lose_layer.ignoreAnchorPointForPosition(!1),this.m_win_lose_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_win_lose_layer.setPosition(ccCenter(this)),this.addChild(this.m_win_lose_layer,0);var fail_bg=cc.Sprite.create(texture.getSprite().getTexture());fail_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),fail_bg.setPosition(ZERO()),fail_bg.setFlippedY(!0),this.m_win_lose_layer.addChild(fail_bg),BattleShaderCache.getInstance().openShader(fail_bg,SHADER_GRAY_SCALE_FSH,SHADER_DEFAULT_ORIGIN_VSH),fail_bg.setOpacity(0);var fadein=new cc.FadeIn(1);if(fail_bg.runAction(fadein),this.m_lose=cc.Sprite.create(),this.m_lose.setAnchorPoint(ANCHOR_MIDDLE()),this.m_lose.setPosition(ccCenter(this.m_win_lose_layer)),this.m_win_lose_layer.addChild(this.m_lose),NOT_USE_SP_BATTLE_ANIMATION){this.m_lose.setScale(3);delay1=new cc.DelayTime(.3);this.m_lose.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_lose_09.png");var scaleTo_1=new cc.ScaleTo(.3,3,3),scaleTo_2=new cc.ScaleTo(.3,2,2),sequence=new cc.Sequence(scaleTo_1,scaleTo_2);delay2=new cc.DelayTime(1.5),cb=new cc.CallFunc(this.cbMakeWinLose,this),seq=new cc.Sequence(delay1,sequence,delay2,cb);this.m_lose.runAction(seq),seq=cb=delay2=sequence=scaleTo_2=scaleTo_1=delay1=null}else{var delay1=new cc.DelayTime(.3),ani=BattleAni._getInstance().getAnimate(BattleAni_.EffectResultLose),delay2=new cc.DelayTime(1.5),cb=new cc.CallFunc(this.cbMakeWinLose,this),seq=new cc.Sequence(delay1,ani,delay2,cb);this.m_lose.runAction(seq),seq=cb=ani=delay2=delay1=null}},cbMakeWinLose:function(){var winSize=cc.director.getWinSize(),mt=MasterManager.getInstance(),context=BattleContext._getInstance();if(this.m_is_win)this.m_win_lose_layer.setVisible(!1),this.makeResultMissionReward(),this.voicePlay(voice_battle_win_leader);else{this.appearButtons();var move=new cc.MoveTo(.3,cc.p(.5*winSize.width,.5*winSize.height+120));this.m_lose.runAction(move);var dmg_box_str="",dmg_box_height=0,is_battle_skip=!1;this.m_game_type==db.BattleGameType.RaidDungeon?dmg_box_height=(is_battle_skip=context.getRaidBossBattleSkip())?(dmg_box_str=RES_CDN_DEFULT+"menu_raid/img_raid_damage.png",90):(dmg_box_str=RES_CDN_DEFULT+"menu_raid/img_raid_damage_2.png",129):this.m_game_type==db.BattleGameType.NewRaidBossDungeon&&(dmg_box_str=RES_CDN_DEFULT+"menu_raid/img_raid_damage_2.png",dmg_box_height=129);var dmg_box=cc.Scale9Sprite.create(dmg_box_str,RectZero());if(dmg_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),dmg_box.setPosition(ZERO()),dmg_box.setPreferredSize(cc.size(winSize.width,dmg_box_height)),this.m_win_lose_layer.addChild(dmg_box),this.m_game_type==db.BattleGameType.RaidDungeon){var str=cmString(mt.get_LanguageData("label_raid_boss_result_total_damage"),this.m_raid_boss_result.accum_damage_point.toLocaleString("en"));if((accum_damage=cmLabel.getLabel(str,LABEL_FONT_INDEX.FONT_281)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),accum_damage.setPosition(ccCenter(dmg_box).x,12),dmg_box.addChild(accum_damage),1==is_battle_skip){var max_current_damage=cmLabel.getLabel(cmString(res_str("label_raid_boss_result_before_damage"),this.m_raid_boss_result.damage.toLocaleString("en")),LABEL_FONT_INDEX.FONT_281);max_current_damage.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),max_current_damage.setPosition(ccPosX(accum_damage),48),dmg_box.addChild(max_current_damage)}else{var max_damage_value=context.getUserRaidBossBeforeDamage();this.m_raid_boss_result.damage>max_damage_value&&(max_damage_value=this.m_raid_boss_result.damage);var max_damage=cmLabel.getLabel(cmString(res_str("label_raid_boss_result_max_damage"),max_damage_value.toLocaleString("en")),LABEL_FONT_INDEX.FONT_281);max_damage.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),max_damage.setPosition(ccPosX(accum_damage),48),dmg_box.addChild(max_damage);var str2=cmString(mt.get_LanguageData("label_raid_boss_result_current_damage"),parseInt(this.m_raid_boss_result.damage).toLocaleString("en"));if((current_damage=cmLabel.getLabel(str2,LABEL_FONT_INDEX.FONT_281)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),current_damage.setPosition(ccPosX(accum_damage),83),dmg_box.addChild(current_damage),this.m_raid_boss_result.damage>context.getUserRaidBossBeforeDamage()){context.setUserRaidBossBeforeDamage(this.m_raid_boss_result.damage);var new_record_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_result_font.png");new_record_img.setAnchorPoint(ZERO()),new_record_img.setPosition(10,ccHeight(dmg_box)),this.m_win_lose_layer.addChild(new_record_img)}}this.m_raid_boss_result.raid_boss_info.discovered_user_id==m_user_id&&this.m_raid_boss_result.raid_boss_info.shared_type==database.Raid_Boss_Shared_Type.Raid_Boss_Shared_Type_None&&this.showRaidBossSharedPopup(this.m_raid_boss_result.raid_boss_info)}else if(this.m_game_type==db.BattleGameType.NewRaidBossDungeon){var max_hp=0,found_boss=this.m_new_raid_boss_result.boss_data_list.findIndex(function(s){return 0!=s.boss_yn});if(-1!=found_boss){var boss_idx=this.m_new_raid_boss_result.boss_data_list[found_boss].boss_idx;max_hp=MasterManager.getInstance().get_NewRaidBossNpcGroup(boss_idx).added_life*this.m_new_raid_boss_result.boss_data_list[found_boss].max_hp+this.m_new_raid_boss_result.boss_data_list[found_boss].max_hp}var accum_damage;this.m_new_raid_boss_result.accum_damage;(accum_damage=cmLabel.getLabel(cmString(res_str("label_raid_boss_result_total_damage"),Number(parseInt(this.m_new_raid_boss_result.accum_damage)).toLocaleString("en")),LABEL_FONT_INDEX.FONT_281)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),accum_damage.setPosition(ccCenter(dmg_box).x,22),dmg_box.addChild(accum_damage);var current_damage;this.m_new_raid_boss_last_damage;(current_damage=cmLabel.getLabel(cmString(res_str("label_raid_boss_result_current_damage"),Number(parseInt(this.m_new_raid_boss_last_damage)).toLocaleString("en")),LABEL_FONT_INDEX.FONT_281)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),current_damage.setPosition(ccPosX(accum_damage),73),dmg_box.addChild(current_damage);var user_id=m_user_id;if(this.m_new_raid_boss_result.discovered_user_id==user_id){var dungeon=context.getBattleNewRaidBossDungeonData();dungeon.dungeon.shared_type==database.New_Raid_Boss_Shared_Type.New_Raid_Boss_Shared_Type_None&&this.showNewRaidBossSharedPopup(dungeon.dungeon)}}}},makeResultMissionReward:function(){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_acclamation.mp3";audio.playEffect(path);var m=MasterTable.getInstance(),mt=MasterManager.getInstance();this.m_gnrl_img=[];var partner_id=0;if(1==USE_PARTNER_GNRL_LOADING){var partner_yunhee=GameDefault.getInstance().GetPartnerYunheeLoad();if(1==partner_yunhee.load)for(var tdx=0;tdx<partner_yunhee.gnrl_img.length;tdx++)this.m_gnrl_img.push(partner_yunhee.gnrl_img[tdx]);this.m_bp=partner_yunhee.position,partner_id=partner_yunhee.partner_id}else{var generalService=GeneralService.getInstance(),partner_gnrl=new db.UserGeneralInfo,partner_key=GameContext.getInstance().getUserGeneralPartner(),gnrl_key=new net.User_General_Key;gnrl_key.gnrl_id=partner_key.gnrl_id,gnrl_key.gnrl_num=partner_key.gnrl_num,generalService.getUserGnrlDisplayClassInfo(gnrl_key,partner_gnrl),partner_id=partner_gnrl.class_type>=AVAIL_EVOLUTION_CLASS_TYPE_LIMIT&&0!=partner_gnrl.display_class&&partner_gnrl.class_type!=partner_gnrl.display_class?partner_gnrl.gnrl_id-1e3*(partner_gnrl.class_type-partner_gnrl.display_class):partner_gnrl.gnrl_id;var morph=m.get_MorphData(partner_id);this.m_bp=mt.get_BodyPosition(partner_id);var gnrl=mt.get_General(morph.gnrl_id);if("y"==morph.is_morph){var stading_files=StandingMultiplePngList[morph.gnrl_id];if(null==stading_files)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".png");else for(var idx=0;idx<stading_files.length;idx++)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+stading_files[idx]+".png");this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".atlas"),this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".json")}else{var general=mt.get_General(partner_id);if(general.gnrl_type==GENERAL_TYPE_YUNHEE){if(mt.get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var str=getCardBody_ImageStr(general.gnrl_id);this.m_gnrl_img.push(str)}else{str=getCardBody_ImageStr(general.gnrl_id);this.m_gnrl_img.push(str)}}else{str=getCardBody_ImageStr(partner_id);this.m_gnrl_img.push(str)}}}this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/bg_raid_result.jpg"),cc.loader.load(this.m_gnrl_img,function(err,results){err||this.resourceLoader_start(partner_id)}.bind(this))},resourceLoader_start:function(partner_id){var winSize=cc.director.getWinSize(),mt=MasterManager.getInstance(),morph=MasterTable.getInstance().get_MorphData(partner_id),gnrl=mt.get_General(morph.gnrl_id);this.m_result_layer=new cc.Layer,this.m_result_layer.ignoreAnchorPointForPosition(!1),this.m_result_layer.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_result_layer.setPosition(ZERO()),this.addChild(this.m_result_layer);var bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/bg_raid_result.jpg");if(USE_SP_RAIDBOSS_SCALE&&bg.setScale(2),bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(this)),this.m_result_layer.addChild(bg),"y"==morph.is_morph){var standing_atlas=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".atlas",standing_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".json";this.m_skeletonNode=new sp.SkeletonAnimation(standing_json,standing_atlas,.1),this.m_skeletonNode.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_skeletonNode.setPosition(MAIN_POS(this,this.m_bp.posx,this.m_bp.posy)),this.m_result_layer.addChild(this.m_skeletonNode),this.m_skeletonNode.setMix("basic","active",.1),this.m_skeletonNode.setMix("active","basic",.1),this.m_skeletonNode.setAnimation(0,"active",!1),this.m_skeletonNode.addAnimation(0,"basic",!0)}else{var general=mt.get_General(partner_id);if(this.m_img_scale=1,general.gnrl_type==GENERAL_TYPE_YUNHEE){if(mt.get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id)}else{img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id)}}else{img_str=getCardBody_ImageStr(partner_id);this.m_img_scale=getCardBody_Scale(partner_id)}this.m_partner_gnrl=cc.Sprite.create(img_str),this.m_partner_gnrl.setScale(this.m_img_scale),this.m_partner_gnrl.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_partner_gnrl.setPosition(MAIN_POS(this,this.m_bp.posx+ccWidth(this.m_partner_gnrl)*this.m_img_scale,this.m_bp.posy)),this.m_result_layer.addChild(this.m_partner_gnrl);var move=new cc.MoveTo(.5,MAIN_POS(this,this.m_bp.posx,this.m_bp.posy)),ease=new cc.EaseExponentialOut(move);this.m_partner_gnrl.runAction(ease)}var title_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_main/bg_state_title.png");title_bg.setAnchorPoint(ANCHOR_TOP_LEFT()),title_bg.setPosition(0,ccHeight(this)),this.m_result_layer.addChild(title_bg);var result_title=cc.Sprite.create("#img_result_text.png");result_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),result_title.setPosition(30,66),title_bg.addChild(result_title);var result_win=new cc.Sprite;if(result_win.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),result_win.setPosition(.5*winSize.width,442),this.m_result_layer.addChild(result_win),NOT_USE_SP_BATTLE_ANIMATION){result_win.setScale(2),result_win.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_result_win_10.png");var scaleTo_1=new cc.ScaleTo(.7,2,2.01),scaleTo_2=new cc.ScaleTo(.7,2,1.99),sequence=new cc.Sequence(scaleTo_1,scaleTo_2);repeat=new cc.RepeatForever(sequence);result_win.runAction(repeat),repeat=sequence=scaleTo_2=scaleTo_1=null}else{var ani=BattleAni._getInstance().getAnimate(BattleAni_.EffectWinText),repeat=new cc.RepeatForever(ani);result_win.runAction(repeat),repeat=ani=null}if(this.m_game_type==db.BattleGameType.NewRaidBossDungeon){var dungeon_data=mt.get_NewRaidBossDungeonInfo(this.m_new_raid_boss_result.new_raid_boss_dungeon_info_idx),boss_name_str="";1==dungeon_data.difficult?boss_name_str=cmString("%s%s",dungeon_data.boss_name,res_str("new_raidboss_main_mode_button_easy")):2==dungeon_data.difficult&&(boss_name_str=cmString("%s%s",dungeon_data.boss_name,res_str("new_raidboss_main_mode_button_hard"))),(boss_name=cmLabel.getLabel(boss_name_str,LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),boss_name.setPosition(144,498),this.m_result_layer.addChild(boss_name)}else if(this.m_game_type==db.BattleGameType.RaidDungeon){var boss=mt.get_RaidBossInfo(this.m_raid_boss_result.raid_boss_info.raid_boss_info_idx),element_icon=cc.Sprite.create("#img_battletech_"+boss.element_type+".png");element_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),element_icon.setPosition(106,495),this.m_result_layer.addChild(element_icon);var boss_name,str=cmString(mt.get_LanguageData("label_raid_boss_name_element"),this.m_raid_boss_result.raid_boss_info.boss_level,boss.name);switch((boss_name=cmLabel.getLabel(str,LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),boss_name.setPosition(144,498),this.m_result_layer.addChild(boss_name),boss.element_type){case ELEMENT_TYPE_FIRE:boss_name.setColor(cc.color(220,36,36));break;case ELEMENT_TYPE_WATER:boss_name.setColor(cc.color(77,134,241));break;case ELEMENT_TYPE_WIND:boss_name.setColor(cc.color(79,193,44));break;case ELEMENT_TYPE_LIGHT:boss_name.setColor(cc.color(225,206,77));break;case ELEMENT_TYPE_DARK:boss_name.setColor(cc.color(204,67,209))}}if(this.appearGeneral(),this.appearGainBonus(),this.appearButtons(),this.m_game_type==db.BattleGameType.RaidDungeon){var infoBoxSize=cc.size(512,40),info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",cc.Rect(40,40,10,10));info_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),info_box.setPosition(0,0),info_box.setPreferredSize(infoBoxSize),this.m_result_layer.addChild(info_box);var info_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_friend/img_friend_text.png");info_icon.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),info_icon.setPosition(106,.5*infoBoxSize.height),info_box.addChild(info_icon);var info_label=cmLabel.getLabel(mt.get_LanguageData("label_raid_boss_result_send_maile_msg"),LABEL_FONT_INDEX.FONT_1613);info_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),info_label.setPosition(140,.5*infoBoxSize.height),info_box.addChild(info_label)}},cbMakeSuccssImpactStar:function(){this.scheduleOnce(function(){this.cbMakeWinLose()}.bind(this),2.5,"success_impact_star")},playFireworks:function(d){this.m_firework_position=new Array;var firework_position_list=cc.p((winSize.width-960)/2+930,500);this.m_firework_position.push_back(firework_position_list),firework_position_list=cc.p((winSize.width-960)/2+110,210),this.m_firework_position.push_back(firework_position_list),firework_position_list=cc.p((winSize.width-960)/2+570,470),this.m_firework_position.push_back(firework_position_list),firework_position_list=cc.p((winSize.width-960)/2+910,150),this.m_firework_position.push_back(firework_position_list),firework_position_list=cc.p((winSize.width-960)/2+680,250),this.m_firework_position.push_back(firework_position_list),this.m_firework_position.shuffle();for(var pos=cc.p(0,0),i=0;i<this.m_firework_position.size();i++){var x=parseInt(30*Math.random())-15,y=parseInt(30*Math.random())-15;(pos=this.m_firework_position.at(i)).x+=x,pos.y+=y;var delay_time=100*Math.random()/1e3+.35*i+d,str="play_fireworks_"+i;this.scheduleOnce(function(){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/hit_power_blow.mp3";audio.playEffect(path);var x=parseInt(30*Math.random())-15,y=parseInt(30*Math.random())-15;if((pos=this.m_firework_position.pop_front()).x+=x,pos.y+=y,0==NOT_USE_SP_FIREWORKS_EFF_ANIMATION){var fire=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Fireworks.json",RES_CDN_DEFULT+"effect/Fireworks.atlas",1);fire.setPosition(pos),this.m_win_lose_layer.addChild(fire),fire.setAnimation(0,"fx_1",!1),fire.setCompleteListener(function(traceIndex,loopCount){fire.setVisible(!1)})}}.bind(this),delay_time,str)}},appearGeneral:function(){var pos_list=new Array,pos_list_p=cc.p(362,202);pos_list.push_back(pos_list_p),pos_list_p=cc.p(234,262),pos_list.push_back(pos_list_p),pos_list_p=cc.p(234,142),pos_list.push_back(pos_list_p),pos_list_p=cc.p(106,262),pos_list.push_back(pos_list_p),pos_list_p=cc.p(106,142),pos_list.push_back(pos_list_p);for(var gnrl_list=BattleContext._getInstance().getBeforeBattleGeneralList(),i=0;i<5;i++){for(var is_exist=!1,pos=i+1,j=0;j<gnrl_list.size();j++){if(pos==(g=gnrl_list.at(j)).position){(exp=net.User_General_Exp).gnrl_id=g.gnrl_id,exp.gnrl_num=g.gnrl_num,exp.gnrl_level=g.gnrl_level,exp.gnrl_exp=g.exp,(gnrl=new BattleResultGeneral_V2).setData(g,exp,g.position),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl),is_exist=!0;break}}if(!is_exist){var gnrl,g=new BattleGeneral(0),exp=net.User_General_Exp;g.gnrl_id=0,(gnrl=new BattleResultGeneral_V2).setData(g,exp,pos),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl)}}},appearGainBonus:function(){var mt=MasterManager.getInstance(),offset_y=443,boxSize=cc.size(295,38);if(this.m_game_type==db.BattleGameType.RaidDungeon)for(var i=0;i<this.m_raid_boss_result.raid_boss_reward_list.length;i++){var r=this.m_raid_boss_result.raid_boss_reward_list[i],box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box.png",RectZero());box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box.setPosition(106,offset_y),box.setPreferredSize(boxSize),this.m_result_layer.addChild(box);var title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2013);title.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),title.setPosition(12,.5*boxSize.height),box.addChild(title),1==r.raid_boss_reward_type?title.setString(mt.get_LanguageData("label_raid_boss_result_reward_type_1")):2==r.raid_boss_reward_type?title.setString(mt.get_LanguageData("label_raid_boss_result_reward_type_2")):3==r.raid_boss_reward_type&&title.setString(mt.get_LanguageData("label_raid_boss_result_reward_type_3"));var icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_pt_small_2.png");icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),icon.setPosition(176,0),box.addChild(icon);var count=cmLabel.getLabel("x"+r.bonus_count,LABEL_FONT_INDEX.FONT_227);count.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),count.setPosition(boxSize.width-10,.5*boxSize.height),box.addChild(count),offset_y-=43}else if(this.m_game_type==db.BattleGameType.NewRaidBossDungeon){for(var gain_item_list=[],idx=0;idx<this.m_new_raid_boss_result.reward_items.length;idx++){var b=this.m_new_raid_boss_result.reward_items[idx];if(b.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_MAKE_MATERIAL)(item=$.extend({},db.BattleGainItem)).item_type=database.BattleGainItemType.NewEquipmentMakeMaterial,item.item_id=BONUS_TYPE_NEW_EQUIPMENT_MAKE_MATERIAL,item.item_level=b.bonus_idx,item.item_count=b.bonus_level,gain_item_list.push_back(item);else if(b.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_SMELT_MATERIAL){(item=$.extend({},db.BattleGainItem)).item_type=database.BattleGainItemType.NewEquipmentSmeltMaterial,item.item_id=BONUS_TYPE_NEW_EQUIPMENT_SMELT_MATERIAL,item.item_level=b.bonus_idx,item.item_count=b.bonus_level,gain_item_list.push_back(item)}else if(b.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_ENHANCE_MATERIAL){(item=$.extend({},db.BattleGainItem)).item_type=database.BattleGainItemType.NewEquipmentEnhanceMaterial,item.item_id=BONUS_TYPE_NEW_EQUIPMENT_ENHANCE_MATERIAL,item.item_level=b.bonus_idx,item.item_count=b.bonus_level,gain_item_list.push_back(item)}else if(b.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_ENCHANT_TICKET){(item=$.extend({},db.BattleGainItem)).item_type=database.BattleGainItemType.NewEquipmentEnchantTicket,item.item_id=BONUS_TYPE_NEW_EQUIPMENT_ENCHANT_TICKET,item.item_level=b.bonus_idx,item.item_count=b.bonus_level,gain_item_list.push_back(item)}else if(b.bonus_type==BONUS_TYPE_NEW_RAID_BOSS_POINT){(item=$.extend({},db.BattleGainItem)).item_type=database.BattleGainItemType.NewRaidBossPoint,item.item_id=BONUS_TYPE_NEW_RAID_BOSS_POINT,item.item_level=b.bonus_idx,item.item_count=b.bonus_level,item.gnrl_group=this.m_new_raid_boss_result.new_raid_boss_period_idx,gain_item_list.push_back(item)}}var viewSize=cc.size(420,98),container_width=72*gain_item_list.size();container_width<viewSize.width&&(container_width=viewSize.width),this.m_scroll_container=new cc.Layer,this.m_scroll_container.ignoreAnchorPointForPosition(!1),this.m_scroll_container.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_scroll_container.setContentSize(container_width,98),this.m_scroll_container.setPosition(ZERO()),this.m_scroll_arrow_left=new cc.Sprite(RES_CDN_DEFULT+"common/img_scroll_arrow.png"),this.m_scroll_arrow_left.setFlippedX(!0),this.m_scroll_arrow_left.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_scroll_arrow_left.setPosition(LP(this,20,1+.5*viewSize.height)),this.m_result_layer.addChild(this.m_scroll_arrow_left),this.m_scroll_arrow_right=new cc.Sprite(RES_CDN_DEFULT+"common/img_scroll_arrow.png"),this.m_scroll_arrow_right.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_scroll_arrow_right.setPosition(LP(this,20+viewSize.width,1+.5*viewSize.height)),this.m_result_layer.addChild(this.m_scroll_arrow_right),this.m_scroll_container.scrollViewDidScroll=function(view){}.bind(this),this.m_scroll_container.scrollViewDidZoom=function(){},this.m_scroll_view=new cc.ScrollView(viewSize,this.m_scroll_container),this.m_scroll_view.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_scroll_view.setPosition(LP(this,20,1)),this.m_scroll_view.setDirection(cc.SCROLLVIEW_DIRECTION_HORIZONTAL),this.m_result_layer.addChild(this.m_scroll_view),this.m_scroll_view.setContentOffset(cc.p(0,0),!1);for(var offset_x=2,j=0;j<gain_item_list.size();j++){var item,d=gain_item_list.at(j);(item=new BattleMissionResultGetItem_V2(d,this.addTooltip.bind(this),this.removeTooltip.bind(this))).setPosition(offset_x,15),this.m_scroll_container.addChild(item),this.m_gain_items.push_back(item),offset_x+=72}this.scheduleOnce(function(){if(0<this.m_gain_items.size()){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_battle_item_get.mp3";audio.playEffect(path)}for(var i=0;i<this.m_gain_items.size();i++){this.m_gain_items.at(i).openBox()}}.bind(this),1.5,"open_box")}},appearButtons:function(){var winSize=cc.director.getWinSize(),container=new cc.Node;if(this.m_is_win?(container.setPosition(winSize.width-10,-130),this.m_result_layer.addChild(container)):(container.setPosition(.5*winSize.width,-60),this.m_win_lose_layer.addChild(container)),this.m_game_type==db.BattleGameType.NewRaidBossDungeon?this.createBtnNewRaidBoss(container):this.m_game_type==db.BattleGameType.RaidDungeon&&this.createBtnRaidBoss(container),this.m_is_win){var delay=cc.delayTime(2.5),move=cc.moveBy(.5,cc.p(0,140)),cb=cc.callFunc(this.cbAppearButtons,this),seq=cc.sequence(delay,move,cb);container.runAction(seq)}else{delay=cc.delayTime(1),move=cc.moveBy(.3,cc.p(0,200)),cb=cc.callFunc(this.cbAppearButtons,this),seq=cc.sequence(delay,move,cb);container.runAction(seq)}this.enable_touch_partner=!0},cbAppearButtons:function(){},createBtnNewRaidBoss:function(container){cc.director.getWinSize();var mt=MasterManager.getInstance(),offset_x=0;if(BattleContext._getInstance().IsBattleDungeonContinue())(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearNewRaidBoss(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn);else if(this.m_is_win){(btn=this.createButton(mt.get_LanguageData("btn_label_confirm"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearNewRaidBoss(),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1),SceneManager.getInstance().reservedHistoryClearToScene(scene_NewRaidBossEntranceScene),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.new_raid_boss_entrance_go)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("new_raidboss_battle_stage_button_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearNewRaidBoss(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("new_raidboss_battle_stage_button_list"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearNewRaidBoss(),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1),SceneManager.getInstance().reservedHistoryClearToScene(scene_NewRaidBossEntranceScene),context.setNewRaidBossTabIndex(NEW_RAID_BOSS_TAB_PARTIN),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.new_raid_boss_dungeon_list_go)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn);var user_id=m_user_id;if(this.m_new_raid_boss_result.discovered_user_id==user_id)(btn=this.createButton(mt.get_LanguageData("new_raidboss_battle_stage_button_summon"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearNewRaidBoss(),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1),this.showCallNewRaidBossPopup()}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn)}else{var btn;offset_x=222,(btn=this.createButton(mt.get_LanguageData("btn_label_retry_mussang"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearNewRaidBoss(),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1);var service=NewRaidBossService.getInstance(),boss_data=service.GetCurrentBoss();boss_data.boss_data_list.clear();for(var assign_idx=0;assign_idx<this.m_new_raid_boss_result.boss_data_list.length;assign_idx++)boss_data.boss_data_list.push(this.m_new_raid_boss_result.boss_data_list[assign_idx]);service.SetCurrentBoss(boss_data),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.new_raid_boss_dungeon_battle_retry)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("label_raid_boss_history"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearNewRaidBoss(),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1),SceneManager.getInstance().reservedHistoryClearToScene(scene_NewRaidBossEntranceScene),context.setNewRaidBossTabIndex(NEW_RAID_BOSS_TAB_PARTIN),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.new_raid_boss_dungeon_list_go)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_label_event_shop"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearNewRaidBoss(),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1),SceneManager.getInstance().reservedHistoryClearToScene(scene_NewRaidBossEntranceScene),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.new_raid_boss_entrance_go)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearNewRaidBoss(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn)}},createBtnRaidBoss:function(container){cc.director.getWinSize();var mt=MasterManager.getInstance(),offset_x=0;if(BattleContext._getInstance().IsBattleDungeonContinue())this.m_is_win?(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearRaidBoss(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this)):((btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn.addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearRaidBoss(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1),context.setBattleDungeonContinue(!1)}.bind(this))),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn);else if(this.m_is_win){if(BattleContext._getInstance().getRaidBossStartTabIndex()==RAID_BOSS_TAB_CALL)(btn=this.createButton(mt.get_LanguageData("label_raid_boss_call_next_level_boss"))).addClickEventListener(function(sender){BattleContext._getInstance().clearRaidBoss(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_raid_boss_call_next_level_boss);var mt_boss=MasterManager.getInstance().get_RaidBossInfo(this.m_raid_boss_result.raid_boss_info.raid_boss_info_idx);BattleContext._getInstance().setRaidBossNextLevelElementType(mt_boss.element_type),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,60),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("label_raid_boss_call"))).addClickEventListener(function(sender){BattleContext._getInstance().clearRaidBoss(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_raid_boss_boss_list),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,60),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn);offset_x=0,(btn=this.createButton(mt.get_LanguageData("label_raid_boss_btn_raid_main"))).addClickEventListener(function(sender){BattleContext._getInstance().clearRaidBoss(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_raid_boss_raid_main),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearRaidBoss(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn)}else{var btn,e_service=EventDungeonService.getInstance();e_service.getFirstEventDungeonPeriodIdx();0!=e_service.getSecondEventDungeonPeriodIdx()&&!0,offset_x=166.5,(btn=this.createButton(mt.get_LanguageData("btn_combat_result_retry"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.setRaidBossData(this.m_raid_boss_result.raid_boss_info),context.clearForRetry(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_raid_boss_retry),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("label_raid_boss_btn_raid_main"))).addClickEventListener(function(sender){BattleContext._getInstance().clearRaidBoss(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_raid_boss_raid_main),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn),(btn=this.createButton(mt.get_LanguageData("btn_battle_result_home"))).addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearRaidBoss(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],NOTIFY_MENU_HOME),this.setEnableBtns(!1)}.bind(this)),btn.setPosition(offset_x,0),container.addChild(btn),offset_x-=ccWidth(btn),this.m_btn_list.push_back(btn)}},createButton:function(btn_label,use_big_btn){var off="btn_01_off.png",on="btn_01_on.png";null==use_big_btn&&(use_big_btn=!1),1==use_big_btn&&(off="btn_07_off.png",on="btn_07_on.png");var label,btn=new ccui.Button;(btn.loadTextures(off,on,"",ccui.Widget.PLIST_TEXTURE),btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),btn_label==res_str("label_raid_boss_call_next_level_boss"))?((label=cmLabel.getLabel(btn_label,LABEL_FONT_INDEX.FONT_181)).setAnchorPoint(ANCHOR_MIDDLE()),label.setPosition(btn.getContentSize().width/2,btn.getContentSize().height/2)):((label=cmLabel.getLabel(btn_label,LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_MIDDLE()),label.setPosition(btn.getContentSize().width/2,btn.getContentSize().height/2));return btn.addChild(label),btn},voicePlay:function(voice_type){var partner_id=GeneralService.getInstance().getUserTroopsPartnerId(),voice_list=MasterTable.getInstance().get_Voice(partner_id,voice_type,{}),voice=voice_list.voice,duration=voice_list.duration;if(voice&&""!=voice){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3";audio.playVoice(path),this.m_is_voice_playing=!0,this.m_voice_playing_delta=duration}},partnerAnimation:function(){if(null!=this.m_partner_gnrl){this.m_partner_gnrl.isRunning()&&(this.m_partner_gnrl.stopAllActions(),this.m_partner_gnrl.setPosition(MAIN_POS(this,this.m_bp.posx,this.m_bp.posy)));var s1=new cc.ScaleTo(.1,this.m_img_scale+.03,this.m_img_scale-.03),s2=new cc.ScaleTo(.2,this.m_img_scale-.03,this.m_img_scale+.03),s3=new cc.ScaleTo(.15,this.m_img_scale+.02,this.m_img_scale-.02),s4=new cc.ScaleTo(.8,this.m_img_scale,this.m_img_scale),e4=new cc.EaseElasticOut(s4),seq=new cc.Sequence(s1,s2,s3,e4);this.m_partner_gnrl.runAction(seq)}null!=this.m_skeletonNode&&(this.m_skeletonNode.setAnimation(0,"active",!1),this.m_skeletonNode.addAnimation(0,"basic",!0)),this.m_is_voice_playing||this.voicePlay(voice_main_body_touch)},reShowNewRaidBossSharedPopup:function(){var boss={};boss.new_raid_boss_period_idx=this.m_new_raid_boss_result.new_raid_boss_period_idx,boss.new_raid_boss_dungeon_info_idx=this.m_new_raid_boss_result.new_raid_boss_dungeon_info_idx,boss.boss_num=this.m_new_raid_boss_result.boss_num,this.showNewRaidBossSharedPopup(boss)},showNewRaidBossSharedPopup:function(boss){this.m_shared_modal_layer._contentNode=function(contentSize,m){var layer=new cc.Layer,popup=new RaidBossSharedPopupLayer;return popup.setNewRaidBossData(boss),popup._callback_close_popup=this.hideRaidBossSharedPopup.bind(this),popup._callback_new_raid_shared=this.reqNewRaidBossHelp.bind(this),layer.setContentSize(popup.getContentSize()),layer.setPosition(this.getContentSize().width/2,this.getContentSize().height/2),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),layer.addChild(popup),popup.setPosition(ccCenter(layer)),this.m_shared_modal_layer.setContentSize(layer.getContentSize()),layer}.bind(this),this.m_shared_modal_layer.is_show()||this.m_shared_modal_layer.show()},hideNewRaidBossSharedPopup:function(){this.m_shared_modal_layer.is_show()&&this.m_shared_modal_layer.hide()},reqNewRaidBossHelp:function(boss,shared_type){var req={};req.opcode=net.OP.op_new_raid_boss_dungeon_help,req.new_raid_boss_period_idx=boss.new_raid_boss_period_idx,req.new_raid_boss_dungeon_info_idx=boss.new_raid_boss_dungeon_info_idx,req.boss_num=boss.boss_num,req.shared_type=shared_type;var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent),this.hideNewRaidBossSharedPopup()},reshowRaidBossSharedPopup:function(){this.showRaidBossSharedPopup(this.m_raid_boss_result.raid_boss_info)},showRaidBossSharedPopup:function(boss){this.m_shared_modal_layer._contentNode=function(contentSize,m){var layer=new cc.Layer,popup=new RaidBossSharedPopupLayer;return popup.setRaidBossData(boss),popup._callback_close_popup=this.hideRaidBossSharedPopup.bind(this),popup._callback_shared=this.reqRaidBossShared.bind(this),layer.setContentSize(popup.getContentSize()),layer.setPosition(.5*this.getContentSize().width,.5*this.getContentSize().height),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),layer.addChild(popup),popup.setPosition(ccCenter(layer)),this.m_shared_modal_layer.setContentSize(layer.getContentSize()),layer}.bind(this),this.m_shared_modal_layer.is_show()||this.m_shared_modal_layer.show()},hideRaidBossSharedPopup:function(){this.m_shared_modal_layer.is_show()&&this.m_shared_modal_layer.hide()},reqRaidBossShared:function(boss,shared_type){var req={};req.opcode=net.OP.op_raid_boss_shared,req.discovered_user_id=boss.discovered_user_id,req.raid_boss_period_idx=boss.raid_boss_period_idx,req.raid_boss_num=boss.raid_boss_num,req.shared_type=shared_type;var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent),this.hideRaidBossSharedPopup()},setEnableBtns:function(isEnable){for(var i=0;i<this.m_btn_list.size();i++){this.m_btn_list.at(i).setEnabled(isEnable)}},showMaxDungeonListPopup:function(){MasterManager.getInstance();this.m_msg_box.setTitle(res_str("new_raidboss_standby_attack_cannot_pop_up_title")),this.m_msg_box.setText(cmString(res_str("new_raidboss_main_boss_summon_cannot_pop_up_text1"),m.get_CountFunction(55).value)),this.m_msg_box.setText("\n"),this.m_msg_box.setText(res_str("new_raidboss_standby_attack_cannot_pop_up_text2")),this.m_msg_box.setText("\n"),this.m_msg_box.addButtonInfo(new MessageButtonInfo(res_str("label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(){this.m_msg_box.hide(!1)},0,"msg_box_hide")}.bind(this))),this.m_msg_box.show()},showNotEnoughCallTicketPopup:function(){this.m_msg_box.setTitle(res_str("new_raidboss_main_boss_summon_key_lack_pop_up_title")),this.m_msg_box.setText(res_str("new_raidboss_main_boss_summon_key_lack_pop_up_text1")),this.m_msg_box.setText("\n"),this.m_msg_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(){this.m_msg_box.hide(!1)},0,"msg_box_hide")}.bind(this))),this.m_msg_box.show()},showCallNewRaidBossPopup:function(){NewRaidBossService.getInstance();var m=MasterManager.getInstance(),max_partin_dungeon_count=m.get_CountFunction(55).value,partin_dungeon_list=NetService().get_New_Raid_Boss_Dungeon_List(),found_list=partin_dungeon_list.findIndex(function(list){return 1==list.request_type&&list.new_raid_boss_period_idx==this.m_new_raid_boss_result.new_raid_boss_period_idx}.bind(this));if(-1!=found_list&&partin_dungeon_list[found_list].user_new_raid_boss_list.size()>=max_partin_dungeon_count)return this.showMaxDungeonListPopup(),void this.setEnableBtns(!0);var info=NetService().get_UserItemInfo_V2(),dungeon=NetService().getNewRaidBossDungeonData(4,this.m_new_raid_boss_result.discovered_user_id,this.m_new_raid_boss_result.new_raid_boss_period_idx,this.m_new_raid_boss_result.new_raid_boss_dungeon_info_idx,this.m_new_raid_boss_result.boss_num);if(0!=dungeon.new_raid_boss_period_idx){var dungeon_data=m.get_NewRaidBossDungeonInfo(dungeon.new_raid_boss_dungeon_info_idx);if(0!=dungeon_data.new_raid_boss_dungeon_info_idx&&dungeon_data.need_spawn_key>info.new_raid_call_ticket_cnt)return this.showNotEnoughCallTicketPopup(),void this.setEnableBtns(!0);this.m_msg_box.setTitle(res_str("new_raidboss_main_boss_discovery_pop_up_title")),this.m_msg_box.setText(cmString(res_str("new_raidboss_main_boss_discovery_pop_up_text1"),dungeon_data.need_spawn_key)),this.m_msg_box.setText("\n"),this.m_msg_box.setText(res_str("new_raidboss_main_boss_discovery_pop_up_text2")),this.m_msg_box.setText("\n"),this.m_msg_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.setEnableBtns(!0),this.scheduleOnce(function(float){this.m_msg_box.hide()},0,"msg_box_hide")}.bind(this))),this.m_msg_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.callNewRaidBoss(dungeon_data),this.setEnableBtns(!0),this.scheduleOnce(function(float){this.m_msg_box.hide()},.1,"msg_box_hide")}.bind(this))),this.m_msg_box.show()}},callNewRaidBoss:function(data){var req={};req.opcode=net.OP.op_new_raid_boss_call,req.new_raid_boss_period_idx=data.new_raid_boss_period_idx,req.new_raid_boss_dungeon_info_idx=data.new_raid_boss_dungeon_info_idx;var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent)},addTooltip:function(world_pos,tooltip,title,content){if(null!=this.m_tooltip_box)return!1;this.m_tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.m_tooltip_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_tooltip_box.setPosition(world_pos),this.m_tooltip_box.setVisible(!0),this.addChild(this.m_tooltip_box);var tooltip_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1810);tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_tooltip_box.addChild(tooltip_title);var tooltip_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181);if(tooltip_content.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_tooltip_box.addChild(tooltip_content),tooltip_title.setString(title),tooltip_content.setString(content),""!=content){var tSize=ccSize(tooltip_title),cSize=ccSize(tooltip_content);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(tSize.width+20,cSize.width+20),bSize.height=Math.max(64,bSize.height+cSize.height+5),this.m_tooltip_box.setContentSize(tooltip._contentSize),this.m_tooltip_box.setPreferredSize(bSize),tooltip_title.setPosition(10,bSize.height-10),tooltip_content.setPosition(10,bSize.height-15-tSize.height);var offset=world_pos.x-bSize.width/2;if(offset<0){var new_pos=cc.p(world_pos.x+Math.abs(offset),world_pos.y);this.m_tooltip_box.setPosition(new_pos),tooltip_title.setPosition(10,bSize.height-10),tooltip_content.setPosition(10,bSize.height-15-tSize.height)}}else{tooltip_title.setAnchorPoint(ANCHOR_MIDDLE());var bSize;tSize=ccSize(tooltip_title);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(64,tSize.width+20),bSize.height=Math.max(54,bSize.height+10),this.m_tooltip_box.setPreferredSize(bSize),tooltip_title.setPosition(ccCenter(bSize))}},removeTooltip:function(){this.removeChild(this.m_tooltip_box),this.m_tooltip_box=null}}),BattleCutinWarningLayer=cc.Layer.extend({m_top_bar:null,m_warning_image:null,m_move_node:null,m_failed_image:null,m_boss_image:null,m_notification_msg:0,m_gnrl_group:0,ctor:function(gnrl_group,bStart){this._super(),this.init(gnrl_group,bStart)},init:function(gnrl_group,bStart){this.m_gnrl_group=gnrl_group,this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var winSize=ccSize(this);if(this.m_top_bar=new cc.LayerColor(cc.color.RED),this.m_top_bar.setContentSize(winSize),this.m_top_bar.ignoreAnchorPointForPosition(!1),this.m_top_bar.setAnchorPoint(ANCHOR_MIDDLE()),this.m_top_bar.setPosition(ccCenter(winSize)),this.m_top_bar.setOpacity(0),this.addChild(this.m_top_bar),0!=gnrl_group){var path="";path=gnrl_group<100?RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(gnrl_group,2)+".png":RES_CDN_DEFULT+"card_war_boss/"+gnrl_group+".png",resourceLoader(path,function(){this.m_boss_image=new cc.Sprite(path),this.m_boss_image.setScale(2),this.m_boss_image.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_boss_image.setPosition(winSize.width+ccWidth(this.m_boss_image),.5*winSize.height),this.addChild(this.m_boss_image),bStart&&this.scheduleOnce(function(float){this.startAnimation()},.3,"1")}.bind(this))}return this.m_warning_image=new cc.Sprite,this.m_warning_image.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_warning_image.setPosition(0,.5*winSize.height),this.addChild(this.m_warning_image),this.m_failed_image=new cc.Sprite,this.m_failed_image.setAnchorPoint(ANCHOR_MIDDLE()),this.m_failed_image.setPosition(ccCenter(winSize)),this.addChild(this.m_failed_image),!0},startAnimation:function(){this.m_top_bar.isRunning()&&this.m_top_bar.stopAllActions();var winSize=cc.director.getWinSize(),time_scale=3==GameDefault.getInstance().getUserBattleGameSpeed()?.5:1;this.m_top_bar.setOpacity(0),this.m_warning_image.setVisible(!0),this.m_failed_image.setVisible(!1);var f1=new cc.FadeTo(.35*time_scale,180),f2=new cc.FadeTo(.35*time_scale,10),f_seq=new cc.Sequence(f1,f2),repeat=new cc.Repeat(f_seq,4);if(this.m_top_bar.runAction(repeat),repeat=f_seq=f2=f1=null,NOT_USE_SP_BATTLE_ANIMATION){this.m_warning_image.setScale(3),this.m_warning_image.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_warning_12.png");var scaleTo_1=new cc.ScaleTo(.3,3,3),scaleTo_2=new cc.ScaleTo(.3,2,2),sequence=new cc.Sequence(scaleTo_1,scaleTo_2);delay=new cc.DelayTime(2*time_scale),pos=this.m_warning_image.getPosition(),moveout=new cc.MoveTo(.5*time_scale,cc.p(-800,pos.y)),ease=new cc.EaseExponentialInOut(moveout),cb=new cc.CallFunc(this.cbStartAnimation.bind(this)),seq=new cc.Sequence(sequence,delay,ease,cb);this.m_warning_image.runAction(seq),seq=cb=ease=moveout=pos=delay=sequence=scaleTo_2=scaleTo_1=null}else{var ani=BattleAni._getInstance().getAnimate(BattleAni_.EffectCutinWarning),delay=new cc.DelayTime(2*time_scale),pos=this.m_warning_image.getPosition(),moveout=new cc.MoveTo(.5*time_scale,cc.p(-800,pos.y)),ease=new cc.EaseExponentialInOut(moveout),cb=new cc.CallFunc(this.cbStartAnimation.bind(this)),seq=new cc.Sequence(ani,delay,ease,cb);this.m_warning_image.runAction(seq),seq=cb=ease=moveout=pos=delay=ani=null}if(0!=this.m_gnrl_group){var pos2=this.m_boss_image.getPosition(),movein=new cc.MoveTo(.5*time_scale,cc.p(winSize.width,pos2.y)),easein=new cc.EaseExponentialInOut(movein),delay02=new cc.DelayTime(2.4*time_scale),moveout2=new cc.MoveTo(.5*time_scale,cc.p(winSize.width+ccWidth(this.m_boss_image),pos2.y)),easeout=new cc.EaseExponentialInOut(moveout2),seq2=new cc.Sequence(easein,delay02,easeout);this.m_boss_image.runAction(seq2)}var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/cutinbattle_siren.mp3";audio.playEffect(path)},cbStartAnimation:function(){MainObserver.getInstance().postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.battle_cutin_warning_after_new_stage)},showCutinStageEnd:function(noti_msg){var winSize=cc.director.getWinSize(),time_scale=3==GameDefault.getInstance().getUserBattleGameSpeed()?.5:1;if(this.m_notification_msg=noti_msg,this.m_top_bar.setOpacity(0),this.m_warning_image.setVisible(!1),this.m_failed_image.setVisible(!0),NOT_USE_SP_BATTLE_ANIMATION){this.m_failed_image.setScale(3),this.m_failed_image.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_timeout_09.png");delay=new cc.DelayTime(2*time_scale);var scaleTo_1=new cc.ScaleTo(.3,3,3),scaleTo_2=new cc.ScaleTo(.3,2,2);cb=new cc.CallFunc(this.cbShowFailedCutinStage.bind(this)),seq=new cc.Sequence(scaleTo_1,scaleTo_2,delay,cb);this.m_failed_image.runAction(seq),seq=cb=scaleTo_2=scaleTo_1=delay=null}else{var ani=BattleAni._getInstance().getAnimate(BattleAni_.EffectCutinFailed),delay=new cc.DelayTime(2*time_scale),cb=new cc.CallFunc(this.cbShowFailedCutinStage.bind(this)),seq=new cc.Sequence(ani,delay,cb);this.m_failed_image.runAction(seq),seq=cb=delay=ani=null}var pos=this.m_boss_image.getPosition(),movein=new cc.MoveTo(.5*time_scale,cc.p(winSize.width,pos.y)),easein=new cc.EaseExponentialInOut(movein),delay02=new cc.DelayTime(1.9*time_scale),moveout=new cc.MoveTo(.5*time_scale,cc.p(winSize.width+ccWidth(this.m_boss_image),pos.y)),easeout=new cc.EaseExponentialInOut(moveout),seq2=new cc.Sequence(easein,delay02,easeout);this.m_boss_image.runAction(seq2)},cbShowFailedCutinStage:function(){MainObserver.getInstance().postNotification(sceneStr[scene_BattleScene],this.m_notification_msg)}}),BattleRaidBossLifeGaugeBar=cc.Node.extend({m_fill_bar:null,m_is_gauging:!1,m_gauge_label:null,m_boss_name:null,m_element_icon:null,m_percent_list:null,m_skill_cooltime_bar:null,ctor:function(){this._super(),this.m_percent_list=new Array,this.init()},onExit:function(){this._super(),this.removeAllChildrenWithCleanup(!0),this.m_fill_bar=null,this.m_is_gauging=!1,this.m_gauge_label=null,this.m_boss_name=null,this.m_element_icon=null,this.m_percent_list=null,this.m_skill_cooltime_bar=null,delete this.m_fill_bar,delete this.m_is_gauging,delete this.m_gauge_label,delete this.m_boss_name,delete this.m_element_icon,delete this.m_percent_list,delete this.m_skill_cooltime_bar},init:function(){var boxSize=cc.size(480,26);this.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.setContentSize(boxSize);var bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_gauge.png");bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(boxSize)),this.addChild(bg),this.m_element_icon=cc.Sprite.create("#img_battletech_1.png"),this.m_element_icon.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_element_icon.setPosition(153,-32),this.addChild(this.m_element_icon),this.m_boss_name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_201),this.m_boss_name.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_boss_name.setPosition(191,-32),this.addChild(this.m_boss_name),this.m_fill_bar=new cc.ProgressTimer(cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_gauge_red_3.png")),this.m_fill_bar.setAnchorPoint(ANCHOR_MIDDLE()),this.m_fill_bar.setMidpoint(ANCHOR_TOP_LEFT()),this.m_fill_bar.setBarChangeRate(cc.p(1,0)),this.m_fill_bar.setPosition(ccCenter(bg)),this.m_fill_bar.setType(cc.ProgressTimer.TYPE_BAR),this.m_fill_bar.setPercentage(100),bg.addChild(this.m_fill_bar),this.m_gauge_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_gauge_label.enableOutline(cc.color.BLACK,1),this.m_gauge_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_gauge_label.setPosition(.5*boxSize.width,.5*boxSize.height+2),bg.addChild(this.m_gauge_label);var skill_gauge_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_gauge_skill.png");return skill_gauge_bg.setAnchorPoint(ANCHOR_MIDDLE_TOP()),skill_gauge_bg.setPosition(.5*boxSize.width,-1),bg.addChild(skill_gauge_bg),this.m_skill_cooltime_bar=new cc.ProgressTimer(cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_gauge_green.png")),this.m_skill_cooltime_bar.setAnchorPoint(ANCHOR_MIDDLE()),this.m_skill_cooltime_bar.setMidpoint(ANCHOR_MIDDLE_LEFT()),this.m_skill_cooltime_bar.setBarChangeRate(cc.p(1,0)),this.m_skill_cooltime_bar.setPosition(ccCenter(skill_gauge_bg)),this.m_skill_cooltime_bar.setType(cc.ProgressTimer.TYPE_BAR),this.m_skill_cooltime_bar.setPercentage(0),skill_gauge_bg.addChild(this.m_skill_cooltime_bar),!0},setPercentageSkillCooltime:function(cooltime_per){var percent=cc.clampf(cooltime_per,0,100);this.m_skill_cooltime_bar.setPercentage(percent)},setPercentageLife:function(cur_life,animate){this.m_percent_list=[];var percent=cur_life/this.m_boss_data.max_hp*100;percent=cc.clampf(percent,0,100),this.m_fill_bar.setPercentage(percent),this.m_gauge_label.setString(cmString(res_str("label_raid_boss_remain_life"),parseInt(cur_life).toLocaleString("en"),this.m_boss_data.max_hp.toLocaleString("en")))},setRaidBossGeneral:function(gnrl){gnrl._raid_boss_skill_cooltime=this},setRaidBossData:function(data){this.m_boss_data=data,this.updateLayout()},updateLayout:function(){var boss=MasterManager.getInstance().get_RaidBossInfo(this.m_boss_data.raid_boss_info_idx),frame=cc.spriteFrameCache.getSpriteFrame(cmString("img_battletech_%d.png",boss.element_type));switch(this.m_element_icon.setSpriteFrame(frame),this.m_boss_name.setString(cmString(res_str("label_raid_boss_name_element"),this.m_boss_data.boss_level,boss.name)),boss.element_type){case ELEMENT_TYPE_FIRE:this.m_boss_name.setColor(cc.color(220,36,36));break;case ELEMENT_TYPE_WATER:this.m_boss_name.setColor(cc.color(77,134,241));break;case ELEMENT_TYPE_WIND:this.m_boss_name.setColor(cc.color(79,193,44));break;case ELEMENT_TYPE_LIGHT:this.m_boss_name.setColor(cc.color(225,206,77));break;case ELEMENT_TYPE_DARK:this.m_boss_name.setColor(cc.color(204,67,209))}}}),BattleNewRaidbossLifeGaugeBar=cc.Node.extend({m_fill_bar:null,m_is_gauging:!1,m_gauge_label:null,m_boss_name:null,m_percent_list:null,m_skill_icon_list:[],m_skill_bar_list:[],m_empty_heart_list:null,m_fill_heart_list:null,m_boss_data:null,m_boss_head:null,m_battle_general:null,m_life_count:0,ctor:function(){this._super(),this.m_percent_list=new Array,this.init()},onExit:function(){this._super(),this.removeAllChildrenWithCleanup(!0),this.m_fill_bar=null,this.m_is_gauging=!1,this.m_gauge_label=null,this.m_boss_name=null,this.m_percent_list=null,this.m_skill_icon_list=null,this.m_skill_bar_list=null,this.m_empty_heart_list=null,this.m_fill_heart_list=null,this.m_boss_data=null,this.m_boss_head=null,this.m_battle_general=null,delete this.m_fill_bar,delete this.m_is_gauging,delete this.m_gauge_label,delete this.m_boss_name,delete this.m_percent_list,delete this.m_skill_icon_list,delete this.m_skill_bar_list,delete this.m_empty_heart_list,delete this.m_fill_heart_list,delete this.m_boss_data,delete this.m_boss_head,delete this.m_battle_general},init:function(){this.m_empty_heart_list=[],this.m_fill_heart_list=[],this.m_skill_bar_list=[],this.m_skill_icon_list=[];var boxSize=cc.size(204,167);this.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.setContentSize(boxSize);var head=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_raid2/img_raid2_tumb_small2_1.png");head.setAnchorPoint(ANCHOR_TOP_LEFT()),head.setPosition(0,boxSize.height),this.addChild(head),this.m_boss_head=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_raid2/img_raid2_tumb_small2_1.png"),this.m_boss_head.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_boss_head.setPosition(0,boxSize.height),this.addChild(this.m_boss_head);for(var heart_offset_x=65,heart_offset_y=boxSize.height-12,i=0;i<5;i++){var empty_heart=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_heart_off.png");empty_heart.setAnchorPoint(ANCHOR_TOP_LEFT()),empty_heart.setPosition(heart_offset_x,heart_offset_y),this.addChild(empty_heart);var fill_heart=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_heart_on.png");fill_heart.setAnchorPoint(ANCHOR_MIDDLE()),fill_heart.setPosition(ccCenter(empty_heart)),empty_heart.addChild(fill_heart),empty_heart.setScale(.6),this.m_empty_heart_list.push_back(empty_heart),this.m_fill_heart_list.push_back(fill_heart),heart_offset_x+=25}var life_bar_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_gauge_3.png",cc.Rect(15,20,1,1));life_bar_bg.setPreferredSize(cc.size(204,30)),life_bar_bg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),life_bar_bg.setPosition(.5*boxSize.width,97),this.addChild(life_bar_bg),this.m_fill_bar=new cc.ProgressTimer(cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_gauge_red_3_2.png")),this.m_fill_bar.setAnchorPoint(ANCHOR_MIDDLE()),this.m_fill_bar.setMidpoint(ANCHOR_MIDDLE_LEFT()),this.m_fill_bar.setBarChangeRate(cc.p(1,0)),this.m_fill_bar.setPosition(ccCenter(life_bar_bg)),this.m_fill_bar.setType(cc.ProgressTimer.TYPE_BAR),this.m_fill_bar.setPercentage(100),life_bar_bg.addChild(this.m_fill_bar);var bg_size=cc.size(life_bar_bg);this.m_gauge_label=cmLabelEx.getLabel("9,999/9,999",LABEL_FONT_INDEX.FONT_1471,!1,!0,1,cc.color.BLACK),this.m_gauge_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_gauge_label.setPosition(.5*bg_size.width,bg_size.height),life_bar_bg.addChild(this.m_gauge_label);var skill_offset_y=66;for(i=0;i<3;i++){var bar_bg=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_gauge_4.png");bar_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bar_bg.setPosition(0,skill_offset_y),this.addChild(bar_bg);var skill_icon=cc.Sprite.create("#active_1110031.png");skill_icon.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),skill_icon.setPosition(14,ccCenter(bar_bg).y),skill_icon.setScale(.5),bar_bg.addChild(skill_icon),this.m_skill_icon_list.push_back(skill_icon);var skill_bar=new cc.ProgressTimer(cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_gauge_green_2_2.png"));skill_bar.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),skill_bar.setMidpoint(ANCHOR_MIDDLE_LEFT()),skill_bar.setBarChangeRate(cc.p(1,0)),skill_bar.setPosition(46,ccCenter(bar_bg).y),skill_bar.setType(cc.ProgressTimer.TYPE_BAR),skill_bar.setPercentage(0),bar_bg.addChild(skill_bar),this.m_skill_bar_list.push_back(skill_bar),skill_offset_y-=33}return!0},setNewRaidBossData:function(data){this.m_boss_data=data,this.updateAddLifeCount(this.m_boss_data.add_life_count)},setNewRaidBossGeneralData:function(gnrl){this.m_battle_general=gnrl,this.updateLayout()},updateAddLifeCount:function(life_count){this.m_life_count=life_count;for(var i=0;i<this.m_empty_heart_list.length;i++)this.m_empty_heart_list[i].setVisible(i<this.m_life_count)},updateLayout:function(){this.setPercentageLife(this.m_boss_data.add_life_count,this.m_boss_data.remain_hp,this.m_boss_data.max_hp,!1);for(var i=0;i<this.m_battle_general.active_skill.length;i++)if(i<this.m_skill_icon_list.length){var skill_icon=this.m_skill_icon_list[i],active_skill=this.m_battle_general.active_skill[i],skill_name=cmString("active_%d.png",active_skill.skill.skill_group),skill_frame=cc.spriteFrameCache.getSpriteFrame(skill_name);skill_icon.setSpriteFrame(skill_frame)}},isBossIdx:function(boss_idx){return 0!=this.m_boss_data.boss_idx&&this.m_boss_data.boss_idx==boss_idx},setPercentageLife:function(life_count,cur_life,max_life,animate){if(null==animate&&(animate=!0),animate){var percent=cur_life/max_life*100;if(percent=cc.clampf(percent,0,100),this.m_percent_list.push_back(percent),!this.m_is_gauging){var from=this.m_fill_bar.getPercentage(),to=this.m_percent_list.shift(),duration=Math.abs(from-to)/200,ease=cc.progressFromTo(duration,from,to).clone().easing(cc.easeExponentialIn()),cb=cc.callFunc(this.cbPercentageLifeProgressEnded.bind(this)),seq=cc.sequence(ease,cb);this.m_fill_bar.runAction(seq),this.m_gauge_label.setString(cmString(res_str("label_raid_boss_remain_life"),Number(parseInt(cur_life)).toLocaleString("en"),Number(max_life).toLocaleString("en")))}}else{this.m_percent_list.length=0;percent=cur_life/max_life*100;percent=cc.clampf(percent,0,100),this.m_fill_bar.setPercentage(percent),this.m_gauge_label.setString(cmString(res_str("label_raid_boss_remain_life"),Number(parseInt(cur_life)).toLocaleString("en"),Number(max_life).toLocaleString("en")))}this.updateAddLifeCount(life_count)},cbPercentageLifeProgressEnded:function(){if(this.m_is_gauging=!1,0!=this.m_percent_list.length){var from=this.m_fill_bar.getPercentage(),to=this.m_percent_list.shift(),duration=Math.abs(from-to)/200,ease=cc.progressFromTo(duration,from,to).clone().easing(cc.easeExponentialIn()),cb=cc.callFunc(this.cbPercentageLifeProgressEnded.bind(this)),seq=cc.sequence(ease,cb);this.m_fill_bar.runAction(seq),this.m_is_gauging=!0}},setPercentageSkillCooltime:function(idx,per){var percent=cc.clampf(per,0,100);idx<this.m_skill_bar_list.size()&&this.m_skill_bar_list.at(idx).setPercentage(percent)},setNewRaidBossBattleGeneral:function(gnrl){gnrl._new_raid_boss_skill_cooltime=this}}),BattleEventDungeonMussangBossLifeGaugeBar=cc.Node.extend({m_fill_bar:null,m_skill_cooltime_bar:null,m_gauge_label:null,m_percent_list:null,m_is_gauging:null,m_element_icon:null,m_Mussnag_Boss_Name:null,m_Mussasng_Boss_Data:null,ctor:function(){this._super(),this.m_percent_list=[],this.init()},init:function(){var boxSize=cc.size(480,26);this.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.setContentSize(boxSize);var bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_gauge.png");bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(boxSize)),this.addChild(bg),this.m_element_icon=cc.Sprite.create("#img_battletech_1.png"),this.m_element_icon.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_element_icon.setPosition(153,-32),this.addChild(this.m_element_icon),this.m_Mussnag_Boss_Name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_201),this.m_Mussnag_Boss_Name.setAnchorPoint(ANCHOR_MIDDLE()),this.m_Mussnag_Boss_Name.setPosition(ccCenter(boxSize).x,-32),this.addChild(this.m_Mussnag_Boss_Name),this.m_fill_bar=new cc.ProgressTimer(cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_gauge_red_3.png")),this.m_fill_bar.setAnchorPoint(ANCHOR_MIDDLE()),this.m_fill_bar.setMidpoint(ANCHOR_TOP_LEFT()),this.m_fill_bar.setBarChangeRate(cc.p(1,0)),this.m_fill_bar.setPosition(ccCenter(bg)),this.m_fill_bar.setType(cc.ProgressTimer.TYPE_BAR),this.m_fill_bar.setPercentage(100),bg.addChild(this.m_fill_bar),this.m_gauge_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_gauge_label.enableOutline(cc.color.BLACK,1),this.m_gauge_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_gauge_label.setPosition(.5*boxSize.width,.5*boxSize.height+2),bg.addChild(this.m_gauge_label);var skill_gauge_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_gauge_skill.png");return skill_gauge_bg.setAnchorPoint(ANCHOR_MIDDLE_TOP()),skill_gauge_bg.setPosition(.5*boxSize.width,-1),bg.addChild(skill_gauge_bg),this.m_skill_cooltime_bar=new cc.ProgressTimer(cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_gauge_green.png")),this.m_skill_cooltime_bar.setAnchorPoint(ANCHOR_MIDDLE()),this.m_skill_cooltime_bar.setMidpoint(ANCHOR_MIDDLE_LEFT()),this.m_skill_cooltime_bar.setBarChangeRate(cc.p(1,0)),this.m_skill_cooltime_bar.setPosition(ccCenter(skill_gauge_bg)),this.m_skill_cooltime_bar.setType(cc.ProgressTimer.TYPE_BAR),this.m_skill_cooltime_bar.setPercentage(0),skill_gauge_bg.addChild(this.m_skill_cooltime_bar),!0},setPercentageSkillCooltime:function(cooltime_per){var percent=cc.clampf(cooltime_per,0,100);this.m_skill_cooltime_bar.setPercentage(percent)},setPercentageLife:function(cur_life,animate){if(animate){var list_idx=NetService().get_User_Mussang_Boss_list_Cnt(),percent=cur_life/this.m_Mussasng_Boss_Data.user_mussang_boss_npc_info[list_idx].max_hp*100;if(percent=cc.clampf(percent,0,100),this.m_percent_list.push_back(percent),!this.m_is_gauging){var from=this.m_fill_bar.getPercentage(),to=this.m_percent_list.shift(),duration=Math.abs(from-to)/300,ease=cc.progressFromTo(duration,from,to).clone().easing(cc.easeExponentialIn()),cb=cc.callFunc(this.cbPercentProgressEnded.bind(this)),seq=cc.sequence(ease,cb);this.m_fill_bar.runAction(seq),this.m_gauge_label.setString(cmString(res_str("label_raid_boss_remain_life"),parseInt(cur_life).toLocaleString("en"),this.m_Mussasng_Boss_Data.user_mussang_boss_npc_info[list_idx].max_hp.toLocaleString("en")))}}else{list_idx=NetService().get_User_Mussang_Boss_list_Cnt();this.m_percent_list.clear();percent=cur_life/this.m_Mussasng_Boss_Data.user_mussang_boss_npc_info[list_idx].max_hp*100;percent=cc.clampf(percent,0,100),this.m_fill_bar.setPercentage(percent),this.m_gauge_label.setString(cmString(res_str("label_raid_boss_remain_life"),parseInt(cur_life).toLocaleString("en"),this.m_Mussasng_Boss_Data.user_mussang_boss_npc_info[list_idx].max_hp.toLocaleString("en")))}},cbPercentProgressEnded:function(){if(this.m_is_gauging=!1,!this.m_percent_list.empty()){var from=this.m_fill_bar.getPercentage(),to=this.m_percent_list.pop_front(),duration=Math.abs(from-to)/300,ease=cc.progressFromTo(duration,from,to).clone().easing(cc.easeExponentialIn()),cb=cc.callFunc(this.cbPercentProgressEnded,this),seq=cc.sequence(ease,cb);this.m_fill_bar.runAction(seq),this.m_is_gauging=!0}},cbAdjustProgressEnded:function(){null!=this._lifeBarAdjustEnd&&this._lifeBarAdjustEnd(this)},setEventDungeonMussangBossData:function(data){this.m_Mussasng_Boss_Data=data,this.updateLayout()},updateLayout:function(){var m=MasterManager.getInstance(),list_idx=NetService().get_User_Mussang_Boss_list_Cnt(),boss=m.get_EventDungeonMussangBossNpcInfo(this.m_Mussasng_Boss_Data.user_mussang_boss_infos.at(list_idx).boss_dungeon_idx,1),npc_general=m.get_NpcGeneral(boss.npc1_id),hero=$.extend({},database.BattleGeneral);BattleService.getInstance().setNpcGeneralData(hero,npc_general);var dungeon_idx=this.m_Mussasng_Boss_Data.user_mussang_boss_npc_info[list_idx].boss_dungeon_idx,dungeon_period_idx=this.m_Mussasng_Boss_Data.user_mussang_boss_npc_info[list_idx].event_dungeon_period_idx,mussangboss_name=m.get_EventDungeonMussangBossInfo(dungeon_idx,dungeon_period_idx).mussang_boss_name;this.m_Mussnag_Boss_Name.setString(cmString(res_str("lavel_event_dungeon_mussang_boss_name"),mussangboss_name));var frame=cc.spriteFrameCache.getSpriteFrame(cmString("img_battletech_%d.png",hero.general.element_type));switch(this.m_element_icon.setSpriteFrame(frame),this.m_element_icon.setPosition(this.m_Mussnag_Boss_Name.getPosition().x-this.m_Mussnag_Boss_Name.getContentSize().width/2-this.m_element_icon.getContentSize().width,-32),hero.general.element_type){case ELEMENT_TYPE_FIRE:this.m_Mussnag_Boss_Name.setColor(cc.color(220,36,36));break;case ELEMENT_TYPE_WATER:this.m_Mussnag_Boss_Name.setColor(cc.color(77,134,241));break;case ELEMENT_TYPE_WIND:this.m_Mussnag_Boss_Name.setColor(cc.color(79,193,44));break;case ELEMENT_TYPE_LIGHT:this.m_Mussnag_Boss_Name.setColor(cc.color(225,206,77));break;case ELEMENT_TYPE_DARK:this.m_Mussnag_Boss_Name.setColor(cc.color(204,67,209))}},setRaidBossGeneral:function(gnrl){gnrl._mussang_boss_skill_cooltime=this}}),WORLD_WAR_DUNGEIN_RESULT_TYPE={NONE:0,WIN:1,LOSE:2,DRAW:3},BattleWorldWarDungeonResultLayer=cc.Layer.extend({m_win_lose_layer:null,m_result_layer:null,m_result_type:0,m_partner_gnrl:null,enable_touch_partner:!1,m_skeletonNode:null,m_debug_log_box:null,m_voice_id:0,m_is_voice_playing:!1,m_lose:null,m_scroll_arrow_left:null,m_scroll_arrow_right:null,m_world_war_npc_dungeon_win:null,m_world_war_npc_dungeon_lose:null,m_world_war_npc_dungeon_timeout:null,m_btn_list:[],m_gain_items:null,m_game_scene:null,m_voice_playing_delta:0,ctor:function(){this._super(),this.battleObserver=MainObserver.getInstance(),this.m_gain_items=[],this.init()},init:function(){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE()),this.m_game_type=BattleContext._getInstance().getGameType();var listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1});return listener.onTouchBegan=this.onTouchBegan.bind(this),listener.onTouchEnded=this.onTouchEnded.bind(this),cc.eventManager.addListener(listener,this),this.m_debug_log_box=new GameModalLayer,this.addChild(this.m_debug_log_box,99999),this.scheduleUpdate(),!0},onEnter:function(){this._super(),this._super(),AudioEngine.getInstance().stopBackgroundMusic()},onExit:function(){if(!BATTLE_TO_SHOP&&(this._super(),null!=this.m_gnrl_img))if(1==USE_PARTNER_GNRL_LOADING)if(0<SAVE_NOW_PARTNER_GNRL.res_img.length)for(var idx=0;idx<this.m_gnrl_img.length;idx++){for(var check_release=!1,jdx=0;jdx<SAVE_NOW_PARTNER_GNRL.res_img.length;jdx++)SAVE_NOW_PARTNER_GNRL.res_img[jdx]==this.m_gnrl_img[idx]&&(check_release=!0);0==check_release&&cc.loader.release(this.m_gnrl_img[idx])}else for(idx=0;idx<this.m_gnrl_img.length;idx++)cc.loader.release(this.m_gnrl_img[idx]);else{for(idx=0;idx<this.m_gnrl_img.length;idx++)cc.loader.release(this.m_gnrl_img[idx]);this.m_gnrl_img=null}},resultData:function(res,num){0==num?(this.m_result_type=WORLD_WAR_DUNGEIN_RESULT_TYPE.WIN,this.m_world_war_npc_dungeon_win=res,BattleContext._getInstance().setWorldWarCastleOccupationRewardItem(res.bonus_item),this.makeSuccess()):1==num?(this.m_result_type=WORLD_WAR_DUNGEIN_RESULT_TYPE.LOSE,this.m_world_war_npc_dungeon_lose=res,this.makeFailed()):2==num&&(this.m_result_type=WORLD_WAR_DUNGEIN_RESULT_TYPE.DRAW,this.m_world_war_npc_dungeon_timeout=res,this.makeDraw())},makeSuccess:function(){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_battle_win.mp3";audio.playEffect(path),this.m_win_lose_layer=new cc.Layer,this.m_win_lose_layer.ignoreAnchorPointForPosition(!1),this.m_win_lose_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_win_lose_layer.setPosition(ccCenter(this)),this.addChild(this.m_win_lose_layer,0);var dim=new cc.LayerColor(cc.color.BLACK);dim.ignoreAnchorPointForPosition(!1),dim.setAnchorPoint(ANCHOR_MIDDLE()),dim.setPosition(ccCenter(this.m_win_lose_layer)),dim.setOpacity(0),this.m_win_lose_layer.addChild(dim);var fadein=new cc.FadeTo(.3,128);dim.runAction(fadein);var win=cc.Sprite.create();if(win.setAnchorPoint(ANCHOR_MIDDLE()),win.setPosition(ccCenter(this.m_win_lose_layer)),this.m_win_lose_layer.addChild(win),NOT_USE_SP_BATTLE_ANIMATION){win.setScale(2),win.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_win_09.png");var scaleTo_1=new cc.ScaleTo(.7,2.03,2.03),scaleTo_2=new cc.ScaleTo(.7,1.97,1.97),sequence=new cc.Sequence(scaleTo_1,scaleTo_2);delay1=new cc.DelayTime(.3),cb=new cc.CallFunc(this.cbMakeSuccssImpactStar,this),seq=new cc.Sequence(delay1,sequence,cb);win.runAction(seq),seq=cb=delay1=sequence=scaleTo_2=scaleTo_1=null}else{var delay1=new cc.DelayTime(.3),ani=BattleAni._getInstance().getAnimate(BattleAni_.EffectResultWin),cb=new cc.CallFunc(this.cbMakeSuccssImpactStar,this),seq=new cc.Sequence(delay1,ani,cb);win.runAction(seq),seq=cb=ani=delay1=null}this.playFireworks(1)},makeFailed:function(){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_battle_lose.mp3";audio.playEffect(path);var size=ccSize(this),texture=new cc.RenderTexture(size.width+1,size.height,cc.Texture2D.PIXEL_FORMAT_RGBA8888);texture.begin(),this.m_game_scene.visit(),texture.end(),this.m_win_lose_layer=new cc.Layer,this.m_win_lose_layer.ignoreAnchorPointForPosition(!1),this.m_win_lose_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_win_lose_layer.setPosition(ccCenter(this)),this.addChild(this.m_win_lose_layer,0);var fail_bg=cc.Sprite.create(texture.getSprite().getTexture());fail_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),fail_bg.setPosition(ZERO()),fail_bg.setFlippedY(!0),this.m_win_lose_layer.addChild(fail_bg),BattleShaderCache.getInstance().openShader(fail_bg,SHADER_GRAY_SCALE_FSH,SHADER_DEFAULT_ORIGIN_VSH),fail_bg.setOpacity(0);var fadein=new cc.FadeIn(1);if(fail_bg.runAction(fadein),this.m_lose=cc.Sprite.create(),this.m_lose.setAnchorPoint(ANCHOR_MIDDLE()),this.m_lose.setPosition(ccCenter(this.m_win_lose_layer)),this.m_win_lose_layer.addChild(this.m_lose),NOT_USE_SP_BATTLE_ANIMATION){this.m_lose.setScale(3),this.m_lose.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_war_lose_09.png");var scaleTo_1=new cc.ScaleTo(.3,3,3),scaleTo_2=new cc.ScaleTo(.7,2,2),sequence=new cc.Sequence(scaleTo_1,scaleTo_2);delay1=new cc.DelayTime(.3),delay2=new cc.DelayTime(1.5),cb=new cc.CallFunc(this.cbMakeWinLoseDraw,this),seq=new cc.Sequence(delay1,sequence,delay2,cb);this.m_lose.runAction(seq),seq=delay2=delay1=sequence=scaleTo_2=scaleTo_1=null}else{var delay1=new cc.DelayTime(.3),ani=BattleAni._getInstance().getAnimate(BattleAni_.EffectResultLose),delay2=new cc.DelayTime(1.5),cb=new cc.CallFunc(this.cbMakeWinLoseDraw,this),seq=new cc.Sequence(delay1,ani,delay2,cb);this.m_lose.runAction(seq),seq=cb=delay2=ani=delay1=null}this.createDebugBtns()},makeDraw:function(){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_battle_lose.mp3";audio.playEffect(path);var winSize=cc.director.getWinSize(),texture=new cc.RenderTexture(winSize.width+1,winSize.height,cc.Texture2D.PIXEL_FORMAT_RGBA8888);texture.begin(),this.m_game_scene.visit(),texture.end(),this.m_win_lose_layer=new cc.Layer,this.m_win_lose_layer.ignoreAnchorPointForPosition(!1),this.m_win_lose_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_win_lose_layer.setPosition(ccCenter(this)),this.addChild(this.m_win_lose_layer,0);var fail_bg=cc.Sprite.create(texture.getSprite().getTexture());fail_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),fail_bg.setPosition(ZERO()),fail_bg.setFlippedY(!0),this.m_win_lose_layer.addChild(fail_bg),BattleShaderCache.getInstance().openShader(fail_bg,SHADER_GRAY_SCALE_FSH,SHADER_DEFAULT_ORIGIN_VSH),fail_bg.setOpacity(0);var fadein=new cc.FadeIn(1);fail_bg.runAction(fadein),this.m_lose=cc.Sprite.create(),this.m_lose.setAnchorPoint(ANCHOR_MIDDLE()),this.m_lose.setPosition(ccCenter(this.m_win_lose_layer)),this.m_win_lose_layer.addChild(this.m_lose);var m_timeout=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/ui_fx_timeout.json",RES_CDN_DEFULT+"effect/ui_fx_timeout.atlas",1);m_timeout.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),m_timeout.setPosition(winSize.width/2,winSize.height/2),m_timeout.setVisible(!0),this.m_win_lose_layer.addChild(m_timeout),m_timeout.setAnimation(0,"fx_1",!1),m_timeout.setCompleteListener(this.spineCompleteListener.bind(this))},spineCompleteListener:function(trackIndex,loopCount){this.cbMakeWinLoseDraw()},cbMakeWinLoseDraw:function(){var winSize=ccSize(this);if(this.m_result_type==WORLD_WAR_DUNGEIN_RESULT_TYPE.WIN)this.m_win_lose_layer.setVisible(!1),this.makeResultWinReward(),this.voicePlay(voice_battle_win_leader);else if(this.m_result_type==WORLD_WAR_DUNGEIN_RESULT_TYPE.LOSE||this.m_result_type==WORLD_WAR_DUNGEIN_RESULT_TYPE.DRAW){this.appearButtons();var move=new cc.MoveTo(.3,cc.p(.5*winSize.width,.5*winSize.height+120));this.m_lose.runAction(move)}},makeResultWinReward:function(){var sound_path=RES_CDN_SOUND+SND_TYPE+"sound/SE_acclamation.mp3";AudioEngine.getInstance().playEffect(sound_path);var mt=MasterManager.getInstance(),partner_id=0;if(this.m_gnrl_img=[],1==USE_PARTNER_GNRL_LOADING){var partner_yunhee=GameDefault.getInstance().GetPartnerYunheeLoad();if(1==partner_yunhee.load)for(var tdx=0;tdx<partner_yunhee.gnrl_img.length;tdx++)this.m_gnrl_img.push(partner_yunhee.gnrl_img[tdx]);this.m_bp=partner_yunhee.position,partner_id=partner_yunhee.partner_id}else{var generalService=GeneralService.getInstance(),partner_gnrl=new db.UserGeneralInfo,partner_key=GameContext.getInstance().getUserGeneralPartner(),gnrl_key=new net.User_General_Key;gnrl_key.gnrl_id=partner_key.gnrl_id,gnrl_key.gnrl_num=partner_key.gnrl_num,generalService.getUserGnrlDisplayClassInfo(gnrl_key,partner_gnrl),partner_id=partner_gnrl.class_type>=AVAIL_EVOLUTION_CLASS_TYPE_LIMIT&&0!=partner_gnrl.display_class&&partner_gnrl.class_type!=partner_gnrl.display_class?partner_gnrl.gnrl_id-1e3*(partner_gnrl.class_type-partner_gnrl.display_class):partner_gnrl.gnrl_id;var morph=MasterTable.getInstance().get_MorphData(partner_id);if(this.m_bp=mt.get_BodyPosition(partner_id),"y"==morph.is_morph){var stading_files=StandingMultiplePngList[morph.gnrl_id],gnrl=MasterManager.getInstance().get_General(morph.gnrl_id);if(null==stading_files)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".png");else for(var idx=0;idx<stading_files.length;idx++)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+stading_files[idx]+".png");this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".atlas"),this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".json")}else{var general=mt.get_General(partner_id);if(general.gnrl_type==GENERAL_TYPE_YUNHEE){if(mt.get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var str=getCardBody_ImageStr(general.gnrl_id);this.m_gnrl_img.push(str)}else{str=getCardBody_ImageStr(general.gnrl_id);this.m_gnrl_img.push(str)}}else{str=getCardBody_ImageStr(partner_id);this.m_gnrl_img.push(str)}}}cc.loader.load(this.m_gnrl_img,function(err,results){err||this.resourceLoader_start(partner_id)}.bind(this))},resourceLoader_start:function(partner_id){var bg,m=MasterTable.getInstance(),mt=MasterManager.getInstance(),winSize=ccSize(this),morph=m.get_MorphData(partner_id),gnrl=mt.get_General(morph.gnrl_id);(this.m_result_layer=new cc.Layer,this.m_result_layer.ignoreAnchorPointForPosition(!1),this.m_result_layer.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_result_layer.setPosition(ZERO()),this.addChild(this.m_result_layer),IS_SP_BROWSER)?((bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/bg_raid_result.jpg")).setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(this)),bg.setScale(2),this.m_result_layer.addChild(bg)):((bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/bg_raid_result.jpg")).setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(this)),this.m_result_layer.addChild(bg));if("y"==morph.is_morph){var standing_atlas=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".atlas",standing_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".json";this.m_skeletonNode=new sp.SkeletonAnimation(standing_json,standing_atlas),this.m_skeletonNode.setScale(.1),this.m_skeletonNode.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_skeletonNode.setPosition(MAIN_POS(this,this.m_bp.posx,this.m_bp.posy)),this.m_result_layer.addChild(this.m_skeletonNode),this.m_skeletonNode.setMix("basic","active",.1),this.m_skeletonNode.setMix("active","basic",.1),this.m_skeletonNode.setAnimation(0,"active",!1),this.m_skeletonNode.addAnimation(0,"basic",!0)}else{var general=mt.get_General(partner_id);if(this.m_img_scale=1,general.gnrl_type==GENERAL_TYPE_YUNHEE){if(mt.get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id)}else{img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id)}}else{img_str=getCardBody_ImageStr(partner_id);this.m_img_scale=getCardBody_Scale(partner_id)}this.m_partner_gnrl=cc.Sprite.create(img_str),this.m_partner_gnrl.setScale(this.m_img_scale),this.m_partner_gnrl.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_partner_gnrl.setPosition(MAIN_POS(this,this.m_bp.posx+ccWidth(this.m_partner_gnrl)*this.m_img_scale,this.m_bp.posy)),this.m_result_layer.addChild(this.m_partner_gnrl);var move=new cc.MoveTo(.5,MAIN_POS(this,this.m_bp.posx,this.m_bp.posy)),ease=new cc.EaseExponentialOut(move);this.m_partner_gnrl.runAction(ease)}var title_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_main/bg_state_title.png");title_bg.setAnchorPoint(ANCHOR_TOP_LEFT()),title_bg.setPosition(0,ccHeight(this)),this.m_result_layer.addChild(title_bg);var result_title=cc.Sprite.create("#img_result_text.png");result_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),result_title.setPosition(30,66),title_bg.addChild(result_title);var result_win=new cc.Sprite;if(result_win.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),result_win.setPosition(.5*winSize.width,442),this.m_result_layer.addChild(result_win),NOT_USE_SP_BATTLE_ANIMATION){result_win.setScale(2),result_win.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_result_win_10.png");var scaleTo_1=new cc.ScaleTo(.7,2,2.01),scaleTo_2=new cc.ScaleTo(.7,2,1.99),sequence=new cc.Sequence(scaleTo_1,scaleTo_2);repeat=new cc.RepeatForever(sequence);result_win.runAction(repeat),repeat=sequence=scaleTo_2=scaleTo_1=null}else{var ani=BattleAni._getInstance().getAnimate(BattleAni_.EffectWinText),repeat=new cc.RepeatForever(ani);result_win.runAction(repeat),repeat=ani=null}this.appearGeneral(),this.appearGainBonus(),this.appearButtons(),this.createDebugBtns()},playFireworks:function(d){this.m_firework_position=new Array;var firework_position_list=cc.p((winSize.width-960)/2+930,500);this.m_firework_position.push_back(firework_position_list),firework_position_list=cc.p((winSize.width-960)/2+110,210),this.m_firework_position.push_back(firework_position_list),firework_position_list=cc.p((winSize.width-960)/2+570,470),this.m_firework_position.push_back(firework_position_list),firework_position_list=cc.p((winSize.width-960)/2+910,150),this.m_firework_position.push_back(firework_position_list),firework_position_list=cc.p((winSize.width-960)/2+680,250),this.m_firework_position.push_back(firework_position_list),this.m_firework_position.shuffle();for(var pos=cc.p(0,0),i=0;i<this.m_firework_position.size();i++){var x=parseInt(30*Math.random())-15,y=parseInt(30*Math.random())-15;(pos=this.m_firework_position.at(i)).x+=x,pos.y+=y;var delay_time=100*Math.random()/1e3+.35*i+d,str="play_fireworks_"+i;this.scheduleOnce(function(){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/hit_power_blow.mp3";audio.playEffect(path);var x=parseInt(30*Math.random())-15,y=parseInt(30*Math.random())-15;if((pos=this.m_firework_position.pop_front()).x+=x,pos.y+=y,0==NOT_USE_SP_FIREWORKS_EFF_ANIMATION){var fire=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Fireworks.json",RES_CDN_DEFULT+"effect/Fireworks.atlas",1);fire.setPosition(pos),this.m_win_lose_layer.addChild(fire),fire.setAnimation(0,"fx_1",!1),fire.setCompleteListener(function(traceIndex,loopCount){fire.setVisible(!1)})}}.bind(this),delay_time,str)}},appearGeneral:function(){var pos_list=new Array,pos_list_p=cc.p(348,202);pos_list.push_back(pos_list_p),pos_list_p=cc.p(228,282),pos_list.push_back(pos_list_p),pos_list_p=cc.p(228,142),pos_list.push_back(pos_list_p),pos_list_p=cc.p(108,282),pos_list.push_back(pos_list_p),pos_list_p=cc.p(108,142),pos_list.push_back(pos_list_p);var gnrl_list=[];WorldWarService.getInstance().getWorldWarTroopsGenerals(this.m_world_war_npc_dungeon_win.troops,gnrl_list,!0);for(var i=0;i<5;i++){for(var is_exist=!1,pos=i+1,j=0;j<gnrl_list.size();j++){if(pos==(g=gnrl_list.at(j)).position){(exp=net.User_General_Exp).gnrl_id=g.gnrl_id,exp.gnrl_num=g.gnrl_num,exp.gnrl_level=g.gnrl_level,exp.gnrl_exp=g.exp,(gnrl=new BattleResultGeneral_V2).setData(g,exp,g.position),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl),is_exist=!0;break}}if(!is_exist){var gnrl,g=new BattleGeneral(0),exp=net.User_General_Exp;g.gnrl_id=0,(gnrl=new BattleResultGeneral_V2).setData(g,exp,pos),gnrl.setPosition(pos_list.at(pos-1)),this.m_result_layer.addChild(gnrl)}}},appearGainBonus:function(){var mt=MasterManager.getInstance(),title=new cc.Sprite("#img_result_text_reward.png");title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(LP(this,20,88)),this.m_result_layer.addChild(title);for(var gain_item_list=[],drop_bonus_items=this.m_world_war_npc_dungeon_win.bonus_item,i=0;i<drop_bonus_items.length;i++){(item=$.extend({},database.BattleGainItem)).init();var b=drop_bonus_items[i];item.item_type=database.BattleGainItemType.None,item.item_id=0,item.item_level=0,item.item_count="";for(var is_exist_item=!1,jjdx=0;jjdx<gain_item_list.length;jjdx++)if(b.bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX){if(gain_item_list[jjdx].item_id==b.bonus_idx){gain_item_list[jjdx].item_count++,is_exist_item=!0;break}}else if(b.bonus_type==BONUS_TYPE_EQUIPMENT){if(mt.get_EquipmentItem(b.equipment.equipment_item_idx).equipment_type==EQUIPMENT_TYPE_EXP&&gain_item_list[jjdx].equipment.equipment_item_idx==b.equipment.equipment_item_idx){gain_item_list[jjdx].item_count++,is_exist_item=!0;break}}else if(b.bonus_type>=BONUS_TYPE_CHRISTMAS_SANTA&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_SNOWMAN){if(gain_item_list[jjdx].item_id==b.bonus_type){gain_item_list[jjdx].item_count+=b.bonus_num,is_exist_item=!0;break}}else if(b.bonus_type==BONUS_TYPE_GOLD&&0<b.castle_id){if(gain_item_list[jjdx].item_id==b.bonus_type&&gain_item_list[jjdx].gnrl_group==b.castle_id){gain_item_list[jjdx].item_count+=b.bonus_idx,is_exist_item=!0;break}}else if(b.bonus_type==BONUS_TYPE_USER_EXP&&9876543==b.castle_id){if(gain_item_list[jjdx].item_id==b.bonus_type&&gain_item_list[jjdx].gnrl_group==b.castle_id){gain_item_list[jjdx].item_count+=b.bonus_idx,is_exist_item=!0;break}}else if(b.bonus_type>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&b.bonus_type<=BONUS_TYPE_CRAFT_SHOP_SECOND_UNIQUE){if(gain_item_list[jjdx].item_id==b.bonus_type&&0<gain_item_list[jjdx].gnrl_group){gain_item_list[jjdx].item_count+=b.bonus_idx,is_exist_item=!0;break}}else if(gain_item_list[jjdx].item_id==b.bonus_type){gain_item_list[jjdx].item_count+=b.bonus_idx,is_exist_item=!0;break}is_exist_item||(b.bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX?(item.item_type=database.BattleGainItemType.General,item.item_id=b.bonus_idx,item.item_level=b.bonus_level,item.item_count=1,gain_item_list.push_back(item)):b.bonus_type==BONUS_TYPE_HEART?(item.item_type=database.BattleGainItemType.Heart,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),gain_item_list.push_back(item)):b.bonus_type==BONUS_TYPE_JADE?(item.item_type=database.BattleGainItemType.Jade,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),gain_item_list.push_back(item)):b.bonus_type==BONUS_TYPE_GOLD?(item.item_type=database.BattleGainItemType.Gold,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.gnrl_group=b.castle_id,gain_item_list.push_back(item)):b.bonus_type>=BONUS_TYPE_HWANDAN_1&&b.bonus_type<=BONUS_TYPE_HWANDAN_7?(item.item_type=database.BattleGainItemType.Hwandan,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.item_level=b.bonus_level,gain_item_list.push_back(item)):b.bonus_type==BONUS_TYPE_EVOLVE_STONE?(item.item_type=database.BattleGainItemType.EvolveStone,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.gnrl_group=b.castle_id,gain_item_list.push_back(item)):b.bonus_type>=BONUS_TYPE_ATTK_POINT&&b.bonus_type<=BONUS_TYPE_CRI_DMG_POINT?(item.item_type=database.BattleGainItemType.FormationPropertyPoint,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.item_level=b.bonus_level,item.gnrl_group=b.castle_id,gain_item_list.push_back(item)):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER?(item.item_type=database.BattleGainItemType.ForceTypeEvolveMtrl,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.item_level=b.bonus_level,item.gnrl_group=b.castle_id,gain_item_list.push_back(item)):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE?(item.item_type=database.BattleGainItemType.ForceTypeEvolveMtrl,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.item_level=b.bonus_level,item.gnrl_group=b.castle_id,gain_item_list.push_back(item)):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW?(item.item_type=database.BattleGainItemType.ForceTypeEvolveMtrl,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.item_level=b.bonus_level,item.gnrl_group=b.castle_id,gain_item_list.push_back(item)):b.bonus_type==BONUS_TYPE_EVOLVE_ORB?(item.item_type=database.BattleGainItemType.EvolveOrb,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.item_level=b.bonus_level,item.gnrl_group=b.castle_id,gain_item_list.push_back(item)):b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE?(item.item_type=database.BattleGainItemType.LoveItem,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.item_level=b.bonus_level,item.gnrl_group=b.castle_id,gain_item_list.push_back(item)):b.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE?(item.item_type=database.BattleGainItemType.LoveItem,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.item_level=b.bonus_level,item.gnrl_group=b.castle_id,gain_item_list.push_back(item)):b.bonus_type==BONUS_TYPE_USER_EXP?(item.item_type=database.BattleGainItemType.UserExp,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.gnrl_group=b.castle_id,gain_item_list.push_back(item)):b.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||b.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL?(item.item_type=database.BattleGainItemType.LimitOverMtrl,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.gnrl_group=b.castle_id,gain_item_list.push_back(item)):b.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL?(item.item_type=database.BattleGainItemType.MagicKeyPiece,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.gnrl_group=b.castle_id,gain_item_list.push_back(item)):b.bonus_type>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&b.bonus_type<=BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND?(item.item_type=database.BattleGainItemType.CraftMtrl,item.item_id=b.bonus_type,item.item_count=parseInt(b.bonus_idx),item.gnrl_group=b.castle_id,gain_item_list.push_back(item)):b.bonus_type==BONUS_TYPE_EQUIPMENT?(item.item_type=database.BattleGainItemType.Equipment,item.item_id=b.bonus_idx,item.item_count=1,item.equipment=b.equipment,gain_item_list.push_back(item)):b.bonus_type==BONUS_TYPE_NAMING?(item.item_type=database.BattleGainItemType.HeroNaming,item.item_id=b.bonus_type,item.item_level=b.bonus_idx,item.item_count=1,gain_item_list.push_back(item)):b.bonus_type==BONUS_TYPE_JADE_RANDOM_BOX||b.bonus_type==BONUS_TYPE_GOLD_RANDOM_BOX||b.bonus_type==BONUS_TYPE_LOVE_ITEM_RANDOM_BOX||b.bonus_type==BONUS_TYPE_RARE_HWANDAN_RANDOM_BOX||b.bonus_type==BONUS_TYPE_EXP_CARD_RANDOM_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_GIFT_BOX||b.bonus_type==BONUS_TYPE_SWORD_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_SPEAR_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_ARCHER_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_RANDOM_BOX||b.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_GIFT_BOX||b.bonus_type==BONUS_TYPE_EVENTDUNGEON_PRESENT_GIFT_BOX||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_1||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_2||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_3||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_4?(item.item_type=database.BattleGainItemType.RandomBox,item.item_id=b.bonus_type,item.item_count=b.bonus_idx,gain_item_list.push_back(item)):b.bonus_type==BONUS_TYPE_SR_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_R_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_HR_RARE_TYPE_ENGAGE?(item.item_type=database.BattleGainItemType.GachaTicket,item.item_id=b.bonus_type,item.item_count=b.bonus_idx,gain_item_list.push_back(item)):b.bonus_type>=BONUS_TYPE_CHRISTMAS_RIBBON&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_APPLE?(item.item_type=database.BattleGainItemType.ETC,item.item_id=b.bonus_type,item.item_count=b.bonus_idx,item.gnrl_group=b.castle_id,gain_item_list.push_back(item)):b.bonus_type>=BONUS_TYPE_CHRISTMAS_SANTA&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_SNOWMAN?(item.item_type=database.BattleGainItemType.ETC,item.item_id=b.bonus_type,item.item_count=b.bonus_num,item.gnrl_group=b.castle_id,gain_item_list.push_back(item)):b.bonus_type>=BONUS_TYPE_REBIRTH_MTRL_TYPE_1&&b.bonus_type<=BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type>=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1&&b.bonus_type<=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6?(item.item_type=database.BattleGainItemType.RebirthMtrl,item.item_id=b.bonus_type,item.item_count=b.bonus_idx,item.gnrl_group=b.castle_id,gain_item_list.push_back(item)):b.bonus_type==BONUS_TYPE_GREAT_WALL_TICKET?(item.item_type=database.BattleGainItemType.GreatWallTicket,item.item_id=b.bonus_type,item.item_count=b.bonus_idx,gain_item_list.push_back(item)):b.bonus_type==BONUS_TYPE_WORLD_WAR_MEDAL&&(item.item_type=database.BattleGainItemType.WorldWarMedal,item.item_id=b.bonus_type,item.item_count=b.bonus_idx,gain_item_list.push_back(item)))}var viewSize=cc.size(420,468);this.m_game_type!=db.BattleGameType.EventDungeon&&this.m_game_type!=db.BattleGameType.WeeklyDungeon||(viewSize=cc.size(720,468));var container_width=72*gain_item_list.size();container_width<viewSize.width&&(container_width=viewSize.width),this.m_scroll_container=new cc.Layer,this.m_scroll_container.ignoreAnchorPointForPosition(!1),this.m_scroll_container.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_scroll_container.setContentSize(container_width,98),this.m_scroll_container.setPosition(ZERO()),this.m_scroll_arrow_left=new cc.Sprite(RES_CDN_DEFULT+"common/img_scroll_arrow.png"),this.m_scroll_arrow_left.setFlippedX(!0),this.m_scroll_arrow_left.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_scroll_arrow_left.setPosition(LP(this,20,1+.5*viewSize.height)),this.m_scroll_arrow_left.setVisible(!1),this.m_result_layer.addChild(this.m_scroll_arrow_left),this.m_scroll_arrow_right=new cc.Sprite(RES_CDN_DEFULT+"common/img_scroll_arrow.png"),this.m_scroll_arrow_right.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_scroll_arrow_right.setPosition(LP(this,20+viewSize.width,1+.5*viewSize.height)),this.m_scroll_arrow_right.setVisible(!1),this.m_result_layer.addChild(this.m_scroll_arrow_right),this.m_scroll_view=new cc.ScrollView(viewSize,this.m_scroll_container),this.m_scroll_view.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_scroll_view.setDirection(cc.SCROLLVIEW_DIRECTION_HORIZONTAL),this.m_scroll_view.setDelegate(this.m_scroll_container),this.m_scroll_view.setPosition(LP(this,20,-30)),this.m_result_layer.addChild(this.m_scroll_view),this.m_scroll_view.setContentOffset(cc.p(0,0),!1);for(var offset_x=2,j=0;j<gain_item_list.size();j++){var item,d=gain_item_list.at(j);(item=new BattleMissionResultGetItem_V2(d,this.addTooltip.bind(this),this.removeTooltip.bind(this))).setPosition(offset_x,50),this.m_scroll_container.addChild(item),this.m_gain_items.push_back(item),offset_x+=72}},addTooltip:function(world_pos,tooltip,title,content){if(null!=this.m_tooltip_box)return!1;this.m_tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.m_tooltip_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_tooltip_box.setPosition(world_pos),this.m_tooltip_box.setVisible(!0),this.addChild(this.m_tooltip_box);var tooltip_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1810);tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_tooltip_box.addChild(tooltip_title);var tooltip_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181);if(tooltip_content.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_tooltip_box.addChild(tooltip_content),tooltip_title.setString(title),tooltip_content.setString(content),""!=content){var tSize=ccSize(tooltip_title),cSize=ccSize(tooltip_content);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(tSize.width+20,cSize.width+20),bSize.height=Math.max(64,bSize.height+cSize.height+5),this.m_tooltip_box.setContentSize(tooltip._contentSize),this.m_tooltip_box.setPreferredSize(bSize),tooltip_title.setPosition(10,bSize.height-10),tooltip_content.setPosition(10,bSize.height-15-tSize.height);var offset=world_pos.x-bSize.width/2;if(offset<0){var new_pos=cc.p(world_pos.x+Math.abs(offset),world_pos.y);this.m_tooltip_box.setPosition(new_pos),tooltip_title.setPosition(10,bSize.height-10),tooltip_content.setPosition(10,bSize.height-15-tSize.height)}}else{tooltip_title.setAnchorPoint(ANCHOR_MIDDLE());var bSize;tSize=ccSize(tooltip_title);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(64,tSize.width+20),bSize.height=Math.max(54,bSize.height+10),this.m_tooltip_box.setPreferredSize(bSize),tooltip_title.setPosition(ccCenter(bSize))}},removeTooltip:function(){this.removeChild(this.m_tooltip_box),this.m_tooltip_box=null},appearButtons:function(){var winSize=ccSize(this),container=new cc.Node;if(this.m_result_type==WORLD_WAR_DUNGEIN_RESULT_TYPE.WIN?(container.setPosition(winSize.width-10,-100),this.m_result_layer.addChild(container)):(container.setPosition(.5*winSize.width,-60),this.m_win_lose_layer.addChild(container)),this.createBtnWorldWarNpcDungeon(container),this.m_result_type==WORLD_WAR_DUNGEIN_RESULT_TYPE.WIN){var delay=new cc.DelayTime(2.5),move=new cc.MoveBy(.5,cc.p(0,110)),seq=new cc.Sequence(delay,move);container.runAction(seq),this.enable_touch_partner=!0}else{delay=new cc.DelayTime(1),move=new cc.MoveBy(.5,cc.p(0,110)),seq=new cc.Sequence(delay,move);container.runAction(seq)}},createBtnWorldWarNpcDungeon:function(container){var offset_x=0,is_battle_continue=BattleContext._getInstance().IsWorldWarBattleContinue(),btn=(ccSize(this),this.createButton(res_str("btn_label_confirm")));btn.addClickEventListener(function(sender){var context=BattleContext._getInstance();context.clear(),context.clearWorldWarNpcBattleData(),context.setWorldWarBattleContinue(!1),WorldWarService.getInstance().CheckWorldWarPeriod()||(is_battle_continue?(NetServiceV3.getInstance().clearWorldWarBattleContinueInfo(),this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_world_war_to_main)):this.battleObserver.postNotification(sceneStr[scene_BattleScene],BattleSceneFlag.menu_result_world_war_to_map),this.setEnableBtns(!1))}.bind(this)),this.m_result_type!=WORLD_WAR_DUNGEIN_RESULT_TYPE.LOSE&&this.m_result_type!=WORLD_WAR_DUNGEIN_RESULT_TYPE.DRAW||(offset_x+=.5*ccWidth(btn)),btn.setPosition(offset_x,0),container.addChild(btn),this.m_btn_list.push_back(btn)},createButton:function(btn_label){var btn=new ccui.Button;btn.loadTextures("btn_01_off.png","btn_01_on.png","",ccui.Widget.PLIST_TEXTURE),btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT());var label=cmLabel.getLabel(btn_label,LABEL_FONT_INDEX.FONT_241);return label.setAnchorPoint(ANCHOR_MIDDLE()),label.setPosition(btn.getContentSize().width/2,btn.getContentSize().height/2),btn.addChild(label),btn},voicePlay:function(voice_type){var partner_id=GeneralService.getInstance().getUserTroopsPartnerId(),voice_list=MasterTable.getInstance().get_Voice(partner_id,voice_type,{}),voice=voice_list.voice,duration=voice_list.duration;if(voice&&""!=voice){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3";audio.playVoice(path),this.m_is_voice_playing=!0,this.m_voice_playing_delta=duration}},partnerAnimation:function(){if(null!=this.m_partner_gnrl){this.m_partner_gnrl.isRunning()&&(this.m_partner_gnrl.stopAllActions(),this.m_partner_gnrl.setPosition(MAIN_POS(this,this.m_bp.posx,this.m_bp.posy)));var s1=new cc.ScaleTo(.1,this.m_img_scale+.03,this.m_img_scale-.03),s2=new cc.ScaleTo(.2,this.m_img_scale-.03,this.m_img_scale+.03),s3=new cc.ScaleTo(.15,this.m_img_scale+.02,this.m_img_scale-.02),s4=new cc.ScaleTo(.8,this.m_img_scale,this.m_img_scale),e4=new cc.EaseElasticOut(s4),seq=new cc.Sequence(s1,s2,s3,e4);this.m_partner_gnrl.runAction(seq)}else null!=this.m_skeletonNode&&(this.m_skeletonNode.setAnimation(0,"active",!1),this.m_skeletonNode.addAnimation(0,"basic",!0),this.m_skeletonNode.setAnimation(1,"emo_basic",!0));this.m_is_voice_playing||this.voicePlay(voice_main_body_touch)},onTouchBegan:function(touch,evt){var winSize=ccSize(this),p=touch.getLocation(),rect=cc.rect(winSize.width-400,0,400,winSize.height);return!!cc.rectContainsPoint(rect,p)},onTouchEnded:function(touch,evt){this.enable_touch_partner&&this.m_result_type==WORLD_WAR_DUNGEIN_RESULT_TYPE.WIN&&this.partnerAnimation()},showDebugBox:function(){this.m_debug_log_box.setContentSize(ccSize(this)),this.m_debug_log_box._contentNode=function(contentSize,m){var layer=new BattleDebugLayer,btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);return btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),btn.setPosition(ccWidth(layer)-2,ccHeight(layer)-2),layer.addChild(btn),btn.addClickEventListener(function(sender){this.hideDebugBox()}.bind(this)),layer}.bind(this),this.m_debug_log_box.show()},hideDebugBox:function(){this.m_debug_log_box.is_show()&&this.m_debug_log_box.hide()},showGeneralDebugBox:function(){this.m_debug_log_box.setContentSize(ccSize(this)),this.m_debug_log_box._contentNode=function(contentSize,m){var layer=new BattleGeneralDebugLayer,btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);return btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),btn.setPosition(ccWidth(layer)-2,ccHeight(layer)-2),layer.addChild(btn),btn.addClickEventListener(function(sender){this.hideDebugBox()}.bind(this)),layer}.bind(this),this.m_debug_log_box.show()},setEnableBtns:function(isEnable){for(var i=0;i<this.m_btn_list.size();i++){this.m_btn_list.at(i).setEnabled(isEnable)}},setGamescene:function(scene){this.m_game_scene=scene},update:function(dt){this.m_is_voice_playing&&(this.m_voice_playing_delta-=dt,this.m_voice_playing_delta<0&&(this.m_is_voice_playing=!1,this.m_voice_playing_delta=0))},createDebugBtns:function(){var btn,winSize=ccSize(this);TEST_DAMAGE_LOG_SHOW&&((btn=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE)).setFont(LABEL_FONT_INDEX.FONT_241),btn.setString("DAMAGE"),btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),btn.setPosition(winSize.width-10,winSize.height-10),this.m_win_lose_layer.addChild(btn),btn.addClickEventListener(function(sender){this.showDebugBox()}.bind(this)));TEST_GENERAL_LOG_SHOW&&((btn=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE)).setFont(LABEL_FONT_INDEX.FONT_241),btn.setString("DEBUG"),btn.setAnchorPoint(ANCHOR_TOP_LEFT()),btn.setPosition(10,winSize.height-10),this.m_win_lose_layer.addChild(btn),btn.addClickEventListener(function(sender){this.showGeneralDebugBox()}.bind(this)))},scrollViewDidScroll:function(view){var viewSize=view.getViewSize(),container_width=view.getContainer().getContentSize().width;if(viewSize.width>=container_width)this.m_scroll_arrow_left.setVisible(!1),this.m_scroll_arrow_right.setVisible(!1);else{var offset=view.getContentOffset(),diff=viewSize.width-container_width;0<=offset.x?(this.m_scroll_arrow_left.setVisible(!1),this.m_scroll_arrow_right.setVisible(!0)):offset.x<=diff?(this.m_scroll_arrow_left.setVisible(!0),this.m_scroll_arrow_right.setVisible(!1)):(this.m_scroll_arrow_left.setVisible(!0),this.m_scroll_arrow_right.setVisible(!0))}},scrollViewDidZoom:function(view){},cbMakeSuccssImpactStar:function(){this.scheduleOnce(function(float){this.cbMakeWinLoseDraw()}.bind(this),2.5,"success_impact_star")}}),RaidBossEnum={raid_boss_battle_start:87369,raid_boss_partin_user_list:87370,popup_empty_troops:87371,lack_raid_ticket:87372,lack_raid_help_ticket:87373,popup_already_end_time:87374,raid_boss_select_battle:87375,raid_boss_skip_battle_start:87376},RaidBossBattleReadyLayer=cc.Layer.extend({m_boss:null,m_base_layer:null,m_bg:null,m_partin_btn:null,m_partin_modal_layer:null,m_gnrl_img:[],m_userItemInfo_check:!1,m_userInfo_check:!1,m_troopsNum_check:!1,m_userItem_info:null,m_user_info:null,m_troops_num:null,m_beforeDamage:0,ctor:function(){this._super(),this.m_boss=null,this.m_base_layer=null,this.m_bg=null,this.m_partin_btn=null,this.m_partin_modal_layer=null,this.m_gnrl_img=[],this.m_userItem_info=$.extend({},db.UserItemInfo),this.m_user_info=$.extend({},db.UserInfo),this.m_userItemInfo_check=!1,this.m_userInfo_check=!1,this.m_troopsNum_check=!1;NetService().Load_User_Troops_General();this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/img_raid_gauge_back.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/img_raid_gauge_red.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/btn_raid_start_off.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/btn_raid_start_on.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/btn_raid_help_start_off.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/btn_raid_help_start_on.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/img_raid_damagebox.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/btn_raid_small_1_off.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/btn_raid_small_1_on.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/btn_raid_small_2_off.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/btn_raid_small_2_on.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/btn_raid_small_1_help_off.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/btn_raid_small_1_help_on.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/btn_raid_small_2_help_off.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/btn_raid_small_2_help_on.png"),cc.loader.load(this.m_gnrl_img,function(err,results){err||this.init()}.bind(this))},onExit:function(){if(this._super(),null!=this.m_gnrl_img){for(var idx=0;idx<this.m_gnrl_img.length;idx++)cc.loader.release(this.m_gnrl_img[idx]);this.m_gnrl_img=null}},init:function(){RAID_BOSS_MODAL_OPEN_FLAG=!1,this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var winSize=ccSize(this);this.m_boss=BattleContext._getInstance().getRaidBossData();var m=MasterManager.getInstance(),boss_info=m.get_RaidBossInfo(this.m_boss.raid_boss_info_idx);USE_SP_RAIDBOSS_SCALE?(this.m_bg=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_raid/bg_raid_boss_%d.jpg",boss_info.element_type)),this.m_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bg.setPosition(ccCenter(winSize)),this.m_bg.setScale(2)):(this.m_bg=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_raid/bg_raid_boss_%d.jpg",boss_info.element_type)),this.m_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bg.setPosition(ccCenter(winSize)),this.m_bg.setScale(1.43)),this.addChild(this.m_bg),this.m_base_layer=new cc.Layer,this.m_base_layer.ignoreAnchorPointForPosition(!1),this.m_base_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_base_layer.setPosition(ccCenter(winSize)),this.addChild(this.m_base_layer);var remain_time_bg_size=cc.size(535,52),remain_time_bg=new cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_timebar.png",RectZero());remain_time_bg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),remain_time_bg.setPreferredSize(remain_time_bg_size),remain_time_bg.setPosition(.5*winSize.width,521),this.m_base_layer.addChild(remain_time_bg);var n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),end_dt=this.m_boss.end_dt,diff=moment(end_dt).valueOf()-n;diff<0&&(diff=0);var remain_time,d=moment.duration(diff);0<d.hours()?((remain_time=new cmMultiLabel).addLabel("逃亡まで残り : ",LABEL_FONT_INDEX.FONT_261),remain_time.addLabel(d.hours()+"時間"+d.minutes()+"分",LABEL_FONT_INDEX.FONT_262),remain_time.setPosition(.5*winSize.width-50,533),remain_time.setLabel(ANCHOR_MIDDLE_BOTTOM),this.m_base_layer.addChild(remain_time)):((remain_time=new cmMultiLabel).addLabel("逃亡まで残り : ",LABEL_FONT_INDEX.FONT_261),remain_time.addLabel(d.minutes()+"分",LABEL_FONT_INDEX.FONT_262),remain_time.setPosition(.5*winSize.width-25,533),remain_time.setLabel(ANCHOR_MIDDLE_BOTTOM),this.m_base_layer.addChild(remain_time));var boss_name=cmLabel.getLabel(cmString(m.get_LanguageData("label_raid_boss_name_element"),this.m_boss.boss_level,boss_info.name),LABEL_FONT_INDEX.FONT_301);switch(boss_name.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),boss_name.setPosition(.5*winSize.width+21,152),this.m_base_layer.addChild(boss_name),boss_info.element_type){case ELEMENT_TYPE_FIRE:boss_name.setColor(cc.color(220,36,36));break;case ELEMENT_TYPE_WATER:boss_name.setColor(cc.color(77,134,241));break;case ELEMENT_TYPE_WIND:boss_name.setColor(cc.color(79,193,44));break;case ELEMENT_TYPE_LIGHT:boss_name.setColor(cc.color(225,206,77));break;case ELEMENT_TYPE_DARK:boss_name.setColor(cc.color(204,67,209))}var nameSize=ccSize(boss_name),element_type=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_raid/img_raid_battletech_%d.png",boss_info.element_type));element_type.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),element_type.setPosition(.5*winSize.width-.5*nameSize.width-4+21,147),this.m_base_layer.addChild(element_type);cc.size(444,25);var life_bar_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_gauge.png");life_bar_bg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),life_bar_bg.setPosition(.5*winSize.width,107),this.m_base_layer.addChild(life_bar_bg);var life_bar=new cc.ProgressTimer(cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_gauge_red_3.png"));life_bar.setAnchorPoint(ANCHOR_MIDDLE()),life_bar.setMidpoint(ANCHOR_MIDDLE_LEFT()),life_bar.setBarChangeRate(ANCHOR_BOTTOM_RIGHT()),life_bar.setPosition(ccCenter(life_bar_bg)),life_bar.setType(cc.ProgressTimer.TYPE_BAR),life_bar_bg.addChild(life_bar);var per=Math.floor(this.m_boss.remain_hp/this.m_boss.max_hp*100);life_bar.setPercentage(per);var remain_hp=cmLabel.getLabel(cmString(m.get_LanguageData("label_raid_boss_remain_life"),this.m_boss.remain_hp.toLocaleString("en"),this.m_boss.max_hp.toLocaleString("en")),LABEL_FONT_INDEX.FONT_161);if(remain_hp.enableOutline(cc.color.BLACK,1),remain_hp.setAnchorPoint(ANCHOR_MIDDLE()),remain_hp.setPosition(Math.floor(ccCenter(life_bar_bg).x),Math.floor(ccCenter(life_bar_bg).y+1)),life_bar_bg.addChild(remain_hp),USE_SP_RAIDBOSS_SCALE)if(m_user_id==this.m_boss.discovered_user_id){(start_btn=new ccui.Button(RES_CDN_DEFULT+"menu_raid/btn_raid_start_off.png",RES_CDN_DEFULT+"menu_raid/btn_raid_start_on.png")).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),start_btn.setPosition(Math.floor(.5*winSize.width),10),start_btn.setScale(2),this.m_base_layer.addChild(start_btn),start_btn.addClickEventListener(function(sender){this.battleStart()}.bind(this));var ticket_count=m.get_CountFunction(18).value;(ticket=cmLabel.getLabel(cmString("%d",ticket_count),LABEL_FONT_INDEX.FONT_247)).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),ticket.setPosition(start_btn.getPosition().x+95,ccCenter(start_btn).y+30),this.m_base_layer.addChild(ticket)}else{(start_btn=new ccui.Button(RES_CDN_DEFULT+"menu_raid/btn_raid_help_start_off.png",RES_CDN_DEFULT+"menu_raid/btn_raid_help_start_on.png")).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),start_btn.setPosition(Math.floor(.5*winSize.width),10),start_btn.setScale(2),this.m_base_layer.addChild(start_btn),start_btn.addClickEventListener(function(sender){this.battleStart()}.bind(this));ticket_count=m.get_CountFunction(7).value;(ticket=cmLabel.getLabel(cmString("%d",ticket_count),LABEL_FONT_INDEX.FONT_247)).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),ticket.setPosition(start_btn.getPosition().x+95,ccCenter(start_btn).y+30),this.m_base_layer.addChild(ticket)}else if(m_user_id==this.m_boss.discovered_user_id){(start_btn=new ccui.Button(RES_CDN_DEFULT+"menu_raid/btn_raid_start_off.png",RES_CDN_DEFULT+"menu_raid/btn_raid_start_on.png")).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),start_btn.setPosition(Math.floor(.5*winSize.width),10),this.m_base_layer.addChild(start_btn),start_btn.addClickEventListener(function(sender){this.battleStart()}.bind(this));ticket_count=m.get_CountFunction(18).value;(ticket=cmLabel.getLabel(cmString("%d",ticket_count),LABEL_FONT_INDEX.FONT_247)).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),ticket.setPosition(290,ccCenter(start_btn).y),start_btn.addChild(ticket)}else{var start_btn;(start_btn=new ccui.Button(RES_CDN_DEFULT+"menu_raid/btn_raid_help_start_off.png",RES_CDN_DEFULT+"menu_raid/btn_raid_help_start_on.png")).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),start_btn.setPosition(Math.floor(.5*winSize.width),10),this.m_base_layer.addChild(start_btn),start_btn.addClickEventListener(function(sender){this.battleStart()}.bind(this));var ticket;ticket_count=m.get_CountFunction(7).value;(ticket=cmLabel.getLabel(cmString("%d",ticket_count),LABEL_FONT_INDEX.FONT_247)).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),ticket.setPosition(290,ccCenter(start_btn).y),start_btn.addChild(ticket)}GameDefault.getInstance().getUserRaidBossElementTroopsNum(this.m_boss.raid_boss_info_idx).done(function(num){var troops=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_raid/img_raid_ready_%d.png",num));troops.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),troops.setPosition(0,79),this.m_base_layer.addChild(troops)}.bind(this));var btn=new LabelButton("btn_25_off.png","btn_25_on.png","",ccui.Widget.PLIST_TEXTURE);if(btn.setFont(LABEL_FONT_INDEX.FONT_241),btn.setString(m.get_LanguageData("btn_label_arrangement_2")),btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn.setPosition(10,10),btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_RaidBossBattleReadyScene],NOTIFY_MENU_YUNHEE_SET)}),this.m_base_layer.addChild(btn),this.m_partin_btn=new LabelButton("btn_25_off.png","btn_25_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_partin_btn.setFont(LABEL_FONT_INDEX.FONT_201),this.m_partin_btn.setString(cmString(m.get_LanguageData("label_raid_boss_partin_list_title_2"),this.m_boss.part_in_count)),this.m_partin_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_partin_btn.setPosition(winSize.width-10,10),this.m_partin_btn.addClickEventListener(function(sender){RAID_BOSS_MODAL_OPEN_FLAG=!0,this.reqRaidBossPartinList()}.bind(this)),this.m_base_layer.addChild(this.m_partin_btn),this.m_beforeDamage=BattleContext._getInstance().getUserRaidBossBeforeDamage(),0<this.m_beforeDamage){var before_damage_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_damagebox.png");before_damage_bg.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),before_damage_bg.setPosition(winSize.width-7,503),this.m_base_layer.addChild(before_damage_bg);var before_damage_label=cmLabel.getLabel(cmString("%s",Number(this.m_beforeDamage).toLocaleString("en")),LABEL_FONT_INDEX.FONT_261);before_damage_label.enableOutline(cc.color.BLACK,2),before_damage_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),before_damage_label.setPosition(ccCenter(before_damage_bg).x,12),before_damage_bg.addChild(before_damage_label)}var modalSize=cc.size(winSize.width,640);this.m_partin_modal_layer=new GameMessageBox,this.m_partin_modal_layer.setContentSize(modalSize),this.addChild(this.m_partin_modal_layer,99999)},battleStart:function(){this.m_userItem_info=null,this.m_user_info=NetService().get_User_info(),this.m_userInfo_check=!0,this.m_userItem_info=NetService().get_UserItemInfo_V2(),this.m_userItemInfo_check=!0;var raid_boss=BattleContext._getInstance().getRaidBossData();GameDefault.getInstance().getUserRaidBossElementTroopsNum(raid_boss.raid_boss_info_idx).done(function(num){if(this.m_troops_num=num,GameDefault.getInstance().setUserRaidBossTroopsNum(this.m_troops_num),this.m_troopsNum_check=!0,1==this.m_userInfo_check&&1==this.m_userItemInfo_check&&1==this.m_troopsNum_check){this.m_userInfo_check=!1,this.m_userItemInfo_check=!1,this.m_troopsNum_check=!1;var need_ticket=MasterManager.getInstance().get_CountFunction(7).value;if(this.IsEmptyTroops(this.m_troops_num))return void MainObserver.getInstance().postNotification(sceneStr[scene_RaidBossBattleReadyScene],RaidBossEnum.popup_empty_troops);if(m_user_id==this.m_boss.discovered_user_id){if(this.m_userItem_info.raid_ticket_cnt<need_ticket)return void MainObserver.getInstance().postNotification(sceneStr[scene_RaidBossBattleReadyScene],RaidBossEnum.lack_raid_ticket)}else if(this.m_userItem_info.raid_help_ticket_cnt<need_ticket)return void MainObserver.getInstance().postNotification(sceneStr[scene_RaidBossBattleReadyScene],RaidBossEnum.lack_raid_help_ticket);var n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),end_dt=this.m_boss.end_dt;if(moment(end_dt).valueOf()<n)return void MainObserver.getInstance().postNotification(sceneStr[scene_RaidBossBattleReadyScene],RaidBossEnum.popup_already_end_time);0==this.m_beforeDamage?MainObserver.getInstance().postNotification(sceneStr[scene_RaidBossBattleReadyScene],RaidBossEnum.raid_boss_battle_start):MainObserver.getInstance().postNotification(sceneStr[scene_RaidBossBattleReadyScene],RaidBossEnum.raid_boss_select_battle)}}.bind(this))},IsEmptyTroops:function(troops_num){return 0==GeneralService.getInstance().getUserTroopsGeneralList(troops_num).filter(function(gnrl){return gnrl.troops_num==troops_num}).length},reqRaidBossPartinList:function(){var req={};req.opcode=net.OP.op_raid_boss_partin_user_list,req.discovered_user_id=this.m_boss.discovered_user_id,req.raid_boss_period_idx=this.m_boss.raid_boss_period_idx,req.raid_boss_num=this.m_boss.raid_boss_num,req.list_type=0;var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent)},showRaidBossPartinListPopup:function(list){this.m_partin_modal_layer._contentNode=function(contentSize,m){var layer=new cc.Layer,popup=new RaidBossPartInUserListLayer;return popup.setRaidBossPartinUserList(list,this.m_boss.activity_type,0),popup._callback_close_popup=this.hideRaidBossPartInUserList.bind(this),layer.setContentSize(popup.getContentSize()),layer.setPosition(Math.floor(.5*this.getContentSize())),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),layer.addChild(popup),popup.setPosition(ccCenter(layer)),this.m_partin_modal_layer.setContentSize(layer.getContentSize()),layer}.bind(this),this.m_partin_btn.setString("参加者 "+list.length+"/20"),this.m_boss.part_in_count=list.length,this.m_partin_modal_layer.is_show()||this.m_partin_modal_layer.show()},hideRaidBossPartInUserList:function(){this.m_partin_modal_layer.is_show()&&this.m_partin_modal_layer.hide()}}),RaidBossBattleReadyScene=GameScene.extend({m_battle_ready_layer:null,m_selectBattleModalLayer:null,m_game_type:null,ctor:function(){this.m_battle_ready_layer=null,this.m_selectBattleModalLayer=null,this.m_game_type=db.BattleGameType.RaidDungeon,this._super(scene_RaidBossBattleReadyScene)},init:function(){var win_size=cc.director.getWinSize();this.m_battle_ready_layer=new RaidBossBattleReadyLayer,this.m_battle_ready_layer.setPosition(ccCenter(win_size)),this.addChild(this.m_battle_ready_layer);var statusLayer=new StatusLayer(INVOKER_TYPE.raid_boss);statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer);var title,back_btn=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png","");(back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(){1!=RAID_BOSS_MODAL_OPEN_FLAG&&this.back()}.bind(this)),this.addChild(back_btn),USE_SP_RAIDBOSS_SCALE)?((title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_raid.png")).setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title)):((title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_raid.png")).setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title));this.m_selectBattleModalLayer=new GameModalLayer,this.m_selectBattleModalLayer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_selectBattleModalLayer.setPosition(ccCenter(win_size).x,ccCenter(win_size).y+13),this.addChild(this.m_selectBattleModalLayer,99e3)},onEnter:function(){this._super(),this.playMainBGM(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_RaidBossBattleReadyScene])},onExit:function(){this._super(),MainObserver.getInstance().removeObserver(sceneStr[scene_RaidBossBattleReadyScene])},onNotification:function(msg){switch(this._super(msg),msg){case RaidBossEnum.raid_boss_battle_start:BattleContext._getInstance().setRaidBossBattleSkip(!1),this.reqRaidBossBattleStart();break;case NOTIFY_MENU_YUNHEE_SET:this.m_game_type!=db.BattleGameType.None&&GameContext.getInstance().setYunheeArrangeMode(!0),BattleContext._getInstance().setGameType(this.m_game_type);var scene=new YunheeScene;scene.get_story_deferred().done(function(){this.scheduleOnce(function(dt){RAID_PREV_SCENE=!0,SceneManager.getInstance().replaceScene(scene,!0),scene=null},YUNHEE_DELAY_TIME,"main_layer_ready")}.bind(this));break;case RaidBossEnum.popup_empty_troops:this.showNoGeneralInTroops();break;case RaidBossEnum.lack_raid_ticket:this.showNotEnoughRaidTicket();break;case RaidBossEnum.lack_raid_help_ticket:this.showNotEnoughRaidHelpTicket();break;case RaidBossEnum.popup_already_end_time:this.showAlreadyBossTimeLimitRetreat();break;case RaidBossEnum.raid_boss_select_battle:this.showSelectBattle();break;case RaidBossEnum.raid_boss_skip_battle_start:BattleContext._getInstance().setRaidBossBattleSkip(!0),this.reqRaidBossBattleStart()}return!0},onNetworkEvent:function(opcode,state,body){if(this._super(opcode,state,body),opcode==net.OP.op_raid_boss_battle_start)if(body.error==net.ERROR.NET_E_ALREADY_PART_IN_MEMBER_FULL)(msg=[]).push(res_str("label_raid_boss_already_part_in_memeber_full_error_msg")),this.showMsgBox(msg),msg=null;else if(body.error==net.ERROR.NET_E_ALREADY_CLEARED){(msg=[]).push(res_str("label_raid_boss_already_win_error_msg")),this.showMsgBox(msg),msg=null}else if(body.error==net.ERROR.NET_E_ALREADY_RETREAT){var msg;(msg=[]).push(res_str("label_raid_boss_already_retreat_error_msg")),this.showMsgBox(msg),msg=null}else if(body.error==net.ERROR.NET_E_INVALID_ENTRANCE_TIME)this.showAlreadyBossTimeLimitRetreat();else if(body.error==net.ERROR.NET_E_LACK_TICKET)this.showNotEnoughRaidTicket();else{GameDefault.getInstance().getUserRaidBossTroopsNum().done(function(num){var service=BattleService.getInstance(),context=BattleContext._getInstance(),dungeon=context.getRaidDungeonData();dungeon.data=body.raid_boss_info,context.setRaidBossData(body.raid_boss_info),context.setBeforeBattleUserInfo(),context.setGameType(db.BattleGameType.RaidDungeon),context.setBeforeBattleUserInfoByTroops(num),service.getRaidDungeonStageNpc(0,dungeon),context.setRaidDungeonData(dungeon);var scene=new BattleSceneLayer;SceneManager.getInstance().replaceScene(scene),scene=null})}else opcode==net.OP.op_raid_boss_partin_user_list?null!=body.partin_user_list&&this.m_battle_ready_layer.showRaidBossPartinListPopup(body.partin_user_list):opcode==net.OP.op_shop_buy_raid_help_ticket&&null!=body.shop_id&&this.showBuyRaidHelpTicketComplete(body.shop_id)},back:function(){this.onKeyBack(!0)},reqRaidBossBattleStart:function(){var raid_boss=BattleContext._getInstance().getRaidBossData();GameDefault.getInstance().getUserRaidBossElementTroopsNum(raid_boss.raid_boss_info_idx).done(function(rVal){var req={};req.opcode=net.OP.op_raid_boss_battle_start,req.discovered_user_id=raid_boss.discovered_user_id,req.raid_boss_period_idx=raid_boss.raid_boss_period_idx,req.raid_boss_num=raid_boss.raid_boss_num,req.troops_num=rVal,this.network_write(req)}.bind(this))},showNoGeneralInTroops:function(){this.m_box.setTitle(res_str("label_deck_empty_title")),this.m_box.setText(res_str("label_deck_empty_content_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_deck_empty_content_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showAlreadyBossTimeLimitRetreat:function(){this.m_box.setTitle(res_str("label_common_information")),this.m_box.setText(res_str("label_raid_boss_already_time_out")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.back(),this.m_box.hide()}.bind(this))),this.m_box.show()},showNotEnoughRaidHelpTicket:function(){var jade_list=[];ShopService.getInstance().getShopJadeInfoList(jade_list);for(var buy_type=0,price=0,idx=0;idx<jade_list.length;idx++){var shop=jade_list[idx];if(shop.bonus_type==BONUS_TYPE_RAID_HELP_TICKET_REFILL){buy_type=shop.buy_type,price=shop.price;break}}var buy=MasterManager.getInstance().get_BuyType(buy_type);this.m_box.setTitle(res_str("label_raid_boss_help_ticket_lack_title")),this.m_box.setText(res_str("label_raid_boss_help_ticket_lack_text_1")),this.m_box.setText("\n"),this.m_box.setText(cmString(res_str("label_raid_boss_help_ticket_lack_text_2"),buy.name,price)),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.reqBuyRaidHelpTicket()},0,"showNotEnoughRaidHelpTicket"),this.m_box.hide()}.bind(this))),this.m_box.show()},reqBuyRaidHelpTicket:function(){var raid_help_ticket_item={},itemList=[];ShopService.getInstance().getShopJadeInfoList(itemList);for(var idx=0;idx<itemList.length;idx++){var shop=itemList[idx];if(shop.bonus_type==BONUS_TYPE_RAID_HELP_TICKET_REFILL){raid_help_ticket_item=shop;break}}var item=NetService().get_UserItemInfo_V2();if(raid_help_ticket_item.price>item.jade_cnt)this.showNotEnoughJade(!0);else if(0!=raid_help_ticket_item.shop_id){var req={};req.opcode=net.OP.op_shop_buy_raid_help_ticket,req.shop_id=raid_help_ticket_item.shop_id,req.buy_count=1,this.network_write(req)}},showBuyRaidHelpTicketComplete:function(shop_id){ShopService.getInstance().getShopInfo(shop_id,{}),this.m_box.setTitle(res_str("label_buy_complete")),this.m_box.setText(res_str("label_raid_boss_help_ticket_buy_complete")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showSelectBattle:function(){this.m_selectBattleModalLayer.setContentSize(ccSize(this)),this.m_selectBattleModalLayer._contentNode=function(contentSize,m){if(USE_SP_RAIDBOSS_SCALE)var layer=this.getSelectBattleLayer_SP();else layer=this.getSelectBattleLayer();return layer}.bind(this),this.m_selectBattleModalLayer.show()},getSelectBattleLayer:function(){var layer=new cc.Layer,win_size=cc.director.getWinSize(),bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",RectZero());bg.setInsetLeft(44),bg.setInsetRight(44),bg.setInsetTop(44),bg.setInsetBottom(44),bg.setPreferredSize(cc.size(680,405)),bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(win_size)),layer.addChild(bg);var navi=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_navi.png",RectZero());navi.setInsetLeft(46),navi.setInsetRight(46),navi.setPreferredSize(cc.size(664,48)),navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(bg).x,ccHeight(bg)-11),bg.addChild(navi);var title_label=cmLabel.getLabel(res_str("label_information_title"),LABEL_FONT_INDEX.FONT_241);title_label.setAnchorPoint(ANCHOR_MIDDLE()),title_label.setPosition(ccCenter(navi)),navi.addChild(title_label);var back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);back_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),back_btn.setPosition(ccWidth(navi)-11,7),back_btn.addClickEventListener(function(sender){this.m_selectBattleModalLayer.hide()}.bind(this)),navi.addChild(back_btn);var beforeDamage=BattleContext._getInstance().getUserRaidBossBeforeDamage(),damage_text=cmLabel.getLabel(cmString(res_str("label_raid_boss_before_damage_text"),beforeDamage),LABEL_FONT_INDEX.FONT_241);damage_text.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),damage_text.setPosition(ccCenter(bg).x,314),bg.addChild(damage_text);var not_skip_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());not_skip_bg.setPreferredSize(cc.size(312,173)),not_skip_bg.setAnchorPoint(ZERO()),not_skip_bg.setPosition(21,117),bg.addChild(not_skip_bg);var not_skip_text_1=cmLabel.getLabel(res_str("label_raid_boss_battle_not_skip_text_1"),LABEL_FONT_INDEX.FONT_181);not_skip_text_1.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),not_skip_text_1.setPosition(ccCenter(not_skip_bg).x,133),not_skip_bg.addChild(not_skip_text_1);var not_skip_text_2=cmLabel.getLabel(res_str("label_raid_boss_battle_not_skip_text_2"),LABEL_FONT_INDEX.FONT_181);not_skip_text_2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),not_skip_text_2.setPosition(ccCenter(not_skip_bg).x,113),not_skip_bg.addChild(not_skip_text_2);var not_skip_text_3=cmLabel.getLabel(res_str("label_raid_boss_battle_not_skip_text_3"),LABEL_FONT_INDEX.FONT_181);not_skip_text_3.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),not_skip_text_3.setPosition(ccCenter(not_skip_bg).x,93),not_skip_bg.addChild(not_skip_text_3);var not_skip_text_4=cmLabel.getLabel(res_str("label_raid_boss_battle_not_skip_text_4"),LABEL_FONT_INDEX.FONT_181);not_skip_text_4.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),not_skip_text_4.setPosition(ccCenter(not_skip_bg).x,73),not_skip_bg.addChild(not_skip_text_4);var not_skip_text_5=cmLabel.getLabel(res_str("label_raid_boss_battle_not_skip_text_5"),LABEL_FONT_INDEX.FONT_181);not_skip_text_5.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),not_skip_text_5.setPosition(ccCenter(not_skip_bg).x,53),not_skip_bg.addChild(not_skip_text_5);var raid_boss=BattleContext._getInstance().getRaidBossData(),not_skip_off="",not_skip_on="",skip_off="",skip_on="";skip_on=m_user_id==raid_boss.discovered_user_id?(not_skip_off=RES_CDN_DEFULT+"menu_raid/btn_raid_small_1_off.png",not_skip_on=RES_CDN_DEFULT+"menu_raid/btn_raid_small_1_on.png",skip_off=RES_CDN_DEFULT+"menu_raid/btn_raid_small_2_off.png",RES_CDN_DEFULT+"menu_raid/btn_raid_small_2_on.png"):(not_skip_off=RES_CDN_DEFULT+"menu_raid/btn_raid_small_1_help_off.png",not_skip_on=RES_CDN_DEFULT+"menu_raid/btn_raid_small_1_help_on.png",skip_off=RES_CDN_DEFULT+"menu_raid/btn_raid_small_2_help_off.png",RES_CDN_DEFULT+"menu_raid/btn_raid_small_2_help_on.png");var not_skip_btn=new ccui.Button(not_skip_off,not_skip_on);not_skip_btn.setAnchorPoint(ZERO()),not_skip_btn.setPosition(28,35),not_skip_btn.addClickEventListener(function(sender){this.m_selectBattleModalLayer.hide(),this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_RaidBossBattleReadyScene],RaidBossEnum.raid_boss_battle_start)},0,"raid_boss_battle_start")}.bind(this)),bg.addChild(not_skip_btn);var need_ticket=MasterManager.getInstance().get_CountFunction(7).value,not_skip_ticket_label=cmLabel.getLabel(cmString("%d",need_ticket),LABEL_FONT_INDEX.FONT_2011);not_skip_ticket_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),not_skip_ticket_label.setPosition(248,21),not_skip_btn.addChild(not_skip_ticket_label);var skip_bg=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());skip_bg.setPreferredSize(cc.size(312,173)),skip_bg.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),skip_bg.setPosition(ccWidth(bg)-21,117),bg.addChild(skip_bg);var skip_text_1=cmLabel.getLabel(res_str("label_raid_boss_battle_skip_text_1"),LABEL_FONT_INDEX.FONT_181);skip_text_1.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),skip_text_1.setPosition(ccCenter(skip_bg).x,133),skip_bg.addChild(skip_text_1);var skip_text_2=cmLabel.getLabel(res_str("label_raid_boss_battle_skip_text_2"),LABEL_FONT_INDEX.FONT_181);skip_text_2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),skip_text_2.setPosition(ccCenter(skip_bg).x,113),skip_bg.addChild(skip_text_2);var skip_text_3=cmLabel.getLabel(res_str("label_raid_boss_battle_skip_text_3"),LABEL_FONT_INDEX.FONT_181);skip_text_3.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),skip_text_3.setPosition(ccCenter(skip_bg).x,93),skip_bg.addChild(skip_text_3);var skip_btn=new ccui.Button(skip_off,skip_on);skip_btn.setAnchorPoint(ZERO()),skip_btn.setPosition(352,35),skip_btn.addClickEventListener(function(sender){this.m_selectBattleModalLayer.hide(),this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_RaidBossBattleReadyScene],RaidBossEnum.raid_boss_skip_battle_start)},0,"raid_boss_skip_battle_start")}.bind(this)),bg.addChild(skip_btn);var skip_ticket_label=cmLabel.getLabel(cmString("%d",need_ticket),LABEL_FONT_INDEX.FONT_2011);return skip_ticket_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),skip_ticket_label.setPosition(248,21),skip_btn.addChild(skip_ticket_label),layer},getSelectBattleLayer_SP:function(){var layer=new cc.Layer,win_size=cc.director.getWinSize(),bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",RectZero());bg.setInsetLeft(44),bg.setInsetRight(44),bg.setInsetTop(44),bg.setInsetBottom(44),bg.setPreferredSize(cc.size(680,405)),bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(win_size)),layer.addChild(bg);var navi=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_navi.png",RectZero());navi.setInsetLeft(46),navi.setInsetRight(46),navi.setPreferredSize(cc.size(664,48)),navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(bg).x,ccHeight(bg)-11),bg.addChild(navi);var title_label=cmLabel.getLabel(res_str("label_information_title"),LABEL_FONT_INDEX.FONT_241);title_label.setAnchorPoint(ANCHOR_MIDDLE()),title_label.setPosition(ccCenter(navi)),navi.addChild(title_label);var back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);back_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),back_btn.setPosition(ccWidth(navi)-11,7),back_btn.addClickEventListener(function(sender){this.m_selectBattleModalLayer.hide()}.bind(this)),navi.addChild(back_btn);var beforeDamage=BattleContext._getInstance().getUserRaidBossBeforeDamage(),damage_text=cmLabel.getLabel(cmString(res_str("label_raid_boss_before_damage_text"),beforeDamage),LABEL_FONT_INDEX.FONT_241);damage_text.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),damage_text.setPosition(ccCenter(bg).x,314),bg.addChild(damage_text);var not_skip_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());not_skip_bg.setPreferredSize(cc.size(312,173)),not_skip_bg.setAnchorPoint(ZERO()),not_skip_bg.setPosition(21,117),bg.addChild(not_skip_bg);var not_skip_text_1=cmLabel.getLabel(res_str("label_raid_boss_battle_not_skip_text_1"),LABEL_FONT_INDEX.FONT_181);not_skip_text_1.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),not_skip_text_1.setPosition(ccCenter(not_skip_bg).x,133),not_skip_bg.addChild(not_skip_text_1);var not_skip_text_2=cmLabel.getLabel(res_str("label_raid_boss_battle_not_skip_text_2"),LABEL_FONT_INDEX.FONT_181);not_skip_text_2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),not_skip_text_2.setPosition(ccCenter(not_skip_bg).x,113),not_skip_bg.addChild(not_skip_text_2);var not_skip_text_3=cmLabel.getLabel(res_str("label_raid_boss_battle_not_skip_text_3"),LABEL_FONT_INDEX.FONT_181);not_skip_text_3.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),not_skip_text_3.setPosition(ccCenter(not_skip_bg).x,93),not_skip_bg.addChild(not_skip_text_3);var not_skip_text_4=cmLabel.getLabel(res_str("label_raid_boss_battle_not_skip_text_4"),LABEL_FONT_INDEX.FONT_181);not_skip_text_4.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),not_skip_text_4.setPosition(ccCenter(not_skip_bg).x,73),not_skip_bg.addChild(not_skip_text_4);var not_skip_text_5=cmLabel.getLabel(res_str("label_raid_boss_battle_not_skip_text_5"),LABEL_FONT_INDEX.FONT_181);not_skip_text_5.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),not_skip_text_5.setPosition(ccCenter(not_skip_bg).x,53),not_skip_bg.addChild(not_skip_text_5);var raid_boss=BattleContext._getInstance().getRaidBossData(),not_skip_off="",not_skip_on="",skip_off="",skip_on="";skip_on=m_user_id==raid_boss.discovered_user_id?(not_skip_off=RES_CDN_DEFULT+"menu_raid/btn_raid_small_1_off.png",not_skip_on=RES_CDN_DEFULT+"menu_raid/btn_raid_small_1_on.png",skip_off=RES_CDN_DEFULT+"menu_raid/btn_raid_small_2_off.png",RES_CDN_DEFULT+"menu_raid/btn_raid_small_2_on.png"):(not_skip_off=RES_CDN_DEFULT+"menu_raid/btn_raid_small_1_help_off.png",not_skip_on=RES_CDN_DEFULT+"menu_raid/btn_raid_small_1_help_on.png",skip_off=RES_CDN_DEFULT+"menu_raid/btn_raid_small_2_help_off.png",RES_CDN_DEFULT+"menu_raid/btn_raid_small_2_help_on.png");var not_skip_btn=new ccui.Button(not_skip_off,not_skip_on);not_skip_btn.setAnchorPoint(ZERO()),not_skip_btn.setPosition(28,35),not_skip_btn.setScale(2),not_skip_btn.addClickEventListener(function(sender){this.m_selectBattleModalLayer.hide(),this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_RaidBossBattleReadyScene],RaidBossEnum.raid_boss_battle_start)},0,"raid_boss_battle_start")}.bind(this)),bg.addChild(not_skip_btn);var need_ticket=MasterManager.getInstance().get_CountFunction(7).value,not_skip_ticket_label=cmLabel.getLabel(cmString("%d",need_ticket),LABEL_FONT_INDEX.FONT_2011);not_skip_ticket_label.setAnchorPoint(ZERO()),not_skip_ticket_label.setPosition(not_skip_btn.getPosition().x+242,not_skip_btn.getPosition().y+21),bg.addChild(not_skip_ticket_label,1);var skip_bg=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());skip_bg.setPreferredSize(cc.size(312,173)),skip_bg.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),skip_bg.setPosition(ccWidth(bg)-21,117),bg.addChild(skip_bg);var skip_text_1=cmLabel.getLabel(res_str("label_raid_boss_battle_skip_text_1"),LABEL_FONT_INDEX.FONT_181);skip_text_1.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),skip_text_1.setPosition(ccCenter(skip_bg).x,133),skip_bg.addChild(skip_text_1);var skip_text_2=cmLabel.getLabel(res_str("label_raid_boss_battle_skip_text_2"),LABEL_FONT_INDEX.FONT_181);skip_text_2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),skip_text_2.setPosition(ccCenter(skip_bg).x,113),skip_bg.addChild(skip_text_2);var skip_text_3=cmLabel.getLabel(res_str("label_raid_boss_battle_skip_text_3"),LABEL_FONT_INDEX.FONT_181);skip_text_3.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),skip_text_3.setPosition(ccCenter(skip_bg).x,93),skip_bg.addChild(skip_text_3);var skip_btn=new ccui.Button(skip_off,skip_on);skip_btn.setAnchorPoint(ZERO()),skip_btn.setPosition(352,35),skip_btn.setScale(2),skip_btn.addClickEventListener(function(sender){this.m_selectBattleModalLayer.hide(),this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_RaidBossBattleReadyScene],RaidBossEnum.raid_boss_skip_battle_start)},0,"raid_boss_skip_battle_start")}.bind(this)),bg.addChild(skip_btn);var skip_ticket_label=cmLabel.getLabel(cmString("%d",need_ticket),LABEL_FONT_INDEX.FONT_2011);return skip_ticket_label.setAnchorPoint(ZERO()),skip_ticket_label.setPosition(skip_btn.getPosition().x+242,skip_btn.getPosition().y+21),bg.addChild(skip_ticket_label,1),layer}}),RaidBossEntranceEnum={BTN_SHOW_HELP:900,BTN_SHOW_HELP_AT_POINT:901,shotcut_event_dungeon_entrance:97674},RaidBossEntranceLayer=cc.Layer.extend({m_base_layer:null,m_raid_point:null,m_winSize:null,m_achv_new_icon:null,m_gnrl_img:null,m_period:null,m_first_period_idx:0,m_second_period_idx:0,m_is_prv_event_dungeon:!1,onEnter:function(){null!=this.m_achv_new_icon&&(AchievementService.getInstance().isNewCompleteAchievementByType(ACHIEVEMENT_RAID_BOSS)||this.m_achv_new_icon.setVisible(!1))},onExit:function(){if(this._super(),!PREV_HELP&&null!=this.m_gnrl_img){for(var idx=0;idx<this.m_gnrl_img.length;idx++)cc.loader.release(this.m_gnrl_img[idx]);this.m_gnrl_img=null}},ctor:function(){this._super(),this.m_base_layer=null,this.m_raid_point=null,this.m_gnrl_img=[],this.init()},init:function(){this.m_winSize=ccSize(this),this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var service=EventDungeonService.getInstance(),event_dungeon_period_idx=0;this.m_is_prv_event_dungeon=BattleContext._getInstance().getIsPrvEventDungeon(),event_dungeon_period_idx=this.m_is_prv_event_dungeon?BattleContext._getInstance().getPrvEventDungeonPeriodIdx():BattleContext._getInstance().getEventDungeonPeriodIdx();this.m_period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),this.m_first_period_idx=service.getEventDungeonFirstHalfPeriodIdx(this.m_period.event_dungeon_group_idx),this.m_second_period_idx=service.getEventDungeonSecondHalfPeriodIdx(this.m_period.event_dungeon_group_idx),this.m_base_layer=new cc.Layer,this.m_base_layer.ignoreAnchorPointForPosition(!1),this.m_base_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_base_layer.setPosition(ccCenter(this.m_winSize)),this.addChild(this.m_base_layer),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/btn_raid_01_off.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/btn_raid_01_on.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/btn_raid_02_off.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/btn_raid_02_on.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/img_raid_boss_text.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/img_raid_pt.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/btn_raid_gacha_off.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/btn_raid_gacha_on.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/img_raid_banner.png"),resourceLoader(this.m_gnrl_img,function(){USE_SP_RAIDBOSS_SCALE?this.createInfoBoxLayer_SP():this.createInfoBoxLayer()}.bind(this))},createInfoBoxLayer:function(){var help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE);help_btn.setAnchorPoint(ZERO()),help_btn.setPosition(10,473),this.m_base_layer.addChild(help_btn),help_btn.addClickEventListener(function(sender){this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_RaidBossEntranceScene],RaidBossEntranceEnum.BTN_SHOW_HELP)},0,"EUQIP_SHOW_HELP")});var achv_btn=new LabelButton("btn_36_off.png","btn_36_on.png","",ccui.Widget.PLIST_TEXTURE);achv_btn.setFont(LABEL_FONT_INDEX.FONT_181),achv_btn.setString(res_str("btn_label_achievement")),achv_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),achv_btn.setPosition(this.m_winSize.width-10,10),achv_btn.addClickEventListener(function(sender){GameContext.getInstance().setAchievementTap(ACHIEVEMENT_RAID_BOSS),MainObserver.getInstance().postNotification(sceneStr[scene_RaidBossEntranceScene],NOTIFY_MENU_ACHIEV)}.bind(this)),this.m_base_layer.addChild(achv_btn),this.m_achv_new_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_achv_new_icon.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_achv_new_icon.setPosition(ccWidth(achv_btn)+10,ccHeight(achv_btn)+12),achv_btn.addChild(this.m_achv_new_icon),AchievementService.getInstance().isNewCompleteAchievementByType(ACHIEVEMENT_RAID_BOSS)||this.m_achv_new_icon.setVisible(!1);var btn_2=new ccui.Button(RES_CDN_DEFULT+"menu_raid/btn_raid_01_off.png",RES_CDN_DEFULT+"menu_raid/btn_raid_01_on.png");btn_2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn_2.setPosition(.5*this.m_winSize.width-ccWidth(btn_2)/2-5,10),this.m_base_layer.addChild(btn_2),btn_2.addClickEventListener(function(sender){var req={};req.opcode=net.OP.op_get_server_time_check,this.getParent().network_write(req),BattleContext._getInstance().setRaidBossStartTabIndex(RAID_BOSS_TAB_CALL);var scene=new RaidBossListScene;SceneManager.getInstance().replaceScene(scene),scene=null}.bind(this));var btn_3=new ccui.Button(RES_CDN_DEFULT+"menu_raid/btn_raid_02_off.png",RES_CDN_DEFULT+"menu_raid/btn_raid_02_on.png");btn_3.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn_3.setPosition(.5*this.m_winSize.width+ccWidth(btn_3)/2+5,10),this.m_base_layer.addChild(btn_3),btn_3.addClickEventListener(function(sender){var req={};req.opcode=net.OP.op_get_server_time_check,this.getParent().network_write(req),BattleContext._getInstance().setRaidBossStartTabIndex(RAID_BOSS_TAB_LIST);var scene=new RaidBossListScene;SceneManager.getInstance().replaceScene(scene),scene=null}.bind(this));var boss_text=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_boss_text.png");boss_text.setAnchorPoint(ANCHOR_TOP_RIGHT()),boss_text.setPosition(this.m_winSize.width-10,this.m_winSize.height-65),IS_SP_BROWSER?boss_text.setScale(2):boss_text.setScale(1),this.m_base_layer.addChild(boss_text);var raid_banner=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_banner.png");raid_banner.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),raid_banner.setPosition(0,172),this.m_base_layer.addChild(raid_banner);var help_btn_at_point=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE);help_btn_at_point.setAnchorPoint(ZERO()),help_btn_at_point.setPosition(ccWidth(raid_banner),ccPosY(raid_banner)),this.m_base_layer.addChild(help_btn_at_point),help_btn_at_point.addClickEventListener(function(sender){this.scheduleOnce(function(float){PREV_HELP=!0,MainObserver.getInstance().postNotification(sceneStr[scene_RaidBossEntranceScene],RaidBossEntranceEnum.BTN_SHOW_HELP_AT_POINT)},0,"BTN_SHOW_HELP_AT_POINT")});var raid_point_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_pt.png");raid_point_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),raid_point_box.setPosition(0,120),this.m_base_layer.addChild(raid_point_box);var raid_boss_period_idx=RaidBossService.getInstance().getCurrentRaidBossPeriodInfo(!0);this.m_raid_point=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_247),this.m_raid_point.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_raid_point.setPosition(124,.5*ccHeight(raid_point_box)),raid_point_box.addChild(this.m_raid_point);var raid_point=NetService().get_User_Raid_Point(raid_boss_period_idx);this.m_raid_point.setString(Number(raid_point).toLocaleString("en"));var btn=new ccui.Button(RES_CDN_DEFULT+"menu_raid/btn_raid_gacha_off.png",RES_CDN_DEFULT+"menu_raid/btn_raid_gacha_on.png");btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn.setPosition(10,10),this.m_base_layer.addChild(btn),btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_RaidBossEntranceScene],NOTIFY_MENU_GACHA_RAID)})},createInfoBoxLayer_SP:function(){var help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE);help_btn.setAnchorPoint(ZERO()),help_btn.setPosition(10,473),this.m_base_layer.addChild(help_btn),help_btn.addClickEventListener(function(sender){this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_RaidBossEntranceScene],RaidBossEntranceEnum.BTN_SHOW_HELP)},0,"EUQIP_SHOW_HELP")});var achv_btn=new LabelButton("btn_36_off.png","btn_36_on.png","",ccui.Widget.PLIST_TEXTURE);achv_btn.setFont(LABEL_FONT_INDEX.FONT_181),achv_btn.setString(res_str("btn_label_achievement")),achv_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),achv_btn.setPosition(this.m_winSize.width-10,10),achv_btn.addClickEventListener(function(sender){GameContext.getInstance().setAchievementTap(ACHIEVEMENT_RAID_BOSS),MainObserver.getInstance().postNotification(sceneStr[scene_RaidBossEntranceScene],NOTIFY_MENU_ACHIEV)}.bind(this)),this.m_base_layer.addChild(achv_btn),this.m_achv_new_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_achv_new_icon.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_achv_new_icon.setPosition(ccWidth(achv_btn)+10,ccHeight(achv_btn)+12),achv_btn.addChild(this.m_achv_new_icon),AchievementService.getInstance().isNewCompleteAchievementByType(ACHIEVEMENT_RAID_BOSS)||this.m_achv_new_icon.setVisible(!1);var btn_2=new ccui.Button(RES_CDN_DEFULT+"menu_raid/btn_raid_01_off.png",RES_CDN_DEFULT+"menu_raid/btn_raid_01_on.png");btn_2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn_2.setPosition(.5*this.m_winSize.width-ccWidth(btn_2)/2*2-5,10),btn_2.setScale(2),this.m_base_layer.addChild(btn_2),btn_2.addClickEventListener(function(sender){var req={};req.opcode=net.OP.op_get_server_time_check,this.getParent().network_write(req),BattleContext._getInstance().setRaidBossStartTabIndex(RAID_BOSS_TAB_CALL);var scene=new RaidBossListScene;SceneManager.getInstance().replaceScene(scene),scene=null}.bind(this));var btn_3=new ccui.Button(RES_CDN_DEFULT+"menu_raid/btn_raid_02_off.png",RES_CDN_DEFULT+"menu_raid/btn_raid_02_on.png");btn_3.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn_3.setPosition(.5*this.m_winSize.width+ccWidth(btn_3)/2*2+5,10),btn_3.setScale(2),this.m_base_layer.addChild(btn_3),btn_3.addClickEventListener(function(sender){var req={};req.opcode=net.OP.op_get_server_time_check,this.getParent().network_write(req),BattleContext._getInstance().setRaidBossStartTabIndex(RAID_BOSS_TAB_CALL);var scene=new RaidBossListScene;SceneManager.getInstance().replaceScene(scene),scene=null}.bind(this));var boss_text=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_boss_text.png");boss_text.setAnchorPoint(ANCHOR_TOP_RIGHT()),boss_text.setPosition(this.m_winSize.width-10,this.m_winSize.height-65),IS_SP_BROWSER?boss_text.setScale(2):boss_text.setScale(1),this.m_base_layer.addChild(boss_text);var raid_banner=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_banner.png");raid_banner.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),raid_banner.setScale(2),raid_banner.setPosition(0,172),this.m_base_layer.addChild(raid_banner);var help_btn_at_point=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE);help_btn_at_point.setAnchorPoint(ZERO()),help_btn_at_point.setPosition(2*ccWidth(raid_banner),ccPosY(raid_banner)),this.m_base_layer.addChild(help_btn_at_point),help_btn_at_point.addClickEventListener(function(sender){this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_RaidBossEntranceScene],RaidBossEntranceEnum.BTN_SHOW_HELP_AT_POINT)},0,"BTN_SHOW_HELP_AT_POINT")});NetService().get_UserItemInfo_V2();var raid_point_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_pt.png");raid_point_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),raid_point_box.setScale(2),raid_point_box.setPosition(0,120),this.m_base_layer.addChild(raid_point_box);var raid_boss_period_idx=RaidBossService.getInstance().getCurrentRaidBossPeriodInfo(!0);this.m_raid_point=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_247),this.m_raid_point.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_raid_point.setPosition(124,146),this.m_base_layer.addChild(this.m_raid_point);var raid_point=NetService().get_User_Raid_Point(raid_boss_period_idx);this.m_raid_point.setString(Number(raid_point).toLocaleString("en"));var btn=new ccui.Button(RES_CDN_DEFULT+"menu_raid/btn_raid_gacha_off.png",RES_CDN_DEFULT+"menu_raid/btn_raid_gacha_on.png");btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn.setPosition(10,10),btn.setScale(2),this.m_base_layer.addChild(btn),btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_RaidBossEntranceScene],NOTIFY_MENU_GACHA_RAID)})}}),RaidBossEntranceScene=GameScene.extend({m_entrance_layer:null,m_progres_bar_raid:null,m_deferred:$.Deferred(),ctor:function(){PREV_HELP=!1,this.m_entrance_layer=null,this._super(scene_RaidBossEntranceScene)},get_story_deferred:function(){return this.m_deferred},init:function(){this.initLayoutProgress_Raid();var bg,win_size=cc.director.getWinSize();USE_SP_RAIDBOSS_SCALE?((bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/bg_raid_banner.jpg")).setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(win_size)),bg.setScale(2),this.addChild(bg)):((bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/bg_raid_banner.jpg")).setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(win_size)),this.addChild(bg));this.m_entrance_layer=new RaidBossEntranceLayer,this.m_entrance_layer.setPosition(ccCenter(win_size)),this.addChild(this.m_entrance_layer);var statusLayer=new StatusLayer(INVOKER_TYPE.raid_boss);statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer);var title,back_btn=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png","");(back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(){this.back()}.bind(this)),this.addChild(back_btn),USE_SP_RAIDBOSS_SCALE)?((title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_raid.png")).setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title)):((title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_raid.png")).setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title));this.scheduleOnce(this.removeLayerProgress_Raid,1),this.m_deferred.resolve(!0),win_size=null},removeLayerProgress_Raid:function(){null!=this.m_progres_bar_raid&&(this.removeChild(this.m_progres_bar_raid),this.m_progres_bar_raid=null)},initLayoutProgress_Raid:function(){if(!IS_NET_ERROR){this.m_progres_bar_raid=new cc.LayerColor(cc.color.BLACK),this.m_progres_bar_raid.setOpacity(255),this.m_progres_bar_raid.setContentSize(ccSize(this));var bg=cc.Sprite.create(RES_CM+"img_progress_bg.png");bg.setPosition(ccCenter(this));var bar=cc.Sprite.create(RES_CM+"img_progress_arrow.png");bar.setPosition(ccCenter(bg)),bg.addChild(bar,1000001),this.m_progres_bar_raid.addChild(bg),this.addChild(this.m_progres_bar_raid,1000001);var loading=new cc.Sprite(res.s_cm_img_text_loading);loading.setAnchorPoint(.5,0),loading.setPosition(ccCenter(bg).x,ccCenter(bg).y-100),loading.setOpacity(255),bg.addChild(loading,1000001);var mu=new cc.RotateBy(.1,30),seq=new cc.Sequence(mu),repeat=new cc.RepeatForever(seq);bar.runAction(repeat),repeat=seq=mu=null;var listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE});listener.onTouchBegan=function(touch,event){event.stopPropagation()}.bind(this);var mouse_listener=cc.EventListener.create({event:cc.EventListener.MOUSE,onMouseScroll:function(event){event.stopPropagation()}.bind(this)});cc.eventManager.addListener(mouse_listener,this.m_progres_bar_raid),cc.eventManager.addListener(listener,this.m_progres_bar_raid)}},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_RaidBossEntranceScene]),this.playMainBGM()},onExit:function(){this._super(),1!=PREV_HELP&&MainObserver.getInstance().removeObserver(sceneStr[scene_RaidBossEntranceScene])},onNotification:function(msg){if(!this._super(msg)){switch(msg){case RaidBossEntranceEnum.BTN_SHOW_HELP:GameContext.getInstance().setHelpInfoIndexByCallIndex(203);var scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null;break;case RaidBossEntranceEnum.BTN_SHOW_HELP_AT_POINT:GameContext.getInstance().setHelpInfoIndexByCallIndex(206);scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null}return!0}},onNetworkEvent:function(opcode,state,body){(this._super(opcode,state,body),opcode!=net.OP.op_get_user_item&&opcode!=net.OP.op_announce_msg&&opcode!=net.OP.op_get_server_time_check)&&(opcode!=net.OP.op_get_user_achievement&&opcode!=net.OP.op_result&&(SceneManager.getInstance().isExistScene(scene_MussangEntryScene)?SceneManager.getInstance().reservedHistoryClearToScene(scene_MussangEntryScene):SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene)))},back:function(){var mng=SceneManager.getInstance(),is_exist_scene=mng.isExistScene(scene_EventDungeonEntranceScene),is_exist_scene2=mng.isExistScene(scene_EventDungeonCraftShopEntranceScene);(is_exist_scene||is_exist_scene2)&&mng.historyClearToScene(scene_MainHomeScene),this.onKeyBack(!0)}}),LIST_TYPE_CALL=0,LIST_TYPE_BATTLE=6,RaidBossListCell=cc.TableViewCell.extend({m_boss:null,m_boss_name:null,m_boss_icon:null,m_boss_life:null,m_remain_time:null,m_discovered_nickname:null,m_friend_icon:null,m_element_type:null,m_state_icon:null,m_boss_life_gauge:null,m_list_type:0,m_btn_shared:[],m_btn_battle:[],m_btn_force_retreat:[],m_btn_partin_list:[],m_btn_history_partin_list:[],m_btn_call:[],_callback_shared:null,_callback_battle:null,_callback_force_retreat:null,_callback_partin_list:null,_callback_call_boss:null,m_discovered_icon:null,m_time_icon:null,ctor:function(){this._super(),this.m_boss=null,this.m_boss_name=null,this.m_boss_icon=null,this.m_boss_life=null,this.m_remain_time=null,this.m_discovered_icon=null,this.m_discovered_nickname=null,this.m_discovered_naming=null,this.m_friend_icon=null,this.m_element_type=null,this.m_state_icon=null,this.m_boss_life_gauge=null,this.m_list_type=0,this.m_time_icon=null,this.m_btn_shared=[],this.m_btn_battle=[],this.m_btn_force_retreat=[],this.m_btn_partin_list=[],this.m_btn_history_partin_list=[],this.m_btn_call=[],this._callback_shared=null,this._callback_battle=null,this._callback_force_retreat=null,this._callback_partin_list=null,this._callback_call_boss=null,this.init()},init:function(){var cellSize=cc.size(924,112);this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(cellSize);var list_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());list_bg.setAnchorPoint(ZERO()),list_bg.setPosition(ZERO()),list_bg.setContentSize(cellSize),this.addChild(list_bg),this.m_boss_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_boss_1.png"),this.m_boss_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_boss_icon.setPosition(4,5),list_bg.addChild(this.m_boss_icon),this.m_state_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_state_join.png"),this.m_state_icon.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_state_icon.setPosition(ccCenter(this.m_boss_icon).x,0),this.m_boss_icon.addChild(this.m_state_icon),this.m_element_type=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_detail_ic_attribute_1.png"),this.m_element_type.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_element_type.setPosition(106,68),list_bg.addChild(this.m_element_type),this.m_boss_name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_201),this.m_boss_name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_boss_name.setPosition(145,78),list_bg.addChild(this.m_boss_name),this.m_discovered_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_find.png"),this.m_discovered_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_discovered_icon.setPosition(106,54),list_bg.addChild(this.m_discovered_icon),this.m_discovered_nickname=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_discovered_nickname.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_discovered_nickname.setPosition(145,54),list_bg.addChild(this.m_discovered_nickname),this.m_discovered_naming=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_discovered_naming.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_discovered_naming.setPosition(ccPosX(this.m_discovered_nickname),ccPosY(this.m_discovered_nickname)),list_bg.addChild(this.m_discovered_naming),this.m_friend_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_friend/img_friend_text_2.png"),this.m_friend_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_friend_icon.setPosition(145,50),list_bg.addChild(this.m_friend_icon),this.m_time_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_time.png"),this.m_time_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_time_icon.setPosition(106,28),list_bg.addChild(this.m_time_icon),this.m_remain_time=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_165),this.m_remain_time.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_remain_time.setPosition(145,30),list_bg.addChild(this.m_remain_time);var gauge_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero());gauge_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),gauge_bg.setPosition(106,5),gauge_bg.setPreferredSize(cc.size(814,16)),this.addChild(gauge_bg),this.m_boss_life_gauge=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_red_2.png",RectZero()),this.m_boss_life_gauge.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_boss_life_gauge.setPosition(3,3),gauge_bg.addChild(this.m_boss_life_gauge),this.m_boss_life=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_boss_life.enableOutline(cc.color.BLACK),this.m_boss_life.setAnchorPoint(ANCHOR_MIDDLE()),this.m_boss_life.setPosition(ccCenter(gauge_bg).x,ccCenter(gauge_bg).y+4),gauge_bg.addChild(this.m_boss_life);var off,off_label,on,on_label,none,none_label,offset_x=cellSize.width-13;(off=cc.Sprite.create("#btn_05_yellow_off.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),off.setPosition(offset_x,ccCenter(cellSize).y),list_bg.addChild(off),(off_label=cmLabel.getLabel(res_str("label_raid_boss_battle"),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_MIDDLE()),off_label.setPosition(ccCenter(off)),off.addChild(off_label),(on=cc.Sprite.create("#btn_05_yellow_on.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),on.setPosition(offset_x,ccCenter(cellSize).y),list_bg.addChild(on),(on_label=cmLabel.getLabel(res_str("label_raid_boss_battle"),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_MIDDLE()),on_label.setPosition(ccCenter(on)),on.addChild(on_label),this.m_btn_battle.push(off),this.m_btn_battle.push(on),(off=cc.Sprite.create("#btn_05_off.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),off.setPosition(offset_x,ccCenter(cellSize).y),list_bg.addChild(off),(off_label=cmLabel.getLabel(res_str("label_raid_boss_call"),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_MIDDLE()),off_label.setPosition(ccCenter(off)),off.addChild(off_label),(on=cc.Sprite.create("#btn_05_on.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),on.setPosition(offset_x,ccCenter(cellSize).y),list_bg.addChild(on),(on_label=cmLabel.getLabel(res_str("label_raid_boss_call"),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_MIDDLE()),on_label.setPosition(ccCenter(on)),on.addChild(on_label),(none=cc.Sprite.create("#btn_04_none.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),none.setPosition(offset_x,ccCenter(cellSize).y),list_bg.addChild(none),(none_label=cmLabel.getLabel(res_str("label_raid_boss_call"),LABEL_FONT_INDEX.FONT_202)).setAnchorPoint(ANCHOR_MIDDLE()),none_label.setPosition(ccCenter(on)),none.addChild(none_label),this.m_btn_call.push(off),this.m_btn_call.push(on),this.m_btn_call.push(none),(off=cc.Sprite.create("#btn_05_off.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),off.setPosition(offset_x,ccCenter(cellSize).y),list_bg.addChild(off),(off_label=cmLabel.getLabel(res_str("label_raid_boss_partin_list"),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_MIDDLE()),off_label.setPosition(ccCenter(off)),off.addChild(off_label),(on=cc.Sprite.create("#btn_05_on.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),on.setPosition(offset_x,ccCenter(cellSize).y),list_bg.addChild(on),(on_label=cmLabel.getLabel(res_str("label_raid_boss_partin_list"),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_MIDDLE()),on_label.setPosition(ccCenter(on)),on.addChild(on_label),this.m_btn_history_partin_list.push(off),this.m_btn_history_partin_list.push(on),offset_x-=ccWidth(off),(off=cc.Sprite.create("#btn_05_off.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),off.setPosition(offset_x,ccCenter(cellSize).y),list_bg.addChild(off),(off_label=cmLabel.getLabel(res_str("label_raid_boss_partin_list"),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_MIDDLE()),off_label.setPosition(ccCenter(off)),off.addChild(off_label),(on=cc.Sprite.create("#btn_05_on.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),on.setPosition(offset_x,ccCenter(cellSize).y),list_bg.addChild(on),(on_label=cmLabel.getLabel(res_str("label_raid_boss_partin_list"),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_MIDDLE()),on_label.setPosition(ccCenter(on)),on.addChild(on_label),this.m_btn_partin_list.push(off),this.m_btn_partin_list.push(on),(off=cc.Sprite.create("#btn_05_off.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),off.setPosition(offset_x,ccCenter(cellSize).y),list_bg.addChild(off),(off_label=cmLabel.getLabel(res_str("label_raid_boss_shared"),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_MIDDLE()),off_label.setPosition(ccCenter(off)),off.addChild(off_label),(on=cc.Sprite.create("#btn_05_on.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),on.setPosition(offset_x,ccCenter(cellSize).y),list_bg.addChild(on),(on_label=cmLabel.getLabel(res_str("label_raid_boss_shared"),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_MIDDLE()),on_label.setPosition(ccCenter(on)),on.addChild(on_label),this.m_btn_shared.push(off),this.m_btn_shared.push(on),offset_x-=ccWidth(off),(off=cc.Sprite.create("#btn_04_off.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),off.setPosition(offset_x,ccCenter(cellSize).y),list_bg.addChild(off),(off_label=cmLabel.getLabel(res_str("label_raid_boss_force_retreat"),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_MIDDLE()),off_label.setPosition(ccCenter(off)),off.addChild(off_label),(on=cc.Sprite.create("#btn_04_on.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),on.setPosition(offset_x,ccCenter(cellSize).y),list_bg.addChild(on),(on_label=cmLabel.getLabel(res_str("label_raid_boss_force_retreat"),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_MIDDLE()),on_label.setPosition(ccCenter(on)),on.addChild(on_label),(none=cc.Sprite.create("#btn_04_none.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),none.setPosition(offset_x,ccCenter(cellSize).y),list_bg.addChild(none),(none_label=cmLabel.getLabel(res_str("label_raid_boss_force_retreat"),LABEL_FONT_INDEX.FONT_202)).setAnchorPoint(ANCHOR_MIDDLE()),none_label.setPosition(ccCenter(on)),none.addChild(none_label),this.m_btn_force_retreat.push(off),this.m_btn_force_retreat.push(on),this.m_btn_force_retreat.push(none),offset_x-=ccWidth(off)},setData:function(list_type,boss){this.m_boss=boss,this.m_list_type=list_type,this.updateCell()},updateCell:function(){var boss=MasterManager.getInstance().get_RaidBossInfo(this.m_boss.raid_boss_info_idx);if(this.m_boss.activity_type==database.Raid_Boss_Activity_Type.Raid_Boss_Activity_Type_Ing&&0<this.m_boss.raid_boss_num){var boss_img=RES_CDN_DEFULT+cmString("menu_raid/img_raid_boss_%d.png",boss.element_type),frame2_texture=cc.textureCache.addImage(boss_img),frame=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_boss_icon.setSpriteFrame(frame)}else{boss_img=RES_CDN_DEFULT+"menu_raid/img_raid_boss_die.png",frame2_texture=cc.textureCache.addImage(boss_img),frame=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_boss_icon.setSpriteFrame(frame)}switch(this.m_boss_name.setString(cmString(res_str("label_raid_boss_name_element"),this.m_boss.boss_level,boss.name)),boss.element_type){case ELEMENT_TYPE_FIRE:this.m_boss_name.setColor(cc.color(220,36,36));break;case ELEMENT_TYPE_WATER:this.m_boss_name.setColor(cc.color(77,134,241));break;case ELEMENT_TYPE_WIND:this.m_boss_name.setColor(cc.color(79,193,44));break;case ELEMENT_TYPE_LIGHT:this.m_boss_name.setColor(cc.color(225,206,77));break;case ELEMENT_TYPE_DARK:this.m_boss_name.setColor(cc.color(204,67,209))}switch(this.m_state_icon.setVisible(!0),this.m_boss.activity_type){case database.Raid_Boss_Activity_Type.Raid_Boss_Activity_Type_Ing:if(this.m_boss.discovered_user_id==m_user_id&&0<this.m_boss.raid_boss_num){var state_find=RES_CDN_DEFULT+"menu_raid/img_raid_state_find.png";frame2_texture=cc.textureCache.addImage(state_find),frame=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_state_icon.setSpriteFrame(frame),frame=frame2_texture=null}else if("y"==this.m_boss.part_in_yn){var state_join=RES_CDN_DEFULT+"menu_raid/img_raid_state_join.png";frame2_texture=cc.textureCache.addImage(state_join),frame=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_state_icon.setSpriteFrame(frame),frame=frame2_texture=null}else this.m_state_icon.setVisible(!1);break;case database.Raid_Boss_Activity_Type.Raid_Boss_Activity_Type_Force_Retreat:case database.Raid_Boss_Activity_Type.Raid_Boss_Activity_Type_Time_Limit_Retreat:if(this.m_list_type==LIST_TYPE_CALL)this.m_state_icon.setVisible(!1);else{var state_escape=RES_CDN_DEFULT+"menu_raid/img_raid_state_escape.png";frame2_texture=cc.textureCache.addImage(state_escape),frame=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_state_icon.setSpriteFrame(frame),frame=frame2_texture=null}break;case database.Raid_Boss_Activity_Type.Raid_Boss_Activity_Type_Win:if(this.m_list_type==LIST_TYPE_CALL)this.m_state_icon.setVisible(!1);else{var state_die=RES_CDN_DEFULT+"menu_raid/img_raid_state_die.png";frame2_texture=cc.textureCache.addImage(state_die),frame=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_state_icon.setSpriteFrame(frame),frame=frame2_texture=null}}state_die=RES_CDN_DEFULT+cmString("menu_yh/img_yh_detail_ic_attribute_%d.png",boss.element_type),frame2_texture=cc.textureCache.addImage(state_die),frame=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));if(this.m_element_type.setSpriteFrame(frame),frame=frame2_texture=null,""==this.m_boss.discovered_user_nickname)this.m_discovered_icon.setVisible(!1),this.m_discovered_nickname.setVisible(!1),this.m_friend_icon.setVisible(!1),this.m_discovered_naming.setVisible(!1),this.m_element_type.setPosition(106,58),this.m_boss_name.setPosition(145,68),this.m_time_icon.setPosition(106,39),this.m_remain_time.setPosition(145,41);else if(this.m_discovered_icon.setVisible(!0),this.m_discovered_nickname.setVisible(!0),this.m_discovered_nickname.setString(cmString(res_str("label_raid_boss_discovered_name"),this.m_boss.discovered_user_nickname)),this.m_discovered_naming.setVisible(!0),this.m_element_type.setPosition(106,68),this.m_boss_name.setPosition(145,78),this.m_time_icon.setPosition(106,28),this.m_remain_time.setPosition(145,30),null!=this.m_discovered_naming&&(this.m_discovered_naming.setString(this.m_boss.discovered_user_naming),this.m_discovered_naming.setPosition(ccPosX(this.m_discovered_nickname)+ccWidth(this.m_discovered_nickname)+5,ccPosY(this.m_discovered_nickname))),"y"==this.m_boss.friend_yn){this.m_friend_icon.setVisible(!0);var ds=ccSize(this.m_discovered_nickname);null!=this.m_discovered_naming&&(ds.width+=ccWidth(this.m_discovered_naming)+5),this.m_friend_icon.setPositionX(145+ds.width+10)}else this.m_friend_icon.setVisible(!1);var width=Math.floor(this.m_boss.remain_hp/this.m_boss.max_hp*808);if(this.m_boss_life_gauge.setPreferredSize(cc.size(width,10)),this.m_boss_life.setString(cmString(res_str("label_raid_boss_remain_life"),this.m_boss.remain_hp.toLocaleString("en"),this.m_boss.max_hp.toLocaleString("en"))),this.m_list_type==LIST_TYPE_BATTLE){this.showBtn(!1,this.m_btn_battle),this.showBtn(!1,this.m_btn_call),this.showBtn(!1,this.m_btn_force_retreat),this.showBtn(!1,this.m_btn_partin_list),this.showBtn(!1,this.m_btn_shared),this.showBtn(!0,this.m_btn_history_partin_list);var end_dt=this.m_boss.end_dt,d=moment(end_dt);this.m_remain_time.setString(cmString(res_str("label_raid_boss_end_time"),d.get("month")+1,d.get("date"),d.hours(),d.minutes()))}else{var is_disable_retreat=!1;if(this.m_list_type==LIST_TYPE_CALL?this.m_boss.activity_type==database.Raid_Boss_Activity_Type.Raid_Boss_Activity_Type_Ing&&0<this.m_boss.raid_boss_num?(this.showBtn(!0,this.m_btn_battle),this.showBtn(!1,this.m_btn_call)):(this.showBtn(!1,this.m_btn_battle),this.showBtn(!0,this.m_btn_call),"n"==this.m_boss.call_yn&&(this.m_btn_call[0].setVisible(!1),this.m_btn_call[1].setVisible(!1),this.m_btn_call[2].setVisible(!0)),is_disable_retreat=!0):(this.showBtn(!0,this.m_btn_battle),this.showBtn(!1,this.m_btn_call)),this.showBtn(!1,this.m_btn_history_partin_list),this.m_list_type==LIST_TYPE_CALL&&this.m_boss.activity_type!=database.Raid_Boss_Activity_Type.Raid_Boss_Activity_Type_Ing){this.showBtn(!1,this.m_btn_shared),this.showBtn(!1,this.m_btn_partin_list),(pos=this.m_btn_battle[0].getPosition()).x-=ccWidth(this.m_btn_battle[0]);for(var i=0;i<this.m_btn_force_retreat.length;i++){(b=this.m_btn_force_retreat[i]).setPosition(pos),b.setVisible(!1)}this.m_btn_force_retreat[2].setVisible(!0)}else if(this.m_boss.shared_type==database.Raid_Boss_Shared_Type.Raid_Boss_Shared_Type_None){if(this.m_boss.remain_hp==this.m_boss.max_hp){this.showBtn(!1,this.m_btn_shared),(pos=this.m_btn_battle[0].getPosition()).x-=ccWidth(this.m_btn_battle[0]);for(i=0;i<this.m_btn_force_retreat.length;i++){(b=this.m_btn_force_retreat[i]).setPosition(pos)}}else{var pos;this.showBtn(!0,this.m_btn_shared),(pos=this.m_btn_shared[0].getPosition()).x-=ccWidth(this.m_btn_shared[0]);for(i=0;i<this.m_btn_force_retreat.length;i++){var b;(b=this.m_btn_force_retreat[i]).setPosition(pos)}}this.showBtn(!0,this.m_btn_force_retreat),1==is_disable_retreat&&(this.m_btn_force_retreat[0].setVisible(!1),this.m_btn_force_retreat[1].setVisible(!1),this.m_btn_force_retreat[2].setVisible(!0)),this.showBtn(!1,this.m_btn_partin_list)}else this.showBtn(!1,this.m_btn_shared),this.showBtn(!1,this.m_btn_force_retreat),this.showBtn(!0,this.m_btn_partin_list);var n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),diff=(end_dt=this.m_boss.end_dt,moment(end_dt).valueOf()-n);diff<0&&(diff=0);d=moment.duration(diff);this.m_remain_time.setString(cmString(res_str("label_raid_boss_remain_time"),d.hours(),d.minutes()))}},highlightPosInCell:function(pos){if(this.m_list_type==LIST_TYPE_BATTLE){var box=this.m_btn_history_partin_list[0].getBoundingBox();cc.rectContainsPoint(box,pos)&&(this.m_btn_history_partin_list[0].setVisible(!1),this.m_btn_history_partin_list[1].setVisible(!0))}else if(this.m_list_type!=LIST_TYPE_CALL||this.m_boss.activity_type==database.Raid_Boss_Activity_Type.Raid_Boss_Activity_Type_Ing&&0!=this.m_boss.raid_boss_num)if(this.m_boss.shared_type==database.Raid_Boss_Shared_Type.Raid_Boss_Shared_Type_None){if(this.m_boss.remain_hp!=this.m_boss.max_hp&&(box=this.m_btn_shared[0].getBoundingBox(),cc.rectContainsPoint(box,pos)))return this.m_btn_shared[0].setVisible(!1),void this.m_btn_shared[1].setVisible(!0);if(box=this.m_btn_force_retreat[0].getBoundingBox(),cc.rectContainsPoint(box,pos))return this.m_btn_force_retreat[0].setVisible(!1),void this.m_btn_force_retreat[1].setVisible(!0);if(box=this.m_btn_battle[0].getBoundingBox(),cc.rectContainsPoint(box,pos))return this.m_btn_battle[0].setVisible(!1),void this.m_btn_battle[1].setVisible(!0)}else{box=this.m_btn_partin_list[0].getBoundingBox();if(cc.rectContainsPoint(box,pos))return this.m_btn_partin_list[0].setVisible(!1),void this.m_btn_partin_list[1].setVisible(!0);if(box=this.m_btn_battle[0].getBoundingBox(),cc.rectContainsPoint(box,pos))return this.m_btn_battle[0].setVisible(!1),void this.m_btn_battle[1].setVisible(!0)}else{var box=this.m_btn_call[0].getBoundingBox();if(cc.rectContainsPoint(box,pos))return void(0==this.m_btn_call[2].isVisible()&&(this.m_btn_call[0].setVisible(!1),this.m_btn_call[1].setVisible(!0),this.m_btn_call[2].setVisible(!1)))}},unhighlightPosInCell:function(pos){if(this.m_list_type==LIST_TYPE_BATTLE){var box=this.m_btn_history_partin_list[0].getBoundingBox();cc.rectContainsPoint(box,pos)&&(this.m_btn_history_partin_list[0].setVisible(!0),this.m_btn_history_partin_list[1].setVisible(!1),null!=this._callback_partin_list&&this._callback_partin_list(this.m_boss))}else if(this.m_list_type!=LIST_TYPE_CALL||this.m_boss.activity_type==database.Raid_Boss_Activity_Type.Raid_Boss_Activity_Type_Ing&&0!=this.m_boss.raid_boss_num)this.m_boss.shared_type==database.Raid_Boss_Shared_Type.Raid_Boss_Shared_Type_None?(this.m_boss.remain_hp!=this.m_boss.max_hp?this.showBtn(!0,this.m_btn_shared):this.showBtn(!1,this.m_btn_shared),this.showBtn(!0,this.m_btn_force_retreat)):this.showBtn(!0,this.m_btn_partin_list),this.showBtn(!0,this.m_btn_battle);else{box=this.m_btn_call[0].getBoundingBox();if(cc.rectContainsPoint(box,pos))return void(0==this.m_btn_call[2].isVisible()&&(this.m_btn_call[0].setVisible(!0),this.m_btn_call[1].setVisible(!1),this.m_btn_call[2].setVisible(!1)))}},touchPosInCell:function(pos){if(this.m_list_type==LIST_TYPE_BATTLE){var box=this.m_btn_history_partin_list[0].getBoundingBox();cc.rectContainsPoint(box,pos)&&(this.m_btn_history_partin_list[0].setVisible(!0),this.m_btn_history_partin_list[1].setVisible(!1),null!=this._callback_partin_list&&this._callback_partin_list(this.m_boss))}else if(this.m_list_type!=LIST_TYPE_CALL||this.m_boss.activity_type==database.Raid_Boss_Activity_Type.Raid_Boss_Activity_Type_Ing&&0!=this.m_boss.raid_boss_num)if(this.m_boss.shared_type==database.Raid_Boss_Shared_Type.Raid_Boss_Shared_Type_None){box=null;if(this.m_boss.remain_hp!=this.m_boss.max_hp&&(box=this.m_btn_shared[0].getBoundingBox(),cc.rectContainsPoint(box,pos)))return this.m_btn_shared[0].setVisible(!0),this.m_btn_shared[1].setVisible(!1),void(null!=this._callback_shared&&this._callback_shared(this.m_boss));if(box=this.m_btn_force_retreat[0].getBoundingBox(),cc.rectContainsPoint(box,pos))return this.m_btn_force_retreat[0].setVisible(!0),this.m_btn_force_retreat[1].setVisible(!1),void(null!=this._callback_force_retreat&&this._callback_force_retreat(this.m_boss));if(box=this.m_btn_battle[0].getBoundingBox(),cc.rectContainsPoint(box,pos))return this.m_btn_battle[0].setVisible(!0),this.m_btn_battle[1].setVisible(!1),void(null!=this._callback_battle&&this._callback_battle(this.m_boss))}else{box=this.m_btn_partin_list[0].getBoundingBox();if(cc.rectContainsPoint(box,pos))return this.m_btn_partin_list[0].setVisible(!0),this.m_btn_partin_list[1].setVisible(!1),void(null!=this._callback_partin_list&&this._callback_partin_list(this.m_boss));var box_1=this.m_btn_battle[0].getBoundingBox();if(cc.rectContainsPoint(box_1,pos))return this.m_btn_battle[0].setVisible(!0),this.m_btn_battle[1].setVisible(!1),void(null!=this._callback_battle&&this._callback_battle(this.m_boss))}else{var box=this.m_btn_call[0].getBoundingBox();if(cc.rectContainsPoint(box,pos))return void(0==this.m_btn_call[2].isVisible()&&(this.m_btn_call[0].setVisible(!0),this.m_btn_call[1].setVisible(!1),this.m_btn_call[2].setVisible(!1),null!=this._callback_call_boss&&this._callback_call_boss(this.m_boss)))}},showBtn:function(is_show,btn_list){if(is_show)for(var i=0;i<btn_list.length;i++)btn_list[i].setVisible(0==i);else for(i=0;i<btn_list.length;i++){btn_list[i].setVisible(is_show)}}}),RaidBossListEnum={BOSS_CALL:0,BOSS_LIST:1,BOSS_FRIEND_LIST:2,BOSS_ELEMENT_1:3,BOSS_ELEMENT_2:4,BOSS_ELEMENT_3:5,BOSS_HISTORY:6,BTN_SHOW_HELP:900,req_boss_list:989898,req_boss_history:989899,req_get_user_raid_boss_damage:989900,BOSS_LIST_SORT_TYPE_REMAIN_TIME:0,BOSS_LIST_SORT_TYPE_LEVEL:1,BOSS_LIST_SORT_TYPE_ELEMENT_TYPE:2,BOSS_LIST_SORT_ORDER_DESC:0,BOSS_LIST_SORT_ORDER_ASC:1},RaidBossList_INIT=!1,RaidBossListLayer=cc.Layer.extend({m_base_layer:null,m_tableView:null,m_empty_list:null,m_current_list_type:0,m_is_first_data_get:!1,m_shared_modal_layer:null,m_partin_modal_layer:null,m_message_box:null,m_message_ctbox:null,m_choice_boss:null,m_boss_list:[],m_sort_btn:null,m_sort_order_btn:null,m_sort_btns_node:null,m_sort_btns_label:[],m_sort_label_btns:[],m_sort_type:RaidBossListEnum.BOSS_LIST_SORT_TYPE_REMAIN_TIME,m_sort_order_type:RaidBossListEnum.BOSS_LIST_SORT_ORDER_ASC,m_tab_sort_type:[],m_tab_sort_order_type:[],m_gnrl_img:[],m_tab_labels:[],m_tab_boss_info:[],m_tab_desc_labels:[],m_tab_btns:[],m_cur_tab_info_label:null,m_cur_tab_desc_label:null,m_nextBossElementType:0,m_boss_list_cell:[],ctor:function(){this._super(),RaidBossList_INIT=!0,cc.log("################ Raid Boss List Layer On Ctor"),this.m_base_layer=null,this.m_tableView=null,this.m_empty_list=null,this.m_current_list_type=0,this.m_is_first_data_get=!1,this.m_shared_modal_layer=null,this.m_partin_modal_layer=null,this.m_message_box=null,this.m_message_ctbox=null,this.m_choice_boss=null,this.m_sort_btns_label=[],this.m_sort_label_btns=[],this.m_boss_list=[],this.m_gnrl_img=[],this.m_tab_btns=[],this.m_cur_tab_info_label=null,this.m_cur_tab_desc_label=null,this.m_tab_sort_type=[],this.m_tab_sort_order_type=[],this.m_boss_list_cell=[],this.init()},init:function(){cc.log("################ Raid Boss List Layer On Init Start"),RAID_BOSS_MODAL_OPEN_FLAG=!1,this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var winSize=ccSize(this);(new NetService).get_raid_boss_history().user_raid_boss_history_list=[];var r_service=RaidBossService.getInstance(),gd=GameDefault.getInstance();1!=USE_BOSS_RAID_SORT&&(this.m_sort_type=parseInt(gd.getUserRaidBossSortType()),this.m_sort_order_type=parseInt(gd.getUserRaidBossSortOrderType())),this.m_base_layer=new cc.Layer,this.m_base_layer.ignoreAnchorPointForPosition(!1),this.m_base_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_base_layer.setPosition(ccCenter(winSize)),this.addChild(this.m_base_layer);var box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),box.setPreferredSize(cc.size(958,515)),box.setPosition(Math.floor(.5*winSize.width),0),this.m_base_layer.addChild(box);var boxSize=ccSize(box);this.m_empty_list=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_241),this.m_empty_list.setAnchorPoint(ANCHOR_MIDDLE()),this.m_empty_list.setPosition(Math.floor(.5*boxSize.width),Math.floor(.5*boxSize.height+30)),box.addChild(this.m_empty_list),this.m_empty_list.setVisible(!1);var tSize=cc.size(924,399);this.m_tableView=new cc.TableView(this,tSize),this.m_tableView.setDelegate(this),this.m_tableView.ignoreAnchorPointForPosition(!1),this.m_tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_tableView.scrollBarEnable(!0),this.m_tableView.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_tableView.setPosition(17,18),box.addChild(this.m_tableView);var offset_x=17;this.m_tab_labels=[],this.m_tab_labels.push(res_str("label_raid_boss_tab_0")),this.m_tab_labels.push(res_str("label_raid_boss_tab_1")),this.m_tab_labels.push(res_str("label_raid_boss_tab_2"));var m=MasterTable.getInstance(),raid_boss_period_idx=r_service.getCurrentRaidBossPeriodInfo(!1),appear_info_list=m.get_RaidBossAppearInfoList(raid_boss_period_idx);if(0<appear_info_list.length){var elements_list,appear_info=appear_info_list[0];elements_list=m.get_RaidBossElementInfoList(appear_info.raid_boss_element_rate_idx);for(var idx=0;idx<elements_list.length;idx++){var e=elements_list[idx];if(0!=e.rate){var b=MasterManager.getInstance().get_RaidBossInfo(e.raid_boss_info_idx);this.m_tab_labels.push("  "+b.name),this.m_tab_boss_info.push(b)}}}this.m_tab_labels.push(res_str("label_raid_boss_tab_6"));for(var tab_sort_type=-1,tab_sort_order_type=-1,i=0;i<this.m_tab_labels.length;i++){var tab_btn=new LabelButton("btn_26_none.png","btn_26_on.png","btn_26_off.png",ccui.Widget.PLIST_TEXTURE);tab_btn.setFont(LABEL_FONT_INDEX.FONT_181),tab_btn.setString(this.m_tab_labels[i]),tab_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),tab_btn.setPosition(offset_x,508),tab_btn.setTag(i),tab_btn.addClickEventListener(function(sender){var btn=sender;1==USE_BOSS_RAID_SORT?(cc.log("reqRaidBossTypeList 13 : btn.getTag() = "+btn.getTag()),this.changeListType_V2(btn.getTag())):this.changeListType(btn.getTag())}.bind(this)),box.addChild(tab_btn,-1),offset_x+=ccWidth(tab_btn),this.m_tab_btns.push(tab_btn),1==USE_BOSS_RAID_SORT&&(tab_sort_type=gd.getUserRaidBossSortType_V2(i),tab_sort_order_type=gd.getUserRaidBossSortOrderType_V2(i),this.m_tab_sort_type.push(parseInt(tab_sort_type)),this.m_tab_sort_order_type.push(parseInt(tab_sort_order_type)))}this.m_cur_tab_info_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2615),this.m_cur_tab_info_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_cur_tab_info_label.setPosition(34,463),box.addChild(this.m_cur_tab_info_label),this.m_tab_desc_labels.push(res_str("label_raid_boss_tab_desc_0")),this.m_tab_desc_labels.push(res_str("label_raid_boss_tab_desc_1")),this.m_tab_desc_labels.push(res_str("label_raid_boss_tab_desc_2")),this.m_tab_desc_labels.push(res_str("label_raid_boss_tab_desc_3")),this.m_tab_desc_labels.push(res_str("label_raid_boss_tab_desc_4")),this.m_tab_desc_labels.push(res_str("label_raid_boss_tab_desc_5")),this.m_tab_desc_labels.push(res_str("label_raid_boss_tab_desc_6")),this.m_cur_tab_desc_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_201),this.m_cur_tab_desc_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_cur_tab_desc_label.setPosition(37,431),this.m_cur_tab_desc_label.setTextHorizontalAlignment(cc.TEXT_ALIGNMENT_LEFT),box.addChild(this.m_cur_tab_desc_label);var refresh_btn=new ccui.Button("btn_refresh_off.png","btn_refresh_on.png","",ccui.Widget.PLIST_TEXTURE);refresh_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),refresh_btn.setPosition(winSize.width-10,boxSize.height+4),this.m_base_layer.addChild(refresh_btn),refresh_btn.addClickEventListener(function(sender){if(this.m_current_list_type==RaidBossListEnum.BOSS_CALL)this.reqRaidBossTypeList(this.m_current_list_type,0);else if(this.m_current_list_type==RaidBossListEnum.BOSS_LIST)this.reqRaidBossTypeList(this.m_current_list_type,0);else if(this.m_current_list_type==RaidBossListEnum.BOSS_HISTORY)this.reqRaidBossTypeList(this.m_current_list_type,0);else if(this.m_current_list_type==RaidBossListEnum.BOSS_FRIEND_LIST)this.reqRaidBossTypeList(this.m_current_list_type,0);else{var boss_info_idx=this.m_current_list_type-RaidBossListEnum.BOSS_ELEMENT_1;if(0<=boss_info_idx){var boss_info=this.m_tab_boss_info[boss_info_idx];this.reqRaidBossTypeList(this.m_current_list_type,boss_info.raid_boss_info_idx)}else this.reqRaidBossTypeList(RaidBossListEnum.BOSS_HISTORY,0)}}.bind(this));var help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE);help_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),help_btn.setPosition(winSize.width-16,boxSize.height),this.m_base_layer.addChild(help_btn),help_btn.addClickEventListener(function(sender){this.scheduleOnce(function(float){PREV_HELP=!0,MainObserver.getInstance().postNotification(sceneStr[scene_RaidBossListScene],RaidBossListEnum.BTN_SHOW_HELP)},0,"BTN_SHOW_HELP")}.bind(this)),1==USE_BOSS_RAID_SORT?this.createSortLayer_V2(box):this.createSortLayer(box);var modalSize=cc.size(winSize.width,640);this.m_shared_modal_layer=new GameModalLayer,this.m_shared_modal_layer.setContentSize(modalSize),this.addChild(this.m_shared_modal_layer,99998),this.m_partin_modal_layer=new GameModalLayer,this.m_partin_modal_layer.setContentSize(modalSize),this.addChild(this.m_partin_modal_layer,99998),this.m_message_box=new GameMessageBox,this.addChild(this.m_message_box,11e4),this.m_message_ctbox=new CTGameMessageBox,this.addChild(this.m_message_ctbox,110001),appear_info_list=[],cc.log("################ Raid Boss List Layer On Init End"),1==RaidBossList_INIT&&(this.m_nextBossElementType=BattleContext._getInstance().getRaidBossNextLevelElementType(),this.m_current_list_type=BattleContext._getInstance().getRaidBossStartTabIndex(),1==USE_BOSS_RAID_SORT?(cc.log("reqRaidBossTypeList 12 : this.m_current_list_type = "+this.m_current_list_type),this.changeListType_V2(this.m_current_list_type)):this.changeListType(this.m_current_list_type),RaidBossList_INIT=!1)},onExit:function(){this._super(),cc.log("################ Raid Boss List Layer On Exit"),BattleContext._getInstance().setRaidBossStartTabIndex(this.m_current_list_type),1!=PREV_HELP&&1!=PREV_ACHIVE_RAIDBOSS&&(this.m_boss_list_cell.forEach(function(t){t.removeAllChildrenWithCleanup(!0)}),this.m_boss_list_cell=[])},onEnterTransitionDidFinish:function(){this._super(),0==RaidBossList_INIT&&(this.m_nextBossElementType=BattleContext._getInstance().getRaidBossNextLevelElementType(),this.m_current_list_type=BattleContext._getInstance().getRaidBossStartTabIndex(),1==USE_BOSS_RAID_SORT?(cc.log("reqRaidBossTypeList 12 : this.m_current_list_type = "+this.m_current_list_type),this.changeListType_V2(this.m_current_list_type)):this.changeListType(this.m_current_list_type))},changeListType:function(list_type){this.m_sort_btns_label=[],this.m_current_list_type=list_type,this.m_sort_type=0,this.m_sort_btn.setVisible(!0),this.m_sort_order_btn.setVisible(!0);for(var i=0;i<this.m_tab_btns.length;i++)this.m_tab_btns[i].setEnabled(i!=this.m_current_list_type);if(this.m_current_list_type==RaidBossListEnum.BOSS_CALL)this.m_sort_btn.setVisible(!1),this.m_sort_order_btn.setVisible(!1),this.m_sort_btns_node.setVisible(!1),this.m_sort_type=RaidBossListEnum.BOSS_LIST_SORT_TYPE_ELEMENT_TYPE,this.reqRaidBossTypeList(this.m_current_list_type,0);else if(this.m_current_list_type==RaidBossListEnum.BOSS_LIST){this.m_sort_btns_label.push(res_str("btn_sort_remain_time")),this.m_sort_btns_label.push(res_str("btn_sort_lv")),this.m_sort_btns_label.push(res_str("btn_sort_element_type"));for(i=0;i<this.m_sort_label_btns.length;i++)i<this.m_sort_btns_label.length?(this.m_sort_label_btns[i].setVisible(!0),this.m_sort_label_btns[i].setString(this.m_sort_btns_label[i])):this.m_sort_label_btns[i].setVisible(!1);this.m_sort_btn.setString(this.m_sort_btns_label[this.m_sort_type]),this.reqRaidBossTypeList(this.m_current_list_type,0)}else if(this.m_current_list_type==RaidBossListEnum.BOSS_HISTORY){this.m_sort_btns_label.push(res_str("btn_sort_raid_boss_end_time")),this.m_sort_btns_label.push(res_str("btn_sort_lv")),this.m_sort_btns_label.push(res_str("btn_sort_element_type"));for(i=0;i<this.m_sort_label_btns.length;i++)i<this.m_sort_btns_label.length?(this.m_sort_label_btns[i].setVisible(!0),this.m_sort_label_btns[i].setString(this.m_sort_btns_label[i])):this.m_sort_label_btns[i].setVisible(!1);this.m_sort_btn.setString(this.m_sort_btns_label[this.m_sort_type]),this.reqRaidBossTypeList(this.m_current_list_type,0)}else if(this.m_current_list_type==RaidBossListEnum.BOSS_FRIEND_LIST){this.m_sort_btns_label.push(res_str("btn_sort_remain_time")),this.m_sort_btns_label.push(res_str("btn_sort_lv")),this.m_sort_btns_label.push(res_str("btn_sort_element_type"));for(i=0;i<this.m_sort_label_btns.size();i++)i<this.m_sort_btns_label.length?(this.m_sort_label_btns[i].setVisible(!0),this.m_sort_label_btns[i].setString(this.m_sort_btns_label[i])):this.m_sort_label_btns[i].setVisible(!1);this.m_sort_btn.setString(this.m_sort_btns_label[this.m_sort_type]),this.reqRaidBossTypeList(this.m_current_list_type,0)}else{this.m_sort_btns_label.push(res_str("btn_sort_remain_time")),this.m_sort_btns_label.push(res_str("btn_sort_lv"));for(i=0;i<this.m_sort_label_btns.length;i++)i<this.m_sort_btns_label.length?(this.m_sort_label_btns[i].setVisible(!0),this.m_sort_label_btns[i].setString(this.m_sort_btns_label[i])):this.m_sort_label_btns[i].setVisible(!1);this.m_sort_type<this.m_sort_btns_label.length||(this.m_sort_type=0),this.m_sort_btn.setString(this.m_sort_btns_label[this.m_sort_type]);var boss_info_idx=this.m_current_list_type-RaidBossListEnum.BOSS_ELEMENT_1;if(0<=boss_info_idx){var boss_info=this.m_tab_boss_info[boss_info_idx];this.reqRaidBossTypeList(this.m_current_list_type,boss_info.raid_boss_info_idx)}else this.reqRaidBossTypeList(RaidBossListEnum.BOSS_HISTORY,0)}},changeListType_V2:function(list_type){this.m_sort_btns_label=[],this.m_current_list_type=list_type,this.m_sort_btn.setVisible(!0),this.m_sort_order_btn.setVisible(!0);for(var i=0;i<this.m_tab_btns.length;i++)this.m_tab_btns[i].setEnabled(i!=this.m_current_list_type);if(this.m_current_list_type==RaidBossListEnum.BOSS_CALL)this.m_sort_btn.setVisible(!1),this.m_sort_order_btn.setVisible(!1),this.m_sort_btns_node.setVisible(!1),this.reqRaidBossTypeList(this.m_current_list_type,0);else if(this.m_current_list_type==RaidBossListEnum.BOSS_LIST){this.m_sort_btns_label.push(res_str("btn_sort_remain_time")),this.m_sort_btns_label.push(res_str("btn_sort_lv")),this.m_sort_btns_label.push(res_str("btn_sort_element_type"));for(i=0;i<this.m_sort_label_btns.length;i++)i<this.m_sort_btns_label.length?(this.m_sort_label_btns[i].setVisible(!0),this.m_sort_label_btns[i].setString(this.m_sort_btns_label[i])):this.m_sort_label_btns[i].setVisible(!1);this.m_sort_btn.setString(this.m_sort_btns_label[this.m_tab_sort_type[this.m_current_list_type]]),this.reqRaidBossTypeList(this.m_current_list_type,0)}else if(this.m_current_list_type==RaidBossListEnum.BOSS_HISTORY){this.m_sort_btns_label.push(res_str("btn_sort_raid_boss_end_time")),this.m_sort_btns_label.push(res_str("btn_sort_lv")),this.m_sort_btns_label.push(res_str("btn_sort_element_type"));for(i=0;i<this.m_sort_label_btns.length;i++)i<this.m_sort_btns_label.length?(this.m_sort_label_btns[i].setVisible(!0),this.m_sort_label_btns[i].setString(this.m_sort_btns_label[i])):this.m_sort_label_btns[i].setVisible(!1);this.m_sort_btn.setString(this.m_sort_btns_label[this.m_tab_sort_type[this.m_current_list_type]]),this.reqRaidBossTypeList(this.m_current_list_type,0)}else if(this.m_current_list_type==RaidBossListEnum.BOSS_FRIEND_LIST){this.m_sort_btns_label.push(res_str("btn_sort_remain_time")),this.m_sort_btns_label.push(res_str("btn_sort_lv")),this.m_sort_btns_label.push(res_str("btn_sort_element_type"));for(i=0;i<this.m_sort_label_btns.size();i++)i<this.m_sort_btns_label.length?(this.m_sort_label_btns[i].setVisible(!0),this.m_sort_label_btns[i].setString(this.m_sort_btns_label[i])):this.m_sort_label_btns[i].setVisible(!1);this.m_sort_btn.setString(this.m_sort_btns_label[this.m_tab_sort_type[this.m_current_list_type]]),this.reqRaidBossTypeList(this.m_current_list_type,0)}else{this.m_sort_btns_label.push(res_str("btn_sort_remain_time")),this.m_sort_btns_label.push(res_str("btn_sort_lv"));for(i=0;i<this.m_sort_label_btns.length;i++)i<this.m_sort_btns_label.length?(this.m_sort_label_btns[i].setVisible(!0),this.m_sort_label_btns[i].setString(this.m_sort_btns_label[i])):this.m_sort_label_btns[i].setVisible(!1);this.m_sort_btn.setString(this.m_sort_btns_label[this.m_tab_sort_type[this.m_current_list_type]]);var boss_info_idx=this.m_current_list_type-RaidBossListEnum.BOSS_ELEMENT_1;if(0<=boss_info_idx){var boss_info=this.m_tab_boss_info[boss_info_idx];this.reqRaidBossTypeList(this.m_current_list_type,boss_info.raid_boss_info_idx)}else this.reqRaidBossTypeList(RaidBossListEnum.BOSS_HISTORY,0)}this.m_tab_sort_order_type[this.m_current_list_type]==RaidBossListEnum.BOSS_LIST_SORT_ORDER_DESC?(this.m_sort_order_btn.loadTexturePressed("btn_align_bottom_on.png",ccui.Widget.PLIST_TEXTURE),this.m_sort_order_btn.loadTextureNormal("btn_align_bottom_off.png",ccui.Widget.PLIST_TEXTURE)):(this.m_sort_order_btn.loadTexturePressed("btn_align_top_on.png",ccui.Widget.PLIST_TEXTURE),this.m_sort_order_btn.loadTextureNormal("btn_align_top_off.png",ccui.Widget.PLIST_TEXTURE))},scrollViewDidScroll:function(view){this.showSortLayer(!1)},cellSizeForTable:function(table){return cc.size(924,112)},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;null!=c?cell=c:((cell=new RaidBossListCell)._callback_shared=this.cbClickBossListShared.bind(this),cell._callback_battle=this.cbClickBossListBattle.bind(this),cell._callback_force_retreat=this.cbClickBossListForceRetreat.bind(this),cell._callback_partin_list=this.cbClickBossListPartInList.bind(this),cell._callback_call_boss=this.cbClickBossListCallBoss.bind(this));var data=this.m_boss_list[idx];return this.m_current_list_type==RaidBossListEnum.BOSS_CALL&&(data.discovered_user_nickname=""),cell.setData(this.m_current_list_type,$.extend({},data)),this.m_boss_list_cell.push(cell),cell},numberOfCellsInTableView:function(table){return this.m_boss_list.length},tableCellTouched:function(table,cell){null!=cell&&cell.touchPosInCell(cell.getTouchPos())},tableCellHighlight:function(table,cell){null!=cell&&cell.highlightPosInCell(cell.getTouchPos())},tableCellUnhighlight:function(table,cell){null!=cell&&cell.unhighlightPosInCell(cell.getTouchPos())},refreshBossList_1:function(info){for(var idx=0;idx<this.m_boss_list.length;idx++){var r=this.m_boss_list[idx];if(r.discovered_user_id==info.discovered_user_id&&r.raid_boss_period_idx==info.raid_boss_period_idx&&r.raid_boss_num==info.raid_boss_num){r.shared_type=info.shared_type,r.remain_hp=info.remain_hp;break}}if(this.sortDataList_V2(),1==RAID_BOSS_NEXT_FLAG){if(this.m_current_list_type==RaidBossListEnum.BOSS_CALL&&this.m_nextBossElementType!=ELEMENT_TYPE_NONE)for(var i=0;i<this.m_boss_list.length;i++){var boss_info=this.m_boss_list[i];if(MasterManager.getInstance().get_RaidBossInfo(boss_info.raid_boss_info_idx).element_type==this.m_nextBossElementType){this.m_nextBossElementType=ELEMENT_TYPE_NONE,this.scheduleOnce(function(float){this.cbClickBossListCallBoss(boss_info)}.bind(this),.2,"cbClickBossListCallBoss");break}}RAID_BOSS_NEXT_FLAG=!1}},refreshBossList:function(list){this.m_boss_list=[];for(var idx=0;idx<list.length;idx++)this.m_boss_list.push($.extend({},list[idx]));if(this.sortDataList_V2(),1==RAID_BOSS_NEXT_FLAG){if(this.m_current_list_type==RaidBossListEnum.BOSS_CALL&&this.m_nextBossElementType!=ELEMENT_TYPE_NONE)for(var i=0;i<this.m_boss_list.length;i++){var boss_info=this.m_boss_list[i];if(MasterManager.getInstance().get_RaidBossInfo(boss_info.raid_boss_info_idx).element_type==this.m_nextBossElementType){this.m_nextBossElementType=ELEMENT_TYPE_NONE,this.scheduleOnce(function(float){this.cbClickBossListCallBoss(boss_info)}.bind(this),.2,"cbClickBossListCallBoss");break}}RAID_BOSS_NEXT_FLAG=!1}},cbClickBossListShared:function(data){var path=RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3";AudioEngine.getInstance().playEffect(path),this.m_choice_boss=data,this.showRaidBossSharedPopup(data)},cbClickBossListBattle:function(data){var path=RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3";AudioEngine.getInstance().playEffect(path),this.m_choice_boss=data,BattleContext._getInstance().setGameType(db.BattleGameType.RaidDungeon),BattleContext._getInstance().setRaidBossData(data),this.m_current_list_type,RaidBossListEnum.BOSS_CALL,BattleContext._getInstance().setRaidBossStartTabIndex(RaidBossListEnum.BOSS_LIST),this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_RaidBossListScene],RaidBossListEnum.req_get_user_raid_boss_damage)}.bind(this),0,"req_get_user_raid_boss_damage")},cbClickBossListForceRetreat:function(data){var path=RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3";AudioEngine.getInstance().playEffect(path),this.m_choice_boss=data,this.showRaidBossForceRetreatPopup(data)},cbClickBossListPartInList:function(data){var path=RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3";AudioEngine.getInstance().playEffect(path),this.m_choice_boss=data;var req={};req.opcode=net.OP.op_raid_boss_partin_user_list,req.discovered_user_id=data.discovered_user_id,req.raid_boss_period_idx=data.raid_boss_period_idx,req.raid_boss_num=data.raid_boss_num,req.list_type=this.m_current_list_type;var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent),req={}},cbClickBossListCallBoss:function(data){var path=RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3";AudioEngine.getInstance().playEffect(path),this.m_choice_boss=data,this.showRaidBossCallBossMsgBox(data)},startRaidBossBattleAfterCall:function(data){this.cbClickBossListBattle(data)},showRaidBossPartinListPopup:function(list){this.m_partin_modal_layer._contentNode=function(contentSize,m){RAID_BOSS_MODAL_OPEN_FLAG=!0;var layer=new cc.Layer,popup=new RaidBossPartInUserListLayer;return popup.setRaidBossPartinUserList(list,this.m_choice_boss.activity_type,this.m_current_list_type),popup._callback_close_popup=this.hideRaidBossPartInUserList.bind(this),layer.setContentSize(popup.getContentSize()),layer.setPosition(Math.floor(.5*this.getContentSize())),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),layer.addChild(popup),popup.setPosition(ccCenter(layer)),this.m_partin_modal_layer.setContentSize(layer.getContentSize()),layer}.bind(this),this.m_partin_modal_layer.is_show()||this.m_partin_modal_layer.show()},hideRaidBossPartInUserList:function(){this.m_partin_modal_layer.is_show()&&this.m_partin_modal_layer.hide()},showRaidBossSharedPopup:function(boss){this.m_shared_modal_layer._contentNode=function(contentSize,m){RAID_BOSS_MODAL_OPEN_FLAG=!0;var layer=new cc.Layer,popup=new RaidBossSharedPopupLayer;return popup.setRaidBossData(boss),popup._callback_close_popup=this.hideRaidBossSharedPopup.bind(this),popup._callback_shared=this.reqRaidBossShared.bind(this),layer.setContentSize(popup.getContentSize()),layer.setPosition(Math.floor(.5*this.getContentSize())),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),layer.addChild(popup),popup.setPosition(ccCenter(layer)),this.m_shared_modal_layer.setContentSize(layer.getContentSize()),layer}.bind(this),this.m_shared_modal_layer.is_show()||this.m_shared_modal_layer.show()},reqRaidBossShared:function(boss,shared_type){var req={};req.opcode=net.OP.op_raid_boss_shared,req.discovered_user_id=boss.discovered_user_id,req.raid_boss_period_idx=boss.raid_boss_period_idx,req.raid_boss_num=boss.raid_boss_num,req.shared_type=shared_type;var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent),req={},this.hideRaidBossSharedPopup()},hideRaidBossSharedPopup:function(){this.m_shared_modal_layer.is_show()&&this.m_shared_modal_layer.hide()},showRaidBossForceRetreatPopup:function(boss){RAID_BOSS_MODAL_OPEN_FLAG=!0,this.m_message_box.setTitle(res_str("label_raid_boss_force_retreat_title")),this.m_message_box.setText(res_str("label_raid_boss_force_retreat_message_text_1")),this.m_message_box.setText("\n"),this.m_message_box.setText(res_str("label_raid_boss_force_retreat_message_text_2")),this.m_message_box.setText("\n"),this.m_message_box.setText(res_str("label_raid_boss_force_retreat_message_text_3")),this.m_message_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_cancel"),MessageBoxButtonType.ButtonTypeRed,0,function(){RAID_BOSS_MODAL_OPEN_FLAG=!1,this.m_message_box.hide()}.bind(this))),this.m_message_box.addButtonInfo(new MessageButtonInfo(res_str("label_raid_boss_force_retreat"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){RAID_BOSS_MODAL_OPEN_FLAG=!1,this.reqRaidBossForceRetreat(this.m_choice_boss)},.5,"reqRaidBossForceRetreat"),this.m_message_box.hide()}.bind(this))),this.m_message_box.show()},reqRaidBossForceRetreat:function(boss){var req={};req.opcode=net.OP.op_raid_boss_force_retreat,req.discovered_user_id=boss.discovered_user_id,req.raid_boss_period_idx=boss.raid_boss_period_idx,req.raid_boss_num=boss.raid_boss_num;var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent)},showRaidBossCallBossMsgBox:function(boss){RAID_BOSS_MODAL_OPEN_FLAG=!0,this.m_message_ctbox.setTitle(res_str("label_raid_boss_call_boss_title"));var mt_boss=MasterManager.getInstance().get_RaidBossInfo(boss.raid_boss_info_idx);switch(mt_boss.element_type){case ELEMENT_TYPE_FIRE:this.m_message_ctbox.setText("Lv"+boss.boss_level+" "+mt_boss.name,LABEL_FONT_INDEX.FONT_2618),this.m_message_ctbox.setText(res_str("label_raid_boss_call_boss_text_1"),LABEL_FONT_INDEX.FONT_261),this.m_message_ctbox.setText("\n");break;case ELEMENT_TYPE_WATER:this.m_message_ctbox.setText("Lv"+boss.boss_level+" "+mt_boss.name,LABEL_FONT_INDEX.FONT_2619),this.m_message_ctbox.setText(res_str("label_raid_boss_call_boss_text_1"),LABEL_FONT_INDEX.FONT_261),this.m_message_ctbox.setText("\n");break;case ELEMENT_TYPE_WIND:this.m_message_ctbox.setText("Lv"+boss.boss_level+" "+mt_boss.name,LABEL_FONT_INDEX.FONT_2620),this.m_message_ctbox.setText(res_str("label_raid_boss_call_boss_text_1"),LABEL_FONT_INDEX.FONT_261),this.m_message_ctbox.setText("\n");break;case ELEMENT_TYPE_LIGHT:this.m_message_ctbox.setText("Lv"+boss.boss_level+" "+mt_boss.name,LABEL_FONT_INDEX.FONT_2621),this.m_message_ctbox.setText(res_str("label_raid_boss_call_boss_text_1"),LABEL_FONT_INDEX.FONT_261),this.m_message_ctbox.setText("\n");break;case ELEMENT_TYPE_DARK:this.m_message_ctbox.setText("Lv"+boss.boss_level+" "+mt_boss.name,LABEL_FONT_INDEX.FONT_2622),this.m_message_ctbox.setText(res_str("label_raid_boss_call_boss_text_1"),LABEL_FONT_INDEX.FONT_261),this.m_message_ctbox.setText("\n")}this.m_message_ctbox.setText(res_str("label_raid_boss_call_boss_text_2"),LABEL_FONT_INDEX.FONT_261),this.m_message_ctbox.setText("\n"),this.m_message_ctbox.setText(res_str("label_raid_boss_call_boss_text_3"),LABEL_FONT_INDEX.FONT_261),this.m_message_ctbox.setText("\n"),this.m_message_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_cancel"),MessageBoxButtonType.ButtonTypeRed,0,function(){RAID_BOSS_MODAL_OPEN_FLAG=!1,BattleContext._getInstance().setRaidBossNextLevelElementType(ELEMENT_TYPE_NONE),this.m_message_ctbox.hide()}.bind(this))),this.m_message_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_raid_boss_call"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){RAID_BOSS_MODAL_OPEN_FLAG=!1,BattleContext._getInstance().setRaidBossNextLevelElementType(ELEMENT_TYPE_NONE),this.reqRaidBossCallBoss(boss)},.5,"reqRaidBossCallBoss"),this.m_message_ctbox.hide()}.bind(this))),this.m_message_ctbox.show()},reqRaidBossCallBoss:function(boss){var req={};req.opcode=net.OP.op_raid_boss_call_boss,req.raid_boss_info_idx=boss.raid_boss_info_idx,req.boss_level=boss.boss_level,this.getParent().network_write(req)},createSortLayer:function(container){var mt=MasterManager.getInstance(),boxSize=ccSize(container);this.m_sort_btns_label.push(mt.get_LanguageData("btn_sort_remain_time")),this.m_sort_btns_label.push(mt.get_LanguageData("btn_sort_lv")),this.m_sort_btns_label.push(mt.get_LanguageData("btn_sort_element_type"));var offset_x=boxSize.width-20,offset_y=boxSize.height-60;this.m_sort_order_type==RaidBossListEnum.BOSS_LIST_SORT_ORDER_DESC?this.m_sort_order_btn=new ccui.Button("btn_align_bottom_off.png","btn_align_bottom_on.png","",ccui.Widget.PLIST_TEXTURE):this.m_sort_order_btn=new ccui.Button("btn_align_top_off.png","btn_align_top_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_sort_order_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_sort_order_btn.setPosition(offset_x,offset_y),container.addChild(this.m_sort_order_btn),this.m_sort_order_btn.addClickEventListener(function(sender){this.changeSortOrder()}.bind(this)),this.m_sort_order_btn.setVisible(!1),offset_x-=ccWidth(this.m_sort_order_btn),this.m_sort_btn=new LabelButton("btn_02_off.png","btn_02_on.png","btn_02_on.png",ccui.Widget.PLIST_TEXTURE),this.m_sort_btn.setFont(LABEL_FONT_INDEX.FONT_201),this.m_sort_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_sort_btn.setPosition(offset_x,offset_y),this.m_sort_btn.setString(this.m_sort_btns_label[this.m_sort_type]),container.addChild(this.m_sort_btn),this.m_sort_btn.addClickEventListener(function(sender){this.showSortLayer(!this.m_sort_btns_node.isVisible())}.bind(this)),this.m_sort_btn.setVisible(!1),this.m_sort_btns_node=new cc.Node,this.m_sort_btns_node.setAnchorPoint(ANCHOR_MIDDLE()),this.m_sort_btns_node.setPosition(offset_x,offset_y),this.m_sort_btns_node.setVisible(!1),container.addChild(this.m_sort_btns_node);for(var i=offset_y=0;i<this.m_sort_btns_label.length;i++){var btn=new LabelButton("btn_02_on.png","btn_02_off.png","",ccui.Widget.PLIST_TEXTURE);btn.setFont(LABEL_FONT_INDEX.FONT_201),btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),btn.setPosition(0,offset_y),this.m_sort_btns_node.addChild(btn),btn.setTag(i),btn.setString(this.m_sort_btns_label[i]),btn.addClickEventListener(function(sender){this.choiceSortType(sender.getTag())}.bind(this)),this.m_sort_label_btns.push(btn),offset_y-=ccHeight(btn)}},createSortLayer_V2:function(container){var mt=MasterManager.getInstance(),boxSize=ccSize(container);this.m_sort_btns_label.push(mt.get_LanguageData("btn_sort_remain_time")),this.m_sort_btns_label.push(mt.get_LanguageData("btn_sort_lv")),this.m_sort_btns_label.push(mt.get_LanguageData("btn_sort_element_type"));var offset_x=boxSize.width-20,offset_y=boxSize.height-60;this.m_tab_sort_order_type[this.m_current_list_type]==RaidBossListEnum.BOSS_LIST_SORT_ORDER_DESC?this.m_sort_order_btn=new ccui.Button("btn_align_bottom_off.png","btn_align_bottom_on.png","",ccui.Widget.PLIST_TEXTURE):this.m_sort_order_btn=new ccui.Button("btn_align_top_off.png","btn_align_top_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_sort_order_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_sort_order_btn.setPosition(offset_x,offset_y),container.addChild(this.m_sort_order_btn),this.m_sort_order_btn.addClickEventListener(function(sender){this.changeSortOrder_V2(this.m_current_list_type)}.bind(this)),this.m_sort_order_btn.setVisible(!1),offset_x-=ccWidth(this.m_sort_order_btn),this.m_sort_btn=new LabelButton("btn_02_off.png","btn_02_on.png","btn_02_on.png",ccui.Widget.PLIST_TEXTURE),this.m_sort_btn.setFont(LABEL_FONT_INDEX.FONT_201),this.m_sort_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_sort_btn.setPosition(offset_x,offset_y),this.m_sort_btn.setString(this.m_sort_btns_label[this.m_sort_type]),container.addChild(this.m_sort_btn),this.m_sort_btn.addClickEventListener(function(sender){this.showSortLayer(!this.m_sort_btns_node.isVisible())}.bind(this)),this.m_sort_btn.setVisible(!1),this.m_sort_btns_node=new cc.Node,this.m_sort_btns_node.setAnchorPoint(ANCHOR_MIDDLE()),this.m_sort_btns_node.setPosition(offset_x,offset_y),this.m_sort_btns_node.setVisible(!1),container.addChild(this.m_sort_btns_node);for(var i=offset_y=0;i<this.m_sort_btns_label.length;i++){var btn=new LabelButton("btn_02_on.png","btn_02_off.png","",ccui.Widget.PLIST_TEXTURE);btn.setFont(LABEL_FONT_INDEX.FONT_201),btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),btn.setPosition(0,offset_y),this.m_sort_btns_node.addChild(btn),btn.setTag(i),btn.setString(this.m_sort_btns_label[i]),btn.addClickEventListener(function(sender){this.choiceSortType_V2(sender.getTag())}.bind(this)),this.m_sort_label_btns.push(btn),offset_y-=ccHeight(btn)}},showSortLayer:function(is_show){this.m_sort_btns_node.setVisible(is_show)},choiceSortType:function(sort_type){this.m_sort_type=sort_type,this.m_sort_btn.setString(this.m_sort_btns_label[this.m_sort_type]),GameDefault.getInstance().setUserRaidBossSortType(this.m_sort_type),this.sortDataList()},choiceSortType_V2:function(sort_type){this.m_tab_sort_type[this.m_current_list_type]=sort_type;var string=this.m_sort_btns_label[this.m_tab_sort_type[this.m_current_list_type]];this.m_sort_btn.setString(string),GameDefault.getInstance().setUserRaidBossSortType_V2(this.m_current_list_type,this.m_tab_sort_type[this.m_current_list_type]),this.sortDataList_V2()},changeSortOrder:function(){this.m_sort_order_type==RaidBossListEnum.BOSS_LIST_SORT_ORDER_DESC?(this.m_sort_order_type=RaidBossListEnum.BOSS_LIST_SORT_ORDER_ASC,this.m_sort_order_btn.loadTexturePressed("btn_align_top_on.png",ccui.Widget.PLIST_TEXTURE),this.m_sort_order_btn.loadTextureNormal("btn_align_top_off.png",ccui.Widget.PLIST_TEXTURE)):(this.m_sort_order_type=RaidBossListEnum.BOSS_LIST_SORT_ORDER_DESC,this.m_sort_order_btn.loadTexturePressed("btn_align_bottom_on.png",ccui.Widget.PLIST_TEXTURE),this.m_sort_order_btn.loadTextureNormal("btn_align_bottom_off.png",ccui.Widget.PLIST_TEXTURE)),GameDefault.getInstance().setUserRaidBossSortOrderType(this.m_sort_order_type),this.sortDataList()},changeSortOrder_V2:function(TabIndex){this.m_tab_sort_order_type[TabIndex]==RaidBossListEnum.BOSS_LIST_SORT_ORDER_DESC?(this.m_tab_sort_order_type[TabIndex]=RaidBossListEnum.BOSS_LIST_SORT_ORDER_ASC,this.m_sort_order_btn.loadTexturePressed("btn_align_top_on.png",ccui.Widget.PLIST_TEXTURE),this.m_sort_order_btn.loadTextureNormal("btn_align_top_off.png",ccui.Widget.PLIST_TEXTURE)):(this.m_tab_sort_order_type[TabIndex]=RaidBossListEnum.BOSS_LIST_SORT_ORDER_DESC,this.m_sort_order_btn.loadTexturePressed("btn_align_bottom_on.png",ccui.Widget.PLIST_TEXTURE),this.m_sort_order_btn.loadTextureNormal("btn_align_bottom_off.png",ccui.Widget.PLIST_TEXTURE)),GameDefault.getInstance().setUserRaidBossSortOrderType_V2(TabIndex,this.m_tab_sort_order_type[TabIndex]),this.sortDataList_V2()},sortDataList:function(){var mt=MasterManager.getInstance();if(this.showSortLayer(!1),this.m_current_list_type==RaidBossListEnum.BOSS_CALL){if(this.m_empty_list.setVisible(!1),0==this.m_boss_list.length)return this.m_empty_list.setVisible(!0),this.m_empty_list.setString(res_str("label_raid_boss_call_list_nothing")),void cc.log("##RaidBossList is null");for(var is_exist_boss_call=!1,idx=0;idx<this.m_boss_list.length;idx++){var boss_info=this.m_boss_list[idx];if(boss_info.activity_type==database.Raid_Boss_Activity_Type.Raid_Boss_Activity_Type_Ing&&0<boss_info.raid_boss_num)is_exist_boss_call=!0;else if(boss_info.activity_type==database.Raid_Boss_Activity_Type.Raid_Boss_Activity_Type_Win){var mt_boss=mt.get_RaidBossInfo(boss_info.raid_boss_info_idx);boss_info.boss_level<mt_boss.max_level&&(boss_info.boss_level+=1);var mt_boss_level=mt.get_RaidBossLevelInfo(boss_info.raid_boss_info_idx,boss_info.boss_level);boss_info.remain_hp=mt_boss_level.hp,boss_info.max_hp=mt_boss_level.hp}else{1<boss_info.boss_level&&(boss_info.boss_level-=1);mt_boss_level=mt.get_RaidBossLevelInfo(boss_info.raid_boss_info_idx,boss_info.boss_level);boss_info.remain_hp=mt_boss_level.hp,boss_info.max_hp=mt_boss_level.hp}boss_info.call_yn="y"}if(1==is_exist_boss_call)for(var i=0;i<this.m_boss_list.length;i++)this.m_boss_list[i].activity_type==database.Raid_Boss_Shared_Type.Raid_Boss_Activity_Type_Ing?0==this.m_boss_list[i].raid_boss_num&&(this.m_boss_list[i].call_yn="n"):this.m_boss_list[i].call_yn="n"}else this.m_current_list_type==RaidBossListEnum.BOSS_HISTORY?0==this.m_boss_list.length?(this.m_empty_list.setVisible(!0),this.m_empty_list.setString(res_str("label_raid_boss_history_nothing"))):this.m_empty_list.setVisible(!1):0==this.m_boss_list.length?(this.m_empty_list.setVisible(!0),this.m_empty_list.setString(res_str("label_raid_boss_list_nothing"))):this.m_empty_list.setVisible(!1);if(this.m_current_list_type==RaidBossListEnum.BOSS_CALL)this.m_boss_list=stable(this.m_boss_list,function(l,r){var m=MasterManager.getInstance(),l_b=m.get_RaidBossInfo(l.raid_boss_info_idx),r_b=m.get_RaidBossInfo(r.raid_boss_info_idx);return l_b.element_type>r_b.element_type}.bind(this));else switch(this.m_sort_type){case RaidBossListEnum.BOSS_LIST_SORT_TYPE_REMAIN_TIME:this.m_boss_list=stable(this.m_boss_list,function(l,r){var l_t=moment(l.end_dt),r_t=moment(r.end_dt);return this.m_sort_order_type==RaidBossListEnum.BOSS_LIST_SORT_ORDER_DESC?l_t.valueOf()<r_t.valueOf():l_t.valueOf()>r_t.valueOf()}.bind(this));break;case RaidBossListEnum.BOSS_LIST_SORT_TYPE_LEVEL:this.m_boss_list=stable(this.m_boss_list,function(l,r){return this.m_sort_order_type==RaidBossListEnum.BOSS_LIST_SORT_ORDER_DESC?l.boss_level<r.boss_level:l.boss_level>r.boss_level}.bind(this));break;case RaidBossListEnum.BOSS_LIST_SORT_TYPE_ELEMENT_TYPE:this.m_boss_list=stable(this.m_boss_list,function(l,r){var l_b=mt.get_RaidBossInfo(l.raid_boss_info_idx),r_b=mt.get_RaidBossInfo(r.raid_boss_info_idx);return this.m_sort_order_type==RaidBossListEnum.BOSS_LIST_SORT_ORDER_DESC?l_b.element_type<r_b.element_type:l_b.element_type>r_b.element_type}.bind(this))}this.m_tableView.reloadData(),this.m_current_list_type==RaidBossListEnum.BOSS_CALL?this.m_cur_tab_info_label.setString(res_str("label_raid_boss_tab_desc_0_title")):this.m_cur_tab_info_label.setString(this.m_tab_labels[this.m_current_list_type]+" "+this.m_boss_list.length+"/100"),this.m_cur_tab_desc_label.setString(this.m_tab_desc_labels.at(this.m_current_list_type))},sortDataList_V2:function(){var mt=MasterManager.getInstance();if(this.showSortLayer(!1),this.m_current_list_type==RaidBossListEnum.BOSS_CALL){if(this.m_empty_list.setVisible(!1),0==this.m_boss_list.length)return this.m_empty_list.setVisible(!0),void this.m_empty_list.setString(res_str("label_raid_boss_call_list_nothing"));for(var is_exist_boss_call=!1,idx=0;idx<this.m_boss_list.length;idx++){var boss_info=this.m_boss_list[idx];if(boss_info.activity_type==database.Raid_Boss_Activity_Type.Raid_Boss_Activity_Type_Ing&&0<boss_info.raid_boss_num)is_exist_boss_call=!0;else if(boss_info.activity_type==database.Raid_Boss_Activity_Type.Raid_Boss_Activity_Type_Win){var mt_boss=mt.get_RaidBossInfo(boss_info.raid_boss_info_idx);boss_info.boss_level<mt_boss.max_level&&(boss_info.boss_level+=1);var mt_boss_level=mt.get_RaidBossLevelInfo(boss_info.raid_boss_info_idx,boss_info.boss_level);boss_info.remain_hp=mt_boss_level.hp,boss_info.max_hp=mt_boss_level.hp}else{1<boss_info.boss_level&&(boss_info.boss_level-=1);mt_boss_level=mt.get_RaidBossLevelInfo(boss_info.raid_boss_info_idx,boss_info.boss_level);boss_info.remain_hp=mt_boss_level.hp,boss_info.max_hp=mt_boss_level.hp}boss_info.call_yn="y"}if(1==is_exist_boss_call)for(var i=0;i<this.m_boss_list.length;i++)this.m_boss_list[i].activity_type==database.Raid_Boss_Shared_Type.Raid_Boss_Activity_Type_Ing?0==this.m_boss_list[i].raid_boss_num&&(this.m_boss_list[i].call_yn="n"):this.m_boss_list[i].call_yn="n"}else this.m_current_list_type==RaidBossListEnum.BOSS_HISTORY?0==this.m_boss_list.length?(this.m_empty_list.setVisible(!0),this.m_empty_list.setString(res_str("label_raid_boss_history_nothing"))):this.m_empty_list.setVisible(!1):0==this.m_boss_list.length?(this.m_empty_list.setVisible(!0),this.m_empty_list.setString(res_str("label_raid_boss_list_nothing"))):this.m_empty_list.setVisible(!1);if(this.m_current_list_type==RaidBossListEnum.BOSS_CALL)this.m_boss_list=stable(this.m_boss_list,function(l,r){var m=MasterManager.getInstance(),l_b=m.get_RaidBossInfo(l.raid_boss_info_idx),r_b=m.get_RaidBossInfo(r.raid_boss_info_idx);return l_b.element_type>r_b.element_type}.bind(this));else switch(this.m_tab_sort_type[this.m_current_list_type]){case RaidBossListEnum.BOSS_LIST_SORT_TYPE_REMAIN_TIME:this.m_boss_list=stable(this.m_boss_list,function(l,r){var l_t=moment(l.end_dt),r_t=moment(r.end_dt);return this.m_tab_sort_order_type[this.m_current_list_type]==RaidBossListEnum.BOSS_LIST_SORT_ORDER_DESC?l_t.valueOf()<r_t.valueOf():l_t.valueOf()>r_t.valueOf()}.bind(this));break;case RaidBossListEnum.BOSS_LIST_SORT_TYPE_LEVEL:this.m_boss_list=stable(this.m_boss_list,function(l,r){return this.m_tab_sort_order_type[this.m_current_list_type]==RaidBossListEnum.BOSS_LIST_SORT_ORDER_DESC?l.boss_level<r.boss_level:l.boss_level>r.boss_level}.bind(this));break;case RaidBossListEnum.BOSS_LIST_SORT_TYPE_ELEMENT_TYPE:this.m_boss_list=stable(this.m_boss_list,function(l,r){var l_b=mt.get_RaidBossInfo(l.raid_boss_info_idx),r_b=mt.get_RaidBossInfo(r.raid_boss_info_idx);return this.m_tab_sort_order_type[this.m_current_list_type]==RaidBossListEnum.BOSS_LIST_SORT_ORDER_DESC?l_b.element_type<r_b.element_type:l_b.element_type>r_b.element_type}.bind(this))}this.m_tableView.reloadData(),this.m_current_list_type==RaidBossListEnum.BOSS_CALL?this.m_cur_tab_info_label.setString(res_str("label_raid_boss_tab_desc_0_title")):this.m_cur_tab_info_label.setString(this.m_tab_labels[this.m_current_list_type]+" "+this.m_boss_list.length+"/100"),this.m_cur_tab_desc_label.setString(this.m_tab_desc_labels.at(this.m_current_list_type))},reqRaidBossTypeList:function(boss_type,raid_boss_info_idx){var req={};req.opcode=net.OP.op_raid_boss_type_list,req.raid_boss_type=boss_type,req.raid_boss_info_idx=raid_boss_info_idx;var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent),0==RaidBossList_INIT&&this.getParent().initLayoutProgress_circle_inner()},tableCellEnded:function(){},tableCellSizeForIndex:function(){return cc.size(924,112)}}),PREV_ACHIVE_RAIDBOSS=!1,RaidBossListScene=GameScene.extend({m_list_layer:null,m_gnrl_img:null,m_loadlist:!1,m_progres_bar2:null,ctor:function(){PREV_HELP=!1,PREV_ACHIVE_RAIDBOSS=!1,this.m_list_layer=null,this.m_blockBackKey=!1,this.m_loadlist=!1,this.m_gnrl_img=[],this.m_progres_bar2=null,this._super(scene_RaidBossListScene)},init:function(){0==this.m_loadlist&&(this.m_loadlist=!0),this.initLayoutProgress2();var win_size=cc.director.getWinSize();this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/bg_raid_list.jpg"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/img_raid_boss_1.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/img_raid_boss_2.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/img_raid_boss_3.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/img_raid_boss_4.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/img_raid_boss_die.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/img_raid_state_find.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/img_raid_state_join.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/img_raid_state_escape.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_raid/img_raid_state_die.png"),resourceLoader(this.m_gnrl_img,function(){var bg;USE_SP_RAIDBOSS_SCALE?((bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/bg_raid_list.jpg")).setAnchorPoint(ANCHOR_MIDDLE()),bg.setScale(2),bg.setPosition(ccCenter(win_size)),this.addChild(bg)):((bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/bg_raid_list.jpg")).setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(win_size)),this.addChild(bg));this.m_list_layer=new RaidBossListLayer,this.m_list_layer.setPosition(ccCenter(win_size)),this.addChild(this.m_list_layer);var statusLayer=new StatusLayer(INVOKER_TYPE.raid_boss);statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer);var title,back_btn=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png","");(back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(){if(0==this.m_blockBackKey){if(1==RAID_BOSS_MODAL_OPEN_FLAG)return;this.back()}}.bind(this)),this.addChild(back_btn),USE_SP_RAIDBOSS_SCALE)?((title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_raid.png")).setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title)):((title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_raid.png")).setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title))}.bind(this))},removeProgressEnd:function(){this.removeLayerProgress2()},onEnter:function(){this._super(),PREV_ACHIVE_RAIDBOSS=!1,MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_RaidBossListScene]),this.playMainBGM(),this.m_blockBackKey=!1},onExit:function(){if(this._super(),!PREV_HELP&&1!=PREV_ACHIVE_MUSSANG_ROAD){if(null!=this.m_gnrl_img){for(var idx=0;idx<this.m_gnrl_img.length;idx++)cc.loader.release(this.m_gnrl_img[idx]);this.m_gnrl_img=null}MainObserver.getInstance().removeObserver(sceneStr[scene_RaidBossListScene])}},onNotification:function(msg){switch(this._super(msg),msg){case RaidBossListEnum.req_boss_list:this.reqBossList();break;case RaidBossListEnum.req_boss_history:this.reqBossHistory();break;case RaidBossListEnum.req_get_user_raid_boss_damage:this.reqGetUserRaidBossDamage();break;case RaidBossListEnum.BTN_SHOW_HELP:GameContext.getInstance().setHelpInfoIndexByCallIndex(204);var scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null}return!0},onNetworkEvent:function(opcode,state,body){if(opcode==net.OP.op_get_user_raid_boss_list);else if(opcode==net.OP.op_get_user_raid_boss_history);else if(opcode==net.OP.op_raid_boss_shared)body.error==net.ERROR.NET_E_SHARED_FRIENDS_IS_NOBODY?this.showErrorMessage(res_str("label_raid_boss_shared_friends_is_nobody_error_msg")):body.error==net.ERROR.NET_E_ALREADY_SHARED?this.showErrorMessage(res_str("label_raid_boss_already_shared_error_msg")):(this.m_list_layer.refreshBossList_1(body.raid_boss_info),this.showErrorMessage(res_str("label_raid_boss_shared_complete")));else if(opcode==net.OP.op_raid_boss_call_boss)if(body.error==net.ERROR.NET_E_INVALID_PERIOD)this.showErrorMessage(res_str("label_raid_boss_invalid_period_error_msg"));else if(body.error==net.ERROR.NET_E_ALREADY_EXIST_DATA)this.showErrorMessage(res_str("label_raid_boss_already_call_boss_error_msg"));else if(body.error==net.ERROR.NET_E_NOT_EXIST_DATA)this.showErrorMessage(res_str("label_raid_boss_not_exist_boss_error_msg"));else for(var i=0;i<body.raid_boss_list.length;i++){var raid_boss_info=body.raid_boss_list[i];if(raid_boss_info.activity_type==database.Raid_Boss_Activity_Type.Raid_Boss_Activity_Type_Ing){this.m_blockBackKey=!0,this.m_list_layer.startRaidBossBattleAfterCall(raid_boss_info);break}}else if(opcode==net.OP.op_raid_boss_force_retreat)body.error==net.ERROR.NET_E_ALREADY_RETREAT||this.m_list_layer.refreshBossList(body.raid_boss_list),this.showErrorMessage(res_str("label_raid_boss_already_retreat_error_msg"));else if(opcode==net.OP.op_raid_boss_partin_user_list)this.m_list_layer.showRaidBossPartinListPopup(body.partin_user_list);else if(opcode==net.OP.op_friend_request);else if(opcode==net.OP.op_get_user_raid_boss_damage){var req={};req.opcode=net.OP.op_get_server_time_check,this.network_write(req),BattleContext._getInstance().setUserRaidBossBeforeDamage(body.damage);var scene=new RaidBossBattleReadyScene;SceneManager.getInstance().replaceScene(scene),scene=null}else opcode==net.OP.op_raid_boss_type_list&&(1==this.m_loadlist?(this.removeProgressEnd(),this.m_loadlist=!1):this.removeLayerProgress_circle_inner(),this.m_list_layer.refreshBossList(body.raid_boss_list))},back:function(){this.onKeyBack(!0)},reqBossList:function(){var req={};req.opcode=net.OP.op_get_user_raid_boss_list,this.network_write(req),req={}},reqBossHistory:function(){var req={};req.opcode=net.OP.op_get_user_raid_boss_history,this.network_write(req),req={}},reqGetUserRaidBossDamage:function(){var req={};req.opcode=net.OP.op_get_user_raid_boss_damage;var raid_boss_battle_info=BattleContext._getInstance().getRaidBossData();req.raid_boss_info_idx=raid_boss_battle_info.raid_boss_info_idx,req.boss_level=raid_boss_battle_info.boss_level,this.network_write(req),req={}},initLayoutProgress_circle_inner:function(alpa){if(1!=this.m_loadlist&&!IS_NET_ERROR){this.m_progres_bar2=new cc.Layer,null==alpa&&(alpa=255),this.m_progres_bar2.setContentSize(ccSize(this));var bg=cc.Sprite.create(RES_CM+"img_progress_bg.png");bg.setPosition(ccCenter(this));var bar=cc.Sprite.create(RES_CM+"img_progress_arrow.png");bar.setPosition(ccCenter(bg)),bg.addChild(bar,1000001),this.m_progres_bar2.addChild(bg),this.addChild(this.m_progres_bar2,1000001);var mu=new cc.RotateBy(.1,30),seq=new cc.Sequence(mu),repeat=new cc.RepeatForever(seq);bar.runAction(repeat);var listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE});listener.onTouchBegan=function(touch,event){event.stopPropagation()}.bind(this);var mouse_listener=cc.EventListener.create({event:cc.EventListener.MOUSE,onMouseScroll:function(event){event.stopPropagation()}.bind(this)});cc.eventManager.addListener(mouse_listener,this.m_progres_bar2),cc.eventManager.addListener(listener,this.m_progres_bar2)}},removeLayerProgress_circle_inner:function(){null!=this.m_progres_bar2&&(this.removeChild(this.m_progres_bar2),this.m_progres_bar2=null)},showErrorMessage:function(msg){this.m_box.setTitle(res_str("label_common_information")),this.m_box.setText(msg),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()}}),RaidBossPartInUserListCell=cc.TableViewCell.extend({m_user:null,m_user_gnrl:null,m_friend_yn_icon:null,m_user_nickname:null,m_accum_damage:null,m_reward_info_1:null,m_reward_info_2:null,m_reward_info_3:null,m_reward_count_1:null,m_reward_count_2:null,m_reward_count_3:null,m_reward_not_passing:null,m_list_bg:null,m_list_type:0,m_raid_boss_activity_type:0,m_btn_freind_req:[],_callback_req_friend:null,m_user_naming:null,ctor:function(){this._super(),this.m_user=null,this.m_user_gnrl=null,this.m_friend_yn_icon=null,this.m_user_nickname=null,this.m_user_naming=null,this.m_accum_damage=null,this.m_reward_info_1=null,this.m_reward_info_2=null,this.m_reward_info_3=null,this.m_reward_count_1=null,this.m_reward_count_2=null,this.m_reward_count_3=null,this.m_reward_not_passing=null,this.m_list_bg=null,this.m_list_type=0,this.m_raid_boss_activity_type=0,this.m_btn_freind_req=[],this._callback_req_friend=null,this.init()},init:function(){var cellSize=cc.size(596,144);this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(cellSize),this.m_list_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero()),this.m_list_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_list_bg.setPosition(ZERO()),this.m_list_bg.setContentSize(cellSize),this.addChild(this.m_list_bg),this.m_user_gnrl=cc.Sprite.create("#m_12001"),this.m_user_gnrl.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_user_gnrl.setPosition(10,23),this.m_list_bg.addChild(this.m_user_gnrl),this.m_friend_yn_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_friend/img_friend_text_1.png"),this.m_friend_yn_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_friend_yn_icon.setPosition(128,105),this.m_list_bg.addChild(this.m_friend_yn_icon),this.m_user_nickname=cmLabel.getLabel("nick",LABEL_FONT_INDEX.FONT_181),this.m_user_nickname.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_user_nickname.setPosition(220,112),this.m_list_bg.addChild(this.m_user_nickname),this.m_user_naming=cmLabel.getLabel("nick",LABEL_FONT_INDEX.FONT_181),this.m_user_naming.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_user_naming.setPosition(ccPosX(this.m_user_nickname)+ccWidth(this.m_user_nickname)+5,ccPosY(this.m_user_nickname)),this.m_list_bg.addChild(this.m_user_naming),this.m_accum_damage=cmLabel.getLabel("ダメージ : ",LABEL_FONT_INDEX.FONT_181),this.m_accum_damage.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_accum_damage.setPosition(128,90),this.m_list_bg.addChild(this.m_accum_damage),this.m_accum_damage_num=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1810),this.m_accum_damage_num.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_accum_damage_num.setPosition(128+ccWidth(this.m_accum_damage),90),this.m_list_bg.addChild(this.m_accum_damage_num),this.m_reward_info_1=cmLabel.getLabel(res_str("label_raid_boss_reward_type_1"),LABEL_FONT_INDEX.FONT_161),this.m_reward_info_1.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_reward_info_1.setPosition(128,57),this.m_list_bg.addChild(this.m_reward_info_1);var reward_icon_1=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_pt_small.png");reward_icon_1.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),reward_icon_1.setPosition(137,-3),this.m_reward_info_1.addChild(reward_icon_1),this.m_reward_count_1=cmLabel.getLabel("x10",LABEL_FONT_INDEX.FONT_165),this.m_reward_count_1.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_reward_count_1.setPosition(163,0),this.m_reward_info_1.addChild(this.m_reward_count_1),this.m_reward_info_2=cmLabel.getLabel(res_str("label_raid_boss_reward_type_2"),LABEL_FONT_INDEX.FONT_161),this.m_reward_info_2.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_reward_info_2.setPosition(128,37),this.m_list_bg.addChild(this.m_reward_info_2);var reward_icon_2=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_pt_small.png");reward_icon_2.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),reward_icon_2.setPosition(137,-3),this.m_reward_info_2.addChild(reward_icon_2),this.m_reward_count_2=cmLabel.getLabel("x10",LABEL_FONT_INDEX.FONT_165),this.m_reward_count_2.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_reward_count_2.setPosition(163,0),this.m_reward_info_2.addChild(this.m_reward_count_2),this.m_reward_info_3=cmLabel.getLabel(res_str("label_raid_boss_reward_type_3"),LABEL_FONT_INDEX.FONT_161),this.m_reward_info_3.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_reward_info_3.setPosition(128,17),this.m_list_bg.addChild(this.m_reward_info_3);var reward_icon_3=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_pt_small.png");reward_icon_3.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),reward_icon_3.setPosition(137,-3),this.m_reward_info_3.addChild(reward_icon_3),this.m_reward_count_3=cmLabel.getLabel("x10",LABEL_FONT_INDEX.FONT_165),this.m_reward_count_3.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_reward_count_3.setPosition(163,0),this.m_reward_info_3.addChild(this.m_reward_count_3),this.m_reward_not_passing=cmLabel.getLabel(res_str("label_raid_boss_partin_user_reward_not"),LABEL_FONT_INDEX.FONT_181),this.m_reward_not_passing.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_reward_not_passing.setPosition(128,37),this.m_list_bg.addChild(this.m_reward_not_passing);var off=cc.Sprite.create("#btn_05_off.png");off.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),off.setPosition(cellSize.width-14,Math.floor(.5*cellSize.height)),this.m_list_bg.addChild(off);var off_label=cmLabel.getLabel(res_str("label_helper_friend_request_title"),LABEL_FONT_INDEX.FONT_161);off_label.setAnchorPoint(ANCHOR_MIDDLE()),off_label.setPosition(ccCenter(off)),off.addChild(off_label);var on=cc.Sprite.create("#btn_05_on.png");on.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),on.setPosition(cellSize.width-14,Math.floor(.5*cellSize.height)),this.m_list_bg.addChild(on);var on_label=cmLabel.getLabel(res_str("label_helper_friend_request_title"),LABEL_FONT_INDEX.FONT_161);on_label.setAnchorPoint(ANCHOR_MIDDLE()),on_label.setPosition(ccCenter(off)),on.addChild(on_label),this.m_btn_freind_req.push(off),this.m_btn_freind_req.push(on),cellSize=null},setData:function(user,raid_boss_activity_type,list_type){this.m_user=user,this.m_list_type=list_type,this.m_raid_boss_activity_type=raid_boss_activity_type,this.updateCell()},updateCell:function(){MasterManager.getInstance(),cc.size(this.m_list_bg);null!=this.m_user_gnrl.getParent()&&this.m_user_gnrl.removeFromParent();var card={};if(card.gnrl_id=this.m_user.partner_gnrl_info.partner_gnrl_id,card.level=this.m_user.partner_gnrl_info.partner_gnrl_lv,card.limit_step_id=this.m_user.partner_gnrl_info.partner_gnrl_limit_step_id,card.love_level=this.m_user.partner_gnrl_info.partner_gnrl_love_lv,this.m_user_gnrl=(new Card).createCard(card,CARD_TYPE.type_common_card),this.m_user_gnrl.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_user_gnrl.setPosition(10,23),this.m_list_bg.addChild(this.m_user_gnrl),card={},this.m_user_nickname.setString(this.m_user.nickname),null!=this.m_user_naming&&this.m_user_naming.setString(this.m_user.naming),m_user_id==this.m_user.user_id)this.m_friend_yn_icon.setVisible(!1),this.m_user_nickname.setPosition(128,102),null!=this.m_user_naming&&this.m_user_naming.setPosition(ccPosX(this.m_user_nickname)+ccWidth(this.m_user_nickname)+5,ccPosY(this.m_user_nickname)),this.showBtn(!1);else if(this.m_friend_yn_icon.setVisible(!0),this.m_user_nickname.setPosition(230,109),null!=this.m_user_naming&&this.m_user_naming.setPosition(ccPosX(this.m_user_nickname)+ccWidth(this.m_user_nickname)+5,ccPosY(this.m_user_nickname)),"y"==this.m_user.friend_yn){var friend_yn_icon_img2=RES_CDN_DEFULT+"menu_friend/img_friend_text_2.png",frame2_texture=cc.textureCache.addImage(friend_yn_icon_img2),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_friend_yn_icon.setSpriteFrame(frame2),this.showBtn(!1)}else if("y"==this.m_user.request_yn){var friend_yn_icon_img1=RES_CDN_DEFULT+"menu_friend/img_friend_text_1.png",frame1_texture=cc.textureCache.addImage(friend_yn_icon_img1),frame=new cc.SpriteFrame(frame1_texture,cc.rect(0,0,frame1_texture.getContentSize().width,frame1_texture.getContentSize().height));this.m_friend_yn_icon.setSpriteFrame(frame),this.showBtn(!1)}else{friend_yn_icon_img1=RES_CDN_DEFULT+"menu_friend/img_friend_text_1.png",frame1_texture=cc.textureCache.addImage(friend_yn_icon_img1),frame=new cc.SpriteFrame(frame1_texture,cc.rect(0,0,frame1_texture.getContentSize().width,frame1_texture.getContentSize().height));this.m_friend_yn_icon.setSpriteFrame(frame),this.showBtn(!0)}if(0==this.m_user.accum_damage?this.m_user.user_id==this.m_user.discovered_user_id?0==this.m_user.challenge_count?this.m_accum_damage.setString(res_str("label_raid_boss_no_partin")):this.m_accum_damage_num.setString(parseInt(this.m_user.accum_damage).toLocaleString("en")):1==this.m_user.challenge_count?this.m_accum_damage.setString(res_str("label_raid_boss_battle_ing")):this.m_accum_damage_num.setString(parseInt(this.m_user.accum_damage).toLocaleString("en")):this.m_accum_damage_num.setString(parseInt(this.m_user.accum_damage).toLocaleString("en")),0==this.m_list_type)this.m_reward_info_1.setVisible(!1),this.m_reward_info_2.setVisible(!1),this.m_reward_info_3.setVisible(!1),this.m_reward_not_passing.setVisible(!1);else if(this.m_raid_boss_activity_type==database.Raid_Boss_Activity_Type.Raid_Boss_Activity_Type_Win)if("y"==this.m_user.reward_yn){this.m_reward_not_passing.setVisible(!1),this.m_reward_info_1.setVisible(!1),this.m_reward_info_2.setVisible(!1),this.m_reward_info_3.setVisible(!1);var offset_y=57;if(0<this.m_user.raid_boss_reward_list.length)for(var i=0;i<this.m_user.raid_boss_reward_list.length;i++){var r=this.m_user.raid_boss_reward_list[i];1==r.raid_boss_reward_type?(this.m_reward_info_1.setVisible(!0),this.m_reward_count_1.setString(cmString("x%d",r.bonus_count)),this.m_reward_info_1.setPositionY(offset_y),offset_y-=20):2==r.raid_boss_reward_type?(this.m_reward_info_2.setVisible(!0),this.m_reward_count_2.setString(cmString("x%d",r.bonus_count)),this.m_reward_info_2.setPositionY(offset_y),offset_y-=20):3==r.raid_boss_reward_type&&(this.m_reward_info_3.setVisible(!0),this.m_reward_count_3.setString(cmString("x%d",r.bonus_count)),this.m_reward_info_3.setPositionY(offset_y),offset_y-=20)}else this.m_reward_not_passing.setVisible(!0)}else this.m_reward_not_passing.setVisible(!0),this.m_reward_info_1.setVisible(!1),this.m_reward_info_2.setVisible(!1),this.m_reward_info_3.setVisible(!1);else this.m_reward_info_1.setVisible(!1),this.m_reward_info_2.setVisible(!1),this.m_reward_info_3.setVisible(!1),this.m_reward_not_passing.setVisible(!1)},showBtn:function(is_show){if(is_show)this.m_btn_freind_req[0].setVisible(!0),this.m_btn_freind_req[1].setVisible(!1);else for(var i=0;i<this.m_btn_freind_req.length;i++){this.m_btn_freind_req[i].setVisible(!1)}},highlightPosInCell:function(pos){if("y"!=this.m_user.friend_yn&&"y"!=this.m_user.request_yn&&m_user_id!=this.m_user.user_id){var box=this.m_btn_freind_req[0].getBoundingBox();cc.rectContainsPoint(box,pos)&&(this.m_btn_freind_req[0].setVisible(!1),this.m_btn_freind_req[1].setVisible(!0))}},unhighlightPosInCell:function(pos){"y"!=this.m_user.friend_yn&&"y"!=this.m_user.request_yn&&m_user_id!=this.m_user.user_id&&this.showBtn(!0)},touchPosInCell:function(pos){if("y"!=this.m_user.friend_yn&&"y"!=this.m_user.request_yn&&m_user_id!=this.m_user.user_id){var box=this.m_btn_freind_req[0].getBoundingBox();cc.rectContainsPoint(box,pos)&&(this.m_btn_freind_req[0].setVisible(!0),this.m_btn_freind_req[1].setVisible(!1),null!=this._callback_req_friend&&(this.m_user.request_yn="y",this._callback_req_friend(this.m_user.user_id)))}}}),RaidBossPartInUserListLayer=cc.Layer.extend({m_title:null,m_table_view:null,m_list_type:0,m_raid_boss_activity_type:0,m_partin_list:[],_callback_close_popup:null,ctor:function(){this._super(),this.m_title=null,this.m_table_view=null,this.m_list_type=0,this.m_raid_boss_activity_type=0,this.m_partin_list=[],this._callback_close_popup=null,this.init()},init:function(){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var winSize=cc.director.getWinSize(),boxSize=(MasterManager.getInstance(),cc.size(630,500)),box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));box.setAnchorPoint(ANCHOR_MIDDLE()),box.setPreferredSize(boxSize),box.setPosition(ccCenter(winSize)),this.addChild(box);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_3.png");navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(Math.floor(.5*boxSize.width),boxSize.height-11),box.addChild(navi);var naviSize=ccSize(navi);this.m_title=cmLabel.getLabel(res_str("label_raid_boss_partin_list"),LABEL_FONT_INDEX.FONT_261),this.m_title.setAnchorPoint(ANCHOR_MIDDLE()),this.m_title.setPosition(Math.floor(.5*naviSize.width),Math.floor(.5*naviSize.height+2)),navi.addChild(this.m_title);var btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);btn.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),btn.setPosition(naviSize.width-10,Math.floor(.5*naviSize.height+3)),navi.addChild(btn),btn.addClickEventListener(function(sender){RAID_BOSS_MODAL_OPEN_FLAG=!1,null!=this._callback_close_popup&&this._callback_close_popup()}.bind(this));var tSize=cc.size(596,424);this.m_table_view=new cc.TableView(this,tSize),this.m_table_view.setDelegate(this),this.m_table_view.ignoreAnchorPointForPosition(!1),this.m_table_view.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_table_view.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_table_view.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_table_view.setPosition(17,18),box.addChild(this.m_table_view),boxSize=winSize=null},cellSizeForTable:function(table){return cc.size(596,144)},tableCellSizeForIndex:function(){return cc.size(596,144)},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;null!=c?cell=c:(cell=new RaidBossPartInUserListCell)._callback_req_friend=this.cbFriendRequest.bind(this);var data=this.m_partin_list[idx];return cell.setData(data,this.m_raid_boss_activity_type,this.m_list_type),cell},numberOfCellsInTableView:function(table){return this.m_partin_list.length},tableCellTouched:function(table,cell){null!=cell&&cell.touchPosInCell(cell.getTouchPos())},tableCellEnded:function(){return!0},tableCellHighlight:function(table,cell){null!=cell&&cell.highlightPosInCell(cell.getTouchPos())},tableCellUnhighlight:function(table,cell){null!=cell&&cell.unhighlightPosInCell(cell.getTouchPos())},setRaidBossPartinUserList:function(list,raid_boss_activity_type,list_type){this.m_partin_list=list,this.m_list_type=list_type,this.m_raid_boss_activity_type=raid_boss_activity_type,this.m_table_view.reloadData(),this.m_title.setString(cmString(res_str("label_raid_boss_partin_list_title"),this.m_partin_list.length))},cbFriendRequest:function(frnd_user_id){for(var i=0;i<this.m_partin_list.length;i++){var part=this.m_partin_list[i];part.user_id==frnd_user_id&&(part.request_yn="y"),part=null}var req={};req.opcode=net.OP.op_friend_request,req.frnd_user_id=frnd_user_id;var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent),req={};var offset=this.m_table_view.getContentOffset();this.m_table_view.reloadData(),this.m_table_view.setContentOffset(offset)}}),RaidBossSharedPopupLayer=cc.Layer.extend({m_boss:null,m_new_raid_boss:null,_callback_shared:null,_callback_close_popup:null,_callback_new_raid_shared:null,m_is_new_raid_boss:!1,m_box:null,ctor:function(){this._super(),this.m_boss=null,this.m_new_raid_boss=null,this._callback_shared=null,this._callback_close_popup=null,this.init()},init:function(){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var winSize=cc.director.getWinSize(),boxSize=cc.size(630,370);this.m_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10)),this.m_box.setAnchorPoint(ANCHOR_MIDDLE()),this.m_box.setPreferredSize(boxSize),this.m_box.setPosition(ccCenter(winSize)),this.addChild(this.m_box);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_3.png");navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(Math.floor(.5*boxSize.width),boxSize.height-11),this.m_box.addChild(navi);var naviSize=ccSize(navi),title=cmLabel.getLabel(res_str("label_raid_boss_shared"),LABEL_FONT_INDEX.FONT_261);title.setAnchorPoint(ANCHOR_MIDDLE()),title.setPosition(Math.floor(.5*naviSize.width),Math.floor(.5*naviSize.height+2)),navi.addChild(title);var btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);btn.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),btn.setPosition(Math.floor(naviSize.width-10),Math.floor(.5*naviSize.height+3)),navi.addChild(btn),btn.addClickEventListener(function(sender){RAID_BOSS_MODAL_OPEN_FLAG=!1,null!=this._callback_close_popup&&this._callback_close_popup()}.bind(this));var content=cmLabel.getLabel(res_str("label_raid_boss_shared_message"),LABEL_FONT_INDEX.FONT_261);content.setAnchorPoint(ANCHOR_MIDDLE()),content.setPosition(Math.floor(.5*boxSize.width),210),this.m_box.addChild(content);var notice=cmLabel.getLabel(res_str("label_raid_boss_shared_notice"),LABEL_FONT_INDEX.FONT_207);return notice.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),notice.setPosition(Math.floor(.5*boxSize.width),90),this.m_box.addChild(notice),!0},createBtnRaidBoss:function(){cc.director.getWinSize();var btn,small_cond,btn_label,boxSize=cc.size(630,370);(btn=new ccui.Button("btn_17_off.png","btn_17_on.png","",ccui.Widget.PLIST_TEXTURE)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn.setPosition(Math.floor(.5*boxSize.width-186),17),this.m_box.addChild(btn),btn.addClickEventListener(function(sender){RAID_BOSS_MODAL_OPEN_FLAG=!1,this.sendRaidBossShared(database.Raid_Boss_Shared_Type.Raid_Boss_Shared_Type_Ex_Friends_All_User)}.bind(this)),(small_cond=cmLabel.getLabel(res_str("label_raid_boss_shared_ex_friends"),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),small_cond.setPosition(Math.floor(.5*ccWidth(btn)),30),btn.addChild(small_cond),(btn_label=cmLabel.getLabel(res_str("label_raid_boss_shared_req"),LABEL_FONT_INDEX.FONT_143)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn_label.setPosition(Math.floor(.5*ccWidth(btn)),8),btn.addChild(btn_label),(btn=new ccui.Button("btn_17_off.png","btn_17_on.png","",ccui.Widget.PLIST_TEXTURE)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn.setPosition(Math.floor(.5*boxSize.width),17),this.m_box.addChild(btn),btn.addClickEventListener(function(sender){RAID_BOSS_MODAL_OPEN_FLAG=!1,this.sendRaidBossShared(database.Raid_Boss_Shared_Type.Raid_Boss_Shared_Type_Friends_And_All_User)}.bind(this)),(small_cond=cmLabel.getLabel(res_str("label_raid_boss_shared_all_users"),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),small_cond.setPosition(.5*ccWidth(btn),30),btn.addChild(small_cond),(btn_label=cmLabel.getLabel(res_str("label_raid_boss_shared_req"),LABEL_FONT_INDEX.FONT_143)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn_label.setPosition(.5*ccWidth(btn),8),btn.addChild(btn_label),(btn=new ccui.Button("btn_17_off.png","btn_17_on.png","",ccui.Widget.PLIST_TEXTURE)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn.setPosition(Math.floor(.5*boxSize.width+186),17),this.m_box.addChild(btn),btn.addClickEventListener(function(sender){RAID_BOSS_MODAL_OPEN_FLAG=!1,this.sendRaidBossShared(database.Raid_Boss_Shared_Type.Raid_Boss_Shared_Type_Only_Friends)}.bind(this)),(small_cond=cmLabel.getLabel(res_str("label_raid_boss_shared_only_friends"),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),small_cond.setPosition(.5*ccWidth(btn),30),btn.addChild(small_cond),(btn_label=cmLabel.getLabel(res_str("label_raid_boss_shared_req"),LABEL_FONT_INDEX.FONT_143)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn_label.setPosition(.5*ccWidth(btn),8),btn.addChild(btn_label),boxSize=null},createBtnNewRaidBoss:function(){var btn,small_cond,boxSize=ccSize(this.m_box);(btn=new LabelButton("btn_17_off.png","btn_17_on.png","",ccui.Widget.PLIST_TEXTURE)).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),btn.setPosition(.5*boxSize.width-10,17),this.m_box.addChild(btn),btn.addClickEventListener(function(sender){this.sendRaidBossShared(database.New_Raid_Boss_Shared_Type.New_Raid_Boss_Shared_Type_All_User)}.bind(this)),(small_cond=cmLabel.getLabel(res_str("new_raidboss_battle_stage_support_pop_up_button_support_all"),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_MIDDLE()),small_cond.setPosition(.5*ccWidth(btn),.5*ccHeight(btn)),btn.addChild(small_cond),(btn=new LabelButton("btn_17_off.png","btn_17_on.png","",ccui.Widget.PLIST_TEXTURE)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn.setPosition(.5*boxSize.width+10,17),this.m_box.addChild(btn),btn.addClickEventListener(function(sender){this.sendRaidBossShared(database.New_Raid_Boss_Shared_Type.New_Raid_Boss_Shared_Type_Friend)}.bind(this)),(small_cond=cmLabel.getLabel(res_str("new_raidboss_battle_stage_support_pop_up_button_support_friend"),LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_MIDDLE()),small_cond.setPosition(.5*ccWidth(btn),.5*ccHeight(btn)),btn.addChild(small_cond)},sendRaidBossShared:function(shared_type){this.m_is_new_raid_boss?null!=this._callback_new_raid_shared&&this._callback_new_raid_shared(this.m_new_raid_boss,shared_type):null!=this._callback_shared&&this._callback_shared(this.m_boss,shared_type)},setRaidBossData:function(boss){this.m_boss=boss,this.m_is_new_raid_boss=!1,this.createBtnRaidBoss()},setNewRaidBossData:function(boss){this.m_new_raid_boss=boss,this.m_is_new_raid_boss=!0,this.createBtnNewRaidBoss()}}),NewRaidBossBattleReadyBossInfoLayer=cc.Layer.extend({}),NewRaidBattleEnum={NEW_RAID_BOSS_BATTLE_BEGIN:100,NEW_RAID_BOSS_REQ_PARTNER_LIST:101,NEW_RAID_BOSS_REQ_CONQUEST:102,NEW_RAID_BOSS_CHARGE_CONQUEST_KEY:103,NEW_RAID_BOSS_TIME_OVER:104,NEW_RAID_BOSS_EMPTY_TROOPS:105,NEW_RAID_BOSS_SHOW_CANT_RUN:106},NewRaidBattleReadyEnum={PARTNER_LIST_TYPE_NONE:1,PARTNER_LIST_TYPE_PARTIN:2,PARTNER_LIST_TYPE_REFRESH:3},NewRaidBossBattleReadyLayer=cc.Layer.extend({m_layer:null,m_BossName_Label:null,m_partin_btn:null,m_partin_modal_layer:null,m_bg:null,m_bg2:null,m_info_label:null,m_remain_time_label:null,m_per_label:null,m_difficulty_label:null,m_PartnerListReqType:NewRaidBattleReadyEnum.PARTNER_LIST_TYPE_REFRESH,m_key_count_label:null,m_needKey:0,ctor:function(){this._super(),this.init()},init:function(){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var winSize=ccSize(this),new_raid_boss_service=NewRaidBossService.getInstance(),m=MasterManager.getInstance(),user_info=NetService().get_User_info();this.m_layer=new cc.Layer,this.m_layer.ignoreAnchorPointForPosition(!1),this.m_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_layer.setPosition(ccCenter(winSize)),this.addChild(this.m_layer);var BossData=new_raid_boss_service.GetCurrentBoss(),BossCount=(m.get_NewRaidBossDungeonInfo(BossData.new_raid_boss_dungeon_info_idx),m.get_NewRaidBossNpcGroup(BossData.new_raid_boss_dungeon_info_idx),0);null!=BossData.boss_data_list&&(BossCount=BossData.boss_data_list.size()),1==BossCount?this.SetInfo_1():this.SetInfo_2();var start_btn=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_1_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_1_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_1_none.png");start_btn.setContentSize(236,58),start_btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM());var btn_rect=cc.Rect(16,16,26,26);start_btn.setTitleFont(btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255)),start_btn.setPosition(ccCenter(this.m_layer).x,20),this.m_layer.addChild(start_btn),start_btn.addClickEventListener(function(sender){this.battleStart()}.bind(this));var btn_label=cmLabelEx.getLabel(res_str("new_raidboss_standby_attack_button_text"),LABEL_FONT_INDEX.FONT_2272,!1,!0,2,cc.color(255,255,255,255));btn_label.setAnchorPoint(ANCHOR_MIDDLE()),btn_label.setPosition(71,ccCenter(start_btn).y),start_btn.addChild(btn_label);var btn_key_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_txtbox_6.png",RectZero());btn_key_bg.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),btn_key_bg.setPreferredSize(cc.size(72,28)),btn_key_bg.setPosition(ccWidth(start_btn)-13,ccCenter(start_btn).y),start_btn.addChild(btn_key_bg);var btn_key=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_raidhelp2.png");btn_key.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),btn_key.setPosition(.5*ccWidth(btn_key),ccCenter(btn_key_bg).y),btn_key_bg.addChild(btn_key);for(var dungeon_list=MasterTable.getInstance().get_NewRaidBossDungeonListData(new_raid_boss_service.GetCurrentPeriodIdx()),dungeon_info={},info=NetService().get_UserItemInfo_V2(),currentBoss=new_raid_boss_service.GetCurrentBoss(),i=0;i<dungeon_list.length;i++)if(dungeon_list[i].difficult==currentBoss.difficult){dungeon_info=dungeon_list[i];break}this.m_needKey=dungeon_info.need_subdue_key;var font=this.m_needKey<=info.new_raid_conquest_ticket_cnt?LABEL_FONT_INDEX.FONT_1875:LABEL_FONT_INDEX.FONT_1877;if(this.m_key_count_label=cmLabelEx.getLabel(cmString("%s",Number(dungeon_info.need_subdue_key).toLocaleString("en")),font,!1,!0,2,cc.color(0,0,0,255)),this.m_key_count_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_key_count_label.setPosition(ccWidth(btn_key_bg)-13,ccCenter(btn_key_bg).y),btn_key_bg.addChild(this.m_key_count_label),user_info.user_id==BossData.discovered_user_id){var kill_btn=new ccui.Button;kill_btn.loadTextures(RES_CDN_DEFULT+"new_menu_raid2/btn_raid2_run_off.png",RES_CDN_DEFULT+"new_menu_raid2/btn_raid2_run_on.png",""),kill_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),kill_btn.setPosition(ccSize(this).width,0),this.m_layer.addChild(kill_btn),kill_btn.addClickEventListener(function(sender){0!=NewRaidBossService.getInstance().GetCurrentBoss().shared_type?this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_NewRaidBossBattleReadyScene],NewRaidBattleEnum.NEW_RAID_BOSS_SHOW_CANT_RUN)},0,"NEW_RAID_BOSS_SHOW_CANT_RUN"):this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_NewRaidBossBattleReadyScene],NewRaidBattleEnum.NEW_RAID_BOSS_REQ_CONQUEST)},0,"NEW_RAID_BOSS_REQ_CONQUEST")}.bind(this))}this.m_partin_btn=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_5_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_5_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_5_none.png"),this.m_partin_btn.setContentSize(168,42),this.m_partin_btn.setTitleFont(cc.Rect(20,20,20,2),LABEL_FONT_INDEX.FONT_2072,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255),cc.p(0,0)),this.m_partin_btn.setTitleText(cmString(res_str("new_raidboss_standby_entry_number"),BossData.partner_count,BossData.max_partner_count)),this.m_partin_btn.setBright(!0),this.m_partin_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_partin_btn.setPosition(15,20),this.m_partin_btn.addClickEventListener(function(sender){this.m_PartnerListReqType=NewRaidBattleReadyEnum.PARTNER_LIST_TYPE_PARTIN,this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_NewRaidBossBattleReadyScene],NewRaidBattleEnum.NEW_RAID_BOSS_REQ_PARTNER_LIST)},0,"NEW_RAID_BOSS_REQ_PARTNER_LIST")}.bind(this)),this.m_layer.addChild(this.m_partin_btn);var btn=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_5_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_5_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_5_none.png");btn.setContentSize(168,42),btn.setTitleFont(cc.Rect(20,20,20,2),LABEL_FONT_INDEX.FONT_2072,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255),cc.p(0,0)),btn.setTitleText(res_str("btn_label_arrangement_2")),btn.setBright(!0),btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn.setPosition(15,77),btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_NewRaidBossBattleReadyScene],NOTIFY_MENU_YUNHEE_SET)}),this.m_layer.addChild(btn);var msgBg=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_talkbox.png");msgBg.setContentSize(146,51),msgBg.setAnchorPoint(ANCHOR_MIDDLE()),msgBg.setPosition(ccCenter(btn).x,57),btn.addChild(msgBg),GameDefault.getInstance().getUserTroopsNum().done(function(_d_num){var troops_num=_d_num;this.m_info_label=cmLabel.getLabel(cmString(res_str("new_raidboss_standby_launch_army"),troops_num),LABEL_FONT_INDEX.FONT_1671),this.m_info_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_info_label.setPosition(ccCenter(msgBg).x,31),msgBg.addChild(this.m_info_label)}.bind(this));var d=new_raid_boss_service.GetBossRemainTime(BossData),raidpointMark_1=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_txtmark.png");raidpointMark_1.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),raidpointMark_1.setPosition(20,549),this.m_layer.addChild(raidpointMark_1),this.m_remain_time_label=cmLabel.getLabel(cmString(res_str("new_raidboss_standby_attack_run_time_text"),d._data.hours,d._data.minutes),LABEL_FONT_INDEX.FONT_2071),this.m_remain_time_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_remain_time_label.setPosition(42,545),this.m_layer.addChild(this.m_remain_time_label);var raidpointMark_2=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_txtmark.png");raidpointMark_2.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),raidpointMark_2.setPosition(20,521),this.m_layer.addChild(raidpointMark_2),this.m_per_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_262),this.m_per_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_per_label.setPosition(42,516),this.m_layer.addChild(this.m_per_label);var raidpointMark_3=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_txtmark.png");raidpointMark_3.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),raidpointMark_3.setPosition(20,493),this.m_layer.addChild(raidpointMark_3);var difficulty="";switch(BossData.difficult){case 1:difficulty=res_str("new_raidboss_main_mode_button_easy");break;case 2:difficulty=res_str("new_raidboss_main_mode_button_hard");break;default:difficulty="UNKNOWN"}this.m_difficulty_label=cmLabel.getLabel(cmString("%s",difficulty),LABEL_FONT_INDEX.FONT_2071),this.m_difficulty_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_difficulty_label.setPosition(42,489),this.m_layer.addChild(this.m_difficulty_label);var modalSize=cc.size(winSize.width,640);return this.m_partin_modal_layer=new GameModalLayer,this.m_partin_modal_layer.setContentSize(modalSize),this.addChild(this.m_partin_modal_layer,99998),!0},onEnter:function(){this._super()},onExit:function(){this._super()},GetInfoLayer:function(posX,State_Data,Dungeon_Info){var layer=new cc.Layer;layer.ignoreAnchorPointForPosition(!1),layer.setContentSize(384,164),layer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),layer.setPosition(posX,94);var m=MasterManager.getInstance(),life_bar_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_gauge_2.png",RectZero());life_bar_bg.setContentSize(384,85),life_bar_bg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),life_bar_bg.setPosition(ccCenter(layer).x,0),layer.addChild(life_bar_bg);var MaxLife=NewRaidBossService.getInstance().GetBossMaxAddedLife(Dungeon_Info.new_raid_boss_dungeon_info_idx,State_Data),fMaxHp=State_Data.max_hp*MaxLife+State_Data.max_hp,fCurrentHp=State_Data.remain_hp+State_Data.add_life_count*State_Data.max_hp,per=State_Data.remain_hp/State_Data.max_hp*100;per=cc.clampf(per,0,100);var gause_name=RES_CDN_DEFULT+"new_common/img_9p_gauge_red_2_2.png",life_bar=new cc.ProgressTimer(cc.Sprite.create(gause_name));life_bar.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),life_bar.setMidpoint(ANCHOR_MIDDLE_LEFT()),life_bar.setBarChangeRate(cc.p(1,0)),life_bar.setPosition(33,31),life_bar.setType(cc.ProgressTimer.TYPE_BAR),life_bar.setPercentage(per),life_bar_bg.addChild(life_bar);var remain_hp=cmLabelEx.getLabel(cmString(res_str("new_raidboss_standby_boss_hp"),Number(fCurrentHp).toLocaleString("en"),Number(fMaxHp).toLocaleString("en")),LABEL_FONT_INDEX.FONT_2471,!1,!0,2,cc.color(0,0,0,255));remain_hp.setAnchorPoint(ANCHOR_MIDDLE()),remain_hp.setPosition(ccCenter(life_bar_bg).x,31),life_bar_bg.addChild(remain_hp);m_user_id;var npcgroup=m.get_NewRaidBossNpcGroup(State_Data.boss_idx),maxBossLife=npcgroup.added_life,currentBossLife=State_Data.add_life_count;maxBossLife<currentBossLife&&(currentBossLife=maxBossLife);for(var i=0;i<maxBossLife;++i){var IsOn=i<currentBossLife,imgPath="";imgPath=RES_CDN_DEFULT+"new_common/img_heart_off.png";var lifeBg=cc.Sprite.create(imgPath);if(lifeBg.setContentSize(41,36),lifeBg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),lifeBg.setPosition(ccCenter(layer).x-ccWidth(lifeBg)*(maxBossLife/2)+ccWidth(lifeBg)*i+20,59),layer.addChild(lifeBg),IsOn){imgPath=RES_CDN_DEFULT+"new_common/img_heart_on.png";var life=cc.Sprite.create(imgPath);life.setAnchorPoint(ANCHOR_MIDDLE()),life.setPosition(ccCenter(lifeBg)),lifeBg.addChild(life)}}var bosInfoBg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_10.png",RectZero());bosInfoBg.setContentSize(320,64),bosInfoBg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bosInfoBg.setPosition(ccCenter(layer).x,100),layer.addChild(bosInfoBg);var BossInfoLabel=cmLabelEx.getLabel(Dungeon_Info.boss_name,LABEL_FONT_INDEX.FONT_2471,!1,!0,2,cc.color(0,0,0,255));BossInfoLabel.setAnchorPoint(ANCHOR_MIDDLE()),BossInfoLabel.setPosition(ccCenter(bosInfoBg).x,39),bosInfoBg.addChild(BossInfoLabel);var npc=m.get_NpcGeneral(npcgroup.npc_id),gnrl=m.get_General(npc.gnrl_id),elementType=npc.element_type;if(elementType==ELEMENT_TYPE_NONE&&(elementType=gnrl.element_type),elementType!=ELEMENT_TYPE_NONE){var element=cc.Sprite.create(cmString(RES_CDN_DEFULT+"new_common/img_ic_attribute_small_%d.png",elementType));element.setAnchorPoint(ANCHOR_MIDDLE()),element.setPosition(ccCenter(bosInfoBg).x-.5*ccWidth(BossInfoLabel)-5-.5*ccWidth(element),37),bosInfoBg.addChild(element)}var BossWeakness=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_raid2/img_raid2_info.png");return BossWeakness.setAnchorPoint(ANCHOR_MIDDLE()),BossWeakness.setPosition(ccCenter(bosInfoBg).x,15.5),bosInfoBg.addChild(BossWeakness),layer},SetInfo_1:function(){var winSize=ccSize(this);this.m_bg=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_raid2/bg_raid2_boss_1.png"),this.m_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bg.setPosition(ccCenter(winSize)),this.m_layer.addChild(this.m_bg);var new_raid_boss_service=NewRaidBossService.getInstance(),m=MasterManager.getInstance(),BossData=new_raid_boss_service.GetCurrentBoss(),State_Data=BossData.boss_data_list[0],DungeonInfo=m.get_NewRaidBossDungeonInfo(BossData.new_raid_boss_dungeon_info_idx),infoLayer=this.GetInfoLayer(ccCenter(this.m_layer).x,State_Data,DungeonInfo);this.m_layer.addChild(infoLayer)},SetInfo_2:function(){var winSize=ccSize(this);this.m_bg=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_raid2/bg_raid2_boss_2_1.png"),this.m_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_bg.setPosition(0,0),this.m_layer.addChild(this.m_bg),this.m_bg2=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_raid2/bg_raid2_boss_2_2.png"),this.m_bg2.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_bg2.setPosition(winSize.width,0),this.m_layer.addChild(this.m_bg2);var new_raid_boss_service=NewRaidBossService.getInstance(),m=MasterManager.getInstance(),BossData=new_raid_boss_service.GetCurrentBoss(),State_Data=BossData.boss_data_list[0],DungeonInfo=m.get_NewRaidBossDungeonInfo(BossData.new_raid_boss_dungeon_info_idx),infoLayer=this.GetInfoLayer(ccCenter(this.m_layer).x-192-10,State_Data,DungeonInfo);State_Data=BossData.boss_data_list[1],DungeonInfo=m.get_NewRaidBossDungeonInfo(BossData.new_raid_boss_dungeon_info_idx);var infoLayer2=this.GetInfoLayer(ccCenter(this.m_layer).x+192+10,State_Data,DungeonInfo);this.m_layer.addChild(infoLayer),this.m_layer.addChild(infoLayer2)},battleStart:function(){var info=NetService().get_UserItemInfo_V2(),new_raid_boss_service=NewRaidBossService.getInstance(),currentBoss=new_raid_boss_service.GetCurrentBoss(),dungeon_list=MasterTable.getInstance().get_NewRaidBossDungeonListData(new_raid_boss_service.GetCurrentPeriodIdx());if(new_raid_boss_service.GetRemainTime(currentBoss)<=0)this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_NewRaidBossBattleReadyScene],NewRaidBattleEnum.NEW_RAID_BOSS_TIME_OVER)},0,"NEW_RAID_BOSS_TIME_OVER");else{for(var dungeon_info={},i=0;i<dungeon_list.length;i++)if(dungeon_list[i].difficult==currentBoss.difficult){dungeon_info=dungeon_list[i];break}if(info.new_raid_conquest_ticket_cnt<dungeon_info.need_subdue_key)this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_NewRaidBossBattleReadyScene],NewRaidBattleEnum.NEW_RAID_BOSS_CHARGE_CONQUEST_KEY)},0,"NEW_RAID_BOSS_CHARGE_CONQUEST_KEY");else GameDefault.getInstance().getUserTroopsNum().done(function(_d_num){var troops_num=_d_num;this.IsEmptyTroops(troops_num)?this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(NewRaidBattleEnum.NEW_RAID_BOSS_EMPTY_TROOPS)},0,"NEW_RAID_BOSS_EMPTY_TROOPS"):this.scheduleOnce(function(){MainObserver.getInstance().postNotification(sceneStr[scene_NewRaidBossBattleReadyScene],NewRaidBattleEnum.NEW_RAID_BOSS_BATTLE_BEGIN)},0,"NEW_RAID_BOSS_BATTLE_BEGIN")}.bind(this))}},IsEmptyTroops:function(troops_num){return 0==GeneralService.getInstance().getUserTroopsGeneralList(troops_num).filter(function(gnrl){return gnrl.troops_num==troops_num}).length},SetCurrentBossInfo:function(){},showPartInList:function(){this.m_partin_modal_layer._contentNode=function(contentSize,m){var layer=new cc.Layer,popup=new NewRaidBossPartInUserListLayer,new_raid_boss_service=NewRaidBossService.getInstance();return popup.setList(NetService().get_new_raid_boss_partner_user_list(),new_raid_boss_service.GetCurrentBoss()),popup._callback_close_popup=this.HideModalLayer.bind(this),layer.setContentSize(popup.getContentSize()),layer.setPosition(.5*this.getContentSize()),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),layer.addChild(popup),popup.setPosition(ccCenter(layer)),this.m_partin_modal_layer.setContentSize(layer.getContentSize()),layer}.bind(this),this.m_partin_modal_layer.is_show()||this.m_partin_modal_layer.show()},HideModalLayer:function(){this.m_partin_modal_layer.is_show()&&this.m_partin_modal_layer.hide()},GetPartnerList:function(){switch(this.m_PartnerListReqType){case NewRaidBattleReadyEnum.PARTNER_LIST_TYPE_PARTIN:this.showPartInList();break;case NewRaidBattleReadyEnum.PARTNER_LIST_TYPE_REFRESH:this.RefreshInfo()}},RefreshInfo:function(){var user_info=NetService().get_User_info(),new_raid_boss_service=NewRaidBossService.getInstance(),BossData=new_raid_boss_service.GetCurrentBoss(),found_user=_new_raid_boss_partner_user_list.parnter_user_list.findIndex(function(p){return p.user_id==user_info.user_id});if(-1!=found_user){var BossMaxHp=0,addLife=new_raid_boss_service.GetCurrentBossMaxAddedLife();0==addLife&&(addLife=1);for(var i=0;i<BossData.boss_data_list.length;i++)BossMaxHp+=BossData.boss_data_list[i].max_hp*addLife+BossData.boss_data_list[i].max_hp;var fPer=_new_raid_boss_partner_user_list.parnter_user_list[found_user].accum_damage/BossMaxHp*100;this.m_per_label.setString(cmString(res_str("new_raidboss_standby_reward_info"),fPer.toFixed(1)));var d=new_raid_boss_service.GetBossRemainTime(BossData);this.m_remain_time_label.setString(cmString(res_str("new_raidboss_standby_attack_run_time_text"),d._data.hours,d._data.minutes))}else{this.m_per_label.setString(cmString(res_str("new_raidboss_standby_reward_info"),"0"));d=new_raid_boss_service.GetBossRemainTime(BossData);this.m_remain_time_label.setString(cmString(res_str("new_raidboss_standby_attack_run_time_text"),d._data.hours,d._data.minutes))}},setKeyCount:function(count){this.m_key_count_label.setColor(this.m_needKey<=count?cc.color(255,221,116):cc.color(255,47,47))}}),NewRaidBossBattleReadyScene=GameScene.extend({m_battle_ready_layer:null,m_game_type:null,m_selectBattleModalLayer:null,m_start_list_req:0,ctor:function(){this.m_battle_ready_layer=null,this.m_game_type=db.BattleGameType.NewRaidBossDungeon,this.m_selectBattleModalLayer=null,this._super(scene_NewRaidBossBattleReadyScene)},init2:function(){var win_size=cc.director.getWinSize();this.m_battle_ready_layer=new NewRaidBossBattleReadyLayer,this.m_battle_ready_layer.setPosition(ccCenter(win_size)),this.addChild(this.m_battle_ready_layer);var statusLayer=new StatusLayer(INVOKER_TYPE.new_raid_boss);statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_raid2.png");title.setAnchorPoint(ANCHOR_TOP_LEFT()),title.setPosition(94,ccHeight(this)),this.addChild(title);var back_btn=new ccui.Button;return back_btn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png",""),back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(){this.back()}.bind(this)),this.addChild(back_btn),this.m_selectBattleModalLayer=new GameModalLayer,this.m_selectBattleModalLayer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_selectBattleModalLayer.setPosition(ccCenter(win_size).x,ccCenter(win_size).y+13),this.addChild(this.m_selectBattleModalLayer,99e3),!0},onEnterTransitionDidFinish:function(){this._super(),this.m_start_list_req=0,this.sendReqList(1)},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_NewRaidBossBattleReadyScene]),this.playNewRaidBossLobbyBGM()},onExit:function(){this._super()},onNotification:function(msg){if(this._super(msg))return!1;switch(msg){case NewRaidBattleEnum.NEW_RAID_BOSS_BATTLE_BEGIN:this.sendNewRaidBossDungeonBattleBegin();break;case NewRaidBattleEnum.NEW_RAID_BOSS_REQ_PARTNER_LIST:this.sendNewRaidBossReqPartnerList();break;case NewRaidBattleEnum.NEW_RAID_BOSS_REQ_CONQUEST:this.showRetreatConfirm();break;case NewRaidBattleEnum.NEW_RAID_BOSS_TIME_OVER:this.showBossIsTimeOver();break;case NOTIFY_MENU_YUNHEE_SET:this.m_game_type!=db.BattleGameType.None&&GameContext.getInstance().setYunheeArrangeMode(!0),BattleContext._getInstance().setGameType(this.m_game_type);var scene=new YunheeScene;SceneManager.getInstance().replaceScene(scene);break;case NewRaidBattleEnum.NEW_RAID_BOSS_CHARGE_CONQUEST_KEY:this.showChargeConquestKeyPopup();break;case NewRaidBattleEnum.NEW_RAID_BOSS_EMPTY_TROOPS:this.showNoGeneralInTroops();break;case NewRaidBattleEnum.NEW_RAID_BOSS_SHOW_CANT_RUN:this.showCantRun()}return!0},onNetworkEvent:function(opcode,state,body){this._super(opcode,state,body);var res=body,new_raid_boss_service=NewRaidBossService.getInstance(),context=(MasterTable.getInstance(),BattleContext._getInstance());if(opcode==net.OP.op_new_raid_boss_dungeon_battle_begin)res.error!=net.ERROR.NET_E_SUCCESS?res.error==net.ERROR.NET_E_LACK_KEY?this.showChargeConquestKeyPopup():res.error==net.ERROR.NET_E_ALREADY_PART_IN_MEMBER_FULL?this.showPartInCountOver():res.error==net.ERROR.NET_E_ALREADY_RETREAT||(res.error==net.ERROR.NET_E_ALREADY_CLEARED?this.showBossIsAlreadyCompleteConquest():res.error==net.ERROR.NET_E_INVALID_ENTRANCE_TIME&&this.showBossIsTimeOver()):(context.setBeforeBattleUserInfo(),context.setGameType(this.m_game_type),GameDefault.getInstance().getUserTroopsNum().done(function(_d_num){var troops_num=_d_num;context.setBeforeBattleUserInfoByTroops(troops_num);var dungeon=$.extend({},database.BattleNewRaidBossDungeon),data=NetService().getNewRaidBossDungeonData(1,res.discovered_user_id,res.new_raid_boss_period_idx,res.new_raid_boss_dungeon_info_idx,res.boss_num);dungeon.dungeon=data,new_raid_boss_service.GetNewRaidBossDungeonStageNpc(res.new_raid_boss_period_idx,res.new_raid_boss_dungeon_info_idx,dungeon),context.setBattleNewRaidBossDungeonData(dungeon);var scene=new BattleSceneLayer;SceneManager.getInstance().pushScene(scene)}.bind(this)));else if(opcode==net.OP.op_new_raid_boss_dungeon_list)this.init2(),this.sendNewRaidBossReqPartnerList();else if(opcode==net.OP.op_new_raid_boss_partner_user_list)res.error!=net.ERROR.NET_E_SUCCESS?res.error==net.ERROR.NET_E_ALREADY_RETREAT?this.showBossIsTimeOver():res.error==net.ERROR.NET_E_ALREADY_SHARED&&this.showCantRun():this.m_battle_ready_layer.GetPartnerList();else if(opcode==net.OP.op_new_raid_boss_dungeon_retreat)this.showRetreatSuccess();else if(opcode==net.OP.op_shop_buy_new_raid_conquest_ticket){var msg=[];msg.push_back(res_str("new_raidboss_standby_attack_key_charge_text")),this.showMsgBox(res_str("label_buy_raid_ticket_complete_title"),msg),this.m_battle_ready_layer.setKeyCount(res.user_raid_ticket.ticket_cnt)}},back:function(){this.onKeyBack(!0)},sendReqList:function(List){var req={};req.opcode=net.OP.op_new_raid_boss_dungeon_list,req.request_type=List;var new_raid_boss_period_idx=MasterTable.getInstance().get_NewRaidBossOpenPeriodIdx();0!=new_raid_boss_period_idx&&(req.new_raid_boss_period_idx=new_raid_boss_period_idx,this.network_write(req))},sendNewRaidBossDungeonBattleBegin:function(){var new_raid_boss_service=NewRaidBossService.getInstance(),new_raid_boss_period_idx=(new_raid_boss_service.GetCurrentBoss(),NetService(),new_raid_boss_service.GetCurrentPeriodIdx());if(0!=new_raid_boss_period_idx){var requestType=new_raid_boss_service.GetCurrentBossBattleReqType(),BossData=new_raid_boss_service.GetCurrentBoss(),dungeon_list_found=_new_raid_boss_dungeon_list.findIndex(function(d){return d.request_type==requestType&&d.new_raid_boss_period_idx==new_raid_boss_period_idx});if(-1!=dungeon_list_found)GameDefault.getInstance().getUserTroopsNum().done(function(_d_num){var troops_num=_d_num;if(0<_new_raid_boss_dungeon_list[dungeon_list_found].user_new_raid_boss_list.size()){var req={};req.opcode=net.OP.op_new_raid_boss_dungeon_battle_begin,req.discovered_user_id=BossData.discovered_user_id,req.new_raid_boss_period_idx=BossData.new_raid_boss_period_idx,req.new_raid_boss_dungeon_info_idx=BossData.new_raid_boss_dungeon_info_idx,req.boss_num=BossData.boss_num,req.troops_num=troops_num,this.network_write(req)}}.bind(this))}},sendNewRaidBossReqPartnerList:function(){var new_raid_boss_service=NewRaidBossService.getInstance(),CurrentBossData=new_raid_boss_service.GetCurrentBoss(),new_raid_boss_period_idx=(new NetService,new_raid_boss_service.GetCurrentPeriodIdx());if(0!=new_raid_boss_period_idx&&-1!=_new_raid_boss_dungeon_list.findIndex(function(d){return 1==d.request_type&&d.new_raid_boss_period_idx==new_raid_boss_period_idx})){var req={};req.opcode=net.OP.op_new_raid_boss_partner_user_list,req.new_raid_boss_period_idx=CurrentBossData.new_raid_boss_period_idx,req.new_raid_boss_dungeon_info_idx=CurrentBossData.new_raid_boss_dungeon_info_idx,req.boss_num=CurrentBossData.boss_num,req.discovered_user_id=CurrentBossData.discovered_user_id,this.network_write(req)}},sendReqRetreat:function(){var BossData=NewRaidBossService.getInstance().GetCurrentBoss();if(0==BossData.boss_activity_type){var req={};req.opcode=net.OP.op_new_raid_boss_dungeon_retreat,req.new_raid_boss_period_idx=BossData.new_raid_boss_period_idx,req.new_raid_boss_dungeon_info_idx=BossData.new_raid_boss_dungeon_info_idx,req.boss_num=BossData.boss_num,this.network_write(req)}},showRetreatConfirm:function(){this.m_box.setTitle(res_str("new_raidboss_standby_retreat_pop_up_title")),this.m_box.setText(res_str("new_raidboss_standby_retreat_pop_up_text1")),this.m_box.setText("\n"),this.m_box.setText(res_str("new_raidboss_standby_retreat_pop_up_text2")),this.m_box.setText("\n"),this.m_box.setText(res_str("new_raidboss_standby_retreat_pop_up_text3")),this.m_box.setText("\n"),this.m_box.setText(res_str("new_raidboss_standby_retreat_pop_up_text4")),this.m_box.setText("\n"),this.m_box.setText(res_str("new_raidboss_standby_retreat_pop_up_text5")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.sendReqRetreat()},0,"sendReqRetreat"),this.m_box.hide()}.bind(this))),this.m_box.show()},showRetreatSuccess:function(){MasterTable.getInstance();this.m_box.setTitle(res_str("label_common_information")),this.m_box.setText(res_str("new_raidboss_standby_retreat_complete_text")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.back()},0,"back"),this.m_box.hide()}.bind(this))),this.m_box.show()},showChargeConquestKeyPopup:function(){this.m_box.setTitle(res_str("new_raidboss_standby_attack_key_lack_pop_up_title")),this.m_box.setText(res_str("new_raidboss_standby_attack_key_lack_pop_up_text1")),this.m_box.setText("\n");var bonusType=MasterManager.getInstance().get_BonusType(BONUS_TYPE_JADE);this.m_box.setText(cmString(res_str("new_raidboss_main_boss_summon_key_lack_pop_up_text2"),bonusType.name,1)),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){NetService().get_UserItemInfo_V2().jade_cnt<1?this.scheduleOnce(function(float){this.showNotEnoughJade()},0,"showNotEnoughJade"):this.scheduleOnce(function(float){this.sendChargeConquestKey()},0,"sendChargeConquestKey"),this.m_box.hide()}.bind(this))),this.m_box.show()},sendChargeConquestKey:function(){var item_list=ShopService.getInstance().getShopJadeInfoList([]),found=item_list.findIndex(function(s){return s.bonus_type==BONUS_TYPE_NEW_RAID_BOSS_BATTLE_KEY_REFILL});if(-1!=found){var req={};req.opcode=net.OP.op_shop_buy_new_raid_conquest_ticket,req.shop_id=item_list[found].shop_id,req.buy_count=1,this.network_write(req)}},playNewRaidBossLobbyBGM:function(){var bgm=MasterTable.getInstance().get_Bgm_v2(BGM_TYPE_NEW_RAID_BOSS_LOBBY_BGM),audio=AudioEngine.getInstance(),new_raid_bgm=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm.sound_file_name;audio.m_bgmPath!=new_raid_bgm&&(audio.stopBackgroundMusic(),audio.playBackgroundMusic(new_raid_bgm,!0))},showBossIsAlreadyCompleteConquest:function(){MasterTable.getInstance();this.m_box.setTitle(res_str("new_raidboss_main_boss_clear_pop_up_title")),this.m_box.setText(res_str("new_raidboss_main_boss_clear_pop_up_text")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.back()},0,"back"),this.m_box.hide()}.bind(this))),this.m_box.show()},showBossIsTimeOver:function(){MasterTable.getInstance();this.m_box.setTitle(res_str("label_information_title")),this.m_box.setText(res_str("new_raidboss_main_boss_run_pop_up_text")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){var currentBoss=NewRaidBossService.getInstance().GetCurrentBoss();(new NetService).checkPartinTimeRetreatDungeon(currentBoss.new_raid_boss_period_idx),this.back()},0,"back"),this.m_box.hide()}.bind(this)))},showPartInCountOver:function(){var m=MasterManager.getInstance();this.m_box.setTitle(res_str("new_raidboss_standby_attack_cannot_pop_up_title")),this.m_box.setText(res_str("new_raidboss_main_boss_summon_cannot_pop_up_text1"),m.get_CountFunction(55).value),this.m_box.setText("\n"),this.m_box.setText(res_str("new_raidboss_standby_attack_cannot_pop_up_text2")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showCantRun:function(){MasterTable.getInstance();this.m_box.setTitle(res_str("label_preparation_title")),this.m_box.setText(res_str("new_raidboss_support_call_done_cannot_run")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()}}),NewRaidBossEndPeriodListCell=cc.TableViewCell.extend({m_click_callback:null,m_banner_image:null,ctor:function(_click_cb){this._super(),this.init(_click_cb)},init:function(_click_cb){this.m_click_callback=_click_cb;var cellSize=cc.size(444,140);this.setContentSize(cellSize),this.setAnchorPoint(ANCHOR_BOTTOM_LEFT());var Rect=cc.Rect(20,20,20,20),box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",Rect);return box.setPreferredSize(cellSize),box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box.setPosition(ZERO()),this.addChild(box),this.m_banner_image=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_raid2/new_raid_boss_pt_shop_1001.png"),this.m_banner_image.setAnchorPoint(ANCHOR_MIDDLE()),this.m_banner_image.setPosition(ccCenter(cellSize)),box.addChild(this.m_banner_image),!0},setShopPeriodData:function(data){this.m_shop_period=data,this.updateCell()},updateCell:function(){0},highlightPosInCell:function(pos){this.m_banner_image.setScale(.99)},unhighlightPosInCell:function(pos){this.m_banner_image.setScale(1)},touchPosInCell:function(pos){null!=this.m_click_callback&&this.m_click_callback(this.m_shop_period)}}),NewRaidBossEndPeriodShopListPopup=cc.Layer.extend({m_close_popup_callback:null,m_table_view:null,m_shop_period_list:[],ctor:function(cb){this._super(),this.m_shop_period_list=[],this.init(cb)},init:function(cb){var m=MasterTable.getInstance();this.m_close_popup_callback=cb,this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var winSize=ccSize(this),boxSize=cc.size(478,421),Rect=cc.Rect(40,40,40,40),box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",Rect);box.setAnchorPoint(ANCHOR_MIDDLE()),box.setPreferredSize(boxSize),box.setPosition(ccCenter(winSize)),this.addChild(box);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(.5*boxSize.width,boxSize.height-11),box.addChild(navi);var naviSize=ccSize(navi),label=cmLabel.getLabel(res_str("boss_point_shop_list_pop_up_title"),LABEL_FONT_INDEX.FONT_241);label.setAnchorPoint(ANCHOR_MIDDLE()),label.setPosition(.5*naviSize.width,.5*naviSize.height+2),navi.addChild(label);var btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);btn.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),btn.setPosition(naviSize.width-10,.5*naviSize.height+3),navi.addChild(btn),btn.addClickEventListener(function(sender){null!=this.m_close_popup_callback&&this.m_close_popup_callback()}.bind(this)),this.m_shop_period_list=m.get_NewRaidBossShopPeriodByPrePeriod(2);var tSize=cc.size(444,342);return this.m_table_view=new cc.TableView(this,tSize),this.m_table_view.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_table_view.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_table_view.setScrollBarAlwaysShow(!1),this.m_table_view.setPosition(17,10),this.m_table_view.setDelegate(this),this.m_table_view.scrollBarEnable(!0),box.addChild(this.m_table_view),this.m_table_view.setDelegate(this),!0},onEnter:function(){this._super()},onExit:function(){this._super()},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;cell=null!=c?c:new NewRaidBossEndPeriodListCell(this.onClickBanner.bind(this));var data=this.m_shop_period_list.at(idx);return cell.setShopPeriodData(data),cell},cellSizeForTable:function(table){return cc.size(444,140)},tableCellSizeForIndex:function(){return cc.size(444,140)},numberOfCellsInTableView:function(table){return this.m_shop_period_list.length},tableCellTouched:function(table,cell){null!=cell&&cell.touchPosInCell(cell.getTouchPos())},tableCellEnded:function(){},tableCellHighlight:function(table,cell){null!=cell&&cell.highlightPosInCell(cell.getTouchPos())},tableCellUnhighlight:function(table,cell){null!=cell&&cell.unhighlightPosInCell(cell.getTouchPos())},highlightPosInCell:function(){},unhighlightPosInCell:function(){},onClickBanner:function(period){BattleContext._getInstance().setNewRaidBossShopPeriodIndex(period.new_raid_boss_shop_period_idx);var scene=new NewRaidBossRewardShopScene;SceneManager.getInstance().replaceScene(scene)}}),NEW_RAID_BOSS_CALL_BOSS=100,NEW_RAID_BOSS_CONQUEST_BOSS=101,NEW_RAID_BOSS_CHARGE_CALL_KEY=102,NEW_RAID_BOSS_CHARGE_CONQUEST_KEY=103,NEW_RAID_BOSS_OVER_COUNT=104,NEW_RAID_BOSS_REFRESH_COUNT=105,NewRaidBossEntranceLayer=cc.Layer.extend({m_new_raid_boss_noti_bg:null,m_count_label:null,m_help_request_btn:null,m_easy_btn_label:null,m_hard_btn_label:null,m_easy_btn_key_bg:null,m_hard_btn_key_bg:null,m_easy_btn_key:null,m_hard_btn_key:null,m_modal_layer:null,m_point_label:null,m_conquest_total_count_label:null,m_conquest_my_count_label:null,m_conquest_help_count_label:null,m_easy_btn:null,m_hard_btn:null,m_hp_info_label:null,m_remain_time_label:null,m_hp_info_labelsetPosition:null,m_selected_difficulty:0,m_easy_key_count_label:null,m_hard_key_count_label:null,m_easy_call_key_count:0,m_hard_call_key_count:0,ctor:function(){this._super(),this.init()},init:function(){},onEnter:function(){this._super()},onExit:function(){this._super()},initLayout:function(){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE()),this.m_layer=this.getMainContentLayer(),this.m_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_layer.setPosition(ccCenter(ccSize(this))),this.addChild(this.m_layer),this.m_modal_layer=new GameModalLayer,this.m_modal_layer.setContentSize(cc.director.getWinSize().width,640),this.addChild(this.m_modal_layer,99999)},getMainContentLayer:function(){var layer=new cc.Layer,winSize=ccSize(this);layer.ignoreAnchorPointForPosition(!1);var frame_size=cc.size(ccWidth(this),ccHeight(this));layer.setContentSize(frame_size);var info=NetService().get_UserItemInfo_V2(),new_raid_boss_service=NewRaidBossService.getInstance();BattleContext._getInstance().setNewRaidBossShopPeriodIndex(new_raid_boss_service.GetCurrentShopPeriodIdx());var m=MasterTable.getInstance(),reward_info_btn=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_5_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_5_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_5_none.png");reward_info_btn.setContentSize(168,42);var btn_rect=cc.Rect(16,16,26,26);reward_info_btn.setTitleFont(btn_rect,LABEL_FONT_INDEX.FONT_2072,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255)),reward_info_btn.setTitleText(res_str("new_raidboss_main_reward_info_button")),reward_info_btn.setBright(!0),reward_info_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),reward_info_btn.setPosition(winSize.width-15,82),layer.addChild(reward_info_btn),reward_info_btn.addClickEventListener(function(sender){this.showNewRaidBossDropRewardInfo()}.bind(this));var conquest_reward_btn=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_5_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_5_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_5_none.png");conquest_reward_btn.setContentSize(168,42),conquest_reward_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT());btn_rect=cc.Rect(16,16,26,26);conquest_reward_btn.setTitleFont(btn_rect,LABEL_FONT_INDEX.FONT_2072,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255)),conquest_reward_btn.setTitleText(res_str("new_raidboss_battle_list_button_result")),conquest_reward_btn.setBright(!0),conquest_reward_btn.setPosition(winSize.width-15,20),layer.addChild(conquest_reward_btn),conquest_reward_btn.addClickEventListener(function(sender){var scene=new NewRaidBossListScene;BattleContext._getInstance().setNewRaidBossTabIndex(NEW_RAID_BOSS_TAB_END),SceneManager.getInstance().replaceScene(scene)}.bind(this)),this.m_help_request_btn=new ccui.Button,this.m_help_request_btn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_raid2_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_raid2_on.png",""),this.m_help_request_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_help_request_btn.setPosition(winSize.width-15,142),layer.addChild(this.m_help_request_btn),this.m_help_request_btn.addClickEventListener(function(sender){BattleContext._getInstance().setNewRaidBossTabIndex(NEW_RAID_BOSS_TAB_HELP_REQUEST);var scene=new NewRaidBossListScene;SceneManager.getInstance().replaceScene(scene)}.bind(this)),this.m_new_raid_boss_noti_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_noti.png",RectZero()),this.m_new_raid_boss_noti_bg.setContentSize(38,30),this.m_new_raid_boss_noti_bg.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_new_raid_boss_noti_bg.setPosition(ccWidth(this.m_help_request_btn)+10,ccHeight(this.m_help_request_btn)+12),this.m_help_request_btn.addChild(this.m_new_raid_boss_noti_bg),this.m_count_label=cmLabel.getLabel(cmString("%d",0),LABEL_FONT_INDEX.FONT_1471),this.m_count_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_count_label.setPosition(ccCenter(this.m_new_raid_boss_noti_bg)),this.m_new_raid_boss_noti_bg.addChild(this.m_count_label),this.m_new_raid_boss_noti_bg.setVisible(!1);var boss_pt_shop_btn=new NPButton(RES_CDN_DEFULT+"new_menu_raid2/btn_raid2_shop_off.png",RES_CDN_DEFULT+"new_menu_raid2/btn_raid2_shop_on.png","");boss_pt_shop_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),boss_pt_shop_btn.setPosition(0,0),layer.addChild(boss_pt_shop_btn),boss_pt_shop_btn.addClickEventListener(function(sender){var scene=new NewRaidBossRewardShopScene;SceneManager.getInstance().replaceScene(scene)}.bind(this));var pointBg=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_blank_1.png");pointBg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),pointBg.setPosition(15,142),layer.addChild(pointBg);var pointIcon=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_raid2/img_raid2_point.png");pointIcon.setAnchorPoint(ANCHOR_MIDDLE()),pointIcon.setPosition(ccCenter(pointBg)),pointBg.addChild(pointIcon);var pointSubject=cmLabelEx.getLabel(res_str("new_raidboss_main_boss_point"),LABEL_FONT_INDEX.FONT_2275,!1,!0,2,cc.color(0,0,0,255));pointSubject.setAnchorPoint(ANCHOR_MIDDLE()),pointSubject.setPosition(ccCenter(pointBg).x,142),pointBg.addChild(pointSubject),this.m_point_label=cmLabelEx.getLabel(Number(new_raid_boss_service.GetBossPoint(BattleContext._getInstance().getNewRaidBossShopPeriodIndex())),LABEL_FONT_INDEX.FONT_2275,!1,!0,2,cc.color(0,0,0,255)),this.m_point_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_point_label.setPosition(ccCenter(pointBg).x,30),pointBg.addChild(this.m_point_label);var raidpointMark_1=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_txtmark.png");raidpointMark_1.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),raidpointMark_1.setPosition(-20,4),this.m_conquest_total_count_label=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_2073,!1,!0,2,cc.color(0,0,0,255)),this.m_conquest_total_count_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_conquest_total_count_label.setPosition(42,545),layer.addChild(this.m_conquest_total_count_label),this.m_conquest_total_count_label.addChild(raidpointMark_1);var raidpointMark_2=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_txtmark.png");raidpointMark_2.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),raidpointMark_2.setPosition(-20,4),this.m_conquest_my_count_label=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_2071,!1,!0,2,cc.color(0,0,0,255)),this.m_conquest_my_count_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_conquest_my_count_label.setPosition(42,516),layer.addChild(this.m_conquest_my_count_label),this.m_conquest_my_count_label.addChild(raidpointMark_2);var raidpointMark_3=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_txtmark.png");raidpointMark_3.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),raidpointMark_3.setPosition(-20,4),this.m_conquest_help_count_label=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_2071,!1,!0,2,cc.color(0,0,0,255)),this.m_conquest_help_count_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_conquest_help_count_label.setPosition(42,489),layer.addChild(this.m_conquest_help_count_label),this.m_conquest_help_count_label.addChild(raidpointMark_3),this.m_conquest_total_count_label.setVisible(!1),this.m_conquest_my_count_label.setVisible(!1),this.m_conquest_help_count_label.setVisible(!1);var dungeon_list=m.get_NewRaidBossDungeonListData(new_raid_boss_service.GetCurrentPeriodIdx()),dungeon_info={};this.m_easy_btn=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_1_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_1_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_1_none.png"),this.m_easy_btn.setContentSize(236,58),this.m_easy_btn._normalTextureSize=cc.size(236,58),this.m_easy_btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM());btn_rect=cc.Rect(16,16,26,26);this.m_easy_btn.setTitleFont(btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255)),this.m_easy_btn.setPosition(ccCenter(layer).x-.5*ccWidth(this.m_easy_btn)-5,20),layer.addChild(this.m_easy_btn),this.m_easy_btn.addClickEventListener(function(sender){this.callOrBattleReadyBoss(1)}.bind(this)),this.m_easy_btn_label=cmLabelEx.getLabel(res_str("new_raidboss_main_mode_button_easy"),LABEL_FONT_INDEX.FONT_2272,!1,!0,2,cc.color(255,255,255,255)),this.m_easy_btn_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_easy_btn.addChild(this.m_easy_btn_label),this.m_easy_btn_key_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_txtbox_6.png",RectZero()),this.m_easy_btn_key_bg.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_easy_btn_key_bg.setPreferredSize(cc.size(72,28)),this.m_easy_btn_key_bg.setPosition(ccWidth(this.m_easy_btn)-13,ccCenter(this.m_easy_btn).y),this.m_easy_btn.addChild(this.m_easy_btn_key_bg),this.m_easy_btn_key=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_raid2.png"),this.m_easy_btn_key.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_easy_btn_key.setPosition(.5*ccWidth(this.m_easy_btn_key),ccCenter(this.m_easy_btn_key_bg).y),this.m_easy_btn_key_bg.addChild(this.m_easy_btn_key);for(var i=0;i<dungeon_list.length;i++)if(1==dungeon_list[i].difficult){dungeon_info=dungeon_list[i];break}var font=dungeon_info.need_spawn_key<=info.new_raid_call_ticket_cnt?LABEL_FONT_INDEX.FONT_1875:LABEL_FONT_INDEX.FONT_1877;this.m_easy_key_count_label=cmLabel.getLabel(cmString("%s",Number(dungeon_info.need_spawn_key).toLocaleString("en")),font),this.m_easy_key_count_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_easy_key_count_label.setPosition(ccWidth(this.m_easy_btn_key_bg)-13,ccCenter(this.m_easy_btn_key_bg).y),this.m_easy_btn_key_bg.addChild(this.m_easy_key_count_label),this.m_easy_call_key_count=dungeon_info.need_spawn_key,this.m_hard_btn=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_1_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_1_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_1_none.png"),this.m_hard_btn.setContentSize(236,58),this.m_hard_btn._normalTextureSize=cc.size(236,58),this.m_hard_btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM());btn_rect=cc.Rect(16,16,26,26);this.m_hard_btn.setTitleFont(btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255)),this.m_hard_btn.setPosition(ccCenter(layer).x+.5*ccWidth(this.m_hard_btn)+5,20),layer.addChild(this.m_hard_btn),this.m_hard_btn.addClickEventListener(function(sender){this.callOrBattleReadyBoss(2)}.bind(this)),this.m_hard_btn_label=cmLabelEx.getLabel(res_str("new_raidboss_main_mode_button_hard"),LABEL_FONT_INDEX.FONT_2272,!1,!0,2,cc.color(255,255,255,255)),this.m_hard_btn_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_hard_btn.addChild(this.m_hard_btn_label),this.m_hard_btn_key_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_txtbox_6.png",RectZero()),this.m_hard_btn_key_bg.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_hard_btn_key_bg.setPreferredSize(cc.size(72,28)),this.m_hard_btn_key_bg.setPosition(ccWidth(this.m_hard_btn)-13,ccCenter(this.m_hard_btn).y),this.m_hard_btn.addChild(this.m_hard_btn_key_bg),this.m_hard_btn_key=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_raid2.png"),this.m_hard_btn_key.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_hard_btn_key.setPosition(.5*ccWidth(this.m_hard_btn_key),ccCenter(this.m_hard_btn_key_bg).y),this.m_hard_btn_key_bg.addChild(this.m_hard_btn_key);for(var idx=0;idx<dungeon_list.length;idx++)if(2==dungeon_list[idx].difficult){dungeon_info=dungeon_list[idx];break}dungeon_info.need_spawn_key<=info.new_raid_call_ticket_cnt?LABEL_FONT_INDEX.FONT_1875:LABEL_FONT_INDEX.FONT_1877;this.m_hard_key_count_label=cmLabel.getLabel(cmString("%s",Number(dungeon_info.need_spawn_key).toLocaleString("en")),font),this.m_hard_key_count_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_hard_key_count_label.setPosition(ccWidth(this.m_hard_btn_key_bg)-13,ccCenter(this.m_hard_btn_key_bg).y),this.m_hard_btn_key_bg.addChild(this.m_hard_key_count_label),this.m_hard_call_key_count=dungeon_info.need_spawn_key;var MyBossDiffculty=0;if(new_raid_boss_service.isHavMyBoss()){var BossData=new_raid_boss_service.GetMyBoss();if(0==BossData.difficult){var dun=MasterManager.getInstance().get_NewRaidBossDungeonInfo(BossData.new_raid_boss_dungeon_info_idx);BossData.difficult=dun.difficult}MyBossDiffculty=BossData.difficult;var State_Data=BossData.boss_data_list[0],DungeonInfo=MasterManager.getInstance().get_NewRaidBossDungeonInfo(BossData.new_raid_boss_dungeon_info_idx),npcgroup=MasterManager.getInstance().get_NewRaidBossNpcGroup(BossData.new_raid_boss_dungeon_info_idx),currentHp=State_Data.remain_hp+State_Data.max_hp*State_Data.add_life_count,MaxHp=State_Data.max_hp*npcgroup.added_life+State_Data.max_hp,d=new_raid_boss_service.GetBossRemainTime(BossData);this.m_remain_time_label=cmLabel.getLabel(cmString(res_str("new_raidboss_standby_attack_run_time_text"),d._data.hours,d._data.minutes),LABEL_FONT_INDEX.FONT_1471),this.m_remain_time_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_remain_time_label.enableOutline(cc.color.BLACK,1),layer.addChild(this.m_remain_time_label),this.m_hp_info_label=cmLabel.getLabel(cmString(res_str("new_raidboss_standby_boss_hp"),Number(currentHp).toLocaleString("en"),Number(MaxHp).toLocaleString("en")),LABEL_FONT_INDEX.FONT_1471),this.m_hp_info_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_hp_info_label.enableOutline(cc.color.BLACK,1),layer.addChild(this.m_hp_info_label);new NPButton;switch(MyBossDiffculty){case 1:this.m_easy_btn,this.m_hard_btn.setEnabled(!1),this.m_remain_time_label.setPosition(ccPos(this.m_easy_btn).x,20+ccHeight(this.m_easy_btn)),this.m_hp_info_label.setPosition(ccPos(this.m_easy_btn).x,20+ccHeight(this.m_easy_btn)+14);break;case 2:this.m_hard_btn,this.m_easy_btn.setEnabled(!1),this.m_remain_time_label.setPosition(ccPos(this.m_hard_btn).x,20+ccHeight(this.m_hard_btn)),this.m_hp_info_label.setPosition(ccPos(this.m_hard_btn).x,20+ccHeight(this.m_hard_btn)+14);break;default:1==(DungeonInfo=MasterManager.getInstance().get_NewRaidBossDungeonInfo(BossData.new_raid_boss_dungeon_info_idx)).difficult?(this.m_easy_btn,this.m_hard_btn.setEnabled(!1)):2==DungeonInfo.difficult&&(this.m_hard_btn,this.m_easy_btn.setEnabled(!1))}this.m_easy_btn_key_bg.setVisible(!1),this.m_hard_btn_key_bg.setVisible(!1),this.m_easy_btn_label.setPosition(ccCenter(this.m_easy_btn)),this.m_hard_btn_label.setPosition(ccCenter(this.m_hard_btn))}else this.m_easy_btn_label.setPosition(71,ccCenter(this.m_easy_btn).y),this.m_hard_btn_label.setPosition(71,ccCenter(this.m_hard_btn).y);var help_btn=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_help_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_help_on.png");return help_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),help_btn.setPosition(winSize.width-15,winSize.height-77),this.addChild(help_btn),help_btn.addClickEventListener(function(sender){GameContext.getInstance().setHelpInfoIndexByCallIndex(251);var scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null}.bind(this)),layer},SetHelpListCount:function(Count){if(0!=Count){var RaidCount=Count,NumLength=Number(RaidCount).toLocaleString("en").length,bgWidth=38;2==NumLength?bgWidth=48:3==NumLength&&(bgWidth=58),this.m_new_raid_boss_noti_bg.setContentSize(bgWidth,30),this.m_count_label.setString(cmString("%d",RaidCount)),this.m_count_label.setPosition(ccCenter(this.m_new_raid_boss_noti_bg)),this.m_new_raid_boss_noti_bg.setVisible(!0)}},callOrBattleReadyBoss:function(difficult){var new_raid_boss_service=NewRaidBossService.getInstance();if(new_raid_boss_service.isHavMyBoss()){var BossData=new_raid_boss_service.GetMyBoss();if(new_raid_boss_service.GetRemainTime(BossData)<=0)return(new NetService).checkPartinTimeRetreatDungeon(BossData.new_raid_boss_period_idx),void this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_NewRaidBossBattleReadyScene],NewRaidBattleEnum.NEW_RAID_BOSS_TIME_OVER)},0,"NEW_RAID_BOSS_TIME_OVER");this.scheduleOnce(function(){MainObserver.getInstance().postNotification(sceneStr[scene_NewRaidBossEntranceScene],NEW_RAID_BOSS_CONQUEST_BOSS)},0,"NEW_RAID_BOSS_CONQUEST_BOSS")}else{this.m_selected_difficulty=difficult;for(var info=NetService().get_UserItemInfo_V2(),dungeon_list=MasterTable.getInstance().get_NewRaidBossDungeonListData(new_raid_boss_service.GetCurrentPeriodIdx()),dungeon_info={},i=0;i<dungeon_list.length;i++)if(dungeon_list[i].difficult==this.m_selected_difficulty){dungeon_info=dungeon_list[i];break}if(dungeon_info.need_spawn_key>info.new_raid_call_ticket_cnt)return void this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_NewRaidBossEntranceScene],NEW_RAID_BOSS_CHARGE_CALL_KEY)},0,"NEW_RAID_BOSS_CHARGE_CALL_KEY");if(new_raid_boss_service.GetNewRaidBossDungeonListCount(1)>=MasterManager.getInstance().get_CountFunction(55).value)return void this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_NewRaidBossEntranceScene],NEW_RAID_BOSS_OVER_COUNT)},0,"NEW_RAID_BOSS_OVER_COUNT");this.scheduleOnce(function(){MainObserver.getInstance().postNotification(sceneStr[scene_NewRaidBossEntranceScene],NEW_RAID_BOSS_CALL_BOSS)},0,"NEW_RAID_BOSS_CALL_BOSS")}},GetSelectedDifficulty:function(){return this.m_selected_difficulty},showNewRaidBossDropRewardInfo:function(){this.m_modal_layer._contentNode=function(contentSize,m){var layer=new cc.Layer,popup=new NewRaidBossRewardInfoPopupLayer;return popup._callback_close_popup=this.HideModalLayer.bind(this),layer.setContentSize(popup.getContentSize()),layer.setPosition(.5*this.getContentSize()),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),layer.addChild(popup),popup.setPosition(ccCenter(layer)),this.m_modal_layer.setContentSize(layer.getContentSize()),layer}.bind(this),this.m_modal_layer.is_show()||this.m_modal_layer.show()},HideModalLayer:function(){this.m_modal_layer.is_show()&&this.m_modal_layer.hide()},RefreshCounquestCount:function(){for(var new_raid_boss_service=NewRaidBossService.getInstance(),user_info=NetService().get_User_info(),end_list=new_raid_boss_service.GetMyBossList(3),history_list=new_raid_boss_service.GetMyBossList(4),totalConquestCount=0,myCallConquestCount=0,requestConquestCount=0,i=0;i<end_list.length;i++)3==end_list[i].boss_activity_type&&(user_info.user_id!=end_list[i].discovered_user_id?++requestConquestCount:++myCallConquestCount,++totalConquestCount);for(var idx=0;idx<history_list.length;idx++)3==history_list[idx].boss_activity_type&&(user_info.user_id!=history_list[idx].discovered_user_id?++requestConquestCount:++myCallConquestCount,++totalConquestCount);if(this.m_conquest_total_count_label.setString(cmString(res_str("new_raidboss_main_now_clear_count_clear"),Number(totalConquestCount).toLocaleString("en"))),this.m_conquest_my_count_label.setString(cmString(res_str("new_raidboss_main_now_clear_count_summon"),Number(myCallConquestCount).toLocaleString("en"))),this.m_conquest_help_count_label.setString(cmString(res_str("new_raidboss_main_now_clear_count_support"),Number(requestConquestCount).toLocaleString("en"))),this.m_conquest_total_count_label.setVisible(!0),this.m_conquest_my_count_label.setVisible(!0),this.m_conquest_help_count_label.setVisible(!0),new_raid_boss_service.isHavMyBoss()){var BossData={};if(new_raid_boss_service.GetMyBoss(BossData),new_raid_boss_service.GetRemainTime(BossData)<=0)(new NetService).checkPartinTimeRetreatDungeon(BossData.new_raid_boss_period_idx),this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_NewRaidBossBattleReadyScene],NewRaidBattleEnum.NEW_RAID_BOSS_TIME_OVER)},0,"NEW_RAID_BOSS_TIME_OVER");else this.RefreshCallBoss()}},RefreshCallBoss:function(){MasterTable.getInstance();var new_raid_boss_service=NewRaidBossService.getInstance(),MyBossDiffculty=0;if(new_raid_boss_service.isHavMyBoss()){var BossData=new_raid_boss_service.GetMyBoss();MyBossDiffculty=BossData.difficult;var d=new_raid_boss_service.GetBossRemainTime(BossData);this.m_remain_time_label.setString(cmString(res_str("new_raidboss_standby_attack_run_time_text"),d._data.hours,d._data.minutes));new NPButton;switch(MyBossDiffculty){case 1:this.m_easy_btn,this.m_hard_btn.setEnabled(!1),this.m_remain_time_label.setPosition(ccPos(this.m_easy_btn).x,20+ccHeight(this.m_easy_btn)),this.m_hp_info_label.setPosition(ccPos(this.m_easy_btn).x,20+ccHeight(this.m_easy_btn)+14);break;case 2:this.m_hard_btn,this.m_easy_btn.setEnabled(!1),this.m_remain_time_label.setPosition(ccPos(this.m_hard_btn).x,20+ccHeight(this.m_hard_btn)),this.m_hp_info_label.setPosition(ccPos(this.m_hard_btn).x,20+ccHeight(this.m_hard_btn)+14)}this.m_remain_time_label.setVisible(!0),this.m_hp_info_label.setVisible(!0),this.m_easy_btn_key_bg.setVisible(!1),this.m_hard_btn_key_bg.setVisible(!1),this.m_easy_btn_label.setPosition(ccCenter(this.m_easy_btn)),this.m_hard_btn_label.setPosition(ccCenter(this.m_hard_btn))}else this.m_remain_time_label.setVisible(!1),this.m_hp_info_label.setVisible(!1),this.m_easy_btn.setEnabled(!0),this.m_hard_btn.setEnabled(!0),this.m_easy_btn_key_bg.setVisible(!0),this.m_hard_btn_key_bg.setVisible(!0),this.m_easy_btn_label.setPosition(71,ccCenter(this.m_easy_btn).y),this.m_hard_btn_label.setPosition(71,ccCenter(this.m_hard_btn).y)},setKeyCount:function(count){this.m_easy_key_count_label.setColor(this.m_easy_call_key_count<=count?cc.color(255,221,116):cc.color(255,47,47)),this.m_hard_key_count_label.setColor(this.m_hard_call_key_count<=count?cc.color(255,221,116):cc.color(255,47,47))}}),NewRaidBossEntranceScene=GameScene.extend({m_entrance_layer:null,m_bIsRefresh:!1,m_start_list_req:0,ctor:function(){this._super(scene_NewRaidBossEntranceScene)},init2:function(){var win_size=cc.director.getWinSize(),bg=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_raid2/bg_raid2_banner.jpg");bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(win_size)),this.addChild(bg),this.m_entrance_layer=new NewRaidBossEntranceLayer,this.m_entrance_layer.setPosition(ccCenter(win_size)),this.m_entrance_layer.initLayout(),this.addChild(this.m_entrance_layer);var statusLayer=new StatusLayer(INVOKER_TYPE.new_raid_boss);statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_raid2.png");title.setAnchorPoint(ANCHOR_TOP_LEFT()),title.setPosition(94,ccHeight(this)),this.addChild(title);var back_btn=new ccui.Button;return back_btn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png",""),back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(sender){this.back()}.bind(this)),this.addChild(back_btn,100),!0},onEnterTransitionDidFinish:function(){this._super(),this.sendRaidBossSignUp(),BattleContext._getInstance().getNewRaidBossTabIndex()==NEW_RAID_BOSS_TAB_NONE?(this.m_start_list_req=0,this.sendReqList(1)):this.scheduleOnce(function(float){var scene=new NewRaidBossListScene;SceneManager.getInstance().replaceScene(scene)},.1,"NewRaidBossListScene")},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_NewRaidBossEntranceScene]),this.playNewRaidBossLobbyBGM()},onExit:function(){this._super()},onNotification:function(msg){this._super(msg);var new_raid_boss_service=NewRaidBossService.getInstance();switch(msg){case NEW_RAID_BOSS_CALL_BOSS:this.showCallPopup();break;case NEW_RAID_BOSS_CONQUEST_BOSS:var BossData=new_raid_boss_service.GetMyBoss();new_raid_boss_service.SetCurrentBoss(BossData);var scene=new NewRaidBossBattleReadyScene;SceneManager.getInstance().replaceScene(scene);break;case NEW_RAID_BOSS_CHARGE_CALL_KEY:this.showChargeCallKeyPopup();break;case NEW_RAID_BOSS_CHARGE_CONQUEST_KEY:break;case NEW_RAID_BOSS_OVER_COUNT:this.showOverCountPopup();break;case NEW_RAID_BOSS_REFRESH_COUNT:break;case NewRaidBattleEnum.NEW_RAID_BOSS_TIME_OVER:this.showBossIsTimeOver()}return!0},onNetworkEvent:function(opcode,state,body){this._super(opcode,state,body);var res=body;if(opcode!=net.OP.op_get_user_achievement){var new_raid_boss_service=NewRaidBossService.getInstance();MasterTable.getInstance();if(opcode==net.OP.op_new_raid_boss_sign_up)body.error==net.ERROR.NET_E_SUCCESS||body.error==net.ERROR.NET_E_INVALID_PERIOD||(body.error,net.ERROR.NET_E_ALREADY_EXIST_DATA);else if(opcode==net.OP.op_new_raid_boss_call)if(body.error==net.ERROR.NET_E_SUCCESS){var BossData=new_raid_boss_service.GetMyBoss();new_raid_boss_service.SetCurrentBoss(BossData);var scene=new NewRaidBossBattleReadyScene;SceneManager.getInstance().replaceScene(scene)}else body.error==net.ERROR.NET_E_NOT_FOUND_USER_ID?this.showErrNotFoundUserId():body.error==net.ERROR.NET_E_ALREADY_EXIST_DATA?this.showErrAlreadyExistData():body.error==net.ERROR.NET_E_LACK_KEY?this.showErrLackKey():body.error==net.ERROR.NET_E_ALREADY_BATTLE_START_GNRL&&this.showErrAlreadyBattleStartGnrl();else if(opcode==net.OP.op_new_raid_boss_dungeon_list)switch(res.request_type){case 1:0==this.m_start_list_req&&(this.init2(),this.m_start_list_req=1,this.sendReqList(2));break;case 2:var RaidCount=new_raid_boss_service.GetNewRaidBossDungeonListCount(2);this.m_entrance_layer.SetHelpListCount(RaidCount),1==this.m_start_list_req&&(this.m_start_list_req=2,this.sendReqList(3));break;case 3:2==this.m_start_list_req&&(this.m_start_list_req=3,this.sendReqList(4));break;case 4:this.m_entrance_layer.RefreshCounquestCount(),3==this.m_start_list_req&&(this.m_start_list_req=100)}else if(opcode==net.OP.op_get_new_raid_boss_point);else if(opcode==net.OP.op_shop_buy_new_raid_call_ticket){var msg=[];msg.push_back(res_str("new_raidboss_main_boss_summon_key_charge_text")),this.showMsgBox(res_str("label_buy_raid_ticket_complete_title"),msg),this.m_entrance_layer.setKeyCount(res.user_raid_ticket.ticket_cnt)}}},back:function(){var mng=SceneManager.getInstance(),is_exist_scene=mng.isExistScene(scene_NewRaidBossBattleReadyScene),is_exist_scene_2=mng.isExistScene(scene_BattleScene);(is_exist_scene||is_exist_scene_2)&&mng.historyClearToScene(scene_MussangEntryScene),this.onKeyBack(!0)},sendRaidBossSignUp:function(){var m=MasterTable.getInstance(),netservice=new NetService,new_raid_boss_period_idx=m.get_NewRaidBossOpenPeriodIdx();if(0!=new_raid_boss_period_idx&&!netservice.IsSignUpNewRaidBoss(new_raid_boss_period_idx)){var req={};req.opcode=net.OP.op_new_raid_boss_sign_up,req.new_raid_boss_period_idx=new_raid_boss_period_idx,this.network_write(req)}},sendReqList:function(List){var req={};req.opcode=net.OP.op_new_raid_boss_dungeon_list,req.request_type=List;var new_raid_boss_period_idx=MasterTable.getInstance().get_NewRaidBossOpenPeriodIdx();0!=new_raid_boss_period_idx&&(req.new_raid_boss_period_idx=new_raid_boss_period_idx,this.network_write(req))},sendReqBossCall:function(Diffcult){var m=MasterTable.getInstance(),new_raid_boss_period_idx=m.get_NewRaidBossOpenPeriodIdx();if(0!=new_raid_boss_period_idx){var dungeon_list=m.get_NewRaidBossDungeonListData(new_raid_boss_period_idx),req={};req.opcode=net.OP.op_new_raid_boss_call,req.new_raid_boss_period_idx=new_raid_boss_period_idx;var partin_dungeon_list=dungeon_list.findIndex(function(d){return d.difficult==Diffcult});-1!=partin_dungeon_list&&(req.new_raid_boss_dungeon_info_idx=dungeon_list[partin_dungeon_list].new_raid_boss_dungeon_info_idx,this.network_write(req))}},sendReqBossPoint:function(){var req={};req.opcode=net.OP.op_get_new_raid_boss_point,0!=MasterTable.getInstance().get_NewRaidBossOpenPeriodIdx()&&this.network_write(req)},sendChargeCallKey:function(){var item_list=ShopService.getInstance().getShopJadeInfoList([]),found=item_list.findIndex(function(s){return s.bonus_type==BONUS_TYPE_NEW_RAID_BOSS_CALL_KEY_REFILL});if(-1!=found){var req={};req.opcode=net.OP.op_shop_buy_new_raid_call_ticket,req.shop_id=item_list[found].shop_id,req.buy_count=1,this.network_write(req)}},showChargeCallKeyPopup:function(){this.m_entrance_layer.GetSelectedDifficulty();this.m_box.setTitle(res_str("new_raidboss_main_boss_summon_key_lack_pop_up_title")),this.m_box.setText(res_str("new_raidboss_main_boss_summon_key_lack_pop_up_text1")),this.m_box.setText("\n");var bonusType=MasterManager.getInstance().get_BonusType(BONUS_TYPE_JADE);this.m_box.setText(cmString(res_str("new_raidboss_main_boss_summon_key_lack_pop_up_text2"),bonusType.name,1)),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){NetService().get_UserItemInfo_V2().jade_cnt<1?this.scheduleOnce(function(float){this.showNotEnoughJade()},0,"showNotEnoughJade"):this.scheduleOnce(function(float){this.sendChargeCallKey()},0,"sendChargeCallKey"),this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showOverCountPopup:function(){var m=MasterManager.getInstance();this.m_box.setTitle(res_str("new_raidboss_standby_attack_cannot_pop_up_title")),this.m_box.setText(cmString(res_str("new_raidboss_main_boss_summon_cannot_pop_up_text1"),m.get_CountFunction(55).value)),this.m_box.setText("\n"),this.m_box.setText(res_str("new_raidboss_standby_attack_cannot_pop_up_text2")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showCallPopup:function(){for(var difficulty=this.m_entrance_layer.GetSelectedDifficulty(),new_raid_boss_service=NewRaidBossService.getInstance(),dungeon_list=(NetService().get_UserItemInfo_V2(),MasterTable.getInstance().get_NewRaidBossDungeonListData(new_raid_boss_service.GetCurrentPeriodIdx())),dungeon_info={},i=0;i<dungeon_list.length;i++)if(dungeon_list[i].difficult==difficulty){dungeon_info=dungeon_list[i];break}this.m_box.setTitle(res_str("new_raidboss_main_boss_discovery_pop_up_title")),this.m_box.setText(cmString(res_str("new_raidboss_main_boss_discovery_pop_up_text1"),dungeon_info.need_spawn_key)),this.m_box.setText("\n"),this.m_box.setText(res_str("new_raidboss_main_boss_discovery_pop_up_text2")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.sendReqBossCall(this.m_entrance_layer.GetSelectedDifficulty()),this.m_box.hide()}.bind(this))),this.m_box.show()},showErrNotFoundUserId:function(){MasterTable.getInstance();this.m_box.setTitle(res_str("label_information_title")),this.m_box.setText("error - showErrNotFoundUserId"),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showErrAlreadyExistData:function(){MasterTable.getInstance();this.m_box.setTitle(res_str("label_information_title")),this.m_box.setText("error - showErrAlreadyExistData"),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showErrLackKey:function(){this.m_box.setTitle(res_str("label_information_title")),this.m_box.setText("error - showErrLackKey"),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showErrAlreadyBattleStartGnrl:function(){this.m_box.setTitle(res_str("label_information_title")),this.m_box.setText("error - showErrAlreadyBattleStartGnrl"),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},playNewRaidBossLobbyBGM:function(){var bgm=MasterTable.getInstance().get_Bgm_v2(BGM_TYPE_NEW_RAID_BOSS_LOBBY_BGM),audio=AudioEngine.getInstance(),new_raid_bgm=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm.sound_file_name;audio.m_bgmPath!=new_raid_bgm&&(audio.stopBackgroundMusic(),audio.playBackgroundMusic(new_raid_bgm,!0))},showBossIsAlreadyCompleteConquest:function(){},showBossIsTimeOver:function(){MasterTable.getInstance();this.m_box.setTitle(res_str("label_information_title")),this.m_box.setText(res_str("new_raidboss_main_boss_run_pop_up_text")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.m_entrance_layer.RefreshCallBoss()},0,"RefreshCallBoss"),this.m_box.hide()}.bind(this)))}}),NewRaidBossFilteringCell=cc.TableViewCell.extend({m_list_bg:null,m_subject_label:null,m_option1_selected:null,m_option2_selected:null,m_option1_btn:null,m_option2_btn:null,m_option1_label:null,m_option2_label:null,m_option1_selected_effect:null,m_option2_selected_effect:null,m_callback_select_option:null,m_myOptionValue:0,m_optionIdx:0,ctor:function(select_option_callback){this._super(),this.init(select_option_callback)},init:function(select_option_callback){this.m_callback_select_option=select_option_callback;var cellSize=cc.size(596,115);this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(cellSize),this.m_list_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_5.png",RectZero()),this.m_list_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_list_bg.setPosition(ccCenter(cellSize)),this.m_list_bg.setContentSize(cellSize),this.addChild(this.m_list_bg),this.setContentSize(ccSize(this.m_list_bg));cc.Rect(10,4,4,20);var subject_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_8.png",RectZero());return subject_bg.setAnchorPoint(ANCHOR_TOP_LEFT()),subject_bg.setPosition(0,ccHeight(this.m_list_bg)-5),subject_bg.setContentSize(202,31),this.m_list_bg.addChild(subject_bg),this.m_subject_label=cmLabel.getLabel("OPTION",LABEL_FONT_INDEX.FONT_201),this.m_subject_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_subject_label.setPosition(27,ccCenter(subject_bg).y),subject_bg.addChild(this.m_subject_label),this.m_option1_btn=cc.Sprite.create("#btn_53_off.png"),this.m_option1_btn.setAnchorPoint(ANCHOR_MIDDLE()),this.m_option1_btn.setPosition(ccCenter(this.m_list_bg).x-10-.5*ccWidth(this.m_option1_btn),48),this.m_list_bg.addChild(this.m_option1_btn),this.m_option1_label=cmLabelEx.getLabel("option1",LABEL_FONT_INDEX.FONT_201,!1,!0,2,cc.color(0,0,0,255)),this.m_option1_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_option1_label.setPosition(ccCenter(this.m_option1_btn)),this.m_option1_btn.addChild(this.m_option1_label),this.m_option1_selected=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_1.png",cc.Rect(20,20,20,20)),this.m_option1_selected.setAnchorPoint(ANCHOR_MIDDLE()),this.m_option1_selected.setPosition(ccCenter(this.m_option1_btn)),this.m_option1_selected.setPreferredSize(ccSize(this.m_option1_btn)),this.m_option1_selected.setVisible(!1),this.m_option1_btn.addChild(this.m_option1_selected),this.m_option1_selected_effect=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_2.png",RectZero()),this.m_option1_selected_effect.setAnchorPoint(ANCHOR_MIDDLE()),this.m_option1_selected_effect.setPosition(ccCenter(this.m_option1_btn)),this.m_option1_selected_effect.setPreferredSize(ccSize(this.m_option1_btn)),this.m_option1_selected_effect.setVisible(!1),this.m_option1_btn.addChild(this.m_option1_selected_effect),this.m_option2_btn=cc.Sprite.create("#btn_53_off.png"),this.m_option2_btn.setAnchorPoint(ANCHOR_MIDDLE()),this.m_option2_btn.setPosition(ccCenter(this.m_list_bg).x+10+.5*ccWidth(this.m_option2_btn),48),this.m_list_bg.addChild(this.m_option2_btn),this.m_option2_label=cmLabelEx.getLabel("option2",LABEL_FONT_INDEX.FONT_201,!1,!0,2,cc.color(0,0,0,255)),this.m_option2_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_option2_label.setPosition(ccCenter(this.m_option2_btn)),this.m_option2_btn.addChild(this.m_option2_label),this.m_option2_selected=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_1.png",RectZero()),this.m_option2_selected.setAnchorPoint(ANCHOR_MIDDLE()),this.m_option2_selected.setPosition(ccCenter(this.m_option2_btn)),this.m_option2_selected.setPreferredSize(ccSize(this.m_option2_btn)),this.m_option2_selected.setVisible(!1),this.m_option2_btn.addChild(this.m_option2_selected),this.m_option2_selected_effect=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_2.png",RectZero()),this.m_option2_selected_effect.setAnchorPoint(ANCHOR_MIDDLE()),this.m_option2_selected_effect.setPosition(ccCenter(this.m_option2_btn)),this.m_option2_selected_effect.setPreferredSize(ccSize(this.m_option2_btn)),this.m_option2_selected_effect.setVisible(!1),this.m_option2_btn.addChild(this.m_option2_selected_effect),!0},SetOptionInfo:function(tap,optionIdx,optionValue){this.m_tap=tap,this.m_optionIdx=optionIdx,this.m_myOptionValue=optionValue,this.updateCell()},updateCell:function(){switch(this.m_tap){case 0:case 1:0==this.m_optionIdx?(this.m_subject_label.setString(res_str("new_raidboss_battle_setting_pop_up_mode")),this.m_option1_label.setString(res_str("new_raidboss_main_mode_button_easy")),this.m_option2_label.setString(res_str("new_raidboss_main_mode_button_hard"))):(this.m_subject_label.setString(res_str("new_raidboss_battle_setting_pop_up_support")),this.m_option1_label.setString(res_str("new_raidboss_battle_setting_pop_up_support_friend")),this.m_option2_label.setString(res_str("new_raidboss_battle_setting_pop_up_support_friend_not")));break;case 2:case 3:0==this.m_optionIdx?(this.m_subject_label.setString(res_str("new_raidboss_battle_setting_pop_up_mode")),this.m_option1_label.setString(res_str("new_raidboss_main_mode_button_easy")),this.m_option2_label.setString(res_str("new_raidboss_main_mode_button_hard"))):1==this.m_optionIdx?(this.m_subject_label.setString(res_str("new_raidboss_battle_setting_pop_up_support")),this.m_option1_label.setString(res_str("new_raidboss_battle_setting_pop_up_support_friend")),this.m_option2_label.setString(res_str("new_raidboss_battle_setting_pop_up_support_friend_not"))):(this.m_subject_label.setString(res_str("new_raidboss_battle_setting_pop_up_clear")),this.m_option1_label.setString(res_str("new_raidboss_battle_setting_pop_up_clear_complete")),this.m_option2_label.setString(res_str("new_raidboss_battle_setting_pop_up_clear_run")))}this.selectOption()},selectOption:function(){switch(this.m_myOptionValue){case 0:this.m_option1_selected.setVisible(!1),this.m_option1_selected_effect.setVisible(!1),this.m_option2_selected.setVisible(!1),this.m_option2_selected_effect.setVisible(!1);break;case 1:this.m_option1_selected.setVisible(!0),this.m_option1_selected_effect.setVisible(!0),this.m_option2_selected.setVisible(!1),this.m_option2_selected_effect.setVisible(!1),this.runAnimation(this.m_option1_selected_effect);break;case 2:this.m_option1_selected.setVisible(!1),this.m_option1_selected_effect.setVisible(!1),this.m_option2_selected.setVisible(!0),this.m_option2_selected_effect.setVisible(!0),this.runAnimation(this.m_option2_selected_effect)}},runAnimation:function(Sprite){Sprite.isRunning()&&Sprite.stopAllActions();var fadeout=new cc.FadeOut(1),fadein=new cc.FadeIn(1),seq=new cc.Sequence(fadeout,fadein),repeat=new cc.RepeatForever(seq);Sprite.runAction(repeat)},highlightPosInCell:function(pos){},unhighlightPosInCell:function(pos){},touchPosInCell:function(pos){this.getBoundingBox();var btn_box=this.m_option1_btn.getBoundingBox(),r=btn_box;cc.rectContainsPoint(r,pos)&&null!=this.m_callback_select_option&&(1==this.m_myOptionValue?this.m_myOptionValue=0:this.m_myOptionValue=1,this.selectOption(),this.m_callback_select_option(this.m_optionIdx,this.m_myOptionValue)),r=btn_box=this.m_option2_btn.getBoundingBox(),cc.rectContainsPoint(r,pos)&&null!=this.m_callback_select_option&&(2==this.m_myOptionValue?this.m_myOptionValue=0:this.m_myOptionValue=2,this.selectOption(),this.m_callback_select_option(this.m_optionIdx,this.m_myOptionValue))}}),NewRaidBossFilteringLayer=cc.Layer.extend({m_setoption_btn:null,m_close_btn:null,m_tableView:null,m_tap:0,m_optionIdxMax:0,m_callback_set_option_popup:null,m_optionlist:[],ctor:function(){this._super(),this.m_optionlist=[],this.init()},init:function(){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var winSize=cc.director.getWinSize(),boxSize=cc.size(630,380),box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));box.setAnchorPoint(ANCHOR_MIDDLE()),box.setPreferredSize(boxSize),box.setPosition(ccCenter(winSize)),this.addChild(box);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_3.png");navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(.5*boxSize.width,boxSize.height-11),box.addChild(navi);var naviSize=ccSize(navi),title=cmLabel.getLabel(res_str("new_raidboss_battle_setting_pop_up_title"),LABEL_FONT_INDEX.FONT_241);title.setAnchorPoint(ANCHOR_MIDDLE()),title.setPosition(.5*naviSize.width,.5*naviSize.height+2),navi.addChild(title);var btn=new ccui.Button;btn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_refresh_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_refresh_on.png",""),btn.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),btn.setPosition(naviSize.width-9,.5*naviSize.height+3),navi.addChild(btn),btn.addClickEventListener(function(sender){this.SetDefault()}.bind(this)),this.m_setoption_btn=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_setoption_btn.setFont(LABEL_FONT_INDEX.FONT_201),this.m_setoption_btn.setString(res_str("new_raidboss_battle_setting_pop_up_button_complete")),this.m_setoption_btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_setoption_btn.setPosition(ccCenter(box).x+5+.5*ccWidth(this.m_setoption_btn),16),box.addChild(this.m_setoption_btn),this.m_setoption_btn.addClickEventListener(function(sender){this.m_callback_set_option_popup(this.m_optionlist),null!=this._callback_close_popup&&this._callback_close_popup()}.bind(this)),this.m_close_btn=new LabelButton("btn_08_off.png","btn_08_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_close_btn.setFont(LABEL_FONT_INDEX.FONT_201),this.m_close_btn.setString(res_str("new_raidboss_battle_setting_pop_up_button_canncel")),this.m_close_btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_close_btn.setPosition(ccCenter(box).x-5-.5*ccWidth(this.m_close_btn),16),box.addChild(this.m_close_btn),this.m_close_btn.addClickEventListener(function(sender){null!=this._callback_close_popup&&this._callback_close_popup()}.bind(this));var tsize=cc.size(596,240);return this.m_tableView=new cc.TableView(this,tsize),this.m_tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_tableView.setPosition(17,80),box.addChild(this.m_tableView),this.m_tableView.setDelegate(this),!0},tableCellEnded:function(table){},scrollViewDidZoom:function(view){},cellSizeForTable:function(table){return cc.size(596,117)},tableCellSizeForIndex:function(){return cc.size(596,117)},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;return(cell=null!=c?c:new NewRaidBossFilteringCell(this.SelectOption.bind(this))).SetOptionInfo(this.m_tap,idx,this.m_optionlist[idx]),cell},numberOfCellsInTableView:function(table){return this.m_optionIdxMax},tableCellTouched:function(table,cell){null!=cell&&cell.touchPosInCell(cell.getTouchPos())},tableCellHighlight:function(table,cell){null!=cell&&cell.highlightPosInCell(cell.getTouchPos())},tableCellUnhighlight:function(table,cell){null!=cell&&cell.unhighlightPosInCell(cell.getTouchPos())},SetCurrentTap:function(tap,optionlist){this.m_tap=tap,this.m_optionlist=[],this.m_optionlist=optionlist,this.m_optionIdxMax=this.m_optionlist.length,this.m_tableView.reloadData()},SelectOption:function(optionIdx,optionValue){this.m_optionlist[optionIdx]=optionValue},SetDefault:function(){for(var i=0;i<this.m_optionlist.length;i++)this.m_optionlist[i]=0;this.m_tableView.reloadData()}}),BOSS_MAX_NUM=3,NewRaidBossListCell=cc.TableViewCell.extend({m_boss_name:null,m_boss_life:null,m_remain_time_subject:null,m_remain_time:null,m_discovered_icon:null,m_discovered_nickname:null,m_element_type:null,m_list_type:0,m_state_icon:null,m_boss_life_gauge:null,m_friend_icon:null,m_time_icon:null,m_boss_icon:null,m_list_bg:null,m_partner_bg:null,m_partner_count_label:null,m_part_in_btns_sprite:[],m_end_time:null,m_getreward_callback:null,m_retreat_callback:null,m_setCurrentBoss_callback:null,m_reqBossPartinList_callback:null,m_setCurrentBoss_btns_sprite:[],m_getreward_btns_sprite:[],m_retreat_btns_sprite:[],m_boss_diffculty:null,m_my_boss_img:null,m_boss_thub:[],m_boss_thub_off:[],ctor:function(getreward_callback,retreat_callback,setCurrentBoss_callback,reqBossPartinList_callback){this._super(),this.m_setCurrentBoss_btns_sprite=[],this.m_getreward_btns_sprite=[],this.m_retreat_btns_sprite=[],this.m_boss_thub=[],this.m_boss_thub_off=[],this.m_part_in_btns_sprite=[],this.init(getreward_callback,retreat_callback,setCurrentBoss_callback,reqBossPartinList_callback)},init:function(getreward_callback,retreat_callback,setCurrentBoss_callback,reqBossPartinList_callback){var cellSize=cc.size(960,138);this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(cellSize),m_user_id=m_user_id,this.m_list_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_1.png",RectZero()),this.m_list_bg.setAnchorPoint(ZERO()),this.m_list_bg.setPosition(ZERO()),this.m_list_bg.setContentSize(cellSize),this.addChild(this.m_list_bg),this.m_boss_icon=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_raid2/img_raid2_tumb_1.png"),this.m_boss_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_boss_icon.setPosition(0,0),this.m_boss_icon.setContentSize(120,138),this.m_list_bg.addChild(this.m_boss_icon),this.m_state_icon=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_raid2/img_raid2_state_1.png"),this.m_state_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_state_icon.setPosition(0,0),this.m_boss_icon.addChild(this.m_state_icon),this.m_state_icon.setVisible(!1),this.m_boss_name=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_2071,!1,!0,2,cc.color(0,0,0,255)),this.m_boss_name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_boss_name.setPosition(170,103),this.m_list_bg.addChild(this.m_boss_name),this.m_discovered_icon=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_small_1.png"),this.m_discovered_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_discovered_icon.setPosition(132,66),this.m_list_bg.addChild(this.m_discovered_icon),this.m_discovered_nickname=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_1871,!1,!0,2,cc.color(0,0,0,255)),this.m_discovered_nickname.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_discovered_nickname.setPosition(170,71),this.m_list_bg.addChild(this.m_discovered_nickname),this.m_friend_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_friend/img_friend_text_2.png"),this.m_friend_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_friend_icon.setPosition(170,68),this.m_list_bg.addChild(this.m_friend_icon),this.m_time_icon=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_small_2.png"),this.m_time_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_time_icon.setPosition(132,38),this.m_list_bg.addChild(this.m_time_icon),this.m_remain_time_subject=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_1871,!1,!0,2,cc.color(0,0,0,255)),this.m_remain_time_subject.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_remain_time_subject.setPosition(170,43),this.m_list_bg.addChild(this.m_remain_time_subject),this.m_remain_time=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_1871,!1,!0,2,cc.color(0,0,0,255)),this.m_remain_time.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_remain_time.setPosition(170,43),this.m_list_bg.addChild(this.m_remain_time),this.m_end_time=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_1871,!1,!0,2,cc.color(0,0,0,255)),this.m_end_time.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_end_time.setPosition(170,43),this.m_list_bg.addChild(this.m_end_time);var gauge_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_gauge.png",RectZero());gauge_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),gauge_bg.setPosition(106,5),gauge_bg.setPreferredSize(cc.size(528,15)),this.addChild(gauge_bg),this.m_boss_life_gauge=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_gauge_red.png",RectZero()),this.m_boss_life_gauge.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_boss_life_gauge.setPosition(0,0),gauge_bg.addChild(this.m_boss_life_gauge),this.m_boss_life=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_161,!1,!0,2,cc.color(0,0,0,255)),this.m_boss_life.setAnchorPoint(ANCHOR_MIDDLE()),this.m_boss_life.setPosition(ccCenter(gauge_bg).x,ccCenter(gauge_bg).y+4),gauge_bg.addChild(this.m_boss_life);var offset_x=cellSize.width-12,img_paths=[];img_paths.push(RES_CDN_DEFULT+"new_common/btn/ori/btn_1_off.png"),img_paths.push(RES_CDN_DEFULT+"new_common/btn/ori/btn_1_on.png");var font_outline_colors=[];font_outline_colors.push(cc.color.WHITE),font_outline_colors.push(cc.color(128,128,128));for(var idx=0;idx<img_paths.length;idx++){var img_1=cc.Scale9Sprite.create(img_paths[idx],RectZero());img_1.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),img_1.setPreferredSize(cc.size(146,58)),img_1.setPosition(offset_x,50),this.m_list_bg.addChild(img_1);var label_1=cmLabelEx.getLabel(res_str("new_raidboss_standby_attack_button_text"),LABEL_FONT_INDEX.FONT_2272,!1,!0,2,font_outline_colors[idx]);label_1.setAnchorPoint(ANCHOR_MIDDLE()),label_1.setPosition(ccCenter(img_1)),img_1.addChild(label_1),this.m_setCurrentBoss_btns_sprite.push(img_1)}for(var jdx=0;jdx<img_paths.length;jdx++){var img_2=cc.Scale9Sprite.create(img_paths[jdx],RectZero());img_2.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),img_2.setPreferredSize(cc.size(146,58)),img_2.setPosition(offset_x,50),this.m_list_bg.addChild(img_2);var label_2=cmLabelEx.getLabel(res_str("new_raidboss_battle_list_reward_button_text"),LABEL_FONT_INDEX.FONT_2272,!1,!0,2,font_outline_colors[jdx]);label_2.setAnchorPoint(ANCHOR_MIDDLE()),label_2.setPosition(ccCenter(img_2)),img_2.addChild(label_2),this.m_getreward_btns_sprite.push(img_2)}for(var kdx=0;kdx<img_paths.size();kdx++){var img_3=cc.Scale9Sprite.create(img_paths[kdx]);img_3.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),img_3.setPreferredSize(cc.size(146,58)),img_3.setPosition(offset_x,50),this.m_list_bg.addChild(img_3);var label_3=cmLabelEx.getLabel(res_str("new_raidboss_battle_list_reward_button_text"),LABEL_FONT_INDEX.FONT_2272,!1,!0,2,font_outline_colors[kdx]);label_3.setAnchorPoint(ANCHOR_MIDDLE()),label_3.setPosition(ccCenter(img_3)),img_3.addChild(label_3),this.m_getreward_btns_sprite.push(img_3)}offset_x-=156;for(var i=0;i<img_paths.length;i++){var img_4=cc.Scale9Sprite.create(img_paths[i],RectZero());img_4.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),img_4.setPreferredSize(cc.size(146,58)),img_4.setPosition(offset_x,50),this.m_list_bg.addChild(img_4);var label_4=cmLabelEx.getLabel(res_str("new_raidboss_standby_retreat_button_text"),LABEL_FONT_INDEX.FONT_2272,!1,!0,2,font_outline_colors[i]);label_4.setAnchorPoint(ANCHOR_MIDDLE()),label_4.setPosition(ccCenter(img_4)),img_4.addChild(label_4),this.m_retreat_btns_sprite.push(img_4)}this.m_partner_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_txtbox_6.png",RectZero()),this.m_partner_bg.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_partner_bg.setContentSize(146,28),this.m_partner_bg.setPosition(cellSize.width-12,cellSize.height-28),this.m_list_bg.addChild(this.m_partner_bg),this.m_partner_count_label=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_1671,!1,!0,2,cc.color(0,0,0,255)),this.m_partner_count_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_partner_count_label.setPosition(ccCenter(this.m_partner_bg).x,ccCenter(this.m_partner_bg).y),this.m_partner_bg.addChild(this.m_partner_count_label),this.m_element_type=cc.Sprite.create(RES_CDN_DEFULT+cmString("new_common/img_ic_attribute_small_%d.png",1)),this.m_element_type.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_element_type.setPosition(132,94),this.m_list_bg.addChild(this.m_element_type),this.m_boss_diffculty=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_label_difficulty_3.png"),this.m_boss_diffculty.setContentSize(80,31),this.m_boss_diffculty.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_boss_diffculty.setPosition(0,ccHeight(this.m_boss_icon)-ccHeight(this.m_boss_diffculty)),this.m_boss_icon.addChild(this.m_boss_diffculty);for(i=0;i<BOSS_MAX_NUM;++i){var boss_thub=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_raid2/img_raid2_tumb_small_1.png");boss_thub.setContentSize(42,42),boss_thub.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),boss_thub.setPosition(792-((BOSS_MAX_NUM-1-i)*ccWidth(boss_thub)+10*(BOSS_MAX_NUM-1-i)),110),boss_thub.setVisible(!1),this.m_list_bg.addChild(boss_thub),this.m_boss_thub.push(boss_thub);var boss_thub_off=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_raid2/img_raid2_tumb_small_off.png");boss_thub_off.setAnchorPoint(ANCHOR_MIDDLE()),boss_thub_off.setPosition(ccCenter(boss_thub)),boss_thub.addChild(boss_thub_off),boss_thub_off.setVisible(!1),this.m_boss_thub_off.push(boss_thub_off)}return this.m_getreward_callback=getreward_callback,this.m_retreat_callback=retreat_callback,this.m_setCurrentBoss_callback=setCurrentBoss_callback,this.m_reqBossPartinList_callback=reqBossPartinList_callback,!0},setData:function(list_type,data){this.m_list_type=list_type+1,this.m_data=data,this.updateCell()},updateCell:function(){this.m_end_time.setVisible(!1),this.m_remain_time.setVisible(!1),this.updateDiscoveredUserInfo(),this.updateBossDifficulty(),this.updateBossElement(),this.updateHp(),this.updatePartnerCount(),this.updateTumbnail(),this.updateBossState();for(var i=0;i<this.m_getreward_btns_sprite.length;i++)this.m_getreward_btns_sprite[i].setVisible(!1);for(var j=0;j<this.m_retreat_btns_sprite.length;j++)this.m_retreat_btns_sprite[j].setVisible(!1);for(var k=0;k<this.m_setCurrentBoss_btns_sprite.length;k++)this.m_setCurrentBoss_btns_sprite[k].setVisible(!1);switch(this.m_list_type){case 1:this.updateCurrentListCell();break;case 2:this.updateHelpListCell();break;case 3:this.updateEndListCell();break;case 4:this.updateHistoryListCell()}},updateCurrentListCell:function(){var DungeonInfo=MasterManager.getInstance().get_NewRaidBossDungeonInfo(this.m_data.new_raid_boss_dungeon_info_idx),new_raid_boss_service=NewRaidBossService.getInstance();this.m_boss_name.setString(DungeonInfo.boss_name);NetService().get_UserItemInfo_V2();m_user_id==this.m_data.discovered_user_id?(null==this.m_my_boss_img&&(this.m_my_boss_img=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_label_y.png"),this.m_my_boss_img.setContentSize(19,29),this.m_my_boss_img.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_my_boss_img.setPosition(0-.5*ccWidth(this.m_my_boss_img),ccHeight(this.m_boss_icon)-ccHeight(this.m_my_boss_img)),this.m_boss_icon.addChild(this.m_my_boss_img)),this.m_my_boss_img.setVisible(!0),this.setReqRetreatOnOff(!0)):null!=this.m_my_boss_img&&this.m_my_boss_img.setVisible(!1);var d=new_raid_boss_service.GetBossRemainTime(this.m_data);this.m_remain_time.setString(cmString(res_str("new_raidboss_standby_attack_run_time_text"),d.hours(),d.minutes())),this.m_remain_time.setVisible(!0),this.setSetCurrentBossOnOff(!0)},updateHelpListCell:function(){var DungeonInfo=MasterManager.getInstance().get_NewRaidBossDungeonInfo(this.m_data.new_raid_boss_dungeon_info_idx),new_raid_boss_service=NewRaidBossService.getInstance();this.m_boss_name.setString(DungeonInfo.boss_name);var d=new_raid_boss_service.GetBossRemainTime(this.m_data);this.m_remain_time.setString(cmString(res_str("new_raidboss_standby_attack_run_time_text"),d.hours(),d.minutes())),this.m_remain_time.setVisible(!0),this.setSetCurrentBossOnOff(!0)},updateEndListCell:function(){var DungeonInfo=MasterManager.getInstance().get_NewRaidBossDungeonInfo(this.m_data.new_raid_boss_dungeon_info_idx);NewRaidBossService.getInstance();this.m_boss_name.setString(DungeonInfo.boss_name);var convertDate=this.m_data.retreat_dt.replaceAll("-","/");3!=this.m_data.boss_activity_type?(this.m_end_time.setString(cmString(res_str("new_raidboss_battle_list_run_time"),convertDate)),this.m_end_time.setVisible(!0)):3==this.m_data.boss_activity_type&&(this.m_end_time.setString(cmString(res_str("new_raidboss_battle_list_clear_time"),convertDate)),this.m_end_time.setVisible(!0)),"y"==this.m_data.need_reward_get_yn&&this.setGetRewardOnOff(!0)},updateHistoryListCell:function(){var DungeonInfo=MasterManager.getInstance().get_NewRaidBossDungeonInfo(this.m_data.new_raid_boss_dungeon_info_idx);NewRaidBossService.getInstance();this.m_boss_name.setString(DungeonInfo.boss_name);var convertDate=this.m_data.retreat_dt.replaceAll("-","/");3!=this.m_data.boss_activity_type?(this.m_end_time.setString(cmString(res_str("new_raidboss_battle_list_run_time"),convertDate)),this.m_end_time.setVisible(!0)):3==this.m_data.boss_activity_type&&(this.m_end_time.setString(cmString(res_str("new_raidboss_battle_list_clear_time"),convertDate)),this.m_end_time.setVisible(!0))},highlightPosInCell:function(pos){},unhighlightPosInCell:function(pos){},touchPosInCell:function(pos){this.getBoundingBox();if(this.m_getreward_btns_sprite[0].isVisible()){var r=(btn_box=this.m_getreward_btns_sprite[0]).getBoundingBox();if(cc.rectContainsPoint(r,pos)&&null!=this.m_getreward_callback)return void this.m_getreward_callback(this.m_data)}if(this.m_retreat_btns_sprite[0].isVisible()){r=(btn_box=this.m_retreat_btns_sprite[0]).getBoundingBox();if(cc.rectContainsPoint(r,pos)&&null!=this.m_retreat_callback)return void this.m_retreat_callback(this.m_data)}if(this.m_setCurrentBoss_btns_sprite[0].isVisible()){r=(btn_box=this.m_setCurrentBoss_btns_sprite[0]).getBoundingBox();if(cc.rectContainsPoint(r,pos)&&null!=this.m_setCurrentBoss_callback)return void this.m_setCurrentBoss_callback(this.m_data)}var btn_box=this.m_partner_bg.getBoundingBox();cc.rectContainsPoint(btn_box,pos)&&null!=this.m_reqBossPartinList_callback&&this.m_reqBossPartinList_callback(this.m_data)},updateDiscoveredUserInfo:function(){var isFriend="y"==this.m_data.friend_yn;this.m_friend_icon.setVisible(isFriend),isFriend?this.m_discovered_nickname.setPosition(275,71):this.m_discovered_nickname.setPosition(170,71),this.m_discovered_nickname.setString(cmString(res_str("new_raidboss_battle_list_summon_name"),this.m_data.discovered_nickname))},updateBossElement:function(){var m=MasterManager.getInstance();m.get_NewRaidBossDungeonInfo(this.m_data.new_raid_boss_dungeon_info_idx),m.get_NewRaidBossDungeonInfo(this.m_data.new_raid_boss_dungeon_info_idx),NewRaidBossService.getInstance();if(0!=this.m_data.boss_data_list.length&&null!=this.m_data.boss_data_list){var npcgroup=m.get_NewRaidBossNpcGroup(this.m_data.boss_data_list[0].boss_idx),npc=m.get_NpcGeneral(npcgroup.npc_id),elementType=m.get_General(npc.gnrl_id).element_type;if(0==elementType)return this.m_element_type.setVisible(!1),void this.m_boss_name.setPositionX(136);this.m_element_type.setVisible(!0),this.m_element_type.setTexture(RES_CDN_DEFULT+cmString("new_common/img_ic_attribute_small_%d.png",elementType))}},updateBossState:function(){switch(this.m_data.boss_activity_type){case 2:this.m_state_icon.setTexture(RES_CDN_DEFULT+"new_menu_raid2/img_raid2_state_2.png"),this.m_state_icon.setVisible(!0);break;case 3:this.m_state_icon.setTexture(RES_CDN_DEFULT+"new_menu_raid2/img_raid2_state_1.png"),this.m_state_icon.setVisible(!0);break;default:this.m_state_icon.setVisible(!1)}},updateBossDifficulty:function(){this.m_boss_diffculty.setTexture(RES_CDN_DEFULT+cmString("new_common/img_label_difficulty_%d.png",this.m_data.difficult))},updateHp:function(){var DungeonInfo=MasterManager.getInstance().get_NewRaidBossDungeonInfo(this.m_data.new_raid_boss_dungeon_info_idx),State_Data=this.m_data.boss_data_list[0],addLife=(MasterTable.getInstance().get_NewRaidBossNpcGroupList(DungeonInfo.new_raid_boss_npc_group_idx),NewRaidBossService.getInstance().GetBossMaxAddedLife(this.m_data.new_raid_boss_dungeon_info_idx,State_Data));0==addLife&&(addLife=1);var CurrentAddLifeCount=State_Data.add_life_count,currentHp=State_Data.remain_hp+State_Data.max_hp*CurrentAddLifeCount,maxHp=State_Data.max_hp*addLife+State_Data.max_hp;this.m_boss_life.setString(cmString("%s / %s",Number(currentHp).toLocaleString("en"),Number(maxHp).toLocaleString("en")));var width=currentHp/maxHp*528;this.m_boss_life_gauge.setContentSize(width,15);var bShow=24<=width;this.m_boss_life_gauge.setVisible(bShow)},updatePartnerCount:function(){this.m_partner_count_label.setString(cmString(res_str("new_raidboss_battle_list_entry_count"),this.m_data.partner_count))},updateTumbnail:function(){for(var size=this.m_data.boss_data_list.length,i=0;i<BOSS_MAX_NUM;++i)this.m_boss_thub[i].setVisible(!1),this.m_boss_thub_off[i].setVisible(!1);for(i=0;i<size;i++)this.m_boss_thub[BOSS_MAX_NUM-1-i].setVisible(!0),0<this.m_data.boss_data_list.length&&null!=this.m_data.boss_data_list&&0==this.m_data.boss_data_list[i].remain_hp&&this.m_boss_thub_off[BOSS_MAX_NUM-1-i].setVisible(!0)},setGetRewardOnOff:function(on){this.m_getreward_btns_sprite[0].setVisible(on),this.m_getreward_btns_sprite[1].setVisible(!on)},setReqRetreatOnOff:function(on){this.m_retreat_btns_sprite[0].setVisible(on),this.m_retreat_btns_sprite[1].setVisible(!on)},setSetCurrentBossOnOff:function(on){this.m_setCurrentBoss_btns_sprite[0].setVisible(on),this.m_setCurrentBoss_btns_sprite[1].setVisible(!on)}}),NEW_RAID_BOSS_REQ_LIST=100,NEW_RAID_BOSS_REQ_REWARD=101,NEW_RAID_BOSS_REQ_REWARD_LIST=102,NEW_RAID_BOSS_REQ_RETREAT=103,NEW_RAID_BOSS_SHOW_CANT_RUN=104,NEW_RAID_BOSS_REQ_PARTIN_LIST=105,NEW_RAID_BOSS_LIST={BOSS_LIST_1:0,BOSS_LIST_2:1,BOSS_LIST_3:2,BOSS_LIST_4:3,BOSS_LIST_MAX:4},NEW_RAID_BOSS_SORT_TYPE={NONE:0,REMAIN_TIME:1,REMAIN_HP:2,PARTNER_COUNT:3,MY_CONTRIBUTION:4,END_TIME:5},NewRaidBossListLayer=cc.Layer.extend({m_current_tap:NEW_RAID_BOSS_LIST.BOSS_LIST_1,m_count_label:null,m_filtering_btn:null,m_sort_label_btn:null,m_sort_btn:null,m_refresh_btn:null,m_modal_layer:null,m_mark_icon:null,m_bottom_info_label:null,m_get_rewards_btn:null,m_isSortBtnVisible:!1,m_iSortType:NEW_RAID_BOSS_SORT_TYPE.REMAIN_TIME,m_bSortOrder:!0,m_sort_btn2:null,m_noCountLabel:null,m_tap_btns:[],m_Final_list:[],m_filtering_option_list:[],m_my_list:[],m_another_list:[],m_filting_list:[],m_isInit:[],m_sortMenuLayer:[],m_tap_btn:0,m_retreat_data:null,m_reward_data:null,m_req_partin_data:null,ctor:function(){this._super(),this.m_tap_btns=[],this.m_Final_list=[],this.m_filtering_option_list=[],this.m_my_list=[],this.m_another_list=[],this.m_filting_list=[]},GetCurrentTap:function(){return this.m_current_tap},SetCurrentTap:function(tap){this.m_current_tap=tap},initLayout:function(){var layer=new cc.Layer;layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),layer.setPosition(ccCenter(this).x,0),this.addChild(layer);for(var all_btn_rect=cc.Rect(16,16,18,18),offset=cc.p(0,-5),pos_x=22,i=0;i<NEW_RAID_BOSS_LIST.BOSS_LIST_MAX;i++){var tap=new NPButton(res.btn_4_off,res.btn_4_on,res.btn_3_off);switch(tap.setTitleFont(all_btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255),offset),tap.setBright(!0),tap.setContentSize(184,50),tap.setAnchorPoint(ZERO()),tap.setPosition(pos_x,520),tap.setTag(i),layer.addChild(tap),pos_x+=ccWidth(tap)+10,this.m_current_tap==i&&tap.setEnabled(!1),this.m_tap_btn=i,tap.addClickEventListener(function(sender){this.m_current_tap=sender.getTag(),0==this.m_isInit[this.m_current_tap]?MainObserver.getInstance().postNotification(sceneStr[scene_NewRaidBossListScene],NEW_RAID_BOSS_REQ_LIST):(cc.log("################ tab.addClickEventListener : "+this.m_current_tap),this.changeTapMenu(this.m_current_tap))}.bind(this)),i){case NEW_RAID_BOSS_LIST.BOSS_LIST_1:tap.setTitleText(res_str("new_raidboss_battle_list_button_battle"));break;case NEW_RAID_BOSS_LIST.BOSS_LIST_2:tap.setTitleText(res_str("new_raidboss_battle_list_button_support"));break;case NEW_RAID_BOSS_LIST.BOSS_LIST_3:tap.setTitleText(res_str("new_raidboss_battle_list_button_reward"));break;case NEW_RAID_BOSS_LIST.BOSS_LIST_4:tap.setTitleText(res_str("new_raidboss_battle_list_button_history"))}this.m_tap_btns.push(tap),this.m_isInit[i]=!1}var bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_base.png",RectZero());bg_box.setContentSize(1e3,520),bg_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bg_box.setPosition(ZERO()),layer.addChild(bg_box),layer.setContentSize(ccSize(bg_box)),this.m_count_label=cmLabelEx.getLabel(cmString("%d/%d",0,0),LABEL_FONT_INDEX.FONT_2671,!1,!0,2,cc.color(0,0,0,255)),this.m_count_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_count_label.setPosition(30,ccHeight(bg_box)-24-26),bg_box.addChild(this.m_count_label),this.m_count_label.setVisible(!1);var tSize=cc.size(960,364);this.m_tableView=new cc.TableView(this,tSize),this.m_tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_tableView.setPosition(17,75),layer.addChild(this.m_tableView),this.m_tableView.setDelegate(this),this.m_tableView.reloadData();var bg_box_bottom=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_bottom.png",RectZero());bg_box_bottom.setContentSize(1e3,72),bg_box_bottom.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bg_box_bottom.setPosition(ZERO()),layer.addChild(bg_box_bottom);var sortLayer=this.getNaviSortLayer();sortLayer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),sortLayer.setPosition(825,ccHeight(bg_box)-20-ccHeight(sortLayer)),this.addChild(sortLayer),this.doSort_final();var refresh_btn=new ccui.Button;refresh_btn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_refresh_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_refresh_on.png",""),refresh_btn.setAnchorPoint(ZERO()),refresh_btn.setPosition(902,17),refresh_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_NewRaidBossListScene],NEW_RAID_BOSS_REQ_LIST)}.bind(this)),bg_box_bottom.addChild(refresh_btn);var btn_rect=cc.Rect(20,20,20,2);this.m_filtering_btn=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_5_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_5_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_5_none.png"),this.m_filtering_btn.setContentSize(146,42),this.m_filtering_btn.setTitleFont(btn_rect,LABEL_FONT_INDEX.FONT_2072,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255),cc.p(0,0)),this.m_filtering_btn.setTitleText(res_str("new_raidboss_battle_list_button_setting")),this.m_filtering_btn.setBright(!0),this.m_filtering_btn.setAnchorPoint(ZERO()),this.m_filtering_btn.setPosition(740,17),this.m_filtering_btn.setVisible(!0),this.m_filtering_btn.addClickEventListener(function(sender){this.showModalLayer()}.bind(this)),bg_box_bottom.addChild(this.m_filtering_btn),this.m_modal_layer=new GameModalLayer,this.m_modal_layer.setContentSize(cc.director.getWinSize().width,640),this.addChild(this.m_modal_layer,99999),this.m_mark_icon=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_mark.png"),this.m_mark_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_mark_icon.setPosition(29,24),layer.addChild(this.m_mark_icon),this.m_mark_icon.setVisible(!1),this.m_bottom_info_label=cmLabelEx.getLabel(cmString(res_str("new_raidboss_battle_list_guide"),MasterManager.getInstance().get_CountFunction(55).value),LABEL_FONT_INDEX.FONT_2076,!1,!0,2,cc.color(0,0,0,255)),this.m_bottom_info_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_bottom_info_label.setPosition(67,29),layer.addChild(this.m_bottom_info_label),this.m_bottom_info_label.setVisible(!1),this.m_get_rewards_btn=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_5_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_5_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_5_none.png"),this.m_get_rewards_btn.setContentSize(216,42),this.m_get_rewards_btn.setTitleFont(btn_rect,LABEL_FONT_INDEX.FONT_2072,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255),cc.p(0,0)),this.m_get_rewards_btn.setTitleText(cmString(res_str("new_raidboss_battle_list_reward_all_button_text"),MasterManager.getInstance().get_CountFunction(50).value)),this.m_get_rewards_btn.setBright(!0),this.m_get_rewards_btn.setAnchorPoint(ZERO()),this.m_get_rewards_btn.setPosition(514,17),this.m_get_rewards_btn.setVisible(!0),this.m_get_rewards_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_NewRaidBossListScene],NEW_RAID_BOSS_REQ_REWARD_LIST)}.bind(this)),bg_box_bottom.addChild(this.m_get_rewards_btn),this.m_noCountLabel=cmLabelEx.getLabel(res_str("new_raidboss_battle_list_battle_zero"),LABEL_FONT_INDEX.FONT_2271,!1,!0,2,cc.color(0,0,0,255)),this.m_noCountLabel.setAnchorPoint(ANCHOR_MIDDLE()),this.m_noCountLabel.setPosition(ccCenter(layer)),layer.addChild(this.m_noCountLabel),this.m_noCountLabel.setVisible(!1)},onEnter:function(){this._super()},onEnterTransitionDidFinish:function(){this._super()},scrollViewDidScroll:function(view){},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;cell=null!=c?c:new NewRaidBossListCell(this.reqGetReward.bind(this),this.reqRetreat.bind(this),this.setCurrentBoss.bind(this),this.reqBossPartInList.bind(this));var data=this.m_Final_list[idx];return cell.setData(this.m_current_tap,data),cell},numberOfCellsInTableView:function(table){return this.m_Final_list.length},tableCellTouched:function(table,cell){null!=cell&&cell.touchPosInCell(cell.getTouchPos())},tableCellEnded:function(){},tableCellHighlight:function(table,cell){null!=cell&&cell.highlightPosInCell(cell.getTouchPos())},tableCellUnhighlight:function(table,cell){null!=cell&&cell.unhighlightPosInCell(cell.getTouchPos())},changeTapMenu:function(index){for(var i=0;i<NEW_RAID_BOSS_LIST.BOSS_LIST_MAX;i++)this.m_tap_btns[i].setEnabled(!0),this.m_sortMenuLayer[i].setVisible(!1),this.m_isInit[i]=!1;this.m_isInit[index]=!0,this.m_tap_btns[index].setEnabled(!1),this.m_current_tap=index,this.m_list=[],this.m_Final_list=[],this.m_filtering_option_list=[];var m=MasterManager.getInstance(),new_raid_boss_service=NewRaidBossService.getInstance();this.m_list=new_raid_boss_service.GetMyBossList(this.m_current_tap+1);var s_type=1;switch(this.m_current_tap){case NEW_RAID_BOSS_LIST.BOSS_LIST_1:s_type=GameDefault.getInstance().getNewRaidBossListTabPartinSortType(),this.m_bSortOrder=GameDefault.getInstance().getNewRaidBossListTabPartinSortOrder();break;case NEW_RAID_BOSS_LIST.BOSS_LIST_2:s_type=GameDefault.getInstance().getNewRaidBossListTabHelpRequestSortType(),this.m_bSortOrder=GameDefault.getInstance().getNewRaidBossListTabHelpRequestSortOrder();break;case NEW_RAID_BOSS_LIST.BOSS_LIST_3:s_type=GameDefault.getInstance().getNewRaidBossListTabEndSortType(),this.m_bSortOrder=GameDefault.getInstance().getNewRaidBossListTabEndSortOrder();break;case NEW_RAID_BOSS_LIST.BOSS_LIST_4:s_type=GameDefault.getInstance().getNewRaidBossListTabHistorySortType(),this.m_bSortOrder=GameDefault.getInstance().getNewRaidBossListTabHistorySortOrder()}var sort_type=parseInt(s_type);this.m_bSortOrder?(this.m_sort_btn2.loadTexturePressed(RES_CDN_DEFULT+"new_common/btn/ori/btn_sort_3_on.png"),this.m_sort_btn2.loadTextureNormal(RES_CDN_DEFULT+"new_common/btn/ori/btn_sort_3_off.png")):(this.m_sort_btn2.loadTexturePressed(RES_CDN_DEFULT+"new_common/btn/ori/btn_sort_4_on.png"),this.m_sort_btn2.loadTextureNormal(RES_CDN_DEFULT+"new_common/btn/ori/btn_sort_4_off.png")),this.m_isSortBtnVisible&&this.toggleDisplaySortMenu(),this.setSortType(sort_type,!1);for(var id=0;id<this.m_list.length;id++){var n=this.m_list[id];this.m_Final_list.push(n)}this.doSort_final(),this.setCountLabel(),this.m_tableView.reloadData(),this.m_mark_icon.setVisible(!1),this.m_bottom_info_label.setVisible(!1),this.m_get_rewards_btn.setVisible(!1),this.setSortDirection(!1),this.m_isSortBtnVisible=!1;var filteringoptioncount=0;switch(this.m_current_tap){case NEW_RAID_BOSS_LIST.BOSS_LIST_1:case NEW_RAID_BOSS_LIST.BOSS_LIST_2:filteringoptioncount=2;break;case NEW_RAID_BOSS_LIST.BOSS_LIST_3:filteringoptioncount=3;for(var iRewardCount=0,idx=0;idx<this.m_Final_list.length;idx++)"y"==this.m_Final_list[idx].need_reward_get_yn&&++iRewardCount;0<iRewardCount&&(this.m_get_rewards_btn.setVisible(!0),iRewardCount=iRewardCount<m.get_CountFunction(50).value?iRewardCount:m.get_CountFunction(50).value,this.m_get_rewards_btn.setTitleText(cmString(res_str("new_raidboss_battle_list_reward_all_button_text"),iRewardCount)));break;case NEW_RAID_BOSS_LIST.BOSS_LIST_4:filteringoptioncount=3,this.m_mark_icon.setVisible(!0),this.m_bottom_info_label.setVisible(!0)}for(var j=0;j<filteringoptioncount;++j)this.m_filtering_option_list.push(0)},cellSizeForTable:function(table){return cc.size(960,138)},tableCellSizeForIndex:function(table){return cc.size(960,138)},onExit:function(){this._super()},GetRewardData:function(){return this.m_reward_data},GetRetreatData:function(){return this.m_retreat_data},GetreqPartInData:function(){return this.m_req_partin_data},showModalLayer:function(){this.m_modal_layer._contentNode=function(contentSize,m){var layer=new cc.Layer,popup=new NewRaidBossFilteringLayer;return popup.SetCurrentTap(this.m_current_tap,this.m_filtering_option_list),popup._callback_close_popup=this.hideModalLayer.bind(this),popup.m_callback_set_option_popup=this.ConfirmFilteringList.bind(this),layer.setContentSize(popup.getContentSize()),layer.setPosition(.5*this.getContentSize()),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),layer.addChild(popup),popup.setPosition(ccCenter(layer)),this.m_modal_layer.setContentSize(layer.getContentSize()),layer}.bind(this),this.m_modal_layer.is_show()||this.m_modal_layer.show()},hideModalLayer:function(){this.m_modal_layer.is_show()&&this.m_modal_layer.hide()},showRewardModalLayer:function(reward_list){this.m_modal_layer._contentNode=function(contentSize,m){for(var layer=new cc.Layer,popup=new NewRaidBossRewardListLayer,rewardlist=[],contributionrewardlist=[],i=0;i<reward_list.length;i++)reward_list[i].bonus_type!=BONUS_TYPE_NEW_RAID_BOSS_POINT?rewardlist.push_back(reward_list[i]):contributionrewardlist.push_back(reward_list[i]);return popup.setRewardList(rewardlist),popup.setContributionRewardList(contributionrewardlist),popup._callback_close_popup=this.hideRewardModalLayer.bind(this),layer.setContentSize(popup.getContentSize()),layer.setPosition(.5*this.getContentSize()),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),layer.addChild(popup),popup.setPosition(ccCenter(layer)),this.m_modal_layer.setContentSize(layer.getContentSize()),layer}.bind(this),this.m_modal_layer.is_show()||this.m_modal_layer.show()},hideRewardModalLayer:function(){this.m_modal_layer.is_show()&&this.m_modal_layer.hide(),this.changeTapMenu(NEW_RAID_BOSS_LIST.BOSS_LIST_3)},GetRewardList:function(list){for(var maxCount=0,i=0;i<this.m_Final_list.length&&maxCount!=MasterManager.getInstance().get_CountFunction(50).value;i++)"y"==this.m_Final_list[i].need_reward_get_yn&&(list.push(this.m_Final_list[i]),++maxCount)},reqGetReward:function(data){this.m_reward_data=data,MainObserver.getInstance().postNotification(sceneStr[scene_NewRaidBossListScene],NEW_RAID_BOSS_REQ_REWARD)},reqRetreat:function(data){this.m_retreat_data=data,0!=this.m_retreat_data.shared_type?MainObserver.getInstance().postNotification(sceneStr[scene_NewRaidBossListScene],NEW_RAID_BOSS_SHOW_CANT_RUN):MainObserver.getInstance().postNotification(sceneStr[scene_NewRaidBossListScene],NEW_RAID_BOSS_REQ_RETREAT)},setCurrentBoss:function(data){NewRaidBossService.getInstance().SetCurrentBoss(data);var scene=new NewRaidBossBattleReadyScene;SceneManager.getInstance().replaceScene(scene)},reqBossPartInList:function(data){this.m_req_partin_data=data,MainObserver.getInstance().postNotification(sceneStr[scene_NewRaidBossListScene],NEW_RAID_BOSS_REQ_PARTIN_LIST)},ConfirmFilteringList:function(confirm_option_list){this.m_filtering_option_list=[];for(var i=0;i<confirm_option_list.length;i++)this.m_filtering_option_list.push(confirm_option_list[i]);switch(this.m_Final_list=[],this.m_my_list=[],this.m_another_list=[],this.m_filting_list=[],this.filteringMyBoss(),this.m_current_tap){case NEW_RAID_BOSS_LIST.BOSS_LIST_1:case NEW_RAID_BOSS_LIST.BOSS_LIST_2:this.filteringDifficulty(),this.filteringIsFriend();break;case NEW_RAID_BOSS_LIST.BOSS_LIST_3:case NEW_RAID_BOSS_LIST.BOSS_LIST_4:this.filteringDifficulty(),this.filteringIsFriend(),this.filteringIsFinish()}this.CheckListBeforedoSort(),this.doSort_final(),this.setCountLabel(),this.m_tableView.reloadData()},filteringMyBoss:function(){for(var user_info=NetService().get_UserItemInfo_V2(),i=0;i<this.m_list.length;i++)user_info.user_id!=this.m_list[i].discovered_user_id?this.m_another_list.push(this.m_list[i]):this.m_my_list.push(this.m_list[i])},filteringDifficulty:function(){if(0!=this.m_filtering_option_list[0])if(1!=this.m_filtering_option_list[0])if(2!=this.m_filtering_option_list[0]);else{if(this.m_current_tap!=NEW_RAID_BOSS_LIST.BOSS_LIST_1)for(var k=0;k<this.m_my_list.length;k++)2==this.m_my_list[k].difficult&&this.m_filting_list.push(this.m_my_list[k]);for(var kdx=0;kdx<this.m_another_list.length;kdx++)2==this.m_another_list[kdx].difficult&&this.m_filting_list.push(this.m_another_list[kdx])}else{if(this.m_current_tap!=NEW_RAID_BOSS_LIST.BOSS_LIST_1)for(var j=0;j<this.m_my_list.length;j++)1==this.m_my_list[j].difficult&&this.m_filting_list.push(this.m_my_list[j]);for(var jdx=0;jdx<this.m_another_list.length;jdx++)1==this.m_another_list[jdx].difficult&&this.m_filting_list.push(this.m_another_list[jdx])}else{if(this.m_current_tap!=NEW_RAID_BOSS_LIST.BOSS_LIST_1)for(var i=0;i<this.m_my_list.length;i++)this.m_filting_list.push(this.m_my_list[i]);for(var idx=0;idx<this.m_another_list.length;idx++)this.m_filting_list.push(this.m_another_list[idx])}},filteringIsFriend:function(){if(0!=this.m_filtering_option_list[1]){var copy_list=this.m_filting_list;if(this.m_filting_list=[],1!=this.m_filtering_option_list[1])if(2!=this.m_filtering_option_list[1]);else for(var idx=0;idx<copy_list.length;idx++)"y"==copy_list[idx].friend_yn&&this.m_filting_list.push(copy_list[idx]);else for(var i=0;i<copy_list.length;i++)"y"!=copy_list[i].friend_yn&&this.m_filting_list.push(copy_list[i])}},filteringIsFinish:function(){if(0!=this.m_filtering_option_list[2]){var copy_list=this.m_filting_list;if(this.m_filting_list=[],1!=this.m_filtering_option_list[2]);else{for(var i=0;i<copy_list.length;i++)return void(3==copy_list[i].boss_activity_type&&this.m_filting_list.push(copy_list[i]));if(2==this.m_filtering_option_list[2])for(var idx=0;idx<copy_list.length;idx++)3!=copy_list[idx].boss_activity_type&&this.m_filting_list.push(copy_list[idx])}}},setCountLabel:function(){var m=MasterManager.getInstance();if(0<this.m_Final_list.length)this.m_count_label.setString(cmString(res_str("new_raidboss_battle_list_battle_list_count"),this.m_Final_list.length,m.get_CountFunction(55).value)),this.m_count_label.setVisible(!0),this.m_noCountLabel.setVisible(!1);else{switch(this.m_current_tap){case NEW_RAID_BOSS_LIST.BOSS_LIST_1:this.m_noCountLabel.setString(res_str("new_raidboss_battle_list_battle_zero"));break;case NEW_RAID_BOSS_LIST.BOSS_LIST_2:this.m_noCountLabel.setString(res_str("new_raidboss_battle_list_support_zero"));break;case NEW_RAID_BOSS_LIST.BOSS_LIST_3:this.m_noCountLabel.setString(res_str("new_raidboss_battle_list_reward_zero"));break;case NEW_RAID_BOSS_LIST.BOSS_LIST_4:this.m_noCountLabel.setString(res_str("new_raidboss_battle_list_history_zero"))}this.m_noCountLabel.setVisible(!0),this.m_count_label.setVisible(!1)}},getSortMenuLayer:function(tapType){var layer=new cc.Layer,sort_btn_strs=[];switch(tapType){case NEW_RAID_BOSS_LIST.BOSS_LIST_1:sort_btn_strs.push_back(res_str("new_raidboss_battle_list_sort_reward_info")),sort_btn_strs.push_back(res_str("new_raidboss_battle_list_sort_entry_count")),sort_btn_strs.push_back(res_str("new_raidboss_battle_list_sort_boss_hp")),sort_btn_strs.push_back(res_str("new_raidboss_battle_list_sort_remain_time"));break;case NEW_RAID_BOSS_LIST.BOSS_LIST_2:sort_btn_strs.push_back(res_str("new_raidboss_battle_list_sort_entry_count")),sort_btn_strs.push_back(res_str("new_raidboss_battle_list_sort_boss_hp")),sort_btn_strs.push_back(res_str("new_raidboss_battle_list_sort_remain_time"));break;case NEW_RAID_BOSS_LIST.BOSS_LIST_3:case NEW_RAID_BOSS_LIST.BOSS_LIST_4:sort_btn_strs.push_back(res_str("new_raidboss_battle_list_sort_reward_info")),sort_btn_strs.push_back(res_str("new_raidboss_battle_list_sort_entry_count")),sort_btn_strs.push_back(res_str("new_raidboss_battle_list_sort_clear_time"))}for(var btn_pos_y=0,str_size=sort_btn_strs.length,i=0;i<sort_btn_strs.length;i++){var str=sort_btn_strs[i],all_btn_rect=cc.Rect(20,15,20,2),offset=cc.p(0,0),btn=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_6_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_6_on.png");btn.setPosition(0,btn_pos_y-25),btn.ignoreContentAdaptWithSize(!1),btn.setTitleFont(all_btn_rect,LABEL_FONT_INDEX.FONT_1672,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255),offset),btn.setTitleText(str),btn.setTag(str_size),btn.setBright(!0),btn.setContentSize(152,32),btn.setAnchorPoint(ZERO()),btn.addClickEventListener(function(sender){var btn=sender,type=this.convertSortType(btn.getTag());this.setSortType(type)}.bind(this)),layer.addChild(btn),btn_pos_y+=ccHeight(btn),str_size--}return layer.setContentSize(111,btn_pos_y),layer},getNaviSortLayer:function(){var layer=new cc.Layer,all_btn_rect=cc.Rect(20,15,20,2),offset=cc.p(0,0);this.m_sort_btn=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_6_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_6_on.png"),this.m_sort_btn.setPosition(ZERO()),this.m_sort_btn.ignoreContentAdaptWithSize(!1),this.m_sort_btn.setTitleFont(all_btn_rect,LABEL_FONT_INDEX.FONT_1672,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255),offset),this.m_sort_btn.setTitleText("remain_time"),this.m_sort_btn.setBright(!0),this.m_sort_btn.setContentSize(152,32),this.m_sort_btn.setAnchorPoint(ZERO()),this.m_sort_btn.addClickEventListener(function(sender){this.toggleDisplaySortMenu()}.bind(this)),layer.addChild(this.m_sort_btn),this.setSortBtnLabel(this.m_iSortType),this.m_sort_btn2=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_sort_3_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_sort_3_on.png"),this.m_sort_btn2.setAnchorPoint(ZERO()),this.m_sort_btn2.setPosition(ccWidth(this.m_sort_btn)+10,0),this.m_sort_btn2.addClickEventListener(function(sender){this.setSortDirection(),this.m_tableView.reloadData()}.bind(this)),layer.addChild(this.m_sort_btn2),this.m_bSortOrder||(this.m_sort_btn2.loadTexturePressed(RES_CDN_DEFULT+"new_common/btn/ori/btn_sort_4_on.png"),this.m_sort_btn2.loadTextureNormal(RES_CDN_DEFULT+"new_common/btn/ori/btn_sort_4_off.png"));for(var i=0;i<NEW_RAID_BOSS_LIST.BOSS_LIST_MAX;++i)this.m_sortMenuLayer[i]=this.getSortMenuLayer(i),this.m_sortMenuLayer[i].ignoreAnchorPointForPosition(!1),this.m_sortMenuLayer[i].setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_sortMenuLayer[i].setPosition(ZERO()),this.m_sortMenuLayer[i].setVisible(!1),layer.addChild(this.m_sortMenuLayer[i],100);return layer.setContentSize(ccSize(this.m_sort_btn)),this.setSortType(this.m_iSortType),layer},toggleDisplaySortMenu:function(){this.m_isSortBtnVisible?(this.m_sortMenuLayer[this.m_current_tap].setVisible(!1),this.m_isSortBtnVisible=!1):(this.m_sortMenuLayer[this.m_current_tap].setVisible(!0),this.m_isSortBtnVisible=!0)},getSortDirection:function(){return this.m_bSortOrder},setSortDirection:function(do_sort){if(null==do_sort&&(do_sort=!0),this.m_bSortOrder?(this.m_bSortOrder=!1,this.m_sort_btn2.loadTexturePressed(RES_CDN_DEFULT+"new_common/btn/ori/btn_sort_4_on.png"),this.m_sort_btn2.loadTextureNormal(RES_CDN_DEFULT+"new_common/btn/ori/btn_sort_4_off.png")):(this.m_bSortOrder=!0,this.m_sort_btn2.loadTexturePressed(RES_CDN_DEFULT+"new_common/btn/ori/btn_sort_3_on.png"),this.m_sort_btn2.loadTextureNormal(RES_CDN_DEFULT+"new_common/btn/ori/btn_sort_3_off.png")),this.m_isSortBtnVisible&&this.toggleDisplaySortMenu(),1==do_sort)switch(this.CheckListBeforedoSort(),this.doSort_final(),this.m_current_tap){case NEW_RAID_BOSS_LIST.BOSS_LIST_1:GameDefault.getInstance().setNewRaidBossListTabPartinSortOrder(this.m_bSortOrder);break;case NEW_RAID_BOSS_LIST.BOSS_LIST_2:GameDefault.getInstance().setNewRaidBossListTabHelpRequestSortOrder(this.m_bSortOrder);break;case NEW_RAID_BOSS_LIST.BOSS_LIST_3:GameDefault.getInstance().setNewRaidBossListTabEndSortOrder(this.m_bSortOrder);break;case NEW_RAID_BOSS_LIST.BOSS_LIST_4:GameDefault.getInstance().setNewRaidBossListTabHistorySortOrder(this.m_bSortOrder)}},setSortBtnLabel:function(sort_type){switch(parseInt(sort_type)){case NEW_RAID_BOSS_SORT_TYPE.REMAIN_TIME:this.m_sort_btn.setTitleText(res_str("new_raidboss_battle_list_sort_remain_time"));break;case NEW_RAID_BOSS_SORT_TYPE.REMAIN_HP:this.m_sort_btn.setTitleText(res_str("new_raidboss_battle_list_sort_boss_hp"));break;case NEW_RAID_BOSS_SORT_TYPE.PARTNER_COUNT:this.m_sort_btn.setTitleText(res_str("new_raidboss_battle_list_sort_entry_count"));break;case NEW_RAID_BOSS_SORT_TYPE.MY_CONTRIBUTION:this.m_sort_btn.setTitleText(res_str("new_raidboss_battle_list_sort_reward_info"));break;case NEW_RAID_BOSS_SORT_TYPE.END_TIME:this.m_sort_btn.setTitleText(res_str("new_raidboss_battle_list_sort_clear_time"));break;default:this.m_sort_btn.setTitleText(res_str("new_raidboss_battle_list_sort_remain_time"))}},setSortType:function(sort_type,do_sort){if(null==do_sort&&(do_sort=!0),0==sort_type&&(sort_type=1),this.m_iSortType!=sort_type){switch(this.m_iSortType=sort_type,this.m_current_tap){case NEW_RAID_BOSS_LIST.BOSS_LIST_1:GameDefault.getInstance().setNewRaidBossListTabPartinSortType(this.m_iSortType);break;case NEW_RAID_BOSS_LIST.BOSS_LIST_2:GameDefault.getInstance().setNewRaidBossListTabHelpRequestSortType(this.m_iSortType);break;case NEW_RAID_BOSS_LIST.BOSS_LIST_3:GameDefault.getInstance().setNewRaidBossListTabEndSortType(this.m_iSortType);break;case NEW_RAID_BOSS_LIST.BOSS_LIST_4:GameDefault.getInstance().setNewRaidBossListTabHistorySortType(this.m_iSortType)}this.setSortBtnLabel(sort_type),1==do_sort&&(this.CheckListBeforedoSort(),this.doSort_final(),this.m_tableView.reloadData())}this.m_isSortBtnVisible&&this.toggleDisplaySortMenu()},doSort:function(list){if(0!=list.length)switch(this.m_iSortType){case NEW_RAID_BOSS_SORT_TYPE.REMAIN_TIME:case NEW_RAID_BOSS_SORT_TYPE.END_TIME:list=stable(list,function(l,r){var b=moment(l.retreat_dt).valueOf(),e=moment(r.retreat_dt).valueOf();return this.m_bSortOrder?b<e:e<b}.bind(this));break;case NEW_RAID_BOSS_SORT_TYPE.REMAIN_HP:list=stable(list,function(l,r){return this.m_bSortOrder?l.boss_data_list[0].remain_hp+l.boss_data_list[0].add_life_count*l.boss_data_list[0].max_hp<r.boss_data_list[0].remain_hp+r.boss_data_list[0].add_life_count*r.boss_data_list[0].max_hp:l.boss_data_list[0].remain_hp+l.boss_data_list[0].add_life_count*l.boss_data_list[0].max_hp>r.boss_data_list[0].remain_hp+r.boss_data_list[0].add_life_count*r.boss_data_list[0].max_hp}.bind(this));break;case NEW_RAID_BOSS_SORT_TYPE.PARTNER_COUNT:list=stable(list,function(l,r){return this.m_bSortOrder?l.partner_count<r.partner_count:l.partner_count>r.partner_count}.bind(this));break;case NEW_RAID_BOSS_SORT_TYPE.MY_CONTRIBUTION:list=stable(list,function(l,r){return this.m_bSortOrder?l.retreat_dt<r.retreat_dt:l.retreat_dt>r.retreat_dt}.bind(this))}},doSort_my:function(){if(0!=this.m_my_list.length)switch(this.m_iSortType){case NEW_RAID_BOSS_SORT_TYPE.REMAIN_TIME:case NEW_RAID_BOSS_SORT_TYPE.END_TIME:this.m_my_list=stable(this.m_my_list,function(l,r){var b=moment(l.retreat_dt).valueOf(),e=moment(r.retreat_dt).valueOf();return this.m_bSortOrder?b<e:e<b}.bind(this));break;case NEW_RAID_BOSS_SORT_TYPE.REMAIN_HP:this.m_my_list=stable(this.m_my_list,function(l,r){return this.m_bSortOrder?l.boss_data_list[0].remain_hp+l.boss_data_list[0].add_life_count*l.boss_data_list[0].max_hp<r.boss_data_list[0].remain_hp+r.boss_data_list[0].add_life_count*r.boss_data_list[0].max_hp:l.boss_data_list[0].remain_hp+l.boss_data_list[0].add_life_count*l.boss_data_list[0].max_hp>r.boss_data_list[0].remain_hp+r.boss_data_list[0].add_life_count*r.boss_data_list[0].max_hp}.bind(this));break;case NEW_RAID_BOSS_SORT_TYPE.PARTNER_COUNT:this.m_my_list=stable(this.m_my_list,function(l,r){return this.m_bSortOrder?l.partner_count<r.partner_count:l.partner_count>r.partner_count}.bind(this));break;case NEW_RAID_BOSS_SORT_TYPE.MY_CONTRIBUTION:this.m_my_list=stable(this.m_my_list,function(l,r){return this.m_bSortOrder?l.retreat_dt<r.retreat_dt:l.retreat_dt>r.retreat_dt}.bind(this))}},doSort_filting:function(){if(0!=this.m_filting_list.length)switch(this.m_iSortType){case NEW_RAID_BOSS_SORT_TYPE.REMAIN_TIME:case NEW_RAID_BOSS_SORT_TYPE.END_TIME:this.m_filting_list=stable(this.m_filting_list,function(l,r){var b=moment(l.retreat_dt).valueOf(),e=moment(r.retreat_dt).valueOf();return this.m_bSortOrder?b<e:e<b}.bind(this));break;case NEW_RAID_BOSS_SORT_TYPE.REMAIN_HP:this.m_filting_list=stable(this.m_filting_list,function(l,r){return this.m_bSortOrder?l.boss_data_list[0].remain_hp+l.boss_data_list[0].add_life_count*l.boss_data_list[0].max_hp<r.boss_data_list[0].remain_hp+r.boss_data_list[0].add_life_count*r.boss_data_list[0].max_hp:l.boss_data_list[0].remain_hp+l.boss_data_list[0].add_life_count*l.boss_data_list[0].max_hp>r.boss_data_list[0].remain_hp+r.boss_data_list[0].add_life_count*r.boss_data_list[0].max_hp}.bind(this));break;case NEW_RAID_BOSS_SORT_TYPE.PARTNER_COUNT:this.m_filting_list=stable(this.m_filting_list,function(l,r){return this.m_bSortOrder?l.partner_count<r.partner_count:l.partner_count>r.partner_count}.bind(this));break;case NEW_RAID_BOSS_SORT_TYPE.MY_CONTRIBUTION:this.m_filting_list=stable(this.m_filting_list,function(l,r){return this.m_bSortOrder?l.retreat_dt<r.retreat_dt:l.retreat_dt>r.retreat_dt}.bind(this))}},doSort_final:function(){if(0!=this.m_Final_list.length)switch(this.m_iSortType){case NEW_RAID_BOSS_SORT_TYPE.REMAIN_TIME:case NEW_RAID_BOSS_SORT_TYPE.END_TIME:this.m_Final_list=stable(this.m_Final_list,function(l,r){var b=moment(l.retreat_dt).valueOf(),e=moment(r.retreat_dt).valueOf();return this.m_bSortOrder?b<e:e<b}.bind(this));break;case NEW_RAID_BOSS_SORT_TYPE.REMAIN_HP:this.m_Final_list=stable(this.m_Final_list,function(l,r){return this.m_bSortOrder?l.boss_data_list[0].remain_hp+l.boss_data_list[0].add_life_count*l.boss_data_list[0].max_hp<r.boss_data_list[0].remain_hp+r.boss_data_list[0].add_life_count*r.boss_data_list[0].max_hp:l.boss_data_list[0].remain_hp+l.boss_data_list[0].add_life_count*l.boss_data_list[0].max_hp>r.boss_data_list[0].remain_hp+r.boss_data_list[0].add_life_count*r.boss_data_list[0].max_hp}.bind(this));break;case NEW_RAID_BOSS_SORT_TYPE.PARTNER_COUNT:this.m_Final_list=stable(this.m_Final_list,function(l,r){return this.m_bSortOrder?l.partner_count<r.partner_count:l.partner_count>r.partner_count}.bind(this));break;case NEW_RAID_BOSS_SORT_TYPE.MY_CONTRIBUTION:this.m_Final_list=stable(this.m_Final_list,function(l,r){return this.m_bSortOrder?l.retreat_dt<r.retreat_dt:l.retreat_dt>r.retreat_dt}.bind(this))}},CheckListBeforedoSort:function(){if(0<this.m_my_list.length||0<this.m_another_list.length){if(this.m_Final_list=[],this.m_current_tap==NEW_RAID_BOSS_LIST.BOSS_LIST_1){this.doSort_my();for(var i=0;i<this.m_my_list.length;i++)this.m_Final_list.push(this.m_my_list[i])}this.doSort_filting();for(var idx=0;idx<this.m_filting_list.length;idx++)this.m_Final_list.push(this.m_filting_list[idx])}},convertSortType:function(type){switch(this.m_current_tap){case NEW_RAID_BOSS_LIST.BOSS_LIST_3:case NEW_RAID_BOSS_LIST.BOSS_LIST_4:if(type==NEW_RAID_BOSS_SORT_TYPE.REMAIN_TIME){type=NEW_RAID_BOSS_SORT_TYPE.END_TIME;break}if(type==NEW_RAID_BOSS_SORT_TYPE.REMAIN_HP){type=NEW_RAID_BOSS_SORT_TYPE.PARTNER_COUNT;break}if(type!=NEW_RAID_BOSS_SORT_TYPE.PARTNER_COUNT)break;type=NEW_RAID_BOSS_SORT_TYPE.MY_CONTRIBUTION}return type},showPartInList:function(){this.m_modal_layer._contentNode=function(contentSize,m){var layer=new cc.Layer,popup=new NewRaidBossPartInUserListLayer;return popup.setList(NetService().get_new_raid_boss_partner_user_list(),this.m_req_partin_data),popup._callback_close_popup=this.HidePartInModalLayer.bind(this),layer.setContentSize(popup.getContentSize()),layer.setPosition(.5*this.getContentSize()),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),layer.addChild(popup),popup.setPosition(ccCenter(layer)),this.m_modal_layer.setContentSize(layer.getContentSize()),layer}.bind(this),this.m_modal_layer.is_show()||this.m_modal_layer.show()},HidePartInModalLayer:function(){this.m_modal_layer.is_show()&&this.m_modal_layer.hide()}}),NewRaidBossListScene=(RaidBossList_INIT=!1,GameScene.extend({m_layer:null,m_current_tap:0,ctor:function(){this._super(scene_NewRaidBossListScene)},init:function(){var win_size=cc.director.getWinSize(),bg=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_raid2/bg_raid2_sub.jpg");bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(win_size)),this.addChild(bg),this.m_layer=new NewRaidBossListLayer,this.m_layer.initLayout(),this.addChild(this.m_layer);var statusLayer=new StatusLayer(INVOKER_TYPE.new_raid_boss);statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_raid2.png");title.setAnchorPoint(ANCHOR_TOP_LEFT()),title.setPosition(94,ccHeight(this)),this.addChild(title);var back_btn=new ccui.Button;return back_btn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png",""),back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(sender){this.back()}.bind(this)),this.addChild(back_btn),!0},onEnterTransitionDidFinish:function(){this._super();var context=BattleContext._getInstance(),tab=context.getNewRaidBossTabIndex();context.getNewRaidBossTabIndex()!=NEW_RAID_BOSS_TAB_NONE&&this.m_layer.SetCurrentTap(tab-1),context.setNewRaidBossTabIndex(NEW_RAID_BOSS_TAB_NONE),this.sendReqList(this.m_layer.GetCurrentTap()+1)},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_NewRaidBossListScene]),this.playNewRaidBossLobbyBGM()},onExit:function(){this._super()},onNotification:function(msg){switch(this._super(msg),msg){case NEW_RAID_BOSS_REQ_LIST:this.sendReqList(this.m_layer.GetCurrentTap()+1);break;case NEW_RAID_BOSS_REQ_REWARD:this.sendReqReward();break;case NEW_RAID_BOSS_REQ_REWARD_LIST:this.sendReqRewardList();break;case NEW_RAID_BOSS_REQ_RETREAT:this.showRetreatConfirm();break;case NEW_RAID_BOSS_SHOW_CANT_RUN:this.showCantRun();break;case NEW_RAID_BOSS_REQ_PARTIN_LIST:this.sendReqPartinList()}return!0},onNetworkEvent:function(opcode,state,body){this._super(opcode,state,body);var res=body;opcode==net.OP.op_new_raid_boss_dungeon_list?this.m_layer.changeTapMenu(res.request_type-1):opcode==net.OP.op_new_raid_boss_conquest_reward?res.error!=net.ERROR.NET_E_SUCCESS?res.error==net.ERROR.NET_E_ALREADY_REWARD_RECEIVED&&this.showErrorRewardReceiveDone():(this.m_layer.changeTapMenu(NEW_RAID_BOSS_TAB_END-1),this.m_layer.showRewardModalLayer(res.reward_items)):opcode==net.OP.op_new_raid_boss_dungeon_retreat?res.error!=net.ERROR.NET_E_SUCCESS?res.error==net.ERROR.NET_E_ALREADY_RETREAT?this.showBossIsTimeOver():res.error==net.ERROR.NET_E_ALREADY_SHARED&&this.showCantRun():(this.m_layer.changeTapMenu(NEW_RAID_BOSS_TAB_PARTIN-1),this.showRetreatSuccess()):opcode==net.OP.op_new_raid_boss_partner_user_list&&this.m_layer.showPartInList()},back:function(){this.onKeyBack(!0)},sendReqList:function(requestType){var req={};req.opcode=net.OP.op_new_raid_boss_dungeon_list,req.request_type=this.m_layer.GetCurrentTap()+1;var new_raid_boss_period_idx=MasterTable.getInstance().get_NewRaidBossOpenPeriodIdx();0!=new_raid_boss_period_idx&&(req.new_raid_boss_period_idx=new_raid_boss_period_idx,this.network_write(req))},showErrorMessage:function(msg){this.m_box.setTitle(res_str("label_common_information")),this.m_box.setText(msg),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},SetTap:function(Tap){this.SetCurrentTap(Tap)},sendReqRewardList:function(){var dungeon_list=[];this.m_layer.GetRewardList(dungeon_list);var dungeon=dungeon_list[0],req={};if(req.opcode=net.OP.op_new_raid_boss_conquest_reward,req.new_raid_boss_period_idx=dungeon.new_raid_boss_period_idx,0!=req.new_raid_boss_period_idx){req.dungeon_list=[];for(var i=0;i<dungeon_list.length;i++)req.dungeon_list.push(dungeon_list[i]);this.network_write(req)}},sendReqReward:function(){var Data=this.m_layer.GetRewardData(),req={};req.opcode=net.OP.op_new_raid_boss_conquest_reward,req.new_raid_boss_period_idx=Data.new_raid_boss_period_idx,req.dungeon_list=[],0!=req.new_raid_boss_period_idx&&(req.dungeon_list.push(Data),this.network_write(req))},sendReqRetreat:function(){var Data=this.m_layer.GetRetreatData();if(0==Data.boss_activity_type){var req={};req.opcode=net.OP.op_new_raid_boss_dungeon_retreat,req.new_raid_boss_period_idx=Data.new_raid_boss_period_idx,req.new_raid_boss_dungeon_info_idx=Data.new_raid_boss_dungeon_info_idx,req.boss_num=Data.boss_num,this.network_write(req)}},sendReqPartinList:function(){var Data=this.m_layer.GetreqPartInData(),req={};req.opcode=net.OP.op_new_raid_boss_partner_user_list,req.new_raid_boss_period_idx=Data.new_raid_boss_period_idx,req.new_raid_boss_dungeon_info_idx=Data.new_raid_boss_dungeon_info_idx,req.boss_num=Data.boss_num,req.discovered_user_id=Data.discovered_user_id,this.network_write(req)},showRetreatConfirm:function(){this.m_box.setTitle(res_str("new_raidboss_standby_retreat_pop_up_title")),this.m_box.setText(res_str("new_raidboss_standby_retreat_pop_up_text1")),this.m_box.setText("\n"),this.m_box.setText(res_str("new_raidboss_standby_retreat_pop_up_text2")),this.m_box.setText("\n"),this.m_box.setText(res_str("new_raidboss_standby_retreat_pop_up_text3")),this.m_box.setText("\n"),this.m_box.setText(res_str("new_raidboss_standby_retreat_pop_up_text4")),this.m_box.setText("\n"),this.m_box.setText(res_str("new_raidboss_standby_retreat_pop_up_text5")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.sendReqRetreat(),this.m_box.hide()}.bind(this))),this.m_box.show()},showRetreatSuccess:function(){MasterTable.getInstance();this.m_box.setTitle(res_str("label_common_information")),this.m_box.setText(res_str("new_raidboss_standby_retreat_complete_text")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},playNewRaidBossLobbyBGM:function(){var bgm=MasterTable.getInstance().get_Bgm_v2(BGM_TYPE_NEW_RAID_BOSS_LOBBY_BGM),audio=AudioEngine.getInstance(),new_raid_bgm=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm.sound_file_name;audio.m_bgmPath!=new_raid_bgm&&(audio.stopBackgroundMusic(),audio.playBackgroundMusic(new_raid_bgm,!0))},showErrorRewardReceiveDone:function(){MasterTable.getInstance();this.m_box.setTitle(res_str("label_preparation_title")),this.m_box.setText(res_str("new_raidboss_reward_receive_done")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showCantRun:function(){MasterTable.getInstance();this.m_box.setTitle(res_str("label_preparation_title")),this.m_box.setText(res_str("new_raidboss_support_call_done_cannot_run")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showBossIsTimeOver:function(){MasterTable.getInstance();this.m_box.setTitle(res_str("label_information_title")),this.m_box.setTitle(res_str("new_raidboss_main_boss_run_pop_up_text")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){var BossData=this.m_layer.GetRetreatData();(new NetService).checkPartinTimeRetreatDungeon(BossData.new_raid_boss_period_idx),this.back()},0,"back"),this.m_box.hide()}.bind(this))),this.m_box.show()}})),NewRaidBossPartInUserListLayer=cc.Layer.extend({m_tableView:null,m_label:null,_callback_close_popup:null,m_list:[],m_bossMaxHp:0,ctor:function(){this._super(),this._callback_close_popup=null,this.m_list={new_raid_boss_period_idx:0,discovered_user_id:"",new_raid_boss_dungeon_info_idx:0,boss_num:0,parnter_user_list:[]},this.init()},init:function(){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var winSize=cc.director.getWinSize(),boxSize=cc.size(630,500),box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));box.setAnchorPoint(ANCHOR_MIDDLE()),box.setPreferredSize(boxSize),box.setPosition(ccCenter(winSize)),this.addChild(box);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_3.png");navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(.5*boxSize.width,boxSize.height-11),box.addChild(navi);var naviSize=ccSize(navi);this.m_label=cmLabel.getLabel("partnerlist",LABEL_FONT_INDEX.FONT_241),this.m_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_label.setPosition(.5*naviSize.width,.5*naviSize.height+2),navi.addChild(this.m_label);var btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);btn.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),btn.setPosition(naviSize.width-10,.5*naviSize.height+3),navi.addChild(btn),btn.addClickEventListener(function(sender){null!=this._callback_close_popup&&this._callback_close_popup()}.bind(this));var Size=cc.size(596,430);return this.m_tableView=new cc.TableView(this,Size),this.m_tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_tableView.setScrollBarAlwaysShow(!1),this.m_tableView.setPosition(17,10),box.addChild(this.m_tableView),this.m_tableView.setDelegate(this),!0},tableCellEnded:function(table){},scrollViewDidZoom:function(view){},cellSizeForTable:function(table){return cc.size(596,147)},tableCellSizeForIndex:function(){return cc.size(596,147)},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;cell=null!=c?c:new NewRaidPartInUserListCell;var data=this.m_list.parnter_user_list[idx];return cell.setData(data,this.m_bossMaxHp),cell},numberOfCellsInTableView:function(table){return this.m_list.parnter_user_list.length},tableCellTouched:function(table,cell){null!=cell&&cell.touchPosInCell(cell.getTouchPos())},tableCellHighlight:function(table,cell){null!=cell&&cell.highlightPosInCell(cell.getTouchPos())},tableCellUnhighlight:function(table,cell){null!=cell&&cell.unhighlightPosInCell(cell.getTouchPos())},setList:function(list,BossData){this.m_list=list;var new_raid_boss_service=NewRaidBossService.getInstance(),State_Data=BossData.boss_data_list[0],addLife=new_raid_boss_service.GetBossMaxAddedLife(BossData.new_raid_boss_dungeon_info_idx,State_Data);0==addLife&&(addLife=1),this.m_bossMaxHp=State_Data.max_hp*addLife+State_Data.max_hp,this.m_tableView.reloadData(),this.m_label.setString(cmString(res_str("new_raidboss_standby_entry_pop_up_count"),this.m_list.parnter_user_list.length))}}),NewRaidBossRewardInfoListCell=cc.TableViewCell.extend({m_list_bg:null,m_difficulty_bg:null,m_difficulty_label:null,m_drop_info_label:null,ctor:function(){this._super(),this.init()},init:function(){var cellSize=cc.size(596,155);this.setContentSize(cellSize),this.m_list_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_5.png",RectZero()),this.m_list_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_list_bg.setPosition(ccCenter(cellSize)),this.m_list_bg.setContentSize(cellSize),this.addChild(this.m_list_bg);var rect=cc.Rect(10,4,4,20);return this.m_difficulty_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_8.png",rect),this.m_difficulty_bg.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_difficulty_bg.setPosition(0,ccHeight(this.m_list_bg)-5),this.m_difficulty_bg.setContentSize(202,31),this.m_list_bg.addChild(this.m_difficulty_bg),this.m_difficulty_label=cmLabel.getLabel("DIFFICULTY",LABEL_FONT_INDEX.FONT_201),this.m_difficulty_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_difficulty_label.setPosition(27,ccCenter(this.m_difficulty_bg).y),this.m_difficulty_bg.addChild(this.m_difficulty_label),this.m_drop_info_label=cmLabel.getLabel(res_str("new_raidboss_battle_reward_pop_up_clear"),LABEL_FONT_INDEX.FONT_201),this.m_drop_info_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_drop_info_label.setPosition(15,ccHeight(this.m_list_bg)-ccHeight(this.m_difficulty_bg)-20),this.m_list_bg.addChild(this.m_drop_info_label),!0},setData:function(data){this.m_data=data,this.updateLayout()},highlightPosInCell:function(pos){},unhighlightPosInCell:function(pos){},touchPosInCell:function(pos){},updateLayout:function(){var m=MasterTable.getInstance(),list=(NewRaidBossService.getInstance(),m.get_NewRaidBossDropRewardList(this.m_data.new_raid_boss_drop_reward_info_group_idx)),offsetX=15;switch(this.m_data.difficult){case 1:this.m_difficulty_label.setString(res_str("new_raidboss_main_reward_info_easy"));break;case 2:this.m_difficulty_label.setString(res_str("new_raidboss_main_reward_info_hard"));break;default:this.m_difficulty_label.setString("UNKNOWN")}for(var finallist=[],isExist=!1,i=0;i<list.length;i++){isExist=!1;for(var j=0;j<finallist.length;j++)if(list[i].bonus_type==finallist[j].bonus_type&&list[i].min_value==finallist[j].min_value){isExist=!0;break}0==isExist&&finallist.push_back(list[i])}for(var idx=0;idx<finallist.length;idx++){var imgPath;imgPath=RES_CDN_DEFULT+"icon/img_icon_frame.png";var RewardBg=cc.Sprite.create(imgPath);RewardBg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),RewardBg.setPosition(offsetX,13),this.addChild(RewardBg);var path="",p=finallist[idx];switch(p.bonus_type){case BONUS_TYPE_NEW_EQUIPMENT_ITEM:path=cmString("#img_reward_328_%03d_n.png",p.min_value);break;case BONUS_TYPE_ILLUSTRATE_TICKET:case BONUS_TYPE_GNRL_PIECE:case BONUS_TYPE_NEW_EQUIPMENT_MAKE_MATERIAL:case BONUS_TYPE_NEW_EQUIPMENT_ENHANCE_MATERIAL:case BONUS_TYPE_NEW_EQUIPMENT_SMELT_MATERIAL:case BONUS_TYPE_NEW_EQUIPMENT_ENCHANT_TICKET:case BONUS_TYPE_NEW_RAID_BOSS_POINT:path=cmString("#img_reward_%02d_%d_n.png",p.bonus_type,p.min_value);break;default:path=cmString("#img_reward_%02d_n.png",p.bonus_type)}var icon=cc.Sprite.create(path);icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(RewardBg)),icon.setScale(.5),RewardBg.addChild(icon),offsetX+=15+ccWidth(RewardBg)}}}),NewRaidBossRewardInfoPopupLayer=cc.Layer.extend({_callback_close_popup:null,m_tableview:null,m_list:[],ctor:function(){this._super(),this.m_list=[],this.init()},init:function(){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var winSize=cc.director.getWinSize(),boxSize=cc.size(630,460),box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));box.setAnchorPoint(ANCHOR_MIDDLE()),box.setPreferredSize(boxSize),box.setPosition(ccCenter(winSize)),this.addChild(box);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_3.png");navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(.5*boxSize.width,boxSize.height-11),box.addChild(navi);var naviSize=ccSize(navi),title=cmLabel.getLabel(res_str("new_raidboss_main_reward_info_popup_title"),LABEL_FONT_INDEX.FONT_241);title.setAnchorPoint(ANCHOR_MIDDLE()),title.setPosition(.5*naviSize.width,.5*naviSize.height+2),navi.addChild(title);var btn=new LabelButton("btn_07_off.png","btn_07_on.png","btn_07_none.png",ccui.Widget.PLIST_TEXTURE);btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn.setFont(LABEL_FONT_INDEX.FONT_241),btn.setString(res_str("btn_label_confirm")),btn.setPosition(ccCenter(box).x,16),box.addChild(btn),btn.addClickEventListener(function(sender){null!=this._callback_close_popup&&this._callback_close_popup()}.bind(this));var m=MasterTable.getInstance(),new_raid_boss_service=NewRaidBossService.getInstance();return this.m_list=m.get_NewRaidBossDungeonListData(new_raid_boss_service.GetCurrentPeriodIdx()),this.m_tableview=new cc.TableView(this,cc.size(596,320)),this.m_tableview.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_tableview.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_tableview.setScrollBarAlwaysShow(!1),this.m_tableview.setPosition(15,80),box.addChild(this.m_tableview),this.m_tableview.setDelegate(this),!0},tableCellSizeForIndex:function(table){return cc.size(565,160)},cellSizeForTable:function(table){return cc.size(565,160)},numberOfCellsInTableView:function(table){return this.m_list.length},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;cell=null!=c?c:new NewRaidBossRewardInfoListCell;var data=this.m_list[idx];return cell.setData(data),cell},tableCellTouched:function(table,cell){null!=cell&&cell.touchPosInCell(cell.getTouchPos())},tableCellHighlight:function(table,cell){null!=cell&&cell.highlightPosInCell(cell.getTouchPos())},tableCellUnhighlight:function(table,cell){null!=cell&&cell.unhighlightPosInCell(cell.getTouchPos())},scrollViewDidZoom:function(view){},tableCellHighlight:function(table,cell){},tableCellUnhighlight:function(table,cell){},tableCellEnded:function(table){}}),NewRaidBossRewardList=cc.Layer.extend({m_tableView:null,m_list_bg:null,m_reward_type_bg:null,m_reward_type_label:null,m_noConquestRewardCountLabel:null,m_list:[],ctor:function(){this._super(),this.m_list=[],this.init()},init:function(){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());cc.director.getWinSize();var boxSize=cc.size(596,155);this.setContentSize(boxSize),this.m_list_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_5.png",RectZero()),this.m_list_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_list_bg.setPreferredSize(boxSize),this.m_list_bg.setPosition(ccCenter(boxSize)),this.addChild(this.m_list_bg);var rect=cc.Rect(10,4,4,20);this.m_reward_type_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_8.png",rect),this.m_reward_type_bg.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_reward_type_bg.setPosition(0,ccHeight(this.m_list_bg)-5),this.m_reward_type_bg.setContentSize(202,31),this.m_list_bg.addChild(this.m_reward_type_bg),this.m_reward_type_label=cmLabel.getLabel("reward_type",LABEL_FONT_INDEX.FONT_201),this.m_reward_type_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_reward_type_label.setPosition(27,ccCenter(this.m_reward_type_bg).y),this.m_reward_type_bg.addChild(this.m_reward_type_label);var tsize=cc.size(581,100);return this.m_tableView=new cc.TableView(this,tsize),this.m_tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_tableView.setScrollBarAlwaysShow(!1),this.m_tableView.setPosition(15,20),this.m_list_bg.addChild(this.m_tableView),this.m_tableView.setDelegate(this),this.m_noConquestRewardCountLabel=cmLabel.getLabel(res_str("new_raidboss_clear_reward_nothing_text"),LABEL_FONT_INDEX.FONT_2076),this.m_noConquestRewardCountLabel.setAnchorPoint(ANCHOR_MIDDLE()),this.m_noConquestRewardCountLabel.setPosition(ccCenter(this.m_list_bg)),this.m_list_bg.addChild(this.m_noConquestRewardCountLabel),this.m_noConquestRewardCountLabel.setVisible(!1),!0},cellSizeForTable:function(table){return Size(581,70)},tableCellSizeForIndex:function(){return cc.size(581,70)},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;cell=null!=c?c:new NewRaidBossRewardListCell;var data=this.m_list[idx];return cell.setData(data),cell},numberOfCellsInTableView:function(table){return this.m_list.length},tableCellTouched:function(table,cell){null!=cell&&cell.touchPosInCell(cell.getTouchPos())},tableCellHighlight:function(table,cell){null!=cell&&cell.highlightPosInCell(cell.getTouchPos())},tableCellUnhighlight:function(table,cell){null!=cell&&cell.unhighlightPosInCell(cell.getTouchPos())},tableCellEnded:function(){},scrollViewDidScroll:function(view){},scrollViewDidZoom:function(view){},setList:function(list,reward_type){0==reward_type?(this.m_reward_type_label.setString(res_str("new_raidboss_battle_reward_pop_up_clear")),0==list.size()&&this.m_noConquestRewardCountLabel.setVisible(!0)):this.m_reward_type_label.setString(res_str("new_raidboss_battle_reward_pop_up_reward_info")),this.m_list=list,this.m_tableView.reloadData()}}),NewRaidBossRewardListCell=cc.TableViewCell.extend({m_reward_label:null,ctor:function(){this._super(),this.init()},init:function(){var cellSize=cc.size(581,68);return this.setContentSize(cellSize),this.m_reward_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.m_reward_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_reward_label.setPosition(80,ccCenter(this).y),this.addChild(this.m_reward_label),!0},setData:function(data){this.m_data=data,this.updateLayout()},highlightPosInCell:function(pos){},unhighlightPosInCell:function(pos){},touchPosInCell:function(pos){},updateLayout:function(){var imgPath,m=MasterManager.getInstance();NewRaidBossService.getInstance();imgPath=RES_CDN_DEFULT+"icon/img_icon_frame.png";var RewardBg=cc.Sprite.create(imgPath);RewardBg.setAnchorPoint(ANCHOR_MIDDLE()),RewardBg.setPosition(.5*ccWidth(RewardBg),ccCenter(this).y),this.addChild(RewardBg);var bonus_type=m.get_BonusType(this.m_data.bonus_type),path="",name="";switch(this.m_data.bonus_type){case BONUS_TYPE_NEW_EQUIPMENT_ITEM:path=cmString("#img_reward_328_%03d_n.png",this.m_data.bonus_idx),name=m.get_NewEquipment(this.m_data.bonus_idx).name;break;case BONUS_TYPE_ILLUSTRATE_TICKET:case BONUS_TYPE_GNRL_PIECE:path=cmString("#img_reward_%02d_%d_n.png",this.m_data.bonus_type,this.m_data.bonus_idx),name=bonus_type.name;break;case BONUS_TYPE_NEW_EQUIPMENT_MAKE_MATERIAL:path=cmString("#img_reward_%02d_%d_n.png",this.m_data.bonus_type,this.m_data.bonus_idx),name=m.get_NewEquipmentMakeMaterial(this.m_data.bonus_idx).name;break;case BONUS_TYPE_NEW_EQUIPMENT_ENHANCE_MATERIAL:path=cmString("#img_reward_%02d_%d_n.png",this.m_data.bonus_type,this.m_data.bonus_idx),name=m.get_NewEquipmentEnhanceMaterial(this.m_data.bonus_idx).name;break;case BONUS_TYPE_NEW_EQUIPMENT_SMELT_MATERIAL:path=cmString("#img_reward_%02d_%d_n.png",this.m_data.bonus_type,this.m_data.bonus_idx),name=m.get_NewEquipmentSmeltMaterial(this.m_data.bonus_idx).name;break;case BONUS_TYPE_NEW_EQUIPMENT_ENCHANT_TICKET:path=cmString("#img_reward_%02d_%d_n.png",this.m_data.bonus_type,this.m_data.bonus_idx),name=m.get_NewEquipmentEnchantTicket(this.m_data.bonus_idx).name;break;case BONUS_TYPE_NEW_RAID_BOSS_POINT:path=cmString("#img_reward_%02d_%d_n.png",this.m_data.bonus_type,this.m_data.bonus_idx),name=bonus_type.name;break;default:path=cmString("#img_reward_%02d_n.png",this.m_data.bonus_type),name=bonus_type.name}var icon=cc.Sprite.create(path);icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(RewardBg)),icon.setScale(.5),RewardBg.addChild(icon),this.m_reward_label.setString(cmString(res_str("new_raidboss_battle_reward_pop_up_item_name_count"),name,Number(this.m_data.bonus_level).toLocaleString("en")))}}),REWARD_BATTLE=0,REWARD_CONTRIBUTION=1,REWARD_MAX=2,NewRaidBossRewardListLayer=cc.Layer.extend({_callback_close_popup:null,m_rewardListLayer:[],ctor:function(){this._super(),this.init()},init:function(){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var winSize=cc.director.getWinSize(),boxSize=cc.size(630,460),box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));box.setAnchorPoint(ANCHOR_MIDDLE()),box.setPreferredSize(boxSize),box.setPosition(ccCenter(winSize)),this.addChild(box);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_3.png");navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(.5*boxSize.width,boxSize.height-11),box.addChild(navi);var naviSize=ccSize(navi),title=cmLabel.getLabel(res_str("new_raidboss_battle_reward_pop_up_title"),LABEL_FONT_INDEX.FONT_241);title.setAnchorPoint(ANCHOR_MIDDLE()),title.setPosition(.5*naviSize.width,.5*naviSize.height+2),navi.addChild(title);var btn=new LabelButton("btn_07_off.png","btn_07_on.png","btn_07_none.png",ccui.Widget.PLIST_TEXTURE);return btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn.setFont(LABEL_FONT_INDEX.FONT_241),btn.setString(res_str("btn_label_confirm")),btn.setPosition(ccCenter(box).x,16),box.addChild(btn),btn.addClickEventListener(function(sender){null!=this._callback_close_popup&&this._callback_close_popup()}.bind(this)),this.m_rewardListLayer[REWARD_BATTLE]=new NewRaidBossRewardList,this.m_rewardListLayer[REWARD_BATTLE].setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_rewardListLayer[REWARD_BATTLE].setPosition(.5*boxSize.width,boxSize.height-65),box.addChild(this.m_rewardListLayer[REWARD_BATTLE]),this.m_rewardListLayer[REWARD_CONTRIBUTION]=new NewRaidBossRewardList,this.m_rewardListLayer[REWARD_CONTRIBUTION].setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_rewardListLayer[REWARD_CONTRIBUTION].setPosition(.5*boxSize.width,boxSize.height-220),box.addChild(this.m_rewardListLayer[REWARD_CONTRIBUTION]),!0},setRewardList:function(list){this.m_rewardListLayer[REWARD_BATTLE].setList(list,REWARD_BATTLE)},setContributionRewardList:function(list){this.m_rewardListLayer[REWARD_CONTRIBUTION].setList(list,REWARD_CONTRIBUTION)}}),NewRaidBossRewardShopItem=cc.Layer.extend({m_buy_callback:null,m_tooltip_callback:null,m_product_icon_frame:null,m_price:null,m_price_icon:null,m_shop_type:0,m_name_label:null,m_name_sprite:null,m_first_buy_jade_tag:null,m_remain_label:null,m_buy_btns_sprite:[],ctor:function(buy_callback,tooltip_callback){this._super(),this.m_buy_btns_sprite=[],this.init(buy_callback,tooltip_callback)},init:function(buy_callback,tooltip_callback){this.m_buy_callback=buy_callback,this.m_tooltip_callback=tooltip_callback;var itemCellSize=cc.size(475,130);this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(itemCellSize);var bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_1.png",RectZero());bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setContentSize(itemCellSize),bg.setPosition(ccCenter(itemCellSize)),this.addChild(bg),this.m_product_icon_frame=cc.Sprite.create("#img_icon_frame_4.png"),this.m_product_icon_frame.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_product_icon_frame.setPosition(10,.5*itemCellSize.height),IS_SP_BROWSER&&this.m_product_icon_frame.setPosition(30,.5*itemCellSize.height),this.addChild(this.m_product_icon_frame),this.m_name_label=cmLabelEx.getLabel(cmString("%s","NAME"),LABEL_FONT_INDEX.FONT_2271,!1,!0,2,cc.color.BLACK),this.m_name_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_name_label.setPosition(129,95),this.addChild(this.m_name_label),this.m_price_icon=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_raid2/img_raid2_point.png"),this.m_price_icon.setScale(.5),this.m_price_icon.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_price_icon.setPosition(129,61),this.addChild(this.m_price_icon),this.m_price=cmLabelEx.getLabel("0",LABEL_FONT_INDEX.FONT_2675,!1,!0,2,cc.color.BLACK),this.m_price.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_price.setPosition(177,61),this.addChild(this.m_price),this.m_remain_label=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_1876,!1,!0,2,cc.color.BLACK),this.m_remain_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_remain_label.setPosition(129,17),this.addChild(this.m_remain_label);var img_paths=[];img_paths.push(RES_CDN_DEFULT+"new_common/btn/ori/btn_1_off.png"),img_paths.push(RES_CDN_DEFULT+"new_common/btn/ori/btn_1_on.png");var font_outline_colors=[];font_outline_colors.push(cc.color.WHITE),font_outline_colors.push(cc.color(128,128,128,255));for(var i=0;i<img_paths.length;i++){var img=cc.Scale9Sprite.create(img_paths.at(i),RectZero());img.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),img.setPreferredSize(cc.size(116,58)),img.setPosition(itemCellSize.width-16,.5*itemCellSize.height),this.addChild(img);var label=cmLabelEx.getLabel(res_str("new_raidboss_point_shop_button_buy"),LABEL_FONT_INDEX.FONT_2272,!1,!0,2,font_outline_colors.at(i));label.setAnchorPoint(ANCHOR_MIDDLE()),label.setPosition(ccCenter(img)),img.addChild(label),this.m_buy_btns_sprite.push_back(img)}return!0},setData:function(data){this.m_data=data,this.updateCellItem()},updateCellItem:function(){var m=MasterManager.getInstance(),bonusType=(NewRaidBossService.getInstance(),m.get_BonusType(this.m_data.bonus_type));this.setBtnOnOff(!1),this.m_price.setString(cmString("%s",Number(this.m_data.price).toLocaleString("en"))),this.m_product_icon_frame.removeAllChildrenWithCleanup(!0);var product_icon=null;if(this.m_data.bonus_type==BONUS_TYPE_YUNHEE_FIX){var gnrl=m.get_General(this.m_data.min_value),card_info={};this.getCardInfo(gnrl.gnrl_id,card_info);var card=(new Card).createCard(card_info,CARD_TYPE.type_common_card);card.setPosition(ccCenter(this.m_product_icon_frame)),this.m_product_icon_frame.addChild(card),this.m_name_label.setString(cmString(res_str("new_raidboss_point_shop_product"),gnrl.name,Number(this.m_data.max_value).toLocaleString("en")))}else switch(this.m_data.bonus_type){case BONUS_TYPE_NEW_EQUIPMENT_ITEM:product_icon=cc.Sprite.create(cmString("#img_shop_evolve_%02d_%d_n.png",this.m_data.bonus_type,this.m_data.min_value)),IS_SP_BROWSER&&product_icon.setScale(2),this.m_name_label.setString(cmString(res_str("new_raidboss_point_shop_product"),m.get_NewEquipment(this.m_data.min_value).name,Number(this.m_data.max_value).toLocaleString("en")));break;case BONUS_TYPE_ILLUSTRATE_TICKET:this.m_name_label.setString(cmString(res_str("new_raidboss_point_shop_product"),"",Number(this.m_data.max_value).toLocaleString("en"))),product_icon=cc.Sprite.create(cmString("#img_reward_%02d_%d_n.png",this.m_data.bonus_type,this.m_data.min_value));break;case BONUS_TYPE_GNRL_PIECE:this.m_name_label.setString(cmString(res_str("new_raidboss_point_shop_product"),m.get_GnrlPieceType(this.m_data.min_value).name,Number(this.m_data.max_value).toLocaleString("en"))),product_icon=cc.Sprite.create(cmString("#img_reward_%02d_%d_n.png",this.m_data.bonus_type,this.m_data.min_value));break;case BONUS_TYPE_NEW_EQUIPMENT_MAKE_MATERIAL:this.m_name_label.setString(cmString(res_str("new_raidboss_point_shop_product"),m.get_NewEquipmentMakeMaterial(this.m_data.min_value).name,Number(this.m_data.max_value).toLocaleString("en"))),product_icon=cc.Sprite.create(cmString("#img_shop_evolve_%02d_%d_n.png",this.m_data.bonus_type,this.m_data.min_value)),IS_SP_BROWSER&&product_icon.setScale(2);break;case BONUS_TYPE_NEW_EQUIPMENT_ENHANCE_MATERIAL:this.m_name_label.setString(cmString(res_str("new_raidboss_point_shop_product"),m.get_NewEquipmentEnhanceMaterial(this.m_data.min_value).name,Number(this.m_data.max_value).toLocaleString("en"))),product_icon=cc.Sprite.create(cmString("#img_shop_evolve_%02d_%d_n.png",this.m_data.bonus_type,this.m_data.min_value)),IS_SP_BROWSER&&product_icon.setScale(2);break;case BONUS_TYPE_NEW_EQUIPMENT_SMELT_MATERIAL:this.m_name_label.setString(cmString(res_str("new_raidboss_point_shop_product"),m.get_NewEquipmentSmeltMaterial(this.m_data.min_value).name,Number(this.m_data.max_value).toLocaleString("en"))),product_icon=cc.Sprite.create(cmString("#img_shop_evolve_%02d_%d_n.png",this.m_data.bonus_type,this.m_data.min_value)),IS_SP_BROWSER&&product_icon.setScale(2);break;case BONUS_TYPE_NEW_EQUIPMENT_ENCHANT_TICKET:this.m_name_label.setString(cmString(res_str("new_raidboss_point_shop_product"),m.get_NewEquipmentEnchantTicket(this.m_data.min_value).name,Number(this.m_data.max_value).toLocaleString("en"))),product_icon=cc.Sprite.create(cmString("#img_shop_evolve_%02d_%d_n.png",this.m_data.bonus_type,this.m_data.min_value)),IS_SP_BROWSER&&product_icon.setScale(2);break;case BONUS_TYPE_JADE:case BONUS_TYPE_SKIP_TICKET:this.m_name_label.setString(cmString(res_str("new_raidboss_point_shop_product"),bonusType.name,Number(this.m_data.max_value).toLocaleString("en"))),(product_icon=cc.Sprite.create(cmString("#img_reward_%02d_n.png",this.m_data.bonus_type))).setScale(.7);break;default:product_icon=cc.Sprite.create(cmString("#img_reward_%02d_n.png",this.m_data.bonus_type)),this.m_name_label.setString(cmString(res_str("new_raidboss_point_shop_product"),bonusType.name,Number(this.m_data.max_value).toLocaleString("en")))}if(null!=product_icon&&(product_icon.setAnchorPoint(ANCHOR_MIDDLE()),product_icon.setPosition(ccCenter(this.m_product_icon_frame)),this.m_product_icon_frame.addChild(product_icon)),cmLabel.autoSizeFit(this.m_name_label,200,22),this.m_remain_label.setString(""),0<this.m_data.max_buy_count){var RemainCount=this.m_data.max_buy_count,shop_period=BattleContext._getInstance().getNewRaidBossShopPeriodIndex(),new_raid_boss_shop_buy_log_list=NetService().get_new_raid_boss_shop_buy_log_list(),buy_log=new_raid_boss_shop_buy_log_list.findIndex(function(log){return log.new_raid_boss_shop_period_idx==shop_period});if(-1!=buy_log){var found_log=new_raid_boss_shop_buy_log_list[buy_log].user_shop_buy_log.findIndex(function(d){return d.new_raid_boss_shop_period_idx==this.m_data.new_raid_boss_shop_period_idx&&d.new_raid_boss_point_shop_item_idx==this.m_data.new_raid_boss_point_shop_item_idx}.bind(this));-1!=found_log&&(RemainCount=this.m_data.max_buy_count-new_raid_boss_shop_buy_log_list[buy_log].user_shop_buy_log[found_log].buy_count)}0==RemainCount&&this.setBtnOnOff(!0),this.m_remain_label.setString(cmString(res_str("new_raidboss_point_shop_limit_count"),RemainCount,this.m_data.max_buy_count))}else this.m_remain_label.setString(res_str("new_raidboss_point_shop_limit_no"))},setBtnOnOff:function(is_on){this.m_buy_btns_sprite.at(0).setVisible(!is_on),this.m_buy_btns_sprite.at(1).setVisible(is_on)},touchPosInItem:function(pos,table_in_pos){var this_rect=this.getBoundingBox(),r=this.m_buy_btns_sprite[0].getBoundingBox();if(r.x+=this_rect.x,r.y+=this_rect.y,cc.rectContainsPoint(r,pos)){if(0==this.m_buy_btns_sprite.at(0).isVisible())return;null!=this.m_buy_callback&&this.m_buy_callback(this.m_data)}},highlightPosInItem:function(pos,table_in_pos){var this_rect=this.getBoundingBox(),icon_box=this.m_product_icon_frame.getBoundingBox();icon_box.x+=this_rect.x,icon_box.y+=this_rect.y,cc.rectContainsPoint(icon_box,pos)&&null!=this.m_tooltip_callback&&this.m_tooltip_callback(this.m_data,table_in_pos)},unhighlightPosInItem:function(pos,table_in_pos){},getCardInfo:function(gnrl_id,info){info.gnrl_id=gnrl_id,info.level=1}}),NewRaidBossRewardShopItemCell=cc.TableViewCell.extend({m_data_list:[],m_item_list:[],ctor:function(buy_callback,tooltip_callback){this.m_data_list=[],this.m_item_list=[],this._super(),this.init(buy_callback,tooltip_callback)},init:function(buy_callback,tooltip_callback){var cellSize=cc.size(960,140);this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(cellSize);for(var i=0;i<2;i++){var item=new NewRaidBossRewardShopItem(buy_callback,tooltip_callback),s=ccSize(item);item.setPosition(s.width*i+10*i,10),this.addChild(item),this.m_item_list.push_back(item)}return!0},setData:function(data){this.m_data_list=data,this.updateCellLayout(this.m_data_list[i])},updateCellLayout:function(){for(var i=0;i<this.m_item_list.length;i++){var item=this.m_item_list[i];item.setVisible(!1),i<this.m_data_list.length&&(item.setVisible(!0),item.setData(this.m_data_list[i]))}},highlightPosInCell:function(pos,table_in_pos){for(var i=0;i<this.m_item_list.length;i++){var item=this.m_item_list[i],r=item.getBoundingBox();if(cc.rectContainsPoint(r,pos)){item.isVisible()&&item.highlightPosInItem(pos,table_in_pos);break}}},unhighlightPosInCell:function(pos,table_in_pos){for(var i=0;i<this.m_item_list.length;i++){var item=this.m_item_list[i],r=item.getBoundingBox();if(cc.rectContainsPoint(r,pos)){item.isVisible()&&item.unhighlightPosInItem(pos,table_in_pos);break}}},touchPosInCell:function(pos,table_in_pos){for(var i=0;i<this.m_item_list.length;i++){var item=this.m_item_list[i],r=item.getBoundingBox();if(cc.rectContainsPoint(r,pos)){item.isVisible()&&item.touchPosInItem(pos,table_in_pos);break}}}}),NEW_RAIDBOSS_ITEM_MAX_COUNT=999,NewRaidBossRewardShopItemCountPopup=cc.Layer.extend({m_item_count_callback:null,m_close_callback:null,m_count:0,m_navi_title:null,m_buy_count:null,m_buy_price:null,m_product_icon:null,m_price_node:null,m_buy_type_icon:null,m_min_btn:null,m_max_btn:null,m_minus_btn:null,m_plus_btn:null,ctor:function(){this._super(),this.init()},init:function(){NewRaidBossService.getInstance(),MasterTable.getInstance();var winSize=ccSize(this);this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var boxSize=cc.size(630,370),rect=cc.Rect(40,40,10,10),bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",rect);bg.setPreferredSize(boxSize),bg.setPosition(ccCenter(winSize)),this.addChild(bg);var navi=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_navi.png",RectZero());navi.setInsetLeft(46),navi.setInsetRight(46),navi.setPreferredSize(cc.size(ccWidth(bg)-16,ccHeight(navi))),navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(bg).x,ccHeight(bg)-11),bg.addChild(navi),this.m_navi_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_261),this.m_navi_title.setAnchorPoint(ANCHOR_MIDDLE()),this.m_navi_title.setPosition(ccCenter(navi).x,ccCenter(navi).y+3),navi.addChild(this.m_navi_title);var rect2=cc.Rect(3,3,22,22),count_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",rect2);count_box.setAnchorPoint(ANCHOR_MIDDLE()),count_box.setPreferredSize(cc.size(138,38)),count_box.setPosition(ccCenter(bg).x,115),bg.addChild(count_box),this.m_buy_count=cmLabel.getLabel("1",LABEL_FONT_INDEX.FONT_262),this.m_buy_count.setAnchorPoint(ANCHOR_MIDDLE()),this.m_buy_count.setPosition(ccCenter(count_box)),count_box.addChild(this.m_buy_count),this.m_price_node=new cc.Node,this.m_price_node.setAnchorPoint(ANCHOR_MIDDLE()),this.m_price_node.setPosition(ccCenter(bg).x,170),bg.addChild(this.m_price_node),this.m_buy_type_icon=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_raid2/img_raid2_point.png"),this.m_buy_type_icon.setScale(.5),this.m_buy_type_icon.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_buy_type_icon.setPosition(0,20),this.m_price_node.addChild(this.m_buy_type_icon),this.m_buy_price=cmLabel.getLabel("0",LABEL_FONT_INDEX.FONT_241),this.m_buy_price.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_buy_price.setPosition(ccPosX(this.m_buy_type_icon)+ccWidth(this.m_buy_type_icon)+10,20),this.m_price_node.addChild(this.m_buy_price),this.m_price_node.setContentSize(ccWidth(this.m_buy_type_icon)+ccWidth(this.m_buy_price)+10,40),this.m_product_icon=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_shop/img_icon_frame_4.png"),this.m_product_icon.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_product_icon.setPosition(ccCenter(bg).x,191),bg.addChild(this.m_product_icon);var btn_cancel=new LabelButton("btn_08_off.png","btn_08_on.png","",ccui.Widget.PLIST_TEXTURE);btn_cancel.setFont(LABEL_FONT_INDEX.FONT_241),btn_cancel.setOffFont(LABEL_FONT_INDEX.FONT_242),btn_cancel.setString(res_str("btn_label_cancel")),btn_cancel.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),btn_cancel.setPosition(ccCenter(bg).x-5,16),bg.addChild(btn_cancel),btn_cancel.addClickEventListener(function(sender){AudioEngine.getInstance().playEffect(RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3"),null!=this.m_close_callback&&this.m_close_callback()}.bind(this));var btn_buy_confirm=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);return btn_buy_confirm.setFont(LABEL_FONT_INDEX.FONT_241),btn_buy_confirm.setString(res_str("btn_label_confirm")),btn_buy_confirm.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn_buy_confirm.setPosition(ccCenter(bg).x+5,16),bg.addChild(btn_buy_confirm),btn_buy_confirm.addClickEventListener(function(sender){AudioEngine.getInstance().playEffect(RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3"),this.sendBuyItemCount()}.bind(this)),this.m_min_btn=new LabelButton("btn_eventvs_green_off.png","btn_eventvs_green_on.png","btn_eventvs_green_none.png",ccui.Widget.PLIST_TEXTURE),this.m_min_btn.setFont(LABEL_FONT_INDEX.FONT_201),this.m_min_btn.setString(res_str("btn_label_min_value")),this.m_min_btn.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_min_btn.setPosition(110,115),bg.addChild(this.m_min_btn),this.m_min_btn.addClickEventListener(function(sender){this.setMinCount()}.bind(this)),this.m_minus_btn=new ccui.Button,this.m_minus_btn.loadTextures("btn_spinner_minus_off.png","btn_spinner_minus_on.png","btn_spinner_minus_none.png",ccui.Widget.PLIST_TEXTURE),this.m_minus_btn.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_minus_btn.setPosition(ccPosX(this.m_min_btn)+ccWidth(this.m_min_btn)+5,115),bg.addChild(this.m_minus_btn),this.m_minus_btn.addClickEventListener(function(sender){this.addCount(-1)}.bind(this)),this.m_max_btn=new LabelButton("btn_eventvs_green_off.png","btn_eventvs_green_on.png","btn_eventvs_green_none.png",ccui.Widget.PLIST_TEXTURE),this.m_max_btn.setFont(LABEL_FONT_INDEX.FONT_201),this.m_max_btn.setString(res_str("btn_label_max_value")),this.m_max_btn.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_max_btn.setPosition(ccWidth(bg)-110,115),bg.addChild(this.m_max_btn),this.m_max_btn.addClickEventListener(function(sender){this.setMaxCount()}.bind(this)),this.m_plus_btn=new ccui.Button,this.m_plus_btn.loadTextures("btn_spinner_plus_off.png","btn_spinner_plus_on.png","btn_spinner_plus_none.png",ccui.Widget.PLIST_TEXTURE),this.m_plus_btn.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_plus_btn.setPosition(ccPosX(this.m_max_btn)-ccWidth(this.m_max_btn)-5,115),bg.addChild(this.m_plus_btn),this.m_plus_btn.addClickEventListener(function(sender){this.addCount(1)}.bind(this)),!0},setItemCountCallback:function(buy_callback,close_callback){this.m_item_count_callback=buy_callback,this.m_close_callback=close_callback},setShopData:function(shop_data){this.m_shop_data=shop_data,this.m_count=1,this.updateLayer()},updateLayer:function(){var m=MasterManager.getInstance();switch(this.m_shop_data.bonus_type){case BONUS_TYPE_NEW_EQUIPMENT_ITEM:var equip=m.get_NewEquipment(this.m_shop_data.min_value);this.m_navi_title.setString(cmString(res_str("new_raidboss_point_shop_product"),equip.name,Number(this.m_shop_data.max_value).toLocaleString("en")));break;case BONUS_TYPE_NEW_EQUIPMENT_MAKE_MATERIAL:var mat=m.get_NewEquipmentMakeMaterial(this.m_shop_data.min_value);this.m_navi_title.setString(cmString(res_str("new_raidboss_point_shop_product"),mat.name,Number(this.m_shop_data.max_value).toLocaleString("en")));break;case BONUS_TYPE_NEW_EQUIPMENT_SMELT_MATERIAL:mat=m.get_NewEquipmentSmeltMaterial(this.m_shop_data.min_value);this.m_navi_title.setString(cmString(res_str("new_raidboss_point_shop_product"),mat.name,Number(this.m_shop_data.max_value).toLocaleString("en")));break;case BONUS_TYPE_NEW_EQUIPMENT_ENHANCE_MATERIAL:mat=m.get_NewEquipmentEnhanceMaterial(this.m_shop_data.min_value);this.m_navi_title.setString(cmString(res_str("new_raidboss_point_shop_product"),mat.name,Number(this.m_shop_data.max_value).toLocaleString("en")));break;case BONUS_TYPE_NEW_EQUIPMENT_ENCHANT_TICKET:mat=m.get_NewEquipmentEnchantTicket(this.m_shop_data.min_value);this.m_navi_title.setString(cmString(res_str("new_raidboss_point_shop_product"),mat.name,Number(this.m_shop_data.max_value).toLocaleString("en")));break;default:var bonusType=m.get_BonusType(this.m_shop_data.bonus_type);this.m_navi_title.setString(cmString(res_str("new_raidboss_point_shop_product"),bonusType.name,Number(this.m_shop_data.max_value).toLocaleString("en")))}if(IS_SP_BROWSER&&this.m_product_icon.setScale(1),this.m_product_icon.removeAllChildrenWithCleanup(!0),this.m_shop_data.bonus_type==BONUS_TYPE_YUNHEE_FIX){var card_info={};this.getCardInfo(this.m_shop_data.min_value,card_info);var card=(new Card).createCard(card_info,CARD_TYPE.type_common_card);card.setPosition(ccCenter(this.m_product_icon).x,ccCenter(this.m_product_icon).y),this.m_product_icon.addChild(card)}else{var path="";switch(this.m_shop_data.bonus_type){case BONUS_TYPE_NEW_EQUIPMENT_ITEM:path=cmString("img_shop_evolve_%02d_%d_n.png",this.m_shop_data.bonus_type,this.m_shop_data.min_value),IS_SP_BROWSER&&this.m_product_icon.setScale(2);break;case BONUS_TYPE_ILLUSTRATE_TICKET:path=cmString("img_reward_%02d_%d_n.png",this.m_shop_data.bonus_type,this.m_shop_data.min_value);break;case BONUS_TYPE_GNRL_PIECE:path=cmString("img_reward_%02d_%d.png",this.m_shop_data.bonus_type,this.m_shop_data.min_value);break;case BONUS_TYPE_NEW_EQUIPMENT_MAKE_MATERIAL:case BONUS_TYPE_NEW_EQUIPMENT_ENHANCE_MATERIAL:case BONUS_TYPE_NEW_EQUIPMENT_SMELT_MATERIAL:case BONUS_TYPE_NEW_EQUIPMENT_ENCHANT_TICKET:path=cmString("img_shop_evolve_%02d_%d_n.png",this.m_shop_data.bonus_type,this.m_shop_data.min_value),IS_SP_BROWSER&&this.m_product_icon.setScale(2);break;case BONUS_TYPE_JADE:case BONUS_TYPE_SKIP_TICKET:this.m_product_icon.setScale(.7),path=cmString("img_reward_%02d_n.png",this.m_shop_data.bonus_type);break;default:path=cmString("img_reward_%02d_n.png",this.m_shop_data.bonus_type)}var frame=cc.spriteFrameCache.getSpriteFrame(path);this.m_product_icon.setSpriteFrame(frame)}this.updateItemCount()},updateItemCount:function(){var myPoint=NewRaidBossService.getInstance().GetBossPoint(BattleContext._getInstance().getNewRaidBossShopPeriodIndex()),is_enable_buy=!0,max_plus_count=0;this.m_buy_count.setString(Number(this.m_count).toLocaleString("en"));var new_raid_boss_shop_buy_log_list=NetService().get_new_raid_boss_shop_buy_log_list(),price=this.m_count*this.m_shop_data.price;if(this.m_buy_price.setString(Number(price).toLocaleString("en")),myPoint<price&&(is_enable_buy=!1),this.m_price_node.setContentSize(ccWidth(this.m_buy_type_icon)+ccWidth(this.m_buy_price)+10,40),is_enable_buy){var is_max=!1,max_count=0;if(max_plus_count=max_count=myPoint/this.m_shop_data.price,0<this.m_shop_data.max_buy_count){var RemainCount=this.m_shop_data.max_buy_count,shop_period=BattleContext._getInstance().getNewRaidBossShopPeriodIndex(),buy_log=new_raid_boss_shop_buy_log_list.findIndex(function(log){return log.new_raid_boss_shop_period_idx==shop_period}.bind(this));if(-1!=buy_log){var found_log=new_raid_boss_shop_buy_log_list[buy_log].user_shop_buy_log.findIndex(function(d){return d.new_raid_boss_shop_period_idx==this.m_shop_data.new_raid_boss_shop_period_idx&&d.new_raid_boss_point_shop_item_idx==this.m_shop_data.new_raid_boss_point_shop_item_idx}.bind(this));-1!=found_log?(RemainCount=this.m_shop_data.max_buy_count-new_raid_boss_shop_buy_log_list[buy_log].user_shop_buy_log[found_log].buy_count,this.m_count>=RemainCount&&(max_count=RemainCount)):this.m_count>=this.m_shop_data.max_buy_count&&(max_count=this.m_shop_data.max_buy_count)}}max_count>ITEM_MAX_COUNT&&(max_count=ITEM_MAX_COUNT),this.m_count>=max_count&&(is_max=!0),is_max?(max_count<=1?(this.m_min_btn.setEnabled(!1),this.m_minus_btn.setEnabled(!1)):(this.m_min_btn.setEnabled(!0),this.m_minus_btn.setEnabled(!0)),this.m_max_btn.setEnabled(!1),this.m_plus_btn.setEnabled(!1)):(this.m_count<=1?(this.m_min_btn.setEnabled(!1),this.m_minus_btn.setEnabled(!1)):(this.m_min_btn.setEnabled(!0),this.m_minus_btn.setEnabled(!0)),max_plus_count<this.m_shop_data.max_buy_count?(this.m_plus_btn.setEnabled(!0),this.m_max_btn.setEnabled(!1)):(this.m_plus_btn.setEnabled(!0),this.m_max_btn.setEnabled(!0)))}else this.m_minus_btn.setEnabled(!1),this.m_plus_btn.setEnabled(!1),this.m_min_btn.setEnabled(!1),this.m_max_btn.setEnabled(!1)},sendBuyItemCount:function(){null!=this.m_item_count_callback&&this.m_item_count_callback(this.m_shop_data,this.m_count),null!=this.m_close_callback&&this.m_close_callback()},addCount:function(cnt){AudioEngine.getInstance().playEffect(RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3");NewRaidBossService.getInstance().GetBossPoint(BattleContext._getInstance().getNewRaidBossShopPeriodIndex());var new_raid_boss_shop_buy_log_list=NetService().get_new_raid_boss_shop_buy_log_list();if(this.m_count+=cnt,0<this.m_shop_data.max_buy_count){this.m_shop_data.max_buy_count;var shop_period=BattleContext._getInstance().getNewRaidBossShopPeriodIndex(),buy_log=new_raid_boss_shop_buy_log_list.findIndex(function(log){return log.new_raid_boss_shop_period_idx==shop_period});if(-1!=buy_log){var found_log=new_raid_boss_shop_buy_log_list[buy_log].user_shop_buy_log.findIndex(function(d){return d.new_raid_boss_shop_period_idx==this.m_shop_data.new_raid_boss_shop_period_idx&&d.new_raid_boss_point_shop_item_idx==this.m_shop_data.new_raid_boss_point_shop_item_idx}.bind(this));if(-1!=found_log){var remain=this.m_shop_data.max_buy_count-new_raid_boss_shop_buy_log_list[buy_log].user_shop_buy_log[found_log].buy_count;this.m_count>remain&&(this.m_count=remain)}else this.m_count>this.m_shop_data.max_buy_count&&(this.m_count=this.m_shop_data.max_buy_count)}}this.m_count>NEW_RAIDBOSS_ITEM_MAX_COUNT&&(this.m_count=NEW_RAIDBOSS_ITEM_MAX_COUNT),this.updateItemCount()},setMinCount:function(){AudioEngine.getInstance().playEffect(RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3");NetService().get_UserItemInfo_V2();this.m_count=1,this.updateItemCount()},setMaxCount:function(){AudioEngine.getInstance().playEffect(RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3");var myPoint=NewRaidBossService.getInstance().GetBossPoint(BattleContext._getInstance().getNewRaidBossShopPeriodIndex()),new_raid_boss_shop_buy_log_list=NetService().get_new_raid_boss_shop_buy_log_list();if(this.m_count=myPoint/this.m_shop_data.price,0<this.m_shop_data.max_buy_count){this.m_shop_data.max_buy_count;var shop_period=BattleContext._getInstance().getNewRaidBossShopPeriodIndex(),buy_log=new_raid_boss_shop_buy_log_list.findIndex(function(log){return log.new_raid_boss_shop_period_idx==shop_period});if(-1!=buy_log){var found_log=new_raid_boss_shop_buy_log_list[buy_log].user_shop_buy_log.findIndex(function(d){return d.new_raid_boss_shop_period_idx==this.m_shop_data.new_raid_boss_shop_period_idx&&d.new_raid_boss_point_shop_item_idx==this.m_shop_data.new_raid_boss_point_shop_item_idx}.bind(this));this.m_count=-1!=found_log?this.m_shop_data.max_buy_count-new_raid_boss_shop_buy_log_list[buy_log].user_shop_buy_log[found_log].buy_count:this.m_shop_data.max_buy_count}}this.m_count>NEW_RAIDBOSS_ITEM_MAX_COUNT&&(this.m_count=NEW_RAIDBOSS_ITEM_MAX_COUNT),this.updateItemCount()},getCardInfo:function(gnrl_id,info){info.gnrl_id=gnrl_id,info.level=1}}),NEWRAIDBOSSCOLUMN_COUNT=2,NewRaidBossRewardShopLayer=cc.Layer.extend({m_point:null,m_tooltip_box:null,m_tooltip_content:null,m_tooltip_title:null,m_shop_item_count_popup:null,m_item_count_modal_popup:null,m_ShopScene:null,m_selectedItem:[],m_list:[],m_period:null,ctor:function(){this._super(),this.m_list=[],this.init()},init:function(){var m=MasterTable.getInstance(),new_raid_boss_service=NewRaidBossService.getInstance();this.m_period={},this.m_list=m.get_NewRaidBossPointShopItemList(new_raid_boss_service.GetCurrentShopPeriodIdx()),this.m_period.new_raid_boss_shop_period_idx=BattleContext._getInstance().getNewRaidBossShopPeriodIndex(),this.m_list=m.get_NewRaidBossPointShopItemList(this.m_period.new_raid_boss_shop_period_idx),AudioEngine.getInstance().playEffect(RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3"),this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var cSize=cc.size(1e3,520),content_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_base.png",RectZero());content_bg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),content_bg.setPreferredSize(cSize),content_bg.setPosition(.5*ccWidth(this),0),this.addChild(content_bg);var tSize=cc.size(960,410);this.m_table_view=new cc.TableView(this,tSize),this.m_table_view.setDelegate(this),this.m_table_view.ignoreAnchorPointForPosition(!1),this.m_table_view.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_table_view.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_table_view.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_table_view.setPosition(.5*cSize.width,25),content_bg.addChild(this.m_table_view);var point_icon=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_raid2/img_raid2_point.png");point_icon.setScale(.8),point_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),point_icon.setPosition(20,443),content_bg.addChild(point_icon),this.m_point=cmLabelEx.getLabel(cmString(res_str("new_raidboss_point_shop_point_count"),Number(new_raid_boss_service.GetBossPoint(BattleContext._getInstance().getNewRaidBossShopPeriodIndex())).toLocaleString("en")),LABEL_FONT_INDEX.FONT_2671,!1,!0,2,cc.color(0,0,0,255)),this.m_point.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_point.setPosition(98,470),content_bg.addChild(this.m_point);var use_term_img=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_raid2/img_raid2_banner_1.png");return use_term_img.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),use_term_img.setPosition(ccSize(content_bg).width,438),content_bg.addChild(use_term_img),this.m_tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.m_tooltip_box.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_tooltip_box.setPosition(0,cSize.height+17),this.m_tooltip_box.setVisible(!1),this.addChild(this.m_tooltip_box,100),this.m_tooltip_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1810),this.m_tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_tooltip_box.addChild(this.m_tooltip_title),this.m_tooltip_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.m_tooltip_content.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_tooltip_box.addChild(this.m_tooltip_content),this.m_item_count_modal_popup=new GameModalLayer,this.addChild(this.m_item_count_modal_popup,1e3),!0},setShopScene:function(scene){this.m_ShopScene=scene},onEnter:function(){this._super()},onExit:function(){this._super()},tableCellSizeForIndex:function(table,idx){return cc.size(960,140)},cellSizeForTable:function(table){return cc.size(960,140)},tableCellAtIndex:function(tabel,idx){var c=tabel.dequeueCell(),cell=null;cell=null!=c?c:new NewRaidBossRewardShopItemCell(this.buyShopItem.bind(this),this.showTooltip.bind(this));var desc=[],start=idx*NEWRAIDBOSSCOLUMN_COUNT,end=start+NEWRAIDBOSSCOLUMN_COUNT;if(end<this.m_list.length)for(idx=start;idx<end;idx++)desc.push(this.m_list[idx]);else for(idx=start;idx<this.m_list.length;idx++)desc.push(this.m_list[idx]);return cell.setData(desc),cell},numberOfCellsInTableView:function(table){var cnt=Math.floor(this.m_list.length/NEWRAIDBOSSCOLUMN_COUNT);return Math.floor(0<this.m_list.length%NEWRAIDBOSSCOLUMN_COUNT)&&(cnt+=1),cnt},tableCellTouched:function(table,cell){null!=cell&&cell.touchPosInCell(cell.getTouchPos(),cell.getTouchTablePos())},tableCellEnded:function(){},tableCellHighlight:function(table,cell){null!=cell&&cell.highlightPosInCell(cell.getTouchPos(),cell.getTouchTablePos())},tableCellUnhighlight:function(table,cell){null!=cell&&cell.unhighlightPosInCell(cell.getTouchPos(),cell.getTouchTablePos()),this.hideTooltip()},showTooltip:function(data,table_in_pos){if(null!=this.m_table_view){var m=MasterManager.getInstance(),t_pos=this.m_table_view.getPosition(),table_size=ccSize(this.m_table_view);t_pos.x-=.5*table_size.width;var bonus=m.get_BonusType(data.bonus_type),tooltip=MasterTable.getInstance().get_TooltipItem(data.bonus_type);if(""==tooltip.content||null==tooltip.content){var name="";if(bonus.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_ITEM)name=m.get_NewEquipment(data.min_value).name;else if(bonus.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_MAKE_MATERIAL)name=m.get_NewEquipmentMakeMaterial(data.min_value).name;else if(bonus.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_SMELT_MATERIAL)name=m.get_NewEquipmentSmeltMaterial(data.min_value).name;else if(bonus.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_ENHANCE_MATERIAL)name=m.get_NewEquipmentEnhanceMaterial(data.min_value).name;else if(bonus.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_ENCHANT_TICKET)name=m.get_NewEquipmentEnchantTicket(data.min_value).name;else if(bonus.bonus_type==BONUS_TYPE_YUNHEE_FIX){name=m.get_General(data.min_value).name}else name=bonus.name;this.m_tooltip_title.setString(name),this.m_tooltip_title.setAnchorPoint(ANCHOR_MIDDLE()),null==tooltip.content&&(tooltip.content=""),this.m_tooltip_content.setString(tooltip.content);var tSize=ccSize(this.m_tooltip_title);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=MAX(64,tSize.width+20),bSize.height=MAX(54,bSize.height+10),this.m_tooltip_box.setContentSize(bSize),this.m_tooltip_title.setPosition(ccCenter(bSize))}else{this.m_tooltip_title.setString(bonus.name),this.m_tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_tooltip_content.setString(tooltip.content);tSize=ccSize(this.m_tooltip_title);var bSize,cSize=ccSize(this.m_tooltip_content);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=MAX(tSize.width+20,cSize.width+20),bSize.height=MAX(64,bSize.height+cSize.height+5),this.m_tooltip_box.setContentSize(bSize),this.m_tooltip_title.setPosition(10,bSize.height-10),this.m_tooltip_content.setPosition(10,bSize.height-15-tSize.height)}if(null!=this.m_tooltip_box){this.m_tooltip_box.setVisible(!0);var x=table_in_pos.x+120;x<0&&(x=0);var y=table_in_pos.y;y-.5*ccHeight(this.m_tooltip_box)<0&&(y=.5*ccHeight(this.m_tooltip_box)),this.m_tooltip_box.setPosition(t_pos.x+x,t_pos.y+y)}}},hideTooltip:function(){null!=this.m_tooltip_box&&this.m_tooltip_box.setVisible(!1)},selectedItem:function(){return this.m_selectedItem},buyShopItem:function(data){var path=RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3";AudioEngine.getInstance().playEffect(path),this.m_item_count_modal_popup.setContentSize(ccSize(this)),this.m_item_count_modal_popup._contentNode=function(contentSize,m){var layer=new cc.Layer;return null==this.m_shop_item_count_popup&&(this.m_shop_item_count_popup=new NewRaidBossRewardShopItemCountPopup,this.m_shop_item_count_popup.setItemCountCallback(this.cbItemCountPopup.bind(this),this.hideItemCountPopup.bind(this))),this.m_selectedItem=data,this.m_shop_item_count_popup.setShopData(data),this.m_shop_item_count_popup.setPosition(ccCenter(layer)),layer.addChild(this.m_shop_item_count_popup),layer}.bind(this),this.m_item_count_modal_popup.show()},hideItemCountPopup:function(){null!=this.m_shop_item_count_popup&&null!=this.m_shop_item_count_popup.getParent()&&this.m_shop_item_count_popup.removeFromParent(),this.m_item_count_modal_popup.hide()},cbItemCountPopup:function(data,buy_count){this.m_ShopScene.reqBuyItem(data,buy_count)},refreshLayer:function(){var offset=this.m_table_view.getContentOffset();this.m_table_view.reloadData(),this.m_table_view.setContentOffset(offset);var point=NewRaidBossService.getInstance().GetBossPoint(BattleContext._getInstance().getNewRaidBossShopPeriodIndex());this.m_point.setString(cmString(res_str("new_raidboss_point_shop_point_count"),Number(point).toLocaleString("en")))}}),NewRaidBossRewardShopScene=GameScene.extend({m_reward_layer:null,ctor:function(){this._super(scene_NewRaidBossRewardShopScene)},init:function(){var winSize=cc.director.getWinSize(),bg=(BattleContext._getInstance(),cc.Sprite.create(RES_CDN_DEFULT+"new_menu_raid2/bg_raid2_sub.jpg"));IS_SP_BROWSER&&this.setScale(2),bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(winSize)),this.addChild(bg),this.m_reward_layer=new NewRaidBossRewardShopLayer,this.m_reward_layer.setShopScene(this),this.m_reward_layer.setPosition(ccCenter(winSize)),this.m_reward_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.addChild(this.m_reward_layer);var statusLayer=new StatusLayer(INVOKER_TYPE.new_raid_boss);statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_raid2.png");title.setAnchorPoint(ANCHOR_TOP_LEFT()),title.setPosition(94,ccHeight(this)),this.addChild(title);var back_btn=new ccui.Button;return back_btn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png",""),back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(){this.back()}.bind(this)),this.addChild(back_btn),!0},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_NewRaidBossRewardShopScene]),this.playNewRaidBossLobbyBGM()},onExit:function(){this._super()},onEnterTransitionDidFinish:function(){this._super();var new_raid_boss_shop_buy_log_list=NetService().get_new_raid_boss_shop_buy_log_list(),period_idx=BattleContext._getInstance().getNewRaidBossShopPeriodIndex();if(0!=period_idx&&-1==new_raid_boss_shop_buy_log_list.findIndex(function(log){return log.new_raid_boss_shop_period_idx==period_idx})){var req={};req.opcode=net.OP.op_new_raid_boss_shop_buy_log,req.new_raid_boss_shop_period_idx=period_idx,this.network_write(req)}},onNotification:function(msg){return!this._super(msg)},onNetworkEvent:function(opcode,state,body){var res=body;opcode==net.OP.op_new_raid_boss_shop_buy_point_item?res.error!=net.ERROR.NET_E_SUCCESS?res.error==net.ERROR.NET_E_LACK_RAID_POINT||(res.error,net.ERROR.NET_E_OVER_MAX_COUNT):(this.showRewardReceivePopup(res),this.m_reward_layer.refreshLayer()):opcode==net.OP.op_new_raid_boss_shop_buy_log&&this.m_reward_layer.refreshLayer()},back:function(){this.onKeyBack(!0)},showRewardReceivePopup:function(buy_item){var m=MasterManager.getInstance();this.m_box.setTitle(res_str("label_buy_complete"));for(var selectedItem=this.m_reward_layer.selectedItem(),i=0;i<buy_item.buy_items.length;i++){var item=buy_item.buy_items.at(i);switch(item.bonus_type){case BONUS_TYPE_YUNHEE_FIX:var gnrl=m.get_General(item.bonus_idx),name=cmString(res_str("new_raidboss_point_shop_product"),gnrl.name,Number(selectedItem.max_value).toLocaleString("en"));this.m_box.setText(cmString(res_str("label_buy_complete_text_2"),name,Number(buy_item.buy_count).toLocaleString("en")));break;case BONUS_TYPE_NEW_EQUIPMENT_ITEM:var equip=m.get_NewEquipment(item.bonus_idx);name=cmString(res_str("new_raidboss_point_shop_product"),equip.name,Number(selectedItem.max_value).toLocaleString("em"));this.m_box.setText(cmString(res_str("label_buy_complete_text_2"),name,Number(buy_item.buy_count).toLocaleString("en")));break;case BONUS_TYPE_NEW_EQUIPMENT_MAKE_MATERIAL:var mat=m.get_NewEquipmentMakeMaterial(item.bonus_idx);name=cmString(res_str("new_raidboss_point_shop_product"),mat.name,Number(selectedItem.max_value).toLocaleString("en"));this.m_box.setText(cmString(res_str("label_buy_complete_text_2"),name,Number(buy_item.buy_count).toLocaleString("en")));break;case BONUS_TYPE_NEW_EQUIPMENT_ENHANCE_MATERIAL:mat=m.get_NewEquipmentEnhanceMaterial(item.bonus_idx),name=cmString(res_str("new_raidboss_point_shop_product"),mat.name,Number(selectedItem.max_value).toLocaleString("en"));this.m_box.setText(cmString(res_str("label_buy_complete_text_2"),name,Number(buy_item.buy_count).toLocaleString("en")));break;case BONUS_TYPE_NEW_EQUIPMENT_SMELT_MATERIAL:mat=m.get_NewEquipmentSmeltMaterial(item.bonus_idx),name=cmString(res_str("new_raidboss_point_shop_product"),mat.name,Number(selectedItem.max_value).toLocaleString("en"));this.m_box.setText(cmString(res_str("label_buy_complete_text_2"),name,Number(buy_item.buy_count).toLocaleString("en")));break;case BONUS_TYPE_NEW_EQUIPMENT_ENCHANT_TICKET:mat=m.get_NewEquipmentEnchantTicket(item.bonus_idx),name=cmString(res_str("new_raidboss_point_shop_product"),mat.name,Number(selectedItem.max_value).toLocaleString("en"));this.m_box.setText(cmString(res_str("label_buy_complete_text_2"),name,Number(buy_item.buy_count).toLocaleString("en")));break;default:var btype=m.get_BonusType(item.bonus_type);name=cmString(res_str("new_raidboss_point_shop_product"),btype.name,Number(selectedItem.max_value).toLocaleString("en"));this.m_box.setText(cmString(res_str("label_buy_complete_text_2"),name,Number(buy_item.buy_count).toLocaleString("en")))}}this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showErrNotEnoughPoint:function(){MasterTable.getInstance();this.m_box.setTitle(res_str("label_buy_boss_pt_lack_pop_up_title")),this.m_box.setText(res_str("label_buy_boss_pt_lack_pop_up_text")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},reqBuyItem:function(data,buy_count){var currentPoint=NewRaidBossService.getInstance().GetBossPoint(BattleContext._getInstance().getNewRaidBossShopPeriodIndex()),new_raid_boss_shop_buy_log_list=NetService().get_new_raid_boss_shop_buy_log_list();if(0<data.max_buy_count){var currentCount=0,shop_period=BattleContext._getInstance().getNewRaidBossShopPeriodIndex(),buy_log=new_raid_boss_shop_buy_log_list.findIndex(function(log){return log.new_raid_boss_shop_period_idx==shop_period});if(-1!=buy_log){var found_log=new_raid_boss_shop_buy_log_list[buy_log].user_shop_buy_log.findIndex(function(d){return d.new_raid_boss_shop_period_idx==data.new_raid_boss_shop_period_idx&&d.new_raid_boss_point_shop_item_idx==data.new_raid_boss_point_shop_item_idx&&d.sub_id==data.min_value});currentCount=-1!=found_log?data.max_buy_count-new_raid_boss_shop_buy_log_list[buy_log].user_shop_buy_log[found_log].buy_count:data.max_buy_count}else currentCount=data.max_buy_count;if((currentCount-=buy_count)<0){var msg=[];return msg.push_back(res_str("Over Buy Max Count")),void this.showMsgBox("INFOMATION",msg)}}if(currentPoint<data.price*buy_count)this.showErrNotEnoughPoint();else{var req={};req.opcode=net.OP.op_new_raid_boss_shop_buy_point_item,req.new_raid_boss_shop_period_idx=data.new_raid_boss_shop_period_idx,req.new_raid_boss_point_shop_item_idx=data.new_raid_boss_point_shop_item_idx,req.buy_count=buy_count,this.network_write(req)}},playNewRaidBossLobbyBGM:function(){var bgm=MasterTable.getInstance().get_Bgm_v2(BGM_TYPE_NEW_RAID_BOSS_LOBBY_BGM),audio=AudioEngine.getInstance(),new_raid_bgm=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm.sound_file_name;audio.m_bgmPath!=new_raid_bgm&&(audio.stopBackgroundMusic(),audio.playBackgroundMusic(new_raid_bgm,!0))}}),NewRaidPartInUserListCell=cc.TableViewCell.extend({m_list_bg:null,m_friend_img:null,m_gnrl_img:null,m_perLabel:null,m_dmgLabel:null,m_NickNameLabel:null,ctor:function(){this._super(),this.init()},init:function(){var cellSize=cc.size(596,144);return this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(cellSize),this.m_list_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_5.png",RectZero()),this.m_list_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_list_bg.setPosition(ccCenter(cellSize)),this.m_list_bg.setContentSize(cellSize),this.addChild(this.m_list_bg),this.setContentSize(ccSize(this.m_list_bg)),this.m_friend_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_friend/img_friend_text_2.png"),this.m_friend_img.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_friend_img.setPosition(118,99),this.m_list_bg.addChild(this.m_friend_img),this.m_friend_img.setVisible(!1),this.m_perLabel=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.m_perLabel.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_perLabel.setPosition(118,50),this.m_list_bg.addChild(this.m_perLabel),this.m_dmgLabel=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.m_dmgLabel.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_dmgLabel.setPosition(118,73),this.m_list_bg.addChild(this.m_dmgLabel),this.m_NickNameLabel=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.m_NickNameLabel.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_list_bg.addChild(this.m_NickNameLabel),!0},setData:function(data,maxHp){this.m_data=data,this.m_maxHp=maxHp,this.updateCell()},updateCell:function(){MasterTable.getInstance(),m_user_id;var fPer=this.m_data.accum_damage/this.m_maxHp;this.m_perLabel.setString(cmString(res_str("new_raidboss_standby_entry_pop_up_reward_info"),cmString("%.1f",100*fPer))),this.m_dmgLabel.setString(cmString(res_str("new_raidboss_standby_entry_pop_up_damage"),Number(this.m_data.accum_damage).toLocaleString("en"))),this.m_NickNameLabel.setString(this.m_data.nickname),this.m_data.user_id!=m_user_id&&"y"==this.m_data.friend_yn?(this.m_friend_img.setVisible(!0),this.m_NickNameLabel.setPosition(221,99)):(this.m_friend_img.setVisible(!1),this.m_NickNameLabel.setPosition(118,99)),null!=this.m_gnrl_img&&this.m_gnrl_img.removeFromParent();var card={};card.gnrl_id=this.m_data.partner_gnrl_id,card.limit_step_id=this.m_data.partner_limit_step_id,card.level=this.m_data.partner_gnrl_lv,card.love_level=this.m_data.partner_love_lv,this.m_gnrl_img=(new Card).createCard(card,CARD_TYPE.type_common_card),this.m_gnrl_img.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_gnrl_img.setPosition(10,23),this.m_list_bg.addChild(this.m_gnrl_img)},highlightPosInCell:function(pos){},unhighlightPosInCell:function(pos){},touchPosInCell:function(pos){}});