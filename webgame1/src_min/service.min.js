var ShopService,CampService,HelpService,DailyDungeonService,UserService=function(){function UserService(){}var instance;return UserService.prototype.setGameState=function(state){null!=m_user_id&&""!=m_user_id||alert("setGameState : use_id 미리 load 되어 있지 않다 user_id: "+m_user_id),db.upd_GameState(m_user_id,state)},UserService.prototype.getUserFormationPropertyPointInfo=function(){return db.sel_UserFormationPropertyPointInfo()},UserService.prototype.getUserEvolveArmServiceMtrl=function(){return NetService().get_user_map_User_Evolve_Arm_Service_Mtrl()},UserService.prototype.getUserLevelInfo=function(user_level){return MasterManager.getInstance().get_UserLevel(user_level)},UserService.prototype.getUserLevelPrcnt=function(){var accm_exp,need_exp,next_level,crrnt_exp,prcnt=0,data=NetService().get_User_info();next_level=data.user_level+1,crrnt_exp=data.user_exp;var userLevel=MasterManager.getInstance().get_UserLevel(next_level);return accm_exp=userLevel.accm_exp,0!=(need_exp=userLevel.need_exp)&&(prcnt=(need_exp-(accm_exp-crrnt_exp))/need_exp),prcnt},UserService.prototype.getUserEventPoint=function(marathon_period_idx,point){},UserService.prototype.getEventLoginBonusMaxCount=function(event_login_id){var m_login_bonus=MasterManager.getInstance().get_AllLoginBonus(),login_list=[];return m_login_bonus.map(function(login_bonus){login_bonus.login_id==event_login_id&&login_bonus.login_bonus_type==LOGIN_BONUS_TYPE_EVENT&&login_list.push(login_bonus)}),login_list.sort(function(r,l){return l.login_count-r.login_count}),login_list[0].login_count},UserService.prototype.updateUserItemHeart=function(heart){},UserService.prototype.updateUserItemFood=function(user_food){},UserService.prototype.updateUserItemEventDungeonPoint=function(event_point,accum_event_point,event_dungeon_period_idx){var m_user_event_dungeon_point=NetService().get_user_event_dungeon_point(),user_event_dungeon_point=m_user_event_dungeon_point.at([m_user_id,event_dungeon_period_idx]);if(null!=user_event_dungeon_point)user_event_dungeon_point.event_point=event_point,user_event_dungeon_point.accum_event_point=accum_event_point,m_user_event_dungeon_point.insert([m_user_id,event_dungeon_period_idx],user_event_dungeon_point);else{var data=new Object;data.event_dungeon_period_idx=event_dungeon_period_idx,data.event_point=event_point,data.accum_event_point=accum_event_point,m_user_event_dungeon_point.insert([m_user_id,data.event_dungeon_period_idx],data)}},UserService.prototype.updateUserItemEventPoint=function(marathon_point,marathon_period_idx){},UserService.prototype.getNextLevelCampClass=function(camp_class){},UserService.prototype.getBadname=function(badnames){},UserService.prototype.getBadWord=function(badwords){},UserService.prototype.getChatServerInfo=function(server_ip,port,room_id){},UserService.prototype.getChangeRoomInfo=function(room_id,server_ip,port){},UserService.prototype.getLoginBonusInfo=function(login_bonus_type,login_bonus_list,login){var login_id=1;null!=login&&(login_id=login);var m_login_bonus=MasterManager.getInstance().get_AllLoginBonus();m_login_bonus.map(function(login_bonus){if(login_bonus.login_id==login_id&&login_bonus.login_bonus_type==login_bonus_type&&-1==login_bonus_list.findIndex(function(obj){return obj.login_count==login_bonus.login_count})){var bonus={login_bonus_items:[]};bonus.login_id=login_bonus.login_id,bonus.login_count=login_bonus.login_count,bonus.bonus_type=login_bonus.bonus_type,bonus.login_bonus_type=login_bonus.login_bonus_type,bonus.bonus_count=login_bonus.bonus_count,bonus.today_text=login_bonus.today_text,bonus.tomorrow_text=login_bonus.tomorrow_text,login_bonus_list.push(bonus)}});for(var idx=0;idx<login_bonus_list.length;idx++){var bonus=login_bonus_list[idx];m_login_bonus.map(function(login_bonus){if(login_bonus.login_id==bonus.login_id&&login_bonus.login_bonus_type==bonus.login_bonus_type&&login_bonus.login_count==bonus.login_count){var item={};item.login_bonus_idx=login_bonus.login_bonus_idx,item.bonus_type=login_bonus.bonus_type,item.bonus_count=login_bonus.bonus_count,item.item_id=login_bonus.item_id,item.img=login_bonus.img,bonus.login_bonus_items.push_back(item)}})}},UserService.prototype.getNoticeList=function(notice_list){for(var map_notice=(new NetService).get_AllNotice(),keys=map_notice.keys(),idx=keys.length-1;0<=idx;idx--)notice_list.push($.extend({},map_notice.at(keys[idx])))},UserService.prototype.getNoticeByBanner=function(banner_type){return{num:0,notice_type:0,gm_notice_type:0,subject:"",subject_color:0,icon_type:0,display_order:0,banner_type:0,begin_dt:""}},UserService.prototype.IsPrologueComplete=function(){var prolog=NetService().get_map_user_prologue_v2().at(m_user_id);return null!=prolog&&"y"==prolog},UserService.prototype.getUserJadeFirstBuyInfo=function(user_info_list){},UserService.prototype.isCompleteJadeFirstBuyAll=function(login_count){for(var user_buy_info_list=NetService().get_User_Jade_First_Buy_Log(),idx=0;idx<user_buy_info_list.length;idx++)if("n"==user_buy_info_list[idx].buy_yn)return!1;return!0},UserService.prototype.isCompteteEventLoginBonus=function(login_count){},UserService.prototype.getUserEvolutionEvent=function(gnrl_key,state_type,complete_yn){},UserService.prototype.getUserDailyBonus=function(){return $.Deferred()},UserService.prototype.isNewDailyBonus=function(user_daily_bonus_list){for(var i=0;i<user_daily_bonus_list.length;i++)if("y"==user_daily_bonus_list[i].enable_yn)return!0;return!1},UserService.prototype.getUserGachaTicketCount=function(shop_id){return NetService().get_User_Gacha_ticket(shop_id)},UserService.prototype.getUserBeginnerBooster=function(booster_info){if(null!=booster_info)return booster_info.complete_yn="y",booster_info.user_level=0,null!=(beginner_booster=NetService().get_user_beginner_booster().at(m_user_id))&&(booster_info.complete_yn=beginner_booster.complete_yn,booster_info.user_level=beginner_booster.user_level,booster_info.deadline_dt=beginner_booster.deadline_dt),booster_info;var beginner_booster,info={complete_yn:"y",user_level:0};return null!=(beginner_booster=NetService().get_user_beginner_booster().at(m_user_id))&&(info.complete_yn=beginner_booster.complete_yn,info.user_level=beginner_booster.user_level,info.deadline_dt=beginner_booster.deadline_dt),"y"!=info.complete_yn},UserService.prototype.getMtBeginnerBooster=function(booster_type,gain_type,consume_type){for(var mt_booster={},m_user_beginner_booster=MasterManager.getInstance().get_AllBeginnerBooster(),idx=0;idx<m_user_beginner_booster.length;idx++){var booster=m_user_beginner_booster.at(idx);booster_type==booster.booster_type&&gain_type==booster.gain_increase_type&&consume_type==booster.consume_decrease_type&&"y"==booster.use_yn&&(mt_booster.battle_type=booster.battle_type,mt_booster.battle_booster_type=booster.battle_booster_type,mt_booster.value=booster.value,mt_booster.booster_type=booster_type,mt_booster.gain_increase_type=gain_type,mt_booster.consume_decrease_type=consume_type)}return mt_booster},UserService.prototype.isBeginnerBooster=function(){return this.getUserBeginnerBooster()},UserService.prototype.getUserNamingInfo=function(){for(var map_user_naming=NetService().get_user_naming(),keys=map_user_naming.keys(),info_list=[],idx=0;idx<keys.length;idx++){var info={},user_naming=map_user_naming.at(keys[idx]);info.naming_id=user_naming.naming_id,info.position=user_naming.position,info.use_yn=user_naming.use_yn,info.create_dt=user_naming.create_dt;var mt_naming=MasterManager.getInstance().get_Naming(info.naming_id);info.naming_type=mt_naming.naming_type,info.level=mt_naming.level,info.name=mt_naming.name,info_list.push_back(info)}return info_list=stable(info_list,function(l,r){return moment(r.create_dt,["MM/DD/YYYY hh:mm:ss a"]).valueOf()-moment(l.create_dt,["MM/DD/YYYY hh:mm:ss a"]).valueOf()}.bind(this))},UserService.prototype.getConstructUserNaming=function(){for(var naming_info_list=this.getUserNamingInfo(),naming1="",naming2="",naming3="",mt=MasterManager.getInstance(),list_cnt=naming_info_list.length,i=0;i<list_cnt;i++)"y"==naming_info_list[i].use_yn&&(""==naming1&&1==(1&naming_info_list[i].position)&&(naming1=mt.get_Naming(naming_info_list[i].naming_id).name),""==naming2&&1==(naming_info_list[i].position>>1&1)&&(naming2=mt.get_Naming(naming_info_list[i].naming_id).name),""==naming3&&1==(naming_info_list[i].position>>2&1)&&(naming3=mt.get_Naming(naming_info_list[i].naming_id).name));return naming1+naming2+naming3},UserService.prototype.isEnoughYunheeBound=function(){var mt=MasterManager.getInstance(),gnrls=[];NetService().getUserGeneral(gnrls);var yunhee_count=0;gnrls.forEach(function(g){var mt_gnrl=mt.get_General(g.gnrl_id);mt_gnrl.gnrl_type!=GENERAL_TYPE_YUNHEE&&mt_gnrl.gnrl_type!=GENERAL_TYPE_SOLDIER||yunhee_count++});var yunhee_bound;return!((yunhee_bound=NetService().get_user_yunhee_bound())<=yunhee_count||yunhee_bound<=0)},UserService.prototype.isEnoughMaterialBound=function(){var mt=MasterManager.getInstance(),gnrls=[];NetService().getUserGeneral(gnrls);var material_count=0;return gnrls.forEach(function(g){var mt_gnrl=mt.get_General(g.gnrl_id);mt_gnrl.gnrl_type!=GENERAL_TYPE_MATERIAL&&mt_gnrl.gnrl_type!=GENERAL_TYPE_LIMIT_OVER||material_count++}),!(NetService().get_user_yunhee_bound()<=material_count)},UserService.prototype.updateUserLoginBonus=function(login_bonus_list){for(var mt=MasterManager.getInstance(),idx=0;idx<login_bonus_list.length;idx++){var login_mng=mt.get_LoginBonusManagement(login_bonus_list[idx].event_login_id,LOGIN_BONUS_TYPE_EVENT);login_bonus_list[idx].sort_num=login_mng.sort_num}},{getInstance:function(){return void 0===instance&&(instance=new UserService),instance}}}(),GachaKey=cc.Class.extend({gacha_tab_type:0,gacha_num:0}),GachaBonusInfo=cc.Class.extend({max_count:0,bonus_type:0,bonus_count:0});function MussangService(){var Instance;return(MussangService=function(){return Instance}).prototype=this,(Instance=new MussangService).constructor=MussangService(),Instance.getUserMussangInfo=function(mussangType){for(var mussangInfo=NetService().get_User_Mussang_Info(),list=[],info_length=mussangInfo.length,i=0;i<info_length;i++)if(mussangInfo[i].mussang_type==mussangType){var mussangPeriod=MasterManager.getInstance().get_MussangPeriod(mussangInfo[i].mussang_type,mussangInfo[i].period_group_idx,mussangInfo[i].period_idx);list.complete_yn=mussangInfo[i].complete_yn,list.current_step=mussangInfo[i].current_step,list.mussang_type=mussangInfo[i].mussang_type,list.period_group_idx=mussangInfo[i].period_group_idx,list.period_idx=mussangInfo[i].period_idx,list.beg_dt=mussangPeriod.beg_dt,list.end_dt=mussangPeriod.end_dt,list.event_yn=mussangPeriod.event_yn,list.event_comment=mussangPeriod.event_comment,list.mussang_bonus_group=mussangPeriod.mussang_bonus_group,list.max_step=mussangPeriod.max_step;break}return list},Instance.getMussangStepInfo=function(stepList,user_mussang){for(var m_Mussang=MasterManager.getInstance().get_AllMussangPeriod(),max_peiod=0,idx=m_Mussang.length-1;0<=idx;idx--)if(m_Mussang[idx].period_group_idx==user_mussang.period_group_idx&&m_Mussang[idx].period_idx==user_mussang.period_idx){max_peiod=m_Mussang[idx].max_step;break}var m_mussang_step=MasterManager.getInstance().get_AllMussangStep(),step_length=m_mussang_step.length;for(idx=0;idx<step_length;idx++)if(m_mussang_step[idx].mussang_type==user_mussang.mussang_type&&m_mussang_step[idx].period_group_idx==user_mussang.period_group_idx&&m_mussang_step[idx].mussang_step<=max_peiod){var step_obj={};step_obj.mussang_id=m_mussang_step[idx].mussang_id,step_obj.mussang_type=m_mussang_step[idx].mussang_type,step_obj.mussang_step=m_mussang_step[idx].mussang_step,step_obj.need_key=m_mussang_step[idx].need_key,step_obj.need_ticket=m_mussang_step[idx].need_ticket,step_obj.period_group_idx=user_mussang.period_group_idx,stepList.push(step_obj)}return stepList},Instance.getMussangBonusItems=function(mussangId,bonusGroup){for(var m_bonuss_item=MasterManager.getInstance().get_All_MussangBonusItem(),bonusList=[],item_length=m_bonuss_item.length,idx=0;idx<item_length;idx++)if(m_bonuss_item[idx].mussang_id==mussangId&&m_bonuss_item[idx].mussang_bonus_group==bonusGroup){var bonusItem={};bonusItem.mussang_id=m_bonuss_item[idx].mussang_id,bonusItem.mussang_bonus_group=m_bonuss_item[idx].mussang_bonus_group,bonusItem.num=m_bonuss_item[idx].num,bonusItem.bonus_type=m_bonuss_item[idx].bonus_type,bonusItem.min_value=m_bonuss_item[idx].min_value,bonusItem.max_value=m_bonuss_item[idx].max_value,bonusItem.bonus_gain_rate=m_bonuss_item[idx].bonus_gain_rate,bonusList.push(bonusItem)}return bonusList},Instance.getMussangBonusLists=function(user_mussang){for(var bonusList=[],m_Mussang=MasterManager.getInstance().get_AllMussangPeriod(),max_step=0,idx=m_Mussang.length-1;0<=idx;idx--)if(m_Mussang[idx].period_group_idx==user_mussang.period_group_idx&&m_Mussang[idx].period_idx==user_mussang.period_idx){max_step=m_Mussang[idx].max_step;break}var mussang_id="",m_mussang_step=MasterManager.getInstance().get_AllMussangStep(),step_length=m_mussang_step.length;for(idx=0;idx<step_length;idx++)if(m_mussang_step[idx].mussang_type==user_mussang.mussang_type&&m_mussang_step[idx].period_group_idx==user_mussang.period_group_idx&&m_mussang_step[idx].mussang_step==max_step){mussang_id=m_mussang_step[idx].mussang_id;break}var m_bonuss_item=MasterManager.getInstance().get_All_MussangBonusItem(),item_length=m_bonuss_item.length;for(idx=0;idx<item_length;idx++)if(m_bonuss_item[idx].mussang_id<=mussang_id&&m_bonuss_item[idx].mussang_bonus_group==user_mussang.mussang_bonus_group){var bonusItem={};bonusItem.mussang_id=m_bonuss_item[idx].mussang_id,bonusItem.mussang_bonus_group=m_bonuss_item[idx].mussang_bonus_group,bonusItem.num=m_bonuss_item[idx].num,bonusItem.bonus_type=m_bonuss_item[idx].bonus_type,bonusItem.min_value=m_bonuss_item[idx].min_value,bonusItem.max_value=m_bonuss_item[idx].max_value,bonusItem.bonus_gain_rate=m_bonuss_item[idx].bonus_gain_rate,bonusList.push(bonusItem)}return bonusList},Instance.getMussangNpcGeneralLists=function(mussangId){for(var m_mussang_npc=MasterManager.getInstance().get_AllMussangNpc(),npcGnrlList=[],npc_length=m_mussang_npc.length,idx=0;idx<npc_length;idx++){var m_npc=m_mussang_npc[idx];if(null!=m_npc.mussang_id&&m_npc.mussang_id==mussangId){var npc_gnrl={};0!=m_npc.npc1_id&&((npc_gnrl={}).npc_id=m_npc.npc1_id,npc_gnrl.npc_size=m_npc.npc1_size,npcGnrlList.push(npc_gnrl)),0!=m_npc.npc2_id&&((npc_gnrl={}).npc_id=m_npc.npc2_id,npc_gnrl.npc_size=m_npc.npc2_size,npcGnrlList.push(npc_gnrl)),0!=m_npc.npc3_id&&((npc_gnrl={}).npc_id=m_npc.npc3_id,npc_gnrl.npc_size=m_npc.npc3_size,npcGnrlList.push(npc_gnrl)),0!=m_npc.npc4_id&&((npc_gnrl={}).npc_id=m_npc.npc4_id,npc_gnrl.npc_size=m_npc.npc4_size,npcGnrlList.push(npc_gnrl)),0!=m_npc.npc5_id&&((npc_gnrl={}).npc_id=m_npc.npc5_id,npc_gnrl.npc_size=m_npc.npc5_size,npcGnrlList.push(npc_gnrl))}}return npcGnrlList},Instance.getMussangTowerMainStepBonusItems=function(mussang_tower_Id,bonusList){var main_bonus_mussang_tower_Id=0,mussang_tower_bonus_Idx=0,mussang_tower_period_info={};Instance.getCurrentMussangTowerPeriod(mussang_tower_period_info);for(var m_mussang_tower_step=MasterManager.getInstance().get_AllMussangTowerStep(),m_mussang_tower_bonus_first_clear_item=MasterManager.getInstance().get_AllMussangTowerBonusFirstClearItem(),tower_step_length=m_mussang_tower_step.length,i=0;i<tower_step_length;i++)if(m_mussang_tower_step[i].mussang_tower_id>mussang_tower_Id&&m_mussang_tower_step[i].step<=mussang_tower_period_info.max_step&&"y"==m_mussang_tower_step[i].main_step_yn){main_bonus_mussang_tower_Id=null==m_mussang_tower_step[i].mussang_tower_id?0:m_mussang_tower_step[i].mussang_tower_id,mussang_tower_bonus_Idx=null==m_mussang_tower_step[i].bonus_idx?0:m_mussang_tower_step[i].bonus_idx;break}for(var bonusItem=null,clear_item_length=m_mussang_tower_bonus_first_clear_item.length,j=0;j<clear_item_length;j++)m_mussang_tower_bonus_first_clear_item[j].mussang_tower_bonus_idx==mussang_tower_bonus_Idx&&((bonusItem={}).mussang_tower_bonus_idx=m_mussang_tower_bonus_first_clear_item[j].mussang_tower_bonus_idx,bonusItem.num=m_mussang_tower_bonus_first_clear_item[j].num,bonusItem.bonus_type=m_mussang_tower_bonus_first_clear_item[j].bonus_type,bonusItem.min_value=m_mussang_tower_bonus_first_clear_item[j].min_value,bonusItem.max_value=m_mussang_tower_bonus_first_clear_item[j].max_value,bonusItem.gain_rate=0,bonusItem.bonus_name=MasterManager.getInstance().get_BonusType(bonusItem.bonus_type).name,bonusList.push(bonusItem));return main_bonus_mussang_tower_Id},Instance.getMussangTowerBonusItems=function(mussang_tower_Id){for(var tower_reward_info={current_step:0,bonus_list:[],fist_clear_bonus_list:[]},m_mussang_tower_step=MasterManager.getInstance().get_AllMussangTowerStep(),mussang_tower_bonus_Idx=0,tower_step_length=m_mussang_tower_step.length,i=0;i<tower_step_length;i++)if(m_mussang_tower_step[i].mussang_tower_id==mussang_tower_Id){mussang_tower_bonus_Idx=m_mussang_tower_step[i].bonus_idx;break}for(var m_mussang_tower_bonus_first_clear_item=MasterManager.getInstance().get_AllMussangTowerBonusFirstClearItem(),clear_item_length=m_mussang_tower_bonus_first_clear_item.length,j=0;j<clear_item_length;j++)if(m_mussang_tower_bonus_first_clear_item[j].mussang_tower_bonus_idx==mussang_tower_bonus_Idx){var bonusItem={};bonusItem.mussang_tower_bonus_idx=m_mussang_tower_bonus_first_clear_item[j].mussang_tower_bonus_idx,bonusItem.num=m_mussang_tower_bonus_first_clear_item[j].num,bonusItem.bonus_type=m_mussang_tower_bonus_first_clear_item[j].bonus_type,bonusItem.min_value=m_mussang_tower_bonus_first_clear_item[j].min_value,bonusItem.max_value=m_mussang_tower_bonus_first_clear_item[j].max_value,bonusItem.gain_rate=0,tower_reward_info.fist_clear_bonus_list.push(bonusItem)}return $.extend({},tower_reward_info)},Instance.getCurrentMussangTowerPeriod=function(mussang_tower_period){for(var valid_period=!1,period_list=MasterTable.getInstance().get_MussangTowerPeriodList(),now=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),list_length=period_list.length,i=0;i<list_length;i++){var period=period_list[i],beg_dt=moment(period.beg_dt).valueOf(),end_dt=moment(period.end_dt).valueOf();beg_dt<=now&&now<=end_dt&&(mussang_tower_period.period_idx=period.period_idx,mussang_tower_period.beg_dt=period.beg_dt,mussang_tower_period.end_dt=period.end_dt,mussang_tower_period.max_step=period.max_step,valid_period=!0)}return valid_period},Instance.checkNewMussangTowerLotusReward=function(){var is_new=!1,tower_period={};if(this.getCurrentMussangTowerPeriod(tower_period))for(var m_user_task_lotus_log=NetService().getUserMussangTowerLotusLog(),keys=m_user_task_lotus_log.keys(),i=0;i<keys.length;i++)if(m_user_task_lotus_log.at(keys[i]).period_idx==tower_period.period_idx&&"y"==m_user_task_lotus_log.at(keys[i]).new_yn){is_new=!0;break}return is_new},Instance.getCurrentUserMussangTowerId=function(){for(var tower_list=NetService().getUserMussangTower(),key=tower_list.keys(),key_length=key.length,tower_id=0,i=0;i<key_length;i++)"y"==tower_list.at(key[i]).complete_yn&&tower_id<=tower_list.at(key[i]).mussang_tower_id&&(tower_id=tower_list.at(key[i]).mussang_tower_id);return tower_id},Instance.getNextChallengeMussangTowerId=function(mussang_tower_id){for(var next_mussang_tower_id=0,m_mussang_tower_step=MasterManager.getInstance().get_AllMussangTowerStep(),step_id=1e5,step_length=m_mussang_tower_step.length,i=0;i<step_length;i++)m_mussang_tower_step[i].mussang_tower_id>mussang_tower_id&&step_id>=m_mussang_tower_step[i].mussang_tower_id&&(step_id=m_mussang_tower_step[i].mussang_tower_id);if(1e5!=step_id&&(next_mussang_tower_id=step_id),0<next_mussang_tower_id){var tower_info=MasterManager.getInstance().get_MussangTowerStep(next_mussang_tower_id),mussang_tower_period_info={};Instance.getCurrentMussangTowerPeriod(mussang_tower_period_info),0<mussang_tower_period_info.period_idx&&tower_info.step>mussang_tower_period_info.max_step&&(next_mussang_tower_id-=tower_info.step-mussang_tower_period_info.max_step)}return next_mussang_tower_id},Instance.getUserMussangTowerList=function(period,list){var m=MasterTable.getInstance(),bs=BattleService.getInstance(),tower_list=m.get_MussangTowerStepList(period.max_step),is_complete_yn=!0,current_mussang_tower_id=this.getCurrentUserMussangTowerId();0==current_mussang_tower_id&&(current_mussang_tower_id=tower_list[tower_list.length-1].mussang_tower_id,is_complete_yn=!1);var next_mussang_tower_id=0;is_complete_yn&&(next_mussang_tower_id=this.getNextChallengeMussangTowerId(current_mussang_tower_id));for(var list_length=tower_list.length,i=0;i<list_length;i++){var t=tower_list[i],tower=new database.BattleMussangTower;tower.mussang_tower_id=t.mussang_tower_id,tower.mussang_tower=t,tower.step=t.step,tower.tower_bonus.current_step=t.step,tower.is_selected=!1,tower.mussang_tower_id<=current_mussang_tower_id?(tower.is_complete=is_complete_yn,tower.is_enable=!0,is_complete_yn?tower.mussang_tower_id==next_mussang_tower_id&&(tower.is_selected=!0):tower.is_selected=tower.mussang_tower_id==current_mussang_tower_id):is_complete_yn&&next_mussang_tower_id==tower.mussang_tower_id&&(tower.is_enable=!0,tower.is_selected=!0);var bonus_list=m.get_MussangTowerBonusFirstClearItemList(tower.mussang_tower.bonus_idx);tower.tower_bonus.fist_clear_bonus_list=[],bonus_list.forEach(function(b){var item={};item.mussang_tower_bonus_idx=b.mussang_tower_bonus_idx,item.num=b.num,item.bonus_type=b.bonus_type,item.min_value=b.min_value,item.max_value=b.max_value,item.gain_rate=0,tower.tower_bonus.fist_clear_bonus_list.push_back(item)}),tower.task_list=bs.getMussangTowerTaskListCheck(tower.mussang_tower.mussang_tower_id),list.push_back(tower)}},Instance}ShopService=function(){function ShopService(){return{getShopJadeInfoList:function(list){for(var shopList=MasterTable.getInstance().get_Shops(),i=0;i<shopList.length;i++)shopList[i].shop_type==SHOP_TYPE_JADE&&"Y"==shopList[i].display_yn&&list.push(shopList[i]);return shopList=null,list},getShopChargeInfoList:function(list){var user_buy_info_list={};UserService.getInstance();user_buy_info_list=NetService().get_User_Jade_First_Buy_Log();for(var m=MasterTable.getInstance(),firstList=m.get_ShopJadeFirstBuy(),normalList=m.get_ShopJadeNormalBuy(),i=1;i<firstList.length;i++)for(var j=0;j<user_buy_info_list.length;j++)firstList[i].shop_id==user_buy_info_list[j].shop_id&&("y"==user_buy_info_list[j].buy_yn?list.push(normalList[firstList[i].gacha_num]):"n"==user_buy_info_list[j].buy_yn&&list.push(firstList[i]));return user_buy_info_list=normalList=firstList=null,list},getShopYunheePTInfoList:function(list){for(var shopList=MasterTable.getInstance().get_Shops(),i=0;i<shopList.length;i++)shopList[i].shop_type==SHOP_TYPE_YUNHEE_PT&&"Y"==shopList[i].display_yn&&list.push(shopList[i]);return shopList=null,list=stable(list,function(l,r){return l.gacha_num>r.gacha_num})},getShopEventList:function(list){for(var shopList=MasterTable.getInstance().get_Shops(),i=0;i<shopList.length;i++)shopList[i].shop_type==SHOP_TYPE_EVENT&&"Y"==shopList[i].display_yn&&this.IsOpenShopEvent(shopList[i].sell_period_group)&&list.push(shopList[i]);return shopList=null,list},getShopHeavenPtList:function(list){for(var shopList=MasterTable.getInstance().get_Shops(),i=0;i<shopList.length;i++)shopList[i].shop_type==SHOP_TYPE_HEAVEN_PT&&"Y"==shopList[i].display_yn&&list.push(shopList[i]);return shopList=null,list},getShopGachaInfoList:function(list){for(var m=MasterTable.getInstance(),shopList=m.get_Shops(),now=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)),i=0;i<shopList.length;i++)if(shopList[i].shop_type==SHOP_TYPE_GACHA&&"Y"==shopList[i].display_yn)if(0!=shopList[i].sell_period_group&&99!=shopList[i].sell_period_group){var period=m.get_ShopPeriod(shopList[i].sell_period_group),n=moment(now).valueOf(),b=moment(period[0].beg_dt).valueOf(),e=moment(period[0].end_dt).valueOf();b<=n&&n<=e&&list.push_back(shopList[i])}else list.push_back(shopList[i]);return shopList=null,list},getShopGachaInfoList_v2:function(gacha_map){var shopList=MasterTable.getInstance().get_Shops();for(var shop in shopList)if(shop.shop_type==SHOP_TYPE_GACHA){var key=new GachaKey;key.gacha_tab_type=shop.gacha_type,key.gacha_num=shop.gacha_num,gacha_map[key].push(shop)}shopList=null},getShopInfo:function(shop_id){for(var shopList=MasterTable.getInstance().get_Shops(),info=[],i=0;i<shopList.length;i++)if(shop_id==shopList[i].shop_id){info=shopList[i];break}return shopList=null,info},getShopList:function(){return MasterTable.getInstance().get_Shops()},getDisplayShopList:function(){for(var shop_list=MasterTable.getInstance().get_Shops(),list=[],i=0;i<shop_list.length;i++)"Y"==shop_list[i].display_yn&&list.push_back(shop_list[i]);return shopList=null,list},getGachaBonusCount:function(bonus_info){var gacha_buy_bonus=MasterManager.getInstance().get_ShopGachaBuyBonus(100);bonus_info.max_count=gacha_buy_bonus.gacha_buy_max,bonus_info.bonus_type=gacha_buy_bonus.gacha_buy_bonus_type,bonus_info.bonus_count=gacha_buy_bonus.gacha_buy_bonus_count},IsGachaPickupGnrlExist:function(shop_id){var is_exist=!1,m=MasterManager.getInstance(),shop_data=m.get_Shop(shop_id),gacha_data=m.get_Gacha(shop_data.gacha_id),new_list=MasterTable.getInstance().get_GachaNewYunheeList(gacha_data.gacha_id);return 0<new_list.length&&(is_exist=!0),new_list=null,is_exist},getOneUserOneTimeFreeGachaLineupYunheeList:function(shop_id){for(var m=MasterManager.getInstance(),mt=MasterTable.getInstance(),gnrl_list=[],free_gacha=m.get_OneUserOneTimeFreeGacha(shop_id),group_random_list=mt.get_GachaGroupRandomIds(free_gacha.base_gacha_group_idx),random_general_list=[],new_list=mt.get_OneUserOneTimeFreeGachaGnrlList(free_gacha.one_user_one_time_free_gacha_new_gnrl_idx),i=0;i<group_random_list.length;i++){random_general_list=mt.get_GachaRandomGeneralList(group_random_list[i].gacha_random_id);for(var j=0;j<random_general_list.length;j++){var gnrl=m.get_General(random_general_list[j].gnrl_id),info={};info.gnrl_id=gnrl.gnrl_id,info.rare_type=gnrl.rare_type,info.arm_service_type=gnrl.arm_service_type,info.gnrl_class=gnrl.gnrl_class,info.gnrl_group=gnrl.gnrl_group,info.gnrl_type=gnrl.gnrl_type;for(var k=info.new_yunhee=0;k<new_list.length;k++)if(new_list[k].gnrl_id==info.gnrl_id){info.new_yunhee=1;break}gnrl_list.push(info)}}return gnrl_list},getOneDayOneTimeFreeGachaLineupYunheeList:function(shop_id){for(var m=MasterManager.getInstance(),mt=MasterTable.getInstance(),gnrl_list=[],free_gacha=m.get_OneDayOneTimeFreeGacha(shop_id),group_random_list=mt.get_GachaGroupRandomIds(free_gacha.base_gacha_group_idx),random_general_list=[],new_list=mt.get_OneDayOneTimeFreeGachaGnrlList(free_gacha.one_day_one_time_free_gacha_new_gnrl_idx),i=0;i<group_random_list.length;i++){random_general_list=mt.get_GachaRandomGeneralList(group_random_list[i].gacha_random_id);for(var j=0;j<random_general_list.length;j++){var gnrl=m.get_General(random_general_list[j].gnrl_id),info={};info.gnrl_id=gnrl.gnrl_id,info.rare_type=gnrl.rare_type,info.arm_service_type=gnrl.arm_service_type,info.gnrl_class=gnrl.gnrl_class,info.gnrl_group=gnrl.gnrl_group,info.gnrl_type=gnrl.gnrl_type;for(var k=info.new_yunhee=0;k<new_list.length;k++)if(new_list[k].gnrl_id==info.gnrl_id){info.new_yunhee=1;break}gnrl_list.push(info),info=null}random_general_list=[]}return new_list=null,gnrl_list},getGachaSpecialTicketLineupYunheeList:function(shop_id){for(var m=MasterManager.getInstance(),mt=MasterTable.getInstance(),special_ticket_gacha=m.get_SpecialTicketGacha(shop_id),group_random_list=mt.get_GachaGroupRandomIds(special_ticket_gacha.base_gacha_group_idx),gnrl_list=[],random_general_list=[],new_list=mt.get_SpecialTicketGachaGnrlList(special_ticket_gacha.special_ticket_gacha_new_gnrl_idx),idx=0;idx<group_random_list.length;idx++){random_general_list=mt.get_GachaRandomGeneralList(group_random_list[idx].gacha_random_id);for(var j=0;j<random_general_list.length;j++){var i={},gnrl=m.get_General(random_general_list[j].gnrl_id);i.gnrl_id=gnrl.gnrl_id,i.rare_type=gnrl.rare_type,i.arm_service_type=gnrl.arm_service_type,i.gnrl_class=gnrl.gnrl_class,i.gnrl_group=gnrl.gnrl_group,i.gnrl_type=gnrl.gnrl_type;for(var k=i.new_yunhee=0;k<new_list.length;k++)if(i.gnrl_id==new_list[k].gnrl_id){i.new_yunhee=1;break}gnrl_list.push(i)}}return gnrl_list},getStepupGachaLineupYunheeList:function(step_up_gacha_idx,step){for(var m=MasterManager.getInstance(),mt=MasterTable.getInstance(),stepup_gacha=m.get_StepUpGacha(step_up_gacha_idx,step),gnrl_list=[],group_random_list=mt.get_GachaGroupRandomIds(stepup_gacha.base_gacha_group_idx),random_general_list=[],new_list=mt.get_StepUpGachaNewGnrlList(stepup_gacha.step_up_gacha_new_gnrl_idx),idx=0;idx<group_random_list.length;idx++){random_general_list=mt.get_GachaRandomGeneralList(group_random_list[idx].gacha_random_id);for(var j=0;j<random_general_list.length;j++){var info={},gnrl=m.get_General(random_general_list[j].gnrl_id);info.gnrl_id=gnrl.gnrl_id,info.rare_type=gnrl.rare_type,info.arm_service_type=gnrl.arm_service_type,info.gnrl_class=gnrl.gnrl_class,info.gnrl_group=gnrl.gnrl_group,info.gnrl_type=gnrl.gnrl_type;for(var k=info.new_yunhee=0;k<new_list.length;k++){var new_yunhee=new_list[k];if(info.gnrl_id==new_yunhee.gnrl_id){info.new_yunhee=1;break}}gnrl_list.push(info),info=null}}return group_random_list=new_list=null,gnrl_list},getDmmPointGachaBoxTicketSelectGnrlList:function(select_type){var mt=MasterManager.getInstance(),m=MasterTable.getInstance(),gnrl_list=[];NetService().getUserGeneral([]);var gacha_mng=mt.get_GachaTicketManagement(select_type),gnrl_choice_ticket_list=MasterTable.getInstance().get_GeneralChoiceTicketList(gacha_mng.gnrl_choice_id);if(0<gnrl_choice_ticket_list.length)for(var idx=0;idx<gnrl_choice_ticket_list.length;idx++){var gnrl=mt.get_General(gnrl_choice_ticket_list[idx].gnrl_id),i={};i.gnrl_id=gnrl.gnrl_id,i.rare_type=gnrl.rare_type,i.arm_service_type=gnrl.arm_service_type,i.gnrl_class=gnrl.gnrl_class,i.gnrl_group=gnrl.gnrl_group,i.gnrl_type=gnrl.gnrl_type,i.state_type=0,i.new_yunhee=0,i.pickup_yunhee=0,gnrl_list.push_back(i)}else{var group_random_list=m.get_GachaGroupRandomIds(gacha_mng.gacha_group_id),new_list=m.get_GachaNewYunheeList(gacha_mng.gacha_group_id);for(idx=0;idx<group_random_list.length;idx++)for(var random_general_list=m.get_GachaRandomGeneralList(group_random_list[idx].gacha_random_id),j=0;j<random_general_list.length;j++){gnrl=mt.get_General(random_general_list[j].gnrl_id);var info={};info.gnrl_id=gnrl.gnrl_id,info.rare_type=gnrl.rare_type,info.arm_service_type=gnrl.arm_service_type,info.gnrl_class=gnrl.gnrl_class,info.gnrl_group=gnrl.gnrl_group,info.gnrl_type=gnrl.gnrl_type;for(var k=info.new_yunhee=0;k<new_list.length;k++)if(new_list[k].gnrl_id==info.gnrl_id){1==new_list[k].display_type?info.new_yunhee=1:2==new_list[k].display_type&&(info.new_yunhee=1);break}gnrl_list.push(info)}}return gnrl_list},getGachaLineupYunheeList:function(shop_id){for(var gnrl_list=[],m=MasterManager.getInstance(),shop_data=m.get_Shop(shop_id),gacha_data=m.get_Gacha(shop_data.gacha_id),group_random_list=MasterTable.getInstance().get_GachaGroupRandomIds(gacha_data.basic_gacha_group_idx),random_general_list=[],new_list=MasterTable.getInstance().get_GachaNewYunheeList(gacha_data.gacha_id),idx=0;idx<group_random_list.length;idx++){random_general_list=MasterTable.getInstance().get_GachaRandomGeneralList(group_random_list[idx].gacha_random_id);for(var j=0;j<random_general_list.length;j++){var i={},gnrl=m.get_General(random_general_list[j]);i.gnrl_id=gnrl.gnrl_id,i.rare_type=gnrl.rare_type,i.arm_service_type=gnrl.arm_service_type,i.gnrl_class=gnrl.gnrl_class,i.gnrl_group=gnrl.gnrl_group,i.gnrl_type=gnrl.gnrl_type,i.new_yunhee=0;for(var jdx=i.pickup_yunhee=0;jdx<new_list.length;jdx++){var new_yunhee=new_list[jdx];if(new_yunhee.gnrl_id==i.gnrl_id){1==new_yunhee.display_type?i.new_yunhee=1:2==new_yunhee.display_type&&(i.new_yunhee=1);break}}gnrl_list.push(i),i=null}}return group_random_list=null,gnrl_list},getGachaPrcntYunheeList:function(shop_id,gnrl_list){var gacha_random_ids,gacha_id=0,gnrl_ids=[],m_shop=MasterManager.getInstance().get_AllShop();for(var idx in m_shop)m_shop[idx].shop_id==shop_id&&(gacha_id=m_shop[idx].gacha_id);var basic_gacha_group_idx=MasterManager.getInstance().get_Gacha(gacha_id).basic_gacha_group_idx;gacha_random_ids=MasterManager.getInstance().get_AllGachaGroupRandom().filter(function(gacha_group){if(gacha_group.group_random_id==basic_gacha_group_idx)return!0});for(var jdx=0;jdx<gacha_random_ids.length;jdx++){var random_id=gacha_random_ids[jdx].gacha_random_id,new_array=MasterManager.getInstance().get_AllGachaRandomGeneral().filter(function(obj){if(obj.gacha_random_id==random_id)return!0});$.merge(gnrl_ids,new_array)}var new_list=MasterTable.getInstance().get_GachaNewYunheeList(gacha_id);for(idx=0;idx<gnrl_ids.length;idx++){var i={},g=MasterManager.getInstance().get_General(gnrl_ids[idx].gnrl_id);i.gnrl_id=g.gnrl_id,i.rare_type=g.rare_type,i.arm_service_type=g.arm_service_type,i.gnrl_class=g.gnrl_class,i.gnrl_group=g.gnrl_group,i.gnrl_type=g.gnrl_type,i.new_yunhee=0;for(jdx=i.pickup_yunhee=0;jdx<new_list.length;jdx++){var new_yunhee=new_list[jdx];if(new_yunhee.gnrl_id==i.gnrl_id){1==new_yunhee.display_type?i.new_yunhee=1:2==new_yunhee.display_type&&(i.pickup_yunhee=1);break}}gnrl_list.push(i)}new_list=null},isExsitShopEvent:function(){var shopList=MasterTable.getInstance().get_Shops();for(var shop in shopList)if(shopList[shop].shop_type==SHOP_TYPE_EVENT&&"Y"==shopList[shop].display_yn&&this.IsOpenShopEvent(shopList[shop].sell_period_group))return!0;return shopList=null,!1},isExsitShopGachaEvent:function(){var shopList=MasterTable.getInstance().get_Shops();for(var shop in shopList)if(shop.gacha_type==GACHA_TAB_TYPE_EVENT&&"Y"==shop.display_yn)return!0;shopList=null},checkFirstTimeGacha:function(shop_id){for(var user_infos=(new NetService).get_user_shop_buy_info().user_shop_buy_info,shopList=MasterTable.getInstance().get_Shops(),i=0;i<shopList.length;i++)if(shop_id==shopList[i].shop_id){shopList[i];break}if((shopList=null)!=user_infos)for(var idx=0;idx<user_infos.length;idx++){if(shop_id==(i=user_infos[idx]).shop_id)return"n"!=i.buy_enable_yn}return!0},getEquipmentBoxGachaRoundCount:function(){return(new NetService).get_User_Equipment_Box_Gacha_Info().user_round_count},getEquipmentBoxGachaDisplayRoundCount:function(){var mm=MasterManager.getInstance(),max_round_count=mm.get_CountFunction(COUNT_FUNCTION_EQUIPMENT_BOX_GACHA_ROUND_COUNT).value,info=(new NetService).get_User_Equipment_Box_Gacha_Info(),box_gacha_idx=this.getEquipmentBoxGachaIdx(info.arm_service_type,info.user_round_count,info.equipment_parts_type);return 0==mm.get_EquipmentBoxGacha(box_gacha_idx).next_box_gacha_idx?0:max_round_count-info.user_round_count+1},getEquipmentBoxGachaPartsType:function(){return(new NetService).get_User_Equipment_Box_Gacha_Info().equipment_parts_type},getUserEquipmentBoxGachaCountInfo:function(round_count,equipment_parts_type,list){for(var mt=MasterManager.getInstance(),mm=MasterTable.getInstance(),user_info=NetService().get_User_Equipment_Box_Gacha_Info(),arm_service_type=user_info.arm_service_type,box_gacha_idx=this.getEquipmentBoxGachaIdx(arm_service_type,round_count,equipment_parts_type),item_list=mm.get_EquipmentBoxGachaProductList(box_gacha_idx,[]),map_info=new Map,idx=0;idx<item_list.length;idx++){(item_key=new Map).insert(item_list[idx].bonus_type,item_list[idx].min_value);var count_info=map_info.at([item_list[idx].bonus_type,item_list[idx].min_value]),count=0;null!=count_info?count=count_info.max_count:count_info={},count+=1,count_info.max_count=count,count_info.bonus_type=item_list[idx].bonus_type,count_info.item_id=item_list[idx].min_value,count_info.box_gacha_idx=box_gacha_idx,count_info.bonus_count=item_list[idx].max_value,count_info.user_count=0,9999!=item_list[idx].display_num&&(count_info.item_idx=item_list[idx].gacha_product_idx,count_info.display_num=item_list[idx].display_num),map_info.insert([item_list[idx].bonus_type,item_list[idx].min_value],count_info)}var map_keys=map_info.keys();for(idx=0;idx<map_keys.length;idx++){for(var info=map_info.at(map_keys[idx]),jdx=0;jdx<user_info.equipment_box_gacha_item_info.length;jdx++){var user=user_info.equipment_box_gacha_item_info[jdx],item_key=new Map,gacha_item=mt.get_EquipmentBoxGachaProduct(user.gacha_product_idx);gacha_item.box_gacha_idx==box_gacha_idx&&(item_key.insert(gacha_item.bonus_type,gacha_item.min_value),info.bonus_type==gacha_item.bonus_type&&(info.bonus_type==BONUS_TYPE_EQUIPMENT?info.item_id==gacha_item.min_value&&info.user_count++:info.user_count++))}list.push(info)}0!=map_keys.length&&list.sort(function(l,r){return l.display_num>r.display_num})},getEquipmentBoxGachaIdx:function(arm_service_type,round_count,equipment_parts_type){var box_gacha_idx=0,m_equipment_box_gacha=MasterManager.getInstance().get_AllEquipmentBoxGacha();for(var idx in m_equipment_box_gacha){var m_box_gacha=m_equipment_box_gacha[idx];if(m_box_gacha.arm_service_type==arm_service_type&&m_box_gacha.equipment_parts_type==equipment_parts_type&&m_box_gacha.round_count==round_count){box_gacha_idx=m_box_gacha.box_gacha_idx;break}}return box_gacha_idx},getEquipmentBoxGachaRemainItemCount:function(box_gacha_idx,bonus_type,item_idx){var mt=MasterManager.getInstance(),user_info=NetService().get_User_Equipment_Box_Gacha_Info(),item_list=mt.get_AllEquipmentBoxGachaProduct(box_gacha_idx);if(null==bonus_type&&null==item_idx){for(var user_count=0,jdx=0;jdx<user_info.equipment_box_gacha_item_info.length;jdx++)for(var user=user_info.equipment_box_gacha_item_info[jdx],idx=0;idx<item_list.length;idx++){var item=item_list[idx];user.gacha_product_idx==item.gacha_product_idx&&user_count++}return item_list.size()-user_count}var total_count=0;for(idx=0;idx<item_list.length;idx++){var i=item_list[idx];i.bonus_type==bonus_type&&(i.bonus_type==BONUS_TYPE_EQUIPMENT&&item_idx==i.min_value?total_count++:i.bonus_type!=BONUS_TYPE_EQUIPMENT&&total_count++)}for(user_count=0,jdx=0;jdx<user_info.equipment_box_gacha_item_info.length;jdx++){var u=user_info.equipment_box_gacha_item_info[jdx],product=mt.get_EquipmentBoxGachaProduct(u.gacha_product_idx);product.box_gacha_idx==box_gacha_idx&&product.bonus_type==bonus_type&&(product.bonus_type==BONUS_TYPE_EQUIPMENT&&item_idx==product.min_value?user_count++:product.bonus_type!=BONUS_TYPE_EQUIPMENT&&user_count++)}return total_count-user_count},getEquipmentBoxGachaMaxItemCount:function(box_gacha_idx){return MasterManager.getInstance().get_AllEquipmentBoxGachaProduct(box_gacha_idx).size()},getBuyTypeToShopId:function(buy_type){for(var list=MasterTable.getInstance().get_Shops(),idx=0;idx<list.length;idx++){var s=list[idx];if("Y"==s.display_yn&&s.buy_type==buy_type)return s.shop_id}return 0},getCeilingGachaCount:function(shop_id){var ceiling_gacha_idx;return null==(ceiling_gacha_idx=MasterManager.getInstance().get_CeilingGachaShop(shop_id).ceiling_gacha_idx)?0:NetService().get_user_ceiling_gacha_info().at([m_user_id,ceiling_gacha_idx]).ceiling_gacha_count},getCeilingGachaMaxCount:function(shop_id){var ceiling_gacha_idx,count=0;ceiling_gacha_idx=MasterManager.getInstance().get_CeilingGachaShop(shop_id).ceiling_gacha_idx;var gacha_count=MasterManager.getInstance().get_CeilingGachaInfo(ceiling_gacha_idx),now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),bb=moment(gacha_count.beg_dt).valueOf(),ee=moment(gacha_count.end_dt).valueOf();return bb<=n&&n<=ee&&(count=gacha_count.need_gacha_count),count},getShopPeriod:function(sell_period_group,shop_period){var period=MasterManager.getInstance().get_AllShopPeriod().find(function(obj){if(obj.group_num==sell_period_group)return!0});shop_period.end_dt=(shop_period.beg_dt=(shop_period.comment=(shop_period.num=(null!=shop_period?shop_period.group_num=period.group_num:(shop_period={}).group_num=period.group_num,period.num),period.comment),period.beg_dt),period.end_dt)},IsEnableBuy1User1TimeFreeGachaByBannerType:function(banner_type){var mm=MasterManager.getInstance(),m=MasterTable.getInstance(),is_enable_buy=!0,gacha_type=0;banner_type==MAIN_BANNER_1_USER_1_TIME_FREE_GACHA?gacha_type=GACHA_TAB_TYPE_1_USER_1_TIME_FREE_GACHA:banner_type==MAIN_BANNER_1_USER_1_TIME_FREE_GACHA_FIRST?gacha_type=GACHA_TAB_TYPE_1_USER_1_TIME_FREE_GACHA_FIRST:banner_type==MAIN_BANNER_1_USER_1_TIME_FREE_GACHA_SECOND&&(gacha_type=GACHA_TAB_TYPE_1_USER_1_TIME_FREE_GACHA_SECOND);for(var shopList=m.get_Shops(),isFound=!1,shop=null,i=0;i<shopList.length;i++){var s=shopList[i];if(s.shop_type==SHOP_TYPE_GACHA&&s.gacha_kinds==GACHA_KIND_1_USER_1_TIME_FREE_GACHA&&s.gacha_type==gacha_type&&"Y"==s.display_yn){shop=shopList[i],isFound=!0;break}}if(shopList=null,1==isFound&&null!=shop){var free_gacha=mm.get_OneUserOneTimeFreeGacha(shop.shop_id);is_enable_buy=this.IsEnableBuy1User1TimeFreeGacha(shop.shop_id,free_gacha.one_user_one_time_free_gacha_idx)}return is_enable_buy},IsEnableBuy1Day1TimeFreeGachaByBannerType:function(banner_type){var mm=MasterManager.getInstance(),m=MasterTable.getInstance(),is_enable_buy=!0,gacha_type=0;banner_type==MAIN_BANNER_1_DAY_1_TIME_FREE_GACHA?gacha_type=GACHA_TAB_TYPE_1_DAY_1_TIME_FREE_GACHA:banner_type==MAIN_BANNER_1_DAY_1_TIME_FREE_GACHA_FIRST?gacha_type=GACHA_TAB_TYPE_1_DAY_1_TIME_FREE_GACHA_FIRST:banner_type==MAIN_BANNER_1_DAY_1_TIME_FREE_GACHA_SECOND&&(gacha_type=GACHA_TAB_TYPE_1_DAY_1_TIME_FREE_GACHA_SECOND);for(var shopList=m.get_Shops(),isFound=!1,shop=null,i=0;i<shopList.length;i++){var s=shopList[i];if(s.shop_type==SHOP_TYPE_GACHA&&5==s.gacha_kinds&&s.gacha_type==gacha_type&&"Y"==s.display_yn){shop=shopList[i],isFound=!0;break}}if(shopList=null,1==isFound&&null!=shop){var free_gacha=mm.get_OneUserOneTimeFreeGacha(shop.shop_id);is_enable_buy=this.IsEnableBuy1Day1TimeFreeGacha(shop.shop_id,free_gacha.one_day_one_time_free_gacha_idx)}return is_enable_buy},IsEnableBuyStepUpGacha:function(shop_id){for(var mm=MasterManager.getInstance(),is_enable_buy=!0,shop=mm.get_Shop(shop_id),stepup_list=MasterTable.getInstance().get_StepUpGachaList(shop_id),buy_log=NetService().get_user_step_up_gacha_buy_log(),isFound=!1,buy_info=null,i=0;i<buy_log.step_up_buy_log.length;i++)if(buy_log.step_up_buy_log[i].shop_id==shop.shop_id&&buy_log.step_up_buy_log[i].step_up_gacha_idx==stepup_list[0].step_up_gacha_idx){isFound=!0,buy_info=buy_log.step_up_buy_log[i];break}if(1==isFound){var circuit_info=mm.get_StepUpGachaCircuitInfo(buy_info.step_up_gacha_idx);0!=circuit_info.limit_type&&buy_info.reset_count>=circuit_info.max_circuit_count&&(is_enable_buy=!1)}return is_enable_buy},IsEnableBuyStepUpGachaByBannerType:function(banner_type){var m=MasterTable.getInstance(),is_enable_buy=!0,gacha_type=0;banner_type==MAIN_BANNER_STEP_UP_GACHA_DMM_POINT_FIRST?gacha_type=GACHA_TAB_TYPE_STEP_UP_DMM_POINT_FIRST:banner_type==MAIN_BANNER_STEP_UP_GACHA_DMM_POINT_SECOND?gacha_type=GACHA_TAB_TYPE_STEP_UP_DMM_POINT_SECOND:banner_type==MAIN_BANNER_STEP_UP_GACHA_JADE_FIRST?gacha_type=GACHA_TAB_TYPE_STEP_UP_JADE_FIRST:banner_type==MAIN_BANNER_STEP_UP_GACHA_JADE_SECOND&&(gacha_type=GACHA_TAB_TYPE_STEP_UP_JADE_SECOND);for(var shop_list=m.get_Shops(),found=!1,shop_info={},i=0;i<shop_list.length;i++){var s=shop_list[i];if(s.shop_type==SHOP_TYPE_GACHA&&s.gacha_kinds==GACHA_KIND_STEP_UP_GACHA&&s.gacha_type==gacha_type&&"Y"==s.display_yn){found=!0,shop_info=shop_list[i];break}}if(shopList=null,1==found){var stepup_list=m.get_StepUpGachaList(shop_info.shop_id),buy_log=(stepup_list[0],NetService().get_user_step_up_gacha_buy_log()),buy_info=null,isFound=!1;for(i=0;i<buy_log.step_up_buy_log.length;i++)if(buy_log.step_up_buy_log[i].shop_id==shop_info.shop_id&&buy_log.step_up_buy_log[i].step_up_gacha_idx==stepup_list[0].step_up_gacha_idx){isFound=!0,buy_info=buy_log.step_up_buy_log[i];break}if(1==isFound){var circuit_info=MasterManager.getInstance().get_StepUpGachaCircuitInfo(buy_info.step_up_gacha_idx);0!=circuit_info.limit_type&&buy_info.reset_count>=circuit_info.max_circuit_count&&(is_enable_buy=!1)}}return is_enable_buy},IsEnabledBuyDmmPointGacha:function(banner_type){var gacha_type=0;banner_type==MAIN_BANNER_DMM_POINT_GACHA?gacha_type=GACHA_TAB_TYPE_DMM_POINT:banner_type==MAIN_BANNER_DMM_POINT_GACHA_THIRD?gacha_type=GACHA_TAB_TYPE_DMM_POINT_THIRD:banner_type==MAIN_BANNER_DMM_POINT_GACHA_SECOND?gacha_type=GACHA_TAB_TYPE_DMM_POINT_SECOND:banner_type==MAIN_BANNER_DMM_POINT_16_GACHA?gacha_type=GACHA_TAB_TYPE_DMM_POINT_16:banner_type==MAIN_BANNER_DMM_POINT_FOURTH?gacha_type=GACHA_TAB_TYPE_DMM_POINT_FOURTH:banner_type==MAIN_BANNER_DMM_POINT_FIFTH&&(gacha_type=GACHA_TAB_TYPE_DMM_POINT_FIFTH);var is_dmm_buy=!0,shop_list=this.getShopList(),dmm_point_shop_id=0;shop_list.some(function(shop){if(shop.shop_type==SHOP_TYPE_GACHA&&shop.gacha_type==gacha_type&&"Y"==shop.display_yn)return dmm_point_shop_id=shop.shop_id,!0});var user_infos=NetService().get_user_shop_buy_info().user_shop_buy_info;MasterManager.getInstance();return user_infos.some(function(user){if(user.shop_id==dmm_point_shop_id&&"n"==user.buy_enable_yn)return!(is_dmm_buy=!1)}),shop_list=null,is_dmm_buy},IsEnabledBuyShopItem:function(shop_id){for(var user_infos=NetService().get_user_shop_buy_info().user_shop_buy_info,idx=0;idx<user_infos.length;idx++){var user_shop=user_infos[idx];if(shop_id==user_shop.shop_id&&"y"!=user_shop.buy_enable_yn)return!1}return!0},IsOpenShopEvent:function(sell_period_group){var shop_period={};this.getShopPeriod(sell_period_group,shop_period);var now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),bb=moment(shop_period.beg_dt).valueOf(),ee=moment(shop_period.end_dt).valueOf();return bb<=n&&n<=ee},IsOpenGacha:function(gacha_type){var gacha_list=[];this.getShopGachaInfoList(gacha_list);for(var i=0;i<gacha_list.length;i++)if(gacha_list[i].gacha_type==gacha_type&&"Y"==gacha_list[i].display_yn)for(var j=0;j<NetService().get_Shop_Gacha_Period_Info().shop_Gacha_Period_Info.length;j++){var period=NetService().get_Shop_Gacha_Period_Info().shop_Gacha_Period_Info[j];if(period.shop_id==gacha_list[i].shop_id&&"y"==period.open_yn&&"n"==period.end_yn&&1==gacha_list[i].gacha_count)return!0}return!1},IsEnableBuy1User1TimeFreeGacha:function(shop_id,one_user_one_time_free_gacha_idx){for(var is_enable=!0,buy_logs=NetService().get_OneUser_OneTime_Free_Gacha_Buy_Log().buy_log,found=!1,i=0;i<buy_logs.length;i++){var log=buy_logs[i];if(log.shop_id==shop_id&&log.one_user_one_time_free_gacha_idx==one_user_one_time_free_gacha_idx){found=!0;break}}return 1==found&&(is_enable=!1),is_enable},IsEnableBuy1Day1TimeFreeGacha:function(shop_id,one_day_one_time_free_gacha_idx){for(var is_enable=!0,buy_logs=NetService().get_OneDay_OneTime_Free_Gacha_Buy_Log().buy_log,nt=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),i=0;i<buy_logs.length;i++){var log=buy_logs[i];if(log.shop_id==shop_id&&log.one_day_one_time_free_gacha_idx==one_day_one_time_free_gacha_idx){var bt=moment(log.buy_dt),et=moment(log.buy_dt),b=bt.valueOf(),e=et.valueOf()+864e5;if(b<=nt&&nt<=e){is_enable=!1;break}}}return is_enable},IsEnableBuyFreeGacha:function(gacha_kinds){var is_enable_buy=!1,free_gacha_list=MasterTable.getInstance().get_ShopGachaListByKind(gacha_kinds);if(gacha_kinds==GACHA_KIND_1_DAY_1_TIME_FREE_GACHA){for(var found_is=!1,idx=0;idx<free_gacha_list.length;idx++){var free=MasterManager.getInstance().get_OneDayOneTimeFreeGacha(free_gacha_list[idx].shop_id);if(this.IsEnableBuy1Day1TimeFreeGacha(free_gacha_list[idx].shop_id,free.one_day_one_time_free_gacha_idx)){found_is=!0;break}}1==found_is&&(is_enable_buy=!0)}else if(gacha_kinds==GACHA_KIND_1_USER_1_TIME_FREE_GACHA){for(found_is=!1,idx=0;idx<free_gacha_list.length;idx++){free=MasterManager.getInstance().get_OneUserOneTimeFreeGacha(free_gacha_list[idx].shop_id);if(this.IsEnableBuy1User1TimeFreeGacha(free_gacha_list[idx].shop_id,free.one_user_one_time_free_gacha_idx)){found_is=!0;break}}1==found_is&&(is_enable_buy=!0)}return is_enable_buy},IsEnableBuyFreeGachaByGachaType:function(gacha_type){var is_enable_buy=!1,free_gacha_list=MasterTable.getInstance().get_ShopGachaListByGachaType(gacha_type);if(gacha_type==GACHA_TAB_TYPE_1_DAY_1_TIME_FREE_GACHA||gacha_type==GACHA_TAB_TYPE_1_DAY_1_TIME_FREE_GACHA_FIRST||gacha_type==GACHA_TAB_TYPE_1_DAY_1_TIME_FREE_GACHA_SECOND){for(var found_is=!1,idx=0;idx<free_gacha_list.length;idx++){var free=MasterManager.getInstance().get_OneDayOneTimeFreeGacha(free_gacha_list[idx].shop_id);if(this.IsEnableBuy1Day1TimeFreeGacha(free_gacha_list[idx].shop_id,free.one_day_one_time_free_gacha_idx)){found_is=!0;break}}1==found_is&&(is_enable_buy=!0)}else if(gacha_type==GACHA_TAB_TYPE_1_USER_1_TIME_FREE_GACHA||gacha_type==GACHA_TAB_TYPE_1_USER_1_TIME_FREE_GACHA_FIRST||gacha_type==GACHA_TAB_TYPE_1_USER_1_TIME_FREE_GACHA_SECOND){for(found_is=!1,idx=0;idx<free_gacha_list.length;idx++){free=MasterManager.getInstance().get_OneUserOneTimeFreeGacha(free_gacha_list[idx].shop_id);if(this.IsEnableBuy1User1TimeFreeGacha(free_gacha_list[idx].shop_id,free.one_user_one_time_free_gacha_idx)){found_is=!0;break}}1==found_is&&(is_enable_buy=!0)}return is_enable_buy}}}var instance;return{getInstance:function(){return void 0===instance&&(instance=new ShopService),instance}}}(),CampService=function(){var instance,m_user_camp=new Map,m_user_camp_branch_ability_log=[];function CampService(){}return CampService.prototype.getUserCamp=function(userCamp,campType){if(null==campType)for(var i=0;i<3;i++){this.getUserCamp({},i+1)}else{var uCmap=m_user_camp.at(campType);userCamp.camp_type=uCmap.camp_type,userCamp.camp_level=uCmap.camp_level,userCamp.complete_yn=uCmap.complete_yn;var campList=MasterManager.getInstance().get_AllCamp().filter(function(camp){return camp.camp_type==campType});campList.sort(function(l,r){return l.camp_level<r.camp_level?1:l.camp_level>r.camp_level?-1:0});var max_camp=campList[0];userCamp.max_camp_level=max_camp.camp_level,userCamp.camp_level==userCamp.max_camp_level&&(userCamp.is_max_upgrade=!0)}},CampService.prototype.getUserCampId=function(campType,campLevel){var campId=0,camp=MasterManager.getInstance().get_AllCamp().find(function(camp){if(camp.camp_type==campType&&camp.camp_level==campLevel)return!0});return null!=camp&&(campId=camp.camp_id),campId},CampService.prototype.upgradeUserCamp=function(campType){},CampService.prototype.getUserCampBranchAbility=function(branchType){var branch_ability={attack:0,defense:0,health:0},my_branch=NetService().get_user_camp_branch_ability().at(branchType);return null!=my_branch&&(branch_ability.attack=my_branch.attack,branch_ability.defense=my_branch.defense,branch_ability.health=my_branch.health),branch_ability},CampService.prototype.getRunningUserCampBranchAbility=function(userCampBranchList,branchType){for(var ability_love_type={},ability_list=m_user_camp_branch_ability_log.filter(function(l){if(l.branch_type==branchType)return!0}),idx=0;idx<ability_list.length;idx++){var love_type=ability_love_type[ability_list[idx].love_stat_type];if(null==love_type)ability_love_type[ability_list[idx].love_stat_type]=[],ability_love_type[ability_list[idx].love_stat_type].push(ability_list[idx]);else{var obj=love_type.pop();obj.ability_id<ability_list[idx].ability_id?love_type.push(ability_list[idx]):love_type.push(obj)}}for(var idx in ability_love_type){var ability_love=ability_love_type[idx].pop(),prevAbilityId=0,campBranchInfo={is_max_level:!1,cancel_yn:"n"};if("y"==ability_love.complete_yn){var newAbilityId=this.getNextUserCampBranchAbility(branchType,ability_love.love_stat_type);0!=newAbilityId?(prevAbilityId=ability_love.ability_id,campBranchInfo.ability_id=newAbilityId):(prevAbilityId=ability_love.ability_id,campBranchInfo.ability_id=ability_love.ability_id,campBranchInfo.is_max_level=!0)}else prevAbilityId=this.getPrevUserCampBranchAbility(branchType,ability_love.love_stat_type),campBranchInfo.ability_id=ability_love.ability_id;campBranchInfo.complete_yn=ability_love.complete_yn,campBranchInfo.cancel_yn=null==ability_love.cancel_yn?"n":"y";var mt=MasterManager.getInstance(),ba=mt.get_CampBranchAbility(campBranchInfo.ability_id);campBranchInfo.branch_type=ba.arm_service_type,campBranchInfo.love_stat_type=ba.love_stat_type,campBranchInfo.camp_level=ba.camp_level,campBranchInfo.love_stat_added=ba.love_stat_added,campBranchInfo.upgrade_level=ba.upgrade_level,campBranchInfo.needed_asset=ba.needed_asset,campBranchInfo.needed_amount=ba.needed_amount,campBranchInfo.needed_second=ba.needed_second,campBranchInfo.yunhee_bound=ba.yunhee_bound,campBranchInfo.prev_love_stat=0!=prevAbilityId?(ba=mt.get_CampBranchAbility(prevAbilityId)).love_stat_added:0,userCampBranchList.push(campBranchInfo)}},CampService.prototype.getNextUserCampBranchAbility=function(branchType,loveStatType){var abilityId=0,completeYn="n",abillity_log=m_user_camp_branch_ability_log.filter(function(l){if(l.branch_type==branchType&&l.love_stat_type==loveStatType)return!0}).sort(function(l,r){return l.ability_id<r.ability_id?1:l.ability_id>r.ability_id?-1:0});return 0!=abillity_log.length&&(abilityId=abillity_log[0].ability_id,completeYn=abillity_log[0].complete_yn),0!=abilityId&&"y"!=completeYn||(abilityId=this.getMinCampBranchAbilityId(branchType,loveStatType,abilityId)),abilityId},CampService.prototype.getPrevUserCampBranchAbility=function(branchType,loveStatType){var ability_list=m_user_camp_branch_ability_log.filter(function(l){if(l.branch_type==branchType&&l.love_stat_type==loveStatType&&"y"==l.complete_yn)return!0});ability_list.sort(function(l,r){return l.ability_id<r.ability_id?1:l.ability_id>r.ability_id?-1:0});var max_camp=ability_list[0];return null==max_camp?0:max_camp.ability_id},CampService.prototype.getMaxCampBranchAbilityLevel=function(branchType,loveStatType){var m_camp=MasterManager.getInstance().get_AllCampBranchAbility(),maxList=[];for(var idx in m_camp){var camp=m_camp[idx];camp.arm_service_type==branchType&&camp.love_stat_type==loveStatType&&maxList.push(camp.upgrade_level)}return maxList.reduce(function(a,b){return Math.max(a,b)})},CampService.prototype.getMinCampBranchAbilityId=function(arm_service_type,love_stat_type,branch_ability_id){var m_camp=MasterManager.getInstance().get_AllCampBranchAbility(),minList=[];for(var idx in m_camp){var camp=m_camp[idx];camp.arm_service_type==arm_service_type&&camp.love_stat_type==love_stat_type&&camp.branch_ability_id>branch_ability_id&&minList.push(camp.branch_ability_id)}return 0==minList.length?0:minList.reduce(function(a,b){return Math.min(a,b)})},CampService.prototype.getUserCampCostSlot=function(troops_num,cost_slot){var slotData=NetService().get_User_Cost_slot_list().at(troops_num);cost_slot.troops_num=troops_num,cost_slot.slots.push("y"==slotData.slots_0),cost_slot.slots.push("y"==slotData.slots_1),cost_slot.slots.push("y"==slotData.slots_2),cost_slot.slots.push("y"==slotData.slots_3),cost_slot.slots.push("y"==slotData.slots_4),cost_slot.slots.push("y"==slotData.slots_5),cost_slot.slots.push("y"==slotData.slots_6),cost_slot.slots.push("y"==slotData.slots_7)},CampService.prototype.getCampArbeitUpgradeTime=function(arbeit_id){var upgradeTime=0,m_camp_arbeit=MasterManager.get_AllCampArbeit();for(var idx in m_camp_arbeit)m_camp_arbeit[idx].arbeit_id==arbeit_id&&(upgradeTime=m_camp_arbeit[idx].needed_second);return upgradeTime},CampService.prototype.getUserCampMaterialList=function(list,branch_type){var gnrls=[];NetService().getUserGeneral(gnrls);for(var user_troops_general=NetService().getUserPartyGeneral(),user_weekly_troops_general=NetService().getUserWeeklyTroopsGeneral(),world_war_troops_generals=NetServiceV3.getInstance().get_list_User_World_War_Troops_General(),w_service=WorldWarService.getInstance(),is_worldwarOpen=w_service.isWorldWarPeriodOpen(),mt=MasterManager.getInstance(),idx_gnrls=0;idx_gnrls<gnrls.length;idx_gnrls++){var gnrl=gnrls[idx_gnrls];if(gnrl.gnrl_id<3e4){var gnrl_key={};gnrl_key.gnrl_id=gnrl.gnrl_id,gnrl_key.gnrl_num=gnrl.gnrl_num;var gnrl_key_2={};if(gnrl_key_2.gnrl_id=gnrl.gnrl_id,gnrl_key_2.gnrl_num=gnrl.gnrl_num,GeneralService.getInstance().isGnrlEquipping(gnrl_key_2))continue;for(var info=new db.UserGeneralInfo,isExist=!1,is_world_war_partin=!1,keys=user_troops_general.keys(),idx=0;idx<keys.length;idx++)if(user_troops_general.at(keys[idx]).gnrl_num==gnrl.gnrl_num){isExist=!0;break}if(!isExist)for(var w in user_weekly_troops_general)if(user_weekly_troops_general[w].gnrl_num==gnrl.gnrl_num){isExist=!0;break}if(keys=world_war_troops_generals.keys(),!is_world_war_partin&&!w_service.isWorldWarUnification()&&is_worldwarOpen)for(var i=0;i<keys.length;i++)if(world_war_troops_generals.at(keys[i]).gnrl_num==gnrl.gnrl_num){is_world_war_partin=isExist=!0;break}if("n"==gnrl.used_in_camp){info.isPartner=GeneralService.getInstance().isPartnerGeneral(gnrl_key),info.is_friend_partner=GeneralService.getInstance().isFriendPartner(gnrl_key.gnrl_id,gnrl_key.gnrl_num),info.gnrl_id=gnrl.gnrl_id,info.gnrl_num=gnrl.gnrl_num,info.gnrl_level=gnrl.gnrl_level,info.gnrl_exp=gnrl.gnrl_exp,info.limit_step_id=gnrl.limit_step_id,info.love_level=gnrl.love_level,info.is_lock="y"==gnrl.lock_yn,info.using_in_camp="y"==gnrl.using_in_camp,info.used_in_camp="y"==gnrl.used_in_camp,info.using_in_troops=isExist,info.using_in_world_war_troops=is_world_war_partin;var g=mt.get_General(info.gnrl_id),gender=mt.get_GeneralDivision(g.gnrl_group);if(0!=branch_type&&g.arm_service_type!=branch_type)continue;info.gender_type=gender.general_gender_type,info.name=g.name,info.base_attk=g.attk,info.base_def=g.def,info.base_hp=g.hp,info.base_sp=g.sp,info.active_skill=g.active_skill_id,info.class_type=g.gnrl_class,info.cost=g.cost,info.gnrl_type=g.gnrl_type,info.gnrl_group=g.gnrl_group;var key={};key.gnrl_id=info.gnrl_id,key.gnrl_num=info.gnrl_num,info.arm_service_type=g.arm_service_type,info.master_type=g.master_type,info.state_type=g.state_type,info.max_level=g.max_level,info.max_class_type=g.evolution_max_class_type,info.rare_type=g.rare_type,g.max_level==info.gnrl_level&&(info.isMaxLevel=!0),list.push(info)}}}},CampService.prototype.getGeneralCampInfo=function(gnrl_key,info){if(0<gnrl_key.gnrl_id&&0<gnrl_key.gnrl_num){var cardInfo=new db.CardInfo;GeneralService.getInstance().getCardInfo(gnrl_key,cardInfo),info.gnrl_id=gnrl_key.gnrl_id,info.gnrl_num=gnrl_key.gnrl_num,info.level=cardInfo.level}},CampService.prototype.getUserCampBranchAbilityYunheeList=function(list,branch_type,love_stat_type){for(var i=0;i<m_user_camp_branch_ability_log.length;i++){var original=m_user_camp_branch_ability_log[i];if(original.branch_type==branch_type&&original.love_stat_type==love_stat_type&&"n"==original.complete_yn)for(var kIdx=0;kIdx<original.gnrl_keys.length;kIdx++){var gnrl_key={};if(gnrl_key.gnrl_id=original.gnrl_keys[kIdx].gnrl_id,gnrl_key.gnrl_num=original.gnrl_keys[kIdx].gnrl_num,0<gnrl_key.gnrl_id&&0<gnrl_key.gnrl_num){var info={};this.getGeneralCampInfo(gnrl_key,info),info.ability_id=original.ability_id,list.push(info)}}}},CampService.prototype.getUserCampCostYunheeList=function(list,troops_num){for(var m_user_camp_cost_log=NetService().get_User_Camp_cost_Log(),keys=m_user_camp_cost_log.keys(),idx=0;idx<keys.length;idx++){var general=$.extend({},m_user_camp_cost_log.at(keys[idx]));if(general.troops_num==troops_num&&0<general.gnrl_id&&0<general.gnrl_num){var gnrl_key={};gnrl_key.gnrl_id=general.gnrl_id,gnrl_key.gnrl_num=general.gnrl_num;var info={};this.getGeneralCampInfo(gnrl_key,info),list.push(info)}}},CampService.prototype.getUserCampArbeitYunheeList=function(list){},CampService.prototype.getUserCampFactoryLevel=function(){var camplist=[];return this.getUserCamp(camplist,CAMP_FACTORY),camplist.camp_level},CampService.prototype.getCampFactoryList=function(){for(var list=MasterTable.getInstance().get_CampFactoryList(),mt=MasterManager.getInstance(),user_plus_key_bound=NetService().get_User_Plus_Key_Bound(),idx=0;idx<list.length;idx++)if(list[idx].cmplt_item_type==BONUS_TYPE_MAGIC_KEY){(user_plus_key_bound+=1)>MAX_CAMP_FACTORY_MALT_KEY&&(user_plus_key_bound=MAX_CAMP_FACTORY_MALT_KEY);var fm=mt.get_FactoryMagicKey(user_plus_key_bound);list[idx].need_mtrl_cnt=fm.need_count}return list},CampService.prototype.getUserCampFactoryMtrlCount=function(factory_mtrl_type,need_mtrl_type){var cnt,_NetService=new NetService;return factory_mtrl_type==CAMP_FACTORY_MTRL_LIMIT_OVER?null==(cnt=_NetService.get_User_Limit_Over_Mtrl().at(need_mtrl_type))?0:cnt.mtrl_cnt:factory_mtrl_type==CAMP_FACTORY_MTRL_MAGIC_KEY?cnt=_NetService.getMagicKeyCount():factory_mtrl_type==CAMP_FACTORY_MTRL_JADE_PIECE?_NetService.getJadePieceCount():0},CampService.prototype.isEnableCampFactoryExchage=function(factory_mtrl_type,need_mtrl_type,need_mtrl_cnt){var _NetService=new NetService;if(factory_mtrl_type==CAMP_FACTORY_MTRL_LIMIT_OVER){if(null==(user_cnt=_NetService.get_User_Limit_Over_Mtrl().at(need_mtrl_type))&&(user_cnt={mtrl_cnt:0}),user_cnt.mtrl_cnt<need_mtrl_cnt)return!1}else if(factory_mtrl_type==CAMP_FACTORY_MTRL_MAGIC_KEY){if((user_cnt=_NetService.getMagicKeyCount())<need_mtrl_cnt)return!1}else if(factory_mtrl_type==CAMP_FACTORY_MTRL_JADE_PIECE){var user_cnt;if((user_cnt=_NetService.getJadePieceCount())<need_mtrl_cnt)return!1}return!0},CampService.prototype.isEnableCampFactoryLevelCheck=function(factory_mtrl_type){if(factory_mtrl_type==CAMP_FACTORY_MTRL_MAGIC_KEY){var camp_factory=[];if(this.getUserCamp(camp_factory,CAMP_FACTORY),camp_factory.camp_level<2)return!1}else if(factory_mtrl_type==CAMP_FACTORY_MTRL_JADE_PIECE){camp_factory=[];if(this.getUserCamp(camp_factory,CAMP_FACTORY),camp_factory.camp_level<1)return!1}return!0},CampService.prototype.getCamp_branch_ability_log=function(){return m_user_camp_branch_ability_log},CampService.prototype.insert_camp_branch_ability_log=function(camp_branch){m_user_camp_branch_ability_log.push(camp_branch)},CampService.prototype.insert_camp=function(original){m_user_camp.insert(original.camp_type,original)},CampService.prototype.clear_camp=function(){m_user_camp.clear()},CampService.prototype.get_user_Camp=function(){return m_user_camp},{getInstance:function(){return void 0===instance&&(instance=new CampService),instance}}}(),HelpService=function(){function HelpService(){return{getPageInfo:function(menu_id,list_id){var helpPageInfo={last_menu_id:15},m_map_help=MasterTable.getInstance().getMasterTable().get_AllHelpInfo(),list=[];for(var l in m_map_help)m_map_help[l].menu_id==menu_id&&list.push(m_map_help[l]);list.sort(function(l,r){return l.list_id<r.list_id?1:l.list_id>r.list_id?-1:0}),helpPageInfo.last_list_id=list[0].list_id;for(var count=0,idx=0;idx<list.length;idx++)list[idx].list_id==list_id&&count++;return helpPageInfo.cur_page_size=count,list=null,helpPageInfo},getHelpInfoIndexByCallIndex:function(call_index){for(var helpInfoList=MasterTable.getInstance().get_HelpInfos(),i=0;i<helpInfoList.length;i++){if(helpInfoList[i].call_index==call_index)return i}return 0}}}var instance;return{getInstance:function(){return void 0===instance&&(instance=new HelpService),instance}}}(),DailyDungeonService=function(){function DailyDungeonService(){return{getUserDailyDungeonList:function(daily_dungeon_period_idx){BattleService.getInstance();for(var t=DailyDungeonTable.getInstance(),list=t.sel_MasterDailyDungeonList(daily_dungeon_period_idx),d=0;d<list.length;d++)this.getMasterDailyDungeonStageNpc(list[d].daily_dungeon.daily_dungeon_idx,list[d]),0==list[d].daily_dungeon.open_daily_dungeon_idx&&(list[d].is_open_pre_daily_dungeon=!0);t.sel_UserDailyDungeonList(m_user_id,list);for(d=0;d<list.length;d++){null!=list.find(function(dungeon){return list[d].daily_dungeon.open_daily_dungeon_idx==dungeon.daily_dungeon.daily_dungeon_idx&&dungeon.is_complete})&&0<list[d].daily_dungeon.open_daily_dungeon_idx&&(list[d].is_open_pre_daily_dungeon=!0)}return list},getMasterDailyDungeonStageNpc:function(daily_dungeon_idx,dungeon){var b_service=BattleService.getInstance(),m=MasterManager.getInstance();dungeon.stage_count=1,dungeon.stage_npc=new Map;for(var npc_list=[],b=0;b<dungeon.stage_count;b++){npc_list=[];var battle_num=b+1,d_npc=m.get_DailyDungeonNpc(daily_dungeon_idx,battle_num);if(0<d_npc.npc1_id){var npc=[];npc=m.get_NpcGeneral(d_npc.npc1_id),(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Head,hero.is_zoom=0<d_npc.npc1_size,hero.npc_boss_type=d_npc.npc1_size,hero.battle_stage=battle_num,b_service.setNpcGeneralData(hero,npc),npc_list.push(hero)}if(0<d_npc.npc2_id){npc={};npc=m.get_NpcGeneral(d_npc.npc2_id),(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_1,hero.is_zoom=0<d_npc.npc2_size,hero.npc_boss_type=d_npc.npc2_size,hero.battle_stage=battle_num,b_service.setNpcGeneralData(hero,npc),npc_list.push(hero)}if(0<d_npc.npc3_id){npc={};npc=m.get_NpcGeneral(d_npc.npc3_id),(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_2,hero.is_zoom=0<d_npc.npc3_size,hero.npc_boss_type=d_npc.npc3_size,hero.battle_stage=battle_num,b_service.setNpcGeneralData(hero,npc),npc_list.push(hero)}if(0<d_npc.npc4_id){npc={};npc=m.get_NpcGeneral(d_npc.npc4_id),(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_1,hero.is_zoom=0<d_npc.npc4_size,hero.npc_boss_type=d_npc.npc4_size,hero.battle_stage=battle_num,b_service.setNpcGeneralData(hero,npc),npc_list.push(hero)}if(0<d_npc.npc5_id){var hero;npc={};npc=m.get_NpcGeneral(d_npc.npc5_id),(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_2,hero.is_zoom=0<d_npc.npc5_size,hero.npc_boss_type=d_npc.npc5_size,hero.battle_stage=battle_num,b_service.setNpcGeneralData(hero,npc),npc_list.push(hero)}0!=npc_list.length&&(npc_list.sort(function(l,r){return l.position>r.position?1:l.position<r.position?-1:0}),dungeon.stage_npc.insert(battle_num,npc_list))}},convertBonusInfo:function(bonus,item){bonus.bonus_type>=BONUS_TYPE_HWANDAN_1&&bonus.bonus_type<=BONUS_TYPE_HWANDAN_7?(item.item_type=database.BattleGainItemType.Hwandan,item.item_id=bonus.bonus_type):bonus.bonus_type==BONUS_TYPE_YUNHEE_FIX?(item.item_type=database.BattleGainItemType.General,item.item_id=bonus.min_value,item.item_level=1):bonus.bonus_type==BONUS_TYPE_EVOLVE_STONE?(item.item_type=database.BattleGainItemType.EvolveStone,item.item_id=bonus.bonus_type):bonus.bonus_type>=BONUS_TYPE_ATTK_POINT&&bonus.bonus_type<=BONUS_TYPE_CRI_DMG_POINT?(item.item_type=database.BattleGainItemType.FormationPropertyPoint,item.item_id=bonus.bonus_type):bonus.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&bonus.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER?(item.item_type=database.BattleGainItemType.ForceTypeEvolveMtrl,item.item_id=bonus.bonus_type):bonus.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&bonus.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE?(item.item_type=database.BattleGainItemType.ForceTypeEvolveMtrl,item.item_id=bonus.bonus_type):bonus.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&bonus.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW?(item.item_type=database.BattleGainItemType.ForceTypeEvolveMtrl,item.item_id=bonus.bonus_type):bonus.bonus_type==BONUS_TYPE_EVOLVE_ORB?(item.item_type=database.BattleGainItemType.EvolveOrb,item.item_id=bonus.bonus_type):bonus.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&bonus.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE?(item.item_type=database.BattleGainItemType.LoveItem,item.item_id=bonus.bonus_type):bonus.bonus_type==BONUS_TYPE_GOLD?(item.item_type=database.BattleGainItemType.Gold,item.item_id=bonus.bonus_type):bonus.bonus_type==BONUS_TYPE_JADE?(item.item_type=database.BattleGainItemType.Jade,item.item_id=bonus.bonus_type):bonus.bonus_type==BONUS_TYPE_HEART?(item.item_type=database.BattleGainItemType.Heart,item.item_id=bonus.bonus_type):bonus.bonus_type==BONUS_TYPE_EVENT_POINT?(item.item_type=database.BattleGainItemType.EventPoint,item.item_id=bonus.bonus_type,item.item_count=bonus.min_value):bonus.bonus_type==BONUS_TYPE_USER_EXP?(item.item_type=database.BattleGainItemType.UserExp,item.item_id=bonus.bonus_type,item.item_count=bonus.min_value):bonus.bonus_type==BONUS_TYPE_SKIP_TICKET&&(item.item_type=database.BattleGainItemType.SkipTicket,item.item_id=bonus.bonus_type,item.item_count=bonus.min_value)}}}var instance;return{getInstance:function(){return void 0===instance&&(instance=new DailyDungeonService),instance}}}();var TutorialService=function(){var instance,m_user_tutorial_v2=new Map;function TutorialService(){}return TutorialService.prototype.add_User_tutorial_V2=function(tutorial_id,data){m_user_tutorial_v2.insert(tutorial_id,data)},TutorialService.prototype.getCompleteTutorialsV2=function(list){for(var keys=m_user_tutorial_v2.keys(),idx=0;idx<keys.length;idx++)list.push(m_user_tutorial_v2.at(keys[idx]));list.sort(function(l,r){return l.tutorial_id<r.tutorial_id?1:l.tutorial_id>r.tutorial_id?-1:0})},TutorialService.prototype.setCompleteTutorialV2=function(tuto){if(null==(tuto=$.extend({},m_user_tutorial_v2.at(tuto.tutorial_id)))){var m_tuto={};m_tuto.user_id=m_user_id,m_tuto.tutorial_id=tuto.tutorial_id,m_user_tutorial_v2.insert(m_tuto.tutorial_id,m_tuto)}},{getInstance:function(){return void 0===instance&&(instance=new TutorialService),instance}}}(),EQUIP_BOUND_CHECK_ALL=0,EQUIP_BOUND_CHECK_NORMAL=1,EQUIP_BOUND_CHECK_EXP=2,EquipmentService=function(){function EquipmentService(){}var instance;return EquipmentService.prototype.getEquipmentInventoryInfo=function(obj){var mt=MasterManager.getInstance(),gf=mt.get_GoodsFunction(9),bonus_type=gf.bonus_type,bt=mt.get_BonusType(bonus_type);obj.need_jade=gf.value,obj.bonus_type_name=bt.name},EquipmentService.prototype.getUserEquipmentCount=function(){return NetService().getUserEquipmentCount()},EquipmentService.prototype.getUserEquipmentBound=function(value,bonus_type_name){return NetService().get_User_Equipment_bound().at(m_user_id).user_equipment_bound},EquipmentService.prototype.isOverUserEquipmentBound=function(check_type){null==check_type&&(check_type=0);for(var user_bound=this.getUserEquipmentBound(),normal_equip_count=0,exp_equip_count=0,mt=MasterManager.getInstance(),m_user_equipment_item=NetService().get_User_Equipment_item(),keys=m_user_equipment_item.keys(),idx=0;idx<keys.length;idx++){var user_equip=m_user_equipment_item.at(keys[idx]);mt.get_EquipmentItem(user_equip.equipment_item_idx).equipment_type==EQUIPMENT_TYPE_EXP?exp_equip_count++:normal_equip_count++}var is_over=!1;switch(check_type){case EQUIP_BOUND_CHECK_NORMAL:user_bound<=normal_equip_count&&(is_over=!0);break;case EQUIP_BOUND_CHECK_EXP:user_bound<=exp_equip_count&&(is_over=!0);break;case EQUIP_BOUND_CHECK_ALL:default:(user_bound<=normal_equip_count||user_bound<=exp_equip_count)&&(is_over=!0)}return is_over},EquipmentService.prototype.getUserEquipmentListInfo=function(info,equip_tab_type,gnrl_key,except_wear,except_equip_id,except_equip_num,same_force_type){this.getUserEquipmentListInfoByType(EQUIPMENT_PARTS_ALL,info,equip_tab_type,gnrl_key,except_wear,except_equip_id,except_equip_num)},EquipmentService.prototype.getUserEquipmentListInfoByType=function(equip_parts_type,info,equip_tab_type,gnrl_key,except_wear,except_equip_id,except_equip_num,same_force_type){null==except_wear&&(except_wear=!1),null==except_equip_id&&(except_equip_id=0),null==except_equip_num&&(except_equip_num=0),null==same_force_type&&(same_force_type=0);var user_equipments=[];NetService().getUserEquipmentList(user_equipments);for(var mt=MasterManager.getInstance(),gnrl_list=[],gnrl_arm_service_type=ARMSERVICETYPE_NONE,isWorldwarOpen=WorldWarService.getInstance().isWorldWarPeriodOpen(),idx=0;idx<user_equipments.length;idx++){var equip=user_equipments[idx];if(!(1==except_wear&&("y"==equip.equip_yn||"y"==equip.lock_yn)||0<except_equip_id&&equip.equipment_item_idx==except_equip_id&&equip.equipment_num==except_equip_num)){if(!WorldWarService.getInstance().isWorldWarUnification()&&isWorldwarOpen&&except_wear){for(var world_war_equip_list=NetServiceV3.getInstance().get_list_User_World_War_General_Equipment_Item(),keys=world_war_equip_list.keys(),found_is=!1,i=0;i<keys.length;i++)if(equip.equipment_item_idx==world_war_equip_list[keys[i]].equipment_item_idx&&equip.equipment_num==world_war_equip_list[keys[i]].equip_num){found_is=!0,idx;break}if(1==found_is)continue}if(0<same_force_type)if(77777==equip.equipment_item_idx){if(gnrl_arm_service_type=ARMSERVICETYPE_NONE,0<(gnrl_list=MasterTable.getInstance().get_GeneralByGroup(equip.gnrl_group)).length&&(gnrl_arm_service_type=gnrl_list[0].arm_service_type),gnrl_arm_service_type!=ARMSERVICETYPE_NONE&&same_force_type!=gnrl_arm_service_type)continue}else if(equip.arm_service_type!=ARMSERVICETYPE_NONE&&same_force_type!=equip.arm_service_type)continue;var equip_item=mt.get_EquipmentItem(equip.equipment_item_idx);if(equip_tab_type==EQUIPMENT_TAB_NORMAL){if(equip_item.equipment_type==EQUIPMENT_TYPE_EXP)continue;if(equip_parts_type!=EQUIPMENT_PARTS_ALL&&equip_item.equipment_parts_type!=equip_parts_type)continue}else if(equip_tab_type==EQUIPMENT_TAB_MTRL&&equip_item.equipment_type!=EQUIPMENT_TYPE_EXP)continue;var user_equip=$.extend({},db.UserEquipment);this.getUserEquipmentInfoInternal(equip,user_equip,gnrl_key),info.push(user_equip)}}},EquipmentService.prototype.getUserEquipmentInfo=function(equip_key,info,gnrl_key){var user_equipment=NetService().getUserEquipment(equip_key);null!=user_equipment&&this.getUserEquipmentInfoInternal(user_equipment,info,gnrl_key)},EquipmentService.prototype.getUserEquipmentInfoInternal=function(user_equip_data,info,gnrl_key){var mt=MasterManager.getInstance();null==user_equip_data&&(user_equip_data={equipment_item_idx:0,equipment_num:0,level:0,exp:0,arm_service_type:0,step:0,combo_stat:0,stat_value:0,option_num1:0,option_num2:0,option_num3:0,option_num4:0,option_num5:0,equip_yn:0,lock_yn:0,base_stat_level_id:0,gnrl_group:0}),info.equip_id=user_equip_data.equipment_item_idx,info.equip_num=user_equip_data.equipment_num,info.level=user_equip_data.level,info.exp=user_equip_data.exp,info.arm_service_type=user_equip_data.arm_service_type,info.equip_step=user_equip_data.step,info.combo_stat=user_equip_data.combo_stat,info.stat_value=user_equip_data.stat_value,info.option_num1=user_equip_data.option_num1,info.option_num2=user_equip_data.option_num2,info.option_num3=user_equip_data.option_num3,info.option_num4=user_equip_data.option_num4,info.option_num5=user_equip_data.option_num5,info.equip_yn=user_equip_data.equip_yn,info.lock_yn=user_equip_data.lock_yn;var equip_item=mt.get_EquipmentItem(user_equip_data.equipment_item_idx);if(info.equip_name=equip_item.name,info.content=equip_item.content,info.image=equip_item.img,info.equip_type=equip_item.equipment_type,info.equip_parts_type=equip_item.equipment_parts_type,info.equip_rare_type=equip_item.equipment_rare_type,info.arm_service_group=equip_item.arm_service_idx,info.max_level=equip_item.max_level,info.equip_step_group=equip_item.equip_step_idx,info.gnrl_group=equip_item.gnrl_group,info.property_img=equip_item.property_img,0<equip_item.gnrl_group){var dedicated_equip=mt.get_EquipmentDedicatedInfo(equip_item.gnrl_group,user_equip_data.gnrl_group);if(info.gnrl_group=user_equip_data.gnrl_group,null!=gnrl_key)if(0<dedicated_equip.gnrl_group&&0<gnrl_key.gnrl_id){var gnrl_info=mt.get_General(gnrl_key.gnrl_id);info.same_gnrl_equip_yn=dedicated_equip.gnrl_group==gnrl_info.gnrl_group?"y":"n"}else info.same_gnrl_equip_yn="n";else info.same_gnrl_equip_yn="n"}else info.gnrl_group=equip_item.gnrl_group,info.same_gnrl_equip_yn="n";var equip_step_info=mt.get_EquipmentStepRate(info.equip_step_group,info.equip_step);info.exp_group=equip_step_info.exp_group,info.base_stat_group=equip_step_info.base_stat_idx,info.option_id1=0,info.option_id2=0,info.option_id3=0,info.option_id4=0,info.option_id5=0;dedicated_equip=mt.get_EquipmentDedicatedInfo(equip_item.gnrl_group,user_equip_data.gnrl_group);0!=info.option_num1&&(info.option_id1=equip_step_info.option1_idx,null!=(equip_option_info=mt.get_EquipmentItemOption(info.option_id1,info.option_num1))?(info.equip_group=equip_option_info.equip_group_idx,0<equip_item.gnrl_group?(info.equip_name=dedicated_equip.naming+equip_option_info.equip_name,info.image=dedicated_equip.img_num):(info.equip_name=equip_option_info.equip_name+info.equip_name,info.image=info.image+equip_option_info.img),info.symbol_id=equip_option_info.symbol_id,info.symbol_name_id=equip_option_info.symbol_name_id,info.frame_id=equip_option_info.frame_id):cc.log("option_id1 :"+info.option_id1+"      ///  option_num1:"+info.option_num1));if(0!=info.option_num2){info.option_id2=equip_step_info.option2_idx;var equip_option_info=mt.get_EquipmentItemOption(info.option_id2,info.option_num2);if(0<equip_item.gnrl_group){var base_stat_info=mt.get_EquipmentItemBaseStat(info.base_stat_group,user_equip_data.base_stat_level_id);info.equip_name=info.equip_name+equip_option_info.equip_name+base_stat_info.content+dedicated_equip.arm_name,info.image=dedicated_equip.img_num}}0!=info.option_num3&&(info.option_id3=equip_step_info.option3_idx),0!=info.option_num4&&(info.option_id4=equip_step_info.option4_idx),0!=info.option_num5&&(info.option_id5=equip_step_info.option5_idx)},EquipmentService.prototype.getUserGeneralEquipmentListInfo=function(key){var gnrl_key={};gnrl_key.gnrl_id=key.gnrl_id,gnrl_key.gnrl_num=key.gnrl_num;var user_gnrl_equipments=NetService().getUserGnrlEquipmentList(gnrl_key),info=[],mt=MasterManager.getInstance();if(null==user_gnrl_equipments)return info;for(var idx=0;idx<user_gnrl_equipments.length;idx++){var gnrl_equip=user_gnrl_equipments[idx],equip_item=mt.get_EquipmentItem(gnrl_equip.equipment_item_idx),user_gnrl_equip={};user_gnrl_equip.gnrl_id=key.gnrl_id,user_gnrl_equip.gnrl_num=key.gnrl_num,user_gnrl_equip.equip_id=gnrl_equip.equipment_item_idx,user_gnrl_equip.equip_num=gnrl_equip.equipment_num,user_gnrl_equip.equip_parts_type=equip_item.equipment_parts_type,user_gnrl_equip.image=equip_item.img,info.push(user_gnrl_equip)}return info},EquipmentService.prototype.getGeneralKeyforEquipment=function(equip_key){for(var gnrl_key={gnrl_id:0,gnrl_num:0},user_gnrl_equipment=NetService().get_user_gnrl_equipment(),keys=user_gnrl_equipment.keys(),idx=0;idx<keys.length;idx++)for(var equipment=user_gnrl_equipment.at(keys[idx]),jdx=0;jdx<equipment.length;jdx++)if(equipment[jdx].equipment_item_idx==equip_key.equipment_item_idx&&equipment[jdx].equipment_num==equip_key.equipment_num){gnrl_key.gnrl_id=equipment[jdx].gnrl_id,gnrl_key.gnrl_num=equipment[jdx].gnrl_num;break}return gnrl_key},EquipmentService.prototype.getEquipmentLevelInfo=function(equip_key,equip_level_info){for(var level=-1,step=0,m_user_equipment_item=NetService().get_User_Equipment_item(),keys=m_user_equipment_item.keys(),idx=0;idx<keys.length;idx++){var original=m_user_equipment_item.at(keys[idx]);if(original.equipment_item_idx==equip_key.equipment_item_idx&&original.equipment_num==equip_key.equipment_num&&(level=original.level,step=original.step),-1!=level){var mt=MasterManager.getInstance(),mt_equip=mt.get_EquipmentItem(equip_key.equipment_item_idx),mt_step=mt.get_EquipmentStepRate(mt_equip.equip_step_idx,step),mt_level=mt.get_EquipmentItemLevelupExp(mt_step.exp_group,level);equip_level_info.level=mt_level.level,equip_level_info.need_exp=mt_level.need_exp,equip_level_info.accum_exp=mt_level.accum_exp,equip_level_info.gain_mtrl_exp=mt_level.gain_mtrl_exp,equip_level_info.need_mtrl_gold=mt_level.need_mtrl_gold,equip_level_info.gain_sell_gold=mt_level.gain_sell_gold,equip_level_info.need_release_bonus_type=mt_level.need_release_bonus_type,equip_level_info.need_release_equip_value=mt_level.need_release_equip_value}}},EquipmentService.prototype.getEquipmentLevelupExpInternal=function(equip_key,es_equip_info){es_equip_info.level=-1,es_equip_info.step=0,es_equip_info.exp=0,es_equip_info.base_stat_level_id=0,es_equip_info.combo_stat=0;var equipment=NetService().get_User_Equipment_item().at([equip_key.equipment_item_idx,equip_key.equipment_num]);return null!=equipment&&(es_equip_info.level=equipment.level,es_equip_info.step=equipment.step,es_equip_info.exp=equipment.exp,es_equip_info.base_stat_level_id=equipment.base_stat_level_id,es_equip_info.combo_stat=equipment.combo_stat),-1!=es_equip_info.level},EquipmentService.prototype.getNextEquipLevelFromExp=function(equip_exp_idx,accum_exp,max_accum_exp){for(var next_level=0,list=[],m_equipment_item_level_exp=MasterManager.getInstance().get_All_get_EquipmentItemLevelupExp(),i=0;i<m_equipment_item_level_exp.length;i++){var exp=m_equipment_item_level_exp[i];exp.equip_exp_idx==equip_exp_idx&&exp.accum_exp<=accum_exp&&list.push(exp)}var max_exp=(list=stable(list,function(l,r){return l.level>r.level})).pop();return max_accum_exp=null==max_exp?(next_level=1,0):(next_level=max_exp.level,max_exp.accum_exp),{next_level:next_level,max_accum_exp:max_accum_exp}},EquipmentService.prototype.getFirstBaseStatValue=function(base_stat_idx,accum_exp,next_level){var level_idx,list=[],m_equipment_item_base_stat=MasterManager.getInstance().get_All_EquipmentItemBaseStat();for(var key in m_equipment_item_base_stat){var exp=MasterManager.getInstance().get_EquipmentItemBaseStat(key);exp.base_stat_idx==base_stat_idx&&list.push(exp)}return level_idx=(list=stable(list,function(l,r){return l.level_idx>r.level_idx})).pop().level_idx,MasterManager.getInstance().get_EquipmentItemBaseStatLevel(level_idx,next_level).min_value},EquipmentService.prototype.getBaseStatLevelId=function(base_stat_idx,level,combo_stat){MasterManager.getInstance().get_EquipmentItemBaseStat(base_stat_idx,level);var m_equipment_item_base_stat=MasterManager.getInstance().get_All_EquipmentItemBaseStat(),m_equipment_item_base_stat_level=MasterManager.getInstance().get_All_EquipmentItemBaseStatLevel();for(var key1 in m_equipment_item_base_stat){var base_stat=MasterManager.getInstance().get_EquipmentItemBaseStat(key1);for(var key2 in m_equipment_item_base_stat_level){var stat_level=MasterManager.getInstance().get_EquipmentItemBaseStatLevel(key2);base_stat.base_stat_idx==base_stat_idx&&base_stat.level_idx==stat_level.level_idx&&stat_level.combo_stat==combo_stat&&stat_level.level==level&&stat_level.level_idx}}},EquipmentService.prototype.getEquipmentLevelupExpPrcnt=function(equip_key){var es_equip_info={};if(1!=this.getEquipmentLevelupExpInternal(equip_key,es_equip_info))return 0;var mt=MasterManager.getInstance(),mt_equip=mt.get_EquipmentItem(equip_key.equipment_item_idx),mt_step=mt.get_EquipmentStepRate(mt_equip.equip_step_idx,es_equip_info.step),mt_level=mt.get_EquipmentItemLevelupExp(mt_step.exp_group,es_equip_info.level);if(es_equip_info.level>=mt_equip.max_level)return 1;var next_level=es_equip_info.level+1,level_gap=mt.get_EquipmentItemLevelupExp(mt_step.exp_group,next_level).need_exp,prcnt=(es_equip_info.exp-mt_level.accum_exp)/level_gap;return prcnt=Math.floor(1e3*prcnt)/1e3},EquipmentService.prototype.getExpectedEquipmentLevelupExpPrcnt=function(equip_key,gain_exp,expected_level,expected_stat_value){var es_equip_info={};if(1!=this.getEquipmentLevelupExpInternal(equip_key,es_equip_info))return{expected_level:expected_level,prcnt:prcnt,expected_stat_value:expected_stat_value};var mt=MasterManager.getInstance(),mt_equip=mt.get_EquipmentItem(equip_key.equipment_item_idx),mt_step=mt.get_EquipmentStepRate(mt_equip.equip_step_idx,es_equip_info.step),expected_exp=(mt.get_EquipmentItemLevelupExp(mt_step.exp_group,es_equip_info.level),es_equip_info.exp+gain_exp),max_accum_exp=0,level=this.getNextEquipLevelFromExp(mt_step.exp_group,expected_exp,max_accum_exp);expected_level=level.next_level,max_accum_exp=level.max_accum_exp,expected_level>=mt_equip.max_level&&max_accum_exp<expected_exp&&(expected_level=mt_equip.max_level,expected_exp=max_accum_exp),0==es_equip_info.base_stat_level_id&&(es_equip_info.base_stat_level_id=this.getBaseStatLevelId(mt_step.base_stat_idx,expected_level,es_equip_info.combo_stat));var mt_base_stat_level=mt.get_EquipmentItemBaseStatLevel(es_equip_info.base_stat_level_id,expected_level);if(null!=mt_base_stat_level&&(expected_stat_value=mt_base_stat_level.min_value),expected_level>=mt_equip.max_level)return{expected_level:expected_level,prcnt:1,expected_stat_value:expected_stat_value};var mt_expected_level=mt.get_EquipmentItemLevelupExp(mt_step.exp_group,expected_level),next_level=expected_level+1,level_gap=mt.get_EquipmentItemLevelupExp(mt_step.exp_group,next_level).need_exp,curr_gap=0;if(null!=mt_expected_level&&(curr_gap=expected_exp-mt_expected_level.accum_exp),0==level_gap)return{expected_level:expected_level,prcnt:0,expected_stat_value:expected_stat_value};var prcnt=curr_gap/level_gap;return{expected_level:expected_level,prcnt:prcnt=Math.floor(1e3*prcnt)/1e3,expected_stat_value:expected_stat_value}},EquipmentService.prototype.getFriendEquipentsOnGeneral=function(gnrl,equips){for(var m=MasterManager.getInstance(),idx=0;idx<equips.length;idx++){var ue=equips[idx],equip_key={};equip_key.equipment_item_idx=ue.equipment_item_idx,equip_key.equipment_num=ue.equipment_num;var user_equip={};this.getUserEquipmentInfo(equip_key,user_equip,{});var gnrl_equipment={};gnrl_equipment.equipment_item_idx=user_equip.equip_id,gnrl_equipment.equipment_num=user_equip.equip_num,gnrl_equipment.equipment_level=user_equip.level,gnrl_equipment.arm_service_type=user_equip.arm_service_type,gnrl_equipment.equipment_step=user_equip.equip_step,gnrl_equipment.combo_stat=user_equip.combo_stat,gnrl_equipment.stat_value=user_equip.stat_value,gnrl_equipment.option_num1=user_equip.option_num1,gnrl_equipment.option_num2=user_equip.option_num2,gnrl_equipment.option_num3=user_equip.option_num3,gnrl_equipment.option_num4=user_equip.option_num4,gnrl_equipment.option_num5=user_equip.option_num5,gnrl_equipment.equipment=m.get_EquipmentItem(gnrl_equipment.equipment_item_idx);var opt,step_rate=m.get_EquipmentStepRate(gnrl_equipment.equipment.equip_step_idx,gnrl_equipment.equipment_step);if(0!=gnrl_equipment.option_num1)(opt={}).equipment_item_idx=gnrl_equipment.equipment_item_idx,opt.equipment_step=gnrl_equipment.equipment_step,opt.option_num=gnrl_equipment.option_num1,opt.option=m.get_EquipmentItemOption(step_rate.option1_idx,opt.option_num),opt.option_level_info=m.get_EquipmentItemOptionLevel(opt.option.level_idx,gnrl_equipment.equipment_level),getEquipmentOptionDataForBattle(opt),gnrl_equipment.equipment_options.push_back(opt);if(0!=gnrl_equipment.option_num2)(opt={}).equipment_item_idx=gnrl_equipment.equipment_item_idx,opt.equipment_step=gnrl_equipment.equipment_step,opt.option_num=gnrl_equipment.option_num2,opt.option=m.get_EquipmentItemOption(step_rate.option2_idx,opt.option_num),opt.option_level_info=m.get_EquipmentItemOptionLevel(opt.option.level_idx,gnrl_equipment.equipment_level),getEquipmentOptionDataForBattle(opt),gnrl_equipment.equipment_options.push_back(opt);if(0!=gnrl_equipment.option_num3)(opt={}).equipment_item_idx=gnrl_equipment.equipment_item_idx,opt.equipment_step=gnrl_equipment.equipment_step,opt.option_num=gnrl_equipment.option_num3,opt.option=m.get_EquipmentItemOption(step_rate.option3_idx,opt.option_num),opt.option_level_info=m.get_EquipmentItemOptionLevel(opt.option.level_idx,gnrl_equipment.equipment_level),getEquipmentOptionDataForBattle(opt),gnrl_equipment.equipment_options.push_back(opt);if(0!=gnrl_equipment.option_num4)(opt={}).equipment_item_idx=gnrl_equipment.equipment_item_idx,opt.equipment_step=gnrl_equipment.equipment_step,opt.option_num=gnrl_equipment.option_num4,opt.option=m.get_EquipmentItemOption(step_rate.option4_idx,opt.option_num),opt.option_level_info=m.get_EquipmentItemOptionLevel(opt.option.level_idx,gnrl_equipment.equipment_level),this.getEquipmentOptionDataForBattle(opt),gnrl_equipment.equipment_options.push_back(opt);if(0!=gnrl_equipment.option_num5)(opt={}).equipment_item_idx=gnrl_equipment.equipment_item_idx,opt.equipment_step=gnrl_equipment.equipment_step,opt.option_num=gnrl_equipment.option_num5,opt.option=m.get_EquipmentItemOption(step_rate.option5_idx,opt.option_num),opt.option_level_info=m.get_EquipmentItemOptionLevel(opt.option.level_idx,gnrl_equipment.equipment_level),this.getEquipmentOptionDataForBattle(opt),gnrl_equipment.equipment_options.push_back(opt);gnrl.equipments.push_back(gnrl_equipment)}return!0},EquipmentService.prototype.getEquipmentsOnWorldWarGeneral=function(gnrl){var m=MasterManager.getInstance(),gnrl_key={};gnrl_key.gnrl_id=gnrl.gnrl_id,gnrl_key.gnrl_num=gnrl.gnrl_num;var user_gnrl_equipments=NetServiceV3.getInstance().getWorldWarUserGnrlEquipmentList(gnrl_key,user_gnrl_equipments);null==user_gnrl_equipments&&(user_gnrl_equipments=[]);for(var idx=0;idx<user_gnrl_equipments.length;idx++){var ue=user_gnrl_equipments[idx],equip_key={};equip_key.equipment_item_idx=ue.equipment_item_idx,equip_key.equipment_num=ue.equipment_num;var user_equip={},gnrl_key2={};gnrl_key2.gnrl_id=gnrl_key.gnrl_id,gnrl_key2.gnrl_num=gnrl_key.gnrl_num,this.getUserEquipmentInfo(equip_key,user_equip,gnrl_key2);var gnrl_equipment={};gnrl_equipment.equipment_item_idx=user_equip.equip_id,gnrl_equipment.equipment_num=user_equip.equip_num,gnrl_equipment.equipment_level=user_equip.level,gnrl_equipment.arm_service_type=user_equip.arm_service_type,gnrl_equipment.equipment_step=user_equip.equip_step,gnrl_equipment.combo_stat=user_equip.combo_stat,gnrl_equipment.stat_value=user_equip.stat_value,gnrl_equipment.option_num1=user_equip.option_num1,gnrl_equipment.option_num2=user_equip.option_num2,gnrl_equipment.option_num3=user_equip.option_num3,gnrl_equipment.option_num4=user_equip.option_num4,gnrl_equipment.option_num5=user_equip.option_num5,gnrl_equipment.equipment=m.get_EquipmentItem(gnrl_equipment.equipment_item_idx),gnrl_equipment.equipment_options=[];var step_rate=m.get_EquipmentStepRate(gnrl_equipment.equipment.equip_step_idx,gnrl_equipment.equipment_step);if(0!=gnrl_equipment.option_num1){var opt={};opt.equipment_item_idx=gnrl_equipment.equipment_item_idx,opt.equipment_step=gnrl_equipment.equipment_step,opt.option_num=gnrl_equipment.option_num1,opt.stats=[],opt.onetime_effects=[],opt.durability_effects=[],opt.passives=[],opt.option=m.get_EquipmentItemOption(step_rate.option1_idx,opt.option_num),opt.option_level_info=m.get_EquipmentItemOptionLevel(opt.option.level_idx,gnrl_equipment.equipment_level),gnrl_equipment.equip_group=opt.option.equip_group_idx,this.getEquipmentOptionDataForBattle(opt),gnrl_equipment.equipment_options.push(opt)}if(0!=gnrl_equipment.option_num2){var opt_num2={};opt_num2.equipment_item_idx=gnrl_equipment.equipment_item_idx,opt_num2.equipment_step=gnrl_equipment.equipment_step,opt_num2.option_num=gnrl_equipment.option_num2,opt_num2.stats=[],opt_num2.onetime_effects=[],opt_num2.durability_effects=[],opt_num2.passives=[],opt_num2.option=m.get_EquipmentItemOption(step_rate.option2_idx,opt_num2.option_num),null==opt_num2.option&&(opt_num2.option={level_idx:0}),opt_num2.option_level_info=m.get_EquipmentItemOptionLevel(opt_num2.option.level_idx,gnrl_equipment.equipment_level),this.getEquipmentOptionDataForBattle(opt_num2),gnrl_equipment.equipment_options.push(opt_num2)}if(0!=gnrl_equipment.option_num3){var opt_num3={};opt_num3.equipment_item_idx=gnrl_equipment.equipment_item_idx,opt_num3.equipment_step=gnrl_equipment.equipment_step,opt_num3.option_num=gnrl_equipment.option_num3,opt_num3.stats=[],opt_num3.onetime_effects=[],opt_num3.durability_effects=[],opt_num3.passives=[],opt_num3.option=m.get_EquipmentItemOption(step_rate.option3_idx,opt_num3.option_num),opt_num3.option_level_info=m.get_EquipmentItemOptionLevel(opt_num3.option.level_idx,gnrl_equipment.equipment_level),this.getEquipmentOptionDataForBattle(opt_num3),gnrl_equipment.equipment_options.push(opt_num3)}if(0!=gnrl_equipment.option_num4){var opt_num4={};opt_num4.equipment_item_idx=gnrl_equipment.equipment_item_idx,opt_num4.equipment_step=gnrl_equipment.equipment_step,opt_num4.option_num=gnrl_equipment.option_num4,opt_num4.stats=[],opt_num4.onetime_effects=[],opt_num4.durability_effects=[],opt_num4.passives=[],opt_num4.option=m.get_EquipmentItemOption(step_rate.option4_idx,opt_num4.option_num),opt_num4.option_level_info=m.get_EquipmentItemOptionLevel(opt_num4.option.level_idx,gnrl_equipment.equipment_level),this.getEquipmentOptionDataForBattle(opt_num4),gnrl_equipment.equipment_options.push(opt_num4)}if(0!=gnrl_equipment.option_num5){var opt_num5={};opt_num5.equipment_item_idx=gnrl_equipment.equipment_item_idx,opt_num5.equipment_step=gnrl_equipment.equipment_step,opt_num5.option_num=gnrl_equipment.option_num5,opt_num5.stats=[],opt_num5.onetime_effects=[],opt_num5.durability_effects=[],opt_num5.passives=[],opt_num5.option=m.get_EquipmentItemOption(step_rate.option5_idx,opt_num5.option_num),opt_num5.option_level_info=m.get_EquipmentItemOptionLevel(opt_num5.option.level_idx,gnrl_equipment.equipment_level),this.getEquipmentOptionDataForBattle(opt_num5),gnrl_equipment.equipment_options.push(opt_num5)}gnrl.equipments.push(gnrl_equipment)}return!0},EquipmentService.prototype.getEquipmentsOnGeneral=function(gnrl){var m=MasterManager.getInstance(),gnrl_key={};gnrl_key.gnrl_id=gnrl.gnrl_id,gnrl_key.gnrl_num=gnrl.gnrl_num;var user_gnrl_equipments=NetService().getUserGnrlEquipmentList(gnrl_key);null==user_gnrl_equipments&&(user_gnrl_equipments=[]);for(var idx=0;idx<user_gnrl_equipments.length;idx++){var ue=user_gnrl_equipments[idx],equip_key={};equip_key.equipment_item_idx=ue.equipment_item_idx,equip_key.equipment_num=ue.equipment_num;var user_equip={},gnrl_key2={};gnrl_key2.gnrl_id=gnrl_key.gnrl_id,gnrl_key2.gnrl_num=gnrl_key.gnrl_num,this.getUserEquipmentInfo(equip_key,user_equip,gnrl_key2);var gnrl_equipment={};gnrl_equipment.equipment_item_idx=user_equip.equip_id,gnrl_equipment.equipment_num=user_equip.equip_num,gnrl_equipment.equipment_level=user_equip.level,gnrl_equipment.arm_service_type=user_equip.arm_service_type,gnrl_equipment.equipment_step=user_equip.equip_step,gnrl_equipment.combo_stat=user_equip.combo_stat,gnrl_equipment.stat_value=user_equip.stat_value,gnrl_equipment.option_num1=user_equip.option_num1,gnrl_equipment.option_num2=user_equip.option_num2,gnrl_equipment.option_num3=user_equip.option_num3,gnrl_equipment.option_num4=user_equip.option_num4,gnrl_equipment.option_num5=user_equip.option_num5,gnrl_equipment.equipment=m.get_EquipmentItem(gnrl_equipment.equipment_item_idx),gnrl_equipment.equipment_options=[];var step_rate=m.get_EquipmentStepRate(gnrl_equipment.equipment.equip_step_idx,gnrl_equipment.equipment_step);if(0!=gnrl_equipment.option_num1){var opt={};opt.equipment_item_idx=gnrl_equipment.equipment_item_idx,opt.equipment_step=gnrl_equipment.equipment_step,opt.option_num=gnrl_equipment.option_num1,opt.stats=[],opt.onetime_effects=[],opt.durability_effects=[],opt.passives=[],opt.option=m.get_EquipmentItemOption(step_rate.option1_idx,opt.option_num),opt.option_level_info=m.get_EquipmentItemOptionLevel(opt.option.level_idx,gnrl_equipment.equipment_level),gnrl_equipment.equip_group=opt.option.equip_group_idx,this.getEquipmentOptionDataForBattle(opt),gnrl_equipment.equipment_options.push(opt)}if(0!=gnrl_equipment.option_num2){var opt_num2={};opt_num2.equipment_item_idx=gnrl_equipment.equipment_item_idx,opt_num2.equipment_step=gnrl_equipment.equipment_step,opt_num2.option_num=gnrl_equipment.option_num2,opt_num2.stats=[],opt_num2.onetime_effects=[],opt_num2.durability_effects=[],opt_num2.passives=[],opt_num2.option=m.get_EquipmentItemOption(step_rate.option2_idx,opt_num2.option_num),null==opt_num2.option&&(opt_num2.option={level_idx:0}),opt_num2.option_level_info=m.get_EquipmentItemOptionLevel(opt_num2.option.level_idx,gnrl_equipment.equipment_level),this.getEquipmentOptionDataForBattle(opt_num2),gnrl_equipment.equipment_options.push(opt_num2)}if(0!=gnrl_equipment.option_num3){var opt_num3={};opt_num3.equipment_item_idx=gnrl_equipment.equipment_item_idx,opt_num3.equipment_step=gnrl_equipment.equipment_step,opt_num3.option_num=gnrl_equipment.option_num3,opt_num3.stats=[],opt_num3.onetime_effects=[],opt_num3.durability_effects=[],opt_num3.passives=[],opt_num3.option=m.get_EquipmentItemOption(step_rate.option3_idx,opt_num3.option_num),opt_num3.option_level_info=m.get_EquipmentItemOptionLevel(opt_num3.option.level_idx,gnrl_equipment.equipment_level),this.getEquipmentOptionDataForBattle(opt_num3),gnrl_equipment.equipment_options.push(opt_num3)}if(0!=gnrl_equipment.option_num4){var opt_num4={};opt_num4.equipment_item_idx=gnrl_equipment.equipment_item_idx,opt_num4.equipment_step=gnrl_equipment.equipment_step,opt_num4.option_num=gnrl_equipment.option_num4,opt_num4.stats=[],opt_num4.onetime_effects=[],opt_num4.durability_effects=[],opt_num4.passives=[],opt_num4.option=m.get_EquipmentItemOption(step_rate.option4_idx,opt_num4.option_num),opt_num4.option_level_info=m.get_EquipmentItemOptionLevel(opt_num4.option.level_idx,gnrl_equipment.equipment_level),this.getEquipmentOptionDataForBattle(opt_num4),gnrl_equipment.equipment_options.push(opt_num4)}if(0!=gnrl_equipment.option_num5){var opt_num5={};opt_num5.equipment_item_idx=gnrl_equipment.equipment_item_idx,opt_num5.equipment_step=gnrl_equipment.equipment_step,opt_num5.option_num=gnrl_equipment.option_num5,opt_num5.stats=[],opt_num5.onetime_effects=[],opt_num5.durability_effects=[],opt_num5.passives=[],opt_num5.option=m.get_EquipmentItemOption(step_rate.option5_idx,opt_num5.option_num),opt_num5.option_level_info=m.get_EquipmentItemOptionLevel(opt_num5.option.level_idx,gnrl_equipment.equipment_level),this.getEquipmentOptionDataForBattle(opt_num5),gnrl_equipment.equipment_options.push(opt_num5)}gnrl.equipments.push(gnrl_equipment)}return!0},EquipmentService.prototype.getEquipmentOptionDataForBattle=function(opt){var m=MasterManager.getInstance();if(opt.opt_type=opt.option.equipment_option_inc_type,opt.opt_type==database.BattleEquipmentOptionType.OptStatType){if(0!=opt.option_level_info.combo_stat&&0!=opt.option_level_info.stat_value){var stat={};stat.combo_stat=opt.option_level_info.combo_stat,stat.stat_value=opt.option_level_info.stat_value,opt.stats.push(stat)}if(0!=opt.option_level_info.combo_stat_2&&0!=opt.option_level_info.stat_value_2){var stat2={};stat2.combo_stat=opt.option_level_info.combo_stat_2,stat2.stat_value=opt.option_level_info.stat_value_2,opt.stats.push_back(stat2)}}else if(opt.opt_type==database.BattleEquipmentOptionType.OptOnetimeEffectType){if(0!=opt.option_level_info.onetime_effect_idx){var eff=m.get_OnetimeEffect(opt.option_level_info.onetime_effect_idx),onetime={};BattleService.getInstance().convertOneTimeEffect(eff,onetime),opt.onetime_effects.push(onetime)}}else if(opt.opt_type==database.BattleEquipmentOptionType.OptDurabilityEffectType){if(0!=opt.option_level_info.durability_effect_idx){eff=m.get_DurabilityEffect(opt.option_level_info.durability_effect_idx);var dur={};BattleService.getInstance().convertDurabilityEffect(eff,dur),opt.durability_effects.push(dur)}}else if(opt.opt_type==database.BattleEquipmentOptionType.OptGainAmountType);else if(opt.opt_type==database.BattleEquipmentOptionType.OptEquipPassiveSkillType&&0!=opt.option_level_info.equip_passive_skill_idx){var passive=m.get_EquipmentPassiveSkill(opt.option_level_info.equip_passive_skill_idx);opt.passives.push(passive)}},EquipmentService.prototype.getEquipmentSkillContent=function(info,skill_list){0<info.option_num1&&this.getEquipmentSkillContent_V2(info.equip_id,info.level,info.option_num1,info.equip_step,1,skill_list),0<info.option_num2&&this.getEquipmentSkillContent_V2(info.equip_id,info.level,info.option_num2,info.equip_step,2,skill_list),0<info.option_num3&&this.getEquipmentSkillContent_V2(info.equip_id,info.level,info.option_num3,info.equip_step,3,skill_list),0<info.option_num4&&this.getEquipmentSkillContent_V2(info.equip_id,info.level,info.option_num1,info.equip_step,4,skill_list),0<info.option_num5&&this.getEquipmentSkillContent_V2(info.equip_id,info.level,info.option_num1,info.equip_step,5,skill_list)},EquipmentService.prototype.getEquipmentSkillContent_V2=function(equipment_item_idx,level,option_num,step,position,content){var mt=MasterManager.getInstance(),equip_step_idx=mt.get_EquipmentItem(equipment_item_idx).equip_step_idx,step_rate=mt.get_EquipmentStepRate(equip_step_idx,step),option_idx=0;switch(position){case 1:option_idx=step_rate.option1_idx;break;case 2:option_idx=step_rate.option2_idx;break;case 3:option_idx=step_rate.option3_idx}var equipment_option=mt.get_EquipmentItemOption(option_idx,option_num);null==equipment_option&&(equipment_option={level_idx:0});var equipment_option_level=mt.get_EquipmentItemOptionLevel(equipment_option.level_idx,level);null==equipment_option_level?content.push(""):content.push(equipment_option_level.content)},EquipmentService.prototype.checkNewOpenEquipmentSlot=function(gnrl_key,old_love_level){var gnrl_info={},net_gnrl_key={};net_gnrl_key.gnrl_id=gnrl_key.gnrl_id,net_gnrl_key.gnrl_num=gnrl_key.gnrl_num;gnrl_info=NetService().getUserGeneral(gnrl_info,net_gnrl_key);var old_equip_slot=MasterManager.getInstance().get_EquipmentReleaseSlot(old_love_level),new_equip_slot=MasterManager.getInstance().get_EquipmentReleaseSlot(gnrl_info.love_level);return old_equip_slot.release_slot<new_equip_slot.release_slot},EquipmentService.prototype.getEquipmentBuff=function(key,stat_type){var point=0,gnrl=(MasterManager.getInstance(),{});gnrl.gnrl_id=key.gnrl_id,gnrl.gnrl_num=key.gnrl_num,gnrl.equipments=[],this.getEquipmentsOnGeneral(gnrl);for(var idx=0;idx<gnrl.equipments.length;idx++){var equip=gnrl.equipments[idx];equip.combo_stat==stat_type&&(point+=equip.stat_value);for(var jdx=0;jdx<equip.equipment_options;jdx++){var opt=equip.equipment_options[idx];if(opt.opt_type==database.BattleEquipmentOptionType.OptStatType)for(var kdx=0;kdx<opt.stats.length;kdx++){var stat=opt.stats[kdx];stat.combo_stat==stat_type&&(point+=stat.stat_value)}}}return point},EquipmentService.prototype.getEquipmentSetGroupBuff=function(key,stat_type){var point=0,gnrl=(MasterTable.getInstance(),{});gnrl.gnrl_id=key.gnrl_id,gnrl.gnrl_num=key.gnrl_num,gnrl.equipments=[],gnrl.set_equipment_effect=[],this.getEquipmentsOnGeneral(gnrl);for(var set_item_count_map=new Map,idx=0;idx<gnrl.equipments.length;idx++){var e=gnrl.equipments[idx];if(0!=e.equip_group){for(var found=-1,keys=set_item_count_map.keys(),kdx=0;kdx<keys.length;kdx++){set_item_count_map.at(keys[kdx]);if(e.equip_group==keys[kdx]){found=keys[kdx];break}}if(-1!=found){var set_item=set_item_count_map.at(found);set_item+=1,set_item_count_map.insert(found,set_item)}else set_item_count_map.insert(e.equip_group,1)}}if(0<set_item_count_map.size())for(var jdx=0;jdx<set_item_count_map.length;jdx++){var grp=set_item_count_map[jdx];if(1<grp){var set_item_count=grp;3<set_item_count&&(set_item_count=3);var equip_set_info=MasterManager.getInstance().get_EquipmentGroup(jdx,set_item_count);0!=equip_set_info.equip_group_idx&&gnrl.set_equipment_effect.push(equip_set_info)}}for(var eIdx=0;eIdx<gnrl.set_equipment_effect.length;eIdx++){var set_eff=gnrl.set_equipment_effect[eIdx];set_eff.combo_stat==stat_type&&(point+=set_eff.added_value)}return point},{getInstance:function(){return void 0===instance&&(instance=new EquipmentService),instance}}}(),Shake=cc.ActionInterval.extend({m_initial_x:0,m_initial_y:0,m_strength_x:0,m_strength_y:0,ctor:function(duration,strength_x,strength_y){this._super(this),null==strength_y&&(strength_y=strength_x),this.initWithDuration(duration,strength_x,strength_y)},create:function(duration,strength){return this.create2(duration,strength,strength)},create2:function(duration,strength_x,strength_y){var pRet=new Shake;return pRet&&pRet.initWithDuration(duration,strength_x,strength_y)?pRet:pRet=null},initWithDuration:function(duration,strength_x,strength_y){return!!cc.ActionInterval.prototype.initWithDuration.call(this,duration)&&(this.m_strength_x=strength_x,this.m_strength_y=strength_y,!0)},update:function(dt){var randx=Math.random()*(this.m_strength_x- -this.m_strength_x)-this.m_strength_x,randy=Math.random()*(this.m_strength_y- -this.m_strength_y)-this.m_strength_y,pos=cc.p(this.m_initial_x,this.m_initial_y),pos2=cc.p(randx,randy);pos=cc.pAdd(pos,pos2),this.getTarget().setPosition(pos)},startWithTarget:function(pTarget){cc.ActionInterval.prototype.startWithTarget.call(this,pTarget),this.m_initial_x=pTarget.getPosition().x,this.m_initial_y=pTarget.getPosition().y},stop:function(){this.getTarget().setPosition(this.m_initial_x,this.m_initial_y),cc.Action.prototype.stop.call(this)}}),BattleEquipment=cc.Class.extend({m_battle_general:null,m_general:null,ctor:function(){},setBattleGeneralData:function(gnrl){this.m_general=gnrl,this.m_battle_general=this.m_general.getGeneral()},getEquipmentBuff:function(stat_type){for(var point=0,idx=0;idx<this.m_battle_general.equipments.length;idx++){var equip=this.m_battle_general.equipments[idx];equip.combo_stat==stat_type&&(point+=equip.stat_value)}return point},getEquipmentOptionStatBuff:function(stat_type){for(var point=0,idx=0;idx<this.m_battle_general.equipments.length;idx++)for(var equip=this.m_battle_general.equipments[idx],jdx=0;jdx<equip.equipment_options.length;jdx++){var opt=equip.equipment_options[jdx];0!=opt.option.wear_arm_service_type&&opt.option.wear_arm_service_type!=this.m_battle_general.general.arm_service_type||(0!=opt.option.wear_element_type&&opt.option.wear_element_type!=this.m_battle_general.general.element_type||0!=opt.option.wear_fight_type&&opt.option.wear_fight_type!=this.m_battle_general.general.fight_type||0!=opt.option.wear_state_type&&opt.option.wear_state_type!=this.m_battle_general.general.state_type||opt.option.invoke_type==database.BattleInvokeType.BattleInvokeType_Always&&opt.opt_type==database.BattleEquipmentOptionType.OptStatType&&(opt.option_level_info.combo_stat==stat_type&&(point+=opt.option_level_info.stat_value),opt.option_level_info.combo_stat_2==stat_type&&(point+=opt.option_level_info.stat_value_2)))}return point},getEquipmentPassiveBuff:function(target,invoke_type,stat_type){for(var point=0,idx=0;idx<this.m_battle_general.equipments.length;idx++)for(var equip=this.m_battle_general.equipments[idx],jdx=0;jdx<equip.equipment_options.length;jdx++){var opt=equip.equipment_options[jdx];if((0==opt.option.wear_arm_service_type||opt.option.wear_arm_service_type==this.m_battle_general.general.arm_service_type)&&((0==opt.option.wear_element_type||opt.option.wear_element_type==this.m_battle_general.general.element_type)&&!(0!=opt.option.wear_fight_type&&opt.option.wear_fight_type!=this.m_battle_general.general.fight_type||0!=opt.option.wear_state_type&&opt.option.wear_state_type!=this.m_battle_general.general.state_type||0!=opt.option.apply_arm_service_type&&opt.option.apply_arm_service_type!=target.general.arm_service_type||0!=opt.option.apply_element_type&&opt.option.apply_element_type!=target.general.element_type||0!=opt.option.apply_fight_type&&opt.option.apply_fight_type!=target.general.fight_type||0!=opt.option.apply_state_type&&opt.option.apply_state_type!=target.general.state_type||opt.option.invoke_type!=invoke_type||opt.opt_type!=database.BattleEquipmentOptionType.OptEquipPassiveSkillType)))for(var kdx=0;kdx<opt.passives.length;kdx++){var p=opt.passives[kdx];stat_type==database.BattleChainStatType.ChainStatType_After_Send_Damage_Rate?point+=p.inc_to_damage:stat_type==database.BattleChainStatType.ChainStatType_After_Recv_Damage_Dec_Rate&&(point+=p.dec_from_damage)}}return point},getEquipmentSetGroupBuff:function(stat_type){for(var point=0,idx=0;idx<this.m_battle_general.set_equipment_effect.length;idx++){var set_eff=this.m_battle_general.set_equipment_effect[idx];set_eff.combo_stat==stat_type&&(point+=set_eff.added_value)}return point},getEquipmentOnetimeEffect:function(target,invoke_type,effs){for(var idx=0;idx<this.m_battle_general.equipments.length;idx++)for(var equip=this.m_battle_general.equipments[idx],jdx=0;jdx<equip.equipment_options.length;jdx++){var opt=equip.equipment_options[jdx];if((0==opt.option.wear_arm_service_type||opt.option.wear_arm_service_type==this.m_battle_general.general.arm_service_type)&&((0==opt.option.wear_element_type||opt.option.wear_element_type==this.m_battle_general.general.element_type)&&!(0!=opt.option.wear_fight_type&&opt.option.wear_fight_type!=this.m_battle_general.general.fight_type||0!=opt.option.wear_state_type&&opt.option.wear_state_type!=this.m_battle_general.general.state_type||0!=opt.option.apply_arm_service_type&&opt.option.apply_arm_service_type!=target.general.arm_service_type||0!=opt.option.apply_element_type&&opt.option.apply_element_type!=target.general.element_type||0!=opt.option.apply_fight_type&&opt.option.apply_fight_type!=target.general.fight_type||0!=opt.option.apply_state_type&&opt.option.apply_state_type!=target.general.state_type||opt.option.invoke_type!=invoke_type)))for(var kdx=0;kdx<opt.onetime_effects.length;kdx++){var o=opt.onetime_effects[kdx];effs.push(o)}}},getEquipmentDurabilityEffect:function(target,invoke_type,effs){for(var idx=0;idx<this.m_battle_general.equipments.length;idx++)for(var equip=this.m_battle_general.equipments[idx],jdx=0;jdx<equip.equipment_options.length;jdx++){var opt=equip.equipment_options[jdx];if((0==opt.option.wear_arm_service_type||opt.option.wear_arm_service_type==this.m_battle_general.general.arm_service_type)&&((0==opt.option.wear_element_type||opt.option.wear_element_type==this.m_battle_general.general.element_type)&&!(0!=opt.option.wear_fight_type&&opt.option.wear_fight_type!=this.m_battle_general.general.fight_type||0!=opt.option.wear_state_type&&opt.option.wear_state_type!=this.m_battle_general.general.state_type||0!=opt.option.apply_arm_service_type&&opt.option.apply_arm_service_type!=target.general.arm_service_type||0!=opt.option.apply_element_type&&opt.option.apply_element_type!=target.general.element_type||0!=opt.option.apply_fight_type&&opt.option.apply_fight_type!=target.general.fight_type||0!=opt.option.apply_state_type&&opt.option.apply_state_type!=target.general.state_type||opt.option.invoke_type!=invoke_type)))for(var kdx=0;kdx<opt.durability_effects.length;kdx++){var o=opt.durability_effects[kdx];effs.push(o)}}}});battle.Event=cc.Class.extend({name:null,boolValue:!1,intValue:0,floatValue:0,stringValue:null,dataValue1:null,dataValue2:null,dataValues:[],ctor:function(){this.dataValues=[]}});var WorldWarService,Hit_Attack_Type={NONE:0,ATTACK_1:1,ATTACK_2:2,ATTACK_3:3,SKILL:4,ONE_TIME_EFFECT:5,DEATH_TRANS_PASSIVE:6,BLOOD_SUCKING:7},Search_type={ENERMY_GENERAL_SAME_ELEMENT_COUNT:0,OUR_GENERAL_SAME_ELEMENT_COUNT:1},BattlePassiveType={Passive_Target_Type_All_Member:0,Passive_Target_Type_Our_Team_Member:1,Passive_Target_Type_Enemy_Team_member:2},Damage=cc.Class.extend({gnrl_id:0,damage_type:database.DamageType.Normal,element_type:0,origin_damage:0,damage:0,shared_point:0,hit_point:0,is_element_trans_buf:!1,attk_element_type_buf:0,element_adv_type:0,onetime_effects:null,durability_effects:null,attack_type:Hit_Attack_Type.NONE,is_first_hit:!1,is_ignore_guard_rate:!1,is_evasion:!1,is_last_hit:!1,ctor:function(){this.gnrl_id=0,this.damage_type=database.DamageType.Normal,this.element_type=0,this.origin_damage=0,this.damage=0,this.shared_point=0,this.hit_point=0,this.is_element_trans_buf=!1,this.attk_element_type_buf=0,this.element_adv_type=0,this.onetime_effects=[],this.durability_effects=[],this.attack_type=Hit_Attack_Type.NONE,this.is_first_hit=!1,this.is_ignore_guard_rate=!1,this.is_evasion=!1,this.is_last_hit=!1},cClear:function(){this.damage_type=null,this.onetime_effects=null,this.durability_effects=null,this.attack_type=null}}),Cure=cc.Class.extend({gnrl_id:0,damage:0,origin_damage:0,share_point:0,onetime_effects:[],durability_effects:[],is_sub_skill:!1,ctor:function(){this.gnrl_id=0,this.damage=0,this.origin_damage=0,this.share_point=0,this.onetime_effects=[],this.durability_effects=[],this.is_sub_skill=!1}}),DamageLog=cc.Class.extend({_attk_name:null,_def_name:null,_max_life:0,_cur_life:0,_origin_damage:0,_damage:0,_def_point:0,_def_rate:0,_is_guard_success:!1,_guard_rate:0,_guard_dec:0,_shared_point:0,_cri_power:0,_buf_cri_power_rate:0,_attaker_limit_step:0,_base_element_type:0,_target_element_type:0,_element_type_buf:0,_skill_element_trans_buf:!1,_attack_time:0,_damage_type:database.DamageType.Normal,_attack_type:Hit_Attack_Type.NONE,_trans_resist_value:0,_time:null,_team_type:0,_is_selected:!1,_is_miss:!1,ctor:function(){this._attk_name=null,this._def_name=null,this._max_life=0,this._cur_life=0,this._origin_damage=0,this._damage=0,this._def_point=0,this._def_rate=0,this._is_guard_success=!1,this._guard_rate=0,this._guard_dec=0,this._shared_point=0,this._cri_power=0,this._buf_cri_power_rate=0,this._attaker_limit_step=0,this._base_element_type=0,this._target_element_type=0,this._element_type_buf=0,this._skill_element_trans_buf=!1,this._attack_time=0,this._damage_type=database.DamageType.Normal,this._attack_type=Hit_Attack_Type.NONE,this._trans_resist_value=0,this._time=null,this._team_type=0,this._is_selected=!1,this._is_miss=!1}}),BuffSkillType={None:0,Cure:1,Heal:2,Buf:3,Cooltime:4},FOCUS_STATE={NONE:0,FOCUS:1,FOCUS_SKILL:2,UNFOCUS:3},EventCode={EVT_FIELD_MNG_START:9e4,EVT_FIELD_MNG_DAMAGE_SHOW:90001,EVT_FIELD_MNG_SHAKE:90002,EVT_FIELD_MNG_EMERGENCY:90003,EVT_FIELD_MNG_CHANGE_BG_COLOR:90004,EVT_FIELD_MNG_DROP_ITEM:90005,EVT_FIELD_MNG_CHANGE_BG_BEGIN:90006,EVT_FIELD_MNG_CHANGE_BG_END:90007,EVT_FIELD_MNG_ENEMY_HIDE_BEGIN:90008,EVT_FIELD_MNG_ENEMY_HIDE_END:90009,EVT_FIELD_MNG_GNRL_DEATH_AT:90010,EVT_TEAM_MNG_START:91e3,EVT_UI_MNG_START:92e3,EVT_UI_MNG_HITTED:92001,EVT_UI_MNG_DEATH:92002,EVT_UI_MNG_SKILL_START:92003,EVT_UI_MNG_SKILL_END:92004},BattleGeneral_GeneralState={None:0,Idle:1,Idle2:2,Idle_Revision:3,Dash:4,Run:5,Find:6,Attack_Ready:7,Attack:8,Skill_Ready:9,Skill:10,Away:11,Stun:12,Sleep:13,Freeze:14,RaidTimeover:15,MussangBossTimeOver:16,Wait:17,Return:18,Death_Ready:19,Death:20,Death_Anim:21,End:22},BattleGeneral_TeamType={Left:0,Right:1},BattleFxPartArray=[["effect/Common_fx_appear.atlas","effect/Common_fx_appear.json",["effect/Common_fx_appear.png"],"fx_appear",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!1,!0],["effect/Common_fx_stun.atlas","effect/Common_fx_stun.json",["effect/Common_fx_stun.png"],"fx_stun",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BAR,!0,!0],["effect/Common_fx_sleep.atlas","effect/Common_fx_sleep.json",["effect/Common_fx_sleep.png"],"fx_sleep",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BAR,!0,!1],["effect/Common_fx_freeze.atlas","effect/Common_fx_freeze.json",["effect/Common_fx_freeze.png"],"fx_freeze",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!0,!0],["effect/Common_fx_freeze.atlas","effect/Common_fx_freeze.json",["effect/Common_fx_freeze.png"],"fx_freeze_end",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!1,!0],["effect/Common_fx_snowman.atlas","effect/Common_fx_snowman.json",["effect/Common_fx_snowman.png"],"fx_freeze_snowman",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!0,!0],["effect/Common_fx_snowman.atlas","effect/Common_fx_snowman.json",["effect/Common_fx_snowman.png"],"fx_freeze_end_snowman",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!1,!0],["effect/Common_fx_healing.atlas","effect/Common_fx_healing.json",["effect/Common_fx_healing.png"],"fx_healing",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!1,!0],["effect/Common_fx_poison.atlas","effect/Common_fx_poison.json",["effect/Common_fx_poison.png"],"fx_poison",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!0,!0],["effect/Common_fx_burns.atlas","effect/Common_fx_burns.json",["effect/Common_fx_burns.png"],"fx_burn",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!0,!0],["effect/Common_fx_sealed.atlas","effect/Common_fx_sealed.json",["effect/Common_fx_sealed.png"],"fx_sealed",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_CENTER,!1,!0],["effect/Common_fx_counter_attack.atlas","effect/Common_fx_counter_attack.json",["effect/Common_fx_counter_attack.png"],"fx_counter",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!1,!0],["effect/Silence_loop.atlas","effect/Silence_loop.json",["effect/Silence_loop.png"],"fx_silence",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_HEAD_BACKWARD,!0,!0],["effect/Common_fx_electricshock.atlas","effect/Common_fx_electricshock.json",["effect/Common_fx_electricshock.png"],"fx_electricshock",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!0,!0],["effect/Common_fx_bleeding.atlas","effect/Common_fx_bleeding.json",["effect/Common_fx_bleeding.png"],"fx_bleeding",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!0,!0],["effect/Common_fx_lithify.atlas","effect/Common_fx_lithify.json",["effect/Common_fx_lithify.png"],"fx_stone",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!0,!0],["effect/Common_fx_lithify.atlas","effect/Common_fx_lithify.json",["effect/Common_fx_lithify.png"],"fx_stone_end",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!0,!0],["effect/Common_fx_defence.atlas","effect/Common_fx_defence.json",["effect/Common_fx_defence.png"],"fx_defence",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_CENTER,!0,!0],["effect/Common_fx_superarmor.atlas","effect/Common_fx_superarmor.json",["effect/Common_fx_superarmor.png"],"fx_superarmor",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!0,!0],["effect/Common_fx_offence.atlas","effect/Common_fx_offence.json",["effect/Common_fx_offence.png"],"fx_offence",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!0,!0],["effect/Common_fx_weaponbreak.atlas","effect/Common_fx_weaponbreak.json",["effect/Common_fx_weaponbreak.png"],"fx_weaponbreak",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_CENTER,!1,!0],["effect/Common_fx_armorbreak.atlas","effect/Common_fx_armorbreak.json",["effect/Common_fx_armorbreak.png"],"fx_armorbreak",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_CENTER,!1,!0],["effect/Common_fx_guardcrush.atlas","effect/Common_fx_guardcrush.json",["effect/Common_fx_guardcrush.png"],"fx_guardbreak",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_CENTER,!1,!0],["effect/Common_fx_aura.atlas","effect/Common_fx_aura.json",["effect/Common_fx_aura.png"],"fx_aura",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!0,!0],["effect/Common_fx_leader.atlas","effect/Common_fx_leader.json",["effect/Common_fx_leader.png"],"fx_leader",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!0,!0],["effect/Common_fx_boss.atlas","effect/Common_fx_boss.json",["effect/Common_fx_boss.png"],"fx_boss",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!0,!0],["effect/Attribute_fire.atlas","effect/Attribute_fire.json",["effect/Attribute_fire.png"],"fx_fire",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_HEAD_FORWARD,!0,!0],["effect/Attribute_water.atlas","effect/Attribute_water.json",["effect/Attribute_water.png"],"fx_water",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_HEAD_FORWARD,!0,!0],["effect/Attribute_wind.atlas","effect/Attribute_wind.json",["effect/Attribute_wind.png"],"fx_wind",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_HEAD_FORWARD,!0,!0],["effect/Attribute_light.atlas","effect/Attribute_light.json",["effect/Attribute_light.png"],"fx_light",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_HEAD_FORWARD,!0,!0],["effect/Attribute_dark.atlas","effect/Attribute_dark.json",["effect/Attribute_dark.png"],"fx_dark",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_HEAD_FORWARD,!0,!0],["effect/Common_fx_buff.atlas","effect/Common_fx_buff.json",["effect/Common_fx_buff.png"],"fx_buff",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!1,!0],["effect/Common_fx_cure.atlas","effect/Common_fx_cure.json",["effect/Common_fx_cure.png"],"fx_cure",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!1,!0],["effect/Common_fx_heal.atlas","effect/Common_fx_heal.json",["effect/Common_fx_heal.png"],"fx_heal",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!1,!0],["effect/Common_fx_offence.atlas","effect/Common_fx_offence.json",["effect/Common_fx_offence.png"],"fx_active_inc",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!0,!0],["effect/Hajin_fx_kill_fx.atlas","effect/Hajin_fx_kill_fx.json",["effect/Hajin_fx_kill_fx.png","effect/Hajin_fx_kill_fx2.png"],"fx_hajin_kill",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_CENTER,!1,!0],["effect/Common_fx_weaponbreak.atlas","effect/Common_fx_weaponbreak.json",["effect/Common_fx_weaponbreak.png"],"fx_active_dec",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_CENTER,!1,!0],["effect/Common_fx_fever.atlas","effect/Common_fx_fever.json",["effect/Common_fx_fever.png"],"fx_fever",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!0,!0],["effect/common_fx_cursed.atlas","effect/common_fx_cursed.json",["effect/common_fx_cursed.png"],"fx_cursed",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_CENTER,!0,!0],["effect/Common_fx_provoke.atlas","effect/Common_fx_provoke.json",["effect/Common_fx_provoke.png"],"fx_provoke",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!0,!0],["effect/Common_fx_slow_heal.atlas","effect/Common_fx_slow_heal.json",["effect/Common_fx_slow_heal.png"],"fx_slow_heal",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!0,!0],["effect/Common_fx_Invisible_effect.atlas","effect/Common_fx_Invisible_effect.json",["effect/Common_fx_Invisible_effect.png"],"fx_invisible_effect",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!0,!0],["effect/Common_fx_immune_debuff.atlas","effect/Common_fx_immune_debuff.json",["effect/Common_fx_immune_debuff.png"],"fx_immune_debuff",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!0,!0],["effect/Common_fx_ignores_defense.atlas","effect/Common_fx_ignores_defense.json",["effect/Common_fx_ignores_defense.png"],"fx_ignores_defense",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!0,!0],["effect/Common_fx_shield_of_flame.atlas","effect/Common_fx_shield_of_flame.json",["effect/Common_fx_shield_of_flame.png"],"fx_flame_shield",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!0,!0],["effect/Bangtong_Haloween17_curse_of_pumpkin.atlas","effect/Bangtong_Haloween17_curse_of_pumpkin.json",["effect/Bangtong_Haloween17_curse_of_pumpkin.png"],"Bangtong_Haloween17_curse_of_pumpkin",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!0,!0],["effect/Bangtong_Haloween17_pumpkin_bomb.atlas","effect/Bangtong_Haloween17_pumpkin_bomb.json",["effect/Bangtong_Haloween17_pumpkin_bomb.png"],"Bangtong_Haloween17_pumpkin_bomb",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_TOP,!0,!0],["effect/Bangtong_Haloween17_pumpkin_bomb.atlas","effect/Bangtong_Haloween17_pumpkin_bomb.json",["effect/Bangtong_Haloween17_pumpkin_bomb.png"],"Bangtong_Haloween17_pumpkin_bomb_end",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_TOP,!0,!0],["effect/Bangtong_Haloween17_skill_charging.atlas","effect/Bangtong_Haloween17_skill_charging.json",["effect/Bangtong_Haloween17_skill_charging.png"],"Bangtong_Haloween17_skill_charging",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!1,!0],["effect/Yeomong_Halloween17_ghost_defence.atlas","effect/Yeomong_Halloween17_ghost_defence.json",["effect/Yeomong_Halloween17_ghost_defence.png"],"Yeomong_Halloween17_ghost_defence",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!1,!0],["effect/Common_fx_blind.atlas","effect/Common_fx_blind.json",["effect/Common_fx_blind.png"],"fx_blind",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_TOP,!0,!0],["effect/Common_fx_wound.atlas","effect/Common_fx_wound.json",["effect/Common_fx_wound.png"],"fx_wound",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_TOP,!0,!0],["effect/Jungwook_Xmas17_giftbox_bomb.atlas","effect/Jungwook_Xmas17_giftbox_bomb.json",["effect/Jungwook_Xmas17_giftbox_bomb.png"],"Jungwook_Xmas17_giftbox_bomb",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_HEAD_FORWARD,!0,!0],["effect/Jungwook_Xmas17_giftbox_bomb.atlas","effect/Jungwook_Xmas17_giftbox_bomb.json",["effect/Jungwook_Xmas17_giftbox_bomb.png"],"Jungwook_Xmas17_giftbox_bomb_end",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_HEAD_FORWARD,!1,!0],["effect/Common_fx_alleviation.atlas","effect/Common_fx_alleviation.json",["effect/Common_fx_alleviation.png"],"fx_alleviation",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!0,!0],["effect/Common_fx_shield_of_wind.atlas","effect/Common_fx_shield_of_wind.json",["effect/Common_fx_shield_of_wind.png"],"fx_shield_of_wind",database.FxLayerType.FxLayer_PersnalSkillHitLayer,FX_POS_BASE,!0,!0],["effect/Bangtong_Suit18_fx_debuff.atlas","effect/Bangtong_Suit18_fx_debuff.json",["effect/Bangtong_Suit18_fx_debuff.png"],"Bangtong_Suit18_fx_debuff",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_HEAD_FORWARD,!0,!0],["effect/Jegalryang_Hero_fx_fan_defence.atlas","effect/Jegalryang_Hero_fx_fan_defence.json",["effect/Jegalryang_Hero_fx_fan_defence.png"],"Jegalryang_Hero_fx_fan_defence",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!1,!0],["effect/Gwanwoo_Dress_fx_buff_flowerguard.atlas","effect/Gwanwoo_Dress_fx_buff_flowerguard.json",["effect/Gwanwoo_Dress_fx_buff_flowerguard.png"],"Gwanwoo_Dress_fx_buff_flowerguard",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!1,!0],["effect/Hwawoong_Maid18_fx_eternal.atlas","effect/Hwawoong_Maid18_fx_eternal.json",["effect/Hwawoong_Maid18_fx_eternal.png","effect/Hwawoong_Maid18_fx_eternal2.png"],"Hwawoong_Maid18_fx_eternal",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!0,!0],["effect/Hwanggae_Swim18_fx_hako_bomb.atlas","effect/Hwanggae_Swim18_fx_hako_bomb.json",["effect/Hwanggae_Swim18_fx_hako_bomb.png"],"Hwanggae_Swim18_fx_hako_bomb",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_HEAD_FORWARD,!1,!0],["effect/Hwanggae_Swim18_fx_hako.atlas","effect/Hwanggae_Swim18_fx_hako.json",["effect/Hwanggae_Swim18_fx_hako.png"],"Hwanggae_Swim18_fx_hako",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_HEAD_FORWARD,!0,!0],["effect/Hina_fx_skill_death.atlas","effect/Hina_fx_skill_death.json",["effect/Hina_fx_skill_death.png","effect/Hina_fx_skill_death2.png"],"Hina_fx_skill_death",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!1,!0],["effect/Common_fx_invincibility.atlas","effect/Common_fx_invincibility.json",["effect/Common_fx_invincibility.png"],"Common_fx_invincibility",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!0,!0],["effect/Yubi_China_fx_buff_tenpai.atlas","effect/Yubi_China_fx_buff_tenpai.json",["effect/Yubi_China_fx_buff_tenpai.png"],"Yubi_China_fx_buff_tenpai",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!0,!0],["effect/Yubi_China_fx_buff_ron.atlas","effect/Yubi_China_fx_buff_ron.json",["effect/Yubi_China_fx_buff_ron.png"],"Yubi_China_fx_buff_ron",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!1,!1],["effect/Jojo_China_fx_pong.atlas","effect/Jojo_China_fx_pong.json",["effect/Jojo_China_fx_pong.png"],"Jojo_China_fx_pong",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!1,!1],["effect/Jochung_fx_death.atlas","effect/Jochung_fx_death.json",["effect/Jochung_fx_death.png"],"Jochung_fx_death",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!1,!0],["effect/Seowhang_Halloween19_fx_kill_fx.atlas","effect/Seowhang_Halloween19_fx_kill_fx.json",["effect/Seowhang_Halloween19_fx_kill_fx.png"],"Seowhang_Halloween19_fx_kill_fx",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!1,!0],["effect/Sonkwon_Blackened_fx_shield_of_darkness.atlas","effect/Sonkwon_Blackened_fx_shield_of_darkness.json",["effect/Sonkwon_Blackened_fx_shield_of_darkness.png"],"Sonkwon_Blackened_fx_shield_of_darkness",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!0,!0],["effect/Sonkwon_Blackened_fx_breaking_shield.atlas","effect/Sonkwon_Blackened_fx_breaking_shield.json",["effect/Sonkwon_Blackened_fx_breaking_shield.png","effect/Sonkwon_Blackened_fx_breaking_shield2.png"],"Sonkwon_Blackened_fx_breaking_shield",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!1,!0],["effect/Yubi_Concert_fx_skill_sing.atlas","effect/Yubi_Concert_fx_skill_sing.json",["effect/Yubi_Concert_fx_skill_sing.png"],"Yubi_Concert_fx_skill_sing",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!0,!0],["effect/Macheol_Xmas19_fx_tree.atlas","effect/Macheol_Xmas19_fx_tree.json",["effect/Macheol_Xmas19_fx_tree.png"],"Macheol_Xmas19_fx_tree",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!0,!0],["effect/Sonsanghyang_Xmas19_fx_tree.atlas","effect/Sonsanghyang_Xmas19_fx_tree.json",["effect/Sonsanghyang_Xmas19_fx_tree.png"],"Sonsanghyang_Xmas19_fx_tree",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!0,!0],["effect/Heonje_NY20_fx_otoshidama_bomb.atlas","effect/Heonje_NY20_fx_otoshidama_bomb.json",["effect/Heonje_NY20_fx_otoshidama_bomb.png"],"Heonje_NY20_fx_otoshidama_bomb",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_TOP,!1,!0],["effect/Heonje_NY20_fx_otoshidama.atlas","effect/Heonje_NY20_fx_otoshidama.json",["effect/Heonje_NY20_fx_otoshidama.png"],"Heonje_NY20_fx_otoshidama",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_TOP,!0,!0],["effect/Sonkwon_Concert_fx_sing.atlas","effect/Sonkwon_Concert_fx_sing.json",["effect/Sonkwon_Concert_fx_sing.png","effect/Sonkwon_Concert_fx_sing2.png"],"Sonkwon_Concert_fx_sing",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!0,!0],["effect/Jegalryang_VD20_fx_Chocolat_bomb.atlas","effect/Jegalryang_VD20_fx_Chocolat_bomb.json",["effect/Jegalryang_VD20_fx_Chocolat_bomb.png","Jegalryang_VD20_fx_Chocolat_bomb2.png"],"Jegalryang_VD20_fx_Chocolat_bomb",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_TOP,!1,!0],["effect/Jegalryang_VD20_fx_Chocolat.atlas","effect/Jegalryang_VD20_fx_Chocolat.json",["effect/Jegalryang_VD20_fx_Chocolat.png"],"Jegalryang_VD20_fx_Chocolat",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_TOP,!0,!0],["effect/Koi_fx_skill_debuff.atlas","effect/Koi_fx_skill_debuff.json",["effect/Koi_fx_skill_debuff.png"],"Koi_fx_skill_debuff",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_HEAD_FORWARD,!0,!0],["effect/Wanko_fx_yell.atlas","effect/Wanko_fx_yell.json",["effect/Wanko_fx_yell.png"],"Wanko_fx_yell",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!0,!0],["effect/Miku_UK_fx_concentration.atlas","effect/Miku_UK_fx_concentration.json",["effect/Miku_UK_fx_concentration.png"],"Miku_UK_fx_concentration",database.FxLayerType.FxLayer_PersnalAuraLayer,FX_POS_BASE,!0,!0]],MAX_NUM_PATH_NODE=22,MAX_PATHFIND=36,INT_MAX=Number.MAX_VALUE,MAX_NODE_CHILDERN=8,NAME_WWEQUIPMENT_SCENE="WorldWarEquipmentScene",NAME_SCROLLABLE_LAYER="__scrollable_layer__",NAME_BASICUI_LAYER="__basic_ui_layer_",NAME_STATUSBAR_LAYER="__status_bar_layer_",MAX_SCALE_WW_MAP=2,MIN_SCALE_WW_MAP=.34,DEFAULT_SCALE_WW_MAP=1,THRESHOLD_SCALE_WW_MAP=.33,CLIENT_CREATE_WW_NPC_TROOPS_NUM=999999,WW_EQUIPMENT_UNIQUE_PRIVATE_ITEM_IDX=77777,NPCLIST_GHOST=11,NPCLIST_BOSS=12,NOTIFICATION_WW_EQUIPMENT="notification_ww_equipment",NOTIFICATION_WW_EQUIPMENT2="notification_ww_equipment2",NOTIFICATION_WW_SPECIAL_INFO="notification_ww_special_info",NOTIFICATION_WW_SPECIAL_FUNC="notification_ww_special_func",NOTIFICATION_WW_YH_THUMBNAIL="notification_ww_yh_thumbnail",DECK_LUNCH_FLAG=!1,DECK_LUNCH_LOAD_FLAG=!1,WORLD_TOUCH_FLAG=!1,WORLD_TOUCH_TROOP_FLAG=!1,WORLD_WAR_EQUIP_TOUCH=!1,WORLD_WAR_STATUS_TOUCH=!1,WORLD_WAR_MAIN_TOUCH=!1,sFindPathData=cc.Class.extend({idDest:0,center:null,destPos:null,eSkipGategory:null,radiusSq:null,ctor:function(){this.idDest=0,this.center=new cc.math.Vec2(0,0),this.destPos=new cc.math.Vec2(0,0),this.eSkipGategory=eNodeType.e_none_mapnode,this.radiusSq=cc.director.getWinSize().width,this.radiusSq*=this.radiusSq}}),eWorldWarUIMessage={WWMSG_MENU_CASTLE:1e4,WWMSG_MENU_CASTLE_INFO:10001,WWMSG_MENU_CASTLE_SPECIAL_INFO:10002,WWMSG_MENU_CASTLE_SPECIAL_RENEWAL:10003,WWMSG_MENU_CASTLE_SPECIAL_FUNC:10004,WWMSG_MENU_CASTLE_BARRACK:10005,WWMSG_UNIT_POPUP:10006,WWMSG_NPC_UNIT_POPUP:10007,WWMSG_OUR_CASTLE_TOUCH:10008,WWMSG_NPC_CASTLE_TOUCH:10009,WWMSG_OUR_BARRACK_TOUCH:10010,WWMSG_NPC_BARRACK_TOUCH:10011,WWMSG_CANCEL_ONTHEMOVE:10012,WWMSG_CHECK_TROOP_UNIT:10013,WWMSG_AREA_INFO:10014,WWMSG_RETURN_TO_BASE:10015,WWMSG_MENU_CASTLE_INFO_UNIT_TOUCH:10016,WWMSG_EQUIPMENT_ITEM_EQUIP_POPUP:10017,WWMSG_EQUIPMENT_ITEM_EQUIP_COMP_POPUP:10018,WWMSG_EQUIPMENT_ITEM_RELEASE_POPUP:10019,WWMSG_EQUIPMENT_ITEM_EQUIP_REQUEST:10020,WWMSG_EQUIPMENT_ITEM_CHANGE_REQUEST:10021,WWMSG_EQUIPMENT_ITEM_RELEASE_REQUEST:10022,WWMSG_YH_THUMBNAIL_TOUCH:10023,WWMSG_EQUIPMENT_UNIT_EQUIPMENT_WAIT_START:10200,WWMSG_EQUIPMENT_UNIT_EQUIPMENT_WAIT_PRIVATE:10201,WWMSG_EQUIPMENT_UNIT_EQUIPMENT_WAIT_ARMOR:10202,WWMSG_EQUIPMENT_UNIT_EQUIPMENT_WAIT_RING:10203,WWMSG_EQUIPMENT_UNIT_EQUIPMENT_WAIT_SHIELD:10204,WWMSG_EQUIPMENT_UNIT_EQUIPMENT_WAIT_JEWELRY:10205,WWMSG_EQUIPMENT_UNIT_EQUIPMENT_WAIT_END:10206,WWMSG_EQUIPMENT_CONFIRM_POPUP_CANCEL:10207,WWMSG_EQUIPMENT_UNIT_EQUIPMENT_CHANGE_ACCEPT:10208,WWMSG_EQUIPMENT_UNIT_SLOT_SELECT_START:10300,WWMSG_EQUIPMENT_UNIT_SLOT_SELECT_1:10301,WWMSG_EQUIPMENT_UNIT_SLOT_SELECT_2:10302,WWMSG_EQUIPMENT_UNIT_SLOT_SELECT_3:10303,WWMSG_EQUIPMENT_UNIT_SLOT_SELECT_4:10304,WWMSG_EQUIPMENT_UNIT_SLOT_SELECT_5:10305,WWMSG_EQUIPMENT_SET_EFFECT_INFO:10209,WWMSG_EQUIPMENT_SET_EFFECT_HELP:10210,WWMSG_FINDITEM_POPUP:10211,WWMSG_CASTLE_SPECIAL_ADD:10212,WWMSG_UNION_CLEAR_REWARD_POPUP_HIDE:10213,WWMSG_HELP_POPUP_SHOW:10214,WWMSG_HELP_POPUP_HIDE:10215,WWMSG_MAX:11e3},eBattleEventType={ebe_none:0,ebe_finditem:1,ebe_combat:2,ebe_attack_npctroop:3,ebe_attack_castle:4,ebe_attack_castle_endura:5},eActionPattern={e_none:0,e_attack_castle:1,e_attack_revange:2,e_attack_final:3,e_attack_calc:4,e_runaway_to_friendly_troop:5,e_runaway_to_friendly_castle:6,e_wait:7},sNpcActionTable=cc.Class.extend({npcPlacementIndex:0,type:0,order:0,ctor:function(){this.npcPlacementIndex=0,this.type=0,this.order=0}}),sNpcActionTypeTable=cc.Class.extend({typeIndex:0,actionPattern:0,searchRange1:0,checkValue1:0,searchRange2:0,checkValue2:0,ctor:function(){this.typeIndex=0,this.actionPattern=eActionPattern.e_none,this.searchRange1=0,this.checkValue1=0,this.searchRange2=0,this.checkValue2=0}}),eReinforcementType={e_reinf_none:0,e_reinf_init:1,e_reinf_turn:2,e_reinf_castle_occup:3,e_reinf_path_arrival:4},ePositionBase={e_path_none:0,e_path_index:1,e_near_user_troop:2,e_near_user_castle:3},sNpcPlacement=cc.Class.extend({index:0,groupIdx:0,troopName:"",level:0,reinforcementType:0,reinforcementValu:0,positionBase:0,positionBaseValue:0,npcIndex:0,numWaitTurn:0,reward:0,tensionIdx:0,bNpc:!0,isNpc:function(){return this.bNpc},ctor:function(){this.index=0,this.groupIdx=0,this.troopName="",this.level=0,this.reinforcementType=eReinforcementType.e_reinf_none,this.reinforcementValu=0,this.positionBase=ePositionBase.e_path_none,this.positionBaseValue=0,this.npcIndex=0,this.numWaitTurn=0,this.reward=0,this.tensionIdx=0,this.bNpc=!0},setNpcPlacement_WWNA:function(dbt){this.bNpc=!0,null!=dbt.world_war_npc_arrangement_idx?this.index=dbt.world_war_npc_arrangement_idx:this.index=0,null!=dbt.world_war_group_idx?this.groupIdx=dbt.world_war_group_idx:this.groupIdx=0,null!=dbt.npc_level?this.level=dbt.npc_level:this.level=0,null!=dbt.world_war_reinforcement_type?this.reinforcementType=dbt.world_war_reinforcement_type:this.reinforcementType=eReinforcementType.e_reinf_none,null!=dbt.world_war_pos_base_type?this.positionBase=dbt.world_war_pos_base_type:this.positionBase=ePositionBase.e_path_none,null!=dbt.pos_base_value?this.positionBaseValue=dbt.pos_base_value:this.positionBaseValue=0,null!=dbt.world_war_npc_idx?this.npcIndex=dbt.world_war_npc_idx:this.npcIndex=0,null!=dbt.world_war_subjugation_reward_idx?this.reward=dbt.world_war_subjugation_reward_idx:this.reward=0},setNpcPlacement_UWWNT:function(_uwwnt){this.bNpc=!0,this.setUWWNT(_uwwnt)},setNpcPlacement_UWWT:function(_uwwt){this.bNpc=!1,this.setUWWT(_uwwt)},setUWWT:function(uwwt){null!=uwwt.troops_num?this.index=uwwt.troops_num+1e4:this.index=1e4,null!=uwwt.formation_id?this.groupIdx=uwwt.formation_id:this.groupIdx=0,null!=uwwt.cost?this.level=uwwt.cost:this.level=0,null!=uwwt.e_reinf_init?this.reinforcementType=eReinforcementType.e_reinf_init:this.reinforcementType=eReinforcementType.e_reinf_none,null!=uwwt.current_cell_info_idx?this.reinforcementValue=uwwt.current_cell_info_idx:this.reinforcementValue=0,this.positionBase=ePositionBase.e_path_index,null!=uwwt.prev_cell_info_idx?this.positionBaseValue=uwwt.prev_cell_info_idx:this.positionBaseValue=0,null!=uwwt.troops_generals?this.npcIndex=uwwt.troops_generals:this.npcIndex=0,this.numWaitTurn=0,null!=uwwt.action_complete_yn?this.tensionIdx=uwwt.action_complete_yn<1?"n":uwwt.action_complete_yn:this.tensionIdx=0,null!=uwwt.activity_type?this.reward=uwwt.activity_type:this.reward=0},getUWWT:function(){var reval={};return this.isNpc()?(reval.troops_num=0,reval.formation_id=0,reval.cost=0,reval.current_cell_info_idx=0,reval.prev_cell_info_idx=0,reval.troops_generals=0,reval.activity_type=0,reval.action_complete_yn=0):(reval.troops_num=this.index-1e4,reval.formation_id=this.groupIdx,reval.cost=this.level,reval.current_cell_info_idx=this.reinforcementValue,reval.prev_cell_info_idx=this.positionBaseValue,reval.troops_generals=this.npcIndex,reval.activity_type=this.reward,reval.action_complete_yn=this.tensionIdx),reval},setUWWNT:function(uwwnt){null!=uwwnt.troops_num?this.index=uwwnt.troops_num:this.index=0,null!=uwwnt.world_war_npc_idx?this.groupIdx=uwwnt.world_war_npc_idx:this.groupIdx=0,null!=uwwnt.current_cell_info_idx?this.positionBase=uwwnt.current_cell_info_idx:this.positionBase=0,null!=uwwnt.prev_cell_info_idx?this.positionBaseValue=uwwnt.prev_cell_info_idx:this.positionBaseValue=0,null!=uwwnt.activity_type?this.reinforcementType=uwwnt.activity_type:this.reinforcementType=0,null!=uwwnt.troops_generals?this.npcIndex=uwwnt.troops_generals:this.npcIndex=0},getUWWNT:function(){var uwwnt={};return uwwnt.troops_num=this.index,uwwnt.world_war_npc_idx=this.groupIdx,uwwnt.current_cell_info_idx=this.positionBase,uwwnt.prev_cell_info_idx=this.positionBaseValue,uwwnt.activity_type=this.reinforcementType,uwwnt.troops_generals=this.npcIndex,uwwnt},getYunheeContainerPointer:function(){return this.npcIndex},endAction:function(){return tensionIdx}}),eNodeTypeTable={et_base_castle:0,et_castle:1,et_path_normal:2,et_path_box:3,et_path_warning1:4,et_path_warning2:5,et_path_warning3:6,et_path_warning4:7,et_path_warning5:8,et_path_warning6:9,et_path_warning7:10,et_path_warning8:11,et_gateway:12,et_castleSpec:13},eNodeType={e_none_mapnode:0,e_base_castle:1,e_castle:2,e_path_normal:4,e_path_box:8,e_path_warning1:16,e_path_warning2:32,e_path_warning3:64,e_path_warning4:128,e_path_warning5:256,e_path_warning6:512,e_path_warning7:1024,e_path_warning8:2048,e_gateway:4096,e_castleSpec:8192,e_castle_enemy:16384,e_barrack:32768,e_barrack_enemy:65536,e_gateway_enemy:131072,e_castleSpec_enemy:262144,e_path_warning:4080},mcNodeType=function(_ttype_){return _ttype_==eNodeTypeTable.et_base_castle?eNodeType.e_base_castle:_ttype_==eNodeTypeTable.et_castle?eNodeType.e_castle_enemy:_ttype_==eNodeTypeTable.et_path_normal?eNodeType.e_path_normal:_ttype_==eNodeTypeTable.et_path_box?eNodeType.e_path_box:_ttype_==eNodeTypeTable.et_path_warning1?eNodeType.e_path_warning1:_ttype_==eNodeTypeTable.et_path_warning2?eNodeType.e_path_warning2:_ttype_==eNodeTypeTable.et_path_warning3?eNodeType.e_path_warning3:_ttype_==eNodeTypeTable.et_path_warning4?eNodeType.e_path_warning4:_ttype_==eNodeTypeTable.et_path_warning5?eNodeType.e_path_warning5:_ttype_==eNodeTypeTable.et_path_warning6?eNodeType.e_path_warning6:_ttype_==eNodeTypeTable.et_path_warning7?eNodeType.e_path_warning7:_ttype_==eNodeTypeTable.et_path_warning8?eNodeType.e_path_warning8:_ttype_==eNodeTypeTable.et_gateway?eNodeType.e_gateway_enemy:eNodeType.e_castleSpec_enemy},sMapNode=cc.Class.extend({index:0,groupIdx:0,nodeType:eNodeType.e_none_mapnode,pathLevel:0,endureMax:0,castleOccupationReward:0,xpos:0,ypos:0,link:[],name:[],maxSpecialTalent:0,durabilityRecoveryRate:0,areaNumber:0,occupationOpenArea1:0,occupationOpenArea2:0,gatewayOpenCondition1:0,gatewayOpenCondition2:0,gatewayOpenCondition3:0,npcProperty:0,ctor:function(){this.index=0,this.groupIdx=0,this.nodeType=eNodeType.e_none_mapnode,this.pathLevel=0,this.endureMax=0,this.castleOccupationReward=0,this.xpos=0,this.ypos=0,this.link=[],this.name=[],this.maxSpecialTalent=0,this.durabilityRecoveryRate=0,this.areaNumber=0,this.occupationOpenArea1=0,this.occupationOpenArea2=0,this.gatewayOpenCondition1=0,this.gatewayOpenCondition2=0,this.gatewayOpenCondition3=0,this.npcProperty=0},setMapNode:function(ci){this.index=ci.world_war_cell_info_idx,this.groupIdx=ci.world_war_group_idx,this.pathLevel=ci.cell_level,this.endureMax=ci.max_castle_durability,this.castleOccupationReward=ci.world_war_castle_occupation_reward_idx,this.xpos=ci.pos_x,this.ypos=ci.pos_y,this.maxSpecialTalent=ci.max_castle_special_func_count,this.durabilityRecoveryRate=ci.castle_durability_recovery_rate,this.areaNumber=ci.area_num,this.occupationOpenArea1=ci.open_area_num_1,this.occupationOpenArea2=ci.open_area_num_2,this.gatewayOpenCondition1=ci.cond_open_area_num_1,this.gatewayOpenCondition2=ci.cond_open_area_num_2,this.gatewayOpenCondition3=ci.cond_open_area_num_3,this.npcProperty=ci.npc_element_type,this.nodeType=mcNodeType(ci.world_war_move_cell_type),this.link=[],this.link[0]=ci.connect_cell_1,this.link[1]=ci.connect_cell_2,this.link[2]=ci.connect_cell_3,this.link[3]=ci.connect_cell_4,this.link[4]=ci.connect_cell_5,this.link[5]=ci.connect_cell_6,this.link[6]=ci.connect_cell_7,this.link[7]=ci.connect_cell_8,null!=ci.name&&""!=ci.name&&null!=ci.name&&(this.name=ci.name)}}),sNpcTable=cc.Class.extend({index:0,combatNumber:0,formation:0,aID:[0,0,0,0,0],aGnrlNum:[0,0,0,0,0],aIsBoss:[!1,!1,!1,!1,!1],aCurHp:[0,0,0,0,0],apUserTroop:[null,null,null,null,null],ctor:function(){this.index=0,this.combatNumber=0,this.formation=0,this.aID=[0,0,0,0,0],this.aCurHp=[0,0,0,0,0],this.aGnrlNum=[0,0,0,0,0],this.aIsBoss=[!1,!1,!1,!1,!1],this.apUserTroop=[null,null,null,null,null]},setNpcTable_WWN:function(dbt){for(var i=0;i<5;++i)this.aID[i]=0,this.aCurHp[i]=0,this.aGnrlNum[i]=0,this.aIsBoss[i]=!1,this.apUserTroop[i]=null;null!=dbt.world_war_npc_idx?this.index=dbt.world_war_npc_idx:this.index=0,null!=dbt.battle_num?this.combatNumber=dbt.battle_num:this.combatNumber=0,null!=dbt.formation_id?this.formation=dbt.formation_id:this.formation=0},setNpcTable_Operator:function(tg){for(var i=0;i<5;++i)if(0==this.aID[i]&&null!=tg[i]){this.aID[i]=tg[i].gnrl_id,this.aGnrlNum[i]=tg[i].gnrl_num,this.aIsBoss[i]="y"==tg[i].leader_yn;var npcList=MasterManager.getInstance().get_General(this.aID[i]);0<npcList.gnrl_id&&(this.apUserTroop[i]=npcList)}null!=tg.world_war_npc_idx?this.index=tg.world_war_npc_idx:this.index=0,null!=tg.battle_num?this.combatNumber=tg.battle_num:this.combatNumber=0,null!=tg.formation_id?this.formation=tg.formation_id:this.formation=0},getBossGnrlID:function(gnrlNum){null==gnrlNum&&(gnrlNum=null);for(var i=0;i<5;++i)if(this.aIsBoss[i])return gnrlNum&&(gnrlNum=this.aGnrlNum[i]),this.aID[i];return 0},isBoss:function(gnrlID){for(var i=0;i<5;i++)if(gnrlID==this.aID[i])return this.aIsBoss[i]},getCurHp:function(gnrlID,gnrlNum){for(var i=0;i<5;++i)if(this.aID[i]==gnrlID&&gnrlNum==this.aGnrlNum[i])return this.aCurHp[i];return cc.UINT_MAX},setCurHp:function(gnrlID,curhp){for(var i=0;i<5;++i)if(this.aID[i]==gnrlID)return this.aCurHp[i]=curhp,!0;return!1},setCurHpRate:function(gnrlID,gnrlNum,hpRate,hpDiffPercent){null==hpDiffPercent&&(hpDiffPercent=null,GameDefault.getInstance().setWorldWarHpDiffPercent(hpDiffPercent));for(var i=0;i<5;++i)if(this.aID[i]==gnrlID&&gnrlNum==this.aGnrlNum[i]&&this.apUserTroop[i]){var prevHp=this.aCurHp[i];if(this.aCurHp[i]=this.apUserTroop[i].hp*hpRate/1e4,null!=hpDiffPercent)if(0!=this.apUserTroop[i].hp)hpDiffPercent=100*(this.aCurHp[i]-prevHp)/this.apUserTroop[i].hp,GameDefault.getInstance().setWorldWarHpDiffPercent(hpDiffPercent);else hpDiffPercent=0,GameDefault.getInstance().setWorldWarHpDiffPercent(hpDiffPercent);return!0}return!1},getUserTroopDB:function(gnrlID){for(var i=0;i<5;++i)if(this.aID[i]==gnrlID&&this.aGnrlNum[i])return this.apUserTroop[i];return null}}),sNpcList=cc.Class.extend({id:0,npc:0,group:0,grade:0,level:0,attack:0,defence:0,health:0,ctor:function(){this.id=0,this.npc=0,this.group=0,this.grade=0,this.level=0,this.attack=0,this.defence=0,this.health=0}}),eCounterFunctionIndex={ecf_combat_limit_time:0,ecf_yunhee_organize_max:1,ecf_troop_organize_max:2,ecf_npc_max:3,ecf_food_posses_max:4,ecf_ghost_behavior_priority_rate:5,ecf_castle_attack_priority_rate:6,ecf_troop_attack_priority_rate:7,ecf_food_consume_constant:8,ecf_return_constant:9,ecf_node_change_min:10,ecf_node_change_max:11,ecf_node_pass_time:12,ecf_jewel_purchase_food:13,ecf_barrack_max_troop:14,ecf_base_castle_health_recovery:15,ecf_npc_castle_health_recovery:16,ecf_castle_max:17,ecf_max_accumulate_tension:18,ecf_max_actionpoint:19,ecf_food_create_unit_second:20,ecf_attack_correction_const:21,ecf_defend_correction_const:22,ecf_health_correction_const:23,ecf_npc_attack_correction_const:24,ecf_npc_defend_correction_const:25,ecf_npc_health_correction_const:26,ecf_attack_castle_const:27,ecf_key_max:28,ecf_key_recovery_time:29,ecf_init_troop_forming_num:30,ecf_max:31},sCounterFunction=cc.Class.extend({groupIdex:0,value:[],ctor:function(){this.groupIdex=0,this.value=[]}}),eCastleSpecialTalent={est_increase_max_action_point:1,est_recovery_yunhee_health:2,est_increase_endurance:3,est_increase_make_food:4,est_increase_stat:5,est_move_castle_action_pt:6,est_increase_troop:7,est_increase_enemy_damage:8},sUnitData=cc.Class.extend({gnrl_id:0,gnrl_num:0,is_leader:!1,is_boss:!1,cur_hp:0,max_hp:0,ctor:function(){this.gnrl_id=0,this.gnrl_num=0,this.is_leader=!1,this.is_boss=!1,this.cur_hp=0,this.max_hp=0}}),eTroopType={eNone:0,eUser:1,eNpc:2},sTroopData=cc.Class.extend({troop_type:0,troop_index:0,troop_num:0,troop_level:0,cost:0,formation_id:0,current_cell_info_idx:0,prev_cell_info_idx:0,activity_type:0,acion_complete_yn:!1,unit_list:[],ctor:function(){this.troop_type=eTroopType.eNone,this.troop_index=0,this.troop_num=0,this.troop_level=0,this.cost=0,this.formation_id=0,this.current_cell_info_idx=0,this.prev_cell_info_idx=0,this.activity_type=0,this.acion_complete_yn=!1,this.unit_list=[]}}),sSendMsgData=cc.Class.extend({msg:null,pUserData:null,ctor:function(){this.msg=eWorldWarUIMessage.WWMSG_MAX,this.pUserData=null}}),sSendInfoPopupData=cc.Class.extend({nodeType:null,idNode:null,endureCurrent:null,troopCount:null,troop_list:[],specialCount:0,specialMaxCount:0,special_list:[],ctor:function(){this.nodeType=eNodeType.e_none_mapnode,this.idNode=null,this.endureCurrent=null,this.troopCount=null,this.troop_list=[],this.specialCount=0,this.specialMaxCount=0,this.special_list=[]}}),troops_num_1=1,troops_num_2=2,troops_num_3=3,troops_num_4=4,troops_num_5=5,troops_num_6=6,troops_num_7=7,eBattleRewardType={None:0,CastleOccupation:1,UnionFirstClear:2,UnionClear:3},eWorldWarMoveCellType={base_castle:0,castle:1,move_normal:2,move_box:3,move_danger_1:4,move_danger_2:5,move_danger_3:6,move_danger_4:7,move_danger_5:8,move_danger_6:9,move_danger_7:10,move_danger_8:11,gate_way:12,castle_special:13},WW_DECK_STATUS={NONE:0,ARRANGEMENT_MODE:1,ARRANGEMENT_SELECT_YUNHEE:2,FRIEND_MODE:3,YUNHEE_SELECT_MODE:4,CHOICE_LEADER:5},WorldWarTable=function(){function WorldWarTable(){}var instance;return WorldWarTable.prototype.sel_UserWorldWarItemInfo=function(user_id,item){var m_world_war_items=NetServiceV3.getInstance().get_user_world_war_items(),world_war_item=m_world_war_items.at([user_id]);null!=world_war_item&&(item.medal_cnt=world_war_item.medal,item.medal_accum_cnt=world_war_item.accum_medal),world_war_item=m_world_war_items=null},WorldWarTable.prototype.sel_UserWorldWarInfo=function(user_id,period_idx){var item={},m_world_war_datas=NetServiceV3.getInstance().get_map_user_world_war_data(),world_war_data=m_world_war_datas.at([user_id,period_idx]);return null!=world_war_data&&(item.castle_occupation_count=world_war_data.castle_occupation_count,item.accum_turn_count=world_war_data.accum_turn_count,item.remain_active_count=world_war_data.remain_active_count,item.troops_lose_count=world_war_data.troops_lose_count,item.npc_retreat_count=world_war_data.npc_retreat_count,item.ghost_retreat_count=world_war_data.ghost_retreat_count,item.evt_npc_retreat_count=world_war_data.evt_npc_retreat_count,item.unification_yn=world_war_data.unification_yn),world_war_data=m_world_war_datas=null,item},WorldWarTable.prototype.sel_UserWorldWarTotalCostBound=function(user_id,period_idx,troops_num){var m_world_war_troops=NetServiceV3.getInstance().get_list_User_World_War_Troops(),world_war_data=m_world_war_troops.at([user_id,period_idx,troops_num]);return null!=world_war_data?(m_world_war_troops=null,world_war_data.cost):(m_world_war_troops=null,0)},WorldWarTable.prototype.sel_UserWorldWarCurHpPercentGeneral=function(user_id,period_idx,gnrl_key){var m_world_war_partin_generals=NetServiceV3.getInstance().get_list_User_World_War_Partin_General(),partin_generals=m_world_war_partin_generals.at([user_id,period_idx,gnrl_key.gnrl_id,gnrl_key.gnrl_num]);return null!=partin_generals?(m_world_war_partin_generals=null,partin_generals.remain_hp):(m_world_war_partin_generals=null,0)},WorldWarTable.prototype.sel_getGeneralKeyforEquipment=function(user_id,period_idx,equip_key,gnrl_key){var m_world_war_gnrl_equipment_item=NetServiceV3.getInstance().get_list_User_World_War_General_Equipment_Item(),world_war_equipment_item=m_world_war_gnrl_equipment_item.at([user_id,period_idx,equip_key.equipment_item_idx,equip_key.equipment_num]);null!=world_war_equipment_item&&(gnrl_key.gnrl_id=world_war_equipment_item.gnrl_id,gnrl_key.gnrl_num=world_war_equipment_item.gnrl_num),world_war_equipment_item=m_world_war_gnrl_equipment_item=null},WorldWarTable.prototype.sel_User_World_War_Special_List=function(user_id,period_idx,sepcial){for(var m_world_war_castle_special_func=NetServiceV3.getInstance().get_list_User_World_War_Castle_Occupation_Special_Info(),keys=m_world_war_castle_special_func.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++){var equip=m_world_war_castle_special_func.at(keys[idx]);if(equip.user_id==user_id&&equip.period_idx==period_idx){var d={};d.world_war_cell_info_idx=equip.world_war_cell_info_idx,d.num=equip.num,d.world_war_castle_special_func_idx=equip.world_war_castle_special_func_idx,sepcial.push_back($.extend({},d))}}m_world_war_castle_special_func=keys=null},WorldWarTable.prototype.sel_UserWorldWarCastleSpecial=function(user_id,period_idx,cell_info_idx,sepcial){for(var m_world_war_gnrl_equipment_item=NetServiceV3.getInstance().get_list_User_World_War_Castle_Occupation_Special_Info(),keys=m_world_war_gnrl_equipment_item.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++){var equip=m_world_war_gnrl_equipment_item.at(keys[idx]);if(equip.user_id==user_id&&equip.period_idx==period_idx&&equip.world_war_cell_info_idx==cell_info_idx){var d={};d.world_war_cell_info_idx=equip.world_war_cell_info_idx,d.num=equip.num,d.world_war_castle_special_func_idx=equip.world_war_castle_special_func_idx,sepcial.push_back(d),d=null}equip=null}m_world_war_gnrl_equipment_item=keys=null},{getInstance:function(){return void 0===instance&&(instance=new WorldWarTable),instance}}}(),NetServiceV3=function(){var instance,list_User_World_War_Troops=null,list_User_World_War_Troops_General=null,list_User_World_War_Partin_General=null,list_User_World_War_General_Equipment_Item=null,list_User_World_War_Castle_Occupation_Info=null,list_User_World_War_Castle_Occupation_Special_Info=null,list_User_World_War_Npc_Troops=null,list_User_World_War_Npc_Troops_General=null,world_war_battle_continue_info=null,list_User_World_War_Unification_First_Clear_Reward_Log=null,map_user_world_war_items=null,map_user_world_war_data=null,vcBoxNode=null,world_war_period_idx=0,world_war_unique_equipment_ticket_count=0,world_war_user_info={};function NetServiceV3(){}return NetServiceV3.prototype.updateResponse_Res_Get_World_War_Season_Info=function(res){WorldWarService.getInstance().setWorldWarSeasonInfo(res.world_war_period_idx,res.season_type),this.deleteall_User_World_War_Troops_General(),0==WOLRD_WAR_SEASON_INFO_FIRST_LOAD?cc.log("################ WorldWar Season Info Data Start ################"):(cc.log("################ WorldWar Season Info Data Start ################"),this.updateResponse_Res_World_War_Npc_Troops(res)),this.updateResponse_Res_Get_World_War_Troops(res),this.updateResponse_Res_Get_World_War_User_Item_Info(res),this.updateResponse_Res_World_War_Castle_Occupation_Info(res),this.updateResponse_Res_World_War_Cell_Box_Info(res),this.updateResponse_Res_User_Unique_Equipment_Ticket(res),this.updateResponse_Res_Get_World_War_Info(res),this.updateResponse_Res_World_War_Battle_Continue_Info(res),this.updateResponse_Res_Get_World_War_Partin_Generals(res),this.updateResponse_Res_Get_World_War_General_Equipments(res),cc.log("################  WorldWar Season Info Data END  ################")},NetServiceV3.prototype.updateResponse_Res_Get_World_War_User_Item_Info=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),0==this.exist_User_World_War_Items()?this.insert_User_World_War_Items(res):this.update_User_World_War_Items(res),NetService().upd_UserWorldWarTicket(res.user_world_war_ticket)},NetServiceV3.prototype.updateResponse_Res_Get_World_War_Troops=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.deleteall_User_World_War_Troops(),this.insert_User_World_War_Troops(res.troops_list,res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_Get_World_War_Partin_Generals=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.deleteall_User_World_War_Partin_Generals(),this.insert_User_World_War_Partin_Generals(res.partin_generals,res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_Get_World_War_General_Equipments=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.deleteall_User_World_War_General_Equipment_Item(),this.insert_User_World_War_General_Equipment_Items(res.gnrl_equipments,res.world_war_period_idx),WorldWarService.getInstance().updateWorldWarUserEquipmentList()},NetServiceV3.prototype.updateResponse_Res_Get_World_War_Info=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),0==this.exist_User_World_War_Data(res.world_war_period_idx)?this.insert_User_World_War_Data(res):this.update_User_World_War_Data(res),world_war_user_info=res},NetServiceV3.prototype.updateResponse_Res_World_War_Castle_Occupation_Info=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.deleteall_User_World_War_Castle_Occupation_Info(),this.deleteall_User_World_War_Castle_Occupation_Special_Info(),this.insert_User_World_War_Castle_Occupation_Infos(res.castle_list,res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Npc_Troops=function(res){this.deleteall_User_World_War_Npc_Troops(),this.deleteall_User_World_War_Npc_Troops_General();for(var troops_list=[],m=MasterManager.getInstance(),period=m.get_WorldWarPeriod(res.world_war_period_idx),_WorldWarNpcArrangement=MasterTable.getInstance().all_map_WorldWarNpcArrangement(),idx=0;idx<_WorldWarNpcArrangement.length;idx++){var npcArr=_WorldWarNpcArrangement[idx];if(npcArr.world_war_group_idx==period.world_war_group_idx){var npcTroop=m.get_WorldWarNpc(npcArr.world_war_npc_idx,1),troop={activity_type:3};troop.current_cell_info_idx=npcArr.pos_base_value,troop.npc_type=2,troop.open_yn="n",troop.prev_cell_info_idx=npcArr.pos_base_value,troop.troops_generals=[];var vcNpcId=[];vcNpcId.push(npcTroop.npc1_id),vcNpcId.push(npcTroop.npc2_id),vcNpcId.push(npcTroop.npc3_id),vcNpcId.push(npcTroop.npc4_id),vcNpcId.push(npcTroop.npc5_id),troop.troops_generals=[];for(var i=0;i<vcNpcId.length;i++){var npc_id=vcNpcId[i];if(0<npc_id){var npc=m.get_NpcGeneral(npc_id);troop.troops_generals.push(this.createUserWorldWarNpcTroopsGeneral(npcArr,i+1,npc.gnrl_id))}}troop.troops_num=CLIENT_CREATE_WW_NPC_TROOPS_NUM,troop.world_war_npc_idx=npcArr.world_war_npc_idx,troops_list.push(troop)}}this.insert_User_World_War_Npc_Troops(troops_list,res.world_war_period_idx);for(i=0;i<res.npc_troops_list.length;i++){var npc_troop=res.npc_troops_list[i];if(this.exist_User_World_War_Npc_Troops(npc_troop,res.world_war_period_idx)){this.update_User_World_War_Npc_Troops(npc_troop,res.world_war_period_idx);for(var j=0;j<npc_troop.troops_generals.length;j++){var npc_troop_general=npc_troop.troops_generals[j];this.update_User_World_War_Npc_Troops_General(npc_troop_general,res.world_war_period_idx)}}}},NetServiceV3.prototype.updateResponse_Res_World_War_Troops_Set=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.update_User_World_War_Troops_Generals(res.troops_num,res.troops_generals),this.deleteall_User_World_War_Partin_Generals(),this.insert_User_World_War_Partin_Generals(res.partin_generals,res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Troops_Del=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.update_User_World_War_Troops_Generals(res.troops_num,res.troops_generals),this.deleteall_User_World_War_Partin_Generals(),this.insert_User_World_War_Partin_Generals(res.partin_generals,res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Troops_Leader_Set=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.update_User_World_War_Troops_Generals(res.troops_num,res.troops_generals)},NetServiceV3.prototype.updateResponse_Res_World_War_Troops_General_Equipment_Item_Set=function(res){if(WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),0<res.release_equipment_key.equipment_item_idx){var equipment_release={};equipment_release.equipment_item_idx=res.release_equipment_key.equipment_item_idx,equipment_release.equip_num=res.release_equipment_key.equipment_num,equipment_release.gnrl_id=res.release_gnrl_key.gnrl_id,equipment_release.gnrl_num=res.release_gnrl_key.gnrl_num,this.delete_User_World_War_General_Equipment_Item(equipment_release,res.world_war_period_idx),WorldWarService.getInstance().setWorldWarUserEquipment(res.release_equipment_key.equipment_item_idx,res.release_equipment_key.equipment_num,!1)}var equipment={};equipment.gnrl_id=res.gnrl_key.gnrl_id,equipment.gnrl_num=res.gnrl_key.gnrl_num,equipment.equipment_item_idx=res.equipment_key.equipment_item_idx,equipment.equip_num=res.equipment_key.equipment_num,this.insert_User_World_War_General_Equipment_Item(equipment,res.world_war_period_idx),WorldWarService.getInstance().setWorldWarUserEquipment(res.equipment_key.equipment_item_idx,res.equipment_key.equipment_num,!0);var partin_gnrls=[];partin_gnrls.push_back(res.gnrl_info),this.update_User_World_War_Partin_Generals(partin_gnrls,res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Troops_General_Equipment_Item_Del=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx);var equipment={};equipment.gnrl_id=res.gnrl_key.gnrl_id,equipment.equip_num=res.gnrl_key.gnrl_num,equipment.equipment_item_idx=res.equipment_key.equipment_item_idx,equipment.equip_num=res.equipment_key.equipment_num,this.delete_User_World_War_General_Equipment_Item(equipment,res.world_war_period_idx),WorldWarService.getInstance().setWorldWarUserEquipment(res.equipment_key.equipment_item_idx,res.equipment_key.equipment_num,!1);var partin_gnrls=[];partin_gnrls.push_back(res.gnrl_info),this.update_User_World_War_Partin_Generals(partin_gnrls,res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Reset=function(res){WorldWarService.getInstance().setWorldWarSeasonInfo(res.world_war_period_idx,res.season_type)},NetServiceV3.prototype.updateResponse_Res_World_War_Troops_Move=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.update_User_World_War_Data2(res),this.update_User_World_War_Troops(res.troops,res.world_war_period_idx),0<res.npc_troops.world_war_npc_idx&&(this.exist_User_World_War_Npc_Troops(res.npc_troops,res.world_war_period_idx)?this.update_User_World_War_Npc_Troops(res.npc_troops,res.world_war_period_idx):this.insert_User_World_War_Npc_Troops(res.npc_troops,res.world_war_period_idx)),res.bonus_item.size(),0!=res.box.world_war_cell_info_idx&&this.removeCellBox(res.box),0<res.castle.world_war_group_idx&&(this.exist_User_World_War_Castle_Occupation_Info(res.world_war_period_idx,res.castle.world_war_group_idx,res.castle.world_war_cell_info_idx)?this.update_User_World_War_Castle_Occupation_Info(res.castle,res.world_war_period_idx):this.insert_User_World_War_Castle_Occupation_Info(res.castle,res.world_war_period_idx))},NetServiceV3.prototype.updateResponse_Res_User_Unique_Equipment_Ticket=function(res){this.exist_User_Unique_Equipment_Ticket()?this.update_User_Unique_Equipment_Ticket(res.ticket_count):this.insert_User_Unique_Equipment_Ticket(res.ticket_count)},NetServiceV3.prototype.updateResponse_Res_Equipment_Unique_Equipment=function(res){NetService().insert_User_Equipment(res.unique_equip_info),this.update_User_Unique_Equipment_Ticket(res.equip_ticket_count)},NetServiceV3.prototype.updateResponse_Res_World_War_Battle_Continue_Info=function(res){var data={world_war_period_idx:res.world_war_period_idx,world_war_cell_info_idx:res.world_war_cell_info_idx,attacker_type:res.attacker_type,event_type:res.event_type,troops:res.troops,npc_troops:res.npc_troops};world_war_battle_continue_info=data},NetServiceV3.prototype.updateResponse_Res_World_War_Battle_Continue_Check=function(res){cc.log("CHeck")},NetServiceV3.prototype.updateResponse_Res_World_War_Move_Battle_Win=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.update_User_World_War_Castle_Occupation_Count(res.castle_occupation_count,res.world_war_period_idx),this.update_User_World_War_Troops(res.troops,res.world_war_period_idx),this.update_User_World_War_Partin_Generals(res.partin_generals,res.world_war_period_idx);for(var i=0;i<res.castle_list.length;i++)this.exist_User_World_War_Castle_Occupation_Info(res.world_war_period_idx,res.castle_list[i].world_war_group_idx,res.castle_list[i].world_war_cell_info_idx)?this.update_User_World_War_Castle_Occupation_Info(res.castle_list[i],res.world_war_period_idx):this.insert_User_World_War_Castle_Occupation_Info(res.castle_list[i],res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Move_Battle_Lose=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.update_User_World_War_Troops(res.troops,res.world_war_period_idx),0<res.npc_troops.world_war_npc_idx&&(this.exist_User_World_War_Npc_Troops(res.npc_troops,res.world_war_period_idx)?this.update_User_World_War_Npc_Troops(res.npc_troops,res.world_war_period_idx):this.insert_User_World_War_Npc_Troops(res.npc_troops,res.world_war_period_idx)),this.update_User_World_War_Partin_Generals(res.partin_generals,res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Move_Battle_Time_Out=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.update_User_World_War_Troops(res.troops,res.world_war_period_idx),0<res.npc_troops.world_war_npc_idx&&(this.exist_User_World_War_Npc_Troops(res.npc_troops,res.world_war_period_idx)?this.update_User_World_War_Npc_Troops(res.npc_troops,res.world_war_period_idx):this.insert_User_World_War_Npc_Troops(res.npc_troops,res.world_war_period_idx)),this.update_User_World_War_Partin_Generals(res.partin_generals,res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Castle_Special_Add=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.delete_User_World_War_Castle_Occupation_Info(res),this.delete_User_World_War_Castle_Occupation_Special_Info(res),this.insert_User_World_War_Castle_Occupation_Info(res.castle,res.world_war_period_idx),this.insert_User_World_War_Troops(res.troops_list,res.world_war_period_idx),this.insert_User_World_War_Data(res)},NetServiceV3.prototype.updateResponse_Res_World_War_Main_Castle_Troops_Return=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.update_User_World_War_Troops(res.troops,res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_User_Team_Turn_End=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx);var info={world_war_period_idx:res.world_war_period_idx,castle_occupation_count:res.castle_occupation_count,accum_turn_count:res.accum_turn_count,remain_active_count:res.remain_active_count,max_active_count:res.max_active_count,roops_lose_count:res.troops_lose_count,npc_retreat_count:res.npc_retreat_count,ghost_retreat_count:res.ghost_retreat_count,evt_npc_retreat_count:res.evt_npc_retreat_count,unification_yn:res.unification_yn};this.update_User_World_War_Data(info);for(var i=0;i<res.troops_list.length;i++)this.update_User_World_War_Troops(res.troops_list[i],res.world_war_period_idx);this.update_User_World_War_Partin_Generals(res.partin_generals,res.world_war_period_idx);for(i=0;i<res.npc_troops_list.length;i++)this.exist_User_World_War_Npc_Troops(res.npc_troops_list[i],res.world_war_period_idx)?this.update_User_World_War_Npc_Troops(res.npc_troops_list[i],res.world_war_period_idx):this.insert_User_World_War_Npc_Troops(res.npc_troops_list[i],res.world_war_period_idx);this.update_User_World_War_Castle_Occupation_Infos(res.castle_list,res.world_war_period_idx),NetService().upd_UserWorldWarTicket(res.user_world_war_ticket),info=null},NetServiceV3.prototype.updateResponse_Res_World_War_Cell_Box_Info=function(res){vcBoxNode=res.box_list},NetServiceV3.prototype.updateResponse_Res_World_War_Unification_First_Clear_Reward=function(res){this.deleteall_User_World_War_Unification_First_Clear_Reward_Log(),this.insert_User_World_War_Unification_First_Clear_Reward_Log_List(res.reward_log,WorldWarService.getInstance().getWorldWarPeriodIndex())},NetServiceV3.prototype.updateResponse_Res_World_War_Buy_Box_Gacha=function(res){for(var m=MasterManager.getInstance(),i=0;i<res.bonus_item.length;i++){var item=res.bonus_item[i];switch(item.bonus_type){case BONUS_TYPE_EQUIPMENT:var equip=m.get_EquipmentItem(item.equipment.equipment_item_idx);try{null!=equip&&equip.equipment_type!=EQUIPMENT_TYPE_EXP&&(item.equipment.level=1,NetService().insert_User_Equipment(item.equipment))}catch(e){}}}},NetServiceV3.prototype.updateResponse_Res_World_War_Unification_First_Clear_Log=function(res){this.deleteall_User_World_War_Unification_First_Clear_Reward_Log(),this.insert_User_World_War_Unification_First_Clear_Reward_Log_List(res.reward_log,WorldWarService.getInstance().getWorldWarPeriodIndex()),cc.log("!@#!@#!@#!@#!@#!@#!@#!@#!@#!@#!@#!@#!@!@#!@#!#!#!@#!#!@#!#!@#!@#!@#!@#!#!@#!@")},NetServiceV3.prototype.exist_User_World_War_Items=function(){return null!=map_user_world_war_items||null!=map_user_world_war_items||(map_user_world_war_items=new Map,!1)},NetServiceV3.prototype.insert_User_World_War_Items=function(userWorldWarItems){var world_war_item={user_id:m_user_id,medal:userWorldWarItems.medal,accum_medal:userWorldWarItems.medal_accum};map_user_world_war_items.insert([m_user_id],world_war_item)},NetServiceV3.prototype.update_User_World_War_Items=function(userWorldWarItems){var world_war_item={user_id:m_user_id,medal:userWorldWarItems.medal,accum_medal:userWorldWarItems.medal_accum};map_user_world_war_items.insert([m_user_id],world_war_item)},NetServiceV3.prototype.update_User_World_War_Items_medal=function(nMedal){null==map_user_world_war_items&&null==map_user_world_war_items&&(map_user_world_war_items=new Map);var world_war_item=map_user_world_war_items.at([m_user_id]);null!=world_war_item&&(world_war_item.medal=nMedal,map_user_world_war_items.insert([m_user_id],world_war_item))},NetServiceV3.prototype.exist_User_Unique_Equipment_Ticket=function(){return!(world_war_unique_equipment_ticket_count<=0)},NetServiceV3.prototype.insert_User_Unique_Equipment_Ticket=function(userUniqueEquipmentTicket){world_war_unique_equipment_ticket_count=userUniqueEquipmentTicket},NetServiceV3.prototype.update_User_Unique_Equipment_Ticket=function(nTicketCount){world_war_unique_equipment_ticket_count=nTicketCount},NetServiceV3.prototype.select_User_Unique_Equipment_Ticket=function(){return world_war_unique_equipment_ticket_count},NetServiceV3.prototype.deleteall_User_World_War_Troops=function(){null==list_User_World_War_Troops&&(list_User_World_War_Troops=new Map),list_User_World_War_Troops.clear()},NetServiceV3.prototype.insert_User_World_War_Troops=function(user_world_war_troops,period_idx){this.deleteall_User_World_War_Troops(),user_world_war_troops.forEach(function(item){this.insert_User_World_War_Troop(item,period_idx)}.bind(this))},NetServiceV3.prototype.insert_User_World_War_Troop=function(user_world_war_troops,period_idx){null==list_User_World_War_Troops&&(list_User_World_War_Troops=new Map),list_User_World_War_Troops.insert([m_user_id,period_idx,user_world_war_troops.troops_num],user_world_war_troops),this.insert_User_World_War_Troops_Generals(user_world_war_troops.troops_generals,period_idx)},NetServiceV3.prototype.update_User_World_War_Troops=function(user_world_war_troops,period_idx){null==list_User_World_War_Troops&&(list_User_World_War_Troops=new Map),list_User_World_War_Troops.insert([m_user_id,period_idx,user_world_war_troops.troops_num],user_world_war_troops)},NetServiceV3.prototype.deleteall_User_World_War_Troops_General=function(){null==list_User_World_War_Troops_General&&(list_User_World_War_Troops_General=new Map),list_User_World_War_Troops_General.clear()},NetServiceV3.prototype.delete_User_World_War_Troops_General=function(){null==list_User_World_War_Troops_General&&(list_User_World_War_Troops_General=new Map),list_User_World_War_Troops_General.clear()},NetServiceV3.prototype.insert_User_World_War_Troops_General=function(user_world_war_troops_general,period_idx){null==list_User_World_War_Troops_General&&(list_User_World_War_Troops_General=new Map),list_User_World_War_Troops_General.insert([m_user_id,period_idx,user_world_war_troops_general.troops_num,user_world_war_troops_general.gnrl_id,user_world_war_troops_general.gnrl_num],user_world_war_troops_general)},NetServiceV3.prototype.insert_User_World_War_Troops_Generals=function(user_world_war_troops_generals,period_idx){world_war_period_idx=period_idx,user_world_war_troops_generals.forEach(function(item){this.insert_User_World_War_Troops_General(item,period_idx)}.bind(this))},NetServiceV3.prototype.update_User_World_War_Troops_Generals=function(troops_num,user_world_war_troops_generals){null==list_User_World_War_Troops&&(list_User_World_War_Troops=new Map);for(var tdxKeys=list_User_World_War_Troops.keys(),tdx=0;tdx<tdxKeys.length;tdx++)list_User_World_War_Troops.at(tdxKeys[tdx]).troops_num==troops_num&&(list_User_World_War_Troops.at(tdxKeys[tdx]).troops_generals=user_world_war_troops_generals);null==list_User_World_War_Troops_General&&(list_User_World_War_Troops_General=new Map);for(var keys=list_User_World_War_Troops_General.keys(),key_idx=0,remove_list=[],remove_is=!1;key_idx<keys.length;)list_User_World_War_Troops_General.at(keys[key_idx]).troops_num==troops_num&&(remove_list.push(keys[key_idx]),remove_is=!0),++key_idx;if(1==remove_is)for(var kdx=0;kdx<remove_list.length;kdx++)list_User_World_War_Troops_General.remove(remove_list[kdx]);for(var idx=0;idx<user_world_war_troops_generals.length;idx++){var original=user_world_war_troops_generals[idx];list_User_World_War_Troops_General.insert([m_user_id,world_war_period_idx,original.troops_num,original.gnrl_id,original.gnrl_num],original)}},NetServiceV3.prototype.deleteall_User_World_War_Partin_Generals=function(){null==list_User_World_War_Partin_General&&(list_User_World_War_Partin_General=new Map),list_User_World_War_Partin_General.clear()},NetServiceV3.prototype.insert_User_World_War_Partin_Generals=function(user_world_war_partin_generals,period_idx){user_world_war_partin_generals.forEach(function(gnrls){this.insert_User_World_War_Partin_General(gnrls,period_idx)}.bind(this))},NetServiceV3.prototype.insert_User_World_War_Partin_General=function(user_world_war_partin_general,period_idx){null==list_User_World_War_Partin_General&&(list_User_World_War_Partin_General=new Map),list_User_World_War_Partin_General.insert([m_user_id,period_idx,user_world_war_partin_general.gnrl_id,user_world_war_partin_general.gnrl_num],user_world_war_partin_general)},NetServiceV3.prototype.update_User_World_War_Partin_Generals=function(user_world_war_partin_generals,period_idx){null==list_User_World_War_Partin_General&&(list_User_World_War_Partin_General=new Map);for(var keys=list_User_World_War_Partin_General.keys(),gidx=0;gidx<keys.length;gidx++){for(var p_general=list_User_World_War_Partin_General.at([keys[gidx]]),isFound=!1,i=0;i<user_world_war_partin_generals.length;i++){var info=user_world_war_partin_generals[i];if(p_general.gnrl_id==info.gnrl_id&&p_general.gnrl_num==info.gnrl_num){isFound=!0,i;break}}isFound&&list_User_World_War_Partin_General.insert(keys[gidx],info),p_general=null}keys=null},NetServiceV3.prototype.deleteall_User_World_War_General_Equipment_Item=function(){null==list_User_World_War_General_Equipment_Item&&(list_User_World_War_General_Equipment_Item=new Map),list_User_World_War_General_Equipment_Item.clear()},NetServiceV3.prototype.delete_User_World_War_General_Equipment_Item=function(user_world_war_general_equipment_item,period_idx){null!=list_User_World_War_General_Equipment_Item.at([m_user_id,period_idx,user_world_war_general_equipment_item.equipment_item_idx,user_world_war_general_equipment_item.equip_num])&&list_User_World_War_General_Equipment_Item.erase([m_user_id,period_idx,user_world_war_general_equipment_item.equipment_item_idx,user_world_war_general_equipment_item.equip_num])},NetServiceV3.prototype.insert_User_World_War_General_Equipment_Item=function(user_world_war_general_equipment_item,period_idx){list_User_World_War_General_Equipment_Item.insert([m_user_id,period_idx,user_world_war_general_equipment_item.equipment_item_idx,user_world_war_general_equipment_item.equip_num],user_world_war_general_equipment_item)},NetServiceV3.prototype.insert_User_World_War_General_Equipment_Items=function(user_world_war_general_equipment_items,period_idx){user_world_war_general_equipment_items.forEach(function(equipment){this.insert_User_World_War_General_Equipment_Item(equipment,period_idx)}.bind(this))},NetServiceV3.prototype.exist_User_World_War_Data=function(period_idx){return null==map_user_world_war_data&&(map_user_world_war_data=new Map),null!=map_user_world_war_data.at([m_user_id,period_idx])},NetServiceV3.prototype.insert_User_World_War_Data=function(userWorldWarInfo){var world_war_data={user_id:m_user_id,world_war_period_idx:userWorldWarInfo.world_war_period_idx,castle_occupation_count:userWorldWarInfo.castle_occupation_count,accum_turn_count:userWorldWarInfo.accum_turn_count,remain_active_count:userWorldWarInfo.remain_active_count,max_active_count:userWorldWarInfo.max_active_count,troops_lose_count:userWorldWarInfo.troops_lose_count,npc_retreat_count:userWorldWarInfo.npc_retreat_count,ghost_retreat_count:userWorldWarInfo.ghost_retreat_count,evt_npc_retreat_count:userWorldWarInfo.evt_npc_retreat_count,unification_yn:userWorldWarInfo.unification_yn};map_user_world_war_data.insert([m_user_id,world_war_data.world_war_period_idx],world_war_data)},NetServiceV3.prototype.update_User_World_War_Datas=function(userWorldWarTroopsMoveInfo){var war_data=map_user_world_war_data.at([m_user_id,userWorldWarTroopsMoveInfo.world_war_period_idx]);war_data.accum_turn_count=userWorldWarTroopsMoveInfo.accum_turn_count,war_data.remain_active_count=userWorldWarTroopsMoveInfo.remain_active_count,map_user_world_war_data.insert([m_user_id,userWorldWarTroopsMoveInfo.world_war_period_idx],war_data)},NetServiceV3.prototype.update_User_World_War_Data=function(userWorldWarInfo){var world_war_data={user_id:m_user_id,world_war_period_idx:userWorldWarInfo.world_war_period_idx,castle_occupation_count:userWorldWarInfo.castle_occupation_count,accum_turn_count:userWorldWarInfo.accum_turn_count,remain_active_count:userWorldWarInfo.remain_active_count,max_active_count:userWorldWarInfo.max_active_count,troops_lose_count:userWorldWarInfo.troops_lose_count,npc_retreat_count:userWorldWarInfo.npc_retreat_count,ghost_retreat_count:userWorldWarInfo.ghost_retreat_count,evt_npc_retreat_count:userWorldWarInfo.evt_npc_retreat_count,unification_yn:userWorldWarInfo.unification_yn};map_user_world_war_data.insert([m_user_id,world_war_data.world_war_period_idx],world_war_data),world_war_data=[]},NetServiceV3.prototype.update_User_World_War_Data2=function(userWorldWarInfo){var items=map_user_world_war_data.at([m_user_id,userWorldWarInfo.world_war_period_idx]),world_war_data={user_id:m_user_id,world_war_period_idx:userWorldWarInfo.world_war_period_idx,castle_occupation_count:items.castle_occupation_count,accum_turn_count:userWorldWarInfo.accum_turn_count,remain_active_count:userWorldWarInfo.remain_active_count,max_active_count:items.max_active_count,troops_lose_count:items.troops_lose_count,npc_retreat_count:items.npc_retreat_count,ghost_retreat_count:items.ghost_retreat_count,evt_npc_retreat_count:items.evt_npc_retreat_count,unification_yn:items.unification_yn};map_user_world_war_data.insert([m_user_id,world_war_data.world_war_period_idx],world_war_data)},NetServiceV3.prototype.update_User_World_War_Castle_Occupation_Count=function(nCount,nPeriodIdx){var war_data=map_user_world_war_data.at([m_user_id,nPeriodIdx]);null!=war_data.castle_occupation_count&&(war_data.castle_occupation_count=nCount,map_user_world_war_data.insert([m_user_id,nPeriodIdx],war_data))},NetServiceV3.prototype.delete_User_World_War_Castle_Occupation_Info=function(res){for(var isFound=!1,foundKey=0,keys=list_User_World_War_Castle_Occupation_Info.keys(),i=0;i<keys.length;i++){var info=list_User_World_War_Castle_Occupation_Info.at(keys[i]);if(res.castle.world_war_cell_info_idx==info.world_war_cell_info_idx){foundKey=i,isFound=!0;break}}isFound&&list_User_World_War_Castle_Occupation_Info.erase(keys[foundKey]),keys=null},NetServiceV3.prototype.deleteall_User_World_War_Castle_Occupation_Info=function(){null==list_User_World_War_Castle_Occupation_Info&&(list_User_World_War_Castle_Occupation_Info=new Map),list_User_World_War_Castle_Occupation_Info.clear()},NetServiceV3.prototype.insert_User_World_War_Castle_Occupation_Infos=function(user_world_war_castle_occupation_infos,period_idx){for(var i=0;i<user_world_war_castle_occupation_infos.length;i++){var item=user_world_war_castle_occupation_infos[i];this.insert_User_World_War_Castle_Occupation_Info(item,period_idx)}},NetServiceV3.prototype.insert_User_World_War_Castle_Occupation_Info=function(user_world_war_castle_occupation_info,period_idx){var world_war_data={user_id:m_user_id,world_war_period_idx:period_idx,world_war_group_idx:user_world_war_castle_occupation_info.world_war_group_idx,world_war_cell_info_idx:user_world_war_castle_occupation_info.world_war_cell_info_idx,own_yn:user_world_war_castle_occupation_info.own_yn,provision_count:user_world_war_castle_occupation_info.provision_count,elapsed:user_world_war_castle_occupation_info.elapsed,castle_durability_value:user_world_war_castle_occupation_info.castle_durability_value,max_castle_durability_value:user_world_war_castle_occupation_info.max_castle_durability_value,open_yn:user_world_war_castle_occupation_info.open_yn,special_funcs:user_world_war_castle_occupation_info.special_funcs};this.insert_User_World_War_Castle_Occupation_Special_Infos(user_world_war_castle_occupation_info.special_funcs,period_idx),list_User_World_War_Castle_Occupation_Info.insert([m_user_id,world_war_data.world_war_period_idx,world_war_data.world_war_group_idx,world_war_data.world_war_cell_info_idx],world_war_data),world_war_data=null},NetServiceV3.prototype.exist_User_World_War_Castle_Occupation_Info=function(period_idx,group_idx,cell_info_idx){return null!=list_User_World_War_Castle_Occupation_Info.at([m_user_id,period_idx,group_idx,cell_info_idx])},NetServiceV3.prototype.update_User_World_War_Castle_Occupation_Info=function(user_world_war_castle_occupation_info,period_idx){null==list_User_World_War_Castle_Occupation_Info&&(list_User_World_War_Castle_Occupation_Info=new Map);var world_war_data={user_id:m_user_id,own_yn:user_world_war_castle_occupation_info.own_yn,castle_durability_value:user_world_war_castle_occupation_info.castle_durability_value,open_yn:user_world_war_castle_occupation_info.open_yn,world_war_group_idx:user_world_war_castle_occupation_info.world_war_group_idx,world_war_cell_info_idx:user_world_war_castle_occupation_info.world_war_cell_info_idx,world_war_period_idx:period_idx,provision_count:user_world_war_castle_occupation_info.provision_count,elapsed:user_world_war_castle_occupation_info.elapsed,max_castle_durability_value:user_world_war_castle_occupation_info.max_castle_durability_value,special_funcs:user_world_war_castle_occupation_info.special_funcs};list_User_World_War_Castle_Occupation_Info.insert([m_user_id,world_war_data.world_war_period_idx,world_war_data.world_war_group_idx,world_war_data.world_war_cell_info_idx],world_war_data)},NetServiceV3.prototype.update_User_World_War_Castle_Occupation_Infos=function(infos,period_idx){list_User_World_War_Castle_Occupation_Info.clear(),infos.forEach(function(info){this.exist_User_World_War_Castle_Occupation_Info(period_idx,info.world_war_group_idx,info.world_war_cell_info_idx)?this.update_User_World_War_Castle_Occupation_Info(info,period_idx):this.insert_User_World_War_Castle_Occupation_Info(info,period_idx)}.bind(this))},NetServiceV3.prototype.delete_User_World_War_Castle_Occupation_Special_Info=function(res){for(var keys=list_User_World_War_Castle_Occupation_Special_Info.keys(),isfoundKey=!1,foundKeyIdx=0,i=0;i<keys.length;i++){var data=list_User_World_War_Castle_Occupation_Special_Info.at(keys[i]);if(data.world_war_cell_info_idx==res.castle.world_war_cell_info_idx){isfoundKey=!0,foundKeyIdx=i;break}data={}}isfoundKey&&list_User_World_War_Castle_Occupation_Special_Info.at(keys[foundKeyIdx]).erase(),keys=null},NetServiceV3.prototype.deleteall_User_World_War_Castle_Occupation_Special_Info=function(){null==list_User_World_War_Castle_Occupation_Special_Info&&(list_User_World_War_Castle_Occupation_Special_Info=new Map),list_User_World_War_Castle_Occupation_Special_Info.clear()},NetServiceV3.prototype.insert_User_World_War_Castle_Occupation_Special_Info=function(item,period_idx){null==list_User_World_War_Castle_Occupation_Special_Info&&(list_User_World_War_Castle_Occupation_Special_Info=new Map);var data={user_id:m_user_id,period_idx:period_idx,num:item.num,world_war_cell_info_idx:item.world_war_cell_info_idx,world_war_castle_special_func_idx:item.world_war_castle_special_func_idx};list_User_World_War_Castle_Occupation_Special_Info.insert([m_user_id,period_idx,item.world_war_cell_info_idx,item.num,item.world_war_castle_special_func_idx],data)},NetServiceV3.prototype.insert_User_World_War_Castle_Occupation_Special_Infos=function(user_world_war_castle_occupation_special_infos,period_idx){user_world_war_castle_occupation_special_infos.forEach(function(item){this.insert_User_World_War_Castle_Occupation_Special_Info(item,period_idx)}.bind(this))},NetServiceV3.prototype.deleteall_User_World_War_Npc_Troops=function(){null==list_User_World_War_Npc_Troops&&null==list_User_World_War_Npc_Troops&&(list_User_World_War_Npc_Troops=new Map),list_User_World_War_Npc_Troops.clear()},NetServiceV3.prototype.exist_User_World_War_Npc_Troops=function(user_world_war_npc_troops,period_idx){return null!=list_User_World_War_Npc_Troops.at([m_user_id,period_idx,user_world_war_npc_troops.world_war_npc_idx])},NetServiceV3.prototype.insert_User_World_War_Npc_Troops=function(user_world_war_npc_troops,period_idx){for(var i=0;i<user_world_war_npc_troops.length;i++){var item=user_world_war_npc_troops[i];this.insert_User_World_War_Npc_Troop(item,period_idx),this.insert_User_World_War_Npc_Troops_Generals(item.troops_generals,period_idx)}},NetServiceV3.prototype.insert_User_World_War_Npc_Troop=function(user_world_war_npc_troops,period_idx){null==list_User_World_War_Npc_Troops&&(list_User_World_War_Npc_Troops=new Map);var world_war_data={user_id:m_user_id,world_war_period_idx:period_idx,world_war_npc_idx:user_world_war_npc_troops.world_war_npc_idx,troops_num:user_world_war_npc_troops.troops_num,current_cell_info_idx:user_world_war_npc_troops.current_cell_info_idx,prev_cell_info_idx:user_world_war_npc_troops.prev_cell_info_idx,activity_type:user_world_war_npc_troops.activity_type,npc_type:user_world_war_npc_troops.npc_type,open_yn:user_world_war_npc_troops.open_yn,troops_generals:user_world_war_npc_troops.troops_generals};list_User_World_War_Npc_Troops.insert([m_user_id,world_war_data.world_war_period_idx,world_war_data.world_war_npc_idx],user_world_war_npc_troops)},NetServiceV3.prototype.update_User_World_War_Npc_Troops=function(user_world_war_npc_troops,period_idx){var world_war_data={};world_war_data.troops_num=user_world_war_npc_troops.troops_num,world_war_data.current_cell_info_idx=user_world_war_npc_troops.current_cell_info_idx,world_war_data.prev_cell_info_idx=user_world_war_npc_troops.prev_cell_info_idx,world_war_data.activity_type=user_world_war_npc_troops.activity_type,world_war_data.npc_type=user_world_war_npc_troops.npc_type,world_war_data.open_yn=user_world_war_npc_troops.open_yn,world_war_data.world_war_period_idx=period_idx,world_war_data.world_war_npc_idx=user_world_war_npc_troops.world_war_npc_idx,world_war_data.troops_generals=user_world_war_npc_troops.troops_generals,this.insert_User_World_War_Npc_Troop(world_war_data,period_idx),world_war_data=null},NetServiceV3.prototype.delete_User_World_War_Npc_Troops=function(user_world_war_npc_troops,period_idx){list_User_World_War_Npc_Troops.erase([m_user_id,period_idx,user_world_war_npc_troops.world_war_npc_idx])},NetServiceV3.prototype.deleteall_User_World_War_Npc_Troops_General=function(){null==list_User_World_War_Npc_Troops_General&&(list_User_World_War_Npc_Troops_General=new Map),list_User_World_War_Npc_Troops_General.clear()},NetServiceV3.prototype.insert_User_World_War_Npc_Troops_General=function(user_world_war_npc_troops_general,period_idx){null==list_User_World_War_Npc_Troops_General&&(list_User_World_War_Npc_Troops_General=new Map);var world_war_data={user_id:m_user_id,world_war_period_idx:period_idx,world_war_npc_idx:user_world_war_npc_troops_general.world_war_npc_idx,troops_num:user_world_war_npc_troops_general.troops_num,gnrl_id:user_world_war_npc_troops_general.gnrl_id,position:user_world_war_npc_troops_general.position,remain_hp:user_world_war_npc_troops_general.remain_hp,dead_yn:user_world_war_npc_troops_general.dead_yn,battle_point:user_world_war_npc_troops_general.battle_point};list_User_World_War_Npc_Troops_General.insert([m_user_id,world_war_data.world_war_period_idx,world_war_data.world_war_npc_idx,world_war_data.gnrl_id,world_war_data.position],world_war_data)},NetServiceV3.prototype.insert_User_World_War_Npc_Troops_Generals=function(user_world_war_npc_troops_generals,period_idx){user_world_war_npc_troops_generals.forEach(function(item){this.insert_User_World_War_Npc_Troops_General(item,period_idx)}.bind(this))},NetServiceV3.prototype.update_User_World_War_Npc_Troops_General=function(npc,period_idx){null==list_User_World_War_Npc_Troops_General&&(list_User_World_War_Npc_Troops_General=new Map);var world_war_data={user_id:m_user_id,world_war_period_idx:period_idx,world_war_npc_idx:npc.world_war_npc_idx,troops_num:npc.troops_num,gnrl_id:npc.gnrl_id,position:npc.position,remain_hp:npc.remain_hp,dead_yn:npc.dead_yn,battle_point:npc.battle_point};list_User_World_War_Npc_Troops_General.insert([m_user_id,world_war_data.world_war_period_idx,world_war_data.world_war_npc_idx,world_war_data.gnrl_id,world_war_data.position],world_war_data)},NetServiceV3.prototype.delete_User_World_War_Npc_Troops_General=function(npc_troops,period_idx){1==list_User_World_War_Npc_Troops_General.find([m_user_id,period_idx])&&list_User_World_War_Npc_Troops_General.remove([m_user_id,period_idx])},NetServiceV3.prototype.update_Battle_Bouns_Item=function(list){for(var i=0;i<list.length;i++){var item=list[i];item.bonus_type==BONUS_TYPE_WORLD_WAR_MEDAL?this.plus_World_War_Medal(item.bonus_idx):item.bonus_type==BONUS_TYPE_WORLD_WAR_UNIQUE_EQUIPMENT_TICKET&&this.plus_Unique_Equipment_Ticket(item.bonus_idx)}},NetServiceV3.prototype.deleteall_User_World_War_Unification_First_Clear_Reward_Log=function(){list_User_World_War_Unification_First_Clear_Reward_Log=[]},NetServiceV3.prototype.insert_User_World_War_Unification_First_Clear_Reward_Log=function(user_world_war_unification_first_clear_reward_log,period_idx){var rewardLogInfo={user_id:m_user_id,world_war_period_idx:user_world_war_unification_first_clear_reward_log.world_war_period_idx,world_war_group_idx:user_world_war_unification_first_clear_reward_log.world_war_group_idx,reward_y:user_world_war_unification_first_clear_reward_log.reward_yn};user_world_war_unification_first_clear_reward_log.world_war_period_idx==period_idx&&list_User_World_War_Unification_First_Clear_Reward_Log.push(rewardLogInfo)},NetServiceV3.prototype.insert_User_World_War_Unification_First_Clear_Reward_Log_List=function(user_world_war_unification_first_clear_reward_log,period_idx){if(!(user_world_war_unification_first_clear_reward_log.length<=0))for(var i=0;i<user_world_war_unification_first_clear_reward_log.length;i++)this.insert_User_World_War_Unification_First_Clear_Reward_Log(user_world_war_unification_first_clear_reward_log[i],period_idx)},NetServiceV3.prototype.createUserWorldWarNpcTroopsGeneral=function(npcArr,position,npc_id){var npc_gnrl={battle_point:0,dead_yn:"n"};return npc_gnrl.gnrl_id=npc_id,npc_gnrl.position=position,npc_gnrl.remain_hp=1e4,npc_gnrl.troops_num=CLIENT_CREATE_WW_NPC_TROOPS_NUM,npc_gnrl.world_war_npc_idx=npcArr.world_war_npc_idx,npc_gnrl},NetServiceV3.prototype.getBoxNode=function(id){if(vcBoxNode.empty())return null;for(var itfound=!1,i=0;i<vcBoxNode.size();i++)if(id==vcBoxNode[i].world_war_cell_info_idx)return itfound=!0,vcBoxNode[i];return itfound?void 0:null},NetServiceV3.prototype.removeCellBox=function(box){if(!vcBoxNode.empty()){var found=vcBoxNode.findIndex(function(b){if(box.world_war_group_idx==b.world_war_group_idx&&box.world_war_cell_info_idx==b.world_war_cell_info_idx)return!0});-1!=found&&vcBoxNode.erase(found)}},NetServiceV3.prototype.clearWorldWarBattleContinueInfo=function(){null==world_war_battle_continue_info&&(world_war_battle_continue_info=new Map),world_war_battle_continue_info=null},NetServiceV3.prototype.select_User_World_War_Items_medal=function(nTicketCount){return this.get_user_world_war_items().at([m_user_id]).medal},NetServiceV3.prototype.plus_World_War_Medal=function(add_medal){var cur_medal=this.select_User_World_War_Items_medal();cur_medal+=add_medal,this.update_User_World_War_Items_medal(cur_medal)},NetServiceV3.prototype.plus_Unique_Equipment_Ticket=function(add_ticket){var cur_ticket_count=this.select_User_Unique_Equipment_Ticket();cur_ticket_count+=add_ticket,this.update_User_Unique_Equipment_Ticket(cur_ticket_count)},NetServiceV3.prototype.getUserPartyGeneral=function(){return null==list_User_World_War_Troops_General&&(list_User_World_War_Troops_General=new Map),list_User_World_War_Troops_General},NetServiceV3.prototype.getCastleOccupationInfo=function(world_war_cell_info_idx,info){for(var keys=list_User_World_War_Castle_Occupation_Info.keys(),idx=0;idx<keys.length;idx++){var data=list_User_World_War_Castle_Occupation_Info.at(keys[idx]);if(data.world_war_cell_info_idx==world_war_cell_info_idx){info=data;break}}return keys=null,info},NetServiceV3.prototype.getCastleOccupationInfoList=function(infoList){infoList.clear();for(var keys=list_User_World_War_Castle_Occupation_Info.keys(),idx=0;idx<keys.length;idx++){var data=list_User_World_War_Castle_Occupation_Info.at(keys[idx]);infoList.push_back(data)}keys=null},NetServiceV3.prototype.getWorldWarUserGnrlEquipmentList=function(gnrl_key,user_gnrl_equips){for(var equip_list=[],keys=list_User_World_War_General_Equipment_Item.keys(),idx=0;idx<keys.length;idx++){var e=list_User_World_War_General_Equipment_Item.at(keys[idx]);if(e.gnrl_id==gnrl_key.gnrl_id&&e.gnrl_num==gnrl_key.gnrl_num){var data={};data.equipment_item_idx=e.equipment_item_idx,data.equipment_num=e.equip_num,data.gnrl_id=e.gnrl_id,data.gnrl_num=e.gnrl_num,equip_list.push_back(data)}}return keys=null,equip_list},NetServiceV3.prototype.getCastleSpecialFuncList=function(func_type){for(var m=MasterManager.getInstance(),keys=list_User_World_War_Castle_Occupation_Special_Info.keys(),list=[],i=0;i<keys.length;i++){var s=list_User_World_War_Castle_Occupation_Special_Info.at(keys[i]),special_func=m.get_WorldWarCastleSpecialFunc(s.world_war_castle_special_func_idx);0!=special_func.world_war_castle_special_func_idx&&(special_func.world_war_special_func_type==func_type&&list.push(special_func))}return keys=null,list},NetServiceV3.prototype.get_User_Unique_Equipment_Ticket=function(){return world_war_unique_equipment_ticket_count},NetServiceV3.prototype.get_Worldwar_User_Info=function(){return world_war_user_info},NetServiceV3.prototype.get_list_User_World_War_Troops=function(){return null==list_User_World_War_Troops&&(list_User_World_War_Troops=new Map),list_User_World_War_Troops},NetServiceV3.prototype.get_list_User_World_War_Troops_General=function(){return null==list_User_World_War_Troops_General&&(list_User_World_War_Troops_General=new Map),list_User_World_War_Troops_General},NetServiceV3.prototype.get_list_User_World_War_Partin_General=function(){return null==list_User_World_War_Partin_General&&(list_User_World_War_Partin_General=new Map),list_User_World_War_Partin_General},NetServiceV3.prototype.get_list_User_World_War_General_Equipment_Item=function(){return null==list_User_World_War_General_Equipment_Item&&(list_User_World_War_General_Equipment_Item=new Map),list_User_World_War_General_Equipment_Item},NetServiceV3.prototype.get_list_User_World_War_Castle_Occupation_Info=function(){return null==list_User_World_War_Castle_Occupation_Info&&(list_User_World_War_Castle_Occupation_Info=new Map),list_User_World_War_Castle_Occupation_Info},NetServiceV3.prototype.get_list_User_World_War_Castle_Occupation_Special_Info=function(){return null==list_User_World_War_Castle_Occupation_Special_Info&&(list_User_World_War_Castle_Occupation_Special_Info=new Map),list_User_World_War_Castle_Occupation_Special_Info},NetServiceV3.prototype.get_list_User_World_War_Npc_Troops=function(){return null==list_User_World_War_Npc_Troops&&(list_User_World_War_Npc_Troops=new Map),list_User_World_War_Npc_Troops},NetServiceV3.prototype.get_list_User_World_War_Npc_Troops_General=function(){return null==list_User_World_War_Npc_Troops_General&&(list_User_World_War_Npc_Troops_General=new Map),list_User_World_War_Npc_Troops_General},NetServiceV3.prototype.get_world_war_battle_continue_info=function(){return world_war_battle_continue_info},NetServiceV3.prototype.get_list_User_World_War_Unification_First_Clear_Reward_Log=function(){return null==list_User_World_War_Unification_First_Clear_Reward_Log&&(list_User_World_War_Unification_First_Clear_Reward_Log=[]),list_User_World_War_Unification_First_Clear_Reward_Log},NetServiceV3.prototype.get_user_world_war_items=function(){return null==map_user_world_war_items&&(map_user_world_war_items=new Map),map_user_world_war_items},NetServiceV3.prototype.get_map_user_world_war_data=function(){return null==map_user_world_war_data&&(map_user_world_war_data=new Map),map_user_world_war_data},{getInstance:function(){return void 0===instance&&(instance=new NetServiceV3),instance}}}(),WORLD_WAR_PERIOD_NONE=0,WORLD_WAR_PERIOD_SEASON=1,WORLD_WAR_PERIOD_REWARD=2;WorldWarService=function(){var instance,m_world_war_equipment_list=null,m_world_war_period_idx=0,m_world_war_group_idx=0,m_world_war_season_type=-1,m_bShowRewardPeriodPopup=!1,m_bShowNonePeriodPopup=!1,m_world_war_troops_num_for_cur_deck=0;function WorldWarService(){}return WorldWarService.prototype.isWorldWarPeriodOpen=function(){var is_open=!1,period_list=MasterTable.getInstance().get_WorldWarPeriodList(),n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf();return period_list.some(function(t){var b=moment(t.begin_dt).valueOf(),e=moment(t.end_dt).valueOf();if(b<=n&&n<=e)return is_open=!0}),is_open},WorldWarService.prototype.CheckWorldWarPeriod=function(){var bRet=!1,period_type=this.getCurrentPeriodType();if(period_type==WORLD_WAR_PERIOD_REWARD){if(SceneManager.getInstance().getRunningScene().getSceneId()!=scene_WorldWarRewardScene){bRet=m_bShowRewardPeriodPopup=!0;var scene=new WorldWarMainScene;SceneManager.getInstance().replaceScene(scene)}}else if(period_type==WORLD_WAR_PERIOD_NONE){bRet=m_bShowNonePeriodPopup=!0;scene=new MainHomeScene;SceneManager.getInstance().replaceScene(scene)}return bRet},WorldWarService.prototype.checkTroopsActionComplete=function(troops_num){for(var list_User_World_War_Troops=NetServiceV3.getInstance().get_list_User_World_War_Troops(),ret=!1,keys=list_User_World_War_Troops.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++){var t=list_User_World_War_Troops.at(keys[idx]);if(t.troops_num==troops_num){ret="y"==t.action_complete_yn;break}}return ret},WorldWarService.prototype.checkTroopsLaunched=function(troops_num){for(var ret=!1,list_User_World_War_Troops=NetServiceV3.getInstance().get_list_User_World_War_Troops(),keys=list_User_World_War_Troops.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++){var t=list_User_World_War_Troops.at(keys[idx]);if(t.troops_num==troops_num){ret=2==t.activity_type;break}}return ret},WorldWarService.prototype.getUserWorldWarSettedTroopsCount=function(){for(var count=0,list_User_World_War_Troops=NetServiceV3.getInstance().get_list_User_World_War_Troops(),keys=list_User_World_War_Troops.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++){0<list_User_World_War_Troops.at(keys[idx]).troops_generals.size()&&count++}return count},WorldWarService.prototype.getWorldWarTroopsGeneralCount=function(troops_num){for(var count=0,user_world_war_troops_general=NetServiceV3.getInstance().getUserPartyGeneral(),keys=user_world_war_troops_general.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++){user_world_war_troops_general.at(keys[idx]).troops_num==troops_num&&count++}return count},WorldWarService.prototype.getWorldWarTroopsCost=function(troops_num){for(var general,cost=0,m=MasterManager.getInstance(),user_world_war_troops_general=NetServiceV3.getInstance().getUserPartyGeneral(),gnrl_ids=[],keys=user_world_war_troops_general.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++){var t=user_world_war_troops_general.at(keys[idx]);if(t.troops_num==troops_num){var gnrl_id=t.gnrl_id;gnrl_ids.push_back(gnrl_id)}}return gnrl_ids.forEach(function(gnrl_id){general=m.get_General(gnrl_id),cost+=general.cost}),cost},WorldWarService.prototype.isExistGeneralInWorldWarTroops=function(troops_num,gnrl_num){for(var isExist=!1,user_world_war_troops_general=NetServiceV3.getInstance().getUserPartyGeneral(),keys=user_world_war_troops_general.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++){var t=user_world_war_troops_general.at(keys[idx]);t.gnrl_num==gnrl_num&&t.troops_num==troops_num&&(isExist=!0)}return isExist},WorldWarService.prototype.isExistGeneralInWorldWarPosType=function(troops_num,pos_type){for(var isExist=!1,user_world_war_troops_general=NetServiceV3.getInstance().getUserPartyGeneral(),keys=user_world_war_troops_general.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++){var t=user_world_war_troops_general.at(keys[idx]);t.troops_num==troops_num&&t.position==pos_type&&(isExist=!0)}return isExist},WorldWarService.prototype.isSameGeneralInWorldWarTroops=function(troops_num,position,troops){var troopsList=[];this.getUserWorldWarTroopsGeneralList(troopsList,troops_num);for(var selectGnrlId=troops.gnrl_id%1e3,idx=0;idx<troopsList.length;idx++){var item=troopsList[idx],id=item.gnrl_id%1e3;if(item.pos_type!=position&&selectGnrlId==id&&item.gnrl_num!=troops.gnrl_num)return!0}return!1},WorldWarService.prototype.isSameGeneralInWorldWarTroops_V2=function(troops_num,troops,position){var troopsList=[];this.getUserWorldWarTroopsGeneralList(troopsList,troops_num);var selectGnrlId=troops.gnrl_id%1e3;for(var item in troopsList){if(null==troopsList[item].gnrl_id)break;var id=troopsList[item].gnrl_id%1e3;if(troopsList[item].pos_type!=position&&selectGnrlId==id&&troopsList[item].gnrl_num!=troops.gnrl_num)return{result:!0,pos:position=troopsList[item].pos_type}}return{result:!1,pos:position=0}},WorldWarService.prototype.checkTroopsPosition=function(troops){for(var isCrrntPos=!1,user_world_war_troops_general=NetServiceV3.getInstance().getUserPartyGeneral(),keys=user_world_war_troops_general.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++){var t=user_world_war_troops_general.at(keys[idx]);t.gnrl_num==troops.gnrl_num&&t.troops_num==troops.troops_num&&t.position==troops.pos_type&&(isCrrntPos=!0)}return isCrrntPos},WorldWarService.prototype.getUserWorldWarTotalCost=function(troops_num){return WorldWarTable.getInstance().sel_UserWorldWarTotalCostBound(m_user_id,this.getWorldWarPeriodIndex(),troops_num)},WorldWarService.prototype.isCostOver=function(gnrl_troops,troops_num){for(var isOver=!1,totalCost=this.getUserWorldWarTotalCost(troops_num),crrnt_cost=0,user_world_war_troops_general=NetServiceV3.getInstance().getUserPartyGeneral(),gnrl_ids=[],keys=user_world_war_troops_general.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++){var t=user_world_war_troops_general.at(keys[idx]);if(t.troops_num==gnrl_troops.troops_num&&t.position!=gnrl_troops.pos_type&&t.gnrl_num!=gnrl_troops.gnrl_num){var gnrl_id=t.gnrl_id;gnrl_ids.push_back(gnrl_id)}}return gnrl_ids.push_back(gnrl_troops.gnrl_id),gnrl_ids.forEach(function(gnrl_id){var gnrl=MasterManager.getInstance().get_General(gnrl_id);crrnt_cost+=gnrl.cost}),totalCost<crrnt_cost&&(isOver=!0),isOver},WorldWarService.prototype.isExistUserWorldWarTroopsPos=function(troops_num,pos_type){for(var isExist=!1,user_world_war_troops_general=NetServiceV3.getInstance().getUserPartyGeneral(),keys=user_world_war_troops_general.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++){var t=user_world_war_troops_general.at(keys[idx]);t.troops_num==troops_num&&t.position==pos_type&&(isExist=!0)}return isExist},WorldWarService.prototype.getUserGeneralRemainHpRate=function(gnrl_key){for(var ret=0,list_User_World_War_Partin_General=NetServiceV3.getInstance().get_list_User_World_War_Partin_General(),keys=list_User_World_War_Partin_General.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++){var gnrl=list_User_World_War_Partin_General.at(keys[idx]);if(gnrl.gnrl_id==gnrl_key.gnrl_id&&gnrl.gnrl_num==gnrl_key.gnrl_num){ret=gnrl.remain_hp;break}}return ret},WorldWarService.prototype.getUserWorldWarTroopsGeneralList=function(list,troops_num){for(var user_world_war_troops_general=NetServiceV3.getInstance().getUserPartyGeneral(),keys=user_world_war_troops_general.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++){var i=user_world_war_troops_general.at(keys[idx]),troops={};if(troops.gnrl_id=i.gnrl_id,troops.gnrl_num=i.gnrl_num,troops.troops_num=i.troops_num,troops.pos_type=i.position,troops.is_leader="y"==i.leader_yn,null!=troops_num){var gnrl_key={};gnrl_key.gnrl_id=i.gnrl_id,gnrl_key.gnrl_num=i.gnrl_num,troops.remain_hp_rate=this.getUserGeneralRemainHpRate(gnrl_key),troops_num==troops.troops_num&&list.push_back(troops)}else list.push_back(troops)}return list},WorldWarService.prototype.getUserWorldWarTroopsGeneral=function(troops_num,pos_type,party){for(var user_world_war_troops_general=NetServiceV3.getInstance().getUserPartyGeneral(),keys=user_world_war_troops_general.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++){var i=user_world_war_troops_general.at(keys[idx]);if(i.troops_num==troops_num&&i.position==pos_type){party.gnrl_id=i.gnrl_id,party.gnrl_num=i.gnrl_num,party.troops_num=i.troops_num,party.pos_type=i.position,party.is_leader="y"==i.leader_yn;break}}},WorldWarService.prototype.getDelGeneralNumInWorldWarTroops=function(troops_num,pos_type){for(var gnrl_num=0,gnrl_id=0,keys_length=(keys=(user_world_war_troops_general=NetServiceV3.getInstance().getUserPartyGeneral()).keys()).length,idx=0;idx<keys_length;idx++){(i=user_world_war_troops_general.at(keys[idx])).troops_num==troops_num&&i.position==pos_type&&(gnrl_id=i.gnrl_id,gnrl_num=i.gnrl_num)}var user_world_war_troops_general,keys,isExist=!1;for(keys_length=(keys=(user_world_war_troops_general=NetServiceV3.getInstance().getUserPartyGeneral()).keys()).length,idx=0;idx<keys_length;idx++){var i;(i=user_world_war_troops_general.at(keys[idx])).troops_num!=troops_num&&i.gnrl_num==gnrl_num&&i.gnrl_id==gnrl_id&&(isExist=!0)}user_world_war_troops_general=null,isExist&&(gnrl_id=gnrl_num=0);var key={};return key.gnrl_id=gnrl_id,key.gnrl_num=gnrl_num,key},WorldWarService.prototype.checkWorldWarPartInGenerals=function(gnrls){if(0!=this.getWorldWarPeriodIndex()&&!this.isWorldWarUnification()&&this.isWorldWarPeriodOpen()){for(var list_User_World_War_Partin_General=NetServiceV3.getInstance().get_list_User_World_War_Partin_General(),keys=list_User_World_War_Partin_General.keys(),idx=0;idx<gnrls.length;idx++){for(var keys_length=keys.length,found_is=!1,found=0,jdx=0;jdx<keys_length;jdx++){var p=list_User_World_War_Partin_General.at(keys[jdx]);if(gnrls[idx].gnrl_id==p.gnrl_id&&gnrls[idx].gnrl_num==p.gnrl_num){found_is=!0,found=jdx;break}}if(gnrls[idx].remain_hp_rate=1e4,gnrls[idx].is_dead=!1,gnrls[idx].is_battle_start=!1,1==found_is){p=list_User_World_War_Partin_General.at(keys[found]);var general=$.extend({},p);gnrls[idx].remain_hp_rate=general.remain_hp,gnrls[idx].is_dead="y"==general.dead_yn,gnrls[idx].is_battle_start="y"==general.battle_start_yn;var gnrl_key={};gnrl_key.gnrl_id=gnrls[idx].gnrl_id,gnrl_key.gnrl_num=gnrls[idx].gnrl_num,gnrls[idx].using_in_world_war_troops=!0;var result=this.getWorldWarGeneralInTroops(gnrl_key,gnrls[idx].gw_troops_num,gnrls[idx].gw_position);gnrls[idx].gw_troops_num=result[0],gnrls[idx].gw_position=result[1]}else gnrls[idx].gw_troops_num=0,gnrls[idx].gw_position=0,gnrls[idx].remain_hp_rate=1e4;gnrls[idx].max_hp=GeneralService.getInstance().getMaxHPGeneral(gnrls[idx])}keys=list_User_World_War_Partin_General=null}},WorldWarService.prototype.getWorldWarGeneralInTroops=function(gnrl_key,troops_num,position){var returnVal=[];position=troops_num=0;for(var list_User_World_War_Troops=NetServiceV3.getInstance().get_list_User_World_War_Troops(),keys=list_User_World_War_Troops.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++)for(var t=list_User_World_War_Troops.at(keys[idx]),t_idx=0;t_idx<t.troops_generals.length;t_idx++){var g=t.troops_generals[t_idx];if(g.gnrl_id==gnrl_key.gnrl_id&&g.gnrl_num==gnrl_key.gnrl_num)return troops_num=t.troops_num,position=g.position,returnVal[0]=troops_num,returnVal[1]=position,keys=list_User_World_War_Troops=null,returnVal}return keys=list_User_World_War_Troops=null,returnVal[0]=troops_num,returnVal[1]=position,returnVal},WorldWarService.prototype.getWorldWarTroopNumberFromUserGeneralKey=function(gnrl_key){if(gnrl_key.gnrl_id<=0||gnrl_key.gnrl_num<=0)return 0;for(var ret_troop_num=0,list_User_World_War_Troops_General=NetServiceV3.getInstance().getUserPartyGeneral(),keys=list_User_World_War_Troops_General.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++){var gnrl=list_User_World_War_Troops_General.at(keys[idx]);if(gnrl.gnrl_id==gnrl_key.gnrl_id&&gnrl.gnrl_num==gnrl_key.gnrl_num){ret_troop_num=gnrl.troops_num;break}}return keys=list_User_World_War_Troops_General=null,ret_troop_num},WorldWarService.prototype.get_WorldWar_Npc_CurHP=function(gnrl_key,troops_num){for(var CurHp=0,list_User_World_War_Npc_Troops=NetServiceV3.getInstance().get_list_User_World_War_Npc_Troops(),keys=list_User_World_War_Npc_Troops.keys(),idx=0;idx<keys.length;idx++){var gnrl=list_User_World_War_Npc_Troops.at(keys[idx]);if(gnrl.troops_num==troops_num)for(var g_idx=0;g_idx<gnrl.troops_generals.length;g_idx++){var g=gnrl.troops_generals[g_idx];if(g.gnrl_id==gnrl_key.gnrl_id){CurHp=g.remain_hp;break}}}return keys=list_User_World_War_Npc_Troops=null,CurHp},WorldWarService.prototype.getUserWorldWarTroopsCellIdx=function(troops_num){for(var nRet=0,list_User_World_War_Troops=NetServiceV3.getInstance().get_list_User_World_War_Troops(),keys=list_User_World_War_Troops.keys(),idx=0;idx<keys.length;idx++){var t=list_User_World_War_Troops.at(keys[idx]);if(t.troops_num==troops_num){nRet=t.current_cell_info_idx;break}}return keys=list_User_World_War_Troops=null,nRet},WorldWarService.prototype.isWorldWarTroopsEmpty=function(troops_num){for(var bRet=!0,list_User_World_War_Troops=NetServiceV3.getInstance().get_list_User_World_War_Troops(),keys=list_User_World_War_Troops.keys(),idx=0;idx<keys.length;idx++){var t=list_User_World_War_Troops.at(keys[idx]);if(t.troops_num==troops_num&&0<t.troops_generals.size()){bRet=!1;break}}return keys=list_User_World_War_Troops=null,bRet},WorldWarService.prototype.isWorldWarTroopsZeroHp=function(troops_num){for(var bRet=!0,list_User_World_War_Troops=NetServiceV3.getInstance().get_list_User_World_War_Troops(),list_User_World_War_Partin_General=NetServiceV3.getInstance().get_list_User_World_War_Partin_General(),keys=list_User_World_War_Troops.keys(),partinkeys=list_User_World_War_Partin_General.keys(),idx=0;idx<keys.length;idx++){var t=list_User_World_War_Troops.at(keys[idx]);if(t.troops_num==troops_num){if(0==t.troops_generals.length){bRet=!1;break}for(var jdx=0;jdx<t.troops_generals.length;jdx++){for(var g=t.troops_generals[jdx],found=0,found_is=!1,p_idx=0;idx<partinkeys.length;p_idx++){var p=list_User_World_War_Partin_General.at(partinkeys[p_idx]);if(g.gnrl_id==p.gnrl_id&&g.gnrl_num==p.gnrl_num){found=p_idx,found_is=!0;break}}if(1==found_is){var general=list_User_World_War_Partin_General.at(partinkeys[found]);if(0<general.remain_hp){general=null,bRet=!1;break}general=null}}}}return keys=list_User_World_War_Partin_General=list_User_World_War_Troops=null,bRet},WorldWarService.prototype.isWorldWarTroopsMaxHp=function(troops_num){for(var list_User_World_War_Troops=NetServiceV3.getInstance().get_list_User_World_War_Troops(),keys=list_User_World_War_Troops.keys(),bRet=!0,idx=0;idx<keys.length;idx++){var t=list_User_World_War_Troops.at(keys[idx]);if(t.troops_num==troops_num){if(0==t.troops_generals.size()){bRet=!1;break}for(var t_idx=0;t_idx<t.troops_generals.length;t_idx++){for(var g=t.troops_generals[t_idx],found=void 0,list_User_World_War_Partin_General=NetServiceV3.getInstance().get_list_User_World_War_Partin_General(),partin_keys=list_User_World_War_Partin_General.keys(),pdx=0;pdx<partin_keys.length;pdx++){var p=list_User_World_War_Partin_General.at(partin_keys[pdx]);g.gnrl_id==p.gnrl_id&&g.gnrl_num==p.gnrl_num&&(found=p)}if(null!=found)if(found.remain_hp<1e4){bRet=!1;break}}}}return keys=list_User_World_War_Troops=null,bRet},WorldWarService.prototype.isWorldWarTroopsOpened=function(troops_num){for(var bRet=!1,list_User_World_War_Troops=NetServiceV3.getInstance().get_list_User_World_War_Troops(),keys=list_User_World_War_Troops.keys(),idx=0;idx<keys.length;idx++){var t=list_User_World_War_Troops.at(keys[idx]);if(t.troops_num==troops_num&&"y"==t.open_yn){bRet=!0;break}}return keys=list_User_World_War_Troops=null,bRet},WorldWarService.prototype.isLaunchedGeneral=function(gnrl_key){var bRet=!1,troops_num=this.getWorldWarTroopNumberFromUserGeneralKey(gnrl_key);return 0<troops_num&&this.checkTroopsLaunched(troops_num)&&(bRet=!0),bRet},WorldWarService.prototype.getUserWorldWarItemInfo=function(info){WorldWarTable.getInstance().sel_UserWorldWarItemInfo(m_user_id,info)},WorldWarService.prototype.getUserUniqueEuipmentTicketCount=function(){return NetServiceV3.getInstance().get_User_Unique_Equipment_Ticket()},WorldWarService.prototype.getUserWorldWarInfo=function(){return WorldWarTable.getInstance().sel_UserWorldWarInfo(m_user_id,this.getWorldWarPeriodIndex())},WorldWarService.prototype.setWorldWarSeasonInfo=function(nPeriodIdx,nSeasonType){this.setWorldWarPeriodIdx(nPeriodIdx),this.setWorldWarSeasonType(nSeasonType)},WorldWarService.prototype.setWorldWarPeriodIdx=function(nPeriodIdx){m_world_war_period_idx=nPeriodIdx},WorldWarService.prototype.setWorldWarSeasonType=function(nSeasonType){m_world_war_season_type=nSeasonType},WorldWarService.prototype.getCurrentPeriod=function(){var isPeriodNone=!0,period_list=MasterTable.getInstance().get_WorldWarPeriodList(),period={},n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf();period_list.some(function(t){var bd_season=moment(t.begin_dt).valueOf(),ed_shop=moment(t.shop_end_dt).valueOf();if(bd_season<=n&&n<=ed_shop)return period=t,isPeriodNone=!1});var returnList=[];return returnList[0]=period,returnList[1]=isPeriodNone,returnList},WorldWarService.prototype.getCurrentPeriodType=function(){if(0<=m_world_war_season_type)return m_world_war_season_type;var periodList=this.getCurrentPeriod(),period=periodList[0],isPeriodNone=periodList[1],period_type=WORLD_WAR_PERIOD_NONE;if(!isPeriodNone){var n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),bd_season=moment(period.begin_dt),ed_season=moment(period.end_dt),bd_shop=moment(period.shop_begin_dt),ed_shop=moment(period.shop_end_dt),bseason=bd_season.valueOf(),eseason=ed_season.valueOf(),bshop=bd_shop.valueOf(),eshop=ed_shop.valueOf();bseason<=n&&n<=eseason?period_type=WORLD_WAR_PERIOD_SEASON:bshop<=n&&n<=eshop&&(period_type=WORLD_WAR_PERIOD_REWARD)}return period_type},WorldWarService.prototype.getWorldWarPeriodIndex=function(){if(0==m_world_war_period_idx){var period=this.getCurrentPeriod()[0];m_world_war_period_idx=period.world_war_period_idx}return m_world_war_period_idx},WorldWarService.prototype.getWorldWarGroupIndex=function(){if(0==m_world_war_group_idx){var period=this.getCurrentPeriod()[0];m_world_war_group_idx=period.world_war_group_idx}return m_world_war_group_idx},WorldWarService.prototype.getMaxHPGeneral=function(gnrl_key){var origin_point,point=0,m=MasterManager.getInstance(),gnrl_serv=GeneralService.getInstance(),info={};if(gnrl_serv.getUserGeneralInfo(gnrl_key,info),point=origin_point=gnrl_serv.getUserGeneralHp(info),1<info.love_level){var love_stat_idx=BattleService.getInstance().getMasterLoveStat(info.love_stat_group,info.love_level);if(0<love_stat_idx){var stat=m.get_LoveStat(love_stat_idx);0<stat.stat_type_1&&(stat.stat_type_1==LOVE_ITEM_STAT_TYPE_5?point+=origin_point*stat.value_1/100:stat.stat_type_1==LOVE_ITEM_STAT_TYPE_6&&(point+=stat.value_1)),0<stat.stat_type_2&&(stat.stat_type_2==LOVE_ITEM_STAT_TYPE_5?point+=origin_point*stat.value_2/100:stat.stat_type_2==LOVE_ITEM_STAT_TYPE_6&&(point+=stat.value_2)),0<stat.stat_type_3&&(stat.stat_type_3==LOVE_ITEM_STAT_TYPE_5?point+=origin_point*stat.value_3/100:stat.stat_type_3==LOVE_ITEM_STAT_TYPE_6&&(point+=stat.value_3))}}if(info.arm_service_type<db.GeneralArmServiceType.ArmServiceType_Captain){var abil=CampService.getInstance().getUserCampBranchAbility(info.arm_service_type);1==CAMP_LOVE_STAT_TYPE?point+=origin_point*(abil.health/1e4):point+=abil.health}for(var p=0,formation_list=GeneralService.getInstance().getUserBattleFormationList(),keys=formation_list.keys(),idx=0;idx<keys.length;idx++)formation_list.at(keys[idx]).combo_stat==database.BattleChainStatType.ChainStatType_Hp_Rate&&formation_list.at(keys[idx]).position_type==info.position&&(p+=this.getBattleFormationValue(formation_list.at(keys[idx]).formation_id)),point+=origin_point*p/100;keys=formation_list=null;var key={};return key.gnrl_id=info.gnrl_id,key.gnrl_num=info.gnrl_num,point+=this.getEquipmentBuff(gnrl_key,database.BattleChainStatType.ChainStatType_Hp_Value),point+=point*this.getEquipmentBuff(gnrl_key,database.BattleChainStatType.ChainStatType_Hp_Rate)/100,point+=this.getEquipmentSetGroupBuff(gnrl_key,database.BattleChainStatType.ChainStatType_Hp_Value),point+=point*this.getEquipmentSetGroupBuff(gnrl_key,database.BattleChainStatType.ChainStatType_Hp_Rate)/100},WorldWarService.prototype.getCurHpGeneralPercent=function(gnrl_key){return WorldWarTable.getInstance().sel_UserWorldWarCurHpPercentGeneral(m_user_id,m_world_war_period_idx,gnrl_key)},WorldWarService.prototype.getCurHpGeneralLifeGauge=function(gnrl_key){var ret_life_gauge=1,max_hp=this.getMaxHPGeneral(gnrl_key),cur_hp=max_hp/1e4*this.getCurHpGeneralPercent(gnrl_key);return max_hp<cur_hp&&(cur_hp=max_hp),(ret_life_gauge=cur_hp/max_hp)<0?ret_life_gauge=0:1<ret_life_gauge&&(ret_life_gauge=1),ret_life_gauge},WorldWarService.prototype.updateWorldWarUserEquipmentList=function(){var allList=[];EquipmentService.getInstance().getUserEquipmentListInfo(allList,EQUIPMENT_TAB_NORMAL,{}),m_world_war_equipment_list=[];var list_user_equipment=NetServiceV3.getInstance().get_list_User_World_War_General_Equipment_Item();allList.some(function(orgInfo){orgInfo.equip_yn="n";for(var keys=list_user_equipment.keys(),idx=0;idx<keys.length;idx++){var wwInfo=list_user_equipment.at(keys[idx]);if(orgInfo.equip_id==wwInfo.equipment_item_idx&&orgInfo.equip_num==wwInfo.equip_num){orgInfo.equip_yn="y";break}}m_world_war_equipment_list.push_back(orgInfo)})},WorldWarService.prototype.setWorldWarUserEquipment=function(equipment_id,equipment_num,is_equip){if(!(equipment_id<=0)){var found=m_world_war_equipment_list.findIndex(function(equip){return equip.equip_id==equipment_id&&equip.equip_num==equipment_num});-1!=found&&(m_world_war_equipment_list[found].equip_yn=1==is_equip?"y":"n")}},WorldWarService.prototype.getWorldWarUserEquipmentData=function(info){if(!(info.equip_id<=0||info.equip_num<=0)){var equip_key={};equip_key.equipment_item_idx=info.equip_id,equip_key.equipment_num=info.equip_num;var data=NetService().getUserEquipment(equip_key);return data.equip_yn=info.equip_yn,data}},WorldWarService.prototype.getWorldWarUserEquipment=function(equip_key,info){var found=m_world_war_equipment_list.findIndex(function(equip){return equip.equip_id==equip_key.equipment_item_idx&&equip.equip_num==equip_key.equipment_num});return-1!=found&&(info=$.extend({},m_world_war_equipment_list[found])),info},WorldWarService.prototype.getWorldWarUserEquipmentList=function(list2){var list=[];return m_world_war_equipment_list.forEach(function(info){list.push_back(info)}),list},WorldWarService.prototype.getWorldWarUserEquipmentList1=function(list2,equip_parts_type){var list=[];return equip_parts_type==EQUIPMENT_PARTS_ALL||null==equip_parts_type?list=this.getWorldWarUserEquipmentList(list):(list.clear(),m_world_war_equipment_list.forEach(function(info){info.equip_parts_type==equip_parts_type&&list.push_back(info)})),list},WorldWarService.prototype.getWorldWarUserEquipmentList2=function(list2,key){for(var list_equipment=NetServiceV3.getInstance().get_list_User_World_War_General_Equipment_Item(),keys=list_equipment.keys(),idx=0;idx<keys.length;idx++){var gnrl_equip_Info=list_equipment.at(keys[idx]);gnrl_equip_Info.gnrl_id==key.gnrl_id&&gnrl_equip_Info.gnrl_num==key.gnrl_num&&m_world_war_equipment_list.forEach(function(info){info.equip_id==gnrl_equip_Info.equipment_item_idx&&info.equip_num==gnrl_equip_Info.equip_num&&list2.push_back(info)})}return list2},WorldWarService.prototype.getGeneralKeyforEquipment=function(equip_key,gnrl_key){gnrl_key.gnrl_id=0,gnrl_key.gnrl_num=0,WorldWarTable.getInstance().sel_getGeneralKeyforEquipment(m_user_id,m_world_war_period_idx,equip_key,gnrl_key)},WorldWarService.prototype.isEquipmentAvailableForUniquePrivateItem=function(gnrl_id,gnrl_group){var ret=!1;if(0<gnrl_id&&0<gnrl_group)for(var gnrl_list=MasterTable.getInstance().get_GeneralByGroup(gnrl_group),i=0;i<gnrl_list.length;i++)if(gnrl_list[i].gnrl_id==gnrl_id){ret=!0;break}return ret},WorldWarService.prototype.isEquipmentAvailableForPrivateItem=function(gnrl_id,equip_key){if(gnrl_id<=0||equip_key.equipment_item_idx<=0)return!1;var ret=!1,gnrl=MasterManager.getInstance().get_General(gnrl_id),userEquipment=this.getWorldWarUserEquipment(equip_key);return gnrl.arm_service_type==userEquipment.arm_service_type&&(ret=!0),4==userEquipment.arm_service_type&&(ret=!0),ret},WorldWarService.prototype.get_User_Special_List=function(special_list){WorldWarTable.getInstance().sel_User_World_War_Special_List(m_user_id,m_world_war_period_idx,special_list)},WorldWarService.prototype.getUserCastleSpecialInfo=function(cell_info_idx,special){WorldWarTable.getInstance().sel_UserWorldWarCastleSpecial(m_user_id,m_world_war_period_idx,cell_info_idx,special)},WorldWarService.prototype.getWorldWarTroopsGenerals=function(troops,gnrl_list,bIncludeDead){gnrl_list.clear();var gnrls=[];NetService().getUserGeneral(gnrls);for(var service=BattleService.getInstance(),idx=0;idx<troops.troops_generals.length;idx++){var gnrl=$.extend({},database.BattleGeneral);gnrl.gnrl_id=troops.troops_generals[idx].gnrl_id,gnrl.gnrl_num=troops.troops_generals[idx].gnrl_num,gnrl.position=troops.troops_generals[idx].position,gnrl.is_zoom="y"==troops.troops_generals[idx].leader_yn;for(var partin=null,list_User_World_War_Partin_General=NetServiceV3.getInstance().get_list_User_World_War_Partin_General(),keys=list_User_World_War_Partin_General.keys(),jdx=0;jdx<keys.length;jdx++){var p=list_User_World_War_Partin_General.at(keys[jdx]);gnrl.gnrl_id==p.gnrl_id&&gnrl.gnrl_num==p.gnrl_num&&(partin=p)}var found=gnrls.findIndex(function(ug){return troops.troops_generals[idx].gnrl_id==ug.gnrl_id&&troops.troops_generals[idx].gnrl_num==ug.gnrl_num});if(-1!=found&&null!=partin)if(!bIncludeDead&&partin.remain_hp<=0);else{var ug=gnrls[found];gnrl.gnrl_level=ug.gnrl_level,gnrl.exp=ug.gnrl_exp,gnrl.love_level=ug.love_level,gnrl.love_exp=ug.love_exp,gnrl.limit_step_id=ug.limit_step_id,gnrl.display_class=ug.display_class,gnrl.remain_hp_rate=partin.remain_hp,gnrl.remain_skill_count=partin.remain_skill_count,gnrl.max_skill_count=partin.max_skill_count,gnrl.is_dead=partin.remain_hp<=0,service.getMasterGeneral(gnrl),service.getWorldWarEquipmentOptions(gnrl),gnrl_list.push_back(gnrl)}gnrl=null}},WorldWarService.prototype.getTroops_BattlePoint=function(troops_number){for(var ret=0,list_User_World_War_Troops_General=NetServiceV3.getInstance().get_list_User_World_War_Troops_General(),keys=list_User_World_War_Troops_General.keys(),idx=0;idx<keys.length;idx++){var gnrl=list_User_World_War_Troops_General.at(keys[idx]);if(troops_number==gnrl.troops_num){var key={};key.gnrl_id=gnrl.gnrl_id,key.gnrl_num=gnrl.gnrl_num,ret+=this.getPartinGeneral_BattlePoint(key)}}return keys=list_User_World_War_Troops_General=null,ret},WorldWarService.prototype.getPartinGeneral_BattlePoint=function(key){for(var ret=0,m_world_war_partin_generals=NetServiceV3.getInstance().get_list_User_World_War_Partin_General(),keys=m_world_war_partin_generals.keys(),idx=0;idx<keys.length;idx++){var gnrl=m_world_war_partin_generals.at(keys[idx]);if(gnrl.gnrl_id==key.gnrl_id&&gnrl.gnrl_num==key.gnrl_num){0<gnrl.remain_hp&&(ret=gnrl.battle_point);break}}return ret},WorldWarService.prototype.get_Npc_Battl_Point=function(gnrl){var npc_att=MasterManager.getInstance().get_WorldWarCountFunc(25),npc_def=MasterManager.getInstance().get_WorldWarCountFunc(26),npc_hp=MasterManager.getInstance().get_WorldWarCountFunc(27),att=MasterManager.getInstance().get_WorldWarCountFunc(22),def=MasterManager.getInstance().get_WorldWarCountFunc(23),hp=MasterManager.getInstance().get_WorldWarCountFunc(24);return(npc_att.value/1e4*att.value*gnrl.attk+npc_def.value/1e4*def.value*gnrl.def+npc_hp.value/1e4*hp.value*gnrl.hp)/100},WorldWarService.prototype.get_Npc_Troops_BattlePoint=function(gnrl){var battle_point=0,m=MasterManager.getInstance(),npc_gnrl=m.get_NpcGeneral(gnrl.npc1_id);return battle_point+=this.get_Npc_Battl_Point(npc_gnrl),npc_gnrl=m.get_NpcGeneral(gnrl.npc2_id),battle_point+=this.get_Npc_Battl_Point(npc_gnrl),npc_gnrl=m.get_NpcGeneral(gnrl.npc3_id),battle_point+=this.get_Npc_Battl_Point(npc_gnrl),npc_gnrl=m.get_NpcGeneral(gnrl.npc4_id),battle_point+=this.get_Npc_Battl_Point(npc_gnrl),npc_gnrl=m.get_NpcGeneral(gnrl.npc5_id),battle_point+=this.get_Npc_Battl_Point(npc_gnrl)},WorldWarService.prototype.get_Npc_Troops_BattlePoint2=function(cell_idx){for(var ret=0,list_User_World_War_Npc_Troops=NetServiceV3.getInstance().get_list_User_World_War_Npc_Troops(),keys=list_User_World_War_Npc_Troops.keys(),idx=0;idx<keys.length;idx++){var troops=list_User_World_War_Npc_Troops.at(keys[idx]);if(cell_idx==troops.current_cell_info_idx)for(var g_idx=0;g_idx<troops.troops_generals.length;g_idx++)0<troops.troops_generals[g_idx].remain_hp&&(ret+=troops.troops_generals[g_idx].battle_point);troops=null}return keys=list_User_World_War_Npc_Troops=null,ret},WorldWarService.prototype.get_Npc_Troops_Now_HP=function(cell_idx){for(var MaxHp=0,CurHp=0,mTable=MasterManager.getInstance(),list_User_World_War_Npc_Troops=NetServiceV3.getInstance().get_list_User_World_War_Npc_Troops(),keys=list_User_World_War_Npc_Troops.keys(),idx=0;idx<keys.length;idx++){var troops=list_User_World_War_Npc_Troops.at(keys[idx]);if(cell_idx==troops.current_cell_info_idx){var npc=mTable.get_WorldWarNpc(troops.world_war_npc_idx,1),gnrl=mTable.get_NpcGeneral(npc.npc1_id);MaxHp+=gnrl.hp,CurHp+=gnrl.hp*(troops.troops_generals.at(0).remain_hp/1e4),MaxHp+=(gnrl=mTable.get_NpcGeneral(npc.npc2_id)).hp,CurHp+=gnrl.hp*(troops.troops_generals.at(1).remain_hp/1e4),MaxHp+=(gnrl=mTable.get_NpcGeneral(npc.npc3_id)).hp,CurHp+=gnrl.hp*(troops.troops_generals.at(2).remain_hp/1e4),MaxHp+=(gnrl=mTable.get_NpcGeneral(npc.npc4_id)).hp,CurHp+=gnrl.hp*(troops.troops_generals.at(3).remain_hp/1e4),MaxHp+=(gnrl=mTable.get_NpcGeneral(npc.npc5_id)).hp,CurHp+=gnrl.hp*(troops.troops_generals.at(4).remain_hp/1e4)}}return CurHp/MaxHp*100},WorldWarService.prototype.getEquipmentBuff=function(key,stat_type){var point=0,gnrl=new database.BattleGeneral2;if(gnrl.gnrl_id=key.gnrl_id,gnrl.gnrl_num=key.gnrl_num,this.getEquipmentsOnGeneral(gnrl),null!=gnrl.equipments)for(var i=0;i<gnrl.equipments.length;i++){var equip=gnrl.equipments[i];equip.combo_stat==stat_type&&(point+=equip.stat_value);for(var j=0;j<equip.equipment_options.length;j++){var opt=equip.equipment_options[j];opt.opt_type==database.BattleEquipmentOptionType.OptStatType&&opt.stats.forEach(function(stat){stat.combo_stat==stat_type&&(point+=stat.stat_value)})}}return point},WorldWarService.prototype.getEquipmentSetGroupBuff=function(key,stat_type){var point=0,gnrl=(MasterManager.getInstance(),new database.BattleGeneral2);gnrl.gnrl_id=key.gnrl_id,gnrl.gnrl_num=key.gnrl_num,this.getEquipmentsOnGeneral(gnrl);var set_item_count_map=new Map;if(null!=gnrl.equipments)for(var idx=0;idx<gnrl.equipments.length;idx++){var e=gnrl.equipments[idx];if(0!=e.equip_group){for(var found=-1,keys=set_item_count_map.keys(),kdx=0;kdx<keys.length;kdx++){set_item_count_map.at(keys[kdx]);if(e.equip_group==keys[kdx]){found=keys[kdx];break}}if(-1!=found){var set_item=set_item_count_map.at(found);set_item+=1,set_item_count_map.insert(found,set_item)}else set_item_count_map.insert(e.equip_group,1)}}if(0<set_item_count_map.size())for(var jdx=0;jdx<set_item_count_map.length;jdx++){var grp=set_item_count_map[jdx];if(1<grp){var set_item_count=grp;3<set_item_count&&(set_item_count=3);var equip_set_info=MasterManager.getInstance().get_EquipmentGroup(jdx,set_item_count);0!=equip_set_info.equip_group_idx&&g.set_equipment_effect.push(equip_set_info)}}for(idx=0;idx<gnrl.set_equipment_effect.length;idx++){var set_eff=gnrl.set_equipment_effect[idx];set_eff.combo_stat==stat_type&&(point+=set_eff.added_value)}return point},WorldWarService.prototype.getEquipmentsOnGeneral=function(gnrl){var m=MasterManager.getInstance(),equip_serv=EquipmentService.getInstance(),gnrl_key={};gnrl_key.gnrl_id=gnrl.gnrl_id,gnrl_key.gnrl_num=gnrl.gnrl_num;var ue_list=[];ue_list=this.getWorldWarUserEquipmentList2(ue_list,gnrl_key);for(var mapOpt=new Map,idx=0;idx<ue_list.length;idx++){var ue=ue_list[idx],be=new database.BattleEquipment;be.equipment_item_idx=ue.equip_id,be.equipment_num=ue.equip_num,be.equipment_level=ue.level,be.arm_service_type=ue.arm_service_type,be.equipment_step=ue.equip_step,be.combo_stat=ue.combo_stat,be.stat_value=ue.stat_value,be.option_num1=ue.option_num1,be.option_num2=ue.option_num2,be.option_num3=ue.option_num3,be.option_num4=ue.option_num4,be.option_num5=ue.option_num5,be.equipment=m.get_EquipmentItem(be.equipment_item_idx);var step_rate=m.get_EquipmentStepRate(be.equipment.equip_step_idx,be.equipment_step);mapOpt=null,(mapOpt=new Map).insert(1,{num:be.option_num1,idx:step_rate.option1_idx}),mapOpt.insert(2,{num:be.option_num2,idx:step_rate.option2_idx}),mapOpt.insert(3,{num:be.option_num3,idx:step_rate.option3_idx}),mapOpt.insert(4,{num:be.option_num4,idx:step_rate.option4_idx}),mapOpt.insert(5,{num:be.option_num5,idx:step_rate.option5_idx});for(var optKey=0,optVal=[],opt_num=0,step_rate_opt_idx=0,mapOptKeys=mapOpt.keys(),i=0;i<mapOptKeys.length;i++)if(optKey=mapOptKeys[i],opt_num=(optVal=mapOpt.at(optKey)).num,step_rate_opt_idx=optVal.idx,0!=opt_num){var opt=new database.BattleEquipmentOption;opt.equipment_item_idx=be.equipment_item_idx,opt.equipment_step=be.equipment_step,opt.option_num=opt_num,opt.option=m.get_EquipmentItemOption(step_rate_opt_idx,opt.option_num),opt.option_level_info=m.get_EquipmentItemOptionLevel(opt.option.level_idx,be.equipment_level),be.equip_group=opt.option.equip_group_idx,equip_serv.getEquipmentOptionDataForBattle(opt),be.equipment_options.push_back(opt),opt=null}gnrl.equipments.push_back(be)}return!0},WorldWarService.prototype.getWorldWarGachaShopInfoList=function(gacha_box_group_idx,list){MasterTable.getInstance().get_WorldWarGachaShopList(gacha_box_group_idx,list);for(var i=0;i<list.length;i++){var shop=list[i];"Y"==shop.display_yn&&list.push(shop)}},WorldWarService.prototype.isWorldWarUnification=function(){var ret=!1,period_idx=this.getWorldWarPeriodIndex();return NetServiceV3.getInstance().get_Worldwar_User_Info().world_war_period_idx==period_idx&&"y"==NetServiceV3.getInstance().get_Worldwar_User_Info().unification_yn&&(ret=!0),ret},WorldWarService.prototype.isWorldWarUnificationCastleClear=function(){for(var ret=!1,occupation_count=0,mtable=MasterManager.getInstance(),groupIdx=this.getWorldWarGroupIndex(),list_user_world_war_castle_occupation_info=NetServiceV3.getInstance().get_list_User_World_War_Castle_Occupation_Info(),keys=list_user_world_war_castle_occupation_info.keys(),i=0;i<keys.length;i++){var info=list_user_world_war_castle_occupation_info.at(keys[i]);mtable.get_WorldWarCellInfo(info.world_war_cell_info_idx,groupIdx).world_war_move_cell_type==eNodeTypeTable.et_castle&&"y"==info.own_yn&&occupation_count++}return mtable.get_WorldWarCountFunc(WWCF_MAX_CASTLE).value<=occupation_count&&(ret=!0),ret},WorldWarService.prototype.isWorldWarFirstCastleSpecialInfoPopup=function(){var ret=!1,list_User_World_War_Castle_Occupation_Special_Info=NetServiceV3.getInstance().get_list_User_World_War_Castle_Occupation_Special_Info();if(list_User_World_War_Castle_Occupation_Special_Info.size()<=0&&0==GameDefault.getInstance().getWorldWarCastleSpecialInfo()){for(var castle_special_count=0,m=MasterManager.getInstance(),list_User_World_War_Castle_Occupation_Info=NetServiceV3.getInstance().get_list_User_World_War_Castle_Occupation_Info(),keys=list_User_World_War_Castle_Occupation_Info.keys(),i=0;i<keys.length;i++){var info=list_User_World_War_Castle_Occupation_Info.at(keys[i]);if("y"==info.own_yn){var cellInfo=m.get_WorldWarCellInfo(info.world_war_cell_info_idx,info.world_war_group_idx);if(cellInfo.world_war_move_cell_type==eWorldWarMoveCellType.castle_special&&1<++castle_special_count)break;cellInfo=null}info=null}1==castle_special_count?ret=!0:1<castle_special_count&&GameDefault.getInstance().setWorldWarCastleSpecialInfo(!0)}return list_User_World_War_Castle_Occupation_Special_Info=null,ret},WorldWarService.prototype.isEquipmentReleaseAvailable=function(equip_key){if(0==equip_key.equipment_item_idx||0==equip_key.equipment_num)return!1;var gnrlkey={};if(this.getGeneralKeyforEquipment(equip_key,gnrlkey),0==gnrlkey.gnrl_id||0==gnrlkey.gnrl_num)return!1;var troop_num=this.getWorldWarTroopNumberFromUserGeneralKey(gnrlkey);if(!(0<troop_num))return!0;var world_war_cell_info_idx=this.getUserWorldWarTroopsCellIdx(troop_num);if(world_war_cell_info_idx<=0)return!1;var group_index=this.getWorldWarGroupIndex();return 0!=group_index&&MasterManager.getInstance().get_WorldWarCellInfo(world_war_cell_info_idx,group_index).world_war_move_cell_type==eWorldWarMoveCellType.base_castle},WorldWarService.prototype.beginMapNode=function(){return MasterTable.getInstance().begin_map_WorldWarCellInfo()},WorldWarService.prototype.endMapNode=function(){return MasterTable.getInstance().end_map_WorldWarCellInfo()},WorldWarService.prototype.allMapNode=function(){return MasterTable.getInstance().all_map_WorldWarCellInfo()},WorldWarService.prototype.beginCounterFunction=function(){return MasterTable.getInstance().begin_map_WorldWarCountFunc()},WorldWarService.prototype.IsShowRewardPeriodPopup=function(){return m_bShowRewardPeriodPopup},WorldWarService.prototype.SetShowRewardPeriodPopup=function(bFlag){m_bShowRewardPeriodPopup=bFlag},WorldWarService.prototype.IsShowNonePeriodPopup=function(){return m_bShowNonePeriodPopup},WorldWarService.prototype.GetWorldWarTroopsNumForCurDeck=function(bFlag){return m_world_war_troops_num_for_cur_deck},WorldWarService.prototype.SetWorldWarTroopsNumForCurDeck=function(troops_num){m_world_war_troops_num_for_cur_deck=troops_num},{getInstance:function(){return void 0===instance&&(instance=new WorldWarService),instance}}}();