var event_dungeon_invalid_entrance_lack_key=1e3,event_dungeon_battle_ready=1001,event_dungeon_invalid_entrance_time=1002,event_dungeon_disable_pre_open_dungeon=1003,EventDungeonListLayer=cc.Layer.extend({m_table_view:null,m_left_layer:null,m_right_layer:null,m_difficulty_name:null,m_gnrl_body:null,m_complete_mask:null,m_content_label:null,m_battle_ready_btn:null,m_bonus_label:null,m_jade_cnt_label:null,m_spend_skip_label:null,m_spend_label:null,m_boss_container:null,m_first_jade_reward:null,m_npc_list:[],m_reward_list:[],m_event_dungeon_data:[],m_event_dungeon_list:[],m_gnrl_img:[],m_task_list:[],m_error:0,m_card_war_boss_num:0,m_deferred:null,m_item_scroll_view:null,m_item_scroll_container:null,m_scroll_arrow_left:null,m_scroll_arrow_right:null,m_tooltip_box:null,m_event_dungeon_cutin_accum_rate_point:{},m_mission_task_modal_layer:null,m_skip_circle_point:null,m_battle_ready_skip_btn:null,m_deffer_done:!1,ctor:function(deferred){this._super(),this.m_npc_list=[],this.m_reward_list=[],this.m_event_dungeon_data=[],this.m_event_dungeon_list=[],this.m_gnrl_img=[],this.m_task_list=[],this.m_event_dungeon_cutin_accum_rate_point={},this.m_deffer_done=!1,this.init()},init:function(){var path=RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3";AudioEngine.getInstance().playEffect(path),this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var winSize=ccSize(this),service=BattleService.getInstance(),event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();this.m_event_dungeon_list=service.getUserEventDungeonList(event_dungeon_period_idx,this.m_event_dungeon_list),EventDungeonService.getInstance().getUserEventDungeonCutinAccumRatePoint(event_dungeon_period_idx,this.m_event_dungeon_cutin_accum_rate_point);var last_event_dungeon_idx=BattleContext._getInstance().getLastEventDungeonId(),last_open_dungeon_index=0;if(0==last_event_dungeon_idx){if(0<this.m_event_dungeon_list.length){for(var i=0;i<this.m_event_dungeon_list.length;i++)this.m_event_dungeon_list[i].is_open_pre_event_dungeon&&(last_open_dungeon_index=Math.max(i,0));this.m_event_dungeon_list[last_open_dungeon_index].is_selected=!0,this.m_event_dungeon_data.push(this.m_event_dungeon_list[last_open_dungeon_index])}}else if(0<this.m_event_dungeon_list.length){for(i=0;i<this.m_event_dungeon_list.length;i++)this.m_event_dungeon_list[i].event_dungeon.event_dungeon_idx==last_event_dungeon_idx&&(last_open_dungeon_index=Math.max(i,0));this.m_event_dungeon_list[last_open_dungeon_index].is_selected=!0,this.m_event_dungeon_data.push(this.m_event_dungeon_list[last_open_dungeon_index])}this.m_boss_container=new cc.Node,this.m_boss_container.setPosition(winSize.width,0),this.addChild(this.m_boss_container);var mask_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal_4.png",RectZero());mask_bg.setContentSize(644,640),mask_bg.setAnchorPoint(ZERO()),mask_bg.setPosition(LP(this,300,0)),this.addChild(mask_bg);new cc.rect(12,12,12,12),cc.size(478,468);this.m_left_layer=new cc.Layer,this.m_left_layer.ignoreAnchorPointForPosition(!1),this.m_left_layer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_left_layer.setContentSize(478,468),this.m_left_layer.setPosition(.5*winSize.width-1,0),this.addChild(this.m_left_layer),this.m_right_layer=new cc.Layer,this.m_right_layer.ignoreAnchorPointForPosition(!1),this.m_right_layer.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_right_layer.setPosition(ZERO()),this.addChild(this.m_right_layer),this.createRightBoxLayer();var modalSize=cc.size(winSize.width,640);return this.m_mission_task_modal_layer=new GameModalLayer,this.m_mission_task_modal_layer.setContentSize(modalSize),this.addChild(this.m_mission_task_modal_layer,99998),!0},createLeftBoxLayer:function(){var table_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));table_bg.setContentSize(478,568),table_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),table_bg.setPosition(ZERO()),this.m_left_layer.addChild(table_bg);var bgSize=cc.size(table_bg.getContentSize().width,table_bg.getContentSize().height),left_navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");left_navi.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),left_navi.setPosition(.5*bgSize.width,509),this.m_left_layer.addChild(left_navi);var naviSize=cc.size(left_navi.getContentSize().width,left_navi.getContentSize().height),navi_title=cmLabel.getLabel("ダンジョンリスト",LABEL_FONT_INDEX.FONT_261);navi_title.setAnchorPoint(ANCHOR_MIDDLE()),navi_title.setPosition(.5*naviSize.width,.5*naviSize.height+3),left_navi.addChild(navi_title);var tableSize=cc.size(444,532-naviSize.height);this.m_table_view=new cc.TableView(this,tableSize),this.m_table_view.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_table_view.ignoreAnchorPointForPosition(!1),this.m_table_view.setVerticalFillOrder(0),this.m_table_view.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_table_view.setPosition(17,18),this.m_table_view.setDelegate(this),this.m_left_layer.addChild(this.m_table_view),this.m_table_view.scrollBarEnable(!0),this.m_table_view.reloadData()},createCutinInfoLayer:function(){EventDungeonService.getInstance();var layer=new cc.Layer;layer.ignoreAnchorPointForPosition(!1);var winSize=ccSize(this.m_right_layer),cloud_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_sample/img_eventvs_cut_cloud_v2.png");cloud_bg.setAnchorPoint(ANCHOR_TOP_RIGHT()),cloud_bg.setPosition(ccWidth(cloud_bg),ccHeight(cloud_bg)),layer.addChild(cloud_bg),layer.setAnchorPoint(ANCHOR_TOP_RIGHT()),layer.setContentSize(ccSize(cloud_bg)),layer.setPosition(winSize.width,winSize.height-55),this.m_right_layer.addChild(layer,100);var progress_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero());progress_bg.setContentSize(cc.size(146,12)),progress_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),progress_bg.setPosition(44,20),cloud_bg.addChild(progress_bg);var bar=new cc.Sprite(cmString(RES_CDN_DEFULT+"common/img_9p_gauge_red_3.png"));bar.setContentSize(cc.size(140,6)),bar._rect=cc.rect(0,0,140,6);var cutin_progress=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_red_3.png",RectZero());cutin_progress.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),cutin_progress.setPreferredSize(cc.size(0,6)),cutin_progress.setPosition(3,3),progress_bg.addChild(cutin_progress);var off=RES_CDN_DEFULT+"menu_eventvs_sample/img_eventvs_cut_gauge_front_v2.png",on=RES_CDN_DEFULT+"menu_eventvs_sample/img_eventvs_cut_gauge_on_v2.png",cutin_info_btn=new ccui.Button(off,on);cutin_info_btn.addClickEventListener(function(sender){var scene=new EventDungeonCutinBossInfoScene;SceneManager.getInstance().replaceScene(scene),scene=null}.bind(this)),cutin_info_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),cutin_info_btn.setPosition(265,67),cloud_bg.addChild(cutin_info_btn);var blink_eff=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_sample/img_eventvs_cut_gauge_ef_v2.png");blink_eff.setAnchorPoint(ANCHOR_MIDDLE()),blink_eff.setPosition(ccCenter(progress_bg)),blink_eff.setVisible(!1),blink_eff.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR),progress_bg.addChild(blink_eff);var fo=new cc.FadeOut(1),fi=new cc.FadeIn(1),seq=new cc.Sequence(fo,fi),repeat=new cc.RepeatForever(seq);blink_eff.runAction(repeat);var cf=MasterManager.getInstance().get_CountFunction(4),per=this.m_event_dungeon_cutin_accum_rate_point.cutin_accum_rate/cf.value*100;100<per&&(per=100),0!=per?(cutin_progress.setPreferredSize(cc.size(1.4*per,6)),cutin_progress.setScaleX(1)):cutin_progress.setScaleX(0);var cutin_text=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_sample/img_eventvs_cut_text_v2.png");cutin_text.setAnchorPoint(ANCHOR_TOP_LEFT()),cutin_text.setPosition(42,67),cloud_bg.addChild(cutin_text)},createRightBoxLayer:function(){if(0!=this.m_event_dungeon_list.length){for(var dungeon=this.getSelectedDungeon(),idx=0;idx<this.m_gnrl_img.length;idx++)cc.loader.release(this.m_gnrl_img[idx]);if(this.m_gnrl_img=[],this.m_gnrl_img.push(RES_CDN_DEFULT+"common/img_circle.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"common/img_attend_finish_small.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"common/img_line.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_quest/img_story_ic_key.png"),85001!=dungeon.event_dungeon_period.event_dungeon_period_idx&&85002!=dungeon.event_dungeon_period.event_dungeon_period_idx||this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_eventvs_"+dungeon.event_dungeon_period.event_dungeon_period_idx+"/img_eventvs_list_present.png"),!USE_SP_EVENT_SCALE)for(idx=1;idx<EVENT_DUNGEON_LIST_NUM+1;idx++)this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_eventvs_"+dungeon.event_dungeon_period.event_dungeon_period_idx+"/img_eventvs_list_"+cmString("%02d",idx)+".png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_eventvs_"+dungeon.event_dungeon_period.event_dungeon_period_idx+"/img_eventvs_text_event_"+cmString("%02d",idx)+".png");var dungeon_stage_npc=dungeon.stage_npc.at(3);for(idx=0;idx<dungeon_stage_npc.length;idx++){var npc=dungeon_stage_npc[idx],n=MasterManager.getInstance().get_NpcGeneral(npc.npc_id),gnrl=MasterManager.getInstance().get_General(n.gnrl_id);npc.is_zoom&&(gnrl.gnrl_group<100?this.m_gnrl_img.push(RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(gnrl.gnrl_group,2)+".png"):this.m_gnrl_img.push(RES_CDN_DEFULT+"card_war_boss/"+gnrl.gnrl_group+".png"),this.m_card_war_boss_num=gnrl.gnrl_group)}cc.loader.load(this.m_gnrl_img,function(err,results){err?cc.log("Failed to load %s.",this.m_gnrl_img):(this.createLeftBoxLayer(),this.m_table_view.reloadData(),this.start_createRightBoxLayer())}.bind(this))}},open_createRightBoxLayer_Callback:function(){var layer=new cc.Layer;layer.setContentSize(481,568),layer.setPosition(LP(this,479,0)),this.m_right_layer.addChild(layer,1e3),this.m_card_war_boss_num<100?(this.m_gnrl_body=cc.Sprite.create(RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(this.m_card_war_boss_num,2)+".png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(this.m_card_war_boss_num,2)+".png")):(this.m_gnrl_body=cc.Sprite.create(RES_CDN_DEFULT+"card_war_boss/"+this.m_card_war_boss_num+".png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"card_war_boss/"+this.m_card_war_boss_num+".png")),this.m_gnrl_body.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_gnrl_body.setPosition(ZERO()),this.m_gnrl_body.setScale(2),this.m_boss_container.addChild(this.m_gnrl_body);var scaleTo_1=cc.scaleTo(.7,2,2.01),scaleTo_2=cc.scaleTo(.7,2,1.99),sequence=cc.sequence(scaleTo_1,scaleTo_2),repeat=cc.repeatForever(sequence);if(this.m_gnrl_body.runAction(repeat),USE_SP_EVENT_SCALE){var dungeon=this.getSelectedDungeon();this.m_difficulty_name=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_"+dungeon.event_dungeon_period.event_dungeon_period_idx+"/img_eventvs_text_event_01.png"),this.m_difficulty_name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_difficulty_name.setPosition(19,500),layer.addChild(this.m_difficulty_name)}else{dungeon=this.getSelectedDungeon();this.m_difficulty_name=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_"+dungeon.event_dungeon_period.event_dungeon_period_idx+"/img_eventvs_text_event_01.png"),this.m_difficulty_name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_difficulty_name.setPosition(19,500),layer.addChild(this.m_difficulty_name)}(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(circle_point),circle_point.setPosition(19,457);var first_reward_title=cmLabel.getLabel(res_str("label_marathon_first_reward"),LABEL_FONT_INDEX.FONT_248);first_reward_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),first_reward_title.setPosition(35,449),layer.addChild(first_reward_title),this.m_first_jade_reward=new MissionPreviewBonusItemCell,this.m_first_jade_reward.setPosition(213,426),this.m_first_jade_reward.setEnableItemCount(!0),this.m_first_jade_reward.setEnableToolTip(!0),layer.addChild(this.m_first_jade_reward),this.m_complete_mask=cc.Sprite.create(RES_CDN_DEFULT+"common/img_attend_finish_small.png"),this.m_complete_mask.setPosition(ccCenter(this.m_first_jade_reward)),this.m_first_jade_reward.addChild(this.m_complete_mask,20),this.m_complete_mask.setVisible(!1),(line=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(line),line.setPosition(19,405),(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(circle_point),circle_point.setPosition(19,380);var appear_gnrl_title=cmLabel.getLabel(res_str("label_weekly_dungeon_boss_stage_npc_title"),LABEL_FONT_INDEX.FONT_248);appear_gnrl_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),appear_gnrl_title.setPosition(35,373),layer.addChild(appear_gnrl_title);var circle_point,npc_pos=[];npc_pos.push(cc.rect(19,258)),npc_pos.push(cc.rect(91,294)),npc_pos.push(cc.rect(91,222)),npc_pos.push(cc.rect(163,294)),npc_pos.push(cc.rect(163,222));for(var gnrl=MasterManager.getInstance().get_General(14058),i=0;i<npc_pos.length;i++){var npc=new NpcInfoItemNode(CARD_TYPE.type_card_thumb);npc.setPosition(npc_pos[i]),npc.setGlobalZOrderTooltip(!0),npc.setGeneralData(gnrl,0==i),layer.addChild(npc),this.m_npc_list.push(npc)}(line=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(line),line.setPosition(19,202),(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(circle_point),circle_point.setPosition(19,182);var bonus_title=cmLabel.getLabel(res_str("label_reward_bonus"),LABEL_FONT_INDEX.FONT_248);bonus_title.setAnchorPoint(ZERO()),bonus_title.setPosition(35,174),layer.addChild(bonus_title);var viewSize=cc.size(420,85);this.m_item_scroll_container=new cc.Layer,this.m_item_scroll_container.ignoreAnchorPointForPosition(!1),this.m_item_scroll_container.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_item_scroll_container.setContentSize(68,98),this.m_item_scroll_container.setPosition(ZERO()),this.m_item_scroll_container.scrollViewDidScroll=function(view){if(view==this.m_item_scroll_view){var viewSize=view.getViewSize(),container_width=view.getContainer().getContentSize().width;if(viewSize.width>=container_width)this.m_scroll_arrow_left.setVisible(!1),this.m_scroll_arrow_right.setVisible(!1);else{var offset=view.getContentOffset(),diff=viewSize.width-container_width;0<=offset.x?(this.m_scroll_arrow_left.setVisible(!1),this.m_scroll_arrow_right.setVisible(!0)):offset.x<=diff?(this.m_scroll_arrow_left.setVisible(!0),this.m_scroll_arrow_right.setVisible(!1)):(this.m_scroll_arrow_left.setVisible(!0),this.m_scroll_arrow_right.setVisible(!0))}}}.bind(this),this.m_item_scroll_container.scrollViewDidZoom=function(){},this.m_scroll_arrow_left=cc.Sprite.create(RES_CDN_DEFULT+"common/img_scroll_arrow.png"),this.m_scroll_arrow_left.setFlippedX(!0),this.m_scroll_arrow_left.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_scroll_arrow_left.setPosition(19,81+.5*viewSize.height),layer.addChild(this.m_scroll_arrow_left),this.m_scroll_arrow_right=cc.Sprite.create(RES_CDN_DEFULT+"common/img_scroll_arrow.png"),this.m_scroll_arrow_right.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_scroll_arrow_right.setPosition(19+viewSize.width,81+.5*viewSize.height),layer.addChild(this.m_scroll_arrow_right),this.m_item_scroll_view=new cc.ScrollView(viewSize,this.m_item_scroll_container),this.m_item_scroll_view.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_item_scroll_view.setPosition(19,81),this.m_item_scroll_view.setDirection(cc.SCROLLVIEW_DIRECTION_HORIZONTAL),this.m_item_scroll_view.setDelegate(this.m_item_scroll_container),layer.addChild(this.m_item_scroll_view),this.m_item_scroll_view.setContentOffset(cc.p(0,0),!1);var offset_x=0;for(i=0;i<16;i++){var bonus=new MissionPreviewBonusItemCell(this.addTooltip.bind(this),this.removeTooltip.bind(this));bonus.setEnableToolTip(!0,!0),bonus.setEnableItemCount(!0),bonus.setPosition(offset_x,15),this.m_item_scroll_container.addChild(bonus),offset_x+=72,this.m_reward_list.push_back(bonus)}var line,container_width=72*this.m_reward_list.size();this.m_item_scroll_container.setContentSize(container_width,98),this.m_skip_circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png"),this.m_skip_circle_point.setAnchorPoint(ZERO()),layer.addChild(this.m_skip_circle_point),this.m_skip_circle_point.setPosition(19,40),(line=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ZERO()),this.m_skip_circle_point.addChild(line),line.setPosition(0,24);var task_title=cmLabel.getLabel(res_str("label_task_title"),LABEL_FONT_INDEX.FONT_248);task_title.setAnchorPoint(ZERO()),task_title.setPosition(16,-7),this.m_skip_circle_point.addChild(task_title);for(var task_offset_x=140,j=0;j<3;j++){var task=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_off.png");task.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),task.setPosition(task_offset_x,30),layer.addChild(task),this.m_task_list.push_back(task),task_offset_x+=34}var help_btn=new ccui.Button("btn_help_small_off.png","btn_help_small_on.png","",ccui.Widget.PLIST_TEXTURE);help_btn.setAnchorPoint(ZERO()),help_btn.setPosition(228,0),this.m_skip_circle_point.addChild(help_btn),help_btn.addClickEventListener(function(sender){this.showMissionTaskModalLayer()}.bind(this));cc.Director._getInstance().getWinSize().width;var s=ccSize(layer),off_skip=cc.Sprite.create("#btn_44_off.png");cc.Sprite.create("#btn_44_on.png"),cc.Sprite.create("#btn_44_none.png");this.m_battle_ready_skip_btn=new LabelButton("btn_44_off.png","btn_44_on.png","btn_44_none.png",ccui.Widget.PLIST_TEXTURE),this.m_battle_ready_skip_btn.addClickEventListener(function(sender){this.battleReady()}.bind(this));var start_label_skip=cmLabel.getLabel(res_str("btn_label_start"),LABEL_FONT_INDEX.FONT_241);start_label_skip.setAnchorPoint(ANCHOR_MIDDLE()),start_label_skip.setPosition(ccCenter(this.m_battle_ready_skip_btn).x-50,ccCenter(this.m_battle_ready_skip_btn).y),this.m_battle_ready_skip_btn.addChild(start_label_skip),this.m_battle_ready_skip_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_battle_ready_skip_btn.setPosition(LP(this,ccWidth(layer)-10,10)),layer.addChild(this.m_battle_ready_skip_btn);var icon_box_skip=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",cc.rect(10,10,10,10));icon_box_skip.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),icon_box_skip.setPreferredSize(cc.size(66,38)),icon_box_skip.setPosition(.5*ccWidth(off_skip)+16,.5*ccHeight(off_skip)),this.m_battle_ready_skip_btn.addChild(icon_box_skip);var key_icon_skip=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_ic_key.png");key_icon_skip.setAnchorPoint(ANCHOR_MIDDLE()),key_icon_skip.setPosition(0,.5*ccHeight(icon_box_skip)),icon_box_skip.addChild(key_icon_skip),this.m_spend_skip_label=cmLabel.getLabel("0",LABEL_FONT_INDEX.FONT_247),this.m_spend_skip_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_spend_skip_label.setPosition(ccWidth(icon_box_skip)-10,.5*ccHeight(icon_box_skip)),icon_box_skip.addChild(this.m_spend_skip_label);var off=cc.Sprite.create("#btn_03_off.png");cc.Sprite.create("#btn_03_on.png"),cc.Sprite.create("#btn_03_none.png");this.m_battle_ready_btn=new ccui.Button("btn_03_off.png","btn_03_on.png","btn_03_none.png",ccui.Widget.PLIST_TEXTURE),this.m_battle_ready_btn.addClickEventListener(function(sender){this.battleReady()}.bind(this));var start_label=cmLabel.getLabel(res_str("btn_label_start"),LABEL_FONT_INDEX.FONT_241);start_label.setAnchorPoint(ANCHOR_MIDDLE()),start_label.setPosition(ccCenter(this.m_battle_ready_btn).x-50,ccCenter(this.m_battle_ready_btn).y),this.m_battle_ready_btn.addChild(start_label),this.m_battle_ready_btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_battle_ready_btn.setPosition(.5*s.width,16),layer.addChild(this.m_battle_ready_btn);var icon_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",cc.Rect(10,10,10,10));icon_box.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),icon_box.setPreferredSize(cc.size(66,38)),icon_box.setPosition(.5*ccWidth(off)+16,.5*ccHeight(off)),this.m_battle_ready_btn.addChild(icon_box);var key_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_ic_key.png");key_icon.setAnchorPoint(ANCHOR_MIDDLE()),key_icon.setPosition(0,.5*ccHeight(icon_box)),icon_box.addChild(key_icon),this.m_spend_label=cmLabel.getLabel("0",LABEL_FONT_INDEX.FONT_247),this.m_spend_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_spend_label.setPosition(ccWidth(icon_box)-10,.5*ccHeight(icon_box)),icon_box.addChild(this.m_spend_label),this.updateRightInfo(),this.createCutinInfoLayer()},start_createRightBoxLayer:function(){var callback=new cc.CallFunc(this.open_createRightBoxLayer_Callback,this);this.runAction(new cc.Sequence(new cc.DelayTime(1),callback))},onEnter:function(){this._super()},onExit:function(){if(this._super(),null!=this.m_gnrl_img){for(var idx=0;idx<this.m_gnrl_img.length;idx++)cc.loader.release(this.m_gnrl_img[idx]),cc.textureCache.removeTexture(this.m_gnrl_img[idx]);this.m_gnrl_img=[]}},cellSizeForTable:function(table){return new ccSize(444,140)},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;(cell=null!=c?c:new EventDungeonListCell).unSelected();var data=this.m_event_dungeon_list[idx];return cell.setData(data),cell},tableCellSizeForIndex:function(table,idx){return cc.size(130,140)},numberOfCellsInTableView:function(table){return this.m_event_dungeon_list.length},tableCellTouched:function(table,cell){var path=RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3";AudioEngine.getInstance().playEffect(path);for(var idx=cell.getIdx(),i=0;i<this.m_event_dungeon_list.length;i++)this.m_event_dungeon_list[i].is_selected=idx==i;var offset=table.getContentOffset();table.reloadData(),table.setContentOffset(offset),this.updateRightInfo()},addTooltip:function(world_pos,tooltip,title,content){if(null!=this.m_tooltip_box)return!1;this.m_tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.m_tooltip_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_tooltip_box.setPosition(world_pos),this.m_tooltip_box.setVisible(!0),this.addChild(this.m_tooltip_box);var tooltip_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1810);tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_tooltip_box.addChild(tooltip_title);var tooltip_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181);if(tooltip_content.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_tooltip_box.addChild(tooltip_content),tooltip_title.setString(title),tooltip_content.setString(content),""!=content){var tSize=ccSize(tooltip_title),cSize=ccSize(tooltip_content);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(tSize.width+20,cSize.width+20),bSize.height=Math.max(64,bSize.height+cSize.height+5),this.m_tooltip_box.setContentSize(tooltip._contentSize),this.m_tooltip_box.setPreferredSize(bSize),tooltip_title.setPosition(10,bSize.height-10),tooltip_content.setPosition(10,bSize.height-15-tSize.height)}else{tooltip_title.setAnchorPoint(ANCHOR_MIDDLE());var bSize;tSize=ccSize(tooltip_title);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(64,tSize.width+20),bSize.height=Math.max(54,bSize.height+10),this.m_tooltip_box.setPreferredSize(bSize),tooltip_title.setPosition(ccCenter(bSize))}},removeTooltip:function(){this.removeChild(this.m_tooltip_box),this.m_tooltip_box=null},battleReady:function(){if(this.m_error=0,this.IsEnableEntrance())if(IS_SP_BROWSER)this.getParent().initLayoutProgress_Raid(0),this.scheduleOnce(function(dt){var bs=BattleService.getInstance(),dungeon=this.getSelectedDungeon();bs.getMasterEventDungeonNpcInfo(dungeon);var context=BattleContext._getInstance();context.setGameType(db.BattleGameType.EventDungeon),context.setEventDungeonId(dungeon.event_dungeon.event_dungeon_idx),context.setEventDungeonData(dungeon),context.setLastEventDungeonId(dungeon.event_dungeon.event_dungeon_idx),MainObserver.getInstance().postNotification(sceneStr[scene_EventDungeonListScene],event_dungeon_battle_ready),this.getParent().removeLayerProgress_Raid()},.5,"EventDungeonListLayerBattleReady");else{var bs=BattleService.getInstance(),dungeon=this.getSelectedDungeon();bs.getMasterEventDungeonNpcInfo(dungeon);var context=BattleContext._getInstance();context.setGameType(db.BattleGameType.EventDungeon),context.setEventDungeonId(dungeon.event_dungeon.event_dungeon_idx),context.setEventDungeonData(dungeon),context.setLastEventDungeonId(dungeon.event_dungeon.event_dungeon_idx),MainObserver.getInstance().postNotification(sceneStr[scene_EventDungeonListScene],event_dungeon_battle_ready)}else if(this.m_error==event_dungeon_invalid_entrance_lack_key){dungeon=this.getSelectedDungeon();var scene=SceneManager.getInstance().getRunningScene();scene.showNotEnoughKey(dungeon.event_dungeon.need_key),scene=null}else MainObserver.getInstance().postNotification(sceneStr[scene_EventDungeonListScene],this.m_error)},IsEnableEntrance:function(){var dungeon=this.getSelectedDungeon();if(dungeon.is_open_pre_event_dungeon){var now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),b=dungeon.event_dungeon_period.begin_date.valueOf(),e=dungeon.event_dungeon_period.end_date.valueOf();return b<=n&&n<=e?(this.m_error=event_dungeon_battle_ready,!0):(this.m_error=event_dungeon_invalid_entrance_time,!1)}return this.m_error=event_dungeon_disable_pre_open_dungeon,!1},checkNeedKeyEventDungeon:function(){var need_key=0,dungeon=this.getSelectedDungeon(),is_expense_dec=!1,now=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)),nn=moment(now).valueOf();for(var idx in list_Global_Booster_Event_V2){var bt,et,b=list_Global_Booster_Event_V2[idx];bt=moment(b.begin_dt).format("YYYY-MM-DD"),et=moment(b.end_dt).format("YYYY-MM-DD");var bb=bt.valueOf(),ee=et.valueOf();if(bb<=nn&&nn<=ee&&b.booster_type==BOOSTER_TYPE_V2_MARATHON_DUNGEON&&b.variation_type==BOOSTER_VARIATION_TYPE_V2_EXPENSE_DEC&&b.item_type==BOOSTER_ITEM_TYPE_V2_ENTRANCE_TICKET){if(0==b.value_1){need_key=dungeon.event_dungeon.need_key-dungeon.event_dungeon.need_key*b.variation_value/100,is_expense_dec=!0;break}if(b.value_1==dungeon.event_dungeon.event_dungeon_idx){need_key=dungeon.event_dungeon.need_key-dungeon.event_dungeon.need_key*b.variation_value/100,is_expense_dec=!0;break}}}var user_service=UserService.getInstance();if(user_service.isBeginnerBooster()){var mt_booster=user_service.getMtBeginnerBooster(BEGINNER_BOOSTER_TYPE_CONSUME_DECREASE,0,CONSUME_DECREASE_KEY);0<mt_booster.value&&(mt_booster.battle_type==BATTLE_DUNGEON_TYPE_EVENT_DUNGEON||mt_booster.battle_type==BATTLE_DUNGEON_TYPE_ALL)&&(need_key=Math.floor(dungeon.event_dungeon.need_key-dungeon.event_dungeon.need_key*mt_booster.value/1e4),is_expense_dec=!0)}return is_expense_dec&&(need_key=Math.max(need_key,0)),0==need_key&&(need_key=dungeon.event_dungeon.need_key),need_key},updateEntranceKey:function(){var need_key=this.checkNeedKeyEventDungeon();this.m_spend_label.setString(need_key),0!=this.getSelectedDungeon().task_list.length&&this.m_spend_skip_label.setString(cmString("%d",need_key)),this.m_deffer_done=!0},get_deffer_done:function(){return this.m_deffer_done},updateRightInfo:function(){if(0!=this.m_event_dungeon_list.length){var dungeon=this.getSelectedDungeon(),m=MasterTable.getInstance(),service=BattleService.getInstance(),winSize=ccSize(this);dungeon.event_dungeon.event_dungeon_idx==PRESENT_DUNGEON_IDX?(this.m_difficulty_name.setTexture(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_vs_event_dungeon_text_present_2.png",dungeon.event_dungeon_period.event_dungeon_period_idx)),this.m_gnrl_img.push(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_vs_event_dungeon_text_present_2.png",dungeon.event_dungeon_period.event_dungeon_period_idx))):(this.m_difficulty_name.setTexture(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_text_event_%02d.png",dungeon.event_dungeon_period.event_dungeon_period_idx,dungeon.event_dungeon.bg_type)),this.m_gnrl_img.push(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_text_event_%02d.png",dungeon.event_dungeon_period.event_dungeon_period_idx,dungeon.event_dungeon.bg_type))),cc.log("!@#!@#"),this.m_boss_container.isRunning()&&this.m_boss_container.stopAllActions();for(var i=0;i<this.m_npc_list.length;i++){(n=this.m_npc_list[i]).setVisible(!1)}for(var dungeon_stage_npc=dungeon.stage_npc.at(3),idx=0;idx<dungeon_stage_npc.length;idx++){var npc=dungeon_stage_npc[idx],n=MasterManager.getInstance().get_NpcGeneral(npc.npc_id),gnrl=MasterManager.getInstance().get_General(n.gnrl_id);if(npc.is_zoom){if(gnrl.gnrl_group<100){var boss_img=RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(gnrl.gnrl_group,2)+".png";this.m_gnrl_img.push(boss_img);var frame_texture=cc.textureCache.addImage(boss_img),frame=new cc.SpriteFrame(frame_texture,cc.rect(0,0,frame_texture.getContentSize().width,frame_texture.getContentSize().height));this.m_gnrl_body.setScale(2),this.m_gnrl_body.setSpriteFrame(frame)}else{boss_img=RES_CDN_DEFULT+"card_war_boss/"+gnrl.gnrl_group+".png";this.m_gnrl_img.push(boss_img);frame_texture=cc.textureCache.addImage(boss_img);var frame1=new cc.SpriteFrame(frame_texture,cc.rect(0,0,frame_texture.getContentSize().width,frame_texture.getContentSize().height));this.m_gnrl_body.setScale(2),this.m_gnrl_body.setSpriteFrame(frame1)}this.m_boss_container.setPosition(winSize.width+ccWidth(this.m_gnrl_body),0);var move=new cc.MoveTo(.2,cc.p(winSize.width,0));this.m_boss_container.runAction(move)}var p=npc.position-1,npc_icon=this.m_npc_list[p];npc_icon.setVisible(!0),npc_icon.setNpcData(n,npc.is_zoom),npc_icon.setGlobalZOrderTooltip(!0)}var bonus=m.getMasterTable().get_EventDungeonBonus(dungeon.event_dungeon.event_dungeon_bonus_idx),b_items=m.get_EventDungeonBonusItem(bonus.event_dungeon_bonus_idx),dup_remove_item_list=[];for(idx=0;idx<b_items.length;idx++){var b=b_items[idx];-1==dup_remove_item_list.findIndex(function(it){return it.bonus_type==b.bonus_type})&&dup_remove_item_list.push_back(b)}for(idx=0;idx<this.m_reward_list.length;idx++){(b=this.m_reward_list[idx]).setVisible(!1)}var reward_index=0;for(idx=0;idx<dup_remove_item_list.length;idx++){b=dup_remove_item_list[idx];var item={};service.convertBonusInfo(b,item);var reward=this.m_reward_list[reward_index];reward.setVisible(!0),item.item_type==database.BattleGainItemType.EventPoint||item.item_type==database.BattleGainItemType.SpecialPoint?item.item_level=dungeon.event_dungeon.event_dungeon_period_idx:item.item_type==database.BattleGainItemType.SpecialPoint&&(item.item_level=dungeon.event_dungeon.event_dungeon_period_idx),reward.setEnableItemCount(1e4==b.bonus_gain_rate&&b.min_value==b.max_value),reward.setGainItem(item),reward_index++}var container_width=72*dup_remove_item_list.size();this.m_item_scroll_container.setContentSize(container_width,68),this.m_item_scroll_view.setContentOffset(cc.p(0,0)),this.m_error=0;var is_enable_entrance=this.IsEnableEntrance();this.m_error==event_dungeon_invalid_entrance_lack_key?(this.m_battle_ready_btn.setEnabled(!0),0!=dungeon.task_list.length&&this.m_battle_ready_skip_btn.setEnabled(!0)):(0!=dungeon.task_list.length&&this.m_battle_ready_skip_btn.setEnabled(is_enable_entrance),this.m_battle_ready_btn.setEnabled(is_enable_entrance));var first_reward=$.extend({},database.BattleGainItem);switch(bonus.first_clear_bonus_type){case BONUS_TYPE_JADE:first_reward.item_type=database.BattleGainItemType.Jade,first_reward.item_id=bonus.first_clear_bonus_type,first_reward.item_count=bonus.first_clear_min_value,this.m_first_jade_reward.setGainItem(first_reward);break;case BONUS_TYPE_YUNHEE_FIX:first_reward.item_type=database.BattleGainItemType.General,first_reward.item_id=bonus.first_clear_min_value,first_reward.item_level=1,first_reward.item_count=1,this.m_first_jade_reward.setGainItem(first_reward);break;case BONUS_TYPE_EQUIPMENT:first_reward.item_type=database.BattleGainItemType.Equipment,first_reward.item_id=bonus.first_clear_min_value,first_reward.item_count=bonus.first_clear_max_value,this.m_first_jade_reward.setGainItem(first_reward);break;case BONUS_TYPE_SR_LIMIT_OVER_MTRL:case BONUS_TYPE_SSR_LIMIT_OVER_MTRL:first_reward.item_type=database.BattleGainItemType.LimitOverMtrl,first_reward.item_id=bonus.first_clear_bonus_type,first_reward.item_count=bonus.first_clear_min_value,this.m_first_jade_reward.setGainItem(first_reward);break;case BONUS_TYPE_LOVE_ITEM_CAKE:first_reward.item_type=database.BattleGainItemType.LoveItem,first_reward.item_id=bonus.first_clear_bonus_type,first_reward.item_count=bonus.first_clear_min_value,this.m_first_jade_reward.setGainItem(first_reward)}this.m_complete_mask.setVisible(dungeon.is_complete);var have_task_list=!0;if(0==dungeon.task_list.length&&(have_task_list=!1),have_task_list){var complete_task=0;for(i=0;i<dungeon.task_list.length;i++)dungeon.task_list[i].is_complete&&(complete_task+=1);for(var j=0;j<this.m_task_list.length;j++){var task=this.m_task_list[j];if(j<complete_task){frame=RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_on.png";var frame2_texture=cc.textureCache.addImage(frame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));task.setSpriteFrame(frame2)}else{frame=RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_off.png",frame2_texture=cc.textureCache.addImage(frame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));task.setSpriteFrame(frame2)}}this.m_battle_ready_btn.setVisible(!1),this.m_battle_ready_skip_btn.setVisible(!0),this.m_skip_circle_point.setVisible(!0)}else this.m_battle_ready_btn.setVisible(!0),this.m_battle_ready_skip_btn.setVisible(!1),this.m_skip_circle_point.setVisible(!1);for(complete_task=0,j=0;j<dungeon.task_list.length;j++){dungeon.task_list[j].is_complete&&(complete_task+=1)}for(var k=0;k<this.m_task_list.length;k++){task=this.m_task_list[k];if(k<complete_task){frame=RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_on.png",frame2_texture=cc.textureCache.addImage(frame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));task.setSpriteFrame(frame2)}else{frame=RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_off.png",frame2_texture=cc.textureCache.addImage(frame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));task.setSpriteFrame(frame2)}}this.updateEntranceKey()}},getSelectedDungeon:function(){for(var i=0;i<this.m_event_dungeon_list.length;i++)if(this.m_event_dungeon_list[i].is_selected)return this.m_event_dungeon_list[i];return this.m_event_dungeon_list[0]},tableCellEnded:function(){return!0},tableCellHighlight:function(){return!0},tableCellUnhighlight:function(table,cell){null!=cell&&cell.unhighlightPosInCell(cell.getTouchPos())},showMissionTaskModalLayer:function(){this.m_mission_task_modal_layer._contentNode=function(contentSize,m){var taskList=this.getSelectedDungeon().task_list,layer=new MissionTaskPopup(taskList,eDungeonTaskType.event_dungeon);return layer._callback_close_popup=this.hideMissionTaskModalLayer.bind(this),this.getParent().m_statusLayer.setStatusDisable(!0),layer}.bind(this),this.m_mission_task_modal_layer.is_show()||this.m_mission_task_modal_layer.show()},hideMissionTaskModalLayer:function(){this.getParent().m_statusLayer.setStatusDisable(!1),this.m_mission_task_modal_layer.is_show()&&this.m_mission_task_modal_layer.hide()}}),EventDungeonListScene=GameScene.extend({m_character_touch_enabled:!1,m_gameObserver:null,m_gnrl_img:[],m_deferred:$.Deferred(),m_progres_bar_dungeon:null,m_statusLayer:null,m_listLayer_visible:!1,m_listLayer_crt:!1,ctor:function(){this._super(scene_EventDungeonListScene),this.m_listLayer_crt=!1,this.m_gnrl_img=[]},get_story_deferred:function(){return this.m_deferred},init:function(){return this.initLayoutProgress_Raid(255),this.m_listLayer_visible=!1,this.m_listLayer_crt=!1,this.m_gameObserver=MainObserver.getInstance(),this.scheduleUpdate(),this.scheduleOnce(function(dt){var winSize=ccSize(this),bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub.png");bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(winSize)),USE_SP_COMMON_SUB_BG_SCALE&&bg.setScale(2),this.addChild(bg),this.m_dungeon_list_layer=new EventDungeonListLayer(this.m_deferred),this.m_listLayer_crt=!0,this.m_dungeon_list_layer.setPosition(ccCenter(winSize)),this.addChild(this.m_dungeon_list_layer),this.m_statusLayer=new StatusLayer(INVOKER_TYPE.normal),this.m_statusLayer.ignoreAnchorPointForPosition(!1),this.m_statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(this.m_statusLayer);var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx);this.initGeneral()},.5,"EventDungeonListScene"),!0},update:function(dt){0==this.m_listLayer_visible&&1==this.m_listLayer_crt&&1==this.m_dungeon_list_layer.get_deffer_done()&&(this.unscheduleUpdate(),this.m_listLayer_visible=this.m_dungeon_list_layer.get_deffer_done(),this.removeLayerProgress_Raid())},removeLayerProgress_Raid:function(){null!=this.m_progres_bar_dungeon&&(this.removeChild(this.m_progres_bar_dungeon),this.m_progres_bar_dungeon=null)},initLayoutProgress_Raid:function(alpha){if(!IS_NET_ERROR){this.m_progres_bar_dungeon=new cc.LayerColor(cc.color.BLACK),this.m_progres_bar_dungeon.setOpacity(alpha),this.m_progres_bar_dungeon.setContentSize(ccSize(this));var bg=cc.Sprite.create(RES_CM+"img_progress_bg.png");bg.setPosition(ccCenter(this));var bar=cc.Sprite.create(RES_CM+"img_progress_arrow.png");bar.setPosition(ccCenter(bg)),bg.addChild(bar,1000001),this.m_progres_bar_dungeon.addChild(bg),this.addChild(this.m_progres_bar_dungeon,1000001);var loading=new cc.Sprite(res.s_cm_img_text_loading);loading.setAnchorPoint(.5,0),loading.setPosition(ccCenter(bg).x,ccCenter(bg).y-100),loading.setOpacity(255),bg.addChild(loading,1000001);var mu=new cc.RotateBy(.1,30),seq=new cc.Sequence(mu),repeat=new cc.RepeatForever(seq);bar.runAction(repeat);var listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE});listener.onTouchBegan=function(touch,event){event.stopPropagation()}.bind(this),cc.eventManager.addListener(listener,this.m_progres_bar_dungeon)}},initGeneral:function(){var title,event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),back_btn=(MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),new ccui.Button);(back_btn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png",""),back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(){1!=this.m_statusLayer.m_is_touch_disable&&this.back()}.bind(this)),this.addChild(back_btn),USE_SP_EVENT_SCALE)?((title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_eventvs.png")).setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title)):((title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_eventvs.png")).setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title))},onEnter:function(){this._super();var audio=AudioEngine.getInstance();if(this.m_gameObserver.addObserver(this.onNotification,this,sceneStr[scene_EventDungeonListScene]),USE_EVENT_BGM){var m=MasterTable.getInstance();if(BattleContext._getInstance().getIsPrvEventDungeon())var bgm=m.get_Bgm_v2(BGM_TYPE_PRV_EVENT_MAIN_BGM);else{var period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();bgm=m.get_EventDungeonFromEventDungeonPeriodIdx(period_idx).event_dungeon_type==EVENT_DUNGEON_TYPE_LINLIN?m.get_Bgm_v2(BGM_TYPE_CRAFT_EVENT_MAIN_BGM):m.get_Bgm_v2(BGM_TYPE_EVENT_MAIN_BGM)}var main_bgm=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm.sound_file_name;audio.m_bgmPath!=main_bgm&&(audio.stopBackgroundMusic(),audio.m_bgmPath="",audio.playBackgroundMusic(main_bgm,!0))}else{var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),b_path=RES_CDN_SOUND+SND_TYPE+"sound/"+cmString("BGM_marathon_loop_%d.mp3",period.event_dungeon_point_period_idx);audio.m_bgmPath!=b_path&&(audio.stopBackgroundMusic(),audio.m_bgmPath="",audio.playBackgroundMusic(b_path,!0))}},onExit:function(){if(this._super(),this.m_gameObserver.removeObserver(sceneStr[scene_EventDungeonListScene]),null!=this.m_gnrl_img){for(var idx=0;idx<this.m_gnrl_img.length;idx++)cc.loader.release(this.m_gnrl_img[idx]);this.m_gnrl_img=null}},onNotification:function(msg){if(this._super(msg))return!1;switch(msg){case event_dungeon_invalid_entrance_time:this.showInvalidEntranceTime();break;case event_dungeon_disable_pre_open_dungeon:this.showInvalidEntrancePreOpen();break;case event_dungeon_battle_ready:var register={};register.opcode=net.OP.op_mission_battle_friend_list,register.user_id=m_user_id,this.network_write(register)}return!0},onNetworkEvent:function(opcode,state,body){if(this._super(opcode,state,body),opcode==net.OP.op_mission_battle_friend_list){BattleContext._getInstance().setFriendList(body.frnd_list);var scene=new FriendSelectScene;SceneManager.getInstance().replaceScene(scene),scene=null}},back:function(msg){this.onKeyBack(!0)},showInvalidEntranceTime:function(){this.m_box.setTitle(res_str("label_weekly_invalid_entrance")),this.m_box.setText(res_str("label_weekly_invalid_entrance_time")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showInvalidEntrancePreOpen:function(){this.m_box.setTitle(res_str("label_weekly_invalid_entrance")),this.m_box.setText(res_str("label_weekly_invalid_entrance_pre_open")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()}}),EventDungeonTaskNode=cc.Node.extend({m_task:null,ctor:function(task){this._super(),this.m_task=task,this.init()},init:function(){return this.setContentSize(444,78),this.createTask(),!0},createTask:function(){var size=ccSize(this),box=new cc.Scale9Sprite(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",cc.Rect(16,16,16,16));box.setPosition(ZERO()),box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box.setPreferredSize(size),this.addChild(box);var task_title=cmLabel.getLabel(this.m_task.task_define.name,LABEL_FONT_INDEX.FONT_2013);task_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),task_title.setPosition(58,43),this.addChild(task_title);var content="";if(this.m_task.task_define.task_type==TaskActionType.Mission_Clear_Count){var clear_count=this.m_task.clear_count;clear_count>this.m_task.task_define.value1&&(clear_count=this.m_task.task_define.value1),content=cmString(res_str("label_battle_task_content_win_count"),this.m_task.task_define.content,clear_count,this.m_task.task_define.value1)}else content=this.m_task.task_define.content;var task_content=cmLabel.getLabel(content,LABEL_FONT_INDEX.FONT_161);task_content.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),task_content.setPosition(58,16),this.addChild(task_content);var icon_box=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");icon_box.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),icon_box.setPosition(size.width-4,.5*size.height),this.addChild(icon_box);var icon_name="";if(this.m_task.task.bonus_type==BONUS_TYPE_LOVE_ITEM)icon_name="#img_reward_love_item_"+leadingZeros(this.m_task.min_value,2)+".png";else if(this.m_task.task.bonus_type==BONUS_TYPE_YUNHEE_FIX||this.m_task.task.bonus_type==BONUS_TYPE_JIN_FIX){var gnrl=MasterManager.getInstance().get_General(this.m_task.task.min_value);icon_name=gnrl.gnrl_type==GENERAL_TYPE_MATERIAL||gnrl.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL?RES_CDN_CARD_MEDIUM_NTP+"m_"+gnrl.bone_id+".png":RES_CDN_CARD_MEDIUM_NTP+"m_"+gnrl.gnrl_id+".png"}else icon_name=this.m_task.task.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||this.m_task.task.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT?"#img_reward_yh.png":"#img_reward_"+leadingZeros(this.m_task.task.bonus_type,2)+".png";if(""!=icon_name){var reward_icon=cc.Sprite.create(icon_name);reward_icon.setAnchorPoint(ANCHOR_MIDDLE()),reward_icon.setPosition(ccCenter(icon_box)),icon_box.addChild(reward_icon);var count_bg=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_valuebox.png");count_bg.setAnchorPoint(ANCHOR_MIDDLE()),count_bg.setPosition(.5*ccWidth(reward_icon),2),reward_icon.addChild(count_bg);var count=0;count=this.m_task.task.bonus_type==BONUS_TYPE_LOVE_ITEM?1:this.m_task.task.bonus_type==BONUS_TYPE_YUNHEE_FIX||this.m_task.task.bonus_type==BONUS_TYPE_JIN_FIX?1:this.m_task.task.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||this.m_task.task.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT?1:this.m_task.task.min_value;var reward_count=cmLabel.getLabel("x"+Number(count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_143);reward_count.setAnchorPoint(ANCHOR_MIDDLE()),reward_count.setPosition(ccCenter(count_bg)),count_bg.addChild(reward_count)}if(this.m_task.is_complete){var cover=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",cc.Rect(1,1,1,1));cover.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),cover.setPosition(ZERO()),cover.setPreferredSize(size),this.addChild(cover),(flower=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_on.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),flower.setPosition(14,39),this.addChild(flower);var complete=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_complete.png");complete.setAnchorPoint(ANCHOR_MIDDLE()),complete.setPosition(ccCenter(size)),IS_SP_BROWSER&&complete.setScale(2),this.addChild(complete)}else{var flower;(flower=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_off.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),flower.setPosition(14,39),this.addChild(flower)}}}),EventDungeonBoxGachaEntranceSceneV2=GameScene.extend({m_entrance_layer:null,m_help_modal_layer:null,m_script_modal:null,m_first_period_idx:0,ctor:function(){this._super(scene_EventDungeonBoxGachaEntranceSceneV2)},init:function(){var m=MasterManager.getInstance(),context=BattleContext._getInstance(),event_dungeon_period_idx=0;event_dungeon_period_idx=context.getIsPrvEventDungeon()?context.getPrvEventDungeonPeriodIdx():context.getEventDungeonPeriodIdx();var period=m.get_EventDungeonPeriod(event_dungeon_period_idx);this.m_first_period_idx=EventDungeonService.getInstance().getEventDungeonFirstHalfPeriodIdx(period.event_dungeon_group_idx),this.m_entrance_layer=new EventDungeonBoxGachaEntranceLayerV2,this.addChild(this.m_entrance_layer);var statusLayer=new StatusLayer;statusLayer.initLayout(),statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer);var title,back_btn=new ccui.Button;(back_btn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png",""),back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(){this.back()}.bind(this)),this.addChild(back_btn),USE_SP_EVENT_SCALE)?((title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_eventvs.png")).setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title)):((title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_eventvs.png")).setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title));return this.m_help_modal_layer=new GameModalLayer,this.addChild(this.m_help_modal_layer),this.m_script_modal=new GameModalLayer,this.addChild(this.m_script_modal,99999),!0},onEnter:function(){this._super();var audio=AudioEngine.getInstance();if(MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_EventDungeonBoxGachaEntranceSceneV2]),USE_EVENT_BGM){var m=MasterTable.getInstance();if(BattleContext._getInstance().getIsPrvEventDungeon())var bgm=m.get_Bgm_v2(BGM_TYPE_PRV_EVENT_MAIN_BGM);else{var period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();bgm=m.get_EventDungeonFromEventDungeonPeriodIdx(period_idx).event_dungeon_type==EVENT_DUNGEON_TYPE_LINLIN?m.get_Bgm_v2(BGM_TYPE_CRAFT_EVENT_MAIN_BGM):m.get_Bgm_v2(BGM_TYPE_EVENT_MAIN_BGM)}var main_bgm=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm.sound_file_name;audio.m_bgmPath!=main_bgm&&(audio.stopBackgroundMusic(),audio.m_bgmPath="",audio.playBackgroundMusic(main_bgm,!0))}else{var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),b_path=RES_CDN_SOUND+SND_TYPE+"sound/"+cmString("BGM_marathon_loop_%d.mp3",event_dungeon_period_idx);audio.m_bgmPath!=b_path&&(audio.stopBackgroundMusic(),audio.m_bgmPath="",audio.playBackgroundMusic(b_path,!0))}},onExit:function(){this._super()},onEnterTransitionDidFinish:function(){if(this._super(),USE_EVENT_DUNGEON_ACHIEVEMENT){var context=BattleContext._getInstance(),event_dungeon_period_idx=0;if(!context.getIsPrvEventDungeon()){event_dungeon_period_idx=context.getEventDungeonPeriodIdx();var period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),req={};req.opcode=net.OP.op_user_event_dungeon_achv_list,req.event_dungeon_period_idx=period.event_dungeon_group_idx,this.network_write(req)}}},back:function(){BattleContext._getInstance().setIsPrvEventDungeon(!1),this.onKeyBack(!0)},onNotification:function(msg){if(this._super(msg),msg==NOTIFY_MENU_SHOW_EVENT_SCRIPT){var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),prev_event_dungeon_idx=(period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx)).prev_event_dungeon_group_idx;this.showPrevEventScript(prev_event_dungeon_idx)}else if(msg==NOTIFY_MENU_SHOW_EVENT_EPILOGUE){event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();var period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx);this.showEventEpilogue(period.event_dungeon_group_idx)}return!0},showPrevEventScript:function(event_dungeon_idx){this.m_script_modal.setContentSize(ccSize(this)),this.m_script_modal._contentNode=function(contentSize,m){var script,layer=new cc.Layer;USE_UI_3RD_SCRIPT?((script=new BattleEventDungeonScriptLayerV2)._scriptViewCompleteNotBattle=this,script.loadScript(event_dungeon_idx,1,function(){script.typingBattleScript()}.bind(this)),layer.setContentSize(ccSize(this)),layer.setPosition(ccCenter(this)),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),layer.addChild(script)):((script=new BattleEventDungeonScriptLayer)._scriptViewComplete=this,script.loadScript(event_dungeon_idx,1,function(){script.typingBattleScript()}.bind(this)),layer.setContentSize(ccSize(this)),layer.setPosition(ccCenter(this)),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),layer.addChild(script));return layer},this.m_script_modal.is_show()||this.m_script_modal.show()},showEventEpilogue:function(event_dungeon_group_idx){this.m_script_modal.setContentSize(ccSize(this)),this.m_script_modal._contentNode=function(contentSize,m){this.initLayoutProgress();var layer=new cc.Layer,script=new EventDungeonEpilogueLayer;return script._scriptViewCompleteNotBattle=this,script.loadScript(event_dungeon_group_idx,4,function(){this.removeLayerProgress(),script.typingBattleScript()}.bind(this)),layer.setContentSize(ccSize(this)),layer.setPosition(ccCenter(this)),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),layer.addChild(script),layer}.bind(this),this.m_script_modal.is_show()||this.m_script_modal.show()},cbHideEventScript:function(){this.m_script_modal.is_show()&&this.m_script_modal.hide();var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),b_path=RES_CDN_SOUND+SND_TYPE+"sound/"+cmString("BGM_marathon_loop_%d.mp3",period.event_dungeon_point_period_idx),audio=AudioEngine.getInstance();audio.m_bgmPath!=b_path&&(audio.stopBackgroundMusic(),audio.playBackgroundMusic(b_path,!0))},onNetworkEvent:function(opcode,state,body){this._super(opcode,state,body),opcode==net.OP.op_user_event_dungeon_achv_list&&USE_EVENT_DUNGEON_ACHIEVEMENT&&this.m_entrance_layer.refreshEventDungeonAchvNewIcon()},showHelpPopup:function(){},showBoxGachaNotOpenInfo:function(){},scriptEventDungeonComplete:function(){this.m_script_modal.is_show()&&this.m_script_modal.hide();var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),b_path=RES_CDN_SOUND+SND_TYPE+"sound/"+cmString("BGM_marathon_loop_%d.mp3",period.event_dungeon_point_period_idx),audio=AudioEngine.getInstance();audio.m_bgmPath!=b_path&&(audio.stopBackgroundMusic(),audio.playBackgroundMusic(b_path,!0))}}),EventDungeonBoxGachaEntranceLayerV2=cc.Layer.extend({m_guage_bar:null,m_cutin_info_btn:null,m_cutin_progress:null,m_achv_new_icon:null,m_first_period_idx:0,m_second_period_idx:0,m_is_prv_event_dungeon:!1,m_epilogue_btn:null,m_epilogue_btn_img:null,m_event_dungeon_cutin_accum_rate_point:{},m_gnrl_img:null,ctor:function(){this._super(),this.m_event_dungeon_cutin_accum_rate_point={},this.m_gnrl_img=[],this.init()},init:function(){ccSize(this);var service=EventDungeonService.getInstance(),m=MasterManager.getInstance(),event_dungeon_period_idx=0;this.m_is_prv_event_dungeon=BattleContext._getInstance().getIsPrvEventDungeon(),event_dungeon_period_idx=this.m_is_prv_event_dungeon?BattleContext._getInstance().getPrvEventDungeonPeriodIdx():BattleContext._getInstance().getEventDungeonPeriodIdx();var period_info={};this.m_period=m.get_EventDungeonPeriod(event_dungeon_period_idx);for(var event_dungeon_open_period=NetService()._event_dungeon_open_period_info.event_dungeon_open_period,idx=0;idx<event_dungeon_open_period.length;idx++){var p=event_dungeon_open_period[idx];if(this.m_period.event_dungeon_point_period_idx==p.event_dungeon_period_idx){period_info=p;break}}this.m_first_period_idx=service.getEventDungeonFirstHalfPeriodIdx(this.m_period.event_dungeon_group_idx),this.m_second_period_idx=service.getEventDungeonSecondHalfPeriodIdx(this.m_period.event_dungeon_group_idx),service.getUserEventDungeonCutinAccumRatePoint(period_info.event_dungeon_period_idx,this.m_event_dungeon_cutin_accum_rate_point);for(var event_dungeon_box_gacha_info=NetService()._event_box_gacha_info_v2.event_dungeon_box_gacha_info,jdx=0;jdx<event_dungeon_box_gacha_info.length;jdx++){var box=event_dungeon_box_gacha_info[jdx];if(box.event_dungeon_period_idx==this.m_period.event_dungeon_point_period_idx){this.m_user_event_box_gacha_info=box;break}}resourceLoader(this.m_gnrl_img,function(){var bg;USE_SP_EVENT_SCALE?((bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_"+this.m_first_period_idx+"/bg_eventvs_main.jpg")).setPosition(ccCenter(this)),bg.setScale(2),this.addChild(bg)):((bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_"+this.m_first_period_idx+"/bg_eventvs_main.jpg")).setPosition(ccCenter(this)),this.addChild(bg));var help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE);if(help_btn.setAnchorPoint(ZERO()),help_btn.setPosition(10,476),this.addChild(help_btn),help_btn.addClickEventListener(function(sender){GameContext.getInstance().setHelpInfoIndexByCallIndex(2);var scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null}.bind(this)),USE_SP_EVENT_SCALE){(right_layer=this.getRightLayer_SP()).ignoreAnchorPointForPosition(!1),right_layer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),right_layer.setPosition(ccWidth(this),0),this.addChild(right_layer);var info_layer=this.getInfoLayer_SP();this.addChild(info_layer)}else{var right_layer;(right_layer=this.getRightLayer()).ignoreAnchorPointForPosition(!1),right_layer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),right_layer.setPosition(ccWidth(this),0),this.addChild(right_layer);info_layer=this.getInfoLayer();this.addChild(info_layer)}return!0}.bind(this))},onEnter:function(){this._super()},onExit:function(){this._super()},getInfoLayer:function(){var layer=new cc.Layer,winSize=ccSize(this),service=(MasterTable.getInstance(),EventDungeonService.getInstance()),pos_y=8,is_dungeon_open=!1,idx=this.m_first_period_idx;if(this.m_is_prv_event_dungeon?service.IsOpenEventPointPeriod(this.m_second_period_idx)&&(idx=this.m_second_period_idx,is_dungeon_open=!0):service.IsOpenDungeon(this.m_second_period_idx)&&(idx=this.m_second_period_idx,is_dungeon_open=!0),!this.m_is_prv_event_dungeon){var info_text_img_text,info_text_2=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_info_2.png",idx));info_text_2.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),is_dungeon_open?info_text_2.setPosition(winSize.width,212):info_text_2.setPosition(winSize.width,162),layer.addChild(info_text_2),(info_text_img_text=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_info_text.png",idx))).setAnchorPoint(ZERO()),info_text_img_text.setPosition(10,pos_y),layer.addChild(info_text_img_text),pos_y+=ccHeight(info_text_img_text)+22}this.m_is_prv_event_dungeon;var achv_btn=new LabelButton("btn_36_off.png","btn_36_on.png","btn_36_none.png",ccui.Widget.PLIST_TEXTURE);(achv_btn.setFont(LABEL_FONT_INDEX.FONT_161),achv_btn.setColor(cc.color(238,238,238)),achv_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),achv_btn.setString(res_str("btn_label_event_mission")),achv_btn.setPosition(10,pos_y),layer.addChild(achv_btn),achv_btn.addClickEventListener(function(sender){if(USE_EVENT_DUNGEON_ACHIEVEMENT){var scene=new EventDungeonAchievementScene_V2;SceneManager.getInstance().replaceScene(scene),scene=null}else GameContext.getInstance().setAchievementTap(ACHIEVEMENT_EVENTDUNGEON),MainObserver.getInstance().postNotification(sceneStr[scene_EventDungeonBoxGachaEntranceSceneV2],NOTIFY_MENU_ACHIEV)}),pos_y+=ccHeight(achv_btn)+10,this.m_achv_new_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_achv_new_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_achv_new_icon.setPosition(5,ccHeight(achv_btn)-5),achv_btn.addChild(this.m_achv_new_icon),this.m_achv_new_icon.setVisible(!1),null!=this.m_achv_new_icon)&&(USE_EVENT_DUNGEON_ACHIEVEMENT?this.m_achv_new_icon.setVisible(!1):AchievementService.getInstance().isNewCompleteAchievementEventDungeon(this.m_first_period_idx)?this.m_achv_new_icon.setVisible(!0):this.m_achv_new_icon.setVisible(!1));var limit_dungeon,is_exist_prev_dungeon=service.IsExistPrevEventDungeon(this.m_period.event_dungeon_group_idx);if(!this.m_is_prv_event_dungeon&&is_exist_prev_dungeon){var prv_event_dungeon_btn=new LabelButton("btn_36_off.png","btn_36_on.png","",ccui.Widget.PLIST_TEXTURE);prv_event_dungeon_btn.setFont(LABEL_FONT_INDEX.FONT_181),prv_event_dungeon_btn.setString(res_str("btn_label_prev_event_reward")),prv_event_dungeon_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),prv_event_dungeon_btn.setPosition(10,pos_y),layer.addChild(prv_event_dungeon_btn),prv_event_dungeon_btn.addClickEventListener(function(sender){BattleContext._getInstance().setPrvEventDungeonPeriodIdx(this.m_period.prev_event_dungeon_group_idx),MainObserver.getInstance().postNotification(NOTIFY_MENU_PRV_EVENT_DUNGEON_ENTRANCE)}.bind(this)),pos_y+=ccHeight(prv_event_dungeon_btn)+10}(this.m_is_prv_event_dungeon&&(achv_btn.setEnabled(!1),this.m_achv_new_icon.setVisible(!1)),this.m_is_prv_event_dungeon)||0<BattleService.getInstance().getUserEventDungeonOnceADayList_v2(this.m_first_period_idx).size()&&((limit_dungeon=new ccui.Button(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_1day_off.png",this.m_period.event_dungeon_group_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_1day_on.png",this.m_period.event_dungeon_group_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_1day_none.png",this.m_period.event_dungeon_group_idx))).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),limit_dungeon.setPosition(10,pos_y),this.addChild(limit_dungeon),limit_dungeon.addClickEventListener(function(sender){this.entranceOnceADayDungeonList(this.m_first_period_idx,EVENT_DUNGEON_SUB_TYPE_ONCE)}.bind(this)),pos_y+=ccHeight(limit_dungeon)+10);this.m_is_prv_event_dungeon||0<BattleService.getInstance().getUserEventDungeonOnceADayList_v2(this.m_second_period_idx).size()&&((limit_dungeon=new ccui.Button(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_1day_off.png",this.m_second_period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_1day_on.png",this.m_second_period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_1day_none.png",this.m_second_period_idx))).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),limit_dungeon.setPosition(10,pos_y),this.addChild(limit_dungeon),limit_dungeon.addClickEventListener(function(sender){this.entranceOnceADayDungeonList(this.m_second_period_idx,EVENT_DUNGEON_SUB_TYPE_ONCE)}.bind(this)),pos_y+=ccHeight(limit_dungeon)+10);return layer},getInfoLayer_SP:function(){var layer=new cc.Layer,winSize=ccSize(this),service=(MasterTable.getInstance(),EventDungeonService.getInstance()),pos_y=8,is_dungeon_open=!1,idx=this.m_first_period_idx;if(this.m_is_prv_event_dungeon?service.IsOpenEventPointPeriod(this.m_second_period_idx)&&(idx=this.m_second_period_idx,is_dungeon_open=!0):service.IsOpenDungeon(this.m_second_period_idx)&&(idx=this.m_second_period_idx,is_dungeon_open=!0),!this.m_is_prv_event_dungeon){var info_text_img_text,info_text_2=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_info_2.png",idx));info_text_2.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),info_text_2.setScale(2),is_dungeon_open?info_text_2.setPosition(winSize.width,212):info_text_2.setPosition(winSize.width,162),layer.addChild(info_text_2),(info_text_img_text=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_info_text.png",idx))).setAnchorPoint(ZERO()),info_text_img_text.setPosition(10,pos_y),info_text_img_text.setScale(2),layer.addChild(info_text_img_text),pos_y+=ccHeight(info_text_img_text)+22}this.m_is_prv_event_dungeon;var achv_btn=new LabelButton("btn_36_off.png","btn_36_on.png","btn_36_none.png",ccui.Widget.PLIST_TEXTURE);(achv_btn.setFont(LABEL_FONT_INDEX.FONT_161),achv_btn.setColor(cc.color(238,238,238)),achv_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),achv_btn.setString(res_str("btn_label_event_mission")),achv_btn.setPosition(10,pos_y),layer.addChild(achv_btn),achv_btn.addClickEventListener(function(sender){if(USE_EVENT_DUNGEON_ACHIEVEMENT){var scene=new EventDungeonAchievementScene_V2;SceneManager.getInstance().replaceScene(scene),scene=null}else GameContext.getInstance().setAchievementTap(ACHIEVEMENT_EVENTDUNGEON),MainObserver.getInstance().postNotification(sceneStr[scene_EventDungeonBoxGachaEntranceSceneV2],NOTIFY_MENU_ACHIEV)}),pos_y+=ccHeight(achv_btn)+10,this.m_achv_new_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_achv_new_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_achv_new_icon.setPosition(5,ccHeight(achv_btn)-5),achv_btn.addChild(this.m_achv_new_icon),this.m_achv_new_icon.setVisible(!1),null!=this.m_achv_new_icon)&&(USE_EVENT_DUNGEON_ACHIEVEMENT?this.m_achv_new_icon.setVisible(!1):AchievementService.getInstance().isNewCompleteAchievementEventDungeon(this.m_first_period_idx)?this.m_achv_new_icon.setVisible(!0):this.m_achv_new_icon.setVisible(!1));var limit_dungeon,is_exist_prev_dungeon=service.IsExistPrevEventDungeon(this.m_period.event_dungeon_group_idx);if(!this.m_is_prv_event_dungeon&&is_exist_prev_dungeon){var prv_event_dungeon_btn=new LabelButton("btn_36_off.png","btn_36_on.png","",ccui.Widget.PLIST_TEXTURE);prv_event_dungeon_btn.setFont(LABEL_FONT_INDEX.FONT_181),prv_event_dungeon_btn.setString(res_str("btn_label_prev_event_reward")),prv_event_dungeon_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),prv_event_dungeon_btn.setPosition(10,pos_y),layer.addChild(prv_event_dungeon_btn),prv_event_dungeon_btn.addClickEventListener(function(sender){BattleContext._getInstance().setPrvEventDungeonPeriodIdx(this.m_period.prev_event_dungeon_group_idx),MainObserver.getInstance().postNotification(NOTIFY_MENU_PRV_EVENT_DUNGEON_ENTRANCE)}.bind(this)),pos_y+=ccHeight(prv_event_dungeon_btn)+10}(this.m_is_prv_event_dungeon&&(achv_btn.setEnabled(!1),this.m_achv_new_icon.setVisible(!1)),this.m_is_prv_event_dungeon)||0<BattleService.getInstance().getUserEventDungeonOnceADayList_v2(this.m_first_period_idx).size()&&((limit_dungeon=new ccui.Button(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_1day_off.png",this.m_period.event_dungeon_group_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_1day_on.png",this.m_period.event_dungeon_group_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_1day_none.png",this.m_period.event_dungeon_group_idx))).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),limit_dungeon.setPosition(10,pos_y),this.addChild(limit_dungeon),limit_dungeon.addClickEventListener(function(sender){this.entranceOnceADayDungeonList(this.m_first_period_idx,EVENT_DUNGEON_SUB_TYPE_ONCE)}.bind(this)),pos_y+=ccHeight(limit_dungeon)+10);this.m_is_prv_event_dungeon||0<BattleService.getInstance().getUserEventDungeonOnceADayList_v2(this.m_second_period_idx).size()&&((limit_dungeon=new ccui.Button(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_1day_off.png",this.m_second_period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_1day_on.png",this.m_second_period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_1day_none.png",this.m_second_period_idx))).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),limit_dungeon.setPosition(10,pos_y),this.addChild(limit_dungeon),limit_dungeon.addClickEventListener(function(sender){this.entranceOnceADayDungeonList(this.m_second_period_idx,EVENT_DUNGEON_SUB_TYPE_ONCE)}.bind(this)),pos_y+=ccHeight(limit_dungeon)+10);return layer},getRightLayer:function(){var layer=new cc.Layer;layer.setContentSize(cc.size(454,217));var service=EventDungeonService.getInstance(),idx=this.m_first_period_idx,is_second=!1;this.m_is_prv_event_dungeon?service.IsOpenEventPointPeriod(this.m_second_period_idx)&&(idx=this.m_second_period_idx,is_second=!0):service.IsOpenDungeon(this.m_second_period_idx)&&(idx=this.m_second_period_idx,is_second=!0);var info_box=cc.Sprite.create(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_info.png",idx));info_box.setAnchorPoint(ZERO()),info_box.setPosition(0,81),layer.addChild(info_box);var y=25;if(is_second){var period=MasterManager.getInstance().get_EventDungeonPeriod(this.m_second_period_idx),event_dungeon_point={};service.getUserEventDungeonPoint(period.event_dungeon_period_idx,event_dungeon_point),(event_point_count=cmLabel.getLabel(cmString(res_str("label_event_dungeon_own_point"),Number(event_dungeon_point.event_point).toLocaleString("en")),LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),event_point_count.setPosition(266,y),info_box.addChild(event_point_count);var second_gacha_half_btn=new LabelButton("btn_36_off.png","btn_36_on.png","",ccui.Widget.PLIST_TEXTURE);second_gacha_half_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),second_gacha_half_btn.setFont(LABEL_FONT_INDEX.FONT_181),second_gacha_half_btn.setString(res_str("event_dungeon_box_gacha_second_half_entrance_btn_title")),second_gacha_half_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),second_gacha_half_btn.setPosition(430,y-8),info_box.addChild(second_gacha_half_btn),second_gacha_half_btn.addClickEventListener(function(sender){this.entranceBoxGacha(this.m_second_period_idx)}.bind(this)),this.m_is_prv_event_dungeon?second_gacha_half_btn.setEnabled(service.IsOpenEventPointPeriod(this.m_second_period_idx)):second_gacha_half_btn.setEnabled(service.IsOpenDungeon(this.m_second_period_idx)),y+=50}var event_point_count;period=MasterManager.getInstance().get_EventDungeonPeriod(this.m_first_period_idx),event_dungeon_point={};service.getUserEventDungeonPoint(period.event_dungeon_period_idx,event_dungeon_point),(event_point_count=cmLabel.getLabel(cmString(res_str("label_event_dungeon_own_point"),Number(event_dungeon_point.event_point).toLocaleString()),LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),event_point_count.setPosition(266,y),info_box.addChild(event_point_count);var first_gacha_half_btn=new LabelButton("btn_36_off.png","btn_36_on.png","",ccui.Widget.PLIST_TEXTURE);first_gacha_half_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),first_gacha_half_btn.setFont(LABEL_FONT_INDEX.FONT_181),first_gacha_half_btn.setString(res_str("event_dungeon_box_gacha_first_half_entrance_btn_title")),first_gacha_half_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),first_gacha_half_btn.setPosition(430,y-8),info_box.addChild(first_gacha_half_btn),first_gacha_half_btn.addClickEventListener(function(sender){this.entranceBoxGacha(this.m_first_period_idx)}.bind(this)),this.m_is_prv_event_dungeon?first_gacha_half_btn.setEnabled(service.IsOpenEventPointPeriod(this.m_first_period_idx)):first_gacha_half_btn.setEnabled(service.IsOpenDungeon(this.m_first_period_idx));ccWidth(layer),ccPosY(info_box),ccHeight(info_box);var first_half_btn=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);first_half_btn.setFont(LABEL_FONT_INDEX.FONT_221),first_half_btn.setString(res_str("label_event_dungeon_first_half_enter_text")),first_half_btn.setAnchorPoint(ZERO()),first_half_btn.setPosition(0,16),layer.addChild(first_half_btn),first_half_btn.addClickEventListener(function(sender){this.entranceDungeonList(this.m_first_period_idx)}.bind(this)),first_half_btn.setEnabled(service.IsOpenDungeon(this.m_first_period_idx));var second_half_btn=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);return second_half_btn.setFont(LABEL_FONT_INDEX.FONT_221),second_half_btn.setString(res_str("label_event_dungeon_second_half_enter_text")),second_half_btn.setAnchorPoint(ZERO()),second_half_btn.setPosition(ccWidth(first_half_btn),16),layer.addChild(second_half_btn),second_half_btn.addClickEventListener(function(sender){this.entranceDungeonList(this.m_second_period_idx)}.bind(this)),second_half_btn.setEnabled(service.IsOpenDungeon(this.m_second_period_idx)),layer},getRightLayer_SP:function(){var layer=new cc.Layer;layer.setContentSize(cc.size(454,217));var service=EventDungeonService.getInstance(),idx=this.m_first_period_idx,is_second=!1;this.m_is_prv_event_dungeon?service.IsOpenEventPointPeriod(this.m_second_period_idx)&&(idx=this.m_second_period_idx,is_second=!0):service.IsOpenDungeon(this.m_second_period_idx)&&(idx=this.m_second_period_idx,is_second=!0);var info_box=cc.Sprite.create(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_info.png",idx));info_box.setAnchorPoint(ZERO()),info_box.setPosition(0,81),info_box.setScale(2),layer.addChild(info_box);var y=25;if(is_second){var period=MasterManager.getInstance().get_EventDungeonPeriod(this.m_second_period_idx),event_dungeon_point={};service.getUserEventDungeonPoint(period.event_dungeon_period_idx,event_dungeon_point),(event_point_count=cmLabel.getLabel(cmString(res_str("label_event_dungeon_own_point"),Number(event_dungeon_point.event_point).toLocaleString("en")),LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),event_point_count.setPosition(952,y+82),this.addChild(event_point_count,10);var second_gacha_half_btn=new LabelButton("btn_36_off.png","btn_36_on.png","",ccui.Widget.PLIST_TEXTURE);second_gacha_half_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),second_gacha_half_btn.setFont(LABEL_FONT_INDEX.FONT_181),second_gacha_half_btn.setString(res_str("event_dungeon_box_gacha_second_half_entrance_btn_title")),second_gacha_half_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),second_gacha_half_btn.setPosition(1115,y+74),this.addChild(second_gacha_half_btn,10),second_gacha_half_btn.addClickEventListener(function(sender){this.entranceBoxGacha(this.m_second_period_idx)}.bind(this)),this.m_is_prv_event_dungeon?second_gacha_half_btn.setEnabled(service.IsOpenEventPointPeriod(this.m_second_period_idx)):second_gacha_half_btn.setEnabled(service.IsOpenDungeon(this.m_second_period_idx)),y+=50}var event_point_count;period=MasterManager.getInstance().get_EventDungeonPeriod(this.m_first_period_idx),event_dungeon_point={};service.getUserEventDungeonPoint(period.event_dungeon_period_idx,event_dungeon_point),(event_point_count=cmLabel.getLabel(cmString(res_str("label_event_dungeon_own_point"),Number(event_dungeon_point.event_point).toLocaleString()),LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),event_point_count.setPosition(952,y+82),this.addChild(event_point_count,10);var first_gacha_half_btn=new LabelButton("btn_36_off.png","btn_36_on.png","",ccui.Widget.PLIST_TEXTURE);first_gacha_half_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),first_gacha_half_btn.setFont(LABEL_FONT_INDEX.FONT_181),first_gacha_half_btn.setString(res_str("event_dungeon_box_gacha_first_half_entrance_btn_title")),first_gacha_half_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),first_gacha_half_btn.setPosition(1115,y+74),this.addChild(first_gacha_half_btn,10),first_gacha_half_btn.addClickEventListener(function(sender){this.entranceBoxGacha(this.m_first_period_idx)}.bind(this)),this.m_is_prv_event_dungeon?first_gacha_half_btn.setEnabled(service.IsOpenEventPointPeriod(this.m_first_period_idx)):first_gacha_half_btn.setEnabled(service.IsOpenDungeon(this.m_first_period_idx));ccWidth(layer),ccPosY(info_box),ccHeight(info_box);var first_half_btn=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);first_half_btn.setFont(LABEL_FONT_INDEX.FONT_221),first_half_btn.setString(res_str("label_event_dungeon_first_half_enter_text")),first_half_btn.setAnchorPoint(ZERO()),first_half_btn.setPosition(0,16),layer.addChild(first_half_btn),first_half_btn.addClickEventListener(function(sender){this.entranceDungeonList(this.m_first_period_idx)}.bind(this)),first_half_btn.setEnabled(service.IsOpenDungeon(this.m_first_period_idx));var second_half_btn=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);return second_half_btn.setFont(LABEL_FONT_INDEX.FONT_221),second_half_btn.setString(res_str("label_event_dungeon_second_half_enter_text")),second_half_btn.setAnchorPoint(ZERO()),second_half_btn.setPosition(ccWidth(first_half_btn),16),layer.addChild(second_half_btn),second_half_btn.addClickEventListener(function(sender){this.entranceDungeonList(this.m_second_period_idx)}.bind(this)),second_half_btn.setEnabled(service.IsOpenDungeon(this.m_second_period_idx)),layer},entranceDungeonList:function(event_dungeon_point_period_idx){if(!EventDungeonService.getInstance().IsOpenDungeon(event_dungeon_point_period_idx))return!1;BattleContext._getInstance().setEventDungeonPeriodIdX(event_dungeon_point_period_idx);var scene=new EventDungeonListScene;return SceneManager.getInstance().replaceScene(scene),!(scene=null)},entranceBoxGacha:function(event_dungeon_point_period_idx){var service=EventDungeonService.getInstance();if(this.m_is_prv_event_dungeon){if(!service.IsOpenEventPointPeriod(event_dungeon_point_period_idx))return!1;BattleContext._getInstance().setPrvEventDungeonPeriodIdx(event_dungeon_point_period_idx)}else{if(!service.IsOpenDungeon(event_dungeon_point_period_idx))return!1;BattleContext._getInstance().setEventDungeonPeriodIdX(event_dungeon_point_period_idx)}this.getParent().initLayoutProgress2();var scene=new EventDungeonBoxGachaSceneV2;return scene.get_story_deferred().done(function(){this.scheduleOnce(function(dt){SceneManager.getInstance().replaceScene(scene,!0),scene=null},.5,"main_layer_ready")}.bind(this)),!0},refreshEventDungeonAchvNewIcon:function(){for(var service=EventDungeonService.getInstance(),period_list=MasterTable.getInstance().get_EventDungeonPeriodList(this.m_period.event_dungeon_group_idx),is_new=!1,i=0;i<period_list.length;i++){var p=period_list[i];if(service.IsOpenDungeon(p.event_dungeon_period_idx)&&service.IsEnableGainEventDungeonAchvReward(p.event_dungeon_period_idx)){is_new=!0;break}}null!=this.m_achv_new_icon&&this.m_achv_new_icon.setVisible(is_new)},entranceOnceADayDungeonList:function(event_dungeon_period_idx,sub_dungeon_type){if(!EventDungeonService.getInstance().IsOpenDungeon(event_dungeon_period_idx))return!1;GameContext.getInstance().setSubDungeonType(sub_dungeon_type),BattleContext._getInstance().setEventDungeonPeriodIdX(event_dungeon_period_idx);var scene=new EventOnceADayDungeonListScene;return SceneManager.getInstance().replaceScene(scene),!(scene=null)}}),EventDungeonBoxGachaSceneV2=GameScene.extend({m_board_layer:null,m_boxgacha_detail_popup:null,m_is_effect_layer_touch:!1,m_statusLayer:null,m_isLineupPopupShow:!1,m_deferred:$.Deferred(),ctor:function(){this._super(scene_EventDungeonBoxGachaSceneV2),this.init2()},get_story_deferred:function(){return this.m_deferred},init2:function(){var m=MasterManager.getInstance(),context=BattleContext._getInstance(),event_dungeon_period_idx=0;event_dungeon_period_idx=context.getIsPrvEventDungeon()?context.getPrvEventDungeonPeriodIdx():context.getEventDungeonPeriodIdx();var period=m.get_EventDungeonPeriod(event_dungeon_period_idx);EventDungeonService.getInstance().getEventDungeonFirstHalfPeriodIdx(period.event_dungeon_group_idx);this.m_isLineupPopupShow=!1,this.m_board_layer=new EventDungeonBoxGachaLayerV2(this.m_deferred),this.addChild(this.m_board_layer),this.m_statusLayer=new StatusLayer,this.m_statusLayer.initLayout(),this.m_statusLayer.ignoreAnchorPointForPosition(!1),this.m_statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(this.m_statusLayer);var title,back_btn=new ccui.Button;(back_btn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png",""),back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(){1!=RAID_BOSS_MODAL_OPEN_FLAG&&1!=this.m_isLineupPopupShow&&this.back()}.bind(this)),this.addChild(back_btn),USE_SP_EVENT_SCALE)?((title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_eventvs.png")).setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title)):((title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_eventvs.png")).setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title));return this.m_boxgacha_detail_popup=new GameModalLayer,this.addChild(this.m_boxgacha_detail_popup,1e4),this.m_normal_voice_list=[],this.m_normal_voice_list.push_back("yue_kunsyu_0001.mp3"),this.m_normal_voice_list.push_back("yue_kunsyu_0002.mp3"),this.m_normal_voice_list.push_back("yue_kunsyu_0003.mp3"),this.m_normal_voice_list.push_back("yue_kunsyu_0025.mp3"),this.m_main_voice_list=[],this.m_main_voice_list.push_back("yue_kunsyu_0023.mp3"),this.m_main_voice_list.push_back("yue_kunsyu_0024.mp3"),this.m_main_voice_list.push_back("yue_kunsyu_0028.mp3"),!0},onEnter:function(){if(this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_EventDungeonBoxGachaSceneV2]),USE_EVENT_BGM){var m=MasterTable.getInstance();if(BattleContext._getInstance().getIsPrvEventDungeon())var bgm=m.get_Bgm_v2(BGM_TYPE_PRV_EVENT_MAIN_BGM);else{var period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();bgm=m.get_EventDungeonFromEventDungeonPeriodIdx(period_idx).event_dungeon_type==EVENT_DUNGEON_TYPE_LINLIN?m.get_Bgm_v2(BGM_TYPE_CRAFT_EVENT_MAIN_BGM):m.get_Bgm_v2(BGM_TYPE_EVENT_MAIN_BGM)}var audio,main_bgm=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm.sound_file_name;if((audio=AudioEngine.getInstance()).m_bgmPath!=main_bgm)(audio=AudioEngine.getInstance()).stopBackgroundMusic(),audio.m_bgmPath="",audio.playBackgroundMusic(main_bgm,!0)}else{var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),b_path=RES_CDN_SOUND+SND_TYPE+"sound/"+cmString("BGM_marathon_loop_%d.mp3",period.event_dungeon_point_period_idx);audio.m_bgmPath!=b_path&&(audio.stopBackgroundMusic(),audio.m_bgmPath="",audio.playBackgroundMusic(b_path,!0))}},onExit:function(){this._super(),AudioEngine.getInstance().stopVoice(),MainObserver.getInstance().removeObserver(sceneStr[scene_EventDungeonBoxGachaSceneV2])},back:function(){this.onKeyBack(!0)},onNotification:function(msg){return!this._super(msg)&&(msg==btn_box_gacha_detail_popup&&this.showBoxGachaDetailPopup(),msg==btn_box_gacha_lineup_popup_on&&(this.m_board_layer.showLineupPopup(),this.m_statusLayer.setStatusDisable(!0),this.m_isLineupPopupShow=!0),msg==btn_box_gacha_lineup_popup_off?(this.m_board_layer.hideLineupPopupV2(),this.m_statusLayer.setStatusDisable(!1),this.m_isLineupPopupShow=!1):msg==btn_epilogue_open_view&&this.back(),!0)},onNetworkEvent:function(opcode,state,body){if(this._super(opcode,body,state),body.error==net.ERROR.NET_E_SUCCESS)if(opcode==net.OP.op_event_dungeon_box_gacha_buy_v2)this.m_board_layer.recvBoxGachaBuyResult(body);else if(opcode==net.OP.op_event_dungeon_box_gacha_reset_v2){var box_gacha=MasterManager.getInstance().get_EventDungeonBoxGachaV2(body.open_box_gacha_idx,body.event_dungeon_period_idx);if(body.event_dungeon_box_gacha_idx==body.open_box_gacha_idx)(msg=[]).push_back(cmString(res_str("label_event_dungeno_box_gacha_reset_msg_2"),box_gacha.name)),this.showMsgBox(msg),msg=null;else(msg=[]).push_back(cmString(res_str("label_event_dungeno_box_gacha_reset_msg_1"),box_gacha.name)),this.showMsgBox(msg),msg=null;var p=MasterManager.getInstance().get_EventDungeonPeriod(body.event_dungeon_period_idx),req={};req.opcode=net.OP.op_event_dungeon_box_gacha_info_v2,req.event_dungeon_group_idx=p.event_dungeon_group_idx,EVENT_BOX_GACHA_RESET=!0,this.network_write(req)}else opcode==net.OP.op_event_dungeon_box_gacha_info_v2&&1==EVENT_BOX_GACHA_RESET&&(EVENT_BOX_GACHA_RESET=!1,this.m_board_layer.recvBoxGachaResetResult(body));else if(opcode==net.OP.op_event_dungeon_box_gacha_buy_v2){if(body.error==net.ERROR.NET_E_BAD_PARAMETER)var msg=[];else if(body.error==net.ERROR.NET_E_LACK_EVENT_DUNGEON_POINT){(msg=[]).push_back(res_str("label_event_dungeon_point_lack")),this.showMsgBox(msg),msg=null}else if(body.error==net.ERROR.NET_E_OVER_MAX_COUNT){(msg=[]).push_back(res_str("label_event_dungeon_box_gacha_next_open_1")),msg.push_back(res_str("label_event_dungeon_box_gacha_next_open_2")),this.showMsgBox(msg),msg=null}}else if(opcode==net.OP.op_event_dungeon_box_gacha_reset_v2){if(body.error==net.ERROR.NET_E_NOT_RECEIVE_MAIN_REWARD)(msg=[]).push_back(res_str("label_event_dungeon_box_gacha_reset_error_1")),msg.push_back(res_str("label_event_dungeon_box_gacha_reset_error_2")),msg.push_back(res_str("label_event_dungeon_box_gacha_reset_error_3")),msg.push_back(res_str("label_event_dungeon_box_gacha_reset_error_4")),this.showMsgBox(msg),msg=null}else opcode==net.OP.op_event_dungeon_box_gacha_info_v2&&1==EVENT_BOX_GACHA_RESET&&(EVENT_BOX_GACHA_RESET=!1)},showBoxGachaDetailPopup:function(){this.m_boxgacha_detail_popup.setContentSize(ccSize(this)),this.m_boxgacha_detail_popup._contentNode=function(contentSize,m){var context=BattleContext._getInstance(),event_dungeon_period_idx=0;event_dungeon_period_idx=context.getIsPrvEventDungeon()?context.getPrvEventDungeonPeriodIdx():context.getEventDungeonPeriodIdx();var mt=MasterManager.getInstance(),period=mt.get_EventDungeonPeriod(event_dungeon_period_idx),service=EventDungeonService.getInstance(),first_idx=service.getEventDungeonFirstHalfPeriodIdx(period.event_dungeon_group_idx),second_idx=service.getEventDungeonSecondHalfPeriodIdx(period.event_dungeon_group_idx),is_second=!1;event_dungeon_period_idx==second_idx&&(is_second=!0);var layer=new cc.Layer,bg_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());bg_mask.setPosition(ccCenter(this)),bg_mask.setContentSize(ccSize(this)),layer.addChild(bg_mask);var bg=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",RectZero());bg.setInsetLeft(44),bg.setInsetRight(44),bg.setInsetTop(44),bg.setInsetBottom(44),bg.setPreferredSize(cc.size(958,555)),bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(this)),layer.addChild(bg);var navi=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_navi.png",RectZero());navi.setInsetLeft(46),navi.setInsetRight(46),navi.setPreferredSize(cc.size(942,48)),navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(bg).x,ccHeight(bg)-11),bg.addChild(navi);var title_label=cmLabel.getLabel(res_str("label_event_dungeon_box_gacha_notice_btn"),LABEL_FONT_INDEX.FONT_241);title_label.setAnchorPoint(ANCHOR_MIDDLE()),title_label.setPosition(ccCenter(navi)),navi.addChild(title_label);var first_period=mt.get_EventDungeonPeriod(first_idx),second_period=mt.get_EventDungeonPeriod(second_idx),first_name=mt.get_EventPointUnitType(first_period.event_point_unit_type).name,second_name=mt.get_EventPointUnitType(second_period.event_point_unit_type).name,content_label=cmLabel.getLabel(is_second?cmString(res_str("label_event_dungeon_box_gacha_detail_msg2"),second_name,second_name):cmString(res_str("label_event_dungeon_box_gacha_detail_msg1"),first_name,first_name),LABEL_FONT_INDEX.FONT_181);content_label.setAnchorPoint(ANCHOR_TOP_LEFT());var viewSize=cc.size(858,470),content_height=ccHeight(content_label)+20;content_height<viewSize.height&&(content_height=viewSize.height);var container=new cc.Layer;container.ignoreAnchorPointForPosition(!1),container.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),container.setContentSize(viewSize.width,content_height),container.setPosition(ZERO());var scroll_view=new cc.ScrollView(viewSize,container);scroll_view.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),scroll_view.setPosition(50,17),scroll_view.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),bg.addChild(scroll_view),scroll_view.setContentOffset(cc.p(0,viewSize.height-content_height),!1),content_label.setPosition(0,ccHeight(container)),container.addChild(content_label);var back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);return back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(bg)-10,ccHeight(bg)-10),back_btn.addClickEventListener(function(sender){this.hideBoxGachaDetailPopup()}.bind(this)),bg.addChild(back_btn),layer}.bind(this),this.m_boxgacha_detail_popup.show()},hideBoxGachaDetailPopup:function(){this.m_boxgacha_detail_popup.is_show()&&this.m_boxgacha_detail_popup.hide()}}),SELECTED_IMAGE_TAG=99999,COUNT_LABEL_TAG=88888,TOOLTIP_BTN_TAG=77777,box_gacha_in=7,box_gacha_buy=8,btn_box_gacha_detail_popup=789842,btn_epilogue_open_view=789843,GACHA_COST_LABEL_TAG=66666,BOX_GACHA_GNRL_GROUP=530,btn_box_gacha_lineup_popup_on=789844,btn_box_gacha_lineup_popup_off=789845,EventDungeonBoxGachaLayerV2=cc.Layer.extend({m_left_layer:null,m_right_layer:null,m_right_layer_sp:null,m_next_box_gacha_btn:null,m_next_box_gacha_btn_dis:null,m_main_item_icon:null,m_event_point_label:null,m_item_lineup_popup:null,m_recv_item_list_popup:null,m_gacha_count_label:null,tooltip_box:null,tooltip_content:null,m_effect_popup:null,m_is_effect_layer_touch:!1,m_gacha_count_title:null,m_main_item_count:null,m_gacha_title:null,m_is_prv_event_dungeon:!1,m_message_box:null,m_tooltip_box:null,m_tooltip_content:null,m_content_view_btn:null,m_golden_barrel_popup:null,m_golden_barrel_help_btn:null,m_btn:null,m_btn1:null,m_btn2:null,m_icon:null,m_icon1:null,m_icon2:null,m_cnt_label:null,m_cnt_label1:null,m_cnt_label2:null,m_cost_label:null,m_cost_label1:null,m_cost_label2:null,m_first_event_period_idx:0,m_second_event_period_idx:0,m_box_gacha_proc:[],m_sub_main_items:[],m_user_event_box_gacha_info:[],m_sub_main_item_icons:[],m_main_item_data:[],m_box_gacha_buy_result:null,m_sub_pos_list:[],m_gacha_btns:[],m_enter_voice:[],m_gacha_voice:[],m_event_dungeon_point:{},m_gnrl_img:null,m_deferred:null,ctor:function(deferred){this._super(),this.m_box_gacha_proc=[],this.m_sub_main_items=[],this.m_user_event_box_gacha_info=[],this.m_sub_main_item_icons=[],this.m_main_item_data=[],this.m_box_gacha_buy_result=null,this.m_sub_pos_list=[],this.m_gacha_btns=[],this.m_enter_voice=[],this.m_gacha_voice=[],this.m_event_dungeon_point={},this.m_deferred=deferred,this.init()},init:function(){RAID_BOSS_MODAL_OPEN_FLAG=!1;var service=EventDungeonService.getInstance(),m=MasterManager.getInstance(),context=BattleContext._getInstance();this.m_is_prv_event_dungeon=context.getIsPrvEventDungeon();var event_dungeon_period_idx=0;event_dungeon_period_idx=this.m_is_prv_event_dungeon?BattleContext._getInstance().getPrvEventDungeonPeriodIdx():BattleContext._getInstance().getEventDungeonPeriodIdx();this.m_period=m.get_EventDungeonPeriod(event_dungeon_period_idx);for(var netService=new NetService,event_dungeon_open_period=netService._event_dungeon_open_period_info.event_dungeon_open_period,idx=0;idx<event_dungeon_open_period.length;idx++){var p=event_dungeon_open_period[idx];if(this.m_period.event_dungeon_point_period_idx==p.event_dungeon_period_idx){this.m_period_info=p;break}}service.getUserEventDungeonPoint(this.m_period.event_dungeon_point_period_idx,this.m_event_dungeon_point),this.m_first_event_period_idx=service.getEventDungeonFirstHalfPeriodIdx(this.m_period.event_dungeon_group_idx),this.m_second_event_period_idx=service.getEventDungeonSecondHalfPeriodIdx(this.m_period.event_dungeon_group_idx);for(var event_dungeon_box_gacha_info=netService._event_box_gacha_info_v2.event_dungeon_box_gacha_info,jdx=0;jdx<event_dungeon_box_gacha_info.length;jdx++){var box=event_dungeon_box_gacha_info[jdx];if(box.event_dungeon_period_idx==this.m_period.event_dungeon_point_period_idx){this.m_user_event_box_gacha_info=box;break}}this.m_gnrl_img=[],this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_group_idx+"/bg_eventvs_sub.jpg"),this.m_gnrl_img.push(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_panel.png",this.m_period.event_dungeon_group_idx)),this.m_gnrl_img.push(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_panel_text.png",this.m_period.event_dungeon_point_period_idx)),this.m_gnrl_img.push(RES_CDN_DEFULT+"fonts/img_eventvs_btn_text.fnt"),this.m_gnrl_img.push(RES_CDN_DEFULT+"fonts/img_eventvs_btn_text_0.png");for(var box_gacha_list=MasterTable.getInstance().get_EventDungeonBoxGachaV2List(this.m_period.event_dungeon_point_period_idx),i=0;i<box_gacha_list.length;i++)this.m_gnrl_img.push(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_box_%d_off.png",this.m_period.event_dungeon_group_idx,i+1)),this.m_gnrl_img.push(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_box_%d_none.png",this.m_period.event_dungeon_group_idx,i+1));this.m_gnrl_img.push(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_boxgacha.png",this.m_period.event_dungeon_group_idx)),this.m_recv_item_list_popup=new GameModalLayer,this.addChild(this.m_recv_item_list_popup,1e4),this.m_item_lineup_popup=new GameModalLayer,this.addChild(this.m_item_lineup_popup,1e4),this.m_effect_popup=new GameModalLayer,this.addChild(this.m_effect_popup,1e4),this.m_message_box=new GameMessageBox,this.addChild(this.m_message_box,1e4),this.m_golden_barrel_popup=new GameMessageBox,this.addChild(this.m_golden_barrel_popup,1e4),resourceLoader(this.m_gnrl_img,function(){var bg,winSize=ccSize(this);USE_SP_EVENT_SCALE?((bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_group_idx+"/bg_eventvs_sub.jpg")).setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(this)),bg.setScale(2),this.addChild(bg),this.m_left_layer=this.createLeftBoxLayer_SP(),this.addChild(this.m_left_layer),this.m_right_layer=this.createRightBoxLayer_SP(),this.m_right_layer.setPosition(winSize.width-ccWidth(this.m_right_layer)-470,0),this.addChild(this.m_right_layer),this.m_tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(40,40,40,40)),this.m_tooltip_box.setAnchorPoint(ANCHOR_MIDDLE()),this.m_tooltip_box.setPosition(ZERO()),this.m_tooltip_box.setVisible(!0),this.addChild(this.m_tooltip_box,100),this.m_tooltip_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_201),this.m_tooltip_content.setAnchorPoint(ANCHOR_MIDDLE()),this.m_tooltip_content.setPosition(100,100),this.m_tooltip_content.enableOutline(cc.color.BLACK,2),this.m_tooltip_box.addChild(this.m_tooltip_content,100)):((bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_group_idx+"/bg_eventvs_sub.jpg")).setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(this)),this.addChild(bg),this.m_left_layer=this.createLeftBoxLayer(),this.m_left_layer.setPosition(LP(this,-53,0)),this.addChild(this.m_left_layer),this.m_right_layer=this.createRightBoxLayer(),this.m_right_layer.setPosition(winSize.width-ccWidth(this.m_right_layer)-10,0),this.addChild(this.m_right_layer),this.m_tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.m_tooltip_box.setAnchorPoint(ANCHOR_MIDDLE()),this.m_tooltip_box.setPosition(ZERO()),this.m_tooltip_box.setVisible(!1),this.m_right_layer.addChild(this.m_tooltip_box),this.m_tooltip_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.m_tooltip_content.setAnchorPoint(ANCHOR_MIDDLE()),this.m_tooltip_content.setPosition(ccCenter(this.m_tooltip_box)),this.m_tooltip_box.addChild(this.m_tooltip_content));this.getParent().removeLayerProgress2(),this.m_deferred.resolve(!0)}.bind(this))},onEnter:function(){this._super()},onExit:function(){if(this._super(),null!=this.m_gnrl_img){for(var idx=0;idx<this.m_gnrl_img.length;idx++)cc.loader.release(this.m_gnrl_img[idx]);this.m_gnrl_img=null,AudioEngine.getInstance().stopEffectsAll()}},onEnterTransitionDidFinish:function(){this._super(),this.playStateVoicePlay(box_gacha_in)},playStateVoicePlay:function(voice_type){var audio=AudioEngine.getInstance(),voice_list=MasterTable.getInstance().get_EventDungeonVoiceList(this.m_period.event_dungeon_period_idx,voice_type);if(0<voice_list.length){var r=parseInt(Math.random()*voice_list.length);audio.stopEffectsAll();var voice_path=RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice_list[r].voice_name+".mp3";audio.playVoice(voice_path)}},createLeftBoxLayer:function(){var layer=new cc.Layer,m=MasterManager.getInstance(),mt=MasterTable.getInstance(),frame_box=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_panel.png",this.m_period.event_dungeon_group_idx));frame_box.setAnchorPoint(ANCHOR_TOP_LEFT()),frame_box.setPosition(0,ccHeight(this)),layer.addChild(frame_box),layer.setContentSize(ccSize(frame_box));var box_title=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_panel_text.png",this.m_period.event_dungeon_point_period_idx));box_title.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),box_title.setPosition(ccCenter(frame_box).x,513),frame_box.addChild(box_title);for(var box_gacha_list=mt.get_EventDungeonBoxGachaV2List(this.m_period.event_dungeon_point_period_idx),btn_offset_y=(mt.get_EventDungeonBoxGachaItemListV2(this.m_user_event_box_gacha_info.event_dungeon_period_idx,this.m_user_event_box_gacha_info.event_dungeon_box_gacha_idx),397),is_selected=!1,i=0;i<box_gacha_list.length;i++){var box_info=box_gacha_list[i],box_img=null;is_selected=box_info.event_dungeon_box_gacha_idx==this.m_user_event_box_gacha_info.event_dungeon_box_gacha_idx&&box_info.event_dungeon_period_idx==this.m_user_event_box_gacha_info.event_dungeon_period_idx?(box_img=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_box_%d_off.png",this.m_period.event_dungeon_group_idx,i+1)),!0):(box_img=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_box_%d_none.png",this.m_period.event_dungeon_group_idx,i+1)),!1),box_img.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),box_img.setPosition(ccCenter(frame_box).x,btn_offset_y),frame_box.addChild(box_img);var selecting_img=cc.Sprite.create("#img_shop_box_arrow.png");selecting_img.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),selecting_img.setPosition(-5,ccCenter(box_img).y),selecting_img.setTag(SELECTED_IMAGE_TAG),box_img.addChild(selecting_img),selecting_img.setVisible(is_selected);var m1=new cc.MoveTo(.5,cc.p(0,ccCenter(box_img).y)),m2=new cc.MoveTo(.5,cc.p(-5,ccCenter(box_img).y)),seq=new cc.Sequence(m1,m2),repeat=new cc.RepeatForever(seq);if(selecting_img.runAction(repeat),i<box_gacha_list.length-1){var arrow=cc.Sprite.create("#img_shop_box_arrow_blue.png");arrow.setAnchorPoint(ANCHOR_MIDDLE_TOP()),arrow.setPosition(ccCenter(frame_box).x,btn_offset_y+12),frame_box.addChild(arrow,100)}this.m_box_gacha_proc.push_back(box_img),btn_offset_y-=80}var noti=cmLabel.getLabel(res_str("label_event_dungeon_box_gacha_notice_msg"),LABEL_FONT_INDEX.FONT_161);noti.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),noti.setPosition(.5*ccWidth(frame_box),123),noti.enableOutline(cc.color.BLACK,1),frame_box.addChild(noti);var cur_box_gacha=m.get_EventDungeonBoxGachaV2(this.m_user_event_box_gacha_info.event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.event_dungeon_period_idx),next_box_gacha=m.get_EventDungeonBoxGachaV2(cur_box_gacha.next_box_gacha_idx,cur_box_gacha.event_dungeon_period_idx);return this.m_next_box_gacha_btn=new LabelButton(RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_group_idx+"/btn_eventvs_box_5_off.png",RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_group_idx+"/btn_eventvs_box_5_on.png",RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_group_idx+"/btn_eventvs_box_5_none.png"),this.m_next_box_gacha_btn.setFont(LABEL_FONT_INDEX.FONT_241),this.m_next_box_gacha_btn.setOffFont(LABEL_FONT_INDEX.FONT_242),cur_box_gacha.name==next_box_gacha.name?this.m_next_box_gacha_btn.setString(cmString(res_str("label_event_dungeon_ed_box_reset_btn"),next_box_gacha.name)):this.m_next_box_gacha_btn.setString(cmString(res_str("label_event_dungeon_gacha_next_box_move"),next_box_gacha.name)),this.m_next_box_gacha_btn.addClickEventListener(function(){this.showNextBoxPopup()}.bind(this)),this.m_next_box_gacha_btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_next_box_gacha_btn.setPosition(ccCenter(frame_box).x,40),frame_box.addChild(this.m_next_box_gacha_btn),this.m_next_box_gacha_btn.setVisible(!1),this.m_next_box_gacha_btn.setEnabled(!1),this.m_next_box_gacha_btn_dis=new LabelButton(RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_group_idx+"/btn_eventvs_box_5_none.png",RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_group_idx+"/btn_eventvs_box_5_none.png",RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_group_idx+"/btn_eventvs_box_5_none.png"),this.m_next_box_gacha_btn_dis.setFont(LABEL_FONT_INDEX.FONT_241),this.m_next_box_gacha_btn_dis.setOffFont(LABEL_FONT_INDEX.FONT_242),cur_box_gacha.name==next_box_gacha.name?this.m_next_box_gacha_btn_dis.setString(cmString(res_str("label_event_dungeon_ed_box_reset_btn"),next_box_gacha.name)):this.m_next_box_gacha_btn_dis.setString(cmString(res_str("label_event_dungeon_gacha_next_box_move"),next_box_gacha.name)),this.m_next_box_gacha_btn_dis.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_next_box_gacha_btn_dis.setPosition(ccCenter(frame_box).x,40),this.m_next_box_gacha_btn_dis.setEnabled(!1),this.m_next_box_gacha_btn_dis.setVisible(!1),frame_box.addChild(this.m_next_box_gacha_btn_dis),layer},createLeftBoxLayer_SP:function(){var layer=new cc.Layer,m=MasterManager.getInstance(),mt=MasterTable.getInstance(),frame_box=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_panel.png",this.m_period.event_dungeon_group_idx));frame_box.setAnchorPoint(ANCHOR_TOP_LEFT()),frame_box.setPosition(0,ccHeight(this)),frame_box.setScale(2),layer.addChild(frame_box),layer.setContentSize(ccSize(frame_box));var box_title=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_panel_text.png",this.m_period.event_dungeon_point_period_idx));box_title.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),box_title.setPosition(220,533),box_title.setScale(2),this.addChild(box_title,10);for(var box_gacha_list=mt.get_EventDungeonBoxGachaV2List(this.m_period.event_dungeon_point_period_idx),btn_offset_y=(mt.get_EventDungeonBoxGachaItemListV2(this.m_user_event_box_gacha_info.event_dungeon_period_idx,this.m_user_event_box_gacha_info.event_dungeon_box_gacha_idx),397),is_selected=!1,i=0;i<box_gacha_list.length;i++){var box_info=box_gacha_list[i],box_img=null;is_selected=box_info.event_dungeon_box_gacha_idx==this.m_user_event_box_gacha_info.event_dungeon_box_gacha_idx&&box_info.event_dungeon_period_idx==this.m_user_event_box_gacha_info.event_dungeon_period_idx?(box_img=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_box_%d_off.png",this.m_period.event_dungeon_group_idx,i+1)),!0):(box_img=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_box_%d_none.png",this.m_period.event_dungeon_group_idx,i+1)),!1),box_img.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),box_img.setPosition(ccCenter(frame_box).x+100,btn_offset_y+10),box_img.setScale(2),this.addChild(box_img,10);var selecting_img=cc.Sprite.create("#img_shop_box_arrow.png");selecting_img.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),selecting_img.setPosition(-5,ccCenter(box_img).y),selecting_img.setTag(SELECTED_IMAGE_TAG),selecting_img.setScale(.5),box_img.addChild(selecting_img,100),selecting_img.setVisible(is_selected);var m1=new cc.MoveTo(.5,cc.p(0,ccCenter(box_img).y)),m2=new cc.MoveTo(.5,cc.p(-5,ccCenter(box_img).y)),seq=new cc.Sequence(m1,m2),repeat=new cc.RepeatForever(seq);if(selecting_img.runAction(repeat),i<box_gacha_list.length-1){var arrow=cc.Sprite.create("#img_shop_box_arrow_blue.png");arrow.setAnchorPoint(ANCHOR_MIDDLE_TOP()),arrow.setPosition(ccCenter(frame_box).x+105,btn_offset_y+22),this.addChild(arrow,100)}this.m_box_gacha_proc.push_back(box_img),btn_offset_y-=80}var noti=cmLabel.getLabel(res_str("label_event_dungeon_box_gacha_notice_msg"),LABEL_FONT_INDEX.FONT_161);noti.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),noti.setPosition(.5*ccWidth(frame_box)+100,133),noti.enableOutline(cc.color.BLACK,1),this.addChild(noti,10);var cur_box_gacha=m.get_EventDungeonBoxGachaV2(this.m_user_event_box_gacha_info.event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.event_dungeon_period_idx),next_box_gacha=m.get_EventDungeonBoxGachaV2(cur_box_gacha.next_box_gacha_idx,cur_box_gacha.event_dungeon_period_idx);return this.m_next_box_gacha_btn=new LabelButton(RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_group_idx+"/btn_eventvs_box_5_off.png",RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_group_idx+"/btn_eventvs_box_5_on.png",RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_group_idx+"/btn_eventvs_box_5_none.png"),this.m_next_box_gacha_btn.setFont(LABEL_FONT_INDEX.FONT_103),cur_box_gacha.name==next_box_gacha.name?this.m_next_box_gacha_btn.setString(cmString(res_str("label_event_dungeon_ed_box_reset_btn"),next_box_gacha.name)):this.m_next_box_gacha_btn.setString(cmString(res_str("label_event_dungeon_gacha_next_box_move"),next_box_gacha.name)),this.m_next_box_gacha_btn.addClickEventListener(function(){this.showNextBoxPopup()}.bind(this)),this.m_next_box_gacha_btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_next_box_gacha_btn.setPosition(ccCenter(frame_box).x,20),frame_box.addChild(this.m_next_box_gacha_btn),this.m_next_box_gacha_btn.setVisible(!1),this.m_next_box_gacha_btn.setEnabled(!1),this.m_next_box_gacha_btn_dis=new LabelButton(RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_group_idx+"/btn_eventvs_box_5_none.png",RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_group_idx+"/btn_eventvs_box_5_none.png",RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_group_idx+"/btn_eventvs_box_5_none.png"),this.m_next_box_gacha_btn_dis.setFont(LABEL_FONT_INDEX.FONT_103),cur_box_gacha.name==next_box_gacha.name?this.m_next_box_gacha_btn_dis.setString(cmString(res_str("label_event_dungeon_ed_box_reset_btn"),next_box_gacha.name)):this.m_next_box_gacha_btn_dis.setString(cmString(res_str("label_event_dungeon_gacha_next_box_move"),next_box_gacha.name)),this.m_next_box_gacha_btn_dis.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_next_box_gacha_btn_dis.setPosition(ccCenter(frame_box).x,20),this.m_next_box_gacha_btn_dis.setEnabled(!1),this.m_next_box_gacha_btn_dis.setVisible(!1),frame_box.addChild(this.m_next_box_gacha_btn_dis),layer},createRightBoxLayer:function(){var layer=new cc.Layer;layer.setContentSize(666,498);var m=MasterTable.getInstance(),mt=MasterManager.getInstance(),bg=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_boxgacha.png",this.m_period.event_dungeon_group_idx));bg.setAnchorPoint(ZERO()),bg.setPosition(0,107),layer.addChild(bg);var bgSize=cc.size(ccSize(bg)),cur_box_gacha=mt.get_EventDungeonBoxGachaV2(this.m_user_event_box_gacha_info.event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.event_dungeon_period_idx);"BOX 1"==cur_box_gacha.name?this.m_gacha_title=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_box_text_1.png",this.m_period.event_dungeon_group_idx)):"BOX 2"==cur_box_gacha.name?this.m_gacha_title=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_box_text_2.png",this.m_period.event_dungeon_group_idx)):"BOX 3"==cur_box_gacha.name?this.m_gacha_title=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_box_text_3.png",this.m_period.event_dungeon_group_idx)):"EX BOX"==cur_box_gacha.name&&(this.m_gacha_title=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_box_text_4.png",this.m_period.event_dungeon_group_idx))),this.m_gacha_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_gacha_title.setPosition(0,bgSize.height-14),bg.addChild(this.m_gacha_title);var item_list=m.get_EventDungeonBoxGachaItemListV2(cur_box_gacha.event_dungeon_period_idx,cur_box_gacha.event_dungeon_box_gacha_idx),remain=item_list.length-this.m_user_event_box_gacha_info.buy_log.length;this.m_gacha_count_label=cmLabel.getLabel(cmString("%d/%d",remain,item_list.length),LABEL_FONT_INDEX.FONT_247),this.m_gacha_count_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_gacha_count_label.setPosition(bgSize.width-26,bgSize.height-36),bg.addChild(this.m_gacha_count_label),this.m_gacha_count_title=cmLabel.getLabel(res_str("label_event_dungeon_box_gacha_remain_title_v2"),LABEL_FONT_INDEX.FONT_2013),this.m_gacha_count_title.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_gacha_count_title.setPosition(this.m_gacha_count_label.getPositionX()-ccWidth(this.m_gacha_count_label)-10,bgSize.height-36),bg.addChild(this.m_gacha_count_title),this.m_sub_main_items=[];for(var idx=0;idx<item_list.length;idx++){1==(item=item_list[idx]).main_bonus_type?this.m_main_item_data=item:2==item.main_bonus_type&&9999!=item.display_id&&this.m_sub_main_items.push(item)}if(this.m_sub_main_items.sort(function(l,r){return l.display_id>r.display_id?1:l.display_id<r.display_id?-1:0}),this.m_main_item_data.bonus_type==BONUS_TYPE_YUNHEE_FIX){var card={};card.gnrl_id=this.m_main_item_data.min_value,card.level=1,this.m_main_item_icon=(new Card).createCard(card,CARD_TYPE.type_common_card),this.m_main_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_main_item_icon.setPosition(179,195),bg.addChild(this.m_main_item_icon)}else this.m_main_item_data.bonus_type==BONUS_TYPE_GOLDEN_BARREL&&(this.m_main_item_icon=cc.Sprite.create(cmString("#img_reward_%d_d.png",this.m_main_item_data.bonus_type)),this.m_main_item_icon.setContentSize(140,140),this.m_main_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_main_item_icon.setPosition(179,195),this.m_main_item_icon.setScale(.8),bg.addChild(this.m_main_item_icon),this.m_golden_barrel_help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_golden_barrel_help_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_golden_barrel_help_btn.setPosition(227,244),bg.addChild(this.m_golden_barrel_help_btn,100),this.m_golden_barrel_help_btn.addClickEventListener(function(sender){this.showGoldenBarrelLineupPopup()}.bind(this)));if(null!=this.m_main_item_icon){this.m_main_item_icon.setTag(this.m_main_item_data.event_dungeon_box_gacha_item_idx),(tooltip_btn=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(1,1,1,1)))).setAnchorPoint(ANCHOR_MIDDLE()),tooltip_btn.setPreferredSize(ccSize(this.m_main_item_icon)),tooltip_btn.setPosition(ccCenter(this.m_main_item_icon)),tooltip_btn.setTag(TOOLTIP_BTN_TAG),this.m_main_item_icon.addChild(tooltip_btn),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_DOWN),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_CANCEL),this.m_main_item_count=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_main_item_count.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_main_item_count.setPosition(181,100),this.m_main_item_count.setTag(COUNT_LABEL_TAG),bg.addChild(this.m_main_item_count);for(var total_count=0,gain_count=0,i=0;i<item_list.length;i++){(it=item_list[i]).event_dungeon_period_idx==this.m_main_item_data.event_dungeon_period_idx&&it.event_dungeon_box_gacha_idx==this.m_main_item_data.event_dungeon_box_gacha_idx&&it.bonus_type==this.m_main_item_data.bonus_type&&it.main_bonus_type==this.m_main_item_data.main_bonus_type&&total_count++}for(var jdx=0;jdx<this.m_user_event_box_gacha_info.buy_log.length;jdx++){(item=mt.get_EventDungeonBoxGachaItemV2(this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_box_gacha_item_idx,this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_period_idx)).event_dungeon_period_idx==this.m_main_item_data.event_dungeon_period_idx&&item.event_dungeon_box_gacha_idx==this.m_main_item_data.event_dungeon_box_gacha_idx&&item.bonus_type==this.m_main_item_data.bonus_type&&item.main_bonus_type==this.m_main_item_data.main_bonus_type&&gain_count++}remain=total_count-gain_count;this.m_main_item_count.setString(cmString(res_str("label_event_dungeon_box_gacha_remain_item_count_v2"),remain))}var event_point_icon,sub_pos_list=[];sub_pos_list.push_back([394,270]),sub_pos_list.push_back([531,270]),sub_pos_list.push_back([394,136]),sub_pos_list.push_back([531,136]);for(i=0;i<this.m_sub_main_items.length;i++){var sub=this.m_sub_main_items[i];if(i<sub_pos_list.length){var tooltip_btn,pos=sub_pos_list.at(i),sub_item=null;(sub_item=sub.bonus_type==BONUS_TYPE_YUNHEE_FIX?cc.Sprite.create(cmString("#img_reward_%02d_%d.png",parseInt(sub.bonus_type),parseInt(sub.min_value))):cc.Sprite.create(cmString("#img_reward_%02d.png",parseInt(sub.bonus_type)))).setAnchorPoint(ANCHOR_MIDDLE()),sub_item.setPosition(pos[0],pos[1]),bg.addChild(sub_item),sub_item.setTag(sub.event_dungeon_box_gacha_item_idx),(tooltip_btn=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(1,1,1,1)))).setAnchorPoint(ANCHOR_MIDDLE()),tooltip_btn.setPreferredSize(ccSize(sub_item)),tooltip_btn.setPosition(ccCenter(sub_item)),tooltip_btn.setTag(TOOLTIP_BTN_TAG),sub_item.addChild(tooltip_btn),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_DOWN),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_CANCEL);var cnt_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161);cnt_label.setAnchorPoint(ANCHOR_MIDDLE_TOP()),cnt_label.setPosition(ccCenter(sub_item).x,-25),cnt_label.setTag(COUNT_LABEL_TAG),sub_item.addChild(cnt_label);for(total_count=0,gain_count=0,idx=0;idx<item_list.length;idx++){var it;(it=item_list[idx]).event_dungeon_period_idx==sub.event_dungeon_period_idx&&it.event_dungeon_box_gacha_idx==sub.event_dungeon_box_gacha_idx&&it.bonus_type==sub.bonus_type&&it.main_bonus_type==sub.main_bonus_type&&total_count++}for(jdx=0;jdx<this.m_user_event_box_gacha_info.buy_log.length;jdx++){var item;(item=mt.get_EventDungeonBoxGachaItemV2(this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_box_gacha_item_idx,this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_period_idx)).event_dungeon_period_idx==sub.event_dungeon_period_idx&&item.event_dungeon_box_gacha_idx==sub.event_dungeon_box_gacha_idx&&item.bonus_type==sub.bonus_type&&item.main_bonus_type==sub.main_bonus_type&&gain_count++}remain=total_count-gain_count;cnt_label.setString(cmString(res_str("label_event_dungeon_box_gacha_remain_item_count_v2"),remain)),this.m_sub_main_item_icons.push(sub_item)}}103001==this.m_period.event_dungeon_point_period_idx?((event_point_icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_point.png",this.m_period.event_dungeon_point_period_idx))).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),event_point_icon.setPosition(ccWidth(bg)-112+14,24),bg.addChild(event_point_icon)):((event_point_icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_point.png",this.m_period.event_dungeon_point_period_idx))).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),event_point_icon.setPosition(ccWidth(bg)-112,24),bg.addChild(event_point_icon));this.m_event_point_label=cmLabel.getLabel(cmString(res_str("label_event_dungeon_own_point"),Number(this.m_event_dungeon_point.event_point).toLocaleString()),LABEL_FONT_INDEX.FONT_181),this.m_event_point_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_event_point_label.setPosition(ccWidth(bg)-24,24),bg.addChild(this.m_event_point_label);var cost_list=m.get_EventDungeonBoxGachaCostInfoListV2(cur_box_gacha.event_dungeon_period_idx,cur_box_gacha.event_dungeon_box_gacha_idx),cnt_strings=[];cnt_strings.push_back("N"),cnt_strings.push_back("O"),cnt_strings.push_back("P");var cost_btn_offset_x=43,cost=cost_list;this.m_btn=new LabelButton("btn_gacha_small_off.png","btn_gacha_small_on.png","btn_gacha_small_none.png",ccui.Widget.PLIST_TEXTURE),this.m_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_btn.setPosition(cost_btn_offset_x,19),layer.addChild(this.m_btn),this.m_btn.addClickEventListener(function(sender){this.reqBoxGachaV2(cost[0].event_dungeon_box_gacha_cost_info_idx)}.bind(this)),this.m_icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_point.png",this.m_period.event_dungeon_point_period_idx)),this.m_icon.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_icon.setPosition(0,.5*ccHeight(this.m_btn)),this.m_btn.addChild(this.m_icon),this.m_cnt_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"fonts/img_eventvs_btn_text.fnt",cnt_strings.at(0),cc.TEXT_ALIGNMENT_CENTER),this.m_cnt_label.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_cnt_label.setPosition(.5*ccWidth(this.m_btn),ccHeight(this.m_btn)-18),this.m_btn.addChild(this.m_cnt_label),this.m_cost_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"fonts/img_eventvs_btn_text.fnt",cmString("%sM",Number(cost[0].need_point).toLocaleString()),cc.TEXT_ALIGNMENT_CENTER),this.m_cost_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_cost_label.setPosition(.5*ccWidth(this.m_btn),2),this.m_cost_label.setTag(GACHA_COST_LABEL_TAG),this.m_btn.addChild(this.m_cost_label),cost_btn_offset_x+=ccWidth(this.m_btn)+9,this.m_gacha_btns.push_back(this.m_btn),this.m_btn1=new LabelButton("btn_gacha_small_off.png","btn_gacha_small_on.png","btn_gacha_small_none.png",ccui.Widget.PLIST_TEXTURE),this.m_btn1.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_btn1.setPosition(cost_btn_offset_x,19),layer.addChild(this.m_btn1),this.m_btn1.addClickEventListener(function(sender){this.reqBoxGachaV2(cost[1].event_dungeon_box_gacha_cost_info_idx)}.bind(this)),this.m_icon1=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_point.png",this.m_period.event_dungeon_point_period_idx)),this.m_icon1.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_icon1.setPosition(0,.5*ccHeight(this.m_btn1)),this.m_btn1.addChild(this.m_icon1),this.m_cnt_label1=cmLabel.createWithBMFont(RES_CDN_DEFULT+"fonts/img_eventvs_btn_text.fnt",cnt_strings.at(1),cc.TEXT_ALIGNMENT_CENTER),this.m_cnt_label1.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_cnt_label1.setPosition(.5*ccWidth(this.m_btn1),ccHeight(this.m_btn1)-18),this.m_btn1.addChild(this.m_cnt_label1),this.m_cost_label1=cmLabel.createWithBMFont(RES_CDN_DEFULT+"fonts/img_eventvs_btn_text.fnt",cmString("%sM",Number(cost[1].need_point).toLocaleString()),cc.TEXT_ALIGNMENT_CENTER),this.m_cost_label1.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_cost_label1.setPosition(.5*ccWidth(this.m_btn1),2),this.m_cost_label1.setTag(GACHA_COST_LABEL_TAG+1),this.m_btn1.addChild(this.m_cost_label1),cost_btn_offset_x+=ccWidth(this.m_btn1)+9,this.m_gacha_btns.push_back(this.m_btn1),this.m_btn2=new LabelButton("btn_gacha_small_off.png","btn_gacha_small_on.png","btn_gacha_small_none.png",ccui.Widget.PLIST_TEXTURE),this.m_btn2.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_btn2.setPosition(cost_btn_offset_x,19),layer.addChild(this.m_btn2),this.m_btn2.addClickEventListener(function(sender){this.reqBoxGachaV2(cost[2].event_dungeon_box_gacha_cost_info_idx)}.bind(this)),this.m_icon2=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_point.png",this.m_period.event_dungeon_point_period_idx)),this.m_icon2.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_icon2.setPosition(0,.5*ccHeight(this.m_btn2)),this.m_btn2.addChild(this.m_icon2),this.m_cnt_label2=cmLabel.createWithBMFont(RES_CDN_DEFULT+"fonts/img_eventvs_btn_text.fnt",cnt_strings.at(2),cc.TEXT_ALIGNMENT_CENTER),this.m_cnt_label2.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_cnt_label2.setPosition(.5*ccWidth(this.m_btn2),ccHeight(this.m_btn2)-18),this.m_btn2.addChild(this.m_cnt_label2),this.m_cost_label2=cmLabel.createWithBMFont(RES_CDN_DEFULT+"fonts/img_eventvs_btn_text.fnt",cmString("%sM",Number(cost[2].need_point).toLocaleString()),cc.TEXT_ALIGNMENT_CENTER),this.m_cost_label2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_cost_label2.setPosition(.5*ccWidth(this.m_btn2),2),this.m_cost_label2.setTag(GACHA_COST_LABEL_TAG+2),this.m_btn2.addChild(this.m_cost_label2),cost_btn_offset_x+=ccWidth(this.m_btn2)+9,this.m_gacha_btns.push_back(this.m_btn2),this.m_content_view_btn=new LabelButton("btn_29_off.png","btn_29_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_content_view_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_content_view_btn.setPosition(0,508),this.m_content_view_btn.setFont(LABEL_FONT_INDEX.FONT_181),this.m_content_view_btn.setOffFont(LABEL_FONT_INDEX.FONT_188),this.m_content_view_btn.setString(cmString(res_str("label_event_dungeon_box_gacha_lineup_btn"),cur_box_gacha.name)),this.m_content_view_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_EventDungeonBoxGachaSceneV2],btn_box_gacha_lineup_popup_on)}.bind(this)),layer.addChild(this.m_content_view_btn);var notice_btn=new LabelButton("btn_29_off.png","btn_29_on.png","",ccui.Widget.PLIST_TEXTURE);return notice_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),notice_btn.setPosition(260,508),notice_btn.setFont(LABEL_FONT_INDEX.FONT_181),notice_btn.setOffFont(LABEL_FONT_INDEX.FONT_188),notice_btn.setString(res_str("label_event_dungeon_box_gacha_notice_btn")),notice_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_EventDungeonBoxGachaSceneV2],btn_box_gacha_detail_popup)}),layer.addChild(notice_btn),this.checkEnableResetBtn(),layer},createRightBoxLayer_SP:function(){var layer=new cc.Layer;layer.setContentSize(666,498);var m=MasterTable.getInstance(),mt=MasterManager.getInstance(),bg=(EventDungeonService.getInstance(),cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_boxgacha.png",this.m_period.event_dungeon_group_idx)));bg.setAnchorPoint(ZERO()),bg.setPosition(460,107),bg.setScale(2),layer.addChild(bg);var bgSize=cc.size(ccSize(bg)),cur_box_gacha=mt.get_EventDungeonBoxGachaV2(this.m_user_event_box_gacha_info.event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.event_dungeon_period_idx);"BOX 1"==cur_box_gacha.name?this.m_gacha_title=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_box_text_1.png",this.m_period.event_dungeon_group_idx)):"BOX 2"==cur_box_gacha.name?this.m_gacha_title=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_box_text_2.png",this.m_period.event_dungeon_group_idx)):"BOX 3"==cur_box_gacha.name?this.m_gacha_title=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_box_text_3.png",this.m_period.event_dungeon_group_idx)):"EX BOX"==cur_box_gacha.name&&(this.m_gacha_title=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_box_text_4.png",this.m_period.event_dungeon_group_idx))),this.m_gacha_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_gacha_title.setPosition(458,bgSize.height+290),this.m_gacha_title.setScale(2),this.addChild(this.m_gacha_title,10);var item_list=m.get_EventDungeonBoxGachaItemListV2(cur_box_gacha.event_dungeon_period_idx,cur_box_gacha.event_dungeon_box_gacha_idx),remain=item_list.length-this.m_user_event_box_gacha_info.buy_log.length;this.m_gacha_count_label=cmLabel.getLabel(cmString("%d/%d",remain,item_list.length),LABEL_FONT_INDEX.FONT_247),this.m_gacha_count_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_gacha_count_label.setPosition(bgSize.width+765,bgSize.height+265),this.addChild(this.m_gacha_count_label,10),this.m_gacha_count_title=cmLabel.getLabel(res_str("label_event_dungeon_box_gacha_remain_title_v2"),LABEL_FONT_INDEX.FONT_2013),this.m_gacha_count_title.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_gacha_count_title.setPosition(bgSize.width+665,bgSize.height+265),this.addChild(this.m_gacha_count_title,10),this.m_sub_main_items=[];for(var idx=0;idx<item_list.length;idx++){1==(item=item_list[idx]).main_bonus_type?this.m_main_item_data=item:2==item.main_bonus_type&&9999!=item.display_id&&this.m_sub_main_items.push(item)}if(this.m_sub_main_items.sort(function(l,r){return l.display_id>r.display_id?1:l.display_id<r.display_id?-1:0}),this.m_main_item_data.bonus_type==BONUS_TYPE_YUNHEE_FIX){var card={};card.gnrl_id=this.m_main_item_data.min_value,card.level=1,this.m_main_item_icon=(new Card).createCard(card,CARD_TYPE.type_common_card),this.m_main_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_main_item_icon.setPosition(639,303),this.addChild(this.m_main_item_icon,10)}else this.m_main_item_data.bonus_type==BONUS_TYPE_GOLDEN_BARREL&&(this.m_main_item_icon=cc.Sprite.create(cmString("#img_reward_%d_d.png",this.m_main_item_data.bonus_type)),this.m_main_item_icon.setContentSize(140,140),this.m_main_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_main_item_icon.setPosition(639,303),this.m_main_item_icon.setScale(.8),this.addChild(this.m_main_item_icon,10),this.m_main_item_icon.setVisible(!0),this.m_golden_barrel_help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_golden_barrel_help_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_golden_barrel_help_btn.setPosition(686,344),this.addChild(this.m_golden_barrel_help_btn,100),this.m_golden_barrel_help_btn.addClickEventListener(function(sender){this.showGoldenBarrelLineupPopup()}.bind(this)));if(null!=this.m_main_item_icon){this.m_main_item_icon.setTag(this.m_main_item_data.event_dungeon_box_gacha_item_idx),(tooltip_btn=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(1,1,1,1)))).setAnchorPoint(ANCHOR_MIDDLE()),tooltip_btn.setPreferredSize(ccSize(this.m_main_item_icon)),tooltip_btn.setPosition(ccCenter(this.m_main_item_icon)),tooltip_btn.setTag(TOOLTIP_BTN_TAG),this.m_main_item_icon.addChild(tooltip_btn,10),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_DOWN),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_CANCEL),this.m_main_item_count=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_main_item_count.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_main_item_count.setPosition(643,206),this.m_main_item_count.setTag(COUNT_LABEL_TAG),this.addChild(this.m_main_item_count,10);for(var total_count=0,gain_count=0,i=0;i<item_list.length;i++){(it=item_list[i]).event_dungeon_period_idx==this.m_main_item_data.event_dungeon_period_idx&&it.event_dungeon_box_gacha_idx==this.m_main_item_data.event_dungeon_box_gacha_idx&&it.bonus_type==this.m_main_item_data.bonus_type&&it.main_bonus_type==this.m_main_item_data.main_bonus_type&&total_count++}for(var jdx=0;jdx<this.m_user_event_box_gacha_info.buy_log.length;jdx++){(item=mt.get_EventDungeonBoxGachaItemV2(this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_box_gacha_item_idx,this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_period_idx)).event_dungeon_period_idx==this.m_main_item_data.event_dungeon_period_idx&&item.event_dungeon_box_gacha_idx==this.m_main_item_data.event_dungeon_box_gacha_idx&&item.bonus_type==this.m_main_item_data.bonus_type&&item.main_bonus_type==this.m_main_item_data.main_bonus_type&&gain_count++}remain=total_count-gain_count;this.m_main_item_count.setString(cmString(res_str("label_event_dungeon_box_gacha_remain_item_count_v2"),remain))}var event_point_icon,sub_pos_list=[];sub_pos_list.push_back([854,374]),sub_pos_list.push_back([991,374]),sub_pos_list.push_back([854,240]),sub_pos_list.push_back([991,240]);for(i=0;i<this.m_sub_main_items.length;i++){var sub=this.m_sub_main_items[i];if(i<sub_pos_list.length){var tooltip_btn,pos=sub_pos_list.at(i),sub_item=null;(sub_item=sub.bonus_type==BONUS_TYPE_YUNHEE_FIX?cc.Sprite.create(cmString("#img_reward_%02d_%d.png",parseInt(sub.bonus_type),parseInt(sub.min_value))):cc.Sprite.create(cmString("#img_reward_%02d.png",parseInt(sub.bonus_type)))).setAnchorPoint(ANCHOR_MIDDLE()),sub_item.setPosition(pos[0],pos[1]),this.addChild(sub_item,10),sub_item.setTag(sub.event_dungeon_box_gacha_item_idx),(tooltip_btn=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(1,1,1,1)))).setAnchorPoint(ANCHOR_MIDDLE()),tooltip_btn.setPreferredSize(ccSize(sub_item)),tooltip_btn.setPosition(ccCenter(sub_item)),tooltip_btn.setTag(TOOLTIP_BTN_TAG),sub_item.addChild(tooltip_btn,100),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_DOWN),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_CANCEL);var cnt_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161);cnt_label.setAnchorPoint(ANCHOR_MIDDLE_TOP()),cnt_label.setPosition(ccCenter(sub_item).x,-25),cnt_label.setTag(COUNT_LABEL_TAG),sub_item.addChild(cnt_label);for(total_count=0,gain_count=0,idx=0;idx<item_list.length;idx++){var it;(it=item_list[idx]).event_dungeon_period_idx==sub.event_dungeon_period_idx&&it.event_dungeon_box_gacha_idx==sub.event_dungeon_box_gacha_idx&&it.bonus_type==sub.bonus_type&&it.main_bonus_type==sub.main_bonus_type&&total_count++}for(jdx=0;jdx<this.m_user_event_box_gacha_info.buy_log.length;jdx++){var item;(item=mt.get_EventDungeonBoxGachaItemV2(this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_box_gacha_item_idx,this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_period_idx)).event_dungeon_period_idx==sub.event_dungeon_period_idx&&item.event_dungeon_box_gacha_idx==sub.event_dungeon_box_gacha_idx&&item.bonus_type==sub.bonus_type&&item.main_bonus_type==sub.main_bonus_type&&gain_count++}remain=total_count-gain_count;cnt_label.setString(cmString(res_str("label_event_dungeon_box_gacha_remain_item_count_v2"),remain)),this.m_sub_main_item_icons.push(sub_item)}}103001==this.m_period.event_dungeon_point_period_idx?((event_point_icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_point.png",this.m_period.event_dungeon_point_period_idx))).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),event_point_icon.setPosition(ccWidth(bg)-112+14,24),bg.addChild(event_point_icon)):((event_point_icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_point.png",this.m_period.event_dungeon_point_period_idx))).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),event_point_icon.setPosition(ccWidth(bg)+682,131),event_point_icon.setScale(2),this.addChild(event_point_icon,10));this.m_event_point_label=cmLabel.getLabel(cmString(res_str("label_event_dungeon_own_point"),Number(this.m_event_dungeon_point.event_point).toLocaleString()),LABEL_FONT_INDEX.FONT_181),this.m_event_point_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_event_point_label.setPosition(ccWidth(bg)+772,131),this.addChild(this.m_event_point_label,10);var cost_list=m.get_EventDungeonBoxGachaCostInfoListV2(cur_box_gacha.event_dungeon_period_idx,cur_box_gacha.event_dungeon_box_gacha_idx),cnt_strings=[];cnt_strings.push_back("N"),cnt_strings.push_back("O"),cnt_strings.push_back("P");var cost_btn_offset_x=503,cost=cost_list;this.m_btn=new LabelButton("btn_gacha_small_off.png","btn_gacha_small_on.png","btn_gacha_small_none.png",ccui.Widget.PLIST_TEXTURE),this.m_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_btn.setPosition(cost_btn_offset_x,19),layer.addChild(this.m_btn),this.m_btn.addClickEventListener(function(sender){this.reqBoxGachaV2(cost[0].event_dungeon_box_gacha_cost_info_idx)}.bind(this)),this.m_icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_point.png",this.m_period.event_dungeon_point_period_idx)),this.m_icon.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_icon.setPosition(0,.5*ccHeight(this.m_btn)),this.m_icon.setScale(2),this.m_btn.addChild(this.m_icon),this.m_cnt_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"fonts/img_eventvs_btn_text.fnt",cnt_strings.at(0),cc.TEXT_ALIGNMENT_CENTER),this.m_cnt_label.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_cnt_label.setPosition(.5*ccWidth(this.m_btn),ccHeight(this.m_btn)-18),this.m_btn.addChild(this.m_cnt_label),this.m_cost_label=cmLabel.createWithBMFont(RES_CDN_DEFULT+"fonts/img_eventvs_btn_text.fnt",cmString("%sM",Number(cost[0].need_point).toLocaleString()),cc.TEXT_ALIGNMENT_CENTER),this.m_cost_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_cost_label.setPosition(.5*ccWidth(this.m_btn),2),this.m_cost_label.setTag(GACHA_COST_LABEL_TAG),this.m_btn.addChild(this.m_cost_label),cost_btn_offset_x+=ccWidth(this.m_btn)+9,this.m_gacha_btns.push_back(this.m_btn),this.m_btn1=new LabelButton("btn_gacha_small_off.png","btn_gacha_small_on.png","btn_gacha_small_none.png",ccui.Widget.PLIST_TEXTURE),this.m_btn1.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_btn1.setPosition(cost_btn_offset_x,19),layer.addChild(this.m_btn1),this.m_btn1.addClickEventListener(function(sender){this.reqBoxGachaV2(cost[1].event_dungeon_box_gacha_cost_info_idx)}.bind(this)),this.m_icon1=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_point.png",this.m_period.event_dungeon_point_period_idx)),this.m_icon1.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_icon1.setPosition(0,.5*ccHeight(this.m_btn1)),this.m_icon1.setScale(2),this.m_btn1.addChild(this.m_icon1),this.m_cnt_label1=cmLabel.createWithBMFont(RES_CDN_DEFULT+"fonts/img_eventvs_btn_text.fnt",cnt_strings.at(1),cc.TEXT_ALIGNMENT_CENTER),this.m_cnt_label1.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_cnt_label1.setPosition(.5*ccWidth(this.m_btn1),ccHeight(this.m_btn1)-18),this.m_btn1.addChild(this.m_cnt_label1),this.m_cost_label1=cmLabel.createWithBMFont(RES_CDN_DEFULT+"fonts/img_eventvs_btn_text.fnt",cmString("%sM",Number(cost[1].need_point).toLocaleString()),cc.TEXT_ALIGNMENT_CENTER),this.m_cost_label1.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_cost_label1.setPosition(.5*ccWidth(this.m_btn1),2),this.m_cost_label1.setTag(GACHA_COST_LABEL_TAG+1),this.m_btn1.addChild(this.m_cost_label1),cost_btn_offset_x+=ccWidth(this.m_btn1)+9,this.m_gacha_btns.push_back(this.m_btn1),this.m_btn2=new LabelButton("btn_gacha_small_off.png","btn_gacha_small_on.png","btn_gacha_small_none.png",ccui.Widget.PLIST_TEXTURE),this.m_btn2.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_btn2.setPosition(cost_btn_offset_x,19),layer.addChild(this.m_btn2),this.m_btn2.addClickEventListener(function(sender){this.reqBoxGachaV2(cost[2].event_dungeon_box_gacha_cost_info_idx)}.bind(this)),this.m_icon2=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_point.png",this.m_period.event_dungeon_point_period_idx)),this.m_icon2.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_icon2.setPosition(0,.5*ccHeight(this.m_btn2)),this.m_icon2.setScale(2),this.m_btn2.addChild(this.m_icon2),this.m_cnt_label2=cmLabel.createWithBMFont(RES_CDN_DEFULT+"fonts/img_eventvs_btn_text.fnt",cnt_strings.at(2),cc.TEXT_ALIGNMENT_CENTER),this.m_cnt_label2.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_cnt_label2.setPosition(.5*ccWidth(this.m_btn2),ccHeight(this.m_btn2)-18),this.m_btn2.addChild(this.m_cnt_label2),this.m_cost_label2=cmLabel.createWithBMFont(RES_CDN_DEFULT+"fonts/img_eventvs_btn_text.fnt",cmString("%sM",Number(cost[2].need_point).toLocaleString()),cc.TEXT_ALIGNMENT_CENTER),this.m_cost_label2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_cost_label2.setPosition(.5*ccWidth(this.m_btn2),2),this.m_cost_label2.setTag(GACHA_COST_LABEL_TAG+2),this.m_btn2.addChild(this.m_cost_label2),cost_btn_offset_x+=ccWidth(this.m_btn2)+9,this.m_gacha_btns.push_back(this.m_btn2),this.m_content_view_btn=new LabelButton("btn_29_off.png","btn_29_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_content_view_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_content_view_btn.setPosition(460,508),this.m_content_view_btn.setFont(LABEL_FONT_INDEX.FONT_181),this.m_content_view_btn.setOffFont(LABEL_FONT_INDEX.FONT_188),this.m_content_view_btn.setString(cmString(res_str("label_event_dungeon_box_gacha_lineup_btn"),cur_box_gacha.name)),this.m_content_view_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_EventDungeonBoxGachaSceneV2],btn_box_gacha_lineup_popup_on)}.bind(this)),layer.addChild(this.m_content_view_btn);var notice_btn=new LabelButton("btn_29_off.png","btn_29_on.png","",ccui.Widget.PLIST_TEXTURE);return notice_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),notice_btn.setPosition(720,508),notice_btn.setFont(LABEL_FONT_INDEX.FONT_181),notice_btn.setOffFont(LABEL_FONT_INDEX.FONT_188),notice_btn.setString(res_str("label_event_dungeon_box_gacha_notice_btn")),notice_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_EventDungeonBoxGachaSceneV2],btn_box_gacha_detail_popup)}),layer.addChild(notice_btn),this.checkEnableResetBtn(),layer},reqBoxGachaV2:function(cost_info_idx){var cost=MasterManager.getInstance().get_EventDungeonBoxGachaCostInfoV2(cost_info_idx);if(0!=cost.event_dungeon_box_gacha_cost_info_idx){if(this.m_event_dungeon_point.event_point<cost.need_point){var scene=SceneManager.getInstance().getRunningScene(),msg=[];return msg.push_back(res_str("label_event_dungeon_point_lack")),void scene.showMsgBox(msg)}var req={};req.opcode=net.OP.op_event_dungeon_box_gacha_buy_v2,req.event_dungeon_period_idx=this.m_user_event_box_gacha_info.event_dungeon_period_idx,req.event_dungeon_box_gacha_idx=this.m_user_event_box_gacha_info.event_dungeon_box_gacha_idx,req.event_dungeon_box_gacha_cost_info_idx=cost.event_dungeon_box_gacha_cost_info_idx,SceneManager.getInstance().getRunningScene().network_write(req),this.playStateVoicePlay(box_gacha_buy)}},reqNextBoxGachaV2:function(){var req={};req.opcode=net.OP.op_event_dungeon_box_gacha_reset_v2,req.event_dungeon_period_idx=this.m_user_event_box_gacha_info.event_dungeon_period_idx,req.event_dungeon_box_gacha_idx=this.m_user_event_box_gacha_info.event_dungeon_box_gacha_idx,SceneManager.getInstance().getRunningScene().network_write(req)},recvBoxGachaBuyResult:function(res){this.m_box_gacha_buy_result=res;var netService=new NetService;EventDungeonService.getInstance().getUserEventDungeonPoint(this.m_period.event_dungeon_point_period_idx,this.m_event_dungeon_point);for(var event_dungeon_box_gacha_info=netService._event_box_gacha_info_v2.event_dungeon_box_gacha_info,idx=0;idx<event_dungeon_box_gacha_info.length;idx++){var box=event_dungeon_box_gacha_info[idx];if(box.event_dungeon_period_idx==this.m_period.event_dungeon_point_period_idx){this.m_user_event_box_gacha_info=box;break}}this.updateLayout(),this.checkEnableResetBtn(),1==res.reward_items.size()?this.showRewardItemEffectPopup(res.buy_log.at(0),res.reward_items.at(0)):(RAID_BOSS_MODAL_OPEN_FLAG=!0,this.showRecvItemListPopup(res))},recvBoxGachaResetResult:function(res){for(var event_dungeon_box_gacha_info=(new NetService)._event_box_gacha_info_v2.event_dungeon_box_gacha_info,idx=0;idx<event_dungeon_box_gacha_info.length;idx++){var box=event_dungeon_box_gacha_info[idx];if(box.event_dungeon_period_idx==this.m_period.event_dungeon_point_period_idx){this.m_user_event_box_gacha_info=box;break}}this.resetLayout()},updateLayout:function(){for(var total_count=0,gain_count=0,m=MasterTable.getInstance(),mt=MasterManager.getInstance(),cur_box_gacha=mt.get_EventDungeonBoxGachaV2(this.m_user_event_box_gacha_info.event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.event_dungeon_period_idx),item_list=m.get_EventDungeonBoxGachaItemListV2(cur_box_gacha.event_dungeon_period_idx,cur_box_gacha.event_dungeon_box_gacha_idx),idx=0;idx<item_list.length;idx++){(it=item_list[idx]).event_dungeon_period_idx==this.m_main_item_data.event_dungeon_period_idx&&it.event_dungeon_box_gacha_idx==this.m_main_item_data.event_dungeon_box_gacha_idx&&it.bonus_type==this.m_main_item_data.bonus_type&&it.main_bonus_type==this.m_main_item_data.main_bonus_type&&total_count++}for(var jdx=0;jdx<this.m_user_event_box_gacha_info.buy_log.length;jdx++){(item=mt.get_EventDungeonBoxGachaItemV2(this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_box_gacha_item_idx,this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_period_idx)).event_dungeon_period_idx==this.m_main_item_data.event_dungeon_period_idx&&item.event_dungeon_box_gacha_idx==this.m_main_item_data.event_dungeon_box_gacha_idx&&item.bonus_type==this.m_main_item_data.bonus_type&&item.main_bonus_type==this.m_main_item_data.main_bonus_type&&gain_count++}var remain=total_count-gain_count;this.m_main_item_count.setString(cmString(res_str("label_event_dungeon_box_gacha_remain_item_count_v2"),remain));for(var i=0;i<this.m_sub_main_items.length;i++){var sub=this.m_sub_main_items[i];if(i<this.m_sub_main_item_icons.length){for(var found=0,found_is=!1,idx2=0;idx2<this.m_sub_main_item_icons.length;idx2++){if(found=idx2,this.m_sub_main_item_icons[idx2].getTag()==sub.event_dungeon_box_gacha_item_idx){found_is=!0;break}}if(1==found_is){for(var icon=this.m_sub_main_item_icons[found],idx3=gain_count=total_count=0;idx3<item_list.length;idx3++){var it;(it=item_list[idx3]).event_dungeon_period_idx==sub.event_dungeon_period_idx&&it.event_dungeon_box_gacha_idx==sub.event_dungeon_box_gacha_idx&&it.bonus_type==sub.bonus_type&&it.main_bonus_type==sub.main_bonus_type&&total_count++}for(var jdx3=0;jdx3<this.m_user_event_box_gacha_info.buy_log.length;jdx3++){var item;(item=mt.get_EventDungeonBoxGachaItemV2(this.m_user_event_box_gacha_info.buy_log[jdx3].event_dungeon_box_gacha_item_idx,this.m_user_event_box_gacha_info.buy_log[jdx3].event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.buy_log[jdx3].event_dungeon_period_idx)).event_dungeon_period_idx==sub.event_dungeon_period_idx&&item.event_dungeon_box_gacha_idx==sub.event_dungeon_box_gacha_idx&&item.bonus_type==sub.bonus_type&&item.main_bonus_type==sub.main_bonus_type&&gain_count++}remain=total_count-gain_count;icon.getChildByTag(COUNT_LABEL_TAG).setString(cmString(res_str("label_event_dungeon_box_gacha_remain_item_count_v2"),remain))}}}remain=item_list.size()-this.m_user_event_box_gacha_info.buy_log.size();this.m_gacha_count_label.setString(cmString("%d/%d",remain,item_list.size())),this.m_gacha_count_title.setPositionX(this.m_gacha_count_label.getPositionX()-ccWidth(this.m_gacha_count_label)-10),this.m_event_point_label.setString(cmString(res_str("label_event_dungeon_own_point"),Number(this.m_event_dungeon_point.event_point).toLocaleString()))},resetLayout:function(){USE_SP_EVENT_SCALE?(this.resetRightBox_SP(),this.resetLeftBox_SP()):(this.resetRightBox(),this.resetLeftBox())},resetRightBox:function(){var m=MasterTable.getInstance(),mt=MasterManager.getInstance(),total_count=(EventDungeonService.getInstance(),0),gain_count=0,cur_box_gacha=mt.get_EventDungeonBoxGachaV2(this.m_user_event_box_gacha_info.event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.event_dungeon_period_idx);"BOX 1"==cur_box_gacha.name?this.m_gacha_title.setTexture(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_box_text_1.png",this.m_period.event_dungeon_group_idx)):"BOX 2"==cur_box_gacha.name?this.m_gacha_title.setTexture(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_box_text_2.png",this.m_period.event_dungeon_group_idx)):"BOX 3"==cur_box_gacha.name?this.m_gacha_title.setTexture(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_box_text_3.png",this.m_period.event_dungeon_group_idx)):"EX BOX"==cur_box_gacha.name&&this.m_gacha_title.setTexture(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_box_text_4.png",this.m_period.event_dungeon_group_idx)),this.m_content_view_btn.setString(cmString(res_str("label_event_dungeon_box_gacha_lineup_btn"),cur_box_gacha.name));var item_list=m.get_EventDungeonBoxGachaItemListV2(cur_box_gacha.event_dungeon_period_idx,cur_box_gacha.event_dungeon_box_gacha_idx);this.m_sub_main_items=[];for(var idx=0;idx<item_list.length;idx++){1==(item=item_list[idx]).main_bonus_type?this.m_main_item_data=item:2==item.main_bonus_type&&9999!=item.display_id&&this.m_sub_main_items.push(item)}this.m_sub_main_items.sort(function(l,r){return l.display_id>r.display_id?1:l.display_id<r.display_id?-1:0});var parent=this.m_main_item_icon.getParent();if(null!=parent&&(this.m_main_item_icon.removeFromParentAndCleanup(!0),this.m_main_item_icon=null),this.m_main_item_data.bonus_type==BONUS_TYPE_YUNHEE_FIX){var card=new Card;card.gnrl_id=this.m_main_item_data.min_value,card.level=1,this.m_main_item_icon=(new Card).createCard(card,CARD_TYPE.type_common_card),this.m_main_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_main_item_icon.setPosition(179,195),parent.addChild(this.m_main_item_icon)}else this.m_main_item_data.bonus_type==BONUS_TYPE_GOLDEN_BARREL&&(this.m_main_item_icon=cc.Sprite.create(cmString("#img_reward_%d_d.png",this.m_main_item_data.bonus_type)),this.m_main_item_icon.setContentSize(140,140),this.m_main_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_main_item_icon.setPosition(179,195),this.m_main_item_icon.setScale(.8),parent.addChild(this.m_main_item_icon),null==this.m_golden_barrel_help_btn&&(this.m_golden_barrel_help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_golden_barrel_help_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_golden_barrel_help_btn.setPosition(200,216),parent.addChild(this.m_golden_barrel_help_btn,100),this.m_golden_barrel_help_btn.addClickEventListener(function(sender){this.showGoldenBarrelLineupPopup()}.bind(this))));if(null!=this.m_main_item_icon){this.m_main_item_icon.setTag(this.m_main_item_data.event_dungeon_box_gacha_item_idx),(tooltip_btn=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(1,1,1,1)))).setAnchorPoint(ANCHOR_MIDDLE()),tooltip_btn.setPreferredSize(ccSize(this.m_main_item_icon)),tooltip_btn.setPosition(ccCenter(this.m_main_item_icon)),tooltip_btn.setTag(TOOLTIP_BTN_TAG),this.m_main_item_icon.addChild(tooltip_btn),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_DOWN),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_CANCEL);for(idx=gain_count=total_count=0;idx<item_list.length;idx++){(it=item_list[idx]).event_dungeon_period_idx==this.m_main_item_data.event_dungeon_period_idx&&it.event_dungeon_box_gacha_idx==this.m_main_item_data.event_dungeon_box_gacha_idx&&it.bonus_type==this.m_main_item_data.bonus_type&&it.main_bonus_type==this.m_main_item_data.main_bonus_type&&total_count++}for(var jdx=0;jdx<this.m_user_event_box_gacha_info.buy_log.length;jdx++){(item=mt.get_EventDungeonBoxGachaItemV2(this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_box_gacha_item_idx,this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_period_idx)).event_dungeon_period_idx==this.m_main_item_data.event_dungeon_period_idx&&item.event_dungeon_box_gacha_idx==this.m_main_item_data.event_dungeon_box_gacha_idx&&item.bonus_type==this.m_main_item_data.bonus_type&&item.main_bonus_type==this.m_main_item_data.main_bonus_type&&gain_count++}var remain=total_count-gain_count;this.m_main_item_count.setString(cmString(res_str("label_event_dungeon_box_gacha_remain_item_count_v2"),remain))}var sub_pos_list=[];sub_pos_list.push_back([394,270]),sub_pos_list.push_back([531,270]),sub_pos_list.push_back([394,136]),sub_pos_list.push_back([531,136]);for(var i=0;i<this.m_sub_main_item_icons.length;i++){(sub_item=this.m_sub_main_item_icons[i]).removeFromParent()}this.m_sub_main_item_icons=[];for(i=0;i<this.m_sub_main_items.length;i++){var sub=this.m_sub_main_items[i];if(i<sub_pos_list.length){var tooltip_btn,pos=sub_pos_list.at(i),sub_item=null;(sub_item=sub.bonus_type==BONUS_TYPE_YUNHEE_FIX?cc.Sprite.create(cmString("#img_reward_%02d_%d.png",parseInt(sub.bonus_type),parseInt(sub.min_value))):cc.Sprite.create(cmString("#img_reward_%02d.png",parseInt(sub.bonus_type)))).setAnchorPoint(ANCHOR_MIDDLE()),sub_item.setPosition(pos[0],pos[1]),parent.addChild(sub_item),sub_item.setTag(sub.event_dungeon_box_gacha_item_idx),(tooltip_btn=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(1,1,1,1)))).setAnchorPoint(ANCHOR_MIDDLE()),tooltip_btn.setPreferredSize(ccSize(sub_item)),tooltip_btn.setPosition(ccCenter(sub_item)),tooltip_btn.setTag(TOOLTIP_BTN_TAG),sub_item.addChild(tooltip_btn),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_DOWN),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_CANCEL);var cnt_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161);cnt_label.setAnchorPoint(ANCHOR_MIDDLE_TOP()),cnt_label.setPosition(ccCenter(sub_item).x,-25),cnt_label.setTag(COUNT_LABEL_TAG),sub_item.addChild(cnt_label);for(idx=gain_count=total_count=0;idx<item_list.length;idx++){var it;(it=item_list[idx]).event_dungeon_period_idx==sub.event_dungeon_period_idx&&it.event_dungeon_box_gacha_idx==sub.event_dungeon_box_gacha_idx&&it.bonus_type==sub.bonus_type&&it.main_bonus_type==sub.main_bonus_type&&total_count++}for(jdx=0;jdx<this.m_user_event_box_gacha_info.buy_log.length;jdx++){var item;(item=mt.get_EventDungeonBoxGachaItemV2(this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_box_gacha_item_idx,this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_period_idx)).event_dungeon_period_idx==sub.event_dungeon_period_idx&&item.event_dungeon_box_gacha_idx==sub.event_dungeon_box_gacha_idx&&item.bonus_type==sub.bonus_type&&item.main_bonus_type==sub.main_bonus_type&&gain_count++}remain=total_count-gain_count;cnt_label.setString(cmString(res_str("label_event_dungeon_box_gacha_remain_item_count_v2"),remain)),this.m_sub_main_item_icons.push_back(sub_item)}}remain=item_list.length-this.m_user_event_box_gacha_info.buy_log.length;this.m_gacha_count_label.setString(cmString("%d/%d",remain,item_list.length)),this.m_gacha_count_title.setPositionX(this.m_gacha_count_label.getPositionX()-ccWidth(this.m_gacha_count_label)-10),this.m_event_point_label.setString(cmString(res_str("label_event_dungeon_point_count_v2"),Number(this.m_event_dungeon_point.event_point).toLocaleString()));var cost_list=m.get_EventDungeonBoxGachaCostInfoListV2(cur_box_gacha.event_dungeon_period_idx,cur_box_gacha.event_dungeon_box_gacha_idx);this.m_cost_label.setString(cmString("%sM",Number(cost_list[0].need_point).toLocaleString())),this.m_btn.addClickEventListener(function(sender){this.reqBoxGachaV2(cost_list[0].event_dungeon_box_gacha_cost_info_idx)}.bind(this)),this.m_cost_label1.setString(cmString("%sM",Number(cost_list[1].need_point).toLocaleString())),this.m_btn1.addClickEventListener(function(sender){this.reqBoxGachaV2(cost_list[1].event_dungeon_box_gacha_cost_info_idx)}.bind(this)),this.m_cost_label2.setString(cmString("%sM",Number(cost_list[2].need_point).toLocaleString())),this.m_btn2.addClickEventListener(function(sender){this.reqBoxGachaV2(cost_list[2].event_dungeon_box_gacha_cost_info_idx)}.bind(this))},resetLeftBox:function(){for(var m=MasterManager.getInstance(),mt=MasterTable.getInstance(),box_gacha_list=(EventDungeonService.getInstance(),mt.get_EventDungeonBoxGachaV2List(this.m_period.event_dungeon_point_period_idx)),is_selected=!1,i=0;i<box_gacha_list.length;i++){var box_info=box_gacha_list[i];if(is_selected=!1,i<this.m_box_gacha_proc.length){var img=this.m_box_gacha_proc[i];if(box_info.event_dungeon_box_gacha_idx==this.m_user_event_box_gacha_info.event_dungeon_box_gacha_idx&&box_info.event_dungeon_period_idx==this.m_user_event_box_gacha_info.event_dungeon_period_idx){var image=RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_box_%d_off.png",parseInt(this.m_period.event_dungeon_group_idx),i+1),frame_texture=cc.textureCache.addImage(image),frame=new cc.SpriteFrame(frame_texture,cc.rect(0,0,frame_texture.getContentSize().width,frame_texture.getContentSize().height));img.setSpriteFrame(frame),is_selected=!0}else{image=RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_box_%d_none.png",parseInt(this.m_period.event_dungeon_group_idx),i+1),frame_texture=cc.textureCache.addImage(image);var frame1=new cc.SpriteFrame(frame_texture,cc.rect(0,0,frame_texture.getContentSize().width,frame_texture.getContentSize().height));img.setSpriteFrame(frame1),is_selected=!1}var selected_img=img.getChildByTag(SELECTED_IMAGE_TAG);null!=selected_img&&selected_img.setVisible(is_selected)}}var cur_box_gacha=m.get_EventDungeonBoxGachaV2(this.m_user_event_box_gacha_info.event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.event_dungeon_period_idx),next_box_gacha=m.get_EventDungeonBoxGachaV2(cur_box_gacha.next_box_gacha_idx,cur_box_gacha.event_dungeon_period_idx);cur_box_gacha.name==next_box_gacha.name?(this.m_next_box_gacha_btn.setString(cmString(res_str("label_event_dungeon_ed_box_reset_btn"),next_box_gacha.name)),this.m_next_box_gacha_btn_dis.setString(cmString(res_str("label_event_dungeon_ed_box_reset_btn"),next_box_gacha.name))):(this.m_next_box_gacha_btn.setString(cmString(res_str("label_event_dungeon_gacha_next_box_move"),next_box_gacha.name)),this.m_next_box_gacha_btn_dis.setString(cmString(res_str("label_event_dungeon_gacha_next_box_move"),next_box_gacha.name))),this.checkEnableResetBtn()},resetRightBox_SP:function(){var m=MasterTable.getInstance(),mt=MasterManager.getInstance(),total_count=0,gain_count=0,cur_box_gacha=mt.get_EventDungeonBoxGachaV2(this.m_user_event_box_gacha_info.event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.event_dungeon_period_idx);"BOX 1"==cur_box_gacha.name?this.m_gacha_title.setTexture(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_box_text_1.png",this.m_period.event_dungeon_group_idx)):"BOX 2"==cur_box_gacha.name?this.m_gacha_title.setTexture(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_box_text_2.png",this.m_period.event_dungeon_group_idx)):"BOX 3"==cur_box_gacha.name?this.m_gacha_title.setTexture(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_box_text_3.png",this.m_period.event_dungeon_group_idx)):"EX BOX"==cur_box_gacha.name&&this.m_gacha_title.setTexture(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_box_text_4.png",this.m_period.event_dungeon_group_idx)),this.m_content_view_btn.setString(cmString(res_str("label_event_dungeon_box_gacha_lineup_btn"),cur_box_gacha.name));var item_list=m.get_EventDungeonBoxGachaItemListV2(cur_box_gacha.event_dungeon_period_idx,cur_box_gacha.event_dungeon_box_gacha_idx);this.m_sub_main_items=[];for(var idx=0;idx<item_list.length;idx++){1==(item=item_list[idx]).main_bonus_type?this.m_main_item_data=item:2==item.main_bonus_type&&9999!=item.display_id&&this.m_sub_main_items.push(item)}this.m_sub_main_items.sort(function(l,r){return l.display_id>r.display_id?1:l.display_id<r.display_id?-1:0});var parent=this.m_main_item_icon.getParent();if(null!=parent&&(this.m_main_item_icon.removeFromParentAndCleanup(!0),this.m_main_item_icon=null),this.m_main_item_data.bonus_type==BONUS_TYPE_YUNHEE_FIX){var card=new Card;card.gnrl_id=this.m_main_item_data.min_value,card.level=1,this.m_main_item_icon=(new Card).createCard(card,CARD_TYPE.type_common_card),this.m_main_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_main_item_icon.setPosition(639,303),this.addChild(this.m_main_item_icon,10)}else this.m_main_item_data.bonus_type==BONUS_TYPE_GOLDEN_BARREL&&(this.m_main_item_icon=cc.Sprite.create(cmString("#img_reward_%d_d.png",this.m_main_item_data.bonus_type)),this.m_main_item_icon.setContentSize(140,140),this.m_main_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_main_item_icon.setPosition(639,303),this.m_main_item_icon.setScale(.8),this.addChild(this.m_main_item_icon,10),null==this.m_golden_barrel_help_btn&&(this.m_golden_barrel_help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_golden_barrel_help_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_golden_barrel_help_btn.setPosition(686,216),this.addChild(this.m_golden_barrel_help_btn,100),this.m_golden_barrel_help_btn.addClickEventListener(function(sender){this.showGoldenBarrelLineupPopup()}.bind(this))));if(null!=this.m_main_item_icon){this.m_main_item_icon.setTag(this.m_main_item_data.event_dungeon_box_gacha_item_idx),(tooltip_btn=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(1,1,1,1)))).setAnchorPoint(ANCHOR_MIDDLE()),tooltip_btn.setPreferredSize(ccSize(this.m_main_item_icon)),tooltip_btn.setPosition(ccCenter(this.m_main_item_icon)),tooltip_btn.setTag(TOOLTIP_BTN_TAG),this.m_main_item_icon.addChild(tooltip_btn,10),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_DOWN),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_CANCEL);for(idx=gain_count=total_count=0;idx<item_list.length;idx++){(it=item_list[idx]).event_dungeon_period_idx==this.m_main_item_data.event_dungeon_period_idx&&it.event_dungeon_box_gacha_idx==this.m_main_item_data.event_dungeon_box_gacha_idx&&it.bonus_type==this.m_main_item_data.bonus_type&&it.main_bonus_type==this.m_main_item_data.main_bonus_type&&total_count++}for(var jdx=0;jdx<this.m_user_event_box_gacha_info.buy_log.length;jdx++){(item=mt.get_EventDungeonBoxGachaItemV2(this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_box_gacha_item_idx,this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_period_idx)).event_dungeon_period_idx==this.m_main_item_data.event_dungeon_period_idx&&item.event_dungeon_box_gacha_idx==this.m_main_item_data.event_dungeon_box_gacha_idx&&item.bonus_type==this.m_main_item_data.bonus_type&&item.main_bonus_type==this.m_main_item_data.main_bonus_type&&gain_count++}var remain=total_count-gain_count;this.m_main_item_count.setString(cmString(res_str("label_event_dungeon_box_gacha_remain_item_count_v2"),remain))}var sub_pos_list=[];sub_pos_list.push_back([854,374]),sub_pos_list.push_back([991,374]),sub_pos_list.push_back([854,240]),sub_pos_list.push_back([991,240]);for(var i=0;i<this.m_sub_main_item_icons.length;i++){(sub_item=this.m_sub_main_item_icons[i]).removeFromParent()}this.m_sub_main_item_icons=[];for(i=0;i<this.m_sub_main_items.length;i++){var sub=this.m_sub_main_items[i];if(i<sub_pos_list.length){var tooltip_btn,pos=sub_pos_list.at(i),sub_item=null;(sub_item=sub.bonus_type==BONUS_TYPE_YUNHEE_FIX?cc.Sprite.create(cmString("#img_reward_%02d_%d.png",parseInt(sub.bonus_type),parseInt(sub.min_value))):cc.Sprite.create(cmString("#img_reward_%02d.png",parseInt(sub.bonus_type)))).setAnchorPoint(ANCHOR_MIDDLE()),sub_item.setPosition(pos[0],pos[1]),parent.addChild(sub_item),sub_item.setTag(sub.event_dungeon_box_gacha_item_idx),(tooltip_btn=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(1,1,1,1)))).setAnchorPoint(ANCHOR_MIDDLE()),tooltip_btn.setPreferredSize(ccSize(sub_item)),tooltip_btn.setPosition(ccCenter(sub_item)+300),tooltip_btn.setTag(TOOLTIP_BTN_TAG),sub_item.addChild(tooltip_btn,100),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_DOWN),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onItemToolTipTouch,cc.CONTROL_EVENT_TOUCH_CANCEL);var cnt_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161);cnt_label.setAnchorPoint(ANCHOR_MIDDLE_TOP()),cnt_label.setPosition(ccCenter(sub_item).x,-25),cnt_label.setTag(COUNT_LABEL_TAG),sub_item.addChild(cnt_label);for(idx=gain_count=total_count=0;idx<item_list.length;idx++){var it;(it=item_list[idx]).event_dungeon_period_idx==sub.event_dungeon_period_idx&&it.event_dungeon_box_gacha_idx==sub.event_dungeon_box_gacha_idx&&it.bonus_type==sub.bonus_type&&it.main_bonus_type==sub.main_bonus_type&&total_count++}for(jdx=0;jdx<this.m_user_event_box_gacha_info.buy_log.length;jdx++){var item;(item=mt.get_EventDungeonBoxGachaItemV2(this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_box_gacha_item_idx,this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_period_idx)).event_dungeon_period_idx==sub.event_dungeon_period_idx&&item.event_dungeon_box_gacha_idx==sub.event_dungeon_box_gacha_idx&&item.bonus_type==sub.bonus_type&&item.main_bonus_type==sub.main_bonus_type&&gain_count++}remain=total_count-gain_count;cnt_label.setString(cmString(res_str("label_event_dungeon_box_gacha_remain_item_count_v2"),remain)),this.m_sub_main_item_icons.push_back(sub_item)}}remain=item_list.length-this.m_user_event_box_gacha_info.buy_log.length;this.m_gacha_count_label.setString(cmString("%d/%d",remain,item_list.length)),this.m_gacha_count_title.setPositionX(this.m_gacha_count_label.getPositionX()-ccWidth(this.m_gacha_count_label)-10),this.m_event_point_label.setString(cmString(res_str("label_event_dungeon_point_count_v2"),Number(this.m_event_dungeon_point.event_point).toLocaleString()));var cost_list=m.get_EventDungeonBoxGachaCostInfoListV2(cur_box_gacha.event_dungeon_period_idx,cur_box_gacha.event_dungeon_box_gacha_idx);this.m_cost_label.setString(cmString("%sM",Number(cost_list[0].need_point).toLocaleString())),this.m_btn.addClickEventListener(function(sender){this.reqBoxGachaV2(cost_list[0].event_dungeon_box_gacha_cost_info_idx)}.bind(this)),this.m_cost_label1.setString(cmString("%sM",Number(cost_list[1].need_point).toLocaleString())),this.m_btn1.addClickEventListener(function(sender){this.reqBoxGachaV2(cost_list[1].event_dungeon_box_gacha_cost_info_idx)}.bind(this)),this.m_cost_label2.setString(cmString("%sM",Number(cost_list[2].need_point).toLocaleString())),this.m_btn2.addClickEventListener(function(sender){this.reqBoxGachaV2(cost_list[2].event_dungeon_box_gacha_cost_info_idx)}.bind(this))},resetLeftBox_SP:function(){for(var m=MasterManager.getInstance(),box_gacha_list=MasterTable.getInstance().get_EventDungeonBoxGachaV2List(this.m_period.event_dungeon_point_period_idx),is_selected=!1,i=0;i<box_gacha_list.length;i++){var box_info=box_gacha_list[i];if(is_selected=!1,i<this.m_box_gacha_proc.length){var img=this.m_box_gacha_proc[i];if(box_info.event_dungeon_box_gacha_idx==this.m_user_event_box_gacha_info.event_dungeon_box_gacha_idx&&box_info.event_dungeon_period_idx==this.m_user_event_box_gacha_info.event_dungeon_period_idx){var image=RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_box_%d_off.png",parseInt(this.m_period.event_dungeon_group_idx),i+1),frame_texture=cc.textureCache.addImage(image),frame=new cc.SpriteFrame(frame_texture,cc.rect(0,0,frame_texture.getContentSize().width,frame_texture.getContentSize().height));img.setSpriteFrame(frame),is_selected=!0}else{image=RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_box_%d_none.png",parseInt(this.m_period.event_dungeon_group_idx),i+1),frame_texture=cc.textureCache.addImage(image);var frame1=new cc.SpriteFrame(frame_texture,cc.rect(0,0,frame_texture.getContentSize().width,frame_texture.getContentSize().height));img.setSpriteFrame(frame1),is_selected=!1}var selected_img=img.getChildByTag(SELECTED_IMAGE_TAG);null!=selected_img&&selected_img.setVisible(is_selected)}}var cur_box_gacha=m.get_EventDungeonBoxGachaV2(this.m_user_event_box_gacha_info.event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.event_dungeon_period_idx),next_box_gacha=m.get_EventDungeonBoxGachaV2(cur_box_gacha.next_box_gacha_idx,cur_box_gacha.event_dungeon_period_idx);cur_box_gacha.name==next_box_gacha.name?(this.m_next_box_gacha_btn.setString(cmString(res_str("label_event_dungeon_ed_box_reset_btn"),next_box_gacha.name)),this.m_next_box_gacha_btn_dis.setString(cmString(res_str("label_event_dungeon_ed_box_reset_btn"),next_box_gacha.name))):(this.m_next_box_gacha_btn.setString(cmString(res_str("label_event_dungeon_gacha_next_box_move"),next_box_gacha.name)),this.m_next_box_gacha_btn_dis.setString(cmString(res_str("label_event_dungeon_gacha_next_box_move"),next_box_gacha.name))),this.checkEnableResetBtn()},checkEnableResetBtn:function(){for(var m=MasterTable.getInstance(),mt=MasterManager.getInstance(),cur_box_gacha=mt.get_EventDungeonBoxGachaV2(this.m_user_event_box_gacha_info.event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.event_dungeon_period_idx),item_list=m.get_EventDungeonBoxGachaItemListV2(cur_box_gacha.event_dungeon_period_idx,cur_box_gacha.event_dungeon_box_gacha_idx),total_count=0,gain_count=0,i=0;i<item_list.length;i++){var it=item_list[i];it.event_dungeon_period_idx==this.m_main_item_data.event_dungeon_period_idx&&it.event_dungeon_box_gacha_idx==this.m_main_item_data.event_dungeon_box_gacha_idx&&it.bonus_type==this.m_main_item_data.bonus_type&&it.main_bonus_type==this.m_main_item_data.main_bonus_type&&total_count++}for(var jdx=0;jdx<this.m_user_event_box_gacha_info.buy_log.length;jdx++){var item=mt.get_EventDungeonBoxGachaItemV2(this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_box_gacha_item_idx,this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.buy_log[jdx].event_dungeon_period_idx);item.event_dungeon_period_idx==this.m_main_item_data.event_dungeon_period_idx&&item.event_dungeon_box_gacha_idx==this.m_main_item_data.event_dungeon_box_gacha_idx&&item.bonus_type==this.m_main_item_data.bonus_type&&item.main_bonus_type==this.m_main_item_data.main_bonus_type&&gain_count++}total_count<=gain_count?(this.m_next_box_gacha_btn.setEnabled(!0),this.m_next_box_gacha_btn.setVisible(!0),this.m_next_box_gacha_btn_dis.setVisible(!1)):(this.m_next_box_gacha_btn.setEnabled(!1),this.m_next_box_gacha_btn.setVisible(!1),this.m_next_box_gacha_btn_dis.setVisible(!0))},showRecvItemListPopup:function(res){this.m_recv_item_list_popup.setContentSize(ccSize(this)),this.m_recv_item_list_popup._contentNode=function(contentSize,m){return new EventDungeonBoxGachaRecvItemPopupV2(res,this.hideRecvItemListPopup.bind(this))}.bind(this),this.m_recv_item_list_popup.show()},hideRecvItemListPopup:function(){RAID_BOSS_MODAL_OPEN_FLAG=!1,this.m_recv_item_list_popup.is_show()&&this.m_recv_item_list_popup.hide(),this.checkEpilogueOpen()},checkEpilogueOpen:function(){var m=MasterManager.getInstance();if(this.m_box_gacha_buy_result.event_dungeon_period_idx==this.m_first_event_period_idx&&"BOX 1"==m.get_EventDungeonBoxGachaV2(this.m_box_gacha_buy_result.event_dungeon_box_gacha_idx,this.m_box_gacha_buy_result.event_dungeon_period_idx).name){for(var is_enable_epilogue=!1,i=0;i<this.m_box_gacha_buy_result.buy_log.length;i++){var log=this.m_box_gacha_buy_result.buy_log[i];if(log.event_dungeon_period_idx==this.m_main_item_data.event_dungeon_period_idx&&log.event_dungeon_box_gacha_idx==this.m_main_item_data.event_dungeon_box_gacha_idx&&log.event_dungeon_box_gacha_item_idx==this.m_main_item_data.event_dungeon_box_gacha_item_idx){is_enable_epilogue=!0;break}}is_enable_epilogue&&this.m_is_prv_event_dungeon,0}},showNextBoxPopup:function(){var m=MasterManager.getInstance(),cur_box_gacha=m.get_EventDungeonBoxGachaV2(this.m_user_event_box_gacha_info.event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.event_dungeon_period_idx),next_box_gacha=m.get_EventDungeonBoxGachaV2(cur_box_gacha.next_box_gacha_idx,cur_box_gacha.event_dungeon_period_idx);cur_box_gacha.event_dungeon_box_gacha_idx!=next_box_gacha.event_dungeon_box_gacha_idx?(this.m_message_box.setTitle(res_str("label_shop_buy_jade_omission_title")),this.m_message_box.setText(res_str("label_event_dungeon_box_next_box_open_msg_1")),this.m_message_box.setText("\n"),this.m_message_box.setText(res_str("label_event_dungeon_box_next_box_open_msg_2")),this.m_message_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_cancel"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_message_box.hide()}.bind(this))),this.m_message_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(){this.reqNextBoxGachaV2()},.1,"reqNextBoxGachaV2"),this.m_message_box.hide(!1)}.bind(this))),this.m_message_box.show()):this.reqNextBoxGachaV2()},showEnableEpiloguePopup:function(){this.m_message_box.setTitle(res_str("label_event_dungeon_epilogue_title")),this.m_message_box.setText(res_str("label_event_dungeon_open_epilogue_message_1")),this.m_message_box.setText("\n"),this.m_message_box.setText(res_str("label_event_dungeon_open_epilogue_message_2")),this.m_message_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_message_box.hide()}.bind(this))),this.m_message_box.addButtonInfo(new MessageButtonInfo(res_str("label_shortcuts_move"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(){MainObserver.getInstance().postNotification(sceneStr[EventDungeonBoxGachaSceneV2],btn_epilogue_open_view)},.1,"open_epilogue"),this.m_message_box.hide(!1)}.bind(this))),this.m_message_box.show()},showGoldenBarrelLineupPopup:function(){this.m_golden_barrel_popup.setContentSize(ccSize(this)),this.m_golden_barrel_popup._contentNode=function(contentSize,m){return new EventDungeonBoxGachaGoldenBarrelPopupV2(this.m_user_event_box_gacha_info,this.hideGoldenBarrelLineupPopup.bind(this))}.bind(this),this.getParent().m_statusLayer.setStatusDisable(!0),this.m_golden_barrel_popup.show()},hideGoldenBarrelLineupPopup:function(){this.getParent().m_statusLayer.setStatusDisable(!1),this.m_golden_barrel_popup.is_show()&&this.m_golden_barrel_popup.hide()},showLineupPopup:function(){this.m_item_lineup_popup.setContentSize(ccSize(this)),this.m_item_lineup_popup._contentNode=function(contentSize,m){return new EventDungeonBoxGachaLineUpPopupV2(this.m_user_event_box_gacha_info,this.hideLineupPopup.bind(this))}.bind(this),this.m_item_lineup_popup.show()},hideLineupPopup:function(){this.m_item_lineup_popup.is_show()&&MainObserver.getInstance().postNotification(sceneStr[EventDungeonBoxGachaSceneV2],btn_box_gacha_lineup_popup_off)},hideLineupPopupV2:function(){this.m_item_lineup_popup.is_show()&&this.m_item_lineup_popup.hide()},showRewardItemEffectPopup:function(log,bonus){this.m_is_effect_layer_touch=!1,this.m_effect_popup.setContentSize(ccSize(this)),this.m_effect_popup._contentNode=function(contentSize,margin){var gacha_item=MasterManager.getInstance().get_EventDungeonBoxGachaItemV2(log.event_dungeon_box_gacha_item_idx,log.event_dungeon_box_gacha_idx,log.event_dungeon_period_idx);return 1!=gacha_item.main_bonus_type||gacha_item.bonus_type!=BONUS_TYPE_GOLDEN_BARREL?(this.getParent().m_statusLayer.setStatusDisable(!0),this.getParent().m_isLineupPopupShow=!0,this.getRewardItemEffectLayer(log,bonus)):this.getRewardGoldenBarrelEFfectLayer(log,bonus)}.bind(this),this.m_effect_popup.onItemTouchBegin=function(index){return!0},this.m_effect_popup.onItemTouchEnd=function(index){this.m_is_effect_layer_touch&&(AudioEngine.getInstance().stopEffectsAll(),this.m_is_effect_layer_touch=!1,this.m_effect_popup.hide(),this.getParent().m_statusLayer.setStatusDisable(!1),this.getParent().m_isLineupPopupShow=!1,this.checkEpilogueOpen())}.bind(this),this.m_effect_popup.show()},getRewardGoldenBarrelEFfectLayer:function(log,bonus){var layer=new cc.Layer,m=MasterManager.getInstance(),gacha_item=(cc.size(ccSize(layer)),m.get_EventDungeonBoxGachaItemV2(log.event_dungeon_box_gacha_item_idx,log.event_dungeon_box_gacha_idx,log.event_dungeon_period_idx)),img=cc.Sprite.create();img.setAnchorPoint(ANCHOR_MIDDLE()),img.setPosition(ccCenter(layer)),layer.addChild(img,1);var animation=new cc.Animation;if(gacha_item.bonus_type==BONUS_TYPE_GOLDEN_BARREL)for(var i=1;i<=12;i++)try{var frame=cc.spriteFrameCache.getSpriteFrame(cmString("effect_boxgacha_%d_large_%02d.png",gacha_item.bonus_type,i));animation.addSpriteFrame(frame)}catch(e){cc.log("gacha_item.bonus_type error :"+e)}else for(i=1;i<=8;i++)try{var frame1=cc.spriteFrameCache.getSpriteFrame(cmString("effect_boxgacha_%d_%02d.png",gacha_item.min_value,i));animation.addSpriteFrame(frame1)}catch(e){cc.log("gacha_item.bonus_type error :"+e)}animation.setDelayPerUnit(.08),animation.setRestoreOriginalFrame(!0);var animate=new cc.Animate(animation);return img.runAction(animate),this.scheduleOnce(function(){var effect_layer=this.getRewardItemEffectLayer(log,bonus);layer.addChild(effect_layer,2)},1,"getRewardItemEffectLayer"),layer},getRewardItemEffectLayer:function(log,bonus){var layer=new cc.Layer,m=MasterManager.getInstance(),winSize=cc.size(ccSize(layer)),audio=AudioEngine.getInstance();audio.playEffect(RES_CDN_SOUND+SND_TYPE+"sound/SE_all_win_popularity.mp3",!1),audio.playEffect(RES_CDN_SOUND+SND_TYPE+"sound/SE_gacha_back.mp3",!0);var back_effect=cc.Sprite.create("#img_attend_effect.png");back_effect.setPosition(ccCenter(layer)),layer.addChild(back_effect,1),back_effect.setScale(1.7);var action=new cc.RotateBy(1,180),repeat=new cc.RepeatForever(action);back_effect.runAction(repeat);var bonus_icon=cc.Sprite.create();bonus_icon.setPosition(ccCenter(layer)),layer.addChild(bonus_icon,1);var bonus_name_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_503);bonus_name_label.setAnchorPoint(ANCHOR_MIDDLE_TOP()),bonus_name_label.enableOutline(cc.color.BLACK,3),bonus_name_label.setPosition(.5*winSize.width,winSize.height-180),layer.addChild(bonus_name_label,1);var count=0;if(bonus.bonus_type==BONUS_TYPE_YUNHEE_FIX){var general=m.get_General(bonus.bonus_idx),frame=cc.spriteFrameCache.getSpriteFrame("img_reward_"+leadingZeros(bonus.bonus_idx,2)+"_d.png");bonus_icon.setSpriteFrame(frame),bonus_name_label.setString(general.name),count=bonus.bonus_level}else if(bonus.bonus_type==BONUS_TYPE_EQUIPMENT){var b=m.get_BonusType(bonus.bonus_type),equip=m.get_EquipmentItem(bonus.equipment.equipment_item_idx);frame=cc.spriteFrameCache.getSpriteFrame("img_reward_"+leadingZeros(b.bonus_type,2)+"_d.png");bonus_icon.setSpriteFrame(frame),bonus_name_label.setString(equip.name),count=1}else{b=m.get_BonusType(bonus.bonus_type),frame=cc.spriteFrameCache.getSpriteFrame("img_reward_"+leadingZeros(bonus.bonus_type,2)+"_d.png");bonus_icon.setSpriteFrame(frame),bonus_name_label.setString(b.name),count=bonus.bonus_idx}var bonus_count_label=cmLabel.getLabel(cmString("x %s",Number(count).toLocaleString("en")),LABEL_FONT_INDEX.FONT_503);bonus_count_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bonus_count_label.enableOutline(cc.color.BLACK,3),bonus_count_label.setPosition(.5*winSize.width,180),layer.addChild(bonus_count_label,1);var boss=cc.Sprite.create(RES_CDN_DEFULT+cmString("card_war_boss/%d.png",BOX_GACHA_GNRL_GROUP));return boss.setScale(2),boss.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),boss.setPosition(winSize.width,0),layer.addChild(boss),this.scheduleOnce(function(float){this.m_is_effect_layer_touch=!0}.bind(this),1,"showEffectLayer"),layer},onItemToolTipTouch:function(sender,_event){if(_event==cc.CONTROL_EVENT_TOUCH_DOWN){var parent=sender.getParent();if(null!=parent){var tag=parent.getTag();0!=tag&&this.showTooltip(parent,tag)}}else this.hideTooltip()},showTooltip:function(parent,event_dungeon_box_gacha_item_idx){var winSize=cc.size(ccSize(this)),item_data=MasterManager.getInstance().get_EventDungeonBoxGachaItemV2(event_dungeon_box_gacha_item_idx,this.m_user_event_box_gacha_info.event_dungeon_box_gacha_idx,this.m_user_event_box_gacha_info.event_dungeon_period_idx);this.m_tooltip_box.setVisible(!0),this.m_tooltip_content.setString(item_data.tooltip);var bSize=cc.size(0,0);if(bSize.width=Math.max(64,ccWidth(this.m_tooltip_content)+20),bSize.height=Math.max(54,ccHeight(this.m_tooltip_content)+20),this.m_tooltip_box.setPreferredSize(bSize),this.m_tooltip_content.setPosition(ccCenter(bSize)),IS_SP_BROWSER){if((pos=parent.getPosition()).y+=.5*bSize.height+47,pos.x+.5*bSize.width+10>winSize.width){var left=winSize.width-(pos.x+.5*bSize.width+10);pos.x-=left}if(pos.y+.5*bSize.height>winSize.height-55){var top=pos.y+.5*bSize.height-(winSize.height-55-20);pos.y-=top}}else{var pos;if((pos=parent.getPosition()).y+=.5*bSize.height+147,pos.x+.5*bSize.width+10>winSize.width){left=winSize.width-(pos.x+.5*bSize.width+10);pos.x-=left}if(pos.y+.5*bSize.height>winSize.height-55){top=pos.y+.5*bSize.height-(winSize.height-55-20);pos.y-=top}}this.m_tooltip_box.setPosition(pos)},hideTooltip:function(){this.m_tooltip_box.setVisible(!1)}}),EventDungeonBoxGachaLineUpCellV2=cc.TableViewCell.extend({m_item_count:null,m_item_title:null,m_item_icon:null,m_icon_frame:null,m_equip_jewelry:null,m_equip_step:null,m_showtootip:null,m_item_data:[],ctor:function(_cb_tooltip){this._super(),this.init(_cb_tooltip)},init:function(_cb_tooltip){this.m_showtootip=_cb_tooltip;var cellSize=cc.size(444,78);this.setContentSize(cellSize);var box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",cc.Rect(20,20,20,20));return box.setPreferredSize(cellSize),box.setAnchorPoint(ZERO()),box.setPosition(ZERO()),this.addChild(box),this.m_icon_frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png"),this.m_icon_frame.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_icon_frame.setPosition(4,.5*cellSize.height),box.addChild(this.m_icon_frame),this.m_item_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2013),this.m_item_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_item_title.setPosition(80,43),box.addChild(this.m_item_title),this.m_item_count=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.m_item_count.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_item_count.setPosition(80,16),box.addChild(this.m_item_count),this.m_equip_jewelry=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_144),this.m_equip_jewelry.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_equip_jewelry.setPosition(cellSize.width-10,13),box.addChild(this.m_equip_jewelry),DISABLE_SPB_TP?this.m_equip_step=cc.Sprite.create(RES_CDN_DEFULT+"menu_equip/img_equip_text_plus.png"):this.m_equip_step=cc.Sprite.create("#img_equip_text_plus.png"),this.m_equip_step.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_equip_step.setPosition(72,73),box.addChild(this.m_equip_step),!0},setData:function(data){this.m_item_data=data,this.updateCell(this.m_item_data)},updateCell:function(data){var m=MasterManager.getInstance();if(null!=this.m_item_icon&&this.m_item_icon.getParent()&&(this.m_item_icon.removeFromParentAndCleanup(!0),this.m_item_icon=null),this.m_equip_jewelry.setVisible(!1),this.m_equip_step.setVisible(!1),data.item.bonus_type==BONUS_TYPE_YUNHEE_FIX){(card=new db.CardInfo).gnrl_id=data.item.min_value,this.m_item_icon=(new Card).createCard(card,CARD_TYPE.type_card_thumb);var gnrl=m.get_General(data.item.min_value);this.m_item_title.setString(gnrl.name+" x"+data.item.max_value),cmLabel.autoSizeFit(this.m_item_title,350,20)}else if(data.item.bonus_type==BONUS_TYPE_EQUIPMENT){var card,arm_service_type=0,equip=m.get_EquipmentItem(data.item.min_value);101==equip.arm_service_idx&&(arm_service_type=ARMSERVICETYPE_INFANTRY),102==equip.arm_service_idx&&(arm_service_type=ARMSERVICETYPE_SPEAR),103==equip.arm_service_idx&&(arm_service_type=ARMSERVICETYPE_ARCHER),(card={}).equip_id=equip.equipment_item_idx,card.arm_service_type=arm_service_type,card.equip_parts_type=equip.equipment_parts_type,card.equip_rare_type=equip.equipment_rare_type,card.equip_type=equip.equipment_type,card.image=equip.img,card.is_equip=!1,card.is_lock=!1,card.level=1,card.equip_group=equip.equip_group_idx,card.property_img=equip.property_img,card.is_same_gnrl_group=!1;var step_list=[];if((card.gnrl_group=0)!=equip.equip_step_idx&&0<(step_list=m.get_EquipmentStepRateList(equip.equip_step_idx)).length&&(card.step=step_list[0].step),1==data.item.main_bonus_type){this.m_item_icon=CardEquipment.getInstance().createCardEquipment(card,EQUIPMENT_CARD_TYPE.type_card_small_ficto);for(var option_idx=step_list[0].option1_idx,option_list=MasterTable.getInstance().get_EquipmentItemOptionList(option_idx),name="",equip_name=equip.name,index=0,i=0;i<option_list.length;i++){name+=option_list[i].equip_name+equip_name,index++,option_list.length>index&&(name+="/")}this.m_item_title.setString(name+" x"+data.item.max_value),cmLabel.autoSizeFit(this.m_item_title,350,20)}else this.m_item_icon=CardEquipment.getInstance().createCardEquipment(card,EQUIPMENT_CARD_TYPE.type_card_common),this.m_item_icon.setScale(.65),5!=card.step&&this.m_equip_step.setVisible(!0),this.m_item_title.setString(equip.name+" x"+data.item.max_value),cmLabel.autoSizeFit(this.m_item_title,350,20);if(equip.equipment_parts_type==EQUIPMENT_JEWELRY&&5==card.step){this.m_equip_jewelry.setVisible(!0);var comba_stat_idx=equip.equip_step_idx%10,combo_stat=m.get_ComboStat(comba_stat_idx);this.m_equip_jewelry.setString(cmString("%s : %s",res_str("label_equipment_box_gacha_jewelry_status"),combo_stat.name))}}else{this.m_item_icon=cc.Sprite.create(cmString("#img_reward_%02d.png",data.item.bonus_type));var bonus=m.get_BonusType(data.item.bonus_type);this.m_item_title.setString(bonus.name+" x"+data.item.min_value),cmLabel.autoSizeFit(this.m_item_title,350,20)}this.m_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),data.item.bonus_type==BONUS_TYPE_YUNHEE_FIX?this.m_item_icon.setPosition(25,25):this.m_item_icon.setPosition(ccCenter(this.m_icon_frame)),this.m_icon_frame.addChild(this.m_item_icon);var remain_count=data.total_count-data.gain_count;this.m_item_count.setString(cmString(res_str("label_event_dungeon_box_gacha_count"),remain_count,data.total_count))},highlightPosInCell:function(pos){var r=this.m_icon_frame.getBoundingBox();cc.rectContainsPoint(r,pos)&&null!=this.m_showtootip&&this.m_showtootip(this.m_item_data,this.getTouchTablePos())}}),EventDungeonBoxGachaLineUpPopupV2=cc.Layer.extend({m_table_view:null,m_close_callback:null,tooltip_box:null,tooltip_content:null,m_box_gacha_info:null,m_lineup_data_list:[],ctor:function(box_gacha_info,_close_callback){this._super(),this.init(box_gacha_info,_close_callback)},init:function(box_gacha_info,_close_callback){this.m_close_callback=_close_callback,this.m_box_gacha_info=box_gacha_info;var m=MasterTable.getInstance(),mt=MasterManager.getInstance(),item_list=m.get_EventDungeonBoxGachaItemListV2(this.m_box_gacha_info.event_dungeon_period_idx,this.m_box_gacha_info.event_dungeon_box_gacha_idx);this.m_lineup_data_list=[];for(var i=0;i<item_list.length;i++){if(9999!=(item=item_list[i]).display_id){var data={};data.item=item,data.total_count=0,data.gain_count=0,this.m_lineup_data_list.push(data)}}for(var j=0;j<this.m_lineup_data_list.length;j++)for(var k=0;k<item_list.length;k++){var item=item_list[k];this.m_lineup_data_list[j].item.bonus_type==item.bonus_type&&this.m_lineup_data_list[j].item.min_value==item.min_value&&(this.m_lineup_data_list[j].total_count+=1)}for(var idx=0;idx<this.m_lineup_data_list.length;idx++)for(var jdx=0;jdx<this.m_box_gacha_info.buy_log.length;jdx++){item=this.m_box_gacha_info.buy_log[jdx];var d=mt.get_EventDungeonBoxGachaItemV2(item.event_dungeon_box_gacha_item_idx,item.event_dungeon_box_gacha_idx,item.event_dungeon_period_idx);this.m_lineup_data_list[idx].item.bonus_type==d.bonus_type&&this.m_lineup_data_list[idx].item.min_value==d.min_value&&(this.m_lineup_data_list[idx].gain_count+=1)}this.m_lineup_data_list=stable(this.m_lineup_data_list,function(l,r){return l.item.display_id>r.item.display_id});var winSize=ccSize(this),boxSize=(cc.Rect(40,40,10,10),cc.size(478,541)),box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),box.setPreferredSize(cc.size(478,541)),box.setPosition(.5*winSize.width,10),this.addChild(box);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(box).x,ccHeight(box)-11),box.addChild(navi);var navi_title=cmLabel.getLabel(res_str("label_equipment_box_gacha_item_list_title"),LABEL_FONT_INDEX.FONT_261);navi_title.setAnchorPoint(ANCHOR_MIDDLE()),navi_title.setPosition(ccCenter(navi).x,ccCenter(navi).y+3),navi.addChild(navi_title);var btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);btn.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),btn.setPosition(ccWidth(navi)-16,ccCenter(navi).y+2),btn.addClickEventListener(function(sender){null!=this.m_close_callback&&this.m_close_callback()}.bind(this)),navi.addChild(btn);var tableSize=cc.size(444,boxSize.height-90);return this.m_table_view=new cc.TableView(this,tableSize),this.m_table_view.ignoreAnchorPointForPosition(!1),this.m_table_view.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_table_view.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_table_view.scrollBarEnable(!0),this.m_table_view.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_table_view.setPosition(17,18),box.addChild(this.m_table_view),this.m_table_view.setDelegate(this),this.m_table_view.reloadData(),this.tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.tooltip_box.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.tooltip_box.setPosition(ZERO()),this.tooltip_box.setVisible(!1),box.addChild(this.tooltip_box,100),this.tooltip_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.tooltip_content.setAnchorPoint(ANCHOR_MIDDLE()),this.tooltip_content.setPosition(ccCenter(this.tooltip_box)),this.tooltip_box.addChild(this.tooltip_content),!0},tableCellSizeForIndex:function(table,idx){return cc.size(444,78)},cellSizeForTable:function(table){return cc.size(444,78)},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;return(cell=null!=c?c:new EventDungeonBoxGachaLineUpCellV2(this.showTooltip.bind(this))).setData(this.m_lineup_data_list[idx]),cell},numberOfCellsInTableView:function(table){return this.m_lineup_data_list.length},tableCellTouched:function(table,cell){},tableCellHighlight:function(table,cell){null!=cell&&cell.highlightPosInCell(cell.getTouchPos())},tableCellUnhighlight:function(table,cell){this.hideTooltip()},tableCellEnded:function(){},tableCellSelectedCallback:function(){},showTooltip:function(data,pos){var winSize=ccSize(this);this.tooltip_box.setVisible(!0),this.tooltip_content.setString(data.item.tooltip);var cSize=ccSize(this.tooltip_content),width=Math.max(64,cSize.width+20),height=Math.max(54,cSize.height+20),bSize=cc.size(width,height);this.tooltip_box.setPreferredSize(bSize),this.tooltip_content.setPosition(ccCenter(bSize));var t_pos=this.m_table_view.getPosition();if(t_pos.y+=pos.y,t_pos.y+.5*bSize.height>winSize.height-55){var top=t_pos.y+.5*bSize.height-(winSize.height-55-20);t_pos.y-=top}this.tooltip_box.setPosition(t_pos.x+80,t_pos.y)},hideTooltip:function(){this.tooltip_box.setVisible(!1)}}),EventDungeonBoxGachaRecvItemCellV2=cc.TableViewCell.extend({m_item_desc:null,cellSize:null,ctor:function(){this._super(),this.init()},init:function(){return this.cellSize=cc.size(440,50),this.setContentSize(this.cellSize),!0},setData:function(data){this.updateCell(data)},updateCell:function(data){var m=MasterManager.getInstance();if(0!=data.castle_id)if(2==data.castle_id)if("EX BOX"==m.get_EventDungeonBoxGachaV2(data.event_dungeon_box_gacha_idx,data.event_dungeon_period_idx).name){var main=m.get_BonusType(BONUS_TYPE_GOLDEN_BARREL);if(data.bonus_type==BONUS_TYPE_YUNHEE_FIX){null!=this.m_item_desc&&null!=this.m_item_desc.getParent()&&(this.removeChild(this.m_item_desc),this.m_item_desc=null);var gnrl=m.get_General(data.bonus_idx);this.m_item_desc=cmLabel.getLabel(cmString(res_str("label_event_dungeon_box_gacha_recv_main_item"),main.name,gnrl.name,data.bonus_count),LABEL_FONT_INDEX.FONT_227),this.m_item_desc.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_desc.setPosition(ccCenter(this.cellSize)),this.addChild(this.m_item_desc)}else if(data.bonus_type==BONUS_TYPE_EQUIPMENT){null!=this.m_item_desc&&null!=this.m_item_desc.getParent()&&(this.removeChild(this.m_item_desc),this.m_item_desc=null);var equip=m.get_EquipmentItem(data.bonus_idx);this.m_item_desc=cmLabel.getLabel(cmString(res_str("label_event_dungeon_box_gacha_recv_main_item"),main.name,equip.name,data.bonus_count),LABEL_FONT_INDEX.FONT_227),this.m_item_desc.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_desc.setPosition(ccCenter(this.cellSize)),this.addChild(this.m_item_desc)}else{var bonus=m.get_BonusType(data.bonus_type);null!=this.m_item_desc&&null!=this.m_item_desc.getParent()&&(this.removeChild(this.m_item_desc),this.m_item_desc=null),this.m_item_desc=cmLabel.getLabel(cmString(res_str("label_event_dungeon_box_gacha_recv_main_item"),main.name,bonus.name,data.bonus_count),LABEL_FONT_INDEX.FONT_227),this.m_item_desc.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_desc.setPosition(ccCenter(this.cellSize)),this.addChild(this.m_item_desc)}}else if(data.bonus_type==BONUS_TYPE_YUNHEE_FIX){null!=this.m_item_desc&&null!=this.m_item_desc.getParent()&&(this.removeChild(this.m_item_desc),this.m_item_desc=null);gnrl=m.get_General(data.bonus_idx);this.m_item_desc=cmLabel.getLabel(cmString(res_str("label_event_dungeon_box_gacha_recv_accent_item"),gnrl.name,data.bonus_count),LABEL_FONT_INDEX.FONT_227),this.m_item_desc.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_desc.setPosition(ccCenter(this.cellSize)),this.addChild(this.m_item_desc)}else if(data.bonus_type==BONUS_TYPE_EQUIPMENT){null!=this.m_item_desc&&null!=this.m_item_desc.getParent()&&(this.removeChild(this.m_item_desc),this.m_item_desc=null);equip=m.get_EquipmentItem(data.bonus_idx);this.m_item_desc=cmLabel.getLabel(cmString(res_str("label_event_dungeon_box_gacha_recv_accent_item"),equip.name,data.bonus_count),LABEL_FONT_INDEX.FONT_227),this.m_item_desc.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_desc.setPosition(ccCenter(this.cellSize)),this.addChild(this.m_item_desc)}else{bonus=m.get_BonusType(data.bonus_type);null!=this.m_item_desc&&null!=this.m_item_desc.getParent()&&(this.removeChild(this.m_item_desc),this.m_item_desc=null),this.m_item_desc=cmLabel.getLabel(cmString(res_str("label_event_dungeon_box_gacha_recv_accent_item"),bonus.name,data.bonus_count),LABEL_FONT_INDEX.FONT_227),this.m_item_desc.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_desc.setPosition(ccCenter(this.cellSize)),this.addChild(this.m_item_desc)}else if(data.bonus_type==BONUS_TYPE_YUNHEE_FIX){null!=this.m_item_desc&&null!=this.m_item_desc.getParent()&&(this.removeChild(this.m_item_desc),this.m_item_desc=null);gnrl=m.get_General(data.bonus_idx);this.m_item_desc=cmLabel.getLabel(cmString(res_str("label_event_dungeon_box_gacha_recv_accent_item"),gnrl.name,data.bonus_count),LABEL_FONT_INDEX.FONT_227),this.m_item_desc.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_desc.setPosition(ccCenter(this.cellSize)),this.addChild(this.m_item_desc)}else if(data.bonus_type==BONUS_TYPE_EQUIPMENT){if(data.bonus_type==BONUS_TYPE_YUNHEE_FIX){null!=this.m_item_desc&&null!=this.m_item_desc.getParent()&&(this.removeChild(this.m_item_desc),this.m_item_desc=null);equip=m.get_EquipmentItem(data.bonus_idx);this.m_item_desc=cmLabel.getLabel(cmString(res_str("label_event_dungeon_box_gacha_recv_accent_item"),equip.name,data.bonus_count),LABEL_FONT_INDEX.FONT_227),this.m_item_desc.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_desc.setPosition(ccCenter(this.cellSize)),this.addChild(this.m_item_desc)}}else{null!=this.m_item_desc&&null!=this.m_item_desc.getParent()&&(this.removeChild(this.m_item_desc),this.m_item_desc=null);bonus=m.get_BonusType(data.bonus_type);this.m_item_desc=cmLabel.getLabel(cmString(res_str("label_event_dungeon_box_gacha_recv_accent_item"),bonus.name,data.bonus_count),LABEL_FONT_INDEX.FONT_227),this.m_item_desc.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_desc.setPosition(ccCenter(this.cellSize)),this.addChild(this.m_item_desc)}else if(data.bonus_type==BONUS_TYPE_YUNHEE_FIX){gnrl=m.get_General(data.bonus_idx);null!=this.m_item_desc&&null!=this.m_item_desc.getParent()&&(this.removeChild(this.m_item_desc),this.m_item_desc=null),this.m_item_desc=cmLabel.getLabel(cmString(res_str("label_event_dungeon_box_gacha_recv_item"),gnrl.name,data.bonus_count),LABEL_FONT_INDEX.FONT_221),this.m_item_desc.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_desc.setPosition(ccCenter(this.cellSize)),this.addChild(this.m_item_desc)}else if(data.bonus_type==BONUS_TYPE_EQUIPMENT){equip=m.get_EquipmentItem(data.bonus_idx);null!=this.m_item_desc&&null!=this.m_item_desc.getParent()&&(this.removeChild(this.m_item_desc),this.m_item_desc=null),this.m_item_desc=cmLabel.getLabel(cmString(res_str("label_event_dungeon_box_gacha_recv_item"),equip.name,data.bonus_count),LABEL_FONT_INDEX.FONT_221),this.m_item_desc.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_desc.setPosition(ccCenter(this.cellSize)),this.addChild(this.m_item_desc)}else if(data.bonus_type==BONUS_TYPE_HR_RARE_TYPE_ENGAGE||data.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE||data.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||data.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||data.bonus_type==BONUS_TYPE_JADE||data.bonus_type==BONUS_TYPE_EVOLVE_ORB||data.bonus_type==BONUS_TYPE_SR_RARE_TYPE_ENGAGE||data.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||data.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){bonus=m.get_BonusType(data.bonus_type);null!=this.m_item_desc&&null!=this.m_item_desc.getParent()&&(this.removeChild(this.m_item_desc),this.m_item_desc=null),this.m_item_desc=cmLabel.getLabel(cmString(res_str("label_event_dungeon_box_gacha_recv_accent_item"),bonus.name,data.bonus_count),LABEL_FONT_INDEX.FONT_227),this.m_item_desc.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_desc.setPosition(ccCenter(this.cellSize)),this.addChild(this.m_item_desc)}else{bonus=m.get_BonusType(data.bonus_type);null!=this.m_item_desc&&null!=this.m_item_desc.getParent()&&(this.removeChild(this.m_item_desc),this.m_item_desc=null),this.m_item_desc=cmLabel.getLabel(cmString(res_str("label_event_dungeon_box_gacha_recv_item"),bonus.name,data.bonus_count),LABEL_FONT_INDEX.FONT_221),this.m_item_desc.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_desc.setPosition(ccCenter(this.cellSize)),this.addChild(this.m_item_desc)}cmLabel.autoSizeFit(this.m_item_desc,430,22)}}),EventDungeonBoxGachaRecvItemPopupV2=cc.Layer.extend({m_close_callback:null,m_table_view:null,m_recv_item_list:[],ctor:function(res_2,_close_callback){this._super(),this.m_recv_item_list=[],this.init(res_2,_close_callback)},init:function(res_2,_close_callback){this.m_close_callback=_close_callback;cc.Rect(40,40,10,10);var boxSize=cc.size(478,541),winSize=ccSize(this),box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),box.setPreferredSize(cc.size(478,541)),box.setPosition(.5*winSize.width,10),this.addChild(box);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(box).x,ccHeight(box)-11),box.addChild(navi);var navi_title=cmLabel.getLabel(res_str("label_event_dungeon_box_gacha_item_list_title"),LABEL_FONT_INDEX.FONT_261);navi_title.setAnchorPoint(ANCHOR_MIDDLE()),navi_title.setPosition(ccCenter(navi).x,ccCenter(navi).y+3),navi.addChild(navi_title);var btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);btn.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),btn.setPosition(ccWidth(navi)-16,ccCenter(navi).y+2),btn.addClickEventListener(function(sender){null!=this.m_close_callback&&this.m_close_callback()}.bind(this)),navi.addChild(btn);for(var is_gain_main_item=!1,i=0;i<res_2.reward_items.length;i++){for(var item=res_2.reward_items[i],found=!1,foundIdx=0,idx=0;idx<this.m_recv_item_list.length;idx++){var d=this.m_recv_item_list[idx];if(item.bonus_type==BONUS_TYPE_YUNHEE_FIX){if(d.bonus_type==item.bonus_type&&d.bonus_idx==item.bonus_idx&&d.castle_id==item.castle_id){foundIdx=idx,found=!0;break}}else if(item.bonus_type==BONUS_TYPE_EQUIPMENT){if(d.bonus_type==item.bonus_type&&d.bonus_idx==item.equipment.equipment_item_idx&&d.castle_id==item.castle_id){foundIdx=idx,found=!0;break}}else if(d.bonus_type==item.bonus_type&&d.castle_id==item.castle_id){foundIdx=idx,found=!0;break}}if(found)item.bonus_type==BONUS_TYPE_YUNHEE_FIX?this.m_recv_item_list[foundIdx].bonus_count+=item.bonus_level:item.bonus_type==BONUS_TYPE_EQUIPMENT?this.m_recv_item_list[foundIdx].bonus_count+=1:this.m_recv_item_list[foundIdx].bonus_count+=item.bonus_idx;else{var data={};data.event_dungeon_period_idx=res_2.event_dungeon_period_idx,data.event_dungeon_box_gacha_idx=res_2.event_dungeon_box_gacha_idx,item.bonus_type==BONUS_TYPE_YUNHEE_FIX?(data.bonus_type=item.bonus_type,data.bonus_idx=item.bonus_idx,data.bonus_count=item.bonus_level,55555==item.bonus_idx?1==item.castle_id?data.castle_id=2:data.castle_id=1:1==item.castle_id?data.castle_id=2:data.castle_id=0):item.bonus_type==BONUS_TYPE_EQUIPMENT?(data.bonus_type=item.bonus_type,data.bonus_count=1,data.bonus_idx=item.equipment.equipment_item_idx,1==item.castle_id?data.castle_id=2:data.castle_id=1):item.bonus_type==BONUS_TYPE_HR_RARE_TYPE_ENGAGE||item.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE||item.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||item.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||item.bonus_type==BONUS_TYPE_JADE||item.bonus_type==BONUS_TYPE_EVOLVE_ORB||item.bonus_type==BONUS_TYPE_SR_RARE_TYPE_ENGAGE||item.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||item.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6?(data.bonus_type=item.bonus_type,data.bonus_count=item.bonus_idx,1==item.castle_id?data.castle_id=2:data.castle_id=1):(data.bonus_type=item.bonus_type,data.bonus_count=item.bonus_idx,1==item.castle_id?data.castle_id=2:data.castle_id=0),this.m_recv_item_list.push(data)}1==item.castle_id&&(is_gain_main_item=!0)}this.m_recv_item_list=stable(this.m_recv_item_list,function(l,r){return l.castle_id<r.castle_id});var recv_title=cmLabel.getLabel(res_str("label_event_dungeno_box_gacha_result_text_always"),LABEL_FONT_INDEX.FONT_201);if(recv_title.setAnchorPoint(ANCHOR_MIDDLE()),is_gain_main_item?recv_title.setPosition(ccCenter(box).x,ccHeight(box)-ccHeight(navi)-20):recv_title.setPosition(ccCenter(box).x,ccHeight(box)-ccHeight(navi)-30),box.addChild(recv_title),is_gain_main_item){var main_item_title=cmLabel.getLabel(res_str("label_event_dungeno_box_gacha_result_text_main_reward"),LABEL_FONT_INDEX.FONT_203);main_item_title.setAnchorPoint(ANCHOR_MIDDLE_TOP()),main_item_title.setPosition(ccCenter(box).x,ccHeight(box)-ccHeight(navi)-37),box.addChild(main_item_title),cmLabel.autoSizeFit(main_item_title,410,20)}var tableSize=cc.size(444,boxSize.height-130);return this.m_table_view=new cc.TableView(this,tableSize),this.m_table_view.ignoreAnchorPointForPosition(!1),this.m_table_view.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_table_view.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_table_view.scrollBarEnable(!0),this.m_table_view.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_table_view.setPosition(17,18),box.addChild(this.m_table_view),this.m_table_view.setDelegate(this),!0},cellSizeForTable:function(table){return cc.size(444,50)},tableCellSizeForIndex:function(table,idx){return cc.size(444,50)},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;cell=null!=c?c:new EventDungeonBoxGachaRecvItemCellV2;var data=this.m_recv_item_list[idx];return cell.setData(data),cell},numberOfCellsInTableView:function(){return this.m_recv_item_list.length},tableCellTouched:function(table,cell){},tableCellHighlight:function(table,cell){},tableCellUnhighlight:function(table,cell){},tableCellEnded:function(){},tableCellSelectedCallback:function(){}}),EventDungeonBoxGachaGoldenBarrelCellV2=cc.TableViewCell.extend({m_showtooltip:null,m_item_title:null,m_icon_frame:null,m_item_count:null,m_equip_jewelry:null,m_equip_step:null,m_item_icon:null,m_item_data:[],ctor:function(_cb_tooltip){this._super(),this.init(_cb_tooltip)},init:function(_cb_tooltip){this.m_showtooltip=_cb_tooltip;var cellSize=cc.size(444,78);this.setContentSize(cellSize);var box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",cc.Rect(20,20,20,20));return box.setPreferredSize(cellSize),box.setAnchorPoint(ZERO()),box.setPosition(ZERO()),this.addChild(box),this.m_icon_frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png"),this.m_icon_frame.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_icon_frame.setPosition(4,.5*cellSize.height),box.addChild(this.m_icon_frame),this.m_item_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2013),this.m_item_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_item_title.setPosition(80,43),box.addChild(this.m_item_title),this.m_item_count=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.m_item_count.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_item_count.setPosition(80,16),box.addChild(this.m_item_count),this.m_equip_jewelry=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_144),this.m_equip_jewelry.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_equip_jewelry.setPosition(cellSize.width-10,13),box.addChild(this.m_equip_jewelry),DISABLE_SPB_TP?this.m_equip_step=cc.Sprite.create(RES_CDN_DEFULT+"menu_equip/img_equip_text_plus.png"):this.m_equip_step=cc.Sprite.create("#img_equip_text_plus.png"),this.m_equip_step.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_equip_step.setPosition(72,73),box.addChild(this.m_equip_step),!0},setData:function(data){this.m_item_data=data,this.updateCell(this.m_item_data)},highLightPosInCell:function(pos){var r=this.m_icon_frame.getBoundingBox();cc.rectContainsPoint(r,pos)&&null!=this.m_showtooltip&&this.m_showtooltip(this.m_item_data,this.getTouchTablePos())},updateCell:function(data){var m=MasterManager.getInstance();if(null!=this.m_item_icon&&this.m_item_icon.getParent()&&this.m_item_icon.removeFromParentAndCleanup(!0),this.m_equip_jewelry.setVisible(!1),this.m_equip_step.setVisible(!1),data.item.bonus_type==BONUS_TYPE_YUNHEE_FIX){var card=new Card;card.gnrl_id=data.item.min_value,this.m_item_icon=(new Card).createCard(card,CARD_TYPE.type_card_thumb);var gnrl=m.get_General(data.item.min_value);this.m_item_title.setString(cmString("%s x%d",gnrl.name,data.item.max_value)),cmLabel.autoSizeFit(this.m_item_title,350,20)}else if(data.item.bonus_type==BONUS_TYPE_EQUIPMENT);else{this.m_item_icon=cc.Sprite.create(cmString("#img_reward_%02d.png",data.item.bonus_type));var bonus=m.get_BonusType(data.item.bonus_type);this.m_item_title.setString(cmString("%s x%d",bonus.name,data.item.min_value)),cmLabel.autoSizeFit(this.m_item_title,350,20)}if(this.m_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),data.item.bonus_type==BONUS_TYPE_YUNHEE_FIX?this.m_item_icon.setPosition(25,25):this.m_item_icon.setPosition(ccCenter(this.m_icon_frame)),this.m_icon_frame.addChild(this.m_item_icon),0==data.item.count)this.m_item_count.setString(res_str("label_event_dungeon_treasure_box_count_3"));else{var remain_count=data.item.count-data.gain_count;this.m_item_count.setString(cmString(res_str("label_event_dungeon_box_gacha_count"),remain_count,data.item.count))}}}),EventDungeonBoxGachaGoldenBarrelPopupV2=cc.Layer.extend({m_close_callback:null,m_table_view:null,tooltip_box:null,tooltip_title:null,tooltip_content:null,m_box_gacha_info:null,m_golden_barrel_data_list:[],ctor:function(box_gacha_info,_close_callback){this._super(),this.m_golden_barrel_data_list=[],this.init(box_gacha_info,_close_callback)},init:function(box_gacha_info,_close_callback){this.m_close_callback=_close_callback,this.m_box_gacha_info=box_gacha_info;for(var m=MasterTable.getInstance(),mt=MasterManager.getInstance(),item_list=m.get_EventDungeonBoxGachaGoldenBarrelList(this.m_box_gacha_info.event_dungeon_period_idx),i=0;i<item_list.length;i++){var item=item_list[i],data={};data.item=item,data.gain_count=0,this.m_golden_barrel_data_list.push(data)}try{for(var j=0;j<this.m_golden_barrel_data_list.length;j++)for(var k=0;k<this.m_box_gacha_info.golden_barrel_log.length;k++){item=this.m_box_gacha_info.golden_barrel_log[k];var d=mt.get_EventDungeonBoxGachaGoldenBarrel(item.event_dungeon_period_idx,item.bonus_type);this.m_golden_barrel_data_list[j].item.bonus_type==d.bonus_type&&this.m_golden_barrel_data_list[j].item.min_value==d.min_value&&(this.m_golden_barrel_data_list[j].gain_count+=1)}}catch(e){}this.m_golden_barrel_data_list=stable(this.m_golden_barrel_data_list,function(l,r){return l.item.sort_num>r.item.sort_num});var winSize=ccSize(this),boxSize=cc.size(478,541),box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),box.setPreferredSize(cc.size(478,541)),box.setPosition(.5*winSize.width,10),this.addChild(box);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(box).x,ccHeight(box)-11),box.addChild(navi);var navi_title=cmLabel.getLabel(res_str("label_event_dungeon_golden_barrel_title"),LABEL_FONT_INDEX.FONT_261);navi_title.setAnchorPoint(ANCHOR_MIDDLE()),navi_title.setPosition(ccCenter(navi).x,ccCenter(navi).y+3),navi.addChild(navi_title);var btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);btn.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),btn.setPosition(ccWidth(navi)-16,ccCenter(navi).y+2),btn.addClickEventListener(function(sender){null!=this.m_close_callback&&this.m_close_callback()}.bind(this)),navi.addChild(btn);var tableSize=cc.size(444,boxSize.height-90);return this.m_table_view=new cc.TableView(this,tableSize),this.m_table_view.ignoreAnchorPointForPosition(!1),this.m_table_view.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_table_view.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_table_view.scrollBarEnable(!0),this.m_table_view.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_table_view.setPosition(17,18),box.addChild(this.m_table_view),this.m_table_view.setDelegate(this),this.m_table_view.reloadData(),this.tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.tooltip_box.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.tooltip_box.setPosition(ZERO()),this.tooltip_box.setVisible(!1),box.addChild(this.tooltip_box,100),this.tooltip_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1810),this.tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_box.addChild(this.tooltip_title),this.tooltip_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.tooltip_content.setAnchorPoint(ANCHOR_MIDDLE),this.tooltip_content.setPosition(ccCenter(this.tooltip_box)),this.tooltip_box.addChild(this.tooltip_content),!0},cellSizeForTable:function(table){return cc.size(444,78)},tableCellSizeForIndex:function(table){return cc.size(444,78)},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;return(cell=null!=c?c:new EventDungeonBoxGachaGoldenBarrelCellV2(this.showTooltip.bind(this))).setData(this.m_golden_barrel_data_list[idx]),cell},numberOfCellsInTableView:function(table){return this.m_golden_barrel_data_list.length},tableCellTouched:function(table,cell){},tableCellHighlight:function(table,cell){null!=cell&&cell.highLightPosInCell(cell.getTouchPos())},tableCellUnhighlight:function(table,cell){this.hideTooltip()},showTooltip:function(data,pos){var winSize=cc.size(ccSize(this));this.tooltip_box.setVisible(!0);var m=MasterTable.getInstance(),mt=MasterManager.getInstance();if(data.item.bonus_type==BONUS_TYPE_YUNHEE_FIX){var gnrl=mt.get_General(data.item.min_value);if(""==(tooltip=m.get_TooltipGeneral(data.item.min_value)).content||null==tooltip.content){this.tooltip_title.setString(gnrl.name),this.tooltip_title.setAnchorPoint(ANCHOR_MIDDLE()),this.tooltip_content.setString("");var tSize=ccSize(this.tooltip_title);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(64,tSize.width+20),bSize.height=Math.max(54,bSize.height+10),this.tooltip_box.setPreferredSize(bSize),this.tooltip_title.setPosition(ccCenter(bSize))}else{this.tooltip_title.setString(gnrl.name),this.tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_content.setString(tooltip.content);tSize=ccSize(this.tooltip_title);var cSize=ccSize(this.tooltip_content);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(tSize.width+20,cSize.width+20),bSize.height=Math.max(64,bSize.height+cSize.height+5),this.tooltip_box.setPreferredSize(bSize),this.tooltip_title.setPosition(10,bSize.height-10),this.tooltip_content.setPosition(10,bSize.height-15-tSize.height)}var bSize=this.tooltip_box.getPreferredSize();if((t_pos=this.m_table_view.getPosition()).y+=pos.y,t_pos.y+.5*bSize.height>winSize.height-55){var top=t_pos.y+.5*bSize.height-(winSize.height-55-20);t_pos.y-=top}this.tooltip_box.setPosition(t_pos.x+80,t_pos.y),this.tooltip_content.setPosition(10,12)}else if(data.item.bonus_type==BONUS_TYPE_EQUIPMENT);else{var tooltip,bonus=mt.get_BonusType(data.item.bonus_type);if(""==(tooltip=m.get_TooltipItem(data.item.bonus_type)).content||null==tooltip.content){this.tooltip_title.setString(bonus.name),this.tooltip_title.setAnchorPoint(ANCHOR_MIDDLE()),this.tooltip_content.setString("");tSize=ccSize(this.tooltip_title);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(64,tSize.width+20),bSize.height=Math.max(54,bSize.height+10),this.tooltip_box.setPreferredSize(bSize),this.tooltip_title.setPosition(ccCenter(bSize))}else{this.tooltip_title.setString(bonus.name),this.tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_content.setString(tooltip.content);tSize=ccSize(this.tooltip_title),cSize=ccSize(this.tooltip_content);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(tSize.width+20,cSize.width+20),bSize.height=Math.max(64,bSize.height+cSize.height+5),this.tooltip_box.setPreferredSize(bSize),this.tooltip_title.setPosition(10,bSize.height-10),this.tooltip_content.setPosition(10,bSize.height-15-tSize.height)}var t_pos;bSize=this.tooltip_box.getPreferredSize();if((t_pos=this.m_table_view.getPosition()).y+=pos.y,t_pos.y+.5*bSize.height>winSize.height-55){top=t_pos.y+.5*bSize.height-(winSize.height-55-20);t_pos.y-=top}this.tooltip_box.setPosition(t_pos.x+80,t_pos.y),this.tooltip_content.setPosition(10,12)}},hideTooltip:function(){this.tooltip_box.setVisible(!1)},scrollViewDidScroll:function(view){},scrollViewDidZoom:function(view){},tableCellEnded:function(){},tableCellSelectedCallback:function(){}}),EventDungeonEpilogueLayer=cc.Layer.extend({m_label:null,m_script_index:0,m_bg_frame:null,m_name_label:null,m_finger:null,m_left_hero:null,m_middle_hero:null,m_right_hero:null,m_is_complete:!1,m_script_bg:null,m_left_emotion:null,m_middle_emotion:null,m_right_emotion:null,m_is_doing_transition_scene:!1,m_script_cover:null,m_is_doing_attack_scene:!1,m_attack_cover:null,m_cliper:null,m_stencil_node:null,_scriptViewCompleteNotBattle:null,m_user_info:{},m_body_img:null,m_hero_left_script:null,m_hero_middle_script:null,m_hero_right_script:null,m_hero_left_script_texture:null,m_hero_middle_script_texture:null,m_hero_right_script_texture:null,winSize:null,m_resource_list:null,m_use_Add_Scale:1,ctor:function(){return this._super(),this.m_script_list=[],this.init(),USE_SP_CARD_SCRIPT_BODY_SCALE?this.m_use_Add_Scale=2:this.m_use_Add_Scale=1,!0},init:function(){BattleAni._getInstance().Is_loaded()||BattleAni._getInstance().loadAnimate(),this.winSize=cc.director.getWinSize(),this.m_user_info=NetService().get_User_info(),this.ignoreAnchorPointForPosition(!1),this.setContentSize(this.winSize),this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setPosition(ZERO()),this.m_script_bg=new cc.Sprite(RES_CDN_DEFULT+"card_script_bg/116.jpg"),USE_SP_SCRIPT_BG_SCALE&&this.m_script_bg.setScale(2),this.m_script_bg.setAnchorPoint(.5,.5),this.m_script_bg.setPosition(this.winSize.width/2,this.winSize.height/2),this.addChild(this.m_script_bg),this.m_left_hero=new cc.Sprite,this.m_left_hero.setAnchorPoint(.5,0),this.m_left_hero.setPosition(.5*ccWidth(this.m_left_hero)*(1.4*this.m_use_Add_Scale),0),this.m_left_hero.setScale(1.4*this.m_use_Add_Scale),this.addChild(this.m_left_hero);var l_size=ccSize(this.m_left_hero);this.m_left_emotion=new cc.Sprite,this.m_left_emotion.setAnchorPoint(.5,.5),this.m_left_emotion.setPosition(.5*l_size.width,l_size.height-70),this.m_left_hero.addChild(this.m_left_emotion,-1),this.m_middle_hero=new cc.Sprite,this.m_middle_hero.setAnchorPoint(.5,0),this.m_middle_hero.setPosition(.5*this.winSize.width,0),this.m_middle_hero.setScale(1.4*this.m_use_Add_Scale),this.addChild(this.m_middle_hero);var m_size=ccSize(this.m_middle_hero);this.m_middle_emotion=new cc.Sprite,this.m_middle_emotion.setAnchorPoint(.5,.5),this.m_middle_emotion.setPosition(.5*m_size.width,m_size.height-70),this.m_middle_hero.addChild(this.m_middle_emotion,-1),this.m_right_hero=new cc.Sprite,this.m_right_hero.setAnchorPoint(.5,0),this.m_right_hero.setPosition(this.winSize.width-.5*ccWidth(this.m_right_hero)*(1.4*this.m_use_Add_Scale),0),this.m_right_hero.setScale(1.4*this.m_use_Add_Scale),this.addChild(this.m_right_hero);var r_size=ccSize(this.m_right_hero);this.m_right_emotion=new cc.Sprite,this.m_right_emotion.setAnchorPoint(.5,.5),this.m_right_emotion.setPosition(.5*r_size.width,r_size.height-70),this.m_right_hero.addChild(this.m_right_emotion,-1);var boxSize=cc.size(this.winSize.width,172);if(this.m_bg_frame=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_line_1.png",cc.rect(1,0,1,0)),this.m_bg_frame.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_bg_frame.setPreferredSize(boxSize),this.m_bg_frame.setPosition(ZERO()),this.addChild(this.m_bg_frame),this.m_name_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_261),this.m_name_label.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_name_label.setPosition(30,boxSize.height-15),this.m_bg_frame.addChild(this.m_name_label),this.m_finger=new cc.Sprite,this.m_finger.setAnchorPoint(1,0),this.m_finger.setPosition(boxSize.width,10),this.m_bg_frame.addChild(this.m_finger),NOT_USE_SP_BATTLE_ANIMATION){this.m_finger.setScale(2),this.m_finger.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/img_script_dialog_01.png");var scaleTo_1=new cc.ScaleTo(.2,2.03,2.03),scaleTo_2=new cc.ScaleTo(.2,1.97,1.97),sequence=new cc.Sequence(scaleTo_1,scaleTo_2);repeat=new cc.RepeatForever(sequence);this.m_finger.runAction(repeat)}else{var repeat=BattleAni._getInstance().getAnimate(BattleAni_.EffectFinger).repeatForever();this.m_finger.runAction(repeat)}this.m_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_221),this.m_label.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_label.setPosition(30,this.m_bg_frame.getContentSize().height-50),this.m_label.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_label.setTextHorizontalAlignment(cc.TEXT_ALIGNMENT_LEFT),this.m_bg_frame.addChild(this.m_label);var touch_button_sc9=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.rect(1,0,1,0)),touch_button=new cc.ControlButton(touch_button_sc9);touch_button.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),touch_button.setPreferredSize(this.winSize),touch_button.setPosition(ZERO()),this.addChild(touch_button),touch_button.addTargetWithActionForControlEvents(this,this.onTouchTalkBox,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),this.m_script_cover=new cc.Sprite(RES_CDN_DEFULT+"card_script_bg/116.jpg"),USE_SP_SCRIPT_BG_SCALE&&this.m_script_cover.setScale(2),this.m_script_cover.setAnchorPoint(.5,.5),this.m_script_cover.setPosition(this.winSize.width/2,this.winSize.height/2),this.m_script_cover.opacity=0,this.addChild(this.m_script_cover);var container=new cc.Layer;container.ignoreAnchorPointForPosition(!1),container.setContentSize(this.winSize),container.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),container.setPosition(0,0),this.addChild(container),this.m_cliper=new cc.ClippingNode,this.m_cliper.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_cliper.alphaThreshold=.5,this.m_cliper.setPosition(ZERO()),container.addChild(this.m_cliper),this.m_stencil_node=new cc.Node,this.m_stencil_node.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_stencil_node.setPosition(this.winSize.width,0),this.m_cliper.stencil=this.m_stencil_node;var spot=new cc.Sprite(RES_CDN_DEFULT+"card_script_bg/116.jpg");USE_SP_SCRIPT_BG_SCALE&&spot.setScale(2),spot.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),spot.setPosition(ZERO()),this.m_stencil_node.addChild(spot),this.m_stencil_node.setContentSize(spot.getContentSize()),this.m_attack_cover=new cc.Sprite(RES_CDN_DEFULT+"uieffect_2/attack_1.png"),this.m_attack_cover.setAnchorPoint(ANCHOR_MIDDLE()),this.m_attack_cover.setPosition(ccCenter(this.winSize)),this.m_cliper.addChild(this.m_attack_cover);var skip=new ccui.Button;skip.loadTextures(RES_CDN_DEFULT+"menu_battle/btn/btn_skip_off.png",RES_CDN_DEFULT+"menu_battle/btn/btn_skip_on.png",""),skip.setAnchorPoint(ANCHOR_TOP_RIGHT()),skip.setPosition(this.winSize.width-10,this.winSize.height-10),this.addChild(skip),skip.addClickEventListener(function(sender){null!=this._scriptViewCompleteNotBattle&&(AudioEngine.getInstance().stopBackgroundMusic(),this._scriptViewCompleteNotBattle.scriptEventDungeonComplete(this))}.bind(this))},onEnter:function(){this._super()},onExit:function(){if(this._super(),null!=this.m_resource_list&&null!=this.m_resource_list)for(var i=0;i<this.m_resource_list.length;i++)cc.loader.release(this.m_resource_list[i]);null!=this.m_body_img&&null!=this.m_body_img&&cc.loader.release(this.m_body_img),this.removeAllChildrenWithCleanup(!0),this.m_label=null,this.m_script_index=0,this.m_bg_frame=null,this.m_name_label=null,this.m_finger=null,this.m_left_hero=null,this.m_middle_hero=null,this.m_right_hero=null,this.m_script_bg=null,this.m_left_emotion=null,this.m_middle_emotion=null,this.m_right_emotion=null,this.m_script_cover=null,this.m_attack_cover=null,this.m_cliper=null,this.m_stencil_node=null,this._scriptViewCompleteNotBattle=null,this.m_user_info=null,this.m_body_img=null,this.m_hero_left_script=null,this.m_hero_middle_script=null,this.m_hero_right_script=null,this.m_hero_left_script_texture=null,this.m_hero_middle_script_texture=null,this.m_hero_right_script_texture=null,this.winSize=null,this.m_resource_list=null,delete this.m_label,delete this.m_script_index,delete this.m_bg_frame,delete this.m_name_label,delete this.m_finger,delete this.m_left_hero,delete this.m_middle_hero,delete this.m_right_hero,delete this.m_script_bg,delete this.m_left_emotion,delete this.m_middle_emotion,delete this.m_right_emotion,delete this.m_script_cover,delete this.m_attack_cover,delete this.m_cliper,delete this.m_stencil_node,delete this._scriptViewCompleteNotBattle,delete this.m_user_info,delete this.m_body_img,delete this.m_hero_left_script,delete this.m_hero_middle_script,delete this.m_hero_right_script,delete this.m_hero_left_script_texture,delete this.m_hero_middle_script_texture,delete this.m_hero_right_script_texture,delete this.winSize,delete this.m_resource_list},loadScript_1:function(prologue_event_dungeon_period_idx,epilogue_event_dungeon_period_idx,occured_type,_callback){var m=MasterTable.getInstance();if(this.reset(),0!=prologue_event_dungeon_period_idx&&(this.m_script_list=m.get_EventDungeonEpilogue(prologue_event_dungeon_period_idx,occured_type)),0!=epilogue_event_dungeon_period_idx)for(var script_list=m.get_EventDungeonEpilogue(epilogue_event_dungeon_period_idx,occured_type),i=0;i<script_list.length;i++)this.m_script_list.push(script_list[i]);null!=this.m_resource_list&&null!=this.m_resource_list||(this.m_resource_list=[]);var resource_list=[];this.m_hero_left_script=[],this.m_hero_middle_script=[],this.m_hero_right_script=[],this.m_hero_left_script_texture=[],this.m_hero_middle_script_texture=[],this.m_hero_right_script_texture=[];for(var idx=0;idx<this.m_script_list.length;idx++){if(this.m_script_list[idx].voice,"0"!=this.m_script_list[idx].r_filename)if(resource_list.push(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].r_filename+".png"),0!=this.m_hero_right_script.length)-1==this.m_hero_right_script.indexOf(this.m_script_list[idx].r_filename)&&(this.m_hero_right_script.push(this.m_script_list[idx].r_filename),this.m_hero_right_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].r_filename+".png")));else this.m_hero_right_script.push(this.m_script_list[idx].r_filename),this.m_hero_right_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].r_filename+".png"));if("0"!=this.m_script_list[idx].m_filename)if(resource_list.push(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].m_filename+".png"),0!=this.m_hero_middle_script.length)-1==this.m_hero_middle_script.indexOf(this.m_script_list[idx].m_filename)&&(this.m_hero_middle_script.push(this.m_script_list[idx].m_filename),this.m_hero_middle_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].m_filename+".png")));else this.m_hero_middle_script.push(this.m_script_list[idx].m_filename),this.m_hero_middle_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].m_filename+".png"));if("0"!=this.m_script_list[idx].l_filename)if(resource_list.push(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].l_filename+".png"),0!=this.m_hero_left_script.length)-1==this.m_hero_left_script.indexOf(this.m_script_list[idx].m_filename)&&(this.m_hero_left_script.push(this.m_script_list[idx].l_filename),this.m_hero_left_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].l_filename+".png")));else this.m_hero_left_script.push(this.m_script_list[idx].l_filename),this.m_hero_left_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].l_filename+".png"));"0"!=this.m_script_list[idx].bg_num&&resource_list.push(RES_CDN_DEFULT+"card_script_bg/"+this.m_script_list[idx].bg_num+".jpg")}return this.m_resource_list=resource_list.reduce(function(a,b){if(0==a.length)return a.push(b),a;for(var is_chk=!1,idx=0;idx<a.length;idx++)a[idx]==b&&(is_chk=!0);return 0==is_chk&&a.push(b),a},[]),resourceLoader(this.m_resource_list,function(){null!=_callback&&_callback()}.bind(this)),!(this.m_script_list.length<=0)},loadScript:function(event_dungeon_period_idx,occured_type,_callback){var m=MasterTable.getInstance();this.reset(),this.m_script_list=m.get_EventDungeonEpilogue(event_dungeon_period_idx,occured_type),null!=this.m_resource_list&&null!=this.m_resource_list||(this.m_resource_list=[]);var resource_list=[];this.m_hero_left_script=[],this.m_hero_middle_script=[],this.m_hero_right_script=[],this.m_hero_left_script_texture=[],this.m_hero_middle_script_texture=[],this.m_hero_right_script_texture=[];for(var idx=0;idx<this.m_script_list.length;idx++){if(this.m_script_list[idx].voice,"0"!=this.m_script_list[idx].r_filename)if(resource_list.push(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].r_filename+".png"),0!=this.m_hero_right_script.length)-1==this.m_hero_right_script.indexOf(this.m_script_list[idx].r_filename)&&(this.m_hero_right_script.push(this.m_script_list[idx].r_filename),this.m_hero_right_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].r_filename+".png")));else this.m_hero_right_script.push(this.m_script_list[idx].r_filename),this.m_hero_right_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].r_filename+".png"));if("0"!=this.m_script_list[idx].m_filename)if(resource_list.push(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].m_filename+".png"),0!=this.m_hero_middle_script.length)-1==this.m_hero_middle_script.indexOf(this.m_script_list[idx].m_filename)&&(this.m_hero_middle_script.push(this.m_script_list[idx].m_filename),this.m_hero_middle_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].m_filename+".png")));else this.m_hero_middle_script.push(this.m_script_list[idx].m_filename),this.m_hero_middle_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].m_filename+".png"));if("0"!=this.m_script_list[idx].l_filename)if(resource_list.push(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].l_filename+".png"),0!=this.m_hero_left_script.length)-1==this.m_hero_left_script.indexOf(this.m_script_list[idx].l_filename)&&(this.m_hero_left_script.push(this.m_script_list[idx].l_filename),this.m_hero_left_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].l_filename+".png")));else this.m_hero_left_script.push(this.m_script_list[idx].l_filename),this.m_hero_left_script_texture.push(cc.textureCache.addImage(RES_CDN_DEFULT+"card_script_body/"+this.m_script_list[idx].l_filename+".png"));"0"!=this.m_script_list[idx].bg_num&&resource_list.push(RES_CDN_DEFULT+"card_script_bg/"+this.m_script_list[idx].bg_num+".jpg")}return this.m_resource_list=resource_list.reduce(function(a,b){if(0==a.length)return a.push(b),a;for(var is_chk=!1,idx=0;idx<a.length;idx++)a[idx]==b&&(is_chk=!0);return 0==is_chk&&a.push(b),a},[]),resourceLoader(this.m_resource_list,function(){null!=_callback&&_callback()}.bind(this)),!(this.m_script_list.length<=0)},IsReady:function(){return 0!=this.m_script_list.length},typingBattleScript:function(){if(this.m_is_complete)null!=this._scriptViewCompleteNotBattle&&(AudioEngine.getInstance().stopBackgroundMusic(),this._scriptViewCompleteNotBattle.scriptEventDungeonComplete(this));else if(this.m_script_index<this.m_script_list.length){var script=this.m_script_list[this.m_script_index];if(script.scene_type==SCENE_TYPE_ATTACK)return void this.startAttackEffect(script.scene_desc);if(script.scene_type==SCENE_TYPE_TRANSITION){this.m_is_doing_transition_scene=!0;var fadeout=cc.fadeIn(1),cb=cc.callFunc(this.cbMiddleSceneTransition.bind(this)),seq=cc.sequence(fadeout,cb);return void this.m_script_cover.runAction(seq)}if(script.scene_type==SCENE_TYPE_SHAKE){script.scene_desc;var shake=new Shake(APPEAR_DURATION,15);this.runAction(shake)}this.updateScript(script)}},reset:function(){this.m_script_index=0,this.m_is_complete=!1,this.m_script_list.length=0,this.m_script_list=[]},updateBG:function(bg_num){this.m_body_img=RES_CDN_DEFULT+"card_script_bg/"+bg_num+".jpg",resourceLoader(this.m_body_img,function(){var frame2_texture=cc.textureCache.addImage(this.m_body_img),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));this.m_script_bg.setSpriteFrame(frame2)}.bind(this))},updateScript:function(script){if(0<script.bg_num&&this.updateBG(script.bg_num),"0"==script.name?this.m_name_label.setString(""):"1"==script.name?this.m_name_label.setString(this.m_user_info.nickname):this.m_name_label.setString(script.name),"0"==script.l_filename)this.m_left_hero.setVisible(!1);else{this.m_left_hero.setVisible(!0),this.m_left_hero.setOpacity(255);var body_l_check=this.m_hero_left_script.indexOf(script.l_filename);if(-1!=body_l_check){var frame2_texture_left=this.m_hero_left_script_texture[body_l_check],frame2_left=new cc.SpriteFrame(frame2_texture_left,cc.rect(0,0,frame2_texture_left.getContentSize().width,frame2_texture_left.getContentSize().height));this.m_left_hero.setSpriteFrame(frame2_left)}1==script.onoff||4==script.onoff?this.m_left_hero.setColor(cc.color(255,255,255)):0!=script.onoff&&2!=script.onoff&&3!=script.onoff||this.m_left_hero.setColor(cc.color(166,166,166)),this.m_left_hero.setPosition(.5*ccWidth(this.m_left_hero)*(1.4*this.m_use_Add_Scale),0),this.m_left_hero.isRunning()&&(this.m_left_hero.stopAllActions(),this.m_left_hero.setPosition(.5*ccWidth(this.m_left_hero)*(1.4*this.m_use_Add_Scale),0),this.m_left_hero.setScale(1.4*this.m_use_Add_Scale),this.m_left_hero.setOpacity(255)),this.appearHero(script.l_appear_type,this.m_left_hero),this.heroEmotion(script.l_emotion,this.m_left_hero,this.m_left_emotion),1==script.l_reverse?this.m_left_hero.setFlippedX(!0):this.m_left_hero.setFlippedX(!1)}if("0"==script.m_filename)this.m_middle_hero.setVisible(!1);else{this.m_middle_hero.setVisible(!0),this.m_middle_hero.setOpacity(255);var body_m_check=this.m_hero_middle_script.indexOf(script.m_filename);if(-1!=body_m_check){var frame2_texture_middle=this.m_hero_middle_script_texture[body_m_check],frame2_middle=new cc.SpriteFrame(frame2_texture_middle,cc.rect(0,0,frame2_texture_middle.getContentSize().width,frame2_texture_middle.getContentSize().height));this.m_middle_hero.setSpriteFrame(frame2_middle)}3==script.onoff||4==script.onoff?this.m_middle_hero.setColor(cc.color(255,255,255)):0!=script.onoff&&1!=script.onoff&&2!=script.onoff||this.m_middle_hero.setColor(cc.color(166,166,166)),this.m_middle_hero.setPosition(.5*this.winSize.width,0),this.m_middle_hero.isRunning()&&(this.m_middle_hero.stopAllActions(),this.m_middle_hero.setPosition(.5*this.winSize.width,0),this.m_middle_hero.setScale(1.4*this.m_use_Add_Scale),this.m_middle_hero.setOpacity(255)),this.appearHero(script.m_appear_type,this.m_middle_hero),this.heroEmotion(script.m_emotion,this.m_middle_hero,this.m_middle_emotion)}if("0"==script.r_filename)this.m_right_hero.setVisible(!1);else{this.m_right_hero.setVisible(!0),this.m_right_hero.setOpacity(255);var body_r_check=this.m_hero_right_script.indexOf(script.r_filename);if(-1!=body_r_check){var frame2_texture_right=this.m_hero_right_script_texture[body_r_check],frame2_right=new cc.SpriteFrame(frame2_texture_right,cc.rect(0,0,frame2_texture_right.getContentSize().width,frame2_texture_right.getContentSize().height));this.m_right_hero.setSpriteFrame(frame2_right)}2==script.onoff||4==script.onoff?this.m_right_hero.setColor(cc.color(255,255,255)):0!=script.onoff&&1!=script.onoff&&3!=script.onoff||this.m_right_hero.setColor(cc.color(166,166,166)),this.m_right_hero.setPosition(this.winSize.width-.5*ccWidth(this.m_right_hero)*(1.4*this.m_use_Add_Scale),0),this.m_right_hero.isRunning()&&(this.m_right_hero.stopAllActions(),this.m_right_hero.setPosition(this.winSize.width-.5*ccWidth(this.m_right_hero)*(1.4*this.m_use_Add_Scale),0),this.m_right_hero.setScale(1.4*this.m_use_Add_Scale),this.m_right_hero.setOpacity(255)),this.appearHero(script.r_appear_type,this.m_right_hero),this.heroEmotion(script.r_emotion,this.m_right_hero,this.m_right_emotion),1==script.r_reverse?this.m_right_hero.setFlippedX(!0):this.m_right_hero.setFlippedX(!1)}if(1==script.name_type){this.m_label.setString(cmString(script.content,this.m_user_info.nickname));var line=SCRIPTCOUNT(cmString(script.content,this.m_user_info.nickname),60);this.m_label.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_label.setTextAreaSize(cc.size(1070,22*line+25)),this.m_label.ignoreContentAdaptWithSize(!1)}else{this.m_label.setString(script.content);line=SCRIPTCOUNT(script.content,60);this.m_label.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_label.setTextAreaSize(cc.size(1070,22*line+25)),this.m_label.ignoreContentAdaptWithSize(!1)}if("0"!=script.sound){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"voice_etc/"+script.sound+".mp3";audio.playVoice(path)}this.isRunning()&&(this.stopAllActions(),this.setPosition(ZERO())),this.m_script_index++,this.m_script_index>=this.m_script_list.length&&(this.m_script_index=this.m_script_list.length-1,this.m_is_complete=!0)},appearHero:function(type,hero){if(type==APPEAR_TYPE_FADE_IN){hero.setOpacity(0);var fadein=cc.fadeIn(APPEAR_DURATION);hero.runAction(fadein)}else if(type==APPEAR_TYPE_SHAKE){var shake=new Shake(APPEAR_DURATION,15);hero.runAction(shake)}else if(type==APPEAR_TYPE_BOMB){hero.setScale(3*this.m_use_Add_Scale);var ease=cc.scaleTo(.1,1.4*this.m_use_Add_Scale).clone().easing(cc.easeBounceOut());hero.runAction(ease)}},heroEmotion:function(type,hero,emotion){if(0==type)emotion.setVisible(!1);else{var n_size=ccSize(hero);if(emotion.setVisible(!0),emotion.setPosition(.5*n_size.width,n_size.height*this.m_use_Add_Scale-70+35),emotion.isRunning()&&emotion.stopAllActions(),NOT_USE_SP_BATTLE_ANIMATION){if(type-1==1){emotion.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/upset01.png");var fadeout=new cc.FadeOut(.5),fadein=new cc.FadeIn(.5),sequence=new cc.Sequence(fadeout,fadein);repeat=new cc.RepeatForever(sequence);emotion.runAction(repeat),repeat=sequence=fadein=fadeout=null}else if(type-1==2){emotion.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/angry01.png");var scaleTo_1=new cc.ScaleTo(.3,1,1),scaleTo_2=new cc.ScaleTo(.3,1.05,1.05);sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);emotion.runAction(repeat),repeat=sequence=scaleTo_2=scaleTo_1=null}else if(type-1==3){emotion.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/shine01.png");fadeout=new cc.FadeOut(.2),fadein=new cc.FadeIn(.2),sequence=new cc.Sequence(fadein,fadeout),repeat=new cc.RepeatForever(sequence);emotion.runAction(repeat),repeat=sequence=fadein=fadeout=null}else if(type-1==4){emotion.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/dark.png");scaleTo_1=new cc.ScaleTo(.3,1,1),scaleTo_2=new cc.ScaleTo(.3,1.03,1.03),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);emotion.runAction(repeat),repeat=sequence=scaleTo_2=scaleTo_1=null}}else{var animate=BattleAni._getInstance().getAnimate(BattleAni_.EffectEmotion_1+(type-1)),repeat=animate.repeatForever();emotion.runAction(repeat),repeat=animate=null}}},cbMiddleSceneTransition:function(){var fadein=cc.fadeOut(1),cb=cc.callFunc(this.cbEndSceneTransition.bind(this)),seq=cc.sequence(fadein,cb);this.m_script_cover.runAction(seq),this.m_script_index++,this.m_script_index>=this.m_script_list.length&&(this.m_script_index=this.m_script_list.length-1,this.m_is_complete=!0),this.typingBattleScript()},cbEndSceneTransition:function(){this.m_is_doing_transition_scene=!1},startAttackEffect:function(scene_desc){this.m_is_doing_attack_scene=!0;var body_img=RES_CDN_DEFULT+"uieffect_2/attack_"+scene_desc+".png",frame2_texture=cc.textureCache.addImage(body_img),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));if(this.m_attack_cover.setSpriteFrame(frame2),scene_desc==ATTACK_TYPE_CUT?this.m_stencil_node.setPosition(0,this.winSize.height):scene_desc==ATTACK_TYPE_STRING?this.m_stencil_node.setPosition(0,-this.winSize.height):scene_desc==ATTACK_TYPE_FIST?this.m_stencil_node.setPosition(ZERO()):scene_desc==ATTACK_TYPE_ARROW?this.m_stencil_node.setPosition(this.winSize.width,0):scene_desc==ATTACK_TYPE_UP_DOWN&&this.m_stencil_node.setPosition(0,this.winSize.height),scene_desc==ATTACK_TYPE_FIST){this.m_attack_cover.setOpacity(0);var fadein=new cc.FadeIn(ATTACK_DURATION),delay=new cc.DelayTime(.5),cb=new cc.CallFunc(this.cbMiddleAttackEffect.bind(this)),seq=new cc.Sequence(fadein,delay,cb);this.m_attack_cover.runAction(seq)}else{this.m_attack_cover.setOpacity(255);var ease=new cc.MoveTo(ATTACK_DURATION,cc.p(0,0)).clone().easing(cc.easeOut(ATTACK_DURATION-.1));delay=cc.delayTime(.5),cb=cc.callFunc(this.cbMiddleAttackEffect.bind(this)),seq=cc.sequence(ease,delay,cb);this.m_stencil_node.runAction(seq)}},cbMiddleAttackEffect:function(){var fade=cc.fadeOut(APPEAR_DURATION),cb=cc.callFunc(this.cbEndAttackEffect.bind(this)),seq=cc.sequence(fade,cb);this.m_attack_cover.runAction(seq),this.m_script_index++,this.m_script_index>=this.m_script_list.length&&(this.m_script_index=this.m_script_list.length-1,this.m_is_complete=!0),this.typingBattleScript()},cbEndAttackEffect:function(){this.m_is_doing_attack_scene=!1},onTouchTalkBox:function(sender,_event){this.isVisible()&&(this.m_is_doing_transition_scene||this.m_is_doing_attack_scene||this.typingBattleScript())}}),EventDungeonCutinBossInfoNode=cc.Node.extend({ctor:function(event_dungeon_period_idx,is_open){this._super(),this.init(event_dungeon_period_idx,is_open)},init:function(event_dungeon_period_idx,is_open){var cellSize=cc.size(380,68);this.setContentSize(cellSize),this.setAnchorPoint(ANCHOR_BOTTOM_LEFT());var m=MasterTable.getInstance();if(is_open)for(var period_info=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),e=m.get_EventDungeonCutinInfoList(period_info.event_dungeon_point_period_idx).at(0),accum_damage=MasterManager.getInstance().get_EventDungeonCutinDamageAccumInfo(e.event_dungeon_cutin_damage_accum_info_idx,1),bonus_list=m.get_EventDungeonCutinBonusItemList(accum_damage.event_dungeon_cutin_damage_accum_info_idx,1),service=BattleService.getInstance(),offset_x=0,i=0;i<bonus_list.size();i++){var b=bonus_list.at(i),item={};service.convertBonusInfo(b,item);var bonus=new MissionPreviewBonusItemCell;bonus.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),bonus.setEnableToolTip(!0),bonus.setPosition(offset_x,.5*cellSize.height),this.addChild(bonus),bonus.setGainItem(item),offset_x+=ccWidth(bonus)+10}return!0}}),EventDungeonCutinBossInfoLayer=cc.Layer.extend({m_base_layer:null,m_cutin_desc:null,m_period:null,m_gnrl_img:null,ctor:function(){this._super(),this.init()},init:function(){var winSize=ccSize(this),m=MasterManager.getInstance();this.m_base_layer=new cc.Layer,this.m_base_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_base_layer.ignoreAnchorPointForPosition(!1),this.m_base_layer.setPosition(ccCenter(winSize)),this.addChild(this.m_base_layer);var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=m.get_EventDungeonPeriod(event_dungeon_period_idx),service=EventDungeonService.getInstance(),first_half_period_idx=service.getEventDungeonFirstHalfPeriodIdx(period.event_dungeon_group_idx),second_half_period_idx=service.getEventDungeonSecondHalfPeriodIdx(period.event_dungeon_group_idx),is_event_2nd=!1;event_dungeon_period_idx=first_half_period_idx;return EventDungeonService.getInstance().IsOpenDungeon(second_half_period_idx)&&(event_dungeon_period_idx=second_half_period_idx,is_event_2nd=!0),this.m_period=m.get_EventDungeonPeriod(event_dungeon_period_idx),this.m_gnrl_img=[],this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_period_idx+"/bg_eventvs_bonus.jpg"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_period_idx+"/img_eventvs_bonus_1.png"),34002==this.m_period.event_dungeon_period_idx&&this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_period_idx+"/img_eventvs_bonus_2.png"),cc.loader.load(this.m_gnrl_img,function(err,results){err||(USE_SP_EVENT_SCALE?this.startInit_SP(is_event_2nd,event_dungeon_period_idx):this.startInit(is_event_2nd,event_dungeon_period_idx))}.bind(this)),!0},startInit:function(is_event_2nd,event_dungeon_period_idx){var m=MasterManager.getInstance(),period=(event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),m.get_EventDungeonPeriod(event_dungeon_period_idx)),first_half_period_idx=(service=EventDungeonService.getInstance()).getEventDungeonFirstHalfPeriodIdx(period.event_dungeon_group_idx),second_half_period_idx=service.getEventDungeonSecondHalfPeriodIdx(period.event_dungeon_group_idx);is_event_2nd=!1,event_dungeon_period_idx=first_half_period_idx;EventDungeonService.getInstance().IsOpenDungeon(second_half_period_idx)&&(event_dungeon_period_idx=second_half_period_idx,is_event_2nd=!0),bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_period_idx+"/bg_eventvs_bonus.jpg"),bg.setPosition(ccCenter(this)),this.m_base_layer.addChild(bg);var event_priod=NetService()._event_dungeon_open_period_info.event_dungeon_open_period,period_info=$.extend({},net.User_Event_Dungeon_Open_Period_Info);for(var p in event_priod){if((e=event_priod[p]).event_dungeon_period_idx==event_dungeon_period_idx){period_info=e;break}}var accum_dma_1=Number(period_info.event_dungeon_cutin_max_accum_damage_point).toLocaleString("en"),accum_dmg=new cmMultiLabel;accum_dmg.addLabel("最高スコア :  ",LABEL_FONT_INDEX.FONT_261),accum_dmg.addLabel(cmString("%s",accum_dma_1),LABEL_FONT_INDEX.FONT_227),accum_dmg.setLabel(),accum_dmg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),accum_dmg.setPosition(480,545),this.m_base_layer.addChild(accum_dmg);var info_list;info_list=MasterTable.getInstance().get_EventDungeonCutinInfoList(this.m_period.event_dungeon_point_period_idx),(bar=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_point_period_idx+"/img_eventvs_bonus_1.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bar.setPosition(0,131),this.m_base_layer.addChild(bar);var e=info_list[0],accum_damage=m.get_EventDungeonCutinDamageAccumInfo(e.event_dungeon_cutin_damage_accum_info_idx,1),bonus_list=[];bonus_list=MasterTable.getInstance().get_EventDungeonCutinBonusItemList(accum_damage.event_dungeon_cutin_damage_accum_info_idx,1);for(var service=BattleService.getInstance(),offset_x=20,i=0;i<bonus_list.length;i++){var b=bonus_list[i],item={};service.convertBonusInfo3(b,item),(bonus=new MissionPreviewBonusItemCell).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bonus.setEnableToolTip(!0),bonus.setPosition(offset_x,10),bar.addChild(bonus),bonus.setGainItem(item),offset_x+=ccWidth(bonus)+10}if(is_event_2nd){var bar;(bar=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_period_idx+"/img_eventvs_bonus_2.png")).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),bar.setPosition(winSize.width,131),this.m_base_layer.addChild(bar);ccSize(bar),e=info_list[1],accum_damage=m.get_EventDungeonCutinDamageAccumInfo(e.event_dungeon_cutin_damage_accum_info_idx,1),bonus_list=[];bonus_list=MasterTable.getInstance().get_EventDungeonCutinBonusItemList(accum_damage.event_dungeon_cutin_damage_accum_info_idx,1);for(service=BattleService.getInstance(),offset_x=480,i=0;i<bonus_list.length;i++){var bonus;b=bonus_list[i],item={};service.convertBonusInfo3(b,item),(bonus=new MissionPreviewBonusItemCell).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),bonus.setEnableToolTip(!0),bonus.setPosition(offset_x,10),bar.addChild(bonus),bonus.setGainItem(item),offset_x-=ccWidth(bonus)+10}}},startInit_SP:function(){var m=MasterManager.getInstance(),event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=m.get_EventDungeonPeriod(event_dungeon_period_idx),first_half_period_idx=(service=EventDungeonService.getInstance()).getEventDungeonFirstHalfPeriodIdx(period.event_dungeon_group_idx),second_half_period_idx=service.getEventDungeonSecondHalfPeriodIdx(period.event_dungeon_group_idx),is_event_2nd=!1;event_dungeon_period_idx=first_half_period_idx;EventDungeonService.getInstance().IsOpenDungeon(second_half_period_idx)&&(event_dungeon_period_idx=second_half_period_idx,is_event_2nd=!0),bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_period_idx+"/bg_eventvs_bonus.jpg"),bg.setPosition(ccCenter(this)),bg.setScale(2),this.m_base_layer.addChild(bg);var event_priod=NetService()._event_dungeon_open_period_info.event_dungeon_open_period,period_info=$.extend({},net.User_Event_Dungeon_Open_Period_Info);for(var p in event_priod){if((e=event_priod[p]).event_dungeon_period_idx==event_dungeon_period_idx){period_info=e;break}}var accum_dma_1=Number(period_info.event_dungeon_cutin_max_accum_damage_point).toLocaleString("en"),accum_dmg=new cmMultiLabel;accum_dmg.addLabel("最高スコア :  ",LABEL_FONT_INDEX.FONT_261),accum_dmg.addLabel(cmString("%s",accum_dma_1),LABEL_FONT_INDEX.FONT_227),accum_dmg.setLabel(),accum_dmg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),accum_dmg.setPosition(480,545),this.m_base_layer.addChild(accum_dmg);var info_list;info_list=MasterTable.getInstance().get_EventDungeonCutinInfoList(this.m_period.event_dungeon_point_period_idx),(bar=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_point_period_idx+"/img_eventvs_bonus_1.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bar.setPosition(0,131),bar.setScale(2),this.m_base_layer.addChild(bar);var e=info_list[0],accum_damage=m.get_EventDungeonCutinDamageAccumInfo(e.event_dungeon_cutin_damage_accum_info_idx,1),bonus_list=[];bonus_list=MasterTable.getInstance().get_EventDungeonCutinBonusItemList(accum_damage.event_dungeon_cutin_damage_accum_info_idx,1);for(var service=BattleService.getInstance(),offset_x=20,i=0;i<bonus_list.length;i++){var b=bonus_list[i],item={};service.convertBonusInfo3(b,item),(bonus=new MissionPreviewBonusItemCell).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bonus.setEnableToolTip(!0),bonus.setPosition(offset_x,142),this.addChild(bonus),bonus.setGainItem(item),offset_x+=ccWidth(bonus)+10}if(is_event_2nd){var bar;(bar=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_period_idx+"/img_eventvs_bonus_2.png")).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),bar.setPosition(winSize.width,131),bar.setScale(2),this.m_base_layer.addChild(bar);ccSize(bar),e=info_list[1],accum_damage=m.get_EventDungeonCutinDamageAccumInfo(e.event_dungeon_cutin_damage_accum_info_idx,1),bonus_list=[];bonus_list=MasterTable.getInstance().get_EventDungeonCutinBonusItemList(accum_damage.event_dungeon_cutin_damage_accum_info_idx,1);for(service=BattleService.getInstance(),offset_x=1138,i=0;i<bonus_list.length;i++){var bonus;b=bonus_list[i],item={};service.convertBonusInfo3(b,item),(bonus=new MissionPreviewBonusItemCell).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),bonus.setEnableToolTip(!0),bonus.setPosition(offset_x,142),this.addChild(bonus),bonus.setGainItem(item),offset_x-=ccWidth(bonus)+10}}},onEnter:function(){this._super()},onExit:function(){if(this._super(),null!=this.m_gnrl_img){for(var idx=0;idx<this.m_gnrl_img.length;idx++)cc.loader.release(this.m_gnrl_img[idx]);this.m_gnrl_img=null}}}),EventDungeonCutinBossInfoLayer_V2=cc.Layer.extend({m_base_layer:null,m_period:null,m_gnrl_img:null,ctor:function(){this._super(),this.init()},init:function(){var winSize=ccSize(this),m=MasterManager.getInstance(),context=BattleContext._getInstance();this.m_base_layer=new cc.Layer,this.m_base_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_base_layer.ignoreAnchorPointForPosition(!1),this.m_base_layer.setPosition(ccCenter(winSize)),this.addChild(this.m_base_layer);var event_dungeon_period_idx=context.getEventDungeonPeriodIdx(),period=m.get_EventDungeonPeriod(event_dungeon_period_idx),service=EventDungeonService.getInstance(),first_half_period_idx=service.getEventDungeonFirstHalfPeriodIdx(period.event_dungeon_group_idx),middle_period_idx=service.getEventDungeonMiddleHalfPeriodIdx(period.event_dungeon_group_idx),second_half_period_idx=service.getEventDungeonSecondHalfPeriodIdx(period.event_dungeon_group_idx);event_dungeon_period_idx=first_half_period_idx;return EventDungeonService.getInstance().IsOpenDungeon(second_half_period_idx)?(event_dungeon_period_idx=second_half_period_idx,!0):EventDungeonService.getInstance().IsOpenDungeon(middle_period_idx)&&(event_dungeon_period_idx=middle_period_idx,!0),this.m_period=m.get_EventDungeonPeriod(event_dungeon_period_idx),this.m_gnrl_img=[],this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_period_idx+"/bg_eventvs_bonus.jpg"),cc.loader.load(this.m_gnrl_img,function(err,results){err||this.startInit()}.bind(this)),!0},startInit:function(){var winSize=ccSize(this),context=BattleContext._getInstance(),m=MasterManager.getInstance(),event_dungeon_period_idx=context.getEventDungeonPeriodIdx(),period=m.get_EventDungeonPeriod(event_dungeon_period_idx),service=EventDungeonService.getInstance(),first_half_period_idx=service.getEventDungeonFirstHalfPeriodIdx(period.event_dungeon_group_idx),middle_period_idx=service.getEventDungeonMiddleHalfPeriodIdx(period.event_dungeon_group_idx),second_half_period_idx=service.getEventDungeonSecondHalfPeriodIdx(period.event_dungeon_group_idx),is_event_2nd=!1,is_event_middle=!1;event_dungeon_period_idx=first_half_period_idx,EventDungeonService.getInstance().IsOpenDungeon(second_half_period_idx)?(event_dungeon_period_idx=second_half_period_idx,is_event_middle=is_event_2nd=!0):EventDungeonService.getInstance().IsOpenDungeon(middle_period_idx)&&(event_dungeon_period_idx=middle_period_idx,is_event_middle=!0);var bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_"+this.m_period.event_dungeon_period_idx+"/bg_eventvs_bonus.jpg");bg.setPosition(ccCenter(this)),this.m_base_layer.addChild(bg);var event_dungeon_open_period=NetService()._event_dungeon_open_period_info.event_dungeon_open_period,period_info=$.extend({},net.User_Event_Dungeon_Open_Period_Info);for(var p in event_dungeon_open_period){var e=event_dungeon_open_period[p];if(e.event_dungeon_period_idx==event_dungeon_period_idx){period_info=e;break}}var accum_dmg=cmLabel.getLabel(cmString(res_str("label_event_max_accum_damage"),period_info.event_dungeon_cutin_max_accum_damage_point),LABEL_FONT_INDEX.FONT_261);accum_dmg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),accum_dmg.setPosition(.5*winSize.width,536),bg.addChild(accum_dmg);var first_node=new EventDungeonCutinBossInfoNode(first_half_period_idx,!0);first_node.setAnchorPoint(ZERO()),first_node.setPosition(626,416),bg.addChild(first_node,100);var middle_node=new EventDungeonCutinBossInfoNode(middle_period_idx,is_event_middle);middle_node.setAnchorPoint(ZERO()),middle_node.setPosition(626,283),bg.addChild(middle_node,101);var second_node=new EventDungeonCutinBossInfoNode(second_half_period_idx,is_event_2nd);second_node.setAnchorPoint(ZERO()),second_node.setPosition(626,150),bg.addChild(second_node,102)},onEnter:function(){this._super()},onExit:function(){if(this._super(),null!=this.m_gnrl_img){for(var idx=0;idx<this.m_gnrl_img.length;idx++)cc.loader.release(this.m_gnrl_img[idx]);this.m_gnrl_img=null}}}),EventDungeonCutinBossInfoScene=GameScene.extend({m_info_layer:null,m_gameObserver:null,ctor:function(){this._super(scene_EventDungeonCutinBossInfoScene)},init:function(){this.initLayoutProgress2(),this.m_gameObserver=MainObserver.getInstance(),this.m_gameObserver.addObserver(this.onNotification,this,sceneStr[scene_EventDungeonCutinBossInfoScene]);cc.director.getWinSize();this.m_info_layer=new EventDungeonCutinBossInfoLayer,this.addChild(this.m_info_layer);var statusLayer=new StatusLayer(INVOKER_TYPE.normal);statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer);var back_btn=new ccui.Button;back_btn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png",""),back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(){this.back()}.bind(this)),this.addChild(back_btn);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_eventvs.png");return title.setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title),this.scheduleOnce(this.removeProgressEnd,1),!0},removeProgressEnd:function(){this.removeLayerProgress2()},onEnter:function(){this._super();var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx);cmString("BGM_marathon_loop_%d.mp3",period.event_dungeon_point_period_idx)},onExit:function(){this._super(),this.m_gameObserver.removeObserver(sceneStr[scene_EventDungeonCutinBossInfoScene]),this.removeChild(this.m_info_layer),this.removeAllChildrenWithCleanup(!0),null!=this.m_info_layer&&(this.m_info_layer=null)},back:function(){this.onKeyBack(!0)},onNotification:function(msg){return!this._super(msg)},onNetworkEvent:function(opcode,body){}}),EventDungeonVoteLeagueV3EntranceLayer=cc.Layer.extend({m_is_prv_event_dungeon:!1,m_first_half_period_idx:0,m_second_half_period_idx:0,m_event_dungeon_group_idx:0,m_event_dungeon_point:null,m_event_dungeon_cutin_accum_rate_point:null,m_Schedule_popup:null,m_Result_Popup:null,m_achv_new_icon:null,m_reward_new_icon:null,m_Schedule_View:null,m_gnrl_img:[],ctor:function(){this._super(),this.m_event_dungeon_point={},this.m_event_dungeon_cutin_accum_rate_point={},this.m_gnrl_img=[],this.init()},init:function(){ccSize(this);var service=EventDungeonService.getInstance(),m=MasterTable.getInstance(),context=BattleContext._getInstance(),event_dungeon_period_idx=0;this.m_is_prv_event_dungeon=context.getIsPrvEventDungeon(),event_dungeon_period_idx=this.m_is_prv_event_dungeon?context.getPrvEventDungeonPeriodIdx():context.getEventDungeonPeriodIdx(),this.m_period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx);for(var period_list=(new NetService)._event_dungeon_open_period_info.event_dungeon_open_period,idx=0;idx<period_list.length;idx++){var e=period_list[idx];if(e.event_dungeon_period_idx==event_dungeon_period_idx){e;break}}service.getUserEventDungeonPoint(this.m_period.event_dungeon_group_idx,this.m_event_dungeon_point),service.getUserEventDungeonCutinAccumRatePoint(this.m_period.event_dungeon_group_idx,this.m_event_dungeon_cutin_accum_rate_point),this.m_event_dungeon_group_idx=this.m_period.event_dungeon_group_idx,this.m_first_half_period_idx=service.getEventDungeonFirstHalfPeriodIdx(this.m_event_dungeon_group_idx),this.m_second_half_period_idx=service.getEventDungeonSecondHalfPeriodIdx(this.m_event_dungeon_group_idx);var period_idx=this.m_first_half_period_idx;this.m_is_prv_event_dungeon?service.IsOpenEventPointPeriod(this.m_second_half_period_idx)&&(period_idx=this.m_second_half_period_idx):service.IsOpenDungeon(this.m_second_half_period_idx)&&(period_idx=this.m_second_half_period_idx),this.m_gnrl_img.push(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_thema_off.png",period_idx)),this.m_gnrl_img.push(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_thema_on.png",period_idx)),this.m_gnrl_img.push(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_info.png",period_idx)),this.m_gnrl_img.push(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_info_boss.png",period_idx)),this.m_gnrl_img.push(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_banner_thema.png",period_idx)),this.m_gnrl_img.push(RES_CDN_DEFULT+cmString("common/img_9p_script_box_2.png")),resourceLoader(this.m_gnrl_img,function(){var bg=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/bg_eventvs_main.jpg",this.m_period.event_dungeon_group_idx));bg.setPosition(ccCenter(this)),USE_SP_EVENT_SCALE&&bg.setScale(2),this.addChild(bg);var label_bg=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_league.png",this.m_period.event_dungeon_group_idx));label_bg.setAnchorPoint(ANCHOR_TOP_RIGHT()),IS_SP_BROWSER?(label_bg.setPosition(ccWidth(this),ccHeight(this)-54),label_bg.setScale(2),this.addChild(label_bg)):(label_bg.setPosition(ccWidth(this),ccHeight(this)-54),bg.addChild(label_bg));var group_data=this.open_list();null==group_data.league_group_title&&(group_data.league_group_title="");var group_label=cmLabel.getLabel(group_data.league_group_title,LABEL_FONT_INDEX.FONT_1810);group_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),group_label.setPosition(ccWidth(this)-10,ccHeight(this)-59),USE_SP_EVENT_SCALE?this.addChild(group_label):bg.addChild(group_label),null==group_data.schedule_info&&(group_data.schedule_info="");var Schedule_label=cmLabel.getLabel(group_data.schedule_info,LABEL_FONT_INDEX.FONT_143);Schedule_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),Schedule_label.setPosition(ccWidth(this)-10,ccHeight(this)-87),USE_SP_EVENT_SCALE?this.addChild(Schedule_label):bg.addChild(Schedule_label);var left_layer=this.getLeftLayer();left_layer.ignoreAnchorPointForPosition(!1),left_layer.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),left_layer.setPosition(10,10),this.addChild(left_layer);var right_pos_y=0;if(USE_SP_EVENT_SCALE){var right_layer=this.getRightLayer_SP();this.addChild(right_layer)}else{(right_layer=this.getRightLayer()).ignoreAnchorPointForPosition(!1),right_layer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),right_layer.setPosition(ccWidth(this),0),this.addChild(right_layer)}right_pos_y+=ccHeight(right_layer)+10;var Schedule_btn=new LabelButton("btn_53_off.png","btn_53_on.png","",ccui.Widget.PLIST_TEXTURE);Schedule_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),Schedule_btn.setPosition(ccWidth(this)-17,right_pos_y),Schedule_btn.setFont(LABEL_FONT_INDEX.FONT_143),Schedule_btn.setString(res_str("label_event_dungeon_vote_league_schedule_result")),this.addChild(Schedule_btn),Schedule_btn.addClickEventListener(function(sender){this.showSchedulePopup()}.bind(this)),m.get_EventVoteLeagueGroupList(m.get_EventVoteLeagueV3(this.m_event_dungeon_group_idx)).size()<=1&&Schedule_btn.setVisible(!1),right_pos_y+=ccHeight(Schedule_btn)+10;var theme_btn=new LabelButton(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_thema_off.png",period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_thema_on.png",period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_thema_off.png",period_idx));theme_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),USE_SP_EVENT_SCALE?(theme_btn.setScale(2),theme_btn.setPosition(ccWidth(this)-17,right_pos_y+10)):(theme_btn.setScale(1),theme_btn.setPosition(ccWidth(this)-17,right_pos_y-50)),this.addChild(theme_btn),theme_btn.addClickEventListener(function(sender){this.showResultPopup(period_idx)}.bind(this));var help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE);return help_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),help_btn.setPosition(10,476),this.addChild(help_btn),help_btn.addClickEventListener(function(sender){GameContext.getInstance().setHelpInfoIndexByCallIndex(2);var scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null}.bind(this)),this.m_Schedule_popup=new GameModalLayer,this.addChild(this.m_Schedule_popup),!0}.bind(this))},getLeftLayer:function(){var layer=new cc.Layer,service=EventDungeonService.getInstance(),period_idx=this.m_first_half_period_idx;service.IsOpenDungeon(this.m_second_half_period_idx)&&(period_idx=this.m_second_half_period_idx);var btn_pos_y=0;if(!this.m_is_prv_event_dungeon){var boss_info_img=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_info_boss.png",period_idx));boss_info_img.setAnchorPoint(ZERO()),boss_info_img.setPosition(0,btn_pos_y),USE_SP_EVENT_SCALE&&boss_info_img.setScale(2),this.addChild(boss_info_img),IS_SP_BROWSER?btn_pos_y+=ccHeight(boss_info_img)+95:btn_pos_y+=ccHeight(boss_info_img)+20}var event_mission_btn=new ccui.Button("btn_eventvs_reward_off.png","btn_eventvs_reward_on.png","",ccui.Widget.PLIST_TEXTURE);(event_mission_btn.setAnchorPoint(ZERO()),IS_SP_BROWSER?event_mission_btn.setPosition(10,btn_pos_y+10):event_mission_btn.setPosition(10,btn_pos_y),layer.addChild(event_mission_btn,1),event_mission_btn.addClickEventListener(function(sender){if(USE_EVENT_DUNGEON_ACHIEVEMENT){var scene=new EventDungeonAchievementScene_V2;SceneManager.getInstance().replaceScene(scene),scene=null}else GameContext.getInstance().setAchievementTap(ACHIEVEMENT_EVENTDUNGEON),MainObserver.getInstance().postNotification(NOTIFY_MENU_ACHIEV)}.bind(this)),event_mission_btn.setEnabled(!this.m_is_prv_event_dungeon),this.m_achv_new_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_achv_new_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_achv_new_icon.setPosition(ccWidth(event_mission_btn),ccHeight(event_mission_btn)),event_mission_btn.addChild(this.m_achv_new_icon),this.m_achv_new_icon.setVisible(!1),null!=this.m_achv_new_icon)?AchievementService.getInstance().isNewCompleteAchievementEventDungeon(this.m_period.event_dungeon_group_idx)?this.m_achv_new_icon.setVisible(!0):this.m_achv_new_icon.setVisible(!1):this.m_achv_new_icon.setVisible(!1);btn_pos_y+=ccHeight(event_mission_btn)+10;service.IsExistPrevEventDungeon(this.m_period.event_dungeon_group_idx);if(!this.m_is_prv_event_dungeon){var prv_event_dungeon_btn=new LabelButton("btn_36_off.png","btn_36_on.png","btn_36_none.png",ccui.Widget.PLIST_TEXTURE);prv_event_dungeon_btn.setFont(LABEL_FONT_INDEX.FONT_181),prv_event_dungeon_btn.setString(res_str("btn_label_prev_event_reward")),prv_event_dungeon_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),IS_SP_BROWSER?prv_event_dungeon_btn.setPosition(10,btn_pos_y+10):prv_event_dungeon_btn.setPosition(10,btn_pos_y),layer.addChild(prv_event_dungeon_btn),prv_event_dungeon_btn.addClickEventListener(function(sender){BattleContext._getInstance().setPrvEventDungeonPeriodIdx(this.m_period.prev_event_dungeon_group_idx),MainObserver.getInstance().postNotification(NOTIFY_MENU_PRV_EVENT_DUNGEON_ENTRANCE)}.bind(this)),btn_pos_y+=ccHeight(prv_event_dungeon_btn)+10}var vote_reward_btn=new LabelButton("btn_36_off.png","btn_36_on.png","btn_36_none.png",ccui.Widget.PLIST_TEXTURE);return vote_reward_btn.setFont(LABEL_FONT_INDEX.FONT_181),vote_reward_btn.setString(res_str("btn_label_event_vote_reward")),vote_reward_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),IS_SP_BROWSER?vote_reward_btn.setPosition(10,btn_pos_y+10):vote_reward_btn.setPosition(10,btn_pos_y),layer.addChild(vote_reward_btn,1),vote_reward_btn.addClickEventListener(function(sender){var scene=new EventDungeonVoteLeagueV3VoteRewardScene;SceneManager.getInstance().replaceScene(scene),scene=null}.bind(this)),this.m_reward_new_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_reward_new_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_reward_new_icon.setPosition(ccWidth(vote_reward_btn),ccHeight(vote_reward_btn)),vote_reward_btn.addChild(this.m_reward_new_icon),this.m_reward_new_icon.setVisible(!1),btn_pos_y+=ccHeight(vote_reward_btn)+10,layer},getRightLayer:function(){var layer=new cc.Layer,mt=MasterManager.getInstance(),service=EventDungeonService.getInstance(),first_period=mt.get_EventDungeonPeriod(this.m_first_half_period_idx),second_period=mt.get_EventDungeonPeriod(this.m_second_half_period_idx),offset_x=ccWidth(this)-17,offset_y=16,second_half_btn=new LabelButton("btn_07_off.png","btn_07_on.png","btn_07_none.png",ccui.Widget.PLIST_TEXTURE);second_half_btn.setFont(LABEL_FONT_INDEX.FONT_201),second_half_btn.setString(res_str("label_event_dungeon_second_half_enter_text")),second_half_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),second_half_btn.setPosition(offset_x,offset_y),layer.addChild(second_half_btn),second_half_btn.addClickEventListener(function(sender){this.entranceDungeonList(this.m_second_half_period_idx)}.bind(this)),offset_x-=ccWidth(second_half_btn);var first_half_btn=new LabelButton("btn_07_off.png","btn_07_on.png","btn_07_none.png",ccui.Widget.PLIST_TEXTURE);first_half_btn.setFont(LABEL_FONT_INDEX.FONT_201),first_half_btn.setString(res_str("label_event_dungeon_first_half_enter_text")),first_half_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),first_half_btn.setPosition(offset_x,offset_y),layer.addChild(first_half_btn),first_half_btn.addClickEventListener(function(sender){this.entranceDungeonList(this.m_first_half_period_idx)}.bind(this)),offset_x-=ccWidth(first_half_btn),offset_y+=ccHeight(first_half_btn)+5,this.m_is_prv_event_dungeon?(second_half_btn.setEnabled(!1),first_half_btn.setEnabled(!1)):(second_half_btn.setEnabled(service.IsOpenDungeon(this.m_second_half_period_idx)),first_half_btn.setEnabled(service.IsOpenDungeon(this.m_first_half_period_idx)));var is_second=!1,period_idx=this.m_first_half_period_idx;this.m_is_prv_event_dungeon?service.IsOpenEventPointPeriod(this.m_second_half_period_idx)&&(period_idx=this.m_second_half_period_idx,first_period.event_dungeon_point_period_idx!=second_period.event_dungeon_point_period_idx&&(is_second=!0)):service.IsOpenDungeon(this.m_second_half_period_idx)&&(period_idx=this.m_second_half_period_idx,first_period.event_dungeon_point_period_idx!=second_period.event_dungeon_point_period_idx&&(is_second=!0));var point_box=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_info.png",period_idx));point_box.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),point_box.setPosition(ccWidth(this)-17,offset_y),layer.addChild(point_box),offset_y+=ccHeight(point_box);var point_pos_y=26,btn_pos_y=16;if(is_second){var event_dungeon_point={};service.getUserEventDungeonPoint(this.m_second_half_period_idx,event_dungeon_point),(event_point_count=cmLabel.getLabel(cmString(res_str("label_event_dungeon_own_point"),Number(event_dungeon_point.event_point).toLocaleString("en")),LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),event_point_count.setPosition(266,point_pos_y),point_box.addChild(event_point_count),(vote_btn=new LabelButton("btn_39_off.png","btn_39_on.png","btn_39_none.png",ccui.Widget.PLIST_TEXTURE)).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),vote_btn.setPosition(ccWidth(point_box)-14,btn_pos_y),point_box.addChild(vote_btn,3),vote_btn.addClickEventListener(function(sender){this.reqVoteRankingInfo(this.m_second_half_period_idx)}.bind(this)),vote_btn.setFont(LABEL_FONT_INDEX.FONT_221),vote_btn.setString(res_str("btn_label_voting")),vote_btn.setEnabled(!this.m_is_prv_event_dungeon),btn_pos_y+=50,point_pos_y+=50}var event_point_count,vote_btn;event_dungeon_point={};return service.getUserEventDungeonPoint(this.m_first_half_period_idx,event_dungeon_point),(event_point_count=cmLabel.getLabel(cmString(res_str("label_event_dungeon_own_point"),Number(event_dungeon_point.event_point).toLocaleString("en")),LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),event_point_count.setPosition(266,point_pos_y),point_box.addChild(event_point_count),(vote_btn=new LabelButton("btn_39_off.png","btn_39_on.png","btn_39_none.png",ccui.Widget.PLIST_TEXTURE)).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),vote_btn.setPosition(ccWidth(point_box)-14,btn_pos_y),point_box.addChild(vote_btn,3),vote_btn.addClickEventListener(function(sender){this.reqVoteRankingInfo(this.m_first_half_period_idx)}.bind(this)),vote_btn.setFont(LABEL_FONT_INDEX.FONT_221),vote_btn.setString(res_str("btn_label_voting")),vote_btn.setEnabled(!this.m_is_prv_event_dungeon),layer.setContentSize(ccWidth(this),offset_y),layer},getRightLayer_SP:function(){var layer=new cc.Layer,mt=MasterManager.getInstance(),service=EventDungeonService.getInstance(),first_period=mt.get_EventDungeonPeriod(this.m_first_half_period_idx),second_period=mt.get_EventDungeonPeriod(this.m_second_half_period_idx),offset_x=ccWidth(this)-17,offset_y=16,second_half_btn=new LabelButton("btn_07_off.png","btn_07_on.png","btn_07_none.png",ccui.Widget.PLIST_TEXTURE);second_half_btn.setFont(LABEL_FONT_INDEX.FONT_201),second_half_btn.setString(res_str("label_event_dungeon_second_half_enter_text")),second_half_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),second_half_btn.setPosition(offset_x,offset_y),layer.addChild(second_half_btn),second_half_btn.addClickEventListener(function(sender){this.entranceDungeonList(this.m_second_half_period_idx)}.bind(this)),offset_x-=ccWidth(second_half_btn);var first_half_btn=new LabelButton("btn_07_off.png","btn_07_on.png","btn_07_none.png",ccui.Widget.PLIST_TEXTURE);first_half_btn.setFont(LABEL_FONT_INDEX.FONT_201),first_half_btn.setString(res_str("label_event_dungeon_first_half_enter_text")),first_half_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),first_half_btn.setPosition(offset_x,offset_y),layer.addChild(first_half_btn),first_half_btn.addClickEventListener(function(sender){this.entranceDungeonList(this.m_first_half_period_idx)}.bind(this)),offset_x-=ccWidth(first_half_btn),offset_y+=ccHeight(first_half_btn)+5,this.m_is_prv_event_dungeon?(second_half_btn.setEnabled(!1),first_half_btn.setEnabled(!1)):(second_half_btn.setEnabled(service.IsOpenDungeon(this.m_second_half_period_idx)),first_half_btn.setEnabled(service.IsOpenDungeon(this.m_first_half_period_idx)));var is_second=!1,period_idx=this.m_first_half_period_idx;this.m_is_prv_event_dungeon?service.IsOpenEventPointPeriod(this.m_second_half_period_idx)&&(period_idx=this.m_second_half_period_idx,first_period.event_dungeon_point_period_idx!=second_period.event_dungeon_point_period_idx&&(is_second=!0)):service.IsOpenDungeon(this.m_second_half_period_idx)&&(period_idx=this.m_second_half_period_idx,first_period.event_dungeon_point_period_idx!=second_period.event_dungeon_point_period_idx&&(is_second=!0));var point_box=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_info.png",period_idx));point_box.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),point_box.setPosition(ccWidth(this)-17,offset_y),point_box.setScale(2),layer.addChild(point_box),offset_y+=ccHeight(point_box);var point_pos_y=26,btn_pos_y=16;if(is_second){var event_dungeon_point={};service.getUserEventDungeonPoint(this.m_second_half_period_idx,event_dungeon_point),(event_point_count=cmLabel.getLabel(cmString(res_str("label_event_dungeon_own_point"),Number(event_dungeon_point.event_point).toLocaleString("en")),LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),event_point_count.setPosition(952,point_pos_y+81),this.addChild(event_point_count,10),(vote_btn=new LabelButton("btn_39_off.png","btn_39_on.png","btn_39_none.png",ccui.Widget.PLIST_TEXTURE)).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),vote_btn.setPosition(ccWidth(point_box)+884,btn_pos_y+82),this.addChild(vote_btn,3),vote_btn.addClickEventListener(function(sender){this.reqVoteRankingInfo(this.m_second_half_period_idx)}.bind(this)),vote_btn.setFont(LABEL_FONT_INDEX.FONT_221),vote_btn.setString(res_str("btn_label_voting")),vote_btn.setEnabled(!this.m_is_prv_event_dungeon),btn_pos_y+=50,point_pos_y+=50}var event_point_count,vote_btn;event_dungeon_point={};return service.getUserEventDungeonPoint(this.m_first_half_period_idx,event_dungeon_point),(event_point_count=cmLabel.getLabel(cmString(res_str("label_event_dungeon_own_point"),Number(event_dungeon_point.event_point).toLocaleString("en")),LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),event_point_count.setPosition(952,point_pos_y+81),this.addChild(event_point_count,10),(vote_btn=new LabelButton("btn_39_off.png","btn_39_on.png","btn_39_none.png",ccui.Widget.PLIST_TEXTURE)).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),vote_btn.setPosition(ccWidth(point_box)+884,btn_pos_y+82),this.addChild(vote_btn,3),vote_btn.addClickEventListener(function(sender){this.reqVoteRankingInfo(this.m_first_half_period_idx)}.bind(this)),vote_btn.setFont(LABEL_FONT_INDEX.FONT_221),vote_btn.setString(res_str("btn_label_voting")),vote_btn.setEnabled(!this.m_is_prv_event_dungeon),layer.setContentSize(ccWidth(this),offset_y),layer},entranceDungeonList:function(event_dungeon_period_idx){if(!EventDungeonService.getInstance().IsOpenDungeon(event_dungeon_period_idx))return!1;BattleContext._getInstance().setEventDungeonPeriodIdX(event_dungeon_period_idx);var scene=new EventDungeonListScene;return SceneManager.getInstance().replaceScene(scene),!0},reqVoteRankingInfo:function(event_dungeon_period_idx){var scene=new EventDungeonVoteLeagueV3Scene(event_dungeon_period_idx);SceneManager.getInstance().replaceScene(scene)},refreshEventDungeonAchvNewIcon:function(){for(var service=EventDungeonService.getInstance(),period_list=MasterTable.getInstance().get_EventDungeonPeriodList(this.m_period.event_dungeon_group_idx),is_new=!1,i=0;i<period_list.length;i++){var p=period_list[i];if(service.IsOpenDungeon(p.event_dungeon_period_idx)&&service.IsEnableGainEventDungeonAchvReward(p.event_dungeon_period_idx)){is_new=!0;break}}null!=this.m_achv_new_icon&&this.m_achv_new_icon.setVisible(is_new)},onEnter:function(){this._super()},onExit:function(){this._super()},showSchedulePopup:function(){this.m_Schedule_popup.setContentSize(ccSize(this)),this.m_Schedule_popup._contentNode=function(contentSize,m){var layer=new cc.Layer,bg_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());bg_mask.setPosition(ccCenter(this)),bg_mask.setContentSize(ccSize(this)),layer.addChild(bg_mask);var bg=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",RectZero());bg.setInsetLeft(44),bg.setInsetRight(44),bg.setInsetTop(44),bg.setInsetBottom(44),bg.setPreferredSize(cc.size(558,470)),bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(this)),layer.addChild(bg);var navi=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_navi.png",RectZero());navi.setInsetLeft(46),navi.setInsetRight(46),navi.setPreferredSize(cc.size(542,48)),navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(bg).x,ccHeight(bg)-11),bg.addChild(navi);var title_label=cmLabel.getLabel(res_str("event_raid_epilogue_popup_title"),LABEL_FONT_INDEX.FONT_241);title_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),title_label.setPosition(.5*ccWidth(navi),16),navi.addChild(title_label);var back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);return back_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),back_btn.setPosition(ccWidth(navi)-11,7),back_btn.addClickEventListener(function(sender){this.hideSchedulePopup()}.bind(this)),navi.addChild(back_btn),this.m_Schedule_View=new cc.TableView(this,cc.size(524,372)),this.m_Schedule_View.setPosition(17,27),this.m_Schedule_View.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_Schedule_View.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_Schedule_View.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_Schedule_View.setDelegate(this),bg.addChild(this.m_Schedule_View),this.reloadTableView(),layer}.bind(this),this.m_Schedule_popup.show()},hideSchedulePopup:function(){this.m_Schedule_popup.is_show()&&this.m_Schedule_popup.hide()},showResultPopup:function(period_idx){this.getParent().showResultPopupScene(period_idx)},hideResultPopup:function(){this.m_Result_Popup.is_show()&&this.m_Result_Popup.hide()},reloadTableView:function(){var offset=this.m_Schedule_View.getContentOffset();this.m_Schedule_View.reloadData(),this.m_Schedule_View.setContentOffset(offset)},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;return(cell=null!=c?c:new EventDungeonVoteLeagueV3ScheduleCell).setData(idx,this.m_event_dungeon_group_idx),cell},numberOfCellsInTableView:function(table){return 1},tableCellSizeForIndex:function(table,idx){return 0==idx?cc.size(524,78):cc.size(524,120)},cellSizeForTable:function(table){return cc.size(524,78)},tableCellTouched:function(table,cell){},tableCellHighlight:function(table,cell){},tableCellUnhighlight:function(table,cell){},tableCellEnded:function(table){},open_list:function(){for(var data=[],now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),season_idx=MasterTable.getInstance().get_EventVoteLeagueV3(this.m_event_dungeon_group_idx),Group_list=MasterTable.getInstance().get_EventVoteLeagueGroupList(season_idx),i=0;i<Group_list.length;i++)if("n"!=Group_list[i].data_on_off){var begin_dt=moment(Group_list[i].begin_dt),end_dt=moment(Group_list[i].end_dt),b=begin_dt.valueOf(),e=end_dt.valueOf();n<b||e<n||(data=$.extend({},Group_list[i]))}return data},updateRewardNewIcon:function(list){if(null!=this.m_reward_new_icon){for(var is_enable_reward=!1,i=0;i<list.length;i++){if(-1!=list[i].reward_list.findIndex(function(r){return"y"==r.complete_yn&&"n"==r.reward_yn}.bind(this))){is_enable_reward=!0;break}}this.m_reward_new_icon.setVisible(is_enable_reward)}}}),VOTE_LIST_PAGE=1,USER_VOTE_PAGE=2,GLOBAL_VOTE_PAGE=3,EventVoteEnum={BTN_VOTE:1,VOTE_COMPLETE_POPUP:2},EventVoteSortEnum={SORT_RECORD:1,SORT_RANKING:2,SORT_NAME:3},EventDungeonVoteLeagueV3EntranceScene=GameScene.extend({m_entrance_layer:null,m_statusLayer:null,m_Result_Popup_Scene:null,ctor:function(){this._super(scene_EventDungeonVoteLeagueV3EntranceScene)},init:function(){cc.director.getWinSize();var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),context=BattleContext._getInstance();event_dungeon_period_idx=context.getIsPrvEventDungeon()?context.getPrvEventDungeonPeriodIdx():context.getEventDungeonPeriodIdx(),this.m_period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),this.m_entrance_layer=new EventDungeonVoteLeagueV3EntranceLayer,this.addChild(this.m_entrance_layer),this.m_statusLayer=new StatusLayer,this.m_statusLayer.initLayout(),this.m_statusLayer.ignoreAnchorPointForPosition(!1),this.m_statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(this.m_statusLayer);var back_btn=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png","");back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(sender){this.back()}.bind(this)),this.addChild(back_btn);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_eventvs.png");return title.setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title),this.m_Result_Popup_Scene=new GameModalLayer,this.addChild(this.m_Result_Popup_Scene),!0},showResultPopupScene:function(period_idx){this.m_Result_Popup_Scene.setContentSize(ccSize(this)),this.m_Result_Popup_Scene._contentNode=function(contentSize,m){var layer=new cc.Layer,bg_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());bg_mask.setPosition(ccCenter(this)),bg_mask.setContentSize(ccSize(this)),layer.addChild(bg_mask);var back_btn,bg=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_banner_thema.png",period_idx));(bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(.5*ccWidth(this),.5*ccHeight(this)),USE_SP_EVENT_SCALE?bg.setScale(2):bg.setScale(1),layer.addChild(bg),USE_SP_EVENT_SCALE)?((back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE)).setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(bg)+550,ccHeight(bg)+310),back_btn.addClickEventListener(function(sender){this.hideResultPopupScene(),back_btn.setVisible(!1)}.bind(this)),layer.addChild(back_btn)):((back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE)).setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(bg)-12,ccHeight(bg)-12),back_btn.addClickEventListener(function(sender){this.hideResultPopupScene()}.bind(this)),bg.addChild(back_btn));return layer}.bind(this),this.m_Result_Popup_Scene.show()},hideResultPopupScene:function(){this.m_Result_Popup_Scene.is_show()&&this.m_Result_Popup_Scene.hide()},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_EventDungeonVoteLeagueV3EntranceScene]);var audio=AudioEngine.getInstance(),m=MasterTable.getInstance();if(BattleContext._getInstance().getIsPrvEventDungeon())var bgm=m.get_Bgm_v2(BGM_TYPE_PRV_EVENT_MAIN_BGM);else{var period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();bgm=m.get_EventDungeonFromEventDungeonPeriodIdx(period_idx).event_dungeon_type==EVENT_DUNGEON_TYPE_LINLIN?m.get_Bgm_v2(BGM_TYPE_CRAFT_EVENT_MAIN_BGM):m.get_Bgm_v2(BGM_TYPE_EVENT_MAIN_BGM)}var main_bgm=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm.sound_file_name;audio.m_bgmPath!=main_bgm&&(audio.stopBackgroundMusic(),audio.m_bgmPath="",audio.playBackgroundMusic(main_bgm,!0))},onExit:function(){this._super(),MainObserver.getInstance().removeObserver(sceneStr[scene_EventDungeonVoteLeagueV3EntranceScene])},onEnterTransitionDidFinish:function(){this._super();var req={};req.opcode=net.OP.op_event_vote_league_group_info_V3,req.event_dungeon_period_idx=this.m_period.event_dungeon_group_idx,this.network_write(req);var req2={};if(req2.opcode=net.OP.op_user_event_dungeon_vote_reward_info_V3,req2.event_dungeon_group_idx=this.m_period.event_dungeon_group_idx,this.network_write(req2),USE_EVENT_DUNGEON_ACHIEVEMENT){var context=BattleContext._getInstance(),event_dungeon_period_idx=0;if(!context.getIsPrvEventDungeon()){event_dungeon_period_idx=context.getEventDungeonPeriodIdx();var period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),req3={};req3.opcode=net.OP.op_user_event_dungeon_achv_list,req3.event_dungeon_period_idx=period.event_dungeon_group_idx,this.network_write(req3)}}},onNotification:function(msg){this._super(msg)},showPrevEventScript:function(event_dungeon_idx){},cbHideEventScript:function(opcode,state,body){},onNetworkEvent:function(opcode,state,body){this._super(opcode,state,body),opcode==net.OP.op_user_event_dungeon_vote_reward_info_V3?body.error==net.ERROR.NET_E_SUCCESS&&this.m_entrance_layer.updateRewardNewIcon(body.vote_reward_info_list):opcode==net.OP.op_user_event_dungeon_achv_list&&USE_EVENT_DUNGEON_ACHIEVEMENT&&this.m_entrance_layer.refreshEventDungeonAchvNewIcon()},back:function(){BattleContext._getInstance().setIsPrvEventDungeon(!1),this.onKeyBack(!0)}}),EventDungeonVoteLeagueV3Layer=cc.Layer.extend({m_league_idx:0,m_league_group_idx:0,m_vote_tap:0,m_vote_count:0,m_right_layer:null,left_layer:null,m_gnrl_body:null,m_event_point_label:null,m_gnrl_name_label:null,m_vote_paper_pos:null,m_vote_count_label:null,m_vote_slider:null,m_ranking_gnrl_name:null,m_ranking_count_label:null,m_slider_layer:null,m_ranking_layer:null,m_period_box:null,m_league_period_label:null,m_vote_label:null,m_tab_btns:[],m_league_group_list:[],m_league_list:[],m_tab_scrollview:null,m_tableView:null,m_vote_guide:null,m_league_info_list:[],m_vote_list:[],m_vote_tableView:null,m_ranking_close_label:null,m_vote_btn:null,m_vote_record_btn:null,m_ranking_btn:null,m_event_dungeon_point:null,event_dungeon_period_idx:0,m_second_event_point_label:null,m_first_point_box:null,m_second_point_box:null,m_vote_ranking_view_time:null,m_sortLayer:null,m_sortNavyLayer:null,m_is_sort_desc:!0,m_sort_index:EventVoteSortEnum.SORT_RECORD,m_is_sort_btn_visible:!1,m_NextPage:VOTE_LIST_PAGE,m_vote_idx:0,m_gnrl_info_list:[],ctor:function(period_idx,Vote_End,vote_group_idx){this._super(),this.m_event_dungeon_point={},this.m_tab_btns=[],this.m_league_group_list=[],this.m_league_list=[],this.m_league_info_list=[],this.m_vote_list=[],this.m_gnrl_info_list=[],this.init_Layout(period_idx,Vote_End,vote_group_idx)},init_Layout:function(period_idx,Vote_End,vote_group_idx){this.m_Vote_End=Vote_End,this.m_vote_idx=0;var m=MasterManager.getInstance(),service=EventDungeonService.getInstance();this.event_dungeon_period_idx=period_idx,this.m_period=m.get_EventDungeonPeriod(this.event_dungeon_period_idx),service.getUserEventDungeonPoint(this.m_period.event_dungeon_point_period_idx,this.m_event_dungeon_point),0==this.m_Vote_End?this.m_league_group_idx=NetService().get_Event_Vote_League_Group_Idx_V3():this.m_league_group_idx=vote_group_idx,this.m_league_list=MasterTable.getInstance().get_EventVoteLeagueList(this.m_league_group_idx);var bg=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/bg_eventvs_vote.jpg",this.event_dungeon_period_idx));bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(this)),USE_SP_EVENT_SCALE?bg.setScale(2):bg.setScale(1),this.addChild(bg),this.m_vote_tap=1,this.m_resource_list=[];var first_half_period_idx=service.getEventDungeonFirstHalfPeriodIdx(this.m_period.event_dungeon_group_idx),second_half_period_idx=service.getEventDungeonSecondHalfPeriodIdx(this.m_period.event_dungeon_group_idx);return this.m_resource_list.push(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_vote_frame.png",this.event_dungeon_period_idx)),this.m_resource_list.push(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/btn_eventvs_votebox.png",this.event_dungeon_period_idx)),this.m_resource_list.push(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/btn_eventvs_votebox_result.png",this.event_dungeon_period_idx)),this.m_resource_list.push(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_vote_pointbox.png",first_half_period_idx)),this.m_resource_list.push(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_vote_pointbox.png",second_half_period_idx)),this.m_resource_list.push(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/btn_eventvs_vote_none.png",this.event_dungeon_period_idx)),this.m_resource_list.push(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/btn_eventvs_vote_on.png",this.event_dungeon_period_idx)),this.m_resource_list.push(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/btn_eventvs_vote_off.png",this.event_dungeon_period_idx)),resourceLoader(this.m_resource_list,function(){var left_layer=this.getLeftLayer();left_layer.setAnchorPoint(ZERO()),left_layer.setPosition(ZERO()),this.addChild(left_layer),this.m_right_layer=this.getRightLayer(),this.m_right_layer.ignoreAnchorPointForPosition(!1),this.m_right_layer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_right_layer.setPosition(ccWidth(this),0),this.addChild(this.m_right_layer,2)}.bind(this)),!0},updatePointBox:function(){var service=EventDungeonService.getInstance(),first_half_period_idx=service.getEventDungeonFirstHalfPeriodIdx(this.m_period.event_dungeon_group_idx),second_half_period_idx=service.getEventDungeonSecondHalfPeriodIdx(this.m_period.event_dungeon_group_idx),first_point={};if(service.getUserEventDungeonPoint(first_half_period_idx,first_point),this.m_event_point_label.setString(Number(first_point.event_point).toLocaleString("en")),service.IsOpenDungeon(second_half_period_idx)){var second_point={};service.getUserEventDungeonPoint(second_half_period_idx,second_point),this.m_second_event_point_label.setString(Number(second_point.event_point).toLocaleString("en")),this.m_vote_tap==VOTE_LIST_PAGE?first_half_period_idx==this.event_dungeon_period_idx?(this.m_first_point_box.setVisible(!0),this.m_second_point_box.setVisible(!1)):(this.m_first_point_box.setVisible(!1),this.m_second_point_box.setVisible(!0),this.m_second_point_box.setPositionY(466)):(this.m_first_point_box.setVisible(!0),this.m_second_point_box.setVisible(!0),this.m_second_point_box.setPositionY(416))}else this.m_vote_tap,this.m_first_point_box.setVisible(!0),this.m_second_point_box.setVisible(!1)},getLeftLayer:function(){var m=MasterManager.getInstance(),layer=new cc.Layer;layer.setContentSize(ccSize(this).width-532,ccSize(this).height-640);var service=EventDungeonService.getInstance();this.m_gnrl_body=cc.Sprite.create(),this.m_gnrl_body.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),USE_SP_EVENT_SCALE?(this.m_gnrl_body.setPosition(ccCenter(layer).x-20,0),this.m_gnrl_body.setScale(2.8)):(this.m_gnrl_body.setPosition(ccCenter(layer).x,0),this.m_gnrl_body.setScale(1.4)),layer.addChild(this.m_gnrl_body);var first_half_period_idx=service.getEventDungeonFirstHalfPeriodIdx(this.m_period.event_dungeon_group_idx),second_half_period_idx=service.getEventDungeonSecondHalfPeriodIdx(this.m_period.event_dungeon_group_idx);this.m_first_point_box=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_vote_pointbox.png",first_half_period_idx)),this.m_first_point_box.setAnchorPoint(ZERO()),this.m_first_point_box.setPosition(0,466),USE_SP_EVENT_SCALE?this.m_first_point_box.setScale(2):this.m_first_point_box.setScale(1),layer.addChild(this.m_first_point_box),this.m_event_point_label=cmLabel.getLabel(Number(this.m_event_dungeon_point.event_point).toLocaleString("en"),LABEL_FONT_INDEX.FONT_161),this.m_event_point_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),USE_SP_EVENT_SCALE?(this.m_event_point_label.setPosition(ccWidth(this.m_first_point_box)-6,ccCenter(this.m_first_point_box).y),this.m_event_point_label.setScale(.5)):this.m_event_point_label.setPosition(ccWidth(this.m_first_point_box)-6,ccCenter(this.m_first_point_box).y),this.m_first_point_box.addChild(this.m_event_point_label),this.m_second_point_box=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_vote_pointbox.png",second_half_period_idx)),this.m_second_point_box.setAnchorPoint(ZERO()),this.m_second_point_box.setPosition(0,416),USE_SP_EVENT_SCALE?this.m_second_point_box.setScale(2):this.m_second_point_box.setScale(1),layer.addChild(this.m_second_point_box),this.m_second_event_point_label=cmLabel.getLabel(Number(this.m_event_dungeon_point.event_point).toLocaleString("en"),LABEL_FONT_INDEX.FONT_161),this.m_second_event_point_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),USE_SP_EVENT_SCALE?(this.m_second_event_point_label.setPosition(ccWidth(this.m_second_point_box)-6,ccCenter(this.m_second_point_box).y),this.m_second_event_point_label.setScale(.5)):this.m_second_event_point_label.setPosition(ccWidth(this.m_second_point_box)-6,ccCenter(this.m_second_point_box).y),this.m_second_point_box.addChild(this.m_second_event_point_label),this.updatePointBox(),this.m_slider_layer=this.getSliderLayer(),this.m_slider_layer.ignoreAnchorPointForPosition(!1),this.m_slider_layer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_slider_layer.setPosition(ccCenter(layer).x,0),layer.addChild(this.m_slider_layer),this.m_ranking_layer=this.getRankingLayer(),this.m_ranking_layer.ignoreAnchorPointForPosition(!1),this.m_ranking_layer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_ranking_layer.setPosition(ccCenter(layer).x,0),layer.addChild(this.m_ranking_layer),this.initSlider(),this.m_period_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_15.png",cc.Rect(0,0,0,0)),this.m_period_box.setPreferredSize(cc.size(420,28)),this.m_period_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_period_box.setPosition(ccCenter(layer).x+25,532),layer.addChild(this.m_period_box);var period_dt_str=m.get_EventDungeonVoteLeagueGroupV3(this.m_league_group_idx).schedule_info;return this.m_league_period_label=cmLabel.getLabel(period_dt_str,LABEL_FONT_INDEX.FONT_161),this.m_league_period_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_league_period_label.setPosition(ccCenter(this.m_period_box)),this.m_period_box.addChild(this.m_league_period_label),layer},getRankingLayer:function(){var layer=new cc.Layer,info_box=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_votebox_result.png",this.event_dungeon_period_idx));return info_box.setAnchorPoint(ZERO()),USE_SP_EVENT_SCALE?(info_box.setPosition(-100,0),info_box.setScale(2)):(info_box.setPosition(ZERO()),info_box.setScale(1)),layer.addChild(info_box),layer.setContentSize(ccSize(info_box)),this.m_ranking_gnrl_name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_221),this.m_ranking_gnrl_name.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),USE_SP_EVENT_SCALE?this.m_ranking_gnrl_name.setPosition(ccCenter(info_box).x-15,84):this.m_ranking_gnrl_name.setPosition(ccCenter(info_box).x,88),this.m_ranking_gnrl_name.enableOutline(cc.color.BLACK,1),layer.addChild(this.m_ranking_gnrl_name),this.m_ranking_count_label=cmLabel.getLabel(0,LABEL_FONT_INDEX.FONT_227),this.m_ranking_count_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),USE_SP_EVENT_SCALE?this.m_ranking_count_label.setPosition(180,46):this.m_ranking_count_label.setPosition(280,48),this.m_ranking_count_label.enableOutline(cc.color.BLACK,1),layer.addChild(this.m_ranking_count_label),this.m_ranking_img=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_rank_1.png",this.event_dungeon_period_idx)),this.m_ranking_img.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),USE_SP_EVENT_SCALE?(this.m_ranking_img.setPosition(.5*ccWidth(info_box)-20,116),this.m_ranking_img.setScale(2)):(this.m_ranking_img.setPosition(.5*ccWidth(info_box),116),this.m_ranking_img.setScale(1)),layer.addChild(this.m_ranking_img),layer},getSliderLayer:function(){var layer=new cc.Layer,info_box=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_votebox.png",this.event_dungeon_period_idx));info_box.setAnchorPoint(ZERO()),USE_SP_EVENT_SCALE?(info_box.setPosition(-100,0),info_box.setScale(2)):(info_box.setPosition(ZERO()),info_box.setScale(1)),layer.addChild(info_box),layer.setContentSize(ccSize(info_box)),this.m_gnrl_name_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_221),this.m_gnrl_name_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),USE_SP_EVENT_SCALE?this.m_gnrl_name_label.setPosition(ccCenter(info_box).x-16,204):this.m_gnrl_name_label.setPosition(ccCenter(info_box).x,207),this.m_gnrl_name_label.enableOutline(cc.color.BLACK,1),layer.addChild(this.m_gnrl_name_label),USE_SP_EVENT_SCALE?(this.m_vote_paper_pos=cc.p(ccCenter(layer).x-18,179),this.m_vote_paper=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_votapaper.png",this.event_dungeon_period_idx)),this.m_vote_paper.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_vote_paper.setScale(2)):(this.m_vote_paper_pos=cc.p(ccCenter(layer).x,179),this.m_vote_paper=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_votapaper.png",this.event_dungeon_period_idx)),this.m_vote_paper.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_vote_paper.setScale(1)),this.m_vote_paper.setPosition(this.m_vote_paper_pos),layer.addChild(this.m_vote_paper),this.m_vote_paper.setVisible(!1);var box_mask=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_votebox_mask.png",this.event_dungeon_period_idx));box_mask.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),box_mask.setPosition(ccCenter(layer).x,0),USE_SP_EVENT_SCALE&&(box_mask.setPosition(ccCenter(layer).x-5,0),box_mask.setScale(2)),layer.addChild(box_mask),this.m_vote_count_label=cmLabel.getLabel(0,LABEL_FONT_INDEX.FONT_241),this.m_vote_count_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_vote_count_label.setPosition(ccCenter(info_box).x,126),this.m_vote_count_label.enableOutline(cc.color.BLACK,1),layer.addChild(this.m_vote_count_label);var itemPlusBtn=new ccui.Button(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/btn_eventvs_vote_plus_off.png",this.event_dungeon_period_idx),cmString(RES_CDN_DEFULT+"menu_eventvs_%d/btn_eventvs_vote_plus_on.png",this.event_dungeon_period_idx));itemPlusBtn.setAnchorPoint(ZERO()),USE_SP_EVENT_SCALE?itemPlusBtn.setPosition(174,93):itemPlusBtn.setPosition(274,93),layer.addChild(itemPlusBtn),itemPlusBtn.addClickEventListener(function(sender){0!=this.GetVoteIndex()&&this.onVotePlus()}.bind(this));var itemMinusBtn=new ccui.Button(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/btn_eventvs_vote_minus_off.png",this.event_dungeon_period_idx),cmString(RES_CDN_DEFULT+"menu_eventvs_%d/btn_eventvs_vote_minus_on.png",this.event_dungeon_period_idx));itemMinusBtn.setAnchorPoint(ZERO()),USE_SP_EVENT_SCALE?itemMinusBtn.setPosition(-78,93):itemMinusBtn.setPosition(18,93),layer.addChild(itemMinusBtn),itemMinusBtn.addClickEventListener(function(sender){0!=this.GetVoteIndex()&&this.onVoteMinus()}.bind(this)),USE_SP_EVENT_SCALE?(this.m_vote_slider=new ccui.Slider,this.m_vote_slider.setTouchEnabled(!0),this.m_vote_slider.setScale9Enabled(!0),this.m_vote_slider.loadBarTexture(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_vote_gauge.png",this.event_dungeon_period_idx)),this.m_vote_slider.loadSlidBallTextures(RES_CDN_DEFULT+"menu_yh/img_yh_feel_gauge_toggle.png",RES_CDN_DEFULT+"menu_yh/img_yh_feel_gauge_toggle.png",""),this.m_vote_slider.loadProgressBarTexture(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_vote_gauge_green.png",this.event_dungeon_period_idx)),this.m_vote_slider.setCapInsets(cc.rect(3,3,3,3)),this.m_vote_slider.setContentSize(ccWidth(info_box)-10,15),this.m_vote_slider.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_vote_slider.setPosition(ccCenter(info_box).x-10,110)):(this.m_vote_slider=new ccui.Slider,this.m_vote_slider.setTouchEnabled(!0),this.m_vote_slider.setScale9Enabled(!0),this.m_vote_slider.loadBarTexture(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_vote_gauge.png",this.event_dungeon_period_idx)),this.m_vote_slider.loadSlidBallTextures(RES_CDN_DEFULT+"menu_yh/img_yh_feel_gauge_toggle.png",RES_CDN_DEFULT+"menu_yh/img_yh_feel_gauge_toggle.png",""),this.m_vote_slider.loadProgressBarTexture(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_vote_gauge_green.png",this.event_dungeon_period_idx)),this.m_vote_slider.setCapInsets(cc.rect(0,0,0,0)),this.m_vote_slider.setContentSize(ccWidth(info_box)/2,16),this.m_vote_slider.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_vote_slider.setPosition(ccCenter(info_box).x,100)),this.m_vote_slider.addEventListener(this.slideCallback,this),this.m_vote_slider.setEnabled(!1),layer.addChild(this.m_vote_slider);var vote_btn=new ccui.Button(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/btn_eventvs_vote_large_off.png",this.event_dungeon_period_idx),cmString(RES_CDN_DEFULT+"menu_eventvs_%d/btn_eventvs_vote_large_on.png",this.event_dungeon_period_idx));return vote_btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),USE_SP_EVENT_SCALE?vote_btn.setPosition(ccCenter(layer).x-10,6):vote_btn.setPosition(ccCenter(layer).x,6),vote_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_EventDungeonVoteLeagueV3Scene],EventVoteEnum.BTN_VOTE)}.bind(this)),layer.addChild(vote_btn,1),layer},slideCallback:function(sender,type){if(0!=this.GetVoteIndex()){var percent=sender.getPercent(),count=(this.m_event_dungeon_point.event_point*percent*.01).toFixed(1);this.m_vote_count=Math.floor(count),this.m_vote_count>this.m_event_dungeon_point.event_point&&(this.m_vote_count=this.m_event_dungeon_point.event_point),this.m_vote_count_label.setString(this.m_vote_count),0<this.m_vote_count?this.m_vote_paper.setVisible(!0):this.m_vote_paper.setVisible(!1)}else this.m_vote_paper.setVisible(!1)},getRightLayer:function(){var layer=new cc.Layer,right_bg_box=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_vote_frame.png",this.event_dungeon_period_idx));right_bg_box.setAnchorPoint(ZERO()),USE_SP_EVENT_SCALE?(right_bg_box.setPosition(-262,0),right_bg_box.setScale(2)):(right_bg_box.setPosition(ZERO()),right_bg_box.setScale(1)),layer.addChild(right_bg_box),layer.setContentSize(ccSize(right_bg_box)),this.m_vote_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1829),this.m_vote_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),USE_SP_EVENT_SCALE?(this.m_vote_label.setPosition(678,-5),this.addChild(this.m_vote_label,10)):(this.m_vote_label.setPosition(68,543),right_bg_box.addChild(this.m_vote_label)),this.m_vote_ranking_view_time=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_144),this.m_vote_ranking_view_time.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),USE_SP_EVENT_SCALE?(this.m_vote_ranking_view_time.setPosition(678,535),this.addChild(this.m_vote_ranking_view_time,100)):(this.m_vote_ranking_view_time.setPosition(68,535),right_bg_box.addChild(this.m_vote_ranking_view_time));var viewSize=cc.size(440,50),scroll_container=new cc.Layer;scroll_container.ignoreAnchorPointForPosition(!1),scroll_container.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),scroll_container.setPosition(ZERO()),this.m_tab_scrollview=new cc.ScrollView(viewSize,scroll_container),this.m_tab_scrollview.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_tab_scrollview.setPosition(66,481),this.m_tab_scrollview.setDirection(cc.SCROLLVIEW_DIRECTION_HORIZONTAL),this.m_tab_scrollview.setTouchEnabled(!1),layer.addChild(this.m_tab_scrollview);var pos_x=0,tab_count=0;this.m_tab_btns=[];for(var i=0;i<this.m_league_list.length;i++){var btn=this.createTabButton(this.m_league_list[i]);USE_SP_EVENT_SCALE?(btn.setPosition(pos_x+675,531),this.addChild(btn,10)):(btn.setPosition(pos_x+58,531),right_bg_box.addChild(btn)),this.m_tab_btns.push_back(btn),tab_count++,pos_x+=ccWidth(btn)}scroll_container.setContentSize(111*tab_count,50),this.m_tab_scrollview.setContentOffset(ZERO(),!1),this.m_tableView=new cc.TableView(this,cc.size(422,397)),IS_SP_BROWSER?this.m_tableView.setPosition(-188,24):this.m_tableView.setPosition(77,24),this.m_tableView.scrollBarEnable(!0),this.m_tableView.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_tableView.setDelegate(this),this.m_tableView.setTag(VOTE_LIST_PAGE),layer.addChild(this.m_tableView),this.m_vote_guide=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_vote_text_1.png",this.event_dungeon_period_idx)),this.m_vote_guide.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),USE_SP_EVENT_SCALE?(this.m_vote_guide.setPosition(676,427),this.m_vote_guide.setScale(2),this.addChild(this.m_vote_guide,10)):(this.m_vote_guide.setPosition(66,427),this.m_vote_guide.setScale(1),right_bg_box.addChild(this.m_vote_guide)),this.m_vote_tableView=new cc.TableView(this,cc.size(422,447)),IS_SP_BROWSER?this.m_vote_tableView.setPosition(-188,24):this.m_vote_tableView.setPosition(77,24),this.m_vote_tableView.scrollBarEnable(!0),this.m_vote_tableView.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_vote_tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_vote_tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_vote_tableView.setDelegate(this),this.m_vote_tableView.setTag(USER_VOTE_PAGE),layer.addChild(this.m_vote_tableView),this.m_ranking_close_label=cmLabel.getLabel(res_str("vote_ranking_close_list_notice_comment"),LABEL_FONT_INDEX.FONT_281),this.m_ranking_close_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_ranking_close_label.setPosition(ccCenter(right_bg_box)),right_bg_box.addChild(this.m_ranking_close_label);var offset_y=464;return 0==this.m_Vote_End&&(this.m_vote_btn=new ccui.Button(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_vote_none.png",this.event_dungeon_period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_vote_on.png",this.event_dungeon_period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_vote_off.png",this.event_dungeon_period_idx)),this.m_vote_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),USE_SP_EVENT_SCALE?(this.m_vote_btn.setPosition(-304,offset_y),this.m_vote_btn.setScale(2)):(this.m_vote_btn.setPosition(-44,offset_y),this.m_vote_btn.setScale(1)),this.m_vote_btn.addClickEventListener(function(){this.m_NextPage=VOTE_LIST_PAGE,this.VoteTab()}.bind(this)),layer.addChild(this.m_vote_btn),offset_y-=70),this.m_vote_record_btn=new ccui.Button(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_record_none.png",this.event_dungeon_period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_vote_on.png",this.event_dungeon_period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_record_off.png",this.event_dungeon_period_idx)),this.m_vote_record_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),USE_SP_EVENT_SCALE?(this.m_vote_record_btn.setPosition(-304,offset_y),this.m_vote_record_btn.setScale(2)):(this.m_vote_record_btn.setPosition(-44,offset_y),this.m_vote_record_btn.setScale(1)),this.m_vote_record_btn.addClickEventListener(function(){this.m_NextPage=USER_VOTE_PAGE;var req={};req.opcode=net.OP.op_user_event_dungeon_vote_V3,req.event_dungeon_period_idx=this.m_period.event_dungeon_group_idx,req.vote_league_group_idx=this.m_league_group_idx,SceneManager.getInstance().getRunningScene().network_write(req)}.bind(this)),layer.addChild(this.m_vote_record_btn),offset_y-=70,this.m_ranking_btn=new ccui.Button(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_ranking_none.png",this.event_dungeon_period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_ranking_on.png",this.event_dungeon_period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_ranking_off.png",this.event_dungeon_period_idx)),this.m_ranking_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),USE_SP_EVENT_SCALE?(this.m_ranking_btn.setPosition(-304,offset_y),this.m_ranking_btn.setScale(2)):(this.m_ranking_btn.setPosition(-44,offset_y),this.m_ranking_btn.setScale(1)),this.m_ranking_btn.addClickEventListener(function(){this.m_NextPage=GLOBAL_VOTE_PAGE,this.UpdateVoteInfo()}.bind(this)),layer.addChild(this.m_ranking_btn),this.m_sortNavyLayer=this.getNaviSortLayer(),this.m_sortNavyLayer.ignoreAnchorPointForPosition(!1),this.m_sortNavyLayer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_sortNavyLayer.setPosition(ccWidth(right_bg_box)-22,427),layer.addChild(this.m_sortNavyLayer),this.m_league_idx=this.m_tab_btns[0].getTag(),0==this.m_Vote_End&&this.VoteTab(),layer},createTabButton:function(vote_league){var btn=new ccui.Button("btn_04_none.png","btn_05_on.png","btn_05_off.png",ccui.Widget.PLIST_TEXTURE);btn.setAnchorPoint(ANCHOR_TOP_LEFT()),btn.setTag(vote_league.league_idx),btn.addClickEventListener(function(sender){this.setLeagueTab(vote_league.league_idx,this.m_vote_tap)}.bind(this));var btn_label=cmLabel.getLabel(vote_league.league_name,LABEL_FONT_INDEX.FONT_161);return btn_label.setAnchorPoint(ANCHOR_MIDDLE()),btn_label.setPosition(ccCenter(btn)),cmLabel.autoSizeFit(btn_label,150,16),btn.addChild(btn_label),btn},VoteTab:function(){0==this.m_Vote_End?(this.m_vote_btn.setEnabled(!1),this.m_vote_record_btn.setEnabled(!0),this.m_ranking_btn.setEnabled(!0),this.m_ranking_close_label.setVisible(!0)):(this.m_vote_record_btn.setEnabled(!1),this.m_ranking_btn.setEnabled(!0),this.m_ranking_close_label.setVisible(!1)),this.m_slider_layer.setVisible(!0),this.m_period_box.setVisible(!0),this.m_league_period_label.setVisible(!0),this.m_ranking_layer.setVisible(!1),this.m_vote_guide.setVisible(!0),this.setLeagueTab(this.m_league_idx,VOTE_LIST_PAGE),this.initSort(this.m_sort_index)},UserVoteTab:function(){0==this.m_Vote_End&&this.m_vote_btn.setEnabled(!0),this.m_vote_record_btn.setEnabled(!1),this.m_ranking_btn.setEnabled(!0),this.m_slider_layer.setVisible(!1),this.m_period_box.setVisible(!1),this.m_league_period_label.setVisible(!1),this.m_ranking_layer.setVisible(!0),this.m_vote_guide.setVisible(!1),this.setLeagueTab(this.m_league_idx,USER_VOTE_PAGE)},GlobalVoteTab:function(){0==this.m_Vote_End&&this.m_vote_btn.setEnabled(!0),this.m_vote_record_btn.setEnabled(!0),this.m_ranking_btn.setEnabled(!1),this.m_slider_layer.setVisible(!1),this.m_period_box.setVisible(!1),this.m_league_period_label.setVisible(!1),this.m_ranking_layer.setVisible(!0),this.m_vote_guide.setVisible(!1),this.setLeagueTab(this.m_league_idx,GLOBAL_VOTE_PAGE)},ReceiveVoteData:function(){switch(this.m_vote_list=NetService().get_Global_Vote_Gnrl_List(this.m_league_idx),this.SetGnrlInfoList(!1,this.m_league_info_list,this.m_vote_list),this.m_NextPage){case VOTE_LIST_PAGE:break;case GLOBAL_VOTE_PAGE:this.GlobalVoteTab()}},setLeagueTab:function(league_idx,vote_tab){this.m_vote_tap=vote_tab;for(var i=0;i<this.m_tab_btns.length;i++)this.m_tab_btns[i].setEnabled(!0),this.m_tab_btns[i].getTag()==league_idx&&(this.m_tab_btns[i].setEnabled(!1),this.m_league_idx=league_idx);this.getVoteLeagueGnrlList(this.m_league_idx),this.LeftLayer_Update(),this.RightLayer_Update()},LeftLayer_Update:function(){if(this.m_vote_tap==GLOBAL_VOTE_PAGE)if(this.m_vote_list[0].vote_count<0)this.m_ranking_img.setVisible(!1),this.m_gnrl_body.setTexture(RES_CDN_DEFULT+"common/img_point.png"),this.m_ranking_gnrl_name.setString(res_str("vote_ranking_close_character_name")),this.m_ranking_count_label.setString("???"),cmLabel.autoSizeFit(this.m_ranking_gnrl_name,147,22);else{this.m_ranking_img.setVisible(!0);var vote_gnrl=MasterManager.getInstance().get_EventDungeonLeagueYunheeListV3(this.m_vote_list[0].vote_gnrl_idx);this.m_gnrl_body.setTexture(RES_CDN_DEFULT+cmString("card_script_body/%d.png",vote_gnrl.script_id)),this.m_ranking_gnrl_name.setString(vote_gnrl.yunhee_name),this.m_ranking_count_label.setString(Number(this.m_vote_list[0].vote_count).toLocaleString("en"))}else if(this.m_vote_tap==USER_VOTE_PAGE){this.m_ranking_img.setVisible(!1);vote_gnrl=MasterManager.getInstance().get_EventDungeonLeagueYunheeListV3(this.m_vote_list[0].vote_gnrl_idx);this.m_gnrl_body.setTexture(RES_CDN_DEFULT+cmString("card_script_body/%d.png",vote_gnrl.script_id)),this.m_ranking_gnrl_name.setString(vote_gnrl.yunhee_name),this.m_ranking_count_label.setString(Number(this.m_vote_list[0].vote_count).toLocaleString("en"))}this.updatePointBox()},RightLayer_Update:function(){var league_info=MasterManager.getInstance().get_EventDungeonLeagueInfoV3(this.m_league_idx);if(this.m_vote_tap==VOTE_LIST_PAGE)this.m_vote_label.setPositionY(543),this.m_vote_label.setString(league_info.vote_title),this.m_vote_ranking_view_time.setVisible(!1),this.m_ranking_close_label.setVisible(!1),this.m_sortNavyLayer.setVisible(!0),this.m_vote_idx=0;else if(this.m_vote_tap==USER_VOTE_PAGE)this.m_ranking_close_label.setVisible(!1),this.m_vote_label.setPositionY(543),this.m_vote_label.setString(league_info.vote_record_title),this.m_vote_ranking_view_time.setVisible(!1),this.m_sortLayer.setVisible(!1),this.m_sortNavyLayer.setVisible(!1);else if(this.m_vote_tap==GLOBAL_VOTE_PAGE){this.m_vote_list[0].vote_count<0&&this.m_ranking_close_label.setVisible(!0),this.m_vote_label.setPositionY(553),this.m_vote_label.setString(league_info.ranking_name),this.m_vote_ranking_view_time.setVisible(!0);var league_group=MasterManager.getInstance().get_EventDungeonVoteLeagueGroupV3(this.m_league_group_idx),end_dt=moment(league_group.ranking_end_dt),beg_month=leadingZeros(end_dt.month()+1,2),beg_day=leadingZeros(end_dt.date(),2),beg_hour=leadingZeros(end_dt.hours(),2),end_dt_str=cmString(res_str("vote_ranking_open_period"),beg_month,beg_day,beg_hour);this.m_vote_ranking_view_time.setString(end_dt_str),this.m_sortLayer.setVisible(!1),this.m_sortNavyLayer.setVisible(!1)}},getVoteLeagueGnrlList:function(league_idx){this.m_vote_tap==VOTE_LIST_PAGE?(this.m_league_info_list=MasterTable.getInstance().get_Event_Vote_League_Gnrl_List(league_idx),this.SetGnrlInfoList(!0,this.m_league_info_list,this.m_vote_list),this.m_sort_index=EventVoteSortEnum.SORT_RECORD,this.initSort(this.m_sort_index),this.UpdateVoteInfo(),this.m_gnrl_body.setTexture(RES_CDN_DEFULT+"common/img_point.png"),this.m_gnrl_name_label.setString(""),this.initSlider(),this.m_tableView.setVisible(!0),this.m_vote_tableView.setVisible(!1)):this.m_vote_tap==USER_VOTE_PAGE?(this.m_vote_list=NetService().get_User_Vote_Gnrl_List(league_idx),this.m_tableView.setVisible(!1),this.m_vote_tableView.setVisible(!0)):this.m_vote_tap==GLOBAL_VOTE_PAGE&&(this.m_vote_list=NetService().get_Global_Vote_Gnrl_List(league_idx),this.m_tableView.setVisible(!1),this.m_vote_list[0].vote_count<0?this.m_vote_tableView.setVisible(!1):this.m_vote_tableView.setVisible(!0)),this.reloadTableView()},reloadTableView:function(){this.m_vote_tap==VOTE_LIST_PAGE?this.m_tableView.reloadData():this.m_vote_tableView.reloadData()},onEnter:function(){this._super()},onExit:function(){this._super()},numberOfCellsInTableView:function(table){var cnt=0;return this.m_vote_tap==VOTE_LIST_PAGE?(cnt=this.m_gnrl_info_list.length/4,0<this.m_gnrl_info_list.length%4&&(cnt+=1)):this.m_vote_tap!=USER_VOTE_PAGE&&this.m_vote_tap!=GLOBAL_VOTE_PAGE||(cnt=this.m_vote_list.length),cnt},tableCellSizeForIndex:function(table,idx){return table.getTag()==VOTE_LIST_PAGE?cc.size(422,108):cc.size(422,74)},cellSizeForTable:function(table){return table.getTag()==VOTE_LIST_PAGE?cc.size(422,108):cc.size(422,74)},tableCellTouched:function(table,cell){if(table.getTag()==VOTE_LIST_PAGE){null!=cell&&cell.touchPosCell(cell.getTouchPos(),cell.getTouchWorldPos())}},tableCellHighlight:function(table,cell){return!0},tableCellUnhighlight:function(table,cell){return!0},tableCellEnded:function(table){return!0},choiceGnrl:function(info){for(var i=0;i<this.m_gnrl_info_list.length;i++){var gnrl=this.m_gnrl_info_list[i];if(gnrl.league_yunhee_idx==info.league_yunhee_idx){this.m_vote_idx=gnrl.league_yunhee_idx,this.m_vote_slider.setEnabled(!0);break}}this.updateGeneralInfo(info),this.initSlider();var offset=this.m_tableView.getContentOffset();this.m_tableView.reloadData(),this.m_tableView.setContentOffset(offset)},initSlider:function(){this.m_vote_count=0,this.m_vote_paper.setVisible(!1),this.m_vote_count_label.setString(Number(this.m_vote_count).toLocaleString("en"));(this.m_make_count/1*100).toFixed(1);this.m_vote_slider.setPercent(0),this.m_vote_slider.setEnabled(!0)},tableCellAtIndex:function(table,idx){if(table.getTag()==VOTE_LIST_PAGE){var cell=null;cell=null!=(c=table.dequeueCell())?c:new EventDungeonVoteLeagueV3NomineeCell(this.choiceGnrl.bind(this));var desc=[],start=4*idx,end=start+4;if(end<this.m_gnrl_info_list.length)for(idx=start;idx<=end;idx++)desc.push(this.m_gnrl_info_list[idx]);else for(idx=start;idx<this.m_gnrl_info_list.length;idx++)desc.push(this.m_gnrl_info_list[idx]);return cell.setNomineeData(desc,this.m_vote_idx),cell}var c;cell=null;return(cell=null!=(c=table.dequeueCell())?c:new EventDungeonVoteLeagueV3RankingListCell(this.event_dungeon_period_idx)).setRankingData(this.m_vote_list[idx]),cell},onVotePlus:function(){if(this.m_vote_count=this.m_vote_count+1,this.m_vote_count>=this.m_event_dungeon_point.event_point&&(this.m_vote_count=this.m_event_dungeon_point.event_point),0!=this.m_event_dungeon_point.event_point){this.m_vote_paper.setVisible(!0);var percent=(this.m_vote_count/this.m_event_dungeon_point.event_point*100).toFixed(1);this.m_vote_slider.setPercent(percent),this.m_vote_count_label.setString(this.m_vote_count)}},onVoteMinus:function(){if(this.m_vote_count=this.m_vote_count-1,this.m_vote_count<=0&&(this.m_vote_count=0,this.m_vote_paper.setVisible(!1)),0!=this.m_event_dungeon_point.event_point){var percent=(this.m_vote_count/this.m_event_dungeon_point.event_point*100).toFixed(1);this.m_vote_slider.setPercent(percent),this.m_vote_count_label.setString(this.m_vote_count)}},updateGeneralInfo:function(info){this.m_gnrl_body.setTexture(cmString(RES_CDN_DEFULT+"card_script_body/%d.png",info.script_id)),this.m_gnrl_name_label.setString(info.yunhee_name)},GetVoteCount:function(){return this.m_vote_count},GetChoiceGnrlName:function(){return this.m_gnrl_name_label.getString()},StartVote:function(){var req={};req.opcode=net.OP.op_user_event_dungeon_vote_gnrl_V3,req.event_dungeon_period_idx=this.m_period.event_dungeon_period_idx,req.vote_league_group_idx=this.m_league_group_idx,req.gnrl_idx=this.GetVoteIndex(),req.vote_cnt=this.m_vote_count,req.vote_league_idx=this.m_league_idx,SceneManager.getInstance().getRunningScene().network_write(req)},showVotingEffect:function(){var callback=new cc.CallFunc(this.votingComplete.bind(this)),move_to=cc.moveTo(.4,cc.p(this.m_vote_paper_pos.x,0));this.m_vote_paper.runAction(new cc.Sequence(move_to,callback))},votingComplete:function(){this.m_vote_idx=0,this.m_vote_slider.setEnabled(!1),this.m_vote_paper.setVisible(!1),this.m_vote_paper.setPosition(this.m_vote_paper_pos);var offset=this.m_tableView.getContentOffset();this.m_tableView.reloadData(),this.m_tableView.setContentOffset(offset),this.m_gnrl_body.setTexture(RES_CDN_DEFULT+"common/img_point.png"),this.m_gnrl_name_label.setString(""),EventDungeonService.getInstance().getUserEventDungeonPoint(this.m_period.event_dungeon_point_period_idx,this.m_event_dungeon_point),this.m_event_point_label.setString(Number(this.m_event_dungeon_point.event_point).toLocaleString("en")),this.VoteTab(),MainObserver.getInstance().postNotification(sceneStr[scene_EventDungeonVoteLeagueV3Scene],EventVoteEnum.VOTE_COMPLETE_POPUP)},getNaviSortLayer:function(){var layer=new cc.Layer;return this.m_btn_sort=new LabelButton("btn_02_off.png","btn_02_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort.setFont(LABEL_FONT_INDEX.FONT_201),this.initSort(this.m_sort_index),this.m_btn_sort.setAnchorPoint(ZERO()),this.m_btn_sort.setPosition(ZERO()),this.m_btn_sort.addClickEventListener(function(sender){this.runActionSortButton()}.bind(this)),layer.addChild(this.m_btn_sort),this.m_btn_sort_desc=new ccui.Button,this.m_btn_sort_desc.loadTextures("btn_align_bottom_off.png","btn_align_bottom_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_desc.setAnchorPoint(ZERO()),this.m_btn_sort_desc.setPosition(ccWidth(this.m_btn_sort),0),this.m_btn_sort_desc.addClickEventListener(function(sender){this.setDesc()}.bind(this)),layer.addChild(this.m_btn_sort_desc),this.m_is_sort_desc||(this.m_btn_sort_desc.loadTexturePressed("btn_align_top_on.png",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_desc.loadTextureNormal("btn_align_top_off.png",ccui.Widget.PLIST_TEXTURE)),this.m_sortLayer=this.getSortLayer(),this.m_sortLayer.ignoreAnchorPointForPosition(!1),this.m_sortLayer.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_sortLayer.setPosition(ZERO()),this.m_sortLayer.setVisible(!1),layer.addChild(this.m_sortLayer,100),layer.setContentSize(ccWidth(this.m_btn_sort)+ccWidth(this.m_btn_sort_desc),ccHeight(this.m_btn_sort)),layer},getSortLayer:function(){MasterManager.getInstance();var layer=new cc.Layer,sort_btn_strs=[];sort_btn_strs.push_back(res_str("btn_sort_name")),this.m_Vote_End||sort_btn_strs.push_back(res_str("btn_sort_vote_ranking")),sort_btn_strs.push_back(res_str("btn_sort_vote_new_last_record"));for(var btn_pos_y=0,str_size=sort_btn_strs.length,idx=0;idx<sort_btn_strs.length;idx++){var btn=new LabelButton("btn_02_on.png","btn_02_off.png","",ccui.Widget.PLIST_TEXTURE);btn.setFont(LABEL_FONT_INDEX.FONT_201),btn.setString(sort_btn_strs[idx]),btn.setAnchorPoint(ZERO()),btn.setPosition(0,btn_pos_y),btn.addClickEventListener(function(sender){this.setSort(sender.getTag())}.bind(this)),layer.addChild(btn),btn_pos_y+=ccHeight(btn),btn.setTag(str_size),str_size--}return layer.setContentSize(111,btn_pos_y),layer},initSort:function(sort_index){this.setSortLabel(sort_index),this.sort()},setSort:function(sort_index){this.m_sort_index!=sort_index&&(this.m_Vote_End&&sort_index==SORT_RANKING&&(sort_index=SORT_NAME),this.setSortLabel(sort_index),this.m_sort_index=sort_index,this.sort()),this.runActionSortButton()},runActionSortButton:function(){this.m_is_sort_btn_visible?(this.m_sortLayer.setVisible(!1),this.m_is_sort_btn_visible=!1):(this.m_sortLayer.setVisible(!0),this.m_is_sort_btn_visible=!0)},setDesc:function(){this.m_is_sort_desc?(this.m_is_sort_desc=!1,this.m_btn_sort_desc.loadTexturePressed("btn_align_top_on.png",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_desc.loadTextureNormal("btn_align_top_off.png",ccui.Widget.PLIST_TEXTURE)):(this.m_is_sort_desc=!0,this.m_btn_sort_desc.loadTexturePressed("btn_align_bottom_on.png",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_desc.loadTextureNormal("btn_align_bottom_off.png",ccui.Widget.PLIST_TEXTURE)),this.m_is_sort_btn_visible&&this.runActionSortButton(),this.sort()},sort:function(){switch(this.m_gnrl_info_list=stable(this.m_gnrl_info_list,function(l,r){return this.m_is_sort_desc?l.league_yunhee_idx>r.league_yunhee_idx:l.league_yunhee_idx<r.league_yunhee_idx}.bind(this)),this.m_sort_index){case EventVoteSortEnum.SORT_RECORD:this.m_gnrl_info_list=stable(this.m_gnrl_info_list,function(l,r){return this.m_is_sort_desc?l.league_yunhee_idx>r.league_yunhee_idx:l.league_yunhee_idx<r.league_yunhee_idx}.bind(this));break;case EventVoteSortEnum.SORT_RANKING:this.m_gnrl_info_list=stable(this.m_gnrl_info_list,function(l,r){return this.m_is_sort_desc?l.vote_ranking>r.vote_ranking:l.vote_ranking<r.vote_ranking}.bind(this));break;case EventVoteSortEnum.SORT_NAME:this.m_gnrl_info_list=stable(this.m_gnrl_info_list,function(l,r){return this.m_is_sort_desc?l.name_num>r.name_num:l.name_num<r.name_num}.bind(this))}this.reloadTableView()},setSortLabel:function(sort_index){switch(sort_index){case EventVoteSortEnum.SORT_RECORD:this.m_btn_sort.setString(res_str("btn_sort_vote_new_last_record"));break;case EventVoteSortEnum.SORT_RANKING:this.m_btn_sort.setString(res_str("btn_sort_vote_ranking"));break;case EventVoteSortEnum.SORT_NAME:this.m_btn_sort.setString(res_str("btn_sort_name"))}},SetGnrlInfoList:function(bIsGnrlInfo,listGnrlInfo,listVoteInfo){if(bIsGnrlInfo){this.m_gnrl_info_list=[];for(var idx=0;idx<listGnrlInfo.length;idx++){var item=new db.EventDungeonLeagueV3YhInfo;item.league_yunhee_idx=listGnrlInfo[idx].league_yunhee_idx,item.league_idx=listGnrlInfo[idx].league_idx,item.yunhee_name=listGnrlInfo[idx].yunhee_name,item.group_num=listGnrlInfo[idx].group_num,item.script_id=listGnrlInfo[idx].script_id,item.yunhee_id=listGnrlInfo[idx].yunhee_id,item.name_num=listGnrlInfo[idx].name_num,this.m_gnrl_info_list.push_back(item),item=null}}else{for(idx=0;idx<this.m_gnrl_info_list.length;idx++)for(var jdx=0;jdx<listVoteInfo.length;jdx++)if(this.m_gnrl_info_list[idx].league_yunhee_idx==listVoteInfo[jdx].vote_gnrl_idx){this.m_gnrl_info_list[idx].vote_count=listVoteInfo[jdx].vote_count,this.m_gnrl_info_list[idx].vote_ranking=listVoteInfo[jdx].vote_ranking;break}this.m_sort_index==EventVoteSortEnum.SORT_RANKING&&this.initSort(this.m_sort_index)}},UpdateVoteInfo:function(){var req={};req.opcode=net.OP.op_global_event_dungeon_vote_V3,req.event_dungeon_period_idx=this.m_period.event_dungeon_group_idx,req.vote_league_group_idx=this.m_league_group_idx;try{SceneManager.getInstance().getRunningScene().network_write(req)}catch(e){var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent)}},GetVoteIndex:function(){return this.m_vote_idx}}),EventDungeonVoteLeagueV3NomineeCell=cc.TableViewCell.extend({m_callback:null,m_Nominee:[],m_list:[],m_item_list:[],ctor:function(_callback){this._super(),this.m_list=[],this.m_Nominee=[],this.m_item_list=[],this.init(_callback)},init:function(_callback){var cellSize=cc.size(422,108);this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(cellSize);for(var i=0;i<4;i++){var item=new EventDungeonVoteLeagueV3NomineeItem(_callback),s=ccSize(item);item.setPosition(s.width*i,0),this.addChild(item),this.m_item_list.push_back(item)}return!0},setNomineeData:function(data,VoteIdx){this.m_Nominee=data,this.updateNomineeItems(VoteIdx)},updateNomineeItems:function(VoteIdx){for(var i=0;i<this.m_item_list.length;i++){var item=this.m_item_list[i];item.setVisible(!1),i<this.m_Nominee.length&&(item.setVisible(!0),item.setData(this.m_Nominee[i],VoteIdx))}},touchPosCell:function(pos,world_pos){for(var i=0;i<this.m_item_list.length;i++){var item=this.m_item_list[i],r=item.getBoundingBox();if(cc.rectContainsPoint(r,pos)){item.touchPosInItem(pos,world_pos);break}}}}),EventDungeonVoteLeagueV3NomineeItem=cc.Layer.extend({m_card_img:null,m_card_spr:null,ctor:function(_callback){this._super(_callback),this.init(_callback)},setData:function(data,VoteIdx){this.m_data=data,this.updateItem(VoteIdx)},updateItem:function(VoteIdx){this.m_card_img.setVisible(!0);var frame=cc.spriteFrameCache.getSpriteFrame("m_"+this.m_data.yunhee_id+".png");IS_SP_BROWSER?this.m_card_spr.setSpriteFrame(frame):this.m_card_img.setSpriteFrame(frame);var select_img=this.m_card_img.getChildByTag(1);if(0!=this.m_data.league_yunhee_idx&&this.m_data.league_yunhee_idx==VoteIdx){var fadeIn=new cc.FadeIn(.7),fadeOut=new cc.FadeOut(.7,90),seq=new cc.Sequence(fadeIn,fadeOut),repeat=new cc.RepeatForever(seq);select_img.runAction(repeat)}else select_img.stopAllActions(),select_img.setOpacity(0);this.m_card_img.setVisible(!0)},init:function(_callback){this.m_callback=_callback;var size=cc.size(108,108);this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(size),this.m_card_img=cc.Sprite.create(),this.m_card_img.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_card_img.setPosition(0,0),this.addChild(this.m_card_img),IS_SP_BROWSER&&(this.m_card_img.setContentSize(98,98),this.m_card_spr=cc.Sprite.create(),this.m_card_spr.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_card_spr.setPosition(0,0),this.m_card_spr.setScale(2),this.m_card_img.addChild(this.m_card_spr));var box=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_frame_normal.png");DISABLE_SPB_TP&&box.setContentSize(98,98),box.setAnchorPoint(ZERO()),box.setPosition(ZERO()),this.m_card_img.addChild(box);var select_img=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_select_2.png");return select_img.setAnchorPoint(ZERO()),select_img.setPosition(ZERO()),this.m_card_img.addChild(select_img,10),select_img.setTag(1),select_img.setOpacity(0),!0},touchPosInItem:function(pos,table_in_pos){var this_rect=this.getBoundingBox(),box=this.m_card_img.getBoundingBox();box.x+=this_rect.x,box.y+=this_rect.y,cc.rectContainsPoint(box,pos)&&null!=this.m_callback&&this.m_callback(this.m_data)}}),EventDungeonVoteLeagueV3RankingListCell=cc.TableViewCell.extend({m_ranking_img:null,m_ranking_label:null,m_gnrl_icon:null,m_gnrl_name:null,m_vote_cnt_label:null,m_event_dungeon_period_idx:0,ctor:function(period_idx){this._super(),this.init(period_idx)},init:function(period_idx){this.m_event_dungeon_period_idx=period_idx;var list_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_9p_box.png",this.m_event_dungeon_period_idx,RectZero()));list_bg.setAnchorPoint(ZERO()),list_bg.setPosition(ZERO()),list_bg.setPreferredSize(cc.size(422,74)),this.addChild(list_bg),this.setContentSize(ccSize(list_bg)),this.m_ranking_img=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_rank_1_small.png",this.m_event_dungeon_period_idx)),this.m_ranking_img.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_ranking_img.setPosition(0,0),IS_SP_BROWSER&&this.m_ranking_img.setScale(2),list_bg.addChild(this.m_ranking_img),this.m_ranking_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_221),this.m_ranking_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_ranking_label.setPosition(40,ccCenter(list_bg).y),list_bg.addChild(this.m_ranking_label);var icon_frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");icon_frame.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),icon_frame.setPosition(79,ccCenter(list_bg).y),list_bg.addChild(icon_frame),DISABLE_SPB_TP?(this.m_gnrl_icon=cc.Sprite.create(RES_CDN_CARD_MEDIUM_NTP+"m_12001.png"),this.m_gnrl_icon.setContentSize(49,49),this.m_gnrl_icon.setScale(DEF_TUMB_SCALE)):this.m_gnrl_icon=cc.Sprite.create("#m_12001.png"),this.m_gnrl_icon.setPosition(ccCenter(icon_frame)),icon_frame.addChild(this.m_gnrl_icon),this.m_gnrl_name=cmLabel.getLabel("aa",LABEL_FONT_INDEX.FONT_221),this.m_gnrl_name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_gnrl_name.setPosition(155,40),list_bg.addChild(this.m_gnrl_name);var vote_img=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_vote_point_small.png",this.m_event_dungeon_period_idx));return vote_img.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),vote_img.setPosition(154,9),USE_SP_EVENT_SCALE?vote_img.setScale(2):vote_img.setScale(1),list_bg.addChild(vote_img),this.m_vote_cnt_label=cmLabel.getLabel("aa",LABEL_FONT_INDEX.FONT_1810),this.m_vote_cnt_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_vote_cnt_label.setPosition(185,10),list_bg.addChild(this.m_vote_cnt_label),!0},setRankingData:function(data){this.m_data=data,this.update()},update:function(){if(this.m_data.vote_ranking<=3)this.m_ranking_img.setVisible(!0),this.m_ranking_label.setVisible(!1),this.m_ranking_img.setTexture(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_rank_%d_small.png",this.m_event_dungeon_period_idx,this.m_data.vote_ranking));else{this.m_ranking_img.setVisible(!1),this.m_ranking_label.setVisible(!0);var rank_str=cmString("%d",this.m_data.vote_ranking);this.m_ranking_label.setString(cmString(res_str("label_rank"),rank_str))}var vote_gnrl=MasterManager.getInstance().get_EventDungeonLeagueYunheeListV3(this.m_data.vote_gnrl_idx),gnrl=MasterManager.getInstance().get_General(vote_gnrl.yunhee_id);if(IS_SP_BROWSER)if(DISABLE_SPB_TP)this.m_gnrl_icon.setTexture(RES_CDN_CARD_MEDIUM_NTP+"m_"+gnrl.gnrl_id+".png"),this.m_gnrl_icon.setContentSize(49,49),this.m_gnrl_icon.setScale(DEF_TUMB_SCALE);else{var frame=cc.spriteFrameCache.getSpriteFrame("m_"+gnrl.gnrl_id+".png");this.m_gnrl_icon.setSpriteFrame(frame)}else{frame=cc.spriteFrameCache.getSpriteFrame("m_"+gnrl.gnrl_id+".png");this.m_gnrl_icon.setSpriteFrame(frame)}this.m_gnrl_icon.setScale(DEF_TUMB_SCALE),this.m_gnrl_name.setString(vote_gnrl.yunhee_name),this.m_vote_cnt_label.setString(Number(this.m_data.vote_count).toLocaleString("en"))}}),LEAGUEV3_INDEX=0,EventDungeonVoteLeagueV3Scene=GameScene.extend({m_layer:null,ctor:function(period_idx,VoteEnd,vote_group_idx){this._super(scene_EventDungeonVoteLeagueV3Scene),null==period_idx?period_idx=LEAGUEV3_INDEX:LEAGUEV3_INDEX=period_idx,this.init_Lay(period_idx,VoteEnd,vote_group_idx)},init_Lay:function(period_idx,VoteEnd,vote_group_idx){this.m_period_idx=period_idx,null==VoteEnd&&(VoteEnd=!1),null==vote_group_idx&&(vote_group_idx=0),this.m_Vote_End=VoteEnd,this.m_Group_idx=vote_group_idx,this.m_layer=new EventDungeonVoteLeagueV3Layer(period_idx,VoteEnd,vote_group_idx),this.addChild(this.m_layer);var statusLayer=new StatusLayer(INVOKER_TYPE.normal);statusLayer.initLayout(),statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer);var back_btn=new ccui.Button;back_btn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png",""),back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(sender){this.back()}.bind(this)),this.addChild(back_btn);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_eventvs.png");return title.setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title),!0},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_EventDungeonVoteLeagueV3Scene]);var audio=AudioEngine.getInstance(),m=MasterTable.getInstance();if(BattleContext._getInstance().getIsPrvEventDungeon())var bgm=m.get_Bgm_v2(BGM_TYPE_PRV_EVENT_MAIN_BGM);else{var period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();bgm=m.get_EventDungeonFromEventDungeonPeriodIdx(period_idx).event_dungeon_type==EVENT_DUNGEON_TYPE_LINLIN?m.get_Bgm_v2(BGM_TYPE_CRAFT_EVENT_MAIN_BGM):m.get_Bgm_v2(BGM_TYPE_EVENT_MAIN_BGM)}var main_bgm=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm.sound_file_name;audio.m_bgmPath!=main_bgm&&(audio.stopBackgroundMusic(),audio.m_bgmPath="",audio.playBackgroundMusic(main_bgm,!0))},onExit:function(){this._super(),MainObserver.getInstance().removeObserver(sceneStr[scene_EventDungeonVoteLeagueV3Scene])},onEnterTransitionDidFinish:function(){if(this._super(),1==this.m_Vote_End){var period=MasterManager.getInstance().get_EventDungeonPeriod(this.m_period_idx),req={};req.opcode=net.OP.op_user_event_dungeon_vote_V3,req.event_dungeon_period_idx=period.event_dungeon_group_idx,req.vote_league_group_idx=this.m_Group_idx,this.network_write(req)}},onNotification:function(msg){if(this._super(msg))return!1;if(msg!=EventVoteEnum.BTN_VOTE)return msg==EventVoteEnum.VOTE_COMPLETE_POPUP&&this.showVoteCompleteBox(),!0;var yunhee_idx=this.m_layer.GetVoteIndex(),vote_count=this.m_layer.GetVoteCount();return 0==yunhee_idx?this.showNotSelectYunhee():0==vote_count?this.showNotAddEventDungeonPoint():this.showVoteBeginBox(),!0},onNetworkEvent:function(opcode,state,body){this._super(opcode,state,body),body.opcode==net.OP.op_user_event_dungeon_vote_V3?this.m_layer.UserVoteTab():body.opcode==net.OP.op_global_event_dungeon_vote_V3?this.m_layer.ReceiveVoteData():body.opcode==net.OP.op_user_event_dungeon_vote_gnrl_V3&&this.m_layer.showVotingEffect()},back:function(){this.onKeyBack(!0)},showVoteBeginBox:function(){var mt=MasterManager.getInstance(),vote_count=(this.m_layer.GetVoteIndex(),this.m_layer.GetVoteCount());this.m_ctbox.setTitle(res_str("label_preparation_title")),this.m_ctbox.setText(this.m_layer.GetChoiceGnrlName(),LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText(" に ",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(Number(vote_count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText(" 枚の投票券で投票しますか。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n");var btnNo=new MessageButtonInfo(mt.get_LanguageData("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0);btnNo.click=function(){this.m_ctbox.hide()}.bind(this);var btnYes=new MessageButtonInfo(mt.get_LanguageData("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0);btnYes.click=function(){this.m_layer.StartVote(),this.m_ctbox.hide()}.bind(this),this.m_ctbox.addButtonInfo(btnNo),this.m_ctbox.addButtonInfo(btnYes),this.m_ctbox.show()},showVoteCompleteBox:function(){this.m_box.setTitle(res_str("label_preparation_title")),this.m_box.setText(res_str("label_vote_complete_text_1"));var btnYes=new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0);btnYes.click=function(){this.m_box.hide()}.bind(this),this.m_box.addButtonInfo(btnYes),this.m_box.show()},showNotAddEventDungeonPoint:function(){this.m_box.setTitle(res_str("label_preparation_title"));var mt=MasterManager.getInstance(),event_period=mt.get_EventDungeonPeriod(this.m_period_idx);this.m_box.setText(cmString(res_str("label_not_add_event_dungeon_point"),mt.get_EventPointUnitType(event_period.event_point_unit_type).name));var btnYes=new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0);btnYes.click=function(){this.m_box.hide()}.bind(this),this.m_box.addButtonInfo(btnYes),this.m_box.show()},showNotSelectYunhee:function(){this.m_box.setTitle(res_str("label_preparation_title")),this.m_box.setText(res_str("label_yunhee_not_select"));var btnYes=new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0);btnYes.click=function(){this.m_box.hide()}.bind(this),this.m_box.addButtonInfo(btnYes),this.m_box.show()}}),EventDungeonVoteLeagueV3ScheduleCell=cc.TableViewCell.extend({m_group_label:null,m_league_label:null,m_arrow:null,m_select_img:null,m_schedule_btn:null,ctor:function(){this._super(),this.init()},init:function(){var bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_5.png",RectZero());return bg.setAnchorPoint(ZERO()),bg.setPosition(ZERO()),bg.setPreferredSize(cc.size(524,78)),this.addChild(bg),this.m_select_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_151001/img_eventvs_label.png"),this.m_select_img.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_select_img.setPosition(20,41),this.addChild(this.m_select_img),this.m_group_label=cmLabel.getLabel("a",LABEL_FONT_INDEX.FONT_2013),this.m_group_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_group_label.setPosition(20,42),bg.addChild(this.m_group_label),this.m_league_label=cmLabel.getLabel("bbbbbb",LABEL_FONT_INDEX.FONT_201),this.m_league_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_league_label.setPosition(20,20),bg.addChild(this.m_league_label),this.m_schedule_btn=new ccui.Button("btn_05_off.png","btn_05_on.png","btn_04_none",ccui.Widget.PLIST_TEXTURE),this.m_schedule_btn.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_schedule_btn.setPosition(ccWidth(bg)-12,.5*ccHeight(bg)),bg.addChild(this.m_schedule_btn),this.m_schedule_btn.addClickEventListener(function(){var season_idx=MasterTable.getInstance().get_EventVoteLeagueV3(this.m_period_idx),Group_list=MasterTable.getInstance().get_EventVoteLeagueGroupList(season_idx),scene=new EventDungeonVoteLeagueV3Scene(this.m_period_idx,!0,Group_list.at(this.m_cell_idx).vote_league_group_idx);SceneManager.getInstance().replaceScene(scene)}.bind(this)),this.m_arrow=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_151001/img_eventvs_arrow.png"),this.m_arrow.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_arrow.setPosition(.5*ccWidth(bg),78),this.addChild(this.m_arrow),!0},setData:function(idx,period_idx){this.m_cell_idx=idx,this.m_period_idx=period_idx,this.update()},update:function(){0==this.m_cell_idx&&this.m_arrow.setVisible(!1);var season_idx=MasterTable.getInstance().get_EventVoteLeagueV3(this.m_period_idx),Group_list=MasterTable.getInstance().get_EventVoteLeagueGroupList(season_idx);this.m_group_label.setString(Group_list.at(this.m_cell_idx).league_group_name),this.m_league_label.setString(Group_list.at(this.m_cell_idx).schedule_info),this.m_group_label.setPosition(112,42)}}),EventDungeonVoteLeagueV3VoteReawardCell=cc.TableViewCell.extend({m_list:[],event_dungeon_period_idx:0,ctor:function(_callback,period_idx){this._super(_callback,period_idx),this.m_list=[],this.event_dungeon_period_idx=0,this.init(_callback,period_idx)},init:function(_callback,period_idx){this.event_dungeon_period_idx=period_idx;cc.size(924,78);for(var i=0;i<2;i++){var item=new EventDungeonVoteLeagueV3VoteReawardItem(_callback),s=ccSize(item);item.setPosition(s.width*i,0),this.addChild(item),this.m_list.push_back(item)}return!0},setRewardData:function(data,Event_dungeon_period_idx){this.m_reward=data,this.update(Event_dungeon_period_idx)},update:function(Event_dungeon_period_idx){for(var i=0;i<this.m_list.size();i++){var item=this.m_list.at(i);item.setVisible(!1),i<this.m_reward.size()&&(item.setVisible(!0),item.setRewardData(this.m_reward.at(i),Event_dungeon_period_idx))}},highlightPosInCell:function(pos){for(var i=0;i<this.m_list.length;i++){var item=this.m_list[i];if(item.isVisible()){var r=item.getBoundingBox();if(cc.rectContainsPoint(r,pos)){item.highlightPosInItem(pos,this.getTouchTablePos());break}}}},unhighlightPosInCell:function(pos){for(var i=0;i<this.m_list.length;i++){var item=this.m_list[i];if(item.isVisible()){var r=item.getBoundingBox();if(cc.rectContainsPoint(r,pos)){item.unhighlightPosInItem(pos,this.getTouchTablePos());break}}}},touchPosInCell:function(pos){for(var i=0;i<this.m_list.length;i++){var item=this.m_list[i];if(item.isVisible()){var r=item.getBoundingBox();if(cc.rectContainsPoint(r,pos)){item.touchPosInItem(pos,this.getTouchTablePos());break}}}}}),EventDungeonVoteLeagueV3VoteReawardItem=cc.Layer.extend({m_icon:null,m_reward_name:null,m_reward_info:null,m_complete_mark:null,m_disable_cover:null,m_event_dungeon_period_idx:0,m_reward_btn:[],m_event_dungeon_point:null,_callback:null,ctor:function(callback){this._super(),this.m_reward_btn=[],this.init_Lay(callback)},init_Lay:function(callback){var size=cc.size(462,78);this._callback=callback,this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(size);var list_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",cc.Rect(20,20,20,20));list_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),list_bg.setPreferredSize(size),list_bg.setPosition(ZERO()),this.addChild(list_bg);var icon_frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");icon_frame.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),icon_frame.setPosition(4,5),list_bg.addChild(icon_frame),this.m_icon=cc.Sprite.create("#img_reward_01.png"),this.m_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_icon.setPosition(ccCenter(icon_frame)),icon_frame.addChild(this.m_icon),this.m_reward_name=cmLabel.getLabel("reward",LABEL_FONT_INDEX.FONT_2013),this.m_reward_name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_reward_name.setPosition(80,43),list_bg.addChild(this.m_reward_name),this.m_reward_info=cmLabel.getLabel("info",LABEL_FONT_INDEX.FONT_181),this.m_reward_info.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_reward_info.setPosition(80,16),list_bg.addChild(this.m_reward_info);var off=cc.Sprite.create("#btn_05_off.png");off.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),off.setPosition(ccWidth(list_bg)-13,.5*ccHeight(list_bg));var off_label=cmLabel.getLabel(res_str("btn_label_attachment"),LABEL_FONT_INDEX.FONT_241);off_label.setAnchorPoint(ANCHOR_MIDDLE()),off_label.setPosition(ccCenter(off)),off.addChild(off_label),list_bg.addChild(off),this.m_reward_btn.push_back(off);var on=cc.Sprite.create("#btn_05_on.png");on.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),on.setPosition(ccWidth(list_bg)-13,.5*ccHeight(list_bg));var on_label=cmLabel.getLabel(res_str("btn_label_attachment"),LABEL_FONT_INDEX.FONT_242);on_label.setAnchorPoint(ANCHOR_MIDDLE()),on_label.setPosition(ccCenter(on)),on.addChild(on_label),list_bg.addChild(on),on.setVisible(!1),this.m_reward_btn.push_back(on);var none=cc.Sprite.create("#btn_04_none.png");none.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),none.setPosition(ccWidth(list_bg)-13,.5*ccHeight(list_bg));var none_label=cmLabel.getLabel(res_str("btn_label_attachment"),LABEL_FONT_INDEX.FONT_242);return none_label.setAnchorPoint(ANCHOR_MIDDLE()),none_label.setPosition(ccCenter(none)),none.addChild(none_label),list_bg.addChild(none),none.setVisible(!1),this.m_reward_btn.push_back(none),this.m_disable_cover=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",cc.Rect(1,1,1,1)),this.m_disable_cover.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_disable_cover.setPreferredSize(size),this.m_disable_cover.setPosition(ZERO()),this.addChild(this.m_disable_cover),this.m_disable_cover.setVisible(!1),this.m_complete_mark=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs/img_eventvs_complete.png"),this.m_complete_mark.setAnchorPoint(ANCHOR_MIDDLE()),this.m_complete_mark.setPosition(ccCenter(size)),this.addChild(this.m_complete_mark),this.m_complete_mark.setVisible(!1),!0},setRewardData:function(data,event_dungeon_period_idx){this.m_data=data,this.m_event_dungeon_period_idx=event_dungeon_period_idx,this.update()},update:function(){var mm=MasterManager.getInstance(),data=mm.get_EventDungeonVoteLeagueUsePointRewardV3(this.m_data.vote_reward_idx,this.m_event_dungeon_period_idx,this.m_data.vote_type),bonus=mm.get_BonusType(data.bonus_type),period=mm.get_EventDungeonPeriod(data.event_dungeon_period_idx);switch(this.m_icon.setScale(1),data.bonus_type){case BONUS_TYPE_GOLD:case BONUS_TYPE_KEY:case BONUS_TYPE_HEART:case BONUS_TYPE_JADE:this.m_reward_name.setString(cmString(res_str("label_marathon_reward_item_count"),bonus.name,Number(data.min).toLocaleString("en")));var frame=cc.spriteFrameCache.getSpriteFrame("img_reward_"+leadingZeros(data.bonus_type,2)+".png");this.m_icon.setSpriteFrame(frame);break;case BONUS_TYPE_YUNHEE_FIX:var g=MasterManager.getInstance().get_General(data.min);MasterManager.getInstance().get_RareType(g.rare_type);if(this.m_reward_name.setString(cmString(res_str("label_marathon_reward_item_count"),g.name,Number(data.max).toLocaleString("en"))),IS_SP_BROWSER)if(g.gnrl_type==GENERAL_TYPE_MATERIAL||g.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL)if(DISABLE_SPB_TP)this.m_icon.setTexture(RES_CDN_CARD_MEDIUM_NTP+"m_"+g.bone_id+".png"),this.m_icon.setScale(DEF_TUMB_SCALE);else{frame=cc.spriteFrameCache.getSpriteFrame("m_"+g.bone_id+".png");this.m_icon.setSpriteFrame(frame),this.m_icon.setScale(DEF_TUMB_SCALE)}else if(DISABLE_SPB_TP)this.m_icon.setTexture(RES_CDN_CARD_MEDIUM_NTP+"m_"+g.gnrl_id+".png"),this.m_icon.setScale(DEF_TUMB_SCALE);else{frame=cc.spriteFrameCache.getSpriteFrame("m_"+g.gnrl_id+".png");this.m_icon.setSpriteFrame(frame),this.m_icon.setScale(DEF_TUMB_SCALE)}else if(g.gnrl_type==GENERAL_TYPE_MATERIAL||g.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL){frame=cc.spriteFrameCache.getSpriteFrame("m_"+g.bone_id+".png");this.m_icon.setSpriteFrame(frame),this.m_icon.setScale(DEF_TUMB_SCALE)}else{frame=cc.spriteFrameCache.getSpriteFrame("m_"+g.gnrl_id+".png");this.m_icon.setSpriteFrame(frame),this.m_icon.setScale(DEF_TUMB_SCALE)}break;case BONUS_TYPE_HWANDAN_1:case BONUS_TYPE_HWANDAN_2:case BONUS_TYPE_HWANDAN_3:case BONUS_TYPE_HWANDAN_4:case BONUS_TYPE_HWANDAN_5:case BONUS_TYPE_HWANDAN_6:case BONUS_TYPE_HWANDAN_7:this.m_reward_name.setString(cmString(res_str("label_marathon_reward_item_count"),bonus.name,Number(data.min).toLocaleString("en")));frame=cc.spriteFrameCache.getSpriteFrame("img_reward_"+leadingZeros(data.bonus_type,2)+".png");this.m_icon.setSpriteFrame(frame);break;case BONUS_TYPE_LOVE_ITEM_MELEE:case BONUS_TYPE_LOVE_ITEM_LANCER:case BONUS_TYPE_LOVE_ITEM_RANGER:case BONUS_TYPE_LOVE_ITEM_CAKE:case BONUS_TYPE_SUPER_CHOCO_CAKE:case BONUS_TYPE_LOVE_MAX_CAKE:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_01:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_02:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_03:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_04:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_05:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_06:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_07:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_08:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_09:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_10:case BONUS_TYPE_EVOLVE_STONE:case BONUS_TYPE_EVOLVE_ORB:this.m_reward_name.setString(cmString(res_str("label_marathon_reward_item_count"),bonus.name,Number(data.min).toLocaleString("en")));frame=cc.spriteFrameCache.getSpriteFrame("img_reward_"+leadingZeros(data.bonus_type,2)+".png");this.m_icon.setSpriteFrame(frame);break;case BONUS_TYPE_EVOLVE_MELEE:case BONUS_TYPE_EVOLVE_LANCER:case BONUS_TYPE_EVOLVE_ARCHER:this.m_reward_name.setString(cmString(res_str("label_marathon_reward_item_count"),bonus.name,Number(data.min).toLocaleString("en")));frame=cc.spriteFrameCache.getSpriteFrame("img_reward_"+leadingZeros(data.bonus_type,2)+".png");this.m_icon.setSpriteFrame(frame);break;case BONUS_TYPE_ATTK_POINT:case BONUS_TYPE_DEF_POINT:case BONUS_TYPE_HP_POINT:case BONUS_TYPE_CRI_PRCNT_POINT:case BONUS_TYPE_CRI_DMG_POINT:this.m_reward_name.setString(cmString(res_str("label_marathon_reward_item_count"),bonus.name,Number(data.min).toLocaleString("en")));frame=cc.spriteFrameCache.getSpriteFrame("img_reward_"+leadingZeros(data.bonus_type,2)+".png");this.m_icon.setSpriteFrame(frame);break;case BONUS_TYPE_JADE_RANDOM_BOX:case BONUS_TYPE_GOLD_RANDOM_BOX:case BONUS_TYPE_LOVE_ITEM_RANDOM_BOX:case BONUS_TYPE_RARE_HWANDAN_RANDOM_BOX:case BONUS_TYPE_EXP_CARD_RANDOM_BOX:case BONUS_TYPE_CHRISTMAS_GIFT_BOX:case BONUS_TYPE_SWORD_ORB_RANDDOM_BOX:case BONUS_TYPE_SPEAR_ORB_RANDDOM_BOX:case BONUS_TYPE_ARCHER_ORB_RANDDOM_BOX:case BONUS_TYPE_FORMATION_PROPERTY_POINT_RANDOM_BOX:case BONUS_TYPE_FORMATION_PROPERTY_POINT_GIFT_BOX:this.m_reward_name.setString(cmString(res_str("label_marathon_reward_item_count"),bonus.name,Number(data.min).toLocaleString("en")));frame=cc.spriteFrameCache.getSpriteFrame("img_reward_"+leadingZeros(data.bonus_type,2)+".png");this.m_icon.setSpriteFrame(frame);break;case BONUS_TYPE_R_RARE_TYPE_ENGAGE:case BONUS_TYPE_HR_RARE_TYPE_ENGAGE:case BONUS_TYPE_SR_RARE_TYPE_ENGAGE:case BONUS_TYPE_SSR_RARE_TYPE_SELECT:case BONUS_TYPE_SR_OVER_GACHA_TICKET:this.m_reward_name.setString(cmString(res_str("label_marathon_reward_item_count"),bonus.name,Number(data.min).toLocaleString("en")));frame=cc.spriteFrameCache.getSpriteFrame("img_reward_"+leadingZeros(data.bonus_type,2)+".png");this.m_icon.setSpriteFrame(frame);break;case BONUS_TYPE_SR_LIMIT_OVER_MTRL:case BONUS_TYPE_SSR_LIMIT_OVER_MTRL:default:this.m_reward_name.setString(cmString(res_str("label_marathon_reward_item_count"),bonus.name,Number(data.min).toLocaleString("en")));frame=cc.spriteFrameCache.getSpriteFrame("img_reward_"+leadingZeros(data.bonus_type,2)+".png");this.m_icon.setSpriteFrame(frame)}this.m_reward_info.setString(data.reward_info),this.m_event_dungeon_point={},EventDungeonService.getInstance().getUserEventDungeonPoint(period.event_dungeon_point_period_idx,this.m_event_dungeon_point);this.m_event_dungeon_point.accum_event_point,this.m_event_dungeon_point.event_point;"n"==this.m_data.complete_yn?(this.m_disable_cover.setVisible(!0),this.m_complete_mark.setVisible(!1),this.m_reward_btn.at(0).setVisible(!1),this.m_reward_btn.at(1).setVisible(!1),this.m_reward_btn.at(2).setVisible(!0)):"y"==this.m_data.reward_yn?(this.m_disable_cover.setVisible(!0),this.m_complete_mark.setVisible(!0),this.m_reward_btn.at(0).setVisible(!1),this.m_reward_btn.at(1).setVisible(!1),this.m_reward_btn.at(2).setVisible(!0)):(this.m_disable_cover.setVisible(!1),this.m_complete_mark.setVisible(!1),this.m_reward_btn.at(0).setVisible(!0),this.m_reward_btn.at(1).setVisible(!1),this.m_reward_btn.at(2).setVisible(!1))},highlightPosInItem:function(pos,table_in_pos){if("y"!=this.m_data.reward_yn&&"n"!=this.m_data.complete_yn){var this_rect=this.getBoundingBox(),r=this.m_reward_btn.at(0).getBoundingBox();return r.x+=this_rect.x,r.y+=this_rect.y,cc.rectContainsPoint(r,pos)?(this.m_reward_btn.at(0).setVisible(!1),this.m_reward_btn.at(1).setVisible(!0),void this.m_reward_btn.at(2).setVisible(!1)):void 0}},unhighlightPosInItem:function(pos,table_in_pos){"y"!=this.m_data.reward_yn&&"n"!=this.m_data.complete_yn&&(this.m_reward_btn.at(0).setVisible(!0),this.m_reward_btn.at(1).setVisible(!1),this.m_reward_btn.at(2).setVisible(!1))},touchPosInItem:function(pos,table_in_pos){if("y"!=this.m_data.reward_yn&&"n"!=this.m_data.complete_yn){var this_rect=this.getBoundingBox(),r=this.m_reward_btn.at(0).getBoundingBox();r.x+=this_rect.x,r.y+=this_rect.y,cc.rectContainsPoint(r,pos)&&(this.m_reward_btn.at(0).setVisible(!0),this.m_reward_btn.at(1).setVisible(!1),this.m_reward_btn.at(2).setVisible(!1),null!=this._callback&&this._callback(this.m_data))}}}),EventDungeonVoteLeagueV3VoteRewardLayer=cc.Layer.extend({m_tableView:null,m_event_dungeon_period_idx:0,m_is_prv_event_dungeon:!1,m_point_label:null,m_info_label:null,m_first_btn:null,m_second_btn:null,m_all_reward_btn:null,m_first_event_period_idx:0,m_second_event_period_idx:0,m_event_dungeon_point:null,m_vote_type:1,m_reward:[],IsAfterReward:!1,m_first_period_reward_icon:null,m_second_period_reward_icon:null,ctor:function(){this._super(),this.m_reward=[],this.m_event_dungeon_point={},this.init()},init:function(){AudioEngine.getInstance().playEffect(RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3"),this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var winSize=ccSize(this);this.m_is_prv_event_dungeon=BattleContext._getInstance().getIsPrvEventDungeon(),this.m_is_prv_event_dungeon?this.m_event_dungeon_period_idx=BattleContext._getInstance().getPrvEventDungeonPeriodIdx():this.m_event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),this.m_period=MasterManager.getInstance().get_EventDungeonPeriod(this.m_event_dungeon_period_idx),this.m_first_event_period_idx=EventDungeonService.getInstance().getEventDungeonFirstHalfPeriodIdx(this.m_period.event_dungeon_group_idx),this.m_second_event_period_idx=EventDungeonService.getInstance().getEventDungeonSecondHalfPeriodIdx(this.m_period.event_dungeon_group_idx),this.m_event_dungeon_period_idx=this.m_first_event_period_idx,this.m_reward=NetService().get_User_Vote_Reward_Info_V3(this.m_event_dungeon_period_idx),EventDungeonService.getInstance().getUserEventDungeonPoint(this.m_event_dungeon_period_idx,this.m_event_dungeon_point);var bg=cc.Sprite.create(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/bg_eventvs_sub.jpg",this.m_event_dungeon_period_idx));return bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(winSize)),USE_SP_EVENT_SCALE?bg.setScale(2):bg.setScale(1),this.addChild(bg),this.m_resource_list=[],this.m_resource_list.push(cmString(RES_CDN_DEFULT+"common/img_box_01.png")),resourceLoader(this.m_resource_list,function(){var bgBoxLayer=this.getRewardBoxLayer();bgBoxLayer.ignoreAnchorPointForPosition(!1),bgBoxLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bgBoxLayer.setPosition(ccCenter(this).x,0),this.addChild(bgBoxLayer),this.RefreshInfoLabel()}.bind(this)),!0},getRewardBoxLayer:function(){var layer=new cc.Layer,service=(GameContext.getInstance().getAchievementTap(),EventDungeonService.getInstance()),is_second_open=!1,mt=MasterManager.getInstance(),first_event_period=mt.get_EventDungeonPeriod(this.m_first_event_period_idx),second_event_period=mt.get_EventDungeonPeriod(this.m_second_event_period_idx);this.m_is_prv_event_dungeon?service.IsOpenEventPointPeriod(this.m_second_event_period_idx)&&(is_second_open=!0):service.IsOpenDungeon(this.m_second_event_period_idx)&&(is_second_open=!0);var pos_x=17;this.m_first_btn=new LabelButton("btn_07_none.png","btn_07_on.png","btn_07_off.png",ccui.Widget.PLIST_TEXTURE),this.m_first_btn.setFont(LABEL_FONT_INDEX.FONT_201),this.m_first_btn.setString(mt.get_EventPointUnitType(first_event_period.event_point_unit_type).name),this.m_first_btn.setAnchorPoint(ZERO()),this.m_first_btn.setPosition(pos_x,508),this.m_first_btn.addClickEventListener(function(sender){this.setTab(this.m_first_event_period_idx,1),this.RefreshInfoLabel()}.bind(this)),layer.addChild(this.m_first_btn),pos_x+=ccWidth(this.m_first_btn),this.m_first_period_reward_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_first_period_reward_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_first_period_reward_icon.setPosition(ccWidth(this.m_first_btn)-15,ccHeight(this.m_first_btn)),this.m_first_btn.addChild(this.m_first_period_reward_icon),this.m_first_period_reward_icon.setVisible(!1),is_second_open&&(this.m_second_btn=new LabelButton("btn_07_none.png","btn_07_on.png","btn_07_off.png",ccui.Widget.PLIST_TEXTURE),this.m_second_btn.setFont(LABEL_FONT_INDEX.FONT_201),this.m_second_btn.setString(mt.get_EventPointUnitType(second_event_period.event_point_unit_type).name),this.m_second_btn.setAnchorPoint(ZERO()),this.m_second_btn.setPosition(pos_x,508),this.m_second_btn.addClickEventListener(function(sender){this.setTab(this.m_second_event_period_idx,2),this.RefreshInfoLabel()}.bind(this)),layer.addChild(this.m_second_btn),pos_x+=ccWidth(this.m_second_btn),this.m_second_period_reward_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_second_period_reward_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_second_period_reward_icon.setPosition(ccWidth(this.m_second_btn)-15,ccHeight(this.m_second_btn)),this.m_second_btn.addChild(this.m_second_period_reward_icon),this.m_second_period_reward_icon.setVisible(!1));var bg_box=cc.Sprite.create(RES_CDN_DEFULT+"common/img_box_01.png");bg_box.setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),layer.addChild(bg_box),layer.setContentSize(ccSize(bg_box)),this.m_point_label=cmLabel.getLabel(cmString(res_str("label_event_dungeon_vote_league_use_reward_count"),"1","1"),LABEL_FONT_INDEX.FONT_227),this.m_point_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_point_label.setPosition(36,472),bg_box.addChild(this.m_point_label),this.m_info_label=cmLabel.getLabel(res_str("label_event_dungeon_vote_league_use_reward_info"),LABEL_FONT_INDEX.FONT_161),this.m_info_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_info_label.setPosition(36,452),bg_box.addChild(this.m_info_label),this.m_all_reward_btn=new LabelButton("btn_11_off.png","btn_11_on.png","btn_11_none.png",ccui.Widget.PLIST_TEXTURE),this.m_all_reward_btn.setFont(LABEL_FONT_INDEX.FONT_241),this.m_all_reward_btn.setAnchorPoint(ZERO()),this.m_all_reward_btn.setPosition(710,453),this.m_all_reward_btn.setFont(LABEL_FONT_INDEX.FONT_201),this.m_all_reward_btn.setString(res_str("btn_label_all_accept")),this.m_all_reward_btn.addClickEventListener(function(sender){var req={};req.opcode=net.OP.op_user_event_dungeon_vote_reward_all_V3,req.event_dungeon_period_idx=this.m_event_dungeon_period_idx,req.vote_paper_type=this.m_vote_type,SceneManager.getInstance().getRunningScene().network_write(req)}.bind(this)),bg_box.addChild(this.m_all_reward_btn);var end_dt=moment(this.m_period.event_dungeon_point_end_dt),end_msg_dt={year:end_dt.year(),month:end_dt.month()+1,day:end_dt.date(),hour:end_dt.hour(),minute:end_dt.minute(),"second ":end_dt.second()},reward_between_dt=cmLabel.getLabel(cmString(res_str("event_vote_reward_period_text"),end_msg_dt.year,end_msg_dt.month,end_msg_dt.day),LABEL_FONT_INDEX.FONT_221);reward_between_dt.enableOutline(cc.color.BLACK,2),reward_between_dt.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),reward_between_dt.setPosition(ccWidth(bg_box)-10,ccHeight(bg_box)+5),bg_box.addChild(reward_between_dt);var tSize=cc.size(924,425);return this.m_tableView=new cc.TableView(this,tSize),this.m_tableView.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_tableView.setPosition(17,18),this.m_tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_tableView.setDelegate(this),layer.addChild(this.m_tableView),this.m_tableView.reloadData(),this.setTab(this.m_first_event_period_idx,1),this.updateAllReceiveBtn(),this.updateAchvNewIcon(),layer},setTab:function(period_idx,vote_type){1==vote_type?(this.m_first_btn.setEnabled(!1),null!=this.m_second_btn&&this.m_second_btn.setEnabled(!0)):2==vote_type&&(this.m_first_btn.setEnabled(!0),this.m_second_btn.setEnabled(!1)),this.m_event_dungeon_period_idx=period_idx,this.m_vote_type=vote_type,this.reloadTableView()},RefreshInfoLabel:function(){var mt=MasterManager.getInstance(),event_period=mt.get_EventDungeonPeriod(this.m_event_dungeon_period_idx),UnitName=mt.get_EventPointUnitType(event_period.event_point_unit_type).name,service=EventDungeonService.getInstance(),EventPoint=new db.UserEventDungeonPoint;service.getUserEventDungeonPoint(this.m_event_dungeon_period_idx,EventPoint),this.m_point_label.setString(cmString(res_str("label_event_dungeon_vote_league_use_reward_count"),UnitName,Number(EventPoint.accum_event_point-EventPoint.event_point).toLocaleString("en"))),this.m_info_label.setString(cmString(res_str("label_event_dungeon_vote_league_use_reward_info"),UnitName))},reloadTableView:function(IsAfterReward){this.m_reward=NetService().get_User_Vote_Reward_Info_V3(this.m_event_dungeon_period_idx);var offset=this.m_tableView.getContentOffset();this.m_tableView.reloadData(),IsAfterReward&&this.m_tableView.setContentOffset(offset),this.updateAllReceiveBtn(),this.updateAchvNewIcon()},onEnter:function(){this._super()},onExit:function(){this._super()},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;cell=null!=c?c:new EventDungeonVoteLeagueV3VoteReawardCell(this.cbReceiveReward.bind(this),this.m_event_dungeon_period_idx);var desc=[],start=2*idx,end=start+2;if(end<this.m_reward.length)for(idx=start;idx<end;idx++)desc.push(this.m_reward[idx]);else for(idx=start;idx<this.m_reward.length;idx++)desc.push(this.m_reward[idx]);return cell.setRewardData(desc,this.m_event_dungeon_period_idx),cell},numberOfCellsInTableView:function(table){var cnt=0;return cnt=this.m_reward.size()/2,0<this.m_reward.size()%2&&(cnt+=1),cnt},tableCellSizeForIndex:function(table,idx){return cc.size(924,78)},cellSizeForTable:function(){return cc.size(924,78)},tableCellTouched:function(table,cell){null!=cell&&cell.touchPosInCell(cell.getTouchPos())},tableCellHighlight:function(table,cell){null!=cell&&cell.highlightPosInCell(cell.getTouchPos())},tableCellUnhighlight:function(table,cell){null!=cell&&cell.unhighlightPosInCell(cell.getTouchPos())},tableCellEnded:function(table){return!0},updateAllReceiveBtn:function(){-1!=this.m_reward.findIndex(function(r){return"y"==r.complete_yn&&"n"==r.reward_yn}.bind(this))?this.m_all_reward_btn.setEnabled(!0):this.m_all_reward_btn.setEnabled(!1)},cbReceiveReward:function(reward){if("y"!=reward.reward_yn){AudioEngine.getInstance().playEffect(RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3");var req={};req.opcode=net.OP.op_user_event_dungeon_vote_reward_V3,req.event_dungeon_period_idx=this.m_event_dungeon_period_idx,req.vote_reward_idx=reward.vote_reward_idx,req.use_vote_type=reward.vote_type;var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent)}},updateAchvNewIcon:function(){var AnotherEventPeriodIndex=this.m_event_dungeon_period_idx==this.m_first_event_period_idx?this.m_second_event_period_idx:this.m_first_event_period_idx,another_reward=NetService().get_User_Vote_Reward_Info_V3(AnotherEventPeriodIndex);-1!=this.m_reward.findIndex(function(r){return"y"==r.complete_yn&&"n"==r.reward_yn}.bind(this))?this.m_event_dungeon_period_idx==this.m_first_event_period_idx?this.m_first_period_reward_icon.setVisible(!0):this.m_second_period_reward_icon&&this.m_second_period_reward_icon.setVisible(!0):this.m_event_dungeon_period_idx==this.m_first_event_period_idx?this.m_first_period_reward_icon.setVisible(!1):this.m_second_period_reward_icon&&this.m_second_period_reward_icon.setVisible(!1),-1!=another_reward.findIndex(function(r){return"y"==r.complete_yn&&"n"==r.reward_yn}.bind(this))?AnotherEventPeriodIndex==this.m_first_event_period_idx?this.m_first_period_reward_icon.setVisible(!0):this.m_second_period_reward_icon&&this.m_second_period_reward_icon.setVisible(!0):AnotherEventPeriodIndex==this.m_first_event_period_idx?this.m_first_period_reward_icon.setVisible(!1):this.m_second_period_reward_icon&&this.m_second_period_reward_icon.setVisible(!1)}}),EventDungeonVoteLeagueV3VoteRewardScene=GameScene.extend({m_is_prv_event_dungeon:!1,m_statusLayer:null,ctor:function(){this._super(scene_EventDungeonVoteLeagueV3VoteRewardScene)},init:function(){var win_size=cc.director.getWinSize(),event_dungeon_period_idx=0;this.m_is_prv_event_dungeon=BattleContext._getInstance().getIsPrvEventDungeon(),event_dungeon_period_idx=this.m_is_prv_event_dungeon?BattleContext._getInstance().getPrvEventDungeonPeriodIdx():BattleContext._getInstance().getEventDungeonPeriodIdx(),this.m_period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),this.m_layer=new EventDungeonVoteLeagueV3VoteRewardLayer,this.m_layer.setPosition(ccCenter(win_size)),this.addChild(this.m_layer),this.m_statusLayer=new StatusLayer(INVOKER_TYPE.normal),this.m_statusLayer.initLayout(),this.m_statusLayer.ignoreAnchorPointForPosition(!1),this.m_statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(this.m_statusLayer);var back_btn=new ccui.Button;back_btn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png",""),back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(){this.back()}.bind(this)),this.addChild(back_btn);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_eventvs.png");return title.setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title),!0},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_EventDungeonVoteLeagueV3VoteRewardScene]);var audio=AudioEngine.getInstance(),m=MasterTable.getInstance();if(BattleContext._getInstance().getIsPrvEventDungeon())var bgm=m.get_Bgm_v2(BGM_TYPE_PRV_EVENT_MAIN_BGM);else{var period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();bgm=m.get_EventDungeonFromEventDungeonPeriodIdx(period_idx).event_dungeon_type==EVENT_DUNGEON_TYPE_LINLIN?m.get_Bgm_v2(BGM_TYPE_CRAFT_EVENT_MAIN_BGM):m.get_Bgm_v2(BGM_TYPE_EVENT_MAIN_BGM)}var main_bgm=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm.sound_file_name;audio.m_bgmPath!=main_bgm&&(audio.stopBackgroundMusic(),audio.m_bgmPath="",audio.playBackgroundMusic(main_bgm,!0))},onExit:function(){this._super(),MainObserver.getInstance().removeObserver(sceneStr[scene_EventDungeonVoteLeagueV3VoteRewardScene])},onEnterTransitionDidFinish:function(){this._super()},onNotification:function(msg){return!this._super(msg)},onNetworkEvent:function(opcode,state,body){this._super(opcode,state,body),opcode==net.OP.op_user_event_dungeon_vote_reward_info_V3?this.m_layer.reloadTableView():opcode==net.OP.op_user_event_dungeon_vote_reward_V3?(this.m_layer.reloadTableView(!0),this.ShowReceiveVoteRewardMsgBox()):opcode==net.OP.op_user_event_dungeon_vote_reward_all_V3&&(this.m_layer.reloadTableView(),this.ShowReceiveVoteRewardMsgBox())},back:function(){this.onKeyBack(!0)},ShowReceiveVoteRewardMsgBox:function(){this.m_box.setTitle(res_str("label_achievement_receive_title")),this.m_box.setText(res_str("uni_msg_explorer_receive_item_mail")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()}}),EventDungeonRaidBoxGachaRecvItemCell=cc.TableViewCell.extend({m_item_desc:null,cellSize:null,ctor:function(){this._super(),this.init()},init:function(){return this.cellSize=cc.size(600,32),this.setContentSize(this.cellSize),!0},setData:function(data){this.updateCell(data)},updateCell:function(data){var m=MasterManager.getInstance();if(data.bonus_type==BONUS_TYPE_YUNHEE_FIX){var gnrl=m.get_General(data.bonus_idx);null!=this.m_item_desc&&null!=this.m_item_desc.getParent()&&(this.removeChild(this.m_item_desc),this.m_item_desc=null),0<data.is_accent?this.m_item_desc=cmLabel.getLabel(cmString(res_str("label_event_dungeon_box_gacha_recv_accent_item"),gnrl.name,data.bonus_count),LABEL_FONT_INDEX.FONT_227):this.m_item_desc=cmLabel.getLabel(cmString(res_str("label_event_dungeon_box_gacha_recv_item"),gnrl.name,data.bonus_count),LABEL_FONT_INDEX.FONT_221),this.m_item_desc.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_desc.setPosition(ccCenter(this.cellSize)),this.addChild(this.m_item_desc)}else if(data.bonus_type==BONUS_TYPE_EQUIPMENT){var equip=m.get_EquipmentItem(data.bonus_idx);null!=this.m_item_desc&&null!=this.m_item_desc.getParent()&&(this.removeChild(this.m_item_desc),this.m_item_desc=null),this.m_item_desc=cmLabel.getLabel(cmString(res_str("label_event_dungeon_box_gacha_recv_item"),equip.name,data.bonus_count),LABEL_FONT_INDEX.FONT_221),this.m_item_desc.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_desc.setPosition(ccCenter(this.cellSize)),this.addChild(this.m_item_desc)}else if(data.bonus_type==BONUS_TYPE_HR_RARE_TYPE_ENGAGE||data.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE||data.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||data.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||data.bonus_type==BONUS_TYPE_JADE||data.bonus_type==BONUS_TYPE_EVOLVE_ORB||data.bonus_type==BONUS_TYPE_SR_RARE_TYPE_ENGAGE||data.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||data.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){var bonus=m.get_BonusType(data.bonus_type);null!=this.m_item_desc&&null!=this.m_item_desc.getParent()&&(this.removeChild(this.m_item_desc),this.m_item_desc=null),0<data.is_accent?this.m_item_desc=cmLabel.getLabel(cmString(res_str("label_event_dungeon_box_gacha_recv_accent_item"),bonus.name,data.bonus_count),LABEL_FONT_INDEX.FONT_227):this.m_item_desc=cmLabel.getLabel(cmString(res_str("label_event_dungeon_box_gacha_recv_item"),bonus.name,data.bonus_count),LABEL_FONT_INDEX.FONT_221),this.m_item_desc.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_desc.setPosition(ccCenter(this.cellSize)),this.addChild(this.m_item_desc)}else{bonus=m.get_BonusType(data.bonus_type);null!=this.m_item_desc&&null!=this.m_item_desc.getParent()&&(this.removeChild(this.m_item_desc),this.m_item_desc=null),0<data.is_accent?this.m_item_desc=cmLabel.getLabel(cmString(res_str("label_event_dungeon_box_gacha_recv_accent_item"),bonus.name,data.bonus_count),LABEL_FONT_INDEX.FONT_227):this.m_item_desc=cmLabel.getLabel(cmString(res_str("label_event_dungeon_box_gacha_recv_item"),bonus.name,data.bonus_count),LABEL_FONT_INDEX.FONT_221),this.m_item_desc.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_desc.setPosition(ccCenter(this.cellSize)),this.addChild(this.m_item_desc)}cmLabel.autoSizeFit(this.m_item_desc,600,22)}}),EventDungeonRaidBoxGachaRecvItemPopup=cc.Layer.extend({m_close_callback:null,m_table_view:null,m_recv_item_list:[],ctor:function(res,_close_callback){this._super(),this.m_recv_item_list=[],this.init(res,_close_callback)},init:function(res,_close_callback){this.m_close_callback=_close_callback;var winSize=ccSize(this),box=(cc.size(630,440),cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10)));box.setAnchorPoint(ANCHOR_MIDDLE()),box.setPreferredSize(cc.size(630,440)),box.setPosition(.5*winSize.width,.5*winSize.height),this.addChild(box);var navi=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_navi.png",RectZero());navi.setInsetLeft(40),navi.setInsetRight(40),navi.setPreferredSize(cc.size(614,48)),navi.setAnchorPoint(ANCHOR_TOP_LEFT()),navi.setPosition(8,ccHeight(box)-11),box.addChild(navi);var navi_title=cmLabel.getLabel(res_str("label_event_dungeon_box_gacha_item_list_title"),LABEL_FONT_INDEX.FONT_261);navi_title.setAnchorPoint(ANCHOR_MIDDLE()),navi_title.setPosition(ccCenter(navi).x,ccCenter(navi).y+3),navi.addChild(navi_title);var btn=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn.setPosition(.5*ccWidth(box),16),btn.addClickEventListener(function(sender){null!=this.m_close_callback&&this.m_close_callback()}.bind(this)),box.addChild(btn);var btn_label=cmLabel.getLabel(res_str("label_confirm"),LABEL_FONT_INDEX.FONT_241);btn_label.setAnchorPoint(ANCHOR_MIDDLE()),btn_label.setPosition(.5*ccWidth(btn),.5*ccHeight(btn)),btn.addChild(btn_label);for(var count=0,i=0;i<res.reward_items.length;i++){var item=res.reward_items[i],data={};data.event_dungeon_period_idx=res.event_dungeon_period_idx;var Max_Count=MasterManager.getInstance().get_EventRaidBoxGacha(res.event_dungeon_period_idx,res.buy_log.at(count).event_raid_box_gacha_idx,res.delimiter).total_count;data.is_accent=Max_Count,item.bonus_type==BONUS_TYPE_YUNHEE_FIX?(data.bonus_type=item.bonus_type,data.bonus_idx=item.bonus_idx,data.bonus_count=item.bonus_level):item.bonus_type==BONUS_TYPE_EQUIPMENT?(data.bonus_type=item.bonus_type,data.bonus_count=1,data.bonus_idx=item.equipment.equipment_item_idx):(item.bonus_type==BONUS_TYPE_HR_RARE_TYPE_ENGAGE||item.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE||item.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||item.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||item.bonus_type==BONUS_TYPE_JADE||item.bonus_type==BONUS_TYPE_EVOLVE_ORB||item.bonus_type==BONUS_TYPE_SR_RARE_TYPE_ENGAGE||item.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||(item.bonus_type,BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6),data.bonus_type=item.bonus_type,data.bonus_count=item.bonus_idx),this.m_recv_item_list.push(data),count++}this.m_recv_item_list.sort(function(l,r){return l.is_accent<r.is_accent?1:l.is_accent>r.is_accent?-1:0});var tableSize=cc.size(600,260);return this.m_table_view=new cc.TableView(this,tableSize),this.m_table_view.ignoreAnchorPointForPosition(!1),this.m_table_view.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_table_view.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_table_view.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_table_view.setPosition(.5*ccWidth(box),ccHeight(box)-81),box.addChild(this.m_table_view),!0},cellSizeForTable:function(table){return cc.size(600,32)},tableCellSizeForIndex:function(table){return cc.size(600,32)},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;return(cell=null!=c?c:new EventDungeonRaidBoxGachaRecvItemCell).setData(this.m_recv_item_list[idx]),cell},numberOfCellsInTableView:function(table){return this.m_recv_item_list.length}}),EventDungeonRaidEntranceScene=GameScene.extend({m_entrance_layer:null,m_script_modal:null,buy_log:[],ctor:function(){this.buy_log=[],this._super(scene_EventDungeonRaidEntranceScene)},init:function(){this.initLayoutProgress2();cc.director.getWinSize();this.m_entrance_layer=new EventDungeonRaidEntranceLayer,this.addChild(this.m_entrance_layer);var statusLayer=new StatusLayer;statusLayer.initLayout(),statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer);BattleContext._getInstance().getEventDungeonPeriodIdx();var title,back_btn=new ccui.Button;(back_btn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png",""),back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(){0==RAID_BOSS_MODAL_OPEN_FLAG&&this.back()}.bind(this)),this.addChild(back_btn),USE_SP_EVENT_SCALE)?((title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_eventvs.png")).setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title)):((title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_eventvs.png")).setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title));return this.m_script_modal=new GameModalLayer,this.addChild(this.m_script_modal,99999),!0},onEnter:function(){this._super();var audio=AudioEngine.getInstance();if(MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_EventDungeonRaidEntranceScene]),USE_EVENT_BGM){var m=MasterTable.getInstance();if(BattleContext._getInstance().getIsPrvEventDungeon())var bgm=m.get_Bgm_v2(BGM_TYPE_PRV_EVENT_MAIN_BGM);else{var period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();bgm=m.get_EventDungeonFromEventDungeonPeriodIdx(period_idx).event_dungeon_type==EVENT_DUNGEON_TYPE_LINLIN?m.get_Bgm_v2(BGM_TYPE_CRAFT_EVENT_MAIN_BGM):m.get_Bgm_v2(BGM_TYPE_EVENT_MAIN_BGM)}var main_bgm=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm.sound_file_name;audio.m_bgmPath!=main_bgm&&(audio.stopBackgroundMusic(),audio.m_bgmPath="",audio.playBackgroundMusic(main_bgm,!0))}else{var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),b_path=RES_CDN_SOUND+SND_TYPE+"sound/"+cmString("BGM_marathon_loop_%d.mp3",period.event_dungeon_point_period_idx);audio.m_bgmPath!=b_path&&(audio.stopBackgroundMusic(),audio.playBackgroundMusic(b_path,!0))}},onEnterTransitionDidFinish:function(){this._super(),(req={}).opcode=net.OP.op_event_dungeon_box_gacha_buy_log_v2;var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx);if(req.event_dungeon_period_idx=period.prev_event_dungeon_group_idx,req.event_dungeon_box_gacha_idx=1,this.network_write(req),USE_EVENT_DUNGEON_ACHIEVEMENT){var context=BattleContext._getInstance();event_dungeon_period_idx=0;if(!context.getIsPrvEventDungeon()){event_dungeon_period_idx=context.getEventDungeonPeriodIdx();var req;period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx);(req={}).opcode=net.OP.op_user_event_dungeon_achv_list,req.event_dungeon_period_idx=period.event_dungeon_group_idx,this.network_write(req)}}},onExit:function(){this._super(),MainObserver.getInstance().removeObserver(sceneStr[scene_EventDungeonRaidEntranceScene])},onNotification:function(msg){if(this._super(msg))return!1;if(msg==NOTIFY_MENU_SHOW_EVENT_SCRIPT)var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),prev_event_dungeon_idx=(period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx)).prev_event_dungeon_group_idx;else if(msg==NOTIFY_MENU_SHOW_EVENT_EPILOGUE){event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();var period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),is_prologue=!1,gacha_list=MasterTable.getInstance().get_EventDungeonBoxGachaV2List(period.prev_event_dungeon_group_idx);if((first_gacha=gacha_list[0]).event_dungeon_period_idx==period.prev_event_dungeon_group_idx)for(var i=0;i<this.buy_log.length;i++){var log=this.buy_log[i];if(first_gacha.event_dungeon_period_idx==log.event_dungeon_period_idx&&first_gacha.event_dungeon_box_gacha_idx==log.event_dungeon_box_gacha_idx){is_prologue=!0;break}}}else if(msg==NOTIFY_MENU_SHOW_PRE_EVENT_EPILOGUE){var first_gacha;event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),prev_event_dungeon_idx=(period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx)).prev_event_dungeon_group_idx,is_prologue=!1;if((first_gacha=(gacha_list=MasterTable.getInstance().get_EventDungeonBoxGachaV2List(period.prev_event_dungeon_group_idx))[0]).event_dungeon_period_idx==period.prev_event_dungeon_group_idx)for(i=0;i<this.buy_log.length;i++){log=this.buy_log[i];if(first_gacha.event_dungeon_period_idx==log.event_dungeon_period_idx&&first_gacha.event_dungeon_box_gacha_idx==log.event_dungeon_box_gacha_idx){is_prologue=!0;break}}if(is_prologue);else{var dungeon_list=MasterTable.getInstance().get_EventDungeonList(prev_event_dungeon_idx);0!=dungeon_list.length&&dungeon_list[0].event_dungeon_idx}}return!0},showEventScript:function(event_dungeon_idx,user_data){this.m_script_modal.setContentSize(ccSize(this)),this.m_script_modal._contentNode=function(contentSize,m){var script,layer=new cc.Layer;USE_UI_3RD_SCRIPT?((script=new BattleEventDungeonScriptLayerV2(user_data))._scriptViewCompleteNotBattle=this,script.loadScript(event_dungeon_idx,1,function(){script.typingBattleScript()}.bind(this)),layer.setContentSize(ccSize(this)),layer.setPosition(ccCenter(this)),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),layer.addChild(script)):((script=new BattleEventDungeonScriptLayer(user_data))._scriptViewCompleteNotBattle=this,script.loadScript(event_dungeon_idx,1,function(){script.typingBattleScript()}.bind(this)),layer.setContentSize(ccSize(this)),layer.setPosition(ccCenter(this)),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),layer.addChild(script));return layer}.bind(this),this.m_script_modal.is_show()||this.m_script_modal.show()},showEventEpilogue:function(event_dungeon_group_idx,prologue){this.m_script_modal.setContentSize(ccSize(this)),this.m_script_modal._contentNode=function(contentSize,m){this.initLayoutProgress();var layer=new cc.Layer,script=new EventDungeonEpilogueLayer;return script._scriptViewCompleteNotBattle=this,script.loadScript(event_dungeon_group_idx,4,function(){script.typingBattleScript()}.bind(this)),layer.setContentSize(ccSize(this)),layer.setPosition(ccCenter(this)),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),layer.addChild(script),layer}.bind(this),this.m_script_modal.is_show()||this.m_script_modal.show()},cbHideEventScript:function(){this.m_script_modal.is_show()&&this.m_script_modal.hide();var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=MasterTable.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),b_path=RES_CDN_SOUND+SND_TYPE+"sound/"+cmString("BGM_marathon_loop_%d.mp3",period.event_dungeon_point_period_idx),audio=AudioEngine.getInstance();audio.m_bgmPath!=b_path&&(audio.stopBackgroundMusic(),audio.playBackgroundMusic(b_path,!0))},scriptEventDungeonComplete:function(){this.m_script_modal.is_show()&&this.m_script_modal.hide();var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),b_path=RES_CDN_SOUND+SND_TYPE+"sound/"+cmString("BGM_marathon_loop_%d.mp3",period.event_dungeon_point_period_idx),audio=AudioEngine.getInstance();audio.m_bgmPath!=b_path&&(audio.stopBackgroundMusic(),audio.playBackgroundMusic(b_path,!0))},onNetworkEvent:function(opcode,state,body){if(this._super(opcode,state,body),opcode==net.OP.op_event_dungeon_box_gacha_buy_log_v2){for(var idx=0;idx<body.buy_log.length;idx++)this.buy_log.push(body.buy_log[idx]);var req={};req.opcode=net.OP.op_event_raid_dungeon_achieve_info,req.event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),this.network_write(req)}else if(opcode==net.OP.op_event_raid_dungeon_achieve_info)this.removeLayerProgress2(),null!=this.m_entrance_layer&&this.m_entrance_layer.is_raid_new_icon();else if(opcode==net.OP.op_event_raid_box_gacha_info){var scene=new EventDungeonRaidRewardGachaScene;SceneManager.getInstance().replaceScene(scene),scene=null}else if(opcode==net.OP.op_user_event_dungeon_achv_list)USE_EVENT_DUNGEON_ACHIEVEMENT&&this.m_entrance_layer.refreshEventDungeonAchvNewIcon();else if(opcode==net.OP.op_event_raid_dungeon_boss_info){var context=BattleContext._getInstance();context.setEventDungeonPeriodIdX(body.event_dungeon_period_idx),context.setGameType(db.BattleGameType.EventRaidDungeon);scene=new FriendSelectScene;SceneManager.getInstance().replaceScene(scene),scene=null}},back:function(){BattleContext._getInstance().setIsPrvEventDungeon(!1),this.onKeyBack(!0)}}),EventDungeonRaidEntranceLayer=cc.Layer.extend({m_achv_new_icon:null,m_period:null,m_event_dungeon_point:{},m_event_dungeon_cutin_accum_rate_point:{},m_event_dungeon_group_idx:0,m_first_half_period_idx:0,m_second_half_period_idx:0,m_limit_dungeon_period_idx:0,m_is_prv_event_dungeon:!1,m_epilogue_btn:null,m_raid_achv_new_icon:null,m_epilogue_select_popup:null,m_cutin_progress:null,m_cutin_info_btn:null,m_gnrl_img:null,ctor:function(){this._super(),this.m_gnrl_img=[],this.init()},init:function(){RAID_BOSS_MODAL_OPEN_FLAG=!1;var service=EventDungeonService.getInstance(),m=MasterManager.getInstance(),context=BattleContext._getInstance();context.setGameType(db.BattleGameType.EventDungeon);var event_dungeon_period_idx=0;this.m_is_prv_event_dungeon=BattleContext._getInstance().getIsPrvEventDungeon(),event_dungeon_period_idx=this.m_is_prv_event_dungeon?context.getPrvEventDungeonPeriodIdx():context.getEventDungeonPeriodIdx(),this.m_period=m.get_EventDungeonPeriod(event_dungeon_period_idx);for(var bg,period_list=NetService()._event_dungeon_open_period_info.event_dungeon_open_period,i=0;i<period_list.length;i++){var e=period_list[i];if(e.event_dungeon_period_idx==event_dungeon_period_idx){e;break}}(service.getUserEventDungeonPoint(this.m_period.event_dungeon_group_idx,this.m_event_dungeon_point),service.getUserEventDungeonCutinAccumRatePoint(this.m_period.event_dungeon_group_idx,this.m_event_dungeon_cutin_accum_rate_point),this.m_event_dungeon_group_idx=this.m_period.event_dungeon_group_idx,this.m_first_half_period_idx=service.getEventDungeonFirstHalfPeriodIdx(this.m_event_dungeon_group_idx),this.m_second_half_period_idx=service.getEventDungeonSecondHalfPeriodIdx(this.m_event_dungeon_group_idx),USE_SP_EVENT_SCALE)?((bg=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/bg_eventvs_main.jpg",this.m_event_dungeon_group_idx))).setPosition(ccCenter(this)),bg.setScale(2),this.addChild(bg)):((bg=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/bg_eventvs_main.jpg",this.m_event_dungeon_group_idx))).setPosition(ccCenter(this)),this.addChild(bg));var period_idx=this.m_first_half_period_idx;return this.m_is_prv_event_dungeon?service.IsOpenEventPointPeriod(this.m_second_half_period_idx)&&(period_idx=this.m_second_half_period_idx):service.IsOpenDungeon(this.m_second_half_period_idx)&&(period_idx=this.m_second_half_period_idx),this.m_gnrl_img.push(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_info_text.png",period_idx)),this.m_gnrl_img.push(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_info.png",period_idx)),resourceLoader(this.m_gnrl_img,function(){if(USE_SP_EVENT_SCALE){var right_layer=this.getRightLayer_SP();this.addChild(right_layer)}else{(right_layer=this.getRightLayer()).ignoreAnchorPointForPosition(!1),right_layer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),right_layer.setPosition(ccWidth(this),0),this.addChild(right_layer)}var help_btn=new LabelButton("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE);help_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),help_btn.setPosition(10,476),this.addChild(help_btn),help_btn.addClickEventListener(function(sender){GameContext.getInstance().setHelpInfoIndexByCallIndex(2);var scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null}.bind(this));var eventvs_info_text,offset_y=8;USE_SP_EVENT_SCALE?this.m_is_prv_event_dungeon||((eventvs_info_text=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_info_text.png",period_idx))).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),eventvs_info_text.setPosition(10,offset_y),eventvs_info_text.setScale(2),this.addChild(eventvs_info_text),offset_y+=ccHeight(eventvs_info_text)+16):this.m_is_prv_event_dungeon||((eventvs_info_text=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_info_text.png",period_idx))).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),eventvs_info_text.setPosition(10,offset_y),this.addChild(eventvs_info_text),offset_y+=ccHeight(eventvs_info_text)+9);var reward_gacha_btn=new LabelButton("btn_36_off.png","btn_36_on.png","btn_36_none.png",ccui.Widget.PLIST_TEXTURE);reward_gacha_btn.setFont(LABEL_FONT_INDEX.FONT_161),reward_gacha_btn.setColor(cc.color(238,238,238)),reward_gacha_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),reward_gacha_btn.setString(res_str("event_raid_quest_title_2")),reward_gacha_btn.setPosition(10,offset_y),this.addChild(reward_gacha_btn,3),reward_gacha_btn.addClickEventListener(function(){this.getGachaList()}.bind(this)),offset_y+=ccHeight(reward_gacha_btn)+10;var reward_btn=new LabelButton("btn_36_off.png","btn_36_on.png","btn_36_none.png",ccui.Widget.PLIST_TEXTURE);reward_btn.setFont(LABEL_FONT_INDEX.FONT_161),reward_btn.setColor(cc.color(238,238,238)),reward_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),reward_btn.setString(res_str("event_raid_quest_title_1")),reward_btn.setPosition(10,offset_y),this.addChild(reward_btn,2),reward_btn.addClickEventListener(function(){var scene=new EventDungeonRaidRewardScene;SceneManager.getInstance().replaceScene(scene),scene=null}.bind(this)),this.m_raid_achv_new_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_raid_achv_new_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_raid_achv_new_icon.setPosition(ccWidth(reward_btn),ccHeight(reward_btn)),reward_btn.addChild(this.m_raid_achv_new_icon),this.m_raid_achv_new_icon.setVisible(!1),offset_y+=ccHeight(reward_btn)+10;var achv_btn=new LabelButton("btn_36_off.png","btn_36_on.png","btn_36_none.png",ccui.Widget.PLIST_TEXTURE);(achv_btn.setFont(LABEL_FONT_INDEX.FONT_161),achv_btn.setColor(cc.color(238,238,238)),achv_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),achv_btn.setString(res_str("btn_label_event_mission")),achv_btn.setPosition(10,offset_y),this.addChild(achv_btn,1),achv_btn.addClickEventListener(function(sender){if(USE_EVENT_DUNGEON_ACHIEVEMENT){var scene=new EventDungeonAchievementScene_V2;SceneManager.getInstance().replaceScene(scene),scene=null}else GameContext.getInstance().setAchievementTap(ACHIEVEMENT_EVENTDUNGEON),MainObserver.getInstance().postNotification(NOTIFY_MENU_ACHIEV)}),achv_btn.setEnabled(!this.m_is_prv_event_dungeon),offset_y+=ccHeight(achv_btn)+10,this.m_achv_new_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_achv_new_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_achv_new_icon.setPosition(ccWidth(achv_btn),ccHeight(achv_btn)),achv_btn.addChild(this.m_achv_new_icon),this.m_achv_new_icon.setVisible(!1),null!=this.m_achv_new_icon)&&(USE_EVENT_DUNGEON_ACHIEVEMENT||(AchievementService.getInstance().isNewCompleteAchievementEventDungeon(this.m_period.event_dungeon_group_idx)?this.m_achv_new_icon.setVisible(!0):this.m_achv_new_icon.setVisible(!1)));this.m_is_prv_event_dungeon&&this.m_achv_new_icon.setVisible(!1);var is_exist_prev_dungeon=service.IsExistPrevEventDungeon(this.m_period.event_dungeon_group_idx);if(!this.m_is_prv_event_dungeon&&is_exist_prev_dungeon){var prv_event_dungeon_btn=new LabelButton("btn_36_off.png","btn_36_on.png","btn_36_none.png",ccui.Widget.PLIST_TEXTURE);prv_event_dungeon_btn.setFont(LABEL_FONT_INDEX.FONT_161),prv_event_dungeon_btn.setString(res_str("btn_label_prev_event_reward")),prv_event_dungeon_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),prv_event_dungeon_btn.setPosition(10,offset_y),this.addChild(prv_event_dungeon_btn),prv_event_dungeon_btn.addClickEventListener(function(sender){BattleContext._getInstance().setPrvEventDungeonPeriodIdx(this.m_period.prev_event_dungeon_group_idx),MainObserver.getInstance().postNotification(NOTIFY_MENU_PRV_EVENT_DUNGEON_ENTRANCE)}.bind(this)),offset_y+=ccHeight(prv_event_dungeon_btn)+10}}.bind(this)),this.m_epilogue_select_popup=new GameModalLayer,this.addChild(this.m_epilogue_select_popup,1e4),!0},getGachaList:function(){var req={};req.opcode=net.OP.op_event_raid_box_gacha_info,req.event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),SceneManager.getInstance().getRunningScene().network_write(req)},is_raid_new_icon:function(){var service=EventDungeonService.getInstance();if(null!=this.m_raid_achv_new_icon){this.m_raid_achv_new_icon.setVisible(!1);var user_achieve_info;user_achieve_info=(new NetService).get_Event_Raid_Dungeon_User_Info();for(var i=0;i<user_achieve_info.event_raid_achieve.length;i++){var info=user_achieve_info.event_raid_achieve[i];if((this.m_is_prv_event_dungeon||service.IsOpenDungeon(this.m_second_half_period_idx)||info.event_dungeon_period_idx!=this.m_second_half_period_idx)&&(info.event_dungeon_period_idx==this.m_first_half_period_idx||info.event_dungeon_period_idx==this.m_second_half_period_idx))for(var j=0;j<info.achieve_complete.length;j++){if("n"==info.achieve_complete[j].complete_yn){this.m_raid_achv_new_icon.setVisible(!0);break}}}}},createCutinInfo:function(period_info){var winSize=ccSize(this),cloud_bg=(EventDungeonService.getInstance(),cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_sample/img_eventvs_cut_cloud.png"));cloud_bg.setAnchorPoint(ANCHOR_TOP_RIGHT()),cloud_bg.setPosition(winSize.width,winSize.height-55),this.addChild(cloud_bg);var progress_bg=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero());progress_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),progress_bg.setPreferredSize(146,12),progress_bg.setPosition(22,44),cloud_bg.addChild(progress_bg);var cutin_progress=new cc.Scale9Sprite("common/img_9p_gauge_red_3.png",RectZero());if(cutin_progress.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),cutin_progress.setPreferredSize(0,6),cutin_progress.setPosition(25,47),cloud_bg.addChild(cutin_progress),this.m_cutin_info_btn=new LabelButton(RES_CDN_DEFULT+"menu_eventvs_sample/img_eventvs_cut_gauge_front.png",RES_CDN_DEFULT+"menu_eventvs_sample/img_eventvs_cut_gauge_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_cutin_info_btn.addClickEventListener(function(sender){var scene=new EventDungeonCutinBossInfoScene;SceneManager.getInstance().replaceScene(scene),scene=null}),this.m_cutin_info_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_cutin_info_btn.setPosition(winSize.width,winSize.height-55),this.addChild(this.m_cutin_info_btn),this.m_cutin_info_btn.setEnabled(!this.m_is_prv_event_dungeon),this.m_is_prv_event_dungeon){var btn_mask=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_cut_cloud_none.png",this.m_first_half_period_idx));return btn_mask.setPosition(ccCenter(cloud_bg)),void cloud_bg.addChild(btn_mask)}var blink_eff=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_sample/img_eventvs_cut_gauge_ef.png");blink_eff.setAnchorPoint(ANCHOR_MIDDLE()),blink_eff.setPosition(ccCenter(progress_bg)),blink_eff.setVisible(!1),blink_eff.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR),progress_bg.addChild(blink_eff);var fo=new cc.FadeOut(1),fi=new cc.FadeIn(1),seq=new cc.Sequence(fo,fi),repeat=new cc.RepeatForever(seq);blink_eff.runAction(repeat);var cf=MasterManager.getInstance().get_CountFunction(4),per=this.m_event_dungeon_cutin_accum_rate_point.cutin_accum_rate/cf.value*100;100<per&&(per=100),0!=per?(cutin_progress.setPreferredSize(1.4*per,6),cutin_progress.setScaleX(1)):cutin_progress.setScaleX(0),blink_eff.setVisible(100<=per);var cutin_text=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_sample/img_eventvs_cut_text.png");cutin_text.setAnchorPoint(ANCHOR_TOP_RIGHT()),cutin_text.setPosition(winSize.width-(ccSize(this.m_cutin_info_btn).width-20),winSize.height-55),this.addChild(cutin_text)},onEnter:function(){this._super()},onExit:function(){this._super()},getRightLayer:function(){ccSize(this);var layer=new cc.Layer,service=EventDungeonService.getInstance(),first_period=(mt=MasterManager.getInstance()).get_EventDungeonPeriod(this.m_first_half_period_idx),second_period=mt.get_EventDungeonPeriod(this.m_second_half_period_idx),offset_x=ccWidth(this)-17,offset_y=16,second_half_btn=new LabelButton("btn_07_off.png","btn_07_on.png","btn_07_none.png",ccui.Widget.PLIST_TEXTURE);second_half_btn.setFont(LABEL_FONT_INDEX.FONT_201),second_half_btn.setString(res_str("label_event_dungeon_second_half_enter_text")),second_half_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),second_half_btn.setPosition(offset_x,offset_y),layer.addChild(second_half_btn),second_half_btn.addClickEventListener(function(sender){this.entranceDungeonList(this.m_second_half_period_idx)}.bind(this)),this.m_is_prv_event_dungeon?second_half_btn.setEnabled(!1):second_half_btn.setEnabled(service.IsOpenDungeon(this.m_second_half_period_idx)),offset_x-=ccWidth(second_half_btn);var first_half_btn=new LabelButton("btn_07_off.png","btn_07_on.png","btn_07_none.png",ccui.Widget.PLIST_TEXTURE);first_half_btn.setFont(LABEL_FONT_INDEX.FONT_201),first_half_btn.setString(res_str("label_event_dungeon_first_half_enter_text")),first_half_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),first_half_btn.setPosition(offset_x,offset_y),layer.addChild(first_half_btn),first_half_btn.addClickEventListener(function(sender){this.entranceDungeonList(this.m_first_half_period_idx)}.bind(this)),this.m_is_prv_event_dungeon?first_half_btn.setEnabled(!1):first_half_btn.setEnabled(service.IsOpenDungeon(this.m_first_half_period_idx)),offset_y+=ccHeight(second_half_btn)+5;var period_idx=this.m_first_half_period_idx,is_second=!1;this.m_is_prv_event_dungeon?service.IsOpenEventPointPeriod(this.m_second_half_period_idx)&&(period_idx=this.m_second_half_period_idx,first_period.event_dungeon_point_period_idx!=second_period.event_dungeon_point_period_idx&&(is_second=!0)):service.IsOpenDungeon(this.m_second_half_period_idx)&&(period_idx=this.m_second_half_period_idx,first_period.event_dungeon_point_period_idx!=second_period.event_dungeon_point_period_idx&&(is_second=!0));var point_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_"+period_idx+"/img_eventvs_info.png");point_box.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),point_box.setPosition(ccWidth(this)-17,offset_y),layer.addChild(point_box),offset_y+=ccHeight(point_box)+9;var point_pos_y=26;if(is_second){var period=mt.get_EventDungeonPeriod(this.m_second_half_period_idx),event_dungeon_point={};service.getUserEventDungeonPoint(period.event_dungeon_period_idx,event_dungeon_point),(event_point_count=cmLabel.getLabel(cmString(res_str("label_event_dungeon_own_point"),Number(event_dungeon_point.event_point).toLocaleString("en")),LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),event_point_count.setPosition(266,point_pos_y),point_box.addChild(event_point_count);var second_gacha_half_btn=new LabelButton("btn_36_off.png","btn_36_on.png","",ccui.Widget.PLIST_TEXTURE);second_gacha_half_btn.setFont(LABEL_FONT_INDEX.FONT_181),second_gacha_half_btn.setString(res_str("event_raid_quest_period_2")),second_gacha_half_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),second_gacha_half_btn.setPosition(430,15),point_box.addChild(second_gacha_half_btn),second_gacha_half_btn.addClickEventListener(function(sender){var req={};req.opcode=net.OP.op_event_raid_dungeon_boss_info,req.event_dungeon_period_idx=this.m_second_half_period_idx,SceneManager.getInstance().getRunningScene().network_write(req)}.bind(this)),this.m_is_prv_event_dungeon?second_gacha_half_btn.setEnabled(!1):second_gacha_half_btn.setEnabled(service.IsOpenDungeon(this.m_second_half_period_idx)),ccHeight(second_gacha_half_btn)+10,point_pos_y+=50}var mt,event_point_count;period=(mt=MasterManager.getInstance()).get_EventDungeonPeriod(this.m_first_half_period_idx),event_dungeon_point={};service.getUserEventDungeonPoint(period.event_dungeon_period_idx,event_dungeon_point),(event_point_count=cmLabel.getLabel(cmString(res_str("label_event_dungeon_own_point"),Number(event_dungeon_point.event_point).toLocaleString("en")),LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),event_point_count.setPosition(266,point_pos_y),point_box.addChild(event_point_count);var first_gacha_half_btn=new LabelButton("btn_36_off.png","btn_36_on.png","",ccui.Widget.PLIST_TEXTURE);if(first_gacha_half_btn.setFont(LABEL_FONT_INDEX.FONT_181),first_gacha_half_btn.setString(res_str("event_raid_quest_period_1")),first_gacha_half_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),first_gacha_half_btn.setPosition(430,point_pos_y-10),point_box.addChild(first_gacha_half_btn),first_gacha_half_btn.addClickEventListener(function(sender){var req={};req.opcode=net.OP.op_event_raid_dungeon_boss_info,req.event_dungeon_period_idx=this.m_first_half_period_idx,SceneManager.getInstance().getRunningScene().network_write(req)}.bind(this)),this.m_is_prv_event_dungeon?first_gacha_half_btn.setEnabled(!1):first_gacha_half_btn.setEnabled(service.IsOpenDungeon(this.m_first_half_period_idx)),!this.m_is_prv_event_dungeon){var boss_info=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_info_boss.png",period_idx));boss_info.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),boss_info.setPosition(ccWidth(this),offset_y),layer.addChild(boss_info)}return layer},getRightLayer_SP:function(){ccSize(this);var layer=new cc.Layer,service=EventDungeonService.getInstance(),first_period=(mt=MasterManager.getInstance()).get_EventDungeonPeriod(this.m_first_half_period_idx),second_period=mt.get_EventDungeonPeriod(this.m_second_half_period_idx),offset_x=ccWidth(this)-17,offset_y=16,second_half_btn=new LabelButton("btn_07_off.png","btn_07_on.png","btn_07_none.png",ccui.Widget.PLIST_TEXTURE);second_half_btn.setFont(LABEL_FONT_INDEX.FONT_201),second_half_btn.setString(res_str("label_event_dungeon_second_half_enter_text")),second_half_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),second_half_btn.setPosition(offset_x,offset_y),layer.addChild(second_half_btn),second_half_btn.addClickEventListener(function(sender){this.entranceDungeonList(this.m_second_half_period_idx)}.bind(this)),this.m_is_prv_event_dungeon?second_half_btn.setEnabled(!1):second_half_btn.setEnabled(service.IsOpenDungeon(this.m_second_half_period_idx)),offset_x-=ccWidth(second_half_btn);var first_half_btn=new LabelButton("btn_07_off.png","btn_07_on.png","btn_07_none.png",ccui.Widget.PLIST_TEXTURE);first_half_btn.setFont(LABEL_FONT_INDEX.FONT_201),first_half_btn.setString(res_str("label_event_dungeon_first_half_enter_text")),first_half_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),first_half_btn.setPosition(offset_x,offset_y),layer.addChild(first_half_btn),first_half_btn.addClickEventListener(function(sender){this.entranceDungeonList(this.m_first_half_period_idx)}.bind(this)),this.m_is_prv_event_dungeon?first_half_btn.setEnabled(!1):first_half_btn.setEnabled(service.IsOpenDungeon(this.m_first_half_period_idx)),offset_y+=ccHeight(second_half_btn)+5;var period_idx=this.m_first_half_period_idx,is_second=!1;this.m_is_prv_event_dungeon?service.IsOpenEventPointPeriod(this.m_second_half_period_idx)&&(period_idx=this.m_second_half_period_idx,first_period.event_dungeon_point_period_idx!=second_period.event_dungeon_point_period_idx&&(is_second=!0)):service.IsOpenDungeon(this.m_second_half_period_idx)&&(period_idx=this.m_second_half_period_idx,first_period.event_dungeon_point_period_idx!=second_period.event_dungeon_point_period_idx&&(is_second=!0));var point_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_"+period_idx+"/img_eventvs_info.png");point_box.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),point_box.setPosition(ccWidth(this)-17,offset_y),point_box.setScale(2),this.addChild(point_box),offset_y+=ccHeight(point_box)+9;var point_pos_y=76;if(is_second){var period=mt.get_EventDungeonPeriod(this.m_second_half_period_idx),event_dungeon_point={};service.getUserEventDungeonPoint(period.event_dungeon_period_idx,event_dungeon_point),(event_point_count=cmLabel.getLabel(cmString(res_str("label_event_dungeon_own_point"),Number(event_dungeon_point.event_point).toLocaleString("en")),LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),event_point_count.setPosition(945,point_pos_y+30),this.addChild(event_point_count);var second_gacha_half_btn=new LabelButton("btn_36_off.png","btn_36_on.png","",ccui.Widget.PLIST_TEXTURE);second_gacha_half_btn.setFont(LABEL_FONT_INDEX.FONT_181),second_gacha_half_btn.setString(res_str("event_raid_quest_period_2")),second_gacha_half_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),second_gacha_half_btn.setPosition(1106,94),this.addChild(second_gacha_half_btn),second_gacha_half_btn.addClickEventListener(function(sender){var req={};req.opcode=net.OP.op_event_raid_dungeon_boss_info,req.event_dungeon_period_idx=this.m_second_half_period_idx,SceneManager.getInstance().getRunningScene().network_write(req)}.bind(this)),this.m_is_prv_event_dungeon?second_gacha_half_btn.setEnabled(!1):second_gacha_half_btn.setEnabled(service.IsOpenDungeon(this.m_second_half_period_idx)),ccHeight(second_gacha_half_btn)+10,point_pos_y+=70}var mt,event_point_count;period=(mt=MasterManager.getInstance()).get_EventDungeonPeriod(this.m_first_half_period_idx),event_dungeon_point={};service.getUserEventDungeonPoint(period.event_dungeon_period_idx,event_dungeon_point),(event_point_count=cmLabel.getLabel(cmString(res_str("label_event_dungeon_own_point"),Number(event_dungeon_point.event_point).toLocaleString("en")),LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),is_second?event_point_count.setPosition(945,point_pos_y+10):event_point_count.setPosition(940,point_pos_y+30),this.addChild(event_point_count);var first_gacha_half_btn=new LabelButton("btn_36_off.png","btn_36_on.png","",ccui.Widget.PLIST_TEXTURE);if(first_gacha_half_btn.setFont(LABEL_FONT_INDEX.FONT_181),first_gacha_half_btn.setString(res_str("event_raid_quest_period_1")),first_gacha_half_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),is_second?first_gacha_half_btn.setPosition(1106,point_pos_y):first_gacha_half_btn.setPosition(1106,point_pos_y+20),this.addChild(first_gacha_half_btn),first_gacha_half_btn.addClickEventListener(function(sender){var req={};req.opcode=net.OP.op_event_raid_dungeon_boss_info,req.event_dungeon_period_idx=this.m_first_half_period_idx,SceneManager.getInstance().getRunningScene().network_write(req)}.bind(this)),this.m_is_prv_event_dungeon?first_gacha_half_btn.setEnabled(!1):first_gacha_half_btn.setEnabled(service.IsOpenDungeon(this.m_first_half_period_idx)),!this.m_is_prv_event_dungeon){var boss_info=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_info_boss.png",period_idx));boss_info.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),boss_info.setPosition(ccWidth(this),offset_y+55),boss_info.setScale(2),this.addChild(boss_info)}return layer},entranceDungeonList:function(event_dungeon_period_idx){if(!EventDungeonService.getInstance().IsOpenDungeon(event_dungeon_period_idx))return!1;BattleContext._getInstance().setEventDungeonPeriodIdX(event_dungeon_period_idx);var scene=new EventDungeonListScene;return SceneManager.getInstance().replaceScene(scene),!(scene=null)},entranceOnceADayDungeonList:function(event_dungeon_period_idx,sub_dungeon_type){if(!EventDungeonService.getInstance().IsOpenDungeon(event_dungeon_period_idx))return!1;GameContext.getInstance().setSubDungeonType(sub_dungeon_type),BattleContext._getInstance().setEventDungeonPeriodIdX(event_dungeon_period_idx);var scene=new EventOnceADayDungeonListScene;return SceneManager.getInstance().replaceScene(scene),!(scene=null)},showEpilogueSelectPopup:function(){this.m_epilogue_select_popup.setContentSize(ccSize(this)),this.m_epilogue_select_popup._contentNode=function(contentSize,m){RAID_BOSS_MODAL_OPEN_FLAG=!0;var layer=new cc.Layer,bg_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());bg_mask.setPosition(ccCenter(this)),bg_mask.setContentSize(ccSize(this)),layer.addChild(bg_mask);var bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",RectZero());bg.setInsetLeft(44),bg.setInsetRight(44),bg.setInsetTop(44),bg.setInsetBottom(44),bg.setPreferredSize(cc.size(630,370)),bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(this)),layer.addChild(bg);var navi=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_navi.png",RectZero());navi.setInsetLeft(46),navi.setInsetRight(46),navi.setPreferredSize(cc.size(614,48)),navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(bg).x,ccHeight(bg)-11),bg.addChild(navi);var title_label=cmLabel.getLabel(res_str("event_raid_epilogue_popup_title"),LABEL_FONT_INDEX.FONT_261);title_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),title_label.setPosition(.5*ccWidth(navi),16),navi.addChild(title_label);var back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(bg)-10,ccHeight(bg)-10),back_btn.addClickEventListener(function(sender){this.hideEpilogueSelectPopup()}.bind(this)),bg.addChild(back_btn);var content_label=cmLabel.getLabel(res_str("event_raid_epilogue_popup_text"),LABEL_FONT_INDEX.FONT_241);content_label.setAnchorPoint(ANCHOR_MIDDLE()),content_label.setPosition(ccCenter(bg)),bg.addChild(content_label);var pre_epilogue_btn=new ccui.Button(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_ep_2_on.png",this.m_period.event_dungeon_group_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_ep_2_off.png",this.m_period.event_dungeon_group_idx));pre_epilogue_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),pre_epilogue_btn.setPosition(92,26),pre_epilogue_btn.addClickEventListener(function(sender){BattleContext._getInstance().setPrvEventDungeonPeriodIdx(this.m_period.prev_event_dungeon_group_idx),MainObserver.getInstance().postNotification(NOTIFY_MENU_SHOW_PRE_EVENT_EPILOGUE),RAID_BOSS_MODAL_OPEN_FLAG=!1,this.hideEpilogueSelectPopup()}.bind(this)),bg.addChild(pre_epilogue_btn,1);var on=RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_ep_3_on.png",this.m_period.event_dungeon_group_idx),off=RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_ep_3_off.png",this.m_period.event_dungeon_group_idx),none=RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_ep_3_none.png",this.m_period.event_dungeon_group_idx),now_epilogue_btn=new ccui.Button(off,on,none);now_epilogue_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),now_epilogue_btn.setPosition(ccWidth(bg)-92,26),now_epilogue_btn.addClickEventListener(function(sender){BattleContext._getInstance().setPrvEventDungeonPeriodIdx(this.m_period.prev_event_dungeon_group_idx),MainObserver.getInstance().postNotification(NOTIFY_MENU_SHOW_EVENT_EPILOGUE),RAID_BOSS_MODAL_OPEN_FLAG=!1,this.hideEpilogueSelectPopup()}.bind(this)),bg.addChild(now_epilogue_btn,1);var now_epilogue_btn_none=new cc.Sprite.create(none);now_epilogue_btn_none.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),now_epilogue_btn_none.setPosition(ccWidth(bg)-92,26),bg.addChild(now_epilogue_btn_none,2),now_epilogue_btn_none.setVisible(!1);var is_find_main_item=!1,achv_list=[];(new NetService).get_User_Event_Raid_Achievement_List(6,this.m_first_half_period_idx,achv_list);for(var i=0;i<achv_list.length;i++){var achv=achv_list[i];4==achv.complete_count&&"n"==achv.new_yn&&"y"==achv.complete_yn&&(is_find_main_item=!0)}return now_epilogue_btn.setEnabled(is_find_main_item),is_find_main_item||now_epilogue_btn_none.setVisible(!0),layer}.bind(this),this.m_epilogue_select_popup.show()},hideEpilogueSelectPopup:function(){this.m_epilogue_select_popup.is_show()&&(RAID_BOSS_MODAL_OPEN_FLAG=!1,this.m_epilogue_select_popup.hide())},refreshEventDungeonAchvNewIcon:function(){for(var service=EventDungeonService.getInstance(),period_list=MasterTable.getInstance().get_EventDungeonPeriodList(this.m_period.event_dungeon_group_idx),is_new=!1,i=0;i<period_list.length;i++){var p=period_list[i];if(service.IsOpenDungeon(p.event_dungeon_period_idx)&&service.IsEnableGainEventDungeonAchvReward(p.event_dungeon_period_idx)){is_new=!0;break}}null!=this.m_achv_new_icon&&this.m_achv_new_icon.setVisible(is_new)}}),EventDungeonRaidRewardScene=GameScene.extend({m_rewardLayer:null,m_script_modal:null,pre_tap_idx:0,ctor:function(){this._super(scene_EventDungeonRaidRewardScene)},init:function(){cc.director.getWinSize();var bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub.png");bg.setPosition(ccCenter(this)),USE_SP_COMMON_SUB_BG_SCALE&&bg.setScale(2),this.addChild(bg);var edService=EventDungeonService.getInstance(),mt=MasterManager.getInstance(),achv_list=[],achv_type=ACHIEVEMENT_EVENTDUNGEON;this.pre_tap_idx=ACHIEVEMENT_EVENTDUNGEON,GameContext.getInstance().setAchievementTap(achv_type);var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=mt.get_EventDungeonPeriod(event_dungeon_period_idx);achv_type==ACHIEVEMENT_EVENTDUNGEON||achv_type==ACHIEVEMENT_EVENTDUNGEON_2ND?event_dungeon_period_idx=edService.getEventDungeonFirstHalfPeriodIdx(period.event_dungeon_group_idx):achv_type!=ACHIEVEMENT_EVENTDUNGEON_3RD&&achv_type!=ACHIEVEMENT_EVENTDUNGEON_4RD||(event_dungeon_period_idx=edService.getEventDungeonSecondHalfPeriodIdx(period.event_dungeon_group_idx)),(new NetService).get_User_Event_Raid_Achievement_List(achv_type,event_dungeon_period_idx,achv_list),this.m_rewardLayer=new EventDungeonRaidRewardLayer,this.m_rewardLayer.initLayout(),this.m_rewardLayer.setAchivementList(achv_list,this.pre_tap_idx),this.addChild(this.m_rewardLayer);var statusLayer=new StatusLayer;statusLayer.initLayout(),statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer);var back_btn=new ccui.Button;back_btn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png",""),back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(){this.back()}.bind(this)),this.addChild(back_btn);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_eventvs.png");return title.setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title),this.m_script_modal=new GameModalLayer,this.addChild(this.m_script_modal,99999),!0},onEnter:function(){this._super();var audio=AudioEngine.getInstance();if(MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_EventDungeonRaidRewardScene]),USE_EVENT_BGM){var m=MasterTable.getInstance();if(BattleContext._getInstance().getIsPrvEventDungeon())var bgm=m.get_Bgm_v2(BGM_TYPE_PRV_EVENT_MAIN_BGM);else{var period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();bgm=m.get_EventDungeonFromEventDungeonPeriodIdx(period_idx).event_dungeon_type==EVENT_DUNGEON_TYPE_LINLIN?m.get_Bgm_v2(BGM_TYPE_CRAFT_EVENT_MAIN_BGM):m.get_Bgm_v2(BGM_TYPE_EVENT_MAIN_BGM)}var main_bgm=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm.sound_file_name;audio.m_bgmPath!=main_bgm&&(audio.stopBackgroundMusic(),audio.m_bgmPath="",audio.playBackgroundMusic(main_bgm,!0))}else{var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),b_path=RES_CDN_SOUND+SND_TYPE+"sound/"+cmString("BGM_marathon_loop_%d.mp3",period.event_dungeon_point_period_idx);audio.m_bgmPath!=b_path&&(audio.stopBackgroundMusic(),audio.playBackgroundMusic(b_path,!0))}},onExit:function(){this._super()},onNotification:function(msg){this._super(msg);var achv_list=[];switch(msg){case ACHIEVEMENT_EVENTDUNGEON:case ACHIEVEMENT_EVENTDUNGEON_2ND:case ACHIEVEMENT_EVENTDUNGEON_3RD:case ACHIEVEMENT_EVENTDUNGEON_4RD:var edService=EventDungeonService.getInstance(),mt=MasterManager.getInstance(),achv_type=msg;GameContext.getInstance().setAchievementTap(msg);var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=mt.get_EventDungeonPeriod(event_dungeon_period_idx);achv_type==ACHIEVEMENT_EVENTDUNGEON||achv_type==ACHIEVEMENT_EVENTDUNGEON_2ND?event_dungeon_period_idx=edService.getEventDungeonFirstHalfPeriodIdx(period.event_dungeon_group_idx):achv_type!=ACHIEVEMENT_EVENTDUNGEON_3RD&&achv_type!=ACHIEVEMENT_EVENTDUNGEON_4RD||(event_dungeon_period_idx=edService.getEventDungeonSecondHalfPeriodIdx(period.event_dungeon_group_idx)),(new NetService).get_User_Event_Raid_Achievement_List(achv_type,event_dungeon_period_idx,achv_list),this.m_rewardLayer.setAchivementList(achv_list,this.pre_tap_idx),this.m_rewardLayer.changeTapMenu(achv_type),this.pre_tap_idx=achv_type;break;case btn_epilogue_open_views:this.back()}return!0},onNetworkEvent:function(opcode,state,body){if(this._super(opcode,state,body),opcode==net.OP.op_event_raid_dungeon_achieve_reward){var achv_list=[],achv_type=GameContext.getInstance().getAchievementTap();(new NetService).get_User_Event_Raid_Achievement_List(achv_type,body.event_dungeon_period_idx,achv_list),this.m_rewardLayer.setAchivementList(achv_list,this.pre_tap_idx);var msg=[];msg.push(res_str("uni_msg_explorer_receive_item_mail")),this.showMsgBox(msg),msg=null}},back:function(){this.onKeyBack(!0)}}),SUBTRACT_END_DATE_RAID=1209600,btn_epilogue_open_views=9876588,EventDungeonRaidRewardLayer=cc.Layer.extend({m_tableView:null,m_bgBoxLayer:null,m_first_Conquest:null,m_first_Damage:null,m_second_Conquest:null,m_second_Damage:null,m_all_recv_btn:null,m_is_enable_epilogue_popup:!1,m_message_box:null,m_info_text:null,m_info_icon:null,m_first_half_period_idx:0,m_second_half_period_idx:0,m_first_event_period_idx:0,m_second_event_period_idx:0,m_is_prv_event_dungeon:!1,m_achieve_List:[],m_first_Conquest_new_icon:null,m_first_Damage_new_icon:null,m_second_Conquest_new_icon:null,m_second_Damage_new_icon:null,ctor:function(){this._super(),this.m_achieve_List=[],this.init()},init:function(){var service=EventDungeonService.getInstance(),m=MasterManager.getInstance(),context=BattleContext._getInstance();this.m_is_prv_event_dungeon=context.getIsPrvEventDungeon();var event_dungeon_period_idx=0;event_dungeon_period_idx=this.m_is_prv_event_dungeon?BattleContext._getInstance().getPrvEventDungeonPeriodIdx():BattleContext._getInstance().getEventDungeonPeriodIdx(),this.m_period=m.get_EventDungeonPeriod(event_dungeon_period_idx),this.m_first_event_period_idx=service.getEventDungeonFirstHalfPeriodIdx(this.m_period.event_dungeon_group_idx),this.m_second_event_period_idx=service.getEventDungeonSecondHalfPeriodIdx(this.m_period.event_dungeon_group_idx)},setAchivementList:function(list,pre_tap_idx){if(!this.m_is_enable_epilogue_popup&&0!=this.m_achieve_List.length&&!this.m_is_prv_event_dungeon){var period_idx=0,tap_index=GameContext.getInstance().getAchievementTap();tap_index==ACHIEVEMENT_EVENTDUNGEON||tap_index==ACHIEVEMENT_EVENTDUNGEON_2ND?period_idx=this.m_first_event_period_idx:tap_index!=ACHIEVEMENT_EVENTDUNGEON_3RD&&tap_index!=ACHIEVEMENT_EVENTDUNGEON_4RD||(period_idx=this.m_second_event_period_idx);for(var m=MasterManager.getInstance(),i=0;i<this.m_achieve_List.length;i++){if("n"==(a=this.m_achieve_List[i]).new_yn&&"y"==a.complete_yn)(ac=m.get_EventRaidAchieveComplete(period_idx,a.achv_type,a.complete_count)).event_dungeon_period_idx==this.m_first_event_period_idx&&1==ac.delimiter&&4==ac.complete_num&&(this.m_is_enable_epilogue_popup=!0)}if(!this.m_is_enable_epilogue_popup&&1==this.m_achieve_List[0].achv_type&&pre_tap_idx==ACHIEVEMENT_EVENTDUNGEON)for(var j=0;j<list.length;j++){var a,ac;if("n"==(a=list[j]).new_yn&&"y"==a.complete_yn)(ac=m.get_EventRaidAchieveComplete(period_idx,a.achv_type,a.complete_count)).event_dungeon_period_idx==this.m_first_event_period_idx&&1==ac.delimiter&&4==ac.complete_num&&(this.m_is_enable_epilogue_popup=!0)}}null!=list&&null!=list&&0!=list.length&&(this.m_achieve_List=list),this.m_achieve_List=stable(this.m_achieve_List,function(l,r){return l.complete_yn<r.complete_yn}),this.m_achieve_List=stable(this.m_achieve_List,function(l,r){return l.new_yn<r.new_yn}),this.checkAllRecvBtn(),this.is_raid_new_icon(),null!=this.m_tableView&&this.m_tableView.reloadData()},checkAllRecvBtn:function(){if(null!=this.m_all_recv_btn){for(var is_enable_recv=!1,i=0;i<this.m_achieve_List.length;i++){var a=this.m_achieve_List[i];if("y"==a.complete_yn&&"y"==a.new_yn){is_enable_recv=!0;break}}this.m_all_recv_btn.setEnabled(is_enable_recv)}},initLayout:function(){this.m_bgBoxLayer=this.getAchieveBoxLayer(),this.m_bgBoxLayer.ignoreAnchorPointForPosition(!1),this.m_bgBoxLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bgBoxLayer.setPosition(ccCenter(this).x,0),this.addChild(this.m_bgBoxLayer),this.m_message_box=new GameMessageBox,this.addChild(this.m_message_box,1e4)},showEnableEpiloguePopup:function(){this.m_message_box.setTitle(res_str("label_event_dungeon_epilogue_title")),this.m_message_box.setText(res_str("label_event_dungeon_open_epilogue_message_1")),this.m_message_box.setText("\n"),this.m_message_box.setText(res_str("label_event_dungeon_open_epilogue_message_2")),this.m_message_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_message_box.hide()}.bind(this))),this.m_message_box.addButtonInfo(new MessageButtonInfo(res_str("label_shortcuts_move"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_EventDungeonRaidRewardScene],btn_epilogue_open_views)},.1,"open_epilogue"),this.m_message_box.hide()}.bind(this))),this.m_message_box.show()},getAchieveBoxLayer:function(){var layer=new cc.Layer,tap_index=GameContext.getInstance().getAchievementTap(),service=EventDungeonService.getInstance(),second_open=!1;this.m_is_prv_event_dungeon?service.IsOpenEventPointPeriod(this.m_second_event_period_idx)&&(second_open=!0):service.IsOpenDungeon(this.m_second_event_period_idx)&&(second_open=!0);var pos_x=17;this.m_first_Conquest=new LabelButton("btn_07_none.png","btn_07_on.png","btn_07_off.png",ccui.Widget.PLIST_TEXTURE),this.m_first_Conquest.setFont(LABEL_FONT_INDEX.FONT_201),this.m_first_Conquest.setString(res_str("event_raid_quest_tab_1_1")),this.m_first_Conquest.setAnchorPoint(ZERO()),this.m_first_Conquest.setPosition(pos_x,508),this.m_first_Conquest.autoSizeFit(20),this.m_first_Conquest.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_EventDungeonRaidRewardScene],ACHIEVEMENT_EVENTDUNGEON)}.bind(this)),layer.addChild(this.m_first_Conquest),pos_x+=ccWidth(this.m_first_Conquest),this.m_first_Conquest_new_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_first_Conquest_new_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_first_Conquest_new_icon.setPosition(ccWidth(this.m_first_Conquest)-15,ccHeight(this.m_first_Conquest)),this.m_first_Conquest.addChild(this.m_first_Conquest_new_icon),this.m_first_Conquest_new_icon.setVisible(!1),this.m_first_Damage=new LabelButton("btn_07_none.png","btn_07_on.png","btn_07_off.png",ccui.Widget.PLIST_TEXTURE),this.m_first_Damage.setFont(LABEL_FONT_INDEX.FONT_201),this.m_first_Damage.setString(res_str("event_raid_quest_tab_1_2")),this.m_first_Damage.setAnchorPoint(ZERO()),this.m_first_Damage.setPosition(pos_x,508),this.m_first_Damage.autoSizeFit(20),this.m_first_Damage.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_EventDungeonRaidRewardScene],ACHIEVEMENT_EVENTDUNGEON_2ND)}.bind(this)),layer.addChild(this.m_first_Damage),pos_x+=ccWidth(this.m_first_Damage),this.m_first_Damage_new_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_first_Damage_new_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_first_Damage_new_icon.setPosition(ccWidth(this.m_first_Damage)-15,ccHeight(this.m_first_Damage)),this.m_first_Damage.addChild(this.m_first_Damage_new_icon),this.m_first_Damage_new_icon.setVisible(!1),second_open&&(this.m_second_Conquest=new LabelButton("btn_07_none.png","btn_07_on.png","btn_07_off.png",ccui.Widget.PLIST_TEXTURE),this.m_second_Conquest.setFont(LABEL_FONT_INDEX.FONT_201),this.m_second_Conquest.setString(res_str("event_raid_quest_tab_2_1")),this.m_second_Conquest.setAnchorPoint(ZERO()),this.m_second_Conquest.setPosition(pos_x,508),this.m_second_Conquest.autoSizeFit(20),this.m_second_Conquest.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_EventDungeonRaidRewardScene],ACHIEVEMENT_EVENTDUNGEON_3RD)}.bind(this)),layer.addChild(this.m_second_Conquest),pos_x+=ccWidth(this.m_second_Conquest),this.m_second_Conquest_new_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_second_Conquest_new_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_second_Conquest_new_icon.setPosition(ccWidth(this.m_second_Conquest)-15,ccHeight(this.m_second_Conquest)),this.m_second_Conquest.addChild(this.m_second_Conquest_new_icon),this.m_second_Conquest_new_icon.setVisible(!1),this.m_second_Damage=new LabelButton("btn_07_none.png","btn_07_on.png","btn_07_off.png",ccui.Widget.PLIST_TEXTURE),this.m_second_Damage.setFont(LABEL_FONT_INDEX.FONT_201),this.m_second_Damage.setString(res_str("event_raid_quest_tab_2_2")),this.m_second_Damage.setAnchorPoint(ZERO()),this.m_second_Damage.setPosition(pos_x,508),this.m_second_Damage.autoSizeFit(20),this.m_second_Damage.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_EventDungeonRaidRewardScene],ACHIEVEMENT_EVENTDUNGEON_4RD)}.bind(this)),layer.addChild(this.m_second_Damage),this.m_second_Damage_new_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_second_Damage_new_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_second_Damage_new_icon.setPosition(ccWidth(this.m_second_Damage)-15,ccHeight(this.m_second_Damage)),this.m_second_Damage.addChild(this.m_second_Damage_new_icon),this.m_second_Damage_new_icon.setVisible(!1)),tap_index==ACHIEVEMENT_EVENTDUNGEON?this.m_first_Conquest.setEnabled(!1):tap_index==ACHIEVEMENT_EVENTDUNGEON_2ND?null!=this.m_first_Damage&&this.m_first_Damage.setEnabled(!1):tap_index==ACHIEVEMENT_EVENTDUNGEON_3RD?null!=this.m_second_Conquest&&this.m_second_Conquest.setEnabled(!1):tap_index==ACHIEVEMENT_EVENTDUNGEON_4RD&&null!=this.m_second_Damage&&this.m_second_Damage.setEnabled(!1);var bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));bg_box.setPreferredSize(cc.size(958,515)),bg_box.setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),layer.addChild(bg_box),layer.setContentSize(ccSize(bg_box));var Size=cc.size(924,438);this.m_tableView=new cc.TableView(this,Size),this.m_tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_tableView.scrollBarEnable(!0),this.m_tableView.setPosition(17,58),layer.addChild(this.m_tableView),this.m_tableView.setDelegate(this),this.m_tableView.reloadData(),this.m_info_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_friend/img_friend_text.png"),this.m_info_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_info_icon.setPosition(311,17),layer.addChild(this.m_info_icon);var date_str;return date_str=this.getEventDungeonEndDateString(),this.m_info_text=cmLabel.getLabel(date_str,LABEL_FONT_INDEX.FONT_1613),this.m_info_text.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_info_text.setPosition(ccPosX(this.m_info_icon)+ccWidth(this.m_info_icon),24),layer.addChild(this.m_info_text),this.m_all_recv_btn=new LabelButton("btn_11_off.png","btn_11_on.png","btn_11_none.png",ccui.Widget.PLIST_TEXTURE),this.m_all_recv_btn.setFont(LABEL_FONT_INDEX.FONT_201),this.m_all_recv_btn.setString(res_str("btn_label_all_accept")),this.m_all_recv_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_all_recv_btn.setPosition(ccWidth(layer)-17,18),this.m_all_recv_btn.addClickEventListener(function(){this.sendRewardAllAchievement()}.bind(this)),layer.addChild(this.m_all_recv_btn),this.checkAllRecvBtn(),layer},getEventDungeonEndDateString:function(){var end_dt=moment(this.m_period.event_dungeon_point_end_dt);return"※期間限定："+((end_dt=end_dt.add("s")).get("month")+1)+"月"+end_dt.get("date")+"日メンテナンス前まで。"},changeTapMenu:function(index,reload){switch(null!=this.m_first_Conquest&&this.m_first_Conquest.setEnabled(!0),null!=this.m_first_Damage&&this.m_first_Damage.setEnabled(!0),null!=this.m_second_Conquest&&this.m_second_Conquest.setEnabled(!0),null!=this.m_second_Damage&&this.m_second_Damage.setEnabled(!0),index){case ACHIEVEMENT_EVENTDUNGEON:null!=this.m_first_Conquest&&this.m_first_Conquest.setEnabled(!1);break;case ACHIEVEMENT_EVENTDUNGEON_2ND:null!=this.m_first_Damage&&this.m_first_Damage.setEnabled(!1);break;case ACHIEVEMENT_EVENTDUNGEON_3RD:null!=this.m_second_Conquest&&this.m_second_Conquest.setEnabled(!1);break;case ACHIEVEMENT_EVENTDUNGEON_4RD:null!=this.m_second_Damage&&this.m_second_Damage.setEnabled(!1)}this.m_tableView.reloadData()},onEnter:function(){this._super()},onExit:function(){this._super()},cellSizeForTable:function(table){return cc.size(924,94)},tableCellSizeForIndex:function(table,idx){return cc.size(924,94)},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;cell=null!=c?c:new EventDungeonRaidRewardCell(this.sendRewardAchievement.bind(this));var mail=this.m_achieve_List[idx],tap_index=GameContext.getInstance().getAchievementTap();return tap_index==ACHIEVEMENT_EVENTDUNGEON||tap_index==ACHIEVEMENT_EVENTDUNGEON_2ND?cell.setUserAchievement(mail,this.m_first_event_period_idx):tap_index!=ACHIEVEMENT_EVENTDUNGEON_3RD&&tap_index!=ACHIEVEMENT_EVENTDUNGEON_4RD||cell.setUserAchievement(mail,this.m_second_event_period_idx),cell},numberOfCellsInTableView:function(table){return this.m_achieve_List.length},sendRewardAchievement:function(user_achiv,idx){var tap_index=GameContext.getInstance().getAchievementTap(),req={};req.opcode=net.OP.op_event_raid_dungeon_achieve_reward,tap_index==ACHIEVEMENT_EVENTDUNGEON||tap_index==ACHIEVEMENT_EVENTDUNGEON_2ND?req.event_dungeon_period_idx=this.m_first_event_period_idx:tap_index!=ACHIEVEMENT_EVENTDUNGEON_3RD&&tap_index!=ACHIEVEMENT_EVENTDUNGEON_4RD||(req.event_dungeon_period_idx=this.m_second_event_period_idx);var achv={};achv.delimiter=user_achiv.achv_type,achv.complete_num=user_achiv.complete_count,req.event_raid_achieve_complete_reward_list=[],req.event_raid_achieve_complete_reward_list.push(achv),SceneManager.getInstance().getRunningScene().network_write(req)},sendRewardAllAchievement:function(){var tap_index=GameContext.getInstance().getAchievementTap(),req={};req.opcode=net.OP.op_event_raid_dungeon_achieve_reward,tap_index==ACHIEVEMENT_EVENTDUNGEON||tap_index==ACHIEVEMENT_EVENTDUNGEON_2ND?req.event_dungeon_period_idx=this.m_first_event_period_idx:tap_index!=ACHIEVEMENT_EVENTDUNGEON_3RD&&tap_index!=ACHIEVEMENT_EVENTDUNGEON_4RD||(req.event_dungeon_period_idx=this.m_second_event_period_idx),req.event_raid_achieve_complete_reward_list=[];for(var i=0;i<this.m_achieve_List.length;i++){var a=this.m_achieve_List[i];if("y"==a.new_yn&&"y"==a.complete_yn){var achv={};achv.delimiter=a.achv_type,achv.complete_num=a.complete_count,req.event_raid_achieve_complete_reward_list.push(achv)}}SceneManager.getInstance().getRunningScene().network_write(req)},tableCellTouched:function(table,cell){null!=cell&&cell.touchPosInCell(cell.getTouchPos())},tableCellHighlight:function(table,cell){null!=cell&&cell.highlightPosInCell(cell.getTouchPos())},tableCellUnhighlight:function(table,cell){null!=cell&&cell.unhighlightPosInCell(cell.getTouchPos())},tableCellEnded:function(){},is_raid_new_icon:function(){var service=EventDungeonService.getInstance(),user_achieve_info=(new NetService).get_Event_Raid_Dungeon_User_Info();null!=this.m_first_Conquest_new_icon&&this.m_first_Conquest_new_icon.setVisible(!1),null!=this.m_first_Damage_new_icon&&this.m_first_Damage_new_icon.setVisible(!1),null!=this.m_second_Conquest_new_icon&&this.m_second_Conquest_new_icon.setVisible(!1),null!=this.m_second_Damage_new_icon&&this.m_second_Damage_new_icon.setVisible(!1);for(var i=0;i<user_achieve_info.event_raid_achieve.length;i++){var info=user_achieve_info.event_raid_achieve[i];if(this.m_is_prv_event_dungeon||service.IsOpenDungeon(this.m_second_event_period_idx)||info.event_dungeon_period_idx!=this.m_second_event_period_idx)if(info.event_dungeon_period_idx==this.m_first_event_period_idx)for(var j=0;j<info.achieve_complete.length;j++){"n"==(complete=info.achieve_complete[j]).complete_yn&&(1==complete.delimiter?this.m_first_Conquest_new_icon.setVisible(!0):2==complete.delimiter&&this.m_first_Damage_new_icon.setVisible(!0))}else if(info.event_dungeon_period_idx==this.m_second_event_period_idx)for(var k=0;k<info.achieve_complete.length;k++){var complete;"n"==(complete=info.achieve_complete[k]).complete_yn&&(1==complete.delimiter?this.m_second_Conquest_new_icon.setVisible(!0):2==complete.delimiter&&this.m_second_Damage_new_icon.setVisible(!0))}}}}),EventDungeonRaidRewardCell=cc.TableViewCell.extend({m_name_label:null,m_reward_label:null,m_content:null,m_gauge:null,m_count_label:null,m_bonus_icon:null,m_callback:null,m_list_bg:null,m_complete_btn_mask:null,m_complete_mask:null,m_btn_sprites:[],dungeon_period_Idx:0,m_achieve:null,ctor:function(_callback){this._super(),this.m_btn_sprites=[],this.init(_callback)},init:function(_callback){this.m_callback=_callback,this.m_list_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero()),this.m_list_bg.setAnchorPoint(ZERO()),this.m_list_bg.setPosition(ZERO()),this.m_list_bg.setContentSize(924,94),this.addChild(this.m_list_bg),this.setContentSize(ccSize(this.m_list_bg)),this.m_name_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2013),this.m_name_label.setAnchorPoint(ZERO()),this.m_name_label.setPosition(80,59),this.m_list_bg.addChild(this.m_name_label),this.m_reward_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1810),this.m_reward_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_reward_label.setPosition(790,59),this.m_list_bg.addChild(this.m_reward_label),this.m_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.m_content.setAnchorPoint(ZERO()),this.m_content.setPosition(80,33),this.m_list_bg.addChild(this.m_content);var gauge_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero());gauge_bg.setAnchorPoint(ZERO()),gauge_bg.setPosition(4,5),gauge_bg.setContentSize(916,16),this.m_list_bg.addChild(gauge_bg),this.m_gauge=cc.Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green.png"),this.m_gauge.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_gauge.setPosition(3,ccCenter(gauge_bg).y),gauge_bg.addChild(this.m_gauge),this.m_count_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_143),this.m_count_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_count_label.setPosition(ccCenter(gauge_bg)),this.m_count_label.enableOutline(cc.color.BLACK,1),gauge_bg.addChild(this.m_count_label);var bonus_bg=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");bonus_bg.setAnchorPoint(ZERO()),bonus_bg.setPosition(4,21),this.m_list_bg.addChild(bonus_bg),this.m_bonus_icon=cc.Sprite.create(),this.m_bonus_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bonus_icon.setPosition(ccCenter(bonus_bg)),USE_SP_TUBM_SUM&&this.m_bonus_icon.setScale(1),bonus_bg.addChild(this.m_bonus_icon),this.m_complete_btn_mask=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_normal.png",cc.rect()),this.m_complete_btn_mask.setAnchorPoint(ZERO()),this.m_complete_btn_mask.setPosition(ZERO()),this.m_complete_btn_mask.setContentSize(924,94),this.m_list_bg.addChild(this.m_complete_btn_mask),this.m_complete_btn_mask.setVisible(!1),this.m_complete_mask=cc.Sprite.create(RES_CDN_DEFULT+"menu_achievement/img_achievement_complete.png"),this.m_complete_mask.setAnchorPoint(ANCHOR_MIDDLE()),this.m_complete_mask.setPosition(ccCenter(this.m_list_bg)),this.m_complete_mask.setVisible(!1),USE_SP_ACHIVEMENT_SCALE&&this.m_complete_mask.setScale(2),this.m_list_bg.addChild(this.m_complete_mask);var nor=cc.Sprite.create("#btn_05_off.png");nor.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),nor.setPosition(ccWidth(this.m_list_bg)-13,30);var nor_label=cmLabel.getLabel(res_str("btn_label_reward"),LABEL_FONT_INDEX.FONT_241);nor_label.setAnchorPoint(ANCHOR_MIDDLE()),nor_label.setPosition(ccCenter(nor)),nor.addChild(nor_label),this.m_list_bg.addChild(nor),this.m_btn_sprites.push_back(nor);var on=cc.Sprite.create("#btn_05_on.png");on.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),on.setPosition(ccWidth(this.m_list_bg)-13,30);var on_label=cmLabel.getLabel(res_str("btn_label_reward"),LABEL_FONT_INDEX.FONT_242);on_label.setAnchorPoint(ANCHOR_MIDDLE()),on_label.setPosition(ccCenter(on)),on.addChild(on_label),this.m_list_bg.addChild(on),on.setVisible(!1),this.m_btn_sprites.push_back(on);var none=cc.Sprite.create("#btn_04_none.png");none.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),none.setPosition(ccWidth(this.m_list_bg)-13,30);var none_label=cmLabel.getLabel(res_str("btn_label_reward"),LABEL_FONT_INDEX.FONT_242);return none_label.setAnchorPoint(ANCHOR_MIDDLE()),none_label.setPosition(ccCenter(none)),none.addChild(none_label),this.m_list_bg.addChild(none),none.setVisible(!1),this.m_btn_sprites.push_back(none),!0},setUserAchievement:function(achieve,period_idx){this.m_achieve=achieve,this.dungeon_period_Idx=period_idx,this.updateLayout()},updateLayout:function(){var m=MasterManager.getInstance(),nService=new NetService,service=EventDungeonService.getInstance(),event_dungeon_point=new db.UserEventDungeonPoint;if(1==USE_SP_TUBM_SUM&&this.m_bonus_icon.setScale(1),this.m_name_label.setString(this.m_achieve.achv_name),this.m_achieve.bonus_type==BONUS_TYPE_YUNHEE_FIX){var gnrl=m.get_General(this.m_achieve.bonus_id);this.m_reward_label.setString(cmString(res_str("label_reward_count"),gnrl.name,Number(this.m_achieve.bonus_count).toLocaleString()))}else this.m_reward_label.setString(cmString(res_str("label_reward_count"),m.get_BonusType(this.m_achieve.bonus_type).name,Number(this.m_achieve.bonus_count).toLocaleString()));this.m_content.setString(this.m_achieve.content);var count=0;if(1==this.m_achieve.achv_type?count=nService.get_User_Event_Raid_ConquestCount(this.dungeon_period_Idx):2==this.m_achieve.achv_type&&(service.getUserEventDungeonPoint(this.dungeon_period_Idx,event_dungeon_point),count=event_dungeon_point.accum_event_point-event_dungeon_point.event_point),this.m_achieve.need_point<count&&(count=this.m_achieve.need_point),0==this.m_achieve.need_point)this.m_gauge.setScaleX(0);else{var _gauge=count/this.m_achieve.need_point;_gauge*=910,this.m_gauge.setScaleX(_gauge)}if(this.m_count_label.setString(cmString("%s/%s",Number(count).toLocaleString(),Number(this.m_achieve.need_point).toLocaleString())),this.m_achieve.bonus_type==BONUS_TYPE_YUNHEE_FIX||this.m_achieve.bonus_type==BONUS_TYPE_JIN_FIX){var general=m.get_General(this.m_achieve.bonus_id);if(IS_SP_BROWSER)if(general.gnrl_type==GENERAL_TYPE_MATERIAL||general.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL)if(DISABLE_SPB_TP)this.m_bonus_icon.setTexture(RES_CDN_CARD_MEDIUM_NTP+"m_"+general.bone_id+".png"),this.m_bonus_icon.setScale(DEF_TUMB_SCALE);else{var frame=cc.spriteFrameCache.getSpriteFrame("m_"+general.bone_id+".png");this.m_bonus_icon.setSpriteFrame(frame),this.m_bonus_icon.setScale(DEF_TUMB_SCALE)}else if(DISABLE_SPB_TP)this.m_bonus_icon.setTexture(RES_CDN_CARD_MEDIUM_NTP+"m_"+general.gnrl_id+".png"),this.m_bonus_icon.setScale(DEF_TUMB_SCALE);else{frame=cc.spriteFrameCache.getSpriteFrame("m_"+general.gnrl_id+".png");this.m_bonus_icon.setSpriteFrame(frame),this.m_bonus_icon.setScale(DEF_TUMB_SCALE)}else if(general.gnrl_type==GENERAL_TYPE_MATERIAL||general.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL){frame=cc.spriteFrameCache.getSpriteFrame("m_"+general.bone_id+".png");this.m_bonus_icon.setSpriteFrame(frame),this.m_bonus_icon.setScale(DEF_TUMB_SCALE)}else{frame=cc.spriteFrameCache.getSpriteFrame("m_"+general.gnrl_id+".png");this.m_bonus_icon.setSpriteFrame(frame),this.m_bonus_icon.setScale(DEF_TUMB_SCALE)}}else if(this.m_achieve.bonus_type<=BONUS_TYPE_SSR_RARE_TYPE_SELECT||this.m_achieve.bonus_type>=BONUS_TYPE_HWANDAN_1&&this.m_achieve.bonus_type<=BONUS_TYPE_HWANDAN_6||this.m_achieve.bonus_type>=BONUS_TYPE_EVENT_POINT)try{frame=cc.spriteFrameCache.getSpriteFrame("img_reward_"+leadingZeros(this.m_achieve.bonus_type,2)+".png");this.m_bonus_icon.setSpriteFrame(frame)}catch(e){cc.log("EventDungeonRaidRewardCell - Icon Name = "+this.m_achieve.bonus_type)}else{frame=cc.spriteFrameCache.getSpriteFrame("img_reward_yh.png");this.m_bonus_icon.setSpriteFrame(frame)}"y"!=this.m_achieve.complete_yn?(this.m_btn_sprites[0].setVisible(!1),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!0),this.m_complete_btn_mask.setVisible(!1)):(this.m_btn_sprites[0].setVisible(!0),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!1),this.m_complete_btn_mask.setVisible(!0)),this.m_complete_mask.setVisible(!1),"y"==this.m_achieve.complete_yn&&"n"==this.m_achieve.new_yn?(this.m_btn_sprites[0].setVisible(!1),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!0),this.m_complete_mask.setVisible(!0),this.m_complete_btn_mask.setVisible(!0)):(this.m_complete_mask.setVisible(!1),this.m_complete_btn_mask.setVisible(!1))},highlightPosInCell:function(pos){var r=this.m_btn_sprites[0].getBoundingBox();cc.rectContainsPoint(r,pos)&&("y"==this.m_achieve.complete_yn&&"y"==this.m_achieve.new_yn?(this.m_btn_sprites[0].setVisible(!1),this.m_btn_sprites[1].setVisible(!0),this.m_btn_sprites[2].setVisible(!1)):(this.m_btn_sprites[0].setVisible(!1),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!0)))},unhighlightPosInCell:function(pos){var r=this.m_btn_sprites[0].getBoundingBox();cc.rectContainsPoint(r,pos),"y"==this.m_achieve.complete_yn&&"y"==this.m_achieve.new_yn?(this.m_btn_sprites[0].setVisible(!0),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!1)):(this.m_btn_sprites[0].setVisible(!1),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!0))},touchPosInCell:function(pos){var r=this.m_btn_sprites[0].getBoundingBox();if(cc.rectContainsPoint(r,pos))if("y"==this.m_achieve.complete_yn&&"y"==this.m_achieve.new_yn){if(this.m_btn_sprites[0].setVisible(!0),this.m_btn_sprites[1].setVisible(!1),null!=this.m_callback)return void this.m_callback(this.m_achieve,this.getIdx())}else this.m_btn_sprites[0].setVisible(!1),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!0)}}),EventDungeonRaidRewardGachaLayer=cc.Layer.extend({m_table_view:null,m_is_prv_event_dungeon:!1,m_first_event_period_idx:0,m_second_event_period_idx:0,m_bgBoxLayer:null,m_first_gold:null,m_first_silver:null,m_second_gold:null,m_second_silver:null,m_one_gacha_btn:null,m_ten_gacha_btn:null,m_one_gacha_dis_btn:null,m_ten_gacha_dis_btn:null,m_bonus_box:null,m_open_need_count:null,m_open_count:null,m_r_bonus_box:null,m_r_bonus_box_label:null,m_effect_popup:null,m_recv_item_list_popup:null,m_is_effect_layer_touch:!1,m_one_btn_label:null,m_ten_btn_label:null,m_one_btn_label_dis:null,m_ten_btn_label_dis:null,m_bonus_box_info:null,Box_Gacha_Info:null,ctor:function(){this._super(),this.init()},init:function(){var m=MasterManager.getInstance(),service=EventDungeonService.getInstance(),context=BattleContext._getInstance();this.m_is_prv_event_dungeon=context.getIsPrvEventDungeon();var event_dungeon_period_idx=0;return event_dungeon_period_idx=this.m_is_prv_event_dungeon?BattleContext._getInstance().getPrvEventDungeonPeriodIdx():BattleContext._getInstance().getEventDungeonPeriodIdx(),this.m_period=m.get_EventDungeonPeriod(event_dungeon_period_idx),this.m_first_event_period_idx=service.getEventDungeonFirstHalfPeriodIdx(this.m_period.event_dungeon_group_idx),this.m_second_event_period_idx=service.getEventDungeonSecondHalfPeriodIdx(this.m_period.event_dungeon_group_idx),this.m_bgBoxLayer=this.getAchieveBoxLayer(),this.m_bgBoxLayer.ignoreAnchorPointForPosition(!1),this.m_bgBoxLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bgBoxLayer.setPosition(ccCenter(this).x,0),this.addChild(this.m_bgBoxLayer),this.m_effect_popup=new GameModalLayer,this.addChild(this.m_effect_popup,1e4),this.m_recv_item_list_popup=new GameModalLayer,this.addChild(this.m_recv_item_list_popup,1e4),!0},getAchieveBoxLayer:function(){var layer=new cc.Layer,tap_index=GameContext.getInstance().getAchievementTap(),service=EventDungeonService.getInstance(),is_second_open=!1;this.m_is_prv_event_dungeon?service.IsOpenEventPointPeriod(this.m_second_event_period_idx)&&(is_second_open=!0):service.IsOpenDungeon(this.m_second_event_period_idx)&&(is_second_open=!0);var pos_x=17;this.m_first_gold=new LabelButton("btn_07_none.png","btn_07_on.png","btn_07_off.png",ccui.Widget.PLIST_TEXTURE),this.m_first_gold.setFont(LABEL_FONT_INDEX.FONT_201),this.m_first_gold.setString(res_str("event_raid_quest_tab_1_1")),this.m_first_gold.setAnchorPoint(ZERO()),this.m_first_gold.setPosition(pos_x,508),this.m_first_gold.autoSizeFit(20),this.m_first_gold.addClickEventListener(function(){this.changeTapMenu(ACHIEVEMENT_EVENTDUNGEON)}.bind(this)),layer.addChild(this.m_first_gold),pos_x+=ccWidth(this.m_first_gold),this.m_first_silver=new LabelButton("btn_07_none.png","btn_07_on.png","btn_07_off.png",ccui.Widget.PLIST_TEXTURE),this.m_first_silver.setFont(LABEL_FONT_INDEX.FONT_201),this.m_first_silver.setString(res_str("event_raid_quest_tab_1_2")),this.m_first_silver.setAnchorPoint(ZERO()),this.m_first_silver.setPosition(pos_x,508),this.m_first_silver.autoSizeFit(20),this.m_first_silver.addClickEventListener(function(){this.changeTapMenu(ACHIEVEMENT_EVENTDUNGEON_2ND)}.bind(this)),layer.addChild(this.m_first_silver),pos_x+=ccWidth(this.m_first_silver),is_second_open&&(this.m_second_gold=new LabelButton("btn_07_none.png","btn_07_on.png","btn_07_off.png",ccui.Widget.PLIST_TEXTURE),this.m_second_gold.setFont(LABEL_FONT_INDEX.FONT_201),this.m_second_gold.setString(res_str("event_raid_quest_tab_2_1")),this.m_second_gold.setAnchorPoint(ZERO()),this.m_second_gold.setPosition(pos_x,508),this.m_second_gold.autoSizeFit(20),this.m_second_gold.addClickEventListener(function(){this.changeTapMenu(ACHIEVEMENT_EVENTDUNGEON_3RD)}.bind(this)),layer.addChild(this.m_second_gold),pos_x+=ccWidth(this.m_second_gold),this.m_second_silver=new LabelButton("btn_07_none.png","btn_07_on.png","btn_07_off.png",ccui.Widget.PLIST_TEXTURE),this.m_second_silver.setFont(LABEL_FONT_INDEX.FONT_201),this.m_second_silver.setString(res_str("event_raid_quest_tab_2_2")),this.m_second_silver.setAnchorPoint(ZERO()),this.m_second_silver.setPosition(pos_x,508),this.m_second_silver.autoSizeFit(20),this.m_second_silver.addClickEventListener(function(){this.changeTapMenu(ACHIEVEMENT_EVENTDUNGEON_4RD)}.bind(this)),layer.addChild(this.m_second_silver)),tap_index==ACHIEVEMENT_EVENTDUNGEON?this.m_first_gold.setEnabled(!1):tap_index==ACHIEVEMENT_EVENTDUNGEON_2ND?null!=this.m_first_silver&&this.m_first_silver.setEnabled(!1):tap_index==ACHIEVEMENT_EVENTDUNGEON_3RD?null!=this.m_second_gold&&this.m_second_gold.setEnabled(!1):tap_index==ACHIEVEMENT_EVENTDUNGEON_4RD&&null!=this.m_second_silver&&this.m_second_silver.setEnabled(!1);var bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));if(bg_box.setPreferredSize(cc.size(958,515)),bg_box.setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),layer.addChild(bg_box),layer.setContentSize(ccSize(bg_box)),USE_SP_EVENT_SCALE){var left_layer=this.getLeftLayer_SP();layer.addChild(left_layer)}else{(left_layer=this.getLeftLayer()).ignoreAnchorPointForPosition(!1),left_layer.setAnchorPoint(ZERO()),left_layer.setPosition(17,18.5),layer.addChild(left_layer)}var right_layer=this.getRightLayer();return right_layer.ignoreAnchorPointForPosition(!1),right_layer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),right_layer.setPosition(ccWidth(layer)-17,18.5),layer.addChild(right_layer),layer},getLeftLayer:function(){var delimiter,layer=new cc.Layer,period_idx=0,title_label="",tap_index=GameContext.getInstance().getAchievementTap();delimiter=tap_index%2+1,tap_index==ACHIEVEMENT_EVENTDUNGEON||tap_index==ACHIEVEMENT_EVENTDUNGEON_2ND?(period_idx=this.m_first_event_period_idx,title_label=1==delimiter?res_str("event_raid_quest_tab_1_5"):res_str("event_raid_quest_tab_1_6")):tap_index!=ACHIEVEMENT_EVENTDUNGEON_3RD&&tap_index!=ACHIEVEMENT_EVENTDUNGEON_4RD||(period_idx=this.m_second_event_period_idx,title_label=1==delimiter?res_str("event_raid_quest_tab_2_5"):res_str("event_raid_quest_tab_2_6"));var nService=new NetService;return this.Box_Gacha_Info=nService.get_Event_Raid_BoxGacha_Info(period_idx,delimiter),this.m_bonus_box=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/bg_eventvs_banner_%d.jpg",period_idx,delimiter)),this.m_bonus_box.setAnchorPoint(ZERO()),this.m_bonus_box.setPosition(ZERO()),layer.addChild(this.m_bonus_box),layer.setContentSize(ccSize(this.m_bonus_box)),this.m_open_need_count=new cmMultiLabel,this.m_open_need_count.addLabel("獲得までの残り : ",LABEL_FONT_INDEX.FONT_161),this.m_open_need_count.addLabel("1",LABEL_FONT_INDEX.FONT_165),this.m_open_need_count.setLabel(),this.m_open_need_count.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_open_need_count.setPosition(99,212),this.m_bonus_box.addChild(this.m_open_need_count),this.m_bonus_box_info=new cmMultiLabel,this.m_bonus_box_info.addLabel("※前半無双ボス討伐数1体につき、",LABEL_FONT_INDEX.FONT_181),this.m_bonus_box_info.addLabel("珠玉の箱[前半]",LABEL_FONT_INDEX.FONT_1810),this.m_bonus_box_info.addLabel("を1個獲得！",LABEL_FONT_INDEX.FONT_181),this.m_bonus_box_info.enableOutline(cc.color.BLACK,1),this.m_bonus_box_info.setLabel(),this.m_bonus_box_info.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bonus_box_info.setPosition(40,136),this.m_bonus_box.addChild(this.m_bonus_box_info),this.m_open_count=new cmMultiLabel,this.m_open_count.addLabel("開封可能回数： ",LABEL_FONT_INDEX.FONT_181),this.m_open_count.addLabel(this.Box_Gacha_Info.event_raid_box_gacha_ticket,LABEL_FONT_INDEX.FONT_1810),this.m_open_count.addLabel("回",LABEL_FONT_INDEX.FONT_181),this.m_open_count.setLabel(),this.m_open_count.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_open_count.setPosition(180,100),this.m_bonus_box.addChild(this.m_open_count),this.m_one_gacha_btn=new ccui.Button(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_off.png",period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_on.png",period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_none.png",period_idx)),this.m_one_gacha_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_one_gacha_btn.setPosition(0,5),this.m_one_gacha_btn.addClickEventListener(function(){this.BuyBoxGacha(1)}.bind(this)),this.m_bonus_box.addChild(this.m_one_gacha_btn),this.m_one_btn_label=cmLabel.getLabel(cmString("%sを\n         1回開く",title_label),LABEL_FONT_INDEX.FONT_221),this.m_one_btn_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_one_btn_label.setPosition(125,40),this.m_one_gacha_btn.addChild(this.m_one_btn_label),this.m_one_gacha_dis_btn=new ccui.Button(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_none.png",period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_none.png",period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_none.png",period_idx)),this.m_one_gacha_dis_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_one_gacha_dis_btn.setPosition(0,5),this.m_bonus_box.addChild(this.m_one_gacha_dis_btn),this.m_one_btn_label_dis=cmLabel.getLabel(cmString("%sを\n         1回開く",title_label),LABEL_FONT_INDEX.FONT_221),this.m_one_btn_label_dis.setAnchorPoint(ANCHOR_MIDDLE()),this.m_one_btn_label_dis.setPosition(125,40),this.m_one_gacha_dis_btn.addChild(this.m_one_btn_label_dis),this.m_one_gacha_btn.setVisible(!0),this.m_one_gacha_dis_btn.setVisible(!1),this.Box_Gacha_Info.event_raid_box_gacha_ticket<1&&(this.m_one_gacha_btn.setVisible(!1),this.m_one_gacha_dis_btn.setVisible(!0)),this.m_ten_gacha_btn=new ccui.Button(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_off.png",period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_on.png",period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_none.png",period_idx)),this.m_ten_gacha_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_ten_gacha_btn.setPosition(470,5),this.m_ten_gacha_btn.addClickEventListener(function(sender){this.BuyBoxGacha(10)}.bind(this)),this.m_bonus_box.addChild(this.m_ten_gacha_btn),this.m_ten_btn_label=cmLabel.getLabel(cmString("%sを\n        10回開く",title_label),LABEL_FONT_INDEX.FONT_221),this.m_ten_btn_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_ten_btn_label.setPosition(125,40),this.m_ten_gacha_btn.addChild(this.m_ten_btn_label),this.m_ten_gacha_dis_btn=new ccui.Button(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_none.png",period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_none.png",period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_none.png",period_idx)),this.m_ten_gacha_dis_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_ten_gacha_dis_btn.setPosition(470,5),this.m_bonus_box.addChild(this.m_ten_gacha_dis_btn),this.m_ten_btn_label_dis=cmLabel.getLabel(cmString("%sを\n        10回開く",title_label),LABEL_FONT_INDEX.FONT_221),this.m_ten_btn_label_dis.setAnchorPoint(ANCHOR_MIDDLE()),this.m_ten_btn_label_dis.setPosition(125,40),this.m_ten_gacha_dis_btn.addChild(this.m_ten_btn_label_dis),this.m_ten_gacha_btn.setVisible(!0),this.m_ten_gacha_dis_btn.setVisible(!1),this.Box_Gacha_Info.event_raid_box_gacha_ticket<10&&(this.m_ten_gacha_btn.setVisible(!1),this.m_ten_gacha_dis_btn.setVisible(!0)),layer},getLeftLayer_SP:function(){var delimiter,layer=new cc.Layer,period_idx=0,title_label="",tap_index=GameContext.getInstance().getAchievementTap();delimiter=tap_index%2+1,tap_index==ACHIEVEMENT_EVENTDUNGEON||tap_index==ACHIEVEMENT_EVENTDUNGEON_2ND?(period_idx=this.m_first_event_period_idx,title_label=1==delimiter?res_str("event_raid_quest_tab_1_5"):res_str("event_raid_quest_tab_1_6")):tap_index!=ACHIEVEMENT_EVENTDUNGEON_3RD&&tap_index!=ACHIEVEMENT_EVENTDUNGEON_4RD||(period_idx=this.m_second_event_period_idx,title_label=1==delimiter?res_str("event_raid_quest_tab_2_5"):res_str("event_raid_quest_tab_2_6"));var nService=new NetService;return this.Box_Gacha_Info=nService.get_Event_Raid_BoxGacha_Info(period_idx,delimiter),this.m_bonus_box=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/bg_eventvs_banner_%d.jpg",period_idx,delimiter)),this.m_bonus_box.setAnchorPoint(ZERO()),this.m_bonus_box.setPosition(105,20),this.m_bonus_box.setScale(2),this.addChild(this.m_bonus_box,10),layer.setContentSize(ccSize(this.m_bonus_box)),this.m_open_need_count=new cmMultiLabel,this.m_open_need_count.addLabel("獲得までの残り : ",LABEL_FONT_INDEX.FONT_161),this.m_open_need_count.addLabel("1",LABEL_FONT_INDEX.FONT_165),this.m_open_need_count.setLabel(),this.m_open_need_count.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_open_need_count.setPosition(200,232),this.addChild(this.m_open_need_count,10),this.m_bonus_box_info=new cmMultiLabel,this.m_bonus_box_info.addLabel("※前半無双ボス討伐数1体につき、",LABEL_FONT_INDEX.FONT_181),this.m_bonus_box_info.addLabel("珠玉の箱[前半]",LABEL_FONT_INDEX.FONT_1810),this.m_bonus_box_info.addLabel("を1個獲得！",LABEL_FONT_INDEX.FONT_181),this.m_bonus_box_info.enableOutline(cc.color.BLACK,1),this.m_bonus_box_info.setLabel(),this.m_bonus_box_info.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bonus_box_info.setPosition(138,155),this.addChild(this.m_bonus_box_info,10),this.m_open_count=new cmMultiLabel,this.m_open_count.addLabel("開封可能回数： ",LABEL_FONT_INDEX.FONT_181),this.m_open_count.addLabel(this.Box_Gacha_Info.event_raid_box_gacha_ticket,LABEL_FONT_INDEX.FONT_1810),this.m_open_count.addLabel("回",LABEL_FONT_INDEX.FONT_181),this.m_open_count.setLabel(),this.m_open_count.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_open_count.setPosition(280,120),this.addChild(this.m_open_count,10),this.m_one_gacha_btn=new ccui.Button(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_off.png",period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_on.png",period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_none.png",period_idx)),this.m_one_gacha_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_one_gacha_btn.setPosition(100,25),this.m_one_gacha_btn.setScale(2),this.m_one_gacha_btn.addClickEventListener(function(){this.BuyBoxGacha(1)}.bind(this)),this.addChild(this.m_one_gacha_btn,10),this.m_one_btn_label=cmLabel.getLabel(cmString("%sを\n         1回開く",title_label),LABEL_FONT_INDEX.FONT_221),this.m_one_btn_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_one_btn_label.setPosition(225,65),this.addChild(this.m_one_btn_label,10),this.m_one_gacha_dis_btn=new ccui.Button(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_none.png",period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_none.png",period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_none.png",period_idx)),this.m_one_gacha_dis_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_one_gacha_dis_btn.setPosition(100,25),this.m_one_gacha_dis_btn.setScale(2),this.addChild(this.m_one_gacha_dis_btn,10),this.m_one_btn_label_dis=cmLabel.getLabel(cmString("%sを\n         1回開く",title_label),LABEL_FONT_INDEX.FONT_221),this.m_one_btn_label_dis.setAnchorPoint(ANCHOR_MIDDLE()),this.m_one_btn_label_dis.setPosition(225,65),this.addChild(this.m_one_btn_label_dis,10),this.m_one_gacha_btn.setVisible(!0),this.m_one_gacha_dis_btn.setVisible(!1),this.Box_Gacha_Info.event_raid_box_gacha_ticket<1&&(this.m_one_gacha_btn.setVisible(!1),this.m_one_gacha_dis_btn.setVisible(!0)),this.m_ten_gacha_btn=new ccui.Button(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_off.png",period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_on.png",period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_none.png",period_idx)),this.m_ten_gacha_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_ten_gacha_btn.setPosition(575,25),this.m_ten_gacha_btn.setScale(2),this.m_ten_gacha_btn.addClickEventListener(function(sender){this.BuyBoxGacha(10)}.bind(this)),this.addChild(this.m_ten_gacha_btn,10),this.m_ten_btn_label=cmLabel.getLabel(cmString("%sを\n        10回開く",title_label),LABEL_FONT_INDEX.FONT_221),this.m_ten_btn_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_ten_btn_label.setPosition(460,65),this.addChild(this.m_ten_btn_label,10),this.m_ten_gacha_dis_btn=new ccui.Button(RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_none.png",period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_none.png",period_idx),RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_gacha_none.png",period_idx)),this.m_ten_gacha_dis_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_ten_gacha_dis_btn.setPosition(575,25),this.m_ten_gacha_dis_btn.setScale(2),this.addChild(this.m_ten_gacha_dis_btn,10),this.m_ten_btn_label_dis=cmLabel.getLabel(cmString("%sを\n        10回開く",title_label),LABEL_FONT_INDEX.FONT_221),this.m_ten_btn_label_dis.setAnchorPoint(ANCHOR_MIDDLE()),this.m_ten_btn_label_dis.setPosition(460,65),this.addChild(this.m_ten_btn_label_dis,10),this.m_ten_gacha_btn.setVisible(!0),this.m_ten_gacha_dis_btn.setVisible(!1),this.Box_Gacha_Info.event_raid_box_gacha_ticket<10&&(this.m_ten_gacha_btn.setVisible(!1),this.m_ten_gacha_dis_btn.setVisible(!0)),layer},BuyBoxGacha:function(count){var req={};req.opcode=net.OP.op_event_raid_box_gacha_buy;var tap_index=GameContext.getInstance().getAchievementTap();tap_index==ACHIEVEMENT_EVENTDUNGEON||tap_index==ACHIEVEMENT_EVENTDUNGEON_2ND?req.event_dungeon_period_idx=this.m_first_event_period_idx:tap_index!=ACHIEVEMENT_EVENTDUNGEON_3RD&&tap_index!=ACHIEVEMENT_EVENTDUNGEON_4RD||(req.event_dungeon_period_idx=this.m_second_event_period_idx),req.buy_type=count,req.delimiter=tap_index%2+1,SceneManager.getInstance().getRunningScene().network_write(req)},recvBoxGachaBuyResult:function(res){USE_SP_EVENT_SCALE?this.updateLayout_SP():this.updateLayout(),1==res.reward_items.length?this.showRewardItemEffectPopup(res.reward_items[0]):this.showRecvItemListPopup(res)},showRewardItemEffectPopup:function(bonus){this.m_is_effect_layer_touch=!1,this.m_effect_popup.setContentSize(ccSize(this)),this.m_effect_popup._contentNode=function(contentSize,m){return this.getRewardItemEffectLayer(bonus)}.bind(this),this.m_effect_popup.onItemTouchBegin=function(){return!0}.bind(this),this.m_effect_popup.onItemTouchEnd=function(){this.m_is_effect_layer_touch&&(AudioEngine.getInstance().stopEffectsAll(),this.m_is_effect_layer_touch=!1,this.m_effect_popup.hide())}.bind(this),this.m_effect_popup.show()},getRewardItemEffectLayer:function(bonus){var layer=new cc.Layer,mt=MasterManager.getInstance(),winSize=ccSize(layer),audio=AudioEngine.getInstance();audio.stopEffectsAll(),audio.playEffect(RES_CDN_SOUND+SND_TYPE+"sound/SE_all_win_popularity.mp3",!1),audio.playEffect(RES_CDN_SOUND+SND_TYPE+"sound/SE_gacha_back.mp3",!0);var back_effect=cc.Sprite.create("#img_attend_effect.png");back_effect.setPosition(ccCenter(layer)),layer.addChild(back_effect),back_effect.setScale(1.7);var action=new cc.RotateBy(1,180),repeat=new cc.RepeatForever(action);back_effect.runAction(repeat);var bonus_icon=new cc.Sprite;bonus_icon.setPosition(ccCenter(layer)),layer.addChild(bonus_icon);var bonus_name_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_503);bonus_name_label.setAnchorPoint(ANCHOR_MIDDLE_TOP()),bonus_name_label.enableOutline(cc.color.BLACK,3),bonus_name_label.setPosition(.5*winSize.width,winSize.height-180),layer.addChild(bonus_name_label);var count=0;if(bonus.bonus_type==BONUS_TYPE_YUNHEE_FIX){var general=mt.get_General(bonus.bonus_idx),frame=cc.spriteFrameCache.getSpriteFrame("img_reward_"+leadingZeros(bonus.bonus_idx,2)+"_d.png");bonus_icon.setSpriteFrame(frame),bonus_name_label.setString(general.name),count=bonus.bonus_level}else if(bonus.bonus_type==BONUS_TYPE_EQUIPMENT){var b=mt.get_BonusType(bonus.bonus_type),equip=mt.get_EquipmentItem(bonus.equipment.equipment_item_idx);frame=cc.spriteFrameCache.getSpriteFrame("img_reward_"+leadingZeros(b.bonus_type,2)+"_d.png");bonus_icon.setSpriteFrame(frame),bonus_name_label.setString(equip.name),count=1}else{b=mt.get_BonusType(bonus.bonus_type),frame=cc.spriteFrameCache.getSpriteFrame("img_reward_"+leadingZeros(bonus.bonus_type,2)+"_d.png");bonus_icon.setSpriteFrame(frame),bonus_name_label.setString(b.name),count=bonus.bonus_idx}var bonus_count_label=cmLabel.getLabel(cmString("x %s",Number(count)).toLocaleString("en"),LABEL_FONT_INDEX.FONT_503);return bonus_count_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bonus_count_label.enableOutline(cc.color.BLACK,3),bonus_count_label.setPosition(.5*winSize.width,180),layer.addChild(bonus_count_label),this.scheduleOnce(function(){this.m_is_effect_layer_touch=!0},1,"showEffectLayer"),layer},showRecvItemListPopup:function(res){this.m_recv_item_list_popup.setContentSize(ccSize(this)),this.m_recv_item_list_popup._contentNode=function(contentSize,m){return new EventDungeonRaidBoxGachaRecvItemPopup(res,this.hideRecvItemListPopup.bind(this))}.bind(this),this.m_recv_item_list_popup.show()},hideRecvItemListPopup:function(){this.m_recv_item_list_popup.is_show()&&this.m_recv_item_list_popup.hide()},getRightLayer:function(){var layer=new cc.Layer,layer_size=cc.size(444,478);layer.setContentSize(layer_size);var delimiter,period_idx=0,title_label="",tap_index=GameContext.getInstance().getAchievementTap();delimiter=tap_index%2+1,tap_index==ACHIEVEMENT_EVENTDUNGEON||tap_index==ACHIEVEMENT_EVENTDUNGEON_2ND?(period_idx=this.m_first_event_period_idx,title_label=1==delimiter?res_str("event_raid_quest_tab_1_5"):res_str("event_raid_quest_tab_1_6")):tap_index!=ACHIEVEMENT_EVENTDUNGEON_3RD&&tap_index!=ACHIEVEMENT_EVENTDUNGEON_4RD||(period_idx=this.m_second_event_period_idx,title_label=1==delimiter?res_str("event_raid_quest_tab_2_5"):res_str("event_raid_quest_tab_2_6")),this.m_r_bonus_box=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_box_%d.png",period_idx,delimiter)),this.m_r_bonus_box.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_r_bonus_box.setPosition(6,ccHeight(layer)),IS_SP_BROWSER&&this.m_r_bonus_box.setScale(2),layer.addChild(this.m_r_bonus_box),this.m_r_bonus_box_label=cmLabel.getLabel(cmString(res_str("event_raid_quest_open_box_title"),title_label),LABEL_FONT_INDEX.FONT_221),this.m_r_bonus_box_label.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_r_bonus_box_label.setPosition(52,ccHeight(layer)-6),layer.addChild(this.m_r_bonus_box_label);var tSize=cc.size(444,438);return this.m_table_view=new cc.TableView(this,tSize),this.m_table_view.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_table_view.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_table_view.scrollBarEnable(!0),this.m_table_view.setDelegate(this),layer.addChild(this.m_table_view),this.m_table_view.reloadData(),layer},updateLayout:function(){var delimiter,period_idx=0,title_label="",btn_label="",count=0,tap_index=GameContext.getInstance().getAchievementTap();delimiter=tap_index%2+1,this.m_event_dungeon_point={};var service=EventDungeonService.getInstance();tap_index==ACHIEVEMENT_EVENTDUNGEON||tap_index==ACHIEVEMENT_EVENTDUNGEON_2ND?(period_idx=this.m_first_event_period_idx,service.getUserEventDungeonPoint(period_idx,this.m_event_dungeon_point),1==delimiter?(title_label=res_str("event_raid_quest_tab_1_3"),btn_label=res_str("event_raid_quest_tab_1_5"),count=1,this.m_bonus_box_info.clearLabel(),this.m_bonus_box_info.addLabel("※前半無双ボス討伐数1体につき、",LABEL_FONT_INDEX.FONT_181),this.m_bonus_box_info.addLabel("珠玉の箱[前半]",LABEL_FONT_INDEX.FONT_1810),this.m_bonus_box_info.addLabel("を1個獲得！",LABEL_FONT_INDEX.FONT_181),this.m_bonus_box_info.enableOutline(cc.color.BLACK,1),this.m_bonus_box_info.setLabel(),this.m_bonus_box_info.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bonus_box_info.setPosition(40,136)):(title_label=res_str("event_raid_quest_tab_1_4"),btn_label=res_str("event_raid_quest_tab_1_6"),count=500-(this.m_event_dungeon_point.accum_event_point-this.m_event_dungeon_point.event_point)%500,this.m_bonus_box_info.clearLabel(),this.m_bonus_box_info.addLabel("※蔵の鍵を500個使用につき、",LABEL_FONT_INDEX.FONT_181),this.m_bonus_box_info.addLabel("至宝の箱[前半]",LABEL_FONT_INDEX.FONT_1810),this.m_bonus_box_info.addLabel("を1個獲得！",LABEL_FONT_INDEX.FONT_181),this.m_bonus_box_info.enableOutline(cc.color.BLACK,1),this.m_bonus_box_info.setLabel(),this.m_bonus_box_info.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bonus_box_info.setPosition(30,136))):tap_index!=ACHIEVEMENT_EVENTDUNGEON_3RD&&tap_index!=ACHIEVEMENT_EVENTDUNGEON_4RD||(period_idx=this.m_second_event_period_idx,service.getUserEventDungeonPoint(period_idx,this.m_event_dungeon_point),1==delimiter?(title_label=res_str("event_raid_quest_tab_2_3"),btn_label=res_str("event_raid_quest_tab_2_5"),count=1,this.m_bonus_box_info.clearLabel(),this.m_bonus_box_info.addLabel("※後半無双ボス討伐数1体につき、",LABEL_FONT_INDEX.FONT_181),this.m_bonus_box_info.addLabel("珠玉の箱[後半]",LABEL_FONT_INDEX.FONT_1810),this.m_bonus_box_info.addLabel("を1個獲得！",LABEL_FONT_INDEX.FONT_181),this.m_bonus_box_info.enableOutline(cc.color.BLACK,1),this.m_bonus_box_info.setLabel(),this.m_bonus_box_info.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bonus_box_info.setPosition(40,136)):(title_label=res_str("event_raid_quest_tab_2_4"),btn_label=res_str("event_raid_quest_tab_2_6"),count=500-(this.m_event_dungeon_point.accum_event_point-this.m_event_dungeon_point.event_point)%500,this.m_bonus_box_info.clearLabel(),this.m_bonus_box_info.addLabel("※蔵の錠前を500個使用につき、",LABEL_FONT_INDEX.FONT_181),this.m_bonus_box_info.addLabel("至宝の箱[後半]",LABEL_FONT_INDEX.FONT_1810),this.m_bonus_box_info.addLabel("を1個獲得！",LABEL_FONT_INDEX.FONT_181),this.m_bonus_box_info.enableOutline(cc.color.BLACK,1),this.m_bonus_box_info.setLabel(),this.m_bonus_box_info.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bonus_box_info.setPosition(30,136))),this.m_bonus_box.setTexture(RES_CDN_DEFULT+cmString("menu_eventvs_%d/bg_eventvs_banner_%d.jpg",period_idx,delimiter)),this.m_open_need_count.clearLabel(),this.m_open_need_count.addLabel("獲得までの残り : ",LABEL_FONT_INDEX.FONT_161),this.m_open_need_count.addLabel(count,LABEL_FONT_INDEX.FONT_165),this.m_open_need_count.setLabel(),this.m_open_need_count.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_open_need_count.setPosition(99,212),this.m_open_count.clearLabel(),this.m_open_count.addLabel("開封可能回数： ",LABEL_FONT_INDEX.FONT_181),this.m_open_count.addLabel(this.Box_Gacha_Info.event_raid_box_gacha_ticket,LABEL_FONT_INDEX.FONT_1810),this.m_open_count.addLabel("回",LABEL_FONT_INDEX.FONT_181),this.m_open_count.setLabel(),this.m_open_count.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_open_count.setPosition(180,100),this.m_r_bonus_box.setTexture(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_box_%d.png",period_idx,delimiter)),this.m_r_bonus_box_label.setString(cmString(res_str("event_raid_quest_open_box_title"),title_label)),this.m_one_gacha_btn.setVisible(!0),this.m_one_gacha_dis_btn.setVisible(!1),this.m_ten_gacha_btn.setVisible(!0),this.m_ten_gacha_dis_btn.setVisible(!1),this.Box_Gacha_Info.event_raid_box_gacha_ticket<1&&(this.m_one_gacha_btn.setVisible(!1),this.m_one_gacha_dis_btn.setVisible(!0)),this.Box_Gacha_Info.event_raid_box_gacha_ticket<10&&(this.m_ten_gacha_btn.setVisible(!1),this.m_ten_gacha_dis_btn.setVisible(!0)),this.m_one_btn_label.setString(cmString("%sを\n         1回開く",btn_label)),this.m_ten_btn_label.setString(cmString("%sを\n        10回開く",btn_label)),this.m_one_btn_label_dis.setString(cmString("%sを\n         1回開く",btn_label)),this.m_ten_btn_label_dis.setString(cmString("%sを\n        10回開く",btn_label)),this.m_table_view.reloadData()},updateLayout_SP:function(){var delimiter,period_idx=0,title_label="",btn_label="",count=0,tap_index=GameContext.getInstance().getAchievementTap();delimiter=tap_index%2+1,this.m_event_dungeon_point={};var service=EventDungeonService.getInstance();tap_index==ACHIEVEMENT_EVENTDUNGEON||tap_index==ACHIEVEMENT_EVENTDUNGEON_2ND?(period_idx=this.m_first_event_period_idx,service.getUserEventDungeonPoint(period_idx,this.m_event_dungeon_point),1==delimiter?(title_label=res_str("event_raid_quest_tab_1_3"),btn_label=res_str("event_raid_quest_tab_1_5"),count=1,this.m_bonus_box_info.clearLabel(),this.m_bonus_box_info.addLabel("※前半無双ボス討伐数1体につき、",LABEL_FONT_INDEX.FONT_181),this.m_bonus_box_info.addLabel("珠玉の箱[前半]",LABEL_FONT_INDEX.FONT_1810),this.m_bonus_box_info.addLabel("を1個獲得！",LABEL_FONT_INDEX.FONT_181),this.m_bonus_box_info.enableOutline(cc.color.BLACK,1),this.m_bonus_box_info.setLabel(),this.m_bonus_box_info.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bonus_box_info.setPosition(138,155)):(title_label=res_str("event_raid_quest_tab_1_4"),btn_label=res_str("event_raid_quest_tab_1_6"),count=500-(this.m_event_dungeon_point.accum_event_point-this.m_event_dungeon_point.event_point)%500,this.m_bonus_box_info.clearLabel(),this.m_bonus_box_info.addLabel("※蔵の鍵を500個使用につき、",LABEL_FONT_INDEX.FONT_181),this.m_bonus_box_info.addLabel("至宝の箱[前半]",LABEL_FONT_INDEX.FONT_1810),this.m_bonus_box_info.addLabel("を1個獲得！",LABEL_FONT_INDEX.FONT_181),this.m_bonus_box_info.enableOutline(cc.color.BLACK,1),this.m_bonus_box_info.setLabel(),this.m_bonus_box_info.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bonus_box_info.setPosition(135,155))):tap_index!=ACHIEVEMENT_EVENTDUNGEON_3RD&&tap_index!=ACHIEVEMENT_EVENTDUNGEON_4RD||(period_idx=this.m_second_event_period_idx,service.getUserEventDungeonPoint(period_idx,this.m_event_dungeon_point),1==delimiter?(title_label=res_str("event_raid_quest_tab_2_3"),btn_label=res_str("event_raid_quest_tab_2_5"),count=1,this.m_bonus_box_info.clearLabel(),this.m_bonus_box_info.addLabel("※後半無双ボス討伐数1体につき、",LABEL_FONT_INDEX.FONT_181),this.m_bonus_box_info.addLabel("珠玉の箱[後半]",LABEL_FONT_INDEX.FONT_1810)):(title_label=res_str("event_raid_quest_tab_2_4"),btn_label=res_str("event_raid_quest_tab_2_6"),count=500-(this.m_event_dungeon_point.accum_event_point-this.m_event_dungeon_point.event_point)%500,this.m_bonus_box_info.clearLabel(),this.m_bonus_box_info.addLabel("※蔵の錠前を500個使用につき、",LABEL_FONT_INDEX.FONT_181),this.m_bonus_box_info.addLabel("至宝の箱[後半]",LABEL_FONT_INDEX.FONT_1810)),this.m_bonus_box_info.addLabel("を1個獲得！",LABEL_FONT_INDEX.FONT_181),this.m_bonus_box_info.enableOutline(cc.color.BLACK,1),this.m_bonus_box_info.setLabel(),this.m_bonus_box_info.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bonus_box_info.setPosition(135,155)),this.m_bonus_box.setTexture(RES_CDN_DEFULT+cmString("menu_eventvs_%d/bg_eventvs_banner_%d.jpg",period_idx,delimiter)),this.m_open_need_count.clearLabel(),this.m_open_need_count.addLabel("獲得までの残り : ",LABEL_FONT_INDEX.FONT_161),this.m_open_need_count.addLabel(count,LABEL_FONT_INDEX.FONT_165),this.m_open_need_count.setLabel(),this.m_open_need_count.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_open_need_count.setPosition(200,232),this.m_open_count.clearLabel(),this.m_open_count.addLabel("開封可能回数： ",LABEL_FONT_INDEX.FONT_181),this.m_open_count.addLabel(this.Box_Gacha_Info.event_raid_box_gacha_ticket,LABEL_FONT_INDEX.FONT_1810),this.m_open_count.addLabel("回",LABEL_FONT_INDEX.FONT_181),this.m_open_count.setLabel(),this.m_open_count.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_open_count.setPosition(280,120),this.m_r_bonus_box.setTexture(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_box_%d.png",period_idx,delimiter)),this.m_r_bonus_box_label.setString(cmString(res_str("event_raid_quest_open_box_title"),title_label)),this.m_one_gacha_btn.setVisible(!0),this.m_one_gacha_dis_btn.setVisible(!1),this.m_ten_gacha_btn.setVisible(!0),this.m_ten_gacha_dis_btn.setVisible(!1),this.Box_Gacha_Info.event_raid_box_gacha_ticket<1&&(this.m_one_gacha_btn.setVisible(!1),this.m_one_gacha_dis_btn.setVisible(!0)),this.Box_Gacha_Info.event_raid_box_gacha_ticket<10&&(this.m_ten_gacha_btn.setVisible(!1),this.m_ten_gacha_dis_btn.setVisible(!0)),this.m_one_btn_label.setString(cmString("%sを\n         1回開く",btn_label)),this.m_ten_btn_label.setString(cmString("%sを\n        10回開く",btn_label)),this.m_one_btn_label_dis.setString(cmString("%sを\n         1回開く",btn_label)),this.m_ten_btn_label_dis.setString(cmString("%sを\n        10回開く",btn_label)),this.m_table_view.reloadData()},changeTapMenu:function(index){null!=this.m_first_gold&&this.m_first_gold.setEnabled(!0),null!=this.m_first_silver&&this.m_first_silver.setEnabled(!0),null!=this.m_second_gold&&this.m_second_gold.setEnabled(!0),null!=this.m_second_silver&&this.m_second_silver.setEnabled(!0);var nService=new NetService;switch(index){case ACHIEVEMENT_EVENTDUNGEON:null!=this.m_first_gold&&(this.m_first_gold.setEnabled(!1),this.Box_Gacha_Info=nService.get_Event_Raid_BoxGacha_Info(this.m_first_event_period_idx,1));break;case ACHIEVEMENT_EVENTDUNGEON_2ND:null!=this.m_first_silver&&(this.m_first_silver.setEnabled(!1),this.Box_Gacha_Info=nService.get_Event_Raid_BoxGacha_Info(this.m_first_event_period_idx,2));break;case ACHIEVEMENT_EVENTDUNGEON_3RD:null!=this.m_second_gold&&(this.m_second_gold.setEnabled(!1),this.Box_Gacha_Info=nService.get_Event_Raid_BoxGacha_Info(this.m_second_event_period_idx,1));break;case ACHIEVEMENT_EVENTDUNGEON_4RD:null!=this.m_second_silver&&(this.m_second_silver.setEnabled(!1),this.Box_Gacha_Info=nService.get_Event_Raid_BoxGacha_Info(this.m_second_event_period_idx,2))}GameContext.getInstance().setAchievementTap(index),USE_SP_EVENT_SCALE?this.updateLayout_SP():this.updateLayout(),this.m_table_view.reloadData()},onEnter:function(){this._super()},onExit:function(){this._super()},cellSizeForTable:function(table){return cc.size(444,78)},tableCellSizeForIndex:function(){return cc.size(444,78)},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;return(cell=null!=c?c:new EventDungeonRaidRewardGachaCell).setRewardList(this.Box_Gacha_Info.box_list[idx]),cell},numberOfCellsInTableView:function(table){return this.Box_Gacha_Info.box_list.length},tableCellTouched:function(table,cell){},tableCellHighlight:function(table,cell){},tableCellUnhighlight:function(table,cell){},tableCellEnded:function(){}}),EventDungeonRaidRewardGachaScene=GameScene.extend({m_rewardLayer:null,pre_tap_idx:0,ctor:function(){this._super(scene_EventDungeonRaidRewardGachaScene)},init:function(){this.win_size=cc.director.getWinSize();var bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub.png");bg.setPosition(ccCenter(this)),USE_SP_COMMON_SUB_BG_SCALE&&bg.setScale(2),this.addChild(bg);var achv_type=ACHIEVEMENT_EVENTDUNGEON;ACHIEVEMENT_EVENTDUNGEON;GameContext.getInstance().setAchievementTap(achv_type),this.m_rewardLayer=new EventDungeonRaidRewardGachaLayer,this.addChild(this.m_rewardLayer);var statusLayer=new StatusLayer;statusLayer.initLayout(),statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer);var back_btn=new ccui.Button;back_btn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png",""),back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(sender){this.back()}.bind(this)),this.addChild(back_btn);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_eventvs.png");return title.setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title),!0},onEnter:function(){this._super(),this.m_gameObserver=MainObserver.getInstance(),this.m_gameObserver.addObserver(this.onNotification,this,sceneStr[scene_EventDungeonRaidRewardGachaScene])},onExit:function(){this._super(),this.m_gameObserver=MainObserver.getInstance(),this.m_gameObserver.removeObserver(sceneStr[scene_EventDungeonRaidRewardGachaScene])},onNotification:function(msg){this._super(msg)},onNetworkEvent:function(opcode,state,body){this._super(opcode,state,body),opcode==net.OP.op_event_raid_box_gacha_buy&&this.m_rewardLayer.recvBoxGachaBuyResult(body)},back:function(){this.onKeyBack(!0)}}),EventDungeonRaidRewardGachaCell=cc.TableViewCell.extend({m_list_bg:null,m_reward_icon:null,m_title_label:null,m_content_label:null,m_gacha_list:null,ctor:function(){this._super(),this.init()},init:function(){this.m_list_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_5.png",RectZero()),this.m_list_bg.setAnchorPoint(ZERO()),this.m_list_bg.setPosition(ZERO()),this.m_list_bg.setContentSize(444,78),this.addChild(this.m_list_bg),this.setContentSize(ccSize(this.m_list_bg));var icon_frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");return icon_frame.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),icon_frame.setPosition(4,5),this.m_list_bg.addChild(icon_frame),this.m_reward_icon=cc.Sprite.create("#img_reward_01.png"),this.m_reward_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_reward_icon.setPosition(ccCenter(icon_frame)),USE_SP_TUBM_SUM&&this.m_reward_icon.setScale(1),icon_frame.addChild(this.m_reward_icon),this.m_title_label=cmLabel.getLabel("title",LABEL_FONT_INDEX.FONT_2013),this.m_title_label.setAnchorPoint(ZERO()),this.m_title_label.setPosition(80,45),this.m_list_bg.addChild(this.m_title_label),this.m_content_label=cmLabel.getLabel("content",LABEL_FONT_INDEX.FONT_181),this.m_content_label.setAnchorPoint(ZERO()),this.m_content_label.setPosition(80,17),this.m_list_bg.addChild(this.m_content_label),!0},updateLayout:function(){var m=MasterManager.getInstance(),str_title="";if(1==USE_SP_TUBM_SUM&&this.m_reward_icon.setScale(1),this.m_gacha_list.bonus_type==BONUS_TYPE_YUNHEE_FIX||this.m_gacha_list.bonus_type==BONUS_TYPE_JIN_FIX){var general=m.get_General(this.m_gacha_list.bonus_min);if(IS_SP_BROWSER)if(general.gnrl_type==GENERAL_TYPE_MATERIAL||general.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL)if(DISABLE_SPB_TP)this.m_reward_icon.setTexture(RES_CDN_CARD_MEDIUM_NTP+"m_"+general.bone_id+".png"),this.m_reward_icon.setScale(DEF_TUMB_SCALE);else{var frame=cc.spriteFrameCache.getSpriteFrame("m_"+general.bone_id+".png");this.m_reward_icon.setSpriteFrame(frame),this.m_reward_icon.setScale(DEF_TUMB_SCALE)}else if(DISABLE_SPB_TP)this.m_reward_icon.setTexture(RES_CDN_CARD_MEDIUM_NTP+"m_"+general.gnrl_id+".png"),this.m_reward_icon.setScale(DEF_TUMB_SCALE);else{frame=cc.spriteFrameCache.getSpriteFrame("m_"+general.gnrl_id+".png");this.m_reward_icon.setSpriteFrame(frame),this.m_reward_icon.setScale(DEF_TUMB_SCALE)}else if(general.gnrl_type==GENERAL_TYPE_MATERIAL||general.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL){frame=cc.spriteFrameCache.getSpriteFrame("m_"+general.bone_id+".png");this.m_reward_icon.setSpriteFrame(frame),this.m_reward_icon.setScale(DEF_TUMB_SCALE)}else{frame=cc.spriteFrameCache.getSpriteFrame("m_"+general.gnrl_id+".png");this.m_reward_icon.setSpriteFrame(frame),this.m_reward_icon.setScale(DEF_TUMB_SCALE)}}else if(this.m_gacha_list.bonus_type==BONUS_TYPE_EQUIPMENT)if(IS_SP_BROWSER){var equip=m.get_EquipmentItem(this.m_gacha_list.bonus_min);if(DISABLE_SPB_TP)this.m_reward_icon.setTexture(RES_CDN_DEFULT+cmString("menu_equip/%s.png",equip.reward_img));else{frame=cc.spriteFrameCache.getSpriteFrame(equip.reward_img+".png");this.m_reward_icon.setScale(2),this.m_reward_icon.setSpriteFrame(frame)}}else{equip=m.get_EquipmentItem(this.m_gacha_list.bonus_min),frame=cc.spriteFrameCache.getSpriteFrame(equip.reward_img+".png");this.m_reward_icon.setSpriteFrame(frame)}else if(this.m_gacha_list.bonus_type<=BONUS_TYPE_SSR_RARE_TYPE_SELECT||this.m_gacha_list.bonus_type>=BONUS_TYPE_HWANDAN_1&&this.m_gacha_list.bonus_type<=BONUS_TYPE_HWANDAN_6||this.m_gacha_list.bonus_type>=BONUS_TYPE_EVENT_POINT){frame=cc.spriteFrameCache.getSpriteFrame("img_reward_"+leadingZeros(this.m_gacha_list.bonus_type,2)+".png");this.m_reward_icon.setSpriteFrame(frame)}else{frame=cc.spriteFrameCache.getSpriteFrame("#img_reward_yh.png");this.m_reward_icon.setSpriteFrame(frame)}if(this.m_gacha_list.bonus_type==BONUS_TYPE_YUNHEE_FIX)str_title=m.get_General(this.m_gacha_list.bonus_min).name+cmString(res_str("label_event_dungeon_own_point"),Number(this.m_gacha_list.bonus_max).toLocaleString("en"));else if(this.m_gacha_list.bonus_type==BONUS_TYPE_EQUIPMENT){str_title=(equip=m.get_EquipmentItem(this.m_gacha_list.bonus_min)).name+cmString(res_str("label_event_dungeon_own_point"),Number(this.m_gacha_list.bonus_max).toLocaleString("en"))}else str_title=m.get_BonusType(this.m_gacha_list.bonus_type).name+cmString(res_str("label_event_dungeon_own_point"),Number(this.m_gacha_list.bonus_max).toLocaleString("en"));0<this.m_gacha_list.max_count?(this.m_title_label.setString(str_title),this.m_title_label.setAnchorPoint(ZERO()),this.m_title_label.setPosition(80,45),this.m_content_label.setString(cmString(res_str("label_event_dungeon_treasure_box_count_2"),this.m_gacha_list.now_count,this.m_gacha_list.max_count))):(this.m_title_label.setString(str_title),this.m_title_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_title_label.setPosition(80,.5*ccHeight(this.m_list_bg)),this.m_content_label.setString(""))},setRewardList:function(List){this.m_gacha_list=List,this.updateLayout()}});