var EventDungeonAchvListItemCell_V2=cc.TableViewCell.extend({m_callback:null,m_list_bg:null,m_complete_btn_mask:null,m_name_label:null,m_reward_label:null,m_content:null,m_count_label:null,m_gauge:null,m_bonus_icon:null,m_complete_mask:null,m_btn_sprites:[],ctor:function(_cb){this._super(),this.m_btn_sprites=[],this.init(_cb)},init:function(_cb){this.m_callback=_cb;var cellSize=cc.size(924,94);this.setContentSize(cellSize),this.m_list_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero()),this.m_list_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_list_bg.setPosition(ccCenter(cellSize)),this.m_list_bg.setPreferredSize(cellSize),this.addChild(this.m_list_bg),this.setContentSize(ccSize(this.m_list_bg)),cellSize=null,this.m_name_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2013),this.m_name_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_name_label.setPosition(80,59),this.m_list_bg.addChild(this.m_name_label),this.m_reward_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1810),this.m_reward_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_reward_label.setPosition(790,59),this.m_list_bg.addChild(this.m_reward_label),this.m_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.m_content.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_content.setPosition(80,33),this.m_list_bg.addChild(this.m_content);var gauge_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero());gauge_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),gauge_bg.setPosition(4,5),gauge_bg.setContentSize(916,16),this.m_list_bg.addChild(gauge_bg),this.m_gauge=cc.Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green.png"),this.m_gauge.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_gauge.setPosition(3,ccCenter(gauge_bg).y),gauge_bg.addChild(this.m_gauge),this.m_count_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_143),this.m_count_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_count_label.setPosition(ccCenter(gauge_bg)),this.m_count_label.enableOutline(cc.color.BLACK,1),gauge_bg.addChild(this.m_count_label);var bonus_bg=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");bonus_bg.setAnchorPoint(ZERO()),bonus_bg.setPosition(4,21),this.m_list_bg.addChild(bonus_bg),this.m_bonus_icon=new cc.Sprite,this.m_bonus_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bonus_icon.setPosition(ccCenter(bonus_bg)),bonus_bg.addChild(this.m_bonus_icon),this.m_complete_btn_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero()),this.m_complete_btn_mask.setAnchorPoint(ZERO()),this.m_complete_btn_mask.setPosition(ZERO()),this.m_complete_btn_mask.setContentSize(924,94),this.m_list_bg.addChild(this.m_complete_btn_mask),this.m_complete_btn_mask.setVisible(!1),this.m_complete_mask=cc.Sprite.create(RES_CDN_DEFULT+"menu_achievement/img_achievement_complete.png"),this.m_complete_mask.setAnchorPoint(ANCHOR_MIDDLE()),this.m_complete_mask.setPosition(ccCenter(this.m_list_bg)),this.m_complete_mask.setVisible(!1),USE_SP_ACHIVEMENT_SCALE&&this.m_complete_mask.setScale(2),this.m_list_bg.addChild(this.m_complete_mask);var nor=cc.Sprite.create("#btn_05_off.png");nor.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),nor.setPosition(ccWidth(this.m_list_bg)-13,30);var nor_label=cmLabel.getLabel("報酬受取",LABEL_FONT_INDEX.FONT_241);nor_label.setAnchorPoint(ANCHOR_MIDDLE()),nor_label.setPosition(ccCenter(nor)),nor.addChild(nor_label),this.m_list_bg.addChild(nor),this.m_btn_sprites.push(nor);var on=cc.Sprite.create("#btn_05_on.png");on.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),on.setPosition(ccWidth(this.m_list_bg)-13,30);var on_label=cmLabel.getLabel("報酬受取",LABEL_FONT_INDEX.FONT_242);on_label.setAnchorPoint(ANCHOR_MIDDLE()),on_label.setPosition(ccCenter(on)),on.addChild(on_label),this.m_list_bg.addChild(on),on.setVisible(!1),this.m_btn_sprites.push(on);var none=cc.Sprite.create("#btn_04_none.png");none.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),none.setPosition(ccWidth(this.m_list_bg)-13,30);var none_label=cmLabel.getLabel("報酬受取",LABEL_FONT_INDEX.FONT_242);return none_label.setAnchorPoint(ANCHOR_MIDDLE()),none_label.setPosition(ccCenter(none)),none.addChild(none_label),this.m_list_bg.addChild(none),none.setVisible(!1),this.m_btn_sprites.push(none),!0},setUserEventDungeonAchvData:function(achv){this.m_data=achv,this.updateLayout()},updateLayout:function(){var m=MasterManager.getInstance();this.m_name_label.setString(this.m_data.event_achv.name),cmLabel.setFontSize(this.m_reward_label,18);var first_reward=this.m_data.rewards[0];if(first_reward.bonus_type==BONUS_TYPE_YUNHEE_FIX){var gnrl=m.get_General(first_reward.min_value);this.m_reward_label.setString(cmString("報酬:%sx%s",gnrl.name,Number(first_reward.max_value).toLocaleString("en")))}else{var bonus=m.get_BonusType(first_reward.bonus_type);this.m_reward_label.setString(cmString("報酬:%sx%s",bonus.name,Number(first_reward.min_value).toLocaleString("en")))}cmLabel.autoSizeFit(this.m_reward_label,194,20),this.m_content.setString(cmString(this.m_data.event_achv.content,this.m_data.achv.complete_count));var complete_count=this.m_data.complete_count;if(this.m_data.achv.complete_count<complete_count&&(complete_count=this.m_data.achv.complete_count),0==this.m_data.achv.complete_count)this.m_gauge.setScaleX(0);else{var per=complete_count/this.m_data.achv.complete_count;per*=910,this.m_gauge.setScaleX(per)}if(this.m_count_label.setString(cmString("%d/%d",this.m_data.complete_count,this.m_data.achv.complete_count)),first_reward.bonus_type==BONUS_TYPE_YUNHEE_FIX){var g=m.get_General(first_reward.min_value);if(g.gnrl_type==GENERAL_TYPE_MATERIAL||g.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL){var frame=cc.spriteFrameCache.getSpriteFrame("m_"+g.bone_id+".png");this.m_bonus_icon.setSpriteFrame(frame),this.m_bonus_icon.setScale(DEF_TUMB_SCALE)}else{frame=cc.spriteFrameCache.getSpriteFrame("m_"+g.gnrl_id+".png");this.m_bonus_icon.setSpriteFrame(frame),this.m_bonus_icon.setScale(DEF_TUMB_SCALE)}}else{frame=cc.spriteFrameCache.getSpriteFrame("img_reward_"+leadingZeros(first_reward.bonus_type,2)+".png");this.m_bonus_icon.setSpriteFrame(frame),this.m_bonus_icon.setScale(1)}this.m_data.is_complete?this.m_data.is_bonus_complete?(this.m_btn_sprites[0].setVisible(!1),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!0),this.m_complete_btn_mask.setVisible(!0),this.m_complete_mask.setVisible(!0)):(this.m_btn_sprites[0].setVisible(!0),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!1),this.m_complete_btn_mask.setVisible(!1),this.m_complete_mask.setVisible(!1)):(this.m_btn_sprites[0].setVisible(!1),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!0),this.m_complete_btn_mask.setVisible(!1),this.m_complete_mask.setVisible(!1))},highlightPosInCell:function(pos){var r=this.m_btn_sprites[0].getBoundingBox();cc.rectContainsPoint(r,pos)&&(this.m_data.is_complete?this.m_data.is_bonus_complete?(this.m_btn_sprites[0].setVisible(!1),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!0)):(this.m_btn_sprites[0].setVisible(!1),this.m_btn_sprites[1].setVisible(!0),this.m_btn_sprites[2].setVisible(!1)):(this.m_btn_sprites[0].setVisible(!1),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!0)))},unhighlightPosInCell:function(pos){var r=this.m_btn_sprites[0].getBoundingBox();cc.rectContainsPoint(r,pos)&&(this.m_data.is_complete?this.m_data.is_bonus_complete?(this.m_btn_sprites[0].setVisible(!1),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!0)):(this.m_btn_sprites[0].setVisible(!0),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!1)):(this.m_btn_sprites[0].setVisible(!1),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!0)))},touchPosInCell:function(pos){var r=this.m_btn_sprites[0].getBoundingBox();cc.rectContainsPoint(r,pos)&&this.m_data.is_complete&&!this.m_data.is_bonus_complete&&null!=this.m_callback&&this.m_callback(this.m_data)}}),TAB_NEW_ICON_TAG=98373,SUBTRACT_END_DATE=259200,EventDungeonAchievementLayer_V2=cc.Layer.extend({m_tableView:null,m_current_event_dungeon_period_idx:0,m_all_bonus_btn:null,m_achv_list:[],m_tab_btns:[],ctor:function(){this._super(),this.m_achv_list=[],this.m_tab_btns=[],this.init()},init:function(){var winSize=ccSize(this),context=BattleContext._getInstance(),m=MasterManager.getInstance(),service=EventDungeonService.getInstance(),event_dungeon_period_idx=context.getEventDungeonPeriodIdx();this.m_period=m.get_EventDungeonPeriod(event_dungeon_period_idx);var first_period_idx=service.getEventDungeonFirstHalfPeriodIdx(this.m_period.event_dungeon_group_idx),second_period_idx=service.getEventDungeonSecondHalfPeriodIdx(this.m_period.event_dungeon_group_idx),bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));bg_box.setPreferredSize(cc.size(958,515)),bg_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bg_box.setPosition(.5*winSize.width,0),this.addChild(bg_box);var btn,new_icon,boxSize=ccSize(bg_box),is_second=service.IsOpenDungeon(second_period_idx),offset_x=17;((btn=new LabelButton("btn_07_none.png","btn_07_on.png","btn_07_off.png",ccui.Widget.PLIST_TEXTURE)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn.setFont(LABEL_FONT_INDEX.FONT_241),is_second?btn.setString(res_str("btn_label_event_achievement_1st")):btn.setString(res_str("btn_label_event_achievement")),btn.setPosition(offset_x,boxSize.height),btn.setTag(first_period_idx),bg_box.addChild(btn),btn.addClickEventListener(function(sender){this.changeTab(first_period_idx)}.bind(this)),(new_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png")).setAnchorPoint(ANCHOR_MIDDLE()),new_icon.setPosition(ccWidth(btn)-15,ccHeight(btn)-7),new_icon.setTag(TAB_NEW_ICON_TAG),btn.addChild(new_icon),new_icon.setVisible(service.IsEnableGainEventDungeonAchvReward(first_period_idx)),this.m_tab_btns.push(btn),offset_x+=ccWidth(btn),service.IsOpenDungeon(second_period_idx))&&((btn=new LabelButton("btn_07_none.png","btn_07_on.png","btn_07_off.png",ccui.Widget.PLIST_TEXTURE)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn.setFont(LABEL_FONT_INDEX.FONT_241),btn.setString(res_str("btn_label_event_achievement_3rd")),btn.setPosition(offset_x,boxSize.height),btn.setTag(second_period_idx),bg_box.addChild(btn),btn.addClickEventListener(function(sender){this.changeTab(second_period_idx)}.bind(this)),(new_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png")).setAnchorPoint(ANCHOR_MIDDLE()),new_icon.setPosition(ccWidth(btn)-15,ccHeight(btn)-7),new_icon.setTag(TAB_NEW_ICON_TAG),btn.addChild(new_icon),new_icon.setVisible(service.IsEnableGainEventDungeonAchvReward(second_period_idx)),this.m_tab_btns.push(btn));var tSize=cc.size(924,432);this.m_tableView=new cc.TableView(this,tSize),this.m_tableView.scrollBarEnable(!0),this.m_tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_tableView.setPosition(17,58),bg_box.addChild(this.m_tableView),this.m_tableView.setDelegate(this);var info_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_friend/img_friend_text.png");info_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),info_icon.setPosition(311,17),bg_box.addChild(info_icon);var info_str=this.getEventEndDateString(),info_text=cmLabel.getLabel(info_str,LABEL_FONT_INDEX.FONT_1613);return info_text.setAnchorPoint(ZERO()),info_text.setPosition(ccPosX(info_icon)+ccWidth(info_icon),24),bg_box.addChild(info_text),this.m_all_bonus_btn=new LabelButton("btn_11_off.png","btn_11_on.png","btn_11_none.png",ccui.Widget.PLIST_TEXTURE),this.m_all_bonus_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_all_bonus_btn.setPosition(boxSize.width-17,18),this.m_all_bonus_btn.setFont(LABEL_FONT_INDEX.FONT_201),this.m_all_bonus_btn.setString(res_str("btn_label_all_accept")),this.m_all_bonus_btn.addClickEventListener(function(sender){this.reqEventDungeonAchvRecvAll()}.bind(this)),bg_box.addChild(this.m_all_bonus_btn),this.changeTab(first_period_idx),!0},onEnter:function(){this._super()},onExit:function(){this._super()},cellSizeForTable:function(table){return cc.size(924,94)},tableCellSizeForIndex:function(){return cc.size(924,94)},numberOfCellsInTableView:function(table){return this.m_achv_list.length},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;cell=null!=c?c:new EventDungeonAchvListItemCell_V2(this.choiceAchievement.bind(this));var data=this.m_achv_list[idx];return cell.setUserEventDungeonAchvData(data),cell},tableCellEnded:function(table){},scrollViewDidScroll:function(view){},scrollViewDidZoom:function(view){},tableCellTouched:function(table,cell){null!=cell&&cell.touchPosInCell(cell.getTouchPos())},tableCellHighlight:function(table,cell){null!=cell&&cell.highlightPosInCell(cell.getTouchPos())},tableCellUnhighlight:function(table,cell){null!=cell&&cell.unhighlightPosInCell(cell.getTouchPos())},choiceAchievement:function(data){data.is_complete&&(data.is_bonus_complete||this.reqEventDungeonAchvRecv(data))},reqEventDungeonAchvRecv:function(data){var req={};req.opcode=net.OP.op_user_event_dungeon_achv_bonus_recv,req.event_dungeon_achv_list_idx=data.event_dungeon_achv_list_idx,req.event_dungeon_period_idx=data.event_dungeon_period_idx,SceneManager.getInstance().getRunningScene().network_write(req)},reqEventDungeonAchvRecvAll:function(){if(0!=this.m_current_event_dungeon_period_idx){var req={};req.opcode=net.OP.op_user_event_dungeon_achv_bonus_recv_all,req.event_dungeon_period_idx=this.m_current_event_dungeon_period_idx,SceneManager.getInstance().getRunningScene().network_write(req)}},changeTab:function(event_dungeon_period_idx){for(var service=EventDungeonService.getInstance(),i=0;i<this.m_tab_btns.length;i++){var btn=this.m_tab_btns[i],tag=btn.getTag();if(btn.setEnabled(tag!=event_dungeon_period_idx),tag==event_dungeon_period_idx){var new_icon=btn.getChildByTag(TAB_NEW_ICON_TAG);null!=new_icon&&new_icon.setVisible(service.IsEnableGainEventDungeonAchvReward(event_dungeon_period_idx))}}this.m_current_event_dungeon_period_idx=event_dungeon_period_idx,this.m_achv_list=service.getUserEventDungeonAchvList(event_dungeon_period_idx),this.m_tableView.reloadData(),this.m_all_bonus_btn.setEnabled(service.IsEnableGainEventDungeonAchvReward(event_dungeon_period_idx))},getEventEndDateString:function(){var end_dt=moment(this.m_period.end_dt);return"※期間限定："+((end_dt=end_dt.add(-SUBTRACT_END_DATE,"s")).get("month")+1)+"月"+end_dt.get("date")+"日メンテナンス前まで。"},refreshEventDungeonAchvList:function(){this.changeTab(this.m_current_event_dungeon_period_idx)}}),EventDungeonAchievementScene_V2=GameScene.extend({m_achievementLayer:null,m_statusLayer:null,ctor:function(){this._super(scene_EventDungeonAchievementScene_V2)},init:function(){var bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub.png");bg.setPosition(ccCenter(this)),USE_SP_COMMON_SUB_BG_SCALE&&bg.setScale(2),this.addChild(bg);var m=MasterManager.getInstance(),context=BattleContext._getInstance(),event_dungeon_period_idx=0;event_dungeon_period_idx=context.getIsPrvEventDungeon()?context.getPrvEventDungeonPeriodIdx():context.getEventDungeonPeriodIdx();m.get_EventDungeonPeriod(event_dungeon_period_idx);this.m_achievementLayer=new EventDungeonAchievementLayer_V2,this.addChild(this.m_achievementLayer),this.m_statusLayer=new StatusLayer,this.m_statusLayer.initLayout(),this.m_statusLayer.ignoreAnchorPointForPosition(!1),this.m_statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(this.m_statusLayer);var title=cc.Sprite.create(RES_CDN_DEFULT+"menu_achievement/img_achievement_text_achievement.png");title.setAnchorPoint(ZERO()),title.setPosition(90,585),this.addChild(title);var back_btn=new ccui.Button("btn_home_off.png","btn_home_on.png","",ccui.Widget.PLIST_TEXTURE);return back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(10,559),back_btn.addClickEventListener(function(){this.back()}.bind(this)),this.addChild(back_btn),!0},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_EventDungeonAchievementScene_V2])},onExit:function(){this._super(),MainObserver.getInstance().removeObserver(sceneStr[scene_EventDungeonAchievementScene_V2]),null!=this.m_statusLayer&&(this.removeChild(this.m_statusLayer),this.m_statusLayer=null)},onEnterTransitionDidFinish:function(){this._super()},onNotification:function(msg){this._super(msg)},onNetworkEvent:function(opcode,state,body){this._super(opcode,state,body),opcode==net.OP.op_user_event_dungeon_achv_bonus_recv?this.m_achievementLayer.refreshEventDungeonAchvList():opcode==net.OP.op_user_event_dungeon_achv_bonus_recv_all&&this.m_achievementLayer.refreshEventDungeonAchvList()},back:function(){this.onKeyBack(!0)},setTabEventDungeonPeriodIdx:function(event_dungeon_period_idx){this.m_achievementLayer.changeTab(event_dungeon_period_idx)}}),EventDungeonListCell=cc.TableViewCell.extend({m_select_box:null,m_highlight:null,m_disable_cover:null,m_dungeon_name:null,m_cell_bg:null,m_data:[],ctor:function(){this._super(),this.m_data=[],this.init()},init:function(){var cellSize=cc.size(444,140);this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(cellSize),cc.log(cellSize);var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();USE_SP_EVENT_SCALE?(this.m_cell_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_"+event_dungeon_period_idx+"/img_eventvs_list_01.png"),this.m_cell_bg.setScale(2),this.m_cell_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_cell_bg.setPosition(ccCenter(cellSize)),this.addChild(this.m_cell_bg),this.m_dungeon_name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2615),this.m_dungeon_name.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_dungeon_name.setPosition(cellSize.width-10,20),this.addChild(this.m_dungeon_name)):(this.m_cell_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs_"+event_dungeon_period_idx+"/img_eventvs_list_01.png"),this.m_cell_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_cell_bg.setPosition(ccCenter(cellSize)),this.addChild(this.m_cell_bg),this.m_dungeon_name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2615),this.m_dungeon_name.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_dungeon_name.setPosition(cellSize.width-10,20),this.m_cell_bg.addChild(this.m_dungeon_name)),this.m_disable_cover=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero()),this.m_disable_cover.setAnchorPoint(ANCHOR_MIDDLE()),this.m_disable_cover.setPreferredSize(cellSize),this.m_disable_cover.setPosition(ccCenter(cellSize)),this.addChild(this.m_disable_cover),this.m_disable_cover.setVisible(!1);var lock=cc.Sprite.create(RES_CDN_DEFULT+"common/img_list_lock.png");return IS_SP_BROWSER&&lock.setScale(2),lock.setAnchorPoint(ANCHOR_MIDDLE()),lock.setPosition(ccCenter(this.m_disable_cover)),this.m_disable_cover.addChild(lock),this.m_highlight=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_1.png",cc.Rect(20,20,20,20)),this.m_highlight.setAnchorPoint(ANCHOR_MIDDLE()),this.m_highlight.setPosition(ccCenter(cellSize)),this.m_highlight.setPreferredSize(cellSize),this.m_highlight.setVisible(!1),this.addChild(this.m_highlight),this.m_select_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_2.png",cc.Rect(20,20,20,20)),this.m_select_box.setAnchorPoint(ANCHOR_MIDDLE()),this.m_select_box.setPosition(ccCenter(cellSize)),this.m_select_box.setPreferredSize(cellSize),this.m_select_box.setVisible(!1),this.addChild(this.m_select_box),!0},setData:function(data){this.m_data=data,this.updateCell()},unSelected:function(){this.m_select_box.setVisible(!1),this.m_highlight.setVisible(!1)},updateCell:function(){cc.size(this);if(this.m_data.event_dungeon.event_dungeon_idx==PRESENT_DUNGEON_IDX?this.m_cell_bg.setTexture(RES_CDN_DEFULT+"menu_eventvs_"+this.m_data.event_dungeon_period.event_dungeon_period_idx+"/img_eventvs_list_present.png"):this.m_cell_bg.setTexture(RES_CDN_DEFULT+"menu_eventvs_"+this.m_data.event_dungeon_period.event_dungeon_period_idx+"/img_eventvs_list_"+leadingZeros(this.m_data.event_dungeon.bg_type,2)+".png"),this.m_dungeon_name.setString(this.m_data.event_dungeon.name),cmLabel.autoSizeFit(this.m_dungeon_name,430,20),this.m_select_box.setVisible(this.m_data.is_selected),this.m_highlight.setVisible(this.m_data.is_selected),this.m_data.is_selected&&this.selectedAnimation(),this.m_data.is_open_pre_event_dungeon){var now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),b=this.m_data.event_dungeon_period.begin_date.valueOf(),e=this.m_data.event_dungeon_period.end_date.valueOf();b<=n?n<=e&&(this.m_data.is_enable=!0):this.m_data.is_enable=!1,this.m_disable_cover.setVisible(!this.m_data.is_enable)}else this.m_disable_cover.setVisible(!0)},selectedAnimation:function(){this.m_select_box.stopAllActions();var fadeout=cc.fadeOut(1),fadein=cc.fadeIn(1),seq=cc.sequence(fadeout,fadein),repeat=cc.repeatForever(seq);this.m_select_box.runAction(repeat)},unhighlightPosInCell:function(pos){}});