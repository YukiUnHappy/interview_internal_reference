var SHORTCUTS_TYPE_MISSION=1,SHORTCUTS_TYPE_WEEK=2,SHORTCUTS_TYPE_EVENT_DUNGEON_1=3,SHORTCUTS_TYPE_SHOP=4,SHORTCUTS_TYPE_EVENT_DUNGEON_2=5,SHORTCUTS_TYPE_MUSSANG_ROAD=6,SHORTCUTS_TYPE_NONE=0,NOT_OPEN_WORLD_WAR=1,NOT_OPEN_RAID_BOSS=2,ShortcutsListItem=cc.Layer.extend({m_shortcuts:null,m_sceneId:0,ctor:function(){this._super()},onExit:function(){this._super()},onEnter:function(){this._super()},initLayout:function(shortcuts,sceneId){this.m_shortcuts=shortcuts,this.m_sceneId=sceneId;var bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());bg_box.setContentSize(596,78),bg_box.setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),this.addChild(bg_box),this.setContentSize(ccSize(bg_box));var content_label=cmLabel.getLabel(shortcuts.content,LABEL_FONT_INDEX.FONT_2013);if(content_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),content_label.setPosition(22,ccCenter(bg_box).y),bg_box.addChild(content_label),shortcuts.shortcuts_type==SHORTCUTS_TYPE_NONE)return!0;var is_mission_open=!0,btn=new LabelButton("btn_05_off.png","btn_05_on.png","",ccui.Widget.PLIST_TEXTURE);btn.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),btn.setFont(LABEL_FONT_INDEX.FONT_241),btn.setString("移動"),btn.setPosition(472,ccCenter(bg_box).y),this.addChild(btn);var openBtn=function(){btn&&(btn.loadTextures("btn_04_off.png","btn_04_on.png","",ccui.Widget.PLIST_TEXTURE),btn.setString("未クリア"))}.bind(this);if(shortcuts.shortcuts_type==SHORTCUTS_TYPE_MISSION){var open=MissionService.getInstance().IsOpenMainMission(shortcuts.shortcuts_id);is_mission_open=!0,open||(is_mission_open=!1,openBtn())}btn.addClickEventListener(function(sender){if(0!=is_mission_open){var layer=sender.getParent();if(layer.m_shortcuts.shortcuts_type==SHORTCUTS_TYPE_MISSION){var mission_id=layer.m_shortcuts.shortcuts_id,context=BattleContext._getInstance();context.setGameType(db.BattleGameType.Mission),context.setMissionID(mission_id),context.showNextMissionPopup(!0),SceneManager.getInstance().getRunningScene().initLayoutProgress();var scene=new StorySceneV2,sceneManager=SceneManager.getInstance();scene.get_story_deferred().done(function(){this.scheduleOnce(function(dt){YUNHEE_PREV_SCENE=!1,SHORTCUT_PREV_SCENE=!0,sceneManager.historyClearToScene(scene_MainHomeScene),sceneManager.replaceScene(scene,!1),scene=null},1.5,"main_layer_ready")}.bind(this))}else if(layer.m_shortcuts.shortcuts_type==SHORTCUTS_TYPE_WEEK){SceneManager.getInstance().getRunningScene().initLayoutProgress();scene=new WeeklyEntryScene,sceneManager=SceneManager.getInstance();scene.get_story_deferred().done(function(){this.scheduleOnce(function(dt){sceneManager.historyClearToScene(scene_MainHomeScene),sceneManager.replaceScene(scene,!1),scene=null},1.5,"main_layer_ready")}.bind(this))}else if(layer.m_shortcuts.shortcuts_type==SHORTCUTS_TYPE_SHOP)layer.m_shortcuts.shortcuts_id==SHOP_TYPE_YUNHEE_PT?MainObserver.getInstance().postNotification(sceneStr[this.m_sceneId],NOTIFY_MENU_SHOP_YUNHEE_POINT):layer.m_shortcuts.shortcuts_id==SHOP_TYPE_HEAVEN_PT&&MainObserver.getInstance().postNotification(sceneStr[this.m_sceneId],NOTIFY_MENU_SHOP_HEAVEN_PT);else if(layer.m_shortcuts.shortcuts_type==SHORTCUTS_TYPE_EVENT_DUNGEON_1){(sceneManager=SceneManager.getInstance()).reservedHistoryClearToScene(scene_MainHomeScene);var event_dungeon_period_idx=EventDungeonService.getInstance().getFirstEventDungeonPeriodIdx();if(0==event_dungeon_period_idx)return;BattleContext._getInstance().setEventDungeonPeriodIdX(event_dungeon_period_idx),MainObserver.getInstance().postNotification(NOTIFY_MENU_EVENT_DUNGEON_ENTRANCE)}else if(layer.m_shortcuts.shortcuts_type==SHORTCUTS_TYPE_MUSSANG_ROAD){(sceneManager=SceneManager.getInstance()).reservedHistoryClearToScene(scene_MainHomeScene),(req={}).opcode=net.OP.op_get_user_mussang;var mainScene=(sceneManager=SceneManager.getInstance()).getMainScene();GameClient().write(req,mainScene.onNetworkEvent,mainScene)}else if(layer.m_shortcuts.shortcuts_type==SHORTCUTS_TYPE_WORLDWAR){if((sceneManager=SceneManager.getInstance()).reservedHistoryClearToScene(scene_MainHomeScene),WorldWarService.getInstance().CheckWorldWarPeriod())this.scheduleOnce(function(dt){MainObserver.getInstance().postNotification(NOT_OPEN_WORLD_WAR)},0,"NOT_OPEN_WORLD_WAR");else{var req;(req={}).opcode=net.OP.op_get_world_war_season_info;mainScene=(sceneManager=SceneManager.getInstance()).getMainScene();GameClient().write(req,mainScene.onNetworkEvent,mainScene)}}else if(layer.m_shortcuts.shortcuts_type==SHORTCUTS_TYPE_RAIDBOSS){sceneManager=SceneManager.getInstance();RaidBossService.getInstance().IsOpenRaidBoss()?(sceneManager.reservedHistoryClearToScene(scene_MainHomeScene),MainObserver.getInstance().postNotification(NOTIFY_MENU_RAID_BOSS_ENTRANCE)):this.scheduleOnce(function(dt){MainObserver.getInstance().postNotification(NOT_OPEN_RAID_BOSS)},0,"NOT_OPEN_RAID_BOSS")}}else MainObserver.getInstance().postNotification(sceneStr[this.m_sceneId],NOTIFY_MENU_NOT_OPEN_SHORTCUTS)}.bind(this))}}),ShortcutsLayer=cmModalLayer.extend({m_shortcuts_list:null,m_touch_Layer:null,ctor:function(){this._super(),this.m_shortcuts_list=[]},setShortcutsInfo:function(shortcuts_list){this.m_shortcuts_list=shortcuts_list},initLayout:function(){var mask_bg=cc.Sprite.create(RES_CDN_DEFULT+"common/img_mask.png");mask_bg.setAnchorPoint(ANCHOR_MIDDLE()),mask_bg.setPosition(ccCenter(this)),this.addChild(mask_bg,-100),this.m_touch_Layer=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE}),this.m_touch_Layer.onTouchBegan=function(touch,event){event.stopPropagation()}.bind(this);var mouse_listener=cc.EventListener.create({event:cc.EventListener.MOUSE,onMouseScroll:function(event){event.stopPropagation()}.bind(this)});cc.eventManager.addListener(mouse_listener,mask_bg),cc.eventManager.addListener(this.m_touch_Layer,mask_bg);var bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,40,40));bg_box.setContentSize(630,440),bg_box.setPosition(ccCenter(this)),this.addChild(bg_box);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_3.png");navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(bg_box).x,ccHeight(bg_box)-11),bg_box.addChild(navi);var title_label=cmLabel.getLabel("獲得情報",LABEL_FONT_INDEX.FONT_261);title_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),title_label.setPosition(ccCenter(navi).x,16),navi.addChild(title_label);var bonus_type=this.m_shortcuts_list[0].bonus_type,img_name=this.bonusToImgName(bonus_type),icon=cc.Sprite.create(img_name);icon.setAnchorPoint(ZERO()),icon.setPosition(40,293),bg_box.addChild(icon);var mt_bonus_type=MasterManager.getInstance().get_BonusType(bonus_type),item_name=cmLabel.getLabel(mt_bonus_type.name,LABEL_FONT_INDEX.FONT_241);item_name.setAnchorPoint(ZERO()),item_name.setPosition(127,335),bg_box.addChild(item_name);var user_reserve_count=this.getUserReserveCount(bonus_type),user_count_label=cmLabel.getLabel("保有 "+Number(user_reserve_count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_247);user_count_label.setAnchorPoint(ZERO()),user_count_label.setPosition(127,306),bg_box.addChild(user_count_label);var listLayer=this.getListLayer();listLayer.setPosition(17,17),bg_box.addChild(listLayer);var back_btn=new ccui.Button;back_btn.loadTextures("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE),back_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),back_btn.setPosition(ccWidth(navi)-11,7),back_btn.addClickEventListener(function(sender){this.scheduleOnce(function(float){this.hide()},0,"back_btn")}.bind(this)),navi.addChild(back_btn)},getListLayer:function(){var listLayer=new VListLayer;return listLayer.setAnimationType(kListAnimationNone),listLayer.setContentSize(596,261),listLayer.setItemCount(this.m_shortcuts_list.length),listLayer.getItemNode=function(index,contentSize,m){var shortcuts=this.m_shortcuts_list[index],layer=new ShortcutsListItem;return layer.initLayout(shortcuts,this.getParent().m_sceneId),layer}.bind(this),listLayer.onItemTouchMoved=function(isScroll){return!0},listLayer.initLayout(),listLayer},getUserReserveCount:function(bonus_type){var gs=GeneralService.getInstance();if(bonus_type==BONUS_TYPE_HWANDAN_1||bonus_type==BONUS_TYPE_HWANDAN_2||bonus_type==BONUS_TYPE_HWANDAN_3||bonus_type==BONUS_TYPE_HWANDAN_4||bonus_type==BONUS_TYPE_HWANDAN_5||bonus_type==BONUS_TYPE_HWANDAN_6||bonus_type==BONUS_TYPE_YUBI_RARE){var class_type=BONUS_TYPE_HWANDAN_1;return bonus_type==BONUS_TYPE_HWANDAN_1?class_type=HWANDAN_CLASS_1:bonus_type==BONUS_TYPE_HWANDAN_2?class_type=HWANDAN_CLASS_2:bonus_type==BONUS_TYPE_HWANDAN_3?class_type=HWANDAN_CLASS_3:bonus_type==BONUS_TYPE_HWANDAN_4?class_type=HWANDAN_CLASS_4:bonus_type==BONUS_TYPE_HWANDAN_5?class_type=HWANDAN_CLASS_5:bonus_type==BONUS_TYPE_HWANDAN_6?class_type=HWANDAN_CLASS_6:bonus_type==BONUS_TYPE_YUBI_RARE&&(class_type=HWANDAN_CLASS_YUBI),GeneralService.getInstance().getUserHwandanInfo(class_type,{}).hwandan_count}if(bonus_type==BONUS_TYPE_EVOLVE_MELEE||bonus_type==BONUS_TYPE_EVOLVE_LANCER||bonus_type==BONUS_TYPE_EVOLVE_ARCHER||bonus_type==BONUS_TYPE_EVOLVE_MELEE_MIDDLE||bonus_type==BONUS_TYPE_EVOLVE_LANCER_MIDDLE||bonus_type==BONUS_TYPE_EVOLVE_ARCHER_MIDDLE||bonus_type==BONUS_TYPE_EVOLVE_MELEE_LOW||bonus_type==BONUS_TYPE_EVOLVE_LANCER_LOW||bonus_type==BONUS_TYPE_EVOLVE_ARCHER_LOW||bonus_type==BONUS_TYPE_YUBI_EVOLVE_HIGH||bonus_type==BONUS_TYPE_YUBI_EVOLVE_MIDDLE||bonus_type==BONUS_TYPE_YUBI_EVOLVE_LOW){var evolve_type=(gs=GeneralService.getInstance()).getBonusTypeToEvolveType(bonus_type);return gs.getUserEvolveArmServiceMtrlInfo(evolve_type).mtrl_count}if(bonus_type==BONUS_TYPE_ATTK_POINT||bonus_type==BONUS_TYPE_DEF_POINT||bonus_type==BONUS_TYPE_HP_POINT||bonus_type==BONUS_TYPE_CRI_PRCNT_POINT||bonus_type==BONUS_TYPE_CRI_DMG_POINT){gs=GeneralService.getInstance();var propertyPointInfo=UserService.getInstance().getUserFormationPropertyPointInfo(),property_type=gs.getBonusTypeToPropertyType(bonus_type);if(property_type==FORMATION_PROPERTY_TYPE_ATTK)return propertyPointInfo.attk_pt;if(property_type==FORMATION_PROPERTY_TYPE_DEF)return propertyPointInfo.def_pt;if(property_type==FORMATION_PROPERTY_TYPE_HP)return propertyPointInfo.hp_pt;if(property_type==FORMATION_PROPERTY_TYPE_CRI_PRCNT)return propertyPointInfo.cri_prcnt_pt;if(property_type==FORMATION_PROPERTY_TYPE_CRI_DMG)return propertyPointInfo.cri_dmg_pt}else{if(bonus_type==BONUS_TYPE_EVOLVE_ORB)return NetService().get_User_Evolve_Orb();if(bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL){var mtrl_type=gs.getBonusTypeToLimitOverMtrlType(bonus_type);return NetService().getUserLimitOverMtrlCount(mtrl_type)}if(bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL)return NetService().getMagicKeyCount();if(bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){var rebirth_mtrl_type=gs.getBonusTypeToRebirthMtrlType(bonus_type),rebirth_mtrl=NetService().get_User_Rebirth_Mtrl_Info(rebirth_mtrl_type);return null!=rebirth_mtrl.mtrl_count&&null!=rebirth_mtrl.mtrl_count||(rebirth_mtrl.mtrl_count=0),rebirth_mtrl.mtrl_count}if(bonus_type==BONUS_TYPE_JADE_PIECE)return NetService().getJadePieceCount()}return 0},bonusToImgName:function(bonus_type){var gs=GeneralService.getInstance();if(bonus_type==BONUS_TYPE_YUBI_RARE)return"#img_hwandan_"+HWANDAN_CLASS_YUBI+".png";if(bonus_type==BONUS_TYPE_EVOLVE_MELEE||bonus_type==BONUS_TYPE_EVOLVE_LANCER||bonus_type==BONUS_TYPE_EVOLVE_ARCHER||bonus_type==BONUS_TYPE_EVOLVE_MELEE_MIDDLE||bonus_type==BONUS_TYPE_EVOLVE_LANCER_MIDDLE||bonus_type==BONUS_TYPE_EVOLVE_ARCHER_MIDDLE||bonus_type==BONUS_TYPE_EVOLVE_MELEE_LOW||bonus_type==BONUS_TYPE_EVOLVE_LANCER_LOW||bonus_type==BONUS_TYPE_EVOLVE_ARCHER_LOW||bonus_type==BONUS_TYPE_YUBI_EVOLVE_LOW||bonus_type==BONUS_TYPE_YUBI_EVOLVE_MIDDLE||bonus_type==BONUS_TYPE_YUBI_EVOLVE_HIGH){var evolve_type=gs.getBonusTypeToEvolveType(bonus_type);return"#img_evolve_"+gs.geEvolveTypeToArmServiceType(evolve_type)+"_"+(class_type=gs.geEvolveTypeToArmServiceClassType(evolve_type))+".png"}if(bonus_type==BONUS_TYPE_ATTK_POINT||bonus_type==BONUS_TYPE_DEF_POINT||bonus_type==BONUS_TYPE_HP_POINT||bonus_type==BONUS_TYPE_CRI_PRCNT_POINT||bonus_type==BONUS_TYPE_CRI_DMG_POINT){var property_type=gs.getBonusTypeToPropertyType(bonus_type);return"#img_formation_m_"+leadingZeros(property_type,2)+".png"}if(bonus_type==BONUS_TYPE_EVOLVE_ORB)return"#img_orb.png";if(bonus_type==BONUS_TYPE_HWANDAN_1||bonus_type==BONUS_TYPE_HWANDAN_2||bonus_type==BONUS_TYPE_HWANDAN_3||bonus_type==BONUS_TYPE_HWANDAN_4||bonus_type==BONUS_TYPE_HWANDAN_5||bonus_type==BONUS_TYPE_HWANDAN_6||bonus_type==BONUS_TYPE_YUBI_RARE){var class_type=0;return bonus_type==BONUS_TYPE_HWANDAN_1?class_type=HWANDAN_CLASS_1:bonus_type==BONUS_TYPE_HWANDAN_2?class_type=HWANDAN_CLASS_2:bonus_type==BONUS_TYPE_HWANDAN_3?class_type=HWANDAN_CLASS_3:bonus_type==BONUS_TYPE_HWANDAN_4?class_type=HWANDAN_CLASS_4:bonus_type==BONUS_TYPE_HWANDAN_5?class_type=HWANDAN_CLASS_5:bonus_type==BONUS_TYPE_HWANDAN_6?class_type=HWANDAN_CLASS_6:bonus_type==BONUS_TYPE_YUBI_RARE&&(class_type=HWANDAN_CLASS_YUBI),"#img_hwandan_"+class_type+".png"}if(bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL)return"#img_limit_"+gs.getBonusTypeToLimitOverMtrlType(bonus_type)+".png";if(bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL)return"#img_magic_key_mtrl.png";if(bonus_type!=BONUS_TYPE_REBIRTH_MTRL_TYPE_1&&bonus_type!=BONUS_TYPE_REBIRTH_MTRL_TYPE_2&&bonus_type!=BONUS_TYPE_REBIRTH_MTRL_TYPE_3&&bonus_type!=BONUS_TYPE_REBIRTH_MTRL_TYPE_4&&bonus_type!=BONUS_TYPE_REBIRTH_MTRL_TYPE_5&&bonus_type!=BONUS_TYPE_REBIRTH_MTRL_TYPE_6&&bonus_type!=BONUS_TYPE_REBIRTH_MTRL_TYPE_7&&bonus_type!=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1&&bonus_type!=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2&&bonus_type!=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3&&bonus_type!=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4&&bonus_type!=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5&&bonus_type!=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6)return bonus_type==BONUS_TYPE_JADE_PIECE?"#img_jade.png":"";var rebirth_mtrl_type=gs.getBonusTypeToRebirthMtrlType(bonus_type);return USE_SHORTCUT_EVOLUTION_ICON?"#rebirth_small_"+rebirth_mtrl_type+".png":RES_CDN_DEFULT+"icon/rebirth_small/"+rebirth_mtrl_type+".png"}}),YunheeCharacterItem=cc.Layer.extend({m_yunheeIcon:null,m_selectIcon:null,m_selected:!1,ctor:function(index,gnrl_id){this._super(),this.initLayout(index,gnrl_id)},initLayout:function(index,gnrl_id){return this.getYunheeIcon(index,gnrl_id),this.setContentSize(ccWidth(this.m_yunheeIcon)+30,ccHeight(this.m_yunheeIcon)),!0},getYunheeIcon:function(index,gnrl_id){this.m_yunheeIcon=cc.Sprite.create(),this.m_yunheeIcon.setContentSize(98,98),this.m_yunheeIcon.setAnchorPoint(ZERO()),this.m_yunheeIcon.setPosition(15,0),this.addChild(this.m_yunheeIcon);var gnrl=MasterManager.getInstance().get_General(gnrl_id);if(IS_SP_BROWSER){var card=cc.Sprite.create(RES_CDN_CARD_MEDIUM_NTP+"m_"+gnrl.gnrl_id+".png");DISABLE_SPB_TP&&card.setContentSize(48,48),card.setAnchorPoint(ANCHOR_MIDDLE()),card.setPosition(ccCenter(this.m_yunheeIcon)),card.setScale(2),this.m_yunheeIcon.addChild(card);var rare_bg=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_frame_"+gnrl.element_type+"_"+gnrl.rare_type+".png");if(DISABLE_SPB_TP&&rare_bg.setContentSize(98,98),rare_bg.setAnchorPoint(ANCHOR_MIDDLE()),rare_bg.setPosition(25,25),rare_bg.setScale(.5),card.addChild(rare_bg),gnrl.arm_service_type!=ARMSERVICETYPE_NONE){var arm_service_img=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_arm_service_"+gnrl.element_type+"_"+gnrl.arm_service_type+".png");DISABLE_SPB_TP&&arm_service_img.setContentSize(38,37),arm_service_img.setAnchorPoint(ZERO()),arm_service_img.setPosition(0,61),arm_service_img.setScale(1),rare_bg.addChild(arm_service_img)}if(1<gnrl.gnrl_class){(rare_type=gnrl.rare_type)<=2&&(rare_type=1);var star_unique=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_unique_"+rare_type+"_"+gnrl.gnrl_class+".png");DISABLE_SPB_TP&&star_unique.setContentSize(28,16),star_unique.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),star_unique.setPosition(ccWidth(rare_bg),28),DISABLE_SPB_TP||star_unique.setScale(.5),rare_bg.addChild(star_unique)}this.m_selectIcon=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_check.png"),this.m_selectIcon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_selectIcon.setPosition(ccCenter(this.m_yunheeIcon)),this.m_yunheeIcon.addChild(this.m_selectIcon),this.m_selectIcon.setVisible(!1)}else{card=cc.Sprite.create(RES_CDN_CARD_MEDIUM_NTP+"m_"+gnrl.gnrl_id+".png");DISABLE_SPB_TP&&card.setContentSize(98,98),card.setAnchorPoint(ANCHOR_MIDDLE()),card.setPosition(ccCenter(this.m_yunheeIcon)),this.m_yunheeIcon.addChild(card);rare_bg=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_frame_"+gnrl.element_type+"_"+gnrl.rare_type+".png");if(DISABLE_SPB_TP&&rare_bg.setContentSize(98,98),rare_bg.setAnchorPoint(ANCHOR_MIDDLE()),rare_bg.setPosition(49,49),card.addChild(rare_bg),gnrl.arm_service_type!=ARMSERVICETYPE_NONE){arm_service_img=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_arm_service_"+gnrl.element_type+"_"+gnrl.arm_service_type+".png");DISABLE_SPB_TP&&arm_service_img.setContentSize(38,37),arm_service_img.setAnchorPoint(ZERO()),arm_service_img.setPosition(0,61),rare_bg.addChild(arm_service_img)}if(1<gnrl.gnrl_class){var rare_type;(rare_type=gnrl.rare_type)<=2&&(rare_type=1);star_unique=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_unique_"+rare_type+"_"+gnrl.gnrl_class+".png");DISABLE_SPB_TP&&star_unique.setContentSize(28,16),star_unique.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),star_unique.setPosition(ccWidth(rare_bg),28),rare_bg.addChild(star_unique)}this.m_selectIcon=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_check.png"),this.m_selectIcon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_selectIcon.setPosition(ccCenter(this.m_yunheeIcon)),this.m_yunheeIcon.addChild(this.m_selectIcon),this.m_selectIcon.setVisible(!1)}},setSelected:function(is_selected){this.m_selected!=is_selected&&(this.m_selected=is_selected,this.m_selectIcon.setVisible(is_selected))},getSelected:function(){return this.m_selected}}),MATERIAL_MASK=102,SELECT_BACKGROUND=100,SELECT_BLINK_BACKGROUND=101,YunheeEvolutionEnum={btn_evolve_start:500,btn_evolve_result_hide:501,btn_show_help:502,btn_limit_over_hide:504},EvolveMaterialItemLayer=cc.Layer.extend({m_card_sprite:null,m_selected_sprite:null,m_evolveGnrlInfo:null,m_mtrlInfo:null,m_mtrlButtons:[],ctor:function(){this._super()},initLayout:function(info){var cardInfo={},key={};key.gnrl_id=info.gnrl_id,key.gnrl_num=info.gnrl_num,cardInfo.gnrl_id=info.gnrl_id,cardInfo.level=info.gnrl_level;var bg=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame_2.png");bg.setContentSize(98,98),bg.setAnchorPoint(ZERO()),bg.setPosition(0,17),this.addChild(bg);var card=new Card;if(this.m_card_sprite=card.createCard(cardInfo,CARD_TYPE.type_common_card),this.m_card_sprite.setAnchorPoint(ANCHOR_MIDDLE()),this.m_card_sprite.setPosition(ccCenter(bg)),bg.addChild(this.m_card_sprite),this.m_selected_sprite=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero()),this.m_selected_sprite.setContentSize(ccSize(bg)),this.m_selected_sprite.setPosition(ccCenter(bg)),bg.addChild(this.m_selected_sprite),this.m_selected_sprite.setOpacity(0),0!=(this.m_info=info).slot_num||info.is_use){this.m_selected_sprite.setOpacity(255);var label=null;0!=info.slot_num?label=cmLabel.getLabel("slot",info.slot_num):info.is_use&&(label=cmLabel.getLabel("troops","")),null!=label&&(label.setAnchorPoint(ANCHOR_MIDDLE()),label.setPosition(ccCenter(this.m_card_sprite)),label.enableOutline(cc.color.BLACK,1),bg.addChild(label))}return this.setContentSize(bg.width+17,bg.height+17),!0},onClickBegin:function(){this.m_selected_sprite.setOpacity(255)},onClickEnd:function(){this.m_selected_sprite.setOpacity(0)},getGnrlInfo:function(){return this.m_info},getGnrlKey:function(){var key={};return key.gnrl_id=this.m_info.gnrl_id,key.gnrl_num=this.m_info.gnrl_num,key}}),YunheeEvolutionLayer=cc.Layer.extend({m_evolveNeedGold:0,m_slotIndex:0,m_leftBoxLayer:null,m_materialTableLayer:null,m_evolveNeedGoldLabel:null,m_evolve_btn_mask:null,m_evolve_btn:null,m_character_skeleton:null,m_characterImg:null,m_select_1:null,m_select_2:null,m_mtrlGnrlKeys:null,m_img_scale:1,m_deferred:$.Deferred(),m_lv_label:null,m_gnrl_img:null,m_right_state_img:null,m_right_cliper:null,m_stencil_node:null,m_rightBoxLayer:null,m_leftBottomLayer:null,m_mtrlLayer:null,m_evolve_mtrl:null,m_arrow_img:null,m_evolve_before:null,m_evolve_after:null,m_help_btn:null,ctor:function(){this._super(),this.m_gnrlKey={gnrl_id:0,gnrl_num:1},this.m_mtrlGnrlKeys=[],this.m_deferred=$.Deferred()},onExit:function(){if(this._super(),1!=this.getParent().getParent().getParent().getParent().m_isPopupShow){if(null!=this.m_gnrl_img){for(var idx=0;idx<this.m_gnrl_img.length;idx++)cc.loader.release(this.m_gnrl_img[idx]);this.m_gnrl_img=null}null!=this.m_character_skeleton&&(this.m_right_cliper.removeChild(this.m_character_skeleton),this.m_character_skeleton._skeleton.data.animations=[],this.m_character_skeleton._skeleton.data.bones=[],this.m_character_skeleton._skeleton.data.events=[],this.m_character_skeleton._skeleton.data.slots=[],this.m_character_skeleton._skeleton.data.skins=[],this.m_character_skeleton._skeleton.data=null,this.m_character_skeleton._spineComplete=null,this.m_character_skeleton.removeAllChildrenWithCleanup(!0),this.m_character_skeleton=null),null!=this.m_stencil_node&&(this.m_right_cliper.removeChild(this.m_stencil_node),this.m_stencil_node=null),null!=this.m_characterImg&&(this.m_right_cliper.removeChild(this.m_characterImg),this.m_characterImg=null),null!=this.m_right_cliper&&(this.m_rightBoxLayer.removeChild(this.m_right_cliper),this.m_right_cliper=null),null!=this.m_right_state_img&&(this.m_rightBoxLayer.removeChild(this.m_right_state_img),this.m_right_state_img=null),null!=this.m_help_btn&&(this.removeChild(this.m_help_btn),this.m_help_btn=null),null!=this.m_evolve_after&&(this.removeChild(this.m_evolve_after),this.m_evolve_after=null),null!=this.m_evolve_before&&(this.removeChild(this.m_evolve_before),this.m_evolve_before=null),null!=this.m_arrow_img&&(this.removeChild(this.m_arrow_img),this.m_arrow_img=null),null!=this.m_mtrlLayer&&(this.m_mtrlLayer.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_mtrlLayer),this.m_mtrlLayer=null),null!=this.m_rightBoxLayer&&(this.m_rightBoxLayer.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_rightBoxLayer),this.m_rightBoxLayer=null),null!=this.m_leftBottomLayer&&(this.m_leftBottomLayer.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_leftBottomLayer),this.m_leftBottomLayer=null),this.removeAllChildrenWithCleanup(!0)}},getEvolveNeedGold:function(){return this.m_evolveNeedGold},getEvolveMaterialList:function(){return this.m_mtrlGnrlKeys},getEvolveMaterialInfo:function(index){return this.findMtrlInfo(index)},initLayout:function(){this.m_leftBottomLayer=this.getLeftBottomLayer(),this.m_leftBottomLayer.ignoreAnchorPointForPosition(!1),this.m_leftBottomLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_leftBottomLayer.setPosition((this.width-478)/2,0),this.addChild(this.m_leftBottomLayer),this.m_rightBoxLayer=this.getRightBoxLayer(),this.m_rightBoxLayer.ignoreAnchorPointForPosition(!1),this.m_rightBoxLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_rightBoxLayer.setPosition(this.width/4*3,0),this.addChild(this.m_rightBoxLayer),this.m_mtrlLayer=this.getMaterialLayer(),this.m_mtrlLayer.ignoreAnchorPointForPosition(!1),this.m_mtrlLayer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_mtrlLayer.setPosition(this.width,88),this.addChild(this.m_mtrlLayer,2),this.m_evolve_mtrl=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_text_evolve_3.png"),this.m_evolve_mtrl.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_evolve_mtrl.setPosition(ccWidth(this)-ccWidth(this.m_mtrlLayer)-5,434),this.addChild(this.m_evolve_mtrl,2),this.m_arrow_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_arrow.png"),this.m_arrow_img.setAnchorPoint(ANCHOR_MIDDLE()),this.m_arrow_img.setPosition(ccCenter(this)),this.addChild(this.m_arrow_img,2),this.m_evolve_before=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_text_evolve_1.png"),this.m_evolve_before.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_evolve_before.setPosition((ccWidth(this)-478)/2,520),this.addChild(this.m_evolve_before,2),this.m_evolve_after=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_text_evolve_2.png"),this.m_evolve_after.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_evolve_after.setPosition(ccWidth(this)/4*3,520),this.addChild(this.m_evolve_after,2),this.m_help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_help_btn.loadTextures(),this.m_help_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_help_btn.setPosition(715,85),this.addChild(this.m_help_btn),this.m_help_btn.addClickEventListener(function(sender){this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeEvolutionEnum.btn_show_help)},0,"btn_show_help")}),this.checkEnableEvolution()},addMaterailGeneral:function(key){var found=this.findMtrlInfo(this.m_slotIndex);null!=found&&(found.isExist=!0);for(var b=0;b<this.m_mtrlButtons.length;b++){var mask=this.m_mtrlButtons[b].getChildByTag(MATERIAL_MASK),bg=this.m_mtrlButtons[b].getChildByTag(SELECT_BACKGROUND),blink=this.m_mtrlButtons[b].getChildByTag(SELECT_BLINK_BACKGROUND);blink.stopAllActions(),bg.setOpacity(0),blink.setOpacity(0),this.m_mtrlButtons[b].setEnabled(!0),this.m_mtrlButtons[b].getTag()==this.m_slotIndex&&mask.setOpacity(0);var slot_type=this.m_mtrlInfo.slot_type;if(this.m_mtrlButtons[b].getTag()==this.m_slotIndex&&slot_type==EVOLVE_MTRL_TYPE_CLASS_TYPE){var gnrl_key={};gnrl_key.gnrl_id=key.gnrl_id,gnrl_key.gnrl_num=key.gnrl_num;var g={};GeneralService.getInstance().getUserGeneralInfo(gnrl_key,g);var info={};info.gnrl_id=g.gnrl_id,info.level=g.gnrl_level;var sprite_on=(new Card).createCard(info,CARD_TYPE.type_evolve_mtrl),sprite_off=(new Card).createCard(info,CARD_TYPE.type_evolve_mtrl),btn_on_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());btn_on_mask.setContentSize(ccSize(sprite_on)),btn_on_mask.setAnchorPoint(ZERO()),btn_on_mask.setPosition(ZERO()),sprite_on.addChild(btn_on_mask),b.loadTexturePressed(sprite_on),b.loadTextureNormal(sprite_off)}}this.m_leftBoxLayer.runAction(new cc.MoveTo(.1,cc.p(-ccWidth(this.m_leftBoxLayer),0))),this.m_mtrlGnrlKeys[this.mtrl_info.slot_type]=key,this.checkEnableEvolution()},setReloadData:function(){this.m_lv_label.setString(cmString(res_str("label_level_max_level_2"),this.m_gnrlInfo.gnrl_level,this.m_gnrlInfo.max_level)),this.m_gnrlInfo.gnrl_level<this.m_gnrlInfo.max_level&&this.m_lv_label.setString(cmString(res_str("label_level_max_level_1"),this.m_gnrlInfo.gnrl_level,this.m_gnrlInfo.max_level)),this.checkEnableEvolution()},checkEnableEvolution:function(){for(var isEnabled=GeneralService.getInstance().isExistEvolutionMtrl(this.m_gnrlKey,this.m_gnrlInfo.evolution_mtrl_num),idx=0;idx<this.m_mtrlInfo.length;idx++)if(!this.m_mtrlInfo[idx].isExist){isEnabled=!1;break}if(isEnabled&&this.m_gnrlInfo.gnrl_level>=this.m_gnrlInfo.max_level){this.m_evolve_btn_mask.setVisible(!1),this.m_evolve_btn.setEnabled(!0),this.m_select_2.setOpacity(255);var fadeout=new cc.FadeOut(1),fadein=new cc.FadeIn(1),seq=new cc.Sequence(fadeout,fadein),repeat=new cc.RepeatForever(seq);this.m_select_2.runAction(repeat)}},setEvolveMaterialList:function(index,list){this.m_mtrlGnrlInfoList=list,null!=this.m_leftBoxLayer&&(this.m_leftBoxLayer.removeFromParent(),this.m_leftBoxLayer=null),this.m_leftBoxLayer=this.getLeftBoxLayer(),this.m_leftBoxLayer.setPosition(-ccWidth(this.m_leftBoxLayer.width),0),this.addChild(this.m_leftBoxLayer,10),this.m_leftBoxLayer.runAction(cc.MoveTo(.1,LP(this,0,0))),this.runSelectAction(index),this.m_slotIndex=index},runSelectAction:function(index){for(var idx=0;idx<this.m_mtrlButtons.length;idx++){var bg=this.m_mtrlButtons[idx].getChildByTag(SELECT_BACKGROUND),blink=this.m_mtrlButtons[idx].getChildByTag(SELECT_BLINK_BACKGROUND);if(b.getTag()==index){bg.setOpacity(255);var fadeIn=new cc.FadeIn(.5),fadeOut=new cc.FadeOut(.5),seq=new cc.Sequence(fadeIn,fadeOut),repeat=new cc.RepeatForever(seq);blink.runAction(repeat),b.setEnabled(!1)}else bg.setOpacity(0),blink.stopAllActions(),blink.setOpacity(0),b.setEnabled(!0)}},getLeftBottomLayer:function(){var layer=new cc.Layer;layer.setContentSize(ccWidth(this)-478,320);var level_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_namebox.png");level_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),level_box.setPosition(ccCenter(layer).x,82),layer.addChild(level_box),this.m_lv_label=cmLabel.getLabel("Lv. "+this.m_gnrlInfo.gnrl_level+" / "+this.m_gnrlInfo.max_level,LABEL_FONT_INDEX.FONT_201),this.m_gnrlInfo.gnrl_level<this.m_gnrlInfo.max_level&&this.m_lv_label.setString("Lv."+this.m_gnrlInfo.gnrl_level+" / "+this.m_gnrlInfo.max_level),this.m_lv_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_lv_label.setPosition(ccCenter(level_box).x,ccCenter(level_box).y+1),level_box.addChild(this.m_lv_label),this.m_lv_label.enableOutline(cc.color.BLACK,1);var cost_label=cmLabel.getLabel("cost "+this.m_gnrlInfo.cost,LABEL_FONT_INDEX.FONT_201);cost_label.setAnchorPoint(ANCHOR_MIDDLE_TOP()),cost_label.setPosition(ccCenter(level_box).x,ccCenter(level_box).y-1),level_box.addChild(cost_label);var class_type_star_path,rare_type_mark=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_unique_"+leadingZeros(this.m_gnrlInfo.rare_type,2)+".png");rare_type_mark.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),rare_type_mark.setPosition(ccCenter(layer).x,164),layer.addChild(rare_type_mark),this.m_gnrlInfo.rare_type==RARE_TYPE_N||this.m_gnrlInfo.rare_type==RARE_TYPE_HN?class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_n.png":this.m_gnrlInfo.rare_type==RARE_TYPE_R?class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_r.png":this.m_gnrlInfo.rare_type==RARE_TYPE_HR?class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_hr.png":this.m_gnrlInfo.rare_type==RARE_TYPE_SR?class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_s.png":this.m_gnrlInfo.rare_type==RARE_TYPE_SSR&&(class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_ss.png");for(var class_star_layer=new cc.Layer,i=1;i<this.m_gnrlInfo.class_type;++i){var class_type_star=cc.Sprite.create(class_type_star_path);class_type_star.setAnchorPoint(ZERO()),class_type_star.setPosition((i-1)*ccWidth(class_type_star),0),class_star_layer.addChild(class_type_star)}class_star_layer.setContentSize(28*(this.m_gnrlInfo.class_type-1),29),class_star_layer.ignoreAnchorPointForPosition(!1),class_star_layer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),class_star_layer.setPosition(ccCenter(layer).x,238),layer.addChild(class_star_layer),this.m_evolve_btn=new LabelButton("btn_03_off.png","btn_03_on.png","btn_03_off.png",ccui.Widget.PLIST_TEXTURE),this.m_evolve_btn.setFont(LABEL_FONT_INDEX.FONT_241),this.m_evolve_btn.setString("進化"),this.m_evolve_btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_evolve_btn.setPosition(ccCenter(layer).x,16),this.m_evolve_btn.setOffsetX(-110),layer.addChild(this.m_evolve_btn),this.m_evolve_btn.setEnabled(!1),this.m_evolve_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeEvolutionEnum.btn_evolve_start)}),this.m_select_1=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_1.png",RectZero()),this.m_select_1.setContentSize(444,60),this.m_select_1.setAnchorPoint(ANCHOR_MIDDLE()),this.m_select_1.setPosition(ccCenter(this.m_evolve_btn)),this.m_evolve_btn.addChild(this.m_select_1),this.m_select_1.setOpacity(0),this.m_select_2=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_2.png",RectZero()),this.m_select_2.setContentSize(444,60),this.m_select_2.setAnchorPoint(ANCHOR_MIDDLE()),this.m_select_2.setPosition(ccCenter(this.m_evolve_btn)),this.m_evolve_btn.addChild(this.m_select_2),this.m_select_2.setOpacity(0);var gold_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero());gold_box.setContentSize(123,38),gold_box.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),gold_box.setPosition(197,ccCenter(this.m_evolve_btn).y),this.m_evolve_btn.addChild(gold_box);var gold_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_sell_gold.png");return gold_icon.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),gold_icon.setPosition(180,ccCenter(this.m_evolve_btn).y),this.m_evolve_btn.addChild(gold_icon),this.m_evolveNeedGoldLabel=cmLabel.getLabel(Number(this.m_evolveNeedGold).toLocaleString("en"),LABEL_FONT_INDEX.FONT_2011),this.m_evolveNeedGoldLabel.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_evolveNeedGoldLabel.setPosition(ccWidth(gold_box)-10,ccCenter(gold_box).y),gold_box.addChild(this.m_evolveNeedGoldLabel),this.m_evolve_btn_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero()),this.m_evolve_btn_mask.setContentSize(ccSize(this.m_evolve_btn)),this.m_evolve_btn_mask.setAnchorPoint(ZERO()),this.m_evolve_btn_mask.setPosition(ZERO()),this.m_evolve_btn.addChild(this.m_evolve_btn_mask),NetService().get_UserItemInfo_V2().gold_cnt<this.m_evolveNeedGold&&this.m_evolveNeedGoldLabel.setColor(new cc.Color(245)),layer},getLeftBoxLayer:function(){var layer=new cc.Layer,right_bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));right_bg_box.setContentSize(478,568),right_bg_box.setAnchorPoint(ZERO()),right_bg_box.setPosition(ZERO()),layer.addChild(right_bg_box);var left_navi=cc.Sprite.create("common/img_navi_center_2.png");left_navi.setAnchorPoint(ZERO()),left_navi.setPosition(cc.p(8,509)),right_bg_box.addChild(left_navi);var close_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);close_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),close_btn.setPosition(ccWidth(left_navi)-11,7),left_navi.addChild(close_btn),close_btn.addClickEventListener(function(sender){this.closeMaterialBox()});var title_label=new cmLabel.getLabel("進化素材",LABEL_FONT_INDEX.FONT_261);if(title_label.setAnchorPoint(ANCHOR_MIDDLE()),title_label.setPosition(ccCenter(left_navi)+Vec2(0,3)),left_navi.addChild(title_label),0!=this.m_mtrlGnrlInfoList.length)this.m_materialTableLayer=this.getMaterialTableLayer(),this.m_materialTableLayer.setPosition(17,18),layer.addChild(this.m_materialTableLayer);else{var info_label=new cmLabel.getLabel("進化素材がありません。",LABEL_FONT_INDEX.FONT_261);info_label.setAnchorPoint(ANCHOR_MIDDLE()),info_label.setPosition(ccCenter(right_bg_box)),right_bg_box.addChild(info_label)}return layer.setContentSize(ccSize(right_bg_box)),layer},closeMaterialBox:function(){for(var b=0;b<this.m_mtrlButtons.length;b++){this.m_mtrlButtons[b].getChildByTag(MATERIAL_MASK);var bg=this.m_mtrlButtons[b].getChildByTag(SELECT_BACKGROUND),blink=this.m_mtrlButtons[b].getChildByTag(SELECT_BLINK_BACKGROUND);blink.stopAllActions(),bg.setOpacity(0),blink.setOpacity(0),this.m_mtrlButtons[b].setEnabled(!0)}this.m_leftBoxLayer.runAction(new cc.MoveTo(.1,cc.p(-ccWidth(this.m_leftBoxLayer),0)))},getRightBoxLayer:function(){var layer=new cc.Layer;layer.setContentSize(480,this.height);var state_type=this.m_evolveGnrlInfo.state_type;this.m_right_state_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_state_"+state_type+".png"),this.m_right_state_img.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_right_state_img.setPosition(ccCenter(layer).x,112),USE_SP_MENU_YH_SCALE&&this.m_right_state_img.setScale(2),layer.addChild(this.m_right_state_img),this.m_right_state_img.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR);var mt=MasterTable.getInstance().getMasterTable(),pos=mt.get_BodyPosition(this.m_evolveGnrlInfo.gnrl_id);this.m_right_cliper=new cc.ClippingNode,this.m_right_cliper.setAnchorPoint(ZERO()),this.m_right_cliper.setPosition(ZERO()),layer.addChild(this.m_right_cliper),this.m_stencil_node=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box.png",cc.rect(10,10,10,10)),this.m_stencil_node.setContentSize(ccSize(layer)),this.m_stencil_node.setAnchorPoint(ZERO()),this.m_stencil_node.setPosition(ZERO()),this.m_right_cliper.setStencil(this.m_stencil_node);var morph=MasterTable.getInstance().get_MorphData(this.m_evolveGnrlInfo.gnrl_id);if("y"==morph.is_morph){var gnrl=MasterManager.getInstance().get_General(morph.gnrl_id);if(this.m_gnrl_img=[],USE_PARTNER_GNRL_LOADING){if(SAVE_NOW_PARTNER_GNRL.gnrl_id!=this.m_evolveGnrlInfo.gnrl_id){if(null==(stading_files=StandingMultiplePngList[morph.gnrl_id]))this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".png");else for(var idx=0;idx<stading_files.length;idx++)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+stading_files[idx]+".png");this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".atlas"),this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".json")}}else{var stading_files;if(null==(stading_files=StandingMultiplePngList[morph.gnrl_id]))this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".png");else for(idx=0;idx<stading_files.length;idx++)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+stading_files[idx]+".png");this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".atlas"),this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".json")}resourceLoader(this.m_gnrl_img,function(){var gnrl_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".json",gnrl_atals=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".atlas";this.m_character_skeleton=new sp.SkeletonAnimation(gnrl_json,gnrl_atals,.1),this.m_character_skeleton.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_character_skeleton.setPosition(Detail_pos(pos.posx,pos.posy)),this.m_right_cliper.addChild(this.m_character_skeleton),this.m_character_skeleton.setMix("basic","active",.1),this.m_character_skeleton.setMix("active","basic",.1),this.m_character_skeleton.setAnimation(0,"active",!1),this.m_character_skeleton.addAnimation(0,"basic",!0),this.m_deferred.resolve(!0)}.bind(this))}else{if(this.m_gnrl_img=[],USE_PARTNER_GNRL_LOADING){if(SAVE_NOW_PARTNER_GNRL.gnrl_id!=this.m_evolveGnrlInfo.gnrl_id){var cardboss=getCardBody_ImageStr(this.m_evolveGnrlInfo.gnrl_id);this.m_gnrl_img.push(cardboss)}}else{cardboss=getCardBody_ImageStr(this.m_evolveGnrlInfo.gnrl_id);this.m_gnrl_img.push(cardboss)}resourceLoader(this.m_gnrl_img,function(){this.m_characterImg=cc.Sprite.create();var general=mt.get_General(this.m_evolveGnrlInfo.gnrl_id);if(general.gnrl_type==GENERAL_TYPE_YUNHEE){if(mt.get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id),this.m_characterImg.setTexture(img_str)}else{img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id),this.m_characterImg.setTexture(img_str)}}else{img_str=getCardBody_ImageStr(this.m_evolveGnrlInfo.gnrl_id);this.m_img_scale=getCardBody_Scale(this.m_evolveGnrlInfo.gnrl_id),this.m_characterImg.setTexture(img_str)}this.m_characterImg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_characterImg.setScale(this.m_img_scale),this.m_characterImg.setPosition(MAIN_POS(this,pos.posx+ccWidth(this.m_characterImg)*this.m_img_scale/2-ccWidth(this)/4*3+240,pos.posy+ccHeight(this.m_characterImg)*this.m_img_scale/2)),this.m_right_cliper.addChild(this.m_characterImg);var scaleTo_1=new cc.ScaleTo(.7,this.m_img_scale,this.m_img_scale+.01),scaleTo_2=new cc.ScaleTo(.7,this.m_img_scale,this.m_img_scale-.01),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);this.m_characterImg.runAction(repeat),this.m_deferred.resolve(!0),repeat=sequence=scaleTo_2=scaleTo_1=null}.bind(this))}var level_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_namebox.png");level_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),level_box.setPosition(ccCenter(layer).x,82),layer.addChild(level_box);var lv_label=cmLabel.getLabel("Lv. 1 / "+this.m_evolveGnrlInfo.max_level,LABEL_FONT_INDEX.FONT_201);lv_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),lv_label.setPosition(ccCenter(level_box).x,ccCenter(level_box).y+1),level_box.addChild(lv_label);var cost_label=cmLabel.getLabel("cost "+this.m_evolveGnrlInfo.cost,LABEL_FONT_INDEX.FONT_201);cost_label.setAnchorPoint(ANCHOR_MIDDLE_TOP()),cost_label.setPosition(ccCenter(level_box).x,ccCenter(level_box).y-1),level_box.addChild(cost_label);var class_type_star_path,rare_type_mark=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_unique_"+leadingZeros(this.m_evolveGnrlInfo.rare_type,2)+".png");rare_type_mark.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),rare_type_mark.setPosition(ccCenter(layer).x,164),layer.addChild(rare_type_mark),this.m_evolveGnrlInfo.rare_type==RARE_TYPE_N||this.m_evolveGnrlInfo.rare_type==RARE_TYPE_HN?class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_n.png":this.m_evolveGnrlInfo.rare_type==RARE_TYPE_R?class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_r.png":this.m_evolveGnrlInfo.rare_type==RARE_TYPE_HR?class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_hr.png":this.m_evolveGnrlInfo.rare_type==RARE_TYPE_SR?class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_s.png":this.m_evolveGnrlInfo.rare_type==RARE_TYPE_SSR&&(class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_ss.png");for(var class_star_layer=new cc.Layer,i=1;i<this.m_evolveGnrlInfo.gnrl_class;++i){var class_type_star=cc.Sprite.create(class_type_star_path);class_type_star.setAnchorPoint(ZERO()),class_type_star.setPosition((i-1)*class_type_star.width,0),class_star_layer.addChild(class_type_star),class_type_star=null}return class_star_layer.setContentSize(28*(this.m_evolveGnrlInfo.gnrl_class-1),29),class_star_layer.ignoreAnchorPointForPosition(!1),class_star_layer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),class_star_layer.setPosition(ccCenter(layer).x,231),layer.addChild(class_star_layer),layer},getMaterialLayer:function(){var layer=new cc.Layer;layer.setContentSize(98,490);for(var i=0;i<this.m_mtrlInfo.length;++i){var bg=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame_2.png");bg.setContentSize(98,98),bg.setAnchorPoint(ANCHOR_TOP_LEFT()),bg.setPosition(0,490-i*bg.height),layer.addChild(bg);var mtrl=this.m_mtrlInfo[i];if(mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_CLASS_1||mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_CLASS_2||mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_CLASS_3||mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_CLASS_4||mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_CLASS_5||mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_CLASS_6||mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_CLASS_7||mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_COMMON||mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_MELEE||mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_LANCER||mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_ARCHER||mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_MELEE_MIDDLE||mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_LANCER_MIDDLE||mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_ARCHER_MIDDLE||mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_MELEE_LOW||mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_LANCER_LOW||mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_ARCHER_LOW||mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_ORB||mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_YUBI_RARE||mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_YUBI_MIDDLE||mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_YUBI_HIGH||mtrl.mtrl_info.slot_type==EVOLVE_MTRL_TYPE_YUBI_LOW){var sprite=this.getMaterialSprite(mtrl.mtrl_info.slot_type,mtrl.mtrl_info.slot_value_1,mtrl.mtrl_info.slot_value_2,mtrl.mtrl_info.slot_num-1);(btn=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(1,1,1,1)))).setPreferredSize(cc.size(90,90)),btn.setAnchorPoint(ANCHOR_MIDDLE()),btn.setPosition(ccCenter(bg)),btn.setTag(mtrl.mtrl_info.slot_type),sprite.setAnchorPoint(ANCHOR_MIDDLE()),sprite.setPosition(ccCenter(bg)),bg.addChild(btn),bg.addChild(sprite),btn.addTargetWithActionForControlEvents(this,function(sender,event){var audio=AudioEngine.getInstance(),snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_card_touch.mp3";audio.playEffect(snd);var bonus_type=GeneralService.getInstance().getEvolveTypeToBonusType(sender.getTag());MainObserver.getInstance().postNotification(NOTIFICATION_EVOLUTION_MTRL_SHORTCUTS,bonus_type)},cc.CONTROL_EVENT_TOUCH_UP_INSIDE)}else{var btn;(btn=this.getMaterialButton(mtrl,mtrl.mtrl_info.slot_num-1)).setAnchorPoint(ANCHOR_MIDDLE()),btn.setTag(mtrl.mtrl_info.slot_num-1),btn.setPosition(ccCenter(bg)),bg.addChild(btn),btn.addClickEventListener(function(sender){var audio=AudioEngine.getInstance(),snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_card_touch.mp3";audio.playEffect(snd),MainObserver.getInstance().postNotification(NOTIFICATION_SELETE_EVOLVE_MATRIAL,sender.getTag())}),this.m_mtrlButtons.push(btn)}}return layer},get_deferred:function(){return this.m_deferred},getMaterialButton:function(info,index){var sprite_on=this.getMaterialSprite(info.mtrl_info.slot_type,info.mtrl_info.slot_value_1,info.mtrl_info.slot_value_2,index),sprite_off=this.getMaterialSprite(info.mtrl_info.slot_type,info.mtrl_info.slot_value_1,info.mtrl_info.slot_value_2,index),rect=RectZero(),btn_on_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",rect);btn_on_mask.setContentSize(cc.size(sprite_on)),btn_on_mask.setAnchorPoint(ZERO()),btn_on_mask.setPosition(ZERO()),sprite_on.addChild(btn_on_mask);var mtrl_btn=new ccui.Button(sprite_off,sprite_on),mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",rect);mask.setContentSize(cc.size(mtrl_btn)),mask.setAnchorPoint(ZERO()),mask.setPosition(ZERO()),mask.setTag(MATERIAL_MASK),mtrl_btn.addChild(mask);var select_bg=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_select.png");select_bg.setPosition(ccCenter(mtrl_btn)),mtrl_btn.addChild(select_bg),select_bg.setTag(SELECT_BACKGROUND),select_bg.setOpacity(0);var select_blink=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_select_2.png");return select_blink.setPosition(ccCenter(mtrl_btn)),mtrl_btn.addChild(select_blink),select_blink.setTag(SELECT_BLINK_BACKGROUND),select_blink.setOpacity(0),mtrl_btn},getMaterialSprite:function(slot_type,slot_value_1,slot_value_2,index){var mt=MasterTable.getInstance();switch(slot_type){case EVOLVE_MTRL_TYPE_YUNHEE:var gnrl_id=slot_value_1,g=MasterManager.getInstance().get_General(gnrl_id);return(info={}).gnrl_id=g.gnrl_id,info.level=1,(new Card).createCard(info,CARD_TYPE.type_evolve_mtrl);case EVOLVE_MTRL_TYPE_CLASS_TYPE:return(new Card).createCard(slot_value_1,slot_value_2);case EVOLVE_MTRL_TYPE_CLASS_1:case EVOLVE_MTRL_TYPE_CLASS_2:case EVOLVE_MTRL_TYPE_CLASS_3:case EVOLVE_MTRL_TYPE_CLASS_4:case EVOLVE_MTRL_TYPE_CLASS_5:case EVOLVE_MTRL_TYPE_CLASS_6:case EVOLVE_MTRL_TYPE_CLASS_7:case EVOLVE_MTRL_TYPE_YUBI_RARE:var gnrl_class=0;slot_type==EVOLVE_MTRL_TYPE_CLASS_1?gnrl_class=HWANDAN_CLASS_1:slot_type==EVOLVE_MTRL_TYPE_CLASS_2?gnrl_class=HWANDAN_CLASS_2:slot_type==EVOLVE_MTRL_TYPE_CLASS_3?gnrl_class=HWANDAN_CLASS_3:slot_type==EVOLVE_MTRL_TYPE_CLASS_4?gnrl_class=HWANDAN_CLASS_4:slot_type==EVOLVE_MTRL_TYPE_CLASS_5?gnrl_class=HWANDAN_CLASS_5:slot_type==EVOLVE_MTRL_TYPE_CLASS_6?gnrl_class=HWANDAN_CLASS_6:slot_type==EVOLVE_MTRL_TYPE_CLASS_7?gnrl_class=HWANDAN_CLASS_7:slot_type==EVOLVE_MTRL_TYPE_YUBI_RARE&&(gnrl_class=HWANDAN_CLASS_YUBI);var sprite=(new Card).createCard(gnrl_class),hwandan_info=GeneralService.getInstance().getUserHwandanInfo(gnrl_class,{});if((value_box=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_valuebox_4.png")).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),value_box.setPosition(ccCenter(sprite).x,2),sprite.addChild(value_box),(plus_icon=cc.Sprite.create("#btn_plus_2_off.png")).setAnchorPoint(ANCHOR_TOP_RIGHT()),plus_icon.setPosition(sprite.width,sprite.height),sprite.addChild(plus_icon),hwandan_info.hwandan_count<slot_value_1)countLabel=cmLabel.getLabel(hwandan_info.hwandan_count+"/"+slot_value_1,LABEL_FONT_INDEX.FONT_161),(mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero())).setContentSize(98,98),mask.setAnchorPoint(ANCHOR_MIDDLE()),mask.setPosition(ccCenter(sprite)),mask.setTag(MATERIAL_MASK),sprite.addChild(mask);else countLabel=cmLabel.getLabel(hwandan_info.hwandan_count+"/"+slot_value_1,LABEL_FONT_INDEX.FONT_161),null!=(found=this.findMtrlInfo(index))?found.isExist=!0:cc.log("");return countLabel.setAnchorPoint(ANCHOR_MIDDLE()),countLabel.setPosition(ccCenter(value_box)),value_box.addChild(countLabel),sprite;case EVOLVE_MTRL_TYPE_SAME_GNRL:var info;gnrl_id=this.m_gnrlInfo.gnrl_id,g=mt.get_General(gnrl_id);return(info={}).gnrl_id=gnrl_id,info.level=1,Card().createCard(info,CARD_TYPE.type_evolve_mtrl);case EVOLVE_MTRL_TYPE_MELEE:case EVOLVE_MTRL_TYPE_LANCER:case EVOLVE_MTRL_TYPE_ARCHER:case EVOLVE_MTRL_TYPE_MELEE_MIDDLE:case EVOLVE_MTRL_TYPE_LANCER_MIDDLE:case EVOLVE_MTRL_TYPE_ARCHER_MIDDLE:case EVOLVE_MTRL_TYPE_MELEE_LOW:case EVOLVE_MTRL_TYPE_LANCER_LOW:case EVOLVE_MTRL_TYPE_ARCHER_LOW:case EVOLVE_MTRL_TYPE_YUBI_MIDDLE:case EVOLVE_MTRL_TYPE_YUBI_HIGH:case EVOLVE_MTRL_TYPE_YUBI_LOW:sprite=cc.Sprite.create("#evolve_"+slot_type+".png");var mtrl_info=GeneralService.getInstance().getUserEvolveArmServiceMtrlInfo(slot_type);if((value_box=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_valuebox_4.png")).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),value_box.setPosition(ccCenter(sprite).x,2),sprite.addChild(value_box),(plus_icon=cc.Sprite.create("#btn_plus_2_off.png")).setAnchorPoint(ANCHOR_TOP_RIGHT()),plus_icon.setPosition(ccWidth(sprite),ccHeight(sprite)),sprite.addChild(plus_icon),null!=mtrl_info){if(mtrl_info.mtrl_count<slot_value_1)countLabel=cmLabel.getLabel(mtrl_info.mtrl_count+"/"+slot_value_1,LABEL_FONT_INDEX.FONT_161),(mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero())).setContentSize(98,98),mask.setAnchorPoint(ANCHOR_MIDDLE()),mask.setPosition(ccCenter(sprite)),mask.setTag(MATERIAL_MASK),sprite.addChild(mask);else countLabel=cmLabel.getLabel(mtrl_info.mtrl_count+"/"+slot_value_1,LABEL_FONT_INDEX.FONT_161),null!=(found=this.findMtrlInfo(index))?found.isExist=!0:cc.log("");countLabel.setAnchorPoint(ANCHOR_MIDDLE()),countLabel.setPosition(ccCenter(value_box)),value_box.addChild(countLabel)}return sprite;case EVOLVE_MTRL_TYPE_ORB:var value_box,plus_icon,countLabel,mask,found,count=NetService().get_User_Evolve_Orb();sprite=cc.Sprite.create("#evolve_"+slot_type+".png");if((value_box=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_valuebox_4.png")).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),value_box.setPosition(ccCenter(sprite).x,2),sprite.addChild(value_box),(plus_icon=cc.Sprite.create("#btn_plus_2_off.png")).setAnchorPoint(ANCHOR_TOP_RIGHT()),plus_icon.setPosition(sprite.width,sprite.height),sprite.addChild(plus_icon),count<slot_value_1)countLabel=cmLabel.getLabel(count+"/"+slot_value_1,LABEL_FONT_INDEX.FONT_161),(mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero())).setContentSize(98,98),mask.setAnchorPoint(ANCHOR_MIDDLE()),mask.setPosition(ccCenter(sprite)),mask.setTag(MATERIAL_MASK),sprite.addChild(mask);else countLabel=cmLabel.getLabel(count+"/"+slot_value_1,LABEL_FONT_INDEX.FONT_161),null!=(found=this.findMtrlInfo(index))?found.isExist=!0:cc.log("");return countLabel.setAnchorPoint(ANCHOR_MIDDLE()),countLabel.setPosition(ccCenter(value_box)),value_box.addChild(countLabel),sprite}return null},setGeneralInfo:function(info,evolve_info,mtrl_info,need_gold){this.m_gnrlInfo=info,this.m_evolveGnrlInfo=evolve_info,this.m_mtrlInfo=mtrl_info,this.m_gnrlKey.gnrl_id=info.gnrl_id,this.m_gnrlKey.gnrl_num=info.gnrl_num,this.m_evolveNeedGold=need_gold},findMtrlInfo:function(index){for(var i=0;i<this.m_mtrlInfo.length;i++)if(this.m_mtrlInfo[i].mtrl_info.slot_num==index+1)return this.m_mtrlInfo[i];return null}}),L_POS_X=227,R_POS_X=450,YunheeInfoPopupLayer=cc.Layer.extend({m_name_label:null,m_gnrl_level_label:null,m_gnrl_max_level_label:null,m_exp_prcnt:null,m_user_cost_label:null,m_leader_skill_title:null,m_leader_skill_name:null,m_leader_skill_desc:null,m_leader_skill_icon:null,m_passive_skill_title:null,m_passive_skill_name:null,m_passive_skill_sub_name:null,m_passive_skill_sub_title:null,m_passive_skill_desc:null,m_passive_skill_icon:null,m_active_skill_desc:null,m_active_skill_icon:null,m_leader_skill_frame:null,m_passive_skill_frame:null,m_active_skill_frame:null,m_active_skill_title:null,m_active_skill_name:null,m_attk_label:null,m_def_label:null,m_hp_label:null,m_sp_label:null,m_cri_prcnt_label:null,m_cri_dmg_label:null,m_def_prcnt_label:null,m_def_decrease_label:null,m_add_attk_label:null,m_add_def_label:null,m_add_hp_label:null,m_add_sp_label:null,m_add_cri_prcnt_label:null,m_add_cri_dmg_label:null,m_add_def_prcnt_label:null,m_add_def_decrease_label:null,m_state_type_label:null,m_arm_service_label:null,m_bg_box:null,m_exp_bar:null,m_passive_mask:null,m_element_type_label:null,m_element_type_icon:null,m_fight_type_label:null,m_arm_service_type_icon:null,m_gnrl_info:null,m_gnrlKey:null,m_desc_height:64,ctor:function(info,popup_type,is_mask){this._super(),this.m_name_label=null,this.m_gnrl_level_label=null,this.m_gnrl_max_level_label=null,this.m_exp_prcnt=null,this.m_user_cost_label=null,this.m_leader_skill_title=null,this.m_leader_skill_name=null,this.m_leader_skill_desc=null,this.m_leader_skill_icon=null,this.m_passive_skill_title=null,this.m_passive_skill_name=null,this.m_passive_skill_sub_name=null,this.m_passive_skill_sub_title=null,this.m_passive_skill_desc=null,this.m_passive_skill_icon=null,this.m_active_skill_desc=null,this.m_active_skill_icon=null,this.m_leader_skill_frame=null,this.m_passive_skill_frame=null,this.m_active_skill_frame=null,this.m_active_skill_title=null,this.m_active_skill_name=null,this.m_attk_label=null,this.m_def_label=null,this.m_hp_label=null,this.m_sp_label=null,this.m_cri_prcnt_label=null,this.m_cri_dmg_label=null,this.m_def_prcnt_label=null,this.m_def_decrease_label=null,this.m_add_attk_label=null,this.m_add_def_label=null,this.m_add_hp_label=null,this.m_add_sp_label=null,this.m_state_type_label=null,this.m_arm_service_label=null,this.m_bg_box=null,this.m_exp_bar=null,this.m_passive_mask=null,this.m_element_type_label=null,this.m_element_type_icon=null,this.m_fight_type_label=null,this.m_arm_service_type_icon=null,this.m_gnrl_info=null,this.m_gnrlKey={},this.initLayer(info,popup_type,is_mask)},create:function(index,gnrl_id,is_mask){},initLayer:function(info,popup_type,is_mask){return this.m_gnrl_info=info,this.m_gnrlKey={},this.m_gnrlKey.gnrl_id=info.gnrl_id,this.m_gnrlKey.gnrl_num=info.gnrl_num,this.initLayout(is_mask),this.updateGeneralInfo(popup_type),!0},setUserGeneralInfo:function(info,popup_type){this.m_gnrl_info=info,this.m_gnrlKey.gnrl_id=info.gnrl_id,this.m_gnrlKey.gnrl_num=info.gnrl_num,this.updateGeneralInfo(popup_type)},initLayout:function(is_mask){if(is_mask){var bg_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());bg_mask.setPosition(ccCenter(this)),bg_mask.setContentSize(ccSize(this)),this.addChild(bg_mask)}if(IS_SP_BROWSER){this.m_bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.m_bg_box.setContentSize(470,640),this.m_bg_box.setAnchorPoint(ANCHOR_MIDDLE()),this.addChild(this.m_bg_box);for(var status_type_1=["Lv","攻撃力","体力","会心発動率","盾発動率","属性","戦闘タイプ"],status_type_2=["COST","防御力","攻速","会心上昇率","盾強度","兵科","勢力"],pos_x=22,pos_y=ccHeight(this.m_bg_box)-45,i=0;i<status_type_1.length;i++){var font=LABEL_FONT_INDEX.FONT_144;0==i&&(font=LABEL_FONT_INDEX.FONT_161),(label=cmLabel.getLabel(status_type_1[i],font)).setAnchorPoint(ANCHOR_TOP_LEFT()),label.setPosition(pos_x,pos_y-22*i),this.m_bg_box.addChild(label)}pos_x+=225;for(i=0;i<status_type_2.length;i++){var label;font=LABEL_FONT_INDEX.FONT_144;0==i&&(font=LABEL_FONT_INDEX.FONT_161),(label=cmLabel.getLabel(status_type_2[i],font)).setAnchorPoint(ANCHOR_TOP_LEFT()),label.setPosition(pos_x,pos_y-22*i),this.m_bg_box.addChild(label)}status_type_2=status_type_1=null;var exp_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero());exp_bg.setContentSize(110,12),exp_bg.setAnchorPoint(ANCHOR_TOP_LEFT()),exp_bg.setPosition(97,ccHeight(this.m_bg_box)-47),this.m_bg_box.addChild(exp_bg)}else this.m_bg_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_detail_box.png"),this.m_bg_box.setContentSize(470,640),this.m_bg_box.setAnchorPoint(ANCHOR_MIDDLE()),this.addChild(this.m_bg_box);return this.m_name_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2011),this.m_name_label.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_name_label.setPosition(ccCenter(this.m_bg_box).x,ccHeight(this.m_bg_box)-10),this.m_bg_box.addChild(this.m_name_label),this.m_gnrl_level_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.m_gnrl_level_label.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_gnrl_level_label.setPosition(40,ccHeight(this.m_bg_box)-46),this.m_bg_box.addChild(this.m_gnrl_level_label),this.m_gnrl_max_level_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.m_gnrl_max_level_label.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_bg_box.addChild(this.m_gnrl_max_level_label),this.m_exp_bar=cc.Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green_2.png"),this.m_exp_bar.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_exp_bar.setPosition(98,ccHeight(this.m_bg_box)-50),this.m_bg_box.addChild(this.m_exp_bar),this.m_exp_prcnt=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_143),this.m_exp_prcnt.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_exp_prcnt.setPosition(149,ccHeight(this.m_bg_box)-35),this.m_bg_box.addChild(this.m_exp_prcnt),this.m_user_cost_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.m_user_cost_label.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_user_cost_label.setPosition(308,ccHeight(this.m_bg_box)-45),this.m_bg_box.addChild(this.m_user_cost_label),this.m_leader_skill_frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png"),this.m_leader_skill_frame.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_bg_box.addChild(this.m_leader_skill_frame),this.m_leader_skill_icon=cc.Sprite.create(),this.m_leader_skill_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_leader_skill_icon.setPosition(ccCenter(this.m_leader_skill_frame)),this.m_leader_skill_frame.addChild(this.m_leader_skill_icon),this.m_leader_skill_title=cmLabel.getLabel(res_str("label_info_skill_leader"),LABEL_FONT_INDEX.FONT_1617),this.m_leader_skill_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_bg_box.addChild(this.m_leader_skill_title),this.m_leader_skill_name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812),this.m_leader_skill_name.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_bg_box.addChild(this.m_leader_skill_name),this.m_leader_skill_desc=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_144),this.m_leader_skill_desc.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_leader_skill_desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_leader_skill_desc.setTextAreaSize(cc.size(320,120)),this.m_leader_skill_desc.ignoreContentAdaptWithSize(!1),this.m_bg_box.addChild(this.m_leader_skill_desc),this.m_passive_skill_frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png"),this.m_passive_skill_frame.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_bg_box.addChild(this.m_passive_skill_frame),this.m_passive_skill_icon=cc.Sprite.create(),this.m_passive_skill_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_passive_skill_icon.setPosition(ccCenter(this.m_passive_skill_frame)),this.m_passive_skill_frame.addChild(this.m_passive_skill_icon),this.m_passive_skill_title=cmLabel.getLabel(res_str("label_info_skill_passive"),LABEL_FONT_INDEX.FONT_1616),this.m_passive_skill_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_bg_box.addChild(this.m_passive_skill_title),this.m_passive_skill_name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812),this.m_passive_skill_name.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_bg_box.addChild(this.m_passive_skill_name),this.m_passive_skill_sub_name=cmLabel.getLabel(cmString("(%s)",res_str("label_evolve_after_passive_skill_info_text")),LABEL_FONT_INDEX.FONT_166),this.m_passive_skill_sub_name.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_bg_box.addChild(this.m_passive_skill_sub_name),this.m_passive_skill_sub_name.setVisible(!1),this.m_passive_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero()),this.m_passive_mask.setContentSize(cc.size(68,68)),this.m_passive_mask.setPosition(30,30),this.m_passive_skill_icon.addChild(this.m_passive_mask),this.m_passive_mask.setVisible(!1),this.m_passive_skill_desc=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_144),this.m_passive_skill_desc.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_passive_skill_desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_passive_skill_desc.setTextAreaSize(cc.size(320,this.m_desc_height)),this.m_passive_skill_desc.ignoreContentAdaptWithSize(!1),this.m_passive_skill_desc.setPosition(103,189),this.m_bg_box.addChild(this.m_passive_skill_desc),this.m_active_skill_frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png"),this.m_active_skill_frame.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_active_skill_frame.setPosition(27,ccHeight(this.m_bg_box)-226),this.m_bg_box.addChild(this.m_active_skill_frame),this.m_active_skill_icon=cc.Sprite.create(),this.m_active_skill_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_active_skill_icon.setPosition(ccCenter(this.m_active_skill_frame)),this.m_active_skill_frame.addChild(this.m_active_skill_icon),this.m_active_skill_title=cmLabel.getLabel(res_str("label_info_skill_active"),LABEL_FONT_INDEX.FONT_1615),this.m_active_skill_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_active_skill_title.setPosition(24,ccHeight(this.m_bg_box)-205),this.m_bg_box.addChild(this.m_active_skill_title),this.m_active_skill_name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1614),this.m_active_skill_name.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_active_skill_name.setPosition(102,ccHeight(this.m_bg_box)-226),this.m_bg_box.addChild(this.m_active_skill_name),this.m_active_skill_desc=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_144),this.m_active_skill_desc.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_active_skill_desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_active_skill_desc.setTextAreaSize(cc.size(320,45)),this.m_active_skill_desc.ignoreContentAdaptWithSize(!1),this.m_active_skill_desc.setPosition(102,ccHeight(this.m_bg_box)-247),this.m_bg_box.addChild(this.m_active_skill_desc),this.m_add_attk_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1412),this.m_add_attk_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_bg_box.addChild(this.m_add_attk_label),this.m_attk_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_attk_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_bg_box.addChild(this.m_attk_label),this.m_add_def_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1412),this.m_add_def_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_bg_box.addChild(this.m_add_def_label),this.m_def_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_def_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_bg_box.addChild(this.m_def_label),this.m_add_hp_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1412),this.m_add_hp_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_bg_box.addChild(this.m_add_hp_label),this.m_hp_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_hp_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_bg_box.addChild(this.m_hp_label),this.m_add_sp_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1412),this.m_add_sp_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_bg_box.addChild(this.m_add_sp_label),this.m_sp_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_sp_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_bg_box.addChild(this.m_sp_label),this.m_add_cri_prcnt_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1412),this.m_add_cri_prcnt_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_bg_box.addChild(this.m_add_cri_prcnt_label),this.m_cri_prcnt_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_cri_prcnt_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_bg_box.addChild(this.m_cri_prcnt_label),this.m_add_cri_dmg_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1412),this.m_add_cri_dmg_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_bg_box.addChild(this.m_add_cri_dmg_label),this.m_cri_dmg_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_cri_dmg_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_bg_box.addChild(this.m_cri_dmg_label),this.m_add_def_prcnt_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1412),this.m_add_def_prcnt_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_bg_box.addChild(this.m_add_def_prcnt_label),this.m_def_prcnt_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_def_prcnt_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_bg_box.addChild(this.m_def_prcnt_label),this.m_add_def_decrease_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1412),this.m_add_def_decrease_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_bg_box.addChild(this.m_add_def_decrease_label),this.m_def_decrease_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_def_decrease_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_bg_box.addChild(this.m_def_decrease_label),this.m_arm_service_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_arm_service_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_arm_service_label.setPosition(R_POS_X,ccHeight(this.m_bg_box)-155),this.m_bg_box.addChild(this.m_arm_service_label),this.m_arm_service_type_icon=cc.Sprite.create(),this.m_arm_service_type_icon.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_arm_service_type_icon.setScale(.7),this.m_bg_box.addChild(this.m_arm_service_type_icon),this.m_element_type_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_element_type_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_element_type_label.setPosition(L_POS_X,ccHeight(this.m_bg_box)-155),this.m_bg_box.addChild(this.m_element_type_label),this.m_element_type_icon=cc.Sprite.create(),this.m_element_type_icon.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_element_type_icon.setScale(.7),this.m_bg_box.addChild(this.m_element_type_icon),this.m_state_type_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_state_type_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_state_type_label.setPosition(R_POS_X,ccHeight(this.m_bg_box)-177),this.m_bg_box.addChild(this.m_state_type_label),this.m_fight_type_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_fight_type_label.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_fight_type_label.setPosition(L_POS_X,ccHeight(this.m_bg_box)-177),this.m_bg_box.addChild(this.m_fight_type_label),!0},updateGeneralInfo:function(popup_type){var m=MasterManager.getInstance();popup_type==NOTIFY_IS_LONG_CLICK?this.m_bg_box.setPosition(this.width/4,this.height/2):this.m_bg_box.setPosition(this.width/4*3,this.height/2),this.m_name_label.setString(this.m_gnrl_info.name),this.m_gnrl_level_label.setString(this.m_gnrl_info.gnrl_level),this.m_gnrl_max_level_label.setString("/"+this.m_gnrl_info.max_level),this.m_gnrl_max_level_label.setPosition(this.m_gnrl_level_label.x+this.m_gnrl_level_label.width,this.m_gnrl_level_label.y);var prcnt=0;this.m_gnrlKey.gnrl_num&&(prcnt=GeneralService.getInstance().getGeneralLevelUpExpPrcnt(this.m_gnrlKey)),1<prcnt&&(prcnt=1);var lv_prcnt=100*prcnt;if(100<lv_prcnt&&(lv_prcnt=100),this.m_exp_prcnt.setString(lv_prcnt.toFixed(0)+"%"),prcnt*=104,this.m_exp_bar.setScaleX(prcnt),this.m_gnrl_info.gnrl_level>=this.m_gnrl_info.max_level&&(this.m_exp_prcnt.setString("MAX"),this.m_exp_bar.setScaleX(104)),this.m_user_cost_label.setString(this.m_gnrl_info.cost),0!=this.m_gnrl_info.active_skill){var skill=m.get_ActiveSkill(this.m_gnrl_info.active_skill);if(USE_ACTIVE_PASSIVE_ICON)this.m_active_skill_icon.setTexture(RES_CDN_DEFULT+cmString("icon/active/active_%d.png",skill.skill_group));else{var frame=cc.spriteFrameCache.getSpriteFrame("active_"+skill.skill_group+".png");this.m_active_skill_icon.setSpriteFrame(frame)}this.m_active_skill_name.setString(cmString("%s",skill.name)),this.m_active_skill_desc.setString(cmString("%s",skill.content));var line=SKILLLINECOUNT(skill,27);IS_SP_BROWSER?this.m_active_skill_desc.setTextAreaSize(cc.size(320,18*line)):this.m_active_skill_desc.setTextAreaSize(cc.size(320,17*line)),skill=null}else{frame=cc.Sprite.create().getSpriteFrame();this.m_active_skill_icon.setSpriteFrame(frame),this.m_active_skill_name.setString(""),this.m_active_skill_desc.setString("")}var add_height=0;64<ccHeight(this.m_active_skill_desc)&&(add_height=ccHeight(this.m_active_skill_desc)-64);var is_exist_passive=!1;this.m_passive_skill_sub_name.setVisible(!1),this.m_passive_mask.setVisible(!1),this.m_passive_skill_name.setColor(COLOR(1812)),this.m_passive_skill_desc.setColor(COLOR(165));for(var idx=0;idx<this.m_gnrl_info.passive_skill.length;idx++){if(99999!=this.m_gnrl_info.passive_skill[idx]&&0!=this.m_gnrl_info.passive_skill[idx])if(0!=(skill=m.get_PassiveSkillV2(this.m_gnrl_info.passive_skill[idx])).skill_icon){if(0!=skill.skill_icon&&null!=skill.skill_icon&&null!=skill.skill_icon)if(USE_ACTIVE_PASSIVE_ICON)this.m_passive_skill_icon.setTexture(RES_CDN_DEFULT+"icon/passive/"+cmString("passive_%d.png",skill.skill_icon));else{var icon_passive_name="passive_"+skill.skill_icon+".png",icon_passive_tex=cc.spriteFrameCache.getSpriteFrame(icon_passive_name);this.m_passive_skill_icon.setSpriteFrame(icon_passive_tex)}this.m_passive_skill_name.setString(skill.name),this.m_passive_skill_desc.setString(skill.content),is_exist_passive=!0}}if(!is_exist_passive)for(idx=0;idx<this.m_gnrl_info.trans_passive_skill.length;idx++){if(99999!=this.m_gnrl_info.trans_passive_skill[idx]&&0!=this.m_gnrl_info.trans_passive_skill[idx])if(0!=(skill=m.get_TransPassiveSkill(this.m_gnrl_info.trans_passive_skill[idx])).skill_icon){if(USE_ACTIVE_PASSIVE_ICON)this.m_passive_skill_icon.setTexture(RES_CDN_DEFULT+"icon/passive/"+cmString("passive_%d.png",skill.skill_icon));else{icon_passive_name="passive_"+skill.skill_icon+".png",icon_passive_tex=cc.spriteFrameCache.getSpriteFrame(icon_passive_name);this.m_passive_skill_icon.setSpriteFrame(icon_passive_tex)}this.m_passive_skill_name.setString(skill.name),this.m_passive_skill_desc.setString(skill.content)}}if(this.m_gnrl_info.gnrl_type==GENERAL_TYPE_YUNHEE||this.m_gnrl_info.gnrl_type==GENERAL_TYPE_JIN_YUNHEE){if(1==this.m_gnrl_info.class_type){var gs=GeneralService.getInstance(),passive_id=gs.getNextClassTypePassiveId(this.m_gnrl_info.evolution_group_num,this.m_gnrl_info.class_type);if(0!=(skill=m.get_PassiveSkillV2(passive_id)).skill_icon){if(0!=skill.skill_icon&&null!=skill.skill_icon&&null!=skill.skill_icon)if(USE_ACTIVE_PASSIVE_ICON)this.m_passive_skill_icon.setTexture(RES_CDN_DEFULT+"icon/passive/"+cmString("passive_%d.png",skill.skill_icon));else{icon_passive_name="passive_"+skill.skill_icon+".png",icon_passive_tex=cc.spriteFrameCache.getSpriteFrame(icon_passive_name);this.m_passive_skill_icon.setSpriteFrame(icon_passive_tex)}this.m_passive_skill_name.setString(skill.name),this.m_passive_skill_desc.setString(skill.content)}if(99999==passive_id||0==passive_id){var passive_id_trans=gs.getNextClassTypeTransPassiveId(this.m_gnrl_info.evolution_group_num,this.m_gnrl_info.class_type),skill_trans=m.get_TransPassiveSkill(passive_id_trans);if(0!=skill_trans.skill_icon&&null!=skill_trans.skill_icon&&skill_trans.skill_icon,USE_ACTIVE_PASSIVE_ICON)this.m_passive_skill_icon.setTexture(RES_CDN_DEFULT+"icon/passive/"+cmString("passive_%d.png",skill.skill_icon));else{icon_passive_name="passive_"+skill_trans.skill_icon+".png",icon_passive_tex=cc.spriteFrameCache.getSpriteFrame(icon_passive_name);this.m_passive_skill_icon.setSpriteFrame(icon_passive_tex)}this.m_passive_skill_name.setString(skill_trans.name),this.m_passive_skill_desc.setString(skill_trans.content)}this.m_passive_skill_name.setColor(COLOR(188)),this.m_passive_skill_desc.setColor(COLOR(166)),this.m_passive_skill_sub_name.setVisible(!0),this.m_passive_mask.setVisible(!0),this.m_passive_mask.setPosition(30,30),skill=null}this.m_passive_skill_frame.setVisible(!0),this.m_passive_skill_title.setVisible(!0),this.m_passive_skill_frame.setPosition(27,ccHeight(this.m_bg_box)-add_height-343),this.m_passive_skill_title.setPosition(24,ccHeight(this.m_bg_box)-add_height-322),this.m_passive_skill_name.setPosition(102,ccHeight(this.m_bg_box)-add_height-343),this.m_passive_skill_desc.setPosition(102,ccHeight(this.m_bg_box)-add_height-366),this.m_passive_skill_sub_name.setPosition(ccWidth(this.m_passive_skill_title)+ccPosX(this.m_passive_skill_title),ccHeight(this.m_bg_box)-add_height-322);var f_size=this.m_passive_skill_desc.getFontSize(),s_lengh=this.m_passive_skill_desc.getString().length;this.m_desc_height=Math.ceil((s_lengh*f_size+320)/320)*(f_size+2),this.m_desc_height=Math.max(64,this.m_desc_height),this.m_passive_skill_desc.setTextAreaSize(cc.size(320,this.m_desc_height)),64<ccHeight(this.m_passive_skill_desc)&&(add_height+=ccHeight(this.m_passive_skill_desc)-64)}else{frame=cc.Sprite.create().getSpriteFrame();this.m_passive_skill_frame.setVisible(!1),this.m_passive_skill_title.setVisible(!1),this.m_passive_skill_icon.setSpriteFrame(frame),this.m_passive_skill_name.setString(""),this.m_passive_skill_desc.setString("")}if(this.m_gnrl_info.gnrl_type==GENERAL_TYPE_SOLDIER){frame=cc.Sprite.create().getSpriteFrame();this.m_leader_skill_icon.setSpriteFrame(frame),this.m_leader_skill_name.setString(""),this.m_leader_skill_desc.setString(""),this.m_leader_skill_frame.setVisible(!1),this.m_leader_skill_title.setVisible(!1)}else{var is_exist_leader_skill=!1;for(idx=0;idx<this.m_gnrl_info.leader_skill.length;idx++)if(0!=this.m_gnrl_info.leader_skill[idx]&&99999!=this.m_gnrl_info.leader_skill[idx]){this.m_leader_skill_frame.setVisible(!0),this.m_leader_skill_title.setVisible(!0);skill=m.get_LeaderSkill(this.m_gnrl_info.leader_skill[idx]);this.m_leader_skill_icon.setTexture(RES_CDN_DEFULT+"icon/leader/leader_"+skill.skill_icon+".png"),this.m_leader_skill_name.setString(skill.name),this.m_leader_skill_desc.setString(skill.content),is_exist_leader_skill=!0;break}if(!is_exist_leader_skill)for(idx=0;idx<this.m_gnrl_info.special_leader_skill.length;idx++)if(0!=this.m_gnrl_info.special_leader_skill[idx]&&99999!=this.m_gnrl_info.special_leader_skill[idx]){this.m_leader_skill_frame.setVisible(!0),this.m_leader_skill_title.setVisible(!0);skill=m.get_SpecialLeaderSkill(this.m_gnrl_info.special_leader_skill[idx]);this.m_leader_skill_icon.setTexture(RES_CDN_DEFULT+"icon/leader/leader_"+skill.skill_icon+".png"),this.m_leader_skill_name.setString(skill.name),this.m_leader_skill_desc.setString(skill.content);break}this.m_leader_skill_frame.setPosition(27,ccHeight(this.m_bg_box)-add_height-460),this.m_leader_skill_title.setPosition(24,ccHeight(this.m_bg_box)-add_height-439),this.m_leader_skill_name.setPosition(102,ccHeight(this.m_bg_box)-add_height-460),this.m_leader_skill_desc.setPosition(102,ccHeight(this.m_bg_box)-add_height-481),64<ccHeight(this.m_leader_skill_desc)&&(add_height+=ccHeight(this.m_leader_skill_desc)-64)}var mt=MasterManager.getInstance(),g=MasterManager.getInstance().get_General(this.m_gnrl_info.gnrl_id),loveStat=MasterTable.getInstance().get_LoveStatItem(g.love_stat_group,this.m_gnrl_info.love_level),value_pack={add_atk_value:0,add_def_value:0,add_hp_value:0,add_cri_prcnt:0,add_cri_dmg_prcnt:0,add_def_prcnt:0,add_def_decrease_prcnt:0};if(loveStat.stat_type_1==LOVE_STAT_TYPE_ATTK_PRCNT&&(value_pack.add_atk_value+=Math.floor(this.m_gnrl_info.attk*(loveStat.value_1/100))),loveStat.stat_type_2==LOVE_STAT_TYPE_ATTK_PRCNT&&(value_pack.add_atk_value+=Math.floor(this.m_gnrl_info.attk*(loveStat.value_2/100))),loveStat.stat_type_3==LOVE_STAT_TYPE_ATTK_PRCNT&&(value_pack.add_atk_value+=Math.floor(this.m_gnrl_info.attk*(loveStat.value_3/100))),loveStat.stat_type_1==LOVE_STAT_TYPE_ATTK_INC&&(value_pack.add_atk_value+=loveStat.value_1),loveStat.stat_type_2==LOVE_STAT_TYPE_ATTK_INC&&(value_pack.add_atk_value+=loveStat.value_2),loveStat.stat_type_2==LOVE_STAT_TYPE_ATTK_INC&&(value_pack.add_atk_value+=loveStat.value_3),loveStat.stat_type_1==LOVE_STAT_TYPE_DEF_PRCNT&&(value_pack.add_def_value+=Math.floor(this.m_gnrl_info.def*(loveStat.value_1/100))),loveStat.stat_type_2==LOVE_STAT_TYPE_DEF_PRCNT&&(value_pack.add_def_value+=Math.floor(this.m_gnrl_info.def*(loveStat.value_2/100))),loveStat.stat_type_3==LOVE_STAT_TYPE_DEF_PRCNT&&(value_pack.add_def_value+=Math.floor(this.m_gnrl_info.def*(loveStat.value_3/100))),loveStat.stat_type_1==LOVE_STAT_TYPE_DEF_INC&&(value_pack.add_def_value+=loveStat.value_1),loveStat.stat_type_2==LOVE_STAT_TYPE_DEF_INC&&(value_pack.add_def_value+=loveStat.value_2),loveStat.stat_type_3==LOVE_STAT_TYPE_DEF_INC&&(value_pack.add_def_value+=loveStat.value_3),loveStat.stat_type_1==LOVE_STAT_TYPE_HP_PRCNT&&(value_pack.add_hp_value+=Math.floor(this.m_gnrl_info.hp*(loveStat.value_1/100))),loveStat.stat_type_2==LOVE_STAT_TYPE_HP_PRCNT&&(value_pack.add_hp_value+=Math.floor(this.m_gnrl_info.hp*(loveStat.value_2/100))),loveStat.stat_type_3==LOVE_STAT_TYPE_HP_PRCNT&&(value_pack.add_hp_value+=Math.floor(this.m_gnrl_info.hp*(loveStat.value_3/100))),loveStat.stat_type_1==LOVE_STAT_TYPE_HP_INC&&(value_pack.add_hp_value+=loveStat.value_1),loveStat.stat_type_2==LOVE_STAT_TYPE_HP_INC&&(value_pack.add_hp_value+=loveStat.value_2),loveStat.stat_type_3==LOVE_STAT_TYPE_HP_INC&&(value_pack.add_hp_value+=loveStat.value_3),null!=this.m_gnrl_info.gnrl_num&&0!=this.m_gnrl_info.gnrl_num){var user_branch_ability=CampService.getInstance().getUserCampBranchAbility(this.m_gnrl_info.arm_service_type);1==CAMP_LOVE_STAT_TYPE?(value_pack.add_atk_value+=Math.floor(this.m_gnrl_info.attk*(user_branch_ability.attack/1e4)),value_pack.add_def_value+=Math.floor(this.m_gnrl_info.def*(user_branch_ability.defense/1e4)),value_pack.add_hp_value+=Math.floor(this.m_gnrl_info.hp*(user_branch_ability.health/1e4))):(value_pack.add_atk_value+=user_branch_ability.attack,value_pack.add_def_value+=user_branch_ability.defense,value_pack.add_hp_value+=user_branch_ability.health)}var equip_info_list,set_effect_info=new Map,user_equip_info_list=[],es=EquipmentService.getInstance();for(var idx in equip_info_list=es.getUserGeneralEquipmentListInfo(this.m_gnrlKey)){var equip=equip_info_list[idx];if(null==equip.equip_id)break;var equip_key={},user_equip_info=$.extend({},db.UserEquipment);equip_key.equipment_item_idx=equip.equip_id,equip_key.equipment_num=equip.equip_num,es.getUserEquipmentInfo(equip_key,user_equip_info,this.m_gnrlKey),user_equip_info_list.push_back(user_equip_info),this.addComboStatValueForEquipment(user_equip_info.combo_stat,user_equip_info.stat_value,value_pack);var equip_option_info=mt.get_EquipmentItemOption(user_equip_info.option_id1,user_equip_info.option_num1);if(0==equip_option_info.wear_element_type||this.m_gnrl_info.element_type==equip_option_info.wear_element_type){var equip_option_level_info=mt.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);this.addComboStatValueForEquipment(equip_option_level_info.combo_stat,equip_option_level_info.stat_value,value_pack),this.addComboStatValueForEquipment(equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2,value_pack)}if(0==(equip_option_info=mt.get_EquipmentItemOption(user_equip_info.option_id2,user_equip_info.option_num2)).wear_element_type||this.m_gnrl_info.element_type==equip_option_info.wear_element_type){equip_option_level_info=mt.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);this.addComboStatValueForEquipment(equip_option_level_info.combo_stat,equip_option_level_info.stat_value,value_pack),this.addComboStatValueForEquipment(equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2,value_pack)}if(0==(equip_option_info=mt.get_EquipmentItemOption(user_equip_info.option_id3,user_equip_info.option_num3)).wear_element_type||this.m_gnrl_info.element_type==equip_option_info.wear_element_type){equip_option_level_info=mt.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);this.addComboStatValueForEquipment(equip_option_level_info.combo_stat,equip_option_level_info.stat_value,value_pack),this.addComboStatValueForEquipment(equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2,value_pack)}if(0==(equip_option_info=mt.get_EquipmentItemOption(user_equip_info.option_id4,user_equip_info.option_num4)).wear_element_type||this.m_gnrl_info.element_type==equip_option_info.wear_element_type){equip_option_level_info=mt.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);this.addComboStatValueForEquipment(equip_option_level_info.combo_stat,equip_option_level_info.stat_value,value_pack),this.addComboStatValueForEquipment(equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2,value_pack)}if(0==(equip_option_info=mt.get_EquipmentItemOption(user_equip_info.option_id5,user_equip_info.option_num5)).wear_element_type||this.m_gnrl_info.element_type==equip_option_info.wear_element_type){equip_option_level_info=mt.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);this.addComboStatValueForEquipment(equip_option_level_info.combo_stat,equip_option_level_info.stat_value,value_pack),this.addComboStatValueForEquipment(equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2,value_pack)}if(0<user_equip_info.equip_group)null==(set_count=set_effect_info.at(user_equip_info.equip_group))&&(set_count={count:0},set_effect_info.insert(user_equip_info.equip_group,set_count)),set_effect_info.insert(user_equip_info.equip_group,set_count),set_count.count=set_count.count+1}var keys=set_effect_info.keys();for(idx=0;idx<keys.length;idx++){for(var mt_set_effect={equip_count:0,combo_stat:0,added_value:0},set_count=set_effect_info.at(keys[idx]).count;null==(mt_set_effect=MasterManager.getInstance().get_EquipmentGroup(parseInt(keys[idx]),set_count)).equip_count&&(mt_set_effect={equip_count:0,combo_stat:0,added_value:0}),0==mt_set_effect.equip_count&&0<set_count--;);this.addComboStatValueForEquipment(mt_set_effect.combo_stat,mt_set_effect.added_value,value_pack)}var add_atk_pos=L_POS_X,atk_value=this.m_gnrl_info.attk;this.m_add_attk_label.setString("(+"+parseInt(value_pack.add_atk_value)+")"),this.m_add_attk_label.setPosition(add_atk_pos,ccHeight(this.m_bg_box)-67),0==value_pack.add_atk_value&&this.m_add_attk_label.setString(""),add_atk_pos=this.m_add_attk_label.x-this.m_add_attk_label.width,this.m_attk_label.setString(parseInt(atk_value)),this.m_attk_label.setPosition(add_atk_pos,ccHeight(this.m_bg_box)-67);var add_def_pos=R_POS_X,def_value=this.m_gnrl_info.def;this.m_add_def_label.setString("(+"+parseInt(value_pack.add_def_value)+")"),this.m_add_def_label.setPosition(add_def_pos,ccHeight(this.m_bg_box)-67),0==value_pack.add_def_value&&this.m_add_def_label.setString(""),add_def_pos=this.m_add_def_label.x-this.m_add_def_label.width,this.m_def_label.setString(parseInt(def_value)),this.m_def_label.setPosition(add_def_pos,ccHeight(this.m_bg_box)-67);var add_hp_pos=L_POS_X,hp_value=this.m_gnrl_info.hp;this.m_add_hp_label.setString("(+"+parseInt(value_pack.add_hp_value)+")"),this.m_add_hp_label.setPosition(add_hp_pos,ccHeight(this.m_bg_box)-89),0==value_pack.add_hp_value&&this.m_add_hp_label.setString(""),add_hp_pos=this.m_add_hp_label.x-this.m_add_hp_label.width,this.m_hp_label.setString(parseInt(hp_value)),this.m_hp_label.setPosition(add_hp_pos,ccHeight(this.m_bg_box)-89);var add_sp_pos=R_POS_X;this.m_add_sp_label.setString("(+"+parseInt(0)+")"),this.m_add_sp_label.setPosition(add_sp_pos,ccHeight(this.m_bg_box)-89),this.m_add_sp_label.setString(""),add_sp_pos=this.m_add_sp_label.x-this.m_add_sp_label.width,this.m_sp_label.setString(this.m_gnrl_info.sp),this.m_sp_label.setPosition(add_sp_pos,ccHeight(this.m_bg_box)-89);var add_cri_prcnt_pos=L_POS_X;this.m_add_cri_prcnt_label.setString(" (+"+value_pack.add_cri_prcnt.toFixed(1)+")"),this.m_add_cri_prcnt_label.setPosition(add_cri_prcnt_pos,ccHeight(this.m_bg_box)-111),0==value_pack.add_cri_prcnt.toFixed(1)&&this.m_add_cri_prcnt_label.setString(""),add_cri_prcnt_pos=ccPosX(this.m_add_cri_prcnt_label)-ccWidth(this.m_add_cri_prcnt_label),this.m_cri_prcnt_label.setString(this.m_gnrl_info.cri_prcnt.toFixed(1)+"%"),this.m_cri_prcnt_label.setPosition(add_cri_prcnt_pos,ccHeight(this.m_bg_box)-111);var add_cri_dmg_prcnt_pos=R_POS_X;cc.log("add_cri_dmg_prcnt : "+value_pack.add_cri_dmg_prcnt.toFixed(1)),this.m_add_cri_dmg_label.setString(" (+"+value_pack.add_cri_dmg_prcnt.toFixed(1)+")"),this.m_add_cri_dmg_label.setPosition(add_cri_dmg_prcnt_pos,ccHeight(this.m_bg_box)-111),0==value_pack.add_cri_dmg_prcnt.toFixed(1)&&this.m_add_cri_dmg_label.setString(""),add_cri_dmg_prcnt_pos=ccPosX(this.m_add_cri_dmg_label)-ccWidth(this.m_add_cri_dmg_label),this.m_cri_dmg_label.setString(this.m_gnrl_info.cri_ratio.toFixed(1)+"%"),this.m_cri_dmg_label.setPosition(add_cri_dmg_prcnt_pos,ccHeight(this.m_bg_box)-111);var add_def_prcnt_pos=L_POS_X;this.m_add_def_prcnt_label.setString(" (+"+value_pack.add_def_prcnt.toFixed(1)+")"),this.m_add_def_prcnt_label.setPosition(add_def_prcnt_pos,ccHeight(this.m_bg_box)-133),0==value_pack.add_def_prcnt.toFixed(1)&&this.m_add_def_prcnt_label.setString(""),add_def_prcnt_pos=ccPosX(this.m_add_def_prcnt_label)-ccWidth(this.m_add_def_prcnt_label),this.m_def_prcnt_label.setString(this.m_gnrl_info.guard_rate.toFixed(1)+"%"),this.m_def_prcnt_label.setPosition(add_def_prcnt_pos,ccHeight(this.m_bg_box)-133);var add_def_decrease_prcnt_pos=R_POS_X;cc.log("add_def_decrease_prcnt : "+value_pack.add_def_decrease_prcnt.toFixed(1)),this.m_add_def_decrease_label.setString(" (+"+value_pack.add_def_decrease_prcnt.toFixed(1)+")"),this.m_add_def_decrease_label.setPosition(add_def_decrease_prcnt_pos,ccHeight(this.m_bg_box)-133),0==value_pack.add_def_decrease_prcnt.toFixed(1)&&this.m_add_def_decrease_label.setString(""),add_def_decrease_prcnt_pos=ccPosX(this.m_add_def_decrease_label)-ccWidth(this.m_add_def_decrease_label),cc.log("this.m_gnrl_info.guard_decrease : "+this.m_gnrl_info.guard_decrease.toFixed(1)),this.m_def_decrease_label.setString(this.m_gnrl_info.guard_decrease.toFixed(1)+"%"),this.m_def_decrease_label.setPosition(add_def_decrease_prcnt_pos,ccHeight(this.m_bg_box)-133);var as=(mt=MasterManager.getInstance()).get_ArmServiceType(this.m_gnrl_info.arm_service_type);this.m_arm_service_label.setString(as.name);var st=mt.get_StateType(this.m_gnrl_info.state_type);this.m_state_type_label.setString(st.name);var et=mt.get_ElementType(this.m_gnrl_info.element_type);this.m_element_type_label.setString(et.name);var ft=mt.get_FightType(this.m_gnrl_info.fight_type);this.m_fight_type_label.setString(ft.name),this.m_element_type_icon.setTexture(RES_CDN_DEFULT+"menu_yh/img_yh_detail_ic_attribute_"+this.m_gnrl_info.element_type+".png"),this.m_element_type_icon.setPosition(this.m_element_type_label.x-this.m_element_type_label.width,ccHeight(this.m_bg_box)-153),this.m_arm_service_type_icon.setTexture(RES_CDN_DEFULT+"menu_yh/img_yh_detail_ic_battletech_"+this.m_gnrl_info.arm_service_type+".png"),this.m_arm_service_type_icon.setPosition(this.m_arm_service_label.x-this.m_arm_service_label.width,ccHeight(this.m_bg_box)-153)},addComboStatValueForEquipment:function(combo_stat_type,stat_value,pack){if(9!=combo_stat_type&&10!=combo_stat_type)switch(combo_stat_type){case COMBO_STAT_ATTK_PLUS:pack.add_atk_value+=stat_value;break;case COMBO_STAT_ATTK:pack.add_atk_value+=Math.floor(this.m_gnrl_info.attk*(stat_value/1e4));break;case COMBO_STAT_DEF_PLUS:pack.add_def_value+=stat_value;break;case COMBO_STAT_DEF:pack.add_def_value+=Math.floor(this.m_gnrl_info.def*(stat_value/1e4));break;case COMBO_STAT_HP_PLUS:pack.add_hp_value+=stat_value;break;case COMBO_STAT_HP:pack.add_hp_value+=Math.floor(this.m_gnrl_info.hp*(stat_value/1e4));break;case COMBO_STAT_CRI_PRCNT:pack.add_cri_prcnt+=Math.floor(stat_value/100);break;case COMBO_STAT_CRI_DMG:pack.add_cri_dmg_prcnt+=Math.floor(stat_value/100);break;case COMBO_STAT_GUARD_PRCNT:pack.add_def_prcnt+=Math.floor(stat_value/100);break;case COMBO_STAT_GUARD_DECREASE:pack.add_def_decrease_prcnt+=Math.floor(stat_value/100)}},isEqualGnrl:function(gnrl_id,gnrl_num){var gnrl_info_num=0;return null!=this.m_gnrl_info.gnrl_num&&(gnrl_info_num=this.m_gnrl_info.gnrl_num),this.m_gnrl_info.gnrl_id==gnrl_id&&gnrl_info_num==gnrl_num}}),YunheeLimitOverEnum={btn_sort:600,limit_over_start:601,btn_show_help:602,limit_over_material_not_selectable:603},LimitOverMaterialItemLayer=cc.Layer.extend({m_card_sprite:null,m_isSelect:null,m_isSortDesc:!0,m_info:null,ctor:function(key){this._super(),this.m_isSelect=!1,this.m_info={},this.initLayout(key)},initLayout:function(info){var cardInfo={},key={};key.gnrl_id=info.gnrl_id,key.gnrl_num=info.gnrl_num,cardInfo.gnrl_id=info.gnrl_id,cardInfo.level=info.gnrl_level,cardInfo.limit_step_id=info.limit_step_id,cardInfo.love_level=info.love_level,cardInfo.gender_type=info.gender_type,cardInfo.is_lock=info.is_lock,this.m_card_sprite=(new Card).createCard(cardInfo,CARD_TYPE.type_common_card),this.m_card_sprite.setAnchorPoint(ZERO()),this.m_card_sprite.setPosition(0,17),this.addChild(this.m_card_sprite);var is_mask=!1;info.using_in_camp&&((icon=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_equip_3.png")).setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(this.m_card_sprite)),this.m_card_sprite.addChild(icon),is_mask=!0);var y=0;info.isPartner&&((icon=cc.Sprite.create("#img_card_leader.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),icon.setPosition(95,78),this.m_card_sprite.addChild(icon),y=ccHeight(icon));info.is_friend_partner&&((icon=cc.Sprite.create("#img_card_friend_partner.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),icon.setPosition(95,78-y),this.m_card_sprite.addChild(icon));if(info.using_in_troops)(icon=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_equip.png")).setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(this.m_card_sprite)),this.m_card_sprite.addChild(icon),is_mask=!0;else if(info.using_in_world_war_troops){var icon;(icon=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_equip_6.png")).setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(this.m_card_sprite)),this.m_card_sprite.addChild(icon),is_mask=!0}(info.is_lock||info.isPartner||info.is_friend_partner)&&(is_mask||((icon=cc.Sprite.create("#img_card_mask.png")).setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(this.m_card_sprite)),this.m_card_sprite.addChild(icon),is_mask=!0));return this.m_selected_sprite=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_check.png"),this.m_selected_sprite.setAnchorPoint(ANCHOR_MIDDLE()),this.m_selected_sprite.setPosition(ccCenter(this.m_card_sprite)),this.m_card_sprite.addChild(this.m_selected_sprite),this.m_selected_sprite.setVisible(!1),this.m_info=info,this.setContentSize(this.m_card_sprite.width+17,this.m_card_sprite.height+17),!0},getGnrlInfo:function(){return this.m_info},unSelectCard:function(){this.m_isSelect=!1,this.m_selected_sprite.setVisible(!1)},selectCard:function(){this.m_isSelect=!0,this.m_selected_sprite.setVisible(!0)},isSelectCard:function(){return this.m_isSelect}}),YunheeLimitOverLayer=cc.Layer.extend({m_tableLayer:null,m_select_card_sprite:null,m_need_gold:0,m_rightBoxLayer:null,m_leftBottomLayer:null,m_mtrlCountLabel:null,m_needGoldLabel:null,m_limit_over_btn:null,m_status_bg:null,m_limit_over_btn_mask:null,m_select_1:null,m_select_2:null,m_need_mtrl_count_label:null,m_need_mtrl_count:0,m_limit_over_only_card:null,m_materialList:[],m_materialLayers:[],m_mtrl_keys:[],m_limit_over_only_card_list:[],ctor:function(){this._super(),this.m_materialLayers=[],this.m_materialList=[],this.m_mtrl_keys=[],this.m_gnrlKey={gnrl_id:0,gnrl_num:0}},limitOverLayerClear:function(){this.m_materialLayers.length=0,this.m_status_bg.removeChild(this.m_select_card_sprite),this.m_select_card_sprite=null,this.removeChild(this.m_leftBottomLayer),this.m_leftBottomLayer=null,this.removeChild(this.m_rightBoxLayer),this.m_rightBoxLayer=null},getLimitOverNeedGold:function(){return this.m_need_gold},initLayout:function(){this.m_leftBottomLayer=this.getLeftBottomLayer(),this.m_leftBottomLayer.setPosition(ZERO()),this.addChild(this.m_leftBottomLayer),this.m_rightBoxLayer=this.getRightBoxLayer(),this.m_rightBoxLayer.ignoreAnchorPointForPosition(!1),this.m_rightBoxLayer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_rightBoxLayer.setPosition(this.width,0),this.addChild(this.m_rightBoxLayer)},getLeftBottomLayer:function(){var layer=new cc.Layer;layer.setContentSize(this.width-478,400),this.m_status_bg=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame_2.png"),this.m_status_bg.setContentSize(98,98),this.m_status_bg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_status_bg.setPosition(ccCenter(layer).x,112),layer.addChild(this.m_status_bg),this.m_need_mtrl_count_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_221),this.m_need_mtrl_count_label.enableOutline(cc.color.BLACK,2),this.m_need_mtrl_count_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_need_mtrl_count_label.setPosition(ccCenter(layer).x,82),layer.addChild(this.m_need_mtrl_count_label),this.m_limit_over_btn=new LabelButton("btn_03_off.png","btn_03_on.png","btn_03_off.png",ccui.Widget.PLIST_TEXTURE),this.m_limit_over_btn.setFont(LABEL_FONT_INDEX.FONT_261),this.m_limit_over_btn.setString("強化"),this.m_limit_over_btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_limit_over_btn.setPosition(ccCenter(layer).x,10),this.m_limit_over_btn.setOffsetX(-120),this.m_limit_over_btn.setEnabled(!1),layer.addChild(this.m_limit_over_btn),this.m_limit_over_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeLimitOverEnum.limit_over_start)}),this.m_select_1=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_1.png",RectZero()),this.m_select_1.setContentSize(444,60),this.m_select_1.setAnchorPoint(ANCHOR_MIDDLE()),this.m_select_1.setPosition(ccCenter(this.m_limit_over_btn)),this.m_limit_over_btn.addChild(this.m_select_1),this.m_select_1.setOpacity(0),this.m_select_2=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_2.png",RectZero()),this.m_select_2.setContentSize(444,60),this.m_select_2.setAnchorPoint(ANCHOR_MIDDLE()),this.m_select_2.setPosition(ccCenter(this.m_limit_over_btn)),this.m_limit_over_btn.addChild(this.m_select_2),this.m_select_2.setOpacity(0);var gold_box=new ccui.Scale9Sprite(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero());gold_box.setContentSize(123,38),gold_box.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),gold_box.setPosition(197,ccCenter(this.m_limit_over_btn).y),this.m_limit_over_btn.addChild(gold_box);var gold_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_sell_gold.png");return gold_icon.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),gold_icon.setPosition(180,ccCenter(this.m_limit_over_btn).y),this.m_limit_over_btn.addChild(gold_icon),this.m_needGoldLabel=cmLabel.getLabel(Number(this.m_need_gold).toLocaleString("en"),LABEL_FONT_INDEX.FONT_2011),this.m_needGoldLabel.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_needGoldLabel.setPosition(gold_box.width-10,ccCenter(gold_box).y),gold_box.addChild(this.m_needGoldLabel),this.m_limit_over_btn_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero()),this.m_limit_over_btn_mask.setContentSize(ccSize(this.m_limit_over_btn)),this.m_limit_over_btn_mask.setAnchorPoint(ZERO()),this.m_limit_over_btn_mask.setPosition(ZERO()),this.m_limit_over_btn.addChild(this.m_limit_over_btn_mask),NetService().get_UserItemInfo_V2().gold_cnt<this.m_need_gold&&this.m_needGoldLabel.setColor(COLOR(245)),layer},getRightBoxLayer:function(){var layer=new cc.Layer,right_bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));right_bg_box.setContentSize(478,568),right_bg_box.setAnchorPoint(ZERO()),right_bg_box.setPosition(ZERO()),layer.addChild(right_bg_box),layer.setContentSize(ccSize(right_bg_box));var left_navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");if(left_navi.setAnchorPoint(ZERO()),left_navi.setPosition(8,509),layer.addChild(left_navi,100),0!=this.m_materialList.length)this.m_tableLayer=this.getMaterialTableLayer(),this.m_tableLayer.setPosition(18,84),layer.addChild(this.m_tableLayer);else{var info_label=cmLabel.getLabel("限界突破素材がありません。",LABEL_FONT_INDEX.FONT_241);info_label.setAnchorPoint(ANCHOR_MIDDLE()),info_label.setPosition(ccCenter(layer).x,+ccCenter(layer).y+100),layer.addChild(info_label);var info_label_2=cmLabel.getLabel("※イベント恋姫は",LABEL_FONT_INDEX.FONT_221);info_label_2.setAnchorPoint(ANCHOR_MIDDLE()),info_label_2.setPosition(ccCenter(layer).x,ccCenter(layer).y+40),layer.addChild(info_label_2);var info_label_3=cmLabel.getLabel("限界突破チケットを使用できません。",LABEL_FONT_INDEX.FONT_221);info_label_3.setAnchorPoint(ANCHOR_MIDDLE()),info_label_3.setPosition(ccCenter(layer).x,ccCenter(layer).y+10),layer.addChild(info_label_3)}this.m_mtrlCountLabel=cmLabel.getLabel("素材選択",LABEL_FONT_INDEX.FONT_261),this.m_mtrlCountLabel.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_mtrlCountLabel.setPosition(32,ccCenter(left_navi).y+3),left_navi.addChild(this.m_mtrlCountLabel);var help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE);return help_btn.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),help_btn.setPosition(416,ccCenter(left_navi).y+4),left_navi.addChild(help_btn),help_btn.addClickEventListener(function(sender){this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeLimitOverEnum.btn_show_help)},0,"btn_show_help")}.bind(this)),layer},setGeneralInfo:function(info,list,general_limit){this.m_gnrlInfo=info,this.m_materialList=list,this.m_gnrlLimitInfo=general_limit,this.m_gnrlKey.gnrl_id=info.gnrl_id,this.m_gnrlKey.gnrl_num=info.gnrl_num,this.m_need_gold=this.m_gnrlLimitInfo.need_expense;for(var lockList=[],unlockList=[],tempList=[],i=0;i<this.m_materialList.length;i++)1==this.m_materialList[i].is_lock?lockList.push(this.m_materialList[i]):unlockList.push(this.m_materialList[i]);lockList=stable(lockList,function(l,r){return this.m_isSortDesc?l.using_in_camp>r.using_in_camp:l.using_in_camp<r.using_in_camp}.bind(this)),lockList=stable(lockList,function(l,r){return this.m_isSortDesc?l.gnrl_type<r.gnrl_type:l.gnrl_type>r.gnrl_type}.bind(this)),unlockList=stable(unlockList,function(l,r){return this.m_isSortDesc?l.gnrl_type<r.gnrl_type:l.gnrl_type>r.gnrl_type}.bind(this)),unlockList=stable(unlockList,function(l,r){return this.m_isSortDesc?l.using_in_camp<r.using_in_camp:l.using_in_camp>r.using_in_camp}.bind(this));for(i=0;i<unlockList.length;i++)tempList.push(unlockList[i]);for(i=0;i<lockList.length;i++)tempList.push(lockList[i]);this.m_materialList=tempList,this.m_limit_over_only_card_list=[];var service=GeneralService.getInstance();this.m_limit_over_only_card_list=service.getLimitOverOnlyCardInfoList(this.m_gnrlInfo.rare_type,this.m_gnrlInfo.limit_step_id,this.m_gnrlInfo.gnrl_group)},getMaterialTableLayer:function(){var tableLayer=new TableViewLayer;return tableLayer.setContentSize(cc.size(447,413)),tableLayer.setItemCount(this.m_materialList.length),tableLayer.setColumnCount(4),tableLayer.getItemNode=function(index,contentSize,m){var materialItem=this.m_materialList[index],layer=new LimitOverMaterialItemLayer(materialItem);return this.m_materialLayers.push(layer),layer}.bind(this),tableLayer.initLayout(),tableLayer.onItemTouchBegin=function(index){return!0},tableLayer.onItemTouchMoved=function(isScroll){},tableLayer.onItemTouchCancel=function(index){return!0},tableLayer.onItemTouchEnd=function(index){var audio=AudioEngine.getInstance(),snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_card_touch.mp3";audio.playEffect(snd);var layer=this.m_materialLayers[index],info=layer.getGnrlInfo();if(info.is_lock||info.isPartner||info.is_friend_partner||info.using_in_camp||info.using_in_troops||info.using_in_great_wall_troops||info.using_in_search_troops||info.using_in_world_war_troops)return MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeLimitOverEnum.limit_over_material_not_selectable),!0;var general=MasterManager.getInstance().get_General(info.gnrl_id);return this.selectMaterialGeneral(general.gnrl_type,layer,info),this.checkEnableLimitOver(),!0}.bind(this),tableLayer},selectMaterialGeneral:function(gnrl_type,layer,info){layer.getGnrlInfo();if(gnrl_type!=GENERAL_TYPE_LIMIT_OVER)if(this.m_need_mtrl_count=1,layer.isSelectCard()){for(idx=0;idx<this.m_materialLayers.length;idx++){(item=this.m_materialLayers[idx]).unSelectCard()}this.removeMaterialGeneral(gnrl_type,info)}else{for(var idx=0;idx<this.m_materialLayers.length;idx++){(item=this.m_materialLayers[idx]).unSelectCard()}layer.selectCard(),this.addMaterailGeneral(gnrl_type,info)}else{for(var i=0;i<this.m_limit_over_only_card_list.length;i++)if(this.m_limit_over_only_card_list[i].need_mtrl_gnrl_id==info.gnrl_id){this.m_need_mtrl_count=this.m_limit_over_only_card_list[i].need_count;break}for(idx=0;idx<this.m_mtrl_keys.length;idx++)if(this.m_mtrl_keys[idx].gnrl_id!=info.gnrl_id){this.m_mtrl_keys=[];for(var jdx=0;jdx<this.m_materialLayers.length;jdx++)this.m_materialLayers[jdx].unSelectCard();break}if(layer.isSelectCard())layer.unSelectCard(),this.removeMaterialGeneral(gnrl_type,info);else{var mt=MasterManager.getInstance();if(this.m_mtrl_keys=this.m_mtrl_keys.filter(function(l){return mt.get_General(l.gnrl_id).gnrl_type==GENERAL_TYPE_LIMIT_OVER}),this.m_need_mtrl_count<=this.m_mtrl_keys.length)return void MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeLevelUpEnum.max_material);for(idx=0;idx<this.m_materialLayers.length;idx++){var item=this.m_materialLayers[idx];mt.get_General(item.getGnrlInfo().gnrl_id).gnrl_type!=GENERAL_TYPE_LIMIT_OVER&&item.unSelectCard()}layer.selectCard(),this.addMaterailGeneral(gnrl_type,info)}}},setReloadData:function(){for(var i=0;i<this.m_materialLayers.length;i++)this.m_materialLayers[i].unSelectCard();this.m_mtrl_keys=[],this.m_need_mtrl_count_label.setString(""),null!=this.m_select_card_sprite&&(this.m_select_card_sprite.removeFromParent(),this.m_select_card_sprite=null),this.checkEnableLimitOver()},checkEnableLimitOver:function(){var isEnabled=!1;if(0<this.m_mtrl_keys.length){var mt=MasterManager.getInstance(),mtrl_gnrl_id=this.m_mtrl_keys[0].gnrl_id;mt.get_General(mtrl_gnrl_id).gnrl_type!=GENERAL_TYPE_LIMIT_OVER?1==this.m_mtrl_keys.length&&(isEnabled=!0):this.m_mtrl_keys.length==this.m_need_mtrl_count&&(isEnabled=!0)}if(isEnabled){this.m_limit_over_btn_mask.setVisible(!1),this.m_limit_over_btn.setEnabled(!0),this.m_select_1.setOpacity(255);var fadeout=new cc.FadeOut(1),fadein=new cc.FadeIn(1),seq=new cc.Sequence(fadeout,fadein),repeat=new cc.RepeatForever(seq);this.m_select_2.runAction(repeat)}else this.m_limit_over_btn_mask.setVisible(!0),this.m_limit_over_btn.setEnabled(!1),this.m_select_2.stopAllActions(),this.m_select_2.setOpacity(0),this.m_select_1.setOpacity(0);return isEnabled},addMaterailGeneral:function(gnrl_type,info){var max_mtrl_count=1;gnrl_type!=GENERAL_TYPE_LIMIT_OVER?this.m_mtrl_keys=[]:max_mtrl_count=this.m_need_mtrl_count;var key=new net.User_General_Key;key.gnrl_id=info.gnrl_id,key.gnrl_num=info.gnrl_num,this.m_mtrl_keys.push(key);var cardInfo={};cardInfo.gnrl_id=info.gnrl_id,cardInfo.level=info.gnrl_level,cardInfo.limit_step_id=info.limit_step_id,cardInfo.love_level=info.love_level,cardInfo.gender_type=info.gender_type,null!=this.m_select_card_sprite&&(this.m_select_card_sprite.removeFromParent(),this.m_select_card_sprite=null),this.m_select_card_sprite=(new Card).createCard(cardInfo,CARD_TYPE.type_common_card),this.m_select_card_sprite.setPosition(ccCenter(this.m_status_bg)),this.m_status_bg.addChild(this.m_select_card_sprite),this.m_need_mtrl_count_label.setString(this.m_mtrl_keys.length+"/"+max_mtrl_count)},removeMaterialGeneral:function(gnrl_type,info){if(gnrl_type!=GENERAL_TYPE_LIMIT_OVER)this.m_need_mtrl_count_label.setString(""),this.m_mtrl_keys=[],null!=this.m_select_card_sprite&&(this.m_select_card_sprite.removeFromParent(),this.m_select_card_sprite=null);else{for(var remove=[],remove_is=!1,i=0;i<this.m_mtrl_keys.length;i++){this.m_mtrl_keys[i].gnrl_num==info.gnrl_num&&(remove.push(i),remove_is=!0)}if(1==remove_is)for(i=remove.length-1;0<=i;i--)this.m_mtrl_keys.splice(remove[i],1);this.m_need_mtrl_count_label.setString(cmString("%d/%d",this.m_mtrl_keys.length,this.m_need_mtrl_count)),0==this.m_mtrl_keys.length&&(null!=this.m_select_card_sprite&&(this.m_select_card_sprite.removeFromParent(),this.m_select_card_sprite=null),this.m_need_mtrl_count_label.setString(""))}},getMaterialItemList:function(){return this.m_materialLayers},getMaterialGeneralKey:function(){return this.m_mtrl_keys},setLevelUpComplete:function(info,list){this.m_gnrlInfo=info,this.m_materialList=list},onEnter:function(){this._super()},isExistMaterial:function(){return 0!=this.m_mtrl_keys.length},onExit:function(){this._super(),0==this.getParent().getParent().getParent().getParent().m_isPopupShow&&this.limitOverLayerClear()}}),YunHeeDetailEnum={menu_yunhee:100,menu_sell:101,message_ok:102,message_buy_shop_gold_ok:103,message_buy_shop_jade_ok:104,btn_master_ability:105,btn_active_skill:106,btn_passive_skill:107,tab_yunhee_levelup:108,btn_yunhee_classup:109,tab_yunhee_love:110,tab_yunhee_detail:111,btn_not_enough_level:112,tab_yunhee_evolution:113,tab_yunhee_limit_over:114,tab_yunhee_rebirth:115,btn_max_class_type:116,btn_click_large_card:117},YunheeDetailLayer=cc.Layer.extend({m_gnrlInfo:null,m_detailBtn:null,m_levelUpBtn:null,m_classUpBtn:null,m_loveBtn:null,m_class_up_new:null,m_classUpBtnLayer:null,m_evolve_new:null,m_isVisibleClassUpBtnLayer:null,m_yunheeInfoLayer:null,m_gameObserver:null,m_progres_bar:null,m_progres_bar2:null,m_yunheeLoveItemLayer:null,m_yunheeLevelUpLayer:null,m_yunheeEvolutionLayer:null,m_yunheeLimitOverLayer:null,m_yunheeRebirthLayer:null,m_limit_over_new:null,m_rebirth_new:null,m_ddeffed_Reb:null,m_ddeffed_Evo:null,ctor:function(){this._super(),this.m_gnrlInfo=null,this.m_detailBtn=null,this.m_levelUpBtn=null,this.m_classUpBtnLayer=null,this.m_gnrlKey={gnrl_id:0,gnrl_num:0}},isExistLoveUpMaterial:function(){return this.m_yunheeLoveItemLayer.isExistMaterial()},isExistLevelUpMaterial:function(){return this.m_yunheeLevelUpLayer.isExistMaterial()},setLevelUpBtnEnable:function(bool){this.m_yunheeLevelUpLayer.setLevelUpBtnEnable(bool)},getLimitOverMaterialGeneralKey:function(){return this.m_yunheeLimitOverLayer.getMaterialGeneralKey()},getLevelUpNeedGold:function(){return this.m_yunheeLevelUpLayer.getLevelUpNeedGold()},isExistLevelupMtrlInSR:function(){return this.m_yunheeLevelUpLayer.isExistMtrlInSR()},getLoveUpNeedGold:function(){return this.m_yunheeLoveItemLayer.getLoveUpNeedGold()},isResistanceLayerEnabled:function(){return this.m_yunheeInfoLayer.isResistanceLayerEnabled()},getEvolveNeedGold:function(){return this.m_yunheeEvolutionLayer.getEvolveNeedGold()},getRebirthNeedGold:function(){return this.m_yunheeRebirthLayer.getRebirthNeedGold()},getEvolveMaterialList:function(){return this.m_yunheeEvolutionLayer.getEvolveMaterialList()},getEvolveMaterialInfo:function(index){return this.m_yunheeEvolutionLayer.getEvolveMaterialInfo(index)},setEvolveMaterialList:function(index,list){this.m_yunheeEvolutionLayer.setEvolveMaterialList(index,list)},getMaterialGeneralKey:function(){return this.m_yunheeLevelUpLayer.getMaterialGeneralKey()},isExistLimitOverMaterial:function(){return this.m_yunheeLimitOverLayer.isExistMaterial()},getLimitOverNeedGold:function(){return this.m_yunheeLimitOverLayer.getLimitOverNeedGold()},levelupMaterialSort:function(){this.m_yunheeLevelUpLayer.materialSort()},setLoveUpComplete:function(info,list){this.m_gnrlInfo=info,this.m_yunheeLoveItemLayer.setUserGeneralInfo(this.m_gnrlInfo,list),this.m_yunheeLoveItemLayer.setLoveUpComplte(),this.m_gnrlInfo.is_rebirth_object&&this.m_gnrlInfo.is_enable_rebirth&&this.m_class_up_new.setVisible(!0)},getLoveUpMaterialItemKey:function(){return this.m_yunheeLoveItemLayer.getLoveUpMaterailItemKey()},setLevelUpComplete:function(info){this.m_gnrlInfo=info;var mtrlGnrlList=[],generalService=GeneralService.getInstance();this.initLayoutProgress_circle(),this.scheduleOnce(function(float){var tab_type=this.m_yunheeLevelUpLayer.getLevelUpTabType();tab_type==YunheeLevelUpTapTypeEnum.tab_type_yunhee?generalService.getUserLevelUpMaterialList(this.m_gnrlKey,mtrlGnrlList):tab_type==YunheeLevelUpTapTypeEnum.tab_type_material&&generalService.getUserLevelUpMaterialList(this.m_gnrlKey,mtrlGnrlList,GENERAL_TYPE_MATERIAL),this.m_yunheeLevelUpLayer.setLevelUpComplete(this.m_gnrlInfo,mtrlGnrlList),this.removeLayerProgress_circle()},.3,"setLevelupLayer")},setLockButton:function(isLock){this.m_yunheeInfoLayer.setLockButton(isLock)},setEnableRebirthBtn:function(_enable){null!=this.m_yunheeRebirthLayer.m_rebirth_btn&&this.m_yunheeRebirthLayer.m_rebirth_btn.setEnabled(_enable)},setEnableEvolutionBtn:function(_enable){null!=this.m_yunheeEvolutionLayer.m_evolve_btn&&this.m_yunheeEvolutionLayer.m_evolve_btn.setEnabled(_enable)},setEnableLimitOverBtn:function(_enable){null!=this.m_yunheeLimitOverLayer.m_limit_over_btn&&this.m_yunheeLimitOverLayer.m_limit_over_btn.setEnabled(_enable)},initLayout:function(){if(this.m_gameObserver=MainObserver.getInstance(),this.setDetailLayer(),this.m_gnrlInfo.gnrl_type!=GENERAL_TYPE_MATERIAL&&this.m_gnrlInfo.gnrl_type!=GENERAL_TYPE_EVOLVE_MATERIAL&&this.m_gnrlInfo.gnrl_type!=GENERAL_TYPE_LIMIT_OVER){var rightBottomLayer=this.getRightBottomLayer();rightBottomLayer.ignoreAnchorPointForPosition(!1),rightBottomLayer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),rightBottomLayer.setPosition(this.width-11,15),this.addChild(rightBottomLayer,1)}},setDetailLayer:function(){null!=this.m_yunheeInfoLayer?(this.m_yunheeInfoLayer.setPosition(ccCenter(this)),this.m_yunheeInfoLayer.setVisible(!0),this.m_yunheeInfoLayer.setReloadData(this.m_gnrlInfo)):(this.m_yunheeInfoLayer=new YunheeInfoLayer,this.m_yunheeInfoLayer.setGeneralInfo(this.m_gnrlInfo),this.m_yunheeInfoLayer.initLayout(),this.m_yunheeInfoLayer.ignoreAnchorPointForPosition(!1),this.m_yunheeInfoLayer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_yunheeInfoLayer.setPosition(ccCenter(this)),this.addChild(this.m_yunheeInfoLayer))},showSkillInfoPopupLayer:function(){cc.log("Active Skill Info Popup3"),this.getParent().getParent().getParent().showSkillExplainPopup()},showPassiveInfoPopupLayer:function(){cc.log("Passive Skill Info Popup3"),this.getParent().getParent().getParent().showPassiveExplainPopup()},showLeaderSkillInfoPopupLayer:function(){cc.log("Passive Skill Info Popup3"),this.getParent().getParent().getParent().showLeaderSkillExplainPopup()},getRightBottomLayer:function(){var layer=new cc.Layer;return layer.setContentSize(456,78),this.m_detailBtn=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_detailBtn.setFont(LABEL_FONT_INDEX.FONT_241),this.m_detailBtn.setString("情報"),this.m_detailBtn.setAnchorPoint(ZERO()),this.m_detailBtn.setPosition(cc.p(6,1)),this.m_detailBtn.addClickEventListener(function(target){this.m_gameObserver.postNotification(sceneStr[scene_YunheeDetailScene],YunHeeDetailEnum.tab_yunhee_detail)}.bind(this)),layer.addChild(this.m_detailBtn),this.m_detailBtn.setEnabled(!1),this.m_detailBtn.setTutorialTag(TUTORIAL_TAG_PAGE_3_GNRL_INFO),this.m_levelUpBtn=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_levelUpBtn.setFont(LABEL_FONT_INDEX.FONT_241),this.m_levelUpBtn.setString("強化"),this.m_levelUpBtn.setAnchorPoint(ZERO()),this.m_levelUpBtn.setPosition(cc.p(this.m_detailBtn.x+this.m_detailBtn.width,1)),this.m_levelUpBtn.addClickEventListener(function(target){this.m_gameObserver.postNotification(sceneStr[scene_YunheeDetailScene],YunHeeDetailEnum.tab_yunhee_levelup)}.bind(this)),layer.addChild(this.m_levelUpBtn),this.m_levelUpBtn.setTutorialTag(TUTORIAL_TAG_PAGE_2_LEVEL_UP_TAB),this.m_loveBtn=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_loveBtn.setFont(LABEL_FONT_INDEX.FONT_241),this.m_loveBtn.setString("好感度"),this.m_loveBtn.setAnchorPoint(ZERO()),this.m_loveBtn.setPosition(cc.p(this.m_levelUpBtn.x+this.m_levelUpBtn.width,1)),this.m_loveBtn.addClickEventListener(function(target){this.m_gameObserver.postNotification(sceneStr[scene_YunheeDetailScene],YunHeeDetailEnum.tab_yunhee_love)}.bind(this)),layer.addChild(this.m_loveBtn),this.m_loveBtn.setTutorialTag(TUTORIAL_TAG_PAGE_3_LOVE_LEVEL_UP_TAB),this.m_classUpBtn=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_classUpBtn.setFont(LABEL_FONT_INDEX.FONT_241),this.m_classUpBtn.setString("昇級"),this.m_classUpBtn.setAnchorPoint(ZERO()),this.m_classUpBtn.setPosition(cc.p(this.m_loveBtn.x+this.m_loveBtn.width,1)),this.m_classUpBtn.addClickEventListener(function(target){this.m_gameObserver.postNotification(sceneStr[scene_YunheeDetailScene],YunHeeDetailEnum.btn_yunhee_classup)}.bind(this)),layer.addChild(this.m_classUpBtn),this.m_class_up_new=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new_evolve.png"),this.m_class_up_new.setPosition(this.m_classUpBtn.width-5,this.m_classUpBtn.height-5),this.m_classUpBtn.addChild(this.m_class_up_new),this.m_class_up_new.setVisible(!1),(this.m_gnrlInfo.isEnabledEvolve||this.m_gnrlInfo.isEnabledLimitOver||this.m_gnrlInfo.is_enable_rebirth)&&this.m_class_up_new.setVisible(!0),this.m_classUpBtnLayer=this.getClassUpBtnLayer(),this.m_classUpBtnLayer.setPosition(this.m_classUpBtn.x,this.m_classUpBtn.y+this.m_classUpBtn.height),layer.addChild(this.m_classUpBtnLayer),this.m_classUpBtnLayer.setVisible(!1),layer},getClassUpBtnLayer:function(){var layer=new cc.Layer,evolutionBtn=(MasterManager.getInstance(),new LabelButton("btn_01_off.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE));evolutionBtn.setFont(LABEL_FONT_INDEX.FONT_241),evolutionBtn.setString("進化"),evolutionBtn.setAnchorPoint(ZERO()),evolutionBtn.setPosition(ZERO()),evolutionBtn.addClickEventListener(function(target){this.m_gameObserver.postNotification(sceneStr[scene_YunheeDetailScene],YunHeeDetailEnum.tab_yunhee_evolution)}.bind(this)),layer.addChild(evolutionBtn,3);var limitOverBtn=new LabelButton("btn_01_off.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE);if(limitOverBtn.setFont(LABEL_FONT_INDEX.FONT_241),limitOverBtn.setString("限界突破"),limitOverBtn.setAnchorPoint(ZERO()),limitOverBtn.setPosition(cc.p(0,evolutionBtn.height)),limitOverBtn.addClickEventListener(function(target){this.m_gameObserver.postNotification(sceneStr[scene_YunheeDetailScene],YunHeeDetailEnum.tab_yunhee_limit_over)}.bind(this)),layer.addChild(limitOverBtn,2),this.m_evolve_new=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new_evolve.png"),this.m_evolve_new.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_evolve_new.setPosition(ccWidth(evolutionBtn)-5,ccHeight(evolutionBtn)-8),evolutionBtn.addChild(this.m_evolve_new),this.m_evolve_new.setVisible(!1),this.m_limit_over_new=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new_evolve.png"),this.m_limit_over_new.setPosition(limitOverBtn.width-5,ccHeight(limitOverBtn)-8),limitOverBtn.addChild(this.m_limit_over_new),this.m_limit_over_new.setVisible(!1),this.m_gnrlInfo.is_rebirth_object){var rebirth_Btn=new LabelButton("btn_01_off.png","btn_01_on.png","btn_01_none.png",ccui.Widget.PLIST_TEXTURE);rebirth_Btn.setFont(LABEL_FONT_INDEX.FONT_241),rebirth_Btn.setString(res_str("btn_label_rebirth")),rebirth_Btn.setAnchorPoint(ZERO()),rebirth_Btn.setPosition(0,ccPosY(limitOverBtn)+ccHeight(limitOverBtn)),rebirth_Btn.addClickEventListener(function(sender){var count_func=MasterManager.getInstance().get_CountFunction(COUNT_FUNCTION_GENERAL_MAX_CLASS_TYPE);if(this.m_gnrlInfo.class_type<count_func.value)return this.m_gameObserver.postNotification(sceneStr[scene_YunheeDetailScene],YunheeRebirthEnum.btn_impossible_rerirth),void this.setClassUpButton();this.m_gameObserver.postNotification(sceneStr[scene_YunheeDetailScene],YunHeeDetailEnum.tab_yunhee_rebirth)}.bind(this)),layer.addChild(rebirth_Btn),this.m_rebirth_new=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new_evolve.png"),this.m_rebirth_new.setPosition(ccWidth(rebirth_Btn)-5,ccHeight(rebirth_Btn)-8),rebirth_Btn.addChild(this.m_rebirth_new),this.m_rebirth_new.setVisible(!1),layer.setContentSize(ccWidth(evolutionBtn),3*ccHeight(evolutionBtn))}else layer.setContentSize(ccWidth(evolutionBtn),2*ccHeight(evolutionBtn));return layer},setClassUpButton:function(){this.m_isVisibleClassUpBtnLayer?(this.m_classUpBtn.setString("昇級"),this.m_classUpBtnLayer.setVisible(!1),this.m_isVisibleClassUpBtnLayer=!1,(this.m_gnrlInfo.isEnabledEvolve||this.m_gnrlInfo.isEnabledLimitOver||this.m_gnrlInfo.is_enable_rebirth)&&this.m_class_up_new.setVisible(!0)):(this.m_classUpBtn.setString("取消"),this.m_classUpBtnLayer.setVisible(!0),this.m_isVisibleClassUpBtnLayer=!0,this.m_class_up_new.setVisible(!1),this.m_gnrlInfo.isEnabledEvolve&&this.m_evolve_new.setVisible(!0),this.m_gnrlInfo.isEnabledLimitOver&&this.m_limit_over_new.setVisible(!0),this.m_gnrlInfo.is_enable_rebirth&&this.m_rebirth_new.setVisible(!0))},checkEvolveNewIcon:function(){(this.m_gnrlInfo.isEnabledEvolve||this.m_gnrlInfo.isEnabledLimitOver||this.m_gnrlInfo.is_enable_rebirth)&&this.m_class_up_new.setVisible(!0)},setTabButton:function(index){switch(null!=this.m_loveBtn&&this.m_loveBtn.setEnabled(!0),null!=this.m_detailBtn&&this.m_detailBtn.setEnabled(!0),null!=this.m_levelUpBtn&&this.m_levelUpBtn.setEnabled(!0),null!=this.m_classUpBtn&&this.m_classUpBtn.setEnabled(!0),null!=this.m_classUpBtnLayer&&this.m_classUpBtnLayer.setVisible(!1),this.m_isVisibleClassUpBtnLayer=!1,index==YunHeeDetailEnum.tab_yunhee_levelup?(this.initLayoutProgress_circle(),this.m_levelUpBtn.setEnabled(!1),this.m_classUpBtn.setString(res_str("btn_label_class_up")),this.m_gnrlInfo.isEnabledEvolve||this.m_gnrlInfo.isEnabledLimitOver||this.m_gnrlInfo.is_enable_rebirth?this.m_class_up_new.setVisible(!0):this.m_class_up_new.setVisible(!1),this.scheduleOnce(function(float){this.setLevelupLayer(),null!=this.m_yunheeInfoLayer&&(this.m_yunheeInfoLayer.removeAllChildrenWithCleanup(!0),this.m_yunheeInfoLayer.removeFromParent(),this.m_yunheeInfoLayer=null),null!=this.m_yunheeLoveItemLayer&&(this.m_yunheeLoveItemLayer.removeAllChildrenWithCleanup(!0),this.m_yunheeLoveItemLayer.removeFromParent(),this.m_yunheeLoveItemLayer=null),null!=this.m_yunheeEvolutionLayer&&(this.m_yunheeEvolutionLayer.removeAllChildrenWithCleanup(!0),this.m_yunheeEvolutionLayer.removeFromParent(),this.m_yunheeEvolutionLayer=null),null!=this.m_yunheeLimitOverLayer&&(this.m_yunheeLimitOverLayer.limitOverLayerClear(),this.m_yunheeLimitOverLayer.removeAllChildrenWithCleanup(!0),this.m_yunheeLimitOverLayer.removeFromParent(),this.m_yunheeLimitOverLayer=null),null!=this.m_yunheeRebirthLayer&&(this.m_yunheeRebirthLayer.removeAllChildrenWithCleanup(!0),this.m_yunheeRebirthLayer.removeFromParent(),this.m_yunheeRebirthLayer=null),this.removeLayerProgress_circle()},.3,"setLevelupLayer")):(null!=this.m_yunheeInfoLayer&&(this.m_yunheeInfoLayer.removeAllChildrenWithCleanup(!0),this.m_yunheeInfoLayer.removeFromParent(),this.m_yunheeInfoLayer=null),null!=this.m_yunheeLevelUpLayer&&(this.m_yunheeLevelUpLayer.removeAllChildrenWithCleanup(!0),this.m_yunheeLevelUpLayer.removeFromParent(),this.m_yunheeLevelUpLayer=null),null!=this.m_yunheeLoveItemLayer&&(this.m_yunheeLoveItemLayer.removeAllChildrenWithCleanup(!0),this.m_yunheeLoveItemLayer.removeFromParent(),this.m_yunheeLoveItemLayer=null),null!=this.m_yunheeEvolutionLayer&&(this.m_yunheeEvolutionLayer.removeAllChildrenWithCleanup(!0),this.m_yunheeEvolutionLayer.removeFromParent(),this.m_yunheeEvolutionLayer=null),null!=this.m_yunheeLimitOverLayer&&(this.m_yunheeLimitOverLayer.limitOverLayerClear(),this.m_yunheeLimitOverLayer.removeAllChildrenWithCleanup(!0),this.m_yunheeLimitOverLayer.removeFromParent(),this.m_yunheeLimitOverLayer=null),null!=this.m_yunheeRebirthLayer&&(this.m_yunheeRebirthLayer.removeAllChildrenWithCleanup(!0),this.m_yunheeRebirthLayer.removeFromParent(),this.m_yunheeRebirthLayer=null)),index){case YunHeeDetailEnum.tab_yunhee_detail:null!=this.m_detailBtn&&this.m_detailBtn.setEnabled(!1),null!=this.m_classUpBtn&&this.m_classUpBtn.setString("昇級"),(this.m_gnrlInfo.isEnabledEvolve||this.m_gnrlInfo.isEnabledLimitOver||this.m_gnrlInfo.is_enable_rebirth)&&null!=this.m_class_up_new&&this.m_class_up_new.setVisible(!0),this.setDetailLayer();break;case YunHeeDetailEnum.tab_yunhee_evolution:this.m_classUpBtn.setEnabled(!1),this.m_classUpBtn.setString("進化"),this.setEvolutionLayer(),this.m_gnrlInfo.isEnabledEvolve?this.m_class_up_new.setVisible(!0):this.m_class_up_new.setVisible(!1);break;case YunHeeDetailEnum.tab_yunhee_limit_over:this.m_classUpBtn.setEnabled(!1),this.m_classUpBtn.setString("限界突破"),this.setLimitOverLayer(),this.m_gnrlInfo.isEnabledLimitOver?this.m_class_up_new.setVisible(!0):this.m_class_up_new.setVisible(!1);break;case YunHeeDetailEnum.tab_yunhee_rebirth:this.m_classUpBtn.setEnabled(!1),this.m_classUpBtn.setString(res_str("btn_label_rebirth")),this.setRebirthLayer(),this.m_gnrlInfo.is_enable_rebirth?this.m_class_up_new.setVisible(!0):this.m_class_up_new.setVisible(!1);break;case YunHeeDetailEnum.tab_yunhee_love:this.m_loveBtn.setEnabled(!1),this.m_classUpBtn.setString(res_str("btn_label_class_up")),this.m_gnrlInfo.isEnabledEvolve||this.m_gnrlInfo.isEnabledLimitOver?this.m_class_up_new.setVisible(!0):this.m_class_up_new.setVisible(!1),this.setLoveLayer()}},setEvolutionLayer:function(){var generalService=GeneralService.getInstance(),g=generalService.getEvolutionGnrlInfo(this.m_gnrlInfo),evolveInfoList=[],need_gold=generalService.getGeneralEvolutionInfo(this.m_gnrlInfo.evolution_mtrl_num,evolveInfoList,need_gold);this.initLayoutProgress(255),this.m_ddeffed_Evo=null;var setAddChild=!1;null!=this.m_yunheeEvolutionLayer?(this.m_ddeffed_Evo=this.m_yunheeEvolutionLayer.get_deferred(),this.m_yunheeEvolutionLayer.setPosition(ccCenter(this)),this.m_yunheeEvolutionLayer.setVisible(!0),this.m_yunheeEvolutionLayer.setGeneralInfo(this.m_gnrlInfo,g,evolveInfoList,need_gold),this.m_yunheeEvolutionLayer.setReloadData()):(this.m_yunheeEvolutionLayer=new YunheeEvolutionLayer,this.m_ddeffed_Evo=this.m_yunheeEvolutionLayer.get_deferred(),this.m_yunheeEvolutionLayer.setGeneralInfo(this.m_gnrlInfo,g,evolveInfoList,need_gold),this.m_yunheeEvolutionLayer.initLayout(),this.m_yunheeEvolutionLayer.ignoreAnchorPointForPosition(!1),this.m_yunheeEvolutionLayer.setPosition(ccCenter(this)),setAddChild=!0),this.m_ddeffed_Evo.done(function(){this.removeLayerProgress(),1==setAddChild&&this.addChild(this.m_yunheeEvolutionLayer)}.bind(this))},initLayoutProgress:function(alpa){this.m_progres_bar=new cc.LayerColor(cc.color.BLACK),null==alpa&&(alpa=255),this.m_progres_bar.setOpacity(alpa),this.m_progres_bar.setContentSize(ccSize(this));var bg=cc.Sprite.create(RES_CM+"img_progress_bg.png");bg.setPosition(ccCenter(this));var bar=cc.Sprite.create(RES_CM+"img_progress_arrow.png");bar.setPosition(ccCenter(bg)),bg.addChild(bar,1000001),this.m_progres_bar.addChild(bg),this.addChild(this.m_progres_bar,1000001);var loading=new cc.Sprite(res.s_cm_img_text_loading);loading.setAnchorPoint(.5,0),loading.setPosition(ccCenter(bg).x,ccCenter(bg).y-100),loading.setOpacity(alpa),bg.addChild(loading,1000001);var mu=new cc.RotateBy(.1,30),seq=new cc.Sequence(mu),repeat=new cc.RepeatForever(seq);bar.runAction(repeat);var listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE});listener.onTouchBegan=function(touch,event){event.stopPropagation()}.bind(this),cc.eventManager.addListener(listener,this.m_progres_bar)},removeLayerProgress:function(){null!=this.m_progres_bar&&(this.removeChild(this.m_progres_bar),this.m_progres_bar=null)},initLayoutProgress_circle:function(alpa){if(!IS_NET_ERROR){this.m_progres_bar2=new cc.Layer,null==alpa&&(alpa=255),this.m_progres_bar2.setContentSize(ccSize(this));var bg=cc.Sprite.create(RES_CM+"img_progress_bg.png");bg.setPosition(ccCenter(this));var bar=cc.Sprite.create(RES_CM+"img_progress_arrow.png");bar.setPosition(ccCenter(bg)),bg.addChild(bar,1000001),this.m_progres_bar2.addChild(bg),this.addChild(this.m_progres_bar2,1000001);var loading=new cc.Sprite(RES_CM+"img_text_loading.png");loading.setAnchorPoint(.5,0),loading.setPosition(ccCenter(bg).x,ccCenter(bg).y-100),loading.setOpacity(alpa),bg.addChild(loading,1000001);var mu=new cc.RotateBy(.1,30),seq=new cc.Sequence(mu),repeat=new cc.RepeatForever(seq);bar.runAction(repeat);var listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE});listener.onTouchBegan=function(touch,event){event.stopPropagation()}.bind(this);var mouse_listener=cc.EventListener.create({event:cc.EventListener.MOUSE,onMouseScroll:function(event){event.stopPropagation()}.bind(this)});cc.eventManager.addListener(mouse_listener,this.m_progres_bar2),cc.eventManager.addListener(listener,this.m_progres_bar2)}},removeLayerProgress_circle:function(){null!=this.m_progres_bar2&&(this.removeChild(this.m_progres_bar2),this.m_progres_bar2=null)},setLimitOverLayer:function(){var gs=GeneralService.getInstance(),mtrlGnrlList=[],generalLimit=gs.getLimitOverInfo(this.m_gnrlInfo);gs.getUserLimitOverMaterialList(this.m_gnrlKey,mtrlGnrlList),null!=this.m_yunheeLimitOverLayer?(this.m_yunheeLimitOverLayer.setPosition(ccCenter(this)),this.m_yunheeLimitOverLayer.setVisible(!0),this.m_yunheeLimitOverLayer.setGeneralInfo(this.m_gnrlInfo,mtrlGnrlList,generalLimit),this.m_yunheeLimitOverLayer.setReloadData()):(this.m_yunheeLimitOverLayer=new YunheeLimitOverLayer,this.m_yunheeLimitOverLayer.setGeneralInfo(this.m_gnrlInfo,mtrlGnrlList,generalLimit),this.m_yunheeLimitOverLayer.initLayout(),this.m_yunheeLimitOverLayer.ignoreAnchorPointForPosition(!1),this.m_yunheeLimitOverLayer.setPosition(ccCenter(this)),this.addChild(this.m_yunheeLimitOverLayer))},setRebirthLayer:function(){var gs=GeneralService.getInstance(),g=gs.getEvolutionGnrlInfo(this.m_gnrlInfo),rebirthInfoList=[],need_gold=gs.getGeneralRebirthInfo(this.m_gnrlInfo.gnrl_group,rebirthInfoList);this.initLayoutProgress(255),this.m_ddeffed_Reb=null;var setAddChild=!1;null!=this.m_yunheeRebirthLayer?(this.m_ddeffed_Reb=this.m_yunheeRebirthLayer.get_deferred(),this.m_yunheeRebirthLayer.setPosition(ccCenter(this)),this.m_yunheeRebirthLayer.setGeneralInfo(this.m_gnrlInfo,g,rebirthInfoList,need_gold),this.m_yunheeRebirthLayer.setReloadData(),this.m_yunheeRebirthLayer.setVisible(!0)):(this.m_yunheeRebirthLayer=new YunheeRebirthLayer,this.m_ddeffed_Reb=this.m_yunheeRebirthLayer.get_deferred(),this.m_yunheeRebirthLayer.setGeneralInfo(this.m_gnrlInfo,g,rebirthInfoList,need_gold),this.m_yunheeRebirthLayer.initLayout(),this.m_yunheeRebirthLayer.ignoreAnchorPointForPosition(!1),this.m_yunheeRebirthLayer.setPosition(ccCenter(this)),setAddChild=!0),this.m_ddeffed_Reb.done(function(){this.removeLayerProgress(),1==setAddChild&&this.addChild(this.m_yunheeRebirthLayer)}.bind(this))},setUserGeneralInfo:function(info){this.m_gnrlInfo=info,this.m_gnrlKey.gnrl_id=info.gnrl_id,this.m_gnrlKey.gnrl_num=info.gnrl_num},setLevelupLayer:function(){this.mtrlGnrlList=[];var generalService=GeneralService.getInstance();TutorialContextV2.getInstance().IsCompleteAllTutorial()?generalService.getUserLevelUpMaterialList(this.m_gnrlKey,this.mtrlGnrlList,GENERAL_TYPE_MATERIAL):generalService.getUserLevelUpMaterialList(this.m_gnrlKey,this.mtrlGnrlList),GameDefault.getInstance().setYunheeLevelUpFlag(!0),null!=this.m_yunheeLevelUpLayer?(this.m_yunheeLevelUpLayer.setPosition(ccCenter(this)),this.m_yunheeLevelUpLayer.setVisible(!0),this.m_yunheeLevelUpLayer.setGeneralInfo(this.m_gnrlInfo,this.mtrlGnrlList),this.m_yunheeLevelUpLayer.setReloadData()):(YUNHEE_LEVELUP_LOAD_FLAG=!1,this.m_yunheeLevelUpLayer=new YunheeLevelUpLayer,this.m_yunheeLevelUpLayer.setGeneralInfo(this.m_gnrlInfo,this.mtrlGnrlList),this.m_yunheeLevelUpLayer.initLayout(),this.m_yunheeLevelUpLayer.ignoreAnchorPointForPosition(!1),this.m_yunheeLevelUpLayer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_yunheeLevelUpLayer.setPosition(ccCenter(this)),this.addChild(this.m_yunheeLevelUpLayer))},setLoveLayer:function(){var list=[];GeneralService.getInstance().getUserLoveItem(this.m_gnrlInfo.gnrl_group,list),null!=this.m_yunheeLoveItemLayer?(this.m_yunheeLoveItemLayer.setPosition(ccCenter(this)),this.m_yunheeLoveItemLayer.setVisible(!0),this.m_yunheeLoveItemLayer.setUserGeneralInfo(this.m_gnrlInfo,list),this.m_yunheeLoveItemLayer.setReloadData()):(this.m_yunheeLoveItemLayer=new YunheeLoveItemLayer,this.m_yunheeLoveItemLayer.setUserGeneralInfo(this.m_gnrlInfo,list),this.m_yunheeLoveItemLayer.initLayout(),this.m_yunheeLoveItemLayer.ignoreAnchorPointForPosition(!1),this.m_yunheeLoveItemLayer.setPosition(ccCenter(this)),this.addChild(this.m_yunheeLoveItemLayer))},setSelectedLoveItem:function(tag){this.m_yunheeLoveItemLayer.setSelectedLoveItem(tag)},checkEnableLimitOver:function(){return this.m_yunheeLimitOverLayer.checkEnableLimitOver()},setYunheeLevelUpTab:function(tab_type){var mtrlGnrlList=[];0==GameDefault.getInstance().getYunheeLevelUpFlag()?(this.initLayoutProgress_circle(),this.scheduleOnce(function(float){var generalService=GeneralService.getInstance();tab_type==YunheeLevelUpEnum.tab_yunhee?generalService.getUserLevelUpMaterialList(this.m_gnrlKey,mtrlGnrlList):tab_type==YunheeLevelUpEnum.tab_material&&generalService.getUserLevelUpMaterialList(this.m_gnrlKey,mtrlGnrlList,GENERAL_TYPE_MATERIAL),this.m_yunheeLevelUpLayer.setGeneralInfo(this.m_gnrlInfo,mtrlGnrlList),this.m_yunheeLevelUpLayer.setReloadTableView(tab_type),this.removeLayerProgress_circle()},.3,"setLevelupLayer")):(this.m_yunheeLevelUpLayer.setReloadTableView(tab_type),GameDefault.getInstance().setYunheeLevelUpFlag(!1))}}),message_not_enough_glod=2100,message_not_enough_point=2101,message_not_enough_property_point=2102,message_is_max_level=2013,message_formation_init=2104,message_show_help=2015,TAG_STAT_LV_LABEL=100,TAG_STAT_POINT_LABEL=150,TAG_POSITION_LEVELUP_COUNT=200,ContentListItem=cc.Layer.extend({m_isSelected:!1,m_position_type:0,m_selected_bg:null,m_selected_img:null,m_position_icon:null,ctor:function(user_formation,position_type){this._super(),this.initLayout(user_formation,position_type)},getPositionType:function(){return this.m_position_type},initLayout:function(user_formation,position_type){this.m_position_type=position_type;var box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());box.setAnchorPoint(ZERO()),box.setPosition(ZERO()),box.setContentSize(444,96),this.addChild(box),this.setContentSize(ccSize(box)),this.m_position_icon=this.getPositionIconSprite(position_type),this.m_position_icon.setAnchorPoint(ZERO()),this.m_position_icon.setPosition(4,5),box.addChild(this.m_position_icon);var cri_damage_label=cmLabel.getLabel("会心上昇率",LABEL_FONT_INDEX.FONT_1812);cri_damage_label.setAnchorPoint(ZERO()),cri_damage_label.setPosition(100,15),box.addChild(cri_damage_label);var cri_prcnt_label=cmLabel.getLabel("会心発動率",LABEL_FONT_INDEX.FONT_1812);cri_prcnt_label.setAnchorPoint(ZERO()),cri_prcnt_label.setPosition(268,40),box.addChild(cri_prcnt_label);var hp_label=cmLabel.getLabel("体力",LABEL_FONT_INDEX.FONT_1812);hp_label.setAnchorPoint(ZERO()),hp_label.setPosition(100,40),box.addChild(hp_label);var def_label=cmLabel.getLabel("防御力",LABEL_FONT_INDEX.FONT_1812);def_label.setAnchorPoint(ZERO()),def_label.setPosition(268,64),box.addChild(def_label);var attk_label=cmLabel.getLabel("攻撃力",LABEL_FONT_INDEX.FONT_1812);attk_label.setAnchorPoint(ZERO()),attk_label.setPosition(100,64),box.addChild(attk_label);var user_attk=cmLabel.getLabel(this.getFormationValue(user_formation,position_type,COMBO_STAT_ATTK).toFixed(1)+"%",LABEL_FONT_INDEX.FONT_181);user_attk.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),user_attk.setPosition(254,64),box.addChild(user_attk);var user_def=cmLabel.getLabel(this.getFormationValue(user_formation,position_type,COMBO_STAT_DEF).toFixed(1)+"%",LABEL_FONT_INDEX.FONT_181);user_def.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),user_def.setPosition(423,64),box.addChild(user_def);var user_hp=cmLabel.getLabel(this.getFormationValue(user_formation,position_type,COMBO_STAT_HP).toFixed(1)+"%",LABEL_FONT_INDEX.FONT_181);user_hp.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),user_hp.setPosition(254,40),box.addChild(user_hp);var user_cri_prcnt=cmLabel.getLabel(this.getFormationValue(user_formation,position_type,COMBO_STAT_CRI_PRCNT).toFixed(1)+"%",LABEL_FONT_INDEX.FONT_181);user_cri_prcnt.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),user_cri_prcnt.setPosition(423,40),box.addChild(user_cri_prcnt);var user_cri_damage=cmLabel.getLabel(this.getFormationValue(user_formation,position_type,COMBO_STAT_CRI_DMG).toFixed(1)+"%",LABEL_FONT_INDEX.FONT_181);return user_cri_damage.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),user_cri_damage.setPosition(254,15),box.addChild(user_cri_damage),position_type==POSITION_TYPE_HEAD?user_def.setColor(COLOR(1810)):position_type==POSITION_TYPE_MID_1?user_hp.setColor(COLOR(1810)):position_type==POSITION_TYPE_MID_2?user_attk.setColor(COLOR(1810)):position_type==POSITION_TYPE_BACK_1?user_cri_prcnt.setColor(COLOR(1810)):position_type==POSITION_TYPE_BACK_2&&user_cri_damage.setColor(COLOR(1810)),this.m_selected_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_1.png",RectZero()),this.m_selected_bg.setAnchorPoint(ZERO()),this.m_selected_bg.setContentSize(ccSize(box)),this.m_selected_bg.setPosition(ZERO()),box.addChild(this.m_selected_bg),this.m_selected_bg.setOpacity(0),this.m_selected_img=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_2.png",RectZero()),this.m_selected_img.setAnchorPoint(ZERO()),this.m_selected_img.setContentSize(ccSize(box)),this.m_selected_img.setPosition(ZERO()),box.addChild(this.m_selected_img),this.m_selected_img.setOpacity(0),!0},getPositionIconSprite:function(position_type){var bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_formation/img_formation_ic.png"),formation_ic=cc.Sprite.create(RES_CDN_DEFULT+"menu_formation/img_formation_ic_position_front.png");formation_ic.setAnchorPoint(ZERO()),bg.addChild(formation_ic);var name_label,position_name=GeneralService.getInstance().getYunheePostionName(position_type);IS_SP_BROWSER?((name_label=cmLabel.getLabel(position_name,LABEL_FONT_INDEX.FONT_165)).setAnchorPoint(ZERO()),name_label.setPosition(8,65),name_label.enableOutline(cc.color.BLACK,2),bg.addChild(name_label)):((name_label=cmLabel.getLabel(position_name,LABEL_FONT_INDEX.FONT_1415)).setAnchorPoint(ZERO()),name_label.setPosition(8,65),bg.addChild(name_label));switch(position_type){case POSITION_TYPE_HEAD:formation_ic.setPosition(58,26);break;case POSITION_TYPE_MID_1:name_label.setColor(cc.color(27,222,119)),formation_ic.setTexture(RES_CDN_DEFULT+"menu_formation/img_formation_ic_position_center.png"),formation_ic.setPosition(34,41);break;case POSITION_TYPE_MID_2:name_label.setColor(cc.color(27,222,119)),formation_ic.setTexture(RES_CDN_DEFULT+"menu_formation/img_formation_ic_position_center.png"),formation_ic.setPosition(34,11);break;case POSITION_TYPE_BACK_1:name_label.setColor(cc.color(8,152,252)),formation_ic.setTexture(RES_CDN_DEFULT+"menu_formation/img_formation_ic_position_back.png"),formation_ic.setPosition(10,41);break;case POSITION_TYPE_BACK_2:name_label.setColor(cc.color(8,152,252)),formation_ic.setTexture(RES_CDN_DEFULT+"menu_formation/img_formation_ic_position_back.png"),formation_ic.setPosition(10,11)}return bg},getFormationValue:function(user_formation,position_type,combo_stat){for(var keys=user_formation.keys(),iter=0;iter<keys.length;iter++)if(user_formation.at(keys[iter]).position_type==position_type&&user_formation.at(keys[iter]).combo_stat==combo_stat){var value=GeneralService.getInstance().getBattleFormationValue(user_formation.at(keys[iter]).formation_id);return user_formation.at(keys[iter]).combo_stat!=COMBO_STAT_CRI_PRCNT&&user_formation.at(keys[iter]).combo_stat!=COMBO_STAT_CRI_DMG||(value/=100),value}return keys=null,0},setClickButton:function(){this.m_selected_bg.setOpacity(255);var fadeIn=new cc.FadeIn(.7),fadeOut=new cc.FadeOut(.7),seq=new cc.Sequence(fadeIn,fadeOut),repeat=new cc.RepeatForever(seq);this.m_selected_img.runAction(repeat),this.m_isSelected=!0,repeat=seq=fadeOut=fadeIn=null},setNormalButton:function(){this.m_selected_bg.setOpacity(0),this.m_selected_img.stopAllActions(),this.m_selected_img.setOpacity(0),this.m_isSelected=!1},onExit:function(){this._super(),1!=PREV_HELP&&1!=FORMATION_SHOP_FLAG&&(this.m_selected_bg=null,this.m_selected_img=null,this.m_isSelected=null,this.m_position_icon=null,delete this.m_selected_bg,delete this.m_selected_img,delete this.m_isSelected,delete this.m_position_icon,this.removeAllChildrenWithCleanup(!0))}}),PositionButtonLayer=cc.Layer.extend({m_isSelected:!1,m_selected_bg:null,m_selected_img:null,m_button:null,ctor:function(position_type){this._super(),this.initLayout(position_type)},initLayout:function(position_type){var icon=RES_CDN_DEFULT+"menu_formation/img_formation_frame_front.png";position_type==POSITION_TYPE_MID_1||position_type==POSITION_TYPE_MID_2?icon=RES_CDN_DEFULT+"menu_formation/img_formation_frame_center.png":position_type!=POSITION_TYPE_BACK_1&&position_type!=POSITION_TYPE_BACK_2||(icon=RES_CDN_DEFULT+"menu_formation/img_formation_frame_back.png"),this.m_button=new ccui.Button,this.m_button.loadTextures(icon,icon),this.m_button.setAnchorPoint(ZERO()),this.m_button.setPosition(ZERO()),this.m_button.setTag(position_type),this.addChild(this.m_button),this.setContentSize(ccSize(this.m_button)),this.m_button.addClickEventListener(function(sender){this.m_isSelected;var tag=sender.getTag();MainObserver.getInstance().postNotification(NOTIFICATION_POSTION_BUTTON,tag)});var name_label,levelup_count_title_label,position_name=GeneralService.getInstance().getYunheePostionName(position_type);IS_SP_BROWSER?((name_label=cmLabel.getLabel(position_name,LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ZERO()),name_label.enableOutline(cc.color.BLACK,2),name_label.setPosition(74,42),this.m_button.addChild(name_label),(levelup_count_title_label=cmLabel.getLabel("強化回数",LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ZERO()),levelup_count_title_label.enableOutline(cc.color.BLACK,2),levelup_count_title_label.setPosition(74,22),this.m_button.addChild(levelup_count_title_label)):((name_label=cmLabel.getLabel(position_name,LABEL_FONT_INDEX.FONT_161)).setAnchorPoint(ZERO()),name_label.setPosition(74,47),this.m_button.addChild(name_label),(levelup_count_title_label=cmLabel.getLabel("強化回数",LABEL_FONT_INDEX.FONT_161)).setAnchorPoint(ZERO()),levelup_count_title_label.setPosition(74,27),this.m_button.addChild(levelup_count_title_label));return this.m_selected_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_1.png",RectZero()),this.m_selected_bg.setAnchorPoint(ZERO()),this.m_selected_bg.setContentSize(ccSize(this.m_button)),this.m_selected_bg.setPosition(ZERO()),this.m_button.addChild(this.m_selected_bg),this.m_selected_bg.setOpacity(0),this.m_selected_img=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_2.png",RectZero()),this.m_selected_img.setAnchorPoint(ZERO()),this.m_selected_img.setContentSize(ccSize(this.m_button)),this.m_selected_img.setPosition(ZERO()),this.m_button.addChild(this.m_selected_img),this.m_selected_img.setOpacity(0),!(icon=position_name=null)},setClickButton:function(){this.m_selected_bg.setOpacity(255);var fadeIn=new cc.FadeIn(.7),fadeOut=new cc.FadeOut(.7),seq=new cc.Sequence(fadeIn,fadeOut),repeat=new cc.RepeatForever(seq);this.m_selected_img.runAction(repeat),this.m_isSelected=!0,repeat=seq=fadeOut=fadeIn=null},setNormalButton:function(){this.m_selected_bg.setOpacity(0),this.m_selected_img.stopAllActions(),this.m_selected_img.setOpacity(0),this.m_isSelected=!1},onExit:function(){this._super(),1!=PREV_HELP&&1!=FORMATION_SHOP_FLAG&&(this.m_isSelected=null,this.m_selected_bg=null,this.m_selected_img=null,this.m_button=null,delete this.m_isSelected,delete this.m_selected_bg,delete this.m_selected_img,delete this.m_button,this.removeAllChildrenWithCleanup(!0))}}),StatButtonLayer=cc.Layer.extend({m_isSelected:!1,m_selected_bg:null,m_selected_img:null,ctor:function(combo_stat){this._super(),this.initLayout(combo_stat)},initLayout:function(combo_stat){var icon=cc.Sprite.create("#img_formation_"+leadingZeros(combo_stat,2)+".png"),button=new ccui.Button;button.loadTextures(RES_CDN_DEFULT+"icon/img_icon_frame.png",RES_CDN_DEFULT+"icon/img_icon_frame.png",""),button.setAnchorPoint(ZERO()),button.setPosition(ZERO()),button.setTag(combo_stat),button.addChild(icon),this.addChild(button),this.setContentSize(ccSize(button)),button.addClickEventListener(function(sender){if(!this.m_isSelected){var tag=sender.getTag();MainObserver.getInstance().postNotification(NOTIFICATION_STAT_BUTTON,tag)}}),icon.setAnchorPoint(.5,.5),icon.setPosition(button.width/2,button.height/2),this.m_selected_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_1.png",RectZero()),this.m_selected_bg.setAnchorPoint(ZERO()),this.m_selected_bg.setContentSize(ccSize(button)),this.m_selected_bg.setPosition(ZERO()),button.addChild(this.m_selected_bg),this.m_selected_bg.setOpacity(0),this.m_selected_img=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_2.png",RectZero()),this.m_selected_img.setAnchorPoint(ZERO()),this.m_selected_img.setContentSize(ccSize(button)),this.m_selected_img.setPosition(ZERO()),button.addChild(this.m_selected_img),this.m_selected_img.setOpacity(0);var level_bg=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_valuebox_3.png");return level_bg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),level_bg.setPosition(ccCenter(button).x,-43),button.addChild(level_bg),!0},setClickButton:function(){if(!this.m_isSelected){this.m_selected_bg.setOpacity(255);var fadeIn=new cc.FadeIn(.7),fadeOut=new cc.FadeOut(.7),seq=new cc.Sequence(fadeIn,fadeOut),repeat=new cc.RepeatForever(seq);this.m_selected_img.runAction(repeat),this.m_isSelected=!0,repeat=seq=fadeOut=fadeIn=null}},setNormalButton:function(){this.m_selected_bg.setOpacity(0),this.m_selected_img.stopAllActions(),this.m_selected_img.setOpacity(0),this.m_isSelected=!1},onExit:function(){this._super(),1!=PREV_HELP&&1!=FORMATION_SHOP_FLAG&&(this.m_isSelected=null,this.m_selected_bg=null,this.m_selected_img=null,delete this.m_isSelected,delete this.m_selected_bg,delete this.m_selected_img,this.removeAllChildrenWithCleanup(!0))}}),BattleFormationLayer=cc.Layer.extend({m_selected_position_type:1,m_selected_combo_stat:1,m_formation_id:0,m_need_gold_label:null,m_need_formation_point_label:null,m_is_not_enough_gold:!1,m_is_not_enough_point:!1,m_is_not_enough_property_point:!1,m_is_max_level:!1,m_contentListLayer:null,m_positionButtonLayer:null,m_statButtonLayer:null,m_leftBottomLayer:null,m_rightBoxLayer:null,m_arrow_img:null,m_property_icon:null,m_need_property_point_label:null,m_crrnt_value_label:null,m_after_value_label:null,m_user_formation_point_label:null,m_crrnt_value_label_2:null,m_after_value_label_2:null,m_property_title_label:null,m_battleFormations:null,m_map_stat_btn:[],m_contentItems:[],m_map_position_btn:[],ctor:function(){this._super(),this.m_selected_position_type=1,this.m_selected_combo_stat=1,this.m_formation_id=0,this.m_need_gold_label=null,this.m_need_formation_point_label=null,this.m_is_not_enough_gold=!1,this.m_is_not_enough_point=!1,this.m_is_not_enough_property_point=!1,this.m_is_max_level=!1,this.m_contentListLayer=null,this.m_positionButtonLayer=null,this.m_statButtonLayer=null,this.m_leftBottomLayer=null,this.m_rightBoxLayer=null,this.m_leftBoxLayer=null,this.m_arrow_img=null,this.m_property_icon=null,this.m_need_property_point_label=null,this.m_crrnt_value_label=null,this.m_after_value_label=null,this.m_user_formation_point_label=null,this.m_crrnt_value_label_2=null,this.m_after_value_label_2=null,this.m_property_title_label=null,this.m_battleFormations=null,this.m_map_stat_btn=[],this.m_map_position_btn=[],this.m_contentItems=[]},initLayout:function(){this.m_rightBoxLayer=this.getRightBoxLayer(),this.m_rightBoxLayer.ignoreAnchorPointForPosition(!1),this.m_rightBoxLayer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_rightBoxLayer.setPosition(ccWidth(this),0),this.addChild(this.m_rightBoxLayer,2),this.m_leftBoxLayer=this.getLeftBoxLayer(),this.m_leftBoxLayer.setAnchorPoint(ZERO()),this.m_leftBoxLayer.setPosition((ccWidth(this)-ccWidth(this.m_rightBoxLayer))/2-ccWidth(this.m_leftBoxLayer)/2,0),this.addChild(this.m_leftBoxLayer,2),this.setPositionInfo(POSITION_TYPE_HEAD)},getSelectedComboStat:function(){return this.m_selected_combo_stat},getSelectedPostionType:function(){return this.m_selected_position_type},setBattleFormations:function(battleFormations){this.m_battleFormations=battleFormations},getLeftBoxLayer:function(){var top_label,bottom_label,layer=new cc.Layer;(layer.setContentSize(481,640),IS_SP_BROWSER)?((top_label=cmLabel.getLabel("強化したい位置を選んでください。",LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),top_label.enableOutline(cc.color.BLACK,2),top_label.setPosition(ccCenter(layer).x,517),layer.addChild(top_label),(bottom_label=cmLabel.getLabel("強化したいステータスを選んでください。",LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bottom_label.enableOutline(cc.color.BLACK,2),bottom_label.setPosition(ccCenter(layer).x,311),layer.addChild(bottom_label)):((top_label=cmLabel.getLabel("強化したい位置を選んでください。",LABEL_FONT_INDEX.FONT_161)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),top_label.setPosition(ccCenter(layer).x,517),layer.addChild(top_label),(bottom_label=cmLabel.getLabel("強化したいステータスを選んでください。",LABEL_FONT_INDEX.FONT_161)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bottom_label.setPosition(ccCenter(layer).x,311),layer.addChild(bottom_label));var top_line=cc.Sprite.create(RES_CDN_DEFULT+"common/img_9p_line.png");top_line.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),top_line.setPosition(ccCenter(layer).x,508),top_line.setScaleX(460/ccWidth(top_line)),layer.addChild(top_line);var bottom_line=cc.Sprite.create(RES_CDN_DEFULT+"common/img_9p_line.png");bottom_line.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bottom_line.setPosition(ccCenter(layer).x,301),bottom_line.setScaleX(460/ccWidth(bottom_line)),layer.addChild(bottom_line);var positionlayer=this.getPositionButtonLayer();this.m_positionButtonLayer=positionlayer,this.m_positionButtonLayer.setPosition(0,345),layer.addChild(this.m_positionButtonLayer),positionlayer=null,IS_SP_BROWSER?this.m_statButtonLayer=this.getStatButtonLayer_SP(POSITION_TYPE_HEAD):this.m_statButtonLayer=this.getStatButtonLayer(POSITION_TYPE_HEAD),this.m_statButtonLayer.setPosition(0,201),layer.addChild(this.m_statButtonLayer),this.m_leftBottomLayer=this.getLeftBottomLayer(POSITION_TYPE_HEAD,COMBO_STAT_ATTK),this.m_leftBottomLayer.setPosition(ZERO()),layer.addChild(this.m_leftBottomLayer);var point_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero());point_bg.setContentSize(70,38),point_bg.setAnchorPoint(ZERO()),point_bg.setPosition(400,532),layer.addChild(point_bg);var formation_point_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_formation/img_formation_point.png");return formation_point_icon.setAnchorPoint(ZERO()),formation_point_icon.setPosition(-20,0),point_bg.addChild(formation_point_icon),IS_SP_BROWSER?(this.m_user_formation_point_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_227),this.m_user_formation_point_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_user_formation_point_label.enableOutline(cc.color.BLACK,2)):(this.m_user_formation_point_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2011),this.m_user_formation_point_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT())),this.m_user_formation_point_label.setPosition(ccWidth(point_bg)-10,ccCenter(point_bg).y),point_bg.addChild(this.m_user_formation_point_label),this.m_user_formation_point_label.setString(Number(NetService().get_User_formation_point()).toLocaleString("en")),layer},getLeftBottomLayer:function(position_type,combo_stat){var layer=new cc.Layer;layer.setContentSize(481,213);var value_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero());value_bg.setContentSize(460,38),value_bg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),value_bg.setPosition(ccCenter(layer).x,115),layer.addChild(value_bg),IS_SP_BROWSER?(this.m_property_title_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_228),this.m_property_title_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_property_title_label.enableOutline(cc.color.BLACK,2),this.m_property_title_label.setPosition(53,ccCenter(value_bg).y),value_bg.addChild(this.m_property_title_label),this.m_crrnt_value_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_221),this.m_crrnt_value_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_crrnt_value_label.enableOutline(cc.color.BLACK,2),this.m_crrnt_value_label.setPosition(147,ccCenter(value_bg).y),value_bg.addChild(this.m_crrnt_value_label),this.m_crrnt_value_label_2=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_201),this.m_crrnt_value_label_2.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_crrnt_value_label_2.enableOutline(cc.color.BLACK,2),this.m_crrnt_value_label_2.setPosition(ZERO()),value_bg.addChild(this.m_crrnt_value_label_2),this.m_after_value_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2031),this.m_after_value_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_after_value_label.setPosition(335,ccCenter(value_bg).y),value_bg.addChild(this.m_after_value_label),this.m_after_value_label_2=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1818),this.m_after_value_label_2.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_after_value_label_2.setPosition(ZERO()),value_bg.addChild(this.m_after_value_label_2),this.m_arrow_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_arrow_3.png"),this.m_arrow_img.setAnchorPoint(ANCHOR_MIDDLE()),this.m_arrow_img.setPosition(280,ccCenter(value_bg).y)):(this.m_property_title_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2029),this.m_property_title_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_property_title_label.setPosition(53,ccCenter(value_bg).y),value_bg.addChild(this.m_property_title_label),this.m_crrnt_value_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_201),this.m_crrnt_value_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_crrnt_value_label.setPosition(137,ccCenter(value_bg).y),value_bg.addChild(this.m_crrnt_value_label),this.m_crrnt_value_label_2=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_crrnt_value_label_2.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_crrnt_value_label_2.setPosition(ZERO()),value_bg.addChild(this.m_crrnt_value_label_2),this.m_after_value_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2031),this.m_after_value_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_after_value_label.setPosition(335,ccCenter(value_bg).y),value_bg.addChild(this.m_after_value_label),this.m_after_value_label_2=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1612),this.m_after_value_label_2.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_after_value_label_2.setPosition(ZERO()),value_bg.addChild(this.m_after_value_label_2),this.m_arrow_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_arrow_3.png"),this.m_arrow_img.setAnchorPoint(ANCHOR_MIDDLE()),this.m_arrow_img.setPosition(270,ccCenter(value_bg).y)),value_bg.addChild(this.m_arrow_img);var btn=new LabelButton("btn_03_off.png","btn_03_on.png","",ccui.Widget.PLIST_TEXTURE);btn.setFont(LABEL_FONT_INDEX.FONT_241),btn.setString("強化"),btn.setOffsetX(-160),btn.setAnchorPoint(ZERO()),btn.setPosition(18,45),layer.addChild(btn),btn.addClickEventListener(function(sender){this.m_is_not_enough_gold?MainObserver.getInstance().postNotification(sceneStr[scene_BattleFormationScene],message_not_enough_glod):this.m_is_not_enough_point?MainObserver.getInstance().postNotification(sceneStr[scene_BattleFormationScene],message_not_enough_point):this.m_is_not_enough_property_point?MainObserver.getInstance().postNotification(sceneStr[scene_BattleFormationScene],message_not_enough_property_point):this.m_is_max_level?MainObserver.getInstance().postNotification(sceneStr[scene_BattleFormationScene],message_is_max_level):MainObserver.getInstance().postNotification(NOTIFICATION_LEVELUP_BATTLE_FORMATION,this.m_formation_id)}.bind(this));var formation_point_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero());formation_point_bg.setContentSize(70,38),formation_point_bg.setAnchorPoint(ZERO()),formation_point_bg.setPosition(142,11),btn.addChild(formation_point_bg);var property_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero());property_bg.setContentSize(70,38),property_bg.setAnchorPoint(ZERO()),property_bg.setPosition(239,11),btn.addChild(property_bg);var gold_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero());gold_bg.setContentSize(100,38),gold_bg.setAnchorPoint(ZERO()),gold_bg.setPosition(324,11),btn.addChild(gold_bg);var formation_point_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_formation/img_formation_point.png");formation_point_icon.setAnchorPoint(ZERO()),formation_point_icon.setPosition(-20,0),formation_point_bg.addChild(formation_point_icon);var gold_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_sell_gold.png");gold_icon.setAnchorPoint(ZERO()),gold_icon.setPosition(-14,0),gold_bg.addChild(gold_icon);var formation_property_type=this.getPropertyType(combo_stat);this.m_property_icon=cc.Sprite.create("#img_formation_small_"+leadingZeros(formation_property_type,2)+".png"),this.m_property_icon.setAnchorPoint(ZERO()),this.m_property_icon.setPosition(-20,0),property_bg.addChild(this.m_property_icon),this.m_need_gold_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2011),this.m_need_gold_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_need_gold_label.setPosition(ccWidth(gold_bg)-10,ccCenter(gold_bg).y),gold_bg.addChild(this.m_need_gold_label),this.m_need_formation_point_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2011),this.m_need_formation_point_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_need_formation_point_label.setPosition(ccWidth(formation_point_bg)-10,ccCenter(formation_point_bg).y),formation_point_bg.addChild(this.m_need_formation_point_label),this.m_need_property_point_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2011),this.m_need_property_point_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_need_property_point_label.setPosition(ccWidth(property_bg)-10,ccCenter(property_bg).y),property_bg.addChild(this.m_need_property_point_label);var info_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_friend/img_friend_text.png");info_icon.setAnchorPoint(ZERO()),info_icon.setPosition(13,9),layer.addChild(info_icon);var info_label=cmLabel.getLabel("陣形共通PTはご主人様レベルUP時２PTずつ獲得します。",LABEL_FONT_INDEX.FONT_1613);return info_label.setAnchorPoint(ZERO()),info_label.setPosition(49,15),layer.addChild(info_label),layer},getPropertyType:function(combo_stat){switch(combo_stat){case COMBO_STAT_ATTK:return FORMATION_PROPERTY_TYPE_ATTK;case COMBO_STAT_DEF:return FORMATION_PROPERTY_TYPE_DEF;case COMBO_STAT_HP:return FORMATION_PROPERTY_TYPE_HP;case COMBO_STAT_CRI_PRCNT:return FORMATION_PROPERTY_TYPE_CRI_PRCNT;case COMBO_STAT_CRI_DMG:return FORMATION_PROPERTY_TYPE_CRI_DMG;default:return 0}},getStatButtonLayer_SP:function(position_type){var layer=new cc.Layer;layer.setContentSize(481,88);for(var property_point_str="",i=1;i<=5;++i){var combo_stat_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812);combo_stat_label.setAnchorPoint(ZERO()),combo_stat_label.enableOutline(cc.color.BLACK,2),layer.addChild(combo_stat_label);var plus_btn=new ccui.Button("btn_plus_2_off.png","btn_plus_2_off.png","",ccui.Widget.PLIST_TEXTURE);plus_btn.setAnchorPoint(ZERO()),layer.addChild(plus_btn);var combo_stat=0;1==i?(combo_stat_label.setString("攻撃力"),combo_stat_label.setPosition(10,71),combo_stat=COMBO_STAT_ATTK,property_point_str="攻P",plus_btn.setPosition(60,67)):2==i?(combo_stat_label.setString("防御力"),combo_stat_label.setPosition(108,71),combo_stat=COMBO_STAT_DEF,property_point_str="防P",plus_btn.setPosition(158,67)):3==i?(combo_stat_label.setString("体力"),combo_stat_label.setPosition(206,71),combo_stat=COMBO_STAT_HP,property_point_str="体P",plus_btn.setPosition(256,67)):4==i?(combo_stat_label.setString("会心発動率"),combo_stat_label.setPosition(283,71),combo_stat_label.setScale(.9),combo_stat=COMBO_STAT_CRI_PRCNT,property_point_str="確P",plus_btn.setPosition(354,67)):5==i&&(combo_stat_label.setString("会心上昇率"),combo_stat_label.setPosition(382,71),combo_stat_label.setScale(.9),combo_stat=COMBO_STAT_CRI_DMG,property_point_str="撃P",plus_btn.setPosition(452,67)),plus_btn.setTag(combo_stat),plus_btn.addClickEventListener(function(sender){var bonus_type=GeneralService.getInstance().getComboStatToBonusType(sender.getTag());MainObserver.getInstance().postNotification(NOTIFICATION_EVOLUTION_MTRL_SHORTCUTS,bonus_type),bonus_type=null});var btn=new StatButtonLayer(combo_stat);btn.setPosition(10+98*(i-1),0),layer.addChild(btn);var level_title_label=cmLabel.getLabel("Lv",LABEL_FONT_INDEX.FONT_181);level_title_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),level_title_label.setPosition(14,-25),level_title_label.enableOutline(cc.color.BLACK,2),btn.addChild(level_title_label);var level_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_227);level_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),level_label.setPosition(47,-28),level_label.enableOutline(cc.color.BLACK,2),level_label.setTag(TAG_STAT_LV_LABEL),btn.addChild(level_label);var property_title_label=cmLabel.getLabel(property_point_str,LABEL_FONT_INDEX.FONT_143);property_title_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),property_title_label.setPosition(15,-40),property_title_label.enableOutline(cc.color.BLACK,2),btn.addChild(property_title_label);var property_point_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1710);property_point_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),property_point_label.setTag(TAG_STAT_POINT_LABEL),property_point_label.enableOutline(cc.color.BLACK,2),property_point_label.setPosition(47,-43),btn.addChild(property_point_label),this.m_map_stat_btn[combo_stat]=btn,btn=null}return this.setPositionLevelUpCount(),property_point_str=null,layer},getStatButtonLayer:function(position_type){var layer=new cc.Layer;layer.setContentSize(481,88);for(var property_point_str="",i=1;i<=5;++i){var combo_stat_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1614);combo_stat_label.setAnchorPoint(ZERO()),layer.addChild(combo_stat_label);var plus_btn=new ccui.Button("btn_plus_2_off.png","btn_plus_2_off.png","",ccui.Widget.PLIST_TEXTURE);plus_btn.setAnchorPoint(ZERO()),layer.addChild(plus_btn);var combo_stat=0;1==i?(combo_stat_label.setString("攻撃力"),combo_stat_label.setPosition(10,71),combo_stat=COMBO_STAT_ATTK,property_point_str="攻P",plus_btn.setPosition(60,67)):2==i?(combo_stat_label.setString("防御力"),combo_stat_label.setPosition(108,71),combo_stat=COMBO_STAT_DEF,property_point_str="防P",plus_btn.setPosition(158,67)):3==i?(combo_stat_label.setString("体力"),combo_stat_label.setPosition(206,71),combo_stat=COMBO_STAT_HP,property_point_str="体P",plus_btn.setPosition(256,67)):4==i?(combo_stat_label.setString("会心発動率"),combo_stat_label.setPosition(283,71),combo_stat_label.setScale(.9),combo_stat=COMBO_STAT_CRI_PRCNT,property_point_str="確P",plus_btn.setPosition(354,67)):5==i&&(combo_stat_label.setString("会心上昇率"),combo_stat_label.setPosition(380,71),combo_stat_label.setScale(.9),combo_stat=COMBO_STAT_CRI_DMG,property_point_str="撃P",plus_btn.setPosition(452,67)),plus_btn.setTag(combo_stat),plus_btn.addClickEventListener(function(sender){var bonus_type=GeneralService.getInstance().getComboStatToBonusType(sender.getTag());MainObserver.getInstance().postNotification(NOTIFICATION_EVOLUTION_MTRL_SHORTCUTS,bonus_type),bonus_type=null});var btn=new StatButtonLayer(combo_stat);btn.setPosition(10+98*(i-1),0),layer.addChild(btn);var level_title_label=cmLabel.getLabel("Lv",LABEL_FONT_INDEX.FONT_143);level_title_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),level_title_label.setPosition(19,-20),btn.addChild(level_title_label);var level_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_144);level_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),level_label.setPosition(47,-20),level_label.setTag(TAG_STAT_LV_LABEL),btn.addChild(level_label);var property_title_label=cmLabel.getLabel(property_point_str,LABEL_FONT_INDEX.FONT_143);property_title_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),property_title_label.setPosition(19,-36),btn.addChild(property_title_label);var property_point_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_144);property_point_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),property_point_label.setTag(TAG_STAT_POINT_LABEL),property_point_label.setPosition(47,-36),btn.addChild(property_point_label),this.m_map_stat_btn[combo_stat]=btn,btn=null}return this.setPositionLevelUpCount(),property_point_str=null,layer},setContentItem:function(position_type){for(var idx=0;idx<this.m_contentItems.length;idx++)this.m_selected_position_type==this.m_contentItems[idx].getPositionType()?this.m_contentItems[idx].setClickButton():this.m_contentItems[idx].setNormalButton()},setPositionLevelUpCount:function(){for(var i=0;i<5;++i){var position_type=i+1,gs=GeneralService.getInstance(),max_lv_count=gs.getFormationMaxLevelUpCount(position_type),lv_count=gs.getUserFormationPositionLevelUpCount(position_type);this.m_map_position_btn[position_type].getChildByTag(TAG_POSITION_LEVELUP_COUNT).setString("("+lv_count+"/"+max_lv_count+")"),lv_count=max_lv_count=null}},setStatLevelInfo:function(position_type){for(var propertyPointInfo=UserService.getInstance().getUserFormationPropertyPointInfo(),keys=this.m_battleFormations.keys(),idx=0;idx<keys.length;idx++){var f=this.m_battleFormations.at(keys[idx]);if(f.position_type==position_type){var crrnt_level=GeneralService.getInstance().getFormationLevel(f.formation_id),label=this.m_map_stat_btn[f.combo_stat].getChildByTag(TAG_STAT_LV_LABEL);label.setString(crrnt_level),label=this.m_map_stat_btn[f.combo_stat].getChildByTag(TAG_STAT_POINT_LABEL),f.combo_stat==COMBO_STAT_ATTK?label.setString(Number(propertyPointInfo.attk_pt).toLocaleString("en")):f.combo_stat==COMBO_STAT_DEF?label.setString(Number(propertyPointInfo.def_pt).toLocaleString("en")):f.combo_stat==COMBO_STAT_HP?label.setString(Number(propertyPointInfo.hp_pt).toLocaleString("en")):f.combo_stat==COMBO_STAT_CRI_PRCNT?label.setString(Number(propertyPointInfo.cri_prcnt_pt).toLocaleString("en")):f.combo_stat==COMBO_STAT_CRI_DMG&&label.setString(Number(propertyPointInfo.cri_dmg_pt).toLocaleString("en"))}}keys=propertyPointInfo=null},getPositionButtonLayer:function(){var layer=new cc.Layer;layer.setContentSize(481,300);for(var i=0;i<5;++i){var position_type=i+1,btn=new PositionButtonLayer(position_type);layer.addChild(btn),this.m_map_position_btn[position_type]=btn;var levelup_count_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_165);levelup_count_label.setTag(TAG_POSITION_LEVELUP_COUNT),levelup_count_label.setAnchorPoint(ZERO()),levelup_count_label.setPosition(74,7),btn.addChild(levelup_count_label),position_type==POSITION_TYPE_HEAD?btn.setPosition(324,39):position_type==POSITION_TYPE_MID_1?btn.setPosition(180,79):position_type==POSITION_TYPE_MID_2?btn.setPosition(180,0):position_type==POSITION_TYPE_BACK_1?btn.setPosition(30,79):position_type==POSITION_TYPE_BACK_2&&btn.setPosition(30,0),btn=null}return layer},getRightBoxLayer:function(){var layer=new cc.Layer,right_bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));right_bg_box.setContentSize(478,568),right_bg_box.setAnchorPoint(ZERO()),right_bg_box.setPosition(ZERO()),layer.addChild(right_bg_box),layer.setContentSize(ccSize(right_bg_box));var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");navi.setAnchorPoint(ZERO()),navi.setPosition(8,509),right_bg_box.addChild(navi);var title_label=cmLabel.getLabel("陣形強化情報",LABEL_FONT_INDEX.FONT_261);title_label.setAnchorPoint(ZERO()),title_label.setPosition(20,16),navi.addChild(title_label);var help_btn=new ccui.Button;help_btn.loadTextures("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE),help_btn.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),help_btn.setPosition(title_label.x+ccWidth(title_label)+10,ccCenter(navi).y+4),navi.addChild(help_btn),help_btn.addClickEventListener(function(sender){this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_BattleFormationScene],message_show_help)},0,"message_show_help")});var btn_formation_init=new LabelButton("btn_02_off.png","btn_02_on.png","",ccui.Widget.PLIST_TEXTURE);return btn_formation_init.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),btn_formation_init.setPosition(ccWidth(navi)-11,7),btn_formation_init.setFont(LABEL_FONT_INDEX.FONT_201),btn_formation_init.setString("初期化"),navi.addChild(btn_formation_init),btn_formation_init.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_BattleFormationScene],message_formation_init)}),this.m_contentListLayer=this.getContentListLayer(),this.m_contentListLayer.setPosition(17,16),layer.addChild(this.m_contentListLayer),layer},getContentListLayer:function(){this.m_contentItems=[];var listLayer=new VListLayer;return listLayer.setContentSize(444,480),listLayer.setItemCount(5),listLayer.setAnimationType(kListAnimationNone),listLayer.getItemNode=function(index,contentSize,m){var position_type=index+1,layer=new ContentListItem(this.m_battleFormations,position_type);return this.m_contentItems.push(layer),layer}.bind(this),listLayer.initLayout(),listLayer.onItemTouchBegin=function(index){return!0},listLayer.onItemTouchMoved=function(){return!0},listLayer.onItemTouchEnd=function(index){var position_type=index+1;this.setPositionInfo(position_type)}.bind(this),listLayer.setTouchScrollEnabled(!1),listLayer},setPositionInfo:function(position_type){for(var idx in this.m_selected_position_type=position_type,this.m_map_position_btn){var iter=this.m_map_position_btn[idx];if(null==iter.m_isSelected)break;idx==position_type?iter.setClickButton():iter.setNormalButton()}this.setStatButtonInfo(COMBO_STAT_ATTK),this.setStatLevelInfo(position_type),this.setContentItem(position_type)},setStatButtonInfo:function(combo_stat){for(var idx in this.m_map_stat_btn){var iter=this.m_map_stat_btn[idx];if(null==iter.m_isSelected)break;idx==combo_stat?iter.setClickButton():iter.setNormalButton()}this.m_selected_combo_stat=combo_stat;var keys=this.m_battleFormations.keys();for(idx=0;idx<keys.length;idx++){var f=this.m_battleFormations.at(keys[idx]);f.position_type==this.m_selected_position_type&&f.combo_stat==this.m_selected_combo_stat&&(this.m_formation_id=f.formation_id)}keys=null,this.checkNeedGoods()},checkNeedGoods:function(){var itemInfo=NetService().get_UserItemInfo_V2(),formation_info={},is_max_level=GeneralService.getInstance().getBattleFormationLevelUpNeedGoods(this.m_formation_id,formation_info),need_gold=formation_info.need_gold,need_formation_point=formation_info.need_formation_point,need_property_point=formation_info.property_point,property_type=formation_info.property_type,crrnt_level=GeneralService.getInstance().getBattleFormationLevel(this.m_formation_id),crrnt_value=GeneralService.getInstance().getBattleFormationValue(this.m_formation_id),next_level=crrnt_level+1,next_value=GeneralService.getInstance().getBattleFormationNextLevelValue(this.m_formation_id,next_level);this.m_selected_combo_stat!=COMBO_STAT_CRI_PRCNT&&this.m_selected_combo_stat!=COMBO_STAT_CRI_DMG||(crrnt_value/=100,next_value/=100);var property_type_name_str="";property_type==FORMATION_PROPERTY_TYPE_ATTK?property_type_name_str="攻撃力":property_type==FORMATION_PROPERTY_TYPE_DEF?property_type_name_str="防御力":property_type==FORMATION_PROPERTY_TYPE_HP?property_type_name_str="体力":property_type==FORMATION_PROPERTY_TYPE_CRI_PRCNT?property_type_name_str="会心発動率":property_type==FORMATION_PROPERTY_TYPE_CRI_DMG&&(property_type_name_str="会心上昇率"),this.m_property_title_label.setString(property_type_name_str),property_type_name_str="";var max_level=GeneralService.getInstance().getFormationMaxLevel(this.m_selected_position_type,this.m_selected_combo_stat);this.m_crrnt_value_label.setString("Lv "+crrnt_level+"/"+max_level),this.m_crrnt_value_label_2.setString(" (+"+crrnt_value.toFixed(1)+"%)"),this.m_crrnt_value_label_2.setPosition(this.m_crrnt_value_label.x+ccCenter(this.m_crrnt_value_label).x,this.m_crrnt_value_label.y);var frame=cc.spriteFrameCache.getSpriteFrame("img_formation_small_"+leadingZeros(property_type,2)+".png");if(this.m_property_icon.setSpriteFrame(frame),is_max_level)return this.m_is_max_level=!0,this.m_after_value_label.setString("MAX"),this.m_after_value_label_2.setString(""),this.m_arrow_img.setVisible(!1),this.m_need_gold_label.setString(""),this.m_need_formation_point_label.setString(""),this.m_need_property_point_label.setString(""),0;this.m_is_max_level=!1,this.m_arrow_img.setVisible(!0),this.m_after_value_label.setString("Lv "+next_level+"/"+max_level),this.m_after_value_label_2.setString(" (+"+next_value.toFixed(1)+"%)"),this.m_after_value_label_2.setPosition(this.m_after_value_label.x+ccCenter(this.m_after_value_label).x,this.m_after_value_label.y),this.m_need_gold_label.setString(Number(need_gold).toLocaleString("en")),this.m_need_formation_point_label.setString(Number(need_formation_point).toLocaleString("en")),this.m_need_property_point_label.setString(Number(need_property_point).toLocaleString("en")),itemInfo.gold_cnt<need_gold?(this.m_is_not_enough_gold=!0,this.m_need_gold_label.setColor(COLOR(2017))):(this.m_is_not_enough_gold=!1,this.m_need_gold_label.setColor(COLOR(2011))),NetService().get_User_formation_point()<need_formation_point?(this.m_is_not_enough_point=!0,this.m_need_formation_point_label.setColor(COLOR(2017))):(this.m_is_not_enough_point=!1,this.m_need_formation_point_label.setColor(COLOR(2011))),this.checkNeedPropertyPoint(property_type,need_property_point)},checkNeedPropertyPoint:function(property_type,need_property_point){this.m_is_not_enough_property_point=!1;var property_info=UserService.getInstance().getUserFormationPropertyPointInfo();property_type==FORMATION_PROPERTY_TYPE_ATTK?property_info.attk_pt<need_property_point&&(this.m_is_not_enough_property_point=!0):property_type==FORMATION_PROPERTY_TYPE_DEF?property_info.def_pt<need_property_point&&(this.m_is_not_enough_property_point=!0):property_type==FORMATION_PROPERTY_TYPE_HP?property_info.hp_pt<need_property_point&&(this.m_is_not_enough_property_point=!0):property_type==FORMATION_PROPERTY_TYPE_CRI_PRCNT?property_info.cri_prcnt_pt<need_property_point&&(this.m_is_not_enough_property_point=!0):property_type==FORMATION_PROPERTY_TYPE_CRI_DMG&&property_info.cri_dmg_pt<need_property_point&&(this.m_is_not_enough_property_point=!0),this.m_is_not_enough_property_point?this.m_need_property_point_label.setColor(COLOR(2017)):this.m_need_property_point_label.setColor(COLOR(2011)),property_info=null},levelupComplete:function(property_type,battleFormations){this.m_battleFormations=battleFormations,this.m_contentListLayer.removeFromParent(),this.m_contentListLayer=this.getContentListLayer(),this.m_contentListLayer.setPosition(17,16),this.m_rightBoxLayer.addChild(this.m_contentListLayer),this.setStatLevelInfo(this.m_selected_position_type),this.setStatButtonInfo(this.m_selected_combo_stat),this.setContentItem(this.m_selected_position_type),this.m_user_formation_point_label.setString(Number(NetService().get_User_formation_point()).toLocaleString("en")),this.setPositionLevelUpCount()},formationInitComplete:function(battleFormations){this.m_battleFormations=battleFormations,this.m_selected_position_type=POSITION_TYPE_HEAD,this.m_selected_combo_stat=COMBO_STAT_ATTK,this.m_contentListLayer.removeFromParent(),this.m_contentListLayer=this.getContentListLayer(),this.m_contentListLayer.setPosition(17,16),this.m_rightBoxLayer.addChild(this.m_contentListLayer),this.setPositionInfo(this.m_selected_position_type),this.m_user_formation_point_label.setString(Number(NetService().get_User_formation_point()).toLocaleString("en")),this.setPositionLevelUpCount()},onEnter:function(){this._super(),null!=this.m_need_gold_label&&this.checkNeedGoods()},onExit:function(){this._super(),1!=PREV_HELP&&1!=FORMATION_SHOP_FLAG&&(this.m_need_gold_label=null,this.m_need_formation_point_label=null,this.m_contentListLayer=null,this.m_positionButtonLayer=null,this.m_statButtonLayer=null,this.m_leftBottomLayer=null,this.m_rightBoxLayer=null,this.m_leftBoxLayer=null,this.m_arrow_img=null,this.m_property_icon=null,this.m_need_property_point_label=null,this.m_crrnt_value_label=null,this.m_after_value_label=null,this.m_user_formation_point_label=null,this.m_crrnt_value_label_2=null,this.m_after_value_label_2=null,this.m_property_title_label=null,this.m_battleFormations=null,this.m_map_stat_btn=[],this.m_map_position_btn=[],this.m_contentItems.forEach(function(t){t.removeAllChildrenWithCleanup(!0),delete t}),this.m_contentItems=[],this.m_map_stat_btn=null,this.m_map_position_btn=null,this.m_contentItems=null,delete this.m_map_stat_btn,delete this.m_map_position_btn,delete this.m_contentItems,delete this.m_statButtonLayer,delete this.m_leftBottomLayer,delete this.m_rightBoxLayer,delete this.m_leftBoxLayer,delete this.m_contentListLayer,this.removeAllChildrenWithCleanup(!0))}}),NOTIFICATION_LEVELUP_BATTLE_FORMATION="notification_levelup_battle_formation",NOTIFICATION_POSTION_BUTTON="notification_position_button",NOTIFICATION_STAT_BUTTON="notification_stat_button",BattleFormationScene=GameScene.extend({m_need_gold:0,m_formation_id:0,m_isPvpFormation:!1,m_selected_formation_id:0,m_formationLayer:null,m_initCompleteLayer:null,m_mtrlShortcutsModalLayer:null,m_formation_name:null,m_resources:[],ctor:function(){this._super(scene_BattleFormationScene),PREV_HELP=!1,FORMATION_SHOP_FLAG=!1},init:function(){this.initLayoutProgress2(),this.m_resources=[],USE_SHORTCUT_EVOLUTION_ICON?(this.m_resources.push(RES_CDN_DEFULT+"icon/shortcut_evolution/"+SHORTCUT_EVOLUTION_TEXTURE+".plist"),this.m_resources.push(RES_CDN_DEFULT+"icon/shortcut_evolution/"+SHORTCUT_EVOLUTION_TEXTURE+".png")):(this.m_resources.push(RES_CDN_DEFULT+"icon/evolve_small/"+ICON_EVOLVE_SMALL_TEXTURE+".plist"),this.m_resources.push(RES_CDN_DEFULT+"icon/evolve_small/"+ICON_EVOLVE_SMALL_TEXTURE+".png"),this.m_resources.push(RES_CDN_DEFULT+"icon/formation/"+FORMATION_TEXTURE+".plist"),this.m_resources.push(RES_CDN_DEFULT+"icon/formation/"+FORMATION_TEXTURE+".png")),this.m_resources.push(RES_CDN_DEFULT+"menu_formation/img_formation_frame_front.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_formation/img_formation_frame_center.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_formation/img_formation_frame_back.png"),resourceLoader(this.m_resources,function(){USE_SHORTCUT_EVOLUTION_ICON?cc.spriteFrameCache.addSpriteFrames(RES_CDN_DEFULT+"icon/shortcut_evolution/"+SHORTCUT_EVOLUTION_TEXTURE+".plist"):(cc.spriteFrameCache.addSpriteFrames(RES_CDN_DEFULT+"icon/evolve_small/"+ICON_EVOLVE_SMALL_TEXTURE+".plist"),cc.spriteFrameCache.addSpriteFrames(RES_CDN_DEFULT+"icon/formation/"+FORMATION_TEXTURE+".plist")),this.m_initCompleteLayer=new GameModalLayer,this.addChild(this.m_initCompleteLayer,9999),this.m_mtrlShortcutsModalLayer=new ShortcutsLayer,this.addChild(this.m_mtrlShortcutsModalLayer,9999),this.initLayout()}.bind(this))},initLayout:function(){var win_size=cc.director.getWinSize(),bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub.png");bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(this)),USE_SP_COMMON_SUB_BG_SCALE&&bg.setScale(2),this.addChild(bg);var bg_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal_3.png",RectZero());bg_mask.setContentSize(ccSize(this)),bg_mask.setAnchorPoint(ZERO()),bg_mask.setPosition(ZERO()),bg.addChild(bg_mask);var formations=GeneralService.getInstance().getUserBattleFormationList();this.m_formationLayer=new BattleFormationLayer,this.m_formationLayer.setBattleFormations(formations),this.m_formationLayer.initLayout(),this.addChild(this.m_formationLayer);var statusLayer=new StatusLayer(INVOKER_TYPE.normal);statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(cc.p(win_size.width,win_size.height)),this.addChild(statusLayer);var back_btn=new ccui.Button;back_btn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png",""),back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(sender){this.back()}.bind(this)),this.addChild(back_btn);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_formation.png");title.setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title),this.scheduleOnce(this.removeProgressEnd,1)},removeProgressEnd:function(){this.removeLayerProgress2()},back:function(){this.m_isPushScene?SceneManager.getInstance().popScene():this.onKeyBack(!0)},checkFormationLevelUpUserLevel:function(){var userInfo=NetService().get_User_info(),user_level_limit=GeneralService.getInstance().getBattleFormationNextLevelLimitUserLevel(this.m_formation_id),combo_stat=this.m_formationLayer.getSelectedComboStat(),position_type=this.m_formationLayer.getSelectedPostionType();userInfo.user_level<user_level_limit?USE_POPUP_INTERGRATION?this.showBattleFrmationPopup(res_str("label_battle_formation_levelup_not_title"),res_str("label_battle_formation_levelup_not_enough_user_level_text_1"),res_str("label_battle_formation_levelup_not_enough_user_level_text_2")):this.showNotEnoughUserLevel():this.showFormationLevelupQuestion(position_type,combo_stat)},onEnter:function(){this._super(),FORMATION_SHOP_FLAG=!1,MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_BattleFormationScene]),MainObserver.getInstance().addObserver(this.onNotifyPositionButton,this,NOTIFICATION_POSTION_BUTTON),MainObserver.getInstance().addObserver(this.onNotifyLevelup,this,NOTIFICATION_LEVELUP_BATTLE_FORMATION),MainObserver.getInstance().addObserver(this.onNotifyStatButton,this,NOTIFICATION_STAT_BUTTON),MainObserver.getInstance().addObserver(this.onNotificationShortcuts,this,NOTIFICATION_EVOLUTION_MTRL_SHORTCUTS);var game_type=BattleContext._getInstance().getGameType();if(game_type==db.BattleGameType.EventDungeon||game_type==db.BattleGameType.EventRaidDungeon){var audio=AudioEngine.getInstance();if(USE_EVENT_BGM){var m=MasterTable.getInstance();if(BattleContext._getInstance().getIsPrvEventDungeon())var bgm=m.get_Bgm_v2(BGM_TYPE_PRV_EVENT_MAIN_BGM);else{var period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();bgm=m.get_EventDungeonFromEventDungeonPeriodIdx(period_idx).event_dungeon_type==EVENT_DUNGEON_TYPE_LINLIN?m.get_Bgm_v2(BGM_TYPE_CRAFT_EVENT_MAIN_BGM):m.get_Bgm_v2(BGM_TYPE_EVENT_MAIN_BGM)}var main_bgm=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm.sound_file_name;audio.m_bgmPath!=main_bgm&&(audio.stopBackgroundMusic(),audio.playBackgroundMusic(main_bgm,!0))}else{var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),b_path=RES_CDN_SOUND+SND_TYPE+"sound/"+cmString("BGM_marathon_loop_%d.mp3",period.event_dungeon_point_period_idx);audio.m_bgmPath!=b_path&&(audio.stopBackgroundMusic(),audio.playBackgroundMusic(b_path,!0))}}else if(game_type==db.BattleGameType.Mission){audio=AudioEngine.getInstance(),b_path=RES_CDN_SOUND+SND_TYPE+"sound/BGM_story_loop.mp3";audio.m_bgmPath!=b_path&&(audio.stopBackgroundMusic(),audio.playBackgroundMusic(b_path,!0))}else this.playMainBGM()},onExit:function(){if(this._super(),1!=PREV_HELP&&1!=FORMATION_SHOP_FLAG&&(MainObserver.getInstance().removeObserver(sceneStr[scene_BattleFormationScene]),MainObserver.getInstance().removeObserver(NOTIFICATION_POSTION_BUTTON),MainObserver.getInstance().removeObserver(NOTIFICATION_LEVELUP_BATTLE_FORMATION),MainObserver.getInstance().removeObserver(NOTIFICATION_STAT_BUTTON),MainObserver.getInstance().removeObserver(NOTIFICATION_EVOLUTION_MTRL_SHORTCUTS),USE_SHORTCUT_EVOLUTION_ICON?(cc.spriteFrameCache.removeSpriteFramesFromFile(RES_CDN_DEFULT+"icon/shortcut_evolution/"+SHORTCUT_EVOLUTION_TEXTURE+".plist"),delete cc.spriteFrameCache._frameConfigCache[RES_CDN_DEFULT+"icon/shortcut_evolution/"+SHORTCUT_EVOLUTION_TEXTURE+".plist"]):(cc.spriteFrameCache.removeSpriteFramesFromFile(RES_CDN_DEFULT+"icon/evolve_small/"+ICON_EVOLVE_SMALL_TEXTURE+".plist"),delete cc.spriteFrameCache._frameConfigCache[RES_CDN_DEFULT+"icon/evolve_small/"+ICON_EVOLVE_SMALL_TEXTURE+".plist"],cc.spriteFrameCache.removeSpriteFramesFromFile(RES_CDN_DEFULT+"icon/formation/"+FORMATION_TEXTURE+".plist"),delete cc.spriteFrameCache._frameConfigCache[RES_CDN_DEFULT+"icon/formation/"+FORMATION_TEXTURE+".plist"]),null!=this.m_resources)){for(var i=0;i<this.m_resources.length;i++)cc.loader.release(this.m_resources[i]);this.m_resources=null}},onNotification:function(msg){if(this._super(msg))return!1;switch(msg){case message_is_max_level:USE_POPUP_INTERGRATION?this.showBattleFrmationPopup(res_str("label_battle_formation_levelup_title"),res_str("label_battle_formation_max_level_text_1"),res_str("label_battle_formation_max_level_text_2")):this.showIsFormationMaxLevel();break;case message_not_enough_glod:this.showNotEnoughGold();break;case message_not_enough_point:this.showNotEnoughFormationPoint();break;case message_not_enough_property_point:this.showNotEnoughFormationProPertyPoint();break;case message_formation_init:this.showFormationInit();break;case message_show_help:PREV_HELP=!0,GameContext.getInstance().setHelpInfoIndexByCallIndex(17);var scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null}return!0},onNotifyPositionButton:function(sender){var position_type=sender;this.m_formationLayer.setPositionInfo(position_type)},onNotifyLevelup:function(sender){this.m_formation_id=sender,this.checkFormationLevelUpUserLevel()},onNotifyStatButton:function(sender){var combo_stat=sender;this.m_formationLayer.setStatButtonInfo(combo_stat)},onNotificationShortcuts:function(sender){var tag=sender,shortcuts=GeneralService.getInstance().getShortcutList(tag);0!=shortcuts.length&&(this.m_mtrlShortcutsModalLayer.setShortcutsInfo(shortcuts),this.m_mtrlShortcutsModalLayer.show())},getInitCompleteConentLayer:function(payback_gold,payback_formation_point,property_point){var layer=new cc.Layer;layer.setContentSize(595,204);var formation_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_formation/img_formation_point.png");formation_icon.setAnchorPoint(ZERO()),formation_icon.setPosition(173,104),layer.addChild(formation_icon);var formation_point_label=cmLabel.getLabel(payback_formation_point,LABEL_FONT_INDEX.FONT_247);formation_point_label.setAnchorPoint(ZERO()),formation_point_label.setPosition(221,114),layer.addChild(formation_point_label);var gold_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_sell_gold.png");gold_icon.setAnchorPoint(ZERO()),gold_icon.setPosition(278,104),layer.addChild(gold_icon);var gold_label=cmLabel.getLabel(payback_gold,LABEL_FONT_INDEX.FONT_247);gold_label.setAnchorPoint(ZERO()),gold_label.setPosition(320,114),layer.addChild(gold_label);for(var i=0;i<property_point.length;i++){var icon=cc.Sprite.create("#img_formation_small_"+leadingZeros(property_point[i].property_type,2)+".png");icon.setAnchorPoint(ZERO()),icon.setPosition(121*(property_point[i].property_type-1),56),layer.addChild(icon);var point_label=cmLabel.getLabel(property_point[i].point_count,LABEL_FONT_INDEX.FONT_247);point_label.setAnchorPoint(ZERO()),point_label.setPosition(47+121*(property_point[i].property_type-1),62),layer.addChild(point_label)}var info_label=cmLabel.getLabel("が還元されました。",LABEL_FONT_INDEX.FONT_241);return info_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),info_label.setPosition(ccCenter(layer).x,10),layer.addChild(info_label),layer},checkFormationInit:function(){if(this.m_box.is_show()&&this.m_box.hide(!1),this.m_ctbox.is_show()&&this.m_ctbox.hide(!1),GeneralService.getInstance().isEnabledFormationInit()){for(var user_item=NetService().get_UserItemInfo_V2(),init_expense_list=MasterTable.getInstance().get_BattleFormationInitExpense(),idx=0;idx<init_expense_list.length;idx++)if(SHOP_BUY_TYPE_JADE==init_expense_list[idx].buy_type&&user_item.jade_cnt<init_expense_list[idx].init_expense)return void this.showNotEnoughJade(!0);this.scheduleOnce(function(float){this.sendPacketFormationInit()}.bind(this),0,"sendPacketFormationInit")}else USE_POPUP_INTERGRATION?this.showBattleFrmationPopup(res_str("label_battle_formation_init_not_title"),res_str("label_battle_formation_init_not_text")):this.showNotInitFormation()},getComboStatName:function(combo_stat){return combo_stat==COMBO_STAT_ATTK?"攻撃力":combo_stat==COMBO_STAT_DEF?"防御力":combo_stat==COMBO_STAT_HP?"体力":combo_stat==COMBO_STAT_CRI_PRCNT?"会心発動率":combo_stat==COMBO_STAT_CRI_DMG?"会心上昇率":""},getInitComleteLayer:function(payback_gold,payback_formation_point,property_point){var layer=new cc.Layer,bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));bg.setContentSize(630,370),bg.setPosition(ccCenter(layer)),layer.addChild(bg);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_3.png");navi.setAnchorPoint(ZERO()),navi.setPosition(8,311),bg.addChild(navi);var contentLayer=this.getInitCompleteConentLayer(payback_gold,payback_formation_point,property_point);contentLayer.setPosition(ccCenter(bg).x-ccCenter(contentLayer).x,89),bg.addChild(contentLayer);var title_label=cmLabel.getLabel("陣形初期化完了",LABEL_FONT_INDEX.FONT_241);title_label.setAnchorPoint(ANCHOR_MIDDLE()),title_label.setPosition(ccCenter(navi)),navi.addChild(title_label);var btn=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);return btn.setFont(LABEL_FONT_INDEX.FONT_241),btn.setString("確認"),btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn.setPosition(ccCenter(bg).x,16),btn.addClickEventListener(function(sender){this.scheduleOnce(function(float){this.m_initCompleteLayer.hide()}.bind(this),0,"showForamtionInitComplete")}.bind(this)),bg.addChild(btn),layer},showForamtionInitComplete:function(payback_gold,payback_formation_point,property_point){this.m_initCompleteLayer.setContentSize(ccSize(this)),this.m_initCompleteLayer._contentNode=function(contentSize,m){return this.getInitComleteLayer(payback_gold,payback_formation_point,property_point)}.bind(this),this.m_initCompleteLayer.show()},sendPacketBattleFormationLevelUp:function(){var req={opcode:0,user_battle_formation:{}};req.opcode=net.OP.op_battle_formation_level_up,req.user_battle_formation.formation_id=this.m_formation_id,this.network_write(req)},sendPacketFormationInit:function(){var req={};req.opcode=net.OP.op_battle_formation_init,this.network_write(req)},onNetworkEvent:function(opcode,state,body){if(this._super(opcode,state,body),opcode==net.OP.op_result);else if(opcode==net.OP.op_troops_set_battle_formation)this.back();else if(opcode==net.OP.op_battle_formation_level_up){var formations=GeneralService.getInstance().getUserBattleFormationList();this.m_formationLayer.levelupComplete(body.formation_property_type,formations),USE_POPUP_INTERGRATION?this.showBattleFrmationPopup(res_str("label_battle_formation_levelup_complete_title"),res_str("label_battle_formation_levelup_complete_text")):this.showFormationLevelUpComplete()}else if(opcode==net.OP.op_battle_formation_init){formations=GeneralService.getInstance().getUserBattleFormationList();this.m_formationLayer.formationInitComplete(formations),this.showForamtionInitComplete(body.payback_gold,body.payback_formation_point,body.payback_property_point)}else opcode==net.OP.op_get_user_event_dungeon_box_gacha_progress_info&&SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene)},showBattleFrmationPopup:function(){this.m_box.is_show()&&this.m_box.hide();for(var val=arguments,msg=[],i=1;i<val.length;i++)msg.push(val[i]);this.showMsgBox(val[0],msg),msg=null},showNotEnoughUserLevel:function(){this.m_box.is_show()&&this.m_box.hide(),this.m_box.setTitle(res_str("label_battle_formation_levelup_not_title")),this.m_box.setText(res_str("label_battle_formation_levelup_not_enough_user_level_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_battle_formation_levelup_not_enough_user_level_text_2")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showIsFormationMaxLevel:function(){this.m_box.is_show()&&this.m_box.hide(),this.m_box.setTitle(res_str("label_battle_formation_levelup_title")),this.m_box.setText(res_str("label_battle_formation_max_level_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_battle_formation_max_level_text_2")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showFormationLevelUpComplete:function(){this.m_box.is_show()&&this.m_box.hide(),this.m_box.setTitle(res_str("label_battle_formation_levelup_complete_title")),this.m_box.setText(res_str("label_battle_formation_levelup_complete_text")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showNotInitFormation:function(){this.m_box.is_show()&&this.m_box.hide(),this.m_box.setTitle(res_str("label_battle_formation_init_not_title")),this.m_box.setText(res_str("label_battle_formation_init_not_text")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showNotEnoughFormationPoint:function(){this.m_ctbox.setTitle(res_str("label_formation_point_lack_title")),this.m_ctbox.setText("陣形強化PT",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("が不足しています。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_ctbox.hide()}.bind(this))),this.m_ctbox.show()},showNotEnoughFormationProPertyPoint:function(){this.m_ctbox.setTitle(res_str("label_formation_property_point_lack_title")),this.m_ctbox.setText("陣形強化特性PT",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("が不足しています。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_ctbox.hide()}.bind(this))),this.m_ctbox.show()},showFormationInit:function(){for(var formation_expense_list=MasterTable.getInstance().get_BattleFormationInitExpense(),gold_payback_prcnt=0,formation_payback_prcnt=0,property_povar_payback_prcnt=0,need_jade=0,i=0;i<formation_expense_list.length;i++)formation_expense_list[i].buy_type==SHOP_BUY_TYPE_GOLD&&(gold_payback_prcnt=formation_expense_list[i].payback_prcnt),formation_expense_list[i].buy_type==SHOP_BUY_TYPE_FORMATION_POINT&&(formation_payback_prcnt=formation_expense_list[i].payback_prcnt),formation_expense_list[i].buy_type==SHOP_BUY_TYPE_JADE&&(need_jade=formation_expense_list[i].init_expense),formation_expense_list[i].buy_type==SHOP_BUY_TYPE_FORMATION_ATTK_POINT&&(property_povar_payback_prcnt=formation_expense_list[i].payback_prcnt);this.m_ctbox.setTitle(res_str("label_battle_formation_init_title")),this.m_ctbox.setText("強化した全陣形のレベルが 1に戻り、",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("陣形共通PT",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("は",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText(formation_payback_prcnt+"%",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText(",",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("金貨",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("は",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText(gold_payback_prcnt+"%",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText(",",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("陣形強化PT",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("は",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText(property_povar_payback_prcnt+"%",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("還元されます。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("翡翠 "+need_jade+"個",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("を使用し初期化しますか。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_ctbox.hide()}.bind(this))),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.checkFormationInit()}.bind(this))),this.m_ctbox.show()},showFormationLevelupQuestion:function(position_type,combo_stat){this.m_ctbox.hide(!1);var mt_position_type=MasterManager.getInstance().get_PositionType(position_type),combo_stat_name=this.getComboStatName(combo_stat);this.m_ctbox.setTitle(res_str("label_battle_formation_levelup_title")),this.m_ctbox.setText("注意：陣形共通PTは",LABEL_FONT_INDEX.FONT_2617),this.m_ctbox.setText("\n"),this.m_ctbox.setText("ご主人様レベルUP時しか獲得できません。",LABEL_FONT_INDEX.FONT_2617),this.m_ctbox.setText("\n"),this.m_ctbox.setText(mt_position_type.name,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("の ",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText(combo_stat_name,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("を",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("強化しますか。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_ctbox.hide()}.bind(this))),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.sendPacketBattleFormationLevelUp(),this.m_ctbox.hide()}.bind(this))),this.m_ctbox.show()},showLevelUpBattleFormation:function(){this.m_box.setTitle(res_str("label_battle_formation_levelup_title")),this.m_box.setText("金貨 "+this.m_need_gold+"を使用して"),this.m_box.setText("\n"),this.m_box.setText(this.m_formation_name+"を強化しますか。"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.checkFormationLevelUpUserLevel(),this.m_box.hide()}.bind(this))),this.m_box.show()}}),deck_num_1=1,deck_num_2=2,deck_num_3=3,deck_num_4=4,deck_num_5=5,deck_num_6=6,deck_num_7=7,deck_num_8=8,deck_num_9=9,message_ok=400,message_is_master_general=401,sell_count_max=402,yunhee_sell_ready=403,yunhee_sell_not_select=404,yunhee_batch_sell_not_have_general=405,YUNHEE_DELAY_TIME=0,NUMBER_OF_BUTTONS=4,YunheeScene=GameScene.extend({m_position:0,m_del_gnrl_num:0,m_yunhee_inc_jade:0,m_batch_sell_count:0,m_layer:null,m_yunheeLayer_V2:null,m_bg:null,m_longClickPopup:null,m_isLongClickPopup:!1,m_gameObserver:null,m_setTroopsGnrl:null,m_deleteTroops:null,m_leaderTroops:null,mask_bg:null,m_is_except_mtrl:!0,m_sellPopup:null,m_batch_sell_counts:[],m_deferred:null,m_batch_rare_type_check_box:[],m_batch_sell_rare_types:[],m_radio_group:[],m_batch_sell_ready_modal_layer:null,m_user_troops_list:[],m_user_gnrl_list:[],m_filter_gnrl_list:[],ctor:function(){this.m_batch_sell_counts=[],this.m_batch_rare_type_check_box=[],this.m_batch_sell_rare_types=[],this.m_radio_group=[],this.m_deferred=$.Deferred(),this.m_user_troops_list=[],this.m_user_gnrl_list=[],this.m_filter_gnrl_list=[],this._super(scene_YunheeScene)},init:function(){this.m_deleteTroops={},this.m_leaderTroops={},this.m_game_type=BattleContext._getInstance().getGameType(),this.m_gameObserver=MainObserver.getInstance(),this.m_setTroopsGnrl={pos_type:0,troops_num:0},this.m_layer=new cc.Layer,this.addChild(this.m_layer),this.m_bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub.png"),this.m_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bg.setPosition(ccCenter(this.m_layer)),USE_SP_COMMON_SUB_BG_SCALE&&this.m_bg.setScale(2),this.m_layer.addChild(this.m_bg),this.mask_bg=new cc.LayerColor(cc.Color.BLACK),this.m_layer.addChild(this.mask_bg),this.mask_bg.setVisible(!1),this.m_yunheeLayer_V2=new YunheeLayer,this.addChild(this.m_yunheeLayer_V2);NetService().Load_User_Troops_General();this.updateUserGeneralInfoList(),this.m_yunheeLayer_V2.setUserTroopsGnrlList(this.m_user_troops_list),this.m_yunheeLayer_V2.setUserFilterGnrlList(this.m_filter_gnrl_list),this.m_yunheeLayer_V2.initLayout(this.m_deferred);var statusLayer,win_size=cc.director.getWinSize();this.m_game_type==db.BattleGameType.GreatWallDungeon?((statusLayer=new StatusLayer(INVOKER_TYPE.great_wall)).ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(cc.p(win_size.width,win_size.height)),this.addChild(statusLayer)):((statusLayer=new StatusLayer(INVOKER_TYPE.yunhee)).ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(cc.p(win_size.width,win_size.height)),this.addChild(statusLayer));var back_btn=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png","");back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(sender){this.back()}.bind(this)),back_btn.setTutorialTag(TOTORIAL_TAG_BTN_BACK),this.addChild(back_btn,3);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_yh.png");return title.setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title,3),this.m_batch_sell_ready_modal_layer=new GameModalLayer,this.addChild(this.m_batch_sell_ready_modal_layer,9999),this.m_batch_sell_counts.push(75),this.m_batch_sell_counts.push(100),this.m_batch_sell_counts.push(200),this.m_batch_sell_counts.push(300),!0},showBatchSellReady:function(){this.m_batch_sell_ready_modal_layer.setContentSize(ccSize(this)),this.m_batch_sell_ready_modal_layer._contentNode=function(contentSize,m){return this.getBathcSellReadyLayer()}.bind(this),this.m_batch_sell_ready_modal_layer.show()},getBathcSellReadyLayer:function(){var layer=new cc.Layer;this.m_batch_sell_rare_types=[],this.m_batch_rare_type_check_box=[];var size=cc.size(630,370),bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));bg.setPreferredSize(size),bg.setPosition(ccCenter(layer)),layer.addChild(bg);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_3.png");navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(.5*size.width,size.height-11),bg.addChild(navi);var title_label=cmLabel.getLabel(res_str("btn_label_batch_sell"),LABEL_FONT_INDEX.FONT_241);title_label.setAnchorPoint(ANCHOR_MIDDLE()),title_label.setPosition(ccCenter(navi).x,ccCenter(navi).y),navi.addChild(title_label);var title=cmLabel.getLabel(cmString("%s\n%s",res_str("label_yunhee_batch_sell_title_1"),res_str("label_yunhee_batch_sell_title_2")),LABEL_FONT_INDEX.FONT_247);title.setAnchorPoint(ANCHOR_MIDDLE_TOP()),title.setTextHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),title.setPosition(ccCenter(bg).x,306),bg.addChild(title);var mt=MasterManager.getInstance();this.m_radio_group=[];for(var i=0;i<NUMBER_OF_BUTTONS;++i){var radioButton=new ccui.CheckBox(RES_CDN_DEFULT+"common/img_checkbox.png",RES_CDN_DEFULT+"common/img_check.png");radioButton.setAnchorPoint(ZERO()),radioButton.setPosition(110+140*i,130),radioButton.addEventListener(this.onChangedBatchSellSelectCount.bind(this)),radioButton.setTag(i),this.m_radio_group.push(radioButton),bg.addChild(radioButton);var tag=i+1,check_box=new ccui.CheckBox(RES_CDN_DEFULT+"common/img_checkbox.png",RES_CDN_DEFULT+"common/img_check.png",RES_CDN_DEFULT+"common/img_check.png",RES_CDN_DEFULT+"common/img_checkbox.png",RES_CDN_DEFULT+"common/img_check.png");check_box.setTag(tag),check_box.setAnchorPoint(ZERO()),check_box.setPosition(110+140*i,200),check_box.addEventListener(this.selectedEventBatchSellRareType.bind(this)),bg.addChild(check_box),this.m_batch_rare_type_check_box.push_back(check_box);var rare_type=mt.get_RareType(tag),count=this.m_batch_sell_counts[i];0==i?(count=75,check_box.setSelected(!0),this.m_batch_sell_rare_types.push(rare_type.rare_type),check_box.setEnabled(!1)):1==i&&(count=100,this.m_batch_sell_count=count,this.m_radio_group[i].setSelected(!0));var label=cmLabel.getLabel(cmString(res_str("label_yunhee_count"),count),LABEL_FONT_INDEX.FONT_241);label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),label.setPosition(ccPosX(radioButton),136),bg.addChild(label);var checkbox_label=cmLabel.getLabel(rare_type.name,LABEL_FONT_INDEX.FONT_241);checkbox_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),checkbox_label.setPosition(ccPosX(check_box)-5,206),bg.addChild(checkbox_label)}var cancel_btn=new LabelButton("btn_08_off.png","btn_08_on.png","",ccui.Widget.PLIST_TEXTURE);cancel_btn.setFont(LABEL_FONT_INDEX.FONT_241),cancel_btn.setString(res_str("btn_label_cancel")),cancel_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),cancel_btn.setPosition(ccCenter(bg).x-10,16),cancel_btn.addClickEventListener(function(sender){this.m_batch_sell_ready_modal_layer.hide()}.bind(this)),bg.addChild(cancel_btn);var sell_btn=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);return sell_btn.setFont(LABEL_FONT_INDEX.FONT_241),sell_btn.setString(res_str("btn_label_sell")),sell_btn.setAnchorPoint(ZERO()),sell_btn.setPosition(ccCenter(bg).x+10,16),sell_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_YunheeScene],NOTIFY_MENU_YUNHEE_BATCH_SELL_MODE)}),bg.addChild(sell_btn),size=null,layer},selectedEventBatchSellRareType:function(pSender,type){var checkbox=pSender,rare_type=checkbox.getTag();switch(AudioEngine.getInstance().playNormaButtonSound(),type){case ccui.CheckBox.EVENT_SELECTED:this.m_batch_sell_rare_types.push_back(rare_type);for(var idx=0;idx<this.m_batch_rare_type_check_box.length;idx++){(check_box=this.m_batch_rare_type_check_box[idx]).setEnabled(!0)}break;case ccui.CheckBox.EVENT_UNSELECTED:if(this.m_batch_sell_rare_types=this.m_batch_sell_rare_types.filter(function(l){return l!=rare_type}),1==this.m_batch_sell_rare_types.size())for(idx=0;idx<this.m_batch_rare_type_check_box.length;idx++){var check_box;(check_box=this.m_batch_rare_type_check_box[idx]).isSelected()&&check_box.setEnabled(!1)}}rare_type=checkbox=null},onChangedBatchSellSelectCount:function(radioButton,type){if(null!=radioButton){for(var tag=radioButton.getTag(),idx=0;idx<this.m_radio_group.length;idx++)idx!=tag&&this.m_radio_group[idx].setSelected(!1);switch(type){case ccui.CheckBox.EVENT_SELECTED:switch(tag){case 0:case 1:case 2:case 3:AudioEngine.getInstance().playNormaButtonSound(),this.m_batch_sell_count=this.m_batch_sell_counts[tag]}}tag=null}},get_story_deferred:function(){return this.m_deferred},back:function(){1==RAID_PREV_SCENE?(RAID_PREV_SCENE=!1,this.onKeyBack2()):1==YUNHEE_PREV_SCENE?(YUNHEE_PREV_SCENE=!1,this.onKeyBack3()):this.onKeyBack(!0,!1)},showLongClickPopup:function(popup_type){var info={};info=popup_type==NOTIFY_IS_LONG_CLICK?this.m_yunheeLayer_V2.getUserGeneralInfo():this.m_yunheeLayer_V2.getUserDeckGeneralInfo(),null==this.m_longClickPopup?(this.m_longClickPopup=new YunheeInfoPopupLayer(info,popup_type),this.addChild(this.m_longClickPopup,1e3)):(this.m_longClickPopup.setUserGeneralInfo(info,popup_type),this.m_longClickPopup.setVisible(!0)),info={},info=null,this.m_isLongClickPopup=!0},onNotification:function(msg){this._super(msg);var ed_service=EventDungeonService.getInstance();MasterManager.getInstance();switch(msg){case NOTIFY_MENU_PARTY_1:case NOTIFY_MENU_PARTY_2:case NOTIFY_MENU_PARTY_3:case NOTIFY_MENU_PARTY_4:case NOTIFY_MENU_PARTY_5:case NOTIFY_MENU_PARTY_6:case NOTIFY_MENU_PARTY_7:this.m_yunheeLayer_V2.changeYhTeam(msg);break;case NOTIFY_MENU_EVENT_DUNGEON_SEARCH_BATCH_OFF:var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),troops_num=this.getCurrentTroopsNum();(req={}).opcode=net.OP.op_event_dungeon_search_troops_batch_off,req.event_dungeon_period_idx=event_dungeon_period_idx,req.troops_num=troops_num,this.network_write(req),req={},troops_num=event_dungeon_period_idx=null;break;case NOTIFY_MENU_EVENT_DUNGEON_SEARCH_AUTO_PAIRING:event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),troops_num=this.getCurrentTroopsNum();var list=[];ed_service.getUserEventDungeonSearchTroopsAutoPairingGeneralList(this.event_dungeon_group_idx,troops_num,list),(req={}).opcode=net.OP.op_event_dungeon_search_troops_auto_pairing,req.event_dungeon_period_idx=event_dungeon_period_idx,req.troops_num=troops_num,req.gnrl_key_list=list,this.network_write(req),list=[],req={};break;case NOTIFY_MENU_YH_DETAIL:var req,offset=this.m_yunheeLayer_V2.getTableViewOffset();GameContext.getInstance().setOffsetVerticalPercent(offset),offset=null,(req={}).opcode=net.OP.op_event_dungeon_open_period_info,this.network_write(req),req={};break;case NOTIFY_ON_BACK:this.back();break;case menu_deck_1:this.setTroopsGeneral(deck_num_1);break;case menu_deck_2:this.setTroopsGeneral(deck_num_2);break;case menu_deck_3:this.setTroopsGeneral(deck_num_3);break;case menu_deck_4:this.setTroopsGeneral(deck_num_4);break;case menu_deck_5:this.setTroopsGeneral(deck_num_5);break;case NOTIFY_MENU_YUNHEE_BATCH_SELL_READY:this.showBatchSellReady();break;case NOTIFY_MENU_YUNHEE_SELL_POPUP_HIEDE:this.removeChild(this.m_sellPopup),this.m_sellPopup=null;break;case NOTIFY_MENU_YUNHEE_BATCH_SELL_MODE:this.m_batch_sell_ready_modal_layer.hide(),this.m_yunheeLayer_V2.getDeckSatus()==DECK_STATUS.CHOICE_LEADER&&this.m_yunheeLayer_V2.setLeaderMode(),this.updateUserGeneralInfoSellList(),this.m_yunheeLayer_V2.setUserFilterGnrlList(this.m_filter_gnrl_list),this.m_yunheeLayer_V2.setBatchSellMode(this.m_batch_sell_rare_types,this.m_batch_sell_count,!0),this.m_bg.setColor(cc.color(255,255,255)),this.mask_bg.setVisible(!1),this.mask_bg.setOpacity(255);break;case NOTIFY_MENU_YUNHEE_SELL_MODE:this.m_yunheeLayer_V2.getDeckSatus()==DECK_STATUS.CHOICE_LEADER&&this.m_yunheeLayer_V2.setLeaderMode(),this.updateUserGeneralInfoSellList(),this.m_yunheeLayer_V2.setUserFilterGnrlList(this.m_filter_gnrl_list),this.m_yunheeLayer_V2.setSellMode(),this.mask_bg.setVisible(!1),this.mask_bg.setOpacity(255);break;case NOTIFY_MENU_YUNHEE_SELL_CANCEL:this.updateUserGeneralInfoList(),this.m_yunheeLayer_V2.setUserTroopsGnrlList(this.m_user_troops_list),this.m_yunheeLayer_V2.setUserFilterGnrlList(this.m_filter_gnrl_list),this.m_yunheeLayer_V2.setSellCancel();break;case NOTIFY_MENU_ARRANGEMENT:this.m_yunheeLayer_V2.getDeckSatus()==DECK_STATUS.NONE?(this.mask_bg.setVisible(!0),this.mask_bg.setOpacity(200)):this.m_yunheeLayer_V2.getDeckSatus()==DECK_STATUS.CHOICE_LEADER?(this.mask_bg.setVisible(!0),this.mask_bg.setOpacity(200),this.m_yunheeLayer_V2.setLeaderMode()):(this.mask_bg.setVisible(!1),this.mask_bg.setOpacity(0)),this.m_yunheeLayer_V2.setArrangementMode();break;case NOTIFY_MENU_LEADER_SET:this.m_yunheeLayer_V2.getDeckSatus()==DECK_STATUS.ARRANGEMENT_MODE||this.m_yunheeLayer_V2.getDeckSatus()==DECK_STATUS.ARRANGEMENT_SELECT_YUNHEE?(this.m_yunheeLayer_V2.setArrangementMode(),this.mask_bg.setVisible(!1),this.mask_bg.setOpacity(255)):this.m_yunheeLayer_V2.getDeckSatus()!=DECK_STATUS.SELL_MODE&&this.m_yunheeLayer_V2.getDeckSatus()!=DECK_STATUS.BATCH_SELL_MODE||(this.updateUserGeneralInfoList(),this.m_yunheeLayer_V2.setUserTroopsGnrlList(this.m_user_troops_list),this.m_yunheeLayer_V2.setUserFilterGnrlList(this.m_filter_gnrl_list),this.m_yunheeLayer_V2.setSellCancel()),this.m_yunheeLayer_V2.setLeaderMode();break;case NOTIFY_MENU_BATTLE_FORM:offset=this.m_yunheeLayer_V2.getTableViewOffset();GameContext.getInstance().setOffsetVerticalPercent(offset),offset=null;var scene=new BattleFormationScene;SceneManager.getInstance().replaceScene(scene),scene=null;break;case message_ok:this.m_box.is_show()&&this.m_box.hide();break;case sell_count_max:USE_POPUP_INTERGRATION?this.showYunheePopup(res_str("label_yunhee_sell_title"),res_str("label_yunhee_sell_max_text_1"),res_str("label_yunhee_sell_max_text_2")):this.showSellCountMaxMsgBox();break;case NOTIFY_MENU_YUNHEE_SELL_START:this.sendPacketYunheeSell();break;case yunhee_batch_sell_not_have_general:USE_POPUP_INTERGRATION?this.showYunheePopup(res_str("label_yunhee_sell_title"),res_str("label_yunhee_not_have_batch_sell_general")):this.showNotHaveBatchSellGeneral(),this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],NOTIFY_MENU_YUNHEE_SELL_CANCEL);break;case yunhee_sell_ready:GameDefault.getInstance().setParentSellPopup(ParentSellPopup.TO_YUNHEE);var info_list=this.m_yunheeLayer_V2.getSellGeneralInfoList();null==this.m_sellPopup?(this.m_sellPopup=new YunheeSellPopupLayer(info_list,SELL_POPUP_TYPE.NORMAL_SELL),this.addChild(this.m_sellPopup)):this.m_sellPopup.setData(info_list),this.m_sellPopup.initLayout(),info_list=[];break;case yunhee_sell_not_select:GameContext.getInstance().getYunheeTabType()==YunheeLevelUpTapTypeEnum.tab_type_yunhee?USE_POPUP_INTERGRATION?this.showGameScenePopup(res_str("label_shop_buy_jade_omission_title"),res_str("label_yunhee_sell_not_select")):this.showYunheeSellNotSelect():USE_POPUP_INTERGRATION?this.showGameScenePopup(res_str("label_shop_buy_jade_omission_title"),res_str("label_general_material_sell_not_select")):this.showGeneralMaterialSellNotSelect();break;case SORT_TYPE.btn_inventory_inc:this.showInventoryIncrease();break;case SORT_TYPE.invalid_deck_set_material:USE_POPUP_INTERGRATION?this.showYunheePopup(res_str("label_invalid_troops_set_material_title"),res_str("label_invalid_troops_set_material_message")):this.showInvalidTroopsSetMaterial();break;case SORT_TYPE.btn_show_help:if(this.m_game_type==db.BattleGameType.GreatWallDungeon){this.m_isPopupShow=!0,GameContext.getInstance().setHelpInfoIndexByCallIndex(4);scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null}else{this.m_isPopupShow=!0,GameContext.getInstance().setHelpInfoIndexByCallIndex(4);scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null}break;case btn_left_arrow:var currTroops=this.getCurrentTroopsNum(),max_troops_num=MAX_TROOPS_NUM;this.m_game_type!=db.BattleGameType.GreatWallDungeon&&(max_troops_num=MAX_TROOPS_NUM-1),1==currTroops?currTroops=max_troops_num:currTroops--,this.m_yunheeLayer_V2.changeYhTeam(NOTIFY_MENU_PARTY_1+currTroops-1);break;case btn_right_arrow:currTroops=this.getCurrentTroopsNum(),max_troops_num=MAX_TROOPS_NUM;this.m_game_type!=db.BattleGameType.GreatWallDungeon&&(max_troops_num=MAX_TROOPS_NUM-1),currTroops==max_troops_num?currTroops=1:currTroops++,this.m_yunheeLayer_V2.changeYhTeam(NOTIFY_MENU_PARTY_1+currTroops-1);break;case NOTIFY_IS_LONG_CLICK:case NOTIFY_DECK_IS_LONG_CLICK:this.showLongClickPopup(msg);break;case NOTIFY_LONG_CLICK_POPUP_HIDE:this.m_isLongClickPopup&&(this.m_longClickPopup.setVisible(!1),this.m_isLongClickPopup=!1);break;case TUTORIAL_SETTING:this.onTutorialSetting()}return!0},setMask:function(opacity){this.mask_bg.setVisible(!0),this.mask_bg.setOpacity(opacity)},updateUserGeneralInfoList:function(){this.m_user_troops_list.clear(),this.m_filter_gnrl_list.clear();var gs=GeneralService.getInstance(),gw_service=GreatWallService.getInstance(),ed_service=EventDungeonService.getInstance(),yunhee_type_filter=GameContext.getInstance().getYunheeTypeFilter(),element_type_filter=GameContext.getInstance().getElementTypeFilter(),yunhee_tab_type=GameContext.getInstance().getYunheeTabType();this.m_user_troops_list=gs.getUserTroopsGeneralList(),this.m_game_type==db.BattleGameType.GreatWallDungeon?this.m_user_troops_list=gw_service.getGreatWallTroopsGeneralList():this.m_game_type==db.BattleGameType.EventDungeonSearch&&ed_service.getEventDungeonSearchTroopsGeneralList(this.m_user_troops_list),yunhee_tab_type==YunheeLevelUpTapTypeEnum.tab_type_yunhee?100!=element_type_filter?gs.getUserGeneralInfoList(this.m_filter_gnrl_list,element_type_filter):gs.getUserGeneralInfoList(this.m_filter_gnrl_list):yunhee_tab_type==YunheeLevelUpTapTypeEnum.tab_type_material&&(100!=yunhee_type_filter?gs.getUserGeneralMaterialInfoList(this.m_filter_gnrl_list,yunhee_type_filter):gs.getUserGeneralMaterialInfoList(this.m_filter_gnrl_list)),yunhee_tab_type=element_type_filter=yunhee_type_filter=null},updateUserGeneralInfoSellList:function(){this.m_filter_gnrl_list.clear();var gs=GeneralService.getInstance(),yunhee_type_filter=GameContext.getInstance().getYunheeTypeFilter(),element_type_filter=GameContext.getInstance().getElementTypeFilter(),yunhee_tab_type=GameContext.getInstance().getYunheeTabType();yunhee_tab_type==YunheeLevelUpTapTypeEnum.tab_type_yunhee?this.m_filter_gnrl_list=100!=element_type_filter?gs.getUserGeneralSellList(this.m_filter_gnrl_list,element_type_filter):gs.getUserGeneralSellList(this.m_filter_gnrl_list):yunhee_tab_type==YunheeLevelUpTapTypeEnum.tab_type_material&&(this.m_filter_gnrl_list=100!=yunhee_type_filter?gs.getUserGeneralMaterialSellList(this.m_filter_gnrl_list,yunhee_type_filter):gs.getUserGeneralMaterialSellList(this.m_filter_gnrl_list)),yunhee_tab_type=element_type_filter=yunhee_type_filter=null},setTroopsGeneral:function(position){var gs=GeneralService.getInstance(),troops_num=M_SELECT_TROOPS,gw_service=GreatWallService.getInstance(),ed_service=EventDungeonService.getInstance();this.m_setTroopsGnrl.pos_type=position,this.m_setTroopsGnrl.troops_num=troops_num;var _deck_status=this.m_yunheeLayer_V2.getDeckSatus();if(_deck_status==DECK_STATUS.ARRANGEMENT_SELECT_YUNHEE){var info=this.m_yunheeLayer_V2.getUserGeneralInfo();this.m_setTroopsGnrl.gnrl_id=info.gnrl_id,this.m_setTroopsGnrl.gnrl_num=info.gnrl_num;var count=gs.getTroopsGeneralCount(troops_num),isInTroops=gs.isExistGeneralInTroops(troops_num,this.m_setTroopsGnrl.gnrl_num);if(this.m_game_type==db.BattleGameType.GreatWallDungeon?(count=gw_service.getGreatWallTroopsGeneralCount(troops_num),isInTroops=gw_service.isExistGeneralInGreatWallTroops(troops_num,this.m_setTroopsGnrl.gnrl_num)):this.m_game_type==db.BattleGameType.EventDungeonSearch&&(count=ed_service.getEventDungeonSearchTroopsGeneralCount(troops_num),isInTroops=ed_service.isExistGeneralInEventDungeonSearchTroops(troops_num,this.m_setTroopsGnrl.gnrl_num)),count>=MAX_TROOPS_COUNT&&!isInTroops){var isExist=gs.isExistGeneralInPosType(troops_num,position);if(this.m_game_type==db.BattleGameType.GreatWallDungeon?isExist=gw_service.isExistGeneralInGreatWallPosType(troops_num,position):this.m_game_type==db.BattleGameType.EventDungeonSearch&&(isExist=ed_service.isExistGeneralInEventDungeonSearchPosType(troops_num,position)),!isExist)return USE_POPUP_INTERGRATION?this.showYunheePopup(res_str("label_general_max_in_troops_title"),res_str("label_general_max_in_troops_text_1"),res_str("label_general_max_in_troops_text_2"),res_str("label_general_max_in_troops_text_3")):this.showGeneraMaxCountlInTroops(),void this.m_yunheeLayer_V2.setArrangementDisabled()}var isSame=gs.isSameGeneralInTroops(troops_num,position,this.m_setTroopsGnrl);if(this.m_game_type==db.BattleGameType.GreatWallDungeon?isSame=gw_service.isSameGeneralInGreatWallTroops(troops_num,position,this.m_setTroopsGnrl):this.m_game_type==db.BattleGameType.EventDungeonSearch&&(isSame=ed_service.isSameGeneralInEventDungeonSearchTroops(troops_num,position,this.m_setTroopsGnrl)),isSame.result)USE_POPUP_INTERGRATION?this.showYunheePopup(res_str("label_general_not_in_troops_title"),res_str("label_general_not_in_troops_text_1"),res_str("label_general_not_in_troops_text_2")):this.showSameGeneralNotInTroops(),this.m_yunheeLayer_V2.setArrangementDisabled();else{var isCrrntPos=gs.checkTroopsPosition(this.m_setTroopsGnrl);if(this.m_game_type==db.BattleGameType.GreatWallDungeon?isCrrntPos=gw_service.checkGreatWallTroopsPosition(this.m_setTroopsGnrl):this.m_game_type==db.BattleGameType.EventDungeonSearch&&(isCrrntPos=ed_service.checkEventDungeonSearchTroopsPosition(this.m_setTroopsGnrl)),isCrrntPos)return void this.m_yunheeLayer_V2.setChangeSelectedEnd();var isCostOver=gs.isCostOver(this.m_setTroopsGnrl,troops_num),is_same_general_other=!1;if(this.m_game_type==db.BattleGameType.GreatWallDungeon?isCostOver=gw_service.isCostOver(this.m_setTroopsGnrl,troops_num):this.m_game_type==db.BattleGameType.EventDungeonSearch&&(isCostOver=!1,is_same_general_other=ed_service.isSameGeneraEventDungeonSearchOtherTroops(this.m_setTroopsGnrl)),isCostOver)this.showCostOverMsgBox(),this.m_yunheeLayer_V2.setArrangementDisabled();else if(is_same_general_other)USE_POPUP_INTERGRATION?this.showGameScenePopup(res_str("label_preparation_title"),res_str("label_event_dungeon_already_search_troops")):this.showAlreadyEventDungeonSearchTroops(),this.m_yunheeLayer_V2.setArrangementDisabled();else{if(this.m_game_type==db.BattleGameType.GreatWallDungeon)gw_service.getDelGeneralNumInGreatWallTroops(this.m_setTroopsGnrl.troops_num,this.m_setTroopsGnrl.pos_type,this.m_del_gnrl_key),(req={gnrl_key:{}}).opcode=net.OP.op_great_wall_troops_set,req.great_wall_dungeon_period_idx=gw_service.getCurrentGreatWallPeriodIdx(),req.gnrl_key.gnrl_id=this.m_setTroopsGnrl.gnrl_id,req.gnrl_key.gnrl_num=this.m_setTroopsGnrl.gnrl_num,req.troops_num=this.m_setTroopsGnrl.troops_num,req.position=this.m_setTroopsGnrl.pos_type,this.network_write(req),req={};else if(this.m_game_type==db.BattleGameType.EventDungeonSearch){(req={gnrl_key:{}}).opcode=net.OP.op_event_dungeon_search_troops_set,req.event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),req.gnrl_key.gnrl_id=this.m_setTroopsGnrl.gnrl_id,req.gnrl_key.gnrl_num=this.m_setTroopsGnrl.gnrl_num,req.troops_num=this.m_setTroopsGnrl.troops_num,req.position=this.m_setTroopsGnrl.pos_type,this.network_write(req),req={}}else{cc.log("set position"+position),this.m_del_gnrl_key=gs.getDelGeneralNumInTroops(this.m_setTroopsGnrl.troops_num,this.m_setTroopsGnrl.pos_type),(req={}).opcode=net.OP.op_troops_set_general_v2,req.gnrl_key={gnrl_id:this.m_setTroopsGnrl.gnrl_id,gnrl_num:this.m_setTroopsGnrl.gnrl_num},req.troops_num=this.m_setTroopsGnrl.troops_num,req.position=this.m_setTroopsGnrl.pos_type,this.network_write(req),req={}}}isCrrntPos=null}info=null}else{var isExistTroopsPos=gs.isExistUserTroopsPos(troops_num,position);if(this.m_game_type==db.BattleGameType.GreatWallDungeon?isExistTroopsPos=gw_service.isExistGeneralInGreatWallPosType(troops_num,position):this.m_game_type==db.BattleGameType.EventDungeonSearch&&(isExistTroopsPos=ed_service.isExistGeneralInEventDungeonSearchPosType(troops_num,position)),!isExistTroopsPos)return;if(_deck_status==DECK_STATUS.ARRANGEMENT_MODE||_deck_status==DECK_STATUS.ARRANGEMENT_SELECT_YUNHEE)if(this.m_game_type==db.BattleGameType.GreatWallDungeon)if(this.m_deleteTroops=gw_service.getGreatWallTroopsGeneral(troops_num,position),gw_service.isEnableReleasePartInGeneral(this.m_deleteTroops))(req={}).opcode=net.OP.op_great_wall_troops_del,req.great_wall_dungeon_period_idx=gw_service.getCurrentGreatWallPeriodIdx(),req.troops_num=troops_num,req.gnrl_key={},req.gnrl_key.gnrl_id=this.m_deleteTroops.gnrl_id,req.gnrl_key.gnrl_num=this.m_deleteTroops.gnrl_num,this.network_write(req),req={};else this.showGreatWallTroopsReleaseBox();else if(this.m_game_type==db.BattleGameType.EventDungeonSearch){this.m_deleteTroops=ed_service.getUerEventDungeonSearchTroopsGeneral(troops_num,position),(req={gnrl_key:{}}).opcode=net.OP.op_event_dungeon_search_troops_del,req.event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),req.gnrl_key.gnrl_id=this.m_deleteTroops.gnrl_id,req.gnrl_key.gnrl_num=this.m_deleteTroops.gnrl_num,req.troops_num=troops_num,this.network_write(req),req={}}else{gs.getUerTroopsGeneral(this.m_deleteTroops,troops_num,position),(in_gnrl={}).opcode=net.OP.op_troops_del_general_v2,in_gnrl.troops_num=troops_num,in_gnrl.gnrl_key={gnrl_id:this.m_deleteTroops.gnrl_id,gnrl_num:this.m_deleteTroops.gnrl_num},this.network_write(in_gnrl),in_gnrl={}}else if(_deck_status==DECK_STATUS.CHOICE_LEADER){if(this.m_game_type==db.BattleGameType.GreatWallDungeon)this.m_leaderTroops=gw_service.getGreatWallTroopsGeneral(troops_num,position),(req={gnrl_key:{}}).opcode=net.OP.op_great_wall_troops_leader_set,req.great_wall_dungeon_period_idx=gw_service.getCurrentGreatWallPeriodIdx(),req.troops_num=troops_num,req.gnrl_key.gnrl_id=this.m_leaderTroops.gnrl_id,req.gnrl_key.gnrl_num=this.m_leaderTroops.gnrl_num,this.network_write(req),req={};else if(this.m_game_type==db.BattleGameType.EventDungeonSearch){var req;this.m_leaderTroops=ed_service.getUerEventDungeonSearchTroopsGeneral(troops_num,position),(req={gnrl_key:{}}).opcode=net.OP.op_event_dungeon_search_troops_leader_set,req.event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),req.troops_num=troops_num,req.gnrl_key.gnrl_id=this.m_leaderTroops.gnrl_id,req.gnrl_key.gnrl_num=this.m_leaderTroops.gnrl_num,this.network_write(req),req={}}else{var in_gnrl;gs.getUerTroopsGeneral(this.m_leaderTroops,troops_num,position),(in_gnrl={}).opcode=net.OP.op_troops_leader_set,in_gnrl.troops_num=troops_num,in_gnrl.gnrl_key={gnrl_id:this.m_leaderTroops.gnrl_id,gnrl_num:this.m_leaderTroops.gnrl_num},this.network_write(in_gnrl),in_gnrl={}}}else{var key=GameContext.getInstance().getGeneralKey();if(0!=key.gnrl_id&&0!=key.num){var offset=this.m_yunheeLayer_V2.getTableViewOffset();GameContext.getInstance().setOffsetVerticalPercent(offset);var scene=new YunheeDetailScene;SceneManager.getInstance().replaceScene(scene,!0),scene=null}}isExistTroopsPos=null}},onNotifyStateFilter:function(sender){var msg=sender,filterGnrlList=[],gService=GeneralService.getInstance();if(this.m_yunheeLayer_V2.getDeckSatus()==DECK_STATUS.SELL_MODE||this.m_yunheeLayer_V2.getDeckSatus()==DECK_STATUS.BATCH_SELL_MODE)filterGnrlList=100!=msg?gService.getUserGeneralSellList(filterGnrlList,msg):gService.getUserGeneralSellList(filterGnrlList),this.m_yunheeLayer_V2.setUserFilterGnrlList(filterGnrlList),this.m_yunheeLayer_V2.setSellMode();else{if(100==msg)gService.getUserGeneralInfoList(filterGnrlList);else{var start=(new Date).getTime();gService.getUserGeneralInfoList(filterGnrlList,msg);var elapsed=(new Date).getTime()-start;cc.log("#########"+elapsed)}this.m_yunheeLayer_V2.setUserFilterGnrlList(filterGnrlList),this.m_yunheeLayer_V2.sort()}this.m_yunheeLayer_V2.setStateFilter(msg),filterGnrlList=[]},onNotifyMaterialFilter:function(sender){var msg=sender,filterGnrlList=[],gService=GeneralService.getInstance();this.m_yunheeLayer_V2.getDeckSatus()==DECK_STATUS.SELL_MODE||this.m_yunheeLayer_V2.getDeckSatus()==DECK_STATUS.BATCH_SELL_MODE?(filterGnrlList=100!=msg?gService.getUserGeneralMaterialSellList(filterGnrlList,msg):gService.getUserGeneralMaterialSellList(filterGnrlList),this.m_yunheeLayer_V2.setUserFilterGnrlList(filterGnrlList),this.m_yunheeLayer_V2.setSellMode()):(100==msg?(gService.getUserGeneralMaterialInfoList(filterGnrlList),this.mask_bg.setVisible(!1),this.mask_bg.setOpacity(0)):gService.getUserGeneralMaterialInfoList(filterGnrlList,msg),this.m_yunheeLayer_V2.setUserFilterGnrlList(filterGnrlList),this.m_yunheeLayer_V2.sort()),this.m_yunheeLayer_V2.getDeckSatus()!=DECK_STATUS.ARRANGEMENT_MODE&&this.m_yunheeLayer_V2.getDeckSatus()!=DECK_STATUS.ARRANGEMENT_SELECT_YUNHEE||(this.m_bg.setColor(cc.color(255,255,255)),this.m_yunheeLayer_V2.setArrangementMode()),this.m_yunheeLayer_V2.setMaterialFilter(msg),filterGnrlList=[]},onEnter:function(){this._super(),this.m_gameObserver.addObserver(this.onNotification,this,sceneStr[scene_YunheeScene]),this.m_gameObserver.addObserver(this.onNotifyStateFilter,this,NOTIFICATION_ELEMENT_TYPE_FILTER),this.m_gameObserver.addObserver(this.onNotifyMaterialFilter,this,NOTIFICATION_YUNHEE_TYPE_FILTER)},onExit:function(){this._super();var g=GameContext.getInstance();g.setYunheePrevSceneId(0),g.setYunheeArrangeMode(!1);var offset=this.m_yunheeLayer_V2.getTableViewOffset();GameContext.getInstance().setOffsetVerticalPercent(offset),this.m_gameObserver.removeObserver(sceneStr[scene_YunheeScene]),this.m_gameObserver.removeObserver(NOTIFICATION_ELEMENT_TYPE_FILTER),this.m_gameObserver.removeObserver(NOTIFICATION_YUNHEE_TYPE_FILTER),this.m_batch_sell_counts=[],this.m_batch_rare_type_check_box=[],this.m_batch_sell_rare_types=[],this.m_radio_group=[],this.m_user_troops_list=[],this.m_user_gnrl_list=[],this.m_filter_gnrl_list=[],this.m_batch_sell_counts=null,this.m_batch_rare_type_check_box=null,this.m_batch_sell_rare_types=null,this.m_radio_group=null,this.m_user_troops_list=null,this.m_user_gnrl_list=null,this.m_filter_gnrl_list=null,this.m_deferred=null,delete this.m_batch_sell_counts,delete this.m_batch_rare_type_check_box,delete this.m_batch_sell_rare_types,delete this.m_radio_group,delete this.m_user_troops_list,delete this.m_user_gnrl_list,delete this.m_filter_gnrl_list,1!=this.m_isPopupShow?(this.m_yunheeLayer_V2.removeAllChildrenWithCleanup(!0),this.removeAllChildrenWithCleanup(!0)):this.m_isPopupShow=!1},onNetworkEvent:function(opcode,state,body){if(opcode==net.OP.op_event_dungeon_open_period_info){var scene=new YunheeDetailScene;return SceneManager.getInstance().replaceScene(scene),void(scene=null)}if(this.m_del_gnrl_key={gnrl_id:0,gnrl_num:0},opcode==net.OP.op_troops_del_general_v2){this.updateUserGeneralInfoList(),this.m_yunheeLayer_V2.setUserTroopsGnrlList(this.m_user_troops_list),this.m_yunheeLayer_V2.setUserFilterGnrlList(this.m_filter_gnrl_list),this.m_yunheeLayer_V2.resetUserTroops(this.m_deleteTroops.gnrl_num);var snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_disarming.mp3";AudioEngine.getInstance().playEffect(snd),snd=null}if(opcode==net.OP.op_event_dungeon_search_troops_del)if(body.error==net.ERROR.NET_E_GENERAL_IN_CAMP)USE_POPUP_INTERGRATION?this.showYunheePopup(res_str("label_general_error_using_in_camp_title"),res_str("label_general_error_using_in_camp_text1"),res_str("label_general_error_using_in_camp_text2")):this.showUsingInCampMsgBox();else{this.updateUserGeneralInfoList(),this.m_yunheeLayer_V2.setUserTroopsGnrlList(this.m_user_troops_list),this.m_yunheeLayer_V2.setUserFilterGnrlList(this.m_filter_gnrl_list),this.m_yunheeLayer_V2.setTroopsGeneral(this.m_del_gnrl_key);snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_dispose.mp3";AudioEngine.getInstance().playEffect(snd),snd=null}if(opcode==net.OP.op_troops_set_general_v2)if(body.error==net.ERROR.NET_E_GENERAL_IN_CAMP)USE_POPUP_INTERGRATION?this.showYunheePopup(res_str("label_general_error_using_in_camp_title"),res_str("label_general_error_using_in_camp_text1"),res_str("label_general_error_using_in_camp_text2")):this.showUsingInCampMsgBox();else{this.updateUserGeneralInfoList(),this.m_yunheeLayer_V2.setUserTroopsGnrlList(this.m_user_troops_list),this.m_yunheeLayer_V2.setUserFilterGnrlList(this.m_filter_gnrl_list),this.m_yunheeLayer_V2.setTroopsGeneral(this.m_del_gnrl_key);snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_dispose.mp3";AudioEngine.getInstance().playEffect(snd),snd=null}if(opcode==net.OP.op_event_dungeon_search_troops_set||opcode==net.OP.op_event_dungeon_search_troops_auto_pairing||opcode==net.OP.op_event_dungeon_search_troops_batch_off)if(body.error==net.ERROR.NET_E_GENERAL_IN_CAMP)USE_POPUP_INTERGRATION?this.showYunheePopup(res_str("label_general_error_using_in_camp_title"),res_str("label_general_error_using_in_camp_text1"),res_str("label_general_error_using_in_camp_text2")):this.showUsingInCampMsgBox();else{this.updateUserGeneralInfoList(),this.m_yunheeLayer_V2.setUserTroopsGnrlList(this.m_user_troops_list),this.m_yunheeLayer_V2.setUserFilterGnrlList(this.m_filter_gnrl_list),this.m_yunheeLayer_V2.setTroopsGeneral(this.m_del_gnrl_key);snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_dispose.mp3";AudioEngine.getInstance().playEffect(snd),snd=null,opcode!=net.OP.op_event_dungeon_search_troops_auto_pairing&&opcode!=net.OP.op_event_dungeon_search_troops_batch_off||(this.m_yunheeLayer_V2.getDeckSatus()==DECK_STATUS.NONE?(this.mask_bg.setVisible(!0),this.mask_bg.setOpacity(200)):this.m_yunheeLayer_V2.getDeckSatus()==DECK_STATUS.CHOICE_LEADER?(this.mask_bg.setVisible(!0),this.mask_bg.setOpacity(200),this.m_yunheeLayer_V2.setLeaderMode()):(this.mask_bg.setVisible(!1),this.mask_bg.setOpacity(0)),this.m_yunheeLayer_V2.setArrangementMode())}if(opcode==net.OP.op_event_dungeon_search_troops_auto_pairing&&this.m_yunheeLayer_V2.setDeckStatus(DECK_STATUS.NONE),opcode==net.OP.op_general_sel&&(this.removeLayerProgress(),body.error==net.ERROR.NET_E_GENERAL_IN_CAMP?USE_POPUP_INTERGRATION?this.showYunheePopup(res_str("label_general_error_using_in_camp_title"),res_str("label_general_error_using_in_camp_text1"),res_str("label_general_error_using_in_camp_text2")):this.showUsingInCampMsgBox():(this.updateUserGeneralInfoList(),this.m_yunheeLayer_V2.setUserTroopsGnrlList(this.m_user_troops_list),this.removeChild(this.m_sellPopup),this.m_sellPopup=null,this.m_yunheeLayer_V2.getDeckSatus()==DECK_STATUS.SELL_MODE?(this.updateUserGeneralInfoSellList(),this.m_yunheeLayer_V2.setUserFilterGnrlList(this.m_filter_gnrl_list),this.m_yunheeLayer_V2.setSellMode()):this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],NOTIFY_MENU_YUNHEE_SELL_CANCEL),this.showSellCompleteMsgBox(body.gnrl_keys.length,body.gain_gold,body.gain_yhpt,body.gain_hvpt))),opcode==net.OP.op_troops_leader_set){this.updateUserGeneralInfoList(),this.m_yunheeLayer_V2.setUserTroopsGnrlList(this.m_user_troops_list),this.m_yunheeLayer_V2.setUserFilterGnrlList(this.m_filter_gnrl_list),this.m_yunheeLayer_V2.resetUserTroops(),this.m_yunheeLayer_V2.setDeckStatus(DECK_STATUS.NONE);snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_dispose.mp3";AudioEngine.getInstance().playEffect(snd),snd=null}if(opcode==net.OP.op_yunhee_inventory_increase&&(this.showInventoryIncreaseConfirm(body.user_yunhee_bound),this.m_yunheeLayer_V2.setUserYunheeBound()),opcode==net.OP.op_great_wall_troops_set)if(body.error==net.ERROR.NET_E_SUCCESS){this.updateUserGeneralInfoList(),this.m_yunheeLayer_V2.setUserTroopsGnrlList(this.m_user_troops_list),this.m_yunheeLayer_V2.setUserFilterGnrlList(this.m_filter_gnrl_list),this.m_yunheeLayer_V2.setTroopsGeneral(this.m_del_gnrl_key);snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_dispose.mp3";AudioEngine.getInstance().playEffect(snd),snd=null}else if(body.error==net.ERROR.NET_E_GENERAL_IN_CAMP)USE_POPUP_INTERGRATION?this.showYunheePopup(res_str("label_general_error_using_in_camp_title"),res_str("label_general_error_using_in_camp_text1"),res_str("label_general_error_using_in_camp_text2")):this.showUsingInCampMsgBox();else if(body.error==net.ERROR.NET_E_ALREADY_ELSE_TROOPS_INCLUDE){(msg=[]).push_back(res_str("label_great_wall_error_msg_already_else_troops_include")),this.showMsgBox(msg),msg=null}else if(body.error==net.ERROR.NET_E_ALREADY_BATTLE_START_GNRL){(msg=[]).push_back(res_str("label_great_wall_error_msg_already_battle_start_gnrl_1")),msg.push_back(res_str("label_great_wall_error_msg_already_battle_start_gnrl_2")),this.showMsgBox(msg),msg=null}else if(body.error==net.ERROR.NET_E_GNRL_LIFE_IS_EMPTY){(msg=[]).push_back(res_str("label_great_wall_error_msg_gnrl_life_is_empty_1")),msg.push_back(res_str("label_great_wall_error_msg_gnrl_life_is_empty_2")),this.showMsgBox(msg),msg=null}else if(body.error==net.ERROR.NET_E_TROOPS_IN_POSITION_GNRL_ALREADY_BATTLE_START){(msg=[]).push_back(res_str("label_great_wall_error_msg_troops_in_position_gnrl_already_battle_start_1")),msg.push_back(res_str("label_great_wall_error_msg_troops_in_position_gnrl_already_battle_start_2")),this.showMsgBox(msg),msg=null}else if(body.error==net.ERROR.NET_E_PARTIN_BATTLE_COUNT_ALREADY_FULL){(msg=[]).push_back(res_str("label_great_wall_partin_count_funn_msg_1")),msg.push_back(res_str("label_great_wall_partin_count_funn_msg_2")),msg.push_back(res_str("label_great_wall_partin_count_funn_msg_3")),this.showMsgBox(msg),msg=null}if(opcode==net.OP.op_great_wall_troops_del)if(body.error==net.ERROR.NET_E_SUCCESS){this.updateUserGeneralInfoList(),this.m_yunheeLayer_V2.setUserTroopsGnrlList(this.m_user_troops_list),this.m_yunheeLayer_V2.setUserFilterGnrlList(this.m_filter_gnrl_list),this.m_yunheeLayer_V2.resetUserTroops(this.m_deleteTroops.gnrl_num);snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_disarming.mp3";AudioEngine.getInstance().playEffect(snd),snd=null}else if(body.error==net.ERROR.NET_E_ALREADY_BATTLE_START_GNRL){(msg=[]).push_back(res_str("label_great_wall_error_msg_already_battle_start_gnrl_1")),msg.push_back(res_str("label_great_wall_error_msg_already_battle_start_gnrl_3")),this.showMsgBox(msg),msg=null}if(opcode==net.OP.op_great_wall_troops_general_force_release&&body.error==net.ERROR.NET_E_SUCCESS){this.updateUserGeneralInfoList(),this.m_yunheeLayer_V2.setUserTroopsGnrlList(this.m_user_troops_list),this.m_yunheeLayer_V2.setUserFilterGnrlList(this.m_filter_gnrl_list),this.m_yunheeLayer_V2.resetUserTroops(this.m_deleteTroops.gnrl_num);var msg;snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_disarming.mp3";AudioEngine.getInstance().playEffect(snd),snd=null,(msg=[]).push_back(res_str("label_great_wall_dungeon_forec_release_complete")),this.showMsgBox(res_str("label_great_wall_dungeon_title"),msg),msg=null}if(opcode==net.OP.op_great_wall_troops_leader_set&&body.error==net.ERROR.NET_E_SUCCESS){this.updateUserGeneralInfoList(),this.m_yunheeLayer_V2.setUserTroopsGnrlList(this.m_user_troops_list),this.m_yunheeLayer_V2.setUserFilterGnrlList(this.m_filter_gnrl_list),this.m_yunheeLayer_V2.resetUserTroops(),this.m_yunheeLayer_V2.setDeckStatus(DECK_STATUS.NONE);snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_dispose.mp3";AudioEngine.getInstance().playEffect(snd),snd=null}if(opcode==net.OP.op_event_dungeon_search_troops_leader_set&&body.error==net.ERROR.NET_E_SUCCESS){this.updateUserGeneralInfoList(),this.m_yunheeLayer_V2.setUserTroopsGnrlList(this.m_user_troops_list),this.m_yunheeLayer_V2.setUserFilterGnrlList(this.m_filter_gnrl_list),this.m_yunheeLayer_V2.resetUserTroops(),this.m_yunheeLayer_V2.setDeckStatus(DECK_STATUS.NONE);snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_dispose.mp3";AudioEngine.getInstance().playEffect(snd),snd=null}},showSellCompleteMsgBox:function(gnrl_count,gain_gold,gain_yhpt,gain_hvpt){this.m_ctbox.setTitle("売却完了");var yunhee_tab_type=GameContext.getInstance().getYunheeTabType();yunhee_tab_type==YunheeLevelUpTapTypeEnum.tab_type_yunhee?(this.m_ctbox.setText("恋姫 ",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText(gnrl_count+"体",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("を売却して",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n")):yunhee_tab_type==YunheeLevelUpTapTypeEnum.tab_type_material&&(this.m_ctbox.setText("素材 ",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText(gnrl_count+"体",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("を売却して",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n")),0!=gain_yhpt?(0!=gain_hvpt?(this.m_ctbox.setText("金貨 "+Number(gain_gold).toLocaleString("en"),LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText(", ",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("恋姫PT "+Number(gain_yhpt).toLocaleString("en"),LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("\n"),this.m_ctbox.setText("天翔PT "+Number(gain_hvpt).toLocaleString("en"),LABEL_FONT_INDEX.FONT_262)):(this.m_ctbox.setText("金貨 "+Number(gain_gold).toLocaleString("en"),LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText(", ",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("恋姫PT "+Number(gain_yhpt).toLocaleString("en"),LABEL_FONT_INDEX.FONT_262)),this.m_ctbox.setText("を獲得しました。",LABEL_FONT_INDEX.FONT_261)):0!=gain_hvpt?(this.m_ctbox.setText("金貨 "+Number(gain_gold).toLocaleString("en"),LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText(", ",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("天翔PT "+Number(gain_hvpt).toLocaleString("en"),LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("を獲得しました。",LABEL_FONT_INDEX.FONT_261)):(this.m_ctbox.setText("金貨 "+Number(gain_gold).toLocaleString("en"),LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText(" を獲得しました。",LABEL_FONT_INDEX.FONT_261)),this.m_ctbox.addButtonInfo(new MessageButtonInfo("確認",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_ctbox.hide(!1)}.bind(this))),this.m_ctbox.show()},showCastleMasterInSellList:function(){this.m_box.setTitle("恋姫売却"),this.m_box.setText("売却する恋姫の中に領主に配置されている恋姫がいます。"),this.m_box.setText("\n"),this.m_box.setText("売却しますか。"),this.m_box.addButtonInfo(new MessageButtonInfo("いいえ",MessageBoxButtonType.ButtonTypeRed,0,function(){this.scheduleOnce(function(float){this.showYunheeSellMsgBox()},0,"btnYes"),this.m_box.hide(!1)}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo("はい",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},sendPacketYunheeSell:function(){for(var g_service=GeneralService.getInstance(),keys=this.m_yunheeLayer_V2.getSellGeneralKeys(),temp_keys=[],idx=0;idx<keys.length;idx++){var temp_key={};temp_key.gnrl_id=keys[idx].gnrl_id,temp_key.gnrl_num=keys[idx].gnrl_num,(gnrl_key={}).gnrl_id=keys[idx].gnrl_id,gnrl_key.gnrl_num=keys[idx].gnrl_num;var gnrl={};g_service.getUserGeneralInfo(gnrl_key,gnrl),temp_key.limit_step_id=gnrl.limit_step_id,temp_keys.push(temp_key),temp_key={},gnrl_key={},gnrl={}}temp_keys=stable(temp_keys,function(l,r){return l.limit_step_id>r.limit_step_id});for(var user_general_keys=[],i=0;i<temp_keys.size();i++){var gnrl_key;(gnrl_key={}).gnrl_id=temp_keys[i].gnrl_id,gnrl_key.gnrl_num=temp_keys[i].gnrl_num,user_general_keys.push(gnrl_key),gnrl_key={}}var register={};register.opcode=net.OP.op_general_sel,register.gnrl_keys=user_general_keys,register.gain_gold=this.m_yunheeLayer_V2.getSellGold(),register.gain_yhpt=this.m_yunheeLayer_V2.getSellYhpt(),register.gain_hvpt=this.m_yunheeLayer_V2.getSellHeavenPt(),this.network_write(register),register={},temp_keys=[]},onNetworkConnect:function(){},onNetworkShutdown:function(){},showInventoryIncrease:function(){this.m_box.is_show()&&this.m_box.hide(!1),this.m_ctbox.is_show()&&this.m_ctbox.hide(!1);var bonus_obj=GeneralService.getInstance().getYunheeRetentionInfo();this.m_yunhee_inc_jade=bonus_obj.value;var bonus_type=bonus_obj.name,yunhee_inventory_inc=MasterManager.getInstance().get_CountFunction(COUNT_FUNCTION_YUNHEE_INVENTORY_INCREASE_SIZE).value;this.m_ctbox.setTitle("待機室拡張"),this.m_ctbox.setText("待機室を拡張しますか。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(bonus_type+this.m_yunhee_inc_jade,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("使用",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("("+yunhee_inventory_inc+" スロット拡張)",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.addButtonInfo(new MessageButtonInfo("いいえ",MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_ctbox.hide(!1)}.bind(this))),this.m_ctbox.addButtonInfo(new MessageButtonInfo("はい",MessageBoxButtonType.ButtonTypeNormal,0,function(){NetService().get_UserItemInfo_V2().jade_cnt<this.m_yunhee_inc_jade?this.scheduleOnce(function(float){this.showNotEnoughJade()},0,"showNotEnoughJade"):this.scheduleOnce(function(float){var req={};req.opcode=net.OP.op_yunhee_inventory_increase,this.network_write(req)},0,"Req_Yunhee_Inventory_Increase"),this.m_ctbox.hide(!1)}.bind(this))),this.m_ctbox.show()},getCurrentTroopsNum:function(){var gd=GameDefault.getInstance(),context=BattleContext._getInstance();this.m_game_type=context.getGameType();var troops_num=1;if(this.m_game_type==db.BattleGameType.WeeklyDungeon)this.m_weekly_difficulty=context.getWeeklyDungeonDifficulty(),gd.getUserWeeklyTroopsNum().done(function(rVal){troops_num=rVal});else if(this.m_game_type==db.BattleGameType.Mussang){context.getMussangId();gd.getUserMussangTroopsNum().done(function(rVal){troops_num=rVal})}else if(this.m_game_type==db.BattleGameType.Mission||this.m_game_type==db.BattleGameType.None){if(1==USE_LOCAL_STORAGE_TROOPS_OFF)troops_num=gd.getUserTroopsNum();else gd.getUserTroopsNum().done(function(data){troops_num=data})}else if(this.m_game_type==db.BattleGameType.EventDungeon){context.getEventDungeonId();this.m_event_dungeon=context.getEventDungeonData(),gd.getUserEventDungeonTroopsNum().done(function(rVal){troops_num=rVal})}else if(this.m_game_type==db.BattleGameType.DailyDungeon)this.m_daily_dungeon=context.getDailyDungeonData(),gd.getUserDailyDungeonTroopsNum().done(function(data){troops_num=data});else if(this.m_game_type==db.BattleGameType.RaidDungeon){var raid_boss=BattleContext._getInstance().getRaidBossData();gd.getUserRaidBossElementTroopsNum(raid_boss.raid_boss_info_idx).done(function(data){troops_num=data})}else if(this.m_game_type==db.BattleGameType.GreatWallDungeon){gd.getUserGreatWallTroopsNum().done(function(rVal){troops_num=rVal})}else if(this.m_game_type==db.BattleGameType.EventDungeonSearch){GameContext.getInstance().getEvenetDungeonSearchTroopsNum().done(function(rVal){troops_num=rVal})}else if(this.m_game_type==db.BattleGameType.TowerDungeon){gd.getUserTowerDungeonTroopsNum().done(function(rVal){troops_num=rVal})}else if(this.m_game_type==db.BattleGameType.OnceADayDungeon){gd.getUserOnceADayDungeonTroopsNum().done(function(rVal){troops_num=rVal})}else if(this.m_game_type==db.BattleGameType.EventMussangBossDungeon){gd.getUserEventMussangBossTroopsNum().done(function(rVal){troops_num=rVal})}else if(this.m_game_type==db.BattleGameType.EventRaidDungeon){gd.getUserEventRaidDungeonTroopsNum().done(function(rVal){troops_num=rVal})}return troops_num},onTutorialSetting:function(){var step=TutorialContextV2.getInstance().getCurrentTutorialStep();this.setTutorialStep(step)},onTutorialEnter:function(step){TutorialContextV2.getInstance();this.setTutorialStep(step),step.tutorial_page==TUTORIAL_PAGE_2_LEVEL_UP?step.tutorial_step==TUTO_STEP_P2_START_DIALOG?this.popTutorialLayer():6==step.tutorial_step&&this.popTutorialLayer():step.tutorial_page==TUTORIAL_PAGE_3_LOVE_LEVEL_UP||(step.tutorial_page==TUTORIAL_PAGE_4_LOVE_CG?step.tutorial_step==TUTO_STEP_P4_START_DIALOG&&this.popTutorialLayer():(step.tutorial_page,TUTORIAL_PAGE_5_TROOPS))},showGreatWallTroopsReleaseBox:function(){this.m_box.setTitle(res_str("label_great_wall_dungeon_title")),this.m_box.setText(res_str("label_great_wall_dungeon_force_release_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_great_wall_dungeon_force_release_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_cancel"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_release"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(),this.scheduleOnce(function(float){this.reqGreatWallTroopsForceRelease()},0,"reqGreatWallTroopsForceRelease")}.bind(this))),this.m_box.show()},reqGreatWallTroopsForceRelease:function(){var troops_num=this.getCurrentTroopsNum(),great_wall_dungeon_period_idx=GreatWallService.getInstance().getCurrentGreatWallPeriodIdx();if(0!=great_wall_dungeon_period_idx){var req={};req.opcode=net.OP.op_great_wall_troops_general_force_release,req.great_wall_dungeon_period_idx=great_wall_dungeon_period_idx,req.gnrl_key={},req.gnrl_key.gnrl_id=this.m_deleteTroops.gnrl_id,req.gnrl_key.gnrl_num=this.m_deleteTroops.gnrl_num,req.troops_num=troops_num,this.network_write(req),req={}}},showYunheePopup:function(){this.m_box.is_show()&&this.m_box.hide();for(var val=arguments,msg=[],i=1;i<val.length;i++)msg.push(val[i]);this.showMsgBox(val[0],msg),msg=null},showGeneraMaxCountlInTroops:function(){this.m_box.setTitle(res_str("label_general_max_in_troops_title")),this.m_box.setText(res_str("label_general_max_in_troops_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_general_max_in_troops_text_2")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_general_max_in_troops_text_3")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showSameGeneralNotInTroops:function(){this.m_box.setTitle(res_str("label_general_not_in_troops_title")),this.m_box.setText(res_str("label_general_not_in_troops_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_general_not_in_troops_text_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showSellCountMaxMsgBox:function(){this.m_box.setTitle(res_str("label_yunhee_sell_title")),this.m_box.setText(res_str("label_yunhee_sell_max_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_yunhee_sell_max_text_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showNotHaveBatchSellGeneral:function(){this.m_box.setTitle(res_str("label_yunhee_sell_title")),this.m_box.setText(res_str("label_yunhee_not_have_batch_sell_general")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showUsingInCampMsgBox:function(){this.m_box.setTitle(res_str("label_general_error_using_in_camp_title")),this.m_box.setText(res_str("label_general_error_using_in_camp_text1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_general_error_using_in_camp_text2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showInvalidTroopsSetMaterial:function(){this.m_box.setTitle(res_str("label_invalid_troops_set_material_title")),this.m_box.setText(res_str("label_invalid_troops_set_material_message")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()}}),res_download_complete=1,res_download_error=2,show_evolve_effect=498901,show_limitover_effect=498902,LOVE_ITEM_SELECT="love_item_select",MAX_MSG_BOX_WIDTH=630,MAX_MSG_BOX_HEIGHT=370,MAX_SELECT_CHARACTER_ITEM_SIZE=3,YunheeDetailScene=GameScene.extend({m_need_gold:0,m_need_hwandan:0,m_skeleton_action_index:0,m_isSpineMode:!1,m_character_skeleton:null,m_characterImg:null,m_skeletonNode:null,m_evolveModalLayer:null,m_largeCardModalLayer:null,m_levelUpEffectLayer:null,m_partnerSetModalLayer:null,m_yunheeSelectModalLayer:null,m_detailLayer:null,m_characterLayer:null,m_downerror:0,m_res_download_count:0,m_totalzipcount:0,m_curzipcount:0,m_layer:null,m_touchEventLayer:null,m_yunheeDetailLayer:null,m_evolutionResultLayer:null,m_card_bg:null,m_detailCard:null,m_ani_img:null,m_effect_img_01:null,m_effect_img_02:null,m_effect_img_03:null,m_effect_img_04:null,m_effect_img_05:null,m_skeletonLevelupEffectNode:null,m_skeletonLoveupEffectNode:null,m_skeletonBackgroundEffectNode:null,m_mtrlShortcutsModalLayer:null,m_is_voice_playing:!1,m_voice_playing_delta:0,m_limitOverModalLayer:null,m_is_partner_select:!1,m_is_friend_partner_select:!1,m_notification_id:null,m_progres_bar:null,m_characterIds:[],m_characterItemLayers:[],m_equipemnt_change_modal_layer:null,m_rebirth_info_modal_layer:null,m_beforeLoveLevel:null,m_standing_view_modal_layer:null,m_skillExplainPopup:null,m_passiveExplainPopup:null,m_LeaderSkillExplainPopup:null,m_img_scale:1,m_partner_select_btn:null,m_main_gnrl_select_btn:null,m_bg:null,m_state_img:null,m_character_pos:null,m_standing_id:0,m_gnrlInfo:null,m_deferred:$.Deferred(),m_gnrl_img:[],m_gnrl_res_img:[],m_sd_img:[],m_resources:[],m_save_partid:0,m_save_morph:!1,ctor:function(){this.m_gnrl_img=[],this.m_sd_img=[],this.m_resources=[],this.m_deferred=$.Deferred(),this._super(scene_YunheeDetailScene)},init:function(){this.initLayoutProgress_YunheeDetail(),this.m_notification_id="yunheeDetailScene",this.m_resources=[],USE_SHORTCUT_EVOLUTION_ICON?(this.m_resources.push(RES_CDN_DEFULT+"icon/shortcut_evolution/"+SHORTCUT_EVOLUTION_TEXTURE+".plist"),this.m_resources.push(RES_CDN_DEFULT+"icon/shortcut_evolution/"+SHORTCUT_EVOLUTION_TEXTURE+".png")):(this.m_resources.push(RES_CDN_DEFULT+"icon/evolve_small/"+ICON_EVOLVE_SMALL_TEXTURE+".plist"),this.m_resources.push(RES_CDN_DEFULT+"icon/evolve_small/"+ICON_EVOLVE_SMALL_TEXTURE+".png"),this.m_resources.push(RES_CDN_DEFULT+"icon/formation/"+FORMATION_TEXTURE+".plist"),this.m_resources.push(RES_CDN_DEFULT+"icon/formation/"+FORMATION_TEXTURE+".png")),this.m_resources.push(RES_CDN_DEFULT+"effect/Affinity.json"),this.m_resources.push(RES_CDN_DEFULT+"effect/Affinity.atlas"),this.m_resources.push(RES_CDN_DEFULT+"effect/Affinity.png"),IS_SP_BROWSER||this.m_resources.push(RES_CDN_DEFULT+"effect/Affinity2.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_n.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_r.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_hr.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_s.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_ss.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_01.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_02.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_03.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_04.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_05.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_06.png"),this.m_resources.push(RES_CDN_DEFULT+"icon/img_icon_valuebox_4.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_zoom_gauge.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_zoom_gauge_mint.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_feel_veluebox.png"),this.m_resources.push(RES_CDN_DEFULT+"common/img_list_01.png"),NOT_USE_SP_MAIN_ANIMATION&&(this.m_resources.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_yh_lvup_01.png"),this.m_resources.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_evolve_12.png"),this.m_resources.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_limit_16.png"),this.m_resources.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_limit_lv_53_06.png"),this.m_resources.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_limit_lv_56_06.png"),this.m_resources.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_limit_lv_59_06.png"),this.m_resources.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_limit_lv_62_06.png"),this.m_resources.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_limit_lv_65_06.png"),this.m_resources.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_rebirth_12.png"),this.m_resources.push(RES_CDN_DEFULT+"gacha_effect/gacha_effect_sprite/rare_type_01_loop_08.png"),this.m_resources.push(RES_CDN_DEFULT+"gacha_effect/gacha_effect_sprite/rare_type_02_loop_08.png"),this.m_resources.push(RES_CDN_DEFULT+"gacha_effect/gacha_effect_sprite/rare_type_03_loop_08.png"),this.m_resources.push(RES_CDN_DEFULT+"gacha_effect/gacha_effect_sprite/rare_type_04_loop_08.png"),this.m_resources.push(RES_CDN_DEFULT+"gacha_effect/gacha_effect_sprite/rare_type_05_loop_08.png"),this.m_resources.push(RES_CDN_DEFULT+"gacha_effect/gacha_effect_sprite/rare_type_06_loop_08.png"),this.m_resources.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_n_06.png"),this.m_resources.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_hr_06.png"),this.m_resources.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_sr_06.png"),this.m_resources.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_ssr_06.png"),this.m_resources.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_ssr_rebirth_06.png")),resourceLoader(this.m_resources,function(){USE_SHORTCUT_EVOLUTION_ICON?cc.spriteFrameCache.addSpriteFrames(RES_CDN_DEFULT+"icon/shortcut_evolution/"+SHORTCUT_EVOLUTION_TEXTURE+".plist"):(cc.spriteFrameCache.addSpriteFrames(RES_CDN_DEFULT+"icon/evolve_small/"+ICON_EVOLVE_SMALL_TEXTURE+".plist"),cc.spriteFrameCache.addSpriteFrames(RES_CDN_DEFULT+"icon/formation/"+FORMATION_TEXTURE+".plist"));GameContext.getInstance().getGeneralKey();return this.initLayout(YUNHEE_DETAIL_NORMAL),this.m_evolveModalLayer=new EvolutionEffectLayer,this.addChild(this.m_evolveModalLayer,100),this.m_limitOverModalLayer=new LimitOverEffectLayer,this.addChild(this.m_limitOverModalLayer,100),this.m_largeCardModalLayer=new GameModalLayer,this.addChild(this.m_largeCardModalLayer,100),this.m_levelUpEffectLayer=new GameModalLayer,this.addChild(this.m_levelUpEffectLayer,100),this.m_partnerSetModalLayer=new GameModalLayer,this.addChild(this.m_partnerSetModalLayer,100),this.m_yunheeSelectModalLayer=new GameModalLayer,this.addChild(this.m_yunheeSelectModalLayer,100),this.m_mtrlShortcutsModalLayer=new ShortcutsLayer,this.addChild(this.m_mtrlShortcutsModalLayer,100),this.m_equipemnt_change_modal_layer=new GameModalLayer,this.addChild(this.m_equipemnt_change_modal_layer,100),this.m_rebirth_info_modal_layer=new GameModalLayer,this.addChild(this.m_rebirth_info_modal_layer,100),this.m_standing_view_modal_layer=new GameModalLayer,this.addChild(this.m_standing_view_modal_layer,100),USE_SKILL_INFO_POPUP&&(this.m_skillExplainPopup=new GameModalLayer,this.addChild(this.m_skillExplainPopup,100),this.m_passiveExplainPopup=new GameModalLayer,this.addChild(this.m_passiveExplainPopup,100),this.m_LeaderSkillExplainPopup=new GameModalLayer,this.addChild(this.m_LeaderSkillExplainPopup,100)),(this.m_gnrlInfo.gnrl_type==GENERAL_TYPE_YUNHEE||this.m_gnrlInfo.gnrl_type==GENERAL_TYPE_SOLDIER||this.m_gnrlInfo.gnrl_type==GENERAL_TYPE_LIMIT_OVER&&1!=this.m_gnrlInfo.class_type)&&(this.initEventListener(),this.initDonwloader()),GameContext.getInstance().setEquipmentDataChanged(EquipmentChangedData.data_init),this.removeLayoutProgress_YunheeDetail(),!0}.bind(this))},get_story_deferred:function(){return this.m_deferred},initDonwloader:function(gnrl_img){},initEventListener:function(){var listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(touch,event){var rect=cc.rect(this.m_touchEventLayer.getPosition().x,this.m_touchEventLayer.getPosition().y,this.m_touchEventLayer.getContentSize().width,this.m_touchEventLayer.getContentSize().height),pos=touch.getLocation();return!!cc.rectContainsPoint(rect,pos)}.bind(this),onTouchEnded:function(touch,event){var m=MasterTable.getInstance();if(this.m_isSpineMode){2<this.m_skeleton_action_index&&(this.m_skeleton_action_index=1),0==this.m_skeleton_action_index?(this.m_skeletonNode.setAnimation(0,"prepare",!1),this.m_skeletonNode.addAnimation(0,"idle",!0)):1==this.m_skeleton_action_index?(this.m_skeletonNode.setAnimation(0,"attack1",!1),this.m_skeletonNode.addAnimation(0,"idle",!0)):2==this.m_skeleton_action_index&&(this.m_skeletonNode.setAnimation(0,"attack2",!1),this.m_skeletonNode.addAnimation(0,"idle",!0)),this.m_skeleton_action_index++;var duration=0,ref={},voice=(voice_list=m.get_Voice(this.m_gnrlInfo.gnrl_id,voice_detail_sd_touch,ref)).voice;if(duration=voice_list.duration,!this.m_is_voice_playing)if(voice&&""!=voice&&null!=voice)AudioEngine.getInstance().playVoice(RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3",!1),this.m_is_voice_playing=!0,this.m_voice_playing_delta=duration,null}else{var voice_list,is_voice_play=!1;duration=0,ref={},voice=(voice_list=m.get_Voice(this.m_gnrlInfo.gnrl_id,voice_books_body_touch,ref)).voice;if(duration=voice_list.duration,null!=this.m_characterImg){this.m_characterImg.stopAllActions();var s1=new cc.ScaleTo(.1,this.m_img_scale+.03,this.m_img_scale-.03),s2=new cc.ScaleTo(.2,this.m_img_scale-.03,this.m_img_scale+.03),s3=new cc.ScaleTo(.15,this.m_img_scale+.02,this.m_img_scale-.02),s4=new cc.ScaleTo(.8,this.m_img_scale,this.m_img_scale),callback=new cc.CallFunc(this.characterIdelAction,this),e4=new cc.EaseElasticOut(s4),seq=new cc.Sequence(s1,s2,s3,e4,callback);this.m_characterImg.runAction(seq),is_voice_play=!0}else this.m_character_skeleton.setAnimation(0,"active",!1),this.m_character_skeleton.addAnimation(0,"basic",!0),is_voice_play=!0;if(1==is_voice_play)if(!this.m_is_voice_playing)if(voice&&""!=voice&&null!=voice)AudioEngine.getInstance().playVoice(RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3",!1),this.m_is_voice_playing=!0,this.m_voice_playing_delta=duration,null}}.bind(this)});cc.eventManager.addListener(listener,this)},initLayout:function(type){this.m_layer=new cc.Layer,this.addChild(this.m_layer);var key=GameContext.getInstance().getGeneralKey();this.m_gnrl_key={},this.m_gnrl_key.gnrl_id=key.gnrl_id,this.m_gnrl_key.gnrl_num=key.num,this.m_gnrlInfo={},GeneralService.getInstance().getUserGeneralInfo(this.m_gnrl_key,this.m_gnrlInfo),this.m_bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub.png"),this.m_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bg.setPosition(ccCenter(this.m_layer)),USE_SP_COMMON_SUB_BG_SCALE&&this.m_bg.setScale(2),this.m_layer.addChild(this.m_bg);var only_card_info=MasterTable.getInstance().get_LimitOverOnlyCardInfo2(this.m_gnrlInfo.gnrl_id,only_card_info),is_yunhee_only_card=!1;if(null!=only_card_info&&0!=only_card_info.only_gnrl_group&&(is_yunhee_only_card=!0),this.m_gnrlInfo.gnrl_type==GENERAL_TYPE_MATERIAL||this.m_gnrlInfo.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL||this.m_gnrlInfo.gnrl_type==GENERAL_TYPE_LIMIT_OVER&&!is_yunhee_only_card){this.m_characterLayer=new cc.Layer,this.m_characterLayer.ignoreAnchorPointForPosition(!1),this.m_characterLayer.setAnchorPoint(ZERO()),this.m_characterLayer.setPosition(ZERO()),this.m_layer.addChild(this.m_characterLayer);var gnrl=MasterTable.getInstance().getMasterTable().get_General(this.m_gnrlInfo.gnrl_id),card_img=getCardBody_ImageStr(gnrl.bone_id),img_scale=getCardBody_Scale(gnrl.bone_id),character=cc.Sprite.create(card_img);character.setScale(img_scale),character.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),character.setPosition(ZERO()),this.m_characterLayer.addChild(character),null!=this.m_deferred&&this.m_deferred.resolve(!0)}else this.m_characterLayer=this.getCharacterLayer(),this.m_characterLayer.ignoreAnchorPointForPosition(!1),this.m_characterLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_characterLayer.setPosition((ccWidth(this)-478)/2,0),this.m_layer.addChild(this.m_characterLayer);this.m_detailLayer=this.getYunheeDetailLayer(),this.m_detailLayer.ignoreAnchorPointForPosition(!1),this.m_detailLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_detailLayer.setPosition(this.width/2,0),this.m_layer.addChild(this.m_detailLayer,2),type==YUNHEE_DETAIL_LEVEL_UP&&this.m_yunheeDetailLayer.setTabButton(YunHeeDetailEnum.tab_yunhee_detail),this.m_touchEventLayer=new cc.Layer,this.m_touchEventLayer.setContentSize(400,520),this.m_touchEventLayer.setPosition(LP(this,40,0)),this.addChild(this.m_touchEventLayer);var statusLayer=new StatusLayer(INVOKER_TYPE.normal);statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer,3);var back_btn=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png","");back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(sender){this.back()}.bind(this)),back_btn.setTutorialTag(TOTORIAL_TAG_BTN_BACK),this.addChild(back_btn,3);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_yh.png");title.setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title,3),this.scheduleUpdate()},getCharacterLayer:function(){var layer=new cc.Layer;layer.setContentSize(480,640);var mt=MasterTable.getInstance().getMasterTable();if(this.m_gnrlInfo.gnrl_type!=GENERAL_TYPE_MATERIAL&&this.m_gnrlInfo.gnrl_type!=GENERAL_TYPE_EVOLVE_MATERIAL){var state_type=this.m_gnrlInfo.state_type;this.m_state_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_state_"+state_type+".png"),this.m_state_img.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_state_img.setPosition(ccCenter(layer).x,112),USE_SP_MENU_YH_SCALE&&this.m_state_img.setScale(2),layer.addChild(this.m_state_img),this.m_state_img.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR);var standing_gnrl=new db.UserGeneralInfo,gnrl_key=new net.User_General_Key;gnrl_key.gnrl_id=this.m_gnrlInfo.gnrl_id,gnrl_key.gnrl_num=this.m_gnrlInfo.gnrl_num,GeneralService.getInstance().getUserGnrlDisplayClassInfo(gnrl_key,standing_gnrl),this.m_standing_id=0,standing_gnrl.class_type>=AVAIL_EVOLUTION_CLASS_TYPE_LIMIT&&0!=standing_gnrl.display_class&&standing_gnrl.class_type!=standing_gnrl.display_class?this.m_standing_id=standing_gnrl.gnrl_id-1e3*(standing_gnrl.class_type-standing_gnrl.display_class):this.m_standing_id=standing_gnrl.gnrl_id;var pos=mt.get_BodyPosition(this.m_standing_id),morph=MasterTable.getInstance().get_MorphData(this.m_standing_id);if(this.m_save_partid=this.m_standing_id,"y"==morph.is_morph){this.m_save_morph=!0,this.initLayoutProgress_circle();var gnrl=MasterManager.getInstance().get_General(this.m_standing_id),gnrl_id=this.m_standing_id;this.m_gnrlInfo.gnrl_type==GENERAL_TYPE_LIMIT_OVER&&(gnrl_id=GeneralService.getInstance().getEventLimitOverCardStandingGnrlId(gnrl.gnrl_group),pos=mt.get_BodyPosition(gnrl_id)),cc.log("gnrl_id = "+gnrl_id);var gnrl_imgs=[];if(this.m_gnrl_res_img=[],!USE_PARTNER_GNRL_LOADING||SAVE_NOW_PARTNER_GNRL.gnrl_id!=this.m_standing_id){var stading_files=StandingMultiplePngList[gnrl_id];if(null==stading_files)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl_id+".png"),gnrl_imgs.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl_id+".png"),this.m_gnrl_res_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl_id+".png");else for(var idx=0;idx<stading_files.length;idx++)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+stading_files[idx]+".png"),gnrl_imgs.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+stading_files[idx]+".png"),this.m_gnrl_res_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+stading_files[idx]+".png");this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl_id+".atlas"),this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl_id+".json"),gnrl_imgs.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl_id+".atlas"),gnrl_imgs.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl_id+".json"),this.m_gnrl_res_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl_id+".atlas"),this.m_gnrl_res_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl_id+".json")}resourceLoader(gnrl_imgs,function(){var gnrl_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl_id+".json",gnrl_atals=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl_id+".atlas";this.m_character_skeleton=new sp.SkeletonAnimation(gnrl_json,gnrl_atals,.1),this.m_character_skeleton.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_character_skeleton.setPosition(Detail_pos(pos.posx,pos.posy)),this.m_character_skeleton.setEventListener(this.spineEventListener.bind(this)),layer.addChild(this.m_character_skeleton),this.m_character_pos=this.m_character_skeleton.getPosition(),this.m_character_skeleton.setMix("active","basic",.1),this.m_character_skeleton.setMix("basic","active",.1),this.m_character_skeleton.setMix("active","active",.1),this.m_character_skeleton.setAnimation(0,"active",!1),this.m_character_skeleton.addAnimation(0,"basic",!0),setTimeout(function(){null!=this.m_deferred&&this.m_deferred.resolve(!0),this.removeLayerProgress_circle()}.bind(this),1.5),gnrl_imgs=[]}.bind(this))}else{gnrl_imgs=[];this.m_gnrl_res_img=[],this.m_save_morph=!1;var cardboss=getCardBody_ImageStr(this.m_standing_id);USE_PARTNER_GNRL_LOADING&&SAVE_NOW_PARTNER_GNRL.gnrl_id==gnrl_id||(gnrl_imgs.push(cardboss),this.m_gnrl_img.push(cardboss),this.m_gnrl_res_img.push(cardboss)),resourceLoader(gnrl_imgs,function(){this.m_characterImg=cc.Sprite.create();var general=mt.get_General(this.m_standing_id);if(general.gnrl_type==GENERAL_TYPE_YUNHEE){if(mt.get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id),this.m_characterImg.setTexture(img_str)}else{img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id),this.m_characterImg.setTexture(img_str)}}else{img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id),this.m_characterImg.setTexture(img_str)}this.m_characterImg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_characterImg.setScale(this.m_img_scale),this.m_characterImg.setPosition(Detail_pos(pos.posx+ccWidth(this.m_characterImg)*this.m_img_scale/2,pos.posy+ccHeight(this.m_characterImg)*this.m_img_scale/2)),layer.addChild(this.m_characterImg);var callback=new cc.CallFunc(this.characterIdelAction,this);this.m_characterImg.runAction(callback),null!=this.m_deferred&&this.m_deferred.resolve(!0)}.bind(this))}if(this.m_gnrlInfo.gnrl_type!=GENERAL_TYPE_LIMIT_OVER){var skin_id;skin_id=this.m_gnrlInfo.bone_id!=this.m_gnrlInfo.skin_id?this.m_standing_id:this.m_gnrlInfo.skin_id;var sd_list=SDGeneralName[this.m_gnrlInfo.gnrl_group],sd_imgs=[];for(idx=0;idx<sd_list.length;idx++)this.m_sd_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(this.m_gnrlInfo.gnrl_group,3)+"/sd/"+sd_list[idx]+".png"),sd_imgs.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(this.m_gnrlInfo.gnrl_group,3)+"/sd/"+sd_list[idx]+".png");this.m_sd_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(this.m_gnrlInfo.gnrl_group,3)+"/sd/"+skin_id+".atlas"),this.m_sd_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(this.m_gnrlInfo.gnrl_group,3)+"/sd/"+skin_id+".json"),sd_imgs.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(this.m_gnrlInfo.gnrl_group,3)+"/sd/"+skin_id+".atlas"),sd_imgs.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(this.m_gnrlInfo.gnrl_group,3)+"/sd/"+skin_id+".json"),resourceLoader(sd_imgs,function(){var sd_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(this.m_gnrlInfo.gnrl_group,3)+"/sd/"+skin_id+".json",sd_atals=RES_CDN_DEFULT+"gnrl_"+leadingZeros(this.m_gnrlInfo.gnrl_group,3)+"/sd/"+skin_id+".atlas";this.m_skeletonNode=new sp.SkeletonAnimation(sd_json,sd_atals,.55),this.m_skeletonNode.setEventListener(this.spineEventListener.bind(this)),null!=this.m_characterImg?this.m_skeletonNode.setPosition(-ccWidth(this.m_characterImg)*this.m_img_scale,120):this.m_skeletonNode.setPosition(-2048,120),layer.addChild(this.m_skeletonNode);var display_class=0;if(this.m_gnrlInfo.gnrl_id!=this.m_standing_id)try{3<(display_class=standing_gnrl.display_class)&&(display_class=3),this.m_skeletonNode.setSkin(display_class)}catch(e){this.m_skeletonNode.setSkin("default")}else try{3<(display_class=standing_gnrl.display_class)&&(display_class=3),this.m_skeletonNode.setSkin(display_class)}catch(e){this.m_skeletonNode.setSkin("default")}this.m_skeletonNode.setAnimation(0,"basic",!0),this.m_skeletonNode.setMix("basic","prepare",.1),this.m_skeletonNode.setMix("prepare","basic",.1),this.m_skeletonNode.setMix("attack1","prepare",.1),this.m_skeletonNode.setMix("prepare","attack1",.1),this.m_skeletonNode.setMix("attack2","prepare",.1),this.m_skeletonNode.setMix("prepare","attack2",.1),this.m_skeletonNode.setMix("attack1","basic",.1),this.m_skeletonNode.setMix("basic","attack1",.1),this.m_skeletonNode.setMix("attack2","basic",.1),this.m_skeletonNode.setMix("basic","attack2",.1),this.m_skeletonNode.setMix("attack1","attack2",.1),this.m_skeletonNode.setMix("attack2","attack1",.1),this.m_skeletonNode.setOpacity(0),null!=this.m_deferred&&this.m_deferred.resolve(!0),sd_imgs=[]}.bind(this))}}else{var character=cc.Sprite.create(),general=mt.get_General(this.m_gnrlInfo.gnrl_id),img_scale=1;if(general.gnrl_type==GENERAL_TYPE_YUNHEE){if(mt.get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var img_str=getCardBody_ImageStr(general.gnrl_id);img_scale=getCardBody_Scale(general.gnrl_id),character.setTexture(img_str)}else{img_str=getCardBody_ImageStr(general.gnrl_id);img_scale=getCardBody_Scale(general.gnrl_id),character.setTexture(img_str)}}else{img_str=getCardBody_ImageStr(this.m_gnrlInfo.gnrl_id);img_scale=getCardBody_Scale(this.m_gnrlInfo.gnrl_id),character.setTexture(img_str)}character.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),character.setScale(img_scale),character.setPosition(ZERO()),layer.addChild(character),null!=this.m_deferred&&this.m_deferred.resolve(!0)}return layer},spineEventListener:function(entry,evt){var event_name=evt.data.name.toLowerCase();"loop_show"==event_name?this.m_skeletonNode.setAnimation(2,"loop",!0):"loop_hide"==event_name&&this.m_skeletonNode.setAnimation(2,"loop_off",!0)},onEnter:function(){this._super(),this.m_isPopupShow=!1;var game_context=GameContext.getInstance(),gameObserver=MainObserver.getInstance();gameObserver.addObserver(this.onNotificationLoveItem,this,LOVE_ITEM_SELECT),gameObserver.addObserver(this.onNotificationShortcuts,this,NOTIFICATION_EVOLUTION_MTRL_SHORTCUTS),gameObserver.addObserver(this.onNotificationShortcuts,this,NOTIFICATION_REBIRTH_MTRL_SHORTCUTS),gameObserver.addObserver(this.onNotificationEvolveMaterial,this,NOTIFICATION_SELETE_EVOLVE_MATRIAL),gameObserver.addObserver(this.onNotification,this,sceneStr[scene_YunheeDetailScene]),(game_context.isEquipmentDataChanged(EquipmentChangedData.yunhee_info_changed)||game_context.isEquipmentDataChanged(EquipmentChangedData.equip_changed)||GameContext.getInstance().isEquipmentDataChanged(EquipmentChangedData.levelup_changed))&&(null!=this.m_yunheeDetailLayer&&this.m_yunheeDetailLayer.setTabButton(YunHeeDetailEnum.tab_yunhee_detail),GameContext.getInstance().clearEquipmentDataChanged(EquipmentChangedData.yunhee_info_changed),GameContext.getInstance().clearEquipmentDataChanged(EquipmentChangedData.equip_changed),GameContext.getInstance().clearEquipmentDataChanged(EquipmentChangedData.levelup_changed));var deck_game_type=BattleContext._getInstance().getGameType();if(deck_game_type==db.BattleGameType.Mission){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/BGM_story_loop.mp3";audio.m_bgmPath!=path&&(audio.stopBackgroundMusic(),audio.playBackgroundMusic(path,!0))}else deck_game_type==db.BattleGameType.EventDungeon?this.getEventSound():this.playMainBGM()},getEventSound:function(){var audio=AudioEngine.getInstance();if(USE_EVENT_BGM){var m=MasterTable.getInstance();if(BattleContext._getInstance().getIsPrvEventDungeon())var bgm=m.get_Bgm_v2(BGM_TYPE_PRV_EVENT_MAIN_BGM);else{var period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();bgm=m.get_EventDungeonFromEventDungeonPeriodIdx(period_idx).event_dungeon_type==EVENT_DUNGEON_TYPE_LINLIN?m.get_Bgm_v2(BGM_TYPE_CRAFT_EVENT_MAIN_BGM):m.get_Bgm_v2(BGM_TYPE_EVENT_MAIN_BGM)}var main_bgm=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm.sound_file_name;audio.m_bgmPath!=main_bgm&&(audio.stopBackgroundMusic(),audio.m_bgmPath="",audio.playBackgroundMusic(main_bgm,!0))}else{var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),b_path=RES_CDN_SOUND+SND_TYPE+"sound/"+cmString("BGM_marathon_loop_%d.mp3",period.event_dungeon_point_period_idx);audio.m_bgmPath!=b_path&&(audio.stopBackgroundMusic(),audio.m_bgmPath="",audio.playBackgroundMusic(b_path,!0))}},onTutorialEnter:function(step){new TutorialContextV2.getInstance;if(this.setTutorialStep(step),step.tutorial_page==TUTORIAL_PAGE_2_LEVEL_UP);else if(step.tutorial_page==TUTORIAL_PAGE_3_LOVE_LEVEL_UP)step.tutorial_step==TUTO_STEP_P3_FINAL_STEP&&this.popTutorialLayer();else if(step.tutorial_page==TUTORIAL_PAGE_4_LOVE_CG)if(step.tutorial_step==TUTO_STEP_P4_EVENTCG_CONFIRM)this.popTutorialLayer(),this.scheduleOnce(function(float){this.setTutorialStep(step)},.15,"tutorial_layer");else if(step.tutorial_step==TUTO_STEP_P4_SOUND_DOWNLOAD)this.popTutorialLayer(),1==TUTO_LOAD_CHECK&&(TUTO_LOAD_CHECK=!1,this.scheduleOnce(function(float){this.setTutorialStep(step)},.15,"tutorial_layer"));else if(step.tutorial_step==TUTO_STEP_P4_WAITING){step.action_type==TutorialAction.Ready&&this.popTutorialLayer()}},getYunheeDetailLayer:function(){this.m_bg.setTexture(RES_CDN_DEFULT+"common/bg_sub.png"),null!=this.m_state_img&&this.m_state_img.setVisible(!0);var layer=new cc.Layer;return this.m_yunheeDetailLayer=new YunheeDetailLayer,this.m_yunheeDetailLayer.setUserGeneralInfo(this.m_gnrlInfo),this.m_yunheeDetailLayer.initLayout(),layer.addChild(this.m_yunheeDetailLayer),layer.setContentSize(ccSize(this.m_yunheeDetailLayer)),layer},sendPacketPartnerMainSet:function(){var g=GameContext.getInstance(),partner=g.getUserGeneralPartner(),main_general=g.getUserFriendPartner(),req={partner_gnrl_key:{},friend_partner_gnrl_key:{}};if(req.opcode=net.OP.op_general_set_partner_and_friend,req.partner_gnrl_key.gnrl_id=0,req.partner_gnrl_key.gnrl_num=0,req.friend_partner_gnrl_key.gnrl_id=0,req.friend_partner_gnrl_key.gnrl_num=0,this.m_is_partner_select){if(partner.gnrl_num!=this.m_gnrl_key.gnrl_num){if(this.m_gnrlInfo.used_in_camp||this.m_gnrlInfo.using_in_camp)return void(USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_yunhee_partner_set_failed_title"),res_str("label_not_levelup_in_camp_text_1"),res_str("label_not_partner_set_in_camp_text_1")):this.showIsNotPartnerInCamp());req.partner_gnrl_key.gnrl_id=this.m_gnrl_key.gnrl_id,req.partner_gnrl_key.gnrl_num=this.m_gnrl_key.gnrl_num;for(var idx=0;idx<this.m_gnrl_res_img.length;idx++){SAVE_NOW_PARTNER_GNRL.res_img.push(this.m_gnrl_res_img[idx]);var found=this.m_gnrl_img.indexOf(this.m_gnrl_res_img[idx]);this.m_gnrl_img.splice(found,1)}SAVE_NOW_PARTNER_GNRL.gnrl_id=this.m_save_partid,SAVE_NOW_PARTNER_GNRL.morph=this.m_save_morph}}else if(1==this.m_gnrlInfo.isPartner){req.partner_gnrl_key.gnrl_id=this.m_gnrlInfo.gnrl_id,req.partner_gnrl_key.gnrl_num=this.m_gnrlInfo.gnrl_num;for(idx=0;idx<this.m_gnrl_res_img.length;idx++){SAVE_NOW_PARTNER_GNRL.res_img.push(this.m_gnrl_res_img[idx]);found=this.m_gnrl_img.indexOf(this.m_gnrl_res_img[idx]);this.m_gnrl_img.splice(found,1)}SAVE_NOW_PARTNER_GNRL.gnrl_id=this.m_save_partid,SAVE_NOW_PARTNER_GNRL.morph=this.m_save_morph}if(this.m_is_friend_partner_select){if(main_general.gnrl_num!=this.m_gnrl_key.gnrl_num){if(this.m_gnrlInfo.used_in_camp||this.m_gnrlInfo.using_in_camp)return void(USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_yunhee_partner_set_failed_title"),res_str("label_not_levelup_in_camp_text_1"),res_str("label_not_partner_set_in_camp_text_1")):this.showIsNotPartnerInCamp());req.friend_partner_gnrl_key.gnrl_id=this.m_gnrl_key.gnrl_id,req.friend_partner_gnrl_key.gnrl_num=this.m_gnrl_key.gnrl_num}}else 1==this.m_gnrlInfo.is_friend_partner&&(req.friend_partner_gnrl_key.gnrl_id=this.m_gnrlInfo.gnrl_id,req.friend_partner_gnrl_key.gnrl_num=this.m_gnrlInfo.gnrl_num);(0!=req.partner_gnrl_key.gnrl_id||0!=req.friend_partner_gnrl_key.gnrl_id)&&this.network_write(req),this.m_partnerSetModalLayer.hide()},setCharacterMode:function(){this.m_bg.setTexture(RES_CDN_DEFULT+"common/bg_sub.png"),this.m_state_img.setVisible(!0);var standing_gnrl=new db.UserGeneralInfo,gnrl_key={};gnrl_key.gnrl_id=this.m_gnrlInfo.gnrl_id,gnrl_key.gnrl_num=this.m_gnrlInfo.gnrl_num,GeneralService.getInstance().getUserGnrlDisplayClassInfo(gnrl_key,standing_gnrl);var standing_id=0;standing_id=standing_gnrl.class_type>=AVAIL_EVOLUTION_CLASS_TYPE_LIMIT&&0!=standing_gnrl.display_class&&standing_gnrl.class_type!=standing_gnrl.display_class?standing_gnrl.gnrl_id-1e3*(standing_gnrl.class_type-standing_gnrl.display_class):standing_gnrl.gnrl_id;var pos=MasterManager.getInstance().get_BodyPosition(standing_id);"y"==MasterTable.getInstance().get_MorphData(standing_id).is_morph?(this.m_character_skeleton.stopAllActions(),this.m_skeletonNode.stopAllActions(),this.m_skeletonNode.setPosition(-2048,120),this.m_character_skeleton.setPosition(Detail_pos(pos.posx,pos.posy))):(this.m_characterImg.stopAllActions(),this.m_skeletonNode.stopAllActions(),this.m_skeletonNode.setPosition(-1*ccWidth(this.m_characterImg)-100,120),this.m_characterImg.setPosition(Detail_pos(pos.posx+ccWidth(this.m_characterImg)*this.m_img_scale/2,pos.posy+ccHeight(this.m_characterImg)*this.m_img_scale/2))),this.m_isSpineMode=!1},onNetworkError:function(){},onNotification:function(msg){this._super(msg);var userItem=NetService().get_UserItemInfo_V2(),generalService=GeneralService.getInstance();EventDungeonService.getInstance();switch(msg){case YunheeEvolutionEnum.btn_evolve_start:if(generalService.isExistGeneralInTroops(this.m_gnrlInfo.gnrl_num))return USE_POPUP_INTERGRATION?this.showGameScenePopup(res_str("label_yunhee_caution_title"),res_str("label_yunhee_in_troops_text_1"),res_str("label_yunhee_in_troops_text_2")):this.showYunheeInTroops(),!0;if(this.m_gnrlInfo.using_in_camp)return USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_yunhee_caution_title"),res_str("label_yunhee_in_camp_text_1"),res_str("label_yunhee_in_camp_text_2")):this.showYunheeInCampMsgBox(),!0;var need_gold=this.m_yunheeDetailLayer.getEvolveNeedGold();return userItem.gold_cnt<need_gold?this.showNotEnoughGold(!0):this.showEvolveBeginPopup(),!0;case YunheeRebirthEnum.btn_rebirth_info:this.showRebirthInfoLayer();break;case YunheeRebirthEnum.btn_impossible_rerirth:this.showImpossibleRebirth();break;case YunheeRebirthEnum.btn_rebirth_start:if(generalService.isExistGeneralInTroops(this.m_gnrlInfo.gnrl_num))return USE_POPUP_INTERGRATION?this.showGameScenePopup(res_str("label_yunhee_caution_title"),res_str("label_yunhee_in_troops_text_1"),res_str("label_yunhee_in_troops_text_2")):this.showYunheeInTroops(),!0;if(this.m_gnrlInfo.using_in_camp)return USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_yunhee_caution_title"),res_str("label_yunhee_in_camp_text_1"),res_str("label_yunhee_in_camp_text_2")):this.showYunheeInCampMsgBox(),!0;need_gold=this.m_yunheeDetailLayer.getRebirthNeedGold();return userItem.gold_cnt<need_gold?this.showNotEnoughGold(!0):this.showRebirthBeginPopup(),!0;case YunheeEvolutionEnum.btn_evolve_result_hide:this.hideEvolveResult();break;case YunheeEvolutionEnum.btn_limit_over_hide:this.hidelimitover();break;case YunheeEvolutionEnum.btn_show_help:this.m_isPopupShow=!0,GameContext.getInstance().setHelpInfoIndexByCallIndex(12);var scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null;break;case YunheelLovelItemEnum.loveup_start:if(!this.m_yunheeDetailLayer.isExistLoveUpMaterial())return USE_POPUP_INTERGRATION?this.showGameScenePopup(res_str("label_loveup_failed_title"),res_str("label_powerup_not_select_material_text_1")):this.showLoveUpNotSelectMaterial(),!0;need_gold=this.m_yunheeDetailLayer.getLoveUpNeedGold();if(userItem.gold_cnt<need_gold)this.showNotEnoughGold(!0);else this.m_beforeLoveLevel=this.m_gnrlInfo.love_level,0==(tutorial=TutorialContextV2.getInstance()).IsCompleteAllTutorial()&&tutorial.IsLoaded()?this.sendPacketLoveUp():this.showLoveUpStart();break;case YunheelLovelItemEnum.btn_show_help:this.m_isPopupShow=!0,GameContext.getInstance().setHelpInfoIndexByCallIndex(9);scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null;break;case YunheeLevelUpEnum.levelup_start:var tutorial;if(!this.m_yunheeDetailLayer.isExistLevelUpMaterial())return this.m_yunheeDetailLayer.setLevelUpBtnEnable(!0),(tutorial=TutorialContextV2.getInstance()).IsCompleteAllTutorial()?USE_POPUP_INTERGRATION?this.showGameScenePopup(res_str("label_levelup_failed_title"),res_str("label_powerup_not_select_material_text_1")):this.showLevelUpNotSelectMaterial():cc.log("Prevent. Before happening the next tutorial step"),!0;need_gold=this.m_yunheeDetailLayer.getLevelUpNeedGold();if(userItem.gold_cnt<need_gold)this.m_yunheeDetailLayer.setLevelUpBtnEnable(!0),this.showNotEnoughGold(!0);else this.m_yunheeDetailLayer.isExistLevelupMtrlInSR()?this.showLevelUpMtrlInSR():this.sendPacketLevelUp();break;case YunheeLimitOverEnum.limit_over_start:if(!this.m_yunheeDetailLayer.isExistLimitOverMaterial())return USE_POPUP_INTERGRATION?this.showGameScenePopup(res_str("label_levelup_failed_title"),res_str("label_powerup_not_select_material_text_1")):this.showLevelUpNotSelectMaterial(),!0;need_gold=this.m_yunheeDetailLayer.getLimitOverNeedGold();return userItem.gold_cnt<need_gold?this.showNotEnoughGold(!0):this.showLimitOverBeginPopup(),!0;case YunheeLimitOverEnum.limit_over_material_not_selectable:USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_buy_goods_fail_title"),res_str("label_material_not_selectable_text_1"),res_str("label_material_not_selectable_text_3")):this.showMaterialNotSelectable();break;case YunheeLimitOverEnum.btn_show_help:GameContext.getInstance().setHelpInfoIndexByCallIndex(14),this.m_isPopupShow=!0;scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null;break;case YunheeInfoEnum.btn_character_change:var standing_id,standing_gnrl=new db.UserGeneralInfo,gnrl_key=new net.User_General_Key;gnrl_key.gnrl_id=this.m_gnrlInfo.gnrl_id,gnrl_key.gnrl_num=this.m_gnrlInfo.gnrl_num,generalService.getUserGnrlDisplayClassInfo(gnrl_key,standing_gnrl),standing_id=standing_gnrl.class_type>=AVAIL_EVOLUTION_CLASS_TYPE_LIMIT&&0!=standing_gnrl.display_class&&standing_gnrl.class_type!=standing_gnrl.display_class?standing_gnrl.gnrl_id-1e3*(standing_gnrl.class_type-standing_gnrl.display_class):standing_gnrl.gnrl_id;var pos=MasterManager.getInstance().get_BodyPosition(standing_id);if("y"==MasterTable.getInstance().get_MorphData(standing_id).is_morph)this.m_character_skeleton.stopAllActions(),this.m_skeletonNode.stopAllActions(),this.m_isSpineMode?(this.m_skeletonNode.runAction(new cc.Sequence(new cc.MoveTo(.18,cc.p(-2048,120)),new cc.FadeOut(0))),this.m_character_skeleton.runAction(new cc.MoveTo(.2,Detail_pos(pos.posx,pos.posy))),this.m_isSpineMode=!1,this.m_character_skeleton.setAnimation(0,"active",!1),this.m_character_skeleton.addAnimation(0,"basic",!0)):(this.m_character_skeleton.runAction(new cc.MoveTo(.2,Detail_pos(-2048,pos.posy))),this.m_skeletonNode.runAction(new cc.Sequence(new cc.FadeIn(0),new cc.MoveTo(.18,cc.p(243,120)))),this.m_isSpineMode=!0);else if(this.m_characterImg.stopAllActions(),this.m_skeletonNode.stopAllActions(),this.m_isSpineMode){this.m_skeletonNode.runAction(new cc.Sequence(new cc.MoveTo(.18,cc.p(-ccWidth(this.m_characterImg)*this.m_img_scale-100,120)),new cc.FadeOut(0)));var callback=new cc.CallFunc(this.characterIdelAction,this);this.m_characterImg.runAction(new cc.Sequence(new cc.MoveTo(.2,Detail_pos(pos.posx+ccWidth(this.m_characterImg)*this.m_img_scale/2,pos.posy+ccHeight(this.m_characterImg)*this.m_img_scale/2)),callback)),this.m_isSpineMode=!1}else this.m_characterImg.runAction(new cc.MoveTo(.2,Detail_pos(-ccWidth(this.m_characterImg)*this.m_img_scale*2-150,pos.posy+ccHeight(this.m_characterImg)*this.m_img_scale/2))),this.m_skeletonNode.runAction(new cc.Sequence(new cc.FadeIn(0),new cc.MoveTo(.18,cc.p(243,120)))),this.m_isSpineMode=!0;this.m_is_voice_playing=!1,this.m_voice_playing_delta=0;break;case YunheeInfoEnum.btn_yunhee_love_show:this.showYunheeLoveCGMsgBox();break;case YunheeInfoEnum.btn_character_love_level:USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_yunhee_need_max_evolution_for_cg_title"),res_str("label_yunhee_need_max_evolution_for_cg_text_1"),res_str("label_yunhee_need_max_evolution_for_cg_text_2")):this.showNeedMaxEvolutionForCGMsgBox();break;case YunheeInfoEnum.btn_release_in_troops:GeneralService.getInstance().isExistGeneralInTroops(this.m_gnrlInfo.gnrl_num)?this.showDeleteAllTroopsMsgBox():USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_yunhee_all_troops_delete_general_error_title"),res_str("label_yunhee_not_found_in_troops_text")):this.showNotFoundInTroopsMsgBox();break;case YunheeInfoEnum.btn_show_resistance_help:this.m_isPopupShow=!0,GameContext.getInstance().setHelpInfoIndexByCallIndex(11);scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null;break;case YunheeInfoEnum.btn_show_help:(gameContext=GameContext.getInstance()).setHelpInfoIndexByCallIndex(6),this.m_yunheeDetailLayer.isResistanceLayerEnabled()?gameContext.setHelpInfoIndexByCallIndex(10):gameContext.setHelpInfoIndexByCallIndex(6),this.m_isPopupShow=!0;scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null;break;case YunheeInfoEnum.btn_select_display:this.showSelectYunheeCharacterMsgBox();break;case YunheeInfoEnum.btn_equipment:var gameContext,key=(gameContext=GameContext.getInstance()).getGeneralKey();0!=key.gnrl_id&&0!=key.num||gameContext.setGeneralKey(this.m_gnrl_key.gnrl_id,this.m_gnrl_key.gnrl_num),gameContext.setEquipmentTabType(EQUIPMENT_TAB_NORMAL),gameContext.setEquipmentParts(EQUIPMENT_PARTS_ALL),gameContext.setNotUseEquipmentPartsTab(!1);scene=new EquipmentScene_WebV2(EQUIP_LAYER_STATE.MAIN);SceneManager.getInstance().replaceScene(scene),scene=null;break;case YunheeInfoLayer.EQUIP_SHOW_HELP:this.m_isPopupShow=!0,GameContext.getInstance().setHelpInfoIndexByCallIndex(208);scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null;break;case YunHeeDetailEnum.tab_yunhee_detail:this.setCharacterMode(),null!=this.m_character_skeleton&&(this.m_character_skeleton.setScale(1),this.m_character_skeleton.setPosition(this.m_character_pos)),this.m_yunheeDetailLayer.setTabButton(YunHeeDetailEnum.tab_yunhee_detail);break;case YunHeeDetailEnum.btn_yunhee_classup:this.m_yunheeDetailLayer.setClassUpButton();break;case YunHeeDetailEnum.tab_yunhee_evolution:if(this.m_gnrlInfo.class_type>=this.m_gnrlInfo.max_class_type)return USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_yunhee_evolution_impossible_title"),res_str("label_yunhee_evolution_impossible_text_1"),res_str("label_yunhee_evolution_impossible_text_2")):this.showMaxClassTypeMsgBox(),this.m_yunheeDetailLayer.setClassUpButton(),!0;if(this.m_gnrlInfo.using_in_camp)return USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_yunhee_caution_title"),res_str("label_yunhee_in_camp_text_1"),res_str("label_yunhee_in_camp_text_2")):this.showYunheeInCampMsgBox(),this.m_yunheeDetailLayer.setClassUpButton(),!0;this.setCharacterMode(),this.m_yunheeDetailLayer.setClassUpButton(),this.m_yunheeDetailLayer.setTabButton(YunHeeDetailEnum.tab_yunhee_evolution);break;case YunHeeDetailEnum.tab_yunhee_limit_over:if(!GeneralService.getInstance().isEnableLimitOver(this.m_gnrlInfo.gnrl_id,this.m_gnrlInfo.gnrl_num))return this.showNotLimitOverMsg(),this.m_yunheeDetailLayer.setClassUpButton(),!0;if(GeneralService.getInstance().isMaxLimitOver(this.m_gnrlInfo.gnrl_id,this.m_gnrlInfo.gnrl_num))return USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_not_limit_over_title"),res_str("label_not_limit_over_text_4")):this.showIsMaxLimitStepMsgBox(),this.m_yunheeDetailLayer.setClassUpButton(),!0;if(this.m_gnrlInfo.using_in_camp)return USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_yunhee_caution_title"),res_str("label_yunhee_in_camp_text_1"),res_str("label_yunhee_in_camp_text_2")):this.showYunheeInCampMsgBox(),this.m_yunheeDetailLayer.setClassUpButton(),!0;this.setCharacterMode(),this.m_yunheeDetailLayer.setClassUpButton(),this.m_yunheeDetailLayer.setTabButton(YunHeeDetailEnum.tab_yunhee_limit_over);break;case YunHeeDetailEnum.tab_yunhee_rebirth:if(this.m_gnrlInfo.using_in_camp)return USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_yunhee_caution_title"),res_str("label_yunhee_in_camp_text_1"),res_str("label_yunhee_in_camp_text_2")):this.showYunheeInCampMsgBox(),this.m_yunheeDetailLayer.setClassUpButton(),!0;if(this.setCharacterMode(),this.m_bg.setTexture(RES_CDN_DEFULT+"common/bg_sub_5.jpg"),this.m_state_img.setVisible(!1),null!=this.m_character_skeleton){pos=MasterManager.getInstance().get_BodyPosition(this.m_standing_id,1);this.m_character_skeleton.setScale(.5),this.m_character_skeleton.setPosition(Detail_pos(pos.posx,pos.posy))}this.m_yunheeDetailLayer.setClassUpButton(),this.m_yunheeDetailLayer.setTabButton(YunHeeDetailEnum.tab_yunhee_rebirth);break;case YunHeeDetailEnum.tab_yunhee_love:if(this.m_gnrlInfo.love_level>=YUNHEE_MAX_LOVE_LEVEL)return this.showIsMaxLoveLevel(),!0;if(this.m_gnrlInfo.used_in_camp||this.m_gnrlInfo.using_in_camp)return this.showIsNotLevelUpInCamp(),!0;this.setCharacterMode(),null!=this.m_character_skeleton&&(this.m_character_skeleton.setScale(1),this.m_character_skeleton.setPosition(this.m_character_pos)),this.m_yunheeDetailLayer.setTabButton(YunHeeDetailEnum.tab_yunhee_love);break;case YunHeeDetailEnum.tab_yunhee_levelup:if(this.m_gnrlInfo.gnrl_level>=this.m_gnrlInfo.max_level)return USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_character_max_level_title"),res_str("label_battle_formation_max_level_text_1"),res_str("label_battle_formation_max_level_text_2")):this.showMaxLevelBox(),!0;if(this.m_gnrlInfo.used_in_camp||this.m_gnrlInfo.using_in_camp)return this.showIsNotLevelUpInCamp(),!0;this.setCharacterMode(),null!=this.m_character_skeleton&&(this.m_character_skeleton.setScale(1),this.m_character_skeleton.setPosition(this.m_character_pos)),this.m_beforeInfo=$.extend({},this.m_gnrlInfo),this.m_yunheeDetailLayer.setTabButton(YunHeeDetailEnum.tab_yunhee_levelup);break;case NOTIFY_MENU_PARTNER_MAIN_POPUP:this.showPartnerSetModalLayer();break;case YunheeInfoEnum.btn_yunhee_lock:this.m_gnrlInfo.using_in_camp?USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_buy_goods_fail_title"),res_str("label_using_in_camp_general_not_lock_text_1"),res_str("label_using_in_camp_general_not_lock_text_2")):this.showNotGeneralLockUsingInCamp():this.showIsLockGeneral();break;case YunheeInfoEnum.btn_yunhee_unlock:this.showIsUnlockGeneral();break;case YunheeLevelUpEnum.max_material:this.showMaxMaterails();break;case YunheeLevelUpEnum.is_max_level:USE_POPUP_INTERGRATION?this.showGameScenePopup(res_str("label_levelup_failed_title"),res_str("label_levelup_impossible")):this.showIsMaxLevel();break;case YunheeLevelUpEnum.btn_sort:this.m_yunheeDetailLayer.levelupMaterialSort();break;case YunheeLevelUpEnum.tab_yunhee:case YunheeLevelUpEnum.tab_material:0==YUNHEE_LEVELUP_LOAD_FLAG&&this.m_yunheeDetailLayer.setYunheeLevelUpTab(msg);break;case YunheeLevelUpEnum.btn_show_help:this.m_isPopupShow=!0,GameContext.getInstance().setHelpInfoIndexByCallIndex(8);scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null;break;case EQUIP_NOTI_TYPE.EUQIP_SHOW_HELP:this.m_isPopupShow=!0,GameContext.getInstance().setHelpInfoIndexByCallIndex(208);scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null;break;case YunheeInfoEnum.BTN_EQUIPMENT_PRIVATE:case YunheeInfoEnum.BTN_EQUIPMENT_ARMOR:case YunheeInfoEnum.BTN_EQUIPMENT_RING:case YunheeInfoEnum.BTN_EQUIPMENT_SHIELD:case YunheeInfoEnum.BTN_EQUIPMENT_JEWELRY:var equip_parts=msg-YunheeInfoEnum.BTN_EQUIPMENT_PRIVATE+1;if(0==(1&MasterManager.getInstance().get_EquipmentReleaseSlot(this.m_gnrlInfo.love_level).release_slot>>equip_parts-1)){var need_love_level=equip_parts==EQUIPMENT_PRIVATE?10:2*(equip_parts-1);this.showNeedLoveUpForEquipmentMsgBox(need_love_level)}else{for(var userGnrlEquipList=EquipmentService.getInstance().getUserGeneralEquipmentListInfo(this.m_gnrl_key),idx=0;idx<userGnrlEquipList.length;idx++){var user_equip=userGnrlEquipList[idx];if(user_equip.equip_parts_type==equip_parts)return GameContext.getInstance().setEquipmentKey(user_equip.equip_id,user_equip.equip_num),GameContext.getInstance().setEquipmentParts(equip_parts),GameContext.getInstance().setEquipmentTabType(EQUIPMENT_TAB_NORMAL),this.showChangeEquipmentMsgBox(),!0}this.m_isPopupShow=!0,GameContext.getInstance().setEquipmentParts(equip_parts),GameContext.getInstance().setEquipmentKey(0,0),GameContext.getInstance().setNotUseEquipmentPartsTab(!0);scene=new EquipmentScene_WebV2(EQUIP_LAYER_STATE.CHANGE,!0);SceneManager.getInstance().replaceScene(scene),scene=null}break;case YunheeInfoEnum.BTN_STANDING_DETAIL_VIEW:0!=(standing_gnrl=GameContext.getInstance().getDetailStandingGnrl()).gnrl_id&&this.showStandingDetailViewPopup(standing_gnrl);break;case res_download_complete:this.showCheckLoveCG();break;case res_download_error:break;case show_evolve_effect:this.showEvolveModalLayer();break;case show_limitover_effect:this.showLimitOverModalLayer();break;case TUTORIAL_SETTING:this.onTutorialSetting()}return!0},onTutorialSetting:function(){var step=TutorialContextV2.getInstance().getCurrentTutorialStep();this.setTutorialStep(step)},characterIdelAction:function(){var scaleTo_1=new cc.ScaleTo(.7,this.m_img_scale,this.m_img_scale+.01),scaleTo_2=new cc.ScaleTo(.7,this.m_img_scale,this.m_img_scale-.01),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);this.m_characterImg.runAction(repeat)},showCheckLoveCG:function(){this.m_box.is_show()&&this.m_box.hide(!1);var m=MasterManager.getInstance(),love_cg_gnrl_id=GameContext.getInstance().getLoveCgGnrlId(),g=m.get_General(love_cg_gnrl_id),tutorial=TutorialContextV2.getInstance();if(!tutorial.IsCompleteAllTutorial()){var step=tutorial.getCurrentTutorialStep();step.tutorial_page==TUTORIAL_PAGE_4_LOVE_CG&&step.tutorial_step==TUTO_STEP_P4_SOUND_DOWNLOAD&&MainObserver.getInstance().postNotification(NOTIFICATION_TUTORIAL,message_complete_tutorial)}leadingZeros(g.gnrl_group,2);var cg=MasterTable.getInstance().get_LoveCgByGnrlId(love_cg_gnrl_id);if(0<cg.love_cg_story_num&&99999!=cg.love_cg_story_num){var scene=new LoveContentsCGScene(love_cg_gnrl_id),sceneManager=SceneManager.getInstance();scene=(tutorial.IsCompleteAllTutorial()?(this.m_isPopupShow=!0,sceneManager.pushScene(scene)):sceneManager.replaceScene(scene),null),scene=null}},checkCrcLocalFiles:function(){},onNetworkEvent:function(opcode,state,body){if(this._super(opcode,state,body),opcode==net.OP.op_general_love_up)if(body.error==net.ERROR.NET_E_LACK_LOVE_ITEM)USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_common_information"),res_str("label_not_enough_love_item_text")):this.showNotEnoughLoveItem();else{var m=MasterTable.getInstance(),audio=AudioEngine.getInstance(),duration=0,voice_list=m.get_Voice(body.gnrl_key.gnrl_id,voice_love_item_apply,0,duration),voice=voice_list.voice;duration=voice_list.duration,""!=voice&&null!=voice&&audio.playVoice(RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3"),this.showLoveUpEffect()}else if(opcode==net.OP.op_general_level_up){if(body.error==net.ERROR.NET_E_GENERAL_IN_CAMP)USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_general_error_using_in_camp_title"),res_str("label_general_error_using_in_camp_text1"),res_str("label_general_error_using_in_camp_text2")):this.showUsingInCampMsgBox();else(audio=AudioEngine.getInstance()).stopEffectsAll(),this.showLevelUpEffect()}else if(opcode==net.OP.op_general_evolution){if(this.removeLayerProgress(),body.error==net.ERROR.NET_E_GENERAL_IN_CAMP)USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_general_error_using_in_camp_title"),res_str("label_general_error_using_in_camp_text1"),res_str("label_general_error_using_in_camp_text2")):this.showUsingInCampMsgBox(),this.m_yunheeDetailLayer.setEnableEvolutionBtn(!0);else this.initLayoutProgress_nonCircle(0),(key={}).gnrl_id=body.new_gnrl.gnrl_id,key.num=body.new_gnrl.gnrl_num,GameContext.getInstance().setGeneralKey(key),this.completeEvolution(),"y"==body.change_great_wall_gnrl_yn&&this.reqGreatWallTroopsInfo(),"y"==body.change_world_war_gnrl_yn&&this.reqWorldWarTroopsInfo()}else if(opcode==net.OP.op_general_rebirth){var key;if(this.removeLayerProgress(),body.error==net.ERROR.NET_E_SUCCESS)this.initLayoutProgress_nonCircle(0),(key={}).gnrl_id=body.new_gnrl.gnrl_id,key.num=body.new_gnrl.gnrl_num,GameContext.getInstance().setGeneralKey(key),this.completeRebirth(),"y"==body.change_great_wall_gnrl_yn&&this.reqGreatWallTroopsInfo(),"y"==body.change_world_war_gnrl_yn&&this.reqWorldWarTroopsInfo();this.m_yunheeDetailLayer.setEnableRebirthBtn(!0)}else if(opcode==net.OP.op_general_limit_over)body.error==net.ERROR.NET_E_GENERAL_IN_CAMP?(this.m_yunheeDetailLayer.setEnableLimitOverBtn(!0),USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_general_error_using_in_camp_title"),res_str("label_general_error_using_in_camp_text1"),res_str("label_general_error_using_in_camp_text2")):this.showUsingInCampMsgBox()):body.error==net.ERROR.NET_E_MAX_LIMIT_OVER_COUNT?(this.m_yunheeDetailLayer.setEnableLimitOverBtn(!0),USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_not_limit_over_title"),res_str("label_not_limit_over_text_4")):this.showIsMaxLimitStepMsgBox()):body.error==net.ERROR.NET_E_LACK_MATERIAL?(this.m_yunheeDetailLayer.setEnableLimitOverBtn(!0),USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_craft_shop_not_enough_mtrl_title"),res_str("label_craft_shop_not_enough_mtrl_text")):this.showNotEnoughMaterial()):body.error==net.ERROR.NET_E_ALREADY_USED_WORLD_WAR||body.error==net.ERROR.NET_E_SUCCESS&&(this.initLayoutProgress_nonCircle(0),this.completeLimitOver(body));else if(opcode==net.OP.op_general_lock)body.error==net.ERROR.NET_E_SUCCESS&&this.m_yunheeDetailLayer.setLockButton(!0);else if(opcode==net.OP.op_general_unlock)body.error==net.ERROR.NET_E_SUCCESS&&this.m_yunheeDetailLayer.setLockButton(!1);else if(opcode==net.OP.op_all_troops_del_general)USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_yunhee_all_troops_delete_general_title"),res_str("label_yunhee_all_troops_delete_general_complete_text")):this.showCompleteDeleteAllTroopsMsgBox();else if(opcode==net.OP.op_get_user_event_dungeon_vd_info){var scene=new EventDungeonVDEntranceScene;SceneManager.getInstance().replaceScene(scene),scene=null}else if(opcode==net.OP.op_general_change_display_class)body.error==net.ERROR.NET_E_TOO_LOW_GENERAL_EVOLUTION_CLASS?USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_change_yunhee_character_error"),res_str("label_change_yunhee_character_error_text_1")):this.showTooLowEvolutionClassMsgBox():body.error==net.ERROR.NET_E_WRONG_GENERAL_EVOLUTION_CLASS?USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_change_yunhee_character_error"),res_str("label_change_yunhee_character_error_text_2")):this.showWrongEvolutionClassMsgBox():(this.m_gnrlInfo.display_class=body.display_class,this.hideEvolveResult());else if(opcode==net.OP.op_general_set_partner_and_friend)0!=body.partner_gnrl_key.gnrl_id&&this.m_gnrlInfo.gnrl_id==body.partner_gnrl_key.gnrl_id&&this.m_gnrlInfo.gnrl_num==body.partner_gnrl_key.gnrl_num&&(this.m_gnrlInfo.isPartner=!0),0!=body.friend_partner_gnrl_key.gnrl_id&&this.m_gnrlInfo.gnrl_id==body.friend_partner_gnrl_key.gnrl_id&&this.m_gnrlInfo.gnrl_num==body.friend_partner_gnrl_key.gnrl_num&&(this.m_gnrlInfo.is_friend_partner=!0);else if(opcode==net.OP.op_get_user_event_dungeon_box_gacha_progress_info||opcode==net.OP.op_get_user_event_dungeon_craft_shop_material||opcode==net.OP.op_get_server_time_check){TutorialContextV2.getInstance().IsCompleteAllTutorial()&&SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene)}else opcode==net.OP.op_equipment_general_release?body.error==net.ERROR.NET_E_LACK_GOLD?this.showNotEnoughGold():this.showCompleteReleaseEquipmentMsgBox():opcode==net.OP.op_great_wall_troops_info||opcode==net.OP.op_get_world_war_troops||opcode==net.OP.op_get_world_war_partin_generals||net.OP.op_get_world_war_general_equipments},showLevelUpEffect:function(){this.m_levelUpEffectLayer.setContentSize(ccSize(this)),this.m_levelUpEffectLayer._contentNode=function(contentSize,m){var layer=new cc.Layer;layer.setContentSize(ccSize(this));var ani_img_1=cc.Sprite.create();ani_img_1.setAnchorPoint(ANCHOR_MIDDLE()),ani_img_1.setPosition(LP(this,240,403)),layer.addChild(ani_img_1);var callBack=new cc.CallFunc(this.spineEffectStart,this);ani_img_1.runAction(callBack);var spineBackground=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Fade.json",RES_CDN_DEFULT+"effect/Fade.atlas",1);return spineBackground.setPosition(ccCenter(layer)),spineBackground.setAnimation(0,"fx_1",!1),layer.addChild(spineBackground),this.m_skeletonLevelupEffectNode=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Enchant.json",RES_CDN_DEFULT+"effect/Enchant.atlas",.33),this.m_skeletonLevelupEffectNode.setPosition((ccWidth(layer)-478)/2,ccCenter(layer).y),this.m_skeletonLevelupEffectNode.setOpacity(0),layer.addChild(this.m_skeletonLevelupEffectNode),layer}.bind(this),this.m_levelUpEffectLayer.show();var snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_growth_2.mp3";AudioEngine.getInstance().playEffect(snd)},showLoveUpEffect:function(){this.m_levelUpEffectLayer.setContentSize(ccSize(this)),this.m_levelUpEffectLayer._contentNode=function(contentSize,m){var layer=new cc.Layer;layer.setContentSize(ccSize(this));var ani_img_1=cc.Sprite.create();ani_img_1.setAnchorPoint(ANCHOR_MIDDLE()),ani_img_1.setPosition(LP(this,240,403)),layer.addChild(ani_img_1);var callBack=new cc.CallFunc(this.spineLoveEffectStart,this);ani_img_1.runAction(callBack);var spineBackground=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Fade.json",RES_CDN_DEFULT+"effect/Fade.atlas",1);return spineBackground.setPosition(ccCenter(layer)),spineBackground.setAnimation(0,"fx_1",!1),layer.addChild(spineBackground),this.m_skeletonLoveupEffectNode=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Affinity.json",RES_CDN_DEFULT+"effect/Affinity.atlas",.33),this.m_skeletonLoveupEffectNode.setPosition((ccWidth(layer)-478)/2,ccCenter(layer).y),this.m_skeletonLoveupEffectNode.setOpacity(0),layer.addChild(this.m_skeletonLoveupEffectNode),layer}.bind(this),this.m_levelUpEffectLayer.show();var snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_growth_2.mp3";AudioEngine.getInstance().playEffect(snd)},spineEffectStart:function(){var ani_img_1=cc.Sprite.create();ani_img_1.setAnchorPoint(ANCHOR_MIDDLE()),ani_img_1.setPosition(LP(this,240,403)),this.addChild(ani_img_1);var callBack=new cc.CallFunc(this.effectComplete,this);ani_img_1.runAction(new cc.Sequence(new cc.DelayTime(1.8),callBack)),this.m_skeletonLevelupEffectNode.setOpacity(255),this.m_skeletonLevelupEffectNode.setAnimation(0,"fx_1",!0)},spineEvolutionEffectStart:function(){var ani_img_1=cc.Sprite.create();ani_img_1.setAnchorPoint(ANCHOR_MIDDLE()),ani_img_1.setPosition(LP(this,240,403)),this.addChild(ani_img_1);var callBack=new cc.CallFunc(this.completeEvolution,this);ani_img_1.runAction(new cc.Sequence(new cc.DelayTime(1.8),callBack)),this.m_skeletonLevelupEffectNode.setOpacity(255),this.m_skeletonLevelupEffectNode.setAnimation(0,"fx_1",!0)},spineLoveEffectStart:function(){var ani_img_1=cc.Sprite.create();ani_img_1.setAnchorPoint(ANCHOR_MIDDLE()),ani_img_1.setPosition(LP(this,240,403)),this.addChild(ani_img_1);var callBack=new cc.CallFunc(this.LoveEffectComplete,this);ani_img_1.runAction(new cc.Sequence(new cc.DelayTime(1.8),callBack)),this.m_skeletonLoveupEffectNode.setOpacity(255),this.m_skeletonLoveupEffectNode.setAnimation(0,"fx_1",!0)},effectComplete:function(){GeneralService.getInstance().getUserGeneralInfo(this.m_gnrl_key,this.m_gnrlInfo),this.m_yunheeDetailLayer.setLevelUpComplete(this.m_gnrlInfo);var is_success=!1;if(this.m_gnrlInfo.gnrl_level!=this.m_beforeInfo.gnrl_level){var spineBackground=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Fade.json",RES_CDN_DEFULT+"effect/Fade.atlas",1);spineBackground.setPosition(ccCenter(this)),spineBackground.setAnimation(0,"fx_1",!1),this.addChild(spineBackground,4);var ani=cc.Sprite.create();if(ani.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),ani.setPosition(ccCenter(this).x,440),this.addChild(ani,1),NOT_USE_SP_MAIN_ANIMATION){ani.setScale(2),ani.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_yh_lvup_01.png");var sequence,scaleTo_1=new cc.ScaleTo(.3,2,2.03),scaleTo_2=new cc.ScaleTo(.3,2,1.97);removeSelfAction=new cc.RemoveSelf(!1);if(USE_TUTORIAL_SEMI_RENEWAL){cb=new cc.CallFunc(this.cbLevelUpEffect,this);sequence=new cc.Sequence(scaleTo_1,scaleTo_2,scaleTo_1,scaleTo_2,cb,removeSelfAction)}else sequence=new cc.Sequence(scaleTo_1,scaleTo_2,scaleTo_1,scaleTo_2,removeSelfAction);ani.runAction(sequence),sequence=removeSelfAction=scaleTo_2=scaleTo_1=null}else{var animatte=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.LevelUpEffect),removeSelfAction=new cc.RemoveSelf(!1);if(USE_TUTORIAL_SEMI_RENEWAL){var cb=new cc.CallFunc(this.cbLevelUpEffect,this);ani.runAction(new cc.Sequence(new cc.DelayTime(1),animatte,animatte,cb,removeSelfAction))}else ani.runAction(new cc.Sequence(new cc.DelayTime(1),animatte,animatte,removeSelfAction))}var snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_firework_2.mp3";AudioEngine.getInstance().playEffect(snd),is_success=!0}this.m_levelUpEffectLayer.hide(),(this.m_gnrlInfo.isEnabledEvolve||this.m_gnrlInfo.isEnabledLimitOver)&&this.m_yunheeDetailLayer.checkEvolveNewIcon();var tutorial=TutorialContextV2.getInstance();if(!tutorial.IsCompleteAllTutorial()){var step=tutorial.getCurrentTutorialStep();step.tutorial_page==TUTORIAL_PAGE_3_LOVE_LEVEL_UP&&step.tutorial_step==TUTO_STEP_P3_LOVE_LEVELUP&&this.setTutorialStep(step)}this.m_beforeInfo=$.extend({},this.m_gnrlInfo),this.setLevelUptVoiceSound(is_success)},cbLevelUpEffect:function(){var tutorial=TutorialContextV2.getInstance();if(!tutorial.IsCompleteAllTutorial()){var step=tutorial.getCurrentTutorialStep();if(step.tutorial_page==TUTORIAL_PAGE_2_LEVEL_UP)if(13==step.tutorial_step)step.action_type==TutorialAction.Ready&&MainObserver.getInstance().postNotification(NOTIFICATION_TUTORIAL,message_complete_tutorial)}},setLevelUptVoiceSound:function(is_success){var duration=0,voice_type=0;voice_type=is_success?voice_level_up_success:voice_level_up;var audio=AudioEngine.getInstance(),voice_list=MasterTable.getInstance().get_Voice(this.m_gnrlInfo.gnrl_id,voice_type,0,duration),voice=voice_list.voice;if(duration=voice_list.duration,""!=voice&&null!=voice){var snd=RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3";audio.playEffect(snd)}},LoveEffectComplete:function(){GeneralService.getInstance().getUserGeneralInfo(this.m_gnrl_key,this.m_gnrlInfo);var list=[];GeneralService.getInstance().getUserLoveItem(this.m_gnrlInfo.gnrl_group,list),this.m_yunheeDetailLayer.setLoveUpComplete(this.m_gnrlInfo,list);var spineBackground=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Fade.json",RES_CDN_DEFULT+"effect/Fade.atlas",1);spineBackground.setPosition(ccCenter(this)),spineBackground.setAnimation(0,"fx_1",!1),this.addChild(spineBackground,4),this.m_levelUpEffectLayer.hide();var tutorial=TutorialContextV2.getInstance();if(tutorial.IsCompleteAllTutorial())this.checkEquipmentSlotOpen();else{var step=tutorial.getCurrentTutorialStep();step.tutorial_page==TUTORIAL_PAGE_3_LOVE_LEVEL_UP&&9==step.tutorial_step&&this.setTutorialStep(step)}},checkEquipmentSlotOpen:function(){if(EquipmentService.getInstance().checkNewOpenEquipmentSlot(this.m_gnrl_key,this.m_beforeLoveLevel))this.showEquipmentSlotOpen();else{if(19==this.m_gnrlInfo.gnrl_group)return;this.checkLoveMaxLevelShowCG()}},checkLoveMaxLevelShowCG:function(){if(this.m_gnrlInfo.love_level==YUNHEE_MAX_LOVE_LEVEL&&TutorialContextV2.getInstance().IsCompleteAllTutorial()){var g=MasterManager.getInstance().get_General(this.m_gnrlInfo.gnrl_id);99999!=g.love_cg_num&&0<g.love_cg_num&&(GameContext.getInstance().setLoveCgGnrlId(g.gnrl_id),this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(YunheeInfoEnum.btn_yunhee_love_show)},.3,"btn_yunhee_love_show"))}},getResultStatusLayer:function(){var layer=new cc.Layer,bottom_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_status_box.png");bottom_bg.setAnchorPoint(ZERO()),bottom_bg.setPosition(ZERO()),layer.addChild(bottom_bg),layer.setContentSize(ccSize(bottom_bg));var before_title_label=cmLabel.getLabel("Lv."+this.m_beforeInfo.gnrl_level,LABEL_FONT_INDEX.FONT_248),after_title_label=cmLabel.getLabel("Lv.%d"+this.m_gnrlInfo.gnrl_level,LABEL_FONT_INDEX.FONT_248),key={};key.gnrl_id=this.m_gnrlInfo.gnrl_id,key.gnrl_num=this.m_gnrlInfo.gnrl_num;before_title_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),before_title_label.setPosition(73,122),bottom_bg.addChild(before_title_label),after_title_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),after_title_label.setPosition(252,122),bottom_bg.addChild(after_title_label);var arrow=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_arrow.png");arrow.setAnchorPoint(ZERO()),arrow.setPosition(156,120),bottom_bg.addChild(arrow);var attk_label=cmLabel.getLabel("攻撃力",LABEL_FONT_INDEX.FONT_1811);attk_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),attk_label.setPosition(164,89),bottom_bg.addChild(attk_label);var def_label=cmLabel.getLabel("防御力",LABEL_FONT_INDEX.FONT_1811);def_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),def_label.setPosition(164,67),bottom_bg.addChild(def_label);var hp_label=cmLabel.getLabel("体力",LABEL_FONT_INDEX.FONT_1811);hp_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),hp_label.setPosition(164,43),bottom_bg.addChild(hp_label);var sp_label=cmLabel.getLabel("攻速",LABEL_FONT_INDEX.FONT_1811);sp_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),sp_label.setPosition(164,20),bottom_bg.addChild(sp_label);var before_attk=cmLabel.getLabel(70,LABEL_FONT_INDEX.FONT_1811);before_attk.setAnchorPoint(ZERO()),before_attk.setPosition(45,89),bottom_bg.addChild(before_attk);var before_def=cmLabel.getLabel(30,LABEL_FONT_INDEX.FONT_1811);before_def.setAnchorPoint(ZERO()),before_def.setPosition(45,67),bottom_bg.addChild(before_def);var before_hp=cmLabel.getLabel(30,LABEL_FONT_INDEX.FONT_1811);before_hp.setAnchorPoint(ZERO()),before_hp.setPosition(45,43),bottom_bg.addChild(before_hp);var before_sp=cmLabel.getLabel(this.m_beforeInfo.sp,LABEL_FONT_INDEX.FONT_1811);before_sp.setAnchorPoint(ZERO()),before_sp.setPosition(45,20),bottom_bg.addChild(before_sp);var after_attk=cmLabel.getLabel(80,LABEL_FONT_INDEX.FONT_1810);after_attk.setAnchorPoint(ZERO()),after_attk.setPosition(230,89),bottom_bg.addChild(after_attk);var after_def=cmLabel.getLabel(80,LABEL_FONT_INDEX.FONT_1810);after_def.setAnchorPoint(ZERO()),after_def.setPosition(230,67),bottom_bg.addChild(after_def);var after_hp=cmLabel.getLabel(90,LABEL_FONT_INDEX.FONT_1810);after_hp.setAnchorPoint(ZERO()),after_hp.setPosition(230,43),bottom_bg.addChild(after_hp);var after_sp=cmLabel.getLabel(this.m_gnrlInfo.sp,LABEL_FONT_INDEX.FONT_1810);return after_sp.setAnchorPoint(ZERO()),after_sp.setPosition(230,20),bottom_bg.addChild(after_sp),layer},onNetworkConnect:function(){},onNetworkShutdown:function(){},back:function(){var tutorial=TutorialContextV2.getInstance();if(!tutorial.IsCompleteAllTutorial()){var step=tutorial.getCurrentTutorialStep();if(step.tutorial_page==TUTORIAL_PAGE_2_LEVEL_UP&&13==step.tutorial_step)return}this.onKeyBack()},sendPacketGeneralLock:function(){var req={};req.opcode=net.OP.op_general_lock,req.gnrl_key={gnrl_id:this.m_gnrl_key.gnrl_id,gnrl_num:this.m_gnrl_key.gnrl_num},this.network_write(req)},showPartnerSetModalLayer:function(){this.m_partnerSetModalLayer.setContentSize(ccSize(this)),this.m_partnerSetModalLayer._contentNode=function(contentSize,m){return this.getParterSetLayer()}.bind(this),this.m_partnerSetModalLayer.show()},getParterSetLayer:function(){var mt=MasterManager.getInstance(),layer=new cc.Layer,rect=cc.Rect(40,40,10,10),bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",rect);bg.setPreferredSize(cc.size(MAX_MSG_BOX_WIDTH,MAX_MSG_BOX_HEIGHT)),bg.setPosition(ccCenter(layer)),layer.addChild(bg);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_3.png");navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(bg).x,ccHeight(bg)-11),bg.addChild(navi);var title_label=cmLabel.getLabel(mt.get_LanguageData("label_set_yunhee_partner_main_general_title"),LABEL_FONT_INDEX.FONT_281);title_label.setAnchorPoint(ANCHOR_MIDDLE()),title_label.setPosition(ccCenter(navi).x,ccCenter(navi).y+3),navi.addChild(title_label);var text_1=cmLabel.getLabel(mt.get_LanguageData("label_set_yunhee_partner_main_general_text_1"),LABEL_FONT_INDEX.FONT_161);text_1.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),text_1.setPosition(ccCenter(bg).x,281),bg.addChild(text_1);var text_2=cmLabel.getLabel(mt.get_LanguageData("label_set_yunhee_partner_main_general_text_2"),LABEL_FONT_INDEX.FONT_161);text_2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),text_2.setPosition(ccCenter(bg).x,257),bg.addChild(text_2);var text_3=cmLabel.getLabel(mt.get_LanguageData("label_set_yunhee_partner_main_general_text_3"),LABEL_FONT_INDEX.FONT_161);text_3.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),text_3.setPosition(ccCenter(bg).x,235),bg.addChild(text_3),this.m_is_partner_select=this.m_gnrlInfo.isPartner,this.m_is_friend_partner_select=this.m_gnrlInfo.is_friend_partner;var check_img_1=cc.Sprite.create(RES_CDN_DEFULT+"common/img_check.png");check_img_1.setVisible(this.m_is_partner_select),check_img_1.setPosition(20,18),this.m_partner_select_btn=new ccui.Button(RES_CDN_DEFULT+"common/img_checkbox.png"),this.m_partner_select_btn.addChild(check_img_1),this.m_partner_select_btn.setAnchorPoint(ZERO()),this.m_partner_select_btn.setPosition(182,181),bg.addChild(this.m_partner_select_btn),this.m_partner_select_btn.addClickEventListener(function(sender){this.m_is_partner_select=!this.m_is_partner_select,check_img_1.setVisible(this.m_is_partner_select)}.bind(this)),(label=cmLabel.getLabel(mt.get_LanguageData("label_partner_yunhee_check_box"),LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ZERO()),label.setPosition(231,187),bg.addChild(label);var label,check_img_2=cc.Sprite.create(RES_CDN_DEFULT+"common/img_check.png");check_img_2.setVisible(this.m_is_friend_partner_select),check_img_2.setPosition(20,18),this.m_main_gnrl_select_btn=new ccui.Button(RES_CDN_DEFULT+"common/img_checkbox.png"),this.m_main_gnrl_select_btn.addChild(check_img_2),this.m_main_gnrl_select_btn.setAnchorPoint(ZERO()),this.m_main_gnrl_select_btn.setPosition(182,133),bg.addChild(this.m_main_gnrl_select_btn),this.m_main_gnrl_select_btn.addClickEventListener(function(sender){this.m_is_friend_partner_select=!this.m_is_friend_partner_select,check_img_2.setVisible(this.m_is_friend_partner_select)}.bind(this)),(label=cmLabel.getLabel(mt.get_LanguageData("label_friend_partner_yunhee_check_box"),LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ZERO()),label.setPosition(231,138),bg.addChild(label);var text_yunhee=cmLabel.getLabel(this.m_gnrlInfo.name,LABEL_FONT_INDEX.FONT_247);text_yunhee.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),text_yunhee.setPosition(ccCenter(bg).x,89),bg.addChild(text_yunhee);var text_4=cmLabel.getLabel(mt.get_LanguageData("label_set_yunhee_partner_main_general_text_4"),LABEL_FONT_INDEX.FONT_181);text_4.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),text_4.setPosition(ccCenter(bg).x+ccWidth(text_yunhee)/2,89),bg.addChild(text_4),text_yunhee.setPosition(ccPosX(text_4)-(ccWidth(text_4)+ccWidth(text_yunhee))/2,89);var btn_no=new LabelButton("btn_08_off.png","btn_08_on.png","",ccui.Widget.PLIST_TEXTURE);btn_no.setFont(LABEL_FONT_INDEX.FONT_241),btn_no.setString(mt.get_LanguageData("btn_label_cancel")),btn_no.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),btn_no.setPosition(ccCenter(bg).x-5,16),btn_no.addClickEventListener(function(sender){this.m_partnerSetModalLayer.hide()}.bind(this)),bg.addChild(btn_no);var btn_yes=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);return btn_yes.setFont(LABEL_FONT_INDEX.FONT_241),btn_yes.setString(mt.get_LanguageData("btn_label_confirm")),btn_yes.setAnchorPoint(ZERO()),btn_yes.setPosition(ccCenter(bg).x+5,16),bg.addChild(btn_yes),btn_yes.addClickEventListener(function(sender){this.scheduleOnce(function(){this.sendPacketPartnerMainSet()},0,"sendPacketPartnerMainSet")}.bind(this)),layer},showNeedYunheeLoveSndMsgBox:function(){},showVoiceDownloadMsgBox:function(){},showSelectYunheeCharacterMsgBox:function(){this.m_yunheeSelectModalLayer.setContentSize(ccSize(this)),this.m_yunheeSelectModalLayer._contentNode=function(contentSize,m){return this.getSelectYunheeCharacterLayer()}.bind(this),this.m_yunheeSelectModalLayer.show()},getSelectYunheeCharacterLayer:function(){var mt=MasterManager.getInstance(),layer=new cc.Layer,rect=cc.Rect(40,40,10,10),bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",rect);bg.setPreferredSize(cc.size(MAX_MSG_BOX_WIDTH,MAX_MSG_BOX_HEIGHT)),bg.setPosition(ccCenter(layer)),layer.addChild(bg);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_3.png");navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(bg).x,ccHeight(bg)-11),bg.addChild(navi);var title_label=cmLabel.getLabel(mt.get_LanguageData("label_change_yunhee_character_title"),LABEL_FONT_INDEX.FONT_281);title_label.setAnchorPoint(ANCHOR_MIDDLE()),title_label.setPosition(ccCenter(navi).x,ccCenter(navi).y+3),navi.addChild(title_label);var text_1=cmLabel.getLabel(mt.get_LanguageData("label_change_yunhee_character_text_1"),LABEL_FONT_INDEX.FONT_181);text_1.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),text_1.setPosition(ccCenter(bg).x,282),bg.addChild(text_1);var text_2=cmLabel.getLabel(mt.get_LanguageData("label_change_yunhee_character_text_2"),LABEL_FONT_INDEX.FONT_181);text_2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),text_2.setPosition(ccCenter(bg).x,262),bg.addChild(text_2);var text_3=cmLabel.getLabel(mt.get_LanguageData("label_change_yunhee_character_text_3"),LABEL_FONT_INDEX.FONT_181);text_3.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),text_3.setPosition(ccCenter(bg).x,242),bg.addChild(text_3);var text_4=cmLabel.getLabel(mt.get_LanguageData("label_change_yunhee_character_text_4"),LABEL_FONT_INDEX.FONT_181);text_4.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),text_4.setPosition(ccCenter(bg).x,222),bg.addChild(text_4);var text_5=cmLabel.getLabel(mt.get_LanguageData("label_change_yunhee_character_text_5"),LABEL_FONT_INDEX.FONT_181);text_5.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),text_5.setPosition(ccCenter(bg).x,202),bg.addChild(text_5);var tableLayer=this.getCharacterTableLayer();tableLayer.setAnchorPoint(ZERO()),tableLayer.setPosition(123,90),bg.addChild(tableLayer);var btn_no=new LabelButton("btn_08_off.png","btn_08_on.png","",ccui.Widget.PLIST_TEXTURE);btn_no.setFont(LABEL_FONT_INDEX.FONT_241),btn_no.setString(mt.get_LanguageData("btn_label_cancel")),btn_no.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),btn_no.setPosition(ccCenter(bg).x-5,16),btn_no.addClickEventListener(function(sender){this.m_yunheeSelectModalLayer.hide()}.bind(this)),bg.addChild(btn_no);var btn_yes=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);return btn_yes.setFont(LABEL_FONT_INDEX.FONT_241),btn_yes.setString(mt.get_LanguageData("btn_label_confirm")),btn_yes.setAnchorPoint(ZERO()),btn_yes.setPosition(ccCenter(bg).x+5,16),bg.addChild(btn_yes),btn_yes.addClickEventListener(function(sender){this.scheduleOnce(function(){this.sendPacketSelectYunheeCharacter()},0,"sendPacketSelectYunheeCharacter")}.bind(this)),layer},getCharacterTableLayer:function(){var gnrl_id=this.m_gnrlInfo.gnrl_id,tableLayer=new TableViewLayer;tableLayer.setContentSize(384,98),tableLayer.setEnableMouseScroll(!1),tableLayer.setItemCount(MAX_SELECT_CHARACTER_ITEM_SIZE),tableLayer.setColumnCount(MAX_SELECT_CHARACTER_ITEM_SIZE);var count_function=MasterManager.getInstance().get_CountFunction(COUNT_FUNCTION_GENERAL_MAX_CLASS_TYPE).value;return this.m_gnrlInfo.class_type>count_function?(this.m_characterIds[0]=gnrl_id-3e3,this.m_characterIds[1]=gnrl_id-2e3,this.m_characterIds[2]=gnrl_id-1e3):(this.m_characterIds[0]=gnrl_id-2e3,this.m_characterIds[1]=gnrl_id-1e3,this.m_characterIds[2]=gnrl_id),this.m_characterItemLayers=[],tableLayer.getItemNode=function(index,contentSize,margin){var layer=new YunheeCharacterItem(index,this.m_characterIds[index]);return this.m_gnrlInfo.display_class==index+1&&layer.setSelected(!0),this.m_characterItemLayers.push(layer),layer}.bind(this),tableLayer.initLayout(),tableLayer.setTouchScrollEnabled(!1),tableLayer.onItemTouchBegin=function(index){return!0},tableLayer.onItemTouchMoved=function(isScroll){},tableLayer.onItemTouchCancel=function(index){return!0},tableLayer.onItemTouchEnd=function(index){AudioEngine.getInstance().playNormaButtonSound();for(var i=0;i<this.m_characterItemLayers.length;i++)this.m_characterItemLayers[i].setSelected(i==index);return!0}.bind(this),tableLayer},getRebirthInfoPopupLayer:function(){var layer=new cc.Layer,bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",RectZero());bg_box.setAnchorPoint(ANCHOR_MIDDLE()),bg_box.setPreferredSize(cc.size(487,568)),bg_box.setInsetLeft(44),bg_box.setInsetRight(44),bg_box.setInsetBottom(44),bg_box.setInsetTop(44),bg_box.setPosition(ccCenter(layer)),layer.addChild(bg_box,1);var navi=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_navi.png",RectZero());navi.setPreferredSize(cc.size(471,48)),navi.setAnchorPoint(ANCHOR_TOP_LEFT()),navi.setPosition(8,ccHeight(bg_box)-11),bg_box.addChild(navi);var title_label=cmLabel.getLabel(res_str("label_rebirth_info"),LABEL_FONT_INDEX.FONT_241);title_label.setAnchorPoint(ANCHOR_MIDDLE()),title_label.setPosition(ccCenter(navi)),navi.addChild(title_label);var back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(bg_box)-25,ccHeight(bg_box)-12),back_btn.addClickEventListener(function(sender){this.m_rebirth_info_modal_layer.hide()}.bind(this)),bg_box.addChild(back_btn);var scrollLayer=new ScrollLayer;return scrollLayer.setContentSize(447,480),scrollLayer.setPosition(17,16),scrollLayer.getItemNode=function(contentSize,m){return this.getRebirthDetailContentLayer(scrollLayer.getContentSize().height)}.bind(this),scrollLayer.initLayout(),scrollLayer.setContentOffset(OffsetType.jumpToTop),bg_box.addChild(scrollLayer),layer},getRebirthDetailContentLayer:function(scroll_height){var layer=new cc.Layer,rebirth_gnrl=GeneralService.getInstance().getEvolutionGnrlInfo(this.m_gnrlInfo),rebirth_gnrl_info=new db.UserGeneralInfo;GeneralService.getInstance().getBaseGeneralInfo(rebirth_gnrl.gnrl_id,rebirth_gnrl_info);for(var height=0,is_same_skill=!1,idx=0;i<this.m_gnrlInfo.leader_skill.length;idx++)if(0!=this.m_gnrlInfo.leader_skill[idx]&&99999!=this.m_gnrlInfo.leader_skill[idx])for(var jdx=0;jdx<rebirth_gnrl_info.leader_skill.length;jdx++)if(this.m_gnrlInfo.leader_skill[idx]==rebirth_gnrl_info.leader_skill[jdx]){is_same_skill=!0;break}if(!is_same_skill)for(idx=0;idx<this.m_gnrlInfo.special_leader_skill.length;idx++)if(0!=this.m_gnrlInfo.special_leader_skill[idx]&&99999!=this.m_gnrlInfo.special_leader_skill[idx])for(jdx=0;jdx<rebirth_gnrl_info.special_leader_skill.length;jdx++)if(this.m_gnrlInfo.special_leader_skill[idx]==rebirth_gnrl_info.special_leader_skill[jdx]){is_same_skill=!0;break}if(!is_same_skill){var leader_skill_layer=this.getRebirthLeaderSkillLayer(rebirth_gnrl_info);leader_skill_layer.setPosition(0,height),layer.addChild(leader_skill_layer),height+=ccHeight(leader_skill_layer)}is_same_skill=!1;for(idx=0;i<this.m_gnrlInfo.passive_skill.length;idx++)if(0!=this.m_gnrlInfo.passive_skill[idx]&&99999!=this.m_gnrlInfo.passive_skill[idx])for(jdx=0;jdx<rebirth_gnrl_info.passive_skill.length;jdx++)if(this.m_gnrlInfo.passive_skill[idx]==rebirth_gnrl_info.passive_skill[jdx]){is_same_skill=!0;break}if(!is_same_skill)for(idx=0;idx<this.m_gnrlInfo.trans_passive_skill.length;idx++)if(0!=this.m_gnrlInfo.trans_passive_skill[idx]&&99999!=this.m_gnrlInfo.trans_passive_skill[idx])for(jdx=0;jdx<rebirth_gnrl_info.trans_passive_skill.length;jdx++)if(this.m_gnrlInfo.trans_passive_skill[idx]==rebirth_gnrl_info.trans_passive_skill[jdx]){is_same_skill=!0;break}if(!is_same_skill){var passive_skill_layer=this.getRebirthPassiveSkillLayer(rebirth_gnrl_info);passive_skill_layer.setPosition(0,height),layer.addChild(passive_skill_layer),height+=ccHeight(passive_skill_layer)}if(is_same_skill=!1,0!=this.m_gnrlInfo.active_skill&&this.m_gnrlInfo.active_skill==rebirth_gnrl.active_skill_id&&(is_same_skill=!0),!is_same_skill){var active_skill_layer=this.getRebirthActiveSkillLayer(rebirth_gnrl_info);active_skill_layer.setPosition(0,height),layer.addChild(active_skill_layer),height+=ccHeight(active_skill_layer)}var general_info_layer=this.getRebirthGeneralInfoLayer(rebirth_gnrl_info);if(general_info_layer.setPosition(0,height),layer.addChild(general_info_layer),height+=ccHeight(general_info_layer),layer.setContentSize(444,height),height<scroll_height){var y=scroll_height-height;layer.setPosition(0,y)}return layer},getRebirthGeneralInfoLayer:function(rebirth_gnrl_info){var bg_box,layer=new cc.Layer;(bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero())).setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),bg_box.setContentSize(444,155),layer.setContentSize(444,155),layer.addChild(bg_box),(bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero())).setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),layer.addChild(bg_box),bg_box.setContentSize(444,155),layer.setContentSize(ccSize(bg_box));var circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_white.png");circle_point.setAnchorPoint(ZERO()),circle_point.setPosition(17,124),bg_box.addChild(circle_point);var generalService=GeneralService.getInstance(),g=MasterManager.getInstance().get_General(rebirth_gnrl_info.gnrl_id),count_func=MasterManager.getInstance().get_CountFunction(COUNT_FUNCTION_REBIRTH_CLASS_TYPE).value,title=cmLabel.getLabel(g.name,LABEL_FONT_INDEX.FONT_201);title.setAnchorPoint(ZERO()),title.setPosition(28,119),bg_box.addChild(title);var card_info=new db.CardInfo;card_info.gnrl_id=rebirth_gnrl_info.gnrl_id,card_info.is_lock=!1,card_info.is_max_level=this.m_gnrlInfo.isMaxLevel,card_info.is_partner=!1,card_info.level=this.m_gnrlInfo.gnrl_level,card_info.limit_step_id=this.m_gnrlInfo.limit_step_id,card_info.love_level=this.m_gnrlInfo.love_level,card_info.is_enable_evolve=!1,card_info.gender_type=this.m_gnrlInfo.gender_type;var card=(new Card).createCard(card_info,CARD_TYPE.type_common_card);card.setAnchorPoint(ZERO()),card.setPosition(14,13),bg_box.addChild(card);var y=85,info=new db.UserGeneralInfo;info.gnrl_id=this.m_gnrlInfo.gnrl_id,info.base_attk=this.m_gnrlInfo.base_attk,info.base_def=this.m_gnrlInfo.base_def,info.base_hp=this.m_gnrlInfo.base_hp,info.rare_type=this.m_gnrlInfo.rare_type,info.arm_service_type=this.m_gnrlInfo.arm_service_type,info.fight_type=this.m_gnrlInfo.fight_type,info.gnrl_level=this.m_gnrlInfo.gnrl_level,info.love_level=this.m_gnrlInfo.love_level,info.love_stat_group=this.m_gnrlInfo.love_stat_group,info.limit_step_id=this.m_gnrlInfo.limit_step_id,info.gnrl_group=this.m_gnrlInfo.gnrl_group,info.class_type=count_func;for(var attk_value=generalService.getUserGeneralAttk(info),def_value=generalService.getUserGeneralDef(info),hp_value=generalService.getUserGeneralHp(info),i=0;i<3;++i){var stat_layer=new cc.Layer;stat_layer.setContentSize(208,35),stat_layer.setAnchorPoint(ZERO()),stat_layer.setPosition(127,y),bg_box.addChild(stat_layer),y-=35;var label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812);label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),label.setPosition(8,ccCenter(stat_layer).y),stat_layer.addChild(label);var arrow=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_arrow_3.png");if(arrow.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),arrow.setPosition(146,ccCenter(stat_layer).y),stat_layer.addChild(arrow),0==i){label.setString(res_str("label_attk"));var crrnt_attk_label=cmLabel.getLabel(Number(Math.floor(this.m_gnrlInfo.attk)).toLocaleString("en"),LABEL_FONT_INDEX.FONT_161);crrnt_attk_label.setAnchorPoint(ANCHOR_MIDDLE()),crrnt_attk_label.setPosition(95,ccCenter(stat_layer).y),stat_layer.addChild(crrnt_attk_label);var rebirth_attk_label=cmLabel.getLabel(Number(Math.floor(attk_value)).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1612);rebirth_attk_label.setAnchorPoint(ANCHOR_MIDDLE()),rebirth_attk_label.setPosition(206,ccCenter(stat_layer).y),stat_layer.addChild(rebirth_attk_label)}else if(1==i){label.setString(res_str("label_def"));var crrnt_def_label=cmLabel.getLabel(Number(Math.floor(this.m_gnrlInfo.def)).toLocaleString("en"),LABEL_FONT_INDEX.FONT_161);crrnt_def_label.setAnchorPoint(ANCHOR_MIDDLE()),crrnt_def_label.setPosition(95,ccCenter(stat_layer).y),stat_layer.addChild(crrnt_def_label);var rebirth_def_label=cmLabel.getLabel(Number(Math.floor(def_value)).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1612);rebirth_def_label.setAnchorPoint(ANCHOR_MIDDLE()),rebirth_def_label.setPosition(206,ccCenter(stat_layer).y),stat_layer.addChild(rebirth_def_label)}else if(2==i){label.setString(res_str("label_hp"));var crrnt_hp_label=cmLabel.getLabel(Number(Math.floor(this.m_gnrlInfo.hp)).toLocaleString("en"),LABEL_FONT_INDEX.FONT_161);crrnt_hp_label.setAnchorPoint(ANCHOR_MIDDLE()),crrnt_hp_label.setPosition(95,ccCenter(stat_layer).y),stat_layer.addChild(crrnt_hp_label);var rebirth_hp_label=cmLabel.getLabel(Number(Math.floor(hp_value)).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1612);rebirth_hp_label.setAnchorPoint(ANCHOR_MIDDLE()),rebirth_hp_label.setPosition(206,ccCenter(stat_layer).y),stat_layer.addChild(rebirth_hp_label)}}return layer},getRebirthLeaderSkillLayer:function(rebirth_gnrl_info){var layer=new cc.Layer,m=MasterManager.getInstance(),bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());bg_box.setPreferredSize(cc.size(444,132)),bg_box.setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),layer.addChild(bg_box);var frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");frame.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),frame.setPosition(14,23),bg_box.addChild(frame);var is_exist_leader_skill=!1,desc_height=64,icon=cc.Sprite.create();icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(frame)),frame.addChild(icon);var name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812);name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),name.setPosition(91,73),bg_box.addChild(name);var box_height=132,desc=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_144);desc.setAnchorPoint(ANCHOR_TOP_LEFT()),desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),desc.setTextAreaSize(cc.size(320,desc_height)),desc.ignoreContentAdaptWithSize(!1),desc.setPosition(91,73),bg_box.addChild(desc);for(var idx=0;idx<rebirth_gnrl_info.leader_skill.length;idx++)if(99999!=rebirth_gnrl_info.leader_skill[idx]&&0!=rebirth_gnrl_info.leader_skill[idx]){0!=(skill=m.get_LeaderSkill(rebirth_gnrl_info.leader_skill[idx])).skill_icon&&null!=skill.skill_icon&&null!=skill.skill_icon&&icon.setTexture(RES_CDN_DEFULT+"icon/leader/leader_"+skill.skill_icon+".png"),name.setString(skill.name),desc.setString(skill.content),is_exist_leader_skill=!0;break}if(!is_exist_leader_skill)for(idx=0;idx<rebirth_gnrl_info.special_leader_skill.length;idx++)if(99999!=rebirth_gnrl_info.special_leader_skill[idx]&&0!=rebirth_gnrl_info.special_leader_skill[idx]){var skill=m.get_SpecialLeaderSkill(rebirth_gnrl_info.special_leader_skill[idx]);icon.setTexture(RES_CDN_DEFULT+"icon/leader/leader_"+skill.skill_icon+".png"),name.setString(skill.name),desc.setString(skill.content);break}var f_size=desc.getFontSize(),s_lengh=desc.getString().length;desc_height=Math.ceil((s_lengh*f_size+320)/320)*(f_size+2),desc_height=Math.max(64,desc_height),desc.setTextAreaSize(cc.size(320,desc_height)),64<ccHeight(desc)&&(box_height+=ccHeight(desc)-64),bg_box.setContentSize(444,box_height),layer.setContentSize(ccSize(bg_box)),frame.setPosition(14,ccHeight(bg_box)-109),name.setPosition(91,ccHeight(bg_box)-59),desc.setPosition(91,ccHeight(bg_box)-59);var circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_leader.png");circle_point.setAnchorPoint(ZERO()),circle_point.setPosition(17,ccHeight(bg_box)-28),bg_box.addChild(circle_point);var title=cmLabel.getLabel(res_str("label_info_skill_leader"),LABEL_FONT_INDEX.FONT_2037);return title.setAnchorPoint(ZERO()),title.setPosition(30,ccHeight(bg_box)-34),bg_box.addChild(title),layer},getRebirthPassiveSkillLayer:function(rebirth_gnrl_info){var layer=new cc.Layer,m=MasterManager.getInstance(),bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());bg_box.setContentSize(444,132),bg_box.setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),layer.addChild(bg_box);var frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");frame.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),frame.setPosition(14,23),bg_box.addChild(frame);var icon=cc.Sprite.create();icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(frame)),frame.addChild(icon);var name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812);name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),name.setPosition(91,73),bg_box.addChild(name);var box_height=132,desc_height=64,desc=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_144);desc.setAnchorPoint(ANCHOR_TOP_LEFT()),desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),desc.setTextAreaSize(cc.size(320,desc_height)),desc.ignoreContentAdaptWithSize(!1),desc.setPosition(91,73),bg_box.addChild(desc);for(var is_exist_passive=!1,idx=0;idx<rebirth_gnrl_info.passive_skill.length;idx++)if(99999!=rebirth_gnrl_info.passive_skill[idx]&&0!=rebirth_gnrl_info.passive_skill[idx]){var skill=m.get_PassiveSkillV2(rebirth_gnrl_info.passive_skill[idx]);if(USE_ACTIVE_PASSIVE_ICON)icon.setTexture(RES_CDN_DEFULT+"icon/passive/"+cmString("passive_%d.png",skill.skill_icon));else{var icon_passive_name="passive_"+skill.skill_icon+".png",icon_passive_tex=cc.spriteFrameCache.getSpriteFrame(icon_passive_name);icon.setSpriteFrame(icon_passive_tex)}name.setString(skill.name),desc.setString(skill.content);var f_size=desc.getFontSize(),s_lengh=desc.getString().length,line_length=320;desc_height=Math.ceil((s_lengh*f_size+line_length)/320)*(f_size+2),desc_height=Math.max(64,desc_height),desc.setTextAreaSize(cc.size(320,desc_height)),64<ccHeight(desc)&&(box_height+=ccHeight(desc)-64),is_exist_passive=!0;break}if(!is_exist_passive)for(idx=0;idx<rebirth_gnrl_info.trans_passive_skill.length;idx++)if(99999!=rebirth_gnrl_info.trans_passive_skill[idx]&&0!=rebirth_gnrl_info.trans_passive_skill[idx]){skill=m.get_TransPassiveSkill(rebirth_gnrl_info.trans_passive_skill[idx]);if(USE_ACTIVE_PASSIVE_ICON)icon.setTexture(RES_CDN_DEFULT+"icon/passive/"+cmString("passive_%d.png",skill.skill_icon));else{icon_passive_name="passive_"+skill.skill_icon+".png",icon_passive_tex=cc.spriteFrameCache.getSpriteFrame(icon_passive_name);icon.setSpriteFrame(icon_passive_tex)}name.setString(skill.name),desc.setString(skill.content);f_size=desc.getFontSize(),s_lengh=desc.getString().length,line_length=320;desc_height=Math.ceil((s_lengh*f_size+line_length)/320)*(f_size+2),desc_height=Math.max(64,desc_height),desc.setTextAreaSize(cc.size(320,desc_height)),64<ccHeight(desc)&&(box_height+=ccHeight(desc)-64);break}bg_box.setContentSize(444,box_height),layer.setContentSize(ccSize(bg_box)),frame.setPosition(14,ccHeight(bg_box)-109),name.setPosition(91,ccHeight(bg_box)-59),desc.setPosition(91,ccHeight(bg_box)-59);var circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_passive.png");circle_point.setAnchorPoint(ZERO()),circle_point.setPosition(17,ccHeight(bg_box)-28),bg_box.addChild(circle_point);var title=cmLabel.getLabel(res_str("label_info_skill_passive"),LABEL_FONT_INDEX.FONT_2036);if(title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(30,ccHeight(bg_box)-34),bg_box.addChild(title),(this.m_gnrlInfo.gnrl_type==GENERAL_TYPE_YUNHEE||this.m_gnrlInfo.gnrl_type==GENERAL_TYPE_JIN_YUNHEE)&&1==this.m_gnrlInfo.class_type){var gs=GeneralService.getInstance(),passive_id=gs.getNextClassTypePassiveId(rebirth_gnrl_info.evolution_group_num,this.m_gnrlInfo.class_type);if(0!=(skill=m.get_PassiveSkillV2(passive_id)).skill_icon&&null!=skill.skill_icon&&null!=skill.skill_icon)if(USE_ACTIVE_PASSIVE_ICON)icon.setTexture(RES_CDN_DEFULT+"icon/passive/"+cmString("passive_%d.png",skill.skill_icon));else{icon_passive_name="passive_"+skill.skill_icon+".png",icon_passive_tex=cc.spriteFrameCache.getSpriteFrame(icon_passive_name);icon.setSpriteFrame(icon_passive_tex)}if(name.setString(skill.name),name.setColor(COLOR(188)),desc.setString(skill.content),desc.setColor(COLOR(166)),99999==passive_id||0==passive_id){passive_id=gs.getNextClassTypeTransPassiveId(this.m_gnrlInfo.evolution_group_num,this.m_gnrlInfo.class_type),skill=m.get_TransPassiveSkill(passive_id);if(USE_ACTIVE_PASSIVE_ICON)icon.setTexture(RES_CDN_DEFULT+"icon/passive/"+cmString("passive_%d.png",skill.skill_icon));else{icon_passive_name="passive_"+skill.skill_icon+".png",icon_passive_tex=cc.spriteFrameCache.getSpriteFrame(icon_passive_name);icon.setSpriteFrame(icon_passive_tex)}name.setString(skill.name),name.setColor(COLOR(188)),desc.setString(skill.content),desc.setColor(COLOR(166))}var icon_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());icon_mask.setContentSize(68,68),icon_mask.setPosition(ccCenter(icon)),icon.addChild(icon_mask);var info_label=cmLabel.getLabel("("+res_str("label_evolve_after_passive_skill_info_text")+")",LABEL_FONT_INDEX.FONT_1613);info_label.setAnchorPoint(ZERO()),info_label.setPosition(ccPosX(title)+ccWidth(title),ccPosY(title)),bg_box.addChild(info_label);f_size=desc.getFontSize(),s_lengh=desc.getString().length,line_length=320;desc_height=Math.ceil((s_lengh*f_size+line_length)/320)*(f_size+2),desc_height=Math.max(64,desc_height),desc.setTextAreaSize(cc.size(320,desc_height)),64<ccHeight(desc)&&(box_height+=ccHeight(desc)-64),bg_box.setContentSize(444,box_height),layer.setContentSize(ccSize(bg_box)),frame.setPosition(14,ccHeight(bg_box)-109),title.setPosition(30,ccHeight(bg_box)-34),null!=info_label&&info_label.setPosition(ccPosX(title)+ccWidth(title),ccPosY(title))}return title.setPosition(30,ccHeight(bg_box)-34),circle_point.setPosition(17,ccHeight(bg_box)-28),layer},getRebirthActiveSkillLayer:function(rebirth_gnrl_info){var layer=new cc.Layer,m=MasterManager.getInstance(),bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());bg_box.setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),layer.addChild(bg_box);var frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");frame.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bg_box.addChild(frame);var box_height=132,name="",desc="";if(0!=this.m_gnrlInfo.active_skill){var icon,skill=m.get_ActiveSkill(rebirth_gnrl_info.active_skill);if(USE_ACTIVE_PASSIVE_ICON)(icon=cc.Sprite.create(RES_CDN_DEFULT+"icon/active/active_"+skill.skill_group+".png")).setContentSize(60,60),icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(frame)),frame.addChild(icon);else(icon=cc.Sprite.create("#active_"+skill.skill_group+".png")).setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(frame)),frame.addChild(icon);(name=cmLabel.getLabel(skill.name,LABEL_FONT_INDEX.FONT_1812)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bg_box.addChild(name);var line=SKILLLINECOUNT(skill,27);(desc=cmLabel.getLabel(skill.content,LABEL_FONT_INDEX.FONT_144)).setAnchorPoint(ANCHOR_TOP_LEFT()),desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),desc.setTextAreaSize(cc.size(320,17*line)),desc.ignoreContentAdaptWithSize(!1),bg_box.addChild(desc),64<ccHeight(desc)&&(box_height+=ccHeight(desc)-64)}bg_box.setContentSize(444,box_height),layer.setContentSize(ccSize(bg_box)),frame.setPosition(14,ccHeight(bg_box)-109),0!=this.m_gnrlInfo.active_skill&&(name.setPosition(91,ccHeight(bg_box)-59),desc.setPosition(91,ccHeight(bg_box)-59));var circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_active.png");circle_point.setAnchorPoint(ZERO()),circle_point.setPosition(17,ccHeight(bg_box)-28),bg_box.addChild(circle_point);var title=cmLabel.getLabel(res_str("label_info_skill_active"),LABEL_FONT_INDEX.FONT_2035);return title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(30,ccHeight(bg_box)-34),bg_box.addChild(title),layer},getEquipmentChangeLayer:function(){var mt=MasterManager.getInstance(),layer=new cc.Layer,size=cc.size(630,370),rect=cc.Rect(40,40,10,10),bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",rect);bg.setPreferredSize(size),bg.setPosition(ccCenter(layer)),layer.addChild(bg);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_3.png");navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(bg).x,ccHeight(bg)-11),bg.addChild(navi);var label_title=cmLabel.getLabel(mt.get_LanguageData("label_equipment"),LABEL_FONT_INDEX.FONT_261);label_title.setAnchorPoint(ANCHOR_MIDDLE()),label_title.setPosition(ccCenter(navi).x,ccCenter(navi).y+3),navi.addChild(label_title);var button_1=new LabelButton("btn_17_off.png","btn_17_on.png","",ccui.Widget.PLIST_TEXTURE);button_1.setFont(LABEL_FONT_INDEX.FONT_241),button_1.setString(mt.get_LanguageData("btn_label_levelup")),button_1.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),button_1.setPosition(ccCenter(bg).x,16),button_1.addClickEventListener(function(sender){this.m_isPopupShow=!0,GameContext.getInstance().setNotUseEquipmentPartsTab(!1),GameContext.getInstance().setEquipmentListInvoker(1),GameContext.getInstance().setEquipmentParts(100);var scene=new EquipmentScene_WebV2(EQUIP_LAYER_STATE.LEVELUP,!0);SceneManager.getInstance().replaceScene(scene),scene=null,this.m_equipemnt_change_modal_layer.hide()}.bind(this)),bg.addChild(button_1);var equip_key=GameContext.getInstance().getEquipmentKey(),equip={};EquipmentService.getInstance().getUserEquipmentInfo(equip_key,equip,this.m_gnrl_key),equip.max_level<=equip.level&&button_1.setEnabled(!1),GameContext.getInstance().setEquipmentParts(equip.equip_parts_type);var button_2=new LabelButton("btn_18_off.png","btn_18_on.png","",ccui.Widget.PLIST_TEXTURE);button_2.setFont(LABEL_FONT_INDEX.FONT_241),button_2.setString(mt.get_LanguageData("btn_label_release")),button_2.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),button_2.setPosition(ccCenter(bg).x-ccCenter(button_1).x,16),button_2.addClickEventListener(function(sender){this.scheduleOnce(function(float){this.showReleaseEquipmentMsgBox()},0,"showReleaseEquipmentMsgBox"),this.m_equipemnt_change_modal_layer.hide()}.bind(this)),bg.addChild(button_2);var button_3=new LabelButton("btn_17_off.png","btn_17_on.png","",ccui.Widget.PLIST_TEXTURE);button_3.setFont(LABEL_FONT_INDEX.FONT_241),button_3.setAnchorPoint(ZERO()),button_3.setString(mt.get_LanguageData("btn_label_change")),button_3.setPosition(ccCenter(bg).x+ccCenter(button_1).x,16),button_3.addClickEventListener(function(sender){GameContext.getInstance().setNotUseEquipmentPartsTab(!0),GameContext.getInstance().setEquipmentListInvoker(1),GameContext.getInstance().setEquipmentChangeScenePreScene(!0),this.m_isPopupShow=!0;var scene=new EquipmentScene_WebV2(EQUIP_LAYER_STATE.CHANGE,!0);SceneManager.getInstance().replaceScene(scene),scene=null,this.m_equipemnt_change_modal_layer.hide()}.bind(this)),bg.addChild(button_3);var back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(bg)-12,ccHeight(bg)-12),bg.addChild(back_btn),back_btn.addClickEventListener(function(sender){this.m_equipemnt_change_modal_layer.hide()}.bind(this));var key=GameContext.getInstance().getEquipmentKey(),service=EquipmentService.getInstance(),info={};service.getUserEquipmentInfo(key,info,this.m_gnrl_key);var card_info={};card_info.equip_id=info.equip_id,card_info.arm_service_type=info.arm_service_type,card_info.equip_group=info.equip_group,card_info.equip_parts_type=info.equip_parts_type,card_info.equip_rare_type=info.equip_rare_type,card_info.equip_type=info.equip_type,card_info.level=info.level,card_info.step=info.equip_step,card_info.image=info.image,card_info.property_img=info.property_img,card_info.frame_id=info.frame_id,card_info.symbol_id=info.symbol_id,card_info.symbol_name_id=info.symbol_name_id,card_info.is_same_gnrl_group=!1,card_info.gnrl_group=info.gnrl_group;var equip_icon=CardEquipment.getInstance().createCardEquipment(card_info,EQUIPMENT_CARD_TYPE.type_card_common);equip_icon.setAnchorPoint(ZERO()),equip_icon.setPosition(36,199),bg.addChild(equip_icon);var font_index=LABEL_FONT_INDEX.FONT_201,equip_name_label=cmLabel.getLabel(info.equip_name,font_index);equip_name_label.setAnchorPoint(ZERO()),equip_name_label.setPosition(154,277),bg.addChild(equip_name_label);mt.get_EquipmentItem(info.equip_id);var combo_stat=mt.get_ComboStat(info.combo_stat),stat_name=cmLabel.getLabel(cmString("%s",combo_stat.name),LABEL_FONT_INDEX.FONT_1812);stat_name.setAnchorPoint(ZERO()),stat_name.setPosition(ccPos(equip_name_label).x,249),bg.addChild(stat_name);var stat_value=cmLabel.getLabel(cmString("%s",info.stat_value.toLocaleString("en")),LABEL_FONT_INDEX.FONT_1820);stat_value.setAnchorPoint(ZERO()),stat_value.setPosition(ccPos(equip_name_label).x+stat_name.getContentSize().width+10,249),bg.addChild(stat_value);var skill_str=[];service.getEquipmentSkillContent(info,skill_str);var pos_y=236;if(null!=skill_str[0]&&""!=skill_str[0]){var skill_name=cmLabel.getLabel(cmString(mt.get_LanguageData("label_equipemnt_skill_content"),skill_str[0]),LABEL_FONT_INDEX.FONT_161);1<(lineCnt=EQUIPLINECOUNT(skill_str[0]))&&(pos_y-=20*(lineCnt-1)),skill_name.setAnchorPoint(ZERO()),skill_name.setPosition(ccPos(equip_name_label).x,pos_y),bg.addChild(skill_name),pos_y-=20}if(null!=skill_str[1]&&""!=skill_str[1]){skill_name=cmLabel.getLabel(cmString(mt.get_LanguageData("label_equipemnt_skill_content"),skill_str[1]),LABEL_FONT_INDEX.FONT_161);1<(lineCnt=EQUIPLINECOUNT(skill_str[1]))&&(pos_y-=20*(lineCnt-1)),skill_name.setAnchorPoint(ZERO()),skill_name.setPosition(ccPos(equip_name_label).x,pos_y),bg.addChild(skill_name),pos_y-=20}if(null!=skill_str[2]&&""!=skill_str[2]){var lineCnt;skill_name=cmLabel.getLabel(cmString(mt.get_LanguageData("label_equipemnt_skill_content"),skill_str[2]),LABEL_FONT_INDEX.FONT_161);1<(lineCnt=EQUIPLINECOUNT(skill_str[1]))&&(pos_y-=20*(lineCnt-1)),skill_name.setAnchorPoint(ZERO()),skill_name.setPosition(ccPos(equip_name_label).x,pos_y),bg.addChild(skill_name),pos_y-=20}var equip_group_idx=0;0!=info.option_num1&&(equip_group_idx=mt.get_EquipmentItemOption(info.option_id1,info.option_num1).equip_group_idx);var group_list=MasterTable.getInstance().get_EquipmentGroupList(equip_group_idx),set_effect_layer=this.getSetEffectLayer(group_list,equip_group_idx);return set_effect_layer.setAnchorPoint(ZERO),set_effect_layer.setPosition(36,87),bg.addChild(set_effect_layer),layer},showChangeEquipmentMsgBox:function(){this.m_equipemnt_change_modal_layer.setContentSize(ccSize(this)),this.m_equipemnt_change_modal_layer._contentNode=function(contentSize,m){return this.getEquipmentChangeLayer()}.bind(this),this.m_equipemnt_change_modal_layer.show()},showRebirthInfoLayer:function(){this.m_rebirth_info_modal_layer.setContentSize(ccSize(this)),this.m_rebirth_info_modal_layer._contentNode=function(contentSize,m){return this.getRebirthInfoPopupLayer()}.bind(this),this.m_rebirth_info_modal_layer.show()},showReleaseEquipmentMsgBox:function(){var equip_key=GameContext.getInstance().getEquipmentKey(),mt=MasterManager.getInstance(),equip_item=mt.get_EquipmentItem(equip_key.equipment_item_idx),equip_name=(mt.get_General(this.m_gnrl_key.gnrl_id),equip_item.name),user_equip={};if(EquipmentService.getInstance().getUserEquipmentInfo(equip_key,user_equip,this.m_gnrl_key),0<user_equip.option_num1){var step_rate=mt.get_EquipmentStepRate(equip_item.equip_step_idx,user_equip.equip_step);mt.get_EquipmentItemOption(step_rate.option1_idx,user_equip.option_num1);equip_name=user_equip.equip_name}var equip_level_info={};EquipmentService.getInstance().getEquipmentLevelInfo(equip_key,equip_level_info);mt.get_BonusType(equip_level_info.need_release_bonus_type);this.m_ctbox.is_show()&&this.m_ctbox.hide(!1),this.m_ctbox.setTitle(res_str("label_equipment_takeoff_equipment_title")),this.m_ctbox.setText(equip_name,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("の",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("装備状態を解除しますか？",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_cancel"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_ctbox.hide()}.bind(this))),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_release"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.sendPacketReleaseEquipment()},0,"sendPacketReleaseEquipment"),this.m_ctbox.hide(!1)}.bind(this))),this.m_ctbox.show()},getSetEffectLayer:function(group_list,set_group_index){var layer=new cc.Layer,mt=MasterManager.getInstance(),bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());bg.setPreferredSize(cc.size(558,88)),bg.setAnchorPoint(ZERO()),bg.setPosition(ZERO()),layer.addChild(bg),layer.setContentSize(ccSize(bg));var title_label=cmLabel.getLabel(mt.get_LanguageData("label_equipment_set_effect_title"),LABEL_FONT_INDEX.FONT_1812);if(title_label.setAnchorPoint(ZERO()),title_label.setPosition(13,63),bg.addChild(title_label),0<set_group_index&&0<group_list.length){var equip_info_list,group_indx=group_list[0].equip_group_idx,set_count=0,es=EquipmentService.getInstance();equip_info_list=es.getUserGeneralEquipmentListInfo(this.m_gnrl_key);for(var idx=0;idx<equip_info_list.length;idx++){var equip=equip_info_list[idx],equip_key={},user_equip_info={};equip_key.equipment_item_idx=equip.equip_id,equip_key.equipment_num=equip.equip_num,es.getUserEquipmentInfo(equip_key,user_equip_info,this.m_gnrl_key),user_equip_info.equip_group==group_indx&&set_count++}var label_pos_y=41,set_group_list_size=group_list.length,i=1;for(idx=0;idx<group_list.length;idx++){var group=group_list[idx],combo_stat=mt.get_ComboStat(group.combo_stat),added_value=group.added_value;"y"==group.use_10000_ratio_yn&&(added_value=(.01*group.added_value).toFixed(1));var content_label=cmLabel.getLabel(group.equip_count+" 部位装着時、"+combo_stat.name+" "+added_value+"%増加",LABEL_FONT_INDEX.FONT_181);content_label.setAnchorPoint(ZERO()),content_label.setPosition(13,label_pos_y),bg.addChild(content_label),(set_count==group.equip_count||set_count>group.equip_count&&set_group_list_size==i)&&content_label.setColor(COLOR(1412)),label_pos_y-=20,i++}}return layer},sendPacketReleaseEquipment:function(){var equip_key=GameContext.getInstance().getEquipmentKey(),req={gnrl_key:{},equipment_key:{}};req.opcode=net.OP.op_equipment_general_release,req.gnrl_key.gnrl_id=this.m_gnrl_key.gnrl_id,req.gnrl_key.gnrl_num=this.m_gnrl_key.gnrl_num,req.equipment_key.equipment_item_idx=equip_key.equipment_item_idx,req.equipment_key.equipment_num=equip_key.equipment_num,this.network_write(req)},sendPacketGeneralUnlock:function(){var req={};req.opcode=net.OP.op_general_unlock,req.gnrl_key={gnrl_id:this.m_gnrl_key.gnrl_id,gnrl_num:this.m_gnrl_key.gnrl_num},this.network_write(req)},sendPacketLimitOver:function(){var req={};req.opcode=net.OP.op_general_limit_over,req.gnrl_key={gnrl_id:this.m_gnrl_key.gnrl_id,gnrl_num:this.m_gnrl_key.gnrl_num},req.mtrl_key=[];var mtrlList=this.m_yunheeDetailLayer.getLimitOverMaterialGeneralKey();this.m_yunheeDetailLayer.setEnableLimitOverBtn(!1);for(var i=0;i<mtrlList.length;i++){var key={};key.gnrl_id=mtrlList[i].gnrl_id,key.gnrl_num=mtrlList[i].gnrl_num,req.mtrl_key.push(key)}this.network_write(req)},sendPacketLevelUp:function(){var req={};req.opcode=net.OP.op_general_level_up,req.gnrl_key={gnrl_id:this.m_gnrl_key.gnrl_id,gnrl_num:this.m_gnrl_key.gnrl_num},req.mtrl_gnrl_keys=this.m_yunheeDetailLayer.getMaterialGeneralKey(),req.need_gold=this.m_yunheeDetailLayer.getLevelUpNeedGold(),this.network_write(req);var tutorial=TutorialContextV2.getInstance();if(!tutorial.IsCompleteAllTutorial()){var step=tutorial.getCurrentTutorialStep();step.tutorial_page==TUTORIAL_PAGE_3_LOVE_LEVEL_UP&&3==step.tutorial_step&&this.popTutorialLayer()}},sendPacketLoveUp:function(){var req={};req.opcode=net.OP.op_general_love_up,req.gnrl_key={gnrl_id:this.m_gnrl_key.gnrl_id,gnrl_num:this.m_gnrl_key.gnrl_num},req.user_love_item=this.m_yunheeDetailLayer.getLoveUpMaterialItemKey(),req.need_gold=this.m_yunheeDetailLayer.getLoveUpNeedGold(),this.network_write(req)},sendPacketEvolution:function(){var req={};req.opcode=net.OP.op_general_evolution,req.gnrl_key={gnrl_id:this.m_gnrlInfo.gnrl_id,gnrl_num:this.m_gnrlInfo.gnrl_num},req.mtrl_keys=[],this.m_yunheeDetailLayer.setEnableEvolutionBtn(!1);for(var mtrlList=this.m_yunheeDetailLayer.getEvolveMaterialList(),i=0;i<mtrlList.length;i++){var key={};key.slot_type=mtrlList[i],key.gnrl_id=mtrlList[i].gnrl_id,key.gnrl_num=mtrlList[i].gnrl_num,req.mtrl_keys.push(key)}this.network_write(req)},sendPacketRebirth:function(){var req={};req.opcode=net.OP.op_general_rebirth,req.gnrl_key={gnrl_id:this.m_gnrlInfo.gnrl_id,gnrl_num:this.m_gnrlInfo.gnrl_num},this.m_yunheeDetailLayer.setEnableRebirthBtn(!1),this.network_write(req)},sendPacketReleaseYunheeInTroops:function(){var req={};req.opcode=net.OP.op_all_troops_del_general,req.gnrl_key={gnrl_id:this.m_gnrl_key.gnrl_id,gnrl_num:this.m_gnrl_key.gnrl_num},this.network_write(req)},sendPacketSelectYunheeCharacter:function(){var req={};req.opcode=net.OP.op_general_change_display_class,req.gnrl_key={gnrl_id:this.m_gnrlInfo.gnrl_id,gnrl_num:this.m_gnrlInfo.gnrl_num};for(var i=0;i<this.m_characterItemLayers.length;i++)if(this.m_characterItemLayers[i].getSelected()){req.display_class=i+1;break}this.network_write(req)},onNotificationLoveItem:function(index){var tag=index;this.m_gnrlInfo.love_level>=YUNHEE_MAX_LOVE_LEVEL?this.showIsMaxLoveLevel():this.m_yunheeDetailLayer.setSelectedLoveItem(tag)},onNotificationShortcuts:function(sender){var tag=sender,shortcuts=GeneralService.getInstance().getShortcutList(tag);shortcuts.length<=0||(this.m_mtrlShortcutsModalLayer.setShortcutsInfo(shortcuts),this.m_mtrlShortcutsModalLayer.show())},onNotificationEvolveMaterial:function(sender){var tag=sender,info=this.m_yunheeDetailLayer.getEvolveMaterialInfo(tag),mtrl_type=info.mtrl_info.slot_type,mtrl_value_1=info.mtrl_info.slot_value_1,mtrl_value_2=info.mtrl_info.slot_value_2,generalService=GeneralService.getInstance(),gnrlInfoList={},keys={};this.m_yunheeDetailLayer.getEvolveMaterialList(keys),mtrl_type==EVOLVE_MTRL_TYPE_YUNHEE?generalService.getEvolutionMaterialInfo(this.m_gnrlInfo.gnrl_num,mtrl_value_1,keys,gnrlInfoList):mtrl_type==EVOLVE_MTRL_TYPE_CLASS_TYPE&&generalService.getEvolutionMaterialInfoClassType(this.m_gnrlInfo.gnrl_num,mtrl_value_1,mtrl_value_2,keys,gnrlInfoList),this.m_yunheeDetailLayer.setEvolveMaterialList(tag,gnrlInfoList)},hideEvolveResult:function(){var audio;(this.m_beforeInfo=this.m_gnrlInfo,this.m_characterLayer.removeFromParent(),this.m_characterLayer=this.getCharacterLayer(),this.m_characterLayer.ignoreAnchorPointForPosition(!1),this.m_characterLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_characterLayer.setPosition((ccWidth(this)-478)/2,0),this.m_layer.addChild(this.m_characterLayer),this.m_detailLayer.removeFromParent(),this.m_detailLayer=this.getYunheeDetailLayer(),this.m_detailLayer.ignoreAnchorPointForPosition(!1),this.m_detailLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_detailLayer.setPosition(ccWidth(this)/2,0),this.m_layer.addChild(this.m_detailLayer,2),this.m_isSpineMode=!1,this.m_evolveModalLayer.is_show())&&((audio=AudioEngine.getInstance()).stopEffectsAll(),audio.stopVoice(),audio.stopBackgroundMusic(),bgm_path="",this.playMainBGM(),this.m_evolveModalLayer.hide());this.m_limitOverModalLayer.is_show()&&((audio=AudioEngine.getInstance()).stopEffectsAll(),audio.stopVoice(),audio.stopBackgroundMusic(),bgm_path="",this.playMainBGM(),this.m_limitOverModalLayer.hide());this.m_yunheeSelectModalLayer.is_show()&&this.m_yunheeSelectModalLayer.hide()},hidelimitover:function(){if(this.m_beforeInfo=this.m_gnrlInfo,this.m_characterLayer.removeFromParent(),this.m_characterLayer=this.getCharacterLayer(),this.m_characterLayer.ignoreAnchorPointForPosition(!1),this.m_characterLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_characterLayer.setPosition((ccWidth(this)-478)/2,0),this.m_layer.addChild(this.m_characterLayer),this.m_detailLayer.removeFromParent(),this.m_detailLayer=this.getYunheeDetailLayer(),this.m_detailLayer.ignoreAnchorPointForPosition(!1),this.m_detailLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_detailLayer.setPosition(ccWidth(this)/2,0),this.m_layer.addChild(this.m_detailLayer,2),this.m_limitOverModalLayer.is_show()){var audio=AudioEngine.getInstance();audio.stopEffectsAll(),audio.stopVoice(),audio.stopBackgroundMusic(),bgm_path="",this.playMainBGM(),this.m_limitOverModalLayer.hide()}},completeEvolution:function(){var key=GameContext.getInstance().getGeneralKey();this.m_gnrl_key.gnrl_id=key.gnrl_id,this.m_gnrl_key.gnrl_num=key.num,GeneralService.getInstance().getUserGeneralInfo(this.m_gnrl_key,this.m_gnrlInfo),this.m_evolveModalLayer.setGeneralKey(this.m_gnrl_key),this.m_evolveModalLayer.show()},showEvolveModalLayer:function(){this.removeLayerProgress_nonCircle(),this.m_evolveModalLayer.setVisible(!0)},showLimitOverModalLayer:function(){this.removeLayerProgress_nonCircle(),this.m_limitOverModalLayer.setVisible(!0)},completeLimitOver:function(body){this.m_gnrl_key.gnrl_id=body.gnrl_key.gnrl_id,this.m_gnrl_key.gnrl_num=body.gnrl_key.gnrl_num,GeneralService.getInstance().getUserGeneralInfo(this.m_gnrl_key,this.m_gnrlInfo),this.m_limitOverModalLayer.setGeneralKey(this.m_gnrl_key),this.m_limitOverModalLayer.show()},completeRebirth:function(){var key=GameContext.getInstance().getGeneralKey();this.m_gnrl_key.gnrl_id=key.gnrl_id,this.m_gnrl_key.gnrl_num=key.num,GeneralService.getInstance().getUserGeneralInfo(this.m_gnrl_key,this.m_gnrlInfo),this.m_evolveModalLayer.setGeneralKey(this.m_gnrl_key,invoker_rebirth),this.m_evolveModalLayer.show()},onExit:function(){this._super(),this.m_deferred=null;var gameObserver=MainObserver.getInstance();if(gameObserver.removeObserver(sceneStr[scene_YunheeDetailScene]),gameObserver.removeObserver(LOVE_ITEM_SELECT),gameObserver.removeObserver(NOTIFICATION_EVOLUTION_MTRL_SHORTCUTS),gameObserver.removeObserver(NOTIFICATION_REBIRTH_MTRL_SHORTCUTS),gameObserver.removeObserver(NOTIFICATION_SELETE_EVOLVE_MATRIAL),1!=this.m_isPopupShow){if(this.m_sd_img.forEach(function(url){cc.loader.release(url)}),this.m_gnrl_img.forEach(function(url){cc.loader.release(url)}),this.m_sd_img=[],this.m_gnrl_img=[],null!=this.m_character_skeleton&&(this.removeChild(this.m_character_skeleton),this.m_character_skeleton._skeleton.data.animations=[],this.m_character_skeleton._skeleton.data.bones=[],this.m_character_skeleton._skeleton.data.events=[],this.m_character_skeleton._skeleton.data.slots=[],this.m_character_skeleton._skeleton.data.skins=[],this.m_character_skeleton._skeleton.data=null,this.m_character_skeleton.removeAllChildrenWithCleanup(!0),this.m_character_skeleton._spineComplete=null,this.m_character_skeleton.removeFromParent(!0),this.m_character_skeleton=null),null!=this.m_skeletonNode&&(this.removeChild(this.m_skeletonNode),this.m_skeletonNode._skeleton.data.animations=[],this.m_skeletonNode._skeleton.data.bones=[],this.m_skeletonNode._skeleton.data.events=[],this.m_skeletonNode._skeleton.data.slots=[],this.m_skeletonNode._skeleton.data.skins=[],this.m_skeletonNode._skeleton.data=null,this.m_skeletonNode.removeAllChildrenWithCleanup(!0),this.m_skeletonNode._spineComplete=null,this.m_skeletonNode.removeFromParent(!0),this.m_skeletonNode=null),null!=this.m_characterLayer&&(this.removeChild(this.m_characterLayer),this.m_characterLayer=null),USE_SHORTCUT_EVOLUTION_ICON?(cc.spriteFrameCache.removeSpriteFramesFromFile(RES_CDN_DEFULT+"icon/shortcut_evolution/"+SHORTCUT_EVOLUTION_TEXTURE+".plist"),delete cc.spriteFrameCache._frameConfigCache[RES_CDN_DEFULT+"icon/shortcut_evolution/"+SHORTCUT_EVOLUTION_TEXTURE+".plist"]):(cc.spriteFrameCache.removeSpriteFramesFromFile(RES_CDN_DEFULT+"icon/evolve_small/"+ICON_EVOLVE_SMALL_TEXTURE+".plist"),delete cc.spriteFrameCache._frameConfigCache[RES_CDN_DEFULT+"icon/evolve_small/"+ICON_EVOLVE_SMALL_TEXTURE+".plist"],cc.spriteFrameCache.removeSpriteFramesFromFile(RES_CDN_DEFULT+"icon/formation/"+FORMATION_TEXTURE+".plist"),delete cc.spriteFrameCache._frameConfigCache[RES_CDN_DEFULT+"icon/formation/"+FORMATION_TEXTURE+".plist"]),null!=this.m_resources){for(var i=0;i<this.m_resources.length;i++)cc.loader.release(this.m_resources[i]);this.m_resources=null}this.removeAllChildrenWithCleanup(!0)}else this.m_isPopupShow=!1},onError:function(){},onProgress:function(total,ownloaded,url,customId){},onSuccess:function(srcUrl,storagePath,customId){},getDownloadResSize:function(){},downloadResFiles:function(){},unzipFile:function(path){},update:function(dt){0!=this.m_is_voice_playing&&(this.m_voice_playing_delta-=dt,this.m_voice_playing_delta<0&&(this.m_is_voice_playing=!1,this.m_voice_playing_delta=0))},reqWorldWarTroopsInfo:function(){var req,world_war_period_idx=WorldWarService.getInstance().getWorldWarPeriodIndex();0!=world_war_period_idx&&((req={}).opcode=net.OP.op_get_world_war_troops,req.world_war_period_idx=world_war_period_idx,this.network_write(req),(req={}).opcode=net.OP.op_get_world_war_partin_generals,req.world_war_period_idx=world_war_period_idx,this.network_write(req),(req={}).opcode=net.OP.op_get_world_war_general_equipments,req.world_war_period_idx=world_war_period_idx,this.network_write(req))},reqGreatWallTroopsInfo:function(){var req={};req.opcode=net.OP.op_great_wall_troops_info;var great_wall_dungeon_period_idx=NetService().get_great_wall_troops_info().great_wall_dungeon_period_idx;0!=great_wall_dungeon_period_idx&&(req.great_wall_dungeon_period_idx=great_wall_dungeon_period_idx,this.network_write(req,!1))},showLeaderSkillExplainPopup:function(){this.m_LeaderSkillExplainPopup.setContentSize(ccSize(this)),this.m_LeaderSkillExplainPopup._contentNode=function(contentSize,m){return cc.log("Leader Skill Info Popup4"),this.getLeaderSkillPopupLayer()}.bind(this),this.m_LeaderSkillExplainPopup.show()},hideLeaderSkillExplainPopup:function(){this.m_LeaderSkillExplainPopup.is_show()&&this.m_LeaderSkillExplainPopup.hide()},getLeaderSkillPopupLayer:function(){var win_size=cc.director.getWinSize(),layer=new cc.Layer,m=MasterManager.getInstance(),bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());bg_box.setAnchorPoint(ANCHOR_MIDDLE()),bg_box.setPosition(ccCenter(this)),layer.addChild(bg_box);var frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");frame.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bg_box.addChild(frame);var icon=cc.Sprite.create();icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(frame)),frame.addChild(icon);var name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_4542);name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bg_box.addChild(name);var desc=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_452);desc.setAnchorPoint(ANCHOR_TOP_LEFT()),desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),desc.setTextAreaSize(cc.size(winSize.width-100,64)),desc.ignoreContentAdaptWithSize(!1),bg_box.addChild(desc);for(var box_height=132,is_exist_leader_skill=!1,idx=0;idx<this.m_gnrlInfo.leader_skill.length;idx++)if(0!=this.m_gnrlInfo.leader_skill[idx]&&99999!=this.m_gnrlInfo.leader_skill[idx]){var skill=m.get_LeaderSkill(this.m_gnrlInfo.leader_skill[idx]);icon.setTexture(RES_CDN_DEFULT+"icon/leader/leader_"+skill.skill_icon+".png"),name.setString(skill.name),desc.setString(skill.content),is_exist_leader_skill=!0;desc.getFontSize(),desc.getString().length;var line=SKILLLINECOUNT(skill,25);desc.setTextAreaSize(cc.size(winSize.width-100,45*line)),64<ccHeight(desc)?box_height+=ccHeight(desc)-64+45+30:box_height+=94;break}if(!is_exist_leader_skill)for(idx=0;idx<this.m_gnrlInfo.special_leader_skill.length;idx++)if(0!=this.m_gnrlInfo.special_leader_skill[idx]&&99999!=this.m_gnrlInfo.special_leader_skill[idx]){skill=m.get_SpecialLeaderSkill(this.m_gnrlInfo.special_leader_skill[idx]);icon.setTexture(RES_CDN_DEFULT+"icon/leader/leader_"+skill.skill_icon+".png"),name.setString(skill.name),desc.setString(skill.content);line=SKILLLINECOUNT(skill,25);desc.setTextAreaSize(cc.size(winSize.width-100,45*line)),64<ccHeight(desc)?box_height+=ccHeight(desc)-64+45+30:box_height+=94;break}bg_box.setContentSize(ccWidth(this),box_height),layer.setContentSize(ccSize(bg_box)),frame.setPosition(14,ccHeight(bg_box)-109-10-15),name.setPosition(91,ccHeight(bg_box)-34-45-10-15),desc.setPosition(91,ccHeight(bg_box)-59-45-15);var circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_leader.png");circle_point.setAnchorPoint(cc.p(0,0)),circle_point.setPosition(17,ccHeight(bg_box)-28-15),circle_point.setScale(2),bg_box.addChild(circle_point);var title=cmLabel.getLabel("リーダースキル",LABEL_FONT_INDEX.FONT_4544);title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(30,ccHeight(bg_box)-34-10-15),bg_box.addChild(title);var bg_clear_botton=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png");bg_clear_botton.setAnchorPoint(ZERO()),bg_clear_botton.setPosition(ZERO()),bg_clear_botton.setContentSize(ccWidth(win_size),ccHeight(win_size)),bg_clear_botton.setScale9Enabled(!0),bg_clear_botton.addClickEventListener(function(sender){this.hideLeaderSkillExplainPopup()}.bind(this)),layer.addChild(bg_clear_botton);var back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);return back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(bg_box)-10-3,ccHeight(bg_box)-34+18+9),back_btn.addClickEventListener(function(sender){this.hideLeaderSkillExplainPopup()}.bind(this)),bg_box.addChild(back_btn),layer},showPassiveExplainPopup:function(){this.m_passiveExplainPopup.setContentSize(ccSize(this)),this.m_passiveExplainPopup._contentNode=function(contentSize,m){return cc.log("Passive Skill Info Popup4"),this.getPassiveSkillPopupLayer()}.bind(this),this.m_passiveExplainPopup.show()},hidePassiveExplainPopup:function(){this.m_passiveExplainPopup.is_show()&&this.m_passiveExplainPopup.hide()},getPassiveSkillPopupLayer:function(){var win_size=cc.director.getWinSize(),layer=new cc.Layer,m=MasterManager.getInstance(),bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());bg_box.setAnchorPoint(ANCHOR_MIDDLE()),bg_box.setPosition(ccCenter(this)),layer.addChild(bg_box);var frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");frame.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bg_box.addChild(frame);var box_height=132,name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_4542);name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bg_box.addChild(name);var desc=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_452);desc.setAnchorPoint(ANCHOR_TOP_LEFT()),desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),desc.setTextAreaSize(cc.size(winSize.width-100,64)),desc.ignoreContentAdaptWithSize(!1),bg_box.addChild(desc);var icon=new cc.Sprite;icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(frame)),frame.addChild(icon);var is_exist_passive=!1;if(0<this.m_gnrlInfo.passive_skill.length&&(99999!=(passive_id=this.m_gnrlInfo.passive_skill[0])&&0!=passive_id)){if(0!=(skill=m.get_PassiveSkillV2(passive_id)).skill_icon&&null!=skill.skill_icon&&null!=skill.skill_icon){var icon_passive_name="passive_"+skill.skill_icon+".png",icon_passive_tex=cc.spriteFrameCache.getSpriteFrame(icon_passive_name);icon.setSpriteFrame(icon_passive_tex)}name.setString(skill.name),desc.setString(skill.content);var line=SKILLLINECOUNT(skill,25);desc.setTextAreaSize(cc.size(winSize.width-100,45*line)),64<ccHeight(desc)?box_height+=ccHeight(desc)-64+45+30:box_height+=94,is_exist_passive=!0}if(!is_exist_passive&&0<this.m_gnrlInfo.trans_passive_skill.length){var trans_passive_id=this.m_gnrlInfo.trans_passive_skill[0];if(99999!=trans_passive_id&&0!=trans_passive_id){icon_passive_name="passive_"+(skill=m.get_TransPassiveSkill(trans_passive_id)).skill_icon+".png",icon_passive_tex=cc.spriteFrameCache.getSpriteFrame(icon_passive_name);icon.setSpriteFrame(icon_passive_tex),name.setString(skill.name),desc.setString(skill.content);line=SKILLLINECOUNT(skill,25);desc.setTextAreaSize(cc.size(winSize.width-100,45*line)),64<ccHeight(desc)?box_height+=ccHeight(desc)-64+45+30:box_height+=94}}bg_box.setContentSize(ccWidth(this),box_height),layer.setContentSize(ccSize(bg_box)),frame.setPosition(14,ccHeight(bg_box)-109-10-15);var circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_passive.png");circle_point.setAnchorPoint(cc.p(0,0)),circle_point.setPosition(17,ccHeight(bg_box)-28-15),circle_point.setScale(2),bg_box.addChild(circle_point);var title=cmLabel.getLabel("パッシブスキル",LABEL_FONT_INDEX.FONT_4543);if(title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(30,ccHeight(bg_box)-34-10-15),bg_box.addChild(title),(this.m_gnrlInfo.gnrl_type==GENERAL_TYPE_YUNHEE||this.m_gnrlInfo.gnrl_type==GENERAL_TYPE_JIN_YUNHEE)&&1==this.m_gnrlInfo.class_type){var gs=GeneralService.getInstance(),passive_id=gs.getNextClassTypePassiveId(this.m_gnrlInfo.evolution_group_num,this.m_gnrlInfo.class_type);if(0!=(skill=m.get_PassiveSkillV2(passive_id)).skill_icon&&null!=skill.skill_icon&&null!=skill.skill_icon){icon_passive_name="passive_"+skill.skill_icon+".png",icon_passive_tex=cc.spriteFrameCache.getSpriteFrame(icon_passive_name);icon.setSpriteFrame(icon_passive_tex)}if(name.setString(skill.name),name.setColor(COLOR(188)),desc.setString(skill.content),desc.setColor(COLOR(166)),99999==passive_id||0==passive_id){var skill;passive_id=gs.getNextClassTypeTransPassiveId(this.m_gnrlInfo.evolution_group_num,this.m_gnrlInfo.class_type);if(0!=(skill=m.get_TransPassiveSkill(passive_id)).skill_icon&&null!=skill.skill_icon&&null!=skill.skill_icon){icon_passive_name="passive_"+skill.skill_icon+".png",icon_passive_tex=cc.spriteFrameCache.getSpriteFrame(icon_passive_name);icon.setSpriteFrame(icon_passive_tex)}else{icon_passive_name="passive_0.png",icon_passive_tex=cc.spriteFrameCache.getSpriteFrame(icon_passive_name);icon.setSpriteFrame(icon_passive_tex)}name.setString(skill.name),name.setColor(COLOR(188)),desc.setString(skill.content),desc.setColor(COLOR(166))}var icon_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());icon_mask.setContentSize(60,60),icon_mask.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),icon_mask.setPosition(cc.p(0,0)),icon.addChild(icon_mask);var info_label=cmLabel.getLabel("(進化後、活性化されます。)",LABEL_FONT_INDEX.FONT_4011);info_label.setAnchorPoint(ZERO()),bg_box.addChild(info_label);line=SKILLLINECOUNT(skill,25);desc.setTextAreaSize(cc.size(winSize.width-100,45*line)),64<ccHeight(desc)?box_height+=ccHeight(desc)-64+45+30:box_height+=94,bg_box.setContentSize(ccWidth(this),box_height),layer.setContentSize(ccSize(bg_box)),frame.setPosition(14,ccHeight(bg_box)-109-10-15),circle_point.setPosition(17,ccHeight(bg_box)-28-15),title.setPosition(30,ccHeight(bg_box)-34-10-15),info_label.setPosition(title.x+ccWidth(title)+3,title.y)}name.setPosition(91,ccHeight(bg_box)-34-45-10-15),desc.setPosition(91,ccHeight(bg_box)-59-45-15);var back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(bg_box)-10-3,ccHeight(bg_box)-34+18+9),back_btn.addClickEventListener(function(sender){this.hidePassiveExplainPopup()}.bind(this)),bg_box.addChild(back_btn);var bg_clear_botton=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png");return bg_clear_botton.setAnchorPoint(ZERO()),bg_clear_botton.setPosition(ZERO()),bg_clear_botton.setContentSize(ccWidth(win_size),ccHeight(win_size)),bg_clear_botton.setScale9Enabled(!0),bg_clear_botton.addClickEventListener(function(sender){this.hidePassiveExplainPopup()}.bind(this)),layer.addChild(bg_clear_botton),layer},showSkillExplainPopup:function(){this.m_skillExplainPopup.setContentSize(ccSize(this)),this.m_skillExplainPopup._contentNode=function(contentSize,m){return cc.log("Active Skill Info Popup4"),this.getActiveSkillPopupLayer()}.bind(this),this.m_skillExplainPopup.show()},hideSkillExplainPopup:function(){this.m_skillExplainPopup.is_show()&&this.m_skillExplainPopup.hide()},getActiveSkillPopupLayer:function(){var win_size=cc.director.getWinSize(),layer=new cc.Layer,m=MasterManager.getInstance(),bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());bg_box.setAnchorPoint(ANCHOR_MIDDLE()),bg_box.setPosition(ccCenter(this)),layer.addChild(bg_box);var frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");frame.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bg_box.addChild(frame);var box_height=132,name=null,desc=null;if(0!=this.m_gnrlInfo.active_skill){var skill=m.get_ActiveSkill(this.m_gnrlInfo.active_skill),icon=cc.Sprite.create("#active_"+skill.skill_group+".png");icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(frame.width/2,frame.height/2),frame.addChild(icon),(name=cmLabel.getLabel(skill.name,LABEL_FONT_INDEX.FONT_4542)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bg_box.addChild(name);var line=SKILLLINECOUNT(skill,25);(desc=cmLabel.getLabel(skill.content,LABEL_FONT_INDEX.FONT_452)).setAnchorPoint(ANCHOR_TOP_LEFT()),desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),IS_SP_BROWSER,desc.setTextAreaSize(cc.size(winSize.width-100,45*line)),desc.ignoreContentAdaptWithSize(!1),bg_box.addChild(desc),64<ccHeight(desc)?box_height+=ccHeight(desc)-64+45+30:box_height+=94}bg_box.setContentSize(ccWidth(this),box_height),null!=desc&&desc.setPosition(91,ccHeight(bg_box)-59-45-15),layer.setContentSize(ccSize(bg_box)),frame.setPosition(14,ccHeight(bg_box)-109-10-15);var circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_active.png");circle_point.setAnchorPoint(ZERO()),circle_point.setPosition(17,ccHeight(bg_box)-28-15),circle_point.setScale(2),bg_box.addChild(circle_point);var title=cmLabel.getLabel("アクティブスキル",LABEL_FONT_INDEX.FONT_4541);title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(30,ccHeight(bg_box)-34-10-15),bg_box.addChild(title),name.setPosition(91,ccHeight(bg_box)-34-10-45-15);var bg_clear_botton=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png");bg_clear_botton.setAnchorPoint(ZERO()),bg_clear_botton.setPosition(ZERO()),bg_clear_botton.setContentSize(ccWidth(win_size),ccHeight(win_size)),bg_clear_botton.setScale9Enabled(!0),bg_clear_botton.addClickEventListener(function(sender){this.hideSkillExplainPopup()}.bind(this)),layer.addChild(bg_clear_botton);var back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);return back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(bg_box)-10-3,ccHeight(bg_box)-34+18+9),back_btn.addClickEventListener(function(sender){this.hideSkillExplainPopup()}.bind(this)),bg_box.addChild(back_btn),layer},showStandingDetailViewPopup:function(detail_gnrl){this.m_standing_view_modal_layer.setContentSize(ccSize(this)),this.m_standing_view_modal_layer._contentNode=function(contentSize,m){var layer=new cc.Layer,viewer=new YunheeStandingViewLayer(detail_gnrl,this.hideStandingDetailViewPopup.bind(this));return layer.addChild(viewer),layer.setContentSize(ccSize(viewer)),layer.setPosition(568,320),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),viewer.setPosition(ccCenter(layer)),layer}.bind(this),this.m_standing_view_modal_layer.is_show()&&this.m_standing_view_modal_layer.hide(),this.m_standing_view_modal_layer.show()},hideStandingDetailViewPopup:function(){this.m_standing_view_modal_layer.is_show()&&this.m_standing_view_modal_layer.hide()},showYunheeDetailPopup:function(){this.m_box.is_show()&&this.m_box.hide();for(var val=arguments,msg=[],i=1;i<val.length;i++)msg.push(val[i]);this.showMsgBox(val[0],msg),msg=null},showMaxClassTypeMsgBox:function(){this.m_box.setTitle(res_str("label_yunhee_evolution_impossible_title")),this.m_box.setText(res_str("label_yunhee_evolution_impossible_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_yunhee_evolution_impossible_text_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showIsNotPartnerInCamp:function(){this.m_box.setTitle(res_str("label_yunhee_partner_set_failed_title")),this.m_box.setText(res_str("label_not_levelup_in_camp_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_not_partner_set_in_camp_text_1")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showUsingInCampMsgBox:function(){this.m_box.setTitle(res_str("label_general_error_using_in_camp_title")),this.m_box.setText(res_str("label_general_error_using_in_camp_text1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_general_error_using_in_camp_text2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showMaterialNotSelectable:function(){this.m_box.setTitle(res_str("label_buy_goods_fail_title")),this.m_box.setText(res_str("label_material_not_selectable_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_material_not_selectable_text_2")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_material_not_selectable_text_3")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showMaxLevelBox:function(){this.m_box.is_show()&&this.m_box.hide(!1),this.m_box.setTitle(res_str("label_character_max_level_title")),this.m_box.setText(res_str("label_battle_formation_max_level_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_battle_formation_max_level_text_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showNotEnoughMaterial:function(){this.m_box.setTitle(res_str("label_craft_shop_not_enough_mtrl_title")),this.m_box.setText(res_str("label_craft_shop_not_enough_mtrl_text")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showNotEnoughLoveItem:function(){this.m_box.is_show()&&this.m_box.hide(!1),this.m_box.setTitle(res_str("label_common_information")),this.m_box.setText(res_str("label_not_enough_love_item_text")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showNotGeneralLockUsingInCamp:function(){this.m_box.is_show()&&this.m_box.hide(!1),this.m_box.setTitle(res_str("label_buy_goods_fail_title")),this.m_box.setText(res_str("label_using_in_camp_general_not_lock_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_using_in_camp_general_not_lock_text_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showIsMaxLimitStepMsgBox:function(){this.m_box.is_show()&&this.m_box.hide(!1),this.m_box.setTitle(res_str("label_not_limit_over_title")),this.m_box.setText(res_str("label_not_limit_over_text_4")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showNeedMaxEvolutionForCGMsgBox:function(){this.m_box.is_show()&&this.m_box.hide(!1),this.m_box.setTitle(res_str("label_yunhee_need_max_evolution_for_cg_title")),this.m_box.setText(res_str("label_yunhee_need_max_evolution_for_cg_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_yunhee_need_max_evolution_for_cg_text_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showYunheeInCampMsgBox:function(){this.m_box.is_show()&&this.m_box.hide(!1),this.m_box.setTitle(res_str("label_yunhee_caution_title")),this.m_box.setText(res_str("label_yunhee_in_camp_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_yunhee_in_camp_text_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showCompleteDeleteAllTroopsMsgBox:function(){this.m_box.is_show()&&this.m_box.hide(!1),this.m_box.setTitle(res_str("label_yunhee_all_troops_delete_general_title")),this.m_box.setText(res_str("label_yunhee_all_troops_delete_general_complete_text")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showNotFoundInTroopsMsgBox:function(){this.m_box.is_show()&&this.m_box.hide(!1),this.m_box.setTitle(res_str("label_yunhee_all_troops_delete_general_error_title")),this.m_box.setText(res_str("label_yunhee_not_found_in_troops_text")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showTooLowEvolutionClassMsgBox:function(){this.m_box.setTitle(res_str("label_change_yunhee_character_error")),this.m_box.setText(res_str("label_change_yunhee_character_error_text_1")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showWrongEvolutionClassMsgBox:function(){this.m_box.setTitle(res_str("label_change_yunhee_character_error")),this.m_box.setText(res_str("label_change_yunhee_character_error_text_2")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showLimitOverBeginPopup:function(){this.m_box.setTitle(res_str("label_yunhee_limit_over_begin_title")),this.m_box.setText(res_str("label_yunhee_limit_over_begin_text")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_yunheeDetailLayer.checkEnableLimitOver()?this.scheduleOnce(function(float){this.sendPacketLimitOver()}.bind(this),0,"sendPacketLimitOver"):this.scheduleOnce(function(float){USE_POPUP_INTERGRATION?this.showYunheeDetailPopup(res_str("label_craft_shop_not_enough_mtrl_title"),res_str("label_craft_shop_not_enough_mtrl_text")):this.showNotEnoughMaterial()}.bind(this),0,"showNotEnoughMaterial"),this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showLoveUpStart:function(){var key=this.m_yunheeDetailLayer.getLoveUpMaterialItemKey(),mt=MasterTable.getInstance().getMasterTable(),love=mt.get_LoveItem(key.love_id);this.m_ctbox.setTitle(res_str("btn_label_loveUp")),null!=key.gnrl_id&&0!=key.gnrl_id?this.m_ctbox.setText(mt.get_General(key.gnrl_id).name+" "+love.name+" "+key.count,LABEL_FONT_INDEX.FONT_262):this.m_ctbox.setText(love.name+" "+key.count,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("個で",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("好感度UPしますか。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_ctbox.hide(!1)}.bind(this))),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_ctbox.hide(!1),this.scheduleOnce(function(float){this.sendPacketLoveUp()}.bind(this),0,"sendPacketLoveUp")}.bind(this))),this.m_ctbox.show()},showEvolveBeginPopup:function(){this.m_box.is_show()&&this.m_box.hide(!1),this.m_box.setTitle(res_str("label_yunhhe_evolution")),this.m_box.setText(res_str("label_yunhee_evolution_begin_text")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.sendPacketEvolution(),this.m_box.hide()},0,"sendPacketEvolution")}.bind(this))),this.m_box.show()},showRebirthBeginPopup:function(){this.m_box.setTitle(res_str("label_yunhhe_rebirth")),this.m_box.setText(res_str("label_yunhee_rebirth_begin_text")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.sendPacketRebirth()}.bind(this),0,"sendPacketRebirth"),this.m_box.hide()}.bind(this))),this.m_box.show()},showEquipmentSlotOpen:function(){this.m_box.setTitle(res_str("label_equipment_slot_open_title")),this.m_box.setText(res_str("label_equipment_slot_open_text")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){19!=this.m_gnrlInfo.gnrl_group?(this.checkLoveMaxLevelShowCG(),this.m_box.hide()):this.m_box.is_show()&&this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showIsLockGeneral:function(){this.m_box.is_show()&&this.m_box.hide(!1),this.m_box.setTitle(res_str("label_yunhee_lock_title")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_yunhee_lock_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_yunhee_lock_text_2")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_yunhee_lock_text_3")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.sendPacketGeneralLock(),this.m_box.hide()}.bind(this))),this.m_box.show()},showIsUnlockGeneral:function(){this.m_box.is_show()&&this.m_box.hide(!1),this.m_box.setTitle(res_str("label_yunhee_lock_title")),this.m_box.setText(res_str("label_yunhee_unlock_text_1")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.sendPacketGeneralUnlock(),this.m_box.hide()}.bind(this))),this.m_box.show()},showYunheeLoveCGMsgBox:function(){this.m_box.is_show()&&this.m_box.hide(!1),this.m_box.setTitle(res_str("label_yunhee_need_max_evolution_for_cg_title")),this.m_box.setText(res_str("label_yunhee_love_see_confirm_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_yunhee_love_see_confirm_text_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,TUTORIAL_TAG_PAGE_4_LOVE_EVENT_CG_POPUP_CONFIRM,function(){this.m_box.hide(),this.showCheckLoveCG()}.bind(this))),this.m_box.show()},showNotLimitOverMsg:function(){this.m_ctbox.is_show()&&this.m_ctbox.hide(!1),this.m_ctbox.setTitle(res_str("label_not_limit_over_title")),this.m_ctbox.setText(res_str("label_not_limit_over_text_2"),LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(res_str("label_not_limit_over_text_3"),LABEL_FONT_INDEX.FONT_262),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_ctbox.hide()}.bind(this))),this.m_ctbox.show()},showDeleteAllTroopsMsgBox:function(){this.m_box.is_show()&&this.m_box.hide(!1),this.m_box.setTitle(res_str("label_yunhee_all_troops_delete_general_title")),this.m_box.setText(res_str("label_yunhee_all_troops_delete_general_text")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.sendPacketReleaseYunheeInTroops()}.bind(this))),this.m_box.show()},showLevelUpMtrlInSR:function(){this.m_box.is_show()&&this.m_box.hide(!1),this.m_ctbox.is_show()&&this.m_ctbox.hide(!1),this.m_ctbox.setTitle(res_str("label_yunhee_levelup")),this.m_ctbox.setText(res_str("label_yunhee_caution_in_SR_type"),LABEL_FONT_INDEX.FONT_2486),this.m_ctbox.setText("\n"),this.m_ctbox.setText(res_str("label_yunhee_caution_in_SR_type_2"),LABEL_FONT_INDEX.FONT_2486),this.m_ctbox.setText("\n"),this.m_ctbox.setText("　",LABEL_FONT_INDEX.FONT_241),this.m_ctbox.setText("\n"),this.m_ctbox.setText(res_str("label_yunhee_level_up_question"),LABEL_FONT_INDEX.FONT_241),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_yunheeDetailLayer.setLevelUpBtnEnable(!0),this.m_ctbox.hide()}.bind(this))),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.sendPacketLevelUp()},.1,"showLevelUpMtrlInSR"),this.m_ctbox.hide()}.bind(this))),this.m_ctbox.show()},showImpossibleRebirth:function(){this.m_ctbox.setTitle(res_str("label_shop_buy_jade_omission_title")),this.m_ctbox.setText(res_str("label_impossible_rebirth_text_1"),LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(res_str("label_impossible_rebirth_text_2"),LABEL_FONT_INDEX.FONT_262),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_ctbox.hide()}.bind(this))),this.m_ctbox.show()},showCompleteReleaseEquipmentMsgBox:function(){this.m_box.setTitle(res_str("label_equipment_takeoff_equipment_title")),this.m_box.setText(res_str("label_equipment_complete_takeoff_text_1")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunHeeDetailEnum.tab_yunhee_detail),this.m_box.hide()}.bind(this))),this.m_box.show()},showNeedLoveUpForEquipmentMsgBox:function(love_level){this.m_ctbox.setTitle(res_str("label_equipment")),this.m_ctbox.setText("この装備のスロットは、",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("恋姫の好感度が",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText(love_level,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("以上で開放されます。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_ctbox.hide()}.bind(this))),this.m_ctbox.show()}}),YunheeInfoEnum={btn_character_change:200,btn_yunhee_lock:201,btn_yunhee_unlock:202,btn_character_love_level:203,btn_yunhee_love_show:204,btn_release_in_troops:205,btn_show_help:206,btn_show_resistance_help:207,btn_equipment:208,btn_select_display:209,BTN_EQUIPMENT_PRIVATE:210,BTN_EQUIPMENT_ARMOR:211,BTN_EQUIPMENT_RING:212,BTN_EQUIPMENT_SHIELD:213,BTN_EQUIPMENT_JEWELRY:214,EQUIP_SHOW_HELP:215,BTN_STANDING_DETAIL_VIEW:216,MAX_GAUGE_VALUE:104},YunheeInfoLayer=cc.Layer.extend({m_isLock:!1,m_lockBtn:null,m_scrollContentLayer:null,m_info_btn:null,m_resistance_btn:null,m_pickup_btn:null,m_reward_buff_pickup_btn:null,m_resistanceLayer:null,m_title_label:null,m_scrollLayer:null,m_add_atk_value:0,m_add_def_value:0,m_add_hp_value:0,m_pickupScrollLayer:null,m_rewardBufPickupScrollLayer:null,m_event_dundeon_gnrl_buff:[],m_dungeon_reward_buf_generals:[],m_add_cri_prcnt:0,m_add_cri_dmg_prcnt:0,m_add_def_prcnt:0,m_add_def_decrease_prcnt:0,m_cg_on_off_btn:null,m_leftBottomLayer:null,m_rightBoxLayer:null,Pickup_list:[],m_voice_btn:null,m_voiceScrollLayer:null,m_is_voice_playing:!1,m_voice_playing_delta:0,ctor:function(){this._super()},isResistanceLayerEnabled:function(){return!(null==this.m_resistanceLayer||!this.m_resistanceLayer.isVisible())},setLockButton:function(isLock){isLock?(this.m_lockBtn.loadTextureNormal("btn_red_circle_lock_off.png",ccui.Widget.PLIST_TEXTURE),this.m_lockBtn.loadTexturePressed("btn_red_circle_lock_on.png",ccui.Widget.PLIST_TEXTURE)):(this.m_lockBtn.loadTextureNormal("btn_purple_circle_lock_off.png",ccui.Widget.PLIST_TEXTURE),this.m_lockBtn.loadTexturePressed("btn_purple_circle_lock_on.png",ccui.Widget.PLIST_TEXTURE)),this.m_isLock=isLock},initLayout:function(){this.checkAddAbilityValue(),null!=this.m_leftBottomLayer&&this.m_leftBottomLayer.removeFromParent(),null!=this.m_rightBoxLayer&&this.m_rightBoxLayer.removeFromParent(),this.m_leftBottomLayer=this.getLeftBottomLayer(),this.m_leftBottomLayer.setPosition(ZERO()),this.addChild(this.m_leftBottomLayer),this.m_rightBoxLayer=this.getRightBoxLayer(),this.m_rightBoxLayer.ignoreAnchorPointForPosition(!1),this.m_rightBoxLayer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_rightBoxLayer.setPosition(ccWidth(this),0),this.addChild(this.m_rightBoxLayer)},showSkillInfoPopupLayer:function(){cc.log("Active Skill Info Popup2"),this.getParent().showSkillInfoPopupLayer()},showPassiveInfoPopupLayer:function(){cc.log("Passive Skill Info Popup2"),this.getParent().showPassiveInfoPopupLayer()},showLeaderSkillInfoPopupLayer:function(){cc.log("Leader Skill Info Popup2"),this.getParent().showLeaderSkillInfoPopupLayer()},getLeftBottomLayer:function(){var layer=new cc.Layer;layer.setContentSize(this.width-478,320);var gnrl_name,name_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_namebox.png");name_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),name_box.setPosition(layer.width/2,0),layer.addChild(name_box),(gnrl_name=this.m_gnrlInfo.gnrl_type==GENERAL_TYPE_MATERIAL?cmLabel.getLabel(this.m_gnrlInfo.name,LABEL_FONT_INDEX.FONT_221):8<this.m_gnrlInfo.name.length?cmLabel.getLabel(this.m_gnrlInfo.name,LABEL_FONT_INDEX.FONT_161):cmLabel.getLabel(this.m_gnrlInfo.name,LABEL_FONT_INDEX.FONT_261)).setAnchorPoint(ANCHOR_MIDDLE()),gnrl_name.setPosition(ccCenter(name_box)),name_box.addChild(gnrl_name),cmLabel.autoSizeFit(gnrl_name,186,26);var rare_type_sprite=this.getRareTypeSprite();if(rare_type_sprite.setAnchorPoint(cc.p(.5,0)),rare_type_sprite.setPosition(layer.width/2,84),layer.addChild(rare_type_sprite),0<this.m_gnrlInfo.limit_step_id){var limit_step_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_ic_limit_"+this.m_gnrlInfo.limit_step_id+".png");limit_step_icon.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),limit_step_icon.setPosition(ccCenter(layer).x,178),layer.addChild(limit_step_icon)}var btn_y=9;if(this.m_lockBtn=new ccui.Button,this.m_isLock?this.m_lockBtn.loadTextures("btn_red_circle_lock_off.png","btn_red_circle_lock_on.png","",ccui.Widget.PLIST_TEXTURE):this.m_lockBtn.loadTextures("btn_purple_circle_lock_off.png","btn_purple_circle_lock_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_lockBtn.setAnchorPoint(ZERO()),this.m_lockBtn.setPosition(6,btn_y),layer.addChild(this.m_lockBtn),this.m_lockBtn.addClickEventListener(function(sender){this.m_isLock?MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeInfoEnum.btn_yunhee_unlock):MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeInfoEnum.btn_yunhee_lock)}.bind(this)),btn_y+=ccHeight(this.m_lockBtn)+10,this.m_gnrlInfo.gnrl_type!=GENERAL_TYPE_MATERIAL&&this.m_gnrlInfo.gnrl_type!=GENERAL_TYPE_EVOLVE_MATERIAL&&this.m_gnrlInfo.gnrl_type!=GENERAL_TYPE_LIMIT_OVER){var characterChangeBtn=new ccui.Button;characterChangeBtn.loadTextures("btn_purple_circle_change_off.png","btn_purple_circle_change_on.png","",ccui.Widget.PLIST_TEXTURE),characterChangeBtn.setAnchorPoint(ZERO()),characterChangeBtn.setPosition(6,btn_y),layer.addChild(characterChangeBtn),characterChangeBtn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeInfoEnum.btn_character_change)}),btn_y+=ccHeight(characterChangeBtn)+10;var releaseTroopsBtn=new ccui.Button;releaseTroopsBtn.loadTextures("btn_purple_circle_cancel_off.png","btn_purple_circle_cancel_on.png","",ccui.Widget.PLIST_TEXTURE),releaseTroopsBtn.setAnchorPoint(ZERO()),releaseTroopsBtn.setPosition(6,btn_y),layer.addChild(releaseTroopsBtn),releaseTroopsBtn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeInfoEnum.btn_release_in_troops)}),btn_y+=ccHeight(releaseTroopsBtn)+10;var partner_btn=new ccui.Button;partner_btn.loadTextures("btn_purple_circle_partner_off.png","btn_purple_circle_partner_on.png","",ccui.Widget.PLIST_TEXTURE),partner_btn.setAnchorPoint(ZERO()),partner_btn.setPosition(6,btn_y),partner_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],NOTIFY_MENU_PARTNER_MAIN_POPUP)}),layer.addChild(partner_btn),btn_y+=ccHeight(partner_btn)+10;var selectDisplayBtn=new ccui.Button;selectDisplayBtn.loadTextures("btn_purple_circle_body_off.png","btn_purple_circle_body_on.png","",ccui.Widget.PLIST_TEXTURE),selectDisplayBtn.setAnchorPoint(ZERO()),selectDisplayBtn.setPosition(6,btn_y),layer.addChild(selectDisplayBtn),selectDisplayBtn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeInfoEnum.btn_select_display)}),this.m_gnrlInfo.class_type<AVAIL_EVOLUTION_CLASS_TYPE_LIMIT&&(selectDisplayBtn.loadTextureNormal("btn_gray_circle_body_off.png",ccui.Widget.PLIST_TEXTURE),selectDisplayBtn.loadTexturePressed("btn_gray_circle_body_on.png",ccui.Widget.PLIST_TEXTURE),selectDisplayBtn.setEnabled(!1)),btn_y+=ccHeight(selectDisplayBtn)+10;var standingDisplayBtn=new ccui.Button;standingDisplayBtn.loadTextures("btn_purple_circle_zoom_off.png","btn_purple_circle_zoom_on.png","",ccui.Widget.PLIST_TEXTURE),standingDisplayBtn.setAnchorPoint(ZERO()),standingDisplayBtn.setPosition(6,btn_y),layer.addChild(standingDisplayBtn),standingDisplayBtn.addClickEventListener(function(sender){var detail_gnrl={};detail_gnrl.gnrl_id=this.m_gnrlInfo.gnrl_id,detail_gnrl.gnrl_num=this.m_gnrlInfo.gnrl_num,detail_gnrl.display_class=this.m_gnrlInfo.display_class,GameContext.getInstance().setDetailStandingGnrlId(detail_gnrl),MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeInfoEnum.BTN_STANDING_DETAIL_VIEW)}.bind(this)),btn_y=9,this.m_cg_on_off_btn=new ccui.Button,this.m_cg_on_off_btn.loadTextures("btn_purple_circle_cg_off.png","btn_purple_circle_cg_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_cg_on_off_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_cg_on_off_btn.setPosition(ccWidth(layer)-6,btn_y),layer.addChild(this.m_cg_on_off_btn),btn_y+=ccHeight(this.m_cg_on_off_btn)+10,this.m_cg_on_off_btn.addClickEventListener(function(target){var g=MasterManager.getInstance().get_General(this.m_gnrlInfo.gnrl_id);this.m_gnrlInfo.love_level==YUNHEE_MAX_LOVE_LEVEL&&99999!=g.love_cg_num&&(0<g.love_cg_num?(GameContext.getInstance().setLoveCgGnrlId(g.gnrl_id),MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeInfoEnum.btn_yunhee_love_show)):MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeInfoEnum.btn_character_love_level)),TutorialContextV2.getInstance().IsCompleteAllTutorial()?this.m_gnrlInfo.love_level==YUNHEE_MAX_LOVE_LEVEL&&99999!=g.love_cg_num&&(0<g.love_cg_num?(GameContext.getInstance().setLoveCgGnrlId(g.gnrl_id),MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeInfoEnum.btn_yunhee_love_show)):MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeInfoEnum.btn_character_love_level)):g.gnrl_id==TUTORIAL_DEFINE_YUNHEE&&(GameContext.getInstance().setLoveCgGnrlId(g.gnrl_id),MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeInfoEnum.btn_yunhee_love_show))}.bind(this)),this.m_gnrlInfo.gender_type!=GENDER_TYPE_M&&this.m_gnrlInfo.gnrl_type!=GENERAL_TYPE_SOLDIER||(this.m_cg_on_off_btn.loadTextureNormal("btn_purple_circle_cgman_off.png",ccui.Widget.PLIST_TEXTURE),this.m_cg_on_off_btn.loadTexturePressed("btn_purple_circle_cgman_on.png",ccui.Widget.PLIST_TEXTURE)),this.m_cg_on_off_btn.setTutorialTag(TUTORIAL_TAG_PAGE_4_LOVE_EVENT_CG_BTN);var g=MasterManager.getInstance().get_General(this.m_gnrlInfo.gnrl_id);(this.m_gnrlInfo.love_level<YUNHEE_MAX_LOVE_LEVEL||99999==g.love_cg_num)&&(this.m_cg_on_off_btn.loadTextureNormal("btn_gray_circle_cg_off.png",ccui.Widget.PLIST_TEXTURE),this.m_cg_on_off_btn.loadTexturePressed("btn_gray_circle_cg_on.png",ccui.Widget.PLIST_TEXTURE),this.m_gnrlInfo.gender_type!=GENDER_TYPE_M&&this.m_gnrlInfo.gnrl_type!=GENERAL_TYPE_SOLDIER||(this.m_cg_on_off_btn.loadTextureNormal("btn_gray_circle_cgman_off.png",ccui.Widget.PLIST_TEXTURE),this.m_cg_on_off_btn.loadTexturePressed("btn_gray_circle_cgman_on.png",ccui.Widget.PLIST_TEXTURE))),19==this.m_gnrlInfo.gnrl_group&&(this.m_cg_on_off_btn.loadTextureNormal("btn_gray_circle_cgman_off.png",ccui.Widget.PLIST_TEXTURE),this.m_cg_on_off_btn.loadTexturePressed("btn_gray_circle_cgman_on.png",ccui.Widget.PLIST_TEXTURE),this.m_cg_on_off_btn.setEnabled(!1)),453==this.m_gnrlInfo.gnrl_group&&(this.m_cg_on_off_btn.loadTextureNormal("btn_purple_circle_cgman_off.png",ccui.Widget.PLIST_TEXTURE),this.m_cg_on_off_btn.loadTexturePressed("btn_purple_circle_cgman_on.png",ccui.Widget.PLIST_TEXTURE),(this.m_gnrlInfo.love_level<YUNHEE_MAX_LOVE_LEVEL||99999==g.love_cg_num)&&(this.m_cg_on_off_btn.loadTextureNormal("btn_gray_circle_cgman_off.png",ccui.Widget.PLIST_TEXTURE),this.m_cg_on_off_btn.loadTexturePressed("btn_gray_circle_cgman_on.png",ccui.Widget.PLIST_TEXTURE))),this.equipmentBtn=new ccui.Button,this.equipmentBtn.loadTextures("btn_purple_circle_equip_off.png","btn_purple_circle_equip_on.png","",ccui.Widget.PLIST_TEXTURE),this.equipmentBtn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.equipmentBtn.setPosition(ccWidth(layer)-6,btn_y),layer.addChild(this.equipmentBtn),this.equipmentBtn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeInfoEnum.btn_equipment)}),btn_y+=ccHeight(this.equipmentBtn)+10}return layer},getRightBoxLayer:function(){var layer=new cc.Layer,right_bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));right_bg_box.setContentSize(478,568),right_bg_box.setAnchorPoint(ZERO()),right_bg_box.setPosition(ZERO()),layer.addChild(right_bg_box),layer.setContentSize(right_bg_box.getContentSize());var pos_y=ccHeight(right_bg_box)-33;if(this.m_gnrlInfo.gnrl_type!=GENERAL_TYPE_EVOLVE_MATERIAL&&this.m_gnrlInfo.gnrl_type!=GENERAL_TYPE_MATERIAL&&this.m_gnrlInfo.gnrl_type!=GENERAL_TYPE_LIMIT_OVER){this.m_info_btn=new LabelButton("btn_09_none.png","btn_10_on.png","btn_10_off.png",ccui.Widget.PLIST_TEXTURE),this.m_info_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_info_btn.setFont(LABEL_FONT_INDEX.FONT_221),this.m_info_btn.setString("情報"),this.m_info_btn.setPosition(cc.p(5,pos_y)),right_bg_box.addChild(this.m_info_btn),this.m_info_btn.setEnabled(!1),this.m_info_btn.addClickEventListener(function(){this.m_resistance_btn.setEnabled(!0),this.m_info_btn.setEnabled(!1),1==USE_YUNHEE_DETAIL_VOICE&&(this.m_voice_btn.setEnabled(!0),this.m_voiceScrollLayer.setVisible(!1)),null!=this.m_pickup_btn&&null!=this.m_pickup_btn&&(this.m_pickup_btn.setEnabled(!0),this.m_pickupScrollLayer.setVisible(!1)),null!=this.m_reward_buff_pickup_btn&&null!=this.m_reward_buff_pickup_btn&&(this.m_reward_buff_pickup_btn.setEnabled(!0),this.m_rewardBufPickupScrollLayer.setVisible(!1)),this.m_scrollLayer.setVisible(!0),this.m_scrollLayer.setContentOffset(OffsetType.jumpToTop),this.m_resistanceLayer.setVisible(!1),this.m_title_label.setString("情報")}.bind(this)),pos_y-=70,this.m_resistance_btn=new LabelButton("btn_09_none.png","btn_10_on.png","btn_10_off.png",ccui.Widget.PLIST_TEXTURE),this.m_resistance_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_resistance_btn.setFont(LABEL_FONT_INDEX.FONT_221),this.m_resistance_btn.setString("耐性"),this.m_resistance_btn.setPosition(cc.p(5,pos_y)),right_bg_box.addChild(this.m_resistance_btn),this.m_resistance_btn.addClickEventListener(function(){this.m_resistance_btn.setEnabled(!1),this.m_info_btn.setEnabled(!0),1==USE_YUNHEE_DETAIL_VOICE&&(this.m_voice_btn.setEnabled(!0),this.m_voiceScrollLayer.setVisible(!1)),null!=this.m_pickup_btn&&null!=this.m_pickup_btn&&(this.m_pickup_btn.setEnabled(!0),this.m_pickupScrollLayer.setVisible(!1)),null!=this.m_reward_buff_pickup_btn&&null!=this.m_reward_buff_pickup_btn&&(this.m_reward_buff_pickup_btn.setEnabled(!0),this.m_rewardBufPickupScrollLayer.setVisible(!1)),this.m_scrollLayer.setVisible(!1),this.m_resistanceLayer.setVisible(!0),this.m_title_label.setString("耐性")}.bind(this)),pos_y-=70,1==USE_YUNHEE_DETAIL_VOICE&&(this.m_voice_btn=new LabelButton("btn_09_none.png","btn_10_on.png","btn_10_off.png",ccui.Widget.PLIST_TEXTURE),this.m_voice_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_voice_btn.setFont(LABEL_FONT_INDEX.FONT_161),this.m_voice_btn.setString(res_str("btn_label_voice")),this.m_voice_btn.setPosition(5,pos_y),right_bg_box.addChild(this.m_voice_btn),this.m_voice_btn.addClickEventListener(function(sender){this.m_resistance_btn.setEnabled(!0),this.m_info_btn.setEnabled(!0),this.m_voice_btn.setEnabled(!1),null!=this.m_pickup_btn&&null!=this.m_pickup_btn&&(this.m_pickup_btn.setEnabled(!0),this.m_pickupScrollLayer.setVisible(!1)),null!=this.m_reward_buff_pickup_btn&&null!=this.m_reward_buff_pickup_btn&&(this.m_reward_buff_pickup_btn.setEnabled(!0),this.m_rewardBufPickupScrollLayer.setVisible(!1)),this.m_scrollLayer.setVisible(!1),this.m_resistanceLayer.setVisible(!1),this.m_voiceScrollLayer.setVisible(!0),this.m_title_label.setString(res_str("voice_list_title"))}.bind(this)),this.m_voiceScrollLayer=this.getVoiceListLayer(),this.m_voiceScrollLayer.setPosition(17,84),this.m_voiceScrollLayer.setVisible(!1),right_bg_box.addChild(this.m_voiceScrollLayer),pos_y-=70);var m=MasterTable.getInstance(),event_dungeon_ids=[],event_priod=NetService()._event_dungeon_open_period_info.event_dungeon_open_period;for(var p in event_priod){if(null==event_priod[p].event_dungeon_period_idx)break;var event_dungeon_list=m.get_EventDungeonList(event_priod[p].event_dungeon_period_idx);for(var d in event_dungeon_list){if(null==event_dungeon_list[d].on_off)break;"y"==event_dungeon_list[d].on_off&&event_dungeon_ids.push(event_dungeon_list[d].event_dungeon_idx)}}this.m_event_dundeon_gnrl_buff=MasterTable.getInstance().get_EventDungeonGeneralBuf(this.m_gnrlInfo.gnrl_group,event_dungeon_ids);var service=EventDungeonService.getInstance();if(0<this.m_event_dundeon_gnrl_buff.length){for(var is_open=!1,buff_index=[],buff_idx=0;buff_idx<this.m_event_dundeon_gnrl_buff.length;buff_idx++)service.IsOpenEventDungeonBuff(this.m_event_dundeon_gnrl_buff[buff_idx].buff_period_idx)||buff_index.push(buff_idx);for(buff_idx=buff_index.length-1;0<=buff_idx;buff_idx--)this.m_event_dundeon_gnrl_buff.erase(buff_index[buff_idx]);if(0<this.m_event_dundeon_gnrl_buff.length){var buff_period_idx=this.m_event_dundeon_gnrl_buff[0].buff_period_idx;is_open=service.IsOpenEventDungeonBuff(buff_period_idx)}is_open&&(this.m_pickup_btn=new ccui.Button,this.m_pickup_btn.loadTextures("btn_pickup_none.png","btn_pickup_on.png","btn_pickup_off.png",ccui.Widget.PLIST_TEXTURE),this.m_pickup_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_pickup_btn.setPosition(5,pos_y),right_bg_box.addChild(this.m_pickup_btn),this.m_pickup_btn.addClickEventListener(function(sender){this.m_resistance_btn.setEnabled(!0),this.m_info_btn.setEnabled(!0),this.m_pickup_btn.setEnabled(!1),1==USE_YUNHEE_DETAIL_VOICE&&(this.m_voice_btn.setEnabled(!0),this.m_voiceScrollLayer.setVisible(!1)),null!=this.m_reward_buff_pickup_btn&&null!=this.m_reward_buff_pickup_btn&&(this.m_reward_buff_pickup_btn.setEnabled(!0),this.m_rewardBufPickupScrollLayer.setVisible(!1)),this.m_scrollLayer.setVisible(!1),this.m_resistanceLayer.setVisible(!1),this.m_pickupScrollLayer.setVisible(!0),this.m_title_label.setString(res_str("btn_label_pickup"))}.bind(this)),this.m_pickupScrollLayer=this.getPickupListLayer(),this.m_pickupScrollLayer.setPosition(17,84),this.m_pickupScrollLayer.setVisible(!1),right_bg_box.addChild(this.m_pickupScrollLayer),pos_y-=70)}if(this.m_dungeon_reward_buf_generals=MasterTable.getInstance().get_DungeonRewardBufGeneral(this.m_gnrlInfo.gnrl_group,event_dungeon_ids),0<this.m_dungeon_reward_buf_generals.length){is_open=!1;for(var buff_index2=[],buff_idx2=0;buff_idx2<this.m_dungeon_reward_buf_generals.length;buff_idx2++)service.IsOpenEventDungeonBuff(this.m_dungeon_reward_buf_generals[buff_idx2].buff_period_idx)||buff_index2.push(buff_idx2);for(buff_idx2=buff_index2.length-1;0<=buff_idx2;buff_idx2--)this.m_dungeon_reward_buf_generals.erase(buff_index2[buff_idx2]);if(0<this.m_dungeon_reward_buf_generals.length){buff_period_idx=this.m_dungeon_reward_buf_generals[0].buff_period_idx;is_open=service.IsOpenEventDungeonBuff(buff_period_idx)}is_open&&(this.m_reward_buff_pickup_btn=new ccui.Button,this.m_reward_buff_pickup_btn.loadTextures("btn_pickup_2_none.png","btn_pickup_2_on.png","btn_pickup_2_off.png",ccui.Widget.PLIST_TEXTURE),this.m_reward_buff_pickup_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_reward_buff_pickup_btn.setPosition(5,pos_y),right_bg_box.addChild(this.m_reward_buff_pickup_btn),this.m_reward_buff_pickup_btn.addClickEventListener(function(sender){this.m_resistance_btn.setEnabled(!0),this.m_info_btn.setEnabled(!0),this.m_reward_buff_pickup_btn.setEnabled(!1),1==USE_YUNHEE_DETAIL_VOICE&&(this.m_voice_btn.setEnabled(!0),this.m_voiceScrollLayer.setVisible(!1)),this.m_pickup_btn&&(this.m_pickup_btn.setEnabled(!0),this.m_pickupScrollLayer.setVisible(!1)),this.m_scrollLayer.setVisible(!1),this.m_resistanceLayer.setVisible(!1),this.m_rewardBufPickupScrollLayer.setVisible(!0),this.m_title_label.setString(res_str("btn_label_pickup"))}.bind(this)),this.m_rewardBufPickupScrollLayer=this.getRewardBufPickupListLayer(),this.m_rewardBufPickupScrollLayer.setPosition(17,84),this.m_rewardBufPickupScrollLayer.setVisible(!1),right_bg_box.addChild(this.m_rewardBufPickupScrollLayer),pos_y-=70)}}var left_navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");left_navi.setAnchorPoint(cc.p(0,0)),left_navi.setPosition(8,509),right_bg_box.addChild(left_navi),this.m_title_label=cmLabel.getLabel("情報",LABEL_FONT_INDEX.FONT_261),this.m_title_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_title_label.setPosition(cc.pAdd(ccCenter(left_navi),cc.p(0,3))),left_navi.addChild(this.m_title_label);var help_btn=new ccui.Button;return help_btn.loadTextures("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE),help_btn.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),help_btn.setPosition(416,ccCenter(left_navi).y+4),left_navi.addChild(help_btn),help_btn.addClickEventListener(function(sender){this.scheduleOnce(function(){MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeInfoEnum.btn_show_help)},0,"btn_show_help")}.bind(this)),this.m_scrollLayer=new ScrollLayer,this.m_gnrlInfo.gnrl_type==GENERAL_TYPE_MATERIAL||this.m_gnrlInfo.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL||this.m_gnrlInfo.gnrl_type==GENERAL_TYPE_LIMIT_OVER?(this.m_scrollLayer.setContentSize(447,493),this.m_scrollLayer.setPosition(17,14)):(this.m_scrollLayer.setContentSize(447,423),this.m_scrollLayer.setPosition(17,84)),this.m_scrollLayer.getItemNode=function(contentSize,m){return this.m_scrollContentLayer=this.getDetailContentLayer(this.m_scrollLayer.getContentSize().height),this.m_scrollContentLayer}.bind(this),right_bg_box.addChild(this.m_scrollLayer),TutorialContextV2.getInstance().IsCompleteAllTutorial()?this.m_scrollLayer.initLayout():this.scheduleOnce(function(float){this.m_scrollLayer.initLayout()},.3,"battle_begin"),this.m_resistanceLayer=this.getResistanceLayer(),this.m_resistanceLayer.ignoreAnchorPointForPosition(!1),this.m_resistanceLayer.setAnchorPoint(cc.p(.5,1)),this.m_resistanceLayer.setPosition(right_bg_box.width/2,right_bg_box.height-61),right_bg_box.addChild(this.m_resistanceLayer),this.m_resistanceLayer.setVisible(!1),layer},getRewardBufPickupListLayer:function(){this.m_dungeon_reward_buf_generals.sort(function(l,r){return l.dungeon_idx<r.dungeon_idx?1:l.dungeon_idx>r.dungeon_idx?-1:0});var map_event_buff=new Map_VectorEx;for(var b in this.m_dungeon_reward_buf_generals){var buff=this.m_dungeon_reward_buf_generals[b];0!=buff.on_off&&map_event_buff.insert(buff.dungeon_idx,buff)}var listLayer=new ScrollLayer;return listLayer.setContentSize(447,423),listLayer.getItemNode=function(contentSize,m){for(var height=0,scrollLayer=new cc.Layer,keys=map_event_buff.keys(),idx=keys.length-1;0<=idx;idx--)map_event_buff.at(keys[idx]).sort(function(l,r){return l.bonus_type<r.bonus_type?1:l.bonus_type>r.bonus_type?-1:0});for(idx=keys.length-1;0<=idx;idx--){var layer=this.getPickupRewardBufContentLayer(map_event_buff.at(keys[idx]));layer.setPosition(0,height),scrollLayer.addChild(layer),height+=ccHeight(layer)}if(scrollLayer.setContentSize(444,height),height<423){var y=423-height;scrollLayer.setPosition(0,y)}return scrollLayer}.bind(this),listLayer.initLayout(),listLayer},setGeneralInfo:function(info){this.m_gnrlInfo=info,this.m_isLock=this.m_gnrlInfo.is_lock,this.m_gnrlKey={gnrl_id:0,gnrl_num:0},this.m_gnrlKey.gnrl_id=info.gnrl_id,this.m_gnrlKey.gnrl_num=info.gnrl_num},setReloadData:function(info){this.m_gnrlInfo=info,this.m_add_atk_value=0,this.m_add_def_value=0,this.m_add_hp_value=0,this.m_add_cri_prcnt=0,this.m_add_cri_dmg_prcnt=0,this.m_add_def_prcnt=0,this.m_add_def_decrease_prcnt=0,this.m_isLock=this.m_gnrlInfo.is_lock,this.initLayout()},checkAddAbilityValue:function(){var mt=MasterManager.getInstance(),g=MasterManager.getInstance().get_General(this.m_gnrlInfo.gnrl_id),loveStat=MasterTable.getInstance().get_LoveStatItem(g.love_stat_group,this.m_gnrlInfo.love_level);loveStat.stat_type_1==LOVE_STAT_TYPE_ATTK_PRCNT&&(this.m_add_atk_value+=Math.floor(this.m_gnrlInfo.attk*(loveStat.value_1/100))),loveStat.stat_type_2==LOVE_STAT_TYPE_ATTK_PRCNT&&(this.m_add_atk_value+=Math.floor(this.m_gnrlInfo.attk*(loveStat.value_2/100))),loveStat.stat_type_3==LOVE_STAT_TYPE_ATTK_PRCNT&&(this.m_add_atk_value+=Math.floor(this.m_gnrlInfo.attk*(loveStat.value_3/100))),loveStat.stat_type_1==LOVE_STAT_TYPE_ATTK_INC&&(this.m_add_atk_value+=loveStat.value_1),loveStat.stat_type_2==LOVE_STAT_TYPE_ATTK_INC&&(this.m_add_atk_value+=loveStat.value_2),loveStat.stat_type_2==LOVE_STAT_TYPE_ATTK_INC&&(this.m_add_atk_value+=loveStat.value_3),loveStat.stat_type_1==LOVE_STAT_TYPE_DEF_PRCNT&&(this.m_add_def_value+=Math.floor(this.m_gnrlInfo.def*(loveStat.value_1/100))),loveStat.stat_type_2==LOVE_STAT_TYPE_DEF_PRCNT&&(this.m_add_def_value+=Math.floor(this.m_gnrlInfo.def*(loveStat.value_2/100))),loveStat.stat_type_3==LOVE_STAT_TYPE_DEF_PRCNT&&(this.m_add_def_value+=Math.floor(this.m_gnrlInfo.def*(loveStat.value_3/100))),loveStat.stat_type_1==LOVE_STAT_TYPE_DEF_INC&&(this.m_add_def_value+=loveStat.value_1),loveStat.stat_type_2==LOVE_STAT_TYPE_DEF_INC&&(this.m_add_def_value+=loveStat.value_2),loveStat.stat_type_3==LOVE_STAT_TYPE_DEF_INC&&(this.m_add_def_value+=loveStat.value_3),loveStat.stat_type_1==LOVE_STAT_TYPE_HP_PRCNT&&(this.m_add_hp_value+=Math.floor(this.m_gnrlInfo.hp*(loveStat.value_1/100))),loveStat.stat_type_2==LOVE_STAT_TYPE_HP_PRCNT&&(this.m_add_hp_value+=Math.floor(this.m_gnrlInfo.hp*(loveStat.value_2/100))),loveStat.stat_type_3==LOVE_STAT_TYPE_HP_PRCNT&&(this.m_add_hp_value+=Math.floor(this.m_gnrlInfo.hp*(loveStat.value_3/100))),loveStat.stat_type_1==LOVE_STAT_TYPE_HP_INC&&(this.m_add_hp_value+=loveStat.value_1),loveStat.stat_type_2==LOVE_STAT_TYPE_HP_INC&&(this.m_add_hp_value+=loveStat.value_2),loveStat.stat_type_3==LOVE_STAT_TYPE_HP_INC&&(this.m_add_hp_value+=loveStat.value_3);var user_branch_ability=CampService.getInstance().getUserCampBranchAbility(this.m_gnrlInfo.arm_service_type);1==CAMP_LOVE_STAT_TYPE?(this.m_add_atk_value+=Math.floor(this.m_gnrlInfo.attk*(user_branch_ability.attack/1e4)),this.m_add_def_value+=Math.floor(this.m_gnrlInfo.def*(user_branch_ability.defense/1e4)),this.m_add_hp_value+=Math.floor(this.m_gnrlInfo.hp*(user_branch_ability.health/1e4))):(this.m_add_atk_value+=user_branch_ability.attack,this.m_add_def_value+=user_branch_ability.defense,this.m_add_hp_value+=user_branch_ability.health);for(var set_effect_info=new Map,es=EquipmentService.getInstance(),equip_info_list=es.getUserGeneralEquipmentListInfo(this.m_gnrlKey),idx=0;idx<equip_info_list.length;idx++){var equip=equip_info_list[idx],equip_key={},user_equip_info={};equip_key.equipment_item_idx=equip.equip_id,equip_key.equipment_num=equip.equip_num,es.getUserEquipmentInfo(equip_key,user_equip_info,this.m_gnrlKey),this.addComboStatValueForEquipment(user_equip_info.combo_stat,user_equip_info.stat_value);var equip_option_info=mt.get_EquipmentItemOption(user_equip_info.option_id1,user_equip_info.option_num1);if(0==equip_option_info.wear_element_type||this.m_gnrlInfo.element_type==equip_option_info.wear_element_type){var equip_option_level_info=mt.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);this.addComboStatValueForEquipment(equip_option_level_info.combo_stat,equip_option_level_info.stat_value),this.addComboStatValueForEquipment(equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2)}if(0==(equip_option_info=mt.get_EquipmentItemOption(user_equip_info.option_id2,user_equip_info.option_num2)).wear_element_type||this.m_gnrlInfo.element_type==equip_option_info.wear_element_type){equip_option_level_info=mt.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);this.addComboStatValueForEquipment(equip_option_level_info.combo_stat,equip_option_level_info.stat_value),this.addComboStatValueForEquipment(equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2)}if(0==(equip_option_info=mt.get_EquipmentItemOption(user_equip_info.option_id3,user_equip_info.option_num3)).wear_element_type||this.m_gnrlInfo.element_type==equip_option_info.wear_element_type){equip_option_level_info=mt.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);this.addComboStatValueForEquipment(equip_option_level_info.combo_stat,equip_option_level_info.stat_value),this.addComboStatValueForEquipment(equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2)}if(0==(equip_option_info=mt.get_EquipmentItemOption(user_equip_info.option_id4,user_equip_info.option_num4)).wear_element_type||this.m_gnrlInfo.element_type==equip_option_info.wear_element_type){equip_option_level_info=mt.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);this.addComboStatValueForEquipment(equip_option_level_info.combo_stat,equip_option_level_info.stat_value),this.addComboStatValueForEquipment(equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2)}if(0==(equip_option_info=mt.get_EquipmentItemOption(user_equip_info.option_id5,user_equip_info.option_num5)).wear_element_type||this.m_gnrlInfo.element_type==equip_option_info.wear_element_type){equip_option_level_info=mt.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);this.addComboStatValueForEquipment(equip_option_level_info.combo_stat,equip_option_level_info.stat_value),this.addComboStatValueForEquipment(equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2)}if(0<user_equip_info.equip_group)null==(set_count=set_effect_info.at(user_equip_info.equip_group))&&(set_count={count:0},set_effect_info.insert(user_equip_info.equip_group,set_count)),set_effect_info.insert(user_equip_info.equip_group,set_count),set_count.count=set_count.count+1}var keys=set_effect_info.keys();for(idx=0;idx<keys.length;idx++)for(var mt_set_effect={equip_count:0},set_count=set_effect_info.at(keys[idx]).count;null==(mt_set_effect=MasterManager.getInstance().get_EquipmentGroup(parseInt(keys[idx]),set_count)).equip_count&&(mt_set_effect={equip_count:0,combo_stat:0,added_value:0}),this.addComboStatValueForEquipment(mt_set_effect.combo_stat,mt_set_effect.added_value),0==mt_set_effect.equip_count&&0<set_count--;);},addComboStatValueForEquipment:function(combo_stat_type,stat_value){if(9!=combo_stat_type&&10!=combo_stat_type)switch(combo_stat_type){case COMBO_STAT_ATTK_PLUS:this.m_add_atk_value+=stat_value;break;case COMBO_STAT_ATTK:this.m_add_atk_value+=Math.floor(this.m_gnrlInfo.attk*(stat_value/1e4));break;case COMBO_STAT_DEF_PLUS:this.m_add_def_value+=stat_value;break;case COMBO_STAT_DEF:this.m_add_def_value+=Math.floor(this.m_gnrlInfo.def*(stat_value/1e4));break;case COMBO_STAT_HP_PLUS:this.m_add_hp_value+=stat_value;break;case COMBO_STAT_HP:this.m_add_hp_value+=Math.floor(this.m_gnrlInfo.hp*(stat_value/1e4));break;case COMBO_STAT_CRI_PRCNT:this.m_add_cri_prcnt+=Math.floor(stat_value/100);break;case COMBO_STAT_CRI_DMG:this.m_add_cri_dmg_prcnt+=Math.floor(stat_value/100);break;case COMBO_STAT_GUARD_PRCNT:this.m_add_def_prcnt+=Math.floor(stat_value/100);break;case COMBO_STAT_GUARD_DECREASE:this.m_add_def_decrease_prcnt+=Math.floor(stat_value/100)}},getResistanceLayer:function(){var m=MasterManager.getInstance(),layer=new cc.Layer,bg_box=new cc.Scale9Sprite(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",cc.Rect(20,20,20,20));bg_box.setContentSize(444,362),bg_box.setAnchorPoint(cc.p(0,0)),bg_box.setPosition(cc.p(0,0)),layer.addChild(bg_box);var tableLayer=this.getTableLayer();tableLayer.setEnableMouseScroll(!1),tableLayer.setPosition(5,20),layer.addChild(tableLayer),layer.setContentSize(cc.size(bg_box.width,bg_box.height));var btn=new LabelButton("btn_21_off.png","btn_21_on.png","",ccui.Widget.PLIST_TEXTURE);return btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),btn.setFont(LABEL_FONT_INDEX.FONT_221),btn.setString(m.get_LanguageData("btn_label_resistance_info")),btn.setPosition(cc.p(bg_box.width,0)),bg_box.addChild(btn),btn.addClickEventListener(function(){MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeInfoEnum.btn_show_resistance_help)}),layer},getTableLayer:function(){var tableLayer=new TableViewLayer;tableLayer.setAnchorPoint(cc.p(0,0)),tableLayer.setContentSize(434,324),tableLayer.setItemCount(8),tableLayer.setColumnCount(1);return tableLayer.getItemNode=function(index,contentSize,margin){return new YunheeResistanceItemLayer(index,this.m_gnrlInfo.gnrl_id)}.bind(this),tableLayer.initLayout(),tableLayer.setTouchScrollEnabled(!1),tableLayer.onItemTouchBegin=function(index){return!0},tableLayer.onItemTouchMoved=function(index){return!0},tableLayer.onItemTouchEnd=function(index){return!0},tableLayer.onMouseScroll=function(){return!0},tableLayer},getDetailContentLayer:function(scroll_height){var layer=new cc.Layer,offset_y=0;if(this.m_gnrlInfo.gnrl_type==GENERAL_TYPE_MATERIAL||this.m_gnrlInfo.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL||this.m_gnrlInfo.gnrl_type==GENERAL_TYPE_LIMIT_OVER){var matGainLayer=this.getMaterialGainPlaceInfoLayer();matGainLayer.setPosition(0,offset_y),layer.addChild(matGainLayer),offset_y+=ccHeight(matGainLayer);var matLayer=this.getMaterialInfoLayer();if(matLayer.setPosition(0,offset_y),layer.addChild(matLayer),offset_y+=ccHeight(matLayer),(statLayer=this.getStatLayer()).setPosition(0,offset_y),layer.addChild(statLayer),offset_y+=ccHeight(statLayer),(levelGaugeLayer=this.getLevelGaugeLayer()).setPosition(0,offset_y),layer.addChild(levelGaugeLayer),offset_y+=ccHeight(levelGaugeLayer),layer.setContentSize(ccWidth(statLayer),offset_y),offset_y<scroll_height){var y=scroll_height-offset_y;layer.setPosition(0,y)}}else{var voiceActorLayer=this.getVoiceActorLayer();voiceActorLayer.setPosition(ZERO()),layer.addChild(voiceActorLayer),offset_y+=ccHeight(voiceActorLayer);var loveContentLayer=this.getLoveContentLayer();null!=loveContentLayer&&(loveContentLayer.setPosition(0,offset_y),layer.addChild(loveContentLayer),offset_y+=ccHeight(loveContentLayer));var loveLayer=this.getLoveLayer();loveLayer.setPosition(0,offset_y),layer.addChild(loveLayer),offset_y+=ccHeight(loveLayer);var leaderSkillLayer=this.getLeaderSkillLayer();leaderSkillLayer.setPosition(0,offset_y),layer.addChild(leaderSkillLayer),offset_y+=ccHeight(leaderSkillLayer);var passiveSkillLayer=this.getPassiveSkillLayer();passiveSkillLayer.setPosition(0,offset_y),layer.addChild(passiveSkillLayer),offset_y+=ccHeight(passiveSkillLayer);var statLayer,activeSkillLayer=this.getActiveSkillLayer();activeSkillLayer.setPosition(0,offset_y),layer.addChild(activeSkillLayer),offset_y+=ccHeight(activeSkillLayer),(statLayer=this.getStatLayer()).setPosition(0,offset_y),layer.addChild(statLayer),offset_y+=ccHeight(statLayer);var levelGaugeLayer,equipmentLayer=this.getGeneralEquipLayer();if(equipmentLayer.setPosition(0,offset_y),layer.addChild(equipmentLayer),offset_y+=ccHeight(equipmentLayer),(levelGaugeLayer=this.getLevelGaugeLayer()).setPosition(0,offset_y),layer.addChild(levelGaugeLayer),offset_y+=ccHeight(levelGaugeLayer),layer.setContentSize(ccWidth(statLayer),offset_y),offset_y<scroll_height){y=scroll_height-offset_y;layer.setPosition(0,y)}}return layer},getMaterialGainPlaceInfoLayer:function(){var layer=new cc.Layer,info_box=new cc.Scale9Sprite(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());info_box.setContentSize(444,89),info_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),info_box.setPosition(ZERO()),layer.addChild(info_box);var gain_place=MasterTable.getInstance().get_MaterialGainPlace(this.m_gnrlInfo.gnrl_id),title_label=cmLabel.getLabel("獲得方法",LABEL_FONT_INDEX.FONT_1812);title_label.setAnchorPoint(ZERO()),title_label.setPosition(20,58),info_box.addChild(title_label);var label=cmLabel.getLabel(gain_place,LABEL_FONT_INDEX.FONT_144);return label.setAnchorPoint(ZERO()),label.setPosition(20,18),info_box.addChild(label),layer.setContentSize(ccSize(info_box)),layer},getMaterialInfoLayer:function(){var layer=new cc.Layer,m=MasterManager.getInstance(),info_box=new cc.Scale9Sprite(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());info_box.setContentSize(444,108),info_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),info_box.setPosition(ZERO()),layer.addChild(info_box);var frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");if(frame.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),frame.setPosition(14,21),info_box.addChild(frame),0!=this.m_gnrlInfo.active_skill){var icon,skill=m.get_ActiveSkill(this.m_gnrlInfo.active_skill);if(USE_ACTIVE_PASSIVE_ICON)(icon=cc.Sprite.create(RES_CDN_DEFULT+"icon/active/active_"+skill.skill_group+".png")).setContentSize(60,60),icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(frame)),frame.addChild(icon);else(icon=cc.Sprite.create("#active_"+skill.skill_group+".png")).setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(frame)),frame.addChild(icon);ccSize(frame);var name=cmLabel.getLabel(skill.name,LABEL_FONT_INDEX.FONT_1812);name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),name.setPosition(91,72),layer.addChild(name);var line=SKILLLINECOUNT(skill,27),desc=cmLabel.getLabel(skill.content,LABEL_FONT_INDEX.FONT_144);desc.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),IS_SP_BROWSER?desc.setTextAreaSize(cc.size(340,18*line)):desc.setTextAreaSize(cc.size(340,17*line)),desc.ignoreContentAdaptWithSize(!1),desc.setPosition(91,30),layer.addChild(desc)}return layer.setContentSize(ccSize(info_box)),layer},getVoiceActorLayer:function(){var layer=new cc.Layer,info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());info_box.setContentSize(444,76),info_box.setAnchorPoint(cc.p(0,0)),info_box.setPosition(cc.p(0,0)),layer.addChild(info_box);var cv_title=cmLabel.getLabel("CV ",LABEL_FONT_INDEX.FONT_201);cv_title.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),cv_title.setPosition(26,ccCenter(info_box).y),info_box.addChild(cv_title);var actor=MasterManager.getInstance().get_VoiceActor(this.m_gnrlInfo.gnrl_id),actor_label=cmLabel.getLabel(actor.name,LABEL_FONT_INDEX.FONT_201);return actor_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),actor_label.setPosition(cv_title.x+ccWidth(cv_title)+5,ccCenter(info_box).y),info_box.addChild(actor_label),layer.setContentSize(ccSize(info_box)),layer},getLoveContentLayer:function(){var love_stats=GeneralService.getInstance().getLoveStat(this.m_gnrlInfo.love_stat_group);if(0==love_stats.length)return null;var layer=new cc.Layer,info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",cc.Rect(20,20,20,20));info_box.setContentSize(444,267),info_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),info_box.setPosition(ZERO()),layer.addChild(info_box);var love_stat_title=cmLabel.getLabel("好感度上昇ステータス",LABEL_FONT_INDEX.FONT_1812);love_stat_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),love_stat_title.setPosition(20,230),layer.addChild(love_stat_title),love_stats=stable(love_stats,function(l,r){return l.love_level<r.love_level});for(var index=0,idx=0;idx<love_stats.length;idx++){var content=cmLabel.getLabel(love_stats[idx].content,LABEL_FONT_INDEX.FONT_1610);if(content.setAnchorPoint(ZERO()),content.setPosition(32,15+21*index),info_box.addChild(content),love_stats[idx].love_level<=this.m_gnrlInfo.love_level){content.setColor(COLOR(165));var check=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_feel_check.png");check.setAnchorPoint(ZERO()),check.setPosition(14,content.y),info_box.addChild(check)}index++}return layer.setContentSize(ccSize(info_box)),layer},getLoveLayer:function(){var layer=new cc.Layer,info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());info_box.setContentSize(444,56),info_box.setInsetBottom(13),info_box.setInsetLeft(13),info_box.setInsetRight(13),info_box.setInsetTop(13),info_box.setAnchorPoint(ZERO()),info_box.setPosition(ZERO()),layer.addChild(info_box);var title=cmLabel.getLabel("好感度",LABEL_FONT_INDEX.FONT_201);title.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),title.setPosition(26,ccCenter(info_box).y),info_box.addChild(title);var gnrl_love_level_label=cmLabel.getLabel(this.m_gnrlInfo.love_level,LABEL_FONT_INDEX.FONT_261);gnrl_love_level_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),gnrl_love_level_label.setPosition(93,ccCenter(info_box).y),info_box.addChild(gnrl_love_level_label);var gnrl_max_love_level_label=cmLabel.getLabel("/"+YUNHEE_MAX_LOVE_LEVEL,LABEL_FONT_INDEX.FONT_201);gnrl_max_love_level_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),gnrl_max_love_level_label.setPosition(gnrl_love_level_label.x+ccWidth(gnrl_love_level_label),ccCenter(info_box).y),info_box.addChild(gnrl_max_love_level_label);var prcnt=GeneralService.getInstance().getGeneralLoveUpExpPrcnt(this.m_gnrlKey);1<prcnt&&(prcnt=1);var exp_bar_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero());exp_bar_box.setContentSize(110,16),exp_bar_box.setAnchorPoint(ZERO()),exp_bar_box.setPosition(178,14),info_box.addChild(exp_bar_box);var exp_bar=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_pink.png",RectZero());exp_bar.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),exp_bar.setPosition(3,ccCenter(exp_bar_box).y),exp_bar_box.addChild(exp_bar);var gauge_prcnt=prcnt*YunheeInfoEnum.MAX_GAUGE_VALUE;exp_bar.setScaleX(gauge_prcnt);var lv_prcnt=100*prcnt;100<lv_prcnt&&(lv_prcnt=100);var exp_prcnt=cmLabel.getLabel(lv_prcnt.toFixed(0)+"%",LABEL_FONT_INDEX.FONT_161);return exp_prcnt.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),exp_prcnt.setPosition(exp_bar_box.x+ccWidth(exp_bar_box)/2+2,exp_bar_box.y+ccHeight(exp_bar_box)),info_box.addChild(exp_prcnt),this.m_gnrlInfo.love_level==YUNHEE_MAX_LOVE_LEVEL&&(exp_prcnt.setString("MAX"),exp_bar.setScaleX(YunheeInfoEnum.MAX_GAUGE_VALUE)),layer.setContentSize(ccSize(info_box)),layer},getLeaderSkillLayer:function(){var layer=new cc.Layer,m=MasterManager.getInstance(),desc_height=64,bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());bg_box.setPreferredSize(cc.size(444,132)),bg_box.setAnchorPoint(cc.p(0,0)),bg_box.setPosition(cc.p(0,0)),layer.addChild(bg_box);var frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");frame.setAnchorPoint(cc.p(0,0)),frame.setPosition(14,23),bg_box.addChild(frame);var icon=cc.Sprite.create();icon.setAnchorPoint(cc.p(.5,.5)),icon.setPosition(frame.width/2,frame.height/2),frame.addChild(icon);var name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812);name.setAnchorPoint(cc.p(0,0)),name.setPosition(91,73),bg_box.addChild(name);var desc=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_144);desc.setAnchorPoint(cc.p(0,1)),desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),desc.setTextAreaSize(cc.size(330,desc_height)),desc.ignoreContentAdaptWithSize(!1),desc.setPosition(91,73),bg_box.addChild(desc);for(var box_height=132,is_exist_leader_skill=!1,idx=0;idx<this.m_gnrlInfo.leader_skill.length;idx++)if(0!=this.m_gnrlInfo.leader_skill[idx]&&99999!=this.m_gnrlInfo.leader_skill[idx]){var skill=m.get_LeaderSkill(this.m_gnrlInfo.leader_skill[idx]);icon.setTexture(RES_CDN_DEFULT+"icon/leader/leader_"+skill.skill_icon+".png"),name.setString(skill.name),desc.setString(skill.content),is_exist_leader_skill=!0;var f_size=desc.getFontSize(),s_lengh=desc.getString().length,line_length=320;desc_height=Math.ceil((s_lengh*f_size+line_length)/line_length)*(f_size+2),desc_height=Math.max(64,desc_height),desc.setTextAreaSize(cc.size(320,desc_height)),64<ccHeight(desc)&&(box_height+=ccHeight(desc)-64);break}if(!is_exist_leader_skill)for(idx=0;idx<this.m_gnrlInfo.special_leader_skill.length;idx++)if(0!=this.m_gnrlInfo.special_leader_skill[idx]&&99999!=this.m_gnrlInfo.special_leader_skill[idx]){skill=m.get_SpecialLeaderSkill(this.m_gnrlInfo.special_leader_skill[idx]);icon.setTexture(RES_CDN_DEFULT+"icon/leader/leader_"+skill.skill_icon+".png"),name.setString(skill.name),desc.setString(skill.content);f_size=desc.getFontSize(),s_lengh=desc.getString().length,line_length=320;desc_height=Math.ceil((s_lengh*f_size+line_length)/line_length)*(f_size+2),desc_height=Math.max(64,desc_height),desc.setTextAreaSize(cc.size(320,desc_height)),64<ccHeight(desc)&&(box_height+=ccHeight(desc)-64);break}bg_box.setContentSize(444,box_height),layer.setContentSize(ccSize(bg_box)),frame.setPosition(14,ccHeight(bg_box)-109),name.setPosition(91,ccHeight(bg_box)-59),desc.setPosition(91,ccHeight(bg_box)-59);var circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_leader.png");circle_point.setAnchorPoint(cc.p(0,0)),circle_point.setPosition(17,ccHeight(bg_box)-28),bg_box.addChild(circle_point);var title=cmLabel.getLabel("リーダースキル",LABEL_FONT_INDEX.FONT_2037);if(title.setAnchorPoint(cc.p(0,0)),title.setPosition(30,ccHeight(bg_box)-34),bg_box.addChild(title),USE_SKILL_INFO_POPUP){var bg_clear_botton=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png");bg_clear_botton.setAnchorPoint(cc.p(0,1)),bg_clear_botton.setPosition(91,ccHeight(bg_box)-59),bg_clear_botton.setContentSize(ccWidth(desc),ccHeight(desc)-22.5),bg_clear_botton.setScale9Enabled(!0),bg_clear_botton.setSwallowTouches(!0),bg_clear_botton.addClickEventListener(function(sender){cc.log("Leader Skill Info Popup"),this.showLeaderSkillInfoPopupLayer()}.bind(this)),bg_box.addChild(bg_clear_botton)}return layer},getPassiveSkillLayer:function(){var layer=new cc.Layer,m=MasterManager.getInstance(),bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());bg_box.setAnchorPoint(cc.p(0,0)),bg_box.setPosition(cc.p(0,0)),layer.addChild(bg_box);var frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");frame.setAnchorPoint(cc.p(0,0)),bg_box.addChild(frame);var box_height=132,desc_height=64,name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812);name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bg_box.addChild(name);var desc=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_144);desc.setAnchorPoint(ANCHOR_TOP_LEFT()),desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),desc.setTextAreaSize(cc.size(320,desc_height)),desc.ignoreContentAdaptWithSize(!1),bg_box.addChild(desc);var icon=new cc.Sprite;icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(frame)),frame.addChild(icon);var is_exist_passive=!1;if(0<this.m_gnrlInfo.passive_skill.length&&(99999!=(passive_id=this.m_gnrlInfo.passive_skill[0])&&0!=passive_id)){if(0!=(skill=m.get_PassiveSkillV2(passive_id)).skill_icon&&null!=skill.skill_icon&&null!=skill.skill_icon)if(USE_ACTIVE_PASSIVE_ICON)icon.setTexture(RES_CDN_DEFULT+"icon/passive/"+cmString("passive_%d.png",skill.skill_icon));else{var icon_passive_name="passive_"+skill.skill_icon+".png",icon_passive_tex=cc.spriteFrameCache.getSpriteFrame(icon_passive_name);icon.setSpriteFrame(icon_passive_tex)}name.setString(skill.name),desc.setString(skill.content);var f_size=desc.getFontSize(),s_lengh=desc.getString().length,line_length=320;desc_height=Math.ceil((s_lengh*f_size+line_length)/line_length)*(f_size+2),desc_height=Math.max(64,desc_height),desc.setTextAreaSize(cc.size(320,desc_height+16)),is_exist_passive=!0}if(!is_exist_passive&&0<this.m_gnrlInfo.trans_passive_skill.length){var trans_passive_id=this.m_gnrlInfo.trans_passive_skill[0];if(99999!=trans_passive_id&&0!=trans_passive_id){var skill=m.get_TransPassiveSkill(trans_passive_id);if(USE_ACTIVE_PASSIVE_ICON)icon.setTexture(RES_CDN_DEFULT+"icon/passive/"+cmString("passive_%d.png",skill.skill_icon));else{icon_passive_name="passive_"+skill.skill_icon+".png",icon_passive_tex=cc.spriteFrameCache.getSpriteFrame(icon_passive_name);icon.setSpriteFrame(icon_passive_tex)}name.setString(skill.name),desc.setString(skill.content);f_size=desc.getFontSize(),s_lengh=desc.getString().length,line_length=320;desc_height=Math.ceil((s_lengh*f_size+line_length)/320)*(f_size+2),desc_height=Math.max(64,desc_height),desc.setTextAreaSize(cc.size(320,desc_height+16))}}64<ccHeight(desc)&&(box_height+=ccHeight(desc)-64+25),bg_box.setContentSize(444,box_height),layer.setContentSize(ccSize(bg_box)),frame.setPosition(14,ccHeight(bg_box)-109);var circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_passive.png");circle_point.setAnchorPoint(cc.p(0,0)),circle_point.setPosition(17,ccHeight(bg_box)-28),bg_box.addChild(circle_point);var title=cmLabel.getLabel("パッシブスキル",LABEL_FONT_INDEX.FONT_2036);if(title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(30,ccHeight(bg_box)-34),bg_box.addChild(title),(this.m_gnrlInfo.gnrl_type==GENERAL_TYPE_YUNHEE||this.m_gnrlInfo.gnrl_type==GENERAL_TYPE_JIN_YUNHEE)&&1==this.m_gnrlInfo.class_type){var gs=GeneralService.getInstance(),passive_id=gs.getNextClassTypePassiveId(this.m_gnrlInfo.evolution_group_num,this.m_gnrlInfo.class_type);if(0!=(skill=m.get_PassiveSkillV2(passive_id)).skill_icon&&null!=skill.skill_icon&&null!=skill.skill_icon)if(USE_ACTIVE_PASSIVE_ICON)icon.setTexture(RES_CDN_DEFULT+"icon/passive/"+cmString("passive_%d.png",skill.skill_icon));else{icon_passive_name="passive_"+skill.skill_icon+".png",icon_passive_tex=cc.spriteFrameCache.getSpriteFrame(icon_passive_name);icon.setSpriteFrame(icon_passive_tex)}if(name.setString(skill.name),name.setColor(COLOR(188)),desc.setString(skill.content),desc.setColor(COLOR(166)),99999==passive_id||0==passive_id){passive_id=gs.getNextClassTypeTransPassiveId(this.m_gnrlInfo.evolution_group_num,this.m_gnrlInfo.class_type);if(0!=(skill=m.get_TransPassiveSkill(passive_id)).skill_icon&&null!=skill.skill_icon&&null!=skill.skill_icon)if(USE_ACTIVE_PASSIVE_ICON)icon.setTexture(RES_CDN_DEFULT+"icon/passive/"+cmString("passive_%d.png",skill.skill_icon));else{icon_passive_name="passive_"+skill.skill_icon+".png",icon_passive_tex=cc.spriteFrameCache.getSpriteFrame(icon_passive_name);icon.setSpriteFrame(icon_passive_tex)}else if(USE_ACTIVE_PASSIVE_ICON)icon.setTexture(RES_CDN_DEFULT+"icon/passive/passive_0.png");else{icon_passive_name="passive_0.png",icon_passive_tex=cc.spriteFrameCache.getSpriteFrame(icon_passive_name);icon.setSpriteFrame(icon_passive_tex)}name.setString(skill.name),name.setColor(COLOR(188)),desc.setString(skill.content),desc.setColor(COLOR(166))}var icon_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());icon_mask.setContentSize(60,60),icon_mask.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),icon_mask.setPosition(cc.p(0,0)),icon.addChild(icon_mask);var info_label=cmLabel.getLabel("(進化後、活性化されます。)",LABEL_FONT_INDEX.FONT_1613);info_label.setAnchorPoint(ZERO()),info_label.setPosition(title.x+ccWidth(title),title.y),bg_box.addChild(info_label);f_size=desc.getFontSize(),s_lengh=desc.getString().length,line_length=320;desc_height=Math.ceil((s_lengh*f_size+line_length)/320)*(f_size+2),desc_height=Math.max(64,desc_height),desc.setTextAreaSize(cc.size(320,desc_height+16)),64<ccHeight(desc)&&(box_height+=ccHeight(desc)-64+25),bg_box.setContentSize(444,box_height),layer.setContentSize(ccSize(bg_box)),frame.setPosition(14,ccHeight(bg_box)-109),circle_point.setPosition(17,ccHeight(bg_box)-28),title.setPosition(30,ccHeight(bg_box)-34),info_label.setPosition(title.x+ccWidth(title),title.y)}if(USE_SKILL_INFO_POPUP){var bg_clear_botton=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png");bg_clear_botton.setAnchorPoint(cc.p(0,1)),bg_clear_botton.setPosition(91,ccHeight(bg_box)-59),bg_clear_botton.setContentSize(ccWidth(desc),ccHeight(desc)-22.5),bg_clear_botton.setScale9Enabled(!0),bg_clear_botton.addTouchEventListener(function(sender){cc.log("Passive Skill Info Popup"),this.showPassiveInfoPopupLayer()}.bind(this)),layer.addChild(bg_clear_botton)}return name.setPosition(91,ccHeight(bg_box)-59),desc.setPosition(91,ccHeight(bg_box)-59),layer},getActiveSkillLayer:function(){var layer=new cc.Layer,m=MasterManager.getInstance(),bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());bg_box.setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),layer.addChild(bg_box);var frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");frame.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bg_box.addChild(frame);var box_height=132,name=null,desc=null;if(0!=this.m_gnrlInfo.active_skill){var icon,skill=m.get_ActiveSkill(this.m_gnrlInfo.active_skill);if(USE_ACTIVE_PASSIVE_ICON)(icon=cc.Sprite.create(RES_CDN_DEFULT+"icon/active/active_"+skill.skill_group+".png")).setContentSize(60,60),icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(frame.width/2,frame.height/2),frame.addChild(icon);else(icon=cc.Sprite.create("#active_"+skill.skill_group+".png")).setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(frame.width/2,frame.height/2),frame.addChild(icon);(name=cmLabel.getLabel(skill.name,LABEL_FONT_INDEX.FONT_1812)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bg_box.addChild(name);var line=SKILLLINECOUNT(skill,27);(desc=cmLabel.getLabel(skill.content,LABEL_FONT_INDEX.FONT_144)).setAnchorPoint(ANCHOR_TOP_LEFT()),desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),IS_SP_BROWSER?desc.setTextAreaSize(cc.size(340,18*line)):desc.setTextAreaSize(cc.size(340,17*line)),desc.ignoreContentAdaptWithSize(!1),desc.setPosition(91,73),bg_box.addChild(desc),64<ccHeight(desc)&&(box_height+=ccHeight(desc)-64)}bg_box.setContentSize(444,box_height),layer.setContentSize(ccSize(bg_box)),frame.setPosition(14,ccHeight(bg_box)-109),0!=this.m_gnrlInfo.active_skill&&(name.setPosition(91,ccHeight(bg_box)-59),desc.setPosition(91,ccHeight(bg_box)-59));var circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_active.png");circle_point.setAnchorPoint(ZERO()),circle_point.setPosition(17,ccHeight(bg_box)-28),bg_box.addChild(circle_point);var title=cmLabel.getLabel("アクティブスキル",LABEL_FONT_INDEX.FONT_2035);if(title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(30,ccHeight(bg_box)-34),bg_box.addChild(title),USE_SKILL_INFO_POPUP){var bg_clear_botton=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png");bg_clear_botton.setAnchorPoint(cc.p(0,1)),bg_clear_botton.setPosition(91,ccHeight(bg_box)-59),bg_clear_botton.setContentSize(ccWidth(desc),ccHeight(desc)-22.5),bg_clear_botton.setScale9Enabled(!0),bg_clear_botton.addClickEventListener(function(sender){cc.log("Active Skill Info Popup"),this.showSkillInfoPopupLayer()}.bind(this)),layer.addChild(bg_clear_botton)}return layer},getGeneralEquipLayer:function(){var mm=MasterManager.getInstance(),layer=new cc.Layer;layer.setContentSize(cc.size(444,122));var bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());bg_box.setContentSize(ccSize(layer)),bg_box.setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),layer.addChild(bg_box);var spot_image=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png");spot_image.setAnchorPoint(ZERO()),spot_image.setPosition(17,97),bg_box.addChild(spot_image);var title_label=cmLabel.getLabel(mm.get_LanguageData("btn_label_item"),LABEL_FONT_INDEX.FONT_2029);title_label.setAnchorPoint(ZERO()),title_label.setPosition(34,92),bg_box.addChild(title_label);var help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE);help_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),help_btn.setScale(.8,.8),help_btn.setPosition(ccWidth(bg_box)-14,ccHeight(bg_box)-7),bg_box.addChild(help_btn),help_btn.addClickEventListener(function(sender){this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],EQUIP_NOTI_TYPE.EUQIP_SHOW_HELP)},0,"EUQIP_SHOW_HELP")}.bind(this));for(var equipService=EquipmentService.getInstance(),userGnrlEquipList=equipService.getUserGeneralEquipmentListInfo(this.m_gnrlKey),release_value=mm.get_EquipmentReleaseSlot(this.m_gnrlInfo.love_level).release_slot,offset_x=14,i=EQUIPMENT_PRIVATE;i<=EQUIPMENT_JEWELRY;i++){for(var equip_info={},idx=0;idx<userGnrlEquipList.length;idx++){var user_equip=userGnrlEquipList[idx];if(user_equip.equip_parts_type==i){var equip_key={};equip_key.equipment_item_idx=user_equip.equip_id,equip_key.equipment_num=user_equip.equip_num,equipService.getUserEquipmentInfo(equip_key,equip_info,this.m_gnrlKey);break}}var is_open=1&release_value,equip_btn=this.getEquipIconButton(i,is_open,equip_info);equip_btn.setAnchorPoint(ZERO()),equip_btn.setPosition(offset_x,14),bg_box.addChild(equip_btn),offset_x+=19+ccWidth(equip_btn),release_value>>=1}return layer},getEquipIconButton:function(index,is_open,equip_info){var layer=new cc.Layer;layer.setContentSize(cc.size(68,68));var card_equip={};if(1==is_open&&null!=equip_info&&0<equip_info.equip_id){var card_equip_info={};card_equip_info.equip_id=equip_info.equip_id,card_equip_info.equip_rare_type=equip_info.equip_rare_type,card_equip_info.equip_parts_type=equip_info.equip_parts_type,card_equip_info.arm_service_type=equip_info.arm_service_type,card_equip_info.equip_type=equip_info.equip_type,card_equip_info.level=equip_info.level,card_equip_info.step=equip_info.equip_step,card_equip_info.image=equip_info.image,card_equip_info.equip_group=equip_info.equip_group,card_equip_info.property_img=equip_info.property_img,card_equip_info.frame_id=equip_info.frame_id,card_equip_info.symbol_id=equip_info.symbol_id,card_equip_info.symbol_name_id=equip_info.symbol_name_id,card_equip_info.is_same_gnrl_group=!1,card_equip_info.gnrl_group=0,card_equip=CardEquipment.getInstance().createCardEquipment(card_equip_info,EQUIPMENT_CARD_TYPE.type_card_small)}else card_equip=cc.Sprite.create(RES_CDN_MENU_EQUIP_NTP+"img_equip_thumb_"+index+".png"),DISABLE_SPB_TP&&card_equip.setContentSize(68,68);var equip_btn=new ccui.Button;if(DISABLE_SPB_TP?(equip_btn.loadTextures(RES_CDN_MENU_EQUIP_NTP+"img_equip_thumb_1.png",RES_CDN_MENU_EQUIP_NTP+"img_equip_thumb_1.png"),equip_btn._contentSize.width=68,equip_btn._contentSize.height=68):equip_btn.loadTextures("img_equip_thumb_1.png","img_equip_thumb_1.png","",ccui.Widget.PLIST_TEXTURE),equip_btn.setAnchorPoint(ANCHOR_MIDDLE()),equip_btn.setPosition(ccCenter(layer)),layer.addChild(equip_btn),equip_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeInfoEnum.BTN_EQUIPMENT_PRIVATE+index-1)}.bind(this)),card_equip.setAnchorPoint(ANCHOR_MIDDLE()),card_equip.setPosition(ccCenter(equip_btn)),equip_btn.addChild(card_equip),0==is_open){var lock_icon=cc.Sprite.create(RES_CDN_MENU_EQUIP_NTP+"img_equip_thumb_lock.png");lock_icon.setAnchorPoint(ZERO()),lock_icon.setPosition(6,42),equip_btn.addChild(lock_icon)}return layer},getStatLayer:function(){var layer=new cc.Layer,info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());info_box.setContentSize(444,279),info_box.setAnchorPoint(cc.p(0,0)),info_box.setPosition(cc.p(0,0)),layer.addChild(info_box);for(var i=0;i<12;++i){var box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero());box.setContentSize(208,38),box.setAnchorPoint(cc.p(0,0)),info_box.addChild(box);var label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812);label.setAnchorPoint(cc.p(0,.5)),label.setPosition(8,ccCenter(box).y),box.addChild(label),0==i?(box.setPosition(11,223),label.setString("攻撃力")):1==i?(box.setPosition(11,182),label.setString("体力")):2==i?(box.setPosition(11,141),label.setString("会心発動率")):3==i?(box.setPosition(11,100),label.setString("盾発動率")):4==i?(box.setPosition(11,59),label.setString("属性")):5==i?(box.setPosition(11,18),label.setString("戦闘タイプ")):6==i?(box.setPosition(225,223),label.setString("防御力")):7==i?(box.setPosition(225,182),label.setString("攻速")):8==i?(box.setPosition(225,141),label.setString("会心上昇率")):9==i?(box.setPosition(225,100),label.setString("盾強度")):10==i?(box.setPosition(225,59),label.setString("兵科")):11==i&&(box.setPosition(225,18),label.setString("勢力"))}var add_atk_pos=212,atk_value=parseInt(this.m_gnrlInfo.attk),add_atk_label=cmLabel.getLabel("(+"+parseInt(this.m_add_atk_value)+")",LABEL_FONT_INDEX.FONT_1412);add_atk_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),add_atk_label.setPosition(add_atk_pos,243),info_box.addChild(add_atk_label),0==this.m_add_atk_value&&add_atk_label.setString(""),add_atk_pos=add_atk_label.x-ccWidth(add_atk_label);var atk_label=cmLabel.getLabel(atk_value.toLocaleString("en"),LABEL_FONT_INDEX.FONT_201);atk_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),atk_label.setPosition(add_atk_pos,243),info_box.addChild(atk_label);var add_def_pos=426,def_value=parseInt(this.m_gnrlInfo.def),add_def_label=cmLabel.getLabel("(+"+parseInt(this.m_add_def_value)+")",LABEL_FONT_INDEX.FONT_1412);add_def_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),add_def_label.setPosition(add_def_pos,243),info_box.addChild(add_def_label),0==this.m_add_def_value&&add_def_label.setString(""),add_def_pos=add_def_label.x-ccWidth(add_def_label);var def_label=cmLabel.getLabel(def_value.toLocaleString("en"),LABEL_FONT_INDEX.FONT_201);def_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),def_label.setPosition(add_def_pos,243),info_box.addChild(def_label);var add_hp_pos=212,hp_value=parseInt(this.m_gnrlInfo.hp),add_hp_label=cmLabel.getLabel("(+"+parseInt(this.m_add_hp_value)+")",LABEL_FONT_INDEX.FONT_1412);add_hp_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),add_hp_label.setPosition(add_hp_pos,202),info_box.addChild(add_hp_label),0==this.m_add_hp_value&&add_hp_label.setString(""),add_hp_pos=add_hp_label.x-ccWidth(add_hp_label);var hp_label=cmLabel.getLabel(hp_value.toLocaleString("en"),LABEL_FONT_INDEX.FONT_201);hp_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),hp_label.setPosition(add_hp_pos,202),info_box.addChild(hp_label);var add_sp_pos=426,add_sp_label=cmLabel.getLabel("(+"+parseInt(0)+")",LABEL_FONT_INDEX.FONT_1412);add_sp_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),add_sp_label.setPosition(add_sp_pos,202),info_box.addChild(add_sp_label),add_sp_label.setString(""),add_sp_pos=ccPosX(add_sp_label)-ccWidth(add_sp_label);var sp_label=cmLabel.getLabel(this.m_gnrlInfo.sp.toLocaleString("en"),LABEL_FONT_INDEX.FONT_201);sp_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),sp_label.setPosition(add_sp_pos,202),info_box.addChild(sp_label);var cri_prcnt_font_index=LABEL_FONT_INDEX.FONT_143,add_cri_prcnt_pos=212,add_cri_prcnt_label=cmLabel.getLabel("(+"+this.m_add_cri_prcnt.toFixed(1)+")",LABEL_FONT_INDEX.FONT_1412);add_cri_prcnt_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),add_cri_prcnt_label.setPosition(add_cri_prcnt_pos,161),info_box.addChild(add_cri_prcnt_label),0==this.m_add_cri_prcnt.toFixed(1)&&(cri_prcnt_font_index=LABEL_FONT_INDEX.FONT_201,add_cri_prcnt_label.setString("")),add_cri_prcnt_pos=ccPosX(add_cri_prcnt_label)-ccWidth(add_cri_prcnt_label);var cri_prcnt_label=cmLabel.getLabel(this.m_gnrlInfo.cri_prcnt.toFixed(1)+"%",cri_prcnt_font_index);cri_prcnt_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),cri_prcnt_label.setPosition(add_cri_prcnt_pos,161),info_box.addChild(cri_prcnt_label);var cri_dmg_prcnt_font_index=LABEL_FONT_INDEX.FONT_143,add_cri_dmg_prcnt_pos=427,add_cri_dmg_prcnt_label=cmLabel.getLabel("(+"+this.m_add_cri_dmg_prcnt.toFixed(1)+")",LABEL_FONT_INDEX.FONT_1412);add_cri_dmg_prcnt_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),add_cri_dmg_prcnt_label.setPosition(add_cri_dmg_prcnt_pos,161),info_box.addChild(add_cri_dmg_prcnt_label),0==this.m_add_cri_dmg_prcnt.toFixed(1)&&(cri_dmg_prcnt_font_index=LABEL_FONT_INDEX.FONT_201,add_cri_dmg_prcnt_label.setString("")),add_cri_dmg_prcnt_pos=ccPosX(add_cri_dmg_prcnt_label)-ccWidth(add_cri_dmg_prcnt_label);var cri_dmg_label=cmLabel.getLabel(this.m_gnrlInfo.cri_ratio.toFixed(1)+"%",cri_dmg_prcnt_font_index);cri_dmg_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),cri_dmg_label.setPosition(add_cri_dmg_prcnt_pos,161),info_box.addChild(cri_dmg_label);var def_prcnt_font_index=LABEL_FONT_INDEX.FONT_143,add_def_prcnt_pos=212,add_def_prcnt_label=cmLabel.getLabel("(+"+this.m_add_def_prcnt.toFixed(1)+")",LABEL_FONT_INDEX.FONT_1412);add_def_prcnt_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),add_def_prcnt_label.setPosition(add_def_prcnt_pos,119),info_box.addChild(add_def_prcnt_label),0==this.m_add_def_prcnt.toFixed(1)&&(def_prcnt_font_index=LABEL_FONT_INDEX.FONT_201,add_def_prcnt_label.setString("")),add_def_prcnt_pos=ccPosX(add_def_prcnt_label)-ccWidth(add_def_prcnt_label);var def_prcnt_label=cmLabel.getLabel(this.m_gnrlInfo.guard_rate.toFixed(1)+"%",def_prcnt_font_index);def_prcnt_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),def_prcnt_label.setPosition(add_def_prcnt_pos,119),info_box.addChild(def_prcnt_label);var def_damage_prcnt_font_index=LABEL_FONT_INDEX.FONT_143,add_def_decrease_prcnt_pos=427,add_def_decrease_prcnt_label=cmLabel.getLabel("(+"+this.m_add_def_decrease_prcnt.toFixed(1)+")",LABEL_FONT_INDEX.FONT_1412);add_def_decrease_prcnt_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),add_def_decrease_prcnt_label.setPosition(add_def_decrease_prcnt_pos,119),info_box.addChild(add_def_decrease_prcnt_label),0==this.m_add_def_decrease_prcnt.toFixed(1)&&(def_damage_prcnt_font_index=LABEL_FONT_INDEX.FONT_201,add_def_decrease_prcnt_label.setString("")),add_def_decrease_prcnt_pos=ccPosX(add_def_decrease_prcnt_label)-ccWidth(add_def_decrease_prcnt_label);var def_decrease_label=cmLabel.getLabel(this.m_gnrlInfo.guard_decrease.toFixed(1)+"%",def_damage_prcnt_font_index);def_decrease_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),def_decrease_label.setPosition(add_def_decrease_prcnt_pos,119),info_box.addChild(def_decrease_label);var mt=MasterManager.getInstance(),et=mt.get_ElementType(this.m_gnrlInfo.element_type),element_type_label=cmLabel.getLabel(et.name,LABEL_FONT_INDEX.FONT_201);if(element_type_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),element_type_label.setPosition(212,78),info_box.addChild(element_type_label),0!=this.m_gnrlInfo.element_type){var element_type_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_detail_ic_attribute_"+this.m_gnrlInfo.element_type+".png");element_type_icon.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),element_type_icon.setPosition(element_type_label.x-ccWidth(element_type_label),78),info_box.addChild(element_type_icon)}var as=mt.get_ArmServiceType(this.m_gnrlInfo.arm_service_type),arm_service_type_label=cmLabel.getLabel(as.name,LABEL_FONT_INDEX.FONT_201);arm_service_type_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),arm_service_type_label.setPosition(426,78),info_box.addChild(arm_service_type_label);var arm_service_type_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_detail_ic_battletech_"+this.m_gnrlInfo.arm_service_type+".png");arm_service_type_icon.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),arm_service_type_icon.setPosition(arm_service_type_label.x-ccWidth(arm_service_type_label),78),info_box.addChild(arm_service_type_icon);var ft=mt.get_FightType(this.m_gnrlInfo.fight_type),fight_type_label=cmLabel.getLabel(ft.name,LABEL_FONT_INDEX.FONT_201);fight_type_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),fight_type_label.setPosition(212,37),info_box.addChild(fight_type_label);var st=mt.get_StateType(this.m_gnrlInfo.state_type),state_type_label=cmLabel.getLabel(st.name,LABEL_FONT_INDEX.FONT_201);return state_type_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),state_type_label.setPosition(426,37),info_box.addChild(state_type_label),layer.setContentSize(ccSize(info_box)),layer},getLevelGaugeLayer:function(){var layer=new cc.Layer,info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());info_box.setContentSize(444,56),info_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),info_box.setPosition(ZERO()),layer.addChild(info_box),layer.setContentSize(info_box.getContentSize());var level_label=cmLabel.getLabel("Lv",LABEL_FONT_INDEX.FONT_201);level_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),level_label.setPosition(27,ccCenter(info_box).y),info_box.addChild(level_label);var gnrl_level_label=cmLabel.getLabel(this.m_gnrlInfo.gnrl_level,LABEL_FONT_INDEX.FONT_261);gnrl_level_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),gnrl_level_label.setPosition(91,17),info_box.addChild(gnrl_level_label);var gnrl_max_level_label=cmLabel.getLabel("/"+this.m_gnrlInfo.max_level,LABEL_FONT_INDEX.FONT_201);gnrl_max_level_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),gnrl_max_level_label.setPosition(gnrl_level_label.x,ccCenter(info_box).y),info_box.addChild(gnrl_max_level_label);var prcnt=GeneralService.getInstance().getGeneralLevelUpExpPrcnt(this.m_gnrlKey);1<prcnt&&(prcnt=1);var exp_bar_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero());exp_bar_box.setContentSize(110,16),exp_bar_box.setAnchorPoint(ZERO()),exp_bar_box.setPosition(154,15),info_box.addChild(exp_bar_box);var exp_bar=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green.png",RectZero());exp_bar.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),exp_bar.setPosition(3,ccCenter(exp_bar_box).y),exp_bar_box.addChild(exp_bar);var gauge_prcnt=prcnt*YunheeInfoEnum.MAX_GAUGE_VALUE;exp_bar.setScaleX(gauge_prcnt);var lv_prcnt=100*prcnt;100<lv_prcnt&&(lv_prcnt=100);var exp_prcnt=cmLabel.getLabel(Math.floor(lv_prcnt)+"%",LABEL_FONT_INDEX.FONT_161);exp_prcnt.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),exp_prcnt.setPosition(exp_bar_box.x+ccWidth(exp_bar_box)/2+2,exp_bar_box.y+ccHeight(exp_bar_box)),info_box.addChild(exp_prcnt);var cost_label=cmLabel.getLabel("COST",LABEL_FONT_INDEX.FONT_201);cost_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),cost_label.setPosition(299,ccCenter(info_box).y),info_box.addChild(cost_label);var user_cost_label=cmLabel.getLabel(this.m_gnrlInfo.cost,LABEL_FONT_INDEX.FONT_261);return user_cost_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),user_cost_label.setPosition(364,ccCenter(layer).y),layer.addChild(user_cost_label),this.m_gnrlInfo.gnrl_level>=this.m_gnrlInfo.max_level&&(exp_prcnt.setString("MAX"),exp_bar.setScaleX(YunheeInfoEnum.MAX_GAUGE_VALUE)),layer},getPickupContentLayer:function(list,pickup_list_dungeon){var buff=list[0],key=[buff.dungeon_type,Math.floor(buff.dungeon_idx/100)];if(1==pickup_list_dungeon.at(key))return null;pickup_list_dungeon.insert(key,!0);var layer=new cc.Layer,mt=MasterManager.getInstance(),bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());bg_box.setAnchorPoint(ZERO()),bg_box.setContentSize(444,41*list.length+86),bg_box.setPosition(ZERO()),bg_box.setName("bg_box"),layer.addChild(bg_box);var name_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_white.png");name_point.setAnchorPoint(ANCHOR_TOP_LEFT()),name_point.setPosition(10,ccHeight(bg_box)-31),bg_box.addChild(name_point);var dungeon=mt.get_EventDungeon(buff.dungeon_idx),d_name=mt.get_EventDungeonName(dungeon.event_dungeon_period_idx),name_label=cmLabel.getLabel(cmString("%s",d_name.name),LABEL_FONT_INDEX.FONT_181);name_label.setAnchorPoint(ANCHOR_TOP_LEFT()),name_label.setPosition(21,ccHeight(bg_box)-24),bg_box.addChild(name_label),cmLabel.autoSizeFit(name_label,400,18);for(var height=68,i=list.length-1;0<=i;i--){var buff_info=list[i],buff_content_layer=this.getBuffValueLayer(buff_info);buff_content_layer.ignoreAnchorPointForPosition(!1),buff_content_layer.setAnchorPoint(ANCHOR_TOP_LEFT()),buff_content_layer.setPosition(5,ccHeight(bg_box)-height),height+=ccHeight(buff_content_layer),layer.addChild(buff_content_layer)}return layer.setContentSize(ccSize(bg_box)),layer},getVoiceContentLayer:function(list){var layer=new cc.Layer,bg_box=(MasterTable.getInstance(),cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_5.png",cc.Rect(20,20,20,20)));bg_box.setAnchorPoint(ZERO()),bg_box.setContentSize(444,76),bg_box.setPosition(ZERO()),bg_box.setName("bg_box"),layer.addChild(bg_box);var circle=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_white.png");circle.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),circle.setPosition(15,ccCenter(bg_box).y),bg_box.addChild(circle);var voice_name=cmLabel.getLabel(list.list_name,LABEL_FONT_INDEX.FONT_201);voice_name.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),voice_name.setPosition(30,ccCenter(bg_box).y),bg_box.addChild(voice_name);var voice_btn=new ccui.Button;return voice_btn.loadTextures("btn_voice_off.png","btn_voice_on.png","",ccui.Widget.PLIST_TEXTURE),voice_btn.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),voice_btn.setPosition(ccWidth(bg_box)-12,ccCenter(bg_box).y),bg_box.addChild(voice_btn),voice_btn.addClickEventListener(function(sender){this.play_voice(list.list_type,list.list_division)}.bind(this)),layer.setContentSize(ccSize(bg_box)),this.scheduleUpdate(),layer},play_voice:function(voice_type,division){var m=MasterTable.getInstance(),audio=AudioEngine.getInstance(),voice=m.get_Voice_V2(this.m_gnrlInfo.gnrl_id,voice_type,division,0);if(""!=voice&&null!=voice){var path=RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3";audio.playVoice(path,!1)}},update:function(dt){this.m_is_voice_playing},getBuffValueLayer:function(buff){var layer=new cc.Layer,mt=MasterManager.getInstance(),gs=GeneralService.getInstance(),info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());info_box.setContentSize(422,38),info_box.setAnchorPoint(ZERO()),info_box.setPosition(6,3),layer.addChild(info_box),layer.setContentSize(ccSize(info_box).width+6,ccSize(info_box).height+3);var buff_name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812);buff_name.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),buff_name.setPosition(9,ccCenter(info_box).y),info_box.addChild(buff_name);var arrow_sprite=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_arrow_3.png");arrow_sprite.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),arrow_sprite.setPosition(286,ccCenter(info_box).y),info_box.addChild(arrow_sprite);var origin_value=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181);origin_value.setAnchorPoint(ANCHOR_MIDDLE()),origin_value.setPosition(212,ccCenter(info_box).y),info_box.addChild(origin_value);var add_value_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1412);add_value_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),add_value_label.setPosition(212,ccCenter(info_box).y),info_box.addChild(add_value_label);var buff_value_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1810);buff_value_label.setAnchorPoint(ANCHOR_MIDDLE()),buff_value_label.setPosition(376,ccCenter(info_box).y),info_box.addChild(buff_value_label);var combo_stat=mt.get_ComboStat(buff.buff_type);buff_name.setString(combo_stat.name);var buff_value=0;if(buff.buff_type==COMBO_STAT_ATTK)origin_value.setString(parseInt(this.m_gnrlInfo.attk)),buff_value=Math.floor(this.m_gnrlInfo.attk+Math.floor(this.m_add_atk_value)),buff_value+=Math.floor(buff_value*buff.buff_value/1e4),buff_value_label.setString(parseInt(buff_value)),0!=this.m_add_atk_value&&(add_value_label.setString("(+"+Math.floor(this.m_add_atk_value)+")"),origin_value.setPosition(origin_value.x-ccWidth(add_value_label),origin_value.y),add_value_label.setPosition(origin_value.x+ccCenter(origin_value).x,origin_value.y));else if(buff.buff_type==COMBO_STAT_DEF)origin_value.setString(parseInt(this.m_gnrlInfo.def)),buff_value=Math.floor(this.m_gnrlInfo.def+Math.floor(this.m_add_def_value)),buff_value+=Math.floor(buff_value*buff.buff_value/1e4),buff_value_label.setString(parseInt(buff_value)),0!=this.m_add_def_value&&(add_value_label.setString("(+"+Math.floor(this.m_add_def_value)+")"),origin_value.setPosition(origin_value.x-ccWidth(add_value_label),origin_value.y),add_value_label.setPosition(origin_value.x+ccCenter(origin_value).x,origin_value.y));else if(buff.buff_type==COMBO_STAT_HP)origin_value.setString(parseInt(this.m_gnrlInfo.hp)),buff_value=Math.floor(this.m_gnrlInfo.hp+Math.floor(this.m_add_hp_value)),buff_value+=Math.floor(buff_value*buff.buff_value/1e4),buff_value_label.setString(parseInt(buff_value)),0!=this.m_add_hp_value&&(add_value_label.setString("(+"+Math.floor(this.m_add_hp_value)+")"),origin_value.setPosition(origin_value.x-ccWidth(add_value_label),origin_value.y),add_value_label.setPosition(origin_value.x+ccCenter(origin_value).x,origin_value.y));else if(buff.buff_type==COMBO_STAT_CRI_PRCNT)origin_value.setString(this.m_gnrlInfo.cri_prcnt.toFixed(1)),buff_value=this.m_gnrlInfo.cri_prcnt,buff_value+=buff.buff_value/100,buff_value_label.setString(buff_value.toFixed(1)),0!=this.m_add_cri_prcnt&&(add_value_label.setString(this.m_add_cri_prcnt.toFixed(1)),origin_value.setPosition(ccPosX(origin_value)-ccWidth(add_value_label),ccPosY(origin_value)),add_value_label.setPosition(ccPosX(origin_value)+ccCenter(origin_value).x,ccPosY(origin_value)));else if(buff.buff_type==COMBO_STAT_CRI_DMG)origin_value.setString(this.m_gnrlInfo.cri_ratio.toFixed(1)),buff_value=this.m_gnrlInfo.cri_ratio,buff_value+=buff.buff_value/100,buff_value_label.setString(buff_value.toFixed(1)),0!=this.m_add_cri_dmg_prcnt&&(add_value_label.setString(this.m_add_cri_dmg_prcnt.toFixed(1)),origin_value.setPosition(ccPosX(origin_value)-ccWidth(add_value_label),ccPosY(origin_value)),add_value_label.setPosition(ccPosX(origin_value)+ccCenter(origin_value).x,ccPosY(origin_value)));else if(buff.buff_type==COMBO_STAT_GUARD_PRCNT)origin_value.setString(this.m_gnrlInfo.guard_rate.toFixed(1)),buff_value=this.m_gnrlInfo.guard_rate,buff_value+=buff.buff_value/100,buff_value_label.setString(buff_value.toFixed(1)),0!=this.m_add_def_prcnt&&(add_value_label.setString(this.m_add_def_prcnt.toFixed(1)),origin_value.setPosition(ccPosX(origin_value)-ccWidth(add_value_label),ccPosY(origin_value)),add_value_label.setPosition(ccPosX(origin_value)+ccCenter(origin_value).x,ccPosY(origin_value)));else if(buff.buff_type==COMBO_STAT_GUARD_DECREASE)origin_value.setString(this.m_gnrlInfo.guard_decrease.toFixed(1)),buff_value=this.m_gnrlInfo.guard_decrease,buff_value+=buff.buff_value/100,buff_value_label.setString(buff_value.toFixed(1)),0!=this.m_add_def_decrease_prcnt&&(add_value_label.setString(this.m_add_def_decrease_prcnt.toFixed(1)),origin_value.setPosition(ccPosX(origin_value)-ccWidth(add_value_label),ccPosY(origin_value)),add_value_label.setPosition(ccPosX(origin_value)+ccCenter(origin_value).x,ccPosY(origin_value)));else{var gr_list=[];mt.get_GeneralResistance(this.m_gnrlInfo.gnrl_id,gr_list);var rt=mt.get_ResistanceType(buff.trans_type);for(var r in buff_name.setString(rt.name),gr_list){var gr_id=gr_list[r];if(gr_id.trans_type==buff.trans_type){origin_value.setString(gr_id.content);var color=gs.getResistanceValueColor(gr_id.resist_value);origin_value.setColor(color);var value=gr_id.resist_value;value+=buff.trans_resist_value;var buff_str=gs.getResistanceValueToName(value);buff_value_label.setString(buff_str),color=gs.getResistanceValueColor(value),buff_value_label.setColor(color)}}}return layer},getPickupListLayer:function(){this.m_event_dundeon_gnrl_buff.sort(function(l,r){return l.event_idx<r.event_idx?1:l.event_idx>r.event_idx?-1:0});var map_event_buff=new Map_VectorEx;for(var b in this.m_event_dundeon_gnrl_buff){var buff=this.m_event_dundeon_gnrl_buff[b];"n"!=buff.onoff&&map_event_buff.insert(buff.dungeon_idx,buff)}var listLayer=new ScrollLayer;return listLayer.setContentSize(447,423),listLayer.getItemNode=function(contentSize,m){var height=0,scrollLayer=new cc.Layer,pickup_list_dungeon=new Map;pickup_list_dungeon.clear();for(var keys=map_event_buff.keys(),idx=keys.length-1;0<=idx;idx--){var layer=this.getPickupContentLayer(map_event_buff.at(keys[idx]),pickup_list_dungeon);null!=layer&&(layer.setPosition(0,height),scrollLayer.addChild(layer),height+=ccHeight(layer))}if(scrollLayer.setContentSize(444,height),height<423){var y=423-height;scrollLayer.setPosition(0,y)}return scrollLayer}.bind(this),listLayer.initLayout(),listLayer},getVoiceListLayer:function(){var listLayer=new ScrollLayer;return listLayer.setContentSize(447,423),listLayer.getItemNode=function(contentSize,m){var height=0,scrollLayer=new ScrollLayer,list=MasterTable.getInstance().get_Voice_List();list.reverse();for(var i=0;i<list.length;i++){var l=list[i],layer=this.getVoiceContentLayer(l);null!=layer&&(layer.setPosition(0,height),scrollLayer.addChild(layer),height+=ccHeight(layer))}if(scrollLayer.setContentSize(444,height),height<423){var y=423-height;scrollLayer.setPosition(0,y)}return scrollLayer}.bind(this),listLayer.initLayout(),listLayer},getPickupRewardBufContentLayer:function(list){var layer=new cc.Layer,mt=MasterManager.getInstance(),bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",cc.Rect(20,20,20,20));bg_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bg_box.setContentSize(444,41*list.length+86),bg_box.setPosition(ZERO()),layer.addChild(bg_box);var name_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_white.png");name_point.setAnchorPoint(ANCHOR_TOP_LEFT()),name_point.setPosition(10,ccHeight(bg_box)-31),bg_box.addChild(name_point);var buff=list[0],dungeon=mt.get_EventDungeon(buff.dungeon_idx),dungeon_difficulty_type=mt.get_EventDungeonDifficultyType(dungeon.event_dungeon_difficulty_type),name_label=cmLabel.getLabel(dungeon.name+"["+dungeon_difficulty_type.name+"]",LABEL_FONT_INDEX.FONT_181);name_label.setAnchorPoint(ANCHOR_TOP_LEFT()),name_label.setPosition(21,ccHeight(bg_box)-24),bg_box.addChild(name_label),"y"==dungeon.two_times_yn&&name_label.setString(cmString("%s[%s] x2",dungeon.name,dungeon_difficulty_type.name)),cmLabel.autoSizeFit(name_label,400,18);for(var height=68,i=list.length-1;0<=i;i--){buff=list[i];var bonus_name,d=mt.get_EventDungeon(buff.dungeon_idx),period=mt.get_EventDungeonPeriod(d.event_dungeon_period_idx),unit_type=mt.get_EventPointUnitType(period.event_point_unit_type),info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());if(info_box.setContentSize(422,38),info_box.setAnchorPoint(ANCHOR_TOP_LEFT()),info_box.setPosition(5,ccHeight(bg_box)-height),layer.addChild(info_box),buff.bonus_type==BONUS_TYPE_EVENT_POINT)bonus_name=unit_type.name;else bonus_name=mt.get_BonusType(buff.bonus_type).name;var buff_name=cmLabel.getLabel(bonus_name,LABEL_FONT_INDEX.FONT_1812);buff_name.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),buff_name.setPosition(14,ccCenter(info_box).y),info_box.addChild(buff_name);var plus_value=cmLabel.getLabel(" + "+buff.max_value,LABEL_FONT_INDEX.FONT_1818);plus_value.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),plus_value.setPosition(ccPosX(buff_name)+ccWidth(buff_name)+20,ccCenter(info_box).y),info_box.addChild(plus_value),height+=ccHeight(info_box)}return layer.setContentSize(ccSize(bg_box)),layer},getRareTypeSprite:function(){var rare_type_mark=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_unique_"+leadingZeros(this.m_gnrlInfo.rare_type,2)+".png");if(this.m_gnrlInfo.gnrl_type!=GENERAL_TYPE_MATERIAL){var class_type_star_path=null;this.m_gnrlInfo.class_type>YUNHEE_MAX_CLASS_TYPE?class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_ss_2.png":this.m_gnrlInfo.rare_type==RARE_TYPE_N||this.m_gnrlInfo.rare_type==RARE_TYPE_HN?class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_n.png":this.m_gnrlInfo.rare_type==RARE_TYPE_R?class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_r.png":this.m_gnrlInfo.rare_type==RARE_TYPE_HR?class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_hr.png":this.m_gnrlInfo.rare_type==RARE_TYPE_SR?class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_s.png":this.m_gnrlInfo.rare_type==RARE_TYPE_SSR&&(class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_ss.png");for(var class_star_layer=new cc.Layer,i=1;i<this.m_gnrlInfo.class_type;++i){var class_type_star=cc.Sprite.create(class_type_star_path);class_type_star.setAnchorPoint(cc.p(0,0)),class_type_star.setPosition(28*(i-1),0),class_star_layer.addChild(class_type_star)}class_star_layer.setContentSize(cc.size(28*(this.m_gnrlInfo.class_type-1),29)),class_star_layer.ignoreAnchorPointForPosition(!1),class_star_layer.setAnchorPoint(cc.p(.5,0)),class_star_layer.setPosition(ccCenter(rare_type_mark).x,67),rare_type_mark.addChild(class_star_layer)}else{rare_type_mark=-1==res_img_yh_exp.indexOf(this.m_gnrlInfo.rare_type)?cc.Sprite.create():cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_exp_"+leadingZeros(this.m_gnrlInfo.rare_type,2)+".png")}return rare_type_mark},onExit:function(){this._super()}}),YunheeIllustInfoLayer=cc.Layer.extend({m_illustImg_Scale:.5,m_illust_img_scale_sp:1,x_now_pos:0,y_now_pos:0,y_start_pos:0,m_illust_img:null,m_lister:null,m_is_voice_playing:!1,m_voice_playing_delta:0,m_illust_idx:0,ctor:function(illust_idx){this._super(),this.m_lister=null,this.m_illustImg_Scale=.5,this.m_illust_img_scale_sp=1,this.x_now_pos=0,this.y_now_pos=0,this.y_start_pos=0,this.m_illust_img=null,this.m_illust_idx=0,this.init(illust_idx)},init:function(illust_idx){this.m_illust_idx=illust_idx;var layer=new cc.Layer;this.addChild(layer);var mt=MasterTable.getInstance();if(USE_SP_3RD_ANNIVERSARY_CARD){(bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_special/bg_special.jpg")).setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(layer)),bg.setScale(2),layer.addChild(bg),this.x_now_pos=ccCenter(bg).x+270,this.y_now_pos=ccCenter(bg).y+160,this.m_illust_img=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_special/im_%d.jpg",illust_idx)),this.m_illust_img.setAnchorPoint(ANCHOR_MIDDLE()),this.m_illust_img.setPosition(this.x_now_pos,this.y_now_pos),this.m_illust_img_scale_sp=640/ccHeight(this.m_illust_img),this.m_illust_img.setScale(this.m_illust_img_scale_sp),this.addChild(this.m_illust_img),(cloud_img=cc.Sprite.create(RES_CDN_DEFULT+"common/img_state_cloud.png")).setAnchorPoint(ANCHOR_TOP_RIGHT()),cloud_img.setPosition(1140,640),this.addChild(cloud_img);var offset_x=ccWidth(bg)+550;(expand_btn=new ccui.Button(RES_CDN_DEFULT+"menu_special/btn_special_zoomin_off.png",RES_CDN_DEFULT+"menu_special/btn_special_zoomin_on.png")).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),expand_btn.setPosition(offset_x,20),this.addChild(expand_btn,1),expand_btn.addClickEventListener(function(sender){this.m_illust_img_scale_sp+=.2,this.ExpandAndReduction_sp(this.m_illust_img_scale_sp)}.bind(this)),offset_x-=ccWidth(expand_btn)+15,(reduction_btn=new ccui.Button(RES_CDN_DEFULT+"menu_special/btn_special_zoomout_off.png",RES_CDN_DEFULT+"menu_special/btn_special_zoomout_on.png")).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),reduction_btn.setPosition(offset_x,20),this.addChild(reduction_btn,1),reduction_btn.addClickEventListener(function(sender){this.m_illust_img_scale_sp-=.2,this.ExpandAndReduction_sp(this.m_illust_img_scale_sp)}.bind(this));var listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(touch,event){var Pos=touch.getLocation(),boundary=this.m_illust_img.getBoundingBox();return!!cc.rectContainsPoint(boundary,Pos)&&(this.y_start_pos=Pos.y,!0)}.bind(this),onTouchMoved:function(touch,event){var Pos=touch.getLocation();this.y_now_pos-=this.y_start_pos-Pos.y,this.y_start_pos=Pos.y;var img_Height=ccHeight(this.m_illust_img)*this.m_illust_img_scale_sp/2;this.y_now_pos<ccHeight(this)/2?this.y_now_pos+img_Height<ccHeight(this)&&(this.y_now_pos=ccHeight(this)-img_Height):this.y_now_pos>ccHeight(this)/2&&0<this.y_now_pos-img_Height&&(this.y_now_pos=img_Height),this.m_illust_img.setPosition(this.x_now_pos+15,this.y_now_pos)}.bind(this),onTouchEnded:function(touch,event){event.stopPropagation()}.bind(this)});cc.eventManager.addListener(listener,this),this.scheduleUpdate()}else{var bg,cloud_img;(bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_special/bg_special.jpg")).setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(layer)),layer.addChild(bg),this.x_now_pos=ccCenter(bg).x,this.y_now_pos=ccCenter(bg).y,this.m_illust_img=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_special/im_%d.jpg",illust_idx)),this.m_illust_img.setAnchorPoint(ANCHOR_MIDDLE()),this.m_illust_img.setPosition(this.x_now_pos,this.y_now_pos),this.m_illustImg_Scale=640/ccHeight(this.m_illust_img),this.m_illust_img.setScale(this.m_illustImg_Scale),bg.addChild(this.m_illust_img),(cloud_img=cc.Sprite.create(RES_CDN_DEFULT+"common/img_state_cloud.png")).setAnchorPoint(ANCHOR_TOP_RIGHT()),cloud_img.setPosition(ccWidth(bg),ccHeight(bg)),bg.addChild(cloud_img,1);var expand_btn,reduction_btn;offset_x=ccWidth(bg)-10;(expand_btn=new ccui.Button(RES_CDN_DEFULT+"menu_special/btn_special_zoomin_off.png",RES_CDN_DEFULT+"menu_special/btn_special_zoomin_on.png")).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),expand_btn.setPosition(offset_x,20),bg.addChild(expand_btn,1),expand_btn.addClickEventListener(function(sender){this.m_illustImg_Scale+=.1,this.ExpandAndReduction(this.m_illustImg_Scale)}.bind(this)),offset_x-=ccWidth(expand_btn)+15,(reduction_btn=new ccui.Button(RES_CDN_DEFULT+"menu_special/btn_special_zoomout_off.png",RES_CDN_DEFULT+"menu_special/btn_special_zoomout_on.png")).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),reduction_btn.setPosition(offset_x,20),bg.addChild(reduction_btn,1),reduction_btn.addClickEventListener(function(sender){this.m_illustImg_Scale-=.1,this.ExpandAndReduction(this.m_illustImg_Scale)}.bind(this));listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(touch,event){var Pos=touch.getLocation(),boundary=this.m_illust_img.getBoundingBox();return!!cc.rectContainsPoint(boundary,Pos)&&(this.y_start_pos=Pos.y,!0)}.bind(this),onTouchMoved:function(touch,event){var Pos=touch.getLocation();this.y_now_pos-=this.y_start_pos-Pos.y,this.y_start_pos=Pos.y;var img_Height=ccHeight(this.m_illust_img)*this.m_illustImg_Scale/2;this.y_now_pos<ccHeight(this)/2?this.y_now_pos+img_Height<ccHeight(this)&&(this.y_now_pos=ccHeight(this)-img_Height):this.y_now_pos>ccHeight(this)/2&&0<this.y_now_pos-img_Height&&(this.y_now_pos=img_Height),this.m_illust_img.setPosition(this.x_now_pos,this.y_now_pos)}.bind(this),onTouchEnded:function(touch,event){event.stopPropagation()}.bind(this)});cc.eventManager.addListener(listener,this),this.addMouseListener(),this.scheduleUpdate()}if(USE_ILLUST_VOICE){var voice_btn=new ccui.Button;voice_btn.loadTextures("btn_purple_circle_voice_off.png","btn_purple_circle_voice_on.png","",ccui.Widget.PLIST_TEXTURE),voice_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),voice_btn.setPosition(10,20),IS_SP_BROWSER?this.addChild(voice_btn,1):bg.addChild(voice_btn,1),voice_btn.addClickEventListener(function(){this.getVoice()}.bind(this)),voice_btn.setVisible(mt.get_illust_Voice_Count(this.m_illust_idx))}return!0},addMouseListener:function(){this.m_mouseListener=cc.EventListener.create({event:cc.EventListener.MOUSE}),this.m_mouseListener.onMouseScroll=function(event){var delta=cc.sys.isNative?1*event.getScrollY():event.getScrollY();return delta=(.001*delta).toFixed(1),this.m_illustImg_Scale=Number(this.m_illustImg_Scale)+Number(delta),this.ExpandAndReduction(this.m_illustImg_Scale),!0}.bind(this),cc.eventManager.addListener(this.m_mouseListener,this)},ExpandAndReduction:function(Scale){if(null!=this.m_illust_img){Scale<640/ccHeight(this.m_illust_img)?(Scale=640/ccHeight(this.m_illust_img),this.m_illustImg_Scale=640/ccHeight(this.m_illust_img)):1<Scale&&(Scale=1,this.m_illustImg_Scale=1),this.m_illust_img.setScale(Scale);var img_Height=ccHeight(this.m_illust_img)*this.m_illustImg_Scale/2;this.y_now_pos<ccHeight(this)/2?this.y_now_pos+img_Height<ccHeight(this)&&(this.y_now_pos=ccHeight(this)-img_Height):this.y_now_pos>ccHeight(this)/2&&0<this.y_now_pos-img_Height&&(this.y_now_pos=img_Height),this.m_illust_img.setPosition(this.x_now_pos,this.y_now_pos)}},ExpandAndReduction_sp:function(Scale){if(null!=this.m_illust_img){Scale<640/ccHeight(this.m_illust_img)?(Scale=640/ccHeight(this.m_illust_img),this.m_illust_img_scale_sp=640/ccHeight(this.m_illust_img)):2<Scale&&(Scale=2,this.m_illust_img_scale_sp=2),this.m_illust_img.setScale(Scale);var img_Height=ccHeight(this.m_illust_img)*this.m_illust_img_scale_sp/2;this.y_now_pos<ccHeight(this)/2?this.y_now_pos+img_Height<ccHeight(this)&&(this.y_now_pos=ccHeight(this)-img_Height):this.y_now_pos>ccHeight(this)/2&&0<this.y_now_pos-img_Height&&(this.y_now_pos=img_Height),this.m_illust_img.setPosition(this.x_now_pos+15,this.y_now_pos)}},getVoice:function(){var mt=MasterTable.getInstance(),audio=AudioEngine.getInstance(),illust_Voice=mt.get_illust_Voice(this.m_illust_idx),voice=illust_Voice[Math.floor(Math.random()*illust_Voice.size())].filename;if(""!=voice&&null!=voice&&null!=voice&&!this.m_is_voice_playing){var path=RES_CDN_SOUND+SND_TYPE+"voice_etc/"+cmString("%s.mp3",voice);audio.playVoice(path),this.m_is_voice_playing=!0,this.m_voice_playing_delta=0}},update:function(dt){this.m_is_voice_playing&&(this.m_voice_playing_delta-=dt,this.m_voice_playing_delta<0&&(this.m_is_voice_playing=!1,this.m_voice_playing_delta=0))},onEnter:function(){this._super()},onExit:function(){this._super()}}),kListAnimationNone=0,LoveItemListItem=cc.Layer.extend({m_isSelected:!1,m_mask:null,m_cancel_sprite:[],m_select_sprite:[],ctor:function(index,item){this._super(),this.m_isSelected=!1,this.m_mask=null,this.m_cancel_sprite=[],this.m_select_sprite=[],this.initLayout(index,item)},initLayout:function(index,item){var list_bg=cc.Sprite.create(RES_CDN_DEFULT+"common/img_list_01.png");list_bg.setAnchorPoint(ZERO()),list_bg.setPosition(ZERO()),this.addChild(list_bg);var icon_frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");if(icon_frame.setAnchorPoint(ZERO()),icon_frame.setPosition(4,5),list_bg.addChild(icon_frame),null!=item.gnrl_id&&0!=item.gnrl_id){var gnrl_icon=null;(gnrl_icon=IS_SP_BROWSER?cc.Sprite.create(RES_CDN_CARD_MEDIUM_NTP+"m_"+item.gnrl_id+".png"):cc.Sprite.create("#m_"+item.gnrl_id+".png")).setScale(DEF_TUMB_SCALE),gnrl_icon.setPosition(33,33),icon_frame.addChild(gnrl_icon)}var icon=cc.Sprite.create(RES_CDN_DEFULT+"icon/love/love_"+leadingZeros(item.love_id,2)+".png");icon.setAnchorPoint(ZERO()),icon.setPosition(4,4),icon_frame.addChild(icon);var item_count_box=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_valuebox.png");item_count_box.setAnchorPoint(ZERO()),item_count_box.setPosition(15,0),list_bg.addChild(item_count_box);var count_label=cmLabel.getLabel(item.count,LABEL_FONT_INDEX.FONT_143);count_label.setAnchorPoint(ANCHOR_MIDDLE()),count_label.setPosition(ccCenter(item_count_box)),item_count_box.addChild(count_label);var name_label=cmLabel.getLabel(item.name,LABEL_FONT_INDEX.FONT_1828);if(name_label.setAnchorPoint(ZERO()),name_label.setPosition(80,43),list_bg.addChild(name_label),null!=item.gnrl_id&&0!=item.gnrl_id){icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(icon_frame));var general=MasterManager.getInstance().get_General(item.gnrl_id);name_label.setString(general.name+" "+item.name)}var nor,nor_label,on,on_label,content_label=cmLabel.getLabel(item.content,LABEL_FONT_INDEX.FONT_1810);content_label.setAnchorPoint(ZERO()),content_label.setPosition(80,16),list_bg.addChild(content_label),(nor=cc.Sprite.create("#btn_05_off.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),nor.setPosition(321,ccCenter(list_bg).y),(nor_label=cmLabel.getLabel("選択",LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_MIDDLE()),nor_label.setPosition(ccCenter(nor)),nor.addChild(nor_label),list_bg.addChild(nor),this.m_select_sprite.push(nor),(on=cc.Sprite.create("#btn_05_on.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),on.setPosition(321,ccCenter(list_bg).y),(on_label=cmLabel.getLabel("選択",LABEL_FONT_INDEX.FONT_242)).setAnchorPoint(ANCHOR_MIDDLE()),on_label.setPosition(ccCenter(on)),on.addChild(on_label),list_bg.addChild(on),on.setVisible(!1),this.m_select_sprite.push(on),(nor=cc.Sprite.create("#btn_04_off.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),nor.setPosition(321,ccCenter(list_bg).y),(nor_label=cmLabel.getLabel("解除",LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_MIDDLE()),nor_label.setPosition(ccCenter(nor)),nor.addChild(nor_label),list_bg.addChild(nor),nor.setVisible(!1),this.m_cancel_sprite.push(nor),(on=cc.Sprite.create("#btn_04_on.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),on.setPosition(321,ccCenter(list_bg).y),(on_label=cmLabel.getLabel("解除",LABEL_FONT_INDEX.FONT_242)).setAnchorPoint(ANCHOR_MIDDLE()),on_label.setPosition(ccCenter(on)),on.addChild(on_label),list_bg.addChild(on),on.setVisible(!1),this.m_cancel_sprite.push(on),this.m_info=item,this.m_mask=cc.Sprite.create(RES_CDN_DEFULT+"common/img_list_mask.png"),this.m_mask.setAnchorPoint(ZERO()),this.m_mask.setPosition(ZERO()),this.m_mask.setOpacity(0),list_bg.addChild(this.m_mask),this.setContentSize(ccSize(list_bg))},onNormalButton:function(){this.m_isSelected?(this.m_cancel_sprite[1].setVisible(!1),this.m_cancel_sprite[0].setVisible(!0),this.m_select_sprite[1].setVisible(!1),this.m_select_sprite[0].setVisible(!1)):(this.m_cancel_sprite[1].setVisible(!1),this.m_cancel_sprite[0].setVisible(!1),this.m_select_sprite[1].setVisible(!1),this.m_select_sprite[0].setVisible(!0))},onClickButton:function(){this.m_isSelected?(this.m_cancel_sprite[1].setVisible(!0),this.m_cancel_sprite[0].setVisible(!1),this.m_select_sprite[1].setVisible(!1)):(this.m_cancel_sprite[1].setVisible(!1),this.m_cancel_sprite[0].setVisible(!1),this.m_select_sprite[1].setVisible(!0)),this.m_select_sprite[0].setVisible(!1)},setSelected:function(){this.m_cancel_sprite[1].setVisible(!1),this.m_cancel_sprite[0].setVisible(!0),this.m_select_sprite[1].setVisible(!1),this.m_select_sprite[0].setVisible(!1),this.m_isSelected=!0},setCanceled:function(){this.m_cancel_sprite[1].setVisible(!1),this.m_cancel_sprite[0].setVisible(!1),this.m_select_sprite[1].setVisible(!1),this.m_select_sprite[0].setVisible(!0),this.m_isSelected=!1},getButtonRect:function(){return this.m_select_sprite[0].getBoundingBox()},isSelected:function(){return this.m_isSelected},getLoveItemInfo:function(){return this.m_info},setTutorialTagByBtn:function(tuto_tag){this.m_select_sprite[0].setTutorialTag(tuto_tag)},getButtonSprite:function(){return this.m_select_sprite[0]}}),YunheelLovelItemEnum={loveup_start:400,btn_show_help:401},YunheeLoveItemLayer=cc.Layer.extend({m_loveItemList:[],m_loveListItemLayers:[],m_after_level:0,m_isLoveItemSelected:!1,m_isLoveUpGuageInit:!1,m_loveItemCountLabel:null,m_loveItemSelectCount:0,m_loveUpNeedGold:0,m_orgin_level:0,m_orgin_exp:0,m_exp_prcnt:0,m_base_gauge_value:0,m_after_prcnt:0,m_rightBoxLayer:null,m_leftBottomLayer:null,m_loveInfoLayer:null,m_listLayer:null,m_loveUpNeedGoldLabel:null,m_crrntLevelLabel:null,m_loveUpLevelLabel:null,m_expPrcntLabel:null,m_levelContentLabel:null,m_loveSlider:null,m_exp_base_energy:null,m_exp_energy:null,m_maxLevelItemCount:0,m_loveItemBoxMask:null,m_isButtonTouch:!1,m_gnrlKey:null,m_loveUpInfo:null,ctor:function(){this._super(),this.m_gnrlKey={gnrl_id:0,gnrl_num:0},this.m_loveItemList=[],this.m_loveListItemLayers=[],this.m_loveUpInfo=new db.UserGeneralLevelUpInfo},initLayout:function(){this.m_leftBottomLayer=this.getLeftBottomLayer(),this.m_leftBottomLayer.setPosition(ZERO()),this.addChild(this.m_leftBottomLayer),this.m_rightBoxLayer=this.getRightBoxLayer(),this.m_rightBoxLayer.ignoreAnchorPointForPosition(!1),this.m_rightBoxLayer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_rightBoxLayer.setPosition(ccWidth(this),0),this.addChild(this.m_rightBoxLayer)},getLeftBottomLayer:function(){var layer=new cc.Layer;layer.setContentSize(ccWidth(this)-478,ccHeight(this));var gaugeLayer=this.getLoveGaugeLayer();gaugeLayer.ignoreAnchorPointForPosition(!1),gaugeLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),gaugeLayer.setPosition(ccCenter(layer).x,76),layer.addChild(gaugeLayer);var levelup_btn=new LabelButton("btn_03_off.png","btn_03_on.png","",ccui.Widget.PLIST_TEXTURE);levelup_btn.setFont(LABEL_FONT_INDEX.FONT_241),levelup_btn.setString("好感度UP"),levelup_btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),levelup_btn.setPosition(ccCenter(layer).x,16),levelup_btn.setOffsetX(-100),layer.addChild(levelup_btn),levelup_btn.addClickEventListener(function(sender){this.m_isActionExpGauge||MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheelLovelItemEnum.loveup_start)}.bind(this)),levelup_btn.setTutorialTag(TUTORIAL_TAG_PAGE_3_LOVE_LEVEL_UP_BTN);var btn_select_1=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_1.png",RectZero());btn_select_1.setContentSize(444,60),btn_select_1.setAnchorPoint(ANCHOR_MIDDLE()),btn_select_1.setPosition(ccCenter(levelup_btn)),levelup_btn.addChild(btn_select_1);var btn_select_2=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_2.png",RectZero());btn_select_2.setContentSize(444,60),btn_select_2.setAnchorPoint(ANCHOR_MIDDLE()),btn_select_2.setPosition(ccCenter(levelup_btn)),levelup_btn.addChild(btn_select_2);var fadeout=new cc.FadeOut(1),fadein=new cc.FadeIn(1),seq=new cc.Sequence(fadeout,fadein),repeat=new cc.RepeatForever(seq);btn_select_2.runAction(repeat);var gold_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero());gold_box.setContentSize(123,38),gold_box.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),gold_box.setPosition(197,ccCenter(levelup_btn).y),levelup_btn.addChild(gold_box);var gold_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_sell_gold.png");return gold_icon.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),gold_icon.setPosition(180,ccCenter(levelup_btn).y),levelup_btn.addChild(gold_icon),this.m_loveUpNeedGoldLabel=cmLabel.getLabel(this.m_loveUpNeedGold,LABEL_FONT_INDEX.FONT_247),this.m_loveUpNeedGoldLabel.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_loveUpNeedGoldLabel.setPosition(gold_box.width-10,ccCenter(gold_box).y),gold_box.addChild(this.m_loveUpNeedGoldLabel),layer},getLoveUpNeedGold:function(){return this.m_loveUpNeedGold},isExistMaterial:function(){return 0!=this.m_loveItemSelectCount},getLoveUpMaterailItemKey:function(){var key={};return key.gnrl_id=this.m_selectedItemInfo.gnrl_id,key.love_id=this.m_selectedItemInfo.love_id,key.count=this.m_loveItemSelectCount,key},setUserGeneralInfo:function(info,list){this.m_gnrlInfo=info,this.m_gnrlKey.gnrl_id=info.gnrl_id,this.m_gnrlKey.gnrl_num=info.gnrl_num,this.m_loveItemList=list,this.m_after_level=this.m_gnrlInfo.love_level,this.m_orgin_exp=this.m_gnrlInfo.love_exp},getLoveGaugeLayer:function(){var layer=new cc.Layer,gauge_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_2.png",RectZero());gauge_box.setContentSize(444,90),gauge_box.setAnchorPoint(ZERO()),gauge_box.setPosition(ZERO()),layer.addChild(gauge_box);var love_stat_title=cmLabel.getLabel("好感度",LABEL_FONT_INDEX.FONT_201);love_stat_title.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),love_stat_title.setPosition(17,60),gauge_box.addChild(love_stat_title);var arrow=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_arrow_2.png");arrow.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),arrow.setPosition(125,60),gauge_box.addChild(arrow),this.m_crrntLevelLabel=cmLabel.getLabel(this.m_gnrlInfo.love_level,LABEL_FONT_INDEX.FONT_261),this.m_crrntLevelLabel.setAnchorPoint(ANCHOR_MIDDLE()),this.m_crrntLevelLabel.setPosition(102,60),gauge_box.addChild(this.m_crrntLevelLabel),this.m_loveUpLevelLabel=cmLabel.getLabel(this.m_gnrlInfo.love_level+"/"+YUNHEE_MAX_LOVE_LEVEL,LABEL_FONT_INDEX.FONT_261),this.m_loveUpLevelLabel.setAnchorPoint(ANCHOR_MIDDLE()),this.m_loveUpLevelLabel.setPosition(192,60),gauge_box.addChild(this.m_loveUpLevelLabel),this.m_exp_prcnt=GeneralService.getInstance().getGeneralLoveUpExpPrcnt(this.m_gnrlKey),this.m_orgin_exp=this.m_gnrlInfo.love_exp,this.m_orgin_level=this.m_gnrlInfo.love_level,this.m_loveUpInfo.rare_type=this.m_gnrlInfo.rare_type,this.m_loveUpInfo.level=this.m_gnrlInfo.love_level,this.m_loveUpInfo.level_exp=this.m_gnrlInfo.love_exp;var exp_bar_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero());exp_bar_box.setContentSize(169,16),exp_bar_box.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),exp_bar_box.setPosition(245,60),gauge_box.addChild(exp_bar_box),this.m_exp_prcnt=cc.clampf(this.m_exp_prcnt,0,1);var gauge_value=this.m_exp_prcnt*MAX_GAUGE_VALUE;if(this.m_base_gauge_value=gauge_value,this.m_exp_energy=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_pink.png",RectZero()),this.m_exp_energy.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_exp_energy.setPosition(3,ccCenter(exp_bar_box).y),exp_bar_box.addChild(this.m_exp_energy),this.m_exp_energy.setScaleX(gauge_value),this.m_exp_base_energy=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green.png",RectZero()),this.m_exp_base_energy.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_exp_base_energy.setPosition(3,ccCenter(exp_bar_box).y),exp_bar_box.addChild(this.m_exp_base_energy),this.m_exp_base_energy.setScaleX(gauge_value),0!=this.m_exp_prcnt){var _prcnt=100*this.m_exp_prcnt;this.m_expPrcntLabel=cmLabel.getLabel(_prcnt.toFixed(1)+"%",LABEL_FONT_INDEX.FONT_161)}else this.m_expPrcntLabel=cmLabel.getLabel(this.m_exp_prcnt+"%",LABEL_FONT_INDEX.FONT_161);this.m_expPrcntLabel.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_expPrcntLabel.setPosition(ccWidth(exp_bar_box)/2,exp_bar_box.height-8),exp_bar_box.addChild(this.m_expPrcntLabel),this.m_gnrlInfo.love_level>=YUNHEE_MAX_LOVE_LEVEL&&(this.m_expPrcntLabel.setString("MAX"),this.m_exp_base_energy.setScaleX(1));var love_stat=GeneralService.getInstance().getLoveStat(this.m_gnrlInfo.love_stat_group,this.m_gnrlInfo.love_level);return this.m_levelContentLabel=cmLabel.getLabel(love_stat.content,LABEL_FONT_INDEX.FONT_165),this.m_levelContentLabel.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_levelContentLabel.setPosition(ccCenter(gauge_box).x,17),gauge_box.addChild(this.m_levelContentLabel),layer.setContentSize(ccSize(gauge_box)),layer},getRightBoxLayer:function(){var layer=new cc.Layer,right_bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));right_bg_box.setContentSize(478,568),right_bg_box.setAnchorPoint(ZERO()),right_bg_box.setPosition(ZERO()),layer.addChild(right_bg_box),layer.setContentSize(ccSize(right_bg_box));var left_navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");left_navi.setAnchorPoint(ZERO()),left_navi.setPosition(8,509),layer.addChild(left_navi,100);var title_label=cmLabel.getLabel("好感度",LABEL_FONT_INDEX.FONT_261);title_label.setAnchorPoint(ANCHOR_MIDDLE()),title_label.setPosition(ccCenter(left_navi).x+0,ccCenter(left_navi).y+3),left_navi.addChild(title_label);var help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE);(help_btn.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),help_btn.setPosition(416,ccCenter(left_navi).y+4),left_navi.addChild(help_btn),help_btn.addClickEventListener(function(sender){this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheelLovelItemEnum.btn_show_help)},0,"btn_show_help")}.bind(this)),!this.m_loveItemList.length<=0)?(this.m_listLayer=this.getLoveItemListLayer(),this.m_listLayer.setAnchorPoint(ZERO()),this.m_listLayer.setPosition(18,220),layer.addChild(this.m_listLayer)):((info_label=cmLabel.getLabel("好感度アイテムがありません。",LABEL_FONT_INDEX.FONT_261)).setAnchorPoint(ANCHOR_MIDDLE()),info_label.setPosition(ccCenter(layer).x+0,ccCenter(layer).y+100),layer.addChild(info_label));this.m_loveInfoLayer=this.getRightLoveInfoLayer(),this.m_loveInfoLayer.setPosition(18,116),layer.addChild(this.m_loveInfoLayer);var info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());info_box.setAnchorPoint(ZERO()),info_box.setContentSize(458,40),info_box.setPosition(10,76),layer.addChild(info_box);var info_label,info_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_friend/img_friend_text.png");return info_icon.setAnchorPoint(ZERO()),info_icon.setPosition(95,4),info_box.addChild(info_icon),(info_label=cmLabel.getLabel(" 同じ兵科の素材は1.5倍ボーナス",LABEL_FONT_INDEX.FONT_1613)).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),info_label.setPosition(130,ccCenter(info_box).y),info_box.addChild(info_label),layer},getLoveItemListLayer:function(){this.m_loveListItemLayers=[];var listLayer=new VListLayer;listLayer.setContentSize(447,277),listLayer.setItemCount(this.m_loveItemList.length),listLayer.setAnimationType(kListAnimationNone);var is_tutorial_valid=!1;return listLayer.getItemNode=function(index,contentSize,m){var item=this.m_loveItemList[index],layer=new LoveItemListItem(index,item);return this.m_loveListItemLayers.push(layer),layer.setTag(index),is_tutorial_valid||(layer.setTutorialTagByBtn(TUTORIAL_TAG_PAGE_3_CHOICE_LOVE_ITEM),is_tutorial_valid=!0),layer}.bind(this),listLayer.initLayout(),listLayer.onItemTouchBeginPos=function(index,pos){var layer=this.m_loveListItemLayers[index],rect=layer.getButtonRect();if(cc.rectContainsPoint(rect,pos)){var tutorial=TutorialContextV2.getInstance();return 0==tutorial.IsCompleteAllTutorial()&&tutorial.IsLoaded()&&tutorial.getCurrentTutorialStep().tagid!=layer.getButtonSprite().getTutorialTag()?this.m_isButtonTouch=!1:(layer.onClickButton(),this.m_isButtonTouch=!0)}return this.m_isButtonTouch=!1}.bind(this),listLayer.onItemTouchMoved=function(){},listLayer.onItemTouchEnd=function(index){if(this.m_isButtonTouch){var layer=this.m_loveListItemLayers[index];layer.onNormalButton();var tutorial=TutorialContextV2.getInstance();if(0==tutorial.IsCompleteAllTutorial()&&tutorial.IsLoaded())tutorial.getCurrentTutorialStep().tagid==layer.getButtonSprite().getTutorialTag()&&MainObserver.getInstance().postNotification(NOTIFICATION_TUTORIAL,message_complete_tutorial);AudioEngine.getInstance().playNormaButtonSound(),MainObserver.getInstance().postNotification(LOVE_ITEM_SELECT,index)}}.bind(this),listLayer.onMouseScroll=function(event){return!0},listLayer},getRightLoveInfoLayer:function(){var layer=new cc.Layer,info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",cc.Rect(20,20,20,20));info_box.setContentSize(444,100),info_box.setAnchorPoint(ZERO()),info_box.setPosition(ZERO()),layer.addChild(info_box);var item_count_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_feel_veluebox.png");item_count_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),item_count_box.setPosition(ccCenter(info_box).x,46),info_box.addChild(item_count_box),this.m_loveItemCountLabel=cmLabel.getLabel(0,LABEL_FONT_INDEX.FONT_261),this.m_loveItemCountLabel.setAnchorPoint(ANCHOR_MIDDLE()),this.m_loveItemCountLabel.setPosition(ccCenter(item_count_box)),item_count_box.addChild(this.m_loveItemCountLabel);var itemPlusBtn=new ccui.Button;itemPlusBtn.loadTextures("btn_spinner_plus_off.png","btn_spinner_plus_on.png","",ccui.Widget.PLIST_TEXTURE),itemPlusBtn.setAnchorPoint(ZERO()),itemPlusBtn.setPosition(311,41),info_box.addChild(itemPlusBtn),itemPlusBtn.addClickEventListener(function(sender){this.m_isLoveItemSelected&&this.onLoveItemPlus()}.bind(this)),itemPlusBtn.setTutorialTag(TUTORIAL_TAG_PAGE_3_LOVE_LEVEL_UP_PLUS);var itemMinusBtn=new ccui.Button;return itemMinusBtn.loadTextures("btn_spinner_minus_off.png","btn_spinner_minus_on.png","",ccui.Widget.PLIST_TEXTURE),itemMinusBtn.setAnchorPoint(ZERO()),itemMinusBtn.setPosition(85,41),info_box.addChild(itemMinusBtn),itemMinusBtn.addClickEventListener(function(sender){this.m_isLoveItemSelected&&this.onLoveItemMinus()}.bind(this)),this.m_loveSlider=new ccui.Slider,this.m_loveSlider.setTouchEnabled(!0),this.m_loveSlider.setScale9Enabled(!0),this.m_loveSlider.loadBarTexture(RES_CDN_DEFULT+"menu_yh/img_yh_feel_gauge_mask.png"),this.m_loveSlider.loadSlidBallTextures(RES_CDN_DEFULT+"menu_yh/img_yh_feel_gauge_toggle.png",RES_CDN_DEFULT+"menu_yh/img_yh_feel_gauge_toggle.png",""),this.m_loveSlider.loadProgressBarTexture(RES_CDN_DEFULT+"menu_yh/img_yh_feel_gauge_purple.png"),this.m_loveSlider.setCapInsets(cc.rect(0,0,0,0)),this.m_loveSlider.setContentSize(cc.size(274,16)),this.m_loveSlider.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_loveSlider.setPosition(ccCenter(info_box).x,15),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_loveSlider.setEnabled(!1),this.m_loveSlider.addEventListener(this.slideCallback,this),info_box.addChild(this.m_loveSlider),layer.setContentSize(ccSize(info_box)),IS_SP_BROWSER?(this.m_loveItemBoxMask=new ccui.Button,this.m_loveItemBoxMask.loadTextures(RES_CDN_DEFULT+"menu_yh/img_yh_info_box_mask.png",RES_CDN_DEFULT+"menu_yh/img_yh_info_box_mask.png"),this.m_loveItemBoxMask.setAnchorPoint(ZERO()),this.m_loveItemBoxMask.setPosition(ZERO()),this.m_loveItemBoxMask.setScale(2)):(this.m_loveItemBoxMask=new ccui.Button,this.m_loveItemBoxMask.loadTextures(RES_CDN_DEFULT+"menu_yh/img_yh_info_box_mask.png",RES_CDN_DEFULT+"menu_yh/img_yh_info_box_mask.png"),this.m_loveItemBoxMask.setAnchorPoint(ZERO()),this.m_loveItemBoxMask.setPosition(ZERO())),info_box.addChild(this.m_loveItemBoxMask),layer},slideCallback:function(sender,type){switch(type){case ccui.Slider.EVENT_PERCENT_CHANGED:var percent=sender.getPercent(),count=(this.m_selectedItemInfo.count*percent*.01).toFixed(1);this.m_loveItemSelectCount=Math.floor(count),this.addLoveExp()}},addLoveExp:function(){this.m_loveItemSelectCount>this.m_maxLevelItemCount&&(this.m_loveItemSelectCount=this.m_maxLevelItemCount),this.m_loveItemSelectCount>this.m_selectedItemInfo.count&&(this.m_loveItemSelectCount=this.m_selectedItemInfo.count);var percent=(this.m_loveItemSelectCount/this.m_selectedItemInfo.count*100).toFixed(1);this.m_loveSlider.setPercent(percent),this.m_loveItemCountLabel.setString(this.m_loveItemSelectCount),this.m_isLoveUpGuageInit||this.setAddLoveUpExpGauge(this.m_loveItemSelectCount)},setAddLoveUpExpGauge:function(count){var mtrl_exp,userInfo=NetService().get_UserItemInfo_V2();mtrl_exp=(obj=this.getLoveItemExp(this.m_selectedItemInfo,count)).exp,this.m_loveUpNeedGold=obj.need_gold,this.m_loveUpNeedGoldLabel.setString(this.m_loveUpNeedGold),userInfo.gold_cnt<this.m_loveUpNeedGold?this.m_loveUpNeedGoldLabel.setColor(cc.color(244,31,31)):this.m_loveUpNeedGoldLabel.setColor(cc.color(255,181,84));var obj=GeneralService.getInstance().geGeneralLoveUpAfterInfo(this.m_loveUpInfo,mtrl_exp,this.m_after_prcnt,this.m_after_level);this.m_after_prcnt=obj.prcnt,this.m_after_level=obj.level,this.runActionLevelupAddGauge()},setReloadData:function(){this.initLoveItem(),this.initLeftBottmLayer(),this.m_loveItemBoxMask.setVisible(!0),this.m_loveSlider.setPercent(0)},setLoveUpComplte:function(){if(this.initLoveItem(),this.initLeftBottmLayer(),null!=this.m_listLayer&&(this.m_listLayer.removeFromParent(),this.m_listLayer=null,this.m_loveListItemLayers=[]),0<this.m_loveItemList.length)this.m_listLayer=this.getLoveItemListLayer(),this.m_listLayer.setAnchorPoint(ZERO()),this.m_listLayer.setPosition(18,220),this.m_rightBoxLayer.addChild(this.m_listLayer);else{var info_label=cmLabel.getLabel("好感度アイテムがありません。",LABEL_FONT_INDEX.FONT_261);info_label.setAnchorPoint(ANCHOR_MIDDLE()),info_label.setPosition(ccCenter(this.m_rightBoxLayer).x,ccCenter(this.m_rightBoxLayer).y+100),this.m_rightBoxLayer.addChild(info_label)}this.m_loveInfoLayer.removeFromParent(),this.m_loveInfoLayer=this.getRightLoveInfoLayer(),this.m_loveInfoLayer.setPosition(18,116),this.m_rightBoxLayer.addChild(this.m_loveInfoLayer)},getLoveItemExp:function(info,count){var exp=this.m_selectedItemInfo.point*count,need_gold=this.m_selectedItemInfo.need_gold*count;return this.m_selectedItemInfo.arm_service_type==this.m_gnrlInfo.arm_service_type&&(exp=exp*this.m_selectedItemInfo.point_prcnt/100),{exp:exp,need_gold:need_gold}},runActionLevelupAddGauge:function(){var gauge_value=this.m_after_prcnt*MAX_GAUGE_VALUE;this.m_exp_energy.setScaleX(gauge_value),this.m_after_level>=YUNHEE_MAX_LOVE_LEVEL?(this.m_expPrcntLabel.setString("MAX"),this.m_exp_energy.setScaleX(MAX_GAUGE_VALUE)):0!=this.m_after_prcnt?this.m_expPrcntLabel.setString((100*this.m_after_prcnt).toFixed(1)+"%"):this.m_expPrcntLabel.setString(this.m_after_prcnt.toFixed(1)+"%"),this.m_loveUpLevelLabel.setString(this.m_after_level+"/"+YUNHEE_MAX_LOVE_LEVEL),this.m_gnrlInfo.love_level!=this.m_after_level?(this.m_loveUpLevelLabel.setColor(COLOR(2613)),this.m_exp_base_energy.setVisible(!1)):(this.m_loveUpLevelLabel.setColor(COLOR(261)),this.m_exp_base_energy.setVisible(!0)),this.setLoveStatLabel(this.m_after_level)},setLoveStatLabel:function(level){var love_stat=GeneralService.getInstance().getLoveStat(this.m_gnrlInfo.love_stat_group,level);this.m_levelContentLabel.setString(love_stat.content)},onLoveItemMinus:function(){this.m_loveItemSelectCount--,this.m_loveItemSelectCount<=0&&(this.m_loveItemSelectCount=0);var percent=(this.m_loveItemSelectCount/this.m_selectedItemInfo.count*100).toFixed(1);this.m_loveSlider.setPercent(percent),this.m_loveItemCountLabel.setString(this.m_loveItemSelectCount),this.m_isLoveUpGuageInit||this.setAddLoveUpExpGauge(this.m_loveItemSelectCount)},onLoveItemPlus:function(){this.m_loveItemSelectCount++,this.addLoveExp()},setSelectedLoveItem:function(tag){this.m_isLoveItemSelected=!1,this.m_isLoveUpGuageInit=!0,this.initLoveItem();for(var idx=0;idx<this.m_loveListItemLayers.length;idx++){var layer=this.m_loveListItemLayers[idx];if(layer.getTag()==tag)if(layer.isSelected())layer.setCanceled();else{if(layer.setSelected(),this.m_isLoveItemSelected=!0,this.m_selectedItemInfo=layer.getLoveItemInfo(),TutorialContextV2.getInstance().IsCompleteAllTutorial())for(var now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),nn=moment(now).valueOf(),list_Global_Booster_Event_V2=NetService().get_Global_Booster_Event(),i=0;idx<list_Global_Booster_Event_V2.length;i++){var b=list_Global_Booster_Event_V2[i],bt=moment(b.begin_dt),et=moment(b.end_dt),bb=bt.valueOf(),ee=et.valueOf();if(bb<=nn&&nn<=ee&&b.booster_type==BOOSTER_TYPE_V2_YUNHEE&&b.variation_type==BOOSTER_VARIATION_TYPE_V2_GAIN_INC&&b.item_type==BOOSTER_ITEM_TYPE_V2_LOVE_EXP){this.m_selectedItemInfo.point+=this.m_selectedItemInfo.point*b.variation_value/100;break}}this.m_maxLevelItemCount=this.getMaxLevelItemCountPrcnt()}else layer.setCanceled()}this.m_isLoveItemSelected?this.m_loveItemBoxMask.setVisible(!1):this.m_loveItemBoxMask.setVisible(!0),this.m_loveItemSelectCount=0,this.m_loveItemCountLabel.setString(this.m_loveItemSelectCount),this.m_loveSlider.setPercent(0),this.initLeftBottmLayer()},initLeftBottmLayer:function(){this.m_isLoveUpGuageInit=!1,this.m_loveUpInfo.rare_type=this.m_gnrlInfo.rare_type,this.m_loveUpInfo.level=this.m_gnrlInfo.love_level,this.m_loveUpInfo.level_exp=this.m_gnrlInfo.love_exp,this.m_leftBottomLayer.removeFromParent(),this.m_leftBottomLayer=this.getLeftBottomLayer(),this.m_leftBottomLayer.setPosition(ZERO()),this.addChild(this.m_leftBottomLayer)},initLoveItem:function(){this.m_isLoveItemSelected=!1,this.m_loveItemSelectCount=0,this.m_loveUpNeedGold=0},getMaxLevelItemCountPrcnt:function(){return GeneralService.getInstance().getLoveUpMaxLevelNeedItemCount(this.m_gnrlInfo,this.m_selectedItemInfo)}}),MAX_GAUGE_VALUE=166,MaterialListCell=cc.TableViewCell.extend({m_callback:null,m_columns:[],m_in_troops_tags:[],m_in_camp_tags:[],m_gnrl_list:[],ctor:function(_callback){this._super(),this.m_columns=[],this.m_in_troops_tags=[],this.m_in_camp_tags=[],this.m_gnrl_list=[],this.init(_callback)},init:function(_callback){this.m_callback=_callback;var size=cc.size(456,108);this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(size);for(var offset_x=57,i=0;i<4;i++){var box=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame_2.png");box.setContentSize(98,98),box.setAnchorPoint(ANCHOR_MIDDLE()),box.setPosition(offset_x,.5*size.height),this.addChild(box),this.m_columns.push(box);var t_tag=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_equip.png");t_tag.setAnchorPoint(ANCHOR_MIDDLE()),t_tag.setPosition(offset_x,.5*size.height),this.addChild(t_tag),t_tag.setVisible(!1),this.m_in_troops_tags.push(t_tag);var c_tag=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_equip_3.png");c_tag.setAnchorPoint(ANCHOR_MIDDLE()),c_tag.setPosition(offset_x,.5*size.height),this.addChild(c_tag),c_tag.setVisible(!1),this.m_in_camp_tags.push(c_tag),offset_x+=114}return!0},setGnrlDatas:function(list){this.m_gnrl_list=list,this.updateGnrlIcons()},updateGnrlIcons:function(){TutorialContextV2.getInstance().initLevelUpMaterialValid();for(var i=0;i<this.m_columns.length;i++){var spr=this.m_columns[i],t_tag=this.m_in_troops_tags[i],c_tag=this.m_in_camp_tags[i];if(i<this.m_gnrl_list.length){var gnrl=this.m_gnrl_list[i];spr.setVisible(!0),t_tag.setVisible(gnrl.using_in_troops),c_tag.setVisible(gnrl.using_in_camp);var info=new db.UserGeneralInfo;this.convertData(gnrl,info);var card=(new Card).createCard(info,CARD_TYPE.type_common_card);spr.removeAllChildren(),card.setAnchorPoint(ANCHOR_MIDDLE()),card.setPosition(ccCenter(spr)),spr.addChild(card);if(gnrl.isPartner){var partner=cc.Sprite.create(RES_CDN_DEFULT+"card_card_img/img_card_leader.png");partner.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),partner.setPosition(95,78),card.addChild(partner)}if(gnrl.is_friend_partner){var icon=cc.Sprite.create(RES_CDN_DEFULT+"card_card_img/img_card_friend_partner.png");icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),icon.setPosition(95,78),card.addChild(icon)}if(gnrl.is_selected){var select_img=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_select_2.png");select_img.setAnchorPoint(ZERO()),card.addChild(select_img),select_img.setOpacity(0);var fadeIn=new cc.FadeIn(.7),fadeOut=new cc.FadeOut(.7,90),seq=new cc.Sequence(fadeIn,fadeOut),repeat=new cc.RepeatForever(seq);select_img.runAction(repeat)}if(gnrl.is_sell_selected){var check_img=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_check.png");check_img.setAnchorPoint(ZERO()),check_img.setPosition(ZERO()),card.addChild(check_img)}var tutorial=TutorialContextV2.getInstance();tutorial.IsCompleteAllTutorial()?spr.setTutorialTag(cc.NODE_TAG_INVALID):tutorial.getLevelUpMaterialValid()||(gnrl.using_in_camp||gnrl.using_in_troops?spr.setTutorialTag(cc.NODE_TAG_INVALID):spr.setTutorialTag(TUTORIAL_TAG_PAGE_2_LEVEL_UP_MATERIAL),tutorial.setLevelUpMaterialValid())}else spr.setVisible(!1),t_tag.setVisible(!1),c_tag.setVisible(!1)}},touchPosCell:function(pos,world_pos){for(var tutorial=TutorialContextV2.getInstance(),i=0;i<this.m_columns.length;i++){var box=this.m_columns[i];if(box.isVisible()){var r=box.getBoundingBox();if(cc.rectContainsPoint(r,pos)){AudioEngine.getInstance().playNormaButtonSound(),box.stopAllActions();var zoom=new cc.ScaleTo(.05,1.1),zoomout=new cc.ScaleTo(.05,1),seq=new cc.Sequence(zoom,zoomout);box.runAction(seq),tutorial.IsCompleteAllTutorial()?this.clickGnrlBtn(i):tutorial.IsValidTouchEvent(box.getTutorialTag(),world_pos)&&box.getTutorialTag()==TUTORIAL_TAG_PAGE_2_LEVEL_UP_MATERIAL&&this.clickGnrlBtn(i)}}}},clickGnrlBtn:function(tag){tag<this.m_gnrl_list.length&&this.m_callback(this.m_gnrl_list[tag])},convertData:function(input,output){output.gnrl_id=input.gnrl_id,output.is_lock=input.is_lock,output.is_max_level=input.isMaxLevel,output.is_partner=input.isPartner,output.level=input.level,output.gnrl_level=input.level,output.limit_step_id=input.limit_step_id,output.love_level=input.love_level,output.is_enable_evolve=input.isEnabledEvolve||input.isEnabledLimitOver,output.gender_type=input.gender_type,output.is_sell_selected=input.is_sell_selected}}),YunheeLevelUpEnum={btn_sort:300,is_max_level:301,max_material:302,levelup_start:303,btn_show_help:304,tab_yunhee:305,tab_material:306},YunheeLevelUpTapTypeEnum={tab_type_yunhee:1,tab_type_material:2},YunheeLevelUpLayer=cc.Layer.extend({m_isActionExpGauge:!1,m_isSortDesc:!1,m_isSortBtnVisible:!1,m_orgin_level:0,m_after_level:0,m_levelUpNeedGold:0,m_exp_prcnt:0,m_after_prcnt:0,m_orgin_exp:0,m_sort:1,m_tableView:null,m_sortLayer:null,m_rightBoxLayer:null,m_leftBottomLayer:null,m_btn_sort:null,m_btn_sort_2:null,m_help_btn:null,m_levelupCountLabel:null,m_levelupNeedGoldLabel:null,m_crrntLevelLabel:null,m_levelUpLevelLabel:null,m_crrntAttkLabel:null,m_levelUpAttkLabel:null,m_crrntDefLabel:null,m_levelUpDefLabel:null,m_crrntHpLabel:null,m_levelUpHpLabel:null,m_crrntSpLabel:null,m_levelUpSpLabel:null,m_expPrcntLabel:null,m_exp_base_energy:null,m_exp_energy:null,m_info_label:null,m_base_gauge_value:0,m_levelup_btn:null,m_mtrl_keys:[],m_lvupInfo:{},m_tab_type:0,m_steppingTutorial:!1,m_tab_btns:[],ctor:function(){this._super(),this.m_gnrlKey={gnrl_id:0,gnrl_num:0},this.m_mtrl_keys=[],this.m_tab_type=YunheeLevelUpTapTypeEnum.tab_type_material,this.m_steppingTutorial=!1},initLayout:function(){this.m_leftBottomLayer=this.getLeftLevelUpBottomLayer(),this.m_leftBottomLayer.setPosition(ZERO()),this.addChild(this.m_leftBottomLayer),this.m_rightBoxLayer=this.getRightBoxLayer(),this.m_rightBoxLayer.ignoreAnchorPointForPosition(!1),this.m_rightBoxLayer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_rightBoxLayer.setPosition(this.width,0),this.addChild(this.m_rightBoxLayer),TutorialContextV2.getInstance().IsCompleteAllTutorial()?this.m_tab_type=YunheeLevelUpTapTypeEnum.tab_type_material:this.m_tab_type=YunheeLevelUpTapTypeEnum.tab_type_yunhee,this.setYunheeDivisionTab(this.m_tab_type)},getLeftLevelUpBottomLayer:function(){var layer=new cc.Layer;layer.setContentSize(ccWidth(this)-478,400);var gaugeLayer=this.getLevelUpGaugeLayer();gaugeLayer.ignoreAnchorPointForPosition(!1),gaugeLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),gaugeLayer.setPosition(ccCenter(layer).x,191),layer.addChild(gaugeLayer);var statLayer=this.getLevelUpStatLayer();statLayer.ignoreAnchorPointForPosition(!1),statLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),statLayer.setPosition(ccCenter(layer).x,76),layer.addChild(statLayer),this.m_levelup_btn=new LabelButton("btn_03_off.png","btn_03_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_levelup_btn.setFont(LABEL_FONT_INDEX.FONT_241),this.m_levelup_btn.setString("強化"),this.m_levelup_btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_levelup_btn.setPosition(ccCenter(layer).x,16),this.m_levelup_btn.setOffsetX(-100),layer.addChild(this.m_levelup_btn),this.m_levelup_btn.addClickEventListener(function(sender){if(this.m_levelup_btn.setEnabled(!1),!this.m_isActionExpGauge){this.m_steppingTutorial||MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeLevelUpEnum.levelup_start);var tutorial=TutorialContextV2.getInstance();if(!tutorial.IsCompleteAllTutorial()){var step=tutorial.getCurrentTutorialStep();step.tutorial_page==TUTORIAL_PAGE_2_LEVEL_UP&&13==step.tutorial_step&&(this.m_steppingTutorial=!0)}}}.bind(this)),this.m_levelup_btn.setTutorialTag(TUTORIAL_TAG_PAGE_2_LEVEL_UP_BTN);var btn_select_1=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_1.png",RectZero());btn_select_1.setContentSize(444,60),btn_select_1.setAnchorPoint(ANCHOR_MIDDLE()),btn_select_1.setPosition(ccCenter(this.m_levelup_btn)),this.m_levelup_btn.addChild(btn_select_1);var btn_select_2=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_2.png",RectZero());btn_select_2.setContentSize(444,60),btn_select_2.setAnchorPoint(ANCHOR_MIDDLE()),btn_select_2.setPosition(ccCenter(this.m_levelup_btn)),this.m_levelup_btn.addChild(btn_select_2);var fadeout=new cc.FadeOut(1),fadein=new cc.FadeIn(1),seq=new cc.Sequence(fadeout,fadein),repeat=new cc.RepeatForever(seq);btn_select_2.runAction(repeat);var gold_box=new ccui.Scale9Sprite(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero());gold_box.setContentSize(123,38),gold_box.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),gold_box.setPosition(197,ccCenter(this.m_levelup_btn).y),this.m_levelup_btn.addChild(gold_box);var gold_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_sell_gold.png");return gold_icon.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),gold_icon.setPosition(180,ccCenter(this.m_levelup_btn).y),this.m_levelup_btn.addChild(gold_icon),this.m_levelupNeedGoldLabel=cmLabel.getLabel(Number(this.m_levelUpNeedGold).toLocaleString("en"),LABEL_FONT_INDEX.FONT_2011),this.m_levelupNeedGoldLabel.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_levelupNeedGoldLabel.setPosition(gold_box.width-10,ccCenter(gold_box).y),gold_box.addChild(this.m_levelupNeedGoldLabel),layer},setLevelUpBtnEnable:function(bool){this.m_levelup_btn.setEnabled(bool)},materialSort:function(){this.sort()},getRightBoxLayer:function(){var layer=new cc.Layer;this.m_tab_btns=[];var pos_x=17,tab_btn_1=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE);tab_btn_1.setAnchorPoint(ZERO()),tab_btn_1.setPosition(pos_x,506),tab_btn_1.setFont(LABEL_FONT_INDEX.FONT_201),tab_btn_1.setTag(YunheeLevelUpTapTypeEnum.tab_type_yunhee),layer.addChild(tab_btn_1),tab_btn_1.addClickEventListener(function(sender){YUNHEE_LEVELUP_LOAD_FLAG=!1,this.setYunheeDivisionTab(YunheeLevelUpTapTypeEnum.tab_type_yunhee)}.bind(this)),pos_x+=ccWidth(tab_btn_1),tab_btn_1.setString(res_str("btn_label_yunhee")),this.m_tab_btns.push(tab_btn_1);var tab_btn_2=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE);tab_btn_2.setAnchorPoint(ZERO()),tab_btn_2.setPosition(pos_x,506),tab_btn_2.setFont(LABEL_FONT_INDEX.FONT_201),tab_btn_2.setTag(YunheeLevelUpTapTypeEnum.tab_type_material),layer.addChild(tab_btn_2),tab_btn_2.addClickEventListener(function(sender){YUNHEE_LEVELUP_LOAD_FLAG=!1,this.setYunheeDivisionTab(YunheeLevelUpTapTypeEnum.tab_type_material)}.bind(this)),tab_btn_2.setString(res_str("label_levelup_material")),this.m_tab_btns.push(tab_btn_2);var right_bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",RectZero());right_bg_box.setInsetLeft(42),right_bg_box.setInsetRight(42),right_bg_box.setInsetTop(42),right_bg_box.setInsetBottom(42),right_bg_box.setPreferredSize(cc.size(478,518)),right_bg_box.setAnchorPoint(ZERO()),right_bg_box.setPosition(ZERO()),layer.addChild(right_bg_box),layer.setContentSize(ccSize(right_bg_box));var left_navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");left_navi.setAnchorPoint(ZERO()),left_navi.setPosition(8,459),layer.addChild(left_navi,100);var tSize=cc.size(451,337);this.m_tableView=new cc.TableView(this,tSize),this.m_tableView.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_tableView.setPosition(11,119),this.m_tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_tableView.scrollBarEnable(!0),this.m_tableView.setDelegate(this),layer.addChild(this.m_tableView),this.m_info_label=cmLabel.getLabel(res_str("label_not_levelup_mtrl"),LABEL_FONT_INDEX.FONT_261),this.m_info_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_info_label.setPosition(ccCenter(layer).x,ccCenter(layer).y+100),layer.addChild(this.m_info_label),this.m_info_label.setVisible(!1),this.m_materialList.length<=0&&this.m_info_label.setVisible(!0);var sortLayer=this.getNaviSortLayer();sortLayer.setPosition(295,7),left_navi.addChild(sortLayer),this.m_levelupCountLabel=cmLabel.getLabel("素材選択 0/"+MAX_LEVELUP_MTRL_COUNT,LABEL_FONT_INDEX.FONT_261),this.m_levelupCountLabel.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_levelupCountLabel.setPosition(32,ccCenter(left_navi).y+3),left_navi.addChild(this.m_levelupCountLabel),this.m_help_btn=new ccui.Button,this.m_help_btn.loadTextures("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_help_btn.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_help_btn.setPosition(this.m_levelupCountLabel.x+ccWidth(this.m_levelupCountLabel)+10,ccCenter(left_navi).y+4),left_navi.addChild(this.m_help_btn),this.m_help_btn.addClickEventListener(function(sender){this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeLevelUpEnum.btn_show_help)},0,"btn_show_help")});var info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());info_box.setAnchorPoint(ZERO()),info_box.setContentSize(458,40),info_box.setPosition(10,76),layer.addChild(info_box);var info_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_friend/img_friend_text.png");info_icon.setAnchorPoint(ZERO()),info_icon.setPosition(95,4),info_box.addChild(info_icon);var info_label=cmLabel.getLabel(" 同じ兵科の素材は1.5倍ボーナス",LABEL_FONT_INDEX.FONT_1613);return info_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),info_label.setPosition(130,ccCenter(info_box).y),info_box.addChild(info_label),layer},setYunheeDivisionTab:function(tab_type){this.m_tab_type=tab_type;for(var i=0;i<this.m_tab_btns.length;i++){tab_type==this.m_tab_btns[i].getTag()?this.m_tab_btns[i].setEnabled(!1):this.m_tab_btns[i].setEnabled(!0)}tab_type==YunheeLevelUpTapTypeEnum.tab_type_yunhee?MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeLevelUpEnum.tab_yunhee):tab_type==YunheeLevelUpTapTypeEnum.tab_type_material&&MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeLevelUpEnum.tab_material)},numberOfCellsInTableView:function(){var cnt=Math.floor(this.m_materialList.length/YUNHEE_COLUMN_COUNT);return 0<Math.floor(this.m_materialList.length%YUNHEE_COLUMN_COUNT)&&(cnt+=1),cnt},tableCellSizeForIndex:function(table,idx){return cc.size(456,108)},tableCellUnhighlight:function(){},tableCellTouched:function(table,cell){if(0!=YUNHEE_LEVELUP_LOAD_FLAG){null!=cell&&cell.touchPosCell(cell.getTouchPos(),cell.getTouchWorldPos())}},getNaviSortLayer:function(){var layer=new cc.Layer;this.m_btn_sort=new LabelButton("btn_48_off.png","btn_48_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort.setFont(LABEL_FONT_INDEX.FONT_161);var sortType=GameDefault.getInstance().getUserGeneralSort(),sortDesc=GameDefault.getInstance().getUserGeneralSortDesc();return this.m_sort=sortType,this.m_isSortDesc="false"!=sortDesc.toString(),this.initSort(this.m_sort),this.m_btn_sort.setAnchorPoint(ZERO()),this.m_btn_sort.setPosition(ZERO()),this.m_btn_sort.addClickEventListener(function(sender){this.runActionSortButton()}.bind(this)),layer.addChild(this.m_btn_sort),this.m_btn_sort_2=new ccui.Button,this.m_btn_sort_2.loadTextures("btn_align_bottom_2_off.png","btn_align_bottom_2_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_2.setAnchorPoint(ZERO()),this.m_btn_sort_2.setPosition(ccWidth(this.m_btn_sort),0),this.m_btn_sort_2.addClickEventListener(function(sender){this.setDesc()}.bind(this)),layer.addChild(this.m_btn_sort_2),this.m_isSortDesc||(this.m_btn_sort_2.loadTexturePressed("btn_align_top_2_on.png",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_2.loadTextureNormal("btn_align_top_2_off.png",ccui.Widget.PLIST_TEXTURE)),this.m_sortLayer=this.getSortLayer(),this.m_sortLayer.ignoreAnchorPointForPosition(!1),this.m_sortLayer.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_sortLayer.setPosition(ZERO()),this.m_sortLayer.setVisible(!1),layer.addChild(this.m_sortLayer,100),layer.setContentSize(ccSize(this.m_btn_sort)),layer},setGeneralInfo:function(info,list){this.m_gnrlInfo=info,this.m_materialList=list,this.m_gnrlKey.gnrl_id=info.gnrl_id,this.m_gnrlKey.gnrl_num=info.gnrl_num;for(var i=0;i<this.m_materialList;i++)this.checkAddAbilityValue(this.m_materialList[i])},initSort:function(sort_index){this.setSortLabel(sort_index),this.sort()},setDesc:function(){this.m_isSortDesc?(this.m_isSortDesc=!1,this.m_btn_sort_2.loadTexturePressed("btn_align_top_2_on.png",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_2.loadTextureNormal("btn_align_top_2_off.png",ccui.Widget.PLIST_TEXTURE)):(this.m_isSortDesc=!0,this.m_btn_sort_2.loadTexturePressed("btn_align_bottom_2_on.png",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_2.loadTextureNormal("btn_align_bottom_2_off.png",ccui.Widget.PLIST_TEXTURE)),GameDefault.getInstance().setUserGeneralSortDesc(this.m_isSortDesc),this.m_isSortBtnVisible&&this.runActionSortButton(),this.sort()},sort:function(){if(!(this.m_materialList.length<=0)){var self=this;switch(this.m_materialList=stable(this.m_materialList,function(l,r){return self.m_isSortDesc?l.gnrl_id<r.gnrl_id:l.gnrl_id>r.gnrl_id}),this.m_materialList=stable(this.m_materialList,function(l,r){return self.m_isSortDesc?l.class_type<r.class_type:l.class_type>r.class_type}),this.m_sort){case SORT_STATE:this.m_materialList=stable(this.m_materialList,function(l,r){return self.m_isSortDesc?l.state_type>r.state_type:l.state_type<r.state_type});break;case SORT_LV:this.m_materialList=stable(this.m_materialList,function(l,r){return self.m_isSortDesc?l.gnrl_level<r.gnrl_level:l.gnrl_level>r.gnrl_level});break;case SORT_RARE:this.m_materialList=stable(this.m_materialList,function(l,r){return self.m_isSortDesc?l.rare_type<r.rare_type:l.rare_type>r.rare_type});break;case SORT_ARMSERVICE:this.m_materialList=stable(this.m_materialList,function(l,r){return self.m_isSortDesc?l.arm_service_type>r.arm_service_type:l.arm_service_type<r.arm_service_type});break;case SORT_YUNHEE:this.m_materialList=stable(this.m_materialList,function(l,r){return self.m_isSortDesc?l.gnrl_group<r.gnrl_group:l.gnrl_group>r.gnrl_group});break;case SORT_GAIN:this.m_materialList=stable(this.m_materialList,function(l,r){return self.m_isSortDesc?l.gnrl_num<r.gnrl_num:l.gnrl_num>r.gnrl_num});break;case SORT_DUNGEON_BUFF:this.m_materialList=stable(this.m_materialList,function(l,r){return self.m_isSortDesc?l.buff_type<r.buff_type:l.buff_type>r.buff_type});break;case SORT_FIGHT_TYPE:this.m_materialList=stable(this.m_materialList,function(l,r){return self.m_isSortDesc?l.fight_type>r.fight_type:l.fight_type<r.fight_type});break;case SORT_ATT:this.m_materialList=stable(this.m_materialList,function(l,r){return self.m_isSortDesc?l.attk+l.add_atk_value<r.attk+r.add_atk_value:l.attk+l.add_atk_value>r.attk+r.add_atk_value}.bind(this));break;case SORT_DEF:this.m_materialList=stable(this.m_materialList,function(l,r){return self.m_isSortDesc?l.def+l.add_def_value<r.def+r.add_def_value:l.def+l.add_def_value>r.def+r.add_def_value});break;case SORT_HP:this.m_materialList=stable(this.m_materialList,function(l,r){return self.m_isSortDesc?l.hp+l.add_hp_value<r.hp+r.add_hp_value:l.hp+l.add_hp_value>r.hp+r.add_hp_value})}this.reloadTableView()}},getSortLayer:function(){var layer=new cc.Layer,sort_btn_strs=[];USE_NEW_SORT&&(sort_btn_strs.push(res_str("btn_sort_hp")),sort_btn_strs.push(res_str("btn_sort_def")),sort_btn_strs.push(res_str("btn_sort_attk"))),sort_btn_strs.push(res_str("btn_sort_dungeon_buff")),sort_btn_strs.push(res_str("btn_sort_lv")),sort_btn_strs.push(res_str("btn_sort_state")),sort_btn_strs.push(res_str("btn_sort_fight_type")),sort_btn_strs.push(res_str("btn_sort_arm_service_type")),sort_btn_strs.push(res_str("btn_sort_yunhee")),sort_btn_strs.push(res_str("btn_sort_gain")),sort_btn_strs.push(res_str("btn_sort_rare_type"));for(var btn_pos_y=0,str_size=sort_btn_strs.length,idx=0;idx<sort_btn_strs.length;idx++){var btn=new LabelButton("btn_48_off.png","btn_48_on.png","",ccui.Widget.PLIST_TEXTURE);btn.setFont(LABEL_FONT_INDEX.FONT_161),btn.setString(sort_btn_strs[idx]),btn.setAnchorPoint(ZERO()),btn.setPosition(0,btn_pos_y),btn.addClickEventListener(function(sender){this.setSort(sender.getTag())}.bind(this)),layer.addChild(btn),btn_pos_y+=ccHeight(btn),btn.setTag(str_size--)}return sort_btn_strs=[],layer.setContentSize(111,btn_pos_y),layer},setSort:function(sort_index){this.m_sort!=sort_index&&(this.setSortLabel(sort_index),this.m_sort=sort_index,GameDefault.getInstance().setUserGeneralSort(sort_index),this.sort()),this.runActionSortButton()},setSortLabel:function(sort_index){switch(sort_index){case SORT_RARE:this.m_btn_sort.setString(res_str("btn_sort_rare_type"));break;case SORT_LV:this.m_btn_sort.setString(res_str("btn_sort_lv"));break;case SORT_STATE:this.m_btn_sort.setString(res_str("btn_sort_state"));break;case SORT_ARMSERVICE:this.m_btn_sort.setString(res_str("btn_sort_arm_service_type"));break;case SORT_YUNHEE:this.m_btn_sort.setString(res_str("btn_sort_yunhee"));break;case SORT_GAIN:this.m_btn_sort.setString(res_str("btn_sort_gain"));break;case SORT_DUNGEON_BUFF:this.m_btn_sort.setString(res_str("btn_sort_dungeon_buff"));break;case SORT_FIGHT_TYPE:this.m_btn_sort.setString(res_str("btn_sort_fight_type"));break;case SORT_ATT:this.m_btn_sort.setString(res_str("btn_sort_attk"));break;case SORT_DEF:this.m_btn_sort.setString(res_str("btn_sort_def"));break;case SORT_HP:this.m_btn_sort.setString(res_str("btn_sort_hp"))}},reloadTableView:function(){var offset=this.m_tableView.getContentOffset();this.m_tableView.reloadData(),this.m_tableView.minContainerOffset().y>offset.y&&(offset=this.m_tableView.minContainerOffset()),this.m_tableView.setContentOffset(offset)},getLevelUpGaugeLayer:function(){var layer=new cc.Layer,gauge_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_2.png",cc.rect(20,20,20,20));gauge_box.setContentSize(444,56),gauge_box.setAnchorPoint(ZERO()),gauge_box.setPosition(ZERO()),layer.addChild(gauge_box);var level_label=cmLabel.getLabel("Lv",LABEL_FONT_INDEX.FONT_201);level_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),level_label.setPosition(27,ccCenter(gauge_box).y),gauge_box.addChild(level_label);var arrow=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_arrow_2.png");arrow.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),arrow.setPosition(115,ccCenter(gauge_box).y),gauge_box.addChild(arrow),this.m_crrntLevelLabel=cmLabel.getLabel(this.m_gnrlInfo.gnrl_level,LABEL_FONT_INDEX.FONT_261),this.m_crrntLevelLabel.setAnchorPoint(ANCHOR_MIDDLE()),this.m_crrntLevelLabel.setPosition(79,ccCenter(gauge_box).y),gauge_box.addChild(this.m_crrntLevelLabel),this.m_levelUpLevelLabel=cmLabel.getLabel(this.m_gnrlInfo.gnrl_level+"/"+this.m_gnrlInfo.max_level,LABEL_FONT_INDEX.FONT_261),this.m_levelUpLevelLabel.setAnchorPoint(ANCHOR_MIDDLE()),this.m_levelUpLevelLabel.setPosition(180,ccCenter(gauge_box).y),gauge_box.addChild(this.m_levelUpLevelLabel);var exp_bar_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero());exp_bar_box.setContentSize(169,16),exp_bar_box.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),exp_bar_box.setPosition(245,ccCenter(gauge_box).y),gauge_box.addChild(exp_bar_box),this.m_exp_prcnt=GeneralService.getInstance().getGeneralLevelUpExpPrcnt(this.m_gnrlKey),this.m_exp_prcnt=cc.clampf(this.m_exp_prcnt,0,1),this.m_orgin_exp=this.m_gnrlInfo.gnrl_exp,this.m_orgin_level=this.m_gnrlInfo.gnrl_level,this.m_lvupInfo.class_type=this.m_gnrlInfo.class_type,this.m_lvupInfo.level=this.m_orgin_level,this.m_lvupInfo.level_exp=this.m_orgin_exp;var gauge_value=this.m_exp_prcnt*MAX_GAUGE_VALUE;if(this.m_base_gauge_value=gauge_value,this.m_exp_energy=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_blue.png",RectZero()),this.m_exp_energy.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_exp_energy.setPosition(3,ccCenter(exp_bar_box).y),exp_bar_box.addChild(this.m_exp_energy),this.m_exp_energy.setScaleX(gauge_value),this.m_exp_base_energy=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green.png",RectZero()),this.m_exp_base_energy.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_exp_base_energy.setPosition(3,ccCenter(exp_bar_box).y),exp_bar_box.addChild(this.m_exp_base_energy),this.m_exp_base_energy.setScaleX(gauge_value),0!=this.m_exp_prcnt){var _prcnt=100*this.m_exp_prcnt;this.m_expPrcntLabel=cmLabel.getLabel(_prcnt.toFixed(1)+"%",LABEL_FONT_INDEX.FONT_161),this.m_gnrlInfo.gnrl_level>=this.m_gnrlInfo.max_level&&this.m_expPrcntLabel.setString("MAX")}else this.m_expPrcntLabel=cmLabel.getLabel(this.m_exp_prcnt+"%",LABEL_FONT_INDEX.FONT_161);return this.m_expPrcntLabel.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_expPrcntLabel.setPosition(ccWidth(exp_bar_box)/2,exp_bar_box.height-8),exp_bar_box.addChild(this.m_expPrcntLabel),layer.setContentSize(ccSize(gauge_box)),layer},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;cell=null!=c?c:new MaterialListCell(this.choiceGnrl.bind(this));var desc=[],start=idx*YUNHEE_COLUMN_COUNT,end=start+YUNHEE_COLUMN_COUNT;if(end<this.m_materialList.length)for(idx=start;idx<end;idx++)desc.push(this.m_materialList[idx]);else for(idx=start;idx<this.m_materialList.length;idx++)desc.push(this.m_materialList[idx]);return cell.setGnrlDatas(desc),cell},choiceGnrl:function(info){this.m_choice_gnrl=info;var tutorial=TutorialContextV2.getInstance();if(!tutorial.IsCompleteAllTutorial()){var step=tutorial.getCurrentTutorialStep();TUTORIAL_TAG_PAGE_2_LEVEL_UP_MATERIAL==step.tagid&&MainObserver.getInstance().postNotification(NOTIFICATION_TUTORIAL,message_complete_tutorial)}var isMaxCount=!1;if(this.m_mtrl_keys.length>=MAX_LEVELUP_MTRL_COUNT&&(isMaxCount=!0),isMaxCount)for(var g in this.m_materialList){if((gnrl=this.m_materialList[g]).gnrl_num==info.gnrl_num){if(gnrl.is_sell_selected){gnrl.is_sell_selected=!1,this.removeMaterialGeneral(info),this.reloadTableView();break}MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeLevelUpEnum.max_material);break}}else{for(var g in this.m_materialList){var gnrl;if((gnrl=this.m_materialList[g]).gnrl_num==info.gnrl_num){if(gnrl.is_sell_selected){gnrl.is_sell_selected=!1,this.removeMaterialGeneral(info);break}if(this.m_after_level>=this.m_gnrlInfo.max_level||this.m_orgin_level>=this.m_gnrlInfo.max_level)return void MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeLevelUpEnum.is_max_level);gnrl.is_sell_selected=!0,this.addMaterailGeneral(info);break}}this.reloadTableView()}},setReloadData:function(){0!=this.m_materialList.length&&(this.m_tableView.reloadData(),this.initLevelUp()),TutorialContextV2.getInstance().IsCompleteAllTutorial()?this.m_tab_type=YunheeLevelUpTapTypeEnum.tab_type_material:this.m_tab_type=YunheeLevelUpTapTypeEnum.tab_type_yunhee,this.setYunheeDivisionTab(this.m_tab_type)},getLevelUpTabType:function(){return this.m_tab_type},setReloadTableView:function(tab_type){this.m_tableView.reloadData(),this.initLevelUp(),tab_type==YunHeeDetailEnum.tab_yunhee?this.m_tab_type=YunheeLevelUpTapTypeEnum.tab_type_yunhee:tab_type==YunHeeDetailEnum.tab_material&&(this.m_tab_type=YunheeLevelUpTapTypeEnum.tab_type_material);for(var i=0;i<this.m_tab_btns.length;i++){var btn_tag=this.m_tab_btns[i].getTag();this.m_tab_type==btn_tag?this.m_tab_btns[i].setEnabled(!1):this.m_tab_btns[i].setEnabled(!0)}0==YUNHEE_LEVELUP_LOAD_FLAG&&this.scheduleOnce(function(){YUNHEE_LEVELUP_LOAD_FLAG=!0}.bind(this),.5,"YUNHEE_LEVELUP_LOAD_FLAG")},setLevelUpComplete:function(info,list){this.m_gnrlInfo=info,this.m_materialList=list,this.initLevelUp();for(var i=0;i<this.m_materialList;i++)this.checkAddAbilityValue(this.m_materialList[i])},tableCellEnded:function(){return!0},tableCellHighlight:function(){return!0},initLevelUp:function(){this.m_mtrl_keys=[],this.m_levelUpNeedGold=0,this.m_after_level=0,this.m_levelup_btn.setEnabled(!0),this.reloadTableView(),this.sort(),this.m_materialList.length<=0?this.m_info_label.setVisible(!0):this.m_info_label.setVisible(!1),this.setMatrialCount(this.m_mtrl_keys.length),this.m_leftBottomLayer.removeFromParent(),this.m_leftBottomLayer=this.getLeftLevelUpBottomLayer(),this.m_leftBottomLayer.setPosition(ZERO()),this.addChild(this.m_leftBottomLayer)},setMatrialCount:function(count){count>MAX_LEVELUP_MTRL_COUNT&&(count=MAX_LEVELUP_MTRL_COUNT),this.m_levelupCountLabel.setString("素材選択"+count+"/"+MAX_LEVELUP_MTRL_COUNT),this.m_help_btn.setPosition(ccPosX(this.m_levelupCountLabel)+ccWidth(this.m_levelupCountLabel)+10,ccPosY(this.m_help_btn))},getLevelUpStatLayer:function(){var layer=new cc.Layer,rect=RectZero(),stat_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_2.png",rect);stat_box.setContentSize(444,115),stat_box.setInsetBottom(20),stat_box.setInsetLeft(20),stat_box.setInsetRight(20),stat_box.setInsetTop(20),stat_box.setAnchorPoint(ZERO()),stat_box.setPosition(ZERO()),layer.addChild(stat_box);for(var i=0;i<4;++i){var box=new ccui.Scale9Sprite(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",rect);box.setContentSize(208,38),box.setAnchorPoint(ZERO()),stat_box.addChild(box);var label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812);label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),label.setPosition(8,ccCenter(box).y),box.addChild(label);var arrow=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_arrow_3.png");arrow.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),arrow.setPosition(126,ccCenter(box).y),box.addChild(arrow),0==i?(box.setPosition(11,59),label.setString("攻撃力"),this.m_crrntAttkLabel=cmLabel.getLabel(Number(parseInt(this.m_gnrlInfo.attk)).toLocaleString("en"),LABEL_FONT_INDEX.FONT_161),this.m_crrntAttkLabel.setAnchorPoint(ANCHOR_MIDDLE()),this.m_crrntAttkLabel.setPosition(95,ccCenter(box).y),box.addChild(this.m_crrntAttkLabel),this.m_levelUpAttkLabel=cmLabel.getLabel(Number(parseInt(this.m_gnrlInfo.attk)).toLocaleString("en"),LABEL_FONT_INDEX.FONT_161),this.m_levelUpAttkLabel.setAnchorPoint(ANCHOR_MIDDLE()),this.m_levelUpAttkLabel.setPosition(176,ccCenter(box).y),box.addChild(this.m_levelUpAttkLabel)):1==i?(box.setPosition(11,18),label.setString("体力"),this.m_crrntHpLabel=cmLabel.getLabel(Number(parseInt(this.m_gnrlInfo.hp)).toLocaleString("en"),LABEL_FONT_INDEX.FONT_161),this.m_crrntHpLabel.setAnchorPoint(ANCHOR_MIDDLE()),this.m_crrntHpLabel.setPosition(95,ccCenter(box).y),box.addChild(this.m_crrntHpLabel),this.m_levelUpHpLabel=cmLabel.getLabel(Number(parseInt(this.m_gnrlInfo.hp)).toLocaleString("en"),LABEL_FONT_INDEX.FONT_161),this.m_levelUpHpLabel.setAnchorPoint(ANCHOR_MIDDLE()),this.m_levelUpHpLabel.setPosition(176,ccCenter(box).y),box.addChild(this.m_levelUpHpLabel)):2==i?(box.setPosition(225,59),label.setString("防御力"),this.m_crrntDefLabel=cmLabel.getLabel(Number(parseInt(this.m_gnrlInfo.def)).toLocaleString("en"),LABEL_FONT_INDEX.FONT_161),this.m_crrntDefLabel.setAnchorPoint(ANCHOR_MIDDLE()),this.m_crrntDefLabel.setPosition(95,ccCenter(box).y),box.addChild(this.m_crrntDefLabel),this.m_levelUpDefLabel=cmLabel.getLabel(Number(parseInt(this.m_gnrlInfo.def)).toLocaleString("en"),LABEL_FONT_INDEX.FONT_161),this.m_levelUpDefLabel.setAnchorPoint(ANCHOR_MIDDLE()),this.m_levelUpDefLabel.setPosition(176,ccCenter(box).y),box.addChild(this.m_levelUpDefLabel)):3==i&&(box.setPosition(225,18),label.setString("攻速"),this.m_crrntSpLabel=cmLabel.getLabel(Number(parseInt(this.m_gnrlInfo.sp)).toLocaleString("en"),LABEL_FONT_INDEX.FONT_161),this.m_crrntSpLabel.setAnchorPoint(ANCHOR_MIDDLE()),this.m_crrntSpLabel.setPosition(95,ccCenter(box).y),box.addChild(this.m_crrntSpLabel),this.m_levelUpSpLabel=cmLabel.getLabel(Number(parseInt(this.m_gnrlInfo.sp)).toLocaleString("en"),LABEL_FONT_INDEX.FONT_161),this.m_levelUpSpLabel.setAnchorPoint(ANCHOR_MIDDLE()),this.m_levelUpSpLabel.setPosition(176,ccCenter(box).y),box.addChild(this.m_levelUpSpLabel))}return layer.setContentSize(ccSize(stat_box)),layer},addMaterailGeneral:function(info){var key={};key.gnrl_id=info.gnrl_id,key.gnrl_num=info.gnrl_num,this.m_mtrl_keys.push(key),this.setMatrialCount(this.m_mtrl_keys.length),this.setAddLevelUpExpGauge(info)},removeMaterialGeneral:function(info){var find=this.m_mtrl_keys.findIndex(function(key){return key.gnrl_num==info.gnrl_num});this.m_mtrl_keys.splice(find,1),this.setMatrialCount(this.m_mtrl_keys.length),this.setRemoveLevelUpExpGauge(info)},setAddLevelUpExpGauge:function(info){var generalService=GeneralService.getInstance(),mtrl_exp=generalService.getGeneralLevelUpMaterialExp(info),need_gold=generalService.getGeneralLevelUpExpense(info);if(info.arm_service_type==this.m_gnrlInfo.arm_service_type&&(mtrl_exp*=1.5),TutorialContextV2.getInstance().IsCompleteAllTutorial())for(var now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),nn=moment(now).valueOf(),list_Global_Booster_Event_V2=NetService().get_Global_Booster_Event(),idx=0;idx<list_Global_Booster_Event_V2.length;idx++){var b=list_Global_Booster_Event_V2[idx],bt=moment(b.begin_dt),et=moment(b.end_dt),bb=bt.valueOf(),ee=et.valueOf();if(bb<=nn&&nn<=ee&&b.booster_type==BOOSTER_TYPE_V2_YUNHEE&&b.variation_type==BOOSTER_VARIATION_TYPE_V2_GAIN_INC&&b.item_type==BOOSTER_ITEM_TYPE_V2_GENERAL_EXP){mtrl_exp=mtrl_exp*b.variation_value/100;break}}var user_service=UserService.getInstance();if(user_service.isBeginnerBooster()){var mt_booster=[];0<(mt_booster=user_service.getMtBeginnerBooster(BEGINNER_BOOSTER_TYPE_CONSUME_DECREASE,0,CONSUME_DECREASE_GOLD,mt_booster)).value&&(need_gold=Math.floor(need_gold-need_gold*mt_booster.value/1e4)),0<(mt_booster=user_service.getMtBeginnerBooster(BEGINNER_BOOSTER_TYPE_GAIN_INCREASE,GAIN_INCREASE_LEVELUP_EXP_PERCENT,0,mt_booster)).value&&(mtrl_exp=Math.floor(mtrl_exp+mtrl_exp*mt_booster.value/1e4))}this.m_levelUpNeedGold+=need_gold;var gold=Number(this.m_levelUpNeedGold).toLocaleString("en");this.m_levelupNeedGoldLabel.setString(gold),(info=NetService().get_UserItemInfo_V2()).gold_cnt<this.m_levelUpNeedGold?this.m_levelupNeedGoldLabel.setColor(COLOR(245)):this.m_levelupNeedGoldLabel.setColor(COLOR(247)),this.m_lvupInfo.level=this.m_orgin_level,this.m_lvupInfo.gnrl_id=this.m_gnrlInfo.gnrl_id,this.m_lvupInfo.gnrl_num=this.m_gnrlInfo.gnrl_num;var obj=generalService.geGeneralLevelUpAfterInfo(this.m_lvupInfo,mtrl_exp,this.m_after_prcnt,this.m_after_level);this.m_after_prcnt=obj.prcnt,this.m_after_level=obj.level,this.m_lvupInfo.level_exp+=mtrl_exp,this.runActionLevelupAddGauge(),this.setGeneralAbility(this.m_after_level)},setRemoveLevelUpExpGauge:function(info){var generalService=GeneralService.getInstance(),mtrl_exp=generalService.getGeneralLevelUpMaterialExp(info),need_gold=generalService.getGeneralLevelUpExpense(info);if(info.arm_service_type==this.m_gnrlInfo.arm_service_type&&(mtrl_exp*=1.5),TutorialContextV2.getInstance().IsCompleteAllTutorial())for(var now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),nn=moment(now).valueOf(),list_Global_Booster_Event_V2=NetService().get_Global_Booster_Event(),idx=0;idx<list_Global_Booster_Event_V2.length;idx++){var b=list_Global_Booster_Event_V2[idx],bt=moment(b.begin_dt),et=moment(b.end_dt),bb=bt.valueOf(),ee=et.valueOf();if(bb<=nn&&nn<=ee&&b.booster_type==BOOSTER_TYPE_V2_YUNHEE&&b.variation_type==BOOSTER_VARIATION_TYPE_V2_GAIN_INC&&b.item_type==BOOSTER_ITEM_TYPE_V2_GENERAL_EXP){mtrl_exp=mtrl_exp*b.variation_value/100;break}}var user_service=UserService.getInstance();if(user_service.isBeginnerBooster()){var mt_booster=[];0<(mt_booster=user_service.getMtBeginnerBooster(BEGINNER_BOOSTER_TYPE_CONSUME_DECREASE,0,CONSUME_DECREASE_GOLD,mt_booster)).value&&(need_gold=Math.floor(need_gold-need_gold*mt_booster.value/1e4)),0<(mt_booster=user_service.getMtBeginnerBooster(BEGINNER_BOOSTER_TYPE_GAIN_INCREASE,GAIN_INCREASE_LEVELUP_EXP_PERCENT,0,mt_booster)).value&&(mtrl_exp=Math.floor(mtrl_exp+mtrl_exp*mt_booster.value/1e4))}this.m_levelUpNeedGold-=need_gold,this.m_levelupNeedGoldLabel.setString(this.m_levelUpNeedGold.toLocaleString("en")),(info=NetService().get_UserItemInfo_V2()).gold_cnt<this.m_levelUpNeedGold?this.m_levelupNeedGoldLabel.setColor(COLOR(245)):this.m_levelupNeedGoldLabel.setColor(COLOR(247)),this.m_lvupInfo.level=this.m_orgin_level,this.m_lvupInfo.gnrl_id=this.m_gnrlInfo.gnrl_id;var obj=generalService.getGeneralLevelUpRemoveAfterInfo(this.m_lvupInfo,mtrl_exp,this.m_after_prcnt,this.m_after_level);this.m_after_prcnt=obj.prcnt,this.m_after_level=obj.level,this.m_after_prcnt=cc.clampf(this.m_after_prcnt,0,1),this.m_lvupInfo.level_exp-=mtrl_exp,0!=this.m_mtrl_keys.length?this.runActionLevelupAddGauge():(this.m_levelupNeedGoldLabel.setString("0"),this.m_levelupNeedGoldLabel.setColor(COLOR(247)),this.m_exp_energy.setScaleX(this.m_base_gauge_value),this.m_exp_base_energy.setVisible(!0),this.m_levelUpLevelLabel.setString(this.m_after_level+"/"+this.m_gnrlInfo.max_level),this.m_levelUpLevelLabel.setColor(COLOR(261)),0!=this.m_after_prcnt?this.m_expPrcntLabel.setString((100*this.m_after_prcnt).toFixed(1)+"%"):this.m_expPrcntLabel.setString(this.m_after_prcnt+"%"),this.m_exp_prcnt=this.m_after_prcnt,this.m_orgin_level=this.m_after_level),this.setGeneralAbility(this.m_after_level)},setGeneralAbility:function(level){var generalService=GeneralService.getInstance(),attk_value=0,def_value=0,hp_value=0,sp_value=0;if(level>this.m_gnrlInfo.gnrl_level){this.m_levelUpAttkLabel.setColor(COLOR(1612)),this.m_levelUpDefLabel.setColor(COLOR(1612)),this.m_levelUpHpLabel.setColor(COLOR(1612)),this.m_levelUpSpLabel.setColor(COLOR(1612));var info={};info.gnrl_id=this.m_gnrlInfo.gnrl_id,info.base_attk=this.m_gnrlInfo.base_attk,info.base_def=this.m_gnrlInfo.base_def,info.base_hp=this.m_gnrlInfo.base_hp,info.rare_type=this.m_gnrlInfo.rare_type,info.arm_service_type=this.m_gnrlInfo.arm_service_type,info.fight_type=this.m_gnrlInfo.fight_type,info.gnrl_level=level,info.love_level=this.m_gnrlInfo.love_level,info.love_stat_group=this.m_gnrlInfo.love_stat_group,info.limit_step_id=this.m_gnrlInfo.limit_step_id,info.class_type=this.m_gnrlInfo.class_type,info.gnrl_group=this.m_gnrlInfo.gnrl_group,attk_value=generalService.getUserGeneralAttk(info),def_value=generalService.getUserGeneralDef(info),hp_value=generalService.getUserGeneralHp(info),sp_value=this.m_gnrlInfo.base_sp}else this.m_levelUpAttkLabel.setColor(COLOR(161)),this.m_levelUpDefLabel.setColor(COLOR(161)),this.m_levelUpHpLabel.setColor(COLOR(161)),this.m_levelUpSpLabel.setColor(COLOR(161)),attk_value=Math.floor(this.m_gnrlInfo.attk),def_value=this.m_gnrlInfo.def,hp_value=this.m_gnrlInfo.hp,sp_value=this.m_gnrlInfo.sp;this.m_levelUpAttkLabel.setString(Number(parseInt(attk_value)).toLocaleString("en")),this.m_levelUpDefLabel.setString(Number(parseInt(def_value)).toLocaleString("en")),this.m_levelUpHpLabel.setString(Number(parseInt(hp_value)).toLocaleString("en")),this.m_levelUpSpLabel.setString(Number(parseInt(sp_value)).toLocaleString("en"))},getMaterialGeneralKey:function(){return this.m_mtrl_keys},getLevelUpNeedGold:function(){return this.m_levelUpNeedGold},isExistMaterial:function(){return 0<this.m_mtrl_keys.length},runActionLevelupAddGauge:function(){var gauge_value=this.m_after_prcnt*MAX_GAUGE_VALUE;this.m_exp_energy.setScaleX(gauge_value),this.m_after_level>=this.m_gnrlInfo.max_level?(this.m_expPrcntLabel.setString("MAX"),this.m_exp_energy.setScaleX(MAX_GAUGE_VALUE)):0!=this.m_after_prcnt?this.m_expPrcntLabel.setString((100*this.m_after_prcnt).toFixed(1)+"%"):this.m_expPrcntLabel.setString(this.m_after_prcnt+"%"),this.m_after_level>=this.m_gnrlInfo.max_level?this.m_levelUpLevelLabel.setString(this.m_gnrlInfo.max_level+"/"+this.m_gnrlInfo.max_level):this.m_levelUpLevelLabel.setString(this.m_after_level+"/"+this.m_gnrlInfo.max_level),this.m_gnrlInfo.gnrl_level!=this.m_after_level?(this.m_levelUpLevelLabel.setColor(COLOR(2612)),this.m_exp_base_energy.setVisible(!1)):(this.m_levelUpLevelLabel.setColor(COLOR(261)),this.m_exp_base_energy.setVisible(!0))},isExistMtrlInSR:function(){var mt=MasterManager.getInstance();for(var key in this.m_mtrl_keys){var gnrl=this.m_mtrl_keys[key];if(null==gnrl.gnrl_id)break;var g=mt.get_General(gnrl.gnrl_id);if(g.rare_type>RARE_TYPE_HR&&g.gnrl_type==GENERAL_TYPE_YUNHEE)return!0}return!1},runActionSortButton:function(){this.m_isSortBtnVisible?(this.m_sortLayer.setVisible(!1),this.m_isSortBtnVisible=!1):(this.m_sortLayer.setVisible(!0),this.m_isSortBtnVisible=!0)},checkAddAbilityValue:function(gnrlInfo){var m=MasterManager.getInstance(),mt=MasterTable.getInstance(),g=m.get_General(gnrlInfo.gnrl_id),loveStat=mt.get_LoveStatItem(g.love_stat_group,gnrlInfo.love_level);loveStat.stat_type_1==LOVE_STAT_TYPE_ATTK_PRCNT&&(gnrlInfo.add_atk_value+=gnrlInfo.attk*(loveStat.value_1/100)),loveStat.stat_type_2==LOVE_STAT_TYPE_ATTK_PRCNT&&(gnrlInfo.add_atk_value+=gnrlInfo.attk*(loveStat.value_2/100)),loveStat.stat_type_3==LOVE_STAT_TYPE_ATTK_PRCNT&&(gnrlInfo.add_atk_value+=gnrlInfo.attk*(loveStat.value_3/100)),loveStat.stat_type_1==LOVE_STAT_TYPE_ATTK_INC&&(gnrlInfo.add_atk_value+=loveStat.value_1),loveStat.stat_type_2==LOVE_STAT_TYPE_ATTK_INC&&(gnrlInfo.add_atk_value+=loveStat.value_2),loveStat.stat_type_2==LOVE_STAT_TYPE_ATTK_INC&&(gnrlInfo.add_atk_value+=loveStat.value_3),loveStat.stat_type_1==LOVE_STAT_TYPE_DEF_PRCNT&&(gnrlInfo.add_def_value+=gnrlInfo.def*(loveStat.value_1/100)),loveStat.stat_type_2==LOVE_STAT_TYPE_DEF_PRCNT&&(gnrlInfo.add_def_value+=gnrlInfo.def*(loveStat.value_2/100)),loveStat.stat_type_3==LOVE_STAT_TYPE_DEF_PRCNT&&(gnrlInfo.add_def_value+=gnrlInfo.def*(loveStat.value_3/100)),loveStat.stat_type_1==LOVE_STAT_TYPE_DEF_INC&&(gnrlInfo.add_def_value+=loveStat.value_1),loveStat.stat_type_2==LOVE_STAT_TYPE_DEF_INC&&(gnrlInfo.add_def_value+=loveStat.value_2),loveStat.stat_type_3==LOVE_STAT_TYPE_DEF_INC&&(gnrlInfo.add_def_value+=loveStat.value_3),loveStat.stat_type_1==LOVE_STAT_TYPE_HP_PRCNT&&(gnrlInfo.add_hp_value+=gnrlInfo.hp*(loveStat.value_1/100)),loveStat.stat_type_2==LOVE_STAT_TYPE_HP_PRCNT&&(gnrlInfo.add_hp_value+=gnrlInfo.hp*(loveStat.value_2/100)),loveStat.stat_type_3==LOVE_STAT_TYPE_HP_PRCNT&&(gnrlInfo.add_hp_value+=gnrlInfo.hp*(loveStat.value_3/100)),loveStat.stat_type_1==LOVE_STAT_TYPE_HP_INC&&(gnrlInfo.add_hp_value+=loveStat.value_1),loveStat.stat_type_2==LOVE_STAT_TYPE_HP_INC&&(gnrlInfo.add_hp_value+=loveStat.value_2),loveStat.stat_type_3==LOVE_STAT_TYPE_HP_INC&&(gnrlInfo.add_hp_value+=loveStat.value_3);var user_branch_ability=CampService.getInstance().getUserCampBranchAbility(gnrlInfo.arm_service_type);1==CAMP_LOVE_STAT_TYPE?(gnrlInfo.add_atk_value+=gnrlInfo.attk*(user_branch_ability.attack/1e4),gnrlInfo.add_def_value+=gnrlInfo.def*(user_branch_ability.defense/1e4),gnrlInfo.add_hp_value+=gnrlInfo.hp*(user_branch_ability.health/1e4)):(gnrlInfo.add_atk_value+=user_branch_ability.attack,gnrlInfo.add_def_value+=user_branch_ability.defense,gnrlInfo.add_hp_value+=user_branch_ability.health);var set_effect_info=new Map,gnrlKey={};gnrlKey.gnrl_id=gnrlInfo.gnrl_id,gnrlKey.gnrl_num=gnrlInfo.gnrl_num;var equip_info_list,es=EquipmentService.getInstance();equip_info_list=es.getUserGeneralEquipmentListInfo(gnrlKey);for(var i=0;i<equip_info_list.length;i++){var equip=equip_info_list[i],equip_key={},user_equip_info=$.extend({},db.UserEquipment);equip_key.equipment_item_idx=equip.equip_id,equip_key.equipment_num=equip.equip_num,es.getUserEquipmentInfo(equip_key,user_equip_info,gnrlKey),this.addComboStatValueForEquipment(gnrlInfo,user_equip_info.combo_stat,user_equip_info.stat_value);var equip_option_info=m.get_EquipmentItemOption(user_equip_info.option_id1,user_equip_info.option_num1);if(0==equip_option_info.wear_element_type||gnrlInfo.element_type==equip_option_info.wear_element_type){var equip_option_level_info=m.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);this.addComboStatValueForEquipment(gnrlInfo,equip_option_level_info.combo_stat,equip_option_level_info.stat_value),this.addComboStatValueForEquipment(gnrlInfo,equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2)}if(0==(equip_option_info=m.get_EquipmentItemOption(user_equip_info.option_id2,user_equip_info.option_num2)).wear_element_type||gnrlInfo.element_type==equip_option_info.wear_element_type){equip_option_level_info=m.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);this.addComboStatValueForEquipment(gnrlInfo,equip_option_level_info.combo_stat,equip_option_level_info.stat_value),this.addComboStatValueForEquipment(gnrlInfo,equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2)}if(0==(equip_option_info=m.get_EquipmentItemOption(user_equip_info.option_id3,user_equip_info.option_num3)).wear_element_type||gnrlInfo.element_type==equip_option_info.wear_element_type){equip_option_level_info=m.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);this.addComboStatValueForEquipment(gnrlInfo,equip_option_level_info.combo_stat,equip_option_level_info.stat_value),this.addComboStatValueForEquipment(gnrlInfo,equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2)}if(0==(equip_option_info=m.get_EquipmentItemOption(user_equip_info.option_id4,user_equip_info.option_num4)).wear_element_type||gnrlInfo.element_type==equip_option_info.wear_element_type){equip_option_level_info=m.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);this.addComboStatValueForEquipment(gnrlInfo,equip_option_level_info.combo_stat,equip_option_level_info.stat_value),this.addComboStatValueForEquipment(gnrlInfo,equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2)}if(0==(equip_option_info=m.get_EquipmentItemOption(user_equip_info.option_id5,user_equip_info.option_num5)).wear_element_type||gnrlInfo.element_type==equip_option_info.wear_element_type){equip_option_level_info=m.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);this.addComboStatValueForEquipment(gnrlInfo,equip_option_level_info.combo_stat,equip_option_level_info.stat_value),this.addComboStatValueForEquipment(gnrlInfo,equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2)}if(0<user_equip_info.equip_group)null==(set_count=set_effect_info.at(user_equip_info.equip_group))&&(set_count={count:0},set_effect_info.insert(user_equip_info.equip_group,set_count)),set_effect_info.insert(user_equip_info.equip_group,set_count),set_count.count=set_count.count+1}for(var keys=set_effect_info.keys(),idx=0;idx<keys.length;idx++){for(var mt_set_effect={equip_count:0,combo_stat:0,added_value:0},set_count=set_effect_info.at(keys[idx]).count;null==(mt_set_effect=m.get_EquipmentGroup(parseInt(keys[idx]),set_count)).equip_count&&(mt_set_effect={equip_count:0,combo_stat:0,added_value:0}),0==mt_set_effect.equip_count&&0<set_count--;);this.addComboStatValueForEquipment(gnrlInfo,mt_set_effect.combo_stat,mt_set_effect.added_value)}},addComboStatValueForEquipment:function(gnrlInfo,combo_stat_type,stat_value){if(9!=combo_stat_type&&10!=combo_stat_type)switch(combo_stat_type){case COMBO_STAT_ATTK_PLUS:gnrlInfo.add_atk_value+=stat_value;break;case COMBO_STAT_ATTK:gnrlInfo.add_atk_value+=gnrlInfo.attk*(stat_value/1e4);break;case COMBO_STAT_DEF_PLUS:gnrlInfo.add_def_value+=stat_value;break;case COMBO_STAT_DEF:gnrlInfo.add_def_value+=gnrlInfo.def*(stat_value/1e4);break;case COMBO_STAT_HP_PLUS:gnrlInfo.add_hp_value+=stat_value;break;case COMBO_STAT_HP:gnrlInfo.add_hp_value+=gnrlInfo.hp*(stat_value/1e4);break;case COMBO_STAT_CRI_PRCNT:case COMBO_STAT_CRI_DMG:case COMBO_STAT_GUARD_PRCNT:case COMBO_STAT_GUARD_DECREASE:}}}),YUNHEE_COLUMN_COUNT=4,menu_deck_1=300,menu_deck_2=301,menu_deck_3=302,menu_deck_4=303,menu_deck_5=304,menu_deck_6=305,menu_deck_7=306,menu_deck_8=307,menu_deck_9=308,M_SELECT_TROOPS=1,btn_inventory_inc=100,TUTORIAL_SETTING=4e4,LIFE_GAUGE=1e3,SKILL_COUNT=1001,YunheeListCell=cc.TableViewCell.extend({m_callback:null,m_columns:[],m_in_troops_tags:[],m_in_camp_tags:[],m_heaven_pt_tags:[],m_search_troops_tags:[],m_life_gauges:[],m_game_type:db.BattleGameType.None,m_great_wall_partin_tags:null,m_great_wall_partin_dead_tags:null,m_deck_status:0,m_great_wall_troops_tags:[],m_buff_frames:[],ctor:function(_callback,game_type,deck_status){this._super(),this.m_columns=[],this.m_in_troops_tags=[],this.m_in_camp_tags=[],this.m_great_wall_partin_tags=[],this.m_great_wall_partin_dead_tags=[],this.m_great_wall_troops_tags=[],this.m_life_gauges=[],this.m_deck_status=0,this.m_heaven_pt_tags=[],this.m_search_troops_tags=[],this.m_buff_frames=[],this.initLayout(_callback,game_type,deck_status)},initLayout:function(callback,game_type,deck_status){this.m_callback=callback,this.m_game_type=game_type,this.m_deck_status=deck_status;var size=cc.size(456,108);this.m_game_type==db.BattleGameType.GreatWallDungeon&&(size=cc.size(456,138)),this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(size);for(var offset_x=57,i=0;i<4;i++){var boximg="",box_con=!1;box_con=this.m_game_type==db.BattleGameType.GreatWallDungeon?(boximg=RES_CDN_DEFULT+"icon/img_icon_frame_6.png",!0):(boximg=RES_CDN_DEFULT+"icon/img_icon_frame_2.png",!1);var box=cc.Sprite.create(boximg);1==box_con?box.setContentSize(98,128):box.setContentSize(98,98),box.setAnchorPoint(ANCHOR_MIDDLE()),box.setPosition(offset_x,.5*size.height),this.addChild(box);for(var map_img={},j=1;j<5;++j){var s_tag=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_search_"+j+".png");s_tag.setAnchorPoint(ANCHOR_MIDDLE_TOP()),s_tag.setPosition(offset_x,size.height),this.addChild(s_tag),s_tag.setVisible(!1),map_img[j]=s_tag}this.m_search_troops_tags.push(map_img);var t_tag=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_equip.png");t_tag.setAnchorPoint(ANCHOR_MIDDLE_TOP()),t_tag.setPosition(offset_x,size.height),this.addChild(t_tag),t_tag.setVisible(!1),this.m_in_troops_tags.push(t_tag);var h_tag=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_equip_9.png");h_tag.setAnchorPoint(ANCHOR_MIDDLE_TOP()),h_tag.setPosition(offset_x,size.height),this.addChild(h_tag),h_tag.setVisible(!1),this.m_heaven_pt_tags.push(h_tag);var c_tag=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_equip_3.png");if(c_tag.setAnchorPoint(ANCHOR_MIDDLE_TOP()),c_tag.setPosition(offset_x,size.height),this.addChild(c_tag),c_tag.setVisible(!1),this.m_in_camp_tags.push(c_tag),this.m_game_type==db.BattleGameType.GreatWallDungeon){var pin_tag=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_equip_6.png");pin_tag.setAnchorPoint(ANCHOR_MIDDLE_TOP()),pin_tag.setPosition(offset_x,size.height),this.addChild(pin_tag),pin_tag.setVisible(!1),this.m_great_wall_partin_tags.push(pin_tag);var dead_tag=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_equip_7.png");dead_tag.setAnchorPoint(ANCHOR_MIDDLE_TOP()),dead_tag.setPosition(offset_x,size.height),this.addChild(dead_tag),dead_tag.setVisible(!1),this.m_great_wall_partin_dead_tags.push(dead_tag);var great_wall_troops_tag=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_equip_10.png");great_wall_troops_tag.setAnchorPoint(ANCHOR_MIDDLE_TOP()),great_wall_troops_tag.setPosition(offset_x,size.height),this.addChild(great_wall_troops_tag),great_wall_troops_tag.setVisible(!1),this.m_great_wall_troops_tags.push_back(great_wall_troops_tag);ccSize(box);var gw_bg=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_frame_great_wall.png");gw_bg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),gw_bg.setPosition(offset_x,5),this.addChild(gw_bg);var gwSize=ccSize(gw_bg),bar_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero());bar_bg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bar_bg.setPreferredSize(cc.size(98,12)),bar_bg.setPosition(.5*gwSize.width,16),gw_bg.addChild(bar_bg);var life_bar=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green.png",RectZero());life_bar.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),life_bar.setPosition(3,24),life_bar.setTag(LIFE_GAUGE),gw_bg.addChild(life_bar);var skill_count=cmLabel.getLabel("0",LABEL_FONT_INDEX.FONT_144);skill_count.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),skill_count.setTextHorizontalAlignment(cc.TEXT_ALIGNMENT_RIGHT),skill_count.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),skill_count.setPosition(gwSize.width-4,0),skill_count.setTag(SKILL_COUNT),gw_bg.addChild(skill_count),this.m_life_gauges.push(gw_bg)}this.m_columns.push(box),offset_x+=114,boximg=""}return!(size=null)},setGnrlDatas:function(list,deck_status){this.m_deck_status=deck_status,this.m_gnrl_list=list,this.updateGnrlIcons()},updateGnrlIcons:function(){for(var dungeon_list=[],dungeon_ids=[],i=0;i<this.m_columns.length;i++){var spr=this.m_columns[i],t_tag=this.m_in_troops_tags[i],c_tag=this.m_in_camp_tags[i],h_tag=this.m_heaven_pt_tags[i],map_img=this.m_search_troops_tags[i];for(var keys in h_tag.setVisible(!1),t_tag.setVisible(!1),c_tag.setVisible(!1),map_img)map_img[keys].setVisible(!1);if(i<this.m_gnrl_list.length){var gnrl=this.m_gnrl_list[i];if(spr.setVisible(!0),gnrl.using_in_search_troops)map_img[gnrl.search_troops_num].setVisible(!0);else t_tag.setVisible(gnrl.using_in_troops);c_tag.setVisible(gnrl.using_in_camp),this.m_deck_status!=DECK_STATUS.SELL_MODE&&this.m_deck_status!=DECK_STATUS.BATCH_SELL_MODE||gnrl.is_lock||h_tag.setVisible(gnrl.is_heaven_pt);var info={};this.convertData(gnrl,info);var buff_card_visible=!1;if(this.m_game_type==db.BattleGameType.EventDungeon&&1==gnrl.gnrl_type){var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();if(0!=gnrl.buff_type&&0!=event_dungeon_period_idx){dungeon_list=MasterTable.getInstance().get_EventDungeonList(event_dungeon_period_idx),dungeon_ids=[];for(var ddx=0;ddx<dungeon_list.length;ddx++)dungeon_ids.push_back(dungeon_list[ddx].event_dungeon_idx);0<MasterTable.getInstance().get_EventDungeonGeneralBuf(gnrl.gnrl_group,dungeon_ids).size()?(info.buff_type=gnrl.buff_type,buff_card_visible=!1,0!=gnrl.buff_type&&(buff_card_visible=!0)):0<MasterTable.getInstance().get_DungeonRewardBufGeneral(gnrl.gnrl_group,dungeon_ids).size()&&(info.buff_type=gnrl.buff_type,buff_card_visible=!1,0!=gnrl.buff_type&&(buff_card_visible=!0))}}var card=(new Card).createCard2(info,CARD_TYPE.type_common_card,buff_card_visible);spr.removeAllChildren(),card.setAnchorPoint(ANCHOR_MIDDLE()),this.m_game_type==db.BattleGameType.GreatWallDungeon?(t_tag.setVisible(!1),card.setPosition(ccCenter(spr).x,ccCenter(spr).y+15)):card.setPosition(ccCenter(spr)),spr.addChild(card);var y=78;if(gnrl.isPartner){var partner=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_leader.png");partner.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),partner.setPosition(95,y),card.addChild(partner),y-=ccHeight(partner)}if(gnrl.is_friend_partner){var icon=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_friend_partner.png");icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),icon.setPosition(95,y),card.addChild(icon)}if(gnrl.is_selected){var select_img=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_select_2.png");select_img.setAnchorPoint(ZERO()),select_img.setPosition(ZERO()),card.addChild(select_img),select_img.setOpacity(0);var fadeIn=new cc.FadeIn(.7),fadeOut=new cc.FadeTo(.7,90),seq=new cc.Sequence(fadeIn,fadeOut),repeat=new cc.RepeatForever(seq);select_img.runAction(repeat)}if(gnrl.is_sell_selected){var check_img=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_check.png");check_img.setAnchorPoint(ZERO()),check_img.setPosition(ZERO()),card.addChild(check_img)}if(TutorialContextV2.getInstance().IsCompleteAllTutorial()?spr.setTutorialTag(INVALID_TAG):gnrl.gnrl_id==TUTORIAL_DEFINE_YUNHEE?spr.setTutorialTag(TUTORIAL_TAG_PAGE_2_LEVEL_UP_JANGRYANG):spr.setTutorialTag(INVALID_TAG),this.m_game_type==db.BattleGameType.GreatWallDungeon){var pin_tag=this.m_great_wall_partin_tags.at(i),dead_tag=this.m_great_wall_partin_dead_tags.at(i),toops_tag=this.m_great_wall_troops_tags.at(i);gnrl.is_battle_start?(t_tag.setVisible(!1),gnrl.is_dead||gnrl.is_force_release?(dead_tag.setVisible(!0),pin_tag.setVisible(!1)):(dead_tag.setVisible(!1),pin_tag.setVisible(!0)),toops_tag.setVisible(!1)):gnrl.using_in_great_wall_troops?(dead_tag.setVisible(!1),pin_tag.setVisible(!1),toops_tag.setVisible(!0)):(dead_tag.setVisible(!1),pin_tag.setVisible(!1),toops_tag.setVisible(!1));var gw_bg=this.m_life_gauges[i];gw_bg.setVisible(!0);var gauge=gw_bg.getChildByTag(LIFE_GAUGE),max_hp=gnrl.max_hp,cur_hp=max_hp*gnrl.remain_hp_rate/1e4,min_life=0;gnrl.is_dead?cur_hp<0&&(cur_hp=0):(cur_hp<0&&(cur_hp=1),min_life=1);var per=cc.clampf(cur_hp/max_hp*92,min_life,92);gauge.setPreferredSize(cc.size(per,6)),gw_bg.getChildByTag(SKILL_COUNT).setString(gnrl.remain_skill_count)}}else spr.setVisible(!1),t_tag.setVisible(!1),c_tag.setVisible(!1),this.m_game_type==db.BattleGameType.GreatWallDungeon&&(this.m_life_gauges[i].setVisible(!1),this.m_great_wall_partin_tags.at(i).setVisible(!1),this.m_great_wall_partin_dead_tags.at(i).setVisible(!1),this.m_great_wall_troops_tags.at(i).setVisible(!1))}},clickGnrlBtn:function(tag){tag<this.m_gnrl_list.length&&this.m_callback(this.m_gnrl_list[tag])},touchPosCell:function(pos,world_pos){for(var tutorial=TutorialContextV2.getInstance(),i=0;i<this.m_columns.length;i++){var box=this.m_columns[i];if(box.isVisible()){var r=box.getBoundingBox();if(cc.rectContainsPoint(r,pos)){AudioEngine.getInstance().playNormaButtonSound(),box.stopAllActions();var zoom=new cc.ScaleTo(.05,1.1),zoomout=new cc.ScaleTo(.05,1),seq=new cc.Sequence(zoom,zoomout);box.runAction(seq),tutorial.IsCompleteAllTutorial()?this.clickGnrlBtn(i):tutorial.IsValidTouchEvent(box.getTutorialTag(),world_pos)&&box.getTutorialTag()==TUTORIAL_TAG_PAGE_2_LEVEL_UP_JANGRYANG&&this.clickGnrlBtn(i)}}}},convertData:function(input,output){output.gnrl_id=input.gnrl_id,output.is_lock=input.is_lock,output.is_max_level=input.isMaxLevel,output.is_partner=input.isPartner,output.level=input.gnrl_level,output.limit_step_id=input.limit_step_id,output.love_level=input.love_level,output.is_enable_evolve=input.isEnabledEvolve||input.isEnabledLimitOver||input.is_enable_rebirth,output.gender_type=input.gender_type}}),TroopsPosInfo=cc.Class.extend({position:0,pos:null,ctor:function(_position,_pos){}}),SORT_TYPE={sort_atk:1,sort_rare_type:2,sort_hp:3,sort_def:4,sort_lv:5,sort_spd:6,sort_state:7,sort_yunhee:8,sort_gain:9,btn_inventory_inc:100,invalid_deck_set_material:101,btn_show_help:102},TROOPS_ENUM={troops_num_1:1,troops_num_2:2,troops_num_3:3,troops_num_4:4,troops_num_5:5,troops_num_6:6,troops_num_7:7},DECK_STATUS={NONE:0,ARRANGEMENT_MODE:1,ARRANGEMENT_SELECT_YUNHEE:2,SELL_MODE:3,BATCH_SELL_MODE:4,FRIEND_MODE:5,YUNHEE_SELECT_MODE:6,CHOICE_LEADER:7},TroopsItem=cc.Class.extend({sprite:null,position:null,ctor:function(_sprite,_position){}}),YunheeTroopsItemContainer=cc.Layer.extend({m_card_layer:null,m_troopsPosInfos:[],m_arrowSprites:[],m_arrowPos:[],m_troopsItems:[],m_rects:[],m_troopsSlots:[],isAction:!1,m_game_type:null,ctor:function(){this.m_troopsPosInfos=[],this.m_arrowSprites=[],this.m_arrowPos=[],this.m_rects=[],this.m_troopsSlots=[],this.m_troopsItems=[],this.isAction=!1,this.m_game_type=null,this._super(),this.init()},init:function(){if(this.m_game_type=BattleContext._getInstance().getGameType(),this.setContentSize(314,216),this.m_card_layer=new cc.Layer,this.addChild(this.m_card_layer),this.m_game_type==db.BattleGameType.GreatWallDungeon){this.setContentSize(314,266),this.m_card_layer.setContentSize(ccSize(this));for(var i=1;i<=5;++i){(deck_bg=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame_6.png")).setContentSize(98,128),deck_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_card_layer.addChild(deck_bg),this.m_troopsSlots.push_back(deck_bg),i==POSITION_TYPE_HEAD?deck_bg.setPosition(216,ccCenter(this.m_card_layer).y-ccHeight(deck_bg)/2):i==POSITION_TYPE_MID_1?deck_bg.setPosition(108,138):i==POSITION_TYPE_MID_2?deck_bg.setPosition(108,0):i==POSITION_TYPE_BACK_1?(deck_bg.setPosition(0,138),deck_bg.setTutorialTag(TUTORIAL_TAG_PAGE_5_EMPTY_SLOT)):i==POSITION_TYPE_BACK_2&&deck_bg.setPosition(ZERO());var pos=ccPos(deck_bg);this.m_troopsPosInfos.push({i:i,pos:pos});var position_name=GeneralService.getInstance().getYunheePostionName(i);(name_label=cmLabel.getLabel(position_name,LABEL_FONT_INDEX.FONT_242)).setAnchorPoint(ANCHOR_MIDDLE()),name_label.setPosition(ccCenter(deck_bg)),deck_bg.addChild(name_label)}}else{this.setContentSize(314,216),this.m_card_layer.setContentSize(ccSize(this));for(i=1;i<=5;++i){var deck_bg;(deck_bg=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame_2.png")).setContentSize(98,98),deck_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_card_layer.addChild(deck_bg),this.m_troopsSlots.push(deck_bg),i==POSITION_TYPE_HEAD?deck_bg.setPosition(216,ccCenter(this.m_card_layer).y-ccHeight(deck_bg)/2):i==POSITION_TYPE_MID_1?deck_bg.setPosition(108,118):i==POSITION_TYPE_MID_2?deck_bg.setPosition(108,0):i==POSITION_TYPE_BACK_1?(deck_bg.setPosition(0,118),deck_bg.setTutorialTag(TUTORIAL_TAG_PAGE_5_EMPTY_SLOT)):i==POSITION_TYPE_BACK_2&&deck_bg.setPosition(ZERO());pos=deck_bg.getPosition();this.m_troopsPosInfos.push({i:i,pos:pos});var name_label;position_name=GeneralService.getInstance().getYunheePostionName(i);(name_label=cmLabel.getLabel(position_name,LABEL_FONT_INDEX.FONT_242)).setAnchorPoint(ANCHOR_MIDDLE()),name_label.setPosition(ccCenter(deck_bg)),deck_bg.addChild(name_label)}}var menu=cc.Menu.create();if(menu.setAnchorPoint(cc.p(0,0)),menu.setPosition(cc.p(0,0)),this.m_card_layer.addChild(menu),TutorialContextV2.getInstance().IsCompleteAllTutorial())for(i=0;i<MAX_TROOPS_COUNT;i++){pos=this.m_troopsPosInfos[i].pos;(arrow_sprite=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_deck_hand.png")).setAnchorPoint(cc.p(.5,.5)),arrow_sprite.setVisible(!1),arrow_sprite.setPosition(pos.x+45,pos.y+105),this.m_card_layer.addChild(arrow_sprite,100),this.m_arrowSprites.push(arrow_sprite),this.m_arrowPos.push(arrow_sprite.getPosition())}else{var arrow_sprite;pos=this.m_troopsPosInfos[3].pos,(arrow_sprite=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_deck_hand.png")).setAnchorPoint(cc.p(.5,.5)),arrow_sprite.setVisible(!1),arrow_sprite.setPosition(pos.x+45,pos.y+105),this.m_card_layer.addChild(arrow_sprite,100),this.m_arrowSprites.push(arrow_sprite),this.m_arrowPos.push(arrow_sprite.getPosition())}for(i=0;i<MAX_TROOPS_COUNT;i++){var rect=new cc.Size(98,98);pos=this.m_troopsPosInfos[i].pos;rect.x=pos.x,rect.y=pos.y,this.m_rects.push(rect)}return!0},runActionArrow:function(pos){this.stopActionArrow();var position=pos;if(!this.isAction)if(null!=position){for(var idx=0;idx<this.m_arrowSprites.length;idx++)if(position==idx+1){var moveUp=new cc.MoveBy(.2,cc.p(0,10)),moveDown=new cc.MoveBy(.2,cc.p(0,-10)),seq=new cc.Sequence(moveUp,moveUp.reverse(),moveDown,moveDown.reverse()),repeat=new cc.RepeatForever(seq);this.m_arrowSprites[idx].setVisible(!0),this.m_arrowSprites[idx].runAction(repeat)}}else for(idx=0;idx<this.m_arrowSprites.length;idx++){moveUp=new cc.MoveBy(.2,cc.p(0,10)),moveDown=new cc.MoveBy(.2,cc.p(0,-10)),seq=new cc.Sequence(moveUp,moveUp.reverse(),moveDown,moveDown.reverse()),repeat=new cc.RepeatForever(seq);this.m_arrowSprites[idx].setVisible(!0),this.m_arrowSprites[idx].runAction(repeat)}this.isAction=!0},stopActionArrow:function(){if(this.isAction){for(var i=0;i<this.m_arrowSprites.length;i++){var pos=this.m_arrowPos[i],sprite=this.m_arrowSprites[i];sprite.stopAllActions(),sprite.setPosition(pos),sprite.setVisible(!1)}this.isAction=!1}},addPartyItem:function(party,gnrlInfo,game_type){this.m_game_type=game_type;var index=party.pos_type-1,gnrl_pos=this.m_troopsPosInfos[index].pos;this.m_game_type==db.BattleGameType.GreatWallDungeon&&(gnrl_pos.y+=30);var service=GeneralService.getInstance();this.m_troopsSlots[index].setTutorialTag(INVALID_TAG);var cardInfo={};cardInfo.gnrl_id=gnrlInfo.gnrl_id,cardInfo.level=gnrlInfo.gnrl_level,cardInfo.limit_step_id=gnrlInfo.limit_step_id,cardInfo.love_level=gnrlInfo.love_level,this.m_game_type==db.BattleGameType.GreatWallDungeon&&(cardInfo.is_lock=gnrlInfo.is_battle_start);var mt=MasterTable.getInstance().getMasterTable(),g=mt.get_General(gnrlInfo.gnrl_id),gender=mt.get_GeneralDivision(g.gnrl_group);cardInfo.gender_type=gender.general_gender_type,service.getMaxLevel(gnrlInfo.gnrl_id)==cardInfo.level&&(cardInfo.is_max_level=!0);var gnrl_sprite=(new Card).createCard(cardInfo,CARD_TYPE.type_common_card);if(gnrl_sprite.setAnchorPoint(cc.p(0,0)),gnrl_sprite.setPosition(gnrl_pos),this.m_card_layer.addChild(gnrl_sprite),party.is_leader){var gSize=gnrl_sprite.getContentSize(),leader=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_ic_leader.png");leader.setAnchorPoint(cc.p(.5,0)),leader.setPosition(.5*gSize.width,gSize.height),this.m_game_type==db.BattleGameType.GreatWallDungeon&&leader.setPosition(.5*gSize.width,gSize.height-5),gnrl_sprite.addChild(leader)}if(this.m_game_type==db.BattleGameType.GreatWallDungeon){gSize=ccSize(gnrl_sprite);var gw_bg=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_frame_great_wall.png");gw_bg.setAnchorPoint(ANCHOR_MIDDLE_TOP()),gw_bg.setPosition(.5*gSize.width,5),gnrl_sprite.addChild(gw_bg,-1);var bgSize=ccSize(gw_bg),bar_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero());bar_bg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bar_bg.setPreferredSize(cc.size(98,12)),bar_bg.setPosition(.5*bgSize.width,16),gw_bg.addChild(bar_bg);var life_bar=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green.png",RectZero());life_bar.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),life_bar.setPosition(3,6),bar_bg.addChild(life_bar);var max_hp=gnrlInfo.max_hp,cur_hp=max_hp*gnrlInfo.remain_hp_rate/1e4;gnrlInfo.is_dead||cur_hp<0&&(cur_hp=1);var per=cur_hp/max_hp,bar_width=cc.clampf(92*per,0,92);life_bar.setPreferredSize(cc.size(bar_width,6));var skill_count=cmLabel.getLabel(cmString("%d",gnrlInfo.remain_skill_count),LABEL_FONT_INDEX.FONT_144);skill_count.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),skill_count.setTextHorizontalAlignment(cc.TEXT_ALIGNMENT_RIGHT),skill_count.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),skill_count.setPosition(bgSize.width-4,0),gw_bg.addChild(skill_count)}this.m_troopsItems.push({sprite:gnrl_sprite,position:party.pos_type})},removePartyItem:function(position){if(0!=this.m_troopsItems.size()){for(var idx=0;idx<this.m_troopsItems.length;idx++)if(this.m_troopsItems[idx].position==position){this.m_troopsItems[idx].sprite.removeFromParent();break}this.m_troopsItems.filter=function(obj){if(obj.position==position)return!0}}}}),YunheeLayer=cc.Layer.extend({m_isSortBtnVisible:!1,m_isSortEnabled:!0,selectedGnrlIndex:0,m_troops_select_gnrl_id:0,m_troops_select_gnrl_num:0,m_sell_yunhee_count:0,m_select_gnrl_id:0,m_select_gnrl_num:0,m_sell_gold:0,m_sell_yhpt:0,m_sell_heaven_pt:0,m_yunheeTableLayer:null,m_isSortDesc:!0,m_user_yunhee_bound:0,m_skeletonNode:null,m_skeleton_index:0,m_element_type_filter:0,m_yunhee_type_filter:0,m_selectGnrlId:0,m_isSpineMode:!1,m_characterLayer:null,m_itemPlusBtn:null,m_characterImg:null,m_character_skeleton:null,m_leader_btn:null,m_leader_cancel_btn:null,m_deck_status:null,m_leader_node:null,m_troopsContainer:null,m_layer:null,m_deckBoxLayer:null,m_leftLayer:null,m_rightLayer:null,m_right_bottom_layer:null,m_right_sell_bottom_layer:null,m_sortLayer:null,m_sortButtonLayer:null,m_troops_1:null,m_troops_2:null,m_troops_3:null,m_btn_arrangement:null,m_btn_batch_sell:null,m_btn_arrangement_cancel:null,m_state_all_btn:null,m_state_wie_btn:null,m_state_chock_btn:null,m_state_o_btn:null,m_state_won_btn:null,m_state_dong_btn:null,m_state_jae_btn:null,m_select_gnrl:null,m_table_select_img:null,m_btn_sort:null,m_btn_sort_2:null,m_yh_title:null,m_yunhee_sell_count_label:null,m_sell_gold_label:null,m_sell_yhpt_label:null,m_sell_heaven_pt_label:null,m_friend_left_title:null,m_user_cost_label:null,m_yunhee_cnt:0,m_sort:0,m_tab_type:YunheeLevelUpTapTypeEnum.tab_type_yunhee,m_listener:null,m_is_voice_playing:!1,m_voice_playing_delta:0,m_userTroopsList:[],m_filterGnrlList:[],m_userGeneralList:null,m_YunheeItemLayer:null,m_itemLayers:null,m_game_type:null,tooltip_box:null,tooltip_content:null,m_troops_btns:[],m_beginPos:null,m_isLongTouch:!1,m_gameObserver:null,m_arrangementGnrlKey:{},m_isDeckLongTouch:!1,m_img_scale:1,m_long_timer:null,m_sellYunheeGnrlKeys:[],m_sellYunheeGnrlInfoList:[],m_tab_btns:[],m_state_filter_btns:[],m_material_btns:[],m_normal_size:null,m_sell_size:null,m_stateFilterLayer:null,m_materialFilterLayer:null,m_sell_yunhee_label:null,m_long_touch_cell:null,m_yunhee_cell_list:[],m_event_dungeon_search_attk_pwr_label:null,m_gain_up_label:null,m_yunheeSellTempList:[],m_tempGold:0,m_tempyhpt:0,m_temphevenpt:0,m_tempLastPick:null,ctor:function(){this._super(),this.m_sell_gold_label=null,this.m_btn_batch_sell=null,this.m_long_touch_cell=null,this.m_yunhee_cell_list=[],this.m_element_type_filter=GameContext.getInstance().getElementTypeFilter(),null==this.m_element_type_filter&&(this.m_element_type_filter=100),this.m_yunhee_type_filter=GameContext.getInstance().getYunheeTypeFilter(),null==this.m_yunhee_type_filter&&(this.m_yunhee_type_filter=100),this.m_tab_type=YunheeLevelUpTapTypeEnum.tab_type_yunhee,this.m_game_type=BattleContext._getInstance().getGameType(),this.m_userTroopsList=[],this.m_troops_btns=[],this.m_deck_status=DECK_STATUS.NONE,this.m_isLongTouch=!1,this.m_gameObserver=MainObserver.getInstance(),this.m_arrangementGnrlKey={gnrl_num:0,gnrl_id:0},this.m_yunheeSellTempList=[],this.m_tempGold=0,this.m_tempyhpt=0,this.m_temphevenpt=0,this.m_tempLastPick=null},initLayout:function(deferred){if(this.m_layer=new cc.Layer,this.addChild(this.m_layer),this.m_leftLayer=this.getLeftBoxLayer(),this.m_leftLayer.setAnchorPoint(cc.p(0,0)),this.m_leftLayer.setPosition((this.width-533)/2-this.m_leftLayer.width/2,0),this.m_layer.addChild(this.m_leftLayer,2),this.m_rightLayer=this.getRightBoxLayer(),this.m_rightLayer.ignoreAnchorPointForPosition(!1),this.m_rightLayer.setAnchorPoint(cc.p(1,0)),this.m_rightLayer.setPosition(this.width,0),this.m_layer.addChild(this.m_rightLayer,2),this.m_table_select_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_select_2.png"),this.m_table_select_img.setAnchorPoint(cc.p(0,0)),this.m_table_select_img.setPosition(18,84),this.m_rightLayer.addChild(this.m_table_select_img,100),this.m_table_select_img.setOpacity(0),this.m_tab_type=GameContext.getInstance().getYunheeTabType(),this.m_deck_status!=DECK_STATUS.YUNHEE_SELECT_MODE){if(this.m_game_type!=db.BattleGameType.EventDungeonSearch){var troops_num=this.getCurrentTroopsNum();1==USE_LOCAL_STORAGE_TROOPS_OFF?this.updateLeaderSkill(troops_num):troops_num.done(function(data){this.updateLeaderSkill(data)}.bind(this))}this.m_stateFilterLayer=this.getStateFilterLayer(),this.m_stateFilterLayer.ignoreAnchorPointForPosition(!1),this.m_stateFilterLayer.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_stateFilterLayer.setPosition(-55,ccCenter(this.m_rightLayer).y),this.m_rightLayer.addChild(this.m_stateFilterLayer),this.m_materialFilterLayer=this.getMaterialFilterLayer(),this.m_materialFilterLayer.ignoreAnchorPointForPosition(!1),this.m_materialFilterLayer.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_materialFilterLayer.setPosition(-55,ccCenter(this.m_rightLayer).y),this.m_rightLayer.addChild(this.m_materialFilterLayer),this.m_materialFilterLayer.setVisible(!1),this.m_tab_type==YunheeLevelUpTapTypeEnum.tab_type_yunhee?(this.m_stateFilterLayer.setVisible(!0),this.m_materialFilterLayer.setVisible(!1),null!=this.m_btn_arrangement&&this.m_btn_arrangement.setEnabled(!0),null!=this.m_btn_batch_sell&&this.m_btn_batch_sell.setEnabled(!0)):this.m_tab_type==YunheeLevelUpTapTypeEnum.tab_type_material&&(this.m_stateFilterLayer.setVisible(!1),this.m_materialFilterLayer.setVisible(!0),null!=this.m_btn_arrangement&&this.m_btn_arrangement.setEnabled(!1),null!=this.m_btn_batch_sell&&this.m_btn_batch_sell.setEnabled(!1),this.setMaterialFilter(this.m_yunhee_type_filter)),this.m_helpBtn=new ccui.Button,this.m_helpBtn.loadTextures("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_helpBtn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_helpBtn.setPosition(-6,ccHeight(this.m_rightLayer)+40),this.m_rightLayer.addChild(this.m_helpBtn),this.m_helpBtn.addClickEventListener(function(float){this.scheduleOnce(function(float){this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],SORT_TYPE.btn_show_help)},0,"btn_show_help")}.bind(this))}else{var bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub.png");bg.setAnchorPoint(cc.p(.5,.5)),bg.setPosition(this.m_layer.width/2,this.m_layer.height/2),USE_SP_COMMON_SUB_BG_SCALE&&bg.setScale(2),this.m_layer.addChild(bg);var summon_btn=new LabelButton("btn_03_off.png","btn_03_on.png","",ccui.Widget.PLIST_TEXTURE);summon_btn.setFont(LABEL_FONT_INDEX.FONT_241),summon_btn.setOffFont(LABEL_FONT_INDEX.FONT_242),summon_btn.setString(res_str("btn_label_summon_3")),summon_btn.setAnchorPoint(cc.p(0,0)),summon_btn.setPosition((ccWidth(this)-478)/2-ccWidth(summon_btn)/2,16),summon_btn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],NOTIFY_MENU_YUNHEE_SELECT_SUMMON)});var characterChangeBtn=new ccui.Button;characterChangeBtn.loadTextures("btn_purple_circle_change_off.png","btn_purple_circle_change_on.png","",ccui.Widget.PLIST_TEXTURE),characterChangeBtn.setAnchorPoint(cc.p(0,0)),characterChangeBtn.setPosition(cc.p(6,9)),this.m_layer.addChild(characterChangeBtn),characterChangeBtn.addClickEventListener(function(){this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],btn_character_change)}.bind(this))}this.setStateFilter(this.m_element_type_filter),this.setYunheeDivisionTab(this.m_tab_type),deferred.resolve(!0)},setYunheeSelectRemove:function(){null!=this.m_characterLayer&&(this.m_characterLayer.removeFromParent(),this.m_characterLayer=null,this.m_characterImg=null,this.m_character_skeleton=null)},setYunheeSelectCardInfo:function(gnrl_id){null!=this.m_characterLayer&&(this.m_characterLayer.removeFromParent(),this.m_characterLayer=null,this.m_characterImg=null,this.m_character_skeleton=null),this.m_characterLayer=new cc.Layer,this.m_characterLayer.setContentSize(480,640),this.m_characterLayer.setPosition((ccWidth(this)-478)/2-ccWidth(this.m_characterLayer)/2,0),this.m_layer.addChild(this.m_characterLayer);var mt=MasterManager.getInstance();this.m_gnrlInfo=mt.get_General(gnrl_id),this.m_selectGnrlId=this.m_gnrlInfo.gnrl_id;var pos=mt.get_BodyPosition(this.m_selectGnrlId),morph=MasterTable.getInstance().get_MorphData(this.m_selectGnrlId);if("y"==morph.is_morph)this.m_character_skeleton=new sp.SkeletonAnimation(cmString("gnrl_%03d/standing/%d.json",this.m_gnrlInfo.gnrl_group,morph.gnrl_id),cmString("gnrl_%03d/standing/%d.atlas",this.m_gnrlInfo.gnrl_group,morph.gnrl_id),.1),this.m_character_skeleton.setAnchorPoint(ANCHOR_MIDDLE()),this.m_character_skeleton.setPosition(Detail_pos(pos.posx,pos.posy)),this.m_characterLayer.addChild(this.m_character_skeleton),this.m_character_skeleton.setMix("basic","active",.1),this.m_character_skeleton.setMix("active","basic",.1),this.m_character_skeleton.setAnimation(0,"active",!1),this.m_character_skeleton.addAnimation(0,"basic",!0);else{this.m_characterImg=cc.Sprite.create();var general=mt.get_General(this.m_selectGnrlId);if(general.gnrl_type==GENERAL_TYPE_YUNHEE){if(mt.get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id),this.m_characterImg.setTexture(img_str),img_str=null}else{img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id),this.m_characterImg.setTexture(img_str),img_str=null}}else{img_str=getCardBody_ImageStr(this.m_selectGnrlId);this.m_img_scale=getCardBody_Scale(general.gnrl_id),this.m_characterImg.setTexture(img_str),img_str=null}this.m_characterImg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_characterImg.setScale(this.m_img_scale),this.m_characterImg.setPosition(Detail_pos(pos.posx+ccWidth(this.m_characterImg)*this.m_img_scale/2,pos.posy+ccHeight(this.m_characterImg)*this.m_img_scale/2)),this.m_characterLayer.addChild(this.m_characterImg);var callback=new cc.CallFunc(this.characterIdelAction,this);this.m_characterImg.runAction(callback),callback=null}this.m_skeletonNode=new sp.SkeletonAnimation(cmString("gnrl_%03d/sd/%d.json",this.m_gnrlInfo.gnrl_group,this.m_gnrlInfo.bone_id),cmString("gnrl_%03d/sd/%d.atlas",this.m_gnrlInfo.gnrl_group,this.m_gnrlInfo.skin_id),.55),null!=this.m_characterImg?this.m_skeletonNode.setPosition(-ccWidth(this.m_characterImg)*this.m_img_scale,120):this.m_skeletonNode.setPosition(-2048,120),this.m_characterLayer.addChild(this.m_skeletonNode),this.m_skeletonNode.setSkin(cmString("%d",this.m_gnrlInfo.gnrl_class)),this.m_skeletonNode.setAnimation(0,"basic",!0),this.m_skeletonNode.setMix("basic","prepare",.1),this.m_skeletonNode.setMix("prepare","basic",.1),this.m_skeletonNode.setMix("attack1","prepare",.1),this.m_skeletonNode.setMix("prepare","attack1",.1),this.m_skeletonNode.setMix("attack2","prepare",.1),this.m_skeletonNode.setMix("prepare","attack2",.1),this.m_skeletonNode.setMix("attack1","basic",.1),this.m_skeletonNode.setMix("basic","attack1",.1),this.m_skeletonNode.setMix("attack2","basic",.1),this.m_skeletonNode.setMix("basic","attack2",.1),this.m_skeletonNode.setMix("attack1","attack2",.1),this.m_skeletonNode.setMix("attack2","attack1",.1),this.m_skeletonNode.setOpacity(0);var name_label=cmLabel.getLabel(this.m_gnrlInfo.name,LABEL_FONT_INDEX.FONT_281);name_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM)(),name_label.setPosition(ccCenter(this.m_characterLayer).x,92),name_label.enableOutline(cc.color.BLACK,1),this.m_characterLayer.addChild(name_label)},characterIdelAction:function(){var scaleTo_1=new cc.ScaleTo(.7,this.m_img_scale,this.m_img_scale+.01),scaleTo_2=new cc.ScaleTo(.7,this.m_img_scale,this.m_img_scale-.01),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);this.m_characterImg.runAction(repeat),repeat=sequence=scaleTo_2=scaleTo_1=null},setUserTroopsGnrlList:function(troops_list){this.m_userTroopsList=troops_list},setUserFilterGnrlList:function(gnrl_list){var dungeon_list=[],dungeon_ids=[],gnrl_buffs=[],reward_buffs=[],m=MasterTable.getInstance(),service=EventDungeonService.getInstance();if(this.m_filterGnrlList=gnrl_list,this.m_game_type==db.BattleGameType.EventDungeon)for(var i=0;i<this.m_filterGnrlList.length;i++){var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();if(0!=this.m_filterGnrlList[i].buff_type&&0!=event_dungeon_period_idx){dungeon_list=m.get_EventDungeonList(event_dungeon_period_idx),dungeon_ids=[];for(var j=0;j<dungeon_list.length;j++)dungeon_ids.push(dungeon_list[j].event_dungeon_idx);gnrl_buffs=m.get_EventDungeonGeneralBuf(this.m_filterGnrlList[i].gnrl_group,dungeon_ids);for(var buff_index=[],buff_idx=0;buff_idx<gnrl_buffs.length;buff_idx++)service.IsOpenEventDungeonBuff(gnrl_buffs[buff_idx].buff_period_idx)||buff_index.push(buff_idx);for(buff_idx=buff_index.length-1;0<=buff_idx;buff_idx--)gnrl_buffs.erase(buff_index[buff_idx]);reward_buffs=m.get_DungeonRewardBufGeneral(this.m_filterGnrlList[i].gnrl_group,dungeon_ids);for(var buff_index2=[],buff_idx2=0;buff_idx2<reward_buffs.length;buff_idx2++)service.IsOpenEventDungeonBuff(reward_buffs[buff_idx2].buff_period_idx)||buff_index2.push(buff_idx);for(buff_idx2=buff_index2.length-1;0<=buff_idx2;buff_idx2--)reward_buffs.erase(buff_index2[buff_idx2]);gnrl_buffs.length<=0&&reward_buffs.length<=0&&(this.m_filterGnrlList[i].buff_type=0)}}this.setUserYunheeBound();var ed_service=EventDungeonService.getInstance(),gw_service=GreatWallService.getInstance(),gnrl_service=GeneralService.getInstance();if(this.m_game_type==db.BattleGameType.EventDungeonSearch)ed_service.removeMaterialGnrlCheck(this.m_filterGnrlList),gnrl_service.getUserGeneralInfoListInSearchTroops(this.m_filterGnrlList);else{gw_service.checkGreatWallDungeonPartInGenerals(this.m_filterGnrlList),this.m_game_type==db.BattleGameType.GreatWallDungeon?(this.m_filterGnrlList=gw_service.removeMaterialGnrlCheck(this.m_filterGnrlList),this.m_filterGnrlList=gw_service.removeCampUsingGnrlCheck(this.m_filterGnrlList)):gnrl_service.getUserGeneralInfoListInSearchTroops(this.m_filterGnrlList);for(var idx=0;idx<this.m_filterGnrlList.length;idx++)if(0==this.m_filterGnrlList[idx].using_in_troops)for(var jdx=0;jdx<this.m_userTroopsList.length;jdx++){if(this.m_userTroopsList[jdx].gnrl_num==this.m_filterGnrlList[idx].gnrl_num){this.m_filterGnrlList[idx].using_in_troops=!0;break}}}for(i=0;i<this.m_filterGnrlList.length;i++)this.checkAddAbilityValue(this.m_filterGnrlList[i])},getNaviSortLayer:function(){var layer=new cc.Layer;this.m_btn_sort=new LabelButton("btn_48_off.png","btn_48_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort.setFont(LABEL_FONT_INDEX.FONT_161),this.m_btn_sort.setAnchorPoint(ZERO()),this.m_btn_sort.setPosition(ZERO()),this.m_btn_sort.addClickEventListener(function(sender){this.runActionSortButton()}.bind(this)),layer.addChild(this.m_btn_sort),this.m_btn_sort_2=new ccui.Button,this.m_btn_sort_2.loadTextures("btn_align_bottom_2_off.png","btn_align_bottom_2_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_2.setAnchorPoint(ZERO()),this.m_btn_sort_2.setPosition(ccWidth(this.m_btn_sort),0),this.m_btn_sort_2.addClickEventListener(function(sender){this.setDesc()}.bind(this)),layer.addChild(this.m_btn_sort_2);var sortDesc=GameDefault.getInstance().getUserGeneralSortDesc();return this.m_sort=GameDefault.getInstance().getUserGeneralSort(),this.m_isSortDesc="false"!=sortDesc.toString(),this.initSort(this.m_sort),this.m_isSortDesc||(this.m_btn_sort_2.loadTexturePressed("btn_align_top_2_on.png",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_2.loadTextureNormal("btn_align_top_2_off.png",ccui.Widget.PLIST_TEXTURE)),this.m_sortLayer=this.getSortLayer(),this.m_sortLayer.ignoreAnchorPointForPosition(!1),this.m_sortLayer.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_sortLayer.setPosition(ZERO()),this.m_sortLayer.setVisible(!1),layer.addChild(this.m_sortLayer,100),layer.setContentSize(ccSize(this.m_btn_sort)),layer},setDesc:function(){this.m_isSortDesc?(this.m_isSortDesc=!1,this.m_btn_sort_2.loadTexturePressed("btn_align_top_2_on.png",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_2.loadTextureNormal("btn_align_top_2_off.png",ccui.Widget.PLIST_TEXTURE)):(this.m_isSortDesc=!0,this.m_btn_sort_2.loadTexturePressed("btn_align_bottom_2_on.png",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_2.loadTextureNormal("btn_align_bottom_2_off.png",ccui.Widget.PLIST_TEXTURE)),GameDefault.getInstance().setUserGeneralSortDesc(this.m_isSortDesc),this.m_isSortBtnVisible&&this.runActionSortButton(),this.sort(!0)},getElementFilterButton:function(index){var btn=new ccui.Button;return btn.loadTextures("btn_09_"+leadingZeros(index,2)+"_none.png","btn_09_"+leadingZeros(index,2)+"_on.png","btn_09_"+leadingZeros(index,2)+"_off.png",ccui.Widget.PLIST_TEXTURE),btn},getMaterialFilterButton:function(index){var btn_click_sprite=cmString("btn_10_%02d_on.png",index),btn_none_sprite=cmString("btn_10_%02d_off.png",index),btn_normal_sprite=cmString("btn_10_%02d_none.png",index),btn=new ccui.Button(btn_normal_sprite,btn_click_sprite,btn_none_sprite,ccui.Widget.PLIST_TEXTURE);return btn_normal_sprite=btn_none_sprite=btn_click_sprite="",btn},setMaterialFilter:function(index){for(var i=0;i<this.m_material_btns.length;i++){var btn_tag=this.m_material_btns[i].getTag();btn_tag==index?this.m_material_btns[i].setEnabled(!1):this.m_material_btns[i].setEnabled(!0),btn_tag=null}this.m_tableView.reloadData(),this.m_yunhee_type_filter=index,GameContext.getInstance().setYunheeTypeFilter(this.m_yunhee_type_filter)},setStateFilter:function(index){for(var i=0;i<this.m_state_filter_btns.length;i++){var btn_tag=this.m_state_filter_btns[i].getTag();btn_tag==index?this.m_state_filter_btns[i].setEnabled(!1):this.m_state_filter_btns[i].setEnabled(!0),btn_tag=null}this.m_tableView.reloadData(),this.m_element_type_filter=index,GameContext.getInstance().setElementTypeFilter(this.m_element_type_filter)},getStateFilterLayer:function(){var layer=new cc.Layer;layer.setContentSize(60,410),this.m_state_filter_btns=[],this.m_element_type_filter=GameContext.getInstance().getElementTypeFilter();for(var pos_y=0,i=1;i<7;++i){var index=i;0<index&&(index=6==index?100:6-i);var btn=this.getElementFilterButton(index);btn.setAnchorPoint(ZERO()),btn.setPosition(0,pos_y),btn.setTag(index),btn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(NOTIFICATION_ELEMENT_TYPE_FILTER,sender.getTag())}.bind(this)),layer.addChild(btn),pos_y+=ccWidth(btn)+10,index==this.m_yunhee_type_filter&&btn.setEnabled(!1),this.m_state_filter_btns.push(btn)}return layer},setYunheeDivisionTab:function(tab_type){this.m_tab_type=tab_type;for(var i=0;i<this.m_tab_btns.length;i++){tab_type==this.m_tab_btns[i].getTag()?this.m_tab_btns[i].setEnabled(!1):this.m_tab_btns[i].setEnabled(!0)}tab_type==YunheeLevelUpTapTypeEnum.tab_type_yunhee?(this.m_stateFilterLayer.setVisible(!0),this.m_materialFilterLayer.setVisible(!1),null!=this.m_btn_arrangement&&this.m_btn_arrangement.setEnabled(!0),null!=this.m_btn_batch_sell&&this.m_btn_batch_sell.setEnabled(!0),this.m_gameObserver.postNotification(NOTIFICATION_ELEMENT_TYPE_FILTER,GameContext.getInstance().getElementTypeFilter())):tab_type==YunheeLevelUpTapTypeEnum.tab_type_material&&(this.m_stateFilterLayer.setVisible(!1),this.m_materialFilterLayer.setVisible(!0),null!=this.m_btn_arrangement&&this.m_btn_arrangement.setEnabled(!1),null!=this.m_btn_batch_sell&&this.m_btn_batch_sell.setEnabled(!1),this.m_gameObserver.postNotification(NOTIFICATION_YUNHEE_TYPE_FILTER,GameContext.getInstance().getYunheeTypeFilter())),GameContext.getInstance().setYunheeTabType(this.m_tab_type)},getMaterialFilterLayer:function(){var layer=new cc.Layer;layer.setContentSize(60,410),this.m_material_btns=[],this.m_yunhee_type_filter=GameContext.getInstance().getYunheeTypeFilter();for(var pos_y=210,i=0;i<3;++i){var index=i+1;index=3==index?100:2-i;var btn=this.getMaterialFilterButton(index);btn.setAnchorPoint(ZERO()),btn.setPosition(0,pos_y),btn.setTag(index),btn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(NOTIFICATION_YUNHEE_TYPE_FILTER,sender.getTag())}.bind(this)),layer.addChild(btn),pos_y+=ccWidth(btn)+10,index==this.m_element_type_filter&&btn.setEnabled(!1),this.m_material_btns.push(btn)}return layer},getRightBoxLayer:function(){var layer=new cc.Layer;this.m_tab_btns=[];var tab_count=2;this.m_game_type==db.BattleGameType.GreatWallDungeon&&(tab_count=1);for(var pos_x=17,i=1;i<=tab_count;++i){var tab_btn=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE);tab_btn.setAnchorPoint(ZERO()),tab_btn.setPosition(pos_x,506),tab_btn.setFont(LABEL_FONT_INDEX.FONT_201),tab_btn.setTag(i),layer.addChild(tab_btn),tab_btn.addClickEventListener(function(sander){this.setYunheeDivisionTab(sander.getTag())}.bind(this)),pos_x+=ccWidth(tab_btn),1==i?tab_btn.setString(res_str("btn_label_yunhee")):tab_btn.setString(res_str("label_levelup_material")),this.m_tab_btns.push(tab_btn)}this.m_listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:function(touch,event){if(this.m_beginPos=touch.getLocation(),this.m_deck_status==DECK_STATUS.YUNHEE_SELECT_MODE){if(null==this.m_characterLayer)return!1;(rc=RectZero()).size=ccSize(this.m_characterLayer);var pos=this.m_characterLayer.convertToWorldSpace(this.m_characterLayer.getPosition());return rc.x=pos.x,rc.y=pos.y,!!cc.rectContainsPoint(rc,this.m_beginPos)}var bounds=RectZero();bounds.width=ccSize(this.m_troopsContainer).width,bounds.height=ccSize(this.m_troopsContainer).height;pos=this.m_troopsContainer.convertToWorldSpace(this.m_troopsContainer.getPosition());if(bounds.x=pos.x,bounds.y=pos.y,cc.rectContainsPoint(bounds,this.m_beginPos)){this.m_beginPos=this.m_troopsContainer.convertToNodeSpace(this.m_beginPos);for(var i=0;i<MAX_TROOPS_COUNT;i++){var rc=this.m_troopsContainer.m_rects[i];if(cc.rectContainsPoint(rc,this.m_beginPos)){for(var position=i+1,troops_num=M_SELECT_TROOPS,a=0;a<this.m_userTroopsList.length;a++){var troops=this.m_userTroopsList[a];if(troops.troops_num==troops_num&&troops.pos_type==position){this.m_troops_select_gnrl_id=troops.gnrl_id,this.m_troops_select_gnrl_num=troops.gnrl_num,this.m_deck_status!=DECK_STATUS.ARRANGEMENT_SELECT_YUNHEE&&this.scheduleOnce(function(float){this.m_isDeckLongTouch=!0,MainObserver.getInstance().postNotification(sceneStr[scene_YunheeScene],NOTIFY_DECK_IS_LONG_CLICK)},.4,DECK_LONG_CLICK);break}}if(0!=this.m_troops_select_gnrl_id)break}}}return!(bounds=null)}.bind(this),onTouchMoved:function(touch,event){if(this.m_deck_status!=DECK_STATUS.ARRANGEMENT_SELECT_YUNHEE&&this.m_deck_status!=DECK_STATUS.YUNHEE_SELECT_MODE){var pos=touch.getLocation();pos=this.m_troopsContainer.convertToNodeSpace(pos),(20<Math.abs(this.m_beginPos.x-pos.x)||20<Math.abs(this.m_beginPos.y-pos.y))&&(this.unschedule(DECK_LONG_CLICK),this.m_troops_select_gnrl_id=0,this.m_troops_select_gnrl_num=0)}else this.m_isDeckLongTouch}.bind(this),onTouchEnded:function(touch,event){if(this.unschedule(DECK_LONG_CLICK),this.m_isDeckLongTouch)return this.m_isDeckLongTouch=!1,void this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],NOTIFY_LONG_CLICK_POPUP_HIDE);var endPos=touch.getLocation(),rc_2=this.m_troopsContainer.getContentSize(),pos=this.m_troopsContainer.convertToWorldSpace(this.m_troopsContainer.getPosition());if(rc_2.x=pos.x,rc_2.y=pos.y,cc.rectContainsPoint(rc_2,endPos)){this.m_endPos=touch.getLocation(),this.m_endPos=this.m_troopsContainer.convertToNodeSpace(this.m_endPos);var key={gnrl_id:0,num:0};key.gnrl_id=this.m_troops_select_gnrl_id,key.num=this.m_troops_select_gnrl_num,0!=this.m_troops_select_gnrl_id&&GameContext.getInstance().setGeneralKey(key);for(var i=0;i<MAX_TROOPS_COUNT;i++){var rc=this.m_troopsContainer.m_rects[i];if(cc.rectContainsPoint(rc,this.m_endPos)){var tutorial;if(this.m_deck_status==DECK_STATUS.ARRANGEMENT_MODE)return void((tutorial=TutorialContextV2.getInstance()).IsCompleteAllTutorial()&&this.deleteYunheeTroops());if((tutorial=TutorialContextV2.getInstance()).IsCompleteAllTutorial())0==i&&this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],menu_deck_1),1==i&&this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],menu_deck_2),2==i&&this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],menu_deck_3),3==i&&this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],menu_deck_4),4==i&&this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],menu_deck_5);else{var step=tutorial.getCurrentTutorialStep();step.tutorial_page==TUTORIAL_PAGE_5_TROOPS&&6==step.tutorial_step&&this.m_troopsContainer.m_troopsSlots[i].getTutorialTag()==step.tagid&&(3==i&&this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],menu_deck_4),this.m_gameObserver.postNotification(NOTIFICATION_TUTORIAL,message_complete_tutorial))}}}}}.bind(this)}),cc.eventManager.addListener(this.m_listener,this);var right_bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",RectZero());right_bg_box.setAnchorPoint(ZERO()),right_bg_box.setInsetLeft(42),right_bg_box.setInsetRight(42),right_bg_box.setInsetTop(42),right_bg_box.setInsetBottom(42),right_bg_box.setPreferredSize(cc.size(478,518)),right_bg_box.setPosition(ZERO()),layer.addChild(right_bg_box),this.m_sel_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal_2.png",RectZero()),this.m_sel_mask.setAnchorPoint(cc.p(0,0)),this.m_sel_mask.setPosition(10,79),this.m_sel_mask.setContentSize(458,436),this.m_sel_mask.setVisible(!1),layer.addChild(this.m_sel_mask),layer.setContentSize(right_bg_box.getContentSize()),this.m_normal_size=cc.size(451,372),this.m_sell_size=cc.size(451,304),this.m_tableView=new cc.TableView(this,this.m_normal_size),this.m_tableView.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_tableView.setPosition(11,84),this.m_tableView.scrollBarEnable(!0),this.m_tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_tableView.setVerticalFillOrder(0),this.m_tableView.setDelegate(this),layer.addChild(this.m_tableView);var winSize=cc.director.getWinSize();this.m_winLayer=new cc.Layer,this.m_winLayer.setContentSize(winSize),this.m_winLayer.setPosition(ZERO()),this.addChild(this.m_winLayer);var left_navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");if(left_navi.setAnchorPoint(cc.p(0,0)),left_navi.setPosition(8,459),layer.addChild(left_navi,1e3),this.m_deck_status==DECK_STATUS.YUNHEE_SELECT_MODE)this.m_yh_title=cmLabel.getLabel(this.m_yunhee_select_title,LABEL_FONT_INDEX.FONT_261);else{var sortLayer=this.getNaviSortLayer();sortLayer.setPosition(295,7),left_navi.addChild(sortLayer);GeneralService.getInstance();var bound=NetService().get_user_yunhee_bound();this.m_user_yunhee_bound=bound,this.m_yunhee_cnt=this.m_filterGnrlList.size();var mt=MasterManager.getInstance();if(this.m_yh_title=cmLabel.getLabel(cmString(res_str("label_retention_yunhee_2"),this.m_yunhee_cnt,this.m_user_yunhee_bound),LABEL_FONT_INDEX.FONT_261),this.m_yh_title.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_yh_title.setPosition(12,left_navi.height/2+4),left_navi.addChild(this.m_yh_title),this.m_game_type==db.BattleGameType.GreatWallDungeon){var max_cnt=mt.get_CountFunction(24).value,cnt=NetService().get_great_wall_troops_info().partin_generals.size();this.m_yh_title.setString(cmString(res_str("label_great_wall_deck_choice_gnrl"),cnt,max_cnt)),this.m_yh_title.setColor(COLOR(261))}else{var yunhee_bound=mt.get_CountFunction(COUNT_FUNCTION_YUNHEE_INVENTORY_BOUND).value;this.m_user_yunhee_bound<yunhee_bound&&(this.m_itemPlusBtn=new ccui.Button("btn_plus_off.png","btn_plus_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_itemPlusBtn.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_itemPlusBtn.setPosition(cc.p(this.m_yh_title.x+this.m_yh_title.width+10,ccCenter(left_navi).y+3)),left_navi.addChild(this.m_itemPlusBtn),this.m_itemPlusBtn.addClickEventListener(function(){this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],SORT_TYPE.btn_inventory_inc)}.bind(this)))}if(this.m_deck_status==DECK_STATUS.YUNHEE_SELECT_MODE)return layer;if(this.m_right_bottom_layer=this.getRightBottomLayer(),this.m_right_bottom_layer.ignoreAnchorPointForPosition(!1),this.m_right_bottom_layer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_right_bottom_layer.setPosition(ccWidth(layer)-11,15),layer.addChild(this.m_right_bottom_layer,10),this.m_right_sell_bottom_layer=this.getRightBottomSellLayer(),this.m_right_bottom_layer.ignoreAnchorPointForPosition(!1),this.m_right_bottom_layer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_right_sell_bottom_layer.setPosition(10,15),layer.addChild(this.m_right_sell_bottom_layer,10),this.m_right_sell_bottom_layer.setVisible(!1),this.m_game_type!=db.BattleGameType.None){if(GameContext.getInstance().getYunheeArrangeMode())try{this.getParent().setMask(200),this.setArrangementMode()}catch(e){}GameContext.getInstance().setYunheeArrangeMode(!1)}}return layer},getRightBottomLayer:function(){var layer=new cc.Layer,right_bottom=cc.Sprite.create(RES_CDN_DEFULT+"common/img_box_right_line_2.png");if(right_bottom.setAnchorPoint(cc.p(0,0)),right_bottom.setPosition(cc.p(0,0)),layer.addChild(right_bottom),layer.setContentSize(right_bottom.getContentSize()),this.m_game_type==db.BattleGameType.GreatWallDungeon)this.m_btn_arrangement=new LabelButton("btn_03_off.png","btn_03_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_btn_arrangement.setFont(LABEL_FONT_INDEX.FONT_241),this.m_btn_arrangement.setString(res_str("btn_label_arrangement_great_wall")),this.m_btn_arrangement.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_btn_arrangement.setPosition(6,1),this.m_btn_arrangement.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],NOTIFY_MENU_ARRANGEMENT)}.bind(this)),this.m_btn_arrangement.setTutorialTag(TUTORIAL_TAG_PAGE_5_ARRANGE_BTN),right_bottom.addChild(this.m_btn_arrangement),this.m_btn_arrangement_cancel=new LabelButton("btn_03_red_off.png","btn_03_red_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_btn_arrangement_cancel.setFont(LABEL_FONT_INDEX.FONT_241),this.m_btn_arrangement_cancel.setString(res_str("btn_label_arrangement_cancel")),this.m_btn_arrangement_cancel.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_btn_arrangement_cancel.setPosition(6,1),this.m_btn_arrangement_cancel.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],NOTIFY_MENU_ARRANGEMENT)}.bind(this)),this.m_btn_arrangement_cancel.setVisible(!1),this.m_btn_arrangement_cancel.setTutorialTag(TUTORIAL_TAG_PAGE_5_ARRANGE_COMPLETE_BTN),right_bottom.addChild(this.m_btn_arrangement_cancel);else{this.m_btn_arrangement=new LabelButton("btn_27_off.png","btn_27_on.png","btn_27_none.png",ccui.Widget.PLIST_TEXTURE),this.m_btn_arrangement.setFont(LABEL_FONT_INDEX.FONT_241),this.m_btn_arrangement.setString(res_str("btn_label_arrangement")),this.m_btn_arrangement.setAnchorPoint(ZERO()),this.m_btn_arrangement.setPosition(6,1),this.m_btn_arrangement.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],NOTIFY_MENU_ARRANGEMENT)}.bind(this)),this.m_btn_arrangement.setTutorialTag(TUTORIAL_TAG_PAGE_5_ARRANGE_BTN),right_bottom.addChild(this.m_btn_arrangement),this.m_btn_arrangement_cancel=new LabelButton("btn_28_off.png","btn_28_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_btn_arrangement_cancel.setFont(LABEL_FONT_INDEX.FONT_241),this.m_btn_arrangement_cancel.setString(res_str("btn_label_arrangement_cancel")),this.m_btn_arrangement_cancel.setAnchorPoint(ZERO()),this.m_btn_arrangement_cancel.setPosition(6,1),this.m_btn_arrangement_cancel.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],NOTIFY_MENU_ARRANGEMENT)}.bind(this)),this.m_btn_arrangement_cancel.setVisible(!1),this.m_btn_arrangement_cancel.setTutorialTag(TUTORIAL_TAG_PAGE_5_ARRANGE_COMPLETE_BTN),right_bottom.addChild(this.m_btn_arrangement_cancel);var btn_sell=new LabelButton("btn_27_off.png","btn_27_on.png","btn_27_none.png",ccui.Widget.PLIST_TEXTURE);btn_sell.setFont(LABEL_FONT_INDEX.FONT_241),btn_sell.setString("売却"),btn_sell.setAnchorPoint(cc.p(0,0)),btn_sell.setPosition(this.m_btn_arrangement.x+ccWidth(this.m_btn_arrangement),1),btn_sell.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],NOTIFY_MENU_YUNHEE_SELL_MODE)}.bind(this)),right_bottom.addChild(btn_sell),this.m_btn_batch_sell=new LabelButton("btn_27_off.png","btn_27_on.png","btn_27_none.png",ccui.Widget.PLIST_TEXTURE),this.m_btn_batch_sell.setFont(LABEL_FONT_INDEX.FONT_241),this.m_btn_batch_sell.setString(res_str("btn_label_batch_sell")),this.m_btn_batch_sell.setAnchorPoint(ZERO()),this.m_btn_batch_sell.setPosition(ccPosX(btn_sell)+ccWidth(btn_sell),1),this.m_btn_batch_sell.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],NOTIFY_MENU_YUNHEE_BATCH_SELL_READY)}.bind(this)),right_bottom.addChild(this.m_btn_batch_sell)}return null!=this.m_btn_arrangement&&this.m_tab_type==YunheeLevelUpTapTypeEnum.tab_type_material&&(this.m_btn_arrangement.setEnabled(!1),this.m_btn_batch_sell.setEnabled(!1)),layer},getRightBottomSellLayer:function(){var layer=new cc.Layer,right_bottom=cc.Sprite.create(RES_CDN_DEFULT+"common/img_box_right_line_2.png");right_bottom.setAnchorPoint(cc.p(0,0)),right_bottom.setPosition(cc.p(0,0)),layer.addChild(right_bottom),layer.setContentSize(right_bottom.getContentSize());var sell_top_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal_2.png",RectZero());sell_top_bg.setContentSize(458,80),sell_top_bg.setAnchorPoint(ZERO()),sell_top_bg.setPosition(0,61),right_bottom.addChild(sell_top_bg),this.m_sell_yunhee_label=cmLabel.getLabel(res_str("label_sell_yunhee_count"),LABEL_FONT_INDEX.FONT_181),this.m_sell_yunhee_label.setAnchorPoint(ZERO()),this.m_sell_yunhee_label.setPosition(17,49),sell_top_bg.addChild(this.m_sell_yunhee_label),this.m_yunhee_sell_count_label=cmLabel.getLabel(this.m_sell_yunhee_count,LABEL_FONT_INDEX.FONT_1810),this.m_yunhee_sell_count_label.setAnchorPoint(ZERO()),this.m_yunhee_sell_count_label.setPosition(ccPosX(this.m_sell_yunhee_label)+ccWidth(this.m_sell_yunhee_label)+10,49),sell_top_bg.addChild(this.m_yunhee_sell_count_label);var heaven_pt_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_sell_wing.png");heaven_pt_img.setAnchorPoint(ZERO()),heaven_pt_img.setPosition(17,0),sell_top_bg.addChild(heaven_pt_img),this.m_sell_heaven_pt_label=cmLabel.getLabel(Number(this.m_sell_heaven_pt).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810),this.m_sell_heaven_pt_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_sell_heaven_pt_label.setPosition(145,5),sell_top_bg.addChild(this.m_sell_heaven_pt_label);var yhpt_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_sell_yhpt.png");yhpt_img.setAnchorPoint(ZERO()),yhpt_img.setPosition(166,0),sell_top_bg.addChild(yhpt_img),this.m_sell_yhpt_label=cmLabel.getLabel(Number(this.m_sell_yhpt).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810),this.m_sell_yhpt_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_sell_yhpt_label.setPosition(295,5),sell_top_bg.addChild(this.m_sell_yhpt_label);var gold_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_sell_gold.png");gold_img.setAnchorPoint(ZERO()),gold_img.setPosition(315,0),sell_top_bg.addChild(gold_img),this.m_sell_gold_label=cmLabel.getLabel(Number(this.m_sell_gold).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810),this.m_sell_gold_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_sell_gold_label.setPosition(436,5),sell_top_bg.addChild(this.m_sell_gold_label);var btn_cancel=new LabelButton("btn_08_off.png","btn_08_on.png","",ccui.Widget.PLIST_TEXTURE);btn_cancel.setFont(LABEL_FONT_INDEX.FONT_241),btn_cancel.setString("取消"),btn_cancel.setAnchorPoint(cc.p(0,0)),btn_cancel.setPosition(6,1),btn_cancel.addClickEventListener(function(target){this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],NOTIFY_MENU_YUNHEE_SELL_CANCEL)}.bind(this)),right_bottom.addChild(btn_cancel);var btn_sell=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);return btn_sell.setFont(LABEL_FONT_INDEX.FONT_241),btn_sell.setString("売却"),btn_sell.setAnchorPoint(cc.p(0,0)),btn_sell.setPosition(btn_cancel.x+ccWidth(btn_cancel),1),btn_sell.addClickEventListener(function(target){0!=this.m_sellYunheeGnrlKeys.length?this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],yunhee_sell_ready):this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],yunhee_sell_not_select)}.bind(this)),right_bottom.addChild(btn_sell),layer},getLeftBoxLayer:function(){var size=new cc.Size(427,640),layer=new cc.Layer;if(layer.setContentSize(size),this.m_deck_status!=DECK_STATUS.YUNHEE_SELECT_MODE){var labelLayer=new cc.Layer;labelLayer.ignoreAnchorPointForPosition(!1),labelLayer.setAnchorPoint(cc.p(.5,0)),labelLayer.setPosition(293,156),layer.addChild(labelLayer,100);var tuto=new cc.Node;if(tuto.setAnchorPoint(cc.p(0,0)),tuto.setPosition(16,500),tuto.setContentSize(360,60),layer.addChild(tuto),this.m_game_type!=db.BattleGameType.EventDungeonSearch){var offset_x=0,btn_name=[];btn_name.push("1軍"),btn_name.push("2軍"),btn_name.push("3軍"),btn_name.push("4軍"),btn_name.push("5軍"),btn_name.push("6軍"),btn_name.push("7軍");for(var i=0;i<MAX_TROOPS_NUM;i++){var troops_btn=null;this.m_game_type==db.BattleGameType.GreatWallDungeon?(troops_btn=new LabelButton("btn_34_none.png","btn_34_on.png","btn_34_off.png",ccui.Widget.PLIST_TEXTURE)).setFont(LABEL_FONT_INDEX.FONT_221):(troops_btn=new LabelButton("btn_34_none.png","btn_34_on.png","btn_34_off.png",ccui.Widget.PLIST_TEXTURE)).setFont(LABEL_FONT_INDEX.FONT_241),troops_btn.setString(btn_name[i]),troops_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),troops_btn.setPosition(offset_x,508),troops_btn.setTag(NOTIFY_MENU_PARTY_1+i),troops_btn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],sender.getTag())}.bind(this)),layer.addChild(troops_btn),offset_x+=ccWidth(troops_btn),this.m_troops_btns.push(troops_btn)}this.m_troops_btns[6].setVisible(this.m_game_type==db.BattleGameType.GreatWallDungeon),this.updateTroopsBtns()}var troops_num=this.getCurrentTroopsNum(),troops_cost=0,user_cost_bnd={};if(this.m_user_cost_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_301),this.m_user_cost_label.setAnchorPoint(cc.p(0,0)),this.m_user_cost_label.setPosition(17,470),layer.addChild(this.m_user_cost_label),1==USE_LOCAL_STORAGE_TROOPS_OFF?(user_cost_bnd=this.m_game_type==db.BattleGameType.GreatWallDungeon?(troops_cost=GreatWallService.getInstance().getGreatWallTroopsCost(troops_num),GreatWallService.getInstance().getGreatWallTroopsTotalCost(troops_num)):(troops_cost=GeneralService.getInstance().getTroopsCost(troops_num),GeneralService.getInstance().getUserTotalCost(troops_num)),this.m_game_type!=db.BattleGameType.EventDungeonSearch&&this.m_user_cost_label.setString("cost "+troops_cost+"/"+user_cost_bnd.cost)):troops_num.done(function(tdata){user_cost_bnd=this.m_game_type==db.BattleGameType.GreatWallDungeon?(troops_cost=GreatWallService.getInstance().getGreatWallTroopsCost(tdata),GreatWallService.getInstance().getGreatWallTroopsTotalCost(tdata)):(troops_cost=GeneralService.getInstance().getTroopsCost(tdata),GeneralService.getInstance().getUserTotalCost(tdata)),this.m_game_type!=db.BattleGameType.EventDungeonSearch&&this.m_user_cost_label.setString("cost "+troops_cost+"/"+user_cost_bnd.cost)}.bind(this)),this.m_game_type==db.BattleGameType.EventDungeonSearch){this.removeChild(this.m_user_cost_label);var navi=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_timebar.png",RectZero());navi.setPreferredSize(cc.size(295,52)),navi.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),navi.setPosition(ccCenter(layer).x,488),layer.addChild(navi),this.m_event_dungeon_search_troops_title_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_221),this.m_event_dungeon_search_troops_title_label.enableOutline(cc.color.BLACK,2),this.m_event_dungeon_search_troops_title_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_event_dungeon_search_troops_title_label.setPosition(ccCenter(navi)),navi.addChild(this.m_event_dungeon_search_troops_title_label);var mt=MasterManager.getInstance(),event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=mt.get_EventDungeonPeriod(event_dungeon_period_idx);this.m_event_dungeon_search_attk_pwr_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_201),this.m_event_dungeon_search_attk_pwr_label.setAnchorPoint(ZERO()),this.m_event_dungeon_search_attk_pwr_label.setPosition(23,131),layer.addChild(this.m_event_dungeon_search_attk_pwr_label),this.m_gain_up_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_gain_up_label.setAnchorPoint(ZERO()),this.m_gain_up_label.setPosition(23,110),layer.addChild(this.m_gain_up_label);var totalbar=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_totalbar.png",period.event_dungeon_group_idx));totalbar.setAnchorPoint(ZERO()),totalbar.setPosition(191,109),layer.addChild(totalbar),GameContext.getInstance().getEvenetDungeonSearchTroopsNum().done(function(troops_num){this.m_event_dungeon_search_troops_title_label.setString(cmString(res_str("label_event_dungeon_search_troops_title"),troops_num),LABEL_FONT_INDEX.FONT_221);var total_attk_pwr=EventDungeonService.getInstance().getEventDungeonSearchTroopsTotalAttkPwr(troops_num);this.m_event_dungeon_search_attk_pwr_label.setString(cmString(res_str("label_event_dungeon_search_total_attk_pwr"),Number(Math.floor(total_attk_pwr)).toLocaleString("en")));var attk_pwr_bonus=MasterTable.getInstance().get_EventDungeonSearchAttkPwrBonusInfo(period.event_dungeon_group_idx,total_attk_pwr),gain_up_prcnt=0;0!=attk_pwr_bonus.gain_up&&(gain_up_prcnt=attk_pwr_bonus.gain_up/100),this.m_gain_up_label.setString(cmString(res_str("label_event_dungeon_search_total_attk_gain_point_up"),gain_up_prcnt)),attk_pwr_bonus=total_attk_pwr=null}.bind(this))}if(this.m_deckBoxLayer=this.getDeckLayer(),this.m_deckBoxLayer.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_deckBoxLayer.setPosition(55,224),this.m_game_type==db.BattleGameType.GreatWallDungeon&&this.m_deckBoxLayer.setPosition(55,191),layer.addChild(this.m_deckBoxLayer),this.m_game_type==db.BattleGameType.EventDungeonSearch){var batch_off_btn=new LabelButton("btn_27_off.png","btn_27_on.png","",ccui.Widget.PLIST_TEXTURE);batch_off_btn.setFont(LABEL_FONT_INDEX.FONT_181),batch_off_btn.setString(res_str("label_yunhee_all_troops_delete_general_title")),batch_off_btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),batch_off_btn.setPosition(ccCenter(layer).x,16),batch_off_btn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],NOTIFY_MENU_EVENT_DUNGEON_SEARCH_BATCH_OFF)}.bind(this)),layer.addChild(batch_off_btn);var auto_pairing_btn=new LabelButton("btn_27_off.png","btn_27_on.png","",ccui.Widget.PLIST_TEXTURE);auto_pairing_btn.setFont(LABEL_FONT_INDEX.FONT_181),auto_pairing_btn.setOffFont(LABEL_FONT_INDEX.FONT_188),auto_pairing_btn.setString(res_str("btn_label_auto_pairing_mode")),auto_pairing_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),auto_pairing_btn.setPosition(ccCenter(layer).x-ccCenter(auto_pairing_btn).x,16),auto_pairing_btn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],NOTIFY_MENU_EVENT_DUNGEON_SEARCH_AUTO_PAIRING)}.bind(this)),layer.addChild(auto_pairing_btn),this.m_leader_btn=new LabelButton("btn_27_off.png","btn_27_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_leader_btn.setFont(LABEL_FONT_INDEX.FONT_181),this.m_leader_btn.setString(res_str("label_leader_setting")),this.m_leader_btn.setAnchorPoint(ZERO()),this.m_leader_btn.setPosition(ccCenter(layer).x+ccCenter(this.m_leader_btn).x,16),this.m_leader_btn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],NOTIFY_MENU_LEADER_SET)}.bind(this)),layer.addChild(this.m_leader_btn),this.m_leader_cancel_btn=new LabelButton("btn_28_off.png","btn_28_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_leader_cancel_btn.setFont(LABEL_FONT_INDEX.FONT_181),this.m_leader_cancel_btn.setString(res_str("label_leader_setting_cancel")),this.m_leader_cancel_btn.setAnchorPoint(ZERO()),this.m_leader_cancel_btn.setPosition(ccCenter(layer).x+ccCenter(this.m_leader_cancel_btn).x,16),this.m_leader_cancel_btn.setVisible(!1),this.m_leader_cancel_btn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],NOTIFY_MENU_LEADER_SET)}.bind(this)),layer.addChild(this.m_leader_cancel_btn)}else{var btn_battle_formation=new LabelButton("btn_16_off.png","btn_16_on.png","",ccui.Widget.PLIST_TEXTURE);btn_battle_formation.setFont(LABEL_FONT_INDEX.FONT_241),btn_battle_formation.setString(res_str("btn_label_battle_formation_title_2")),btn_battle_formation.setAnchorPoint(ZERO()),btn_battle_formation.setPosition(0,16),layer.addChild(btn_battle_formation),btn_battle_formation.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],NOTIFY_MENU_BATTLE_FORM)}.bind(this));var leader_title=cmLabel.getLabel(res_str("label_leader_skill"),LABEL_FONT_INDEX.FONT_2615);if(leader_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),leader_title.setPosition(17,172),layer.addChild(leader_title),this.m_game_type==db.BattleGameType.GreatWallDungeon){var warning_tag=cc.Sprite.create("#btn_warning_off.png");warning_tag.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),warning_tag.setPosition(372,160),layer.addChild(warning_tag);var tooltip_btn=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(1,1,1,1)));tooltip_btn.setAnchorPoint(ANCHOR_MIDDLE()),tooltip_btn.setPreferredSize(ccSize(warning_tag)),tooltip_btn.setPosition(ccCenter(warning_tag)),warning_tag.addChild(tooltip_btn),tooltip_btn.addTargetWithActionForControlEvents(this,this.onTouchWarningTooltip,cc.CONTROL_EVENT_TOUCH_DOWN),tooltip_btn.addTargetWithActionForControlEvents(this,this.onTouchWarningTooltip,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onTouchWarningTooltip,cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onTouchWarningTooltip,cc.CONTROL_EVENT_TOUCH_CANCEL);var boxSize=ccSize(warning_tag);if(null==this.tooltip_box){var world_pos=layer.convertToWorldSpace(warning_tag.getPosition());world_pos.x=world_pos.x+3*boxSize.width,world_pos.y=world_pos.y+boxSize.height+5,this.tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.tooltip_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.tooltip_box.setPosition(world_pos),this.tooltip_box.setVisible(!1),this.getParent().addChild(this.tooltip_box)}null==this.tooltip_content&&(this.tooltip_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.tooltip_content.setAnchorPoint(ANCHOR_MIDDLE()),this.tooltip_box.addChild(this.tooltip_content))}this.m_leader_node=new WeeklyDeckReadyLeaderNode,this.m_leader_node.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_leader_node.setPosition(17,98),layer.addChild(this.m_leader_node),this.m_game_type==db.BattleGameType.GreatWallDungeon&&(leader_title.setPosition(17,162),this.m_leader_node.setPosition(17,88)),this.m_leader_btn=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_leader_btn.setFont(LABEL_FONT_INDEX.FONT_241),this.m_leader_btn.setString(res_str("label_leader_setting")),this.m_leader_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_leader_btn.setPosition(ccWidth(btn_battle_formation),16),this.m_leader_btn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],NOTIFY_MENU_LEADER_SET)}.bind(this)),layer.addChild(this.m_leader_btn),this.m_leader_cancel_btn=new LabelButton("btn_08_off.png","btn_08_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_leader_cancel_btn.setFont(LABEL_FONT_INDEX.FONT_221),this.m_leader_cancel_btn.setString("キャンセル"),this.m_leader_cancel_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_leader_cancel_btn.setPosition(ccWidth(btn_battle_formation),16),this.m_leader_cancel_btn.setVisible(!1),this.m_leader_cancel_btn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],NOTIFY_MENU_LEADER_SET)}.bind(this)),layer.addChild(this.m_leader_cancel_btn)}if(this.m_game_type!=db.BattleGameType.EventDungeonSearch){var leftArrowBtn=new ccui.Button("btn_main_banner_arrow_off.png","btn_main_banner_arrow_on.png","",ccui.Widget.PLIST_TEXTURE);leftArrowBtn.setAnchorPoint(ZERO()),leftArrowBtn.setPosition(0,300),layer.addChild(leftArrowBtn),leftArrowBtn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],btn_left_arrow)}.bind(this));var rightArrowBtn=new ccui.Button("btn_main_banner_arrow_off.png","btn_main_banner_arrow_on.png","",ccui.Widget.PLIST_TEXTURE);rightArrowBtn.setRotation(180),rightArrowBtn.setAnchorPoint(ZERO()),rightArrowBtn.setPosition(ccPosX(this.m_deckBoxLayer)+ccWidth(this.m_deckBoxLayer)+ccWidth(rightArrowBtn)+7,300+ccHeight(rightArrowBtn)),layer.addChild(rightArrowBtn),rightArrowBtn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],btn_right_arrow)}.bind(this))}}var battle_tech=cc.Sprite.create("#img_battletech.png");return battle_tech.setAnchorPoint(ZERO()),battle_tech.setPosition(343,402),layer.addChild(battle_tech),layer},getDeckSatus:function(){return this.m_deck_status},getLeftFriendLayer:function(){var layer=new cc.Layer;return layer.setContentSize(349,494),null!=this.m_skeletonNode&&(this.m_skeletonNode.removeFromParent(),this.m_skeletonNode=null),this.m_skeletonNode=cc.SkeletonAnimation("gnrl_"+leadingZeros(info.gnrl_group,3)+"/sd/"+info.bone_id+".json","gnrl_"+leadingZeros(info.gnrl_group,3)+"/sd/"+info.skin_id+".atlas",.33),this.m_skeletonNode.setPosition(176,112),layer.addChild(this.m_skeletonNode),this.m_skeletonNode.setSkin(info.class_type),this.m_skeletonNode.setAnimation(0,"idle",!0),this.m_skeletonNode.setMix("idle","attack",.2),this.m_skeletonNode.setMix("idle","skill",.2),this.m_skeletonNode.setMix("attack","idle",.2),this.m_skeletonNode.setMix("skill","idle",.2),layer},setUserYunheeBound:function(){if(null!=this.m_yh_title){if(this.m_deck_status==DECK_STATUS.ARRANGEMENT_MODE||this.m_deck_status==DECK_STATUS.ARRANGEMENT_SELECT_YUNHEE)return this.m_yh_title.setString(res_str("label_yunhee_select_please")),void this.m_yh_title.setColor(COLOR(262));var bound=NetService().get_user_yunhee_bound();this.m_user_yunhee_bound=bound,this.m_yunhee_cnt=this.m_filterGnrlList.size();var mt=MasterManager.getInstance();if(this.m_game_type==db.BattleGameType.GreatWallDungeon){var max_cnt=mt.get_CountFunction(24).value,cnt=0;null==NetService().get_great_wall_troops_info().partin_generals&&(cnt=0),cnt=NetService().get_great_wall_troops_info().partin_generals.length,this.m_yh_title.setString(cmString(res_str("label_great_wall_deck_choice_gnrl"),cnt,max_cnt)),this.m_yh_title.setColor(COLOR(261))}else this.m_yh_title.setString(cmString(res_str("label_retention_yunhee_2"),this.m_yunhee_cnt,this.m_user_yunhee_bound)),this.m_yh_title.setColor(COLOR(261));null!=this.m_itemPlusBtn&&this.m_itemPlusBtn.setPositionX(this.m_yh_title.x+ccWidth(this.m_yh_title)+10),this.m_yh_title.setColor(COLOR(261));var yunhee_bound=mt.get_CountFunction(COUNT_FUNCTION_YUNHEE_INVENTORY_BOUND).value;this.m_user_yunhee_bound>=yunhee_bound&&null!=this.m_itemPlusBtn&&this.m_itemPlusBtn.setVisible(!1)}},setBatchSellMode:function(batch_rare_types,count,is_except_mtrl){this.m_deck_status!=DECK_STATUS.ARRANGEMENT_MODE&&this.m_deck_status!=DECK_STATUS.ARRANGEMENT_SELECT_YUNHEE||this.setArrangementMode(),this.setDeckStatus(DECK_STATUS.BATCH_SELL_MODE),this.m_sellYunheeGnrlKeys=[],this.m_sellYunheeGnrlInfoList=[],this.m_right_bottom_layer.setVisible(!1),this.m_right_sell_bottom_layer.setVisible(!0),this.m_yunhee_cnt=this.m_filterGnrlList.length,this.m_yh_title.setString(cmString(res_str("label_retention_yunhee_2"),this.m_yunhee_cnt,this.m_user_yunhee_bound)),this.m_yh_title.setColor(COLOR(261)),null!=this.m_itemPlusBtn&&this.m_itemPlusBtn.setPositionX(this.m_yh_title.x+ccWidth(this.m_yh_title)+10),this.m_sell_gold=0,this.m_sell_yhpt=0,this.m_sell_heaven_pt=0,this.m_sell_yunhee_count=0,this.m_sellYunheeGnrlKeys=[],this.m_sell_gold_label.setString(Number(this.m_sell_gold).toLocaleString("en")),this.m_sell_yhpt_label.setString(Number(this.m_sell_yhpt).toLocaleString("en")),this.m_sell_heaven_pt_label.setString(Number(this.m_sell_heaven_pt).toLocaleString("en")),this.m_yunhee_sell_count_label.setString("0/"+YUNHEE_SELL_MAX_BOUND),this.setBatchSellGeneralSort(batch_rare_types,count,is_except_mtrl)?(this.sort(),this.m_tableView.setViewSize(this.m_sell_size),this.m_tableView.setPosition(11,152),this.m_tableView.reloadData(),null!=this.m_helpBtn&&this.m_helpBtn.setVisible(!1)):this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],yunhee_batch_sell_not_have_general)},setBatchSellGeneralSort:function(batch_rare_types,_count,is_except_mtrl){batch_rare_types.sort(function(a,b){return a-b}),this.m_filterGnrlList=stable(this.m_filterGnrlList,function(l,r){return l.gnrl_id<r.gnrl_id}),this.m_filterGnrlList=stable(this.m_filterGnrlList,function(l,r){return l.gnrl_level>r.gnrl_level}),this.m_filterGnrlList=stable(this.m_filterGnrlList,function(l,r){return l.class_type>r.class_type}),this.m_filterGnrlList=stable(this.m_filterGnrlList,function(l,r){return l.rare_type>r.rare_type});for(var count=0,idx=0;idx<batch_rare_types.length;idx++)for(var rare_type=batch_rare_types[idx],jdx=0;jdx<this.m_filterGnrlList.length;jdx++){var gnrl=this.m_filterGnrlList[jdx];if(count==_count)break;if(!is_except_mtrl||gnrl.gnrl_type!=GENERAL_TYPE_EVOLVE_MATERIAL&&gnrl.gnrl_type!=GENERAL_TYPE_LIMIT_OVER&&gnrl.gnrl_type!=GENERAL_TYPE_MATERIAL){var key={};key.gnrl_id=gnrl.gnrl_id,key.gnrl_num=gnrl.gnrl_num,rare_type==gnrl.rare_type&&(gnrl.is_sell_selected=!0,this.addSellGeneralBatchMode(key),count++),key={}}}return this.calculBatchSell(),0<count},setSellMode:function(){this.m_deck_status!=DECK_STATUS.ARRANGEMENT_MODE&&this.m_deck_status!=DECK_STATUS.ARRANGEMENT_SELECT_YUNHEE||this.setArrangementMode(),this.setDeckStatus(DECK_STATUS.SELL_MODE),this.m_sellYunheeGnrlKeys=[],this.m_sellYunheeGnrlInfoList=[],this.m_right_bottom_layer.setVisible(!1),this.m_right_sell_bottom_layer.setVisible(!0),this.m_yunhee_cnt=this.m_filterGnrlList.length,this.m_yh_title.setString(cmString(res_str("label_retention_yunhee_2"),this.m_yunhee_cnt,this.m_user_yunhee_bound)),this.m_yh_title.setColor(COLOR(261)),null!=this.m_itemPlusBtn&&this.m_itemPlusBtn.setPositionX(this.m_yh_title.x+ccWidth(this.m_yh_title)+10),this.m_sell_gold=0,this.m_sell_yhpt=0,this.m_sell_heaven_pt=0,this.m_sell_yunhee_count=0,this.m_sellYunheeGnrlKeys=[],this.m_sell_gold_label.setString(Number(this.m_sell_gold).toLocaleString("en")),this.m_sell_yhpt_label.setString(Number(this.m_sell_yhpt).toLocaleString("en")),this.m_sell_heaven_pt_label.setString(Number(this.m_sell_heaven_pt).toLocaleString("en")),this.m_tab_type==YunheeLevelUpTapTypeEnum.tab_type_yunhee?this.m_sell_yunhee_label.setString(res_str("label_sell_yunhee_count")):this.m_sell_yunhee_label.setString(res_str("label_sell_general_material_count")),this.m_yunhee_sell_count_label.setString("0/"+YUNHEE_SELL_MAX_BOUND),this.m_yunhee_sell_count_label.setPosition(ccPosX(this.m_sell_yunhee_label)+ccWidth(this.m_sell_yunhee_label)+10,49),this.sort(),this.m_tableView.setViewSize(this.m_sell_size),this.m_tableView.setPosition(11,152),this.m_tableView.reloadData(),null!=this.m_helpBtn&&this.m_helpBtn.setVisible(!1)},setSellCancel:function(){this.setDeckStatus(DECK_STATUS.NONE),this.m_right_bottom_layer.setVisible(!0),this.m_right_sell_bottom_layer.setVisible(!1),this.m_sell_gold=0,this.m_sell_yhpt=0,this.m_sell_heaven_pt=0,this.m_sell_yunhee_count=0,this.m_sellYunheeGnrlKeys=[],this.m_sellYunheeGnrlInfoList=[],this.sort(),this.m_tableView.reloadData(),this.m_tableView.setViewSize(this.m_normal_size),this.m_tableView.setPosition(11,84),this.m_tableView.setContentOffset(this.m_tableView.minContainerOffset()),this.m_yunhee_cnt=this.m_filterGnrlList.length,this.m_yh_title.setString(cmString(res_str("label_retention_yunhee_2"),this.m_yunhee_cnt,this.m_user_yunhee_bound)),this.m_yh_title.setColor(COLOR(261)),null!=this.m_itemPlusBtn&&this.m_itemPlusBtn.setPositionX(this.m_yh_title.x+ccWidth(this.m_yh_title)+10),null!=this.m_helpBtn&&this.m_helpBtn.setVisible(!0)},getSellGeneralKeys:function(){return this.m_sellYunheeGnrlKeys},getSellGeneralInfoList:function(){return this.m_sellYunheeGnrlInfoList},getYunheeSellCount:function(){return this.m_sell_yunhee_count},getSellGold:function(){return this.m_sell_gold},getSellYhpt:function(){return this.m_sell_yhpt},getSellHeavenPt:function(){return this.m_sell_heaven_pt},isExistSellInSR:function(){for(var mt=MasterManager.getInstance(),idx=0;idx<this.m_sellYunheeGnrlKeys.length;idx++){var g=mt.get_General(this.m_sellYunheeGnrlKeys[idx].gnrl_id);if(g.rare_type>RARE_TYPE_HR&&g.gnrl_type==GENERAL_TYPE_YUNHEE)return!0}return!1},setArrangementMode:function(){if(this.m_deck_status==DECK_STATUS.NONE){if(this.m_btn_arrangement_cancel.setVisible(!0),this.m_btn_arrangement.setVisible(!1),this.m_game_type==db.BattleGameType.GreatWallDungeon){var max_cnt=MasterManager.getInstance().get_CountFunction(24).value,cnt=NetService().get_great_wall_troops_info().partin_generals.size();this.m_yh_title.setString(cmString(res_str("label_great_wall_deck_choice_gnrl"),cnt,max_cnt)),this.m_yh_title.setColor(COLOR(261))}else this.m_yh_title.setString(res_str("label_yunhee_select_please")),this.m_yh_title.setColor(COLOR(262));null!=this.m_itemPlusBtn&&(this.m_itemPlusBtn.setPositionX(this.m_yh_title.x+ccWidth(this.m_yh_title)+10),this.m_itemPlusBtn.setVisible(!1)),null!=this.m_helpBtn&&this.m_helpBtn.setVisible(!1),this.setDeckStatus(DECK_STATUS.ARRANGEMENT_MODE)}else if(this.m_deck_status==DECK_STATUS.ARRANGEMENT_MODE||this.m_deck_status==DECK_STATUS.ARRANGEMENT_SELECT_YUNHEE){if(this.setDeckStatus(DECK_STATUS.NONE),this.m_troopsContainer.stopActionArrow(),this.m_btn_arrangement_cancel.setVisible(!1),this.m_btn_arrangement.setVisible(!0),this.m_tab_type==YunheeLevelUpTapTypeEnum.tab_type_material&&(null!=this.m_btn_arrangement&&this.m_btn_arrangement.setEnabled(!1),null!=this.m_btn_batch_sell&&this.m_btn_batch_sell.setEnabled(!1)),this.setUserYunheeBound(),null!=this.m_itemPlusBtn){var yunhee_bound=MasterManager.getInstance().get_CountFunction(COUNT_FUNCTION_YUNHEE_INVENTORY_BOUND).value;this.m_user_yunhee_bound<yunhee_bound?this.m_itemPlusBtn.setVisible(!0):this.m_itemPlusBtn.setVisible(!1)}null!=this.m_helpBtn&&this.m_helpBtn.setVisible(!0)}},setLeaderMode:function(){this.m_deck_status!=DECK_STATUS.CHOICE_LEADER?this.setDeckStatus(DECK_STATUS.CHOICE_LEADER):this.setDeckStatus(DECK_STATUS.NONE)},getSortLayer:function(){var layer=new cc.Layer,sort_btn_strs=[];USE_NEW_SORT&&(sort_btn_strs.push(res_str("btn_sort_hp")),sort_btn_strs.push(res_str("btn_sort_def")),sort_btn_strs.push(res_str("btn_sort_attk"))),sort_btn_strs.push(res_str("btn_sort_dungeon_buff")),sort_btn_strs.push(res_str("btn_sort_lv")),sort_btn_strs.push(res_str("btn_sort_state")),sort_btn_strs.push(res_str("btn_sort_fight_type")),sort_btn_strs.push(res_str("btn_sort_arm_service_type")),sort_btn_strs.push(res_str("btn_sort_yunhee")),sort_btn_strs.push(res_str("btn_sort_gain")),sort_btn_strs.push(res_str("btn_sort_rare_type"));for(var btn_pos_y=0,str_size=sort_btn_strs.length,idx=0;idx<sort_btn_strs.length;idx++){var btn=new LabelButton("btn_48_off.png","btn_48_on.png","",ccui.Widget.PLIST_TEXTURE);btn.setFont(LABEL_FONT_INDEX.FONT_161),btn.setString(sort_btn_strs[idx]),btn.setAnchorPoint(ZERO()),btn.setPosition(0,btn_pos_y),btn.addClickEventListener(function(sender){this.setSort(sender.getTag())}.bind(this)),layer.addChild(btn),btn_pos_y+=ccHeight(btn),btn.setTag(str_size--)}return sort_btn_strs=[],layer.setContentSize(111,btn_pos_y),layer},setSortLabel:function(sort_index){switch(sort_index){case SORT_RARE:this.m_btn_sort.setString(res_str("btn_sort_rare_type"));break;case SORT_LV:this.m_btn_sort.setString(res_str("btn_sort_lv"));break;case SORT_STATE:this.m_btn_sort.setString(res_str("btn_sort_state"));break;case SORT_ARMSERVICE:this.m_btn_sort.setString(res_str("btn_sort_arm_service_type"));break;case SORT_YUNHEE:this.m_btn_sort.setString(res_str("btn_sort_yunhee"));break;case SORT_GAIN:this.m_btn_sort.setString(res_str("btn_sort_gain"));break;case SORT_DUNGEON_BUFF:this.m_btn_sort.setString(res_str("btn_sort_dungeon_buff"));break;case SORT_FIGHT_TYPE:this.m_btn_sort.setString(res_str("btn_sort_fight_type"));break;case SORT_ATT:this.m_btn_sort.setString(res_str("btn_sort_attk"));break;case SORT_DEF:this.m_btn_sort.setString(res_str("btn_sort_def"));break;case SORT_HP:this.m_btn_sort.setString(res_str("btn_sort_hp"))}},initSort:function(sort_index){this.setSortLabel(sort_index),this.sort()},setSort:function(sort_index){this.m_sort!=sort_index&&(this.setSortLabel(sort_index),this.m_sort=sort_index,GameDefault.getInstance().setUserGeneralSort(sort_index),this.sort(!0)),this.runActionSortButton()},runActionSortButton:function(){this.m_isSortBtnVisible?(this.m_sortLayer.setVisible(!1),this.m_isSortBtnVisible=!1):(this.m_sortLayer.setVisible(!0),this.m_isSortBtnVisible=!0)},setArrangementDisabled:function(){this.setDeckStatus(DECK_STATUS.ARRANGEMENT_MODE),this.m_troopsContainer.stopActionArrow(),this.m_troops_select_gnrl_id=0,this.m_troops_select_gnrl_num=0,this.setInitSelected()},deleteYunheeTroops:function(){this.m_listener.setSwallowTouches(!1);for(var i=0;i<MAX_TROOPS_COUNT;i++){var rc=this.m_troopsContainer.m_rects[i];if(cc.rectContainsPoint(rc,this.m_beginPos)){var tutorial=TutorialContextV2.getInstance();if(tutorial.IsCompleteAllTutorial())0==i&&this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],menu_deck_1),1==i&&this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],menu_deck_2),2==i&&this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],menu_deck_3),3==i&&this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],menu_deck_4),4==i&&this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],menu_deck_5);else{var step=tutorial.getCurrentTutorialStep();step.tutorial_page==TUTORIAL_PAGE_5_TROOPS&&7==step.tutorial_step&&3==i&&this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],menu_deck_4)}}}},addSellGeneralBatchMode:function(key){var info={};GeneralService.getInstance().getUserGeneralInfo(key,info),this.m_sellYunheeGnrlInfoList.push(info),this.m_sellYunheeGnrlKeys.push(key),this.m_sell_yunhee_count=this.m_sellYunheeGnrlKeys.length},calculBatchSell:function(){var sell_item=this.calculatorYunheeSellResult(this.m_sellYunheeGnrlKeys,!0);this.m_sell_gold=sell_item.gold,this.m_sell_yhpt=sell_item.yhpt,this.m_sell_heaven_pt=sell_item.heaven_pth,this.m_sell_gold_label.setString(Number(this.m_sell_gold).toLocaleString("en")),this.m_sell_yhpt_label.setString(Number(this.m_sell_yhpt).toLocaleString("en")),this.m_sell_heaven_pt_label.setString(Number(this.m_sell_heaven_pt).toLocaleString("en")),this.m_yunhee_sell_count_label.setString(this.m_sell_yunhee_count+"/"+YUNHEE_SELL_MAX_BOUND)},addSellGeneral:function(key){var info={};GeneralService.getInstance().getUserGeneralInfo(key,info),this.m_sellYunheeGnrlInfoList.push(info),this.m_sellYunheeGnrlKeys.push(key),this.m_sell_yunhee_count=this.m_sellYunheeGnrlKeys.length;var sell_item=this.calculatorYunheeSellResult(this.m_sellYunheeGnrlKeys);this.m_sell_gold=sell_item.gold,this.m_sell_yhpt=sell_item.yhpt,this.m_sell_heaven_pt=sell_item.heaven_pth,this.m_sell_gold_label.setString(Number(this.m_sell_gold).toLocaleString("en")),this.m_sell_yhpt_label.setString(Number(this.m_sell_yhpt).toLocaleString("en")),this.m_sell_heaven_pt_label.setString(Number(this.m_sell_heaven_pt).toLocaleString("en")),this.m_yunhee_sell_count_label.setString(this.m_sell_yunhee_count+"/"+YUNHEE_SELL_MAX_BOUND),info={}},delSellGeneral:function(key){var new_end=this.m_sellYunheeGnrlKeys.filter(function(l){return l.gnrl_id!=key.gnrl_id||l.gnrl_num!=key.gnrl_num});this.m_sellYunheeGnrlKeys=new_end;var new_end_2=this.m_sellYunheeGnrlInfoList.filter(function(l){return l.gnrl_id!=key.gnrl_id||l.gnrl_num!=key.gnrl_num});this.m_sellYunheeGnrlInfoList=new_end_2,this.m_sell_yunhee_count=this.m_sellYunheeGnrlKeys.length;var sell_item=this.calculatorYunheeSellResult(this.m_sellYunheeGnrlKeys);this.m_sell_gold=sell_item.gold,this.m_sell_yhpt=sell_item.yhpt,this.m_sell_heaven_pt=sell_item.heaven_pth,this.m_sell_gold_label.setString(Number(this.m_sell_gold).toLocaleString("en")),this.m_sell_yhpt_label.setString(Number(this.m_sell_yhpt).toLocaleString("en")),this.m_sell_heaven_pt_label.setString(Number(this.m_sell_heaven_pt).toLocaleString("en")),this.m_yunhee_sell_count_label.setString(this.m_sell_yunhee_count+"/"+YUNHEE_SELL_MAX_BOUND)},calculatorYunheeSellResult:function(keys,isBatchSell){null==isBatchSell&&(isBatchSell=!1);var gold=0,yhpt=0,heaven_pt=0,generalService=GeneralService.getInstance();if(keys.length<=1&&(this.m_yunheeSellTempList=[],this.m_tempGold=0,this.m_tempyhpt=0,this.m_temphevenpt=0),keys.length!=this.m_yunheeSellTempList.length&&0==isBatchSell){if(keys.length>this.m_yunheeSellTempList.length&&0<keys.length){this.m_yunheeSellTempList=$.extend([],keys);var infotemp=keys[keys.length-1],retval={};return generalService.getUserGeneralInfo(infotemp,retval),this.m_tempGold+=retval.sell_gold,this.m_tempyhpt+=retval.sell_yhpt,null!=retval.sell_heaven_pt?this.m_temphevenpt+=retval.sell_heaven_pt:this.m_temphevenpt+=0,{gold:this.m_tempGold,yhpt:this.m_tempyhpt,heaven_pth:this.m_temphevenpt}}if(keys.length<=0)return this.m_yunheeSellTempList=[],this.m_tempGold=0,this.m_tempyhpt=0,this.m_temphevenpt=0,{gold:this.m_tempGold,yhpt:this.m_tempyhpt,heaven_pth:this.m_temphevenpt};this.m_yunheeSellTempList=$.extend([],keys);var gnrlInfo={gnrl_id:this.m_choice_gnrl.gnrl_id,gnrl_num:this.m_choice_gnrl.gnrl_num};retval={};return generalService.getUserGeneralInfo(gnrlInfo,retval),this.m_tempGold-=retval.sell_gold,this.m_tempyhpt-=retval.sell_yhpt,null!=retval.sell_heaven_pt?this.m_temphevenpt-=retval.sell_heaven_pt:this.m_temphevenpt-=0,{gold:this.m_tempGold,yhpt:this.m_tempyhpt,heaven_pth:this.m_temphevenpt}}this.m_yunheeSellTempList=$.extend([],keys);for(var idx=0;idx<keys.length;idx++){var info={};generalService.getUserGeneralInfo(keys[idx],info),gold+=info.sell_gold,yhpt+=info.sell_yhpt,heaven_pt+=null!=info.sell_heaven_pt?info.sell_heaven_pt:0}return{gold:this.m_tempGold=gold,yhpt:this.m_tempyhpt=yhpt,heaven_pth:this.m_temphevenpt=heaven_pt}},calculatorYunheeSellGold:function(keys){for(var gold=0,generalService=GeneralService.getInstance(),idx=0;idx<keys.length;idx++){var info={};generalService.getUserGeneralInfo(keys[idx],info),gold+=info.sell_gold}return gold},calculatorYunheeSellYhpt:function(keys){for(var yhpt=0,generalService=GeneralService.getInstance(),idx=0;idx<keys.length;idx++){var info={};generalService.getUserGeneralInfo(keys[idx],info),yhpt+=info.sell_yhpt}return yhpt},calculatorYunheeSellHeavenPt:function(keys){for(var heaven_pt=0,generalService=GeneralService.getInstance(),idx=0;idx<keys.length;idx++){var info={};generalService.getUserGeneralInfo(keys[idx],info),heaven_pt+=null!=info.sell_heaven_pt?info.sell_heaven_pt:0}return heaven_pt},setYunheeSelectMode:function(title){this.setDeckStatus(DECK_STATUS.YUNHEE_SELECT_MODE),this.m_yunhee_select_title=title},getUserGeneralInfo:function(){return this.m_choice_gnrl},getStateFilterButton:function(index){var btn_dis_sprite=cc.Sprite.create("#btn_09_"+index+"_on.png"),btn_text_dis_sprite=cc.Sprite.create("#img_text_09_"+index+".png");btn_text_dis_sprite.setPosition(btn_dis_sprite.width/2,btn_dis_sprite.height/2),btn_dis_sprite.addChild(btn_text_dis_sprite);var btn_none_sprite=cc.Sprite.create("#btn_09_none.png"),btn_text_none_sprite=cc.Sprite.create("#img_text_09_"+index+".png");btn_text_none_sprite.setPosition(btn_none_sprite.width/2,btn_none_sprite.height/2),btn_none_sprite.addChild(btn_text_none_sprite);var btn_on_sprite=cc.Sprite.create("#btn_09_on.png"),btn_text_on_sprite=cc.Sprite.create("#img_text_09_"+index+".png");return btn_text_on_sprite.setPosition(btn_on_sprite.width/2,btn_on_sprite.height/2),btn_on_sprite.addChild(btn_text_on_sprite),new ccui.Button(btn_none_sprite,btn_on_sprite,btn_dis_sprite)},getUserDeckGeneralInfo:function(){var key={};key.gnrl_id=this.m_troops_select_gnrl_id,key.gnrl_num=this.m_troops_select_gnrl_num;return this.m_deck_gnrl={},GeneralService.getInstance().getUserGeneralInfo(key,this.m_deck_gnrl),this.m_deck_gnrl},getTableViewOffset:function(){return this.m_tableView.getContentOffset()},setDeckStatus:function(_s){this.m_deck_status=_s,this.m_deck_status==DECK_STATUS.NONE?(this.m_leader_btn.setVisible(!0),this.m_leader_cancel_btn.setVisible(!1),this.m_troopsContainer.stopActionArrow(),this.setInitSelected()):this.m_deck_status==DECK_STATUS.CHOICE_LEADER&&(this.m_leader_btn.setVisible(!1),this.m_leader_cancel_btn.setVisible(!0),this.m_troopsContainer.runActionArrow(),this.m_btn_arrangement_cancel.setVisible(!1),this.m_btn_arrangement.setVisible(!0))},update:function(dt){},setInitSelected:function(){for(var idx=0;idx<this.m_filterGnrlList.length;idx++)this.m_filterGnrlList[idx].is_selected=!1,this.m_filterGnrlList[idx].is_sell_selected=!1;var offset=this.m_tableView.getContentOffset();this.m_tableView.reloadData(),this.m_tableView.setContentOffset(offset)},tableCellUnhighlight:function(){},cellSizeForTable:function(table){return this.m_game_type==db.BattleGameType.GreatWallDungeon?cc.size(456,138):cc.size(456,108)},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;cell=null!=c?c:new YunheeListCell(this.choiceGnrl.bind(this),this.m_game_type,this.m_deck_status);var desc=[],start=idx*YUNHEE_COLUMN_COUNT,end=start+YUNHEE_COLUMN_COUNT;if(end<this.m_filterGnrlList.length)for(idx=start;idx<end;idx++)desc.push(this.m_filterGnrlList[idx]);else for(idx=start;idx<this.m_filterGnrlList.length;idx++)desc.push(this.m_filterGnrlList[idx]);return cell.setGnrlDatas(desc,this.m_deck_status),this.m_yunhee_cell_list.push(cell),cell},updateTroopsBtns:function(){var tm=this.getCurrentTroopsNum();if(1==USE_LOCAL_STORAGE_TROOPS_OFF)for(var i=0;i<this.m_troops_btns.length;i++){var t=i+1;this.m_troops_btns[i].setEnabled(!(t==tm))}else tm.done(function(troops_num){for(var i=0;i<this.m_troops_btns.length;i++){var t=i+1;this.m_troops_btns[i].setEnabled(!(t==troops_num))}}.bind(this))},tableCellTouched:function(table,cell){if(window.clearTimeout(this.m_long_timer),!this.m_isLongTouch){null!=cell&&cell.touchPosCell(cell.getTouchPos(),cell.getTouchWorldPos())}},choiceGnrl:function(info){var tutorial=TutorialContextV2.getInstance();if(!tutorial.IsCompleteAllTutorial()&&(this.m_choice_gnrl=info).gnrl_id==TUTORIAL_DEFINE_YUNHEE){var step=tutorial.getCurrentTutorialStep();TUTORIAL_TAG_PAGE_2_LEVEL_UP_JANGRYANG==step.tagid&&this.m_gameObserver.postNotification(NOTIFICATION_TUTORIAL,message_complete_tutorial)}if(this.m_deck_status!=DECK_STATUS.ARRANGEMENT_SELECT_YUNHEE){if(this.m_isLongTouch)return void(info.gnrl_type!=GENERAL_TYPE_MATERIAL&&info.gnrl_type!=GENERAL_TYPE_EVOLVE_MATERIAL&&info.gnrl_type!=GENERAL_TYPE_LIMIT_OVER?(this.m_choice_gnrl=info,this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],NOTIFY_IS_LONG_CLICK)):this.m_isLongTouch=!1);if(this.m_deck_status==DECK_STATUS.ARRANGEMENT_MODE){if(info.gnrl_type==GENERAL_TYPE_MATERIAL||info.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL||info.gnrl_type==GENERAL_TYPE_LIMIT_OVER)return void this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],SORT_TYPE.invalid_deck_set_material);for(var gnrl in this.m_choice_gnrl=info,this.setDeckStatus(DECK_STATUS.ARRANGEMENT_SELECT_YUNHEE),this.m_arrangementGnrlKey.gnrl_id=info.gnrl_id,this.m_arrangementGnrlKey.gnrl_num=info.gnrl_num,this.isTableLayerArrangement(),this.m_filterGnrlList)this.m_filterGnrlList[gnrl].gnrl_num==info.gnrl_num?this.m_filterGnrlList[gnrl].is_selected=!0:this.m_filterGnrlList[gnrl].is_selected=!1;var offset=this.m_tableView.getContentOffset();this.m_tableView.reloadData(),this.m_tableView.setContentOffset(offset)}else if(this.m_deck_status==DECK_STATUS.NONE)this.m_choice_gnrl=info,GameContext.getInstance().setGeneralKey(info.gnrl_id,info.gnrl_num),this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],NOTIFY_MENU_YH_DETAIL);else if(this.m_deck_status==DECK_STATUS.SELL_MODE||this.m_deck_status==DECK_STATUS.BATCH_SELL_MODE){this.m_choice_gnrl=info;var isMaxCount=!1;this.m_sell_yunhee_count>=YUNHEE_SELL_MAX_BOUND&&(isMaxCount=!0);var gnrl_key={};if(gnrl_key.gnrl_id=info.gnrl_id,gnrl_key.gnrl_num=info.gnrl_num,isMaxCount)for(var idx=0;idx<this.m_filterGnrlList.length;idx++){if((gnrl=this.m_filterGnrlList[idx]).gnrl_num==info.gnrl_num){if(gnrl.is_sell_selected){gnrl.is_sell_selected=!1,this.delSellGeneral(gnrl_key),this.reloadTableView(!1);break}this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],sell_count_max);break}}else{for(idx=0;idx<this.m_filterGnrlList.length;idx++){if((gnrl=this.m_filterGnrlList[idx]).gnrl_num==info.gnrl_num){if(gnrl.is_sell_selected){gnrl.is_sell_selected=!1,this.delSellGeneral(gnrl_key);break}gnrl.is_sell_selected=!0,this.addSellGeneral(gnrl_key);break}}this.reloadTableView(!1)}}}else{if(this.m_arrangementGnrlKey.gnrl_id==info.gnrl_id&&this.m_arrangementGnrlKey.gnrl_num==info.gnrl_num){this.m_choice_gnrl=info,this.setChangeSelectedEnd();for(idx=0;idx<this.m_filterGnrlList.length;idx++)this.m_filterGnrlList[idx].is_selected=!1}else{if(info.gnrl_type==GENERAL_TYPE_MATERIAL||info.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL||info.gnrl_type==GENERAL_TYPE_LIMIT_OVER)return void this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],SORT_TYPE.invalid_deck_set_material);for(var gnrl in this.m_choice_gnrl=info,this.m_arrangementGnrlKey.gnrl_id=info.gnrl_id,this.m_arrangementGnrlKey.gnrl_num=info.gnrl_num,this.isTableLayerArrangement(),this.m_filterGnrlList)this.m_filterGnrlList[gnrl].gnrl_num==info.gnrl_num?this.m_filterGnrlList[gnrl].is_selected=!0:this.m_filterGnrlList[gnrl].is_selected=!1}offset=this.m_tableView.getContentOffset();this.m_tableView.reloadData(),this.m_tableView.setContentOffset(offset)}},getCurrentTroopsNum:function(){var deferred=$.Deferred(),troops_num=0,gd=GameDefault.getInstance();if(this.m_game_type==db.BattleGameType.WeeklyDungeon)gd.getUserWeeklyTroopsNum().done(function(data){troops_num=data,deferred.resolve(troops_num)});else if(this.m_game_type==db.BattleGameType.Mussang){gd.getUserMussangTroopsNum().done(function(data){troops_num=data,deferred.resolve(troops_num)})}else if(this.m_game_type==db.BattleGameType.Mission||this.m_game_type==db.BattleGameType.None){if(1==USE_LOCAL_STORAGE_TROOPS_OFF)return troops_num=gd.getUserTroopsNum();gd.getUserTroopsNum().done(function(data){troops_num=data,deferred.resolve(troops_num)})}else if(this.m_game_type==db.BattleGameType.EventDungeon){gd.getUserEventDungeonTroopsNum().done(function(data){troops_num=data,deferred.resolve(troops_num)})}else if(this.m_game_type==db.BattleGameType.DailyDungeon){gd.getUserDailyDungeonTroopsNum().done(function(data){troops_num=data,deferred.resolve(troops_num)})}else if(this.m_game_type==db.BattleGameType.RaidDungeon){var raid_boss=BattleContext._getInstance().getRaidBossData();gd.getUserRaidBossElementTroopsNum(raid_boss.raid_boss_info_idx).done(function(data){troops_num=data,deferred.resolve(troops_num)})}else if(this.m_game_type==db.BattleGameType.GreatWallDungeon){gd.getUserGreatWallTroopsNum().done(function(data){troops_num=data,deferred.resolve(troops_num)})}else if(this.m_game_type==db.BattleGameType.TowerDungeon){gd.getUserTowerDungeonTroopsNum().done(function(data){troops_num=data,deferred.resolve(troops_num)})}else if(this.m_game_type==db.BattleGameType.EventDungeonSearch){GameContext.getInstance().getEvenetDungeonSearchTroopsNum().done(function(data){troops_num=data,deferred.resolve(data)})}else if(this.m_game_type==db.BattleGameType.OnceADayDungeon){gd.getUserOnceADayDungeonTroopsNum().done(function(data){troops_num=data,deferred.resolve(data)})}else if(this.m_game_type==db.BattleGameType.EventMussangBossDungeon){gd.getUserEventMussangBossTroopsNum().done(function(data){troops_num=data,deferred.resolve(data)})}else if(this.m_game_type==db.BattleGameType.EventRaidDungeon){gd.getUserEventRaidDungeonTroopsNum().done(function(data){troops_num=data,deferred.resolve(data)})}return deferred},numberOfCellsInTableView:function(table){var cnt=Math.floor(this.m_filterGnrlList.length/YUNHEE_COLUMN_COUNT);return 0<Math.floor(this.m_filterGnrlList.length%YUNHEE_COLUMN_COUNT)&&(cnt+=1),cnt},tableCellSizeForIndex:function(){return this.m_game_type==db.BattleGameType.GreatWallDungeon?cc.size(456,138):cc.size(456,108)},getDeckLayer:function(){var layer=new cc.Layer;this.m_troopsContainer=new YunheeTroopsItemContainer,layer.addChild(this.m_troopsContainer);var troops_num=this.getCurrentTroopsNum(),gs=GeneralService.getInstance();if(1==USE_LOCAL_STORAGE_TROOPS_OFF){M_SELECT_TROOPS=troops_num;for(var idx=0;idx<this.m_userTroopsList.length;idx++)if(this.m_userTroopsList[idx].troops_num==troops_num){var gnrl=new db.UserGeneralInfo,key=new db.UserGeneralKey;key.gnrl_id=this.m_userTroopsList[idx].gnrl_id,key.gnrl_num=this.m_userTroopsList[idx].gnrl_num,gs.getUserGeneralInfo(key,gnrl),this.m_game_type==db.BattleGameType.GreatWallDungeon&&GreatWallService.getInstance().checkGreatWallDungeonPartInGeneral(gnrl),this.m_troopsContainer.addPartyItem(this.m_userTroopsList[idx],gnrl,this.m_game_type)}layer.setContentSize(this.m_troopsContainer.getContentSize())}else troops_num.done(function(tdata){M_SELECT_TROOPS=tdata;for(var idx=0;idx<this.m_userTroopsList.length;idx++)if(this.m_userTroopsList[idx].troops_num==tdata){var gnrl=new db.UserGeneralInfo,key=new db.UserGeneralKey;key.gnrl_id=this.m_userTroopsList[idx].gnrl_id,key.gnrl_num=this.m_userTroopsList[idx].gnrl_num,gs.getUserGeneralInfo(key,gnrl),this.m_game_type==db.BattleGameType.GreatWallDungeon&&GreatWallService.getInstance().checkGreatWallDungeonPartInGeneral(gnrl),this.m_troopsContainer.addPartyItem(this.m_userTroopsList[idx],gnrl,this.m_game_type)}layer.setContentSize(this.m_troopsContainer.getContentSize())}.bind(this));return layer},sort:function(isNowPos){if(!(this.m_filterGnrlList.length<=0)){switch(this.m_filterGnrlList=stable(this.m_filterGnrlList,function(l,r){return this.m_isSortDesc?l.gnrl_id<r.gnrl_id:l.gnrl_id>r.gnrl_id}.bind(this)),this.m_filterGnrlList=stable(this.m_filterGnrlList,function(l,r){return this.m_isSortDesc?l.element_type>r.element_type:l.element_type<r.element_type}.bind(this)),this.m_filterGnrlList=stable(this.m_filterGnrlList,function(l,r){return this.m_isSortDesc?l.class_type<r.class_type:l.class_type>r.class_type}.bind(this)),this.m_sort){case SORT_STATE:this.m_filterGnrlList=stable(this.m_filterGnrlList,function(l,r){return this.m_isSortDesc?l.state_type>r.state_type:l.state_type<r.state_type}.bind(this));break;case SORT_LV:this.m_filterGnrlList=stable(this.m_filterGnrlList,function(l,r){return this.m_isSortDesc?l.gnrl_level<r.gnrl_level:l.gnrl_level>r.gnrl_level}.bind(this));break;case SORT_RARE:this.m_filterGnrlList=stable(this.m_filterGnrlList,function(l,r){return this.m_isSortDesc?l.rare_type<r.rare_type:l.rare_type>r.rare_type}.bind(this));break;case SORT_ARMSERVICE:this.m_filterGnrlList=stable(this.m_filterGnrlList,function(l,r){return this.m_isSortDesc?l.arm_service_type>r.arm_service_type:l.arm_service_type<r.arm_service_type}.bind(this));break;case SORT_YUNHEE:this.m_filterGnrlList=stable(this.m_filterGnrlList,function(l,r){return this.m_isSortDesc?l.gnrl_group<r.gnrl_group:l.gnrl_group>r.gnrl_group}.bind(this));break;case SORT_GAIN:this.m_filterGnrlList=stable(this.m_filterGnrlList,function(l,r){return this.m_isSortDesc?l.gnrl_num<r.gnrl_num:l.gnrl_num>r.gnrl_num}.bind(this));break;case SORT_DUNGEON_BUFF:this.m_filterGnrlList=stable(this.m_filterGnrlList,function(l,r){return this.m_isSortDesc?l.buff_type<r.buff_type:l.buff_type>r.buff_type}.bind(this));break;case SORT_FIGHT_TYPE:this.m_filterGnrlList=stable(this.m_filterGnrlList,function(l,r){return this.m_isSortDesc?l.fight_type>r.fight_type:l.fight_type<r.fight_type}.bind(this));break;case SORT_ATT:this.m_filterGnrlList=stable(this.m_filterGnrlList,function(l,r){return this.m_isSortDesc?l.attk+l.add_atk_value<r.attk+r.add_atk_value:l.attk+l.add_atk_value>r.attk+r.add_atk_value}.bind(this));break;case SORT_DEF:this.m_filterGnrlList=stable(this.m_filterGnrlList,function(l,r){return this.m_isSortDesc?l.def+l.add_def_value<r.def+r.add_def_value:l.def+l.add_def_value>r.def+r.add_def_value}.bind(this));break;case SORT_HP:this.m_filterGnrlList=stable(this.m_filterGnrlList,function(l,r){return this.m_isSortDesc?l.hp+l.add_hp_value<r.hp+r.add_hp_value:l.hp+l.add_hp_value>r.hp+r.add_hp_value}.bind(this))}this.reloadTableView(isNowPos)}},reloadTableView:function(isNowPos){var offset=null;offset=((isNowPos||!offset)&&(offset=GameContext.getInstance().getOffsetVerticalPercent()),this.m_tableView.getContentOffset()),this.m_tableView.reloadData(),this.m_tableView.setContentOffset(offset)},scrollViewDidScroll:function(view){window.clearTimeout(this.m_long_timer),cc.log("clear timer ========================="+this.m_long_timer)},tableCellEnded:function(table){this.m_isLongTouch&&(this.m_isLongTouch=!1,this.m_gameObserver.postNotification(sceneStr[scene_YunheeScene],NOTIFY_LONG_CLICK_POPUP_HIDE))},tableCellHighlight:function(table,cell){if(TutorialContextV2.getInstance().IsCompleteAllTutorial())return this.m_long_touch_cell=cell,this.m_deck_status!=DECK_STATUS.ARRANGEMENT_SELECT_YUNHEE&&(cc.log("pre timer ========================="+this.m_long_timer),this.m_long_timer=window.setTimeout(function(float){this.m_isLongTouch=!0,cc.log("setTimeout ========================="+this.m_long_timer);var c=this.m_long_touch_cell;null!=c&&c.touchPosCell(this.m_long_touch_cell.getTouchPos(),this.m_long_touch_cell.getTouchWorldPos())}.bind(this),600),cc.log("start timer ========================="+this.m_long_timer)),!0},changeYhTeam:function(team_index){var gs=GeneralService.getInstance(),troops_num=team_index-NOTIFY_MENU_PARTY_1+1;this.setCurrentTroopsNum(troops_num),this.updateTroopsBtns(),this.m_troopsContainer.removeFromParent(),this.m_troopsContainer=new YunheeTroopsItemContainer,this.m_deckBoxLayer.addChild(this.m_troopsContainer);var troops_cost=GeneralService.getInstance().getTroopsCost(troops_num),load=GeneralService.getInstance().getUserTotalCost(troops_num);this.m_game_type==db.BattleGameType.GreatWallDungeon&&(troops_cost=GreatWallService.getInstance().getGreatWallTroopsCost(troops_num),load=GreatWallService.getInstance().getGreatWallTroopsTotalCost(troops_num)),this.m_game_type!=db.BattleGameType.EventDungeonSearch&&this.m_user_cost_label.setString("cost "+troops_cost+"/"+load.cost);for(var idx=0;idx<this.m_userTroopsList.length;idx++)if(this.m_userTroopsList[idx].troops_num==troops_num){var gnrl=new db.UserGeneralInfo,key={};key.gnrl_id=this.m_userTroopsList[idx].gnrl_id,key.gnrl_num=this.m_userTroopsList[idx].gnrl_num,gs.getUserGeneralInfo(key,gnrl),this.m_game_type==db.BattleGameType.GreatWallDungeon&&GreatWallService.getInstance().checkGreatWallDungeonPartInGeneral(gnrl),this.m_troopsContainer.addPartyItem(this.m_userTroopsList[idx],gnrl,this.m_game_type)}this.m_deck_status==DECK_STATUS.ARRANGEMENT_SELECT_YUNHEE?this.isTableLayerArrangement():this.m_deck_status==DECK_STATUS.CHOICE_LEADER&&this.m_troopsContainer.runActionArrow(),this.updateLeaderSkill(troops_num)},setCurrentTroopsNum:function(troops_num){var gd=GameDefault.getInstance();if(M_SELECT_TROOPS=troops_num,this.m_game_type==db.BattleGameType.WeeklyDungeon)gd.setUserWeeklyTroopsNum(troops_num);else if(this.m_game_type==db.BattleGameType.Mussang)gd.setUserMussangTroopsNum(troops_num);else if(this.m_game_type==db.BattleGameType.Mission||this.m_game_type==db.BattleGameType.None)gd.setUserTroopsNum(troops_num);else if(this.m_game_type==db.BattleGameType.EventDungeon)gd.setUserEventDungeonTroopsNum(troops_num);else if(this.m_game_type==db.BattleGameType.DailyDungeon)gd.setUserDailyDungeonTroopsNum(troops_num);else if(this.m_game_type==db.BattleGameType.RaidDungeon){var raid_boss=BattleContext._getInstance().getRaidBossData();gd.setUserRaidBossElementTroopsNum(troops_num,raid_boss.raid_boss_info_idx)}else this.m_game_type==db.BattleGameType.GreatWallDungeon?gd.setUserGreatWallTroopsNum(troops_num):this.m_game_type==db.BattleGameType.TowerDungeon?gd.setUserTowerDungeonTroopsNum(troops_num):this.m_game_type==db.BattleGameType.OnceADayDungeon?gd.setUserOnceADayDungeonTroopsNum(troops_num):this.m_game_type==db.BattleGameType.EventMussangBossDungeon?gd.setUserEventMussangBossTroopsNum(troops_num):this.m_game_type==db.BattleGameType.EventRaidDungeon&&gd.setUserEventRaidDungeonTroopsNum(troops_num);M_SELECT_TROOPS=troops_num},onTouchWarningTooltip:function(sender,_event){_event==cc.CONTROL_EVENT_TOUCH_DOWN?this.showGreatWallWarningTooltip():this.hideGreatWallWarningTooltip()},showGreatWallWarningTooltip:function(){var tip=cmString("%s\n%s\n%s\n%s",res_str("label_great_wall_leader_skill_warning_1"),res_str("label_great_wall_leader_skill_warning_2"),res_str("label_great_wall_leader_skill_warning_3"),res_str("label_great_wall_leader_skill_warning_4"));this.tooltip_content.setString(tip);var tSize=ccSize(this.tooltip_content),bSize=cc.size(tSize.width+40,tSize.height+20);bSize.width=MAX(64,tSize.width+40),bSize.height=MAX(54,tSize.height+20),this.tooltip_box.setPreferredSize(bSize),this.tooltip_content.setPosition(ccCenter(bSize)),this.tooltip_box.setVisible(!0)},hideGreatWallWarningTooltip:function(){this.tooltip_box.setVisible(!1)},checkAddAbilityValue:function(gnrlInfo){var m=MasterManager.getInstance(),mt=MasterTable.getInstance(),g=m.get_General(gnrlInfo.gnrl_id),loveStat=mt.get_LoveStatItem(g.love_stat_group,gnrlInfo.love_level);loveStat.stat_type_1==LOVE_STAT_TYPE_ATTK_PRCNT&&(gnrlInfo.add_atk_value+=gnrlInfo.attk*(loveStat.value_1/100)),loveStat.stat_type_2==LOVE_STAT_TYPE_ATTK_PRCNT&&(gnrlInfo.add_atk_value+=gnrlInfo.attk*(loveStat.value_2/100)),loveStat.stat_type_3==LOVE_STAT_TYPE_ATTK_PRCNT&&(gnrlInfo.add_atk_value+=gnrlInfo.attk*(loveStat.value_3/100)),loveStat.stat_type_1==LOVE_STAT_TYPE_ATTK_INC&&(gnrlInfo.add_atk_value+=loveStat.value_1),loveStat.stat_type_2==LOVE_STAT_TYPE_ATTK_INC&&(gnrlInfo.add_atk_value+=loveStat.value_2),loveStat.stat_type_2==LOVE_STAT_TYPE_ATTK_INC&&(gnrlInfo.add_atk_value+=loveStat.value_3),loveStat.stat_type_1==LOVE_STAT_TYPE_DEF_PRCNT&&(gnrlInfo.add_def_value+=gnrlInfo.def*(loveStat.value_1/100)),loveStat.stat_type_2==LOVE_STAT_TYPE_DEF_PRCNT&&(gnrlInfo.add_def_value+=gnrlInfo.def*(loveStat.value_2/100)),loveStat.stat_type_3==LOVE_STAT_TYPE_DEF_PRCNT&&(gnrlInfo.add_def_value+=gnrlInfo.def*(loveStat.value_3/100)),loveStat.stat_type_1==LOVE_STAT_TYPE_DEF_INC&&(gnrlInfo.add_def_value+=loveStat.value_1),loveStat.stat_type_2==LOVE_STAT_TYPE_DEF_INC&&(gnrlInfo.add_def_value+=loveStat.value_2),loveStat.stat_type_3==LOVE_STAT_TYPE_DEF_INC&&(gnrlInfo.add_def_value+=loveStat.value_3),loveStat.stat_type_1==LOVE_STAT_TYPE_HP_PRCNT&&(gnrlInfo.add_hp_value+=gnrlInfo.hp*(loveStat.value_1/100)),loveStat.stat_type_2==LOVE_STAT_TYPE_HP_PRCNT&&(gnrlInfo.add_hp_value+=gnrlInfo.hp*(loveStat.value_2/100)),loveStat.stat_type_3==LOVE_STAT_TYPE_HP_PRCNT&&(gnrlInfo.add_hp_value+=gnrlInfo.hp*(loveStat.value_3/100)),loveStat.stat_type_1==LOVE_STAT_TYPE_HP_INC&&(gnrlInfo.add_hp_value+=loveStat.value_1),loveStat.stat_type_2==LOVE_STAT_TYPE_HP_INC&&(gnrlInfo.add_hp_value+=loveStat.value_2),loveStat.stat_type_3==LOVE_STAT_TYPE_HP_INC&&(gnrlInfo.add_hp_value+=loveStat.value_3);var user_branch_ability=CampService.getInstance().getUserCampBranchAbility(gnrlInfo.arm_service_type);1==CAMP_LOVE_STAT_TYPE?(gnrlInfo.add_atk_value+=gnrlInfo.attk*(user_branch_ability.attack/1e4),gnrlInfo.add_def_value+=gnrlInfo.def*(user_branch_ability.defense/1e4),gnrlInfo.add_hp_value+=gnrlInfo.hp*(user_branch_ability.health/1e4)):(gnrlInfo.add_atk_value+=user_branch_ability.attack,gnrlInfo.add_def_value+=user_branch_ability.defense,gnrlInfo.add_hp_value+=user_branch_ability.health);var set_effect_info=new Map,gnrlKey={};gnrlKey.gnrl_id=gnrlInfo.gnrl_id,gnrlKey.gnrl_num=gnrlInfo.gnrl_num;var equip_info_list,es=EquipmentService.getInstance();equip_info_list=es.getUserGeneralEquipmentListInfo(gnrlKey);for(var i=0;i<equip_info_list.length;i++){var equip=equip_info_list[i],equip_key={},user_equip_info=$.extend({},db.UserEquipment);equip_key.equipment_item_idx=equip.equip_id,equip_key.equipment_num=equip.equip_num,es.getUserEquipmentInfo(equip_key,user_equip_info,gnrlKey),this.addComboStatValueForEquipment(gnrlInfo,user_equip_info.combo_stat,user_equip_info.stat_value);var equip_option_info=m.get_EquipmentItemOption(user_equip_info.option_id1,user_equip_info.option_num1);if(0==equip_option_info.wear_element_type||gnrlInfo.element_type==equip_option_info.wear_element_type){var equip_option_level_info=m.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);this.addComboStatValueForEquipment(gnrlInfo,equip_option_level_info.combo_stat,equip_option_level_info.stat_value),this.addComboStatValueForEquipment(gnrlInfo,equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2)}if(0==(equip_option_info=m.get_EquipmentItemOption(user_equip_info.option_id2,user_equip_info.option_num2)).wear_element_type||gnrlInfo.element_type==equip_option_info.wear_element_type){equip_option_level_info=m.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);this.addComboStatValueForEquipment(gnrlInfo,equip_option_level_info.combo_stat,equip_option_level_info.stat_value),this.addComboStatValueForEquipment(gnrlInfo,equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2)}if(0==(equip_option_info=m.get_EquipmentItemOption(user_equip_info.option_id3,user_equip_info.option_num3)).wear_element_type||gnrlInfo.element_type==equip_option_info.wear_element_type){equip_option_level_info=m.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);this.addComboStatValueForEquipment(gnrlInfo,equip_option_level_info.combo_stat,equip_option_level_info.stat_value),this.addComboStatValueForEquipment(gnrlInfo,equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2)}if(0==(equip_option_info=m.get_EquipmentItemOption(user_equip_info.option_id4,user_equip_info.option_num4)).wear_element_type||gnrlInfo.element_type==equip_option_info.wear_element_type){equip_option_level_info=m.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);this.addComboStatValueForEquipment(gnrlInfo,equip_option_level_info.combo_stat,equip_option_level_info.stat_value),this.addComboStatValueForEquipment(gnrlInfo,equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2)}if(0==(equip_option_info=m.get_EquipmentItemOption(user_equip_info.option_id5,user_equip_info.option_num5)).wear_element_type||gnrlInfo.element_type==equip_option_info.wear_element_type){equip_option_level_info=m.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);this.addComboStatValueForEquipment(gnrlInfo,equip_option_level_info.combo_stat,equip_option_level_info.stat_value),this.addComboStatValueForEquipment(gnrlInfo,equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2)}if(0<user_equip_info.equip_group)null==(set_count=set_effect_info.at(user_equip_info.equip_group))&&(set_count={count:0},set_effect_info.insert(user_equip_info.equip_group,set_count)),set_effect_info.insert(user_equip_info.equip_group,set_count),set_count.count=set_count.count+1}for(var keys=set_effect_info.keys(),idx=0;idx<keys.length;idx++){for(var mt_set_effect={equip_count:0,combo_stat:0,added_value:0},set_count=set_effect_info.at(keys[idx]).count;null==(mt_set_effect=m.get_EquipmentGroup(parseInt(keys[idx]),set_count)).equip_count&&(mt_set_effect={equip_count:0,combo_stat:0,added_value:0}),0==mt_set_effect.equip_count&&0<set_count--;);this.addComboStatValueForEquipment(gnrlInfo,mt_set_effect.combo_stat,mt_set_effect.added_value)}},addComboStatValueForEquipment:function(gnrlInfo,combo_stat_type,stat_value){if(9!=combo_stat_type&&10!=combo_stat_type)switch(combo_stat_type){case COMBO_STAT_ATTK_PLUS:gnrlInfo.add_atk_value+=stat_value;break;case COMBO_STAT_ATTK:gnrlInfo.add_atk_value+=gnrlInfo.attk*(stat_value/1e4);break;case COMBO_STAT_DEF_PLUS:gnrlInfo.add_def_value+=stat_value;break;case COMBO_STAT_DEF:gnrlInfo.add_def_value+=gnrlInfo.def*(stat_value/1e4);break;case COMBO_STAT_HP_PLUS:gnrlInfo.add_hp_value+=stat_value;break;case COMBO_STAT_HP:gnrlInfo.add_hp_value+=gnrlInfo.hp*(stat_value/1e4);break;case COMBO_STAT_CRI_PRCNT:case COMBO_STAT_CRI_DMG:case COMBO_STAT_GUARD_PRCNT:case COMBO_STAT_GUARD_DECREASE:}},onEnter:function(){this._super(),this.scheduleOnce(function(float){if(0!=this.m_filterGnrlList.length){var cur=GameContext.getInstance().getYunheePrevSceneId();if(cur==scene_MainHomeScene||cur==scene_EventDungeonSearchPartyScene||cur==scene_EventDungeonSearchAreaScene||cur==scene_GreatWallStageScene||cur==scene_FriendSelectScene)GameContext.getInstance().setOffsetVerticalPercent(this.m_tableView.minContainerOffset());else if(this.m_game_type==db.BattleGameType.None||this.m_game_type==db.BattleGameType.EventDungeonSearch||this.m_game_type==db.BattleGameType.GreatWallDungeon){this.m_tableView.reloadData(),null!=(offset=GameContext.getInstance().getOffsetVerticalPercent())&&offset.y<this.m_tableView.minContainerOffset().y&&(offset=this.m_tableView.minContainerOffset()),this.m_tableView.setContentOffset(offset)}else{var offset=cc.p(0,0);GameContext.getInstance().setOffsetVerticalPercent(offset)}}},.1,"yunheeLayerEnter")},getOffsetVerticalPrcnt:function(){return this.m_yunheeTableLayer.getOffsetVerticalPercent()},isTableLayerArrangement:function(){var troops_num=M_SELECT_TROOPS,isSame=GeneralService.getInstance().isSameGeneralInTroops(troops_num,0,this.m_arrangementGnrlKey);this.m_game_type==db.BattleGameType.GreatWallDungeon?isSame=GreatWallService.getInstance().isSameGeneralInGreatWallTroops(troops_num,0,this.m_arrangementGnrlKey):this.m_game_type==db.BattleGameType.EventDungeonSearch&&(isSame=EventDungeonService.getInstance().isSameGeneralInEventDungeonSearchTroops(troops_num,0,this.m_arrangementGnrlKey)),isSame.result?this.m_troopsContainer.runActionArrow(isSame.pos):this.m_troopsContainer.runActionArrow()},resetUserTroops:function(gnrl_num){if(null==gnrl_num&&(gnrl_num=0),this.m_deckBoxLayer.removeFromParent(),this.m_deckBoxLayer=this.getDeckLayer(),this.m_deckBoxLayer.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_deckBoxLayer.setPosition(55,224),this.m_game_type==db.BattleGameType.GreatWallDungeon&&this.m_deckBoxLayer.setPosition(55,191),this.m_leftLayer.addChild(this.m_deckBoxLayer),0!=gnrl_num)for(var idx=0;idx<this.m_filterGnrlList.length;idx++)for(var i=0;i<this.m_userTroopsList.length;i++){this.m_userTroopsList[i].gnrl_num==this.m_filterGnrlList[idx].gnrl_num&&(this.m_filterGnrlList[idx].using_in_troops=!0)}var load=M_SELECT_TROOPS,troops_cost=GeneralService.getInstance().getTroopsCost(load),load_data=GeneralService.getInstance().getUserTotalCost(load);if(this.m_game_type==db.BattleGameType.GreatWallDungeon&&(troops_cost=GreatWallService.getInstance().getGreatWallTroopsCost(load),load_data=GreatWallService.getInstance().getGreatWallTroopsTotalCost(load)),this.m_game_type!=db.BattleGameType.EventDungeonSearch)this.m_user_cost_label.setString("cost "+troops_cost+"/"+load_data.cost),this.updateLeaderSkill(load);else{var mt=MasterManager.getInstance(),event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=mt.get_EventDungeonPeriod(event_dungeon_period_idx),total_attk_pwr=EventDungeonService.getInstance().getEventDungeonSearchTroopsTotalAttkPwr(load);this.m_event_dungeon_search_attk_pwr_label.setString(cmString(res_str("label_event_dungeon_search_total_attk_pwr"),Number(Math.floor(total_attk_pwr)).toLocaleString("en")));var attk_pwr_bonus=MasterTable.getInstance().get_EventDungeonSearchAttkPwrBonusInfo(period.event_dungeon_group_idx,total_attk_pwr),gain_up_prcnt=0;0!=attk_pwr_bonus.gain_up&&(gain_up_prcnt=attk_pwr_bonus.gain_up/100),this.m_gain_up_label.setString(cmString(res_str("label_event_dungeon_search_total_attk_gain_point_up"),gain_up_prcnt))}this.sort();var offset=this.m_tableView.getContentOffset();this.m_tableView.reloadData(),this.m_tableView.setContentOffset(offset),offset=null,this.m_game_type==db.BattleGameType.GreatWallDungeon&&this.setUserYunheeBound()},setTroopsGeneral:function(gnrl_key){this.resetUserTroops();var troops_num=M_SELECT_TROOPS;this.m_troopsContainer.stopActionArrow(),this.m_select_gnrl_id=0,this.m_select_gnrl_num=0,this.m_arrangementGnrlKey.gnrl_id=0,this.m_arrangementGnrlKey.gnrl_num=0,this.setDeckStatus(DECK_STATUS.ARRANGEMENT_MODE),this.setInitSelected();var troops_cost=GeneralService.getInstance().getTroopsCost(troops_num),load=GeneralService.getInstance().getUserTotalCost(troops_num);if(this.m_game_type==db.BattleGameType.GreatWallDungeon&&(troops_cost=GreatWallService.getInstance().getGreatWallTroopsCost(troops_num),load=GreatWallService.getInstance().getGreatWallTroopsTotalCost(troops_num)),this.m_game_type!=db.BattleGameType.EventDungeonSearch)this.m_user_cost_label.setString("cost "+troops_cost+"/"+load.cost),this.updateLeaderSkill(troops_num);else{var mt=MasterManager.getInstance(),event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=mt.get_EventDungeonPeriod(event_dungeon_period_idx),total_attk_pwr=EventDungeonService.getInstance().getEventDungeonSearchTroopsTotalAttkPwr(troops_num);this.m_event_dungeon_search_attk_pwr_label.setString(cmString(res_str("label_event_dungeon_search_total_attk_pwr"),Number(Math.floor(total_attk_pwr)).toLocaleString("en")));var attk_pwr_bonus=MasterTable.getInstance().get_EventDungeonSearchAttkPwrBonusInfo(period.event_dungeon_group_idx,total_attk_pwr),gain_up_prcnt=0;0!=attk_pwr_bonus.gain_up&&(gain_up_prcnt=attk_pwr_bonus.gain_up/100),this.m_gain_up_label.setString(cmString(res_str("label_event_dungeon_search_total_attk_gain_point_up"),gain_up_prcnt))}this.sort(),this.setChangeSelectedEnd(),this.m_isLongTouch=!1,this.m_game_type==db.BattleGameType.GreatWallDungeon&&this.setUserYunheeBound()},setChangeSelectedEnd:function(){this.m_troopsContainer.stopActionArrow(),this.m_select_gnrl_id=0,this.m_select_gnrl_num=0,this.setDeckStatus(DECK_STATUS.ARRANGEMENT_MODE),this.m_arrangementGnrlKey.gnrl_id=0,this.m_arrangementGnrlKey.gnrl_num=0},updateLeaderSkill:function(troops_num){for(var gnrl_id=0,idx=0;idx<this.m_userTroopsList.length;idx++)if(this.m_userTroopsList[idx].troops_num==troops_num&&this.m_userTroopsList[idx].is_leader){gnrl_id=this.m_userTroopsList[idx].gnrl_id;break}if(0==gnrl_id)this.m_leader_node.setLeaderSkillId(0);else{var gnrl=MasterManager.getInstance().get_General(gnrl_id);if(0==gnrl.leader_skill_id||99999==gnrl.leader_skill_id){gnrl.special_leader_skill_id=gnrl.special_leader_skill_id+"";var leader_skill_list=gnrl.special_leader_skill_id.split(",");if(0<leader_skill_list.size()){var leader_skill_id=1*leader_skill_list.at(0);this.m_leader_node.setSLeaderSkillId(leader_skill_id)}}else this.m_leader_node.setLeaderSkillId(gnrl.leader_skill_id)}},onExit:function(){this._super(),1!=this.getParent().m_isPopupShow&&(this.m_troops_btns=[],this.m_right_bottom_layer.removeAllChildrenWithCleanup(!0),this.m_right_bottom_layer=null,this.m_right_sell_bottom_layer.removeAllChildrenWithCleanup(!0),this.m_right_sell_bottom_layer=null,this.m_leftLayer.removeAllChildrenWithCleanup(!0),this.m_leftLayer=null,this.m_sortLayer.removeAllChildrenWithCleanup(!0),this.m_sortLayer=null,this.m_filterGnrlList=[],this.m_yunhee_cell_list.forEach(function(t){t.removeAllChildrenWithCleanup(!0)}),this.m_yunhee_cell_list=[],delete this.m_right_bottom_layer,delete this.m_leftLayer,delete this.m_sortLayer,delete this.m_yunhee_cell_list,this.m_yunheeTableLayer=null,this.m_skeletonNode=null,this.m_characterLayer=null,this.m_itemPlusBtn=null,this.m_characterImg=null,this.m_character_skeleton=null,this.m_leader_btn=null,this.m_leader_cancel_btn=null,this.m_deck_status=null,this.m_leader_node=null,this.m_troopsContainer=null,this.m_layer=null,this.m_deckBoxLayer=null,this.m_leftLayer=null,this.m_rightLayer=null,this.m_right_bottom_layer=null,this.m_right_sell_bottom_layer=null,this.m_sortLayer=null,this.m_sortButtonLayer=null,this.m_troops_1=null,this.m_troops_2=null,this.m_troops_3=null,this.m_btn_arrangement=null,this.m_btn_batch_sell=null,this.m_btn_arrangement_cancel=null,this.m_state_all_btn=null,this.m_state_wie_btn=null,this.m_state_chock_btn=null,this.m_state_o_btn=null,this.m_state_won_btn=null,this.m_state_dong_btn=null,this.m_state_jae_btn=null,this.m_select_gnrl=null,this.m_table_select_img=null,this.m_btn_sort=null,this.m_btn_sort_2=null,this.m_yh_title=null,this.m_yunhee_sell_count_label=null,this.m_sell_gold_label=null,this.m_sell_yhpt_label=null,this.m_sell_heaven_pt_label=null,this.m_friend_left_title=null,this.m_user_cost_label=null,this.m_listener=null,this.m_userTroopsList=null,this.m_filterGnrlList=null,this.m_userGeneralList=null,this.m_YunheeItemLayer=null,this.m_itemLayers=null,this.m_game_type=null,this.tooltip_box=null,this.tooltip_content=null,this.m_troops_btns=null,this.m_beginPos=null,this.m_gameObserver=null,this.m_arrangementGnrlKey=null,this.m_long_timer=null,this.m_sellYunheeGnrlKeys=null,this.m_sellYunheeGnrlInfoList=null,this.m_tab_btns=null,this.m_state_filter_btns=null,this.m_material_btns=null,this.m_normal_size=null,this.m_sell_size=null,this.m_stateFilterLayer=null,this.m_materialFilterLayer=null,this.m_sell_yunhee_label=null,this.removeAllChildrenWithCleanup(!0))}}),REBIRTH_SELECT_BACKGROUND=100,REBIRTH_SELECT_BLINK_BACKGROUND=101,REBIRTH_MATERIAL_MASK=102,YunheeRebirthEnum={btn_rebirth_start:800,btn_rebirth_result_hide:801,btn_impossible_rerirth:802,btn_rebirth_info:803,btn_show_help:804},RebirthMaterialItemLayer=cc.Layer.extend({m_card_sprite:null,m_selected_sprite:null,ctor:function(info){this._super()},initLayout:function(info){var cardInfo={},key={};key.gnrl_id=info.gnrl_id,key.gnrl_num=info.gnrl_num,cardInfo.gnrl_id=info.gnrl_id,cardInfo.level=info.gnrl_level;var bg=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame_2.png");bg.setContentSize(98,98),bg.setAnchorPoint(ZERO()),bg.setPosition(0,17),this.addChild(bg);var card=new Card;if(this.m_card_sprite=card.createCard(cardInfo,CARD_TYPE.type_common_card),this.m_card_sprite.setAnchorPoint(ANCHOR_MIDDLE()),this.m_card_sprite.setPosition(ccCenter(bg)),bg.addChild(this.m_card_sprite),this.m_selected_sprite=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero()),this.m_selected_sprite.setContentSize(ccSize(bg)),this.m_selected_sprite.setPosition(ccCenter(bg)),bg.addChild(this.m_selected_sprite),this.m_selected_sprite.setOpacity(0),0!=(this.m_info=info).slot_num||info.is_use){this.m_selected_sprite.setOpacity(255);var label=null;0!=info.slot_num?label=cmLabel.getLabel(cmString(res_str("label_evolve_mtrl_slot"),info.slot_num),LABEL_FONT_INDEX.FONT_161):info.is_use&&(label=cmLabel.getLabel(cmString(res_str("label_in_troops"),info.slot_num),LABEL_FONT_INDEX.FONT_161)),null!=label&&(label.setAnchorPoint(ANCHOR_MIDDLE()),label.setPosition(ccCenter(this.m_card_sprite)),label.enableOutline(cc.color.BLACK,1),bg.addChild(label))}return this.setContentSize(bg.width+17,bg.height+17),!0},onClickBegin:function(){this.m_selected_sprite.setOpacity(255)},onClickEnd:function(){this.m_selected_sprite.setOpacity(0)},getGnrlInfo:function(){return this.m_info},getGnrlKey:function(){var key={};return key.gnrl_id=this.m_info.gnrl_id,key.gnrl_num=this.m_info.gnrl_num,key}}),YunheeRebirthLayer=cc.Layer.extend({m_rebirth_need_gold:0,m_slotIndex:0,m_leftBoxLayer:null,m_rebirth_need_goldLabel:null,m_rebirth_btn:null,m_enable_rebirth:!1,m_character_skeleton:null,m_characterImg:null,m_select_1:null,m_select_2:null,m_tooltip_box:null,m_lv_label:null,m_lv_label_1:null,m_mtrlGnrlKeys:null,m_img_scale:1,m_rebirthGnrlInfo:null,m_tempPos:null,m_deferred:$.Deferred(),m_isRebirthing:!1,m_rebirth_lv_label:null,ctor:function(){this._super(),this.m_gnrlKey={gnrl_id:0,gnrl_num:1},this.m_mtrlGnrlKeys=[],this.m_isRebirthing=!1,this.m_deferred=$.Deferred()},setGeneralInfo:function(info,evolve_info,mtrl_info,need_gold){this.m_gnrlInfo=info,this.m_rebirthGnrlInfo=evolve_info,this.m_mtrlInfo=mtrl_info,this.m_gnrlKey.gnrl_id=info.gnrl_id,this.m_gnrlKey.gnrl_num=info.gnrl_num,this.m_rebirth_need_gold=need_gold},getRebirthNeedGold:function(){return this.m_rebirth_need_gold},initLayout:function(){var leftBottomLayer=this.getLeftBottomLayer();leftBottomLayer.ignoreAnchorPointForPosition(!1),leftBottomLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),leftBottomLayer.setPosition((ccWidth(this)-478)/2,0),this.addChild(leftBottomLayer);var rightBoxLayer=this.getRightBoxLayer();rightBoxLayer.ignoreAnchorPointForPosition(!1),rightBoxLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),rightBoxLayer.setPosition(ccWidth(this)/4*3,0),this.addChild(rightBoxLayer);var mtrlLayer=this.getMaterialLayer();mtrlLayer.ignoreAnchorPointForPosition(!1),mtrlLayer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),mtrlLayer.setPosition(ccWidth(this),88),this.addChild(mtrlLayer,2);var rebirth_mtrl=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_text_rebirth.png");rebirth_mtrl.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),rebirth_mtrl.setPosition(ccWidth(this)-ccWidth(mtrlLayer)-5,434),this.addChild(rebirth_mtrl,2);var arrow_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_arrow.png");arrow_img.setAnchorPoint(ANCHOR_MIDDLE()),arrow_img.setPosition(ccCenter(this)),this.addChild(arrow_img,2);var rebirth_before=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_text_rebirth_1.png");rebirth_before.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),rebirth_before.setPosition((ccWidth(this)-478)/2,520),this.addChild(rebirth_before,2);var rebirth_after=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_text_rebirth_2.png");rebirth_after.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),rebirth_after.setPosition(ccWidth(this)/4*3,520),this.addChild(rebirth_after,2),this.checkEnableRebirth()},getLeftBottomLayer:function(){var layer=new cc.Layer;layer.setContentSize(ccWidth(this)-478,320);var rare_type_mark=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_unique_"+leadingZeros(this.m_gnrlInfo.rare_type,2)+"_small.png");rare_type_mark.setAnchorPoint(ZERO()),rare_type_mark.setPosition(ccCenter(layer).x-222,86),layer.addChild(rare_type_mark);var text_text=new cmMultiLabel,count_func=MasterManager.getInstance().get_CountFunction(COUNT_FUNCTION_GENERAL_REBIRTH_ENABLE_LEVEL);this.m_gnrlInfo.gnrl_level<count_func.value?(text_text.addLabel("Lv. ",LABEL_FONT_INDEX.FONT_261),text_text.addLabel(this.m_gnrlInfo.gnrl_level,LABEL_FONT_INDEX.FONT_355)):(text_text.addLabel("Lv. ",LABEL_FONT_INDEX.FONT_261),text_text.addLabel(this.m_gnrlInfo.gnrl_level,LABEL_FONT_INDEX.FONT_261)),text_text.addLabel("/ "+this.m_gnrlInfo.max_level+" Cost"+this.m_gnrlInfo.cost,LABEL_FONT_INDEX.FONT_261),text_text.setAnchorPoint(ZERO()),text_text.enableOutline(cc.color.BLACK,1),text_text.setLabel(),text_text.setPosition(ccCenter(layer).x-129,110),layer.addChild(text_text);var class_type_star_path="";this.m_gnrlInfo.rare_type==RARE_TYPE_N||this.m_gnrlInfo.rare_type==RARE_TYPE_HN?class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_n.png":this.m_gnrlInfo.rare_type==RARE_TYPE_R?class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_r.png":this.m_gnrlInfo.rare_type==RARE_TYPE_HR?class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_hr.png":this.m_gnrlInfo.rare_type==RARE_TYPE_SR?class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_s.png":this.m_gnrlInfo.rare_type==RARE_TYPE_SSR&&(class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_ss.png");for(var class_star_layer=new cc.Layer,i=1;i<this.m_gnrlInfo.class_type;++i){var class_type_star=cc.Sprite.create(class_type_star_path);class_type_star.setAnchorPoint(ZERO()),class_type_star.setPosition(28*(i-1),0),class_star_layer.addChild(class_type_star)}class_star_layer.setContentSize(28*(this.m_gnrlInfo.class_type-1),29),class_star_layer.ignoreAnchorPointForPosition(!1),class_star_layer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),class_star_layer.setPosition(48,47),rare_type_mark.addChild(class_star_layer),this.m_rebirth_btn=new LabelButton("btn_03_off.png","btn_03_on.png","btn_03_off.png",ccui.Widget.PLIST_TEXTURE),this.m_rebirth_btn.setFont(LABEL_FONT_INDEX.FONT_241),this.m_rebirth_btn.setString(res_str("btn_label_rebirth")),this.m_rebirth_btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_rebirth_btn.setPosition(ccCenter(layer).x,16),this.m_rebirth_btn.setOffsetX(-110),layer.addChild(this.m_rebirth_btn),this.m_rebirth_btn.addClickEventListener(function(sender){this.m_enable_rebirth?MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeRebirthEnum.btn_rebirth_start):MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeRebirthEnum.btn_impossible_rerirth)}.bind(this)),this.m_select_1=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_1.png",RectZero()),this.m_select_1.setContentSize(444,60),this.m_select_1.setAnchorPoint(ANCHOR_MIDDLE()),this.m_select_1.setPosition(ccCenter(this.m_rebirth_btn)),this.m_rebirth_btn.addChild(this.m_select_1),this.m_select_1.setOpacity(0),this.m_select_2=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_2.png",RectZero()),this.m_select_2.setContentSize(444,60),this.m_select_2.setAnchorPoint(ANCHOR_MIDDLE()),this.m_select_2.setPosition(ccCenter(this.m_rebirth_btn)),this.m_rebirth_btn.addChild(this.m_select_2),this.m_select_2.setOpacity(0);var gold_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero());gold_box.setContentSize(123,38),gold_box.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),gold_box.setPosition(197,ccCenter(this.m_rebirth_btn).y),this.m_rebirth_btn.addChild(gold_box);var gold_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_sell_gold.png");return gold_icon.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),gold_icon.setPosition(180,ccCenter(this.m_rebirth_btn).y),this.m_rebirth_btn.addChild(gold_icon),this.m_rebirth_need_goldLabel=cmLabel.getLabel(Number(this.m_rebirth_need_gold).toLocaleString("en"),LABEL_FONT_INDEX.FONT_2011),this.m_rebirth_need_goldLabel.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_rebirth_need_goldLabel.setPosition(ccWidth(gold_box)-10,ccCenter(gold_box).y),gold_box.addChild(this.m_rebirth_need_goldLabel),NetService().get_UserItemInfo_V2().gold_cnt<this.m_rebirth_need_gold&&this.m_rebirth_need_goldLabel.setColor(new cc.Color(245)),this.checkEnableRebirth(),layer},getRightBoxLayer:function(){var layer=new cc.Layer;layer.setContentSize(480,ccHeight(this));var mt=MasterManager.getInstance(),rebirth_info_btn=new ccui.Button(RES_CDN_DEFULT+"menu_yh/btn_rebirth_info_off.png",RES_CDN_DEFULT+"menu_yh/btn_rebirth_info_on.png");rebirth_info_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),rebirth_info_btn.setPosition(ccWidth(layer)-10,170),rebirth_info_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeRebirthEnum.btn_rebirth_info)}.bind(this)),layer.addChild(rebirth_info_btn,1e3);var cliper=new cc.ClippingNode;cliper.setAnchorPoint(ZERO()),cliper.setPosition(ZERO()),layer.addChild(cliper);var stencil_node=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box.png",cc.rect(10,10,10,10));stencil_node.setContentSize(ccSize(layer)),stencil_node.setAnchorPoint(ZERO()),stencil_node.setPosition(ZERO()),cliper.setStencil(stencil_node);var standing_gnrl=new db.UserGeneralInfo,gnrl_key={};gnrl_key.gnrl_id=this.m_gnrlInfo.gnrl_id,gnrl_key.gnrl_num=this.m_gnrlInfo.gnrl_num,GeneralService.getInstance().getUserGnrlDisplayClassInfo(gnrl_key,standing_gnrl);var standing_id=0;standing_id=standing_gnrl.class_type>=AVAIL_EVOLUTION_CLASS_TYPE_LIMIT&&0!=standing_gnrl.display_class&&standing_gnrl.class_type!=standing_gnrl.display_class?standing_gnrl.gnrl_id-1e3*(standing_gnrl.class_type-standing_gnrl.display_class):standing_gnrl.gnrl_id;var pos=mt.get_BodyPosition(standing_id,1),morph=MasterTable.getInstance().get_MorphData(standing_id);if("y"==morph.is_morph){var gnrl=MasterManager.getInstance().get_General(morph.gnrl_id),gnrl_img=[],stading_files=StandingMultiplePngList[morph.gnrl_id];if(null==stading_files)gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".png");else for(var idx=0;idx<stading_files.length;idx++)gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+stading_files[idx]+".png");gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".atlas"),gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".json"),resourceLoader(gnrl_img,function(){var gnrl_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".json",gnrl_atals=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".atlas";this.m_character_skeleton=new sp.SkeletonAnimation(gnrl_json,gnrl_atals,.1),this.m_character_skeleton.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_character_skeleton.setScale(.5),this.m_character_skeleton.setPosition(MAIN_POS(this,pos.posx-ccWidth(this)/4*3+240,pos.posy)),cliper.addChild(this.m_character_skeleton),this.m_character_skeleton.setPosition(this.m_character_skeleton.getPosition()),this.m_character_skeleton.setMix("basic","active",.1),this.m_character_skeleton.setMix("active","basic",.1),this.m_character_skeleton.setAnimation(0,"active",!1),this.m_character_skeleton.addAnimation(0,"basic",!0),this.m_deferred.resolve(!0)}.bind(this))}else{this.m_characterImg=cc.Sprite.create();var general=MasterManager.getInstance().get_General(this.m_rebirthGnrlInfo.gnrl_id);if(general.gnrl_type==GENERAL_TYPE_YUNHEE){if(MasterManager.getInstance().get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id),this.m_characterImg.setTexture(img_str)}else{img_str=getCardBody_ImageStr(general.gnrl_group);this.m_img_scale=getCardBody_Scale(general.gnrl_group),this.m_characterImg.setTexture(img_str)}}else{img_str=getCardBody_ImageStr(this.m_rebirthGnrlInfo.gnrl_id);this.m_img_scale=getCardBody_Scale(this.m_rebirthGnrlInfo.gnrl_id),this.m_characterImg.setTexture(img_str)}this.m_characterImg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_characterImg.setScale(this.m_img_scale),this.m_characterImg.setPosition(MAIN_POS(this,pos.posx+ccWidth(this.m_characterImg)/2-ccWidth(this)/4*3+240,pos.posy+ccHeight(this.m_characterImg)/2)),cliper.addChild(this.m_characterImg);var scaleTo_1=new cc.ScaleTo(.7,this.m_img_scale,this.m_img_scale+.01),scaleTo_2=new cc.ScaleTo(.7,this.m_img_scale,this.m_img_scale-.01),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);this.m_characterImg.runAction(repeat),this.m_deferred.resolve(!0)}var rare_type_mark=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_unique_"+leadingZeros(this.m_rebirthGnrlInfo.rare_type,2)+"_small.png");rare_type_mark.setAnchorPoint(ZERO()),rare_type_mark.setPosition(64,86),layer.addChild(rare_type_mark);var count_func=MasterManager.getInstance().get_CountFunction(COUNT_FUNCTION_GENERAL_REBIRTH_ENABLE_LEVEL),gnrl_level=this.m_gnrlInfo.gnrl_level;gnrl_level<count_func.value&&(gnrl_level=count_func.value);var lv_label=cmLabel.getLabel(cmString(res_str("label_level_max_level_rebirth_2"),gnrl_level,this.m_gnrlInfo.max_level,this.m_rebirthGnrlInfo.cost),LABEL_FONT_INDEX.FONT_261);lv_label.setAnchorPoint(ZERO()),lv_label.setPosition(157,97),lv_label.enableOutline(cc.color.BLACK,1),layer.addChild(lv_label);for(var class_star_layer=new cc.Layer,i=1;i<this.m_rebirthGnrlInfo.gnrl_class;++i){var class_type_star=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_ss_2.png");class_type_star.setAnchorPoint(ZERO()),class_type_star.setPosition(28*(i-1),0),class_star_layer.addChild(class_type_star)}return class_star_layer.setContentSize(28*(this.m_rebirthGnrlInfo.gnrl_class-1),29),class_star_layer.ignoreAnchorPointForPosition(!1),class_star_layer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),class_star_layer.setPosition(48,47),rare_type_mark.addChild(class_star_layer),layer},getMaterialLayer:function(){var layer=new cc.Layer;layer.setContentSize(98,490);for(var i=0;i<this.m_mtrlInfo.length;++i){var bg=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame_2.png");bg.setContentSize(98,98),bg.setAnchorPoint(ANCHOR_TOP_LEFT()),bg.setPosition(0,490-i*ccHeight(bg)),layer.addChild(bg);var mtrl=this.m_mtrlInfo[i],sprite=this.getMaterialSprite(mtrl.mtrl_info.slot_type,mtrl.mtrl_info.slot_value_1,mtrl.mtrl_info.slot_value_2,mtrl.mtrl_info.slot_num-1),btn=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(1,1,1,1)));btn.setPreferredSize(cc.size(90,90)),btn.setAnchorPoint(ANCHOR_MIDDLE()),btn.setPosition(ccCenter(bg)),btn.setTag(mtrl.mtrl_info.slot_type),sprite.setAnchorPoint(ANCHOR_MIDDLE()),sprite.setPosition(ccCenter(bg)),bg.addChild(btn),bg.addChild(sprite),btn.addTargetWithActionForControlEvents(this,function(sender,event){var audio=AudioEngine.getInstance(),snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_card_touch.mp3";audio.playEffect(snd);var bonus_type=GeneralService.getInstance().getRebirthMtrlTypeToBonusType(sender.getTag());MainObserver.getInstance().postNotification(NOTIFICATION_REBIRTH_MTRL_SHORTCUTS,bonus_type)},cc.CONTROL_EVENT_TOUCH_UP_INSIDE)}return layer},getEvolveMaterialInfo:function(index){return this.findMtrlInfo(index)},get_deferred:function(){return this.m_deferred},getMaterialButton:function(info,index){var sprite_on=this.getMaterialSprite(info.mtrl_info.slot_type,info.mtrl_info.slot_value_1,info.mtrl_info.slot_value_2,index),sprite_off=this.getMaterialSprite(info.mtrl_info.slot_type,info.mtrl_info.slot_value_1,info.mtrl_info.slot_value_2,index),rect=RectZero(),btn_on_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",rect);btn_on_mask.setContentSize(cc.size(sprite_on)),btn_on_mask.setAnchorPoint(ZERO()),btn_on_mask.setPosition(ZERO()),sprite_on.addChild(btn_on_mask);var mtrl_btn=new ccui.Button(sprite_off,sprite_on),mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",rect);mask.setContentSize(cc.size(mtrl_btn)),mask.setAnchorPoint(ZERO()),mask.setPosition(ZERO()),mask.setTag(MATERIAL_MASK),mtrl_btn.addChild(mask);var select_bg=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_select.png");select_bg.setPosition(ccCenter(mtrl_btn)),mtrl_btn.addChild(select_bg),select_bg.setTag(SELECT_BACKGROUND),select_bg.setOpacity(0);var select_blink=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_select_2.png");return select_blink.setPosition(ccCenter(mtrl_btn)),mtrl_btn.addChild(select_blink),select_blink.setTag(SELECT_BLINK_BACKGROUND),select_blink.setOpacity(0),mtrl_btn},runSelectAction:function(index){for(var idx=0;idx<this.m_mtrlButtons.length;idx++){var bg=this.m_mtrlButtons[idx].getChildByTag(REBIRTH_SELECT_BACKGROUND),blink=this.m_mtrlButtons[idx].getChildByTag(REBIRTH_SELECT_BLINK_BACKGROUND);if(this.m_mtrlButtons[idx].getTag()==index){bg.setOpacity(255);var fadeIn=new cc.FadeIn(.5),fadeOut=new cc.FadeOut(.5),seq=new cc.Sequence(fadeIn,fadeOut),repeat=new cc.RepeatForever(seq);blink.runAction(repeat),this.m_mtrlButtons[idx].setEnabled(!1)}else bg.setOpacity(0),blink.stopAllActions(),blink.setOpacity(0),this.m_mtrlButtons[idx].setEnabled(!0)}},setReloadData:function(){this.checkEnableRebirth()},checkEnableRebirth:function(){if(GeneralService.getInstance().isExistRebirthMtrl(this.m_gnrlInfo.gnrl_group)){var count_func=MasterManager.getInstance().get_CountFunction(COUNT_FUNCTION_GENERAL_REBIRTH_ENABLE_LEVEL),userInfo=NetService().get_UserItemInfo_V2();if(this.m_gnrlInfo.gnrl_level>=count_func.value&&this.m_gnrlInfo.love_level>=YUNHEE_MAX_LOVE_LEVEL&&userInfo.gold_cnt>=this.m_rebirth_need_gold){this.m_select_2.setOpacity(255);var fadeout=cc.fadeOut(1),fadein=cc.fadeIn(1),seq=cc.sequence(fadeout,fadein),repeat=cc.repeatForever(seq);this.m_select_2.runAction(repeat),this.m_enable_rebirth=!0,this.m_rebirth_btn.setEnabled(!0)}else this.m_enable_rebirth=!1}},getEvolveMaterialList:function(){return this.m_mtrlGnrlKeys},closeMaterialBox:function(){for(var b=0;b<this.m_mtrlButtons.length;b++){this.m_mtrlButtons[b].getChildByTag(REBIRTH_MATERIAL_MASK);var bg=this.m_mtrlButtons[b].getChildByTag(REBIRTH_SELECT_BACKGROUND),blink=this.m_mtrlButtons[b].getChildByTag(REBIRTH_SELECT_BLINK_BACKGROUND);blink.stopAllActions(),bg.setOpacity(0),blink.setOpacity(0),this.m_mtrlButtons[b].setEnabled(!0)}this.m_leftBoxLayer.runAction(new cc.MoveTo(.1,cc.p(-ccWidth(this.m_leftBoxLayer),0)))},getMaterialSprite:function(slot_type,slot_value_1,slot_value_2,index){var sprite=cc.Sprite.create(RES_CDN_DEFULT+"icon/rebirth/"+slot_type+".png"),mtrl_info=NetService().get_User_Rebirth_Mtrl_Info(slot_type);null!=mtrl_info.mtrl_count&&null!=mtrl_info.mtrl_count||(mtrl_info.mtrl_count=0);var value_box=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_valuebox_4.png");value_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),value_box.setPosition(45,2),sprite.addChild(value_box);var plus_icon=cc.Sprite.create("#btn_plus_2_off.png");plus_icon.setAnchorPoint(ANCHOR_TOP_RIGHT()),plus_icon.setPosition(90,90),sprite.addChild(plus_icon);var countLabel=null;if(null!=mtrl_info){if(mtrl_info.mtrl_count<slot_value_1){countLabel=cmLabel.getLabel(mtrl_info.mtrl_count+"/"+slot_value_1,LABEL_FONT_INDEX.FONT_161);var mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());mask.setContentSize(98,98),mask.setAnchorPoint(ANCHOR_MIDDLE()),mask.setPosition(45,45),mask.setTag(MATERIAL_MASK),sprite.addChild(mask)}else{countLabel=cmLabel.getLabel(mtrl_info.mtrl_count+"/"+slot_value_1,LABEL_FONT_INDEX.FONT_161);var found=this.findMtrlInfo(index);null!=found?found.isExist=!0:cc.log("")}countLabel.setAnchorPoint(ANCHOR_MIDDLE()),countLabel.setPosition(ccCenter(value_box)),value_box.addChild(countLabel)}return sprite},addMaterailGeneral:function(key){var found=this.findMtrlInfo(this.m_slotIndex);null!=found&&(found.isExist=!0);for(var b=0;b<this.m_mtrlButtons.length;b++){var mask=this.m_mtrlButtons[b].getChildByTag(MATERIAL_MASK),bg=this.m_mtrlButtons[b].getChildByTag(SELECT_BACKGROUND),blink=this.m_mtrlButtons[b].getChildByTag(SELECT_BLINK_BACKGROUND);blink.stopAllActions(),bg.setOpacity(0),blink.setOpacity(0),this.m_mtrlButtons[b].setEnabled(!0),this.m_mtrlButtons[b].getTag()==this.m_slotIndex&&mask.setOpacity(0);var slot_type=this.m_mtrlInfo.slot_type;if(this.m_mtrlButtons[b].getTag()==this.m_slotIndex&&slot_type==EVOLVE_MTRL_TYPE_CLASS_TYPE){var gnrl_key={};gnrl_key.gnrl_id=key.gnrl_id,gnrl_key.gnrl_num=key.gnrl_num;var g={};GeneralService.getInstance().getUserGeneralInfo(gnrl_key,g);var info={};info.gnrl_id=g.gnrl_id,info.level=g.gnrl_level;var sprite_on=(new Card).createCard(info,CARD_TYPE.type_evolve_mtrl),sprite_off=(new Card).createCard(info,CARD_TYPE.type_evolve_mtrl),btn_on_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());btn_on_mask.setContentSize(ccSize(sprite_on)),btn_on_mask.setAnchorPoint(ZERO()),btn_on_mask.setPosition(ZERO()),sprite_on.addChild(btn_on_mask),b.loadTexturePressed(sprite_on),b.loadTextureNormal(sprite_off)}}this.m_leftBoxLayer.runAction(new cc.MoveTo(.1,cc.p(-ccWidth(this.m_leftBoxLayer),0))),this.m_mtrlGnrlKeys[this.mtrl_info.slot_type]=key},onEnter:function(){this._super(),NetService().get_UserItemInfo_V2().gold_cnt<this.m_rebirth_need_gold?this.m_rebirth_need_goldLabel.setColor(cc.color(244,31,31)):this.m_rebirth_need_goldLabel.setColor(cc.color(255,181,84))},onExit:function(){this._super()},findMtrlInfo:function(index){for(var i=0;i<this.m_mtrlInfo.length;i++)if(this.m_mtrlInfo[i].mtrl_info.slot_num==index+1)return this.m_mtrlInfo[i];return null}}),YunheeResistanceItemLayer=cc.Layer.extend({ctor:function(index,gnrl_id){this._super(),this.initLayout(index,gnrl_id)},initLayout:function(index,gnrl_id){var gs=GeneralService.getInstance(),info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());info_box.setContentSize(422,38),info_box.setAnchorPoint(cc.p(0,0)),info_box.setPosition(6,3),this.addChild(info_box),this.setContentSize(info_box.getContentSize());var label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812);label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),label.setPosition(8,ccCenter(info_box).y),info_box.addChild(label);var content_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_201);content_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),content_label.setPosition(ccWidth(info_box)-9,ccCenter(info_box).y),info_box.addChild(content_label);var mt=MasterManager.getInstance(),gr_list=MasterTable.getInstance().get_GeneralResistances(gnrl_id),resistance_type=0;switch(index){case 0:resistance_type=database.BattleEffectTrans.After_Recv_Damage_Inc_Rate;break;case 1:resistance_type=database.BattleEffectTrans.Freeze;break;case 2:resistance_type=database.BattleEffectTrans.Damage_Reduce;break;case 3:resistance_type=database.BattleEffectTrans.Stun;break;case 4:resistance_type=database.BattleEffectTrans.New_Poison_Dmg_Rate;break;case 5:resistance_type=database.BattleEffectTrans.Silence;break;case 6:resistance_type=database.BattleEffectTrans.Wound_Obstruct_Heal;break;case 7:resistance_type=database.BattleEffectTrans.Blind_Darkness}for(var r in gr_list)if(gr_list[r].trans_type==resistance_type){content_label.setString(gr_list[r].content);var color=gs.getResistanceValueColor(gr_list[r].resist_value);content_label.setColor(color)}var rt=mt.get_ResistanceType(resistance_type);label.setString(rt.name);for(var idx=0;idx<gr_list.length;idx++)gr_list[idx].trans_type}}),YunheeResistanceItemLayerV2=cc.Layer.extend({ctor:function(index,gnrl_id){this._super(),this.initLayout(index,gnrl_id)},initLayout:function(index,gnrl_id){var gs=GeneralService.getInstance(),info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_1.png",RectZero());info_box.setContentSize(440,34),info_box.setAnchorPoint(ZERO()),info_box.setPosition(0,0),this.addChild(info_box),this.setContentSize(446,44);var label=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_1871,!1,!0,2,cc.color(0,0,0,255));label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),label.setPosition(8,ccCenter(info_box).y),info_box.addChild(label);var content_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1871);content_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),content_label.setPosition(ccWidth(info_box)-9,ccCenter(info_box).y),info_box.addChild(content_label);var mt=MasterManager.getInstance(),gr_list=MasterTable.getInstance().get_GeneralResistances(gnrl_id),resistance_type=0;switch(index){case 0:resistance_type=database.BattleEffectTrans.After_Recv_Damage_Inc_Rate;break;case 1:resistance_type=database.BattleEffectTrans.Freeze;break;case 2:resistance_type=database.BattleEffectTrans.Damage_Reduce;break;case 3:resistance_type=database.BattleEffectTrans.Stun;break;case 4:resistance_type=database.BattleEffectTrans.New_Poison_Dmg_Rate;break;case 5:resistance_type=database.BattleEffectTrans.Silence;break;case 6:resistance_type=database.BattleEffectTrans.Wound_Obstruct_Heal;break;case 7:resistance_type=database.BattleEffectTrans.Blind_Darkness}for(var r in gr_list)if(gr_list[r].trans_type==resistance_type){content_label.setString(gr_list[r].content);var color=gs.getResistanceValueColor(gr_list[r].resist_value);content_label.setColor(color)}var rt=mt.get_ResistanceType(resistance_type);label.setString(rt.name);for(var idx=0;idx<gr_list.length;idx++)gr_list[idx].trans_type}}),LONG_CLICK="logn_click",DECK_LONG_CLICK="deck_long_click",SELECT_COLUMN_COUNT=4,YUNHEE_SELECT_GACHA=1,YUNHEE_SELECT_EVENT_DUNGEON=2,YunheeSelectListCell=cc.TableViewCell.extend({m_columns:null,m_in_troops_tags:null,m_in_camp_tags:null,m_gnrl_list:null,m_character_img:null,m_img_scale:1,m_own_tags:null,ctor:function(_callback){this._super(),this.m_columns=[],this.m_in_troops_tags=[],this.m_in_camp_tags=[],this.m_gnrl_list=[],this.m_own_tags=[],this.init(_callback)},init:function(_callback){this._super(),this.m_callback=_callback;var size=cc.size(456,108);this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(size);for(var offset_x=57,i=0;i<4;i++){var box=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame_2.png");box.setContentSize(98,98),box.setAnchorPoint(ANCHOR_MIDDLE()),box.setPosition(offset_x,.5*size.height),this.addChild(box),this.m_columns.push(box);var t_tag=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_equip.png");t_tag.setAnchorPoint(ANCHOR_MIDDLE()),t_tag.setPosition(offset_x,.5*size.height),this.addChild(t_tag),t_tag.setVisible(!1),this.m_in_troops_tags.push(t_tag);var c_tag=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_equip_3.png");c_tag.setAnchorPoint(ANCHOR_MIDDLE()),c_tag.setPosition(offset_x,.5*size.height),this.addChild(c_tag),c_tag.setVisible(!1),this.m_in_camp_tags.push(c_tag);var o_tag=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_equip_13.png");o_tag.setAnchorPoint(ANCHOR_MIDDLE()),o_tag.setPosition(offset_x,.5*size.height),this.addChild(o_tag),o_tag.setVisible(!1),this.m_own_tags.push(o_tag),offset_x+=114}return!0},setGnrlDatas:function(list){this.m_gnrl_list=list,this.updateGnrlIcons()},updateGnrlIcons:function(){for(var i=0;i<this.m_columns.length;i++){var spr=this.m_columns[i],t_tag=this.m_in_troops_tags[i],c_tag=this.m_in_camp_tags[i],o_tag=this.m_own_tags[i];if(i<this.m_gnrl_list.length){var gnrl=this.m_gnrl_list[i];spr.setVisible(!0),t_tag.setVisible(gnrl.using_in_troops),c_tag.setVisible(gnrl.using_in_camp),o_tag.setVisible(gnrl.is_own);var info={};this.convertData(gnrl,info);var card=(new Card).createCard(info,CARD_TYPE.type_common_card);spr.removeAllChildren(),card.setAnchorPoint(ANCHOR_MIDDLE()),card.setPosition(ccCenter(spr)),spr.addChild(card);if(gnrl.isPartner){var partner=cc.Sprite.create("#img_card_leader.png");partner.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),partner.setPosition(95,78),card.addChild(partner)}if(gnrl.is_friend_partner){var icon=cc.Sprite.create("#img_card_friend_partner.png");icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT),icon.setPosition(95,78),card.addChild(icon)}if(gnrl.is_selected){var select_img=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_select_2.png");select_img.setAnchorPoint(ZERO()),select_img.setPosition(ZERO()),card.addChild(select_img),select_img.setOpacity(0);var fadeIn=new cc.FadeIn(.7),fadeOut=new cc.FadeTo(.7,90),seq=new cc.Sequence(fadeIn,fadeOut),repeat=new cc.RepeatForever(seq);select_img.runAction(repeat)}if(gnrl.is_sell_selected){var check_img=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_check.png");check_img.setAnchorPoint(ZERO()),check_img.setPosition(ZERO()),card.addChild(check_img)}}else spr.setVisible(!1),t_tag.setVisible(!1),c_tag.setVisible(!1),o_tag.setVisible(!1)}},clickGnrlBtn:function(tag){tag<this.m_gnrl_list.length&&this.m_callback(this.m_gnrl_list[tag])},touchPosCell:function(pos,world_pos){for(var i=0;i<this.m_columns.length;i++){var box=this.m_columns[i];if(box.isVisible()){var r=box.getBoundingBox();if(cc.rectContainsPoint(r,pos)){box.stopAllActions();var zoom=new cc.ScaleTo(.05,1.1),zoomout=new cc.ScaleTo(.05,1),seq=new cc.Sequence(zoom,zoomout);box.runAction(seq),this.clickGnrlBtn(i)}}}},convertData:function(input,output){output.gnrl_id=input.gnrl_id,output.is_lock=input.is_lock,output.is_max_level=input.isMaxLevel,output.is_partner=input.isPartner,output.level=input.gnrl_level,output.limit_step_id=input.limit_step_id,output.love_level=input.love_level,output.is_enable_evolve=input.isEnabledEvolve||input.isEnabledLimitOver,output.gender_type=input.gender_type}}),YunheeSelectGachaLayer=cc.Layer.extend({m_select_gnrl_id:0,m_skeleton_action_index:0,m_voice_playing_delta:0,m_isSpineMode:!1,m_is_voice_playing:!1,m_leftLayer:null,m_rightLayer:null,m_isLongTouch:!1,m_long_touch_cell:null,m_characterLayer:null,m_character_img:null,m_standing_skeleton:null,m_img_scale:1,m_tableView:null,m_skeletonNode:null,m_layer:null,m_touchEventLayer:null,m_yunheeTableLayer:null,m_invoker:0,m_element_type_filter:100,m_btn_sort:null,m_btn_sort_2:null,m_isSortDesc:!0,m_sort:1,m_isSortBtnVisible:!1,m_filter_gnrl_list:[],m_state_filter_btns:[],m_sortLayer:null,ctor:function(invoker){invoker=YUNHEE_SELECT_GACHA,this._super(),this.m_select_gnrl_id=0,this.m_skeleton_action_index=0,this.m_voice_playing_delta=0,this.m_isSpineMode=!1,this.m_is_voice_playing=!1,this.m_leftLayer=null,this.m_rightLayer=null,this.m_isLongTouch=!1,this.m_long_touch_cell=null,this.m_characterLayer=null,this.m_character_img=null,this.m_standing_skeleton=null,this.m_layer=null,this.m_touchEventLayer=null,this.m_yunheeTableLayer=null,this.m_invoker=invoker,this.m_sort=1},init:function(){},setYunheeSelectGeneralInfo:function(title,gnrl_list){this.m_gnrl_list=[],this.m_gnrl_list=gnrl_list,this.getUserGeneralInfoList(this.m_element_type_filter),this.m_title_str=title},initLayout:function(){this.m_layer=new cc.Layer,this.addChild(this.m_layer),this.m_rightLayer=this.getRightBoxLayer(),this.m_rightLayer.ignoreAnchorPointForPosition(!1),this.m_rightLayer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_rightLayer.setPosition(ccWidth(this),0),this.m_layer.addChild(this.m_rightLayer,2),this.m_stateFilterLayer=this.getStateFilterLayer(),this.m_stateFilterLayer.ignoreAnchorPointForPosition(!1),this.m_stateFilterLayer.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_stateFilterLayer.setPosition(-55,ccCenter(this.m_rightLayer).y),this.m_rightLayer.addChild(this.m_stateFilterLayer);var bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub.png");bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(this.m_layer)),USE_SP_COMMON_SUB_BG_SCALE&&bg.setScale(2),this.m_layer.addChild(bg);var summon_btn=new LabelButton("btn_03_off.png","btn_03_on.png","",ccui.Widget.PLIST_TEXTURE);summon_btn.setFont(LABEL_FONT_INDEX.FONT_241),summon_btn.setString("召喚する"),summon_btn.setAnchorPoint(ZERO()),summon_btn.setPosition((ccWidth(this)-478)/2-ccWidth(summon_btn)/2,16),summon_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_MailScene_V2],NOTIFY_MENU_YUNHEE_SELECT_SUMMON)}),this.m_layer.addChild(summon_btn,1),this.m_invoker==YUNHEE_SELECT_EVENT_DUNGEON&&summon_btn.setString("選択する");var characterChangeBtn=new ccui.Button("btn_purple_circle_change_off.png","btn_purple_circle_change_on.png","",ccui.Widget.PLIST_TEXTURE);characterChangeBtn.setAnchorPoint(ZERO()),characterChangeBtn.setPosition(6,92),this.m_layer.addChild(characterChangeBtn,1),characterChangeBtn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_MailScene_V2],NOTIFY_MENU_YUNHEE_CHARACTER_CHANGE)}),this.m_touchEventLayer=new cc.Layer,this.m_touchEventLayer.ignoreAnchorPointForPosition(!1),this.m_touchEventLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_touchEventLayer.setContentSize(cc.size(480,640)),this.m_touchEventLayer.setPosition((ccWidth(this)-478)/2-ccWidth(this.m_touchEventLayer)/2,0),this.m_layer.addChild(this.m_touchEventLayer);var listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(touch,event){if(0==this.m_select_gnrl_id)return!1;var rect=new cc.Rect(this.m_touchEventLayer.getPosition().x,this.m_touchEventLayer.getPosition().y,this.m_touchEventLayer.getContentSize().width,this.m_touchEventLayer.getContentSize().height),pos=touch.getLocation();return!!cc.rectContainsPoint(rect,pos)}.bind(this),onTouchEnded:function(touch,event){if(this.m_isSpineMode){2<this.m_skeleton_action_index&&(this.m_skeleton_action_index=1),0==this.m_skeleton_action_index?(this.m_skeletonNode.setAnimation(0,"prepare",!1),this.m_skeletonNode.addAnimation(0,"idle",!0)):1==this.m_skeleton_action_index?(this.m_skeletonNode.setAnimation(0,"attack1",!1),this.m_skeletonNode.addAnimation(0,"idle",!0)):2==this.m_skeleton_action_index&&(this.m_skeletonNode.setAnimation(0,"attack2",!1),this.m_skeletonNode.addAnimation(0,"idle",!0)),this.m_skeleton_action_index++;var duration=0,ref={},voice=(voice_list=MasterTable.getInstance().get_Voice(this.m_gnrl_info.gnrl_id,voice_detail_sd_touch,ref)).voice;if(duration=voice_list.duration,!this.m_is_voice_playing)if(voice&&""!=voice&&null!=voice)AudioEngine.getInstance().playVoice(RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3",!1),this.m_is_voice_playing=!0,this.m_voice_playing_delta=duration}else{var voice_list,is_voice_play=!1;duration=0,ref={},voice=(voice_list=MasterTable.getInstance().get_Voice(this.m_gnrl_info.gnrl_id,voice_books_body_touch,ref)).voice;if(duration=voice_list.duration,null!=this.m_character_img){this.m_character_img.stopAllActions();var s1=new cc.ScaleTo(.1,this.m_img_scale+.03,this.m_img_scale-.03),s2=new cc.ScaleTo(.2,this.m_img_scale-.03,this.m_img_scale+.03),s3=new cc.ScaleTo(.15,this.m_img_scale+.02,this.m_img_scale-.02),s4=new cc.ScaleTo(.8,this.m_img_scale,this.m_img_scale),callback=new cc.CallFunc(this.characterIdelAction,this),e4=new cc.EaseElasticInOut(s4),seq=new cc.Sequence(s1,s2,s3,e4,callback);this.m_character_img.runAction(seq),is_voice_play=!0}else this.m_standing_skeleton.setAnimation(0,"active",!1),this.m_standing_skeleton.addAnimation(0,"basic",!0),is_voice_play=!0;if(1==is_voice_play)if(!this.m_is_voice_playing)if(voice&&""!=voice&&null!=voice)AudioEngine.getInstance().playVoice(RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3",!1),this.m_is_voice_playing=!0,this.m_voice_playing_delta=duration}}.bind(this)});cc.eventManager.addListener(listener,this);var statusLayer=new StatusLayer(INVOKER_TYPE.normal);statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer,3);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_mail.png");return title.setAnchorPoint(ZERO()),title.setPosition(94,586),this.addChild(title,4),this.scheduleUpdate(),!0},getUserGeneralInfoList:function(element_type){this.m_filter_gnrl_list=[];for(var mt=MasterManager.getInstance(),i=0;i<this.m_gnrl_list.length;i++){var gnrl=this.m_gnrl_list[i],g=mt.get_General(gnrl.gnrl_id);100==element_type?this.m_filter_gnrl_list.push(gnrl):g.element_type==element_type&&this.m_filter_gnrl_list.push(gnrl)}},setStateFilter:function(index){for(var i=0;i<this.m_state_filter_btns.length;i++){this.m_state_filter_btns[i].getTag()==index?this.m_state_filter_btns[i].setEnabled(!1):this.m_state_filter_btns[i].setEnabled(!0)}this.m_tableView.reloadData(),this.m_element_type_filter=index,GameContext.getInstance().setElementTypeFilter(this.m_element_type_filter)},getStateFilterLayer:function(){var layer=new cc.Layer;layer.setContentSize(60,410),this.m_state_filter_btns=[],this.m_element_type_filter=GameContext.getInstance().getElementTypeFilter();for(var pos_y=0,i=1;i<7;++i){var index=i;0<index&&(index=6==index?100:6-i);var btn=this.getElementFilterButton(index);btn.setAnchorPoint(ZERO()),btn.setPosition(0,pos_y),btn.setTag(index),btn.addClickEventListener(function(sender){var index=sender.getTag();this.getUserGeneralInfoList(index),this.sort(),this.setStateFilter(index)}.bind(this)),layer.addChild(btn),pos_y+=ccWidth(btn)+10,index==this.m_element_type_filter&&btn.setEnabled(!1),this.m_state_filter_btns.push(btn)}return layer},sort:function(){if(0!=this.m_filter_gnrl_list.length){switch(this.m_filter_gnrl_list=stable(this.m_filter_gnrl_list,function(l,r){return this.m_isSortDesc?l.gnrl_id<r.gnrl_id:l.gnrl_id>r.gnrl_id}.bind(this)),this.m_filter_gnrl_list=stable(this.m_filter_gnrl_list,function(l,r){return this.m_isSortDesc?l.element_type>r.element_type:l.element_type<r.element_type}.bind(this)),this.m_filter_gnrl_list=stable(this.m_filter_gnrl_list,function(l,r){return this.m_isSortDesc?l.class_type<r.class_type:l.class_type>r.class_type}.bind(this)),this.m_sort){case 5:this.m_filter_gnrl_list=stable(this.m_filter_gnrl_list,function(l,r){return this.m_isSortDesc?l.state_type>r.state_type:l.state_type<r.state_type}.bind(this));break;case 1:this.m_filter_gnrl_list=stable(this.m_filter_gnrl_list,function(l,r){return this.m_isSortDesc?l.rare_type<r.rare_type:l.rare_type>r.rare_type}.bind(this));break;case 3:this.m_filter_gnrl_list=stable(this.m_filter_gnrl_list,function(l,r){return this.m_isSortDesc?l.arm_service_type>r.arm_service_type:l.arm_service_type<r.arm_service_type}.bind(this));break;case 2:this.m_filter_gnrl_list=stable(this.m_filter_gnrl_list,function(l,r){return this.m_isSortDesc?l.gnrl_group<r.gnrl_group:l.gnrl_group>r.gnrl_group}.bind(this));break;case 4:this.m_filter_gnrl_list=stable(this.m_filter_gnrl_list,function(l,r){return this.m_isSortDesc?l.fight_type>r.fight_type:l.fight_type<r.fight_type}.bind(this));break;case 6:this.m_filter_gnrl_list=stable(this.m_filter_gnrl_list,function(l,r){return this.m_isSortDesc?l.attk+l.add_atk_value<r.attk+r.add_atk_value:l.attk+l.add_atk_value>r.attk+r.add_atk_value}.bind(this));break;case 7:this.m_filter_gnrl_list=stable(this.m_filter_gnrl_list,function(l,r){return this.m_isSortDesc?l.def+l.add_def_value<r.def+r.add_def_value:l.def+l.add_def_value>r.def+r.add_def_value}.bind(this));break;case 8:this.m_filter_gnrl_list=stable(this.m_filter_gnrl_list,function(l,r){return this.m_isSortDesc?l.hp+l.add_hp_value<r.hp+r.add_hp_value:l.hp+l.add_hp_value>r.hp+r.add_hp_value}.bind(this))}this.reloadTableView()}},reloadTableView:function(){var offset=this.m_tableView.getContentOffset();this.m_tableView.reloadData(),this.m_tableView.setContentOffset(offset)},getElementFilterButton:function(index){var btn=new ccui.Button;return btn.loadTextures("btn_09_"+leadingZeros(index,2)+"_none.png","btn_09_"+leadingZeros(index,2)+"_on.png","btn_09_"+leadingZeros(index,2)+"_off.png",ccui.Widget.PLIST_TEXTURE),btn},getRightBoxLayer:function(){var layer=new cc.Layer,right_bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));if(right_bg_box.setContentSize(478,568),right_bg_box.setAnchorPoint(ZERO()),right_bg_box.setPosition(ZERO()),layer.addChild(right_bg_box),layer.setContentSize(ccSize(right_bg_box)),this.m_invoker==YUNHEE_SELECT_GACHA){this.m_tableView=new cc.TableView(this,cc.size(451,391)),this.m_tableView.setPosition(ccCenter(layer).x,56),(info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero())).setAnchorPoint(ZERO()),info_box.setContentSize(cc.size(458,40)),info_box.setPosition(10,16),layer.addChild(info_box);var info_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_friend/img_friend_text.png");info_icon.setAnchorPoint(ZERO),info_icon.setPosition(95,4),info_box.addChild(info_icon);var info_label=cmLabel.getLabel("恋姫を長タッチすると詳細情報が出ます。",LABEL_FONT_INDEX.FONT_1613);info_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),info_label.setPosition(130,ccCenter(info_box).y),info_box.addChild(info_label)}else{this.m_tableView=new cc.TableView(this,cc.size(451,391)),this.m_tableView.setPosition(ccCenter(layer).x,21);var info_box,event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=MasterTable.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx);(info_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_eventvs"+period.event_dungeon_point_period_idx+"/img_eventvs_yhselect_text.png")).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),info_box.setPosition(ccCenter(layer).x,375),layer.addChild(info_box)}this.m_tableView.ignoreAnchorPointForPosition(!1),this.m_tableView.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_tableView.setVerticalFillOrder(0),this.m_tableView.setDelegate(this),layer.addChild(this.m_tableView),this.m_tableView.reloadData();var left_navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");left_navi.setAnchorPoint(ZERO()),left_navi.setPosition(8,509),layer.addChild(left_navi,1e3);var title_label=cmLabel.getLabel(this.m_title_str,LABEL_FONT_INDEX.FONT_261);title_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),title_label.setPosition(12,ccCenter(left_navi).y+4),left_navi.addChild(title_label),cmLabel.autoSizeFit(title_label,380,26);var ticket_info_text=cmLabel.getLabel(res_str("character_select_ticket_info_text"),LABEL_FONT_INDEX.FONT_221);ticket_info_text.setAnchorPoint(ANCHOR_TOP_LEFT()),ticket_info_text.setPosition(26,ccHeight(layer)-78),layer.addChild(ticket_info_text);var sortLayer=this.getNaviSortLayer();return sortLayer.setPosition(302,460),layer.addChild(sortLayer),layer},setDesc:function(){this.m_isSortDesc?(this.m_isSortDesc=!1,this.m_btn_sort_2.loadTexturePressed("btn_align_top_on.png",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_2.loadTextureNormal("btn_align_top_off.png",ccui.Widget.PLIST_TEXTURE)):(this.m_isSortDesc=!0,this.m_btn_sort_2.loadTexturePressed("btn_align_bottom_on.png",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_2.loadTextureNormal("btn_align_bottom_off.png",ccui.Widget.PLIST_TEXTURE)),this.m_isSortBtnVisible&&this.runActionSortButton(),this.sort()},getNaviSortLayer:function(){var layer=new cc.Layer;return this.m_btn_sort=new LabelButton("btn_02_off.png","btn_02_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort.setFont(LABEL_FONT_INDEX.FONT_201),this.m_sort=1,this.m_isSortDesc=!0,this.initSort(this.m_sort),this.m_btn_sort.setAnchorPoint(ZERO()),this.m_btn_sort.setPosition(ZERO()),this.m_btn_sort.addClickEventListener(function(sender){this.runActionSortButton()}.bind(this)),layer.addChild(this.m_btn_sort),this.m_btn_sort_2=new ccui.Button,this.m_btn_sort_2.loadTextures("btn_align_bottom_off.png","btn_align_bottom_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_2.setAnchorPoint(ZERO()),this.m_btn_sort_2.setPosition(ccWidth(this.m_btn_sort),0),this.m_btn_sort_2.addClickEventListener(function(sender){this.setDesc()}.bind(this)),layer.addChild(this.m_btn_sort_2),this.m_isSortDesc||(this.m_btn_sort_2.loadTexturePressed("btn_align_top_on.png",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_2.loadTextureNormal("btn_align_top_off.png",ccui.Widget.PLIST_TEXTURE)),this.m_sortLayer=this.getSortLayer(),this.m_sortLayer.ignoreAnchorPointForPosition(!1),this.m_sortLayer.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_sortLayer.setPosition(ZERO()),this.m_sortLayer.setVisible(!1),layer.addChild(this.m_sortLayer,100),layer.setContentSize(ccSize(this.m_btn_sort)),layer},getSortLayer:function(){var layer=new cc.Layer,sort_btn_strs=[];sort_btn_strs.push_back(res_str("btn_sort_hp")),sort_btn_strs.push_back(res_str("btn_sort_def")),sort_btn_strs.push_back(res_str("btn_sort_attk")),sort_btn_strs.push_back(res_str("btn_sort_state")),sort_btn_strs.push_back(res_str("btn_sort_fight_type")),sort_btn_strs.push_back(res_str("btn_sort_arm_service_type")),sort_btn_strs.push_back(res_str("btn_sort_yunhee")),sort_btn_strs.push_back(res_str("btn_sort_rare_type"));for(var btn_pos_y=0,str_size=sort_btn_strs.length,idx=0;idx<sort_btn_strs.length;idx++){var btn=new LabelButton("btn_02_off.png","btn_02_on.png","",ccui.Widget.PLIST_TEXTURE);btn.setFont(LABEL_FONT_INDEX.FONT_201),btn.setString(sort_btn_strs[idx]),btn.setAnchorPoint(ZERO()),btn.setPosition(0,btn_pos_y),btn.addClickEventListener(function(sender){this.setSort(sender.getTag())}.bind(this)),layer.addChild(btn),btn_pos_y+=ccHeight(btn),btn.setTag(str_size--)}return sort_btn_strs=[],layer.setContentSize(111,btn_pos_y),layer},setSortLabel:function(sort_index){switch(sort_index){case 1:this.m_btn_sort.setString(res_str("btn_sort_rare_type"));break;case 5:this.m_btn_sort.setString(res_str("btn_sort_state"));break;case 3:this.m_btn_sort.setString(res_str("btn_sort_arm_service_type"));break;case 2:this.m_btn_sort.setString(res_str("btn_sort_yunhee"));break;case 4:this.m_btn_sort.setString(res_str("btn_sort_fight_type"));break;case 6:this.m_btn_sort.setString(res_str("btn_sort_attk"));break;case 7:this.m_btn_sort.setString(res_str("btn_sort_def"));break;case 8:this.m_btn_sort.setString(res_str("btn_sort_hp"))}},initSort:function(sort_index){this.setSortLabel(sort_index),this.sort()},setSort:function(sort_index){this.m_sort!=sort_index&&(this.setSortLabel(sort_index),this.m_sort=sort_index,this.sort()),this.runActionSortButton()},runActionSortButton:function(){this.m_isSortBtnVisible?(this.m_sortLayer.setVisible(!1),this.m_isSortBtnVisible=!1):(this.m_sortLayer.setVisible(!0),this.m_isSortBtnVisible=!0)},getCharacterLayer:function(gnrl_id){this.m_voice_playing_delta=0,this.m_is_voice_playing=!1,this.m_isSpineMode=!1,this.m_character_img=null;var layer=new cc.Layer;layer.setContentSize(cc.size(480,640));var mt=MasterManager.getInstance();this.m_gnrl_info=mt.get_General(gnrl_id),this.m_select_gnrl_id=this.m_gnrl_info.gnrl_id;var state_type=this.m_gnrl_info.state_type,state_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_state_"+state_type+".png");state_img.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),state_img.setPosition(ccCenter(layer).x,112),USE_SP_MENU_YH_SCALE&&state_img.setScale(2),layer.addChild(state_img),state_img.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR);var pos=mt.get_BodyPosition(this.m_gnrl_info.gnrl_id),morph=MasterTable.getInstance().get_MorphData(this.m_gnrl_info.gnrl_id),gnrl=mt.get_General(morph.gnrl_id);if("y"==morph.is_morph){var gnrl_img=[],stading_files=StandingMultiplePngList[morph.gnrl_id];if(USE_PARTNER_GNRL_LOADING){if(SAVE_NOW_PARTNER_GNRL.gnrl_id!=this.m_gnrl_info.gnrl_id){if(null==stading_files)gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".png");else for(var idx=0;idx<stading_files.length;idx++)gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+stading_files[idx]+".png");gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".json"),gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".atlas")}}else{if(null==stading_files)gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".png");else for(idx=0;idx<stading_files.length;idx++)gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+stading_files[idx]+".png");gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".json"),gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".atlas")}resourceLoader(gnrl_img,function(){var gnrl_atlas=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".atlas",gnrl_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".json";this.m_standing_skeleton=new sp.SkeletonAnimation(gnrl_json,gnrl_atlas),this.m_standing_skeleton.setScale(.1),this.m_standing_skeleton.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_standing_skeleton.setPosition(Detail_pos(pos.posx,pos.posy)),layer.addChild(this.m_standing_skeleton),this.m_standing_skeleton.setMix("basic","active",.1),this.m_standing_skeleton.setMix("active","basic",.1),this.m_standing_skeleton.setAnimation(0,"active",!1),this.m_standing_skeleton.addAnimation(0,"basic",!0)}.bind(this))}else{gnrl_img=[];if(USE_PARTNER_GNRL_LOADING){if(SAVE_NOW_PARTNER_GNRL.gnrl_id!=this.m_gnrl_info.gnrl_id){var card_img=getCardBody_ImageStr(gnrl_id);gnrl_img.push(card_img)}}else{card_img=getCardBody_ImageStr(gnrl_id);gnrl_img.push(card_img)}resourceLoader(gnrl_img,function(){this.m_character_img=new cc.Sprite;var mt=MasterManager.getInstance(),general=mt.get_General(this.m_gnrl_info.gnrl_id);if(general.gnrl_type==GENERAL_TYPE_YUNHEE){if(mt.get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id),this.m_character_img.setTexture(img_str)}else{img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id),this.m_character_img.setTexture(img_str)}}else{img_str=getCardBody_ImageStr(this.m_gnrl_info.gnrl_id);this.m_img_scale=getCardBody_Scale(this.m_gnrl_info.gnrl_id),this.m_character_img.setTexture(img_str)}this.m_character_img.setAnchorPoint(ANCHOR_MIDDLE()),this.m_character_img.setScale(this.m_img_scale),this.m_character_img.setPosition(Detail_pos(pos.posx+ccWidth(this.m_character_img)*this.m_img_scale/2,pos.posy+ccHeight(this.m_character_img)*this.m_img_scale/2)),layer.addChild(this.m_character_img);var callback=new cc.CallFunc(this.characterIdelAction,this);this.m_character_img.runAction(callback)}.bind(this))}var sd_img=[],sd_list=SDGeneralName[gnrl.gnrl_group];for(idx=0;idx<sd_list.length;idx++)sd_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+sd_list[idx]+".png");sd_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+gnrl.skin_id+".atlas"),sd_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+gnrl.skin_id+".json"),resourceLoader(sd_img,function(){this.m_skeletonNode=new sp.SkeletonAnimation(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+this.m_gnrl_info.bone_id+".json",RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+this.m_gnrl_info.skin_id+".atlas",.55),null!=this.m_character_img?this.m_skeletonNode.setPosition(-ccWidth(this.m_character_img)*this.m_img_scale,120):this.m_skeletonNode.setPosition(-2048,120),layer.addChild(this.m_skeletonNode),this.m_skeletonNode.setSkin(this.m_gnrl_info.gnrl_class),this.m_skeletonNode.setAnimation(0,"basic",!0),this.m_skeletonNode.setMix("basic","prepare",.1),this.m_skeletonNode.setMix("prepare","basic",.1),this.m_skeletonNode.setMix("attack1","prepare",.1),this.m_skeletonNode.setMix("prepare","attack1",.1),this.m_skeletonNode.setMix("attack2","prepare",.1),this.m_skeletonNode.setMix("prepare","attack2",.1),this.m_skeletonNode.setMix("attack1","basic",.1),this.m_skeletonNode.setMix("basic","attack1",.1),this.m_skeletonNode.setMix("attack2","basic",.1),this.m_skeletonNode.setMix("basic","attack2",.1),this.m_skeletonNode.setMix("attack1","attack2",.1),this.m_skeletonNode.setMix("attack2","attack1",.1),this.m_skeletonNode.setOpacity(0)}.bind(this));var rare_type_mark=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_unique_"+leadingZeros(this.m_gnrl_info.rare_type,2)+".png");rare_type_mark.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),rare_type_mark.setPosition(ccCenter(layer).x,154),layer.addChild(rare_type_mark,100);var gnrl_name,name_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_namebox.png");return name_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),name_box.setPosition(ccCenter(layer).x,70),layer.addChild(name_box,100),(gnrl_name=8<this.m_gnrl_info.name.length?cmLabel.getLabel(this.m_gnrl_info.name,LABEL_FONT_INDEX.FONT_161):cmLabel.getLabel(this.m_gnrl_info.name,LABEL_FONT_INDEX.FONT_261)).setAnchorPoint(ANCHOR_MIDDLE()),gnrl_name.setPosition(ccCenter(name_box)),name_box.addChild(gnrl_name,100),layer},changeCharacter:function(){this.m_voice_playing_delta=0,this.m_is_voice_playing=!1;var pos=MasterManager.getInstance().get_BodyPosition(this.m_select_gnrl_id);if("y"==MasterTable.getInstance().get_MorphData(this.m_select_gnrl_id).is_morph)this.m_standing_skeleton.stopAllActions(),this.m_skeletonNode.stopAllActions(),this.m_isSpineMode?(this.m_skeletonNode.runAction(new cc.Sequence(new cc.MoveTo(.18,cc.p(-2048,120)),new cc.FadeOut(0))),this.m_standing_skeleton.runAction(new cc.MoveTo(.2,Detail_pos(pos.posx,pos.posy))),this.m_isSpineMode=!1,this.m_standing_skeleton.setAnimation(0,"active",!1),this.m_standing_skeleton.addAnimation(0,"basic",!0)):(this.m_standing_skeleton.runAction(new cc.MoveTo(.2,Detail_pos(-2048,pos.posy))),this.m_skeletonNode.runAction(new cc.Sequence(new cc.FadeIn(0),new cc.MoveTo(.18,cc.p(243,120)))),this.m_isSpineMode=!0);else if(this.m_character_img.stopAllActions(),this.m_skeletonNode.stopAllActions(),this.m_isSpineMode){this.m_skeletonNode.runAction(new cc.Sequence(new cc.MoveTo(.18,Vec2(-ccWidth(this.m_character_img)*this.m_img_scale-100,120)),new cc.FadeOut(0)));var callback=new cc.CallFunc(this.characterIdelAction,this);this.m_character_img.runAction(new cc.Sequence(new cc.MoveTo(.2,Detail_pos(pos.posx+ccWidth(this.m_character_img)*this.m_img_scale/2,pos.posy+ccHeight(this.m_character_img)*this.m_img_scale/2)),callback)),this.m_isSpineMode=!1}else this.m_character_img.runAction(new cc.MoveTo(.2,Detail_pos(-ccWidth(this.m_character_img)*this.m_img_scale*2-150,pos.posy+ccHeight(this.m_character_img)*this.m_img_scale/2))),this.m_skeletonNode.runAction(new cc.Sequence(new cc.FadeIn(0),new cc.MoveTo(.18,cc.p(243,120)))),this.m_isSpineMode=!0;this.m_is_voice_playing=!1,this.m_voice_playing_delta=0},characterIdelAction:function(){var scaleTo_1=new cc.ScaleTo(.7,this.m_img_scale,this.m_img_scale+.01),scaleTo_2=new cc.ScaleTo(.7,this.m_img_scale,this.m_img_scale-.01),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);this.m_character_img.runAction(repeat)},setYunheeSelectCardInfo:function(gnrl_id){null!=this.m_characterLayer&&(this.m_characterLayer.removeFromParent(),this.m_characterLayer=null,this.m_standing_skeleton=null),this.m_characterLayer=this.getCharacterLayer(gnrl_id),this.m_characterLayer.setPosition((ccWidth(this)-478)/2-ccWidth(this.m_characterLayer)/2,0),this.m_layer.addChild(this.m_characterLayer)},setYunheeSelectRemove:function(){null!=this.m_characterLayer&&(this.m_characterLayer.removeFromParent(),this.m_characterLayer=null,this.m_character_img=null,this.m_standing_skeleton=null);for(var gnrl=0;gnrl<this.m_filter_gnrl_list.length;gnrl++)this.m_filter_gnrl_list[gnrl].is_selected=!1;var offset=this.m_tableView.getContentOffset();this.m_tableView.reloadData(),this.m_tableView.setContentOffset(offset),this.m_select_gnrl_id=0},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;cell=null!=c?c:new YunheeSelectListCell(this.choiceGnrl.bind(this));var desc=[],start=idx*SELECT_COLUMN_COUNT,end=start+SELECT_COLUMN_COUNT;if(end<this.m_filter_gnrl_list.length)for(idx=start;idx<end;idx++)desc.push(this.m_filter_gnrl_list[idx]);else for(idx=start;idx<this.m_filter_gnrl_list.length;idx++)desc.push(this.m_filter_gnrl_list[idx]);return cell.setGnrlDatas(desc),cell},cellSizeForTable:function(){return cc.size(456,108)},tableCellSizeForIndex:function(table,idx){return cc.size(456,108)},numberOfCellsInTableView:function(){var cnt=Math.floor(this.m_filter_gnrl_list.length/SELECT_COLUMN_COUNT);return 0<this.m_filter_gnrl_list.length%SELECT_COLUMN_COUNT&&(cnt+=1),cnt},tableCellTouched:function(table,cell){if(this.unschedule(LONG_CLICK),!this.m_isLongTouch){null!=cell&&cell.touchPosCell(cell.getTouchPos(),cell.getTouchWorldPos())}},tableCellHighlight:function(table,cell){this.m_long_touch_cell=cell,this.scheduleOnce(function(float){this.m_isLongTouch=!0;var c=this.m_long_touch_cell;null!=c&&c.touchPosCell(this.m_long_touch_cell.getTouchPos(),this.m_long_touch_cell.getTouchWorldPos())}.bind(this),.4,LONG_CLICK)},tableCellUnhighlight:function(){},tableCellEnded:function(table){this.m_isLongTouch&&(this.m_isLongTouch=!1,MainObserver.getInstance().postNotification(sceneStr[scene_MailScene_V2],NOTIFY_LONG_CLICK_POPUP_HIDE))},scrollViewDidScroll:function(){this.unschedule(LONG_CLICK)},choiceGnrl:function(info){if(this.m_choice_gnrl=info,this.m_isLongTouch)info.gnrl_type!=GENERAL_TYPE_MATERIAL&&info.gnrl_type!=GENERAL_TYPE_EVOLVE_MATERIAL?(GameContext.getInstance().setGeneralKey(info.gnrl_id,info.gnrl_num),MainObserver.getInstance().postNotification(sceneStr[scene_MailScene_V2],NOTIFY_IS_LONG_CLICK)):this.m_isLongTouch=!1;else{for(var idx=0;idx<this.m_filter_gnrl_list.length;idx++){var gnrl=this.m_filter_gnrl_list[idx];gnrl.gnrl_id==info.gnrl_id?gnrl.is_selected=!0:gnrl.is_selected=!1}GameContext.getInstance().setGeneralKey(info.gnrl_id,info.gnrl_num);var offset=this.m_tableView.getContentOffset();this.m_tableView.reloadData(),this.m_tableView.setContentOffset(offset),MainObserver.getInstance().postNotification(sceneStr[scene_MailScene_V2],NOTIFY_MENU_YH_DETAIL)}},update:function(dt){this.m_is_voice_playing&&(this.m_voice_playing_delta-=dt,this.m_voice_playing_delta<0&&(this.m_is_voice_playing=!1,this.m_voice_playing_delta=0))}}),YunheeIllustItemLayer=cc.Layer.extend({m_selected_img:null,m_selected_bg:null,m_isSelected:!1,m_illust_idx:-1,ctor:function(illust_idx){this._super(),this.initLayout(illust_idx)},initLayout:function(illust_idx){var n=new NetService;this.m_illust_idx=illust_idx;var layer=new cc.Layer,box=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_special/i_%d.png",this.m_illust_idx));box.setAnchorPoint(ZERO()),box.setPosition(ZERO()),layer.addChild(box);var box_frame=cc.Sprite.create(RES_CDN_DEFULT+"menu_special/img_card_frame_special.png");if(box_frame.setAnchorPoint(ANCHOR_MIDDLE()),box_frame.setPosition(ccCenter(box)),box.addChild(box_frame),1==n.getUserIllust(illust_idx)){var hold_illust=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_equip_13.png");hold_illust.setAnchorPoint(ANCHOR_MIDDLE()),hold_illust.setPosition(ccCenter(box)),box.addChild(hold_illust)}return layer.setContentSize(ccWidth(box)+6,ccHeight(box)+6),this.setContentSize(ccSize(layer)),this.addChild(layer),this.m_selected_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_1.png",RectZero()),this.m_selected_bg.setContentSize(ccSize(box)),this.m_selected_bg.setAnchorPoint(ZERO()),this.m_selected_bg.setPosition(ZERO()),box.addChild(this.m_selected_bg),this.m_selected_bg.setOpacity(0),this.m_selected_img=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_2.png",RectZero()),this.m_selected_img.setContentSize(ccSize(box)),this.m_selected_img.setAnchorPoint(ZERO()),this.m_selected_img.setPosition(ZERO()),box.addChild(this.m_selected_img),this.m_selected_img.setOpacity(0),!0},setClickButton:function(){this.m_selected_bg.setOpacity(255);var fadeIn=new cc.FadeIn(.7),fadeOut=new cc.FadeOut(.7),seq=new cc.Sequence(fadeIn,fadeOut),repeat=new cc.RepeatForever(seq);this.m_selected_img.runAction(repeat),this.m_isSelected=!0},setNormalButton:function(){this.m_selected_bg.setOpacity(0),this.m_selected_img.stopAllActions(),this.m_selected_img.setOpacity(0),this.m_isSelected=!1}}),YunheeSelectIllustLayer=(YUNHEE_SELECT_GACHA=1,YUNHEE_SELECT_EVENT_DUNGEON=2,cc.Layer.extend({m_layer:null,m_leftLayer:null,m_rightLayer:null,m_illustTableLayer:null,m_title_str:null,m_IllustGrouplist:[],m_illustGroupItems:[],m_illustLayer:null,m_select_illust_idx:0,m_illustInfoModalLayer:null,m_summon_btn:null,m_voice_btn:null,m_is_voice_playing:!1,m_voice_playing_delta:0,ctor:function(){this._super(),this.m_layer=null,this.m_leftLayer=null,this.m_rightLayer=null,this.m_illustTableLayer=null,this.m_title_str=null,this.m_IllustGrouplist=[],this.m_illustGroupItems=[],this.m_voice_btn=null,this.m_is_voice_playing=!1,this.m_voice_playing_delta=0},init:function(){return this._super(),!0},initLayout:function(){var n=new NetService;MasterTable.getInstance();this.m_layer=new cc.Layer,this.addChild(this.m_layer);var bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub.png");bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(this.m_layer)),USE_SP_COMMON_SUB_BG_SCALE&&bg.setScale(2),this.m_layer.addChild(bg);var statusLayer=new StatusLayer(INVOKER_TYPE.normal);statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer,3),this.m_summon_btn=new LabelButton("btn_03_off.png","btn_03_on.png","btn_03_none.png",ccui.Widget.PLIST_TEXTURE),this.m_summon_btn.setFont(LABEL_FONT_INDEX.FONT_241),this.m_summon_btn.setString(res_str("card_illust_summon_button_text")),this.m_summon_btn.setAnchorPoint(ZERO()),this.m_summon_btn.setPosition((ccWidth(this)-478)/2-ccWidth(this.m_summon_btn)/2,16),this.m_summon_btn.addClickEventListener(function(sender){n.getUserIllust(this.m_select_illust_idx)||0==this.m_select_illust_idx||MainObserver.getInstance().postNotification(NOTIFY_MENU_ILLUST_SELECT_SUMMON)}.bind(this)),0==this.m_select_illust_idx&&this.m_summon_btn.setEnabled(!1),this.m_layer.addChild(this.m_summon_btn,1);var illustInfoBtn=new ccui.Button;illustInfoBtn.loadTextures("btn_purple_circle_zoom_off.png","btn_purple_circle_zoom_on.png","",ccui.Widget.PLIST_TEXTURE),illustInfoBtn.setAnchorPoint(ZERO()),illustInfoBtn.setPosition(10,92),this.m_layer.addChild(illustInfoBtn,1),illustInfoBtn.addClickEventListener(function(sender){0!=this.m_select_illust_idx&&this.showIllustInfoLayer()}.bind(this));var offset_y=92+ccHeight(illustInfoBtn)+10;USE_ILLUST_VOICE&&(this.m_voice_btn=new ccui.Button,this.m_voice_btn.loadTextures("btn_purple_circle_voice_off.png","btn_purple_circle_voice_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_voice_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_voice_btn.setPosition(10,offset_y),IS_SP_BROWSER?this.addChild(this.m_voice_btn,1):bg.addChild(this.m_voice_btn,1),this.m_voice_btn.addClickEventListener(function(){0!=this.m_select_illust_idx&&this.getVoice()}.bind(this)),this.m_voice_btn.setVisible(!1)),this.m_rightLayer=this.getRightBoxLayer(),this.m_rightLayer.ignoreAnchorPointForPosition(!1),this.m_rightLayer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_rightLayer.setPosition(ccWidth(this),0),this.m_layer.addChild(this.m_rightLayer,2);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_mail.png");return title.setAnchorPoint(ZERO()),title.setPosition(94,586),this.addChild(title,10),this.m_illustInfoModalLayer=new GameModalLayer,this.addChild(this.m_illustInfoModalLayer,100),this.scheduleUpdate(),!0},setYunheeSelectGeneralInfo:function(title,illust_group_idx){var m=MasterTable.getInstance();this.m_title_str=title,this.m_IllustGrouplist=m.get_IllustGroupList(illust_group_idx)},getRightBoxLayer:function(){var layer=new cc.Layer,right_bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));right_bg_box.setContentSize(478,568),right_bg_box.setAnchorPoint(ZERO()),right_bg_box.setPosition(ZERO()),layer.addChild(right_bg_box),layer.setContentSize(ccSize(right_bg_box));cc.director.getWinSize();this.m_illustTableLayer=this.getIllustTableLayer(),this.m_illustTableLayer.setAnchorPoint(ZERO()),this.m_illustTableLayer.setPosition(17,16),layer.addChild(this.m_illustTableLayer);var left_navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");left_navi.setAnchorPoint(ZERO()),left_navi.setPosition(8,509),layer.addChild(left_navi,1e3);var title_label=cmLabel.getLabel(this.m_title_str,LABEL_FONT_INDEX.FONT_221);return title_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),title_label.setPosition(12,ccCenter(left_navi).y+4),left_navi.addChild(title_label),layer},getIllustTableLayer:function(){this.m_illustGroupItems=[];var n=new NetService,tableLayer=new TableViewLayer;return tableLayer.setAnchorPoint(ZERO()),tableLayer.setContentSize(440,485),tableLayer.setItemCount(this.m_IllustGrouplist.length),tableLayer.setColumnCount(4),tableLayer.getItemNode=function(index,contentSize,m){var illustGroup=this.m_IllustGrouplist[index],illustGroup_Layer=new YunheeIllustItemLayer(illustGroup.illust_idx);return this.m_illustGroupItems.push(illustGroup_Layer),illustGroup_Layer}.bind(this),tableLayer.initLayout(),tableLayer.onItemTouchBegin=function(index){return!0}.bind(this),tableLayer.onItemTouchMoved=function(isScroll){}.bind(this),tableLayer.onItemTouchCancel=function(index){return!0}.bind(this),tableLayer.onItemTouchEnd=function(index){var m=MasterTable.getInstance(),audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3";audio.playEffect(path);for(var i=0;i<this.m_illustGroupItems.length;i++){this.m_illustGroupItems[i].setNormalButton()}if(this.m_select_illust_idx=this.m_illustGroupItems[index].m_illust_idx,this.m_illustGroupItems[index].setClickButton(),GameContext.getInstance().setIllustIdx(this.m_select_illust_idx),this.setSelectIllustInfo(this.m_select_illust_idx),n.getUserIllust(this.m_select_illust_idx)?this.m_summon_btn.setEnabled(!1):this.m_summon_btn.setEnabled(!0),USE_ILLUST_VOICE){var isSound=m.get_illust_Voice_Count(this.m_select_illust_idx);this.m_voice_btn.setVisible(isSound)}return!0}.bind(this),tableLayer},showIllustInfoLayer:function(){this.m_illustInfoModalLayer.setContentSize(ccSize(this)),this.m_illustInfoModalLayer._contentNode=function(contentSize,m){var illust_Layer=new YunheeIllustInfoLayer(this.m_select_illust_idx),back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);return back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(this)-10,ccHeight(this)-10),back_btn.addClickEventListener(function(sender){this.scheduleOnce(function(float){this.m_illustInfoModalLayer.hide()},0,"m_illustInfoModalLayer")}.bind(this)),illust_Layer.addChild(back_btn),illust_Layer}.bind(this),this.m_illustInfoModalLayer.show()},setSelectIllustInfo:function(illust_idx){null!=this.m_illustLayer&&(this.m_illustLayer.removeFromParent(),this.m_illustLayer=null),this.m_illustLayer=this.getIllustLayer(illust_idx),this.m_illustLayer.setPosition((ccWidth(this)-478)/2-ccWidth(this.m_illustLayer)/2,0),this.m_layer.addChild(this.m_illustLayer)},getIllustLayer:function(illust_idx){var layer=new cc.Layer;layer.setContentSize(480,640);var state_img=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_special/im_%d.jpg",illust_idx)),scale=500/ccHeight(state_img);return state_img.setScale(scale),state_img.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),state_img.setPosition(ccCenter(layer).x,76),layer.addChild(state_img),layer},getVoice:function(){var mt=MasterTable.getInstance(),audio=AudioEngine.getInstance(),illust_Voice=mt.get_illust_Voice(this.m_select_illust_idx),voice=illust_Voice[Math.floor(Math.random()*illust_Voice.size())].filename;if(""!=voice&&null!=voice&&null!=voice&&!this.m_is_voice_playing){var path=RES_CDN_SOUND+SND_TYPE+"voice_etc/"+cmString("%s.mp3",voice);audio.playVoice(path),this.m_is_voice_playing=!0,this.m_voice_playing_delta=0}},update:function(dt){this.m_is_voice_playing&&(this.m_voice_playing_delta-=dt,this.m_voice_playing_delta<0&&(this.m_is_voice_playing=!1,this.m_voice_playing_delta=0))},tableCellAtIndex:function(table,idx){return table.dequeueCell()},cellSizeForTable:function(){return cc.size(456,108)},tableCellSizeForIndex:function(table,idx){return cc.size(456,108)},numberOfCellsInTableView:function(){return 0},tableCellTouched:function(table,cell){},tableCellHighlight:function(table,cell){},tableCellUnhighlight:function(table,cell){},tableCellEnded:function(table){},scrollViewDidScroll:function(){this.unschedule(LONG_CLICK)}})),SELL_COLUMN_COUNT=8,YunheeSellPopupCell=cc.TableViewCell.extend({m_columns:[],m_select_tag:[],m_heaven_pt_tags:[],m_callback:[],m_mask_tag:[],ctor:function(_callback){return this._super(),this.m_columns=[],this.m_select_tag=[],this.m_heaven_pt_tags=[],this.m_mask_tag=[],this.init(_callback),!0},init:function(_callback){this.m_callback=_callback;var size=cc.size(912,108);this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(size);for(var offset_x=57,i=0;i<8;i++){var box=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame_2.png");box.setContentSize(98,98),box.setAnchorPoint(ANCHOR_MIDDLE()),box.setPosition(offset_x,.5*size.height),this.addChild(box),this.m_columns.push(box);var m_tag=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());m_tag.setPreferredSize(cc.size(98,98)),m_tag.setAnchorPoint(ANCHOR_MIDDLE()),m_tag.setPosition(offset_x,.5*size.height),this.addChild(m_tag),m_tag.setVisible(!1),this.m_mask_tag.push(m_tag);var k_tag=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_check.png");k_tag.setAnchorPoint(ANCHOR_MIDDLE()),k_tag.setPosition(offset_x,.5*size.height),this.addChild(k_tag),k_tag.setVisible(!1),this.m_select_tag.push(k_tag);var h_tag=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_equip_9.png");h_tag.setAnchorPoint(ANCHOR_MIDDLE_TOP()),h_tag.setPosition(offset_x,size.height),this.addChild(h_tag),h_tag.setVisible(!1),this.m_heaven_pt_tags.push(h_tag),offset_x+=114}return!0},clickGnrlBtn:function(tag){tag<this.m_gnrl_list.size()&&this.m_callback(this.m_gnrl_list.at(tag))},touchPosCell:function(pos){for(var i=0;i<this.m_columns.size();i++){var box=this.m_columns.at(i);if(box.isVisible()){var r=box.getBoundingBox();if(cc.rectContainsPoint(r,pos)){box.stopAllActions();var zoom=new cc.ScaleTo(.05,1.1),zoomout=new cc.ScaleTo(.05,1),seq=new cc.Sequence(zoom,zoomout);box.runAction(seq),this.clickGnrlBtn(i)}}}},setGnrlDatas:function(list){this.m_gnrl_list=list,this.updateGnrlIcons()},updateGnrlIcons:function(){for(var i=0;i<this.m_columns.size();i++){var spr=this.m_columns.at(i),m_tag=this.m_mask_tag.at(i),sel_tag=this.m_select_tag.at(i),h_tag=this.m_heaven_pt_tags.at(i);if(sel_tag.setVisible(!1),m_tag.setVisible(!1),h_tag.setVisible(!1),i<this.m_gnrl_list.size()){var gnrl=this.m_gnrl_list.at(i);if(spr.setVisible(!0),h_tag.setVisible(gnrl.is_heaven_pt),sel_tag.setVisible(gnrl.is_sell_selected),17039==gnrl.gnrl_id);if(gnrl.using_in_troops||gnrl.using_in_great_wall_troops||gnrl.using_in_search_troops||gnrl.using_in_camp||gnrl.is_lock||gnrl.is_equipping||gnrl.is_friend_partner||gnrl.isPartner||gnrl.using_in_world_war_troops){if(17039==gnrl.gnrl_id);m_tag.setVisible(!0)}var info={};this.convertData(gnrl,info);var card=(new Card).createCard(info,CARD_TYPE.type_common_card);spr.removeAllChildren(),card.setAnchorPoint(ANCHOR_MIDDLE()),card.setPosition(ccCenter(spr)),spr.addChild(card)}else spr.setVisible(!1)}},convertData:function(input,output){output.gnrl_id=input.gnrl_id,output.is_max_level=input.isMaxLevel,output.is_lock=input.is_lock,output.level=input.gnrl_level,output.limit_step_id=input.limit_step_id,output.love_level=input.love_level,output.gender_type=input.gender_type}}),SELL_POPUP_TYPE={NORMAL_SELL:0,HEAVEN_PT_SELL:1},YunheeSellPopupLayer=cc.Layer.extend({m_gold:0,m_yunhee_pt:0,m_map_rare_type_count:null,m_gnrl_list:[],m_heaven_pt:0,m_sell_type:null,m_select_gnrl_list:[],m_info_label_1:null,m_info_label_2:null,m_tableView:null,m_is_SR_over:null,ctor:function(gnrl_info_list,sell_type){this._super(),this.m_gold=0,this.m_yunhee_pt=0,this.m_map_rare_type_count=new Map,this.m_gnrl_list=[],this.m_select_gnrl_list.clear(),this.init(gnrl_info_list,sell_type),this.m_touch_Layer=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE}),this.m_touch_Layer.onTouchBegan=function(touch,event){event.stopPropagation()}.bind(this);var mouse_listener=cc.EventListener.create({event:cc.EventListener.MOUSE,onMouseScroll:function(event){event.stopPropagation()}.bind(this)});cc.eventManager.addListener(mouse_listener,this),cc.eventManager.addListener(this.m_touch_Layer,this)},init:function(gnrl_info_list,sell_type){return this.m_gnrl_list=gnrl_info_list,this.m_sell_type=sell_type,this.convertData(),!0},setData:function(gnrl_info_list,sell_type){this.m_gnrl_list=gnrl_info_list,this.m_sell_type=sell_type,this.m_gold=0,this.m_heaven_pt=0,this.m_yunhee_pt=0,this.convertData()},convertData:function(){if(this.m_map_rare_type_count.clear(),this.m_is_SR_over=!1,this.m_gnrl_list=stable(this.m_gnrl_list,function(l,r){return l.gnrl_id>r.gnrl_id}.bind(this)),this.m_gnrl_list=stable(this.m_gnrl_list,function(l,r){return l.limit_step_id<r.limit_step_id}.bind(this)),this.m_gnrl_list=stable(this.m_gnrl_list,function(l,r){return l.gnrl_group>r.gnrl_group}.bind(this)),this.m_gnrl_list=stable(this.m_gnrl_list,function(l,r){return l.rare_type<r.rare_type}.bind(this)),this.m_sell_type==SELL_POPUP_TYPE.NORMAL_SELL)for(var idx=0;idx<this.m_gnrl_list.length;idx++){var info=this.m_gnrl_list[idx];this.m_gold+=info.sell_gold,this.m_yunhee_pt+=info.sell_yhpt,info.is_heaven_pt&&(this.m_heaven_pt+=info.sell_heaven_pt);var sell_key={};sell_key.gnrl_type=info.gnrl_type,sell_key.rare_type=info.rare_type;var temp_sell_key=[];temp_sell_key[0]=[sell_key.gnrl_type,sell_key.rare_type],0!=this.m_map_rare_type_count.find(temp_sell_key[0])?this.m_map_rare_type_count[temp_sell_key[0]]+=1:this.m_map_rare_type_count.insert(temp_sell_key[0],1),GameContext.getInstance().getYunheeTabType()==YunheeLevelUpTapTypeEnum.tab_type_yunhee&&info.rare_type>=RARE_TYPE_SR&&(this.m_is_SR_over=!0)}},initLayout:function(){var bg_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());bg_mask.setAnchorPoint(ZERO()),bg_mask.setPosition(ZERO()),bg_mask.setContentSize(ccSize(this)),this.addChild(bg_mask);var bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,40,40));bg.setInsetLeft(44),bg.setInsetRight(44),bg.setInsetTop(44),bg.setInsetBottom(44),bg.setPreferredSize(cc.size(958,555)),bg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bg.setPosition(ccCenter(this).x,10),this.addChild(bg);var navi=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_navi.png",RectZero());navi.setInsetLeft(46),navi.setInsetRight(46),navi.setPreferredSize(cc.size(942,48)),navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(bg).x,ccHeight(bg)-11),bg.addChild(navi);var title_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_241);title_label.setAnchorPoint(ANCHOR_MIDDLE()),title_label.setPosition(ccCenter(navi).x,ccCenter(navi).y),navi.addChild(title_label),(tab_type=GameContext.getInstance().getYunheeTabType())==YunheeLevelUpTapTypeEnum.tab_type_material?title_label.setString(res_str("label_general_material_sell_title")):tab_type==YunheeLevelUpTapTypeEnum.tab_type_yunhee&&title_label.setString(res_str("label_yunhee_sell_title"));var info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());info_box.setPreferredSize(cc.size(918,324)),info_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),info_box.setPosition(ccCenter(bg).x,166),bg.addChild(info_box);var cancel_btn=new LabelButton("btn_08_off.png","btn_08_on.png","",ccui.Widget.PLIST_TEXTURE);cancel_btn.setFont(LABEL_FONT_INDEX.FONT_241),cancel_btn.setString(res_str("btn_label_cancel")),cancel_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),cancel_btn.setPosition(ccCenter(bg).x-10,16),cancel_btn.addClickEventListener(function(sender){GameDefault.getInstance().getParentSellPopup()==ParentSellPopup.TO_SHOP?MainObserver.getInstance().postNotification(sceneStr[scene_ShopSceneV2],NOTIFY_MENU_YUNHEE_SELL_POPUP_HIEDE):GameDefault.getInstance().getParentSellPopup()==ParentSellPopup.TO_YUNHEE&&MainObserver.getInstance().postNotification(sceneStr[scene_YunheeScene],NOTIFY_MENU_YUNHEE_SELL_POPUP_HIEDE)}),bg.addChild(cancel_btn);var sell_btn=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);sell_btn.setFont(LABEL_FONT_INDEX.FONT_241),sell_btn.setString(res_str("btn_label_sell")),sell_btn.setAnchorPoint(ZERO()),sell_btn.setPosition(ccCenter(bg).x+10,16),sell_btn.addClickEventListener(function(sender){this.m_sell_type!=SELL_POPUP_TYPE.HEAVEN_PT_SELL||0!=this.m_select_gnrl_list.length?GameDefault.getInstance().getParentSellPopup()==ParentSellPopup.TO_SHOP?MainObserver.getInstance().postNotification(sceneStr[scene_ShopSceneV2],NOTIFY_MENU_YUNHEE_SELL_START):GameDefault.getInstance().getParentSellPopup()==ParentSellPopup.TO_YUNHEE&&MainObserver.getInstance().postNotification(sceneStr[scene_YunheeScene],NOTIFY_MENU_YUNHEE_SELL_START):GameDefault.getInstance().getParentSellPopup()==ParentSellPopup.TO_SHOP?MainObserver.getInstance().postNotification(sceneStr[scene_ShopSceneV2],NOTIFY_YUNHHE_SELL_NOT_SELECT):GameDefault.getInstance().getParentSellPopup()==ParentSellPopup.TO_YUNHEE&&MainObserver.getInstance().postNotification(sceneStr[scene_YunheeScene],NOTIFY_YUNHHE_SELL_NOT_SELECT)}.bind(this)),bg.addChild(sell_btn),this.m_tableView=new cc.TableView(this,cc.size(910,304)),this.m_tableView.ignoreAnchorPointForPosition(!1),this.m_tableView.setAnchorPoint(ANCHOR_MIDDLE()),this.m_tableView.setPosition(ccCenter(info_box)),this.m_tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_tableView.scrollBarEnable(!0),this.m_tableView.setDelegate(this),this.m_tableView.scrollBarEnable(!0),info_box.addChild(this.m_tableView);var mt=MasterManager.getInstance(),index=0;this.m_info_label_1=new cmMultiLabel;var map_rare_type_count_key,tab_type;if(map_rare_type_count_key=this.m_map_rare_type_count.keys(),(tab_type=GameContext.getInstance().getYunheeTabType())==YunheeLevelUpTapTypeEnum.tab_type_material)for(var idx=0;idx<map_rare_type_count_key.length;idx++){var temp_gnrl_type=(temp_key=map_rare_type_count_key[idx]).substring(0,1),temp_rare_type=temp_key.substring(2,3),rare_type=mt.get_RareType(temp_rare_type),gnrl_type=mt.get_GeneralType(temp_gnrl_type);if(null==rare_type)break;var r=this.m_map_rare_type_count[map_rare_type_count_key[idx]];0<index&&this.m_info_label_1.addLabel(", ",LABEL_FONT_INDEX.FONT_181);var rare_type_name="";gnrl_type.gnrl_type==GENERAL_TYPE_MATERIAL?(this.m_info_label_1.addLabel("レアリティ",LABEL_FONT_INDEX.FONT_181),1==rare_type.rare_type?(rare_type_name=res_str("label_material_type_1"),this.m_info_label_1.addLabel(rare_type_name+" "+r,LABEL_FONT_INDEX.FONT_1810)):2==rare_type.rare_type?(rare_type_name=res_str("label_material_type_2"),this.m_info_label_1.addLabel(rare_type_name+" "+r,LABEL_FONT_INDEX.FONT_1810)):3==rare_type.rare_type?(rare_type_name=res_str("label_material_type_3"),this.m_info_label_1.addLabel(rare_type_name+" "+r,LABEL_FONT_INDEX.FONT_1810)):6==rare_type.rare_type&&(rare_type_name=res_str("label_material_type_6"),this.m_info_label_1.addLabel(rare_type_name+" "+r,LABEL_FONT_INDEX.FONT_1810))):(this.m_info_label_1.addLabel("レアリティ",LABEL_FONT_INDEX.FONT_181),this.m_info_label_1.addLabel(rare_type.name+" "+r,LABEL_FONT_INDEX.FONT_1810)),idx==map_rare_type_count_key.length-1?this.m_info_label_1.addLabel("体"+res_str("label_yunhee_sell_rare_type_text_2"),LABEL_FONT_INDEX.FONT_181):this.m_info_label_1.addLabel("体",LABEL_FONT_INDEX.FONT_181),index++}else for(idx=0;idx<map_rare_type_count_key.length;idx++){var temp_key;temp_rare_type=(temp_key=map_rare_type_count_key[idx]).substring(2,3);if(null==(rare_type=mt.get_RareType(temp_rare_type)))break;0<index&&this.m_info_label_1.addLabel(", ",LABEL_FONT_INDEX.FONT_181);r=this.m_map_rare_type_count[map_rare_type_count_key[idx]];this.m_info_label_1.addLabel("レアリティ",LABEL_FONT_INDEX.FONT_181),this.m_info_label_1.addLabel(rare_type.name+" "+r,LABEL_FONT_INDEX.FONT_1810),idx==map_rare_type_count_key.length-1?this.m_info_label_1.addLabel("体"+res_str("label_yunhee_sell_rare_type_text_2"),LABEL_FONT_INDEX.FONT_181):this.m_info_label_1.addLabel("体",LABEL_FONT_INDEX.FONT_181),index++}if(this.m_info_label_1.setLabel(),0<index){this.m_info_label_1.setPosition(ccCenter(bg).x/2+180-65*(index-1),144)}else this.m_info_label_1.setPosition(ccCenter(bg).x/2+180,144);if(bg.addChild(this.m_info_label_1),this.m_info_label_2=new cmMultiLabel,this.m_info_label_2.addLabel("金貨 "+Number(this.m_gold).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810),this.m_info_label_2.addLabel(", ",LABEL_FONT_INDEX.FONT_181),this.m_info_label_2.addLabel("恋姫PT "+Number(this.m_yunhee_pt).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810),this.m_info_label_2.addLabel(", ",LABEL_FONT_INDEX.FONT_181),this.m_info_label_2.addLabel("天翔PT "+Number(this.m_heaven_pt).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810),this.m_info_label_2.addLabel(" で売却しますか。",LABEL_FONT_INDEX.FONT_181),this.m_info_label_2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_info_label_2.setLabel(),this.m_info_label_2.setPosition(ccCenter(bg).x/2+80,120),bg.addChild(this.m_info_label_2),this.m_is_SR_over){var label_3=cmLabel.getLabel("警告 : SR以上の恋姫が含まれています。恋姫は編成、陣営、強化、進化、限界突破に使われます",LABEL_FONT_INDEX.FONT_1613);label_3.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),label_3.setPosition(ccCenter(bg).x,86),bg.addChild(label_3)}},numberOfCellsInTableView:function(table){var cnt=Math.floor(this.m_gnrl_list.size()/SELL_COLUMN_COUNT);return 0<Math.floor(this.m_gnrl_list.size()%SELL_COLUMN_COUNT)&&(cnt+=1),cnt},tableCellSizeForIndex:function(){return cc.size(456,108)},tableCellUnhighlight:function(){},tableCellHighlight:function(){},tableCellEnded:function(){},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;cell=null!=c?c:new YunheeSellPopupCell(this.selectGeneral.bind(this));var desc=[],start=idx*SELL_COLUMN_COUNT,end=start+SELL_COLUMN_COUNT;if(end<this.m_gnrl_list.length)for(idx=start;idx<end;idx++)desc.push(this.m_gnrl_list[idx]);else for(idx=start;idx<this.m_gnrl_list.length;idx++)desc.push(this.m_gnrl_list[idx]);return cell.setGnrlDatas(desc),cell},tableCellTouched:function(table,cell){null!=cell&&cell.touchPosCell(cell.getTouchPos())},selectGeneral:function(info){if(this.m_sell_type!=SELL_POPUP_TYPE.NORMAL_SELL&&!(info.using_in_troops||info.using_in_great_wall_troops||info.using_in_search_troops||info.using_in_camp||info.is_lock||info.is_equipping||info.is_friend_partner||info.isPartner||info.using_in_world_war_troops)){this.m_gold=0,this.m_yunhee_pt=0,this.m_heaven_pt=0,this.m_info_label_1.removeFromParent(),this.m_info_label_2.removeFromParent(),this.m_map_rare_type_count.clear(),this.m_select_gnrl_list.clear();for(var idx=0;idx<this.m_gnrl_list.length;idx++){var g=this.m_gnrl_list[idx];if(g.gnrl_id==info.gnrl_id&&g.gnrl_num==info.gnrl_num&&(g.is_sell_selected?g.is_sell_selected=!1:g.is_sell_selected=!0),this.m_is_SR_over=!1,this.m_sell_type==SELL_POPUP_TYPE.HEAVEN_PT_SELL&&g.is_sell_selected){this.m_gold+=g.sell_gold,this.m_yunhee_pt+=g.sell_yhpt,this.m_heaven_pt+=g.sell_heaven_pt;var sell_key={};sell_key.gnrl_type=g.gnrl_type,sell_key.rare_type=g.rare_type;var temp_sell_key=[];temp_sell_key[0]=[sell_key.gnrl_type,sell_key.rare_type],0!=this.m_map_rare_type_count.find(temp_sell_key[0])?this.m_map_rare_type_count[temp_sell_key[0]]+=1:this.m_map_rare_type_count.insert(temp_sell_key[0],1),GameContext.getInstance().getYunheeTabType()==YunheeLevelUpTapTypeEnum.tab_type_yunhee&&info.rare_type>=RARE_TYPE_SR&&(this.m_is_SR_over=!0)}if(g.is_sell_selected){var key={};key.gnrl_id=g.gnrl_id,key.gnrl_num=g.gnrl_num,this.m_select_gnrl_list.push_back(key)}}var mt=MasterManager.getInstance(),index=0;this.m_info_label_1=new cmMultiLabel;var map_rare_type_count_key;if(map_rare_type_count_key=this.m_map_rare_type_count.keys(),GameContext.getInstance().getYunheeTabType()==YunheeLevelUpTapTypeEnum.tab_type_material)for(idx=0;idx<map_rare_type_count_key.length;idx++){var temp_gnrl_type=(temp_key=map_rare_type_count_key[idx]).substring(0,1),temp_rare_type=temp_key.substring(2,3),rare_type=mt.get_RareType(temp_rare_type),gnrl_type=mt.get_GeneralType(temp_gnrl_type);if(null==rare_type)break;var r=this.m_map_rare_type_count[map_rare_type_count_key[idx]];0<index&&this.m_info_label_1.addLabel(", ",LABEL_FONT_INDEX.FONT_181);var rare_type_name="";gnrl_type.gnrl_type==GENERAL_TYPE_MATERIAL?(this.m_info_label_1.addLabel("レアリティ",LABEL_FONT_INDEX.FONT_181),1==rare_type.rare_type?(rare_type_name=res_str("label_material_type_1"),this.m_info_label_1.addLabel(rare_type_name+" "+r,LABEL_FONT_INDEX.FONT_1810)):2==rare_type.rare_type?(rare_type_name=res_str("label_material_type_2"),this.m_info_label_1.addLabel(rare_type_name+" "+r,LABEL_FONT_INDEX.FONT_1810)):3==rare_type.rare_type?(rare_type_name=res_str("label_material_type_3"),this.m_info_label_1.addLabel(rare_type_name+" "+r,LABEL_FONT_INDEX.FONT_1810)):6==rare_type.rare_type&&(rare_type_name=res_str("label_material_type_6"),this.m_info_label_1.addLabel(rare_type_name+" "+r,LABEL_FONT_INDEX.FONT_1810))):(this.m_info_label_1.addLabel("レアリティ",LABEL_FONT_INDEX.FONT_181),this.m_info_label_1.addLabel(rare_type.name+" "+r,LABEL_FONT_INDEX.FONT_1810)),idx==map_rare_type_count_key.length-1?this.m_info_label_1.addLabel("体"+res_str("label_yunhee_sell_rare_type_text_2"),LABEL_FONT_INDEX.FONT_181):this.m_info_label_1.addLabel("体",LABEL_FONT_INDEX.FONT_181),index++}else for(idx=0;idx<map_rare_type_count_key.length;idx++){var temp_key;temp_rare_type=(temp_key=map_rare_type_count_key[idx]).substring(2,3);if(null==(rare_type=mt.get_RareType(temp_rare_type)))break;0<index&&this.m_info_label_1.addLabel(", ",LABEL_FONT_INDEX.FONT_181);r=this.m_map_rare_type_count[map_rare_type_count_key[idx]];this.m_info_label_1.addLabel("レアリティ",LABEL_FONT_INDEX.FONT_181),this.m_info_label_1.addLabel(rare_type.name+" "+r,LABEL_FONT_INDEX.FONT_1810),idx==map_rare_type_count_key.length-1?this.m_info_label_1.addLabel("体"+res_str("label_yunhee_sell_rare_type_text_2"),LABEL_FONT_INDEX.FONT_181):this.m_info_label_1.addLabel("体",LABEL_FONT_INDEX.FONT_181),index++}if(this.m_info_label_1.setLabel(),0<index){this.m_info_label_1.setPosition(ccCenter(this).x/2+180-65*(index-1),144)}else this.m_info_label_1.setPosition(ccCenter(this).x/2+180,144);this.addChild(this.m_info_label_1),this.m_info_label_2=new cmMultiLabel,this.m_info_label_2.addLabel("金貨 "+Number(this.m_gold).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810),this.m_info_label_2.addLabel(", ",LABEL_FONT_INDEX.FONT_181),this.m_info_label_2.addLabel("恋姫PT "+Number(this.m_yunhee_pt).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810),this.m_info_label_2.addLabel(", ",LABEL_FONT_INDEX.FONT_181),this.m_info_label_2.addLabel("天翔PT "+Number(this.m_heaven_pt).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810),this.m_info_label_2.addLabel(" で売却しますか。",LABEL_FONT_INDEX.FONT_181),this.m_info_label_2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_info_label_2.setLabel(),this.m_info_label_2.setPosition(ccCenter(this).x/2+80,120),this.addChild(this.m_info_label_2);var offset=this.m_tableView.getContentOffset();this.m_tableView.reloadData(),this.m_tableView.setContentOffset(offset)}},getSellGeneralKeys:function(){return this.m_select_gnrl_list},getSellGeneralGoods:function(gold,yhpt,hvpt){this.m_gold,this.m_yunhee_pt,this.m_heaven_pt}}),invoker_evolution=1,invoker_rebirth=2,EvolutionEffectLayer=cmModalLayer.extend({m_isMoph:!1,m_gnrlSkeleton:null,m_gnrlBody:null,m_whiteLayer:null,m_end_btn:null,m_motion:null,m_skeletonLevelupEffectNode:null,m_img_scale:1,m_touch_Layer:null,m_invoker:0,ctor:function(){this._super(),this.m_isMoph=!1,this.m_gnrlSkeleton=null,this.m_gnrlBody=null,this.m_whiteLayer=null,this.m_end_btn=null,this.m_motion=null,this.m_skeletonLevelupEffectNode=null,this.m_gnrl_info={},this.m_gnrl_key={}},initLayout:function(){var bg_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());bg_mask.setPosition(ccCenter(this)),bg_mask.setContentSize(ccSize(this)),this.addChild(bg_mask);var spineBackground=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Fade.json",RES_CDN_DEFULT+"effect/Fade.atlas",1);spineBackground.setPosition(ccCenter(this)),spineBackground.setAnimation(0,"fx_1",!1),this.addChild(spineBackground),this.m_skeletonLevelupEffectNode=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Enchant.json",RES_CDN_DEFULT+"effect/Enchant.atlas",.33),this.m_skeletonLevelupEffectNode.setPosition(ccCenter(this)),this.m_skeletonLevelupEffectNode.setAnimation(0,"fx_1",!1),this.addChild(this.m_skeletonLevelupEffectNode);var audio=AudioEngine.getInstance();audio.stopBackgroundMusic();var snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_growth_2.mp3";audio.playEffect(snd);var path=RES_CDN_SOUND+SND_TYPE+"sound/BGM_gacha_back.mp3";audio.playBackgroundMusic(path,!0);var callback=new cc.CallFunc(this.setBackground,this);this.runAction(new cc.Sequence(new cc.DelayTime(1.8),callback))},setGeneralKey:function(gnrl_key,invoker){invoker=null==invoker?invoker_evolution:invoker,this.m_gnrl_key=gnrl_key,this.m_invoker=invoker},setBackground:function(){var bg=cc.Sprite.create(RES_CDN_DEFULT+"gacha_effect/gacha_bg_ready.png");bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(this)),USE_SP_YUNHEE_SCALE&&bg.setScale(2),this.addChild(bg),this.m_touch_Layer=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE}),this.m_touch_Layer.onTouchBegan=function(touch,event){event.stopPropagation()}.bind(this);var mouse_listener=cc.EventListener.create({event:cc.EventListener.MOUSE,onMouseScroll:function(event){event.stopPropagation()}.bind(this)});cc.eventManager.addListener(mouse_listener,bg),cc.eventManager.addListener(this.m_touch_Layer,bg);var right_top_bg=cc.Sprite.create("#frame_topR.png");right_top_bg.setAnchorPoint(ANCHOR_TOP_RIGHT()),right_top_bg.setPosition(ccWidth(this),ccHeight(this)),USE_SP_YUNHEE_SCALE&&right_top_bg.setScale(2),this.addChild(right_top_bg,100);var left_bottom_bg=cc.Sprite.create("#frame_bottomL.png");left_bottom_bg.setAnchorPoint(ZERO()),left_bottom_bg.setPosition(ZERO()),USE_SP_YUNHEE_SCALE&&left_bottom_bg.setScale(2),this.addChild(left_bottom_bg,100),this.m_whiteLayer=new cc.LayerColor(cc.color(255,255,255,255)),this.addChild(this.m_whiteLayer,1e3),this.m_end_btn=new ccui.Button,this.m_end_btn.loadTextures("btn_purple_circle_ok_off.png","btn_purple_circle_ok_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_end_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_end_btn.setPosition(ccWidth(this)-10,10),this.m_end_btn.addTouchEventListener(function(sender){AudioEngine.getInstance().playNormaButtonSound(),MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeEvolutionEnum.btn_evolve_result_hide)},this),this.addChild(this.m_end_btn,100),this.m_end_btn.setVisible(!1),GeneralService.getInstance().getUserGeneralInfo(this.m_gnrl_key,this.m_gnrl_info);var mt=MasterManager.getInstance(),gnrl_key=new net.User_General_Key;gnrl_key.gnrl_id=this.m_gnrl_info.gnrl_id,gnrl_key.gnrl_num=this.m_gnrl_info.gnrl_num;var standing_gnrl=new db.UserGeneralInfo;GeneralService.getInstance().getUserGnrlDisplayClassInfo(gnrl_key,standing_gnrl);var standing_id=0;standing_id=standing_gnrl.class_type>=AVAIL_EVOLUTION_CLASS_TYPE_LIMIT&&0!=standing_gnrl.display_class&&standing_gnrl.class_type!=standing_gnrl.display_class?standing_gnrl.gnrl_id-1e3*(standing_gnrl.class_type-standing_gnrl.display_class):standing_gnrl.gnrl_id;var pos=mt.get_BodyPosition(standing_id),morph=MasterTable.getInstance().get_MorphData(standing_id);if(this.m_isMoph="y"==morph.is_morph,this.m_isMoph){var gnrl=MasterManager.getInstance().get_General(morph.gnrl_id);if(USE_PARTNER_GNRL_LOADING){var gnrl_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".json",gnrl_atals=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".atlas";this.m_gnrlSkeleton=new sp.SkeletonAnimation(gnrl_json,gnrl_atals),this.m_gnrlSkeleton.setScale(.1),this.m_gnrlSkeleton.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_gnrlSkeleton.setPosition(ccWidth(this)-1458+pos.posx,-726+pos.posy),this.addChild(this.m_gnrlSkeleton),this.m_gnrlSkeleton.setMix("basic","active",.1),this.m_gnrlSkeleton.setMix("active","basic",.1),MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],show_evolve_effect);var callback=new cc.CallFunc(this.startFlash,this);this.runAction(new cc.Sequence(new cc.DelayTime(1),callback))}else{var gnrl_img=[],stading_files=StandingMultiplePngList[morph.gnrl_id];if(null==stading_files)gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".png");else for(var idx=0;idx<stading_files.length;idx++)gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+stading_files[idx]+".png");gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".atlas"),gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".json"),resourceLoader(gnrl_img,function(){var gnrl_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".json",gnrl_atals=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".atlas";this.m_gnrlSkeleton=new sp.SkeletonAnimation(gnrl_json,gnrl_atals),this.m_gnrlSkeleton.setScale(.1),this.m_gnrlSkeleton.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_gnrlSkeleton.setPosition(ccWidth(this)-1458+pos.posx,-726+pos.posy),this.addChild(this.m_gnrlSkeleton),this.m_gnrlSkeleton.setMix("basic","active",.1),this.m_gnrlSkeleton.setMix("active","basic",.1),MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],show_evolve_effect);var callback=new cc.CallFunc(this.startFlash,this);this.runAction(new cc.Sequence(new cc.DelayTime(1),callback))}.bind(this))}}else{this.m_gnrlBody=cc.Sprite.create();var general=mt.get_General(this.m_gnrl_key.gnrl_id);if(USE_PARTNER_GNRL_LOADING){if(general.gnrl_type==GENERAL_TYPE_YUNHEE){if(mt.get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id),this.m_gnrlBody.setTexture(img_str)}else{img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id),this.m_gnrlBody.setTexture(img_str)}}else{img_str=getCardBody_ImageStr(this.m_gnrl_key.gnrl_id);this.m_img_scale=getCardBody_Scale(this.m_gnrl_key.gnrl_id),this.m_gnrlBody.setTexture(img_str)}this.m_gnrlBody.setAnchorPoint(ANCHOR_MIDDLE()),this.m_gnrlBody.setScale(this.m_img_scale),this.m_gnrlBody.setPosition(ccWidth(this)-1458+pos.posx+ccWidth(this.m_gnrlBody)*this.m_img_scale/2,-726+pos.posy+ccHeight(this.m_gnrlBody)*this.m_img_scale/2),this.addChild(this.m_gnrlBody),MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],show_evolve_effect);callback=new cc.CallFunc(this.startFlash,this);this.runAction(new cc.Sequence(new cc.DelayTime(1),callback))}else{var card_img="";if(general.gnrl_type==GENERAL_TYPE_YUNHEE)card_img=(mt.get_GeneralDivision(general.gnrl_group).general_gender_type,GENDER_TYPE_M,getCardBody_ImageStr(general.gnrl_id));else card_img=getCardBody_ImageStr(this.m_gnrl_key.gnrl_id);resourceLoader(card_img,function(){if(general.gnrl_type==GENERAL_TYPE_YUNHEE){if(mt.get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id),this.m_gnrlBody.setTexture(img_str)}else{img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id),this.m_gnrlBody.setTexture(img_str)}}else{img_str=getCardBody_ImageStr(this.m_gnrl_key.gnrl_id);this.m_img_scale=getCardBody_Scale(this.m_gnrl_key.gnrl_id),this.m_gnrlBody.setTexture(img_str)}this.m_gnrlBody.setAnchorPoint(ANCHOR_MIDDLE()),this.m_gnrlBody.setScale(this.m_img_scale),this.m_gnrlBody.setPosition(ccWidth(this)-1458+pos.posx+ccWidth(this.m_gnrlBody)*this.m_img_scale/2,-726+pos.posy+ccHeight(this.m_gnrlBody)*this.m_img_scale/2),this.addChild(this.m_gnrlBody),MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],show_evolve_effect);var callback=new cc.CallFunc(this.startFlash,this);this.runAction(new cc.Sequence(new cc.DelayTime(1),callback))}.bind(this))}}var left_top_bg=cc.Sprite.create("#frame_topL.png");left_top_bg.setAnchorPoint(ZERO()),USE_SP_YUNHEE_SCALE?(left_top_bg.setPosition(0,ccHeight(this)-2*ccHeight(left_top_bg)),left_top_bg.setScale(2)):left_top_bg.setPosition(0,ccHeight(this)-ccHeight(left_top_bg)),this.addChild(left_top_bg,1);var right_bottom_bg=cc.Sprite.create("#frame_bottomR.png");right_bottom_bg.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),right_bottom_bg.setPosition(ccWidth(this),0),USE_SP_YUNHEE_SCALE&&right_bottom_bg.setScale(2),this.addChild(right_bottom_bg,1);var rare_type_sprite=cc.Sprite.create();if(rare_type_sprite.setAnchorPoint(ANCHOR_TOP_LEFT()),rare_type_sprite.setPosition(0,ccHeight(this)),this.addChild(rare_type_sprite,2),NOT_USE_SP_MAIN_ANIMATION){rare_type_sprite.setScale(2);star_url="";this.m_gnrl_info.rare_type==RARE_TYPE_N?(rare_type_sprite.setTexture(RES_CDN_DEFULT+"gacha_effect/gacha_effect_sprite/rare_type_01_loop_08.png"),star_url=RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_n_06.png"):this.m_gnrl_info.rare_type==RARE_TYPE_HN?(rare_type_sprite.setTexture(RES_CDN_DEFULT+"gacha_effect/gacha_effect_sprite/rare_type_02_loop_08.png"),star_url=RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_n_06.png"):this.m_gnrl_info.rare_type==RARE_TYPE_R?(rare_type_sprite.setTexture(RES_CDN_DEFULT+"gacha_effect/gacha_effect_sprite/rare_type_03_loop_08.png"),star_url=RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_n_06.png"):this.m_gnrl_info.rare_type==RARE_TYPE_HR?(rare_type_sprite.setTexture(RES_CDN_DEFULT+"gacha_effect/gacha_effect_sprite/rare_type_04_loop_08.png"),star_url=RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_hr_06.png"):this.m_gnrl_info.rare_type==RARE_TYPE_SR?(rare_type_sprite.setTexture(RES_CDN_DEFULT+"gacha_effect/gacha_effect_sprite/rare_type_05_loop_08.png"),star_url=RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_sr_06.png"):this.m_gnrl_info.rare_type==RARE_TYPE_SSR&&(rare_type_sprite.setTexture(RES_CDN_DEFULT+"gacha_effect/gacha_effect_sprite/rare_type_06_loop_08.png"),star_url=RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_ssr_06.png")}else{var animate=null,star_url="";this.m_gnrl_info.rare_type==RARE_TYPE_N?(animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.GachaAniRareType_01),star_url="#effect_star_n_06.png"):this.m_gnrl_info.rare_type==RARE_TYPE_HN?(animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.GachaAniRareType_02),star_url="#effect_star_n_06.png"):this.m_gnrl_info.rare_type==RARE_TYPE_R?(animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.GachaAniRareType_03),star_url="#effect_star_n_06.png"):this.m_gnrl_info.rare_type==RARE_TYPE_HR?(animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.GachaAniRareType_04),star_url="#effect_star_hr_06.png"):this.m_gnrl_info.rare_type==RARE_TYPE_SR?(animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.GachaAniRareType_05),star_url="#effect_star_sr_06.png"):this.m_gnrl_info.rare_type==RARE_TYPE_SSR&&(animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.GachaAniRareType_06),star_url="#effect_star_ssr_06.png");var repeat=new cc.RepeatForever(animate);rare_type_sprite.runAction(repeat)}if(3==this.m_gnrl_info.class_type){var class_type_star=cc.Sprite.create(star_url);class_type_star.setAnchorPoint(ZERO()),class_type_star.setPosition(-18,545),NOT_USE_SP_MAIN_ANIMATION&&class_type_star.setScale(2),this.addChild(class_type_star,2)}else if(4==this.m_gnrl_info.class_type){var class_type_star_1=cc.Sprite.create(),class_type_star_2=cc.Sprite.create();if(NOT_USE_SP_MAIN_ANIMATION)class_type_star_1.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_ssr_rebirth_06.png"),class_type_star_2.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_ssr_rebirth_06.png"),class_type_star_1.setScale(2),class_type_star_2.setScale(2);else{var rebirth_tex=cc.spriteFrameCache.getSpriteFrame("effect_star_ssr_rebirth_06.png");class_type_star_1.setSpriteFrame(rebirth_tex),class_type_star_2.setSpriteFrame(rebirth_tex)}class_type_star_1.setAnchorPoint(ZERO()),class_type_star_1.setPosition(-39,540),this.addChild(class_type_star_1,2),class_type_star_2.setAnchorPoint(ZERO()),class_type_star_2.setPosition(-2,552),this.addChild(class_type_star_2,2)}var name_label=cmLabel.createWithTTF(this.m_gnrl_info.name,FONT_NAME_RGKNOW,80);name_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),name_label.enableShadow(cc.color.BLACK,cc.p(5,-5)),name_label.setPosition(ccWidth(this)-20,125),this.addChild(name_label,2);var element_type_icon=cc.Sprite.create("#img_gacha_ic_"+this.m_gnrl_info.element_type+".png");element_type_icon.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),USE_SP_YUNHEE_SCALE&&element_type_icon.setScale(2),element_type_icon.setPosition(name_label.x-ccWidth(name_label)-10,name_label.y+10),this.addChild(element_type_icon,2)},startFlash:function(){var callback=new cc.CallFunc(this.endFlash,this);this.m_whiteLayer.runAction(new cc.Sequence(new cc.FadeOut(.2),callback))},endFlash:function(){if(this.m_isMoph)this.m_gnrlSkeleton.setAnimation(0,"active",!1),this.m_gnrlSkeleton.addAnimation(0,"basic",!0);else{var s1=new cc.ScaleTo(.1,this.m_img_scale+.03,this.m_img_scale-.03),s2=new cc.ScaleTo(.2,this.m_img_scale-.03,this.m_img_scale+.03),s3=new cc.ScaleTo(.15,this.m_img_scale+.02,this.m_img_scale-.02),s4=new cc.ScaleTo(.8,this.m_img_scale,this.m_img_scale),e4=new cc.EaseElasticOut(s4),callback=new cc.CallFunc(this.characterIdelAction,this),seq=new cc.Sequence(s1,s2,s3,e4,callback);this.m_gnrlBody.runAction(seq)}var img=cc.Sprite.create();img.setAnchorPoint(ANCHOR_MIDDLE_TOP()),img.setPosition(ccCenter(this).x,ccHeight(this)),this.addChild(img,100);var animate=null;if(this.m_invoker==invoker_evolution)if(NOT_USE_SP_MAIN_ANIMATION){img.setScale(2),img.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_evolve_12.png");var scaleTo_1=new cc.ScaleTo(.3,2,2.03),scaleTo_2=new cc.ScaleTo(.3,2,1.97),callback_seq=(callback=new cc.CallFunc(this.runClassTypeEffect,this),new cc.Spawn(new cc.DelayTime(.2),callback)),sequence=new cc.Sequence(scaleTo_1,scaleTo_2,scaleTo_1,scaleTo_2,callback_seq);img.runAction(sequence),callback=callback_seq=sequence=scaleTo_2=scaleTo_1=null}else{animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.EvolutionEffect);var callback=new cc.CallFunc(this.runClassTypeEffect,this);img.runAction(new cc.Sequence(animate,new cc.Spawn(new cc.DelayTime(.2),callback)))}else if(NOT_USE_SP_MAIN_ANIMATION){img.setScale(2),img.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_rebirth_12.png");scaleTo_1=new cc.ScaleTo(.3,2,2.03),scaleTo_2=new cc.ScaleTo(.3,2,1.97),callback=new cc.CallFunc(this.runClassTypeEffect,this),callback_seq=new cc.Spawn(new cc.DelayTime(.2),callback),sequence=new cc.Sequence(scaleTo_1,scaleTo_2,scaleTo_1,scaleTo_2,callback_seq);img.runAction(sequence),callback=callback_seq=sequence=scaleTo_2=scaleTo_1=null}else{animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.RebirthEffect);callback=new cc.CallFunc(this.runClassTypeEffect,this);img.runAction(new cc.Sequence(animate,new cc.Spawn(new cc.DelayTime(.2),callback)))}var audio=AudioEngine.getInstance(),snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_firework_2.mp3";audio.playEffect(snd),this.setVoiceSound()},setVoiceSound:function(){var audio=AudioEngine.getInstance(),voice_list=MasterTable.getInstance().get_Voice(this.m_gnrl_info.gnrl_id,voice_evolution,0),voice=voice_list.voice;voice_list.duration,""!=voice&&null!=voice&&audio.playVoice(RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3",!1)},runClassTypeEffect:function(){var img=cc.Sprite.create();img.setAnchorPoint(ANCHOR_TOP_LEFT()),this.addChild(img,2);var animate=null;NOT_USE_SP_MAIN_ANIMATION?this.m_invoker==invoker_evolution?(img.setScale(2),this.m_gnrl_info.rare_type==RARE_TYPE_N||this.m_gnrl_info.rare_type==RARE_TYPE_HN||this.m_gnrl_info.rare_type==RARE_TYPE_R?img.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_n_06.png"):this.m_gnrl_info.rare_type==RARE_TYPE_HR?img.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_hr_06.png"):this.m_gnrl_info.rare_type==RARE_TYPE_SR?img.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_sr_06.png"):this.m_gnrl_info.rare_type==RARE_TYPE_SSR&&img.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_ssr_06.png")):(img.setScale(2),img.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_ssr_rebirth_06.png")):this.m_invoker==invoker_evolution?this.m_gnrl_info.rare_type==RARE_TYPE_N||this.m_gnrl_info.rare_type==RARE_TYPE_HN||this.m_gnrl_info.rare_type==RARE_TYPE_R?animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.EvolutionClassType_N):this.m_gnrl_info.rare_type==RARE_TYPE_HR?animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.EvolutionClassType_HR):this.m_gnrl_info.rare_type==RARE_TYPE_SR?animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.EvolutionClassType_SR):this.m_gnrl_info.rare_type==RARE_TYPE_SSR&&(animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.EvolutionClassType_SSR)):animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.RebirthClassType_SSR),2==this.m_gnrl_info.class_type?img.setPosition(0,ccHeight(this)):3==this.m_gnrl_info.class_type?img.setPosition(19,ccHeight(this)):4==this.m_gnrl_info.class_type&&img.setPosition(33,ccHeight(this)+7),NOT_USE_SP_MAIN_ANIMATION||img.runAction(animate),this.scheduleOnce(function(){this.m_end_btn.setVisible(!0)},.5,"m_end_btn")}}),LimitOverEffectLayer=cmModalLayer.extend({m_isMoph:!1,m_gnrlSkeleton:null,m_gnrlBody:null,m_whiteLayer:null,m_end_btn:null,m_motion:null,m_skeletonLevelupEffectNode:null,m_img_scale:1,ctor:function(){this._super(),this.m_isMoph=!1,this.m_gnrlSkeleton=null,this.m_gnrlBody=null,this.m_whiteLayer=null,this.m_end_btn=null,this.m_motion=null,this.m_skeletonLevelupEffectNode=null,this.m_gnrl_info={},this.m_gnrl_key={}},initLayout:function(){var bg_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());bg_mask.setPosition(ccCenter(this)),bg_mask.setContentSize(ccSize(this)),this.addChild(bg_mask);var spineBackground=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Fade.json",RES_CDN_DEFULT+"effect/Fade.atlas",1);spineBackground.setPosition(ccCenter(this)),spineBackground.setAnimation(0,"fx_1",!1),this.addChild(spineBackground),this.m_skeletonLevelupEffectNode=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Enchant.json",RES_CDN_DEFULT+"effect/Enchant.atlas",.33),this.m_skeletonLevelupEffectNode.setPosition(ccCenter(this).x-239,ccCenter(this).y),this.m_skeletonLevelupEffectNode.setAnimation(0,"fx_1",!1),this.addChild(this.m_skeletonLevelupEffectNode);var audio=AudioEngine.getInstance();audio.stopBackgroundMusic();var snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_growth_2.mp3";audio.playEffect(snd);var callback=new cc.CallFunc(this.setBackground,this);this.runAction(new cc.Sequence(new cc.DelayTime(1.8),callback));var path=RES_CDN_SOUND+SND_TYPE+"sound/BGM_gacha_back.mp3";audio.playBackgroundMusic(path,!0)},setGeneralKey:function(gnrl_key){this.m_gnrl_key=gnrl_key},setBackground:function(){var bg=cc.Sprite.create(RES_CDN_DEFULT+"gacha_effect/gacha_bg_ready.png");bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(this)),USE_SP_YUNHEE_SCALE&&bg.setScale(2),this.addChild(bg),this.m_touch_Layer=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE}),this.m_touch_Layer.onTouchBegan=function(touch,event){event.stopPropagation()}.bind(this);var mouse_listener=cc.EventListener.create({event:cc.EventListener.MOUSE,onMouseScroll:function(event){event.stopPropagation()}.bind(this)});cc.eventManager.addListener(mouse_listener,bg),cc.eventManager.addListener(this.m_touch_Layer,bg);var right_top_bg=cc.Sprite.create("#frame_topR.png");right_top_bg.setAnchorPoint(ANCHOR_TOP_RIGHT()),right_top_bg.setPosition(ccWidth(this),ccHeight(this)),USE_SP_YUNHEE_SCALE&&right_top_bg.setScale(2),this.addChild(right_top_bg,100);var left_bottom_bg=cc.Sprite.create("#frame_bottomL.png");left_bottom_bg.setAnchorPoint(ZERO()),left_bottom_bg.setPosition(ZERO()),USE_SP_YUNHEE_SCALE&&left_bottom_bg.setScale(2),this.addChild(left_bottom_bg,100),this.m_whiteLayer=new cc.LayerColor(cc.color(255,255,255,255)),this.addChild(this.m_whiteLayer,1e3),this.m_end_btn=new ccui.Button,this.m_end_btn.loadTextures("btn_purple_circle_ok_off.png","btn_purple_circle_ok_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_end_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_end_btn.setPosition(ccWidth(this)-10,10),this.m_end_btn.addTouchEventListener(function(sender){AudioEngine.getInstance().playNormaButtonSound(),MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],YunheeEvolutionEnum.btn_limit_over_hide)},this),this.addChild(this.m_end_btn,100),this.m_end_btn.setVisible(!1),GeneralService.getInstance().getUserGeneralInfo(this.m_gnrl_key,this.m_gnrl_info);var standing_id,standing_gnrl=new db.UserGeneralInfo,gnrl_key=new net.User_General_Key;gnrl_key.gnrl_id=this.m_gnrl_key.gnrl_id,gnrl_key.gnrl_num=this.m_gnrl_key.gnrl_num,GeneralService.getInstance().getUserGnrlDisplayClassInfo(gnrl_key,standing_gnrl),standing_id=standing_gnrl.class_type>=AVAIL_EVOLUTION_CLASS_TYPE_LIMIT&&0!=standing_gnrl.display_class&&standing_gnrl.class_type!=standing_gnrl.display_class?standing_gnrl.gnrl_id-1e3*(standing_gnrl.class_type-standing_gnrl.display_class):standing_gnrl.gnrl_id;var mt=MasterManager.getInstance(),pos=mt.get_BodyPosition(standing_id),morph=MasterTable.getInstance().get_MorphData(standing_id);if(this.m_isMoph="y"==morph.is_morph,this.m_isMoph){var gnrl=MasterManager.getInstance().get_General(morph.gnrl_id);if(this.m_gnrl_img=[],USE_PARTNER_GNRL_LOADING){if(SAVE_NOW_PARTNER_GNRL.gnrl_id!=morph.gnrl_id){var gnrl_img=[];if(null==(stading_files=StandingMultiplePngList[morph.gnrl_id]))gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".png");else for(var idx=0;idx<stading_files.length;idx++)gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+stading_files[idx]+".png");gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".atlas"),gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".json")}}else{var stading_files;gnrl_img=[];if(null==(stading_files=StandingMultiplePngList[morph.gnrl_id]))gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".png");else for(idx=0;idx<stading_files.length;idx++)gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+stading_files[idx]+".png");gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".atlas"),gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".json")}resourceLoader(gnrl_img,function(){var gnrl=mt.get_General(morph.gnrl_id),gnrl_atlas=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".atlas",gnrl_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".json";this.m_gnrlSkeleton=new sp.SkeletonAnimation(gnrl_json,gnrl_atlas),this.m_gnrlSkeleton.setScale(.1),this.m_gnrlSkeleton.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_gnrlSkeleton.setPosition(ccWidth(this)-1458+pos.posx,-726+pos.posy),this.addChild(this.m_gnrlSkeleton),this.m_gnrlSkeleton.setMix("basic","active",.1),this.m_gnrlSkeleton.setMix("active","basic",.1),MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],show_limitover_effect);var callback=new cc.CallFunc(this.startFlash,this);this.runAction(new cc.Sequence(new cc.DelayTime(1),callback))}.bind(this))}else{this.m_gnrlBody=cc.Sprite.create();var general=mt.get_General(this.m_gnrl_key.gnrl_id),card_img="";if(USE_PARTNER_GNRL_LOADING){if(USE_PARTNER_GNRL_LOADING)if(general.gnrl_type==GENERAL_TYPE_YUNHEE)card_img=(mt.get_GeneralDivision(general.gnrl_group).general_gender_type,GENDER_TYPE_M,getCardBody_ImageStr(general.gnrl_id));else card_img=getCardBody_ImageStr(this.m_gnrl_key.gnrl_id)}else if(general.gnrl_type==GENERAL_TYPE_YUNHEE)card_img=(mt.get_GeneralDivision(general.gnrl_group).general_gender_type,GENDER_TYPE_M,getCardBody_ImageStr(general.gnrl_id));else card_img=getCardBody_ImageStr(this.m_gnrl_key.gnrl_id);resourceLoader(card_img,function(){if(general.gnrl_type==GENERAL_TYPE_YUNHEE){if(mt.get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id),this.m_gnrlBody.setTexture(img_str)}else{img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id),this.m_gnrlBody.setTexture(img_str)}}else{img_str=getCardBody_ImageStr(this.m_gnrl_key.gnrl_id);this.m_img_scale=getCardBody_Scale(this.m_gnrl_key.gnrl_id),this.m_gnrlBody.setTexture(img_str)}this.m_gnrlBody.setAnchorPoint(ANCHOR_MIDDLE()),this.m_gnrlBody.setScale(this.m_img_scale),this.m_gnrlBody.setPosition(ccWidth(this)-1458+pos.posx+ccWidth(this.m_gnrlBody)*this.m_img_scale/2,-726+pos.posy+ccHeight(this.m_gnrlBody)*this.m_img_scale/2),this.addChild(this.m_gnrlBody),MainObserver.getInstance().postNotification(sceneStr[scene_YunheeDetailScene],show_limitover_effect);var callback=new cc.CallFunc(this.startFlash,this);this.runAction(new cc.Sequence(new cc.DelayTime(1),callback))}.bind(this))}var left_top_bg=cc.Sprite.create("#frame_topL.png");left_top_bg.setAnchorPoint(ZERO()),USE_SP_YUNHEE_SCALE?(left_top_bg.setPosition(0,ccHeight(this)-2*ccHeight(left_top_bg)),left_top_bg.setScale(2)):left_top_bg.setPosition(0,ccHeight(this)-ccHeight(left_top_bg)),this.addChild(left_top_bg,1);var right_bottom_bg=cc.Sprite.create("#frame_bottomR.png");right_bottom_bg.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),right_bottom_bg.setPosition(ccWidth(this),0),USE_SP_YUNHEE_SCALE&&right_bottom_bg.setScale(2),this.addChild(right_bottom_bg,1);var rare_type_sprite=cc.Sprite.create();if(rare_type_sprite.setAnchorPoint(ANCHOR_TOP_LEFT()),rare_type_sprite.setPosition(0,ccHeight(this)),this.addChild(rare_type_sprite,2),NOT_USE_SP_MAIN_ANIMATION){rare_type_sprite.setScale(2);star_url="";this.m_gnrl_info.rare_type==RARE_TYPE_N?(rare_type_sprite.setTexture(RES_CDN_DEFULT+"gacha_effect/gacha_effect_sprite/rare_type_01_loop_08.png"),star_url=RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_n_06.png"):this.m_gnrl_info.rare_type==RARE_TYPE_HN?(rare_type_sprite.setTexture(RES_CDN_DEFULT+"gacha_effect/gacha_effect_sprite/rare_type_02_loop_08.png"),star_url=RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_n_06.png"):this.m_gnrl_info.rare_type==RARE_TYPE_R?(rare_type_sprite.setTexture(RES_CDN_DEFULT+"gacha_effect/gacha_effect_sprite/rare_type_03_loop_08.png"),star_url=RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_n_06.png"):this.m_gnrl_info.rare_type==RARE_TYPE_HR?(rare_type_sprite.setTexture(RES_CDN_DEFULT+"gacha_effect/gacha_effect_sprite/rare_type_04_loop_08.png"),star_url=RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_hr_06.png"):this.m_gnrl_info.rare_type==RARE_TYPE_SR?(rare_type_sprite.setTexture(RES_CDN_DEFULT+"gacha_effect/gacha_effect_sprite/rare_type_05_loop_08.png"),star_url=RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_sr_06.png"):this.m_gnrl_info.rare_type==RARE_TYPE_SSR&&(rare_type_sprite.setTexture(RES_CDN_DEFULT+"gacha_effect/gacha_effect_sprite/rare_type_06_loop_08.png"),star_url=RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_ssr_06.png")}else{var animate=null,star_url="";1==this.m_gnrl_info.rare_type?(animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.GachaAniRareType_01),star_url="#effect_star_n_06.png"):2==this.m_gnrl_info.rare_type?(animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.GachaAniRareType_02),star_url="#effect_star_n_06.png"):3==this.m_gnrl_info.rare_type?(animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.GachaAniRareType_03),star_url="#effect_star_n_06.png"):4==this.m_gnrl_info.rare_type?(animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.GachaAniRareType_04),star_url="#effect_star_hr_06.png"):5==this.m_gnrl_info.rare_type?(animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.GachaAniRareType_05),star_url="#effect_star_sr_06.png"):6==this.m_gnrl_info.rare_type&&(animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.GachaAniRareType_06),star_url="#effect_star_ssr_06.png");var repeat=new cc.RepeatForever(animate);rare_type_sprite.runAction(repeat)}if(this.m_gnrl_info.class_type>YUNHEE_MAX_CLASS_TYPE){star_url=NOT_USE_SP_MAIN_ANIMATION?RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_star_ssr_rebirth_06.png":"#effect_star_ssr_rebirth_06.png";for(var i=0;i<3;++i){(class_type_star=cc.Sprite.create(star_url)).setAnchorPoint(ZERO()),NOT_USE_SP_MAIN_ANIMATION&&class_type_star.setScale(2),class_type_star.setPosition(37*i-39,540+12*i),this.addChild(class_type_star,2)}}else for(i=0;i<2;++i){var class_type_star;(class_type_star=cc.Sprite.create(star_url)).setAnchorPoint(ZERO()),NOT_USE_SP_MAIN_ANIMATION&&class_type_star.setScale(2),class_type_star.setPosition(37*i-18,545+12*i),this.addChild(class_type_star,2)}var name_label=cmLabel.createWithTTF(this.m_gnrl_info.name,FONT_NAME_RGKNOW,80);name_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),name_label.enableShadow(cc.color.BLACK,cc.p(5,-5)),name_label.setPosition(ccWidth(this)-20,125),this.addChild(name_label,2);var element_type_icon=cc.Sprite.create("#img_gacha_ic_"+this.m_gnrl_info.element_type+".png");element_type_icon.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),element_type_icon.setPosition(name_label.x-ccWidth(name_label)-10,name_label.y+10),USE_SP_YUNHEE_SCALE&&element_type_icon.setScale(2),this.addChild(element_type_icon,2)},startFlash:function(){var callback=new cc.CallFunc(this.endFlash,this);this.m_whiteLayer.runAction(new cc.Sequence(new cc.FadeOut(.2),callback))},endFlash:function(){if(this.m_isMoph)this.m_gnrlSkeleton.setAnimation(0,"active",!1),this.m_gnrlSkeleton.addAnimation(0,"basic",!0);else{var s1=new cc.ScaleTo(.1,this.m_img_scale+.03,this.m_img_scale-.03),s2=new cc.ScaleTo(.2,this.m_img_scale-.03,this.m_img_scale+.03),s3=new cc.ScaleTo(.15,this.m_img_scale+.02,this.m_img_scale-.02),s4=new cc.ScaleTo(.8,this.m_img_scale,this.m_img_scale),e4=new cc.EaseElasticOut(s4),callback=new cc.CallFunc(this.characterIdelAction,this),seq=new cc.Sequence(s1,s2,s3,e4,callback);this.m_gnrlBody.runAction(seq)}var img=cc.Sprite.create();if(img.setAnchorPoint(ANCHOR_MIDDLE_TOP()),img.setPosition(ccCenter(this).x,ccHeight(this)),this.addChild(img,100),NOT_USE_SP_MAIN_ANIMATION){img.setScale(2),img.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_limit_16.png");var scaleTo_1=new cc.ScaleTo(.3,2,2.03),scaleTo_2=new cc.ScaleTo(.3,2,1.97),callback_seq=(callback=new cc.CallFunc(this.runClassTypeEffect,this),new cc.Spawn(new cc.DelayTime(.2),callback)),sequence=new cc.Sequence(scaleTo_1,scaleTo_2,callback_seq,scaleTo_1,scaleTo_2);img.runAction(sequence),callback=callback_seq=sequence=scaleTo_2=scaleTo_1=null}else{var animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.LimitOverEffect),callback=new cc.CallFunc(this.runClassTypeEffect,this);img.runAction(new cc.Sequence(animate,new cc.Spawn(new cc.DelayTime(.2),callback)))}var audio=AudioEngine.getInstance(),snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_firework_2.mp3";audio.playEffect(snd),this.setVoiceSound()},setVoiceSound:function(){var audio=AudioEngine.getInstance(),voice_list=MasterTable.getInstance().get_Voice(this.m_gnrl_info.gnrl_id,voice_evolution,0),voice=voice_list.voice;voice_list.duration,""!=voice&&null!=voice&&audio.playVoice(RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3",!1)},runClassTypeEffect:function(){var img=cc.Sprite.create();if(img.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),img.setPosition(ccCenter(this).x,0),this.addChild(img,2),NOT_USE_SP_MAIN_ANIMATION){img.setScale(2),1==this.m_gnrl_info.limit_step_id?img.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_limit_lv_53_06.png"):2==this.m_gnrl_info.limit_step_id?img.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_limit_lv_56_06.png"):3==this.m_gnrl_info.limit_step_id?img.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_limit_lv_59_06.png"):4==this.m_gnrl_info.limit_step_id?img.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_limit_lv_62_06.png"):5==this.m_gnrl_info.limit_step_id&&img.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_limit_lv_65_06.png");var scaleTo_1=new cc.ScaleTo(.3,2,2.03),scaleTo_2=new cc.ScaleTo(.3,2,1.97),sequence=new cc.Sequence(scaleTo_1,scaleTo_2,scaleTo_1,scaleTo_2,scaleTo_1,scaleTo_2);img.runAction(sequence),sequence=scaleTo_2=scaleTo_1=null}else{var animate=null;1==this.m_gnrl_info.limit_step_id?animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.LimitOverStep_1):2==this.m_gnrl_info.limit_step_id?animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.LimitOverStep_2):3==this.m_gnrl_info.limit_step_id?animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.LimitOverStep_3):4==this.m_gnrl_info.limit_step_id?animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.LimitOverStep_4):5==this.m_gnrl_info.limit_step_id&&(animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.LimitOverStep_5)),null!=animate&&img.runAction(animate)}this.scheduleOnce(function(){this.m_end_btn.setVisible(!0)},.5,"m_end_btn")},characterIdelAction:function(){var scaleTo_1=new cc.ScaleTo(.7,this.m_img_scale,this.m_img_scale+.01),scaleTo_2=new cc.ScaleTo(.7,this.m_img_scale,this.m_img_scale-.01),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);this.m_gnrlBody.runAction(repeat)}}),MAX_SCALE=300,MIN_SCALE=30,DEFAULT_SCALE=100,MAX_SCALE_FOR_PERCENT=MAX_SCALE-MIN_SCALE,MAX_LENGTH=3,TOUCH_MOVE_THRESHOLD=20,YunheeStandingViewLayer=cc.Layer.extend({m_morphing_gnrl:null,m_standing_gnrl:null,m_base_layer:null,m_container:null,m_isMoved:!1,m_is_voice_play:!1,m_voice_play_delta:0,m_scale:100,m_scaleLabel:null,m_scaleSlider:null,_close_callback:null,m_dim:null,m_display_btn_0:null,m_display_btn_1:null,m_display_btn_2:null,m_close_btn:null,m_isHide:!1,m_hideBtn:null,m_cloud_img:null,m_state_img:null,m_bottom_layer:null,m_img_scale:1,m_progres_bar:null,m_tempCenter:null,m_openGroupCount:0,m_card_tumbList:[],m_checkList:[],m_maskList:[],m_touchPos:{},m_touchReturn:!1,m_gnrl_img:[],_cbVoiceEnd:null,m_test_pos_bg:null,m_test_pos_mv:null,m_bgSelected_1:null,m_bgSelected_2:null,m_touchCnt:0,m_distance_began:0,m_distance:0,ctor:function(gnrl_id,_close){this._super(),USE_SP_STANDING_LAYER?this.init_SP(gnrl_id,_close):this.init(gnrl_id,_close)},init:function(detail_gnrl,_close){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE()),this._close_callback=_close,this.m_gnrl=detail_gnrl,this.m_scale=100,this.m_openGroupCount=0;var winSize=ccSize(this);this.m_dim=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/bg_yh_zoom.jpg"),this.m_dim.ignoreAnchorPointForPosition(!1),this.m_dim.setAnchorPoint(ANCHOR_MIDDLE()),this.m_dim.setPosition(ccCenter(this)),this.addChild(this.m_dim,0),this.m_dim.setScale(0);var scale=new cc.ScaleTo(.5,2),cb=new cc.CallFunc(this.cbAppearEnd,this),seq=new cc.Sequence(scale,cb);this.m_dim.runAction(seq),seq=cb=scale=null,this.m_base_layer=new cc.Layer,this.m_base_layer.setContentSize(ccSize(this)),this.m_base_layer.ignoreAnchorPointForPosition(!1),this.m_base_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_base_layer.setPosition(ccCenter(this)),this.addChild(this.m_base_layer);var gnrl_info=MasterManager.getInstance().get_General(this.m_gnrl.gnrl_id);this.m_state_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_state_"+gnrl_info.state_type+".png"),this.m_state_img.setAnchorPoint(ANCHOR_MIDDLE()),USE_SP_MENU_YH_SCALE?this.m_state_img.setScale(3):this.m_state_img.setScale(1.5),this.m_state_img.setPosition(ccCenter(this.m_base_layer)),this.m_base_layer.addChild(this.m_state_img),this.m_container=new cc.Node,this.m_container.setAnchorPoint(ANCHOR_MIDDLE()),this.m_container.setPosition(ccCenter(this.m_base_layer)),this.m_base_layer.addChild(this.m_container);var listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this)}),mouse_listener=cc.EventListener.create({event:cc.EventListener.MOUSE,onMouseScroll:function(event){event.stopPropagation();var delta=cc.sys.isNative?1*event.getScrollY():event.getScrollY();delta=10*(.01*delta).toFixed(1);var curScale=this.m_scale+parseInt(delta);MAX_SCALE<curScale&&(curScale=MAX_SCALE),curScale<MIN_SCALE&&(curScale=MIN_SCALE),this.m_scaleLabel.setString(parseInt(curScale)+"%");var percent=((curScale-MIN_SCALE)/MAX_SCALE_FOR_PERCENT*100).toFixed(1);this.m_scaleSlider.setPercent(percent),this.setGeneralScale(curScale),this.m_scale=curScale}.bind(this)});cc.eventManager.addListener(mouse_listener,this.m_container),cc.eventManager.addListener(listener,this.m_container),listener.setSwallowTouches(!1),this.m_cloud_img=cc.Sprite.create(RES_CDN_DEFULT+"common/img_state_cloud.png"),this.m_cloud_img.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_cloud_img.setPosition(ccWidth(this),ccHeight(this)),this.addChild(this.m_cloud_img),this.m_close_btn=new ccui.Button,this.m_close_btn.loadTextures("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_close_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_close_btn.setPosition(ccWidth(this)-10,ccHeight(this)-10),this.m_close_btn.addClickEventListener(function(){null!=this._close_callback&&this._close_callback()}.bind(this)),this.addChild(this.m_close_btn);var offset_x=winSize.width-260,g=MasterManager.getInstance().get_General(this.m_gnrl.gnrl_id),gnrl_list=MasterTable.getInstance().get_GeneralByGroup(g.gnrl_group),on="btn_purple_circle_body_on.png",off="btn_purple_circle_body_off.png";this.m_card_tumbList=[],this.m_checkList=[],this.m_maskList=[];for(var i=0;i<MAX_LENGTH;i++){var tumbicon=cc.Sprite.create();if(tumbicon.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),tumbicon.setPosition(30,0),IS_SP_BROWSER){if(DISABLE_SPB_TP)tumbicon.setTexture(RES_CDN_CARD_MEDIUM_NTP+"m_"+gnrl_list[i].gnrl_id+".png");else{var frame=cc.spriteFrameCache.getSpriteFrame("m_"+gnrl_list[i].gnrl_id+".png");tumbicon.setSpriteFrame(frame)}tumbicon.setContentSize(49,49),tumbicon.setScale(DEF_TUMB_SCALE)}else{frame=cc.spriteFrameCache.getSpriteFrame("m_"+gnrl_list[i].gnrl_id+".png");tumbicon.setSpriteFrame(frame),tumbicon.setScale(DEF_TUMB_SCALE)}var mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());mask.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),mask.setPosition(30,0),mask.setPreferredSize(cc.size(60,60));var check_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/img_check.png");check_icon.setAnchorPoint(ANCHOR_TOP_LEFT()),check_icon.setPosition(0,60),this.m_card_tumbList.push(tumbicon),this.m_checkList.push(check_icon),this.m_maskList.push(mask),mask=mask=tumbicon=null}this.m_display_btn_0=new ccui.Button(off,on,on,ccui.Widget.PLIST_TEXTURE),this.m_display_btn_0.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_display_btn_0.setPosition(offset_x,15),this.addChild(this.m_display_btn_0),this.m_display_btn_0.addClickEventListener(function(sender){0==this.m_touchReturn&&this.changeSkeleteonDisplayClass(1)}.bind(this)),this.m_display_btn_0.addChild(this.m_card_tumbList[0]),this.m_display_btn_0.addChild(this.m_maskList[0]),this.m_display_btn_0.addChild(this.m_checkList[0]),offset_x+=70,this.m_display_btn_1=new ccui.Button(off,on,on,ccui.Widget.PLIST_TEXTURE),this.m_display_btn_1.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_display_btn_1.setPosition(offset_x,15),this.addChild(this.m_display_btn_1),this.m_display_btn_1.addClickEventListener(function(sender){0==this.m_touchReturn&&this.changeSkeleteonDisplayClass(2)}.bind(this)),this.m_display_btn_1.addChild(this.m_card_tumbList[1]),this.m_display_btn_1.addChild(this.m_maskList[1]),this.m_display_btn_1.addChild(this.m_checkList[1]),offset_x+=70,this.m_display_btn_2=new ccui.Button(off,on,on,ccui.Widget.PLIST_TEXTURE),this.m_display_btn_2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_display_btn_2.setPosition(offset_x,15),this.addChild(this.m_display_btn_2),this.m_display_btn_2.addClickEventListener(function(sender){0==this.m_touchReturn&&this.changeSkeleteonDisplayClass(3)}.bind(this)),this.m_display_btn_2.addChild(this.m_card_tumbList[2]),this.m_display_btn_2.addChild(this.m_maskList[2]),this.m_display_btn_2.addChild(this.m_checkList[2]),offset_x+=70,this.m_isHide=!0,this.m_hideBtn=new ccui.Button,this.m_hideBtn.loadTextures(RES_CDN_DEFULT+"menu_cg/btn_cglook_off.png",RES_CDN_DEFULT+"menu_cg/btn_cglook_on.png"),this.m_hideBtn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_hideBtn.setPosition(offset_x,15),this.addChild(this.m_hideBtn),this.m_hideBtn.addClickEventListener(function(sender){this.m_isHide?(this.m_hideBtn.loadTextureNormal(RES_CDN_DEFULT+"menu_cg/btn_cghide_off.png"),this.m_hideBtn.loadTexturePressed(RES_CDN_DEFULT+"menu_cg/btn_cghide_on.png"),this.m_isHide=!1):(this.m_hideBtn.loadTextureNormal(RES_CDN_DEFULT+"menu_cg/btn_cglook_off.png"),this.m_hideBtn.loadTexturePressed(RES_CDN_DEFULT+"menu_cg/btn_cglook_on.png"),this.m_isHide=!0),this.m_cloud_img.setVisible(this.m_isHide),this.m_close_btn.setVisible(this.m_isHide),this.m_display_btn_0.setVisible(this.m_isHide),this.m_display_btn_1.setVisible(this.m_isHide),this.m_display_btn_2.setVisible(this.m_isHide),this.m_bottom_layer.setVisible(this.m_isHide)}.bind(this)),this.m_bottom_layer=this.getBottomLayer(),this.m_bottom_layer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bottom_layer.setPosition(ccCenter(this).x-222,15),this.addChild(this.m_bottom_layer),this.m_cloud_img.setVisible(!1),this.m_close_btn.setVisible(!1),this.m_state_img.setVisible(!1),this.m_display_btn_0.setVisible(!1),this.m_display_btn_1.setVisible(!1),this.m_display_btn_2.setVisible(!1),this.m_hideBtn.setVisible(!1),this.m_bottom_layer.setVisible(!1),this.m_display_btn_0.setOpacity(0),this.m_display_btn_1.setOpacity(0),this.m_display_btn_2.setOpacity(0);for(i=0;i<MAX_LENGTH;i++)this.m_maskList[i].setVisible(!1),this.m_checkList[i].setVisible(!1);return this._cbVoiceEnd=new cc.Layer,this.addChild(this._cbVoiceEnd),!0},init_SP:function(detail_gnrl,_close){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE()),this.m_touchCnt=0,this.m_distance_began=0,this.m_distance=0,this._close_callback=_close,this.m_gnrl=detail_gnrl,this.m_scale=100,this.m_openGroupCount=0;var winSize=ccSize(this);this.m_dim=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/bg_yh_zoom.jpg"),this.m_dim.ignoreAnchorPointForPosition(!1),this.m_dim.setAnchorPoint(ANCHOR_MIDDLE()),this.m_dim.setPosition(ccCenter(this)),this.addChild(this.m_dim,0),this.m_dim.setScale(0);var scale=new cc.ScaleTo(.5,2),cb=new cc.CallFunc(this.cbAppearEnd,this),seq=new cc.Sequence(scale,cb);this.m_dim.runAction(seq),seq=cb=scale=null,this.m_base_layer=new cc.Layer,this.m_base_layer.setContentSize(ccSize(this)),this.m_base_layer.ignoreAnchorPointForPosition(!1),this.m_base_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_base_layer.setPosition(ccCenter(this)),this.addChild(this.m_base_layer);var gnrl_info=MasterManager.getInstance().get_General(this.m_gnrl.gnrl_id);this.m_state_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_state_"+gnrl_info.state_type+".png"),this.m_state_img.setAnchorPoint(ANCHOR_MIDDLE()),USE_SP_MENU_YH_SCALE?this.m_state_img.setScale(3):this.m_state_img.setScale(1.5),this.m_state_img.setRotation(-90),this.m_state_img.setPosition(ccCenter(this.m_base_layer)),this.m_base_layer.addChild(this.m_state_img),this.m_state_img.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR),this.m_container=new cc.Node,this.m_container.setAnchorPoint(ANCHOR_MIDDLE()),this.m_container.setPosition(ccCenter(this.m_base_layer)),this.m_container.setRotation(-90),this.m_base_layer.addChild(this.m_container);var listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this)}),mouse_listener=cc.EventListener.create({event:cc.EventListener.MOUSE,onMouseScroll:function(event){event.stopPropagation();var delta=cc.sys.isNative?1*event.getScrollY():event.getScrollY();delta=10*(.01*delta).toFixed(1);var curScale=this.m_scale+parseInt(delta);MAX_SCALE<curScale&&(curScale=MAX_SCALE),curScale<MIN_SCALE&&(curScale=MIN_SCALE),this.m_scaleLabel.setString(parseInt(curScale)+"%");var percent=((curScale-MIN_SCALE)/MAX_SCALE_FOR_PERCENT*100).toFixed(1);this.m_scaleSlider.setPercent(percent),this.setGeneralScale(curScale),this.m_scale=curScale}.bind(this)});cc.eventManager.addListener(mouse_listener,this.m_container),cc.eventManager.addListener(listener,this.m_container),listener.setSwallowTouches(!1),this.m_cloud_img=cc.Sprite.create(RES_CDN_DEFULT+"common/img_state_cloud.png"),this.m_cloud_img.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_cloud_img.setRotation(-90),this.m_cloud_img.setPosition(0,ccHeight(this)),this.addChild(this.m_cloud_img),this.m_close_btn=new ccui.Button,this.m_close_btn.loadTextures("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_close_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_close_btn.setRotation(-90),this.m_close_btn.setPosition(10,ccHeight(this)-10),this.m_close_btn.addClickEventListener(function(){null!=this._close_callback&&this._close_callback()}.bind(this)),this.addChild(this.m_close_btn);var offset_x=330,g=MasterManager.getInstance().get_General(this.m_gnrl.gnrl_id),gnrl_list=MasterTable.getInstance().get_GeneralByGroup(g.gnrl_group),on="btn_purple_circle_body_on.png",off="btn_purple_circle_body_off.png";this.m_card_tumbList=[],this.m_checkList=[],this.m_maskList=[];for(var i=0;i<MAX_LENGTH;i++){var tumbicon=cc.Sprite.create();if(tumbicon.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),tumbicon.setPosition(30,0),IS_SP_BROWSER){if(DISABLE_SPB_TP)tumbicon.setTexture(RES_CDN_CARD_MEDIUM_NTP+"m_"+gnrl_list[i].gnrl_id+".png");else{var frame=cc.spriteFrameCache.getSpriteFrame("m_"+gnrl_list[i].gnrl_id+".png");tumbicon.setSpriteFrame(frame)}tumbicon.setContentSize(49,49),tumbicon.setScale(DEF_TUMB_SCALE)}else{frame=cc.spriteFrameCache.getSpriteFrame("m_"+gnrl_list[i].gnrl_id+".png");tumbicon.setSpriteFrame(frame),tumbicon.setScale(DEF_TUMB_SCALE)}var mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());mask.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),mask.setPosition(30,0),mask.setPreferredSize(cc.size(60,60));var check_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/img_check.png");check_icon.setAnchorPoint(ANCHOR_TOP_LEFT()),check_icon.setPosition(0,60),this.m_card_tumbList.push(tumbicon),this.m_checkList.push(check_icon),this.m_maskList.push(mask),mask=mask=tumbicon=null}this.m_display_btn_0=new ccui.Button(off,on,on,ccui.Widget.PLIST_TEXTURE),this.m_display_btn_0.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_display_btn_0.setPosition(ccWidth(this)-offset_x,winSize.height-10),this.addChild(this.m_display_btn_0),this.m_display_btn_0.setRotation(-90),this.m_display_btn_0.addClickEventListener(function(sender){0==this.m_touchReturn&&this.changeSkeleteonDisplayClass(1)}.bind(this)),this.m_display_btn_0.addChild(this.m_card_tumbList[0]),this.m_display_btn_0.addChild(this.m_maskList[0]),this.m_display_btn_0.addChild(this.m_checkList[0]),offset_x-=70,this.m_display_btn_1=new ccui.Button(off,on,on,ccui.Widget.PLIST_TEXTURE),this.m_display_btn_1.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_display_btn_1.setPosition(ccWidth(this)-offset_x,winSize.height-10),this.addChild(this.m_display_btn_1),this.m_display_btn_1.setRotation(-90),this.m_display_btn_1.addClickEventListener(function(sender){0==this.m_touchReturn&&this.changeSkeleteonDisplayClass(2)}.bind(this)),this.m_display_btn_1.addChild(this.m_card_tumbList[1]),this.m_display_btn_1.addChild(this.m_maskList[1]),this.m_display_btn_1.addChild(this.m_checkList[1]),offset_x-=70,this.m_display_btn_2=new ccui.Button(off,on,on,ccui.Widget.PLIST_TEXTURE),this.m_display_btn_2.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_display_btn_2.setPosition(ccWidth(this)-offset_x,winSize.height-10),this.addChild(this.m_display_btn_2),this.m_display_btn_2.setRotation(-90),this.m_display_btn_2.addClickEventListener(function(sender){0==this.m_touchReturn&&this.changeSkeleteonDisplayClass(3)}.bind(this)),this.m_display_btn_2.addChild(this.m_card_tumbList[2]),this.m_display_btn_2.addChild(this.m_maskList[2]),this.m_display_btn_2.addChild(this.m_checkList[2]),offset_x-=70,this.m_isHide=!0,this.m_hideBtn=new ccui.Button,this.m_hideBtn.loadTextures(RES_CDN_DEFULT+"menu_cg/btn_cglook_off.png",RES_CDN_DEFULT+"menu_cg/btn_cglook_on.png"),this.m_hideBtn.setAnchorPoint(ZERO()),this.m_hideBtn.setPosition(68,10),this.m_hideBtn.setRotation(-90),this.addChild(this.m_hideBtn),this.m_hideBtn.addClickEventListener(function(sender){this.m_isHide?(this.m_hideBtn.loadTextureNormal(RES_CDN_DEFULT+"menu_cg/btn_cghide_off.png"),this.m_hideBtn.loadTexturePressed(RES_CDN_DEFULT+"menu_cg/btn_cghide_on.png"),this.m_isHide=!1):(this.m_hideBtn.loadTextureNormal(RES_CDN_DEFULT+"menu_cg/btn_cglook_off.png"),this.m_hideBtn.loadTexturePressed(RES_CDN_DEFULT+"menu_cg/btn_cglook_on.png"),this.m_isHide=!0),this.m_cloud_img.setVisible(this.m_isHide),this.m_close_btn.setVisible(this.m_isHide),this.m_display_btn_0.setVisible(this.m_isHide),this.m_display_btn_1.setVisible(this.m_isHide),this.m_display_btn_2.setVisible(this.m_isHide),this.m_bottom_layer.setVisible(this.m_isHide)}.bind(this)),this.m_bottom_layer=this.getBottomLayer(),this.m_bottom_layer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bottom_layer.setRotation(-90),this.m_bottom_layer.setPosition(ccWidth(this)-250,ccCenter(this).y),this.addChild(this.m_bottom_layer),this.m_cloud_img.setVisible(!1),this.m_close_btn.setVisible(!1),this.m_state_img.setVisible(!1),this.m_display_btn_0.setVisible(!1),this.m_display_btn_1.setVisible(!1),this.m_display_btn_2.setVisible(!1),this.m_hideBtn.setVisible(!1),this.m_bottom_layer.setVisible(!1),this.m_display_btn_0.setOpacity(0),this.m_display_btn_1.setOpacity(0),this.m_display_btn_2.setOpacity(0);for(i=0;i<MAX_LENGTH;i++)this.m_maskList[i].setVisible(!1),this.m_checkList[i].setVisible(!1);return this._cbVoiceEnd=new cc.Layer,this.addChild(this._cbVoiceEnd),this.m_bgSelected_1=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_1.png",cc.rect(0,0,0,0)),this.m_bgSelected_1.setContentSize(90,90),this.m_bgSelected_1.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bgSelected_1.setOpacity(0),this.m_bgSelected_1.setPosition(ccCenter(this).x+60,ccCenter(this).y),this.addChild(this.m_bgSelected_1),this.m_bgSelected_2=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_3.png",cc.rect(0,0,0,0)),this.m_bgSelected_2.setContentSize(90,90),this.m_bgSelected_2.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bgSelected_2.setOpacity(0),this.m_bgSelected_2.setPosition(ccCenter(this).x-60,ccCenter(this).y),this.addChild(this.m_bgSelected_2),!0},createBaseLayer:function(){var standing_gnrl={};GeneralService.getInstance().getUserGnrlDisplayClassInfo(this.m_gnrl,standing_gnrl),null==standing_gnrl.display_class&&(3<this.m_gnrl.display_class?standing_gnrl.display_class=3:standing_gnrl.display_class=this.m_gnrl.display_class),this.m_openGroupCount=0;var g=MasterManager.getInstance().get_General(this.m_gnrl.gnrl_id);this.m_openGroupCount=g.gnrl_class,this.m_maskList[0].setVisible(!1),this.m_openGroupCount<2&&(this.m_display_btn_1.setEnabled(!1),this.m_maskList[1].setVisible(!0)),this.m_openGroupCount<3&&(this.m_display_btn_2.setEnabled(!1),this.m_maskList[2].setVisible(!0)),this.m_cloud_img.setVisible(!0),this.m_close_btn.setVisible(!0),this.m_state_img.setVisible(!0),this.m_display_btn_0.setVisible(!0),this.m_display_btn_1.setVisible(!0),this.m_display_btn_2.setVisible(!0),this.m_hideBtn.setVisible(!0),this.m_bottom_layer.setVisible(!0),this.changeSkeleteonDisplayClass(standing_gnrl.display_class)},getBottomLayer:function(){var layer=new cc.Layer;layer.setContentSize(444,100),this.m_scaleLabel=cmLabel.getLabel(this.m_scale+"%",LABEL_FONT_INDEX.FONT_181),this.m_scaleLabel.enableOutline(cc.color.BLACK,3),this.m_scaleLabel.setAnchorPoint(ANCHOR_MIDDLE()),this.m_scaleLabel.setPosition(ccCenter(layer).x,40),layer.addChild(this.m_scaleLabel,2),this.m_scaleSlider=new ccui.Slider,this.m_scaleSlider.setTouchEnabled(!0),this.m_scaleSlider.setScale9Enabled(!0),this.m_scaleSlider.loadBarTexture(RES_CDN_DEFULT+"menu_yh/img_yh_zoom_gauge.png"),this.m_scaleSlider.loadSlidBallTextures(RES_CDN_DEFULT+"menu_yh/img_yh_feel_gauge_toggle.png",RES_CDN_DEFULT+"menu_yh/img_yh_feel_gauge_toggle.png",""),this.m_scaleSlider.loadProgressBarTexture(RES_CDN_DEFULT+"menu_yh/img_yh_zoom_gauge_mint.png"),this.m_scaleSlider.setCapInsets(cc.rect(0,0,0,0)),this.m_scaleSlider.setContentSize(cc.size(274,16)),this.m_scaleSlider.setAnchorPoint(ANCHOR_MIDDLE()),this.m_scaleSlider.setPosition(ccCenter(layer).x,21),this.m_scaleSlider.addEventListener(this.slideCallback,this);var percent=((this.m_scale-MIN_SCALE)/MAX_SCALE_FOR_PERCENT*100).toFixed(1);this.m_scaleSlider.setPercent(percent),layer.addChild(this.m_scaleSlider);var scalePlusBtn=new ccui.Button;scalePlusBtn.loadTextures("btn_spinner_plus_off.png","btn_spinner_plus_on.png","",ccui.Widget.PLIST_TEXTURE),scalePlusBtn.setAnchorPoint(ANCHOR_MIDDLE()),scalePlusBtn.setPosition(ccCenter(layer).x+187,21),scalePlusBtn.addClickEventListener(function(){this.onScalePlus()}.bind(this)),layer.addChild(scalePlusBtn);var scaleMinusBtn=new ccui.Button;return scaleMinusBtn.loadTextures("btn_spinner_minus_off.png","btn_spinner_minus_on.png","",ccui.Widget.PLIST_TEXTURE),scaleMinusBtn.setAnchorPoint(ANCHOR_MIDDLE()),scaleMinusBtn.setPosition(ccCenter(layer).x-187,21),scaleMinusBtn.addClickEventListener(function(){this.onScaleMinus()}.bind(this)),layer.addChild(scaleMinusBtn),layer},cbAppearEnd:function(){this.createBaseLayer()},slideCallback:function(sender,type){switch(type){case ccui.Slider.EVENT_PERCENT_CHANGED:var percent=sender.getPercent(),temp=(MAX_SCALE_FOR_PERCENT*percent*.01+MIN_SCALE).toFixed(1);this.m_scaleLabel.setString(Math.floor(temp)+"%"),this.m_scale=Math.floor(temp),this.setGeneralScale(this.m_scale)}},onScalePlus:function(){this.m_scale+=10,this.m_scale>MAX_SCALE&&(this.m_scale=MAX_SCALE),this.m_scaleLabel.setString(this.m_scale+"%");var percent=((this.m_scale-MIN_SCALE)/MAX_SCALE_FOR_PERCENT*100).toFixed(1);this.m_scaleSlider.setPercent(percent),this.setGeneralScale(this.m_scale)},onScaleMinus:function(){this.m_scale-=10,this.m_scale<=MIN_SCALE&&(this.m_scale=MIN_SCALE),this.m_scaleLabel.setString(this.m_scale+"%");var percent=((this.m_scale-MIN_SCALE)/MAX_SCALE_FOR_PERCENT*100).toFixed(1);this.m_scaleSlider.setPercent(percent),this.setGeneralScale(this.m_scale)},setGeneralScale:function(scale){var to_scale=scale/100;null!=this.m_standing_gnrl?this.m_container.setScale(to_scale):null!=this.m_morphing_gnrl&&this.m_container.setScale(to_scale)},changeSkeleteonDisplayClass:function(display_class){this.initLayoutProgress_Ani(0);for(var i=0;i<MAX_LENGTH;i++)this.m_checkList[i].setVisible(!1);switch(display_class){case 1:this.m_checkList[0].setVisible(!0);break;case 2:this.m_checkList[1].setVisible(!0);break;case 3:case 4:this.m_checkList[2].setVisible(!0)}var gnrl_list,g=MasterManager.getInstance().get_General(this.m_gnrl.gnrl_id);gnrl_list=MasterTable.getInstance().get_GeneralByGroup(g.gnrl_group);for(var idx=0;idx<gnrl_list.length;idx++){var gnrl=gnrl_list[idx];if(gnrl.gnrl_class==display_class&&this.m_display_class!=gnrl.gnrl_class){var gnrl_id=0;gnrl_id=gnrl.gnrl_class>AVAIL_EVOLUTION_CLASS_TYPE_LIMIT?gnrl.gnrl_id-1e3:gnrl.gnrl_id;var pos=MasterManager.getInstance().get_BodyPosition(gnrl_id),morph=MasterTable.getInstance().get_MorphData(gnrl_id);if("y"==morph.is_morph){null!=this.m_morphing_gnrl&&this.m_morphing_gnrl.removeFromParent();var general=MasterManager.getInstance().get_General(morph.gnrl_id);this.m_gnrl_img=[];var stading_files=StandingMultiplePngList[morph.gnrl_id];if(!USE_PARTNER_GNRL_LOADING||SAVE_NOW_PARTNER_GNRL.gnrl_id!=gnrl_id){if(null==stading_files)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(general.gnrl_group,3)+"/standing/"+morph.gnrl_id+".png");else for(idx=0;idx<stading_files.length;idx++)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(general.gnrl_group,3)+"/standing/"+stading_files[idx]+".png");this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(general.gnrl_group,3)+"/standing/"+general.gnrl_id+".atlas"),this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(general.gnrl_group,3)+"/standing/"+general.gnrl_id+".json")}resourceLoader(this.m_gnrl_img,function(){var standing_atlas=RES_CDN_DEFULT+"gnrl_"+leadingZeros(general.gnrl_group,3)+"/standing/"+morph.gnrl_id+".atlas",standing_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(general.gnrl_group,3)+"/standing/"+morph.gnrl_id+".json";this.m_morphing_gnrl=new sp.SkeletonAnimation(standing_json,standing_atlas,.1),this.m_morphing_gnrl.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),USE_SP_STANDING_LAYER?this.m_morphing_gnrl.setPosition(STANDING_POS(this.m_base_layer,pos.posx,pos.posy+120)):this.m_morphing_gnrl.setPosition(STANDING_POS(this.m_base_layer,pos.posx,pos.posy)),this.m_container.addChild(this.m_morphing_gnrl,PARTNER_ZORDER),this.m_morphing_gnrl.setMix("basic","active",.1),this.m_morphing_gnrl.setMix("active","basic",.1),this.m_morphing_gnrl.setMix("active","active",.1),this.m_morphing_gnrl.setAnimation(0,"active",!1),this.m_morphing_gnrl.addAnimation(0,"basic",!0),this.removeLayerProgress()}.bind(this))}else{null!=this.m_standing_gnrl&&this.m_standing_gnrl.removeFromParent();general=MasterManager.getInstance().get_General(gnrl.gnrl_id);var card_img=null;if(this.m_gnrl_img=[],!USE_PARTNER_GNRL_LOADING||SAVE_NOW_PARTNER_GNRL.gnrl_id!=gnrl_id){if(general.gnrl_type==GENERAL_TYPE_YUNHEE)card_img=MasterManager.getInstance().get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M?getCardBody_ImageStr(general.gnrl_id):getCardBody_ImageStr(general.gnrl_group);else card_img=getCardBody_ImageStr(gnrl.gnrl_id);null!=card_img&&this.m_gnrl_img.push(card_img)}resourceLoader(card_img,function(){if(this.m_standing_gnrl=cc.Sprite.create(),this.m_img_scale=1,general.gnrl_type==GENERAL_TYPE_YUNHEE){if(MasterManager.getInstance().get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id),this.m_standing_gnrl.setTexture(img_str)}else{img_str=getCardBody_ImageStr(general.gnrl_group);this.m_img_scale=getCardBody_Scale(general.gnrl_group),this.m_standing_gnrl.setTexture(img_str)}}else{img_str=getCardBody_ImageStr(gnrl.gnrl_id);this.m_img_scale=getCardBody_Scale(gnrl.gnrl_id),this.m_standing_gnrl.setTexture(img_str)}this.m_standing_gnrl.setAnchorPoint(ANCHOR_MIDDLE()),this.m_standing_gnrl.setScale(this.m_img_scale),USE_SP_STANDING_LAYER?this.m_standing_gnrl.setPosition(STANDING_POS(this.m_base_layer,pos.posx+ccWidth(this.m_standing_gnrl)*this.m_img_scale/2,pos.posy+280+ccHeight(this.m_standing_gnrl)*this.m_img_scale/2)):this.m_standing_gnrl.setPosition(STANDING_POS(this.m_base_layer,pos.posx+ccWidth(this.m_standing_gnrl)*this.m_img_scale/2,pos.posy+ccHeight(this.m_standing_gnrl)*this.m_img_scale/2)),this.m_container.addChild(this.m_standing_gnrl,PARTNER_ZORDER);var scaleTo_1=new cc.ScaleTo(.1,this.m_img_scale+.03,this.m_img_scale-.03),scaleTo_2=new cc.ScaleTo(.125,this.m_img_scale-.03,this.m_img_scale+.03),scaleTo_3=new cc.ScaleTo(.1,this.m_img_scale+.02,this.m_img_scale-.02),scaleTo_4=new cc.ScaleTo(.1,this.m_img_scale,this.m_img_scale),callback=new cc.CallFunc(this.stadingIdelAction,this);this.m_standing_gnrl.runAction(new cc.Sequence(scaleTo_1,scaleTo_2,scaleTo_3,scaleTo_4,callback)),this.removeLayerProgress(),scaleTo_4=scaleTo_3=scaleTo_2=scaleTo_1=null}.bind(this))}this.m_scale=DEFAULT_SCALE,this.m_container.setPosition(ccCenter(this.m_base_layer)),this.m_scaleLabel.setString(this.m_scale+"%");var percent=((this.m_scale-MIN_SCALE)/MAX_SCALE_FOR_PERCENT*100).toFixed(1);this.m_scaleSlider.setPercent(percent),this.m_is_voice_play=!1,this.m_voice_play_delta=0,this.playVoiceAndRunAction(),this.setGeneralScale(this.m_scale);break}}},stadingIdelAction:function(){var scaleTo_1=new cc.ScaleTo(1.2,this.m_img_scale,this.m_img_scale+.01),scaleTo_2=new cc.ScaleTo(1.2,this.m_img_scale,this.m_img_scale-.01),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);this.m_standing_gnrl.runAction(repeat),repeat=sequence=scaleTo_2=scaleTo_1=null},playVoiceAndRunAction:function(){var is_voice_play=!1,duration=0,voice_list=MasterTable.getInstance().get_Voice(this.m_gnrl.gnrl_id,voice_main_body_touch,0,duration),voice=voice_list.voice;if(duration=voice_list.duration,null!=this.m_standing_gnrl){this.m_standing_gnrl.stopAllActions();var s1=new cc.ScaleTo(.1,this.m_img_scale+.03,this.m_img_scale-.03),s2=new cc.ScaleTo(.2,this.m_img_scale-.03,this.m_img_scale+.03),s3=new cc.ScaleTo(.15,this.m_img_scale+.02,this.m_img_scale-.02),s4=new cc.ScaleTo(.8,this.m_img_scale,this.m_img_scale),callback=new cc.CallFunc(this.stadingIdelAction,this),e4=new cc.EaseElasticOut(s4),seq=new cc.Sequence(s1,s2,s3,e4,callback);this.m_standing_gnrl.runAction(seq),is_voice_play=!0,seq=e4=callback=s4=s3=s2=s1=null}else null!=this.m_morphing_gnrl&&(this.m_morphing_gnrl.setAnimation(0,"active",!1),this.m_morphing_gnrl.addAnimation(0,"basic",!0),is_voice_play=!0);if(is_voice_play&&!this.m_is_voice_play&&""!=voice&&null!=voice){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3";audio.playVoice(path,!1),this.m_is_voice_play=!0,this.m_voice_play_delta=duration;var delay=cc.delayTime(this.m_voice_play_delta),cb=cc.callFunc(this.stopVoice,this);seq=cc.sequence(delay,cb);this._cbVoiceEnd.runAction(seq)}},stopVoice:function(){this.m_is_voice_play=!1,this.m_voice_play_delta=0},initLayoutProgress_Ani:function(alpa){this.m_progres_bar=new cc.LayerColor(cc.color.BLACK),this.m_touchReturn=!0,null==alpa&&(alpa=255),this.m_progres_bar.setOpacity(alpa),this.m_progres_bar.setContentSize(ccSize(this));var bg=cc.Sprite.create(RES_CM+"img_progress_bg.png");bg.setPosition(ccCenter(this));var bar=cc.Sprite.create(RES_CM+"img_progress_arrow.png");bar.setPosition(ccCenter(bg)),bg.addChild(bar,1000001),this.m_progres_bar.addChild(bg),USE_SP_STANDING_LAYER&&this.m_progres_bar.setRotation(-90),this.m_base_layer.addChild(this.m_progres_bar,1000001);var loading=new cc.Sprite(res.s_cm_img_text_loading);loading.setAnchorPoint(.5,0),loading.setPosition(ccCenter(bg).x,ccCenter(bg).y-100),bg.addChild(loading,1000001);var mu=new cc.RotateBy(.1,30),seq=new cc.Sequence(mu),repeat=new cc.RepeatForever(seq);bar.runAction(repeat);var listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE});listener.onTouchBegan=function(touch,event){event.stopPropagation()}.bind(this),cc.eventManager.addListener(listener,this.m_progres_bar)},removeLayerProgress:function(){this.m_touchReturn=!1,null!=this.m_progres_bar&&(this.m_base_layer.removeChild(this.m_progres_bar),this.m_progres_bar=null)},onTouchBegan:function(touch,evt){if(this.m_isMoved=!1,this.m_touchPos=touch.getLocation(),USE_SP_STANDING_LAYER&&(2<this.m_touchCnt&&(this.m_touchCnt=0,this.m_distance_began=0),this.m_touchCnt++,1==this.m_touchCnt&&this.m_bgSelected_1.setPosition(this.m_touchPos.x,this.m_touchPos.y),2==this.m_touchCnt)){this.m_bgSelected_2.setPosition(this.m_touchPos.x,this.m_touchPos.y);var disX=this.m_bgSelected_1.getPosition().x-this.m_bgSelected_2.getPosition().x,disY=this.m_bgSelected_1.getPosition().y-this.m_bgSelected_2.getPosition().y;this.m_distance_began=Math.sqrt(Math.abs(disX*disX)+Math.abs(disY*disY))}return!0},onTouchMoved:function(touch,evt){var pre_loc=touch.getPreviousLocation(),loc=touch.getLocation();if(USE_SP_STANDING_LAYER&&2==this.m_touchCnt){var r1=this.m_bgSelected_1.getBoundingBox();cc.rectContainsPoint(r1,loc)&&this.m_bgSelected_1.setPosition(loc.x,loc.y);var r2=this.m_bgSelected_2.getBoundingBox();cc.rectContainsPoint(r2,loc)&&this.m_bgSelected_2.setPosition(loc.x,loc.y);var disX=this.m_bgSelected_1.getPosition().x-this.m_bgSelected_2.getPosition().x,disY=this.m_bgSelected_1.getPosition().y-this.m_bgSelected_2.getPosition().y;if(this.m_distance=Math.sqrt(Math.abs(disX*disX)+Math.abs(disY*disY)),0<this.m_distance){var prevScale=this.m_scale,delta=2*(.01*Math.floor(this.m_distance-this.m_distance_began)).toFixed(1),curScale=prevScale+parseInt(delta);MAX_SCALE<curScale&&(curScale=MAX_SCALE),curScale<MIN_SCALE&&(curScale=MIN_SCALE),this.m_scaleLabel.setString(parseInt(curScale)+"%");var percent=((curScale-MIN_SCALE)/MAX_SCALE_FOR_PERCENT*100).toFixed(1);this.m_scaleSlider.setPercent(percent),this.setGeneralScale(curScale),this.m_scale=curScale}}if(1==this.m_isMoved){var diff=SUM_POS(loc,pre_loc),pos=this.m_container.getPosition(),movePos=ADD_POS(pos,diff);this.m_container.setPosition(movePos)}else{var diff_begin_x,diff_begin_y;if(diff_begin_x=loc.x-this.m_touchPos.x,diff_begin_y=loc.y-this.m_touchPos.y,Math.abs(diff_begin_x)>TOUCH_MOVE_THRESHOLD||Math.abs(diff_begin_y)>TOUCH_MOVE_THRESHOLD){diff=SUM_POS(loc,pre_loc),pos=this.m_container.getPosition(),movePos=ADD_POS(pos,diff);this.m_container.setPosition(movePos),this.m_isMoved=!0}}},onTouchEnded:function(touch,evt){0==this.m_isMoved&&this.playVoiceAndRunAction(),USE_SP_STANDING_LAYER&&(this.m_bgSelected_1.setPosition(ccCenter(this).x+60,ccCenter(this).y),this.m_bgSelected_2.setPosition(ccCenter(this).x-60,ccCenter(this).y),this.m_touchCnt=0),this.m_isMoved=!1},onEnter:function(){this._super()},onExit:function(){this._super(),null!=this.m_gnrl_img&&(this.m_gnrl_img=[]),null!=this.m_morphing_gnrl&&(this.m_morphing_gnrl._skeleton.data.animations=[],this.m_morphing_gnrl._skeleton.data.bones=[],this.m_morphing_gnrl._skeleton.data.slots=[],this.m_morphing_gnrl._skeleton.data.skins=[],this.m_morphing_gnrl._skeleton.data.ikConstraints=[],this.m_morphing_gnrl._skeleton.slots=[],this.m_morphing_gnrl._skeleton.bones=[],this.m_morphing_gnrl._skeleton.ikConstraints=[],this.m_morphing_gnrl._skeleton.drawOrder=[],this.m_morphing_gnrl._skeleton=null,this.m_morphing_gnrl._state=null,this.m_morphing_gnrl=null),(this.m_standing_gnrl=null)!=this.m_container&&(this.m_container.removeAllChildrenWithCleanup(!0),this.m_container=null),this.m_scaleLabel=null,this.m_scaleSlider=null,this.m_bottom_layer=null,this._close_callback=null,this.m_dim=null,this.m_display_btn_0=null,this.m_display_btn_1=null,this.m_display_btn_2=null,this.m_close_btn=null,this.m_hideBtn=null,this.m_cloud_img=null,this.m_state_img=null,this.m_progres_bar=null,this.m_tempCenter=null,this.m_card_tumbList=[],this.m_checkList=[],this.m_maskList=[],this.m_touchPos={},this._cbVoiceEnd=null,this.m_base_layer.removeAllChildrenWithCleanup(!0),this.m_base_layer=null,this._super()}}),EQUIP_LAYER_STATE={MAIN:1,SELL:2,CHANGE:3,LEVELUP:4},EQUIP_PARTS={EQUIPMENT_PARTS_ALL:100,EQUIPMENT_PRIVATE:1,EQUIPMENT_ARMOR:2,EQUIPMENT_RING:3,EQUIPMENT_SHIELD:4,EQUIPMENT_JEWELRY:5},EQUIP_TABS={NORMAL:1,MATERIAL:2},EQUIP_BOTTOM_BTNS={BTN_EQUIP_SELL:1,BTN_EQUIP_BATCH_SELL:2,BTN_CHANGE_LEVELUP:3,BTN_CHANGE_TAKE_OFF:4,BTN_CHANGE_CHANGE:5,BTN_CHANGE_WEAR:6,BTN_LEVEL_CANCEL:7,BTN_SELL_CANCEL:8,BTN_SELL_SELL:9},EQUIP_SORT_TYPE={SORT_GAIN_ORDER:1,SORT_ELEMENT_TYPE:2,SORT_SERIES:3,SORT_LEVEL:4,SORT_PLUS_VALUE:5,SORT_RARE_TYPE:6,SORT_WEARING:7,SORT_PARTS_TYPE:8,SORT_ARM_SERVICE_TYPE:9},EQUIP_NOTI_TYPE={BTN_INVENTORY_INC:100,BTN_WEAR:101,BTN_TAKE_OFF:102,BTN_CHANGE:103,BTN_LOCK:104,BTN_LOCK_WEAR_EQUIP:105,BTN_UNLOCK:106,BTN_UNLOCK_WEAR_EQUIP:107,BTN_SET_EFFECT:108,BTN_SET_EFFECT_WEAR_EQUIP:109,BTN_LEVELUP:110,BTN_SELL:111,BTN_EQUIPMENT_NOT_SELECTED:112,BTN_CANCEL:113,BTN_BATCH_SELL:114,BTN_NOT_SAME_GENERAL_GROUP:115,BTN_NOT_SAME_ARM_SERVICE_TYPE:116,BTN_BATCH_SELL_MTRL:117,OVER_MAX_LEVEL:118,EUQIP_SHOW_HELP:310,EUQIP_SHOW_HELP_AT_SET_EFFECT:311,OVER_MAX_COUNT:900,NOTIFICATION_EQUIPMENT_CELL_TOUCHED:901},NOTIFICATION_EQUIPMENT_SET_LAYER="notification_equipment_set_layer",MAX_LEVELUP_COUNT=20,EQUIP_MAX_BATCH_SELL_KIND=4,MAX_SELL_COUNT=300,WARNING_RARE_TYPE=2,MAX_BATCH_SELL_RARE_TYPE=1,EQUIPMENT_COUNT_FUNCTION_SAME_TYPE=13,MININUM_MAX_LEVEL=10,EQUIP_MAX_GAUGE_VALUE=134,EQUIP_RIGHT_BOX_HEIGHT=487,EQUIP_RIGHT_BOX_WIDTH=451,SELL_MAX_MSG_BOX_WIDTH=958,SELL_MAX_MSG_BOX_HEIGHT=555,SELL_CELL_SIZE_WIDTH=896,SELL_CELL_SIZE_HEIGHT=108,EQUIP_MAX_MSG_BOX_WIDTH=630,EQUIP_MAX_MSG_BOX_HEIGHT=370,EQUIP_COLUMN_COUNT=4,PREV_EQUIP_SHOP=!1,PREV_ACHIVE_EQUIP=!1,EquipmentScene_WebV2=GameScene.extend({m_gnrl_key:null,m_equipLayer:null,m_EquipLayerStateList:[],m_cur_LayerState:0,m_items:[75,100,200,300],m_checkImgs:[],m_selected_item:0,m_selected_grades:[],m_selected_equip_types:[],m_selected_option_steps:[],m_selected_mtrl_grades:[],m_checkGrades:[],m_checkEquipTypes:[],m_checkOptionSteps:[],m_checkCount:[],m_checkMtrlGrade:[],m_checkBatchSellModalLayer:null,m_set_effect_modal_layer:null,m_comfirmSellModalLayer:null,m_isWearEquip:!1,m_equip_key:null,m_levelUpEffectLayer:null,m_skeletonLevelupEffectNode:null,m_isToDeck:!1,m_prevSetFliter:[],m_resources:[],ctor:function(state,isDeck){this._super(scene_EquipmentScene_WebV2),this.m_isToDeck=null!=isDeck&&isDeck,this.initLayout(state)},onEnter:function(){this._super(),PREV_HELP=!1,PREV_ACHIVE_EQUIP=PREV_EQUIP_SHOP=!1,MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_EquipmentScene_WebV2]),MainObserver.getInstance().addObserver(this.onNotifySetLayer,this,NOTIFICATION_EQUIPMENT_SET_LAYER)},init:function(){return this.m_gnrl_key={},this.m_equipLayer=null,this.m_EquipLayerStateList=[],this.m_prevSetFliter=[],this.m_cur_LayerState=0,this.m_isWearEquip=!1,this.m_equip_key={equipment_item_idx:0,equipment_num:0},this.m_levelUpEffectLayer=new GameModalLayer,this.addChild(this.m_levelUpEffectLayer,100),this.m_set_effect_modal_layer=new GameModalLayer,this.addChild(this.m_set_effect_modal_layer,999999),this.m_checkBatchSellModalLayer=new GameModalLayer,this.addChild(this.m_checkBatchSellModalLayer,99999),this.m_comfirmSellModalLayer=new GameModalLayer,this.addChild(this.m_comfirmSellModalLayer,99999),this.removeLayerProgress2(),!0},initLayout:function(state){this.initLayoutProgress2(0),this.m_resources=[],this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_n.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_r.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_hr.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_s.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_ss.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_01.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_02.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_03.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_04.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_05.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_06.png"),NOT_USE_SP_MAIN_ANIMATION&&this.m_resources.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_yh_lvup_01.png"),resourceLoader(this.m_resources,function(){var bg;USE_SP_YUNHEE_SCALE?((bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_equip/bg_equip.jpg")).setPosition(ccCenter(this)),bg.setScale(2),this.addChild(bg)):((bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_equip/bg_equip.jpg")).setPosition(ccCenter(this)),this.addChild(bg));var keys=GameContext.getInstance().getGeneralKey();this.m_gnrl_key={},this.m_gnrl_key.gnrl_id=keys.gnrl_id,this.m_gnrl_key.gnrl_num=keys.num,this.m_equipLayer=new EquipmentLayer_WebV2,this.m_equipLayer.setPosition(ZERO()),this.addChild(this.m_equipLayer),this.m_equipLayer.setIsToDeck(this.m_isToDeck),this.setLayoutState(state,!0,!0);var statusLayer=new StatusLayer;statusLayer.initLayout(),statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer,33333);var back_btn=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png","");back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(sender){this.back()}.bind(this)),this.addChild(back_btn,33333);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_yh.png");title.setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title,33333),this.m_set_effect_modal_layer=new GameModalLayer,this.addChild(this.m_set_effect_modal_layer,999999),this.m_comfirmSellModalLayer=new GameModalLayer,this.addChild(this.m_comfirmSellModalLayer,99999),this.removeLayerProgress2()}.bind(this))},onNetworkEvent:function(opcode,state,body){if(this._super(opcode,state,body),opcode==net.OP.op_equipment_inventory_increase)this.showEquipmentInventoryIncreaseConfirm(body.user_equip_bound),this.m_equipLayer.updateEquipBoxUI();else if(opcode==net.OP.op_equipment_sell)body.error==net.ERROR.NET_E_EQUIPED?USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_not_use_wearing_equipment_text_1")):this.showCanNotUseWearingEquipmentMsgBox():body.error==net.ERROR.NET_E_LOCKED?USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_not_use_lock_equipment_text_1")):this.showCanNotUseLockEquipmentMsgBox():(this.showCompleteSellEquipmentMsgBox(),GameContext.getInstance().setEquipmentBatchSellCount(-1),this.m_equipLayer.setInitSellData(),this.m_equipLayer.setUserEquipmentList(),this.m_equipLayer.updateRightSellInfoLayer(),this.m_equipLayer.updateEquipBoxUI(),this.m_equipLayer.doSort(),this.m_equipLayer.updateEquipmentData(),this.m_equipLayer.updateSelectedEquipLayer(),this.m_equipLayer.updateWearingEquipLayer());else if(opcode==net.OP.op_equipment_lock)this.m_equipLayer.saveEquipmentListOffSet(),this.m_equipLayer.setUserEquipmentList(),this.m_equipLayer.doSort(),this.m_equipLayer.updateEquipmentData(),this.m_equipLayer.updateSelectedEquipLayer(),this.m_equipLayer.updateWearingEquipLayer(),this.m_equipLayer.setEquipmentListOffset();else if(opcode==net.OP.op_equipment_unlock)this.m_equipLayer.saveEquipmentListOffSet(),this.m_equipLayer.setUserEquipmentList(),this.m_equipLayer.doSort(),this.m_equipLayer.updateEquipmentData(),this.m_equipLayer.updateSelectedEquipLayer(),this.m_equipLayer.updateWearingEquipLayer(),this.m_equipLayer.setEquipmentListOffset();else if(opcode==net.OP.op_equipment_general_release)body.error==net.ERROR.NET_E_LACK_GOLD?this.showNotEnoughGold():body.error==net.ERROR.NET_E_NOT_FOUND_GENERAL?USE_POPUP_INTERGRATION?this.showGameScenePopup(res_str("label_information_title"),res_str("label_not_found_general_text_1")):this.showNotFoundGeneral():(this.m_equipLayer.setUserEquipmentList(),this.m_equipLayer.doSort(),this.m_equipLayer.setInitSellData(),this.m_equipLayer.updateEquipmentData(),this.m_equipLayer.updateSelectedEquipLayer(),this.m_equipLayer.updateWearingEquipLayer(),this.m_equipLayer.updateRightBottomBtn(EQUIP_LAYER_STATE.CHANGE),this.showCompleteTakeoffEquipmentMsgBox());else if(opcode==net.OP.op_equipment_general_equip)body.error==net.ERROR.NET_E_NOT_SAME_FORCE_TYPE?USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_not_same_force_type_text_1")):this.showNotSameForceTypeMsgBox():body.error==net.ERROR.NET_E_NOT_SAME_ELEMENT_TYPE?USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_not_same_element_type_text_1")):this.showNotSameElementTypeMsgBox():body.error==net.ERROR.NET_E_NOT_FOUND_EQUIPMENT||(body.error==net.ERROR.NET_E_LACK_GOLD?this.showNotEnoughGold():body.error==net.ERROR.NET_E_NOT_FOUND_GENERAL?USE_POPUP_INTERGRATION?this.showGameScenePopup(res_str("label_information_title"),res_str("label_not_found_general_text_1")):this.showNotFoundGeneral():body.error==net.ERROR.NET_E_EQUIPMENT_NOT_SAME_GENERAL_GROUP?USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_not_same_general_group_text_1"),res_str("label_equipment_not_same_general_group_text_2")):this.showNotSameGeneralGroupMsgBox():body.error==net.ERROR.NET_E_LOW_LOVE_LEVEL_FOR_EQUIPMENT?USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_low_love_level_text_1")):this.showLowLoveLevelMsgBox():body.error==net.ERROR.NET_E_GENERAL_IN_CAMP?USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_general_in_camp_text_1")):this.showGeneralInCampMsgBox():(this.m_equipLayer.setUserEquipmentList(),this.m_equipLayer.doSort(),this.m_equipLayer.setInitSellData(),this.m_equipLayer.updateEquipmentData(),this.m_equipLayer.updateSelectedEquipLayer(),this.m_equipLayer.updateWearingEquipLayer(),this.m_equipLayer.updateRightBottomBtn(EQUIP_LAYER_STATE.CHANGE),this.showCompleteWearEquipmentMsgBox()));else if(opcode==net.OP.op_equipment_general_change){if(body.error==net.ERROR.NET_E_NOT_SAME_FORCE_TYPE)return void(USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_not_same_force_type_text_1")):this.showNotSameForceTypeMsgBox());if(body.error==net.ERROR.NET_E_NOT_SAME_ELEMENT_TYPE)return void(USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_not_same_element_type_text_1")):this.showNotSameElementTypeMsgBox());if(body.error==net.ERROR.NET_E_NOT_FOUND_EQUIPMENT)return;if(body.error==net.ERROR.NET_E_LACK_GOLD)return void this.showNotEnoughGold();if(body.error==net.ERROR.NET_E_NOT_FOUND_GENERAL)return void(USE_POPUP_INTERGRATION?this.showGameScenePopup(res_str("label_information_title"),res_str("label_not_found_general_text_1")):this.showNotFoundGeneral());if(body.error==net.ERROR.NET_E_EQUIPMENT_NOT_SAME_GENERAL_GROUP)return void(USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_not_same_general_group_text_1"),res_str("label_equipment_not_same_general_group_text_2")):this.showNotSameGeneralGroupMsgBox());if(body.error==net.ERROR.NET_E_LOW_LOVE_LEVEL_FOR_EQUIPMENT)return void(USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_low_love_level_text_1")):this.showLowLoveLevelMsgBox());if(body.error==net.ERROR.NET_E_GENERAL_IN_CAMP)return void(USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_general_in_camp_text_1")):this.showGeneralInCampMsgBox());this.m_equipLayer.setUserEquipmentList(),this.m_equipLayer.doSort(),this.m_equipLayer.setInitSellData(),this.m_equipLayer.updateEquipmentData(),this.m_equipLayer.updateSelectedEquipLayer(),this.m_equipLayer.updateWearingEquipLayer(),this.m_equipLayer.updateRightBottomBtn(EQUIP_LAYER_STATE.CHANGE),this.showCompleteChangeEquipmentMsgBox()}else opcode==net.OP.op_equipment_levelup&&(body.error==net.ERROR.NET_E_EQUIPED?USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_not_use_wearing_equipment_text_1")):this.showCanNotUseWearingEquipmentMsgBox():body.error==net.ERROR.NET_E_LOCKED?USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_not_use_lock_equipment_text_1")):this.showCanNotUseLockEquipmentMsgBox():body.error==net.ERROR.NET_E_LACK_GOLD?this.showNotEnoughGold():body.error==net.ERROR.NET_E_NOT_FOUND_EQUIPMENT||(this.m_equipLayer.setInitSellData(),this.m_equipLayer.setUserEquipmentList(),this.m_equipLayer.doSort(),this.m_equipLayer.updateEquipBoxUI(),this.m_equipLayer.updateEquipLevelUpUI(),this.m_equipLayer.updateEquipmentData(),this.m_equipLayer.createLevelupEquipmentLayer(),this.showLevelUpEffect()))},onNotification:function(msg){switch(this._super(msg),msg){case EQUIP_NOTI_TYPE.NOTIFICATION_EQUIPMENT_CELL_TOUCHED:var gameContext=GameContext.getInstance();if(null!=this.m_equipLayer)if(this.m_equipLayer.getLayerState()==EQUIP_LAYER_STATE.MAIN)this.m_equipLayer.saveEquipmentListOffSet(),0<(equip_key=gameContext.getEquipmentKey()).equipment_item_idx&&(this.setLayoutState(EQUIP_LAYER_STATE.CHANGE,!1,!0),this.m_equipLayer.selectEquipment(equip_key.equipment_item_idx,equip_key.equipment_num),this.m_equipLayer.updateEquipmentData(),this.m_equipLayer.updateSelectedEquipLayer(),this.m_equipLayer.updateWearingEquipLayer(),this.m_equipLayer.updateRightBottomBtn(EQUIP_LAYER_STATE.CHANGE)),this.m_equipLayer.setEquipmentListOffset();else if(this.m_equipLayer.getLayerState()==EQUIP_LAYER_STATE.SELL){if(this.m_comfirmSellModalLayer.is_show())return!0;GameContext.getInstance().setEquipmentListInvoker(0),this.m_equipLayer.saveEquipmentListOffSet(),0<(equip_key=gameContext.getEquipmentKey()).equipment_item_idx&&(this.m_equipLayer.selectEquipment(equip_key.equipment_item_idx,equip_key.equipment_num),this.m_equipLayer.updateEquipmentData(),this.m_equipLayer.updateSelectedEquipLayer(),this.m_equipLayer.updateWearingEquipLayer()),this.m_equipLayer.setEquipmentListOffset()}else if(this.m_equipLayer.getLayerState()==EQUIP_LAYER_STATE.CHANGE){gameContext.setEquipmentListInvoker(0),this.m_equipLayer.saveEquipmentListOffSet(),0<(equip_key=gameContext.getEquipmentKey()).equipment_item_idx&&(this.m_equipLayer.selectEquipment(equip_key.equipment_item_idx,equip_key.equipment_num),this.m_equipLayer.updateEquipmentData(),this.m_equipLayer.updateSelectedEquipLayer(),this.m_equipLayer.updateWearingEquipLayer(),this.m_equipLayer.updateRightBottomBtn(EQUIP_LAYER_STATE.CHANGE)),this.m_equipLayer.setEquipmentListOffset()}else if(this.m_equipLayer.getLayerState()==EQUIP_LAYER_STATE.LEVELUP){gameContext.setEquipmentListInvoker(0),this.m_equipLayer.saveEquipmentListOffSet(),0<(equip_key=gameContext.getEquipmentKey()).equipment_item_idx&&(this.m_equip_key.equipment_item_idx=equip_key.equipment_item_idx,this.m_equip_key.equipment_num=equip_key.equipment_num,this.m_equipLayer.selectEquipment(equip_key.equipment_item_idx,equip_key.equipment_num),this.m_equipLayer.updateEquipmentData(),this.m_equipLayer.updateEquipBoxUI(),this.m_equipLayer.updateEquipLevelUpUI()),this.m_equipLayer.setEquipmentListOffset()}break;case EQUIP_NOTI_TYPE.EUQIP_SHOW_HELP:if(null!=this.m_equipLayer){this.m_equipLayer.getLayerState()==EQUIP_LAYER_STATE.MAIN?GameContext.getInstance().setHelpInfoIndexByCallIndex(207):this.m_equipLayer.getLayerState()==EQUIP_LAYER_STATE.LEVELUP&&GameContext.getInstance().setHelpInfoIndexByCallIndex(211);var scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null}break;case EQUIP_NOTI_TYPE.BTN_BATCH_SELL:null!=this.m_equipLayer&&this.m_equipLayer.getLayerState()==EQUIP_LAYER_STATE.MAIN&&this.showConfirmBatchSellEquipmentMsgBox();break;case EQUIP_NOTI_TYPE.BTN_SELL:this.showConfirmSellEquipmentMsgBox();break;case EQUIP_NOTI_TYPE.BTN_LOCK:var equip_key=this.m_equipLayer.getSelectedEquipment();this.m_isWearEquip=!1,0<equip_key.equipment_item_idx?this.showConfirmLockEquipmentMsgBox(equip_key):USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_not_selected_error_text_1"),res_str("label_equipment_not_selected_error_text_2")):this.showShouldSelectEquipmentMsgBox();break;case EQUIP_NOTI_TYPE.BTN_UNLOCK:equip_key=this.m_equipLayer.getSelectedEquipment();this.m_isWearEquip=!1,0<equip_key.equipment_item_idx?this.showConfirmUnlockEquipmentMsgBox(equip_key):USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_not_selected_error_text_1"),res_str("label_equipment_not_selected_error_text_2")):this.showShouldSelectEquipmentMsgBox();break;case EQUIP_NOTI_TYPE.BTN_LOCK_WEAR_EQUIP:equip_key=this.m_equipLayer.getWearingEquipment();this.m_isWearEquip=!0,0<equip_key.equipment_item_idx?this.showConfirmLockEquipmentMsgBox(equip_key):USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_not_selected_error_text_1"),res_str("label_equipment_not_selected_error_text_2")):this.showShouldSelectEquipmentMsgBox();case EQUIP_NOTI_TYPE.BTN_UNLOCK_WEAR_EQUIP:equip_key=this.m_equipLayer.getWearingEquipment();this.m_isWearEquip=!0,0<equip_key.equipment_item_idx?this.showConfirmUnlockEquipmentMsgBox(equip_key):USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_not_selected_error_text_1"),res_str("label_equipment_not_selected_error_text_2")):this.showShouldSelectEquipmentMsgBox();break;case EQUIP_NOTI_TYPE.BTN_INVENTORY_INC:null!=this.m_equipLayer&&this.m_equipLayer.getLayerState()==EQUIP_LAYER_STATE.MAIN&&this.showInventoryIncreaseMsgBox();break;case EQUIP_NOTI_TYPE.BTN_WEAR:equip_key=this.m_equipLayer.getSelectedEquipment();GameContext.getInstance().setEquipmentKey(equip_key.equipment_item_idx,equip_key.equipment_num),0<equip_key.equipment_item_idx?this.showConfirmWearEquipmentMsgBox(equip_key):USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_not_selected_error_text_1"),res_str("label_equipment_not_selected_error_text_2")):this.showShouldSelectEquipmentMsgBox();break;case EQUIP_NOTI_TYPE.BTN_TAKE_OFF:equip_key=this.m_equipLayer.getSelectedEquipment();GameContext.getInstance().setEquipmentKey(equip_key.equipment_item_idx,equip_key.equipment_num),0<equip_key.equipment_item_idx?this.showConfirmTakeoffEquipmentMsgBox(equip_key):USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_not_selected_error_text_1"),res_str("label_equipment_not_selected_error_text_2")):this.showShouldSelectEquipmentMsgBox();break;case EQUIP_NOTI_TYPE.BTN_CHANGE:equip_key=this.m_equipLayer.getSelectedEquipment();GameContext.getInstance().setEquipmentKey(equip_key.equipment_item_idx,equip_key.equipment_num),0<equip_key.equipment_item_idx?this.showConfirmChangeEquipmentMsgBox(equip_key):USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_not_selected_error_text_1"),res_str("label_equipment_not_selected_error_text_2")):this.showShouldSelectEquipmentMsgBox();break;case EQUIP_NOTI_TYPE.BTN_NOT_SAME_GENERAL_GROUP:USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_not_same_general_group_text_1"),res_str("label_equipment_not_same_general_group_text_2")):this.showNotSameGeneralGroupMsgBox();break;case EQUIP_NOTI_TYPE.BTN_NOT_SAME_ARM_SERVICE_TYPE:USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_not_same_force_type_text_1")):this.showNotSameForceTypeMsgBox();break;case EQUIP_NOTI_TYPE.BTN_EQUIPMENT_NOT_SELECTED:USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_not_select_title"),res_str("label_not_select_equipment_text_1"),res_str("label_not_select_equipment_text_2")):this.showNotSelectedEquipmentMsgBox();break;case EQUIP_NOTI_TYPE.BTN_SET_EFFECT:this.m_isWearEquip=!1,this.showSetEffectLayer();break;case EQUIP_NOTI_TYPE.BTN_SET_EFFECT_WEAR_EQUIP:this.m_isWearEquip=!0,this.showSetEffectLayer();break;case EQUIP_NOTI_TYPE.OVER_MAX_COUNT:USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_over_max_count_text_1")):this.showOverMaxCountMsgBox();break;case EQUIP_NOTI_TYPE.EUQIP_SHOW_HELP_AT_SET_EFFECT:GameContext.getInstance().setHelpInfoIndexByCallIndex(212);scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null;break;case EQUIP_NOTI_TYPE.BTN_LEVELUP:if(this.m_equipLayer.getLayerState()==EQUIP_LAYER_STATE.CHANGE){equip_key=this.m_equipLayer.getSelectedEquipment();GameContext.getInstance().setEquipmentKey(equip_key.equipment_item_idx,equip_key.equipment_num);var equip={};if(EquipmentService.getInstance().getUserEquipmentInfo(equip_key,equip),equip.max_level<=equip.level)return void MainObserver.getInstance().postNotification(EQUIP_NOTI_TYPE.OVER_MAX_LEVEL);0<equip_key.equipment_item_idx?(this.m_equip_key.equipment_item_idx=equip_key.equipment_item_idx,this.m_equip_key.equipment_num=equip_key.equipment_num,this.setLayoutState(EQUIP_LAYER_STATE.LEVELUP,!0,!0)):USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_error_title"),res_str("label_equipment_not_selected_error_text_1"),res_str("label_equipment_not_selected_error_text_2")):this.showShouldSelectEquipmentMsgBox()}else this.m_equipLayer.getLayerState()==EQUIP_LAYER_STATE.LEVELUP&&this.showConfirmLevelupEquipmentMsgBox();break;case EQUIP_NOTI_TYPE.OVER_MAX_LEVEL:USE_POPUP_INTERGRATION?this.showEquipmentPopup(res_str("label_equipment_levelup_error_title"),res_str("label_equipment_over_max_level_text_1"),res_str("label_equipment_over_max_level_text_2")):this.showIsEquipmentMaxLevel();break;case EQUIP_NOTI_TYPE.BTN_CANCEL:this.m_isToDeck?this.back():(this.setLayoutState(EQUIP_LAYER_STATE.CHANGE,!0,!0),this.m_equipLayer.setEquipmentListSubOffset())}},onNotifySetLayer:function(msg){switch(msg){case EQUIP_LAYER_STATE.MAIN:this.setLayoutState(EQUIP_LAYER_STATE.MAIN,!1,!0);break;case EQUIP_LAYER_STATE.SELL:this.setLayoutState(EQUIP_LAYER_STATE.SELL,!1,!0);break;case EQUIP_LAYER_STATE.CHANGE:this.setLayoutState(EQUIP_LAYER_STATE.CHANGE,!1,!0);break;case EQUIP_LAYER_STATE.LEVELUP:this.setLayoutState(EQUIP_LAYER_STATE.LEVELUP,!1,!0)}},setLayoutState:function(state,isInit,isUpdate){null==state&&EQUIP_LAYER_STATE.MAIN,null==isUpdate&&(isUpdate=!0),null==isInit&&(isInit=!1);for(var stateList=[],i=0;i<this.m_EquipLayerStateList.length&&this.m_EquipLayerStateList[i]!=state;i++)stateList.push(this.m_EquipLayerStateList[i]);this.m_EquipLayerStateList=[],this.m_EquipLayerStateList=stateList,this.m_EquipLayerStateList.push(state),this.m_cur_LayerState=state;var preLayerState=this.m_equipLayer.getLayerState(),prevParts=this.m_equipLayer.getCurrentPartsFilter(),prevTab=this.m_equipLayer.getCurrentTabFilter(),isFound=!1;for(i=0;i<this.m_prevSetFliter.length;i++)if(this.m_prevSetFliter[i].prevLayer==preLayerState){isFound=!0,this.m_prevSetFliter[i].prevLayer=preLayerState,this.m_prevSetFliter[i].prevParts=prevParts,this.m_prevSetFliter[i].prevTab=prevTab;break}if(!isFound){var prevSetFliter={prevLayer:preLayerState,prevParts:prevParts,prevTab:prevTab};this.m_prevSetFliter.push(prevSetFliter)}var isPrevFound=!1;for(i=0;i<this.m_prevSetFliter.length;i++)if(this.m_prevSetFliter[i].prevLayer==state){isPrevFound=!0;break}if(isPrevFound&&state==EQUIP_LAYER_STATE.MAIN){var prevSet=[],initSetFliter=!1;for(i=0;i<this.m_prevSetFliter.length;i++)if(this.m_prevSetFliter[i].prevLayer==state){prevSetFliter={prevLayer:this.m_prevSetFliter[i].prevLayer,prevParts:this.m_prevSetFliter[i].prevParts,prevTab:this.m_prevSetFliter[i].prevTab};prevSet.push(prevSetFliter),initSetFliter=!0;break}1==initSetFliter&&(this.m_prevSetFliter=[],this.m_prevSetFliter=prevSet)}switch(state){case EQUIP_LAYER_STATE.MAIN:case EQUIP_LAYER_STATE.CHANGE:case EQUIP_LAYER_STATE.SELL:if(isInit&&this.m_equipLayer.setInitLayer(state),isUpdate){if(isPrevFound)for(i=0;i<this.m_prevSetFliter.length;i++)if(this.m_prevSetFliter[i].prevLayer==state){this.m_equipLayer.setFliterState(this.m_prevSetFliter[i].prevTab,this.m_prevSetFliter[i].prevParts);break}this.m_equipLayer.setLayerState(state)}break;case EQUIP_LAYER_STATE.LEVELUP:isInit&&this.m_equipLayer.setInitLayer(state),isUpdate&&this.m_equipLayer.setLayerState(state)}},onExit:function(){this._super(),1!=PREV_HELP&&1!=PREV_EQUIP_SHOP&&1!=PREV_ACHIVE_EQUIP&&(this.m_gnrl_key=null,this.m_equipLayer=null,this.m_EquipLayerStateList=[],this.m_items=[],this.m_checkImgs=[],this.m_selected_grades=[],this.m_selected_equip_types=[],this.m_selected_option_steps=[],this.m_selected_mtrl_grades=[],this.m_checkGrades=[],this.m_checkEquipTypes=[],this.m_checkOptionSteps=[],this.m_checkCount=[],this.m_checkMtrlGrade=[],this.m_checkBatchSellModalLayer=null,this.m_set_effect_modal_layer=null,this.m_comfirmSellModalLayer=null,this.m_equip_key=null,this.m_levelUpEffectLayer=null,this.m_skeletonLevelupEffectNode=null)},back:function(){if(this.m_isPushScene)SceneManager.getInstance().popScene();else if(this.m_isToDeck)this.onKeyBack(!0);else{if(this.m_EquipLayerStateList[this.m_EquipLayerStateList.length-1]!=EQUIP_LAYER_STATE.MAIN)return this.m_EquipLayerStateList[this.m_EquipLayerStateList.length-2]==EQUIP_LAYER_STATE.CHANGE?(this.m_equipLayer.setLevelUpToChangeData(),this.setLayoutState(this.m_EquipLayerStateList[this.m_EquipLayerStateList.length-2],!0,!0),void this.m_equipLayer.setEquipmentListSubOffset()):void this.setLayoutState(this.m_EquipLayerStateList[this.m_EquipLayerStateList.length-2],!1,!0);this.onKeyBack(!0)}},showSetEffectLayer:function(){this.m_set_effect_modal_layer.setContentSize(ccSize(this)),this.m_set_effect_modal_layer._contentNode=function(contentSize,m){return this.getSetEffectLayer()}.bind(this),this.m_set_effect_modal_layer.show()},getSetEffectLayer:function(){var layer=new cc.Layer,equip_key={};equip_key=1==this.m_isWearEquip?this.m_equipLayer.getWearingEquipment():this.m_equipLayer.getSelectedEquipment();var bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_2.png",RectZero());bg.setPreferredSize(cc.size(722,456)),bg.setPosition(ccCenter(layer)),layer.addChild(bg);var back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(bg)-5,ccHeight(bg)-5),bg.addChild(back_btn),back_btn.addClickEventListener(function(sender){this.m_set_effect_modal_layer.hide()}.bind(this));var help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE);help_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),help_btn.setPosition(ccPos(back_btn).x-ccWidth(help_btn)-10,ccPos(back_btn).y-2),bg.addChild(help_btn),help_btn.addClickEventListener(function(sender){this.scheduleOnce(function(){PREV_HELP=!0,MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.EUQIP_SHOW_HELP_AT_SET_EFFECT)},0,"EUQIP_SHOW_HELP_AT_SET_EFFECT")}.bind(this));var navi=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_info_box_8.png",cc.Rect(10,4,4,20));navi.setInsetLeft(5),navi.setInsetRight(20),navi.setPreferredSize(cc.size(322,31)),navi.setAnchorPoint(ANCHOR_TOP_LEFT()),navi.setPosition(0,ccHeight(bg)-5),bg.addChild(navi);var equip_info={};EquipmentService.getInstance().getUserEquipmentInfo(equip_key,equip_info);var font_index=LABEL_FONT_INDEX.FONT_201,title_label=cmLabel.getLabel(res_str("label_equipment_set_title"),font_index);title_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),title_label.setPosition(20,ccCenter(navi).y),navi.addChild(title_label);var mt=MasterManager.getInstance(),equip_group_idx=0;0!=equip_info.option_num1&&(equip_group_idx=mt.get_EquipmentItemOption(equip_info.option_id1,equip_info.option_num1).equip_group_idx);for(var equipment_list=MasterTable.getInstance().get_EquipmentItemGroup(equip_group_idx),item_pos_y=332,idx=0;idx<equipment_list.length;idx++){var item=equipment_list[idx],item_layer=this.getEquipmentListItem(item,equip_info.equip_rare_type);item_layer.setAnchorPoint(ZERO()),item_layer.setPosition(20,item_pos_y),bg.addChild(item_layer),item_pos_y-=ccHeight(item_layer)}var group_list=MasterTable.getInstance().get_EquipmentGroupList(equip_group_idx),right_layer=this.getSetEffectRightLayer(group_list);return right_layer.setPosition(346,20),bg.addChild(right_layer),layer},getEquipmentListItem:function(item,rare_type){var layer=new cc.Layer,bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());bg.setPreferredSize(cc.size(316,78)),bg.setAnchorPoint(ZERO()),bg.setPosition(ZERO()),layer.addChild(bg),layer.setContentSize(ccSize(bg));var card_info={};card_info.equip_id=item.equipment_item_idx,card_info.arm_service_type=0,card_info.equip_group=item.equip_group_idx,card_info.equip_parts_type=item.equipment_parts_type,card_info.equip_rare_type=item.equipment_rare_type,card_info.equip_type=item.equipment_type,card_info.level=0,card_info.step=0,card_info.image=item.img,card_info.property_img=item.property_img;var equip_icon=CardEquipment.getInstance().createCardEquipment(card_info,EQUIPMENT_CARD_TYPE.type_card_small);equip_icon.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),equip_icon.setPosition(10,ccCenter(bg).y),bg.addChild(equip_icon);var name_label=cmLabel.getLabel(item.name,LABEL_FONT_INDEX.FONT_181);return name_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),name_label.setPosition(85,ccCenter(bg).y),bg.addChild(name_label),layer},getSetEffectRightLayer:function(group_list){var layer=new cc.Layer,bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());bg.setPreferredSize(cc.size(356,390)),bg.setAnchorPoint(ZERO()),bg.setPosition(ZERO()),layer.addChild(bg),layer.setContentSize(ccSize(bg));var label_pos_y=ccHeight(bg)-20,title_label=cmLabel.getLabel(res_str("label_equipment_set_effect_title"),LABEL_FONT_INDEX.FONT_2013);title_label.setAnchorPoint(ANCHOR_TOP_LEFT()),title_label.setPosition(20,label_pos_y),bg.addChild(title_label),label_pos_y-=ccHeight(title_label)+10;var group_indx=0;0!=group_list.length&&(group_indx=group_list[0].equip_group_idx);for(var set_count=0,es=EquipmentService.getInstance(),equip_info_list=es.getUserGeneralEquipmentListInfo(this.m_gnrl_key),idx=0;idx<equip_info_list.length;idx++){var equip=equip_info_list[idx],equip_key={};equip_key.equipment_item_idx=equip.equip_id,equip_key.equipment_num=equip.equip_num;var user_equip_info={};es.getUserEquipmentInfo(equip_key,user_equip_info),user_equip_info.equip_group==group_indx&&set_count++}var mt=MasterManager.getInstance(),max_group_equip_count=0;for(idx=0;idx<group_list.length;idx++){max_group_equip_count<(group=group_list[idx]).equip_count&&(max_group_equip_count=group.equip_count)}for(idx=0;idx<group_list.length;idx++){var group=group_list[idx],combo_stat=mt.get_ComboStat(group.combo_stat),added_value=group.added_value;"y"==group.use_10000_ratio_yn&&(added_value=(.01*group.added_value).toFixed(1));var content_label=cmLabel.getLabel(group.equip_count+" 部位装着時、"+combo_stat.name+" "+added_value+"%増加",LABEL_FONT_INDEX.FONT_181);content_label.setAnchorPoint(ANCHOR_TOP_LEFT()),content_label.setPosition(20,label_pos_y),bg.addChild(content_label),(set_count==group.equip_count||max_group_equip_count<=set_count&&max_group_equip_count==group.equip_count)&&content_label.setColor(COLOR(1412)),label_pos_y-=ccHeight(content_label)+10}return layer},showConfirmSellEquipmentMsgBox:function(){this.m_comfirmSellModalLayer.setContentSize(ccSize(this)),this.m_comfirmSellModalLayer._contentNode=function(contentSize,m){return this.getConfirmSellEquipmentLayer()}.bind(this),this.m_comfirmSellModalLayer.show()},getConfirmSellEquipmentLayer:function(){var layer=new cc.Layer,bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,40,40));bg.setPreferredSize(cc.size(SELL_MAX_MSG_BOX_WIDTH,SELL_MAX_MSG_BOX_HEIGHT)),bg.setPosition(ccCenter(layer)),layer.addChild(bg);var navi=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_navi.png",RectZero());navi.setPreferredSize(cc.size(942,48)),navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(bg).x,ccHeight(bg)-11),bg.addChild(navi);var title_label=cmLabel.getLabel(res_str("label_equipment_sell_title"),LABEL_FONT_INDEX.FONT_261);title_label.setAnchorPoint(ANCHOR_MIDDLE()),title_label.setPosition(ccCenter(navi).x,ccCenter(navi).y+3),navi.addChild(title_label);var content_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());content_bg.setPreferredSize(cc.size(918,334)),content_bg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),content_bg.setPosition(ccCenter(bg).x,156),bg.addChild(content_bg);var cell_size=cc.size(SELL_CELL_SIZE_WIDTH,SELL_CELL_SIZE_HEIGHT),list=this.m_equipLayer.getSellEquipmentListInfo(),sell_equip_list=$.extend([],list),equipSellListLayer=new EquipmentListLayerV2_WebV2;equipSellListLayer.setCellSizeAndColumnCount(cell_size,SELL_COLUMN_COUNT),equipSellListLayer.initLayout(cc.size(SELL_CELL_SIZE_WIDTH,324)),equipSellListLayer.setEquipmentData(sell_equip_list),equipSellListLayer.setAnchorPoint(ANCHOR_MIDDLE()),equipSellListLayer.setPosition(ccCenter(content_bg)),content_bg.addChild(equipSellListLayer);var sell_obj=this.m_equipLayer.getSellEquipmentsInfo(),equip_count=sell_obj.equip_count,gold_count=sell_obj.gold_count,text_text=new cmMultiLabel;if(text_text.addLabel("選択中の ",LABEL_FONT_INDEX.FONT_241),text_text.addLabel(Number(equip_count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_2425),text_text.addLabel(" 個の装備を",LABEL_FONT_INDEX.FONT_241),text_text.addLabel(" 金貨 "+Number(gold_count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_2425),text_text.addLabel("で 売却しますか？",LABEL_FONT_INDEX.FONT_241),text_text.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),text_text.setLabel(),text_text.setPosition(ccCenter(bg).x/2,114),bg.addChild(text_text),this.m_equipLayer.checkOver2StepEquipment()){var text_1=cmLabel.getLabel(res_str("label_equipment_warning_over_2_rare_type_text"),LABEL_FONT_INDEX.FONT_1613);text_1.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),text_1.setPosition(ccCenter(bg).x,88),bg.addChild(text_1)}var btn_no=new LabelButton("btn_08_off.png","btn_08_on.png","",ccui.Widget.PLIST_TEXTURE);btn_no.setFont(LABEL_FONT_INDEX.FONT_241),btn_no.setString(res_str("btn_label_cancel")),btn_no.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),btn_no.setPosition(ccCenter(bg).x-5,16),btn_no.addClickEventListener(function(sender){this.m_comfirmSellModalLayer.hide()}.bind(this)),bg.addChild(btn_no);var btn_yes=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);return btn_yes.setFont(LABEL_FONT_INDEX.FONT_241),btn_yes.setString(res_str("btn_label_confirm")),btn_yes.setAnchorPoint(ZERO()),btn_yes.setPosition(ccCenter(bg).x+5,16),bg.addChild(btn_yes),btn_yes.addClickEventListener(function(sender){this.scheduleOnce(function(float){this.sendPacketSellEquipment(),this.m_comfirmSellModalLayer.hide()},0,"sendPacketSellEquipment")}.bind(this)),layer},showConfirmBatchSellEquipmentMsgBox:function(){var equip_tap_type=GameContext.getInstance().getEquipmentTabType();this.m_checkBatchSellModalLayer.setContentSize(ccSize(this)),this.m_checkBatchSellModalLayer._contentNode=function(contentSize,m){return 1==equip_tap_type?this.getCheckBatchSellCountLayerV2():this.getCheckBatchSellMtrlLayer()}.bind(this),this.m_checkBatchSellModalLayer.show()},getCheckBatchSellCountLayerV2:function(){var layer=new cc.Layer;this.m_selected_item=0,this.m_selected_grades=[],this.m_selected_equip_types=[],this.m_selected_option_steps=[],this.m_selected_mtrl_grades=[],this.m_checkGrades=[],this.m_checkEquipTypes=[],this.m_checkOptionSteps=[],this.m_checkCount=[];var game=GameDefault.getInstance(),gs=game.getEquipmentBatchSellGrade(),ets=game.getEquipmentBatchSellEquipType(),ss=game.getEquipmentBatchSellOptSteps(),ct=parseInt(game.getEquipmentBatchSellCount()),bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));bg.setPreferredSize(cc.size(MAX_MSG_BOX_WIDTH,480)),bg.setPosition(ccCenter(layer)),layer.addChild(bg);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_3.png");navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(bg).x,ccHeight(bg)-11),bg.addChild(navi);var title_label=cmLabel.getLabel(res_str("btn_label_batch_sell"),LABEL_FONT_INDEX.FONT_261);title_label.setAnchorPoint(ANCHOR_MIDDLE()),title_label.setPosition(ccCenter(navi).x,ccCenter(navi).y+3),navi.addChild(title_label);var text_1=cmLabel.getLabel(res_str("label_equipment_batch_sell_text_1"),LABEL_FONT_INDEX.FONT_227);text_1.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),text_1.setPosition(ccCenter(bg).x,387),bg.addChild(text_1);var text_2=cmLabel.getLabel(res_str("label_equipment_batch_sell_text_2"),LABEL_FONT_INDEX.FONT_227);text_2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),text_2.setPosition(ccCenter(bg).x,357),bg.addChild(text_2);var str=[],offset_x=230,offset_y=310;str.clear(),str.push_back(res_str("label_equipment_batch_sell_star_1")),str.push_back(res_str("label_equipment_batch_sell_star_2"));for(var i=0;i<str.length;i++){(label=cmLabel.getLabel(str[i],LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),label.setPosition(offset_x,offset_y),bg.addChild(label);var off=RES_CDN_DEFULT+"common/img_checkbox.png",on=RES_CDN_DEFULT+"common/img_checkbox.png",none=RES_CDN_DEFULT+"common/img_checkbox.png",check=cc.Sprite.create(RES_CDN_DEFULT+"common/img_check.png");(btn=new ccui.Button(off,on,none)).setTag(i),btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn.setPosition(offset_x+ccWidth(label),offset_y-6),bg.addChild(btn),btn.addClickEventListener(function(sender){var index=sender.getTag();this.setSelectedGrade(index+1)}.bind(this)),check.setAnchorPoint(ANCHOR_MIDDLE()),check.setPosition(ccCenter(btn)),check.setVisible(!1),btn.addChild(check),this.m_checkGrades.push(check),offset_x+=ccWidth(label)+ccWidth(btn)+20}if(0<gs.length)for(var idx=0;idx<gs.length;idx++)this.setSelectedGrade(gs[idx]);else this.setSelectedGrade(1);offset_y-=80,offset_x=66,(str=[]).push(res_str("label_equipment_armor")),str.push(res_str("label_equipment_accessory")),str.push(res_str("label_equipment_shield")),str.push(res_str("label_equipment_jewerly")),str.push(res_str("label_equipment_weapon"));var e_types=[];e_types.push(2),e_types.push(3),e_types.push(4),e_types.push(5),e_types.push(1);for(i=0;i<str.length;i++){(label=cmLabel.getLabel(str[i],LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),label.setPosition(offset_x,offset_y),bg.addChild(label);off=RES_CDN_DEFULT+"common/img_checkbox.png",on=RES_CDN_DEFULT+"common/img_checkbox.png",check=cc.Sprite.create(RES_CDN_DEFULT+"common/img_check.png");(btn=new ccui.Button(off,on)).setTag(i),btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn.setPosition(offset_x+ccWidth(label),offset_y-6),bg.addChild(btn),btn.addClickEventListener(function(sender){var index=sender.getTag();this.setSelectedEquipType(e_types[index])}.bind(this)),check.setAnchorPoint(ANCHOR_MIDDLE()),check.setPosition(ccCenter(btn).x,ccCenter(btn).y),check.setVisible(!1),check.setTag(e_types[i]),btn.addChild(check),this.m_checkEquipTypes.push(check),offset_x+=ccWidth(label)+ccWidth(btn)+20}if(0<ets.length)for(i=0;i<ets.length;i++){var e=ets[i];this.setSelectedEquipType(e)}else this.setSelectedEquipType(2),this.setSelectedEquipType(3),this.setSelectedEquipType(4),this.setSelectedEquipType(5);offset_y-=66,offset_x=50,(str=[]).push("+0"),str.push("+1"),str.push("+2"),str.push("+3"),str.push("+4"),str.push("+5");for(i=0;i<str.length;i++){(label=cmLabel.getLabel(str[i],LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),label.setPosition(offset_x,offset_y),bg.addChild(label);off=RES_CDN_DEFULT+"common/img_checkbox.png",on=RES_CDN_DEFULT+"common/img_checkbox.png",none=RES_CDN_DEFULT+"common/img_checkbox.png",check=cc.Sprite.create(RES_CDN_DEFULT+"common/img_check.png");(btn=new ccui.Button(off,on,none)).setTag(i),btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn.setPosition(offset_x+ccWidth(label),offset_y-6),bg.addChild(btn),btn.addClickEventListener(function(sender){var index=sender.getTag();this.setSelectedOptStep(index)}.bind(this)),check.setAnchorPoint(ANCHOR_MIDDLE()),check.setPosition(ccCenter(btn)),check.setVisible(!1),btn.addChild(check),this.m_checkOptionSteps.push(check),offset_x+=ccWidth(label)+ccWidth(btn)+20}if(0<ss.length)for(i=0;i<ss.length;i++){var t=ss[i];this.setSelectedOptStep(t)}else this.setSelectedOptStep(0);offset_y-=66,offset_x=60;for(i=0;i<EQUIP_MAX_BATCH_SELL_KIND;i++){var label;(label=cmLabel.getLabel(cmString(res_str("label_count"),this.m_items[i]),LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),label.setPosition(offset_x,offset_y),bg.addChild(label);var btn;off=RES_CDN_DEFULT+"common/img_checkbox.png",on=RES_CDN_DEFULT+"common/img_checkbox.png",check=cc.Sprite.create(RES_CDN_DEFULT+"common/img_check.png");(btn=new ccui.Button(off,on)).setTag(i),btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn.setPosition(offset_x+ccWidth(label),offset_y-6),bg.addChild(btn),btn.addClickEventListener(function(sender){var index=sender.getTag();this.setSelectedCount(index)}.bind(this)),check.setAnchorPoint(ANCHOR_MIDDLE()),check.setPosition(ccCenter(btn)),check.setVisible(!1),btn.addChild(check),this.m_checkCount.push(check),offset_x+=ccWidth(label)+ccWidth(btn)+20}this.setSelectedCount(ct);var btn_no=new LabelButton("btn_08_off.png","btn_08_on.png","",ccui.Widget.PLIST_TEXTURE);btn_no.setFont(LABEL_FONT_INDEX.FONT_241),btn_no.setString(res_str("btn_label_cancel")),btn_no.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),btn_no.setPosition(ccCenter(bg).x-5,16),btn_no.addClickEventListener(function(sender){this.m_checkGrades=[],this.m_checkEquipTypes=[],this.m_checkOptionSteps=[],this.m_checkCount=[];var context=GameContext.getInstance();context.setEquipmentBatchSellCount(0),this.m_selected_grades=[],context.setEquipmentBatchSellGrade(this.m_selected_grades),this.m_selected_equip_types=[],context.setEquipmentBatchSellEquipType(this.m_selected_equip_types),this.m_selected_option_steps=[],context.setEquipmentBatchSellOptStep(this.m_selected_option_steps),this.m_checkBatchSellModalLayer.hide()}.bind(this)),bg.addChild(btn_no);var btn_yes=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);return btn_yes.setFont(LABEL_FONT_INDEX.FONT_241),btn_yes.setString(res_str("btn_label_confirm")),btn_yes.setAnchorPoint(ZERO()),btn_yes.setPosition(ccCenter(bg).x+5,16),btn_yes.addClickEventListener(function(sender){var context=GameContext.getInstance();context.setEquipmentBatchSellCount(this.m_items[this.m_selected_item]),context.setEquipmentBatchSellGrade(this.m_selected_grades),context.setEquipmentBatchSellEquipType(this.m_selected_equip_types),context.setEquipmentBatchSellOptStep(this.m_selected_option_steps),context.setEquipmentBatchSellMtrlGrade(this.m_selected_mtrl_grades);var gd=GameDefault.getInstance();gd.setEquipmentBatchSellGrade(this.m_selected_grades),gd.setEquipmentBatchSellEquipType(this.m_selected_equip_types),gd.setEquipmentBatchSellOptSteps(this.m_selected_option_steps),gd.setEquipmentBatchSellCount(this.m_selected_item),this.scheduleOnce(function(float){this.setLayoutState(EQUIP_LAYER_STATE.SELL,!1,!0)}.bind(this),.01,"pushEquipmentSellScene"),this.m_checkGrades=[],this.m_checkEquipTypes=[],this.m_checkOptionSteps=[],this.m_checkCount=[],this.m_checkBatchSellModalLayer.hide()}.bind(this)),bg.addChild(btn_yes),layer},getCheckBatchSellCountLayer:function(){var layer=new cc.Layer,bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.rect(40,40,10,10));bg.setPreferredSize(cc.size(EQUIP_MAX_MSG_BOX_WIDTH,EQUIP_MAX_MSG_BOX_HEIGHT)),bg.setPosition(ccCenter(layer)),layer.addChild(bg);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_3.png");navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(bg).x,ccHeight(bg)-11),bg.addChild(navi);var title_label=cmLabel.getLabel(res_str("btn_label_batch_sell"),LABEL_FONT_INDEX.FONT_261);title_label.setAnchorPoint(ANCHOR_MIDDLE()),title_label.setPosition(ccCenter(navi).x,ccCenter(navi).y+3),navi.addChild(title_label);var text_1=cmLabel.getLabel(res_str("label_check_batch_sell_text_1"),LABEL_FONT_INDEX.FONT_241);text_1.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),text_1.setPosition(ccCenter(bg).x,242),bg.addChild(text_1);var text_2=cmLabel.getLabel(res_str("label_check_batch_sell_text_2"),LABEL_FONT_INDEX.FONT_241);text_2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),text_2.setPosition(ccCenter(bg).x,212),bg.addChild(text_2);for(var offset_x=70,i=0;i<EQUIP_MAX_BATCH_SELL_KIND;i++){var label=cmLabel.getLabel(cmString(res_str("label_count"),this.m_items[i]),LABEL_FONT_INDEX.FONT_241);label.setAnchorPoint(ZERO()),label.setPosition(offset_x,137),bg.addChild(label);var check_img_1=cc.Sprite.create(RES_CDN_DEFULT+"common/img_check.png");check_img_1.setVisible(this.m_is_partner_select),check_img_1.setPosition(20,18);var check_btn=new ccui.Button(RES_CDN_DEFULT+"common/img_checkbox.png");check_btn.addChild(check_img_1),check_btn.setAnchorPoint(ZERO()),check_btn.setPosition(ccPosX(label)+ccWidth(label),131),check_btn.setTag(i),bg.addChild(check_btn),check_btn.addClickEventListener(function(sender){this.setSelectedItemCount(sender.getTag())}.bind(this)),this.m_checkImgs.push(check_img_1),offset_x+=ccWidth(label)+ccWidth(check_btn)+20}this.setSelectedItemCount(1);var btn_no=new LabelButton("btn_08_off.png","btn_08_on.png","",ccui.Widget.PLIST_TEXTURE);btn_no.setFont(LABEL_FONT_INDEX.FONT_241),btn_no.setString(res_str("btn_label_cancel")),btn_no.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),btn_no.setPosition(ccCenter(bg).x-5,16),btn_no.addClickEventListener(function(sender){this.m_selected_item=0,this.m_checkImgs=[],this.m_checkBatchSellModalLayer.hide()}.bind(this)),bg.addChild(btn_no);var btn_yes=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);return btn_yes.setFont(LABEL_FONT_INDEX.FONT_241),btn_yes.setString(res_str("btn_label_confirm")),btn_yes.setAnchorPoint(ZERO()),btn_yes.setPosition(ccCenter(bg).x+5,16),bg.addChild(btn_yes),btn_yes.addClickEventListener(function(sender){this.scheduleOnce(function(float){GameContext.getInstance().setEquipmentBatchSellCount(this.m_items[this.m_selected_item]),this.setLayoutState(EQUIP_LAYER_STATE.SELL,!1,!0),this.m_selected_item=0,this.m_checkImgs=[],this.m_checkBatchSellModalLayer.hide()},0,"pushEquipmentSellScene")}.bind(this)),layer},getCheckBatchSellMtrlLayer:function(){this.m_selected_item=0,this.m_selected_grades=[],this.m_selected_equip_types=[],this.m_selected_option_steps=[],this.m_selected_mtrl_grades=[],this.m_checkGrades=[],this.m_checkEquipTypes=[],this.m_checkOptionSteps=[],this.m_checkCount=[],this.m_checkMtrlGrade=[];var game=GameDefault.getInstance(),ct=parseInt(game.getEquipmentBatchSellMtrlCount()),mtrl_grades=game.getEquipmentBatchSellMtrlGrade(),layer=new cc.Layer,bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));bg.setPreferredSize(cc.size(MAX_MSG_BOX_WIDTH,380)),bg.setPosition(ccCenter(layer)),layer.addChild(bg);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_3.png");navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(bg).x,ccHeight(bg)-11),bg.addChild(navi);var title_label=cmLabel.getLabel(res_str("btn_label_batch_sell"),LABEL_FONT_INDEX.FONT_261);title_label.setAnchorPoint(ANCHOR_MIDDLE()),title_label.setPosition(ccCenter(navi).x,ccCenter(navi).y+3),navi.addChild(title_label);var text_1=cmLabel.getLabel(res_str("label_equipment_batch_sell_text_1"),LABEL_FONT_INDEX.FONT_227);text_1.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),text_1.setPosition(ccCenter(bg).x,282),bg.addChild(text_1);var text_2=cmLabel.getLabel(res_str("label_equipment_batch_sell_text_2"),LABEL_FONT_INDEX.FONT_227);text_2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),text_2.setPosition(ccCenter(bg).x,252),bg.addChild(text_2);var str=[],offset_x=150,offset_y=190;str.clear(),str.push(res_str("label_equipment_mtrl_grade_1")),str.push(res_str("label_equipment_mtrl_grade_2")),str.push(res_str("label_equipment_mtrl_grade_3")),str.push(res_str("label_equipment_mtrl_grade_4"));for(var i=0;i<str.length;i++){(label=cmLabel.getLabel(str[i],LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),label.setPosition(offset_x,offset_y),bg.addChild(label);var off=RES_CDN_DEFULT+"common/img_checkbox.png",on=RES_CDN_DEFULT+"common/img_checkbox.png",none=RES_CDN_DEFULT+"common/img_checkbox.png",check=cc.Sprite.create(RES_CDN_DEFULT+"common/img_check.png");(btn=new ccui.Button(off,on,none)).setTag(i),btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn.setPosition(offset_x+ccWidth(label),offset_y-6),bg.addChild(btn),btn.addClickEventListener(function(sender){var index=sender.getTag();this.setSelectedMtrlGrade(index+1)}.bind(this)),check.setAnchorPoint(ANCHOR_MIDDLE()),check.setPosition(ccCenter(btn)),check.setVisible(!1),btn.addChild(check),this.m_checkMtrlGrade.push(check),offset_x+=ccWidth(label)+ccWidth(btn)+20}if(0<mtrl_grades.length)for(var idx=0;idx<mtrl_grades.length;idx++)this.setSelectedMtrlGrade(mtrl_grades[idx]);else this.setSelectedMtrlGrade(1);offset_y-=60,offset_x=60;for(i=0;i<EQUIP_MAX_BATCH_SELL_KIND;i++){var label;(label=cmLabel.getLabel(cmString(res_str("label_count"),this.m_items[i]),LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),label.setPosition(offset_x,offset_y),bg.addChild(label);var btn;off=RES_CDN_DEFULT+"common/img_checkbox.png",on=RES_CDN_DEFULT+"common/img_checkbox.png",check=cc.Sprite.create(RES_CDN_DEFULT+"common/img_check.png");(btn=new ccui.Button(off,on)).setTag(i),btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn.setPosition(offset_x+ccWidth(label),offset_y-6),bg.addChild(btn),btn.addClickEventListener(function(sender){var index=sender.getTag();this.setSelectedCount(index)}.bind(this)),check.setAnchorPoint(ANCHOR_MIDDLE()),check.setPosition(ccCenter(btn)),check.setVisible(!1),btn.addChild(check),this.m_checkCount.push(check),offset_x+=ccWidth(label)+ccWidth(btn)+20}this.setSelectedCount(ct);var btn_no=new LabelButton("btn_08_off.png","btn_08_on.png","",ccui.Widget.PLIST_TEXTURE);btn_no.setFont(LABEL_FONT_INDEX.FONT_241),btn_no.setString(res_str("btn_label_cancel")),btn_no.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),btn_no.setPosition(ccCenter(bg).x-5,16),btn_no.addClickEventListener(function(sender){this.m_checkGrades=[],this.m_checkEquipTypes=[],this.m_checkOptionSteps=[],this.m_checkCount=[],this.m_checkMtrlGrade=[];var context=GameContext.getInstance();context.setEquipmentBatchSellCount(0),this.m_selected_grades=[],context.setEquipmentBatchSellGrade(this.m_selected_grades),this.m_selected_equip_types=[],context.setEquipmentBatchSellEquipType(this.m_selected_equip_types),this.m_selected_option_steps=[],context.setEquipmentBatchSellOptStep(this.m_selected_option_steps),this.m_selected_mtrl_grades=[],context.setEquipmentBatchSellMtrlGrade(this.m_selected_mtrl_grades),this.m_checkBatchSellModalLayer.hide()}.bind(this)),bg.addChild(btn_no);var btn_yes=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);return btn_yes.setFont(LABEL_FONT_INDEX.FONT_241),btn_yes.setString(res_str("btn_label_confirm")),btn_yes.setAnchorPoint(ZERO()),btn_yes.setPosition(ccCenter(bg).x+5,16),btn_yes.addClickEventListener(function(sender){this.m_checkGrades=[],this.m_checkEquipTypes=[],this.m_checkOptionSteps=[],this.m_checkCount=[],this.m_checkMtrlGrade=[];var context=GameContext.getInstance();context.setEquipmentBatchSellCount(this.m_items[parseInt(this.m_selected_item)]),context.setEquipmentBatchSellGrade(this.m_selected_grades),context.setEquipmentBatchSellEquipType(this.m_selected_equip_types),context.setEquipmentBatchSellOptStep(this.m_selected_option_steps),context.setEquipmentBatchSellMtrlGrade(this.m_selected_mtrl_grades);var gd=GameDefault.getInstance();gd.setEquipmentBatchSellMtrlGrade(this.m_selected_mtrl_grades),gd.setEquipmentBatchSellMtrlCount(this.m_selected_item),this.scheduleOnce(function(float){this.setLayoutState(EQUIP_LAYER_STATE.SELL,!1,!0)}.bind(this),.01,"pushEquipmentSellScene"),this.m_checkBatchSellModalLayer.hide()}.bind(this)),bg.addChild(btn_yes),layer},setSelectedGrade:function(idx){for(var found=!1,found_idx=0,i=0;i<this.m_selected_grades.length;i++)if(this.m_selected_grades[i]==idx){found=!0,found_idx=i;break}if(1==found){if(!(1<this.m_selected_grades.length))return void this.showToastBox("",res_str("label_equipment_batch_minimum_choice_msg"),2);this.m_selected_grades.splice(found_idx,1)}else this.m_selected_grades.push(idx);for(i=0;i<this.m_checkGrades.length;i++)this.m_checkGrades[i].setVisible(!1);for(i=0;i<this.m_selected_grades.length;i++){var grade=this.m_selected_grades[i]-1;0<=grade&&grade<this.m_checkGrades.length&&this.m_checkGrades[grade].setVisible(!0)}},setSelectedEquipType:function(idx){for(var found=!1,found_idx=0,i=0;i<this.m_selected_equip_types.length;i++)if(this.m_selected_equip_types[i]==idx){found=!0,found_idx=i;break}if(1==found){if(!(1<this.m_selected_equip_types.length))return void this.showToastBox("",res_str("label_equipment_batch_minimum_choice_msg"),2);this.m_selected_equip_types.splice(found_idx,1)}else this.m_selected_equip_types.push(idx);for(i=0;i<this.m_checkEquipTypes.length;i++)this.m_checkEquipTypes[i].setVisible(!1);for(i=0;i<this.m_selected_equip_types.length;i++)for(var et=this.m_selected_equip_types[i],j=(found=!1,found_idx=0,0);j<this.m_checkEquipTypes.length;j++)et==this.m_checkEquipTypes[j].getTag()&&(found=!0,found_idx=j),1==found&&this.m_checkEquipTypes[found_idx].setVisible(!0)},setSelectedOptStep:function(idx){for(var found=!1,found_idx=0,i=0;i<this.m_selected_option_steps.length;i++)if(this.m_selected_option_steps[i]==idx){found=!0,found_idx=i;break}if(1==found){if(!(1<this.m_selected_option_steps.length))return void this.showToastBox("",res_str("label_equipment_batch_minimum_choice_msg"),2);this.m_selected_option_steps.splice(found_idx,1)}else this.m_selected_option_steps.push(idx);for(i=0;i<this.m_checkOptionSteps.length;i++)this.m_checkOptionSteps[i].setVisible(!1);for(i=0;i<this.m_selected_option_steps.length;i++){var step=this.m_selected_option_steps[i];0<=step&&step<this.m_checkOptionSteps.length&&this.m_checkOptionSteps[step].setVisible(!0)}},setSelectedCount:function(idx){this.m_selected_item=idx;for(var i=0;i<this.m_checkCount.length;i++)this.m_checkCount[i].setVisible(i==this.m_selected_item)},setSelectedMtrlGrade:function(idx){for(var found=!1,found_idx=0,i=0;i<this.m_selected_mtrl_grades.length;i++)if(this.m_selected_mtrl_grades[i]==idx){found=!0,found_idx=i;break}if(1==found){if(!(1<this.m_selected_mtrl_grades.length))return void this.showToastBox("",res_str("label_equipment_batch_minimum_choice_msg"),2);this.m_selected_mtrl_grades.splice(found_idx,1)}else this.m_selected_mtrl_grades.push(idx);for(i=0;i<this.m_checkMtrlGrade.length;i++)this.m_checkMtrlGrade[i].setVisible(!1);for(i=0;i<this.m_selected_mtrl_grades.length;i++){var grade=this.m_selected_mtrl_grades[i]-1;0<=grade&&grade<this.m_checkMtrlGrade.length&&this.m_checkMtrlGrade[grade].setVisible(!0)}},setSelectedItemCount:function(index){this.m_selected_item=index;for(var i=0;i<EQUIP_MAX_BATCH_SELL_KIND;i++)i==index?this.m_checkImgs[i].setVisible(!0):this.m_checkImgs[i].setVisible(!1)},showLevelUpEffect:function(){this.m_levelUpEffectLayer.setContentSize(ccSize(this)),this.m_levelUpEffectLayer._contentNode=function(contentSize,m){var layer=new cc.Layer;layer.setContentSize(ccSize(this));var ani_img_1=cc.Sprite.create();ani_img_1.setAnchorPoint(ANCHOR_MIDDLE()),ani_img_1.setPosition(LP(this,240,403)),layer.addChild(ani_img_1);var callBack=cc.callFunc(function(){var ani_img_1=cc.Sprite.create();ani_img_1.setAnchorPoint(ANCHOR_MIDDLE()),ani_img_1.setPosition(LP(this,240,403)),this.addChild(ani_img_1),ani_img_1.runAction(cc.sequence(cc.delayTime(1.8),cc.callFunc(function(){this.effectComplete()}.bind(this)))),this.m_skeletonLevelupEffectNode.setOpacity(255),this.m_skeletonLevelupEffectNode.setAnimation(0,"fx_1",!0)}.bind(this));ani_img_1.runAction(callBack);var spineBackground=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Fade.json",RES_CDN_DEFULT+"effect/Fade.atlas",1);return spineBackground.setPosition(ccCenter(layer)),spineBackground.setAnimation(0,"fx_1",!1),layer.addChild(spineBackground),this.m_skeletonLevelupEffectNode=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Enchant.json",RES_CDN_DEFULT+"effect/Enchant.atlas",.33),this.m_skeletonLevelupEffectNode.setPosition((ccWidth(layer)-478)/2,ccCenter(layer).y),this.m_skeletonLevelupEffectNode.setOpacity(0),layer.addChild(this.m_skeletonLevelupEffectNode),layer}.bind(this),this.m_levelUpEffectLayer.show();var path=RES_CDN_SOUND+SND_TYPE+"sound/SE_growth.mp3";AudioEngine.getInstance().playEffect(path)},effectComplete:function(){if(1==this.m_equipLayer.isLevelup()){var spineBackground=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Fade.json",RES_CDN_DEFULT+"effect/Fade.atlas",1);spineBackground.setPosition(ccCenter(this)),spineBackground.setAnimation(0,"fx_1",!1),this.addChild(spineBackground,4);var ani=cc.Sprite.create();if(ani.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),ani.setPosition(ccCenter(this).x,440),this.addChild(ani,1),NOT_USE_SP_MAIN_ANIMATION){ani.setScale(2),ani.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_yh_lvup_01.png");var scaleTo_1=new cc.ScaleTo(.3,2,2.03),scaleTo_2=new cc.ScaleTo(.3,2,1.97),sequence=(removeSelfAction=new cc.RemoveSelf(!1),new cc.Sequence(scaleTo_1,scaleTo_2,scaleTo_1,scaleTo_2,removeSelfAction));ani.runAction(sequence),sequence=removeSelfAction=scaleTo_2=scaleTo_1=null}else{var animatte=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.LevelUpEffect),removeSelfAction=new cc.RemoveSelf(!1);ani.runAction(new cc.Sequence(new cc.DelayTime(1),animatte,animatte,removeSelfAction))}var path=RES_CDN_SOUND+SND_TYPE+"sound/SE_firework.mp3";AudioEngine.getInstance().playEffect(path)}this.m_levelUpEffectLayer.hide()},sendPacketSellEquipment:function(){var sell_equips=this.m_equipLayer.getSellEquipmentList(),req={};req.opcode=net.OP.op_equipment_sell,req.equipment_list=sell_equips,this.network_write(req)},sendPacketUnlockEquipment:function(){var equip_key={};equip_key=1==this.m_isWearEquip?this.m_equipLayer.getWearingEquipment():this.m_equipLayer.getSelectedEquipment();var req={equipment_key:{}};req.opcode=net.OP.op_equipment_unlock,req.equipment_key.equipment_item_idx=equip_key.equipment_item_idx,req.equipment_key.equipment_num=equip_key.equipment_num,this.network_write(req)},sendPacketLockEquipment:function(){var equip_key={};equip_key=1==this.m_isWearEquip?this.m_equipLayer.getWearingEquipment():this.m_equipLayer.getSelectedEquipment();var req={equipment_key:{}};req.opcode=net.OP.op_equipment_lock,req.equipment_key.equipment_item_idx=equip_key.equipment_item_idx,req.equipment_key.equipment_num=equip_key.equipment_num,this.network_write(req)},sendPacketTakeoffEquipment:function(){var equip_key=this.m_equipLayer.getSelectedEquipment(),req={};req.opcode=net.OP.op_equipment_general_release,req.gnrl_key={},req.equipment_key={},req.gnrl_key.gnrl_id=this.m_gnrl_key.gnrl_id,req.gnrl_key.gnrl_num=this.m_gnrl_key.gnrl_num,req.equipment_key.equipment_item_idx=equip_key.equipment_item_idx,req.equipment_key.equipment_num=equip_key.equipment_num,this.network_write(req)},sendPacketWearEquipment:function(){var equip_key=this.m_equipLayer.getSelectedEquipment(),req={};req.opcode=net.OP.op_equipment_general_equip,req.gnrl_key={},req.equipment_key={},req.gnrl_key.gnrl_id=this.m_gnrl_key.gnrl_id,req.gnrl_key.gnrl_num=this.m_gnrl_key.gnrl_num,req.equipment_key.equipment_item_idx=equip_key.equipment_item_idx,req.equipment_key.equipment_num=equip_key.equipment_num,this.network_write(req)},sendPacketLevelupEquipment:function(){var levelup_equips=this.m_equipLayer.getLevelupEquipmentList(),equip_key=this.m_equipLayer.getLevelupEquipment();GameContext.getInstance().setEquipmentKey(equip_key.equipment_item_idx,equip_key.equipment_num);var req={};req.opcode=net.OP.op_equipment_levelup,req.equipment_key=equip_key,req.mtrl_equip_list=levelup_equips,this.network_write(req)},sendPacketChangeEquipment:function(){var equip_key=this.m_equipLayer.getSelectedEquipment(),release_equip_key=this.m_equipLayer.getWearingEquipment(),req={};req.opcode=net.OP.op_equipment_general_change,req.gnrl_key={},req.equipment_key={},req.release_equipment_key={},req.gnrl_key.gnrl_id=this.m_gnrl_key.gnrl_id,req.gnrl_key.gnrl_num=this.m_gnrl_key.gnrl_num,req.equipment_key.equipment_item_idx=equip_key.equipment_item_idx,req.equipment_key.equipment_num=equip_key.equipment_num,req.release_equipment_key.equipment_item_idx=release_equip_key.equipment_item_idx,req.release_equipment_key.equipment_num=release_equip_key.equipment_num,this.network_write(req)},showEquipmentPopup:function(){this.m_box.is_show()&&this.m_box.hide();for(var val=arguments,msg=[],i=1;i<val.length;i++)msg.push(val[i]);this.showMsgBox(val[0],msg),msg=null},showNotSelectedEquipmentMsgBox:function(){this.m_box.setTitle(res_str("label_not_select_title")),this.m_box.setText(res_str("label_not_select_equipment_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_not_select_equipment_text_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.m_box.hide(!1)},0,"btnOk")}.bind(this))),this.m_box.show()},showCanNotUseWearingEquipmentMsgBox:function(){this.m_box.setTitle(res_str("label_equipment_error_title")),this.m_box.setText(res_str("label_equipment_not_use_wearing_equipment_text_1")),new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,1,1).click=function(){this.m_box.hide()}.bind(this),this.m_box.show()},showCanNotUseLockEquipmentMsgBox:function(){this.m_box.setTitle(res_str("label_equipment_error_title")),this.m_box.setText(res_str("label_equipment_not_use_lock_equipment_text_1")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showOverMaxCountMsgBox:function(){this.m_box.setTitle(res_str("label_equipment_error_title")),this.m_box.setText(res_str("label_equipment_over_max_count_text_1")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showShouldSelectEquipmentMsgBox:function(){this.m_box.setTitle(res_str("label_equipment_error_title")),this.m_box.setText(res_str("label_equipment_not_selected_error_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_equipment_not_selected_error_text_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showNotSameForceTypeMsgBox:function(){this.m_box.setTitle(res_str("label_equipment_error_title")),this.m_box.setText(res_str("label_equipment_not_same_force_type_text_1")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showNotSameElementTypeMsgBox:function(){this.m_box.setTitle(res_str("label_equipment_error_title")),this.m_box.setText(res_str("label_equipment_not_same_element_type_text_1")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showNotSameGeneralGroupMsgBox:function(){this.m_box.setTitle(res_str("label_equipment_error_title")),this.m_box.setText(res_str("label_equipment_not_same_general_group_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_equipment_not_same_general_group_text_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showLowLoveLevelMsgBox:function(){this.m_box.setTitle(res_str("label_equipment_error_title")),this.m_box.setText(res_str("label_equipment_low_love_level_text_1")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showGeneralInCampMsgBox:function(){this.m_box.setTitle(res_str("label_equipment_error_title")),this.m_box.setText(res_str("label_equipment_general_in_camp_text_1")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showIsEquipmentMaxLevel:function(){this.m_box.setTitle(res_str("label_equipment_levelup_error_title")),this.m_box.setText(res_str("label_equipment_over_max_level_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_equipment_over_max_level_text_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showCompleteWearEquipmentMsgBox:function(){this.m_box.setTitle(res_str("label_equipment_wear_equipment_title")),this.m_box.setText(res_str("label_equipment_complete_wear_text_1")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_isToDeck?(this.m_box.hide(!1),this.back()):this.setLayoutState(EQUIP_LAYER_STATE.MAIN,!1,!0),this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showCompleteTakeoffEquipmentMsgBox:function(){this.m_box.setTitle(res_str("label_equipment_takeoff_equipment_title")),this.m_box.setText(res_str("label_equipment_complete_takeoff_text_1")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_isToDeck?(this.m_box.hide(!1),this.back()):(this.setLayoutState(EQUIP_LAYER_STATE.MAIN,!1,!0),this.m_box.hide(!1))}.bind(this))),this.m_box.show()},showCompleteChangeEquipmentMsgBox:function(){this.m_box.setTitle(res_str("label_equipment_change_title")),this.m_box.setText(res_str("label_equipment_complete_change_text_1")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_isToDeck?(this.m_box.hide(!1),this.back()):(this.setLayoutState(EQUIP_LAYER_STATE.MAIN,!1,!0),this.m_box.hide(!1))}.bind(this))),this.m_box.show()},showInventoryIncreaseMsgBox:function(){var obj={bonus_type_name:"",need_jade:0};this.m_ctbox.hide(),EquipmentService.getInstance().getEquipmentInventoryInfo(obj);var count_function=MasterManager.getInstance().get_CountFunction(COUNT_FUNCTION_EQUIPMENT_INVENTORY_INCREASE_SIZE);this.m_ctbox.setTitle("所持数上限の拡張"),this.m_ctbox.setText("所持数の上限を拡張しますか？",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(obj.bonus_type_name+" "+obj.need_jade,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("個使用",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("("+count_function.value+"スロット拡張)",LABEL_FONT_INDEX.FONT_262);var btnNo=new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,1,1);btnNo.click=function(){this.m_ctbox.hide()}.bind(this);var btnYes=new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,-1,1);btnYes.click=function(){NetService().get_UserItemInfo_V2().jade_cnt<obj.need_jade?this.scheduleOnce(function(float){this.showNotEnoughJade()},0,"showNotEnoughJade"):this.scheduleOnce(function(float){var req={};req.opcode=net.OP.op_equipment_inventory_increase,this.network_write(req)},0,"Req_Yunhee_Inventory_Increase"),this.m_ctbox.hide(!1)}.bind(this),this.m_ctbox.addButtonInfo(btnNo),this.m_ctbox.addButtonInfo(btnYes),this.m_ctbox.show()},showCompleteSellEquipmentMsgBox:function(){var sell_obj=this.m_equipLayer.getSellEquipmentsInfo(),equip_count=sell_obj.equip_count,gold_count=sell_obj.gold_count;this.m_ctbox.setTitle("装備売却"),this.m_ctbox.setText("装備",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText(Number(equip_count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("個を売却して",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("金貨 "+Number(gold_count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText(" 獲得しました。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_ctbox.hide()}.bind(this))),this.m_ctbox.show()},showConfirmWearEquipmentMsgBox:function(equip_key){var mt=MasterManager.getInstance(),equip_item=mt.get_EquipmentItem(equip_key.equipment_item_idx),yunhee=mt.get_General(this.m_gnrl_key.gnrl_id),equip_name=equip_item.name,user_equip={};EquipmentService.getInstance().getUserEquipmentInfo(equip_key,user_equip,this.m_gnrl_key),0<user_equip.option_num1&&(equip_name=user_equip.equip_name),this.m_ctbox.setTitle(res_str("label_equipment_wear_equipment_title"));if(0<this.m_equipLayer.getGnrlKeyForSelectedEquipment().gnrl_id){var equip_level_info={};EquipmentService.getInstance().getEquipmentLevelInfo(equip_key,equip_level_info),equip_level_info.need_release_equip_value;this.m_ctbox.setText(res_str("label_equipment_used_by_other_yunhee_text_3"),LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(res_str("label_equipment_used_by_other_yunhee_text_4"),LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n")}var font_index_1=LABEL_FONT_INDEX.FONT_261,font_index_2=LABEL_FONT_INDEX.FONT_262;this.m_ctbox.setText(yunhee.name,font_index_2),this.m_ctbox.setText("に ",font_index_1),this.m_ctbox.setText("\n"),this.m_ctbox.setText(equip_name,font_index_2),this.m_ctbox.setText("を装備しますか？",font_index_1),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_ctbox.hide()}.bind(this))),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.sendPacketWearEquipment()},0,"sendPacketWearEquipment"),this.m_ctbox.hide(!1)}.bind(this))),this.m_ctbox.show()},showConfirmTakeoffEquipmentMsgBox:function(equip_key){var equip_name=MasterManager.getInstance().get_EquipmentItem(equip_key.equipment_item_idx).name;EquipmentService.getInstance().getEquipmentLevelInfo(equip_key,{});var user_equip={};EquipmentService.getInstance().getUserEquipmentInfo(equip_key,user_equip,this.m_gnrl_key),0<user_equip.option_num1&&(equip_name=user_equip.equip_name),this.m_ctbox.setTitle(res_str("label_equipment_takeoff_equipment_title")),this.m_ctbox.setText(equip_name,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("の",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("装備状態を解除しますか？",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_ctbox.hide(!1)}.bind(this))),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.sendPacketTakeoffEquipment()},0,"sendPacketTakeoffEquipment"),this.m_ctbox.hide(!1)}.bind(this))),this.m_ctbox.show()},showConfirmChangeEquipmentMsgBox:function(equip_key){var mt=MasterManager.getInstance();this.m_ctbox.setTitle(res_str("label_equipment_change_title"));var equip_name=mt.get_EquipmentItem(equip_key.equipment_item_idx).name,user_equip={};EquipmentService.getInstance().getUserEquipmentInfo(equip_key,user_equip,this.m_gnrl_key),0<user_equip.option_num1&&(equip_name=user_equip.equip_name);var gnrl_key_for_selected_equip;gnrl_key_for_selected_equip=this.m_equipLayer.getGnrlKeyForSelectedEquipment();var wear_equip_key=this.m_equipLayer.getWearingEquipment();EquipmentService.getInstance().getEquipmentLevelInfo(wear_equip_key,{});var gnrl=mt.get_General(this.m_gnrl_key.gnrl_id);if(0<gnrl_key_for_selected_equip.gnrl_id){EquipmentService.getInstance().getEquipmentLevelInfo(equip_key,{}),this.m_ctbox.setText(res_str("label_equipment_used_by_other_yunhee_text_3"),LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(res_str("label_equipment_used_by_other_yunhee_text_4"),LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(gnrl.name,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("に ",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(equip_name,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("を装備しますか？",LABEL_FONT_INDEX.FONT_261)}else this.m_ctbox.setText(gnrl.name,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("は別のアイテムを装備中です。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(res_str("label_equipment_change_text_2"),LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(equip_name,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("を装備しますか？",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n");this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_ctbox.hide(!1)}.bind(this))),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.sendPacketChangeEquipment()},0,"sendPacketChangeEquipment"),this.m_ctbox.hide(!1)}.bind(this))),this.m_ctbox.show()},showConfirmUnlockEquipmentMsgBox:function(equip_key){var equip_name=MasterManager.getInstance().get_EquipmentItem(equip_key.equipment_item_idx).name,user_equip={};EquipmentService.getInstance().getUserEquipmentInfo(equip_key,user_equip),0<user_equip.option_num1&&(equip_name=user_equip.equip_name),this.m_ctbox.setTitle(res_str("label_equipment_unlock_title")),this.m_ctbox.setText(equip_name,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText(cmString(res_str("label_equipment_unlock_text_1"),""),LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_ctbox.hide(!1)}.bind(this))),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.sendPacketUnlockEquipment()},0,"sendPacketUnlockEquipment"),this.m_ctbox.hide(!1)}.bind(this))),this.m_ctbox.show()},showConfirmLockEquipmentMsgBox:function(equip_key){var equip_name=MasterManager.getInstance().get_EquipmentItem(equip_key.equipment_item_idx).name,user_equip={};EquipmentService.getInstance().getUserEquipmentInfo(equip_key,user_equip),0<user_equip.option_num1&&(equip_name=user_equip.equip_name),this.m_ctbox.setTitle(res_str("label_equipment_lock_title")),this.m_ctbox.setText(equip_name,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText(cmString(res_str("label_equipment_lock_text_1"),""),LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(res_str("label_equipment_lock_text_2"),LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(res_str("label_equipment_lock_text_3"),LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_ctbox.hide()}.bind(this))),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.sendPacketLockEquipment()},0,"sendPacketLockEquipment"),this.m_ctbox.hide()}.bind(this))),this.m_ctbox.show()},showConfirmLevelupEquipmentMsgBox:function(){this.m_ctbox.setTitle(res_str("label_equipment_levelup_title")),this.m_equipLayer.checkOver2StepEquipment()&&(this.m_ctbox.setText("警告：★２以上の装備が含まれています。",LABEL_FONT_INDEX.FONT_2617),this.m_ctbox.setText("",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n")),this.m_ctbox.setText("装備強化をしますか。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_ctbox.hide(!1)}.bind(this))),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.sendPacketLevelupEquipment()},0,"sendPacketLevelupEquipment"),this.m_ctbox.hide(!1)}.bind(this))),this.m_ctbox.show()},showCompleteLevelupEquipmentMsgBox:function(){this.m_equipLevelUpLayer.getLevelupEquipmentsInfo(0,0),this.m_box.setTitle(res_str("label_equipment_levelup_title")),this.m_box.setText(res_str("label_equipment_levelup_success_text_1")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.updateLevelupEquipmentInfo(),this.m_box.hide(!1)}.bind(this))),this.m_box.show()}}),EquipmentLayer_WebV2=cc.Layer.extend({m_leftYunheeLayer:null,m_leftBottomLayer:null,m_gnrl_key:null,m_gnrl_img:null,m_layerState:EQUIP_LAYER_STATE.MAIN,m_equip_key:null,m_equipTitleLabel:null,m_itemPlusBtn:null,m_help_btn:null,m_tabsLayer:null,m_tab_filter:EQUIP_TABS.NORMAL,m_sortType:EQUIP_SORT_TYPE.SORT_GAIN_ORDER,m_isSortDesc:!1,m_sort_btn:null,m_sort_Direction_btn:null,m_sortMenuLayer:null,m_isSortBtnVisible:!1,m_partsTabLayer:null,m_parts_filter:EQUIP_PARTS.EQUIPMENT_PARTS_ALL,m_isPartsTabVisible:!0,m_rightBottomSellInfoLayer:null,m_countLabel:null,m_sellEquipKeys:[],m_sellCount:0,m_goldCountLabel:null,m_gainGoldCount:0,m_isBatchSell:!1,m_rightBottomLayer:null,m_buttom_btn_1:null,m_buttom_btn_2:null,m_selectedEquipment:{},m_equipListLayer:null,m_userEquipList:[],m_userGnrlEquipList:[],m_exceptWearEquipment:!1,m_isSameEquip:!1,m_isWearingEquip:!1,m_wearingEquipment:null,m_gnrlKeyForSelectedEquip:null,m_selectedEquipLayer:null,m_wearingEquipLayer:null,m_levelupEquipLayer:null,m_equipDetailInfoLayer:null,m_skillInfoLayer:null,m_currLevelLabel:null,m_nextLevelLabel:null,m_currStatLabel:null,m_nextStatLabel:null,m_progressBar:null,m_expPrcnt:null,m_goldCountLevelupLabel:null,m_levelupCount:0,m_needGoldCound:0,m_gain_exp:0,m_overMaxLevel:!1,m_expectedLevel:0,m_expectedStatValue:0,m_prcnt:0,m_equip:null,m_levelupEquipKeys:[],m_beforeLevel:0,m_sameTypeMux:0,m_gain_stat:0,m_save_parts_filter:0,m_isToDeck:!1,m_character_skeleton:null,ctor:function(){this._super(),this.init()},init:function(){this._super(),this.m_leftYunheeLayer=null,this.m_leftBottomLayer=null,this.m_gnrl_img=[],this.m_equipTitleLabel=null,this.m_itemPlusBtn=null,this.m_help_btn=null;var keys=GameContext.getInstance().getGeneralKey();this.m_gnrl_key={gnrl_id:keys.gnrl_id,gnrl_num:keys.num},this.m_layerState=EQUIP_LAYER_STATE.MAIN,this.m_tab_filter=EQUIP_TABS.NORMAL;var sortType=GameDefault.getInstance().getEquipmentSort(),sortDesc=GameDefault.getInstance().getEquipmentSortDesc();this.m_sortType=sortType,this.m_isSortDesc="false"!=sortDesc.toString(),this.m_sort_btn=null,this.m_sort_Direction_btn=null,this.m_sortMenuLayer=null,this.m_isSortBtnVisible=!1,this.m_partsTabLayer=null,this.m_parts_filter=EQUIP_PARTS.EQUIPMENT_PARTS_ALL,this.m_isPartsTabVisible=!0,this.m_rightBottomSellInfoLayer=null,this.m_countLabel=null,this.m_sellEquipKeys=[],this.m_sellCount=0,this.m_goldCountLabel=null,this.m_gainGoldCount=0,this.m_isBatchSell=!1,this.m_selectedEquipment={equipment_item_idx:0,equipment_num:0},this.m_equip_key={equipment_item_idx:0,equipment_num:0},this.m_rightBottomLayer=null,this.m_buttom_btn_1=null,this.m_buttom_btn_2=null,this.m_equipListLayer=null,this.m_userEquipList=[],this.m_exceptWearEquipment=!1,this.m_isSameEquip=!1,this.m_isWearingEquip=!1,this.m_gnrlKeyForSelectedEquip={gnrl_id:0,gnrl_num:0},this.m_wearingEquipment={equipment_item_idx:0,equipment_num:0},this.m_selectedEquipLayer=null,this.m_wearingEquipLayer=null,this.m_levelupEquipLayer=null,this.m_equipDetailInfoLayer=null,this.m_skillInfoLayer=null,this.m_currLevelLabel=null,this.m_nextLevelLabel=null,this.m_currStatLabel=null,this.m_nextStatLabel=null,this.m_progressBar=null,this.m_expPrcnt=null,this.m_goldCountLevelupLabel=null,this.m_levelupCount=0,this.m_needGoldCound=0,this.m_gain_exp=0,this.m_overMaxLevel=!1,this.m_expectedLevel=0,this.m_expectedStatValue=0,this.m_prcnt=0,this.m_equip=null,this.m_levelupEquipKeys=[],this.m_beforeLevel=0,this.m_sameTypeMux=0,this.m_gain_stat=0,this.m_isToDeck=!1,this.m_character_skeleton=null,this.createListUILayer()},setUserEquipmentList:function(){this.m_userEquipList=[];var userEquipList=[],userGnrlEquipList=[],equipService=EquipmentService.getInstance(),game_context=GameContext.getInstance();switch(this.m_layerState){case EQUIP_LAYER_STATE.MAIN:this.m_exceptWearEquipment=!1,this.m_parts_filter==EQUIP_PARTS.EQUIPMENT_PARTS_ALL?equipService.getUserEquipmentListInfo(userEquipList,this.m_tab_filter,this.m_gnrl_key):equipService.getUserEquipmentListInfoByType(this.m_parts_filter,userEquipList,this.m_tab_filter,this.m_gnrl_key,this.m_exceptWearEquipment,this.m_exceptEquipId,this.m_exceptEquipNum,this.m_sameForceType),equipService.getUserGeneralEquipmentListInfo(this.m_gnrl_key,userGnrlEquipList);for(var idx=0;idx<userEquipList.length;idx++)this.m_userEquipList.push($.extend({},userEquipList[idx]));userEquipList=[],this.setUserGeneralEquipmentList(this.m_gnrl_key,userGnrlEquipList),this.m_equipListLayer.setStateTableView(EQUIP_LAYER_STATE.MAIN);break;case EQUIP_LAYER_STATE.CHANGE:if(game_context.getNotUseEquipmentPartsTab()){if(0!=this.m_gnrl_key.gnrl_id){var general=MasterManager.getInstance().get_General(this.m_gnrl_key.gnrl_id);this.m_sameForceType=general.arm_service_type}equipService.getUserEquipmentListInfoByType(this.m_parts_filter,userEquipList,this.m_tab_filter,this.m_gnrl_key,0,0,0,this.m_sameForceType)}else equipService.getUserEquipmentListInfoByType(this.m_parts_filter,userEquipList,this.m_tab_filter,this.m_gnrl_key);userGnrlEquipList=equipService.getUserGeneralEquipmentListInfo(this.m_gnrl_key);for(idx=0;idx<userEquipList.length;idx++)this.m_userEquipList.push($.extend({},userEquipList[idx]));userEquipList=[],this.setUserGeneralEquipmentList(this.m_gnrl_key,userGnrlEquipList),this.m_equipListLayer.setStateTableView(EQUIP_LAYER_STATE.CHANGE);break;case EQUIP_LAYER_STATE.SELL:this.m_exceptWearEquipment=!0,this.m_parts_filter==EQUIP_PARTS.EQUIPMENT_PARTS_ALL?equipService.getUserEquipmentListInfo(userEquipList,this.m_tab_filter,this.m_gnrl_key,this.m_exceptWearEquipment,this.m_exceptEquipId,this.m_exceptEquipNum,this.m_sameForceType):equipService.getUserEquipmentListInfoByType(this.m_parts_filter,userEquipList,this.m_tab_filter,this.m_gnrl_key,this.m_exceptWearEquipment,this.m_exceptEquipId,this.m_exceptEquipNum,this.m_sameForceType),this.m_userEquipList=[];for(idx=0;idx<userEquipList.length;idx++)this.m_userEquipList.push($.extend({},userEquipList[idx]));userEquipList=[],equipService.getUserGeneralEquipmentListInfo(this.m_gnrl_key,userGnrlEquipList);var batch_sell_count=game_context.getEquipmentBatchSellCount();if(0<batch_sell_count){var grades=game_context.getEquipmentBatchSellGrade(),equip_types=game_context.getEquipmentBatchSellEquipType(),steps=game_context.getEquipmentBatchSellOptStep(),mtrl_grades=game_context.getEquipmentBatchSellMtrlGrade();this.selectBatchSellItems(grades,equip_types,steps,mtrl_grades,batch_sell_count)}this.m_equipListLayer.setStateTableView(EQUIP_LAYER_STATE.SELL);break;case EQUIP_LAYER_STATE.LEVELUP:this.m_exceptWearEquipment=!0,this.m_exceptEquipId=this.m_equip_key.equipment_item_idx,this.m_exceptEquipNum=this.m_equip_key.equipment_num,this.m_parts_filter==EQUIP_PARTS.EQUIPMENT_PARTS_ALL?equipService.getUserEquipmentListInfo(userEquipList,this.m_tab_filter,this.m_gnrl_key,this.m_exceptWearEquipment,this.m_exceptEquipId,this.m_exceptEquipNum,this.m_sameForceType):equipService.getUserEquipmentListInfoByType(this.m_parts_filter,userEquipList,this.m_tab_filter,this.m_gnrl_key,this.m_exceptWearEquipment,this.m_exceptEquipId,this.m_exceptEquipNum,this.m_sameForceType),this.m_userEquipList=[];for(idx=0;idx<userEquipList.length;idx++)this.m_userEquipList.push($.extend({},userEquipList[idx]));userEquipList=[],this.m_equipListLayer.setStateTableView(EQUIP_LAYER_STATE.LEVELUP)}},initLayout:function(state){return!0},setInitLayer:function(state){switch(this.m_layerState=state){case EQUIP_LAYER_STATE.MAIN:this.createCharacterLayer();break;case EQUIP_LAYER_STATE.CHANGE:if(this.m_tab_filter=EQUIP_TABS.NORMAL,null!=this.m_levelupEquipLayer&&(this.m_levelupEquipLayer.removeFromParent(),this.m_levelupEquipLayer=null),this.m_isToDeck){var equip_key=GameContext.getInstance().getEquipmentKey();this.m_selectedEquipment.equipment_item_idx=equip_key.equipment_item_idx,this.m_selectedEquipment.equipment_num=equip_key.equipment_num,this.m_parts_filter=GameContext.getInstance().getEquipmentParts()}null!=this.m_equipDetailInfoLayer&&(this.m_equipDetailInfoLayer.removeFromParent(),this.m_equipDetailInfoLayer=null);break;case EQUIP_LAYER_STATE.SELL:break;case EQUIP_LAYER_STATE.LEVELUP:null!=this.m_selectedEquipLayer&&(this.m_selectedEquipLayer.removeFromParent(),this.m_selectedEquipLayer=null),null!=this.m_wearingEquipLayer&&(this.m_wearingEquipLayer.removeFromParent(),this.m_wearingEquipLayer=null);equip_key=GameContext.getInstance().getEquipmentKey();this.m_equip_key.equipment_item_idx=equip_key.equipment_item_idx,this.m_equip_key.equipment_num=equip_key.equipment_num,this.m_tab_filter=EQUIP_TABS.MATERIAL,this.m_parts_filter=EQUIP_PARTS.EQUIPMENT_PARTS_ALL,this.m_equip={},EquipmentService.getInstance().getUserEquipmentInfo(this.m_equip_key,this.m_equip,this.m_gnrl_key),this.createLevelupEquipmentLayer(),this.createLevelupEquipmentDetailInfoLayer(),this.setInitSellData()}},setFliterState:function(tab,part){this.m_tab_filter=tab,this.m_parts_filter=part},setLayerState:function(state){switch(this.m_layerState=state,null!=this.m_equipListLayer&&(state==EQUIP_LAYER_STATE.LEVELUP?this.m_equipListLayer.setAbleLongtouch(!0):this.m_equipListLayer.setAbleLongtouch(!1)),state){case EQUIP_LAYER_STATE.MAIN:null!=this.m_leftYunheeLayer&&this.m_leftYunheeLayer.setVisible(!0),null!=this.m_leftBottomLayer&&this.m_leftBottomLayer.setVisible(!0),this.m_help_btn.setVisible(!0),this.setInitSellData(),this.updateTabLayer(this.m_tab_filter),this.updatePartsTabLayer(),this.updateRightBottomBtn(this.m_layerState),this.updateRightSellInfoLayer(),this.setUserEquipmentList(),this.updateEquipBoxUI(),this.doSort(),this.m_equipListLayer.setEquipmentData(this.m_userEquipList),this.updateSelectedEquipLayer(),this.updateWearingEquipLayer();break;case EQUIP_LAYER_STATE.CHANGE:null!=this.m_leftYunheeLayer&&this.m_leftYunheeLayer.setVisible(!1),null!=this.m_leftBottomLayer&&this.m_leftBottomLayer.setVisible(!1),this.m_help_btn.setVisible(!1),this.updateTabLayer(this.m_tab_filter),this.updatePartsTabLayer(),this.updateRightSellInfoLayer(),this.setUserEquipmentList(),this.updateEquipBoxUI(),this.doSort(),0<this.m_selectedEquipment.equipment_item_idx&&this.selectEquipment(this.m_selectedEquipment.equipment_item_idx,this.m_selectedEquipment.equipment_num),this.m_equipListLayer.setEquipmentData(this.m_userEquipList),this.updateSelectedEquipLayer(),this.updateWearingEquipLayer(),this.updateRightBottomBtn(this.m_layerState);break;case EQUIP_LAYER_STATE.SELL:null!=this.m_leftYunheeLayer&&this.m_leftYunheeLayer.setVisible(!1),null!=this.m_leftBottomLayer&&this.m_leftBottomLayer.setVisible(!1),this.m_help_btn.setVisible(!1),this.setInitSellData(),this.updateTabLayer(this.m_tab_filter),this.updatePartsTabLayer(),this.updateRightBottomBtn(this.m_layerState),this.setUserEquipmentList(),this.updateRightSellInfoLayer(),this.updateEquipBoxUI(),this.doSort(),this.m_equipListLayer.setEquipmentData(this.m_userEquipList);break;case EQUIP_LAYER_STATE.LEVELUP:null!=this.m_leftYunheeLayer&&this.m_leftYunheeLayer.setVisible(!1),null!=this.m_leftBottomLayer&&this.m_leftBottomLayer.setVisible(!1),this.m_help_btn.setVisible(!0),this.updateTabLayer(this.m_tab_filter),this.updatePartsTabLayer(),this.updateRightBottomBtn(this.m_layerState),this.updateRightSellInfoLayer(),this.setUserEquipmentList(),this.updateEquipBoxUI(),this.doSort(),this.m_equipListLayer.setEquipmentData(this.m_userEquipList)}},createListUILayer:function(){this.m_equipMainLayer=this.getRightBoxLayer(),this.m_equipMainLayer.ignoreAnchorPointForPosition(!1),this.m_equipMainLayer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_equipMainLayer.setPosition(ccWidth(this),0),this.addChild(this.m_equipMainLayer,1)},getRightBoxLayer:function(){var layer=new cc.Layer,size=cc.size(478,568);layer.setContentSize(size),this.m_tabsLayer=this.getTabLayer(this.m_tab_filter),this.m_tabsLayer.setAnchorPoint(ZERO()),this.m_tabsLayer.setPosition(17,506),layer.addChild(this.m_tabsLayer);var right_bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));right_bg_box.setAnchorPoint(ZERO()),right_bg_box.setPosition(ZERO()),right_bg_box.setContentSize(size.width,size.height-50),layer.addChild(right_bg_box);var navi=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_navi.png",cc.Rect(20,20,20,20));navi.setContentSize(ccWidth(right_bg_box)-16,ccHeight(navi)),navi.setAnchorPoint(ANCHOR_TOP_LEFT()),navi.setPosition(8,ccHeight(right_bg_box)-10),layer.addChild(navi,1e3),this.m_partsTabLayer=this.getPartsTabLayer(this.m_parts_filter),this.m_partsTabLayer.ignoreAnchorPointForPosition(!1),this.m_partsTabLayer.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_partsTabLayer.setPosition(-55,ccCenter(layer).y),layer.addChild(this.m_partsTabLayer),this.m_rightBottomSellInfoLayer=this.getRightSellInfoLayer(),this.m_rightBottomSellInfoLayer.ignoreAnchorPointForPosition(!1),this.m_rightBottomSellInfoLayer.setAnchorPoint(ZERO()),this.m_rightBottomSellInfoLayer.setPosition(10,76),layer.addChild(this.m_rightBottomSellInfoLayer);var cell_size=cc.size(DEF_EQUIP_CELL.CELL_SIZE_WIDTH,DEF_EQUIP_CELL.CELL_SIZE_HEIGHT),table_height=EQUIP_RIGHT_BOX_HEIGHT-64-50;this.m_equipListLayer=new EquipmentListLayer_WebV2,this.m_equipListLayer.setCellSizeAndColumnCount(cell_size,EQUIP_COLUMN_COUNT),this.m_equipListLayer.initLayout(cc.size(EQUIP_RIGHT_BOX_WIDTH,table_height)),this.m_equipListLayer.setAnchorPoint(ZERO()),this.m_equipListLayer.setPosition(11,84),layer.addChild(this.m_equipListLayer),this.m_rightBottomLayer=this.getRightBottomLayer(),this.m_rightBottomLayer.ignoreAnchorPointForPosition(!1),this.m_rightBottomLayer.setAnchorPoint(ZERO()),this.m_rightBottomLayer.setPosition(17,15),layer.addChild(this.m_rightBottomLayer);var sortLayer=this.getNaviSortLayer();return sortLayer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),sortLayer.setPosition(ccWidth(navi)-170,7),navi.addChild(sortLayer),this.m_equipTitleLabel=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_261),this.m_equipTitleLabel.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_equipTitleLabel.setPosition(12,ccCenter(navi).y+4),navi.addChild(this.m_equipTitleLabel),this.m_itemPlusBtn=new ccui.Button("btn_plus_off.png","btn_plus_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_itemPlusBtn.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_itemPlusBtn.setPosition(ccPosX(this.m_equipTitleLabel)+ccWidth(this.m_equipTitleLabel)+10,ccPosY(this.m_equipTitleLabel)-1),navi.addChild(this.m_itemPlusBtn),this.m_itemPlusBtn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_INVENTORY_INC)}.bind(this)),this.m_help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_help_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_help_btn.setPosition(-6,ccHeight(layer)-10),layer.addChild(this.m_help_btn),this.m_help_btn.addClickEventListener(function(sender){this.scheduleOnce(function(float){1==this.m_help_btn.isVisible()&&(PREV_HELP=!0,MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.EUQIP_SHOW_HELP))},0,"EUQIP_SHOW_HELP")}.bind(this)),layer},updateEquipBoxUI:function(){switch(this.m_layerState){case EQUIP_LAYER_STATE.MAIN:null!=this.m_itemPlusBtn&&this.m_itemPlusBtn.setVisible(!1);var equip_bound=EquipmentService.getInstance().getUserEquipmentBound(),equip_cnt=this.m_userEquipList.length;null!=this.m_equipTitleLabel&&this.m_equipTitleLabel.setString(cmString("装備 %d/%d",equip_cnt,equip_bound)),this.m_itemPlusBtn.setPosition(ccPosX(this.m_equipTitleLabel)+ccWidth(this.m_equipTitleLabel)+10,ccPosY(this.m_equipTitleLabel)-1),equip_bound<MasterManager.getInstance().get_CountFunction(14).value&&this.m_itemPlusBtn.setVisible(!0);break;case EQUIP_LAYER_STATE.SELL:case EQUIP_LAYER_STATE.CHANGE:null!=this.m_itemPlusBtn&&this.m_itemPlusBtn.setVisible(!1);equip_bound=EquipmentService.getInstance().getUserEquipmentBound(),equip_cnt=this.m_userEquipList.length;null!=this.m_equipTitleLabel&&this.m_equipTitleLabel.setString(cmString("装備 %d/%d",equip_cnt,equip_bound));break;case EQUIP_LAYER_STATE.LEVELUP:null!=this.m_itemPlusBtn&&this.m_itemPlusBtn.setVisible(!1),null!=this.m_equipTitleLabel&&this.m_equipTitleLabel.setString(cmString(res_str("label_equipment_levelup_count_label"),this.m_levelupCount,MAX_LEVELUP_COUNT))}},updateEquipLevelUpUI:function(){if(EquipmentService.getInstance().getUserEquipmentInfo(this.m_equip_key,this.m_equip,this.m_gnrlKey),null!=this.m_nextStatLabel&&this.m_nextStatLabel.setString(Number(this.m_expectedStatValue).toLocaleString("en")),null!=this.m_progressBar){var gauge_prcnt=this.m_prcnt*EQUIP_MAX_GAUGE_VALUE;this.m_progressBar.setScaleX(gauge_prcnt)}if(null!=this.m_expPrcnt&&this.m_expPrcnt.setString(cmString("%d%%",100*this.m_prcnt)),null!=this.m_nextLevelLabel&&this.m_nextLevelLabel.setString(cmString("%d/%d",this.m_expectedLevel,this.m_equip.max_level)),null!=this.m_currLevelLabel&&this.m_currLevelLabel.setString(cmString("%d",this.m_equip.level)),null!=this.m_currStatLabel&&this.m_currStatLabel.setString(Number(this.m_equip.stat_value).toLocaleString("en")),null!=this.m_skillInfoLayer){var equip_info=$.extend({},this.m_equip);equip_info.level=this.m_expectedLevel;var parent_layer=this.m_skillInfoLayer.getParent();this.m_skillInfoLayer.removeFromParent(),this.m_skillInfoLayer=this.getEquipSkillLayer(equip_info),this.m_skillInfoLayer.setAnchorPoint(ZERO()),this.m_skillInfoLayer.setPosition(23,110),parent_layer.addChild(this.m_skillInfoLayer)}null!=this.m_goldCountLevelupLabel&&(this.m_goldCountLevelupLabel.setString(Number(this.m_needGoldCound).toLocaleString("en")),NetService().get_UserItemInfo_V2().gold_cnt<this.m_needGoldCound?this.m_goldCountLevelupLabel.setColor(COLOR(245)):this.m_goldCountLevelupLabel.setColor(cmLabel.getColor(LABEL_FONT_INDEX.FONT_2011)))},updateRightBottomBtn:function(state){if(null!=this.m_buttom_btn_1&&null!=this.m_buttom_btn_2)if(state==EQUIP_LAYER_STATE.MAIN)this.m_buttom_btn_1.loadTextures("btn_07_off.png","btn_07_on.png","btn_07_none.png",ccui.Widget.PLIST_TEXTURE),this.m_buttom_btn_1.setTag(EQUIP_BOTTOM_BTNS.BTN_EQUIP_SELL),this.m_buttom_btn_1.setString(res_str("btn_label_sell")),this.m_buttom_btn_1.setVisible(!0),this.m_buttom_btn_1.setEnabled(!0),this.m_buttom_btn_2.loadTextures("btn_07_off.png","btn_07_on.png","btn_07_none.png",ccui.Widget.PLIST_TEXTURE),this.m_buttom_btn_2.setTag(EQUIP_BOTTOM_BTNS.BTN_EQUIP_BATCH_SELL),this.m_buttom_btn_2.setString(res_str("btn_label_batch_sell")),this.m_buttom_btn_2.setVisible(!0),this.m_buttom_btn_2.setEnabled(!0);else if(state==EQUIP_LAYER_STATE.CHANGE){var use_btn=!1;if(0<this.m_selectedEquipment.equipment_item_idx){var info={};EquipmentService.getInstance().getUserEquipmentInfo(this.m_selectedEquipment,info,this.m_gnrl_key),info.equip_type!=EQUIPMENT_TYPE_EXP&&(use_btn=!0)}this.m_isToDeck?(this.m_buttom_btn_2.setVisible(!1),1==this.m_isSameEquip?(this.m_buttom_btn_1.loadTextures("btn_03_red_off.png","btn_03_red_on.png","btn_03_red_none.png",ccui.Widget.PLIST_TEXTURE),this.m_buttom_btn_1.setTag(EQUIP_BOTTOM_BTNS.BTN_CHANGE_TAKE_OFF),this.m_buttom_btn_1.setString(res_str("btn_label_takeoff"))):1==this.m_isWearingEquip?(this.m_buttom_btn_1.loadTextures("btn_03_off.png","btn_03_on.png","btn_03_none.png",ccui.Widget.PLIST_TEXTURE),this.m_buttom_btn_1.setTag(EQUIP_BOTTOM_BTNS.BTN_CHANGE_CHANGE),this.m_buttom_btn_1.setString(res_str("btn_label_change"))):(this.m_buttom_btn_1.loadTextures("btn_03_off.png","btn_03_on.png","btn_03_none.png",ccui.Widget.PLIST_TEXTURE),this.m_buttom_btn_1.setTag(EQUIP_BOTTOM_BTNS.BTN_CHANGE_WEAR),this.m_buttom_btn_1.setString(res_str("btn_label_wear"))),this.m_buttom_btn_1.setVisible(!0),this.m_buttom_btn_1.setEnabled(use_btn)):(this.m_buttom_btn_1.loadTextures("btn_07_off.png","btn_07_on.png","btn_07_none.png",ccui.Widget.PLIST_TEXTURE),this.m_buttom_btn_1.setTag(EQUIP_BOTTOM_BTNS.BTN_CHANGE_LEVELUP),this.m_buttom_btn_1.setString(res_str("btn_label_levelup")),this.m_buttom_btn_1.setVisible(!0),this.m_buttom_btn_1.setEnabled(use_btn),1==this.m_isSameEquip?(this.m_buttom_btn_2.loadTextures("btn_08_off.png","btn_08_on.png","btn_08_on.png",ccui.Widget.PLIST_TEXTURE),this.m_buttom_btn_2.setTag(EQUIP_BOTTOM_BTNS.BTN_CHANGE_TAKE_OFF),this.m_buttom_btn_2.setString(res_str("btn_label_takeoff"))):1==this.m_isWearingEquip?(this.m_buttom_btn_2.loadTextures("btn_07_off.png","btn_07_on.png","btn_07_none.png",ccui.Widget.PLIST_TEXTURE),this.m_buttom_btn_2.setTag(EQUIP_BOTTOM_BTNS.BTN_CHANGE_CHANGE),this.m_buttom_btn_2.setString(res_str("btn_label_change"))):(this.m_buttom_btn_2.loadTextures("btn_07_off.png","btn_07_on.png","btn_07_none.png",ccui.Widget.PLIST_TEXTURE),this.m_buttom_btn_2.setTag(EQUIP_BOTTOM_BTNS.BTN_CHANGE_WEAR),this.m_buttom_btn_2.setString(res_str("btn_label_wear"))),this.m_buttom_btn_2.setVisible(!0),this.m_buttom_btn_2.setEnabled(use_btn))}else state==EQUIP_LAYER_STATE.LEVELUP?(this.m_buttom_btn_1.loadTextures("btn_03_red_off.png","btn_03_red_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_buttom_btn_1.setTag(EQUIP_BOTTOM_BTNS.BTN_LEVEL_CANCEL),this.m_buttom_btn_1.setString(res_str("btn_label_cancel")),this.m_buttom_btn_1.setVisible(!0),this.m_buttom_btn_2.setVisible(!1),this.m_buttom_btn_2.setEnabled(!1),this.m_buttom_btn_1.setEnabled(!0)):state==EQUIP_LAYER_STATE.SELL&&(this.m_buttom_btn_1.loadTextures("btn_08_off.png","btn_08_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_buttom_btn_1.setTag(EQUIP_BOTTOM_BTNS.BTN_SELL_CANCEL),this.m_buttom_btn_1.setString(res_str("btn_label_cancel")),this.m_buttom_btn_1.setVisible(!0),this.m_buttom_btn_1.setEnabled(!0),this.m_buttom_btn_2.loadTextures("btn_07_off.png","btn_07_on.png","btn_07_none.png",ccui.Widget.PLIST_TEXTURE),this.m_buttom_btn_2.setTag(EQUIP_BOTTOM_BTNS.BTN_SELL_SELL),this.m_buttom_btn_2.setString(res_str("btn_label_sell")),this.m_buttom_btn_2.setVisible(!0),this.m_buttom_btn_2.setEnabled(!0))},getRightSellInfoLayer:function(){var layer=new cc.Layer,size=cc.size(458,40);layer.setContentSize(size);var info_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",cc.Rect(10,10,10,10));info_bg.setContentSize(ccSize(layer)),info_bg.setAnchorPoint(ZERO()),info_bg.setPosition(ZERO()),layer.addChild(info_bg);var title_label=cmLabel.getLabel(res_str("label_equipment_sell_count_label"),LABEL_FONT_INDEX.FONT_201);title_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),title_label.setPosition(10,ccCenter(info_bg).y),info_bg.addChild(title_label),this.m_countLabel=cmLabel.getLabel(cmString(res_str("label_equipment_sell_count"),this.m_sellCount,MAX_SELL_COUNT),LABEL_FONT_INDEX.FONT_2011),this.m_countLabel.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_countLabel.setPosition(ccPosX(title_label)+ccWidth(title_label),ccCenter(info_bg).y),info_bg.addChild(this.m_countLabel);var gold_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_sell_gold.png");return gold_img.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),gold_img.setPosition(335,ccCenter(info_bg).y),info_bg.addChild(gold_img),this.m_goldCountLabel=cmLabel.getLabel(Number(this.m_gainGoldCount).toLocaleString("en"),LABEL_FONT_INDEX.FONT_2011),this.m_goldCountLabel.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_goldCountLabel.setPosition(ccWidth(info_bg)-10,ccCenter(info_bg).y),info_bg.addChild(this.m_goldCountLabel),layer},updateRightSellInfoLayer:function(){this.m_layerState==EQUIP_LAYER_STATE.SELL?(this.m_rightBottomSellInfoLayer.setVisible(!0),null!=this.m_countLabel&&this.m_countLabel.setString(cmString(res_str("label_equipment_sell_count"),this.m_sellCount,MAX_SELL_COUNT)),null!=this.m_goldCountLabel&&this.m_goldCountLabel.setString(Number(this.m_gainGoldCount).toLocaleString("en"))):this.m_rightBottomSellInfoLayer.setVisible(!1)},getPartsTabLayer:function(index){var layer=new cc.Layer,size=cc.size(60,410);layer.setContentSize(size);for(var parts_indexs=[EQUIP_PARTS.EQUIPMENT_PARTS_ALL,EQUIP_PARTS.EQUIPMENT_PRIVATE,EQUIP_PARTS.EQUIPMENT_ARMOR,EQUIP_PARTS.EQUIPMENT_RING,EQUIP_PARTS.EQUIPMENT_SHIELD,EQUIP_PARTS.EQUIPMENT_JEWELRY],offset_y=320,i=0;i<parts_indexs.length;i++){var btn_click_sprite="",btn_none_sprite="",btn_normal_sprite="";btn_normal_sprite=0==parts_indexs[i]||100==parts_indexs[i]?(btn_click_sprite="btn_09_"+leadingZeros(parts_indexs[i],2)+"_on.png",btn_none_sprite="btn_09_"+leadingZeros(parts_indexs[i],2)+"_off.png","btn_09_"+leadingZeros(parts_indexs[i],2)+"_none.png"):(btn_click_sprite="btn_equip_"+leadingZeros(parts_indexs[i],2)+"_on.png",btn_none_sprite="btn_equip_"+leadingZeros(parts_indexs[i],2)+"_off.png","btn_equip_"+leadingZeros(parts_indexs[i],2)+"_none.png");var btn=new ccui.Button(btn_normal_sprite,btn_click_sprite,btn_none_sprite,ccui.Widget.PLIST_TEXTURE);btn.setAnchorPoint(ZERO()),btn.setTag(parts_indexs[i]),btn.setPosition(0,offset_y),btn.addClickEventListener(function(sender){this.m_isBatchSell&&(GameContext.getInstance().setEquipmentBatchSellCount(0),this.m_isBatchSell=!1),this.setInitSellData(),this.updatePartsTabLayer(sender.getTag()),this.setUserEquipmentList(),this.updateEquipBoxUI(),this.doSort(),this.m_equipListLayer.setEquipmentData(this.m_userEquipList),this.m_layerState==EQUIP_LAYER_STATE.SELL?(this.updateSelectedEquipLayer(),this.updateWearingEquipLayer(),this.updateRightSellInfoLayer()):this.m_layerState==EQUIP_LAYER_STATE.CHANGE?(this.updateSelectedEquipLayer(),this.updateWearingEquipLayer(),this.updateRightBottomBtn(this.m_layerState)):this.m_layerState==EQUIP_LAYER_STATE.LEVELUP&&this.updateEquipLevelUpUI()}.bind(this)),layer.addChild(btn),offset_y-=ccHeight(btn)+10,index==parts_indexs[i]?btn.setEnabled(!1):btn.setEnabled(!0)}return layer},updatePartsTabLayer:function(index){if(null!=this.m_partsTabLayer)if(null==index&&(index=this.m_parts_filter),GameContext.getInstance().setEquipmentParts(index),this.m_parts_filter=index,this.m_isToDeck&&this.m_layerState==EQUIP_LAYER_STATE.CHANGE&&(this.m_isPartsTabVisible=!1),this.m_isPartsTabVisible){this.m_partsTabLayer.setVisible(!0);for(var parts_indexs=[EQUIP_PARTS.EQUIPMENT_PARTS_ALL,EQUIP_PARTS.EQUIPMENT_PRIVATE,EQUIP_PARTS.EQUIPMENT_ARMOR,EQUIP_PARTS.EQUIPMENT_RING,EQUIP_PARTS.EQUIPMENT_SHIELD,EQUIP_PARTS.EQUIPMENT_JEWELRY],i=0;i<parts_indexs.length;i++)this.m_partsTabLayer.getChildByTag(parts_indexs[i]).getTag()==index?this.m_partsTabLayer.getChildByTag(parts_indexs[i]).setEnabled(!1):this.m_partsTabLayer.getChildByTag(parts_indexs[i]).setEnabled(!0)}else this.m_partsTabLayer.setVisible(!1)},getRightBottomLayer:function(){var layer=new cc.Layer;return layer.setContentSize(451,60),this.m_buttom_btn_1=new LabelButton("","","",ccui.Widget.PLIST_TEXTURE),this.m_buttom_btn_1.setFont(LABEL_FONT_INDEX.FONT_241),this.m_buttom_btn_1.setAnchorPoint(ZERO()),this.m_buttom_btn_1.setPosition(0,0),this.m_buttom_btn_1.setString(""),this.m_buttom_btn_1.setTag(""),this.m_buttom_btn_1.addClickEventListener(function(sender){if(sender.getTag()==EQUIP_BOTTOM_BTNS.BTN_EQUIP_SELL)GameContext.getInstance().setEquipmentBatchSellCount(0),MainObserver.getInstance().postNotification(NOTIFICATION_EQUIPMENT_SET_LAYER,EQUIP_LAYER_STATE.SELL);else if(sender.getTag()==EQUIP_BOTTOM_BTNS.BTN_SELL_CANCEL)GameContext.getInstance().setEquipmentBatchSellCount(0),MainObserver.getInstance().postNotification(NOTIFICATION_EQUIPMENT_SET_LAYER,EQUIP_LAYER_STATE.MAIN);else if(sender.getTag()==EQUIP_BOTTOM_BTNS.BTN_LEVEL_CANCEL)null!=this.m_levelupEquipLayer&&(this.m_levelupEquipLayer.removeFromParent(),this.m_levelupEquipLayer=null),null!=this.m_equipDetailInfoLayer&&(this.m_equipDetailInfoLayer.removeFromParent(),this.m_equipDetailInfoLayer=null),this.setLevelUpToChangeData(),MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_CANCEL);else if(sender.getTag()==EQUIP_BOTTOM_BTNS.BTN_CHANGE_LEVELUP)0<this.m_selectedEquipment.equipment_item_idx?(this.saveEquipmentListOffSet(),this.saveEquipmentListSubOffSet(),MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_LEVELUP)):MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_EQUIPMENT_NOT_SELECTED);else if(sender.getTag()==EQUIP_BOTTOM_BTNS.BTN_CHANGE_TAKE_OFF)0<this.m_selectedEquipment.equipment_item_idx?MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_TAKE_OFF):MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_EQUIPMENT_NOT_SELECTED);else if(sender.getTag()==EQUIP_BOTTOM_BTNS.BTN_CHANGE_CHANGE)if(0<this.m_selectedEquipment.equipment_item_idx){var info={};EquipmentService.getInstance().getUserEquipmentInfo(this.m_selectedEquipment,info,this.m_gnrl_key);var gnrl=MasterManager.getInstance().get_General(this.m_gnrl_key.gnrl_id);0<info.gnrl_group&&"y"!=info.same_gnrl_equip_yn?MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_NOT_SAME_GENERAL_GROUP):info.arm_service_type!=ARMSERVICETYPE_NONE&&info.arm_service_type!=gnrl.arm_service_type?MainObserver.getInstance.postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_NOT_SAME_ARM_SERVICE_TYPE):MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_CHANGE)}else MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_EQUIPMENT_NOT_SELECTED);else if(sender.getTag()==EQUIP_BOTTOM_BTNS.BTN_CHANGE_WEAR)if(0<this.m_selectedEquipment.equipment_item_idx){info={};EquipmentService.getInstance().getUserEquipmentInfo(this.m_selectedEquipment,info,this.m_gnrl_key);gnrl=MasterManager.getInstance().get_General(this.m_gnrl_key.gnrl_id);0<info.gnrl_group&&"y"!=info.same_gnrl_equip_yn?MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_NOT_SAME_GENERAL_GROUP):info.arm_service_type!=ARMSERVICETYPE_NONE&&info.arm_service_type!=gnrl.arm_service_type?MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_NOT_SAME_ARM_SERVICE_TYPE):MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_WEAR)}else MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_EQUIPMENT_NOT_SELECTED)}.bind(this)),layer.addChild(this.m_buttom_btn_1),this.m_buttom_btn_2=new LabelButton("","","",ccui.Widget.PLIST_TEXTURE),this.m_buttom_btn_2.setFont(LABEL_FONT_INDEX.FONT_241),this.m_buttom_btn_2.setAnchorPoint(ZERO()),this.m_buttom_btn_2.setPosition(222,0),this.m_buttom_btn_2.setString(""),this.m_buttom_btn_2.setTag(""),this.m_buttom_btn_2.addClickEventListener(function(sender){if(sender.getTag()==EQUIP_BOTTOM_BTNS.BTN_EQUIP_BATCH_SELL)MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_BATCH_SELL);else if(sender.getTag()==EQUIP_BOTTOM_BTNS.BTN_SELL_SELL)0==this.m_sellCount?MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_EQUIPMENT_NOT_SELECTED):MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_SELL);else if(sender.getTag()==EQUIP_BOTTOM_BTNS.BTN_CHANGE_CHANGE)if(0<this.m_selectedEquipment.equipment_item_idx){var info={};EquipmentService.getInstance().getUserEquipmentInfo(this.m_selectedEquipment,info,this.m_gnrl_key);var gnrl=MasterManager.getInstance().get_General(this.m_gnrl_key.gnrl_id);0<info.gnrl_group&&"y"!=info.same_gnrl_equip_yn?MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_NOT_SAME_GENERAL_GROUP):info.arm_service_type!=ARMSERVICETYPE_NONE&&info.arm_service_type!=gnrl.arm_service_type?MainObserver.getInstance.postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_NOT_SAME_ARM_SERVICE_TYPE):MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_CHANGE)}else MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_EQUIPMENT_NOT_SELECTED);else if(sender.getTag()==EQUIP_BOTTOM_BTNS.BTN_CHANGE_WEAR)if(0<this.m_selectedEquipment.equipment_item_idx){info={};EquipmentService.getInstance().getUserEquipmentInfo(this.m_selectedEquipment,info,this.m_gnrl_key);gnrl=MasterManager.getInstance().get_General(this.m_gnrl_key.gnrl_id);0<info.gnrl_group&&"y"!=info.same_gnrl_equip_yn?MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_NOT_SAME_GENERAL_GROUP):info.arm_service_type!=ARMSERVICETYPE_NONE&&info.arm_service_type!=gnrl.arm_service_type?MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_NOT_SAME_ARM_SERVICE_TYPE):MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_WEAR)}else MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_EQUIPMENT_NOT_SELECTED);else sender.getTag()==EQUIP_BOTTOM_BTNS.BTN_CHANGE_TAKE_OFF&&(0<this.m_selectedEquipment.equipment_item_idx?MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_TAKE_OFF):MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_EQUIPMENT_NOT_SELECTED))}.bind(this)),layer.addChild(this.m_buttom_btn_2),layer},getNaviSortLayer:function(){var layer=new cc.Layer;return this.m_sort_btn=new LabelButton("btn_02_off.png","btn_02_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_sort_btn.setFont(LABEL_FONT_INDEX.FONT_201),this.m_sort_btn.setString(res_str("btn_sort_gain")),this.m_sort_btn.setAnchorPoint(ZERO()),this.m_sort_btn.setPosition(ZERO()),this.m_sort_btn.addClickEventListener(function(sender){this.toggleDisplaySortMenu()}.bind(this)),layer.addChild(this.m_sort_btn),this.setSortBtnLabel(this.m_sortType),this.m_sort_Direction_btn=new ccui.Button("btn_align_bottom_off.png","btn_align_bottom_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_sort_Direction_btn.setAnchorPoint(ZERO()),this.m_sort_Direction_btn.setPosition(ccWidth(this.m_sort_btn),0),this.m_sort_Direction_btn.addClickEventListener(function(sender){this.setSortDirection()}.bind(this)),layer.addChild(this.m_sort_Direction_btn),this.m_sortMenuLayer=this.getSortMenuLayer(),this.m_sortMenuLayer.ignoreAnchorPointForPosition(!1),this.m_sortMenuLayer.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_sortMenuLayer.setPosition(ZERO()),this.m_sortMenuLayer.setVisible(!1),layer.addChild(this.m_sortMenuLayer,100),layer.setContentSize(ccSize(this.m_sort_btn)),layer},toggleDisplaySortMenu:function(){this.m_isSortBtnVisible?(this.m_sortMenuLayer.setVisible(!1),this.m_isSortBtnVisible=!1):(this.m_sortMenuLayer.setVisible(!0),this.m_isSortBtnVisible=!0)},setSortBtnLabel:function(sort_type){switch(sort_type){case EQUIP_SORT_TYPE.SORT_PARTS_TYPE:this.m_sort_btn.setString(res_str("btn_sort_equip_parts_type"));break;case EQUIP_SORT_TYPE.SORT_RARE_TYPE:this.m_sort_btn.setString(res_str("btn_sort_rarity"));break;case EQUIP_SORT_TYPE.SORT_LEVEL:this.m_sort_btn.setString(res_str("btn_sort_lv"));break;case EQUIP_SORT_TYPE.SORT_PLUS_VALUE:this.m_sort_btn.setString(res_str("btn_sort_plus_value"));break;case EQUIP_SORT_TYPE.SORT_WEARING:this.m_sort_btn.setString(res_str("btn_sort_wearing"));break;case EQUIP_SORT_TYPE.SORT_GAIN_ORDER:this.m_sort_btn.setString(res_str("btn_sort_gain"));break;case EQUIP_SORT_TYPE.SORT_ELEMENT_TYPE:this.m_sort_btn.setString(res_str("btn_sort_element_type"));break;case EQUIP_SORT_TYPE.SORT_SERIES:this.m_sort_btn.setString(res_str("btn_sort_series"))}},getTabLayer:function(index){var layer=new cc.Layer,size=cc.size(222,60);layer.setContentSize(size);for(var pos_x=0,tabs_indexs=[EQUIP_TABS.NORMAL,EQUIP_TABS.MATERIAL],i=0;i<tabs_indexs.length;i++){var tab_btn=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE);tab_btn.setAnchorPoint(ZERO()),tab_btn.setFont(LABEL_FONT_INDEX.FONT_201),tabs_indexs[i]==EQUIP_TABS.NORMAL?tab_btn.setString(res_str("label_equipment")):tabs_indexs[i]==EQUIP_TABS.MATERIAL&&tab_btn.setString(res_str("label_levelup_material")),tab_btn.setTag(tabs_indexs[i]),tab_btn.setPosition(pos_x,0),tab_btn.addClickEventListener(function(sender){this.m_isBatchSell&&(GameContext.getInstance().setEquipmentBatchSellCount(0),this.m_isBatchSell=!1),this.setInitSellData(),this.updateTabLayer(sender.getTag()),this.updatePartsTabLayer(this.m_parts_filter),this.setUserEquipmentList(),this.updateEquipBoxUI(),this.doSort(),this.m_equipListLayer.setEquipmentData(this.m_userEquipList),this.m_layerState==EQUIP_LAYER_STATE.SELL?(this.updateSelectedEquipLayer(),this.updateWearingEquipLayer(),this.updateRightSellInfoLayer()):this.m_layerState==EQUIP_LAYER_STATE.CHANGE?(this.updateSelectedEquipLayer(),this.updateWearingEquipLayer(),this.updateRightBottomBtn(this.m_layerState)):this.m_layerState==EQUIP_LAYER_STATE.LEVELUP&&this.updateEquipLevelUpUI()}.bind(this)),layer.addChild(tab_btn),pos_x+=ccWidth(tab_btn),index==tabs_indexs[i]?tab_btn.setEnabled(!1):tab_btn.setEnabled(!0)}return layer},updateTabLayer:function(index){if(null!=this.m_tabsLayer){GameContext.getInstance().setEquipmentTabType(index),this.m_tab_filter=index;for(var tabs_indexs=[EQUIP_TABS.NORMAL,EQUIP_TABS.MATERIAL],i=0;i<tabs_indexs.length;i++)this.m_tabsLayer.getChildByTag(tabs_indexs[i]).getTag()==index?(this.m_tabsLayer.getChildByTag(tabs_indexs[i]).setEnabled(!1),index==EQUIP_TABS.NORMAL?this.m_isPartsTabVisible=!0:this.m_isPartsTabVisible=!1):(this.m_tabsLayer.getChildByTag(tabs_indexs[i]).setEnabled(!0),this.m_isToDeck&&this.m_layerState==EQUIP_LAYER_STATE.CHANGE&&this.m_tabsLayer.getChildByTag(tabs_indexs[i]).setVisible(!1))}},getSortMenuLayer:function(){for(var layer=new cc.Layer,sort_btn_obj=[{name:res_str("btn_sort_equip_parts_type"),tag:EQUIP_SORT_TYPE.SORT_PARTS_TYPE},{name:res_str("btn_sort_wearing"),tag:EQUIP_SORT_TYPE.SORT_WEARING},{name:res_str("btn_sort_rarity"),tag:EQUIP_SORT_TYPE.SORT_RARE_TYPE},{name:res_str("btn_sort_plus_value"),tag:EQUIP_SORT_TYPE.SORT_PLUS_VALUE},{name:res_str("btn_sort_lv"),tag:EQUIP_SORT_TYPE.SORT_LEVEL},{name:res_str("btn_sort_series"),tag:EQUIP_SORT_TYPE.SORT_SERIES},{name:res_str("btn_sort_element_type"),tag:EQUIP_SORT_TYPE.SORT_ELEMENT_TYPE},{name:res_str("btn_sort_gain"),tag:EQUIP_SORT_TYPE.SORT_GAIN_ORDER}],btn_pos_y=0,i=0;i<sort_btn_obj.size();i++){var btn=new LabelButton("btn_02_off.png","btn_02_on.png","",ccui.Widget.PLIST_TEXTURE);btn.setFont(LABEL_FONT_INDEX.FONT_201),btn.setString(sort_btn_obj.at(i).name),btn.setAnchorPoint(ZERO()),btn.setPosition(0,btn_pos_y),btn.addClickEventListener(function(sender){this.setSortType(sender.getTag())}.bind(this)),layer.addChild(btn),btn.setTag(sort_btn_obj.at(i).tag),btn_pos_y+=ccHeight(btn)}return layer.setContentSize(111,btn_pos_y),layer},setSortType:function(sort_type){this.m_sortType!=sort_type&&(GameDefault.getInstance().setEquipmentSort(sort_type),this.m_sortType=sort_type,this.setSortBtnLabel(sort_type),this.doSort(),this.m_equipListLayer.setEquipmentData(this.m_userEquipList)),this.m_isSortBtnVisible&&this.toggleDisplaySortMenu()},setSortDirection:function(){this.m_isSortDesc?(this.m_isSortDesc=!1,this.m_sort_Direction_btn.loadTexturePressed("btn_align_top_on.png",ccui.Widget.PLIST_TEXTURE),this.m_sort_Direction_btn.loadTextureNormal("btn_align_top_off.png",ccui.Widget.PLIST_TEXTURE)):(this.m_isSortDesc=!0,this.m_sort_Direction_btn.loadTexturePressed("btn_align_bottom_on.png",ccui.Widget.PLIST_TEXTURE),this.m_sort_Direction_btn.loadTextureNormal("btn_align_bottom_off.png",ccui.Widget.PLIST_TEXTURE)),this.m_isSortBtnVisible&&this.toggleDisplaySortMenu(),GameDefault.getInstance().setEquipmentSortDesc(this.m_isSortDesc),this.doSort(),this.m_equipListLayer.setEquipmentData(this.m_userEquipList)},createCharacterLayer:function(){var gnrl_info={};GeneralService.getInstance().getUserGeneralInfo(this.m_gnrl_key,gnrl_info),this.m_leftYunheeLayer=this.getCharacterLayer(gnrl_info),this.m_leftYunheeLayer.ignoreAnchorPointForPosition(!1),this.m_leftYunheeLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_leftYunheeLayer.setPosition((ccWidth(this)-478)/2,0),this.addChild(this.m_leftYunheeLayer),this.m_leftBottomLayer=this.getLeftBottomLayer(gnrl_info),this.m_leftBottomLayer.setPosition(ZERO()),this.addChild(this.m_leftBottomLayer)},createLevelupEquipmentLayer:function(){null!=this.m_levelupEquipLayer&&(this.m_levelupEquipLayer.removeAllChildrenWithCleanup(!0),this.m_levelupEquipLayer.removeFromParent(),this.m_levelupEquipLayer=null),this.m_levelupEquipLayer=this.getLevelUpEquipmentLayer(this.m_equip),this.m_levelupEquipLayer.ignoreAnchorPointForPosition(!1),this.m_levelupEquipLayer.setAnchorPoint(ZERO()),this.m_levelupEquipLayer.setPosition(239,359),this.addChild(this.m_levelupEquipLayer)},getLevelUpEquipmentLayer:function(equip){var layer=new cc.Layer,size=cc.size(127,40);layer.setContentSize(size);var icon_bg=cc.Sprite.create(RES_CDN_MENU_EQUIP_NTP+"img_equip_panel.png");DISABLE_SPB_TP&&icon_bg.setContentSize(127,127),icon_bg.setAnchorPoint(ZERO()),icon_bg.setPosition(ZERO()),layer.addChild(icon_bg);var equip_info={};equip_info.equip_id=equip.equip_id,equip_info.equip_rare_type=equip.equip_rare_type,equip_info.equip_parts_type=equip.equip_parts_type,equip_info.arm_service_type=equip.arm_service_type,equip_info.equip_type=equip.equip_type,equip_info.level=equip.level,equip_info.step=equip.equip_step,equip_info.is_equip="y"==equip.equip_yn,equip_info.is_lock="y"==equip.lock_yn,equip_info.image=equip.image,equip_info.equip_group=equip.equip_group,equip_info.property_img=equip.property_img,equip_info.symbol_id=equip.symbol_id,equip_info.symbol_name_id=equip.symbol_name_id,equip_info.frame_id=equip.frame_id,equip_info.is_same_gnrl_group=!1,equip_info.gnrl_group=equip.gnrl_group;var card_equip=CardEquipment.getInstance().createCardEquipment(equip_info,EQUIPMENT_CARD_TYPE.type_card_common);return card_equip.setAnchorPoint(ANCHOR_MIDDLE()),card_equip.setPosition(ccCenter(icon_bg)),icon_bg.addChild(card_equip),equip_info=null,layer},createLevelupEquipmentDetailInfoLayer:function(){null!=this.m_equipDetailInfoLayer&&(this.m_equipDetailInfoLayer.removeFromParent(),this.m_equipDetailInfoLayer=null),this.m_sameTypeMux=MasterManager.getInstance().get_CountFunction(EQUIPMENT_COUNT_FUNCTION_SAME_TYPE).value,this.m_equipDetailInfoLayer=this.getEquipmentDetailInfoLayer(this.m_equip),this.m_equipDetailInfoLayer.ignoreAnchorPointForPosition(!1),this.m_equipDetailInfoLayer.setAnchorPoint(ZERO()),this.m_equipDetailInfoLayer.setPosition(80,16),this.addChild(this.m_equipDetailInfoLayer)},getEquipmentDetailInfoLayer:function(equip){var layer=new cc.Layer;layer.setContentSize(cc.size(444,307));var size=cc.size(444,247),info_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_2.png",cc.Rect(20,20,20,20));info_bg.setContentSize(size),info_bg.setAnchorPoint(ZERO()),info_bg.setPosition(0,60),layer.addChild(info_bg);var rect=cc.Rect(15,15,5,5);size.width=381,size.height=31;var title_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_3.png",rect);title_bg.setContentSize(size),title_bg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),title_bg.setPosition(ccCenter(info_bg).x,227),info_bg.addChild(title_bg);var title_label=cmLabel.getLabel(equip.equip_name,LABEL_FONT_INDEX.FONT_201);title_label.setAnchorPoint(ANCHOR_MIDDLE()),title_label.setPosition(ccCenter(title_bg)),title_bg.addChild(title_label);var level_title=cmLabel.getLabel("Lv",LABEL_FONT_INDEX.FONT_1812);level_title.setAnchorPoint(ZERO()),level_title.setPosition(23,199),info_bg.addChild(level_title),this.m_currLevelLabel=cmLabel.getLabel(cmString("%d",equip.level),LABEL_FONT_INDEX.FONT_181),this.m_currLevelLabel.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_currLevelLabel.setPosition(105,199),info_bg.addChild(this.m_currLevelLabel);var arrow1=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_arrow_3.png");arrow1.setAnchorPoint(ZERO()),arrow1.setPosition(134,200),info_bg.addChild(arrow1),this.m_nextLevelLabel=cmLabel.getLabel(cmString("%d/%d",equip.level,equip.max_level),LABEL_FONT_INDEX.FONT_1820),this.m_nextLevelLabel.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_nextLevelLabel.setPosition(179,199),info_bg.addChild(this.m_nextLevelLabel);var stat_info=MasterManager.getInstance().get_ComboStat(equip.combo_stat),stat_title=cmLabel.getLabel(stat_info.name,LABEL_FONT_INDEX.FONT_1812);stat_title.setAnchorPoint(ZERO()),stat_title.setPosition(23,169),info_bg.addChild(stat_title),this.m_currStatLabel=cmLabel.getLabel(Number(equip.stat_value).toLocaleString("en"),LABEL_FONT_INDEX.FONT_181),this.m_currStatLabel.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_currStatLabel.setPosition(106,169),info_bg.addChild(this.m_currStatLabel);var arrow2=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_arrow_3.png");arrow2.setAnchorPoint(ZERO()),arrow2.setPosition(134,171),info_bg.addChild(arrow2),this.m_nextStatLabel=cmLabel.getLabel(Number(equip.stat_value).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1820),this.m_nextStatLabel.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_nextStatLabel.setPosition(179,169),info_bg.addChild(this.m_nextStatLabel);var equip_key={};equip_key.equipment_item_idx=equip.equip_id,equip_key.equipment_num=equip.equip_num;var prcnt=EquipmentService.getInstance().getEquipmentLevelupExpPrcnt(equip_key);1<prcnt?prcnt=1:prcnt<0&&(prcnt=0);var progress_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero());progress_bg.setContentSize(140,16),progress_bg.setAnchorPoint(ZERO()),progress_bg.setPosition(210,198),info_bg.addChild(progress_bg),this.m_progressBar=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green.png",RectZero()),this.m_progressBar.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_progressBar.setPosition(3,ccCenter(progress_bg).y),progress_bg.addChild(this.m_progressBar);var gauge_prcnt=prcnt*EQUIP_MAX_GAUGE_VALUE;this.m_progressBar.setScaleX(gauge_prcnt);var lv_prcnt=100*prcnt;if(100<lv_prcnt&&(lv_prcnt=100),this.m_expPrcnt=cmLabel.getLabel(cmString("%d%%",lv_prcnt),LABEL_FONT_INDEX.FONT_161),this.m_expPrcnt.enableOutline(cc.color.BLACK,1),this.m_expPrcnt.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_expPrcnt.setPosition(ccCenter(progress_bg).x+2,3),progress_bg.addChild(this.m_expPrcnt),this.m_skillInfoLayer=this.getEquipSkillLayer(equip),this.m_skillInfoLayer.setAnchorPoint(ZERO()),this.m_skillInfoLayer.setPosition(23,110),layer.addChild(this.m_skillInfoLayer),this.m_isToDeck)var gnrl_key=EquipmentService.getInstance().getGeneralKeyforEquipment(this.m_equip_key);else gnrl_key=EquipmentService.getInstance().getGeneralKeyforEquipment(this.m_selectedEquipment);var yunheeIconLayer=this.getEquipYunheeLayer(gnrl_key);yunheeIconLayer.setAnchorPoint(ZERO()),yunheeIconLayer.setPosition(356,198),layer.addChild(yunheeIconLayer);var levelupBtnLayer=this.getLevelUpButtonLayer();return levelupBtnLayer.setAnchorPoint(ZERO()),levelupBtnLayer.setPosition(ZERO()),layer.addChild(levelupBtnLayer),layer},getEquipYunheeLayer:function(gnrl_key){var layer=new cc.Layer;layer.setContentSize(cc.size(68,88));MasterManager.getInstance();var title_label=cmLabel.getLabel("着用恋姫",LABEL_FONT_INDEX.FONT_143);if(title_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),title_label.setPosition(35,72),layer.addChild(title_label),0==gnrl_key.gnrl_id){var icon=cc.Sprite.create(RES_CDN_MENU_EQUIP_NTP+"img_equip_thumb_yh.png");DISABLE_SPB_TP&&icon.setContentSize(68,68),icon.setAnchorPoint(ZERO()),icon.setPosition(ZERO()),layer.addChild(icon)}else{var card_info={};card_info.gnrl_id=gnrl_key.gnrl_id;var card=(new Card).createCard(card_info,CARD_TYPE.type_card_thumb);card.setAnchorPoint(ZERO()),card.setPosition(ZERO()),layer.addChild(card)}return layer},getLevelUpButtonLayer:function(){var layer=new cc.Layer;layer.setContentSize(444,60);var levelup_btn=new LabelButton("btn_03_off.png","btn_03_on.png","",ccui.Widget.PLIST_TEXTURE);levelup_btn.setFont(LABEL_FONT_INDEX.FONT_241),levelup_btn.setString(res_str("btn_label_levelup")),levelup_btn.setAnchorPoint(ZERO()),levelup_btn.setPosition(ZERO()),levelup_btn.setOffsetX(-100),layer.addChild(levelup_btn),levelup_btn.addClickEventListener(function(sender){0==this.m_levelupCount?MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_EQUIPMENT_NOT_SELECTED):(this.m_beforeLevel=this.m_equip.level,MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_LEVELUP))}.bind(this));var btn_select_1=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_1.png",RectZero());btn_select_1.setContentSize(ccSize(layer)),btn_select_1.setAnchorPoint(ANCHOR_MIDDLE()),btn_select_1.setPosition(ccCenter(levelup_btn)),levelup_btn.addChild(btn_select_1);var btn_select_2=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_2.png",RectZero());btn_select_2.setContentSize(ccSize(layer)),btn_select_2.setAnchorPoint(ANCHOR_MIDDLE()),btn_select_2.setPosition(ccCenter(levelup_btn)),levelup_btn.addChild(btn_select_2);var fadeout=cc.fadeOut(1),fadein=cc.fadeIn(1),seq=cc.sequence(fadeout,fadein),repeat=cc.repeatForever(seq);btn_select_2.runAction(repeat);var gold_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero());gold_box.setContentSize(123,38),gold_box.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),gold_box.setPosition(197,ccCenter(levelup_btn).y),levelup_btn.addChild(gold_box);var gold_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_sell_gold.png");return gold_icon.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),gold_icon.setPosition(180,ccCenter(levelup_btn).y),levelup_btn.addChild(gold_icon),this.m_goldCountLevelupLabel=cmLabel.getLabel(Number(this.m_needGoldCound).toLocaleString("en"),LABEL_FONT_INDEX.FONT_2011),this.m_goldCountLevelupLabel.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_goldCountLevelupLabel.setPosition(ccWidth(gold_box)-10,ccCenter(gold_box).y),gold_box.addChild(this.m_goldCountLevelupLabel),layer},onEnter:function(){this._super()},onExit:function(){if(this._super(),1!=PREV_HELP&&1!=PREV_EQUIP_SHOP&&1!=PREV_ACHIVE_EQUIP){this.m_gnrl_img=[],this.m_equipTitleLabel=null,this.m_itemPlusBtn=null,this.m_help_btn=null,this.m_gnrl_key=null,this.m_sort_btn=null,this.m_sort_Direction_btn=null,this.m_sortMenuLayer=null,this.m_partsTabLayer=null,this.m_isPartsTabVisible=!0,this.m_rightBottomSellInfoLayer=null,this.m_countLabel=null,this.m_goldCountLabel=null,this.m_selectedEquipment=null,this.m_equip_key=null,this.m_rightBottomLayer=null,this.m_buttom_btn_1=null,this.m_buttom_btn_2=null,this.m_equipListLayer=null,this.m_userEquipList=[],this.m_gnrlKeyForSelectedEquip=null,this.m_wearingEquipment=null,this.m_selectedEquipLayer=null,this.m_wearingEquipLayer=null,this.m_levelupEquipLayer=null,this.m_equipDetailInfoLayer=null,this.m_skillInfoLayer=null,this.m_currLevelLabel=null,this.m_nextLevelLabel=null,this.m_currStatLabel=null,this.m_nextStatLabel=null,this.m_progressBar=null,this.m_expPrcnt=null,this.m_goldCountLevelupLabel=null,this.m_levelupEquipKeys=[];for(var i=0;i<this.m_gnrl_img.length;i++)cc.loader.release(this.m_gnrl_img[i]);null!=this.m_character_skeleton&&(this.m_character_skeleton._skeleton.data.animations=[],this.m_character_skeleton._skeleton.data.bones=[],this.m_character_skeleton._skeleton.data.events=[],this.m_character_skeleton._skeleton.data.slots=[],this.m_character_skeleton._skeleton.data.skins=[],this.m_character_skeleton._skeleton.data.ikConstraints=[],this.m_character_skeleton._skeleton.data=null,this.m_character_skeleton._skeleton.slots=[],this.m_character_skeleton._skeleton.bones=[],this.m_character_skeleton._skeleton.drawOrder=[],this.m_character_skeleton._skeleton=null,this.m_character_skeleton=null,this.removeChild(this.m_character_skeleton)),null!=this.m_leftYunheeLayer&&(this.m_leftYunheeLayer.removeAllChildrenWithCleanup(!0),this.m_leftYunheeLayer=null),null!=this.m_leftBottomLayer&&(this.m_leftBottomLayer.removeAllChildrenWithCleanup(!0),this.m_leftBottomLayer=null),this.removeAllChildrenWithCleanup(!0)}},getCharacterLayer:function(gnrl_info){var layer=new cc.Layer;layer.setContentSize(480,640);var mt=MasterManager.getInstance(),state_type=mt.get_General(this.m_gnrl_key.gnrl_id).state_type,state_img=cc.Sprite.create(cmString(RES_CDN_DEFULT+"menu_yh/img_state_%d.png",state_type));state_img.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),state_img.setPosition(ccCenter(layer).x,112),USE_SP_MENU_YH_SCALE&&state_img.setScale(2),layer.addChild(state_img),state_img.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR);var standing_id=0;this.m_gnrl_img=[],this.m_card_img=[],standing_id=gnrl_info.class_type>=AVAIL_EVOLUTION_CLASS_TYPE_LIMIT&&0!=gnrl_info.display_class&&gnrl_info.class_type!=gnrl_info.display_class?gnrl_info.gnrl_id-1e3*(gnrl_info.class_type-gnrl_info.display_class):gnrl_info.gnrl_id;var pos=mt.get_BodyPosition(standing_id),morph=MasterTable.getInstance().get_MorphData(standing_id);if(USE_PARTNER_GNRL_LOADING)if("y"==morph.is_morph){stading_files=StandingMultiplePngList[morph.gnrl_id],gnrl=mt.get_General(morph.gnrl_id);var standing_atlas=RES_CDN_DEFULT+cmString("gnrl_%03d/standing/%d.atlas",gnrl.gnrl_group,morph.gnrl_id),standing_json=RES_CDN_DEFULT+cmString("gnrl_%03d/standing/%d.json",gnrl.gnrl_group,morph.gnrl_id);this.m_character_skeleton=new sp.SkeletonAnimation(standing_json,standing_atlas),this.m_character_skeleton.setScale(.1),this.m_character_skeleton.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_character_skeleton.setPosition(Detail_pos(pos.posx,pos.posy)),layer.addChild(this.m_character_skeleton),this.m_character_skeleton.setMix("basic","active",.1),this.m_character_skeleton.setMix("active","basic",.1),this.m_character_skeleton.setAnimation(0,"active",!1),this.m_character_skeleton.addAnimation(0,"basic",!0)}else{character_img=cc.Sprite.create(),general=mt.get_General(standing_id),img_scale=1,img_str="";if(general.gnrl_type==GENERAL_TYPE_YUNHEE){gender=mt.get_GeneralDivision(general.gnrl_group);img_scale=(gender.general_gender_type,GENDER_TYPE_M,img_str=getCardBody_ImageStr(general.gnrl_id),getCardBody_Scale(general.gnrl_id))}else img_str=getCardBody_ImageStr(general.gnrl_id),img_scale=getCardBody_Scale(general.gnrl_id);character_img.setTexture(img_str),character_img.setScale(img_scale),character_img.setAnchorPoint(ANCHOR_MIDDLE()),character_img.setPosition(Detail_pos(pos.posx+ccWidth(character_img)*img_scale/2,pos.posy+ccHeight(character_img)*img_scale/2)),layer.addChild(character_img)}else if("y"==morph.is_morph){var stading_files=StandingMultiplePngList[morph.gnrl_id],gnrl=mt.get_General(morph.gnrl_id);if(null==stading_files)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".png");else for(var idx=0;idx<stading_files.length;idx++)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+stading_files[idx]+".png");this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".atlas"),this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".json"),resourceLoader(this.m_gnrl_img,function(){var gnrl=mt.get_General(morph.gnrl_id),standing_atlas=RES_CDN_DEFULT+cmString("gnrl_%03d/standing/%d.atlas",gnrl.gnrl_group,morph.gnrl_id),standing_json=RES_CDN_DEFULT+cmString("gnrl_%03d/standing/%d.json",gnrl.gnrl_group,morph.gnrl_id);this.m_character_skeleton=new sp.SkeletonAnimation(standing_json,standing_atlas),this.m_character_skeleton.setScale(.1),this.m_character_skeleton.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_character_skeleton.setPosition(Detail_pos(pos.posx,pos.posy)),layer.addChild(this.m_character_skeleton),this.m_character_skeleton.setMix("basic","active",.1),this.m_character_skeleton.setMix("active","basic",.1),this.m_character_skeleton.setAnimation(0,"active",!1),this.m_character_skeleton.addAnimation(0,"basic",!0)}.bind(this))}else{var character_img=cc.Sprite.create(),general=mt.get_General(standing_id),img_scale=1;if(general.gnrl_type==GENERAL_TYPE_YUNHEE){var gender;if((gender=mt.get_GeneralDivision(general.gnrl_group)).general_gender_type==GENDER_TYPE_M){var img_str=getCardBody_ImageStr(general.gnrl_id);img_scale=getCardBody_Scale(general.gnrl_id),this.m_card_img.push(img_str)}else{var img_str=getCardBody_ImageStr(general.gnrl_id);img_scale=getCardBody_Scale(general.gnrl_id),this.m_card_img.push(img_str)}}else{img_str=getCardBody_ImageStr(general.gnrl_id);img_scale=getCardBody_Scale(general.gnrl_id),this.m_card_img.push(img_str)}resourceLoader(this.m_card_img,function(){character_img.setTexture(this.m_card_img.pop()),character_img.setScale(img_scale),character_img.setAnchorPoint(ANCHOR_MIDDLE()),character_img.setPosition(Detail_pos(pos.posx+ccWidth(character_img)*img_scale/2,pos.posy+ccHeight(character_img)*img_scale/2)),layer.addChild(character_img)}.bind(this))}return layer},getLeftBottomLayer:function(gnrl_info){var layer=new cc.Layer;layer.setContentSize(ccWidth(this)-478,320);var name_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_namebox.png");name_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),name_box.setPosition(ccCenter(layer).x,0),layer.addChild(name_box);var gnrl_name=null;(gnrl_name=gnrl_info.gnrl_type==GENERAL_TYPE_MATERIAL?cmLabel.getLabel(gnrl_info.name,LABEL_FONT_INDEX.FONT_221):8<gnrl_info.name.length?cmLabel.getLabel(gnrl_info.name,LABEL_FONT_INDEX.FONT_161):cmLabel.getLabel(gnrl_info.name,LABEL_FONT_INDEX.FONT_261)).setAnchorPoint(ANCHOR_MIDDLE()),gnrl_name.setPosition(ccCenter(name_box)),gnrl_name.enableOutline(cc.color.BLACK,1),name_box.addChild(gnrl_name),cmLabel.autoSizeFit(gnrl_name,186,26);var rare_type_sprite=this.getRareTypeSprite(gnrl_info);if(rare_type_sprite.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),rare_type_sprite.setPosition(ccCenter(layer).x,84),layer.addChild(rare_type_sprite),0<gnrl_info.limit_step_id){var limit_step_icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_yh/img_ic_limit_%d.png",gnrl_info.limit_step_id));limit_step_icon.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),limit_step_icon.setPosition(ccCenter(layer).x,178),layer.addChild(limit_step_icon)}return layer},getRareTypeSprite:function(gnrl_info){var rare_type_mark=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_yh/img_yh_unique_%02d.png",gnrl_info.rare_type));if(gnrl_info.gnrl_type!=GENERAL_TYPE_MATERIAL){var class_type_star_path=RES_CDN_DEFULT;gnrl_info.rare_type==RARE_TYPE_N||gnrl_info.rare_type==RARE_TYPE_HN?class_type_star_path+="menu_yh/img_yh_unique_star_n.png":gnrl_info.rare_type==RARE_TYPE_R?class_type_star_path+="menu_yh/img_yh_unique_star_r.png":gnrl_info.rare_type==RARE_TYPE_HR?class_type_star_path+="menu_yh/img_yh_unique_star_hr.png":gnrl_info.rare_type==RARE_TYPE_SR?gnrl_info.class_type>YUNHEE_MAX_CLASS_TYPE?class_type_star_path+="menu_yh/img_yh_unique_star_ss_2.png":class_type_star_path+="menu_yh/img_yh_unique_star_s.png":gnrl_info.rare_type==RARE_TYPE_SSR&&(gnrl_info.class_type>YUNHEE_MAX_CLASS_TYPE?class_type_star_path+="menu_yh/img_yh_unique_star_ss_2.png":class_type_star_path+="menu_yh/img_yh_unique_star_ss.png");for(var class_star_layer=new cc.Layer,i=1;i<gnrl_info.class_type;++i){var class_type_star=cc.Sprite.create(class_type_star_path);class_type_star.setAnchorPoint(ZERO()),class_type_star.setPosition((i-1)*ccWidth(class_type_star),0),class_star_layer.addChild(class_type_star)}class_star_layer.setContentSize(28*(gnrl_info.class_type-1),29),class_star_layer.ignoreAnchorPointForPosition(!1),class_star_layer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),class_star_layer.setPosition(ccCenter(rare_type_mark).x,67),rare_type_mark.addChild(class_star_layer)}else{-1!=res_img_yh_exp.indexOf(gnrl_info.rare_type)&&rare_type_mark.setTexture(cmString(RES_CDN_DEFULT+"menu_yh/img_yh_exp_%02d.png",gnrl_info.rare_type))}return rare_type_mark},doSort:function(){if(0!=this.m_userEquipList.length)switch(this.m_sortType!=EQUIP_SORT_TYPE.SORT_SERIES&&(this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return this.m_isSortDesc?l.symbol_name_id%100<r.symbol_name_id%100:l.symbol_name_id%100>r.symbol_name_id%100}.bind(this))),this.m_sortType!=EQUIP_SORT_TYPE.SORT_ELEMENT_TYPE&&(this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return this.m_isSortDesc?l.symbol_id<r.symbol_id:l.symbol_id>r.symbol_id}.bind(this))),this.m_sortType!=EQUIP_SORT_TYPE.SORT_ARM_SERVICE_TYPE&&(this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return this.m_isSortDesc?l.arm_service_type<r.arm_service_type:l.arm_service_type>r.arm_service_type}.bind(this))),this.m_sortType!=EQUIP_SORT_TYPE.SORT_WEARING&&(this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return this.m_isSortDesc?l.equip_yn<r.equip_yn:l.equip_yn>r.equip_yn}.bind(this))),this.m_sortType!=EQUIP_SORT_TYPE.SORT_GAIN_ORDER&&(this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return this.m_isSortDesc?l.equip_num<r.equip_num:l.equip_num>r.equip_num}.bind(this))),this.m_sortType!=EQUIP_SORT_TYPE.SORT_PARTS_TYPE&&(this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return this.m_isSortDesc?l.equip_parts_type<r.equip_parts_type:l.equip_parts_type>r.equip_parts_type}.bind(this))),this.m_sortType!=EQUIP_SORT_TYPE.SORT_LEVEL&&(this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return l.level<r.level}.bind(this))),this.m_sortType!=EQUIP_SORT_TYPE.SORT_PLUS_VALUE&&(this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return this.m_isSortDesc?l.equip_step<r.equip_step:l.equip_step>r.equip_step}.bind(this))),this.m_sortType!=EQUIP_SORT_TYPE.SORT_RARE_TYPE&&(this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return this.m_isSortDesc?l.equip_rare_type<r.equip_rare_type:l.equip_rare_type>r.equip_rare_type}.bind(this))),this.m_sortType){case EQUIP_SORT_TYPE.SORT_PARTS_TYPE:this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return this.m_isSortDesc?l.equip_parts_type<r.equip_parts_type:l.equip_parts_type>r.equip_parts_type}.bind(this));break;case EQUIP_SORT_TYPE.SORT_RARE_TYPE:this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return this.m_isSortDesc?l.equip_rare_type<r.equip_rare_type:l.equip_rare_type>r.equip_rare_type}.bind(this));break;case EQUIP_SORT_TYPE.SORT_LEVEL:this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return this.m_isSortDesc?l.level<r.level:l.level>r.level}.bind(this));break;case EQUIP_SORT_TYPE.SORT_PLUS_VALUE:this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return this.m_isSortDesc?l.equip_step<r.equip_step:l.equip_step>r.equip_step}.bind(this));break;case EQUIP_SORT_TYPE.SORT_WEARING:this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return this.m_isSortDesc?l.equip_yn<r.equip_yn:l.equip_yn>r.equip_yn}.bind(this));break;case EQUIP_SORT_TYPE.SORT_GAIN_ORDER:this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return this.m_isSortDesc?l.equip_num<r.equip_num:l.equip_num>r.equip_num}.bind(this));break;case EQUIP_SORT_TYPE.SORT_ELEMENT_TYPE:this.m_userEquipList=stable(this.m_userEquipList,function(l,r){if(this.m_isSortDesc){if(900<l.symbol_id){if(0<r.symbol_id&&r.symbol_id<900)return!0}else if(900<r.symbol_id&&0<l.symbol_id&&l.symbol_id<900)return!1;return l.symbol_id<r.symbol_id}if(900<l.symbol_id){if(0<r.symbol_id&&r.symbol_id<900)return!1}else if(900<r.symbol_id&&0<l.symbol_id&&l.symbol_id<900)return!0;return l.symbol_id>r.symbol_id}.bind(this));break;case EQUIP_SORT_TYPE.SORT_SERIES:this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return this.m_isSortDesc?l.symbol_name_id%100<r.symbol_name_id%100:l.symbol_name_id%100>r.symbol_name_id%100}.bind(this))}},selectEquipment:function(equipment_id,equipment_num){if(this.m_layerState==EQUIP_LAYER_STATE.MAIN)this.m_selectedEquipment.equipment_item_idx=equipment_id,this.m_selectedEquipment.equipment_num=equipment_num;else if(this.m_layerState==EQUIP_LAYER_STATE.SELL){0<this.m_selectedEquipment.equipment_item_idx&&this.toggleSelectedEquip(this.m_selectedEquipment,!1),this.m_selectedEquipment={equipment_item_idx:0,equipment_num:0},this.m_selectedEquipment.equipment_item_idx=equipment_id,this.m_selectedEquipment.equipment_num=equipment_num,(equip_key={}).equipment_item_idx=equipment_id,equip_key.equipment_num=equipment_num;for(var is_add=!0,idx=0;idx<this.m_sellEquipKeys.length;idx++){if((iter=this.m_sellEquipKeys[idx]).equipment_item_idx==equip_key.equipment_item_idx&&iter.equipment_num==equip_key.equipment_num){is_add=!1,this.m_sellEquipKeys=this.m_sellEquipKeys.filter(function(object){return object.equipment_item_idx!=equip_key.equipment_item_idx||object.equipment_num!=equip_key.equipment_num});break}}var equip_level_info={};if(EquipmentService.getInstance().getEquipmentLevelInfo(this.m_selectedEquipment,equip_level_info),1==is_add){if(this.m_sellCount>=MAX_SELL_COUNT)return void MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.OVER_MAX_COUNT);this.m_sellEquipKeys.push($.extend({},this.m_selectedEquipment)),this.m_gainGoldCount+=equip_level_info.gain_sell_gold}else this.m_gainGoldCount-=equip_level_info.gain_sell_gold,this.m_gainGoldCount<0&&(this.m_gainGoldCount=0);this.m_sellCount=this.m_sellEquipKeys.length,this.toggleSellSelectedEquip(this.m_selectedEquipment,is_add),this.toggleSelectedEquip(this.m_selectedEquipment,!0),this.updateRightSellInfoLayer()}else if(this.m_layerState==EQUIP_LAYER_STATE.CHANGE){0<this.m_selectedEquipment.equipment_item_idx&&this.toggleSelectedEquip(this.m_selectedEquipment,!1),this.m_selectedEquipment={equipment_item_idx:0,equipment_num:0},this.m_selectedEquipment.equipment_item_idx=equipment_id,this.m_selectedEquipment.equipment_num=equipment_num;var info=$.extend({},db.UserEquipment);EquipmentService.getInstance().getUserEquipmentInfo(this.m_selectedEquipment,info,this.m_gnrl_key);var gnrl_key=EquipmentService.getInstance().getGeneralKeyforEquipment(this.m_selectedEquipment);if(this.m_gnrlKeyForSelectedEquip.gnrl_id=gnrl_key.gnrl_id,this.m_gnrlKeyForSelectedEquip.gnrl_num=gnrl_key.gnrl_num,this.m_isSameEquip=!1,this.m_isWearingEquip=!1,this.m_wearingEquipment.equipment_item_idx=0,this.m_wearingEquipment.equipment_num=0,info.equip_type!=EQUIPMENT_TYPE_EXP)for(idx=0;idx<this.m_userGnrlEquipList.length;idx++){var user_equip=this.m_userGnrlEquipList[idx];if(user_equip.equip_parts_type==info.equip_parts_type){this.m_isWearingEquip=!0,this.m_wearingEquipment.equipment_item_idx=user_equip.equip_id,this.m_wearingEquipment.equipment_num=user_equip.equip_num,this.m_wearingEquipment.equipment_item_idx==this.m_selectedEquipment.equipment_item_idx&&this.m_wearingEquipment.equipment_num==this.m_selectedEquipment.equipment_num&&(this.m_isSameEquip=!0);break}}this.toggleSelectedEquip(this.m_selectedEquipment,!0)}else if(this.m_layerState==EQUIP_LAYER_STATE.LEVELUP){if(this.m_selectedEquipment.equipment_item_idx=equipment_id,this.m_selectedEquipment.equipment_num=equipment_num,this.m_equip.level==this.m_equip.max_level)return void MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.OVER_MAX_LEVEL);var equip_key;(equip_key={}).equipment_item_idx=equipment_id,equip_key.equipment_num=equipment_num;for(is_add=!0,idx=0;idx<this.m_levelupEquipKeys.length;idx++){var iter;if((iter=this.m_levelupEquipKeys[idx]).equipment_item_idx==equip_key.equipment_item_idx&&iter.equipment_num==equip_key.equipment_num){is_add=!1,this.m_levelupEquipKeys=this.m_levelupEquipKeys.filter(function(object){return object.equipment_item_idx!=equip_key.equipment_item_idx||object.equipment_num!=equip_key.equipment_num});break}}equip_level_info={};var es=EquipmentService.getInstance();es.getEquipmentLevelInfo(equip_key,equip_level_info);var user_equip_info={};es.getUserEquipmentInfo(equip_key,user_equip_info,this.m_gnrl_key);var selected_equip_info={};es.getUserEquipmentInfo(this.m_equip_key,selected_equip_info,this.m_gnrl_key);var mux_value=1;if(selected_equip_info.arm_service_type!=ARMSERVICETYPE_NONE&&selected_equip_info.arm_service_type==user_equip_info.arm_service_type)mux_value=MasterManager.getInstance().get_CountFunction(EQUIPMENT_COUNT_FUNCTION_SAME_TYPE).value;if(1==is_add){if(1==this.m_overMaxLevel)return void MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.OVER_MAX_LEVEL);if(this.m_levelupCount>=MAX_LEVELUP_COUNT)return void MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.OVER_MAX_COUNT);this.m_levelupEquipKeys.push(equip_key),this.m_needGoldCound+=equip_level_info.need_mtrl_gold,this.m_gain_exp+=equip_level_info.gain_mtrl_exp*mux_value}else this.m_needGoldCound-=equip_level_info.need_mtrl_gold,this.m_gain_exp-=equip_level_info.gain_mtrl_exp*mux_value,this.m_needGoldCound<0&&(this.m_needGoldCound=0);this.m_levelupCount=this.m_levelupEquipKeys.length;var exp_obj=EquipmentService.getInstance().getExpectedEquipmentLevelupExpPrcnt(this.m_equip_key,this.m_gain_exp,this.m_expectedLevel,this.m_expectedStatValue);this.m_prcnt=exp_obj.prcnt,this.m_expectedLevel=exp_obj.expected_level,this.m_expectedStatValue=exp_obj.expected_stat_value,1<this.m_prcnt?this.m_prcnt=1:this.m_prcnt<0&&(this.m_prcnt=0),this.m_expectedLevel<this.m_equip.level&&(this.m_expectedLevel=this.m_equip.level),this.m_expectedStatValue<this.m_equip.stat_value&&(this.m_expectedStatValue=this.m_equip.stat_value),this.m_equip.max_level>=MININUM_MAX_LEVEL&&this.m_expectedLevel>=this.m_equip.max_level?this.m_overMaxLevel=!0:1==this.m_overMaxLevel&&(this.m_overMaxLevel=!1),this.toggleSellSelectedEquip(equip_key,is_add)}},updateSelectedEquipLayer:function(){null!=this.m_selectedEquipLayer&&(this.m_selectedEquipLayer.removeFromParent(),this.m_selectedEquipLayer=null),0!=this.m_selectedEquipment.equipment_item_idx&&this.getSelectedEquipmentLayer()},getSelectedEquipmentLayer:function(){var gnrl_key=EquipmentService.getInstance().getGeneralKeyforEquipment(this.m_selectedEquipment),isLockBtn=!1;this.m_layerState==EQUIP_LAYER_STATE.CHANGE&&(isLockBtn=!0),this.m_selectedEquipLayer=this.getEquipDetailLayer(this.m_selectedEquipment,gnrl_key,isLockBtn),this.m_selectedEquipLayer.setAnchorPoint(ZERO()),this.m_selectedEquipLayer.setPosition((ccWidth(this)-533)/2-ccWidth(this.m_selectedEquipLayer)/2,274),this.addChild(this.m_selectedEquipLayer,2)},updateWearingEquipLayer:function(){null!=this.m_wearingEquipLayer&&(this.m_wearingEquipLayer.removeFromParent(),this.m_wearingEquipLayer=null),1==this.m_isWearingEquip&&this.getWearingEquipmentLayer()},getWearingEquipmentLayer:function(){if(1==this.m_isWearingEquip){var gnrl_key=EquipmentService.getInstance().getGeneralKeyforEquipment(this.m_wearingEquipment);EquipmentService.getInstance().getUserEquipmentInfo(this.m_wearingEquipment,{},gnrl_key),this.m_wearingEquipLayer=this.getEquipDetailLayer(this.m_wearingEquipment,gnrl_key,!0,!0),this.m_wearingEquipLayer.setAnchorPoint(ZERO()),this.m_wearingEquipLayer.setPosition((ccWidth(this)-533)/2-ccWidth(this.m_wearingEquipLayer)/2,4),this.addChild(this.m_wearingEquipLayer,2)}},getEquipDetailLayer:function(equip_key,gnrl_key,use_btn,wear_equip){var layer=new cc.Layer;layer.setContentSize(cc.size(444,270)),null==wear_equip&&(wear_equip=0);MasterManager.getInstance();var info={};EquipmentService.getInstance().getUserEquipmentInfo(equip_key,info,gnrl_key);var info_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_2.png",cc.Rect(20,20,20,20));info_bg.setContentSize(ccSize(layer)),info_bg.setAnchorPoint(ZERO()),info_bg.setPosition(ZERO()),layer.addChild(info_bg);var size=cc.size(162,31),title_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_8.png",cc.Rect(10,4,4,20));title_bg.setContentSize(size),title_bg.setAnchorPoint(ANCHOR_TOP_LEFT()),title_bg.setPosition(0,ccHeight(info_bg)-5),info_bg.addChild(title_bg);var title_offset_x=0;if(1==use_btn){var lock_off,lock_on,is_lock="y"==info.lock_yn;lock_on=is_lock?(lock_off="btn_equip_lock_red_off.png","btn_equip_lock_red_on.png"):(lock_off="btn_equip_lock_purple_off.png","btn_equip_lock_purple_on.png");var lock_btn=new ccui.Button(lock_off,lock_on,"",ccui.Widget.PLIST_TEXTURE);lock_btn.setAnchorPoint(ANCHOR_TOP_LEFT()),lock_btn.setPosition(3,ccHeight(title_bg)+3),title_bg.addChild(lock_btn),lock_btn.addClickEventListener(function(sender){1==is_lock?MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_UNLOCK+sender.getTag()):MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_LOCK+sender.getTag())}),lock_btn.setTag(wear_equip),title_offset_x+=26}var title_label=cmLabel.getLabel("装備",LABEL_FONT_INDEX.FONT_201);if(title_label.setAnchorPoint(ZERO()),title_label.setPosition(20+title_offset_x,6),title_bg.addChild(title_label),this.getEquipInfoLayer(info_bg,info),info.equip_type!=EQUIPMENT_TYPE_EXP){var skillInfoLayer=this.getEquipSkillLayer(info);skillInfoLayer.setAnchorPoint(ZERO()),skillInfoLayer.setPosition(23,17),layer.addChild(skillInfoLayer);var yunheeIconLayer=this.getEquipYunheeLayer(gnrl_key);if(yunheeIconLayer.setAnchorPoint(ZERO()),yunheeIconLayer.setPosition(356,129),layer.addChild(yunheeIconLayer),null!=info.equip_group&&0!=info.equip_group){var set_effect_btn=new ccui.Button("btn_equip_set_off.png","btn_equip_set_on.png","",ccui.Widget.PLIST_TEXTURE);set_effect_btn.setAnchorPoint(ANCHOR_TOP_LEFT()),set_effect_btn.setPosition(355,ccHeight(info_bg)-18),info_bg.addChild(set_effect_btn),set_effect_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_EquipmentScene_WebV2],EQUIP_NOTI_TYPE.BTN_SET_EFFECT+sender.getTag())}),set_effect_btn.setTag(wear_equip)}}return layer},getEquipInfoLayer:function(parent,info){var equip_info={};equip_info.equip_id=info.equip_id,equip_info.equip_rare_type=info.equip_rare_type,equip_info.equip_parts_type=info.equip_parts_type,equip_info.arm_service_type=info.arm_service_type,equip_info.equip_type=info.equip_type,equip_info.level=info.level,equip_info.step=info.equip_step,equip_info.is_equip="y"==info.equip_yn,equip_info.is_lock="y"==info.lock_yn,equip_info.image=info.image,equip_info.equip_group=info.equip_group,equip_info.property_img=info.property_img,equip_info.frame_id=info.frame_id,equip_info.symbol_id=info.symbol_id,equip_info.symbol_name_id=info.symbol_name_id,equip_info.is_same_gnrl_group=!1,equip_info.gnrl_group=info.gnrl_group;var card_equip=CardEquipment.getInstance().createCardEquipment(equip_info,EQUIPMENT_CARD_TYPE.type_card_common);card_equip.setAnchorPoint(ZERO()),card_equip.setPosition(20,129),parent.addChild(card_equip);var mt=MasterManager.getInstance(),name_label=(mt.get_EquipmentItem(info.equip_id),cmLabel.getLabel(info.equip_name,LABEL_FONT_INDEX.FONT_201));if(name_label.setAnchorPoint(ZERO()),name_label.setPosition(128,204),cmLabel.autoSizeFit(name_label,230,20),parent.addChild(name_label),info.equip_parts_type>EQUIPMENT_PARTS_NONE){var parts_info=mt.get_EquipmentPartsType(info.equip_parts_type),type_title=cmLabel.getLabel(parts_info.name,LABEL_FONT_INDEX.FONT_1812);type_title.setAnchorPoint(ZERO()),type_title.setPosition(ccPos(name_label).x,181),parent.addChild(type_title),info.equip_parts_type==EQUIPMENT_PRIVATE&&0==info.gnrl_group&&type_title.setString(res_str("label_weapon"))}var stat_info=mt.get_ComboStat(info.combo_stat),stat_title=cmLabel.getLabel(stat_info.name,LABEL_FONT_INDEX.FONT_1812);stat_title.setAnchorPoint(ZERO()),stat_title.setPosition(ccPos(name_label).x,156),parent.addChild(stat_title);var stat_label=cmLabel.getLabel(Number(info.stat_value).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1820);stat_label.setAnchorPoint(ZERO()),stat_label.setPosition(ccPos(stat_title).x+ccWidth(stat_title),ccPos(stat_title).y),parent.addChild(stat_label);var level_title=cmLabel.getLabel("Lv",LABEL_FONT_INDEX.FONT_1812);level_title.setAnchorPoint(ZERO()),level_title.setPosition(ccPos(name_label).x,129),parent.addChild(level_title);var level_label=cmLabel.getLabel(cmString("%d/%d",info.level,info.max_level),LABEL_FONT_INDEX.FONT_181);level_label.setAnchorPoint(ZERO()),level_label.setPosition(ccPos(level_title).x+ccWidth(level_title),ccPos(level_title).y),parent.addChild(level_label);var equip_key={};equip_key.equipment_item_idx=info.equip_id,equip_key.equipment_num=info.equip_num;var prcnt=EquipmentService.getInstance().getEquipmentLevelupExpPrcnt(equip_key);1<prcnt?prcnt=1:prcnt<0&&(prcnt=0);var progress_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero());progress_bg.setContentSize(140,16),progress_bg.setAnchorPoint(ZERO()),progress_bg.setPosition(210,131),parent.addChild(progress_bg);var progress_bar=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green.png",RectZero());progress_bar.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),progress_bar.setPosition(3,ccCenter(progress_bg).y),progress_bg.addChild(progress_bar);var gauge_prcnt=prcnt*EQUIP_MAX_GAUGE_VALUE;progress_bar.setScaleX(gauge_prcnt);var lv_prcnt=100*prcnt;100<lv_prcnt&&(lv_prcnt=100);var exp_prcnt=cmLabel.getLabel(cmString("%d%%",lv_prcnt),LABEL_FONT_INDEX.FONT_161);exp_prcnt.enableOutline(cc.color.BLACK,1),exp_prcnt.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),exp_prcnt.setPosition(ccCenter(progress_bg).x+2,3),progress_bg.addChild(exp_prcnt)},getEquipYunheeLayer:function(gnrl_key){var layer=new cc.Layer;layer.setContentSize(cc.size(68,88));MasterManager.getInstance();var title_label=cmLabel.getLabel("着用恋姫",LABEL_FONT_INDEX.FONT_143);if(title_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),title_label.setPosition(35,72),layer.addChild(title_label),0==gnrl_key.gnrl_id){var icon=cc.Sprite.create(RES_CDN_MENU_EQUIP_NTP+"img_equip_thumb_yh.png");DISABLE_SPB_TP&&icon.setContentSize(68,68),icon.setAnchorPoint(ZERO()),icon.setPosition(ZERO()),layer.addChild(icon)}else{var card_info={};card_info.gnrl_id=gnrl_key.gnrl_id;var card=(new Card).createCard(card_info,CARD_TYPE.type_card_thumb);card.setAnchorPoint(ZERO()),card.setPosition(ZERO()),layer.addChild(card)}return layer},getEquipSkillLayer:function(info){var layer=new cc.Layer;layer.setContentSize(cc.size(404,100));MasterManager.getInstance();var skill_title=cmLabel.getLabel("スキル",LABEL_FONT_INDEX.FONT_1812);skill_title.setAnchorPoint(ZERO()),skill_title.setPosition(0,80),layer.addChild(skill_title);var pos_y=64,skill_str=[];if(EquipmentService.getInstance().getEquipmentSkillContent(info,skill_str),0<=info.option_id1&&0<=info.option_num1&&null!=skill_str[0]){var skill_label1=cmLabel.getLabel(skill_str[0],LABEL_FONT_INDEX.FONT_143);1<(lineCnt=EQUIPLINECOUNT(skill_str[0]))&&(pos_y-=15*(lineCnt-1)),skill_label1.setAnchorPoint(ZERO()),skill_label1.setPosition(0,pos_y),layer.addChild(skill_label1),pos_y-=15}if(0<=info.option_id2&&0<=info.option_num2&&null!=skill_str[1]){var skill_label2=cmLabel.getLabel(skill_str[1],LABEL_FONT_INDEX.FONT_143);1<(lineCnt=EQUIPLINECOUNT(skill_str[1]))&&(pos_y-=15*(lineCnt-1)),skill_label2.setAnchorPoint(ZERO()),skill_label2.setPosition(0,pos_y),layer.addChild(skill_label2),pos_y-=15}if(0<=info.option_id3&&0<=info.option_num3&&null!=skill_str[2]){var skill_label3=cmLabel.getLabel(skill_str[2],LABEL_FONT_INDEX.FONT_143);1<(lineCnt=EQUIPLINECOUNT(skill_str[2]))&&(pos_y-=15*(lineCnt-1)),skill_label3.setAnchorPoint(ZERO()),skill_label3.setPosition(0,pos_y),layer.addChild(skill_label3),pos_y-=15}if(0<=info.option_id4&&0<=info.option_num4&&null!=skill_str[3]){var skill_label4=cmLabel.getLabel(skill_str[3],LABEL_FONT_INDEX.FONT_143);1<(lineCnt=EQUIPLINECOUNT(skill_str[3]))&&(pos_y-=15*(lineCnt-1)),skill_label4.setAnchorPoint(ZERO()),skill_label4.setPosition(0,pos_y),layer.addChild(skill_label4),pos_y-=15}if(0<=info.option_id5&&0<=info.option_num5&&null!=skill_str[4]){var lineCnt,skill_label5=cmLabel.getLabel(skill_str[4],LABEL_FONT_INDEX.FONT_143);1<(lineCnt=EQUIPLINECOUNT(skill_str[4]))&&(pos_y-=15*(lineCnt-1)),skill_label5.setAnchorPoint(ZERO()),skill_label5.setPosition(0,pos_y),layer.addChild(skill_label5),pos_y-=15}return layer},toggleSelectedEquip:function(equip_key,set){for(var idx=0;idx<this.m_userEquipList.length;idx++)if(equip_key.equipment_num==this.m_userEquipList[idx].equip_num){this.m_userEquipList[idx].is_selected=set;break}},toggleSellSelectedEquip:function(equip_key,set){for(var idx=0;idx<this.m_userEquipList.length;idx++)if(equip_key.equipment_num==this.m_userEquipList[idx].equip_num){this.m_userEquipList[idx].is_sell_selected=set;break}},updateEquipmentData:function(){this.m_equipListLayer.setEquipmentData(this.m_userEquipList)},getLayerState:function(){return this.m_layerState},getCurrentPartsFilter:function(){return this.m_parts_filter},getCurrentTabFilter:function(){return this.m_tab_filter},saveEquipmentListOffSet:function(){this.m_equipListLayer.saveEquipmentListOffSet()},setEquipmentListOffset:function(){this.m_equipListLayer.setEquipmentListOffset()},saveEquipmentListSubOffSet:function(){this.m_equipListLayer.saveEquipmentListSubOffSet()},setEquipmentListSubOffset:function(){this.m_equipListLayer.setEquipmentListSubOffset()},setInitSellData:function(){if(this.m_layerState==EQUIP_LAYER_STATE.LEVELUP)return 0<this.m_equip_key.equipment_item_idx&&(this.m_equip={},EquipmentService.getInstance().getUserEquipmentInfo(this.m_equip_key,this.m_equip,this.m_gnrl_key),this.m_expectedLevel=this.m_equip.level,this.m_expectedStatValue=this.m_equip.stat_value,this.m_prcnt=EquipmentService.getInstance().getEquipmentLevelupExpPrcnt(this.m_equip_key),1<this.m_prcnt?this.m_prcnt=1:this.m_prcnt<0&&(this.m_prcnt=0)),this.m_levelupCount=0,this.m_needGoldCound=0,this.m_gain_exp=0,this.m_overMaxLevel=!1,void(this.m_levelupEquipKeys=[]);this.m_selectedEquipment={equipment_item_idx:0,equipment_num:0},this.m_wearingEquipment={equipment_item_idx:0,equipment_num:0},this.m_isSameEquip=!1,this.m_isWearingEquip=!1,this.m_sellCount=0,this.m_sellEquipKeys=[],this.m_gainGoldCount=0},getSellEquipmentListInfo:function(){for(var sell_equip_list=[],tempList=[],idx=0;idx<this.m_userEquipList.length;idx++)tempList.push($.extend({},this.m_userEquipList[idx])),1==tempList[idx].is_sell_selected&&(tempList[idx].is_selected=!1,tempList[idx].is_sell_selected=!1,sell_equip_list.push(tempList[idx]));return sell_equip_list},getSellEquipmentsInfo:function(){return{equip_count:this.m_sellCount,gold_count:this.m_gainGoldCount}},getSelectedEquipment:function(){return this.m_selectedEquipment},getWearingEquipment:function(){return this.m_wearingEquipment},getGnrlKeyForSelectedEquipment:function(){return this.m_gnrlKeyForSelectedEquip},getLevelupEquipment:function(){return this.m_equip_key},getLevelupEquipmentList:function(){return this.m_levelupEquipKeys},checkOver2StepEquipment:function(){var es=EquipmentService.getInstance();if(this.m_layerState==EQUIP_LAYER_STATE.LEVELUP){for(var idx=0;idx<this.m_levelupEquipKeys.length;idx++){var sell_equip=this.m_levelupEquipKeys[idx],user_equip={};if(es.getUserEquipmentInfo(sell_equip,user_equip),user_equip.equip_rare_type>=WARNING_RARE_TYPE&&user_equip.equip_type!=EQUIPMENT_TYPE_EXP)return!0}return!1}if(this.m_layerState==EQUIP_LAYER_STATE.SELL){for(idx=0;idx<this.m_sellEquipKeys.length;idx++){sell_equip=this.m_sellEquipKeys[idx],user_equip={};if(es.getUserEquipmentInfo(sell_equip,user_equip,this.m_gnrl_key),user_equip.equip_rare_type>=WARNING_RARE_TYPE&&user_equip.equip_type!=EQUIPMENT_TYPE_EXP)return!0}return!1}},isLevelup:function(){return this.m_expectedLevel>this.m_beforeLevel},getSellEquipmentList:function(){return this.m_sellEquipKeys},selectBatchSellItems:function(){var val=arguments;if(1<val.length)this.selectBatchSellItems_V2(val[0],val[1],val[2],val[3],val[4]);else{var select_item_count=val[0];this.m_isBatchSell=!0,this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return l.equip_step<r.equip_step}),this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return l.equip_rare_type<r.equip_rare_type}),this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return l.level<r.level});for(var count=0,idx=0;idx<this.m_userEquipList.length;idx++){var user_equip=this.m_userEquipList[idx];if(select_item_count<=count)break;if(user_equip.equip_rare_type<=MAX_BATCH_SELL_RARE_TYPE){count++,user_equip.is_sell_selected=!0;var chagne_equip={};chagne_equip.equipment_item_idx=user_equip.equip_id,chagne_equip.equipment_num=user_equip.equip_num,this.m_sellEquipKeys.push(chagne_equip);var equip_level_info={};EquipmentService.getInstance().getEquipmentLevelInfo(chagne_equip,equip_level_info),this.m_gainGoldCount+=equip_level_info.gain_sell_gold}}this.m_sellCount=this.m_sellEquipKeys.length}},selectBatchSellItems_V2:function(grades,equip_types,steps,mtrl_grades,count){var service=EquipmentService.getInstance();this.m_isBatchSell=!0,this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return l.equip_step>r.equip_step}),this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return l.equip_rare_type>r.equip_rare_type}),this.m_userEquipList=stable(this.m_userEquipList,function(l,r){return l.level>r.level});for(var choice_count=0,is_grade=!1,is_step=!1,is_equip_type=!1,is_mtrl_sell=0<mtrl_grades.length,sell_equip={},idx=0;idx<this.m_userEquipList.length;idx++){var equip=this.m_userEquipList[idx];if(count<=choice_count)break;if(is_equip_type=is_step=is_grade=!1,is_mtrl_sell){if(3==equip.equip_type){for(var i=0;i<mtrl_grades.length;i++)if(mtrl_grades[i]==equip.equip_rare_type){is_grade=!0;break}if(is_grade){equip.is_sell_selected=!0,sell_equip.equipment_item_idx=equip.equip_id,sell_equip.equipment_num=equip.equip_num,this.m_sellEquipKeys.push($.extend({},sell_equip));var equip_level_info={};service.getEquipmentLevelInfo(sell_equip,equip_level_info),this.m_gainGoldCount+=equip_level_info.gain_sell_gold,choice_count++}}}else{for(i=0;i<equip_types.length;i++)if(equip_types[i]==equip.equip_parts_type){is_equip_type=!0;break}for(i=0;i<grades.length;i++)if(grades[i]==equip.equip_rare_type){is_grade=!0;break}for(i=0;i<steps.length;i++)if(steps[i]==equip.equip_step){is_step=!0;break}if(is_grade&&is_step&&is_equip_type){equip.is_sell_selected=!0,sell_equip.equipment_item_idx=equip.equip_id,sell_equip.equipment_num=equip.equip_num,this.m_sellEquipKeys.push($.extend({},sell_equip));equip_level_info={};service.getEquipmentLevelInfo(sell_equip,equip_level_info),this.m_gainGoldCount+=equip_level_info.gain_sell_gold,choice_count++}}}this.m_sellCount=this.m_sellEquipKeys.length},setUserGeneralEquipmentList:function(gnrl_key,gnrl_equip_list){this.m_userGnrlEquipList=[];for(var idx=0;idx<gnrl_equip_list.length;idx++)this.m_userGnrlEquipList.push($.extend({},gnrl_equip_list[idx]))},setLevelUpToChangeData:function(){0<this.m_equip_key.equipment_item_idx&&(this.m_selectedEquipment.equipment_item_idx=this.m_equip_key.equipment_item_idx,this.m_selectedEquipment.equipment_num=this.m_equip_key.equipment_num),this.m_equip_key={equipment_item_idx:0,equipment_num:0}},setIsToDeck:function(isDeck){this.m_isToDeck=isDeck}}),EquipmentListLayer_WebV2=cc.Layer.extend({m_table_view:null,m_is_longtouch:null,m_long_popup:null,m_noItemsLabel:null,m_is_longoutchable:!1,m_cellSize:cc.size(0,0),m_columnCount:0,m_equipList:[],m_gameObserver:null,m_is_lastlongtouch:!1,m_cellList:[],ctor:function(){this._super(),this.m_equipList=[],this.m_cellList=[],this.init()},init:function(){return this.m_gameObserver=MainObserver.getInstance(),this._super(),!0},setTags:function(tag){this.setTag(tag)},setCellSizeAndColumnCount:function(tSize,column_count){this.m_cellSize.width=tSize.width,this.m_cellSize.height=tSize.height,this.m_columnCount=column_count},initLayout:function(tSize){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(tSize),this.m_table_view=new cc.TableView(this,tSize),this.m_table_view.ignoreAnchorPointForPosition(!1),this.m_table_view.setAnchorPoint(ANCHOR_MIDDLE()),this.m_table_view.setPosition(ccCenter(this)),this.m_table_view.scrollBarEnable(!0),this.m_table_view.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_table_view.setVerticalFillOrder(0),this.m_table_view.setDelegate(this),this.addChild(this.m_table_view),this.m_noItemsLabel=cmLabel.getLabel("保有装備はありません。",LABEL_FONT_INDEX.FONT_261),this.m_noItemsLabel.setAnchorPoint(ANCHOR_MIDDLE()),this.m_noItemsLabel.setPosition(ccCenter(tSize)),this.addChild(this.m_noItemsLabel),0<this.m_equipList.length&&this.m_noItemsLabel.setVisible(!1)},saveEquipmentListOffSet:function(){var offset=this.m_table_view.getContentOffset();GameContext.getInstance().setEquipmentListOffset(offset)},setEquipmentListOffset:function(){if(null!=this.m_table_view&&0==GameContext.getInstance().getEquipmentListInvoker()){var offset=GameContext.getInstance().getEquipmentListOffset();null==offset&&(offset=cc.p(0,0));var min_offset=this.m_table_view.minContainerOffset();min_offset.y>offset.y&&(offset.y=min_offset.y),this.m_table_view.setContentOffset(offset)}},saveEquipmentListSubOffSet:function(){var offset=this.m_table_view.getContentOffset();GameContext.getInstance().setEquipmentListSubOffset(offset)},setEquipmentListSubOffset:function(){if(null!=this.m_table_view&&0==GameContext.getInstance().getEquipmentListInvoker()){var offset=GameContext.getInstance().getEquipmentListSubOffset();null==offset&&(offset=cc.p(0,0));var min_offset=this.m_table_view.minContainerOffset();min_offset.y>offset.y&&(offset.y=min_offset.y),this.m_table_view.setContentOffset(offset)}},setEquipmentData:function(list){this.m_equipList=$.extend([],list),this.m_table_view.reloadData(),null!=this.m_noItemsLabel&&this.m_noItemsLabel.setVisible(!this.m_equipList.length)},setStateTableView:function(state){if(null!=this.m_table_view)switch(state){case EQUIP_LAYER_STATE.MAIN:case EQUIP_LAYER_STATE.LEVELUP:case EQUIP_LAYER_STATE.CHANGE:this.setPosition(11,84),this.m_table_view.setViewSize(cc.size(451,373)),this.m_table_view.reloadData();break;case EQUIP_LAYER_STATE.SELL:this.setPosition(11,102),this.m_table_view.setViewSize(cc.size(451,337)),this.m_table_view.reloadData()}},tableCellSizeForIndex:function(table){return cc.size(DEF_EQUIP_CELL.CELL_SIZE_WIDTH,DEF_EQUIP_CELL.CELL_SIZE_HEIGHT)},refreshTable:function(){this.m_table_view.reloadData()},cellSizeForTable:function(table){return this.m_cellSize},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;cell=null!=c?c:new EquipmentCell_WebV2(this.tableCellSelectedCallback.bind(this),this.m_cellSize,this.m_columnCount);var desc=[],start=idx*this.m_columnCount,end=start+this.m_columnCount;if(end<this.m_equipList.length)for(idx=start;idx<end;idx++)desc.push($.extend({},this.m_equipList[idx]));else for(idx=start;idx<this.m_equipList.length;idx++)desc.push($.extend({},this.m_equipList[idx]));return cell.setData(desc),this.m_cellList.push(cell),cell},numberOfCellsInTableView:function(table){var cnt=Math.floor(this.m_equipList.length/this.m_columnCount);return 0<Math.floor(this.m_equipList.length%this.m_columnCount)&&(cnt+=1),cnt},tableCellTouched:function(table,cell){var audio=AudioEngine.getInstance();audio.stopVoice();var path=RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3";audio.playEffect(path),AudioEngine.getInstance().playNormaButtonSound();var idx=cell.getIdx();null!=cell&&cell.touchPosCell(idx,cell.getTouchPos(),cell.getTouchWorldPos())},tableCellHighlight:function(table,cell){var idx=cell.getIdx(),c=cell;null!=(this.m_selectCell=c)&&(this.m_is_lastlongtouch=!1,this.m_is_longoutchable&&(this.m_is_longtouch=!0,this.m_selectData=c.getData(cell.getTouchPos(),cell.getTouchWorldPos()),null!=this.m_selectData&&this.scheduleOnce(function(t){this.m_is_lastlongtouch=!0,this.m_is_longtouch&&0!=this.m_selectData.equip_id&&null!=this.m_selectData.equip_id&&(this.m_long_popup=new EquipmentTooltipPopup_WebV2(this.m_selectCell,this.m_selectData),SceneManager.getInstance().getRunningScene().addChild(this.m_long_popup,1e3))}.bind(this),.5,"longtouch")),c.touchCellHighlight(idx,cell.getTouchPos(),cell.getTouchWorldPos()))},tableCellUnhighlight:function(table,cell){AudioEngine.getInstance().stopVoice();var idx=cell.getIdx();null!=cell&&cell.touchCellUnHighlight(idx,cell.getTouchPos(),cell.getTouchWorldPos()),this.m_is_longoutchable&&(this.m_is_longtouch=!1,null!=this.m_long_popup&&(SceneManager.getInstance().getRunningScene().removeChild(this.m_long_popup,!0),this.m_long_popup=null),this.unschedule("longtouch"))},tableCellSelectedCallback:function(info){this.m_is_lastlongtouch||(GameContext.getInstance().setEquipmentKey(info.equip_id,info.equip_num),this.scheduleOnce(function(float){this.m_gameObserver.postNotification(sceneStr[this.getParent().m_sceneId],EQUIP_NOTI_TYPE.NOTIFICATION_EQUIPMENT_CELL_TOUCHED)}.bind(this),0,"NOTIFICATION_EQUIPMENT_CELL_TOUCHED"))},getTableViewOffset:function(){if(null!=this.m_table_view)return this.m_table_view.getContentOffset();return 0},setTableViewOffset:function(offset){if(null!=this.m_table_view){var min_offset=this.m_table_view.minContainerOffset();min_offset.y>offset.y&&(offset.y=min_offset.y),this.m_table_view.setContentOffset(offset)}},setAbleLongtouch:function(isTrue){this.m_is_longoutchable=isTrue},tableRefresh:function(){this.m_table_view.reloadData()},tableCellEnded:function(table){this.m_is_longoutchable&&(this.m_is_longtouch=!1,null!=this.m_long_popup&&(SceneManager.getInstance().getRunningScene().removeChild(this.m_long_popup,!0),this.m_long_popup=null),this.unschedule("longtouch"))},onEnter:function(){this._super()},onExit:function(){this._super(),1!=PREV_HELP&&1!=PREV_EQUIP_SHOP&&1!=PREV_ACHIVE_EQUIP&&(this.m_cellList.forEach(function(t){t.removeAllChildrenWithCleanup(!0)}),this.m_cellList=[])}}),EquipmentListLayerV2_WebV2=cc.Layer.extend({m_table_view:null,m_is_longtouch:null,m_long_popup:null,m_noItemsLabel:null,m_is_longoutchable:!1,m_cellSize:cc.size(0,0),m_columnCount:0,m_equipList:[],m_gameObserver:null,m_is_lastlongtouch:!1,m_cellList:[],ctor:function(){this._super(),this.m_equipList=[],this.m_cellList=[],this.init()},init:function(){return this.m_gameObserver=MainObserver.getInstance(),this._super(),!0},setTags:function(tag){this.setTag(tag)},setCellSizeAndColumnCount:function(tSize,column_count){this.m_cellSize.width=tSize.width,this.m_cellSize.height=tSize.height,this.m_columnCount=column_count},initLayout:function(tSize){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(tSize),this.m_table_view=new cc.TableView(this,tSize),this.m_table_view.ignoreAnchorPointForPosition(!1),this.m_table_view.setAnchorPoint(ANCHOR_MIDDLE()),this.m_table_view.setPosition(ccCenter(this)),this.m_table_view.scrollBarEnable(!0),this.m_table_view.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_table_view.setVerticalFillOrder(0),this.m_table_view.setDelegate(this),this.addChild(this.m_table_view),this.m_noItemsLabel=cmLabel.getLabel("保有装備はありません。",LABEL_FONT_INDEX.FONT_261),this.m_noItemsLabel.setAnchorPoint(ANCHOR_MIDDLE()),this.m_noItemsLabel.setPosition(ccCenter(tSize)),this.addChild(this.m_noItemsLabel),0<this.m_equipList.length&&this.m_noItemsLabel.setVisible(!1)},saveEquipmentListOffSet:function(){var offset=this.m_table_view.getContentOffset();GameContext.getInstance().setEquipmentListOffset(offset)},setEquipmentListOffset:function(){if(null!=this.m_table_view&&0==GameContext.getInstance().getEquipmentListInvoker()){var offset=GameContext.getInstance().getEquipmentListOffset();null==offset&&(offset=cc.p(0,0));var min_offset=this.m_table_view.minContainerOffset();min_offset.y>offset.y&&(offset.y=min_offset.y),this.m_table_view.setContentOffset(offset)}},saveEquipmentListSubOffSet:function(){var offset=this.m_table_view.getContentOffset();GameContext.getInstance().setEquipmentListSubOffset(offset)},setEquipmentListSubOffset:function(){if(null!=this.m_table_view&&0==GameContext.getInstance().getEquipmentListInvoker()){var offset=GameContext.getInstance().getEquipmentListSubOffset();null==offset&&(offset=cc.p(0,0));var min_offset=this.m_table_view.minContainerOffset();min_offset.y>offset.y&&(offset.y=min_offset.y),this.m_table_view.setContentOffset(offset)}},setEquipmentData:function(list){this.m_equipList=$.extend([],list),this.m_table_view.reloadData(),null!=this.m_noItemsLabel&&this.m_noItemsLabel.setVisible(!this.m_equipList.length)},setStateTableView:function(state){if(null!=this.m_table_view)switch(state){case EQUIP_LAYER_STATE.MAIN:case EQUIP_LAYER_STATE.LEVELUP:case EQUIP_LAYER_STATE.CHANGE:this.setPosition(11,84),this.m_table_view.setViewSize(cc.size(451,373)),this.m_table_view.reloadData();break;case EQUIP_LAYER_STATE.SELL:this.setPosition(11,102),this.m_table_view.setViewSize(cc.size(451,337)),this.m_table_view.reloadData()}},tableCellSizeForIndex:function(table){return cc.size(DEF_EQUIP_CELL.CELL_SIZE_WIDTH,DEF_EQUIP_CELL.CELL_SIZE_HEIGHT)},refreshTable:function(){this.m_table_view.reloadData()},cellSizeForTable:function(table){return this.m_cellSize},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;cell=null!=c?c:new EquipmentCell_WebV2(this.tableCellSelectedCallback.bind(this),this.m_cellSize,this.m_columnCount);var desc=[],start=idx*this.m_columnCount,end=start+this.m_columnCount;if(end<this.m_equipList.length)for(idx=start;idx<end;idx++)desc.push($.extend({},this.m_equipList[idx]));else for(idx=start;idx<this.m_equipList.length;idx++)desc.push($.extend({},this.m_equipList[idx]));return cell.setData(desc),this.m_cellList.push(cell),cell},numberOfCellsInTableView:function(table){var cnt=Math.floor(this.m_equipList.length/this.m_columnCount);return 0<Math.floor(this.m_equipList.length%this.m_columnCount)&&(cnt+=1),cnt},tableCellTouched:function(table,cell){var audio=AudioEngine.getInstance();audio.stopVoice();var path=RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3";audio.playEffect(path),AudioEngine.getInstance().playNormaButtonSound();var idx=cell.getIdx();null!=cell&&cell.touchPosCell(idx,cell.getTouchPos(),cell.getTouchWorldPos())},tableCellHighlight:function(table,cell){var idx=cell.getIdx(),c=cell;null!=(this.m_selectCell=c)&&(this.m_is_lastlongtouch=!1,this.m_is_longoutchable&&(this.m_is_longtouch=!0,this.m_selectData=c.getData(cell.getTouchPos(),cell.getTouchWorldPos()),null!=this.m_selectData&&this.scheduleOnce(function(t){this.m_is_lastlongtouch=!0,this.m_is_longtouch&&0!=this.m_selectData.equip_id&&null!=this.m_selectData.equip_id&&(this.m_long_popup=new EquipmentTooltipPopup_WebV2(this.m_selectCell,this.m_selectData),SceneManager.getInstance().getRunningScene().addChild(this.m_long_popup,1e3))}.bind(this),.5,"longtouch")),c.touchCellHighlight(idx,cell.getTouchPos(),cell.getTouchWorldPos()))},tableCellUnhighlight:function(table,cell){AudioEngine.getInstance().stopVoice();var idx=cell.getIdx();null!=cell&&cell.touchCellUnHighlight(idx,cell.getTouchPos(),cell.getTouchWorldPos()),this.m_is_longoutchable&&(this.m_is_longtouch=!1,null!=this.m_long_popup&&(SceneManager.getInstance().getRunningScene().removeChild(this.m_long_popup,!0),this.m_long_popup=null),this.unschedule("longtouch"))},tableCellSelectedCallback:function(info){this.m_is_lastlongtouch||(GameContext.getInstance().setEquipmentKey(info.equip_id,info.equip_num),this.scheduleOnce(function(float){this.m_gameObserver.postNotification(sceneStr[this.getParent().m_sceneId],EQUIP_NOTI_TYPE.NOTIFICATION_EQUIPMENT_CELL_TOUCHED)}.bind(this),0,"NOTIFICATION_EQUIPMENT_CELL_TOUCHED"))},getTableViewOffset:function(){if(null!=this.m_table_view)return this.m_table_view.getContentOffset();return 0},setTableViewOffset:function(offset){if(null!=this.m_table_view){var min_offset=this.m_table_view.minContainerOffset();min_offset.y>offset.y&&(offset.y=min_offset.y),this.m_table_view.setContentOffset(offset)}},setAbleLongtouch:function(isTrue){this.m_is_longoutchable=isTrue},tableRefresh:function(){this.m_table_view.reloadData()},tableCellEnded:function(table){this.m_is_longoutchable&&(this.m_is_longtouch=!1,null!=this.m_long_popup&&(SceneManager.getInstance().getRunningScene().removeChild(this.m_long_popup,!0),this.m_long_popup=null),this.unschedule("longtouch"))},onEnter:function(){this._super()},onExit:function(){this._super(),1!=PREV_HELP&&1!=PREV_EQUIP_SHOP&&1!=PREV_ACHIVE_EQUIP&&(this.m_cellList.forEach(function(t){t.removeAllChildrenWithCleanup(!0)}),this.m_cellList=[])}}),EquipmentItem_WebV2=cc.Layer.extend({m_icon:null,m_nameLabel:null,m_contentLabel:null,m_lock_icon:null,ctor:function(){this._super(),this.init()},init:function(){this.m_step=null;var size=cc.size(100,100);return this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ZERO()),this.setContentSize(size),!0},setData:function(info){this.m_itemInfo=info;var equip_info={};equip_info.equip_id=info.equip_id,equip_info.equip_rare_type=info.equip_rare_type,equip_info.equip_parts_type=info.equip_parts_type,equip_info.arm_service_type=info.arm_service_type,equip_info.equip_type=info.equip_type,equip_info.level=info.level,equip_info.step=info.equip_step,equip_info.is_equip="y"==info.equip_yn,equip_info.is_lock="y"==info.lock_yn,equip_info.image=info.image,equip_info.equip_group=info.equip_group,equip_info.property_img=info.property_img,equip_info.frame_id=info.frame_id,equip_info.symbol_id=info.symbol_id,equip_info.symbol_name_id=info.symbol_name_id,equip_info.is_same_gnrl_group="y"==info.same_gnrl_equip_yn,equip_info.gnrl_group=info.gnrl_group;var card=CardEquipment.getInstance().createCardEquipment(equip_info,EQUIPMENT_CARD_TYPE.type_card_common);if(card.setAnchorPoint(ZERO()),card.setPosition(ZERO()),info.is_selected){var select_img=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_select_2.png");select_img.setAnchorPoint(ZERO()),select_img.setPosition(ZERO()),USE_SP_EQUIPMENT_ICON_SCALE&&info.equip_type==EQUIPMENT_TYPE_EXP&&select_img.setScale(DISABLE_SPB_TP?1:.5),card.addChild(select_img),select_img.setOpacity(0);var fadeIn=cc.fadeIn(.7),fadeOut=cc.fadeTo(.7,90),seq=cc.sequence(fadeIn,fadeOut),repeat=cc.repeatForever(seq);select_img.runAction(repeat)}if(info.is_sell_selected){var check_img=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_check.png");check_img.setAnchorPoint(ZERO()),check_img.setPosition(ZERO()),USE_SP_EQUIPMENT_ICON_SCALE&&info.equip_type==EQUIPMENT_TYPE_EXP&&check_img.setScale(.5),card.addChild(check_img)}if(equip_info.is_same_gnrl_group){var dedicated_img=cc.Sprite.create(RES_CDN_MENU_EQUIP_NTP+"img_equip_stat_unique.png");if(dedicated_img.setAnchorPoint(ANCHOR_MIDDLE_TOP()),dedicated_img.setPosition(ccCenter(card).x,ccHeight(card)),card.addChild(dedicated_img),0==equip_info.is_equip){var up_pos=ccPos(dedicated_img),down_pos=$.extend({},up_pos);down_pos.y-=10;var moveUp=new cc.MoveTo(.5,up_pos),moveDown=new cc.MoveTo(.5,down_pos);seq=new cc.Sequence(moveDown,moveUp),repeat=new cc.RepeatForever(seq);dedicated_img.runAction(repeat)}else{var use_img=cc.Sprite.create(RES_CDN_MENU_EQUIP_NTP+"img_equip_mask.png");use_img.setAnchorPoint(ANCHOR_MIDDLE()),use_img.setPosition(ccCenter(card)),card.addChild(use_img)}}return card},setClicked:function(){},setUnclicked:function(){}}),DEF_EQUIP_CELL={COLUMN_COUNT:4,CELL_SIZE_WIDTH:456,CELL_SIZE_HEIGHT:100},EquipmentCell_WebV2=cc.TableViewCell.extend({m_callback:null,m_item_list:[],m_data_list:[],ctor:function(_callback,cell_size,column_count){this.m_item_list=[],this.m_data_list=[],this._super(),this.init(_callback,cell_size,column_count)},init:function(_callback,cell_size,column_count){this.m_callback=_callback,this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(cell_size);for(var width=cell_size.width/column_count,offset_x=width/2,i=0;i<column_count;i++){var item=new EquipmentItem_WebV2;item.setAnchorPoint(ANCHOR_MIDDLE()),item.setPosition(offset_x+width*i,.5*cell_size.height),this.addChild(item),this.m_item_list.push(item)}return!0},setData:function(data){this.m_data_list=[],this.m_data_list=data,this.updateCell()},updateCell:function(){for(var i=0;i<this.m_item_list.length;i++){var item=this.m_item_list[i];if(item.setVisible(!1),i<this.m_data_list.length){item.removeAllChildren(),item.setVisible(!0);var card_equip=item.setData(this.m_data_list[i]);item.addChild(card_equip)}}},touchPosCell:function(idx,pos,world_pos){for(var i=0;i<this.m_item_list.length;i++){var item=this.m_item_list[i];if(item.isVisible()){var r=item.getBoundingBox();if(cc.rectContainsPoint(r,pos)){this.clickItemCell(i);break}}}},clickItemCell:function(tag){tag<this.m_data_list.length&&this.m_callback(this.m_data_list[tag])},getData:function(pos,world_pos){for(var ue=null,i=0;i<this.m_item_list.length;i++){var item=this.m_item_list[i];if(item.isVisible()){var r=item.getBoundingBox();if(cc.rectContainsPoint(r,pos)&&i<this.m_data_list.length){ue=this.m_data_list[i];break}}}return ue},touchCellHighlight:function(idx,pos,world_pos){for(var i=0;i<this.m_item_list.length;i++){var item=this.m_item_list[i];if(item.isVisible()){var r=item.getBoundingBox();if(cc.rectContainsPoint(r,pos)){item.setClicked();break}}}},touchCellUnHighlight:function(){for(var i=0;i<this.m_item_list.length;i++){var item=this.m_item_list[i];if(item.isVisible()){item.setUnclicked();break}}}}),EquipmentTooltipPopup_WebV2=cc.Layer.extend({ctor:function(select,info){this._super(),this.init(select,info)},init:function(select,info){var size=cc.size(400,250),vec=select.getTouchWorldPos();vec.x-=50,vec.y+=50,vec.y<250&&(vec.y=250);var box=new cc.Scale9Sprite(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());box.setPreferredSize(size),box.setAnchorPoint(ANCHOR_TOP_RIGHT()),box.setPosition(vec),this.addChild(box),this.getEquipInfoLayer(box,info);var skilllayer=this.getEquipSkillLayer(info);return skilllayer.setAnchorPoint(ANCHOR_TOP_LEFT()),skilllayer.setPosition(cc.p(20,24)),box.addChild(skilllayer),!0},getEquipInfoLayer:function(parent,info){var equip_info={};equip_info.equip_id=info.equip_id,equip_info.equip_rare_type=info.equip_rare_type,equip_info.equip_parts_type=info.equip_parts_type,equip_info.arm_service_type=info.arm_service_type,equip_info.equip_type=info.equip_type,equip_info.level=info.level,equip_info.step=info.equip_step,equip_info.is_equip="y"==info.equip_yn,equip_info.is_lock="y"==info.lock_yn,equip_info.image=info.image,equip_info.equip_group=info.equip_group,equip_info.property_img=info.property_img,equip_info.frame_id=info.frame_id,equip_info.symbol_id=info.symbol_id,equip_info.symbol_name_id=info.symbol_name_id,equip_info.is_same_gnrl_group=!1,equip_info.gnrl_group=info.gnrl_group;var card_equip=CardEquipment.getInstance().createCardEquipment(equip_info,EQUIPMENT_CARD_TYPE.type_card_common);card_equip.setAnchorPoint(ZERO()),card_equip.setPosition(20,129),parent.addChild(card_equip);var mt=MasterManager.getInstance(),name_label=(mt.get_EquipmentItem(info.equip_id),cmLabel.getLabel(info.equip_name,LABEL_FONT_INDEX.FONT_201));name_label.setAnchorPoint(ZERO()),name_label.setPosition(128,204),cmLabel.autoSizeFit(name_label,230,20),parent.addChild(name_label);var parts_info=mt.get_EquipmentPartsType(info.equip_parts_type),type_title=cmLabel.getLabel(parts_info.name,LABEL_FONT_INDEX.FONT_1812);type_title.setAnchorPoint(ZERO()),type_title.setPosition(ccPos(name_label).x,181),parent.addChild(type_title),info.equip_parts_type==EQUIPMENT_PRIVATE&&0==info.gnrl_group&&type_title.setString(res_str("label_weapon"));var stat_info=mt.get_ComboStat(info.combo_stat),stat_title=cmLabel.getLabel(stat_info.name,LABEL_FONT_INDEX.FONT_1812);stat_title.setAnchorPoint(ZERO()),stat_title.setPosition(ccPos(name_label).x,156),parent.addChild(stat_title);var stat_label=cmLabel.getLabel(cmString("%d",info.stat_value),LABEL_FONT_INDEX.FONT_1820);stat_label.setAnchorPoint(ZERO()),stat_label.setPosition(ccPos(stat_title).x+ccWidth(stat_title),ccPos(stat_title).y),parent.addChild(stat_label);var level_title=cmLabel.getLabel("Lv",LABEL_FONT_INDEX.FONT_1812);level_title.setAnchorPoint(ZERO()),level_title.setPosition(ccPos(name_label).x,129),parent.addChild(level_title);var level_label=cmLabel.getLabel(cmString("%d/%d",info.level,info.max_level),LABEL_FONT_INDEX.FONT_181);level_label.setAnchorPoint(ZERO()),level_label.setPosition(ccPos(level_title).x+ccWidth(level_title),ccPos(level_title).y),parent.addChild(level_label)},getEquipSkillLayer:function(info){var layer=new cc.Layer;layer.setContentSize(404,100);MasterManager.getInstance();var skill_title=cmLabel.getLabel(res_str("label_skill"),LABEL_FONT_INDEX.FONT_1812);skill_title.setAnchorPoint(ZERO()),skill_title.setPosition(0,80),layer.addChild(skill_title);var pos_y=64,skill_str=[];if(EquipmentService.getInstance().getEquipmentSkillContent(info,skill_str),0<=info.option_id1&&0<=info.option_num1&&null!=skill_str[0]){var skill_label1=cmLabel.getLabel(skill_str[0],LABEL_FONT_INDEX.FONT_143);1<(lineCnt=EQUIPLINECOUNT(skill_str[0]))&&(pos_y-=15*(lineCnt-1)),skill_label1.setAnchorPoint(ZERO()),skill_label1.setPosition(0,pos_y),layer.addChild(skill_label1),pos_y-=15}if(0<=info.option_id2&&0<=info.option_num2&&null!=skill_str[1]){var skill_label2=cmLabel.getLabel(skill_str[1],LABEL_FONT_INDEX.FONT_143);1<(lineCnt=EQUIPLINECOUNT(skill_str[1]))&&(pos_y-=15*(lineCnt-1)),skill_label2.setAnchorPoint(ZERO()),skill_label2.setPosition(0,pos_y),layer.addChild(skill_label2),pos_y-=15}if(0<=info.option_id3&&0<=info.option_num3&&null!=skill_str[2]){var skill_label3=cmLabel.getLabel(skill_str[2],LABEL_FONT_INDEX.FONT_143);1<(lineCnt=EQUIPLINECOUNT(skill_str[2]))&&(pos_y-=15*(lineCnt-1)),skill_label3.setAnchorPoint(ZERO()),skill_label3.setPosition(0,pos_y),layer.addChild(skill_label3),pos_y-=15}if(0<=info.option_id4&&0<=info.option_num4&&null!=skill_str[3]){var skill_label4=cmLabel.getLabel(skill_str[3],LABEL_FONT_INDEX.FONT_143);1<(lineCnt=EQUIPLINECOUNT(skill_str[3]))&&(pos_y-=15*(lineCnt-1)),skill_label4.setAnchorPoint(ZERO()),skill_label4.setPosition(0,pos_y),layer.addChild(skill_label4),pos_y-=15}if(0<=info.option_id5&&0<=info.option_num5&&null!=skill_str[4]){var lineCnt,skill_label5=cmLabel.getLabel(skill_str[4],LABEL_FONT_INDEX.FONT_143);1<(lineCnt=EQUIPLINECOUNT(skill_str[4]))&&(pos_y-=15*(lineCnt-1)),skill_label5.setAnchorPoint(ZERO()),skill_label5.setPosition(0,pos_y),layer.addChild(skill_label5),pos_y-=15}return layer}});