var GreatWallService,SCRIPT_TYPE={SCRIPT:0,ANIMATION:1},WATCH_STATUS={PHASE:0,FINISH:1},ResourceType={RT_IMAGE:1,RT_BGM:2,RT_SOUND:3,RT_VOICE:4,RT_SKELETON:5,RT_PARTICLE:6,RT_TEXTURE:10,RT_SKELETON2:8888},STATUS_LOVE_CG={NONE:0,FAST_FORWARD:1,AUTO_FORWARD:2},Contents_Skip=1e3,Hide_Script_Log=1001,SCENE_MODE={NORMAL:0,WATCH:1},HSCNE_SCREEN_WIDTH=780,MOSAIC_CELL_SIZE=9,EFFECT_TYPE_NONE=0,EFFECT_TYPE_WHITE_BLINK=1,EFFECT_TYPE_WHITE_FADEIN=2,EFFECT_TYPE_DELAY_TIME=3,EFFECT_TYPE_WHITE_OUT=4,AUTO_FORWARD_TIME=1.5,FAST_FORWARD_TIME=.1,MODE_CHANGE_CLEAN_TIME=1,MODE_CHNAGE_TIME=1,HSCENE_TIME_SCALE_2X=2,HSCENE_TIME_SCALE_1X=1,LoveContentsScriptLayer_V2=cc.Layer.extend({m_label:null,m_script_index:0,m_bg_frame:null,m_name_label:null,m_finger:null,m_is_complete:!1,m_script_bg:null,is_zooming:!1,m_show_btn:null,m_btn_container:null,m_status:null,m_script_delta_time:0,m_current_voice_id:0,m_log_box:null,m_blink_layer:null,m_test_label:null,m_auto_icon:null,m_ff_icon:null,m_ff_effect:null,m_auto_effect:null,m_script_type:null,m_left_body:null,m_middle_body:null,m_right_body:null,m_skeleton:null,m_skeleton_bg:null,m_script_body_layer:null,m_gnrl_id:null,m_cliper:null,m_stencil:null,m_mosaic:null,m_is_effect_playing:!1,m_loading_modal_layer:null,m_is_update:!1,m_script_bg_layer:null,m_loop_ui_container:null,m_scene_mode:null,m_2x_effect:null,m_box:null,m_is_2x_speed:!1,m_watch_status:null,m_left_mask:null,m_right_mask:null,m_finish_btn:null,m_front_particle:null,m_back_particle:null,m_env_effect_bg:null,m_2x_speed_btns:[],m_resource_list:[],m_resource_list_array:null,m_fast_forward_btns:[],m_auto_forward_btns:[],m_last_animation:null,last_script_bg:null,m_img_rd_temp1:null,m_img_rd_temp2:null,m_img_rd_temp3:null,m_Observer:null,shader:null,m_texture:null,m_enable_touch:!0,m_enable_touch_click:!0,m_b_create:!1,m_enc_load:null,m_enc_strng:null,m_texture_img:null,m_screen_mosaic_visible:!1,m_is_hide_mosaic:!1,m_bg_mask:null,m_event_touch:null,m_audio:null,m_optionWatch:null,m_skipWatch:null,m_speed_2x_start_Watch:null,m_speed_2x_stop_Watch:null,m_touch_button_Common:null,m_option_Common:null,m_skip_Common:null,m_hide_Common:null,m_log_Common:null,m_ff_start_Common:null,m_ff_stop_Common:null,m_auto_start_Common:null,m_auto_stop_Common:null,m_polygon_stencil:null,m_script_skip_and_phase_btn:null,m_love_watch_mode_index:0,m_watch_mode_counting:null,m_left_arrow_btn:null,m_right_arrow_btn:null,m_use_Add_Scale:1,ctor:function(a){this.m_enc_load=null,this.m_texture_img=null,this.m_b_create=!1,this.mosaicSize=1,this.m_2x_speed_btns=[],this.m_resource_list=[],this.m_resource_list_array=[],this.m_fast_forward_btns=[],this.m_auto_forward_btns=[],this.m_status=STATUS_LOVE_CG.NONE,this.m_scene_mode=SCENE_MODE.NORMAL,this.m_last_animation=null,this.m_current_animation={animation:0},this.m_img_rd_temp1=null,this.m_img_rd_temp2=null,this.m_img_rd_temp3=null,this.m_screen_mosaic_visible=!1,this.m_is_hide_mosaic=!1,this.m_bg_mask=null,this.m_event_touch=null,this.m_audio=AudioEngine.getInstance(),this.m_optionWatch=null,this.m_skipWatch=null,this.m_speed_2x_start_Watch=null,this.m_speed_2x_stop_Watch=null,this.m_touch_button_Common=null,this.m_option_Common=null,this.m_skip_Common=null,this.m_hide_Common=null,this.m_log_Common=null,this.m_ff_start_Common=null,this.m_ff_stop_Common=null,this.m_auto_start_Common=null,this.m_auto_stop_Common=null,this.m_polygon_stencil=null,this.m_script_skip_and_phase_btn=null,this.m_love_watch_mode_index=0,this.m_watch_mode_counting=null,this.m_left_arrow_btn=null,this.m_right_arrow_btn=null,USE_SP_CARD_SCRIPT_BODY_SCALE?this.m_use_Add_Scale=2:this.m_use_Add_Scale=1,this._super(),this.init(a),this.last_script_bg=""},init:function(d){this.m_Observer=MainObserver.getInstance(),this.m_gnrl_id=d;var e=MasterTable.getInstance().get_LoveCgByGnrlId(this.m_gnrl_id);if(this.m_love_watch_mode_list=MasterTable.getInstance().get_LoveWatchModeList(e.love_cg_story_num),"y"==e.animation_yn){this.m_script_type=SCRIPT_TYPE.ANIMATION,this.m_animation_script_list=MasterTable.getInstance().get_LoveCgAnimationStoryList(e.love_cg_story_num),this.m_animation_script_list.sort(function(l,r){return l.order_number>r.order_number?1:l.order_number<r.order_number?-1:0});for(var f=[],idx=0;idx<this.m_animation_script_list.length;idx++){if("0"!=this.m_animation_script_list[idx].voice){var g={_resource_type:ResourceType.RT_VOICE,path:RES_CDN_SOUND+SND_TYPE+"voice_love/"+this.m_animation_script_list[idx].voice+".mp3"};f.push(g),g=null}if("0"!=this.m_animation_script_list[idx].r_filename){g={_resource_type:ResourceType.RT_IMAGE,png:RES_CDN_DEFULT+"card_script_body/"+this.m_animation_script_list[idx].r_filename+".png"};f.push(g),this.m_img_rd_temp1=new cc.Sprite(RES_CDN_DEFULT+"card_script_body/"+this.m_animation_script_list[idx].r_filename+".png"),this.m_img_rd_temp1.setVisible(!1),this.addChild(this.m_img_rd_temp1),g=null}if("0"!=this.m_animation_script_list[idx].m_filename){g={_resource_type:ResourceType.RT_IMAGE,png:RES_CDN_DEFULT+"card_script_body/"+this.m_animation_script_list[idx].m_filename+".png"};f.push(g),this.m_img_rd_temp2=new cc.Sprite(RES_CDN_DEFULT+"card_script_body/"+this.m_animation_script_list[idx].m_filename+".png"),this.m_img_rd_temp2.setVisible(!1),this.addChild(this.m_img_rd_temp2),g=null}if("0"!=this.m_animation_script_list[idx].l_filename){g={_resource_type:ResourceType.RT_IMAGE,png:RES_CDN_DEFULT+"card_script_body/"+this.m_animation_script_list[idx].l_filename+".png"};f.push(g),this.m_img_rd_temp3=new cc.Sprite(RES_CDN_DEFULT+"card_script_body/"+this.m_animation_script_list[idx].l_filename+".png"),this.m_img_rd_temp3.setVisible(!1),this.addChild(this.m_img_rd_temp3),g=null}if("0"!=this.m_animation_script_list[idx].bg_img){g={_resource_type:ResourceType.RT_IMAGE,png:RES_CDN_DEFULT+"card_script_bg/"+this.m_animation_script_list[idx].bg_img+".jpg"};f.push(g),g=null}}if(0!=e.bg_type){g={_resource_type:ResourceType.RT_IMAGE,png:RES_CDN_DEFULT+"hscene_bg/"+e.bg_type+".png"};f.push(g),g=null}var h=[];h[0]=RES_CDN_DEFULT+"menu_cg/img_auto.png",h[1]=RES_CDN_DEFULT+"menu_cg/img_foward.png",h[2]=RES_CDN_DEFULT+"menu_cg/btn_cglook_off.png",h[3]=RES_CDN_DEFULT+"menu_cg/btn_cglook_on.png",h[4]=RES_CDN_DEFULT+"menu_cg/btn_option_off.png",h[5]=RES_CDN_DEFULT+"menu_cg/btn_option_on.png",h[6]=RES_CDN_DEFULT+"menu_cg/btn_skip_off.png",h[7]=RES_CDN_DEFULT+"menu_cg/btn_skip_on.png",h[8]=RES_CDN_DEFULT+"menu_cg/btn_log_off.png",h[9]=RES_CDN_DEFULT+"menu_cg/btn_log_on.png",h[10]=RES_CDN_DEFULT+"menu_cg/btn_fast_forward_off.png",h[11]=RES_CDN_DEFULT+"menu_cg/btn_fast_forward_on.png",h[12]=RES_CDN_DEFULT+"menu_cg/btn_speed_none.png",h[13]=RES_CDN_DEFULT+"menu_cg/btn_speed_off.png",h[14]=RES_CDN_DEFULT+"menu_cg/btn_speed_on.png",h[15]=RES_CDN_DEFULT+"menu_cg/btn_finish_off.png",h[16]=RES_CDN_DEFULT+"menu_cg/btn_finish_on.png",h[17]=RES_CDN_DEFULT+"menu_cg/btn_fast_forward_none.png",h[18]=RES_CDN_DEFULT+"menu_cg/btn_auto_off.png",h[19]=RES_CDN_DEFULT+"menu_cg/btn_auto_none.png",h[20]=RES_CDN_DEFULT+"menu_cg/btn_auto_on.png";for(idx=0;idx<h.length;idx++){g={_resource_type:ResourceType.RT_IMAGE,png:h[idx]};f.push(g),g=null}this.m_resource_list=f.reduce(function(a,b){if(0==a.length)return a.push(b),a;for(var c=!1,idx=0;idx<a.length;idx++)a[idx].png==b.png&&(c=!0);return 0==c&&a.push(b),a},[]);for(idx=0;idx<this.m_resource_list.length;idx++)this.m_resource_list_array.push(this.m_resource_list[idx]);f=h=null}else{this.m_script_type=SCRIPT_TYPE.SCRIPT,this.m_script_list=MasterTable.getInstance().get_LoveCgStoryList(e.love_cg_story_num),this.m_script_list.sort(function(l,r){return l.order_number>r.order_number?1:l.order_number<r.order_number?-1:0});for(idx=0;idx<this.m_script_list.length;idx++){if("0"!=this.m_script_list[idx].voice){g={_resource_type:ResourceType.RT_VOICE,path:RES_CDN_SOUND+SND_TYPE+"voice_love/"+this.m_script_list[idx].voice+".mp3"};this.m_resource_list.push(g),this.m_resource_list_array.push(g),g=null}if(null!=this.m_script_list[idx].img){g={_resource_type:ResourceType.RT_IMAGE,png:RES_CDN_DEFULT+"menu_cg/"+this.m_script_list[idx].img+".jpg"};this.m_resource_list.push(g),this.m_resource_list_array.push(g),g=null}}}var i=cc.director.getWinSize();return this.ignoreAnchorPointForPosition(!1),this.setContentSize(i),this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setPosition(ZERO()),this.m_user_info=NetService().get_User_info(),this.m_env_effect_bg=null,0!=e.bg_type&&(this.m_env_effect_bg=cc.Sprite.create(),this.m_env_effect_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_env_effect_bg.setPosition(ccCenter(i)),this.addChild(this.m_env_effect_bg)),this.m_script_bg_layer=new cc.Layer,this.m_script_bg_layer.ignoreAnchorPointForPosition(!1),this.m_script_bg_layer.setContentSize(i),this.m_script_bg_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_script_bg_layer.setPosition(ccCenter(i)),this.addChild(this.m_script_bg_layer),this.m_script_bg=cc.Sprite.create(RES_CDN_DEFULT+"card_script_bg/116.jpg"),USE_SP_SCRIPT_BG_SCALE&&this.m_script_bg.setScale(2),this.m_script_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_script_bg.setPosition(ccCenter(i)),this.m_script_bg_layer.addChild(this.m_script_bg),this.m_script_type==SCRIPT_TYPE.ANIMATION&&(this.createAnimationTypeLoad(),this.createAnimationType()),this.m_loading_modal_layer=new LoveContentLoadingLayer,this.m_loading_modal_layer.setTotalResourceCount(this.m_resource_list.length+100),this.m_loading_modal_layer.setPosition(ccCenter(i)),this.addChild(this.m_loading_modal_layer,88888),this.m_box=new GameMessageBox,this.addChild(this.m_box,99999),this.showLoadingLayer(),this.m_log_box=new GameModalLayer,this.addChild(this.m_log_box,99999),this.schedule(this.resourceLoading,.1),!(i=e=null)},onExit:function(){if(this._super(),this.m_audio.stopEffectsAll(),this.m_audio.releaseResourceEffects(),null!=this.m_enc_load&&(cc.loader.release(this.m_enc_load),this.m_enc_load=null),(this.m_enc_strng=null)!=this.m_resource_list_array){for(var i=0;i<this.m_resource_list_array.length;i++){if(this.m_resource_list_array[i]._resource_type==ResourceType.RT_IMAGE&&(this.m_resource_list_array[i].png==RES_CDN_DEFULT+"card_script_body/24501.png"||cc.loader.release(this.m_resource_list_array[i].png),this.m_resource_list_array[i].png=null),this.m_resource_list_array[i]._resource_type==ResourceType.RT_VOICE&&(cc.loader.release(this.m_resource_list_array[i].path),this.m_resource_list_array[i].path=null),this.m_resource_list_array[i]._resource_type==ResourceType.RT_SKELETON&&(null!=this.m_resource_list_array[i].atlas&&null!=this.m_resource_list_array[i].atlas&&(cc.loader.release(this.m_resource_list_array[i].atlas),this.m_resource_list_array[i].atlas=null),null!=this.m_resource_list_array[i].bone&&null!=this.m_resource_list_array[i].bone&&(cc.loader.release(this.m_resource_list_array[i].bone),this.m_resource_list_array[i].bone=null),null!=this.m_resource_list_array[i].bg&&null!=this.m_resource_list_array[i].bg&&(cc.loader.release(this.m_resource_list_array[i].bg),this.m_resource_list_array[i].bg=null),null!=this.m_resource_list_array[i].png&&null!=this.m_resource_list_array[i].png)){for(var a=0;a<this.m_resource_list_array[i].png.length;a++)cc.loader.release(this.m_resource_list_array[i].png[a]);this.m_resource_list_array[i].png=null}this.m_resource_list_array[i]._resource_type==ResourceType.RT_SKELETON2&&(null!=this.m_resource_list_array[i].atlas&&null!=this.m_resource_list_array[i].atlas&&(cc.loader.release(this.m_resource_list_array[i].atlas),this.m_resource_list_array[i].atlas=null),null!=this.m_resource_list_array[i].bone&&null!=this.m_resource_list_array[i].bone&&(cc.loader.release(this.m_resource_list_array[i].bone),this.m_resource_list_array[i].bone=null),null!=this.m_resource_list_array[i].bg&&null!=this.m_resource_list_array[i].bg&&(cc.loader.release(this.m_resource_list_array[i].bg),this.m_resource_list_array[i].bg=null))}this.m_resource_list_array=null}this.m_resource_list=[],(this.m_enc_strng=null)!=this.m_img_rd_temp1&&(this.removeChild(this.m_img_rd_temp1),this.m_img_rd_temp1=null),null!=this.m_img_rd_temp2&&(this.removeChild(this.m_img_rd_temp2),this.m_img_rd_temp2=null),null!=this.m_img_rd_temp3&&(this.removeChild(this.m_img_rd_temp3),this.m_img_rd_temp3=null),null!=this.m_skeleton_bg&&null!=this.m_skeleton_bg&&(this.m_script_body_layer.removeChild(this.m_skeleton_bg),this.m_skeleton_bg=null),null!=this.m_skeleton&&null!=this.m_skeleton&&(this.m_script_body_layer.removeChild(this.m_skeleton),this.m_skeleton._skeleton.data.animations=[],this.m_skeleton._skeleton.data.bones=[],this.m_skeleton._skeleton.data.events=[],this.m_skeleton._skeleton.data.slots=[],this.m_skeleton._skeleton.data.skins=[],this.m_skeleton._skeleton.data=null,this.m_skeleton._spineComplete=null,this.m_skeleton=null),null!=this.m_left_body&&null!=this.m_left_body&&(this.m_script_body_layer.removeChild(this.m_left_body),this.m_left_body=null),null!=this.m_middle_body&&null!=this.m_middle_body&&(this.m_script_body_layer.removeChild(this.m_middle_body),this.m_middle_body=null),null!=this.m_right_body&&null!=this.m_right_body&&(this.m_script_body_layer.removeChild(this.m_right_body),this.m_right_body=null),null!=this.m_script_bg&&null!=this.m_script_bg&&(this.m_script_bg_layer.removeChild(this.m_script_bg),this.m_script_bg=null),this.m_script_bg_layer.removeAllChildrenWithCleanup(!0),this.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_script_bg_layer),this.m_2x_speed_btns=[],null!=this.m_optionWatch&&(this.m_loop_ui_container.removeChild(this.m_optionWatch),this.m_optionWatch=null),null!=this.m_skipWatch&&(this.m_loop_ui_container.removeChild(this.m_skipWatch),this.m_skipWatch=null),null!=this.m_speed_2x_start_Watch&&(this.m_loop_ui_container.removeChild(this.m_speed_2x_start_Watch),this.m_speed_2x_start_Watch=null),null!=this.m_speed_2x_stop_Watch&&(this.m_loop_ui_container.removeChild(this.m_speed_2x_stop_Watch),this.m_speed_2x_stop_Watch=null),null!=this.m_2x_effect&&(this.m_loop_ui_container.removeChild(this.m_2x_effect),this.m_2x_effect._skeleton.data.animations=[],this.m_2x_effect._skeleton.data.bones=[],this.m_2x_effect._skeleton.data.events=[],this.m_2x_effect._skeleton.data.slots=[],this.m_2x_effect._skeleton.data.skins=[],this.m_2x_effect._skeleton.slots=[],this.m_2x_effect._spineComplete=null,this.m_2x_effect._skeleton=null,this.m_2x_effect=null),null!=this.m_finish_btn&&(this.m_loop_ui_container.removeChild(this.m_finish_btn),this.m_finish_btn=null),null!=this.m_loop_ui_container&&(this.m_loop_ui_container.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_loop_ui_container),this.m_loop_ui_container=null),null!=this.m_event_touch&&(cc.eventManager.removeListener(this.m_event_touch),this.m_event_touch=null),null!=this.m_name_label&&(this.m_bg_frame.removeChild(this.m_name_label),this.m_name_label=null),null!=this.m_finger&&(this.m_bg_frame.removeChild(this.m_finger),this.m_finger=null),null!=this.m_label&&(this.m_bg_frame.removeChild(this.m_label),this.m_label=null),null!=this.m_bg_mask&&(this.m_bg_frame.removeChild(this.m_bg_mask),this.m_bg_mask=null),null!=this.m_auto_icon&&(this.removeChild(this.m_auto_icon),this.m_auto_icon=null),null!=this.m_show_btn&&(this.removeChild(this.m_show_btn),this.m_show_btn=null),null!=this.m_ff_icon&&(this.removeChild(this.m_ff_icon),this.m_ff_icon=null),null!=this.m_touch_button_Common&&(this.removeChild(this.m_touch_button_Common),this.m_touch_button_Common=null),null!=this.m_bg_frame&&(this.m_bg_frame.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_bg_frame),this.m_bg_frame=null),null!=this.m_ff_effect&&null!=this.m_ff_effect&&(this.m_btn_container.removeChild(this.m_ff_effect),this.m_ff_effect._skeleton.data.animations=[],this.m_ff_effect._skeleton.data.bones=[],this.m_ff_effect._skeleton.data.events=[],this.m_ff_effect._skeleton.data.slots=[],this.m_ff_effect._skeleton.data.skins=[],this.m_ff_effect._skeleton.slots=[],this.m_ff_effect._spineComplete=null,this.m_ff_effect._skeleton=null,this.m_ff_effect=null),null!=this.m_auto_effect&&null!=this.m_auto_effect&&(this.m_btn_container.removeChild(this.m_auto_effect),this.m_auto_effect._skeleton.data.animations=[],this.m_auto_effect._skeleton.data.bones=[],this.m_auto_effect._skeleton.data.events=[],this.m_auto_effect._skeleton.data.slots=[],this.m_auto_effect._skeleton.data.skins=[],this.m_auto_effect._skeleton.slots=[],this.m_auto_effect._spineComplete=null,this.m_auto_effect._skeleton=null,this.m_auto_effect=null),null!=this.m_option_Common&&(this.m_btn_container.removeChild(this.m_option_Common),this.m_option_Common=null),null!=this.m_skip_Common&&(this.m_btn_container.removeChild(this.m_skip_Common),this.m_skip_Common=null),null!=this.m_hide_Common&&(this.m_btn_container.removeChild(this.m_hide_Common),this.m_hide_Common=null),null!=this.m_log_Common&&(this.m_btn_container.removeChild(this.m_log_Common),this.m_log_Common=null),null!=this.m_ff_start_Common&&(this.m_btn_container.removeChild(this.m_ff_start_Common),this.m_ff_start_Common=null),null!=this.m_ff_stop_Common&&(this.m_btn_container.removeChild(this.m_ff_stop_Common),this.m_ff_stop_Common=null),null!=this.m_auto_start_Common&&(this.m_btn_container.removeChild(this.m_auto_start_Common),this.m_auto_start_Common=null),null!=this.m_auto_stop_Common&&(this.m_btn_container.removeChild(this.m_auto_stop_Common),this.m_auto_stop_Common=null),null!=this.m_btn_container&&(this.m_btn_container.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_btn_container),this.m_btn_container=null),this.m_auto_forward_btns=[],null!=this.m_loading_modal_layer&&(this.removeChild(this.m_loading_modal_layer),this.m_loading_modal_layer=null),null!=this.m_stencil&&(this.m_cliper.removeChild(this.m_stencil),this.m_stencil=null),null!=this.m_mosaic&&(this.m_cliper.removeChild(this.m_mosaic),this.m_mosaic=null),null!=this.m_front_particle&&(this.m_script_body_layer.removeChild(this.m_front_particle),this.m_front_particle=null),null!=this.m_back_particle&&(this.m_script_body_layer.removeChild(this.m_back_particle),this.m_back_particle=null),null!=this.m_cliper&&(this.m_cliper.removeAllChildrenWithCleanup(!0),this.m_script_body_layer.removeChild(this.m_cliper),this.m_cliper=null),null!=this.m_box&&(this.removeChild(this.m_box),this.m_box=null),null!=this.m_log_box&&(this.removeChild(this.m_log_box),this.m_log_box=null),null!=this.m_env_effect_bg&&(this.removeChild(this.m_env_effect_bg),this.m_env_effect_bg=null),null!=this.m_left_mask&&(this.removeChild(this.m_left_mask),this.m_left_mask=null),null!=this.m_right_mask&&(this.removeChild(this.m_right_mask),this.m_right_mask=null),null!=this.m_blink_layer&&(this.removeChild(this.m_blink_layer),this.m_blink_layer=null),null!=this.m_script_body_layer&&(this.m_script_body_layer.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_script_body_layer)),this.m_script_body_layer=null,this.m_fast_forward_btns=null,this.m_script_bg_layer=null,this.m_texture_img=null,this.m_texture=null,this.shader=null,this.m_animation_script_list=null,this.m_audio=null,this.m_script_list=null,this.m_script_skip_and_phase_btn=null,this.m_love_watch_mode_index=0,this.m_watch_mode_counting=null,this.m_left_arrow_btn=null,this.m_right_arrow_btn=null},stopUpdate:function(){this.m_is_update&&(this.m_is_update=!1,this.unscheduleUpdate())},createAnimationTypeLoad:function(){var a=ccSize(this),m=MasterManager.getInstance(),cg=MasterTable.getInstance().get_LoveCgByGnrlId(this.m_gnrl_id),gnrl=m.get_General(this.m_gnrl_id);this.m_script_body_layer=new cc.Layer,this.m_script_body_layer.ignoreAnchorPointForPosition(!1),this.m_script_body_layer.setContentSize(a),this.m_script_body_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_script_body_layer.setPosition(ccCenter(a)),this.addChild(this.m_script_body_layer);var b={_resource_type:null,bone:null,atlas:null,png:[],bg:null};b._resource_type=ResourceType.RT_SKELETON,b.bone=RES_JBIN+cg.love_cg_story_num+".jbin",b.atlas=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/hscene/"+cg.love_cg_story_num+".atlas";for(var c=LoveCgGeneralName[gnrl.gnrl_group],idx=0;idx<c.length;idx++)b.png.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/hscene/"+c[idx]+".png");var d=res_hscene_bg_jpg_list.indexOf(cg.love_cg_story_num);-1!=d&&(b.bg=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/hscene/"+cg.love_cg_story_num+".jpg"),this.m_resource_list.push(b),this.m_resource_list_array.push(b),this.m_resource_list.sort(function(r,l){return l._resource_type-r._resource_type}),d=c=a=cg=m=gnrl=b=null},createAnimationType:function(){var a=ccSize(this),cg=MasterTable.getInstance().get_LoveCgByGnrlId(this.m_gnrl_id);this.m_back_particle=null,""!=cg.back_effect&&0==USE_SP_LOVE_CONTENT_PARTICLE&&(this.m_back_particle=new cc.ParticleSystem(RES_CDN_DEFULT+"env_effect/"+cg.back_effect+".plist"),this.m_back_particle.setPosition(a.width*cg.back_effect_x,a.height*cg.back_effect_y),this.m_back_particle.resetSystem(),this.m_back_particle.setVisible(!1),this.m_script_body_layer.addChild(this.m_back_particle,1)),this.m_front_particle=null,""!=cg.front_effect&&0==USE_SP_LOVE_CONTENT_PARTICLE&&(this.m_front_particle=new cc.ParticleSystem(RES_CDN_DEFULT+"env_effect/"+cg.front_effect+".plist"),this.m_front_particle.setPosition(cc.p(a.width*cg.front_effect_x,a.height*cg.front_effect_y)),this.m_front_particle.resetSystem(),this.m_front_particle.setVisible(!1),this.m_script_body_layer.addChild(this.m_front_particle,1)),this.m_left_body=cc.Sprite.create(RES_CDN_DEFULT+"card_script_body/10000.png"),this.m_left_body.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_left_body.setPosition(.5*ccWidth(this.m_left_body)*(1.4*this.m_use_Add_Scale),0),this.m_left_body.setScale(1.4*this.m_use_Add_Scale),this.m_left_body.setVisible(!1),this.m_script_body_layer.addChild(this.m_left_body,3),this.m_middle_body=cc.Sprite.create(RES_CDN_DEFULT+"card_script_body/10000.png"),this.m_middle_body.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_middle_body.setPosition(.5*a.width,0),this.m_middle_body.setScale(1.4*this.m_use_Add_Scale),this.m_middle_body.setVisible(!1),this.m_script_body_layer.addChild(this.m_middle_body,4),this.m_right_body=cc.Sprite.create(RES_CDN_DEFULT+"card_script_body/10000.png"),this.m_right_body.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_right_body.setPosition(a.width-.5*ccWidth(this.m_right_body)*(1.4*this.m_use_Add_Scale),0),this.m_right_body.setScale(1.4*this.m_use_Add_Scale),this.m_right_body.setVisible(!1),this.m_script_body_layer.addChild(this.m_right_body,5),this.m_front_particle=null,""!=cg.front_effect&&0==USE_SP_LOVE_CONTENT_PARTICLE&&(this.m_front_particle=new cc.ParticleSystem(RES_CDN_DEFULT+"env_effect/"+cg.front_effect+".plist"),this.m_front_particle.setPosition(cc.p(a.width*cg.front_effect_x,a.height*cg.front_effect_y)),this.m_front_particle.resetSystem(),this.m_front_particle.setVisible(!1),this.m_script_body_layer.addChild(this.m_front_particle,5)),this.m_blink_layer=new cc.LayerColor(cc.color.WHITE),this.m_blink_layer.setOpacity(0),this.m_blink_layer.ignoreAnchorPointForPosition(!1),this.m_blink_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_blink_layer.setPosition(ccCenter(a)),this.addChild(this.m_blink_layer),this.m_left_mask=new cc.LayerColor(cc.color.BLACK),this.m_left_mask.ignoreAnchorPointForPosition(!1),this.m_left_mask.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_left_mask.setPosition(ZERO()),this.m_left_mask.setContentSize(.5*(a.width-HSCNE_SCREEN_WIDTH),a.height),this.addChild(this.m_left_mask),this.m_left_mask.setVisible(!1),this.m_right_mask=new cc.LayerColor(cc.color.BLACK),this.m_right_mask.ignoreAnchorPointForPosition(!1),this.m_right_mask.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_right_mask.setPosition(a.width,0),this.m_right_mask.setContentSize(.5*(a.width-HSCNE_SCREEN_WIDTH),a.height),this.addChild(this.m_right_mask),this.m_right_mask.setVisible(!1),this.m_blink_layer=new cc.LayerColor(cc.color.WHITE),this.m_blink_layer.setOpacity(0),this.m_blink_layer.ignoreAnchorPointForPosition(!1),this.m_blink_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_blink_layer.setPosition(ccCenter(a)),this.addChild(this.m_blink_layer,100),this.m_texture=new cc.RenderTexture(a.width,a.height),this.m_texture.retain(),a=cg=null},createMosaicStencil:function(){var a=ccSize(this),cg=MasterTable.getInstance().get_LoveCgByGnrlId(this.m_gnrl_id);if(this.m_cliper=new cc.ClippingNode,this.m_cliper.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_cliper.setAlphaThreshold(1),this.m_cliper.setPosition(ZERO()),this.m_script_body_layer.addChild(this.m_cliper,6),USE_POLYGON_MOSAIC){var b=this.m_skeleton.getAttachment("mosaicbox","mosaicbox");if(null!=b&&null!=b){var c=[cc.p(100-a.width,100),cc.p(150-a.width,110),cc.p(160-a.width,170),cc.p(100-a.width,190),cc.p(50-a.width,150)];this.m_polygon_stencil=new cc.DrawNode,this.m_polygon_stencil.clear(),this.m_polygon_stencil.drawPoly(c,cc.color.BLACK,0,cc.color.BLACK),this.m_cliper.setStencil(this.m_polygon_stencil)}else this.m_stencil=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box.png",cc.rect(10,10,10,10)),this.m_stencil.setAnchorPoint(ANCHOR_MIDDLE()),this.m_stencil.setPreferredSize(cc.size(cg.mosaic_w*this.mosaicSize,cg.mosaic_h*this.mosaicSize)),this.m_stencil.setPosition(-a.width,0),this.m_cliper.setStencil(this.m_stencil)}else this.m_stencil=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box.png",cc.rect(10,10,10,10)),this.m_stencil.setAnchorPoint(ANCHOR_MIDDLE()),this.m_stencil.setPreferredSize(cc.size(cg.mosaic_w*this.mosaicSize,cg.mosaic_h*this.mosaicSize)),this.m_stencil.setPosition(-a.width,0),this.m_cliper.setStencil(this.m_stencil);this.m_mosaic=cc.Sprite.create(),this.m_mosaic.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_mosaic.setPosition(ZERO()),this.m_cliper.addChild(this.m_mosaic),BattleShaderCache.getInstance().openShader(this.m_mosaic,SHADER_MOSAIC_V2_FSH,SHADER_HSCENE_VSH),this.shader=this.m_mosaic.getShaderProgram();var d=this.shader.getProgram(),f=new Float32Array(2);f[0]=a.width,f[1]=a.height;var e=gl.getUniformLocation(d,"u_resolution");this.shader.setUniformLocationWith2fv(e,f);var g=gl.getUniformLocation(d,"u_cell_size");this.shader.setUniformLocationWith1f(g,MOSAIC_CELL_SIZE),this.shader.updateUniforms(),g=d=e=f=null},showSideMask:function(a){this.m_left_mask.setVisible(a),this.m_right_mask.setVisible(a)},createWatchLayout:function(){var b=ccSize(this);this.m_loop_ui_container=new cc.Node,this.m_loop_ui_container.setPosition(b.width-10,b.height-10),this.addChild(this.m_loop_ui_container),this.m_loop_ui_container.setVisible(!1);var c=0,normal=RES_CDN_DEFULT+"menu_cg/btn_option_off.png",selected=RES_CDN_DEFULT+"menu_cg/btn_option_on.png";this.m_optionWatch=new ccui.Button,this.m_optionWatch.loadTextures(normal,selected),this.m_optionWatch.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_optionWatch.setPosition(0,c),this.m_loop_ui_container.addChild(this.m_optionWatch),this.m_optionWatch.addClickEventListener(function(a){this.openOption()}.bind(this)),c-=68;normal=RES_CDN_DEFULT+"menu_cg/btn_menu_off.png",selected=RES_CDN_DEFULT+"menu_cg/btn_menu_on.png";if(this.m_skipWatch=new ccui.Button,this.m_skipWatch.loadTextures(normal,selected),this.m_skipWatch.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_skipWatch.setPosition(0,c),this.m_loop_ui_container.addChild(this.m_skipWatch),this.m_skipWatch.addClickEventListener(function(a){this.showSkipCheck()}.bind(this)),c-=68,0==USE_HSCENE_WATCH_MODE){normal=RES_CDN_DEFULT+"menu_cg/btn_speed_off.png",selected=RES_CDN_DEFULT+"menu_cg/btn_speed_on.png";this.m_speed_2x_start_Watch=new ccui.Button,this.m_speed_2x_start_Watch.loadTextures(normal,selected),this.m_speed_2x_start_Watch.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_speed_2x_start_Watch.setPosition(0,c),this.m_loop_ui_container.addChild(this.m_speed_2x_start_Watch),this.m_speed_2x_start_Watch.addClickEventListener(function(a){this.speed2XChange()}.bind(this)),this.m_2x_speed_btns.push(this.m_speed_2x_start_Watch);normal=RES_CDN_DEFULT+"menu_cg/btn_speed_none.png",selected=RES_CDN_DEFULT+"menu_cg/btn_speed_on.png";this.m_speed_2x_stop_Watch=new ccui.Button,this.m_speed_2x_stop_Watch.loadTextures(normal,selected),this.m_speed_2x_stop_Watch.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_speed_2x_stop_Watch.setPosition(0,c),this.m_speed_2x_stop_Watch.setVisible(!1),this.m_loop_ui_container.addChild(this.m_speed_2x_stop_Watch),this.m_speed_2x_stop_Watch.addClickEventListener(function(a){this.speed2XChange()}.bind(this)),this.m_2x_speed_btns.push(this.m_speed_2x_stop_Watch),this.m_2x_effect=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/auto_love.json",RES_CDN_DEFULT+"effect/auto_love.atlas",1),this.m_2x_effect.setAnchorPoint(ANCHOR_MIDDLE()),this.m_2x_effect.setPosition(-29,c-29),this.m_2x_effect.setVisible(!1),this.m_2x_effect.setAnimation(0,"fx_1",!0),this.m_loop_ui_container.addChild(this.m_2x_effect,100),c-=68}normal=RES_CDN_DEFULT+"menu_cg/btn_finish_off.png",selected=RES_CDN_DEFULT+"menu_cg/btn_finish_on.png";if(this.m_finish_btn=new ccui.Button,this.m_finish_btn.loadTextures(normal,selected),this.m_finish_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_finish_btn.setPosition(0,c),this.m_loop_ui_container.addChild(this.m_finish_btn),this.m_finish_btn.addClickEventListener(function(a){this.watchFinish()}.bind(this)),USE_HSCENE_WATCH_MODE?c-=150:c-=68,USE_HSCENE_WATCH_MODE){c=-(b.height-10),c+=80;var d=RES_CDN_DEFULT+"menu_cg/btn_page_left_off.png",on=RES_CDN_DEFULT+"menu_cg/btn_page_left_on.png",none=RES_CDN_DEFULT+"menu_cg/btn_page_left_none.png";this.m_left_arrow_btn=new ccui.Button,this.m_left_arrow_btn.loadTextures(d,on,none),this.m_left_arrow_btn.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_left_arrow_btn.setPosition(20-b.width,c),this.m_loop_ui_container.addChild(this.m_left_arrow_btn),this.m_left_arrow_btn.addClickEventListener(function(a){this.watchModeLeft()}.bind(this));d=RES_CDN_DEFULT+"menu_cg/btn_page_right_off.png",on=RES_CDN_DEFULT+"menu_cg/btn_page_right_on.png",none=RES_CDN_DEFULT+"menu_cg/btn_page_right_none.png";this.m_right_arrow_btn=new ccui.Button,this.m_right_arrow_btn.loadTextures(d,on,none),this.m_right_arrow_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_right_arrow_btn.setPosition(0,c),this.m_loop_ui_container.addChild(this.m_right_arrow_btn),this.m_right_arrow_btn.addClickEventListener(function(a){this.watchModeRight()}.bind(this)),c+=40,this.m_watch_mode_counting=cmLabel.getLabel(cmString("%d/%d",this.m_love_watch_mode_index+1,this.m_love_watch_mode_list.length),LABEL_FONT_INDEX.FONT_261),this.m_watch_mode_counting.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_watch_mode_counting.setPosition(-10,c),this.m_loop_ui_container.addChild(this.m_watch_mode_counting)}b=null},createCommonLayout:function(){var d=ccSize(this),boxSize=cc.size(d.width,172);if(this.m_bg_frame=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_line_1.png",cc.rect(1,0,1,0)),this.m_bg_frame.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_bg_frame.setPreferredSize(boxSize),this.m_bg_frame.setPosition(ZERO()),this.addChild(this.m_bg_frame),this.m_bg_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_line_1.png",RectZero()),this.m_bg_mask.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_bg_mask.setPosition(ZERO()),this.m_bg_mask.setContentSize(d.width,172),this.m_bg_frame.addChild(this.m_bg_mask),this.m_name_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_261),this.m_name_label.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_name_label.setPosition(30,ccHeight(this.m_bg_frame)-15),this.m_bg_frame.addChild(this.m_name_label),this.m_finger=cc.Sprite.create(),this.m_finger.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_finger.setPosition(boxSize.width,10),this.m_bg_frame.addChild(this.m_finger),NOT_USE_SP_BATTLE_ANIMATION){this.m_finger.setScale(2),this.m_finger.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/img_script_dialog_01.png");var e=new cc.ScaleTo(.2,2.03,2.03),scaleTo_2=new cc.ScaleTo(.2,1.97,1.97),sequence=new cc.Sequence(e,scaleTo_2);repeat=new cc.RepeatForever(sequence);this.m_finger.runAction(repeat),repeat=sequence=scaleTo_2=e=null}else{var f=BattleAni._getInstance().getAnimate(BattleAni_.EffectFinger),repeat=f.repeatForever();this.m_finger.runAction(repeat),repeat=f=null}repeat=f=null,this.m_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_221),this.m_label.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_label.setPosition(30,boxSize.height-50),this.m_label.setTextAreaSize(cc.size(boxSize.width-135,120)),this.m_label.ignoreContentAdaptWithSize(!1),this.m_label.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_label.setTextHorizontalAlignment(cc.TEXT_ALIGNMENT_LEFT),this.m_bg_frame.addChild(this.m_label),this.m_touch_button_Common=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(1,1,1,1))),this.m_touch_button_Common.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_touch_button_Common.setPreferredSize(cc.size(d.width,d.height)),this.m_touch_button_Common.setPosition(ZERO()),this.addChild(this.m_touch_button_Common),this.m_touch_button_Common.addTargetWithActionForControlEvents(this,this.onTouchTalkBox,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),this.m_event_touch=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE}),this.m_event_touch.onTouchBegan=this.onTouchTalkBox.bind(this),cc.eventManager.addListener(this.m_event_touch,this),this.m_auto_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_cg/img_auto.png"),this.m_auto_icon.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_auto_icon.setPosition(20,635),this.m_auto_icon.setVisible(!1),this.addChild(this.m_auto_icon),this.m_ff_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_cg/img_foward.png"),this.m_ff_icon.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_ff_icon.setPosition(20,635),this.m_ff_icon.setVisible(!1),this.addChild(this.m_ff_icon);var g=RES_CDN_DEFULT+"menu_cg/btn_cglook_off.png",selected=RES_CDN_DEFULT+"menu_cg/btn_cglook_on.png";this.m_show_btn=new ccui.Button,this.m_show_btn.loadTextures(g,selected),this.m_show_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_show_btn.setPosition(d.width-10,630),this.m_show_btn.setVisible(!1),this.addChild(this.m_show_btn),this.m_show_btn.addClickEventListener(function(a){this.showScript(!0)}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_show_btn.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),this.m_btn_container=new cc.Node,this.m_btn_container.setPosition(d.width-10,d.height-10),this.m_btn_container.setVisible(!1),this.addChild(this.m_btn_container);var h=0;g=RES_CDN_DEFULT+"menu_cg/btn_option_off.png",selected=RES_CDN_DEFULT+"menu_cg/btn_option_on.png";this.m_option_Common=new ccui.Button,this.m_option_Common.loadTextures(g,selected),this.m_option_Common.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_option_Common.setPosition(0,h),this.m_btn_container.addChild(this.m_option_Common),this.m_option_Common.addClickEventListener(function(a){this.openOption()}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_option_Common.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),h-=68;g=RES_CDN_DEFULT+"menu_cg/btn_cghide_off.png",selected=RES_CDN_DEFULT+"menu_cg/btn_cghide_on.png";this.m_hide_Common=new ccui.Button,this.m_hide_Common.loadTextures(g,selected),this.m_hide_Common.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_hide_Common.setPosition(0,h),this.m_btn_container.addChild(this.m_hide_Common),this.m_hide_Common.addClickEventListener(function(a){this.setStatus(STATUS_LOVE_CG.NONE),this.showScript(!1)}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_hide_Common.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),h-=68;g=RES_CDN_DEFULT+"menu_cg/btn_log_off.png",selected=RES_CDN_DEFULT+"menu_cg/btn_log_on.png";this.m_log_Common=new ccui.Button,this.m_log_Common.loadTextures(g,selected),this.m_log_Common.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_log_Common.setPosition(0,h),this.m_btn_container.addChild(this.m_log_Common),this.m_log_Common.addClickEventListener(function(a){this.setStatus(STATUS_LOVE_CG.NONE),this.showScriptLog(!0)}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_log_Common.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),h-=68;g=RES_CDN_DEFULT+"menu_cg/btn_auto_off.png",selected=RES_CDN_DEFULT+"menu_cg/btn_auto_on.png";this.m_auto_start_Common=new ccui.Button,this.m_auto_start_Common.loadTextures(g,selected),this.m_auto_start_Common.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_auto_start_Common.setPosition(0,h),this.m_btn_container.addChild(this.m_auto_start_Common),this.m_auto_start_Common.addClickEventListener(function(a){this.setAutoForward(STATUS_LOVE_CG.AUTO_FORWARD)}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_auto_start_Common.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),this.m_auto_forward_btns.push(this.m_auto_start_Common);g=RES_CDN_DEFULT+"menu_cg/btn_auto_none.png",selected=RES_CDN_DEFULT+"menu_cg/btn_auto_on.png";this.m_auto_stop_Common=new ccui.Button,this.m_auto_stop_Common.loadTextures(g,selected),this.m_auto_stop_Common.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_auto_stop_Common.setPosition(0,h),this.m_auto_stop_Common.setVisible(!1),this.m_btn_container.addChild(this.m_auto_stop_Common),this.m_auto_stop_Common.addClickEventListener(function(a){this.setAutoForward(STATUS_LOVE_CG.NONE)}.bind(this)),this.m_auto_forward_btns.push(this.m_auto_stop_Common),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_auto_stop_Common.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),this.m_auto_effect=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/auto_love.json",RES_CDN_DEFULT+"effect/auto_love.atlas",1),this.m_auto_effect.setAnchorPoint(ANCHOR_MIDDLE()),this.m_auto_effect.setPosition(-29,h-29),this.m_btn_container.addChild(this.m_auto_effect,100),this.m_auto_effect.setVisible(!1),this.m_auto_effect.setAnimation(0,"fx_1",!0),h-=68;g=RES_CDN_DEFULT+"menu_cg/btn_fast_forward_off.png",selected=RES_CDN_DEFULT+"menu_cg/btn_fast_forward_on.png";this.m_ff_start_Common=new ccui.Button,this.m_ff_start_Common.loadTextures(g,selected),this.m_ff_start_Common.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_ff_start_Common.setPosition(0,h),this.m_btn_container.addChild(this.m_ff_start_Common),this.m_ff_start_Common.addClickEventListener(function(a){this.setFastForward(STATUS_LOVE_CG.FAST_FORWARD)}.bind(this)),this.m_fast_forward_btns.push(this.m_ff_start_Common),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_ff_start_Common.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS);g=RES_CDN_DEFULT+"menu_cg/btn_fast_forward_none.png",selected=RES_CDN_DEFULT+"menu_cg/btn_fast_forward_on.png";this.m_ff_stop_Common=new ccui.Button,this.m_ff_stop_Common.loadTextures(g,selected),this.m_ff_stop_Common.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_ff_stop_Common.setPosition(0,h),this.m_ff_stop_Common.setVisible(!1),this.m_btn_container.addChild(this.m_ff_stop_Common),this.m_ff_stop_Common.addClickEventListener(function(a){this.setFastForward(STATUS_LOVE_CG.NONE)}.bind(this)),this.m_fast_forward_btns.push(this.m_ff_stop_Common),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_ff_stop_Common.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),this.m_ff_effect=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/auto_love.json",RES_CDN_DEFULT+"effect/auto_love.atlas",1),this.m_ff_effect.setAnchorPoint(ANCHOR_MIDDLE()),this.m_ff_effect.setPosition(-29,h-29),this.m_ff_effect.setVisible(!1),this.m_ff_effect.setAnimation(0,"fx_1",!0),this.m_btn_container.addChild(this.m_ff_effect,100),h-=68;g=RES_CDN_DEFULT+"menu_cg/btn_menu_off.png",selected=RES_CDN_DEFULT+"menu_cg/btn_menu_on.png";this.m_skip_Common=new ccui.Button,this.m_skip_Common.loadTextures(g,selected),this.m_skip_Common.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_skip_Common.setPosition(0,h),this.m_btn_container.addChild(this.m_skip_Common),this.m_skip_Common.addClickEventListener(function(a){this.setFastForward(STATUS_LOVE_CG.NONE);var b=TutorialContextV2.getInstance();if(b.IsCompleteAllTutorial())this.sceneEnd();else{var c=b.getCurrentTutorialStep();if(c.tutorial_page==TUTORIAL_PAGE_4_LOVE_CG)c.action_type==TutorialAction.Ready?MainObserver.getInstance().postNotification(NOTIFICATION_TUTORIAL,message_complete_tutorial):this.sceneEnd();else this.sceneEnd()}}.bind(this)),this.m_skip_Common.setTutorialTag(TUTORIAL_TAG_PAGE_4_LOVE_EVENT_SKIP),h-=68;var i=MasterTable.getInstance().get_LoveCgByGnrlId(this.m_gnrl_id);if(USE_HSCENE_WATCH_MODE&&"y"==i.animation_yn){var j=RES_CDN_DEFULT+"menu_cg/btn_skip_off.png",on=RES_CDN_DEFULT+"menu_cg/btn_skip_on.png";this.m_script_skip_and_phase_btn=new ccui.Button,this.m_script_skip_and_phase_btn.loadTextures(j,on),this.m_script_skip_and_phase_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_script_skip_and_phase_btn.setPosition(0,h),this.m_btn_container.addChild(this.m_script_skip_and_phase_btn),this.m_script_skip_and_phase_btn.addClickEventListener(function(a){this.skipScriptAndShowPhase()}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_script_skip_and_phase_btn.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),h-=68}boxSize=d=null},startLoveContentsAnimationScript:function(){if(!this.m_is_complete){if(this.m_script_index<this.m_animation_script_list.length){var a=this.m_animation_script_list[this.m_script_index];if(this.m_status==STATUS_LOVE_CG.FAST_FORWARD&&"finish"==a.animation&&this.setStatus(STATUS_LOVE_CG.NONE),"0"!=a.bg_img){if(this.m_script_bg.setVisible(!0),this.last_script_bg!=a.bg_img){var b=RES_CDN_DEFULT+"card_script_bg/"+a.bg_img+".jpg";this.m_script_bg.setTexture(b),this.last_script_bg=a.bg_img}}else this.m_script_bg.setVisible(!1);if("0"==a.l_filename||""==a.l_filename)this.m_left_body.setVisible(!1);else{if(this.m_left_body.setVisible(!0),this.m_last_left_body!=a.l_filename){b=RES_CDN_DEFULT+"card_script_body/"+a.l_filename+".png";this.m_left_body.setTexture(b),this.m_last_left_body=a.l_filename}0==a.body_onoff||2==a.body_onoff||3==a.body_onoff?this.m_left_body.setColor(cc.color.GRAY):1!=a.body_onoff&&4!=a.body_onoff||this.m_left_body.setColor(cc.color.WHITE),0!=a.l_reverse?this.m_left_body.setFlippedX(!0):this.m_left_body.setFlippedX(!1)}if("0"==a.m_filename||""==a.m_filename)this.m_middle_body.setVisible(!1);else{if(this.m_middle_body.setVisible(!0),this.m_last_middle_body!=a.m_filename){b=RES_CDN_DEFULT+"card_script_body/"+a.m_filename+".png";this.m_middle_body.setTexture(b),this.m_last_middle_body=a.m_filename}0==a.body_onoff||1==a.body_onoff||2==a.body_onoff?this.m_middle_body.setColor(cc.color.GRAY):3!=a.body_onoff&&4!=a.body_onoff||this.m_middle_body.setColor(cc.color.WHITE)}if("0"==a.r_filename||""==a.r_filename)this.m_right_body.setVisible(!1);else{if(this.m_right_body.setVisible(!0),this.m_last_right_body!=a.r_filename){b=RES_CDN_DEFULT+"card_script_body/"+a.r_filename+".png";this.m_right_body.setTexture(b),this.m_last_right_body=a.r_filename}0==a.body_onoff||1==a.body_onoff||3==a.body_onoff?this.m_right_body.setColor(cc.color.GRAY):2!=a.body_onoff&&4!=a.body_onoff||this.m_right_body.setColor(cc.color.WHITE),0!=a.r_reverse?this.m_right_body.setFlippedX(!0):this.m_right_body.setFlippedX(!1)}if("0"==a.name||""==a.name?this.m_name_label.setString(""):"1"==a.name?this.m_name_label.setString(this.m_user_info.nickname):this.m_name_label.setString(a.name),1==a.name_type){var c=a.content.replace("%s",this.m_user_info.nickname);this.m_label.setString(c)}else this.m_label.setString(a.content);if(a.effect_type==EFFECT_TYPE_WHITE_BLINK?this.m_status!=STATUS_LOVE_CG.FAST_FORWARD&&this.screenEmergency(a.effect_value):a.effect_type==EFFECT_TYPE_WHITE_FADEIN?this.m_status!=STATUS_LOVE_CG.FAST_FORWARD&&this.screenFadeIn(a.effect_value):a.effect_type==EFFECT_TYPE_DELAY_TIME?this.m_status!=STATUS_LOVE_CG.FAST_FORWARD&&this.screenWhiteDelay(a.effect_value):a.effect_type==EFFECT_TYPE_WHITE_OUT?(this.m_status,STATUS_LOVE_CG.FAST_FORWARD):a.effect_type,"0"==a.animation||""==a.animation)this.m_skeleton_bg.setVisible(!1),this.m_skeleton.setVisible(!1),this.hideMosaic(),this.showSideMask(!1);else if(this.showSideMask(!0),this.m_skeleton_bg.setVisible(!0),this.m_skeleton.setVisible(!0),USE_HSCENE_WATCH_MODE&&null!=this.m_script_skip_and_phase_btn&&this.m_script_skip_and_phase_btn.setVisible(!1),this.m_last_animation!=a.animation){var d=MasterTable.getInstance().get_LoveCgByGnrlId(this.m_gnrl_id);if(null!=this.m_stencil&&this.m_stencil.setPreferredSize(cc.size(d.mosaic_w*this.mosaicSize,d.mosaic_h*this.mosaicSize)),null!=this.m_env_effect_bg&&this.m_env_effect_bg.setVisible(!0),null!=this.m_back_particle&&this.m_back_particle.setVisible(!0),null!=this.m_front_particle&&this.m_front_particle.setVisible(!0),"finish"==a.animation)this.m_skeleton.setAnimation(0,a.animation,!1),this.setStatus(STATUS_LOVE_CG.NONE);else if("after"==a.animation)this.m_skeleton.setSlotsToSetupPose(),this.m_skeleton.setAnimation(0,a.animation,!0);else{-1!=a.animation.indexOf("between")?this.m_skeleton.setAnimation(0,a.animation,!1):this.m_skeleton.setAnimation(0,a.animation,!0)}this.m_last_animation=a.animation,this.m_is_hide_mosaic&&(this.m_is_hide_mosaic=!1)}if("0"!=a.voice&&this.m_status!=STATUS_LOVE_CG.FAST_FORWARD){var e=AudioEngine.getInstance();e.stopEffectsAll(),e.stopVoiceAll();var f=RES_CDN_SOUND+SND_TYPE+"voice_love/"+a.voice+".mp3";e.playVoice(f),this.m_script_delta_time=0}if(this.m_current_animation=a,this.m_script_index=this.m_script_index+1,this.m_script_index>=this.m_animation_script_list.length){this.m_script_index=this.m_animation_script_list.length-1,this.m_is_complete=!0,this.m_finger.setVisible(!1);var g=TutorialContextV2.getInstance();if(!g.IsCompleteAllTutorial()){var h=g.getCurrentTutorialStep();if(h.tutorial_page==TUTORIAL_PAGE_4_LOVE_CG)h.action_type==TutorialAction.Ready&&MainObserver.getInstance().postNotification(NOTIFICATION_TUTORIAL,message_complete_tutorial)}}a=null}this.scheduleOnce(this.hideLoadingLayer,.1)}},startLoveContentsScript:function(){if(!this.m_is_complete){if(this.m_script_index<this.m_script_list.length){var a=this.m_script_list[this.m_script_index];if(null!=a.img&&this.last_script_bg!=a.img){var b=RES_CDN_DEFULT+"menu_cg/"+a.img+".jpg";this.m_script_bg.setTexture(b),this.last_script_bg=a.bg_img}if("0"==a.name?this.m_name_label.setString(""):"1"==a.name?this.m_name_label.setString(this.m_user_info.nickname):this.m_name_label.setString(a.name),1==a.name_type){var c=a.content.replace("%s",this.m_user_info.nickname);this.m_label.setString(c)}else this.m_label.setString(a.content);if(a.effect_type==EFFECT_TYPE_WHITE_BLINK?this.m_status!=STATUS_LOVE_CG.FAST_FORWARD&&this.screenEmergency(a.effect_value):a.effect_type==EFFECT_TYPE_WHITE_FADEIN?this.m_status!=STATUS_LOVE_CG.FAST_FORWARD&&this.screenFadeIn(a.effect_value):a.effect_type==EFFECT_TYPE_DELAY_TIME?this.m_status!=STATUS_LOVE_CG.FAST_FORWARD&&this.screenWhiteDelay(a.effect_value):a.effect_type==EFFECT_TYPE_WHITE_OUT?(this.m_status,STATUS_LOVE_CG.FAST_FORWARD):a.effect_type,"0"!=a.voice&&this.m_status!=STATUS_LOVE_CG.FAST_FORWARD){var d=AudioEngine.getInstance();d.stopEffectsAll(),d.stopVoiceAll();var e=RES_CDN_SOUND+SND_TYPE+"voice_love/"+a.voice+".mp3";this.m_current_voice_id=d.playVoice(e)}if(this.m_current_script=a,this.m_script_index=this.m_script_index+1,this.m_script_index>=this.m_script_list.length){this.m_script_index=this.m_script_list.length-1,this.m_is_complete=!0;var f=TutorialContextV2.getInstance();if(!f.IsCompleteAllTutorial())if(this.step=f.getCurrentTutorialStep(),step.tutorial_page==TUTORIAL_PAGE_4_LOVE_CG)step.action_type==TutorialAction.Ready&&MainObserver.getInstance().postNotification(NOTIFICATION_TUTORIAL,message_complete_tutorial)}a=null}this.scheduleOnce(this.hideLoadingLayer,.1)}},touchTalkBoxDelay:function(){this.m_enable_touch=!0},onTouchTalkBox:function(b,c){if(0!=this.m_enable_touch_click){if(this.scheduleOnce(function(a){this.m_enable_touch=!0,this.m_enable_touch_click=!0}.bind(this),.5,"touchTalkBoxDelay"),1==this.m_enable_touch){if(this.m_enable_touch_click=!1,this.m_enable_touch=!1,!this.isVisible()||!this.m_bg_frame.isVisible())return;if(this.m_status!=STATUS_LOVE_CG.NONE)return;if(this.m_loading_modal_layer.is_show())return;if(this.m_box.is_show())return;if(this.m_scene_mode!=SCENE_MODE.NORMAL)return;var d=TutorialContextV2.getInstance();if(d.IsCompleteAllTutorial())this.m_script_type==SCRIPT_TYPE.ANIMATION?"end"==this.m_current_animation.animation?this.autoLoveContentComplete():"finish"!=this.m_current_animation.animation&&(this.m_is_complete?this.sceneEnd():this.startLoveContentsAnimationScript()):this.m_script_type==SCRIPT_TYPE.SCRIPT&&(this.m_is_complete?this.sceneEnd():this.startLoveContentsScript());else{var e=d.getCurrentTutorialStep();if(e.tutorial_page==TUTORIAL_PAGE_4_LOVE_CG)e.action_type==TutorialAction.Ready&&(this.m_script_type==SCRIPT_TYPE.ANIMATION?"end"==this.m_current_animation.animation?this.autoLoveContentComplete():"finish"!=this.m_current_animation.animation&&(this.m_is_complete?this.sceneEnd():this.startLoveContentsAnimationScript()):this.m_script_type==SCRIPT_TYPE.SCRIPT&&(this.startLoveContentsScript(),this.m_is_complete?this.sceneEnd():this.startLoveContentsScript()))}this.m_enable_touch=!1}cc.log("this.m_enalble_touch2 = "+this.m_enable_touch)}},showScript:function(a){this.m_bg_frame.setVisible(a),this.m_btn_container.setVisible(a),a?this.m_show_btn.setVisible(!1):this.m_show_btn.setVisible(!0)},setAutoForward:function(a){this.setStatus(a),this.m_script_delta_time=0,a==STATUS_LOVE_CG.AUTO_FORWARD?(this.m_auto_forward_btns[0].setVisible(!1),this.m_auto_forward_btns[1].setVisible(!0),this.m_is_complete&&(this.m_script_index--,this.m_script_index=Math.max(this.m_script_index,0)),this.m_script_type==SCRIPT_TYPE.ANIMATION?this.startLoveContentsAnimationScript():this.m_script_type==SCRIPT_TYPE.SCRIPT&&this.startLoveContentsScript()):(this.m_auto_forward_btns[0].setVisible(!0),this.m_auto_forward_btns[1].setVisible(!1))},setFastForward:function(a){AudioEngine.getInstance().stopVoice(),this.setStatus(a),this.m_script_delta_time=0,a==STATUS_LOVE_CG.FAST_FORWARD?(this.m_fast_forward_btns[0].setVisible(!1),this.m_fast_forward_btns[1].setVisible(!0)):(this.m_fast_forward_btns[0].setVisible(!0),this.m_fast_forward_btns[1].setVisible(!1))},autoLoveContentComplete:function(){this.m_script_delta_time=0,this.setStatus(STATUS_LOVE_CG.NONE);var a=TutorialContextV2.getInstance();if(!a.IsCompleteAllTutorial()){var b=a.getCurrentTutorialStep();if(b.tutorial_page==TUTORIAL_PAGE_4_LOVE_CG)b.action_type==TutorialAction.Ready&&MainObserver.getInstance().postNotification(NOTIFICATION_TUTORIAL,message_complete_tutorial)}},sceneEnd:function(){this.m_script_type==SCRIPT_TYPE.ANIMATION?TutorialContextV2.getInstance().IsCompleteAllTutorial()?this.showSkipCheck():(this.m_is_update&&(this.m_is_update=!1,this.unscheduleUpdate()),MainObserver.getInstance().postNotification(sceneStr[scene_LoveContentsCGScene],Contents_Skip)):(this.m_is_update&&(this.m_is_update=!1,this.unscheduleUpdate()),MainObserver.getInstance().postNotification(sceneStr[scene_LoveContentsCGScene],Contents_Skip))},watchSceneEnd:function(){this.m_is_update&&(this.m_is_update=!1,this.unscheduleUpdate()),MainObserver.getInstance().postNotification(sceneStr[scene_LoveContentsCGScene],Contents_Skip)},hideMosaic:function(){if(this.m_is_hide_mosaic=!0,USE_POLYGON_MOSAIC){var a=ccSize(this);if(null!=this.m_polygon_stencil){var b=[cc.p(100-a.width,100),cc.p(150-a.width,110),cc.p(160-a.width,170),cc.p(100-a.width,190),cc.p(50-a.width,150)];this.m_polygon_stencil.clear(),this.m_polygon_stencil.drawPoly(b,cc.color.BLACK,0,cc.color.BLACK)}else null!=this.m_stencil&&this.m_stencil.setPosition(-2e3,0)}else null!=this.m_stencil&&this.m_stencil.setPosition(-2e3,0)},mosaic:function(){return this.hideMosaic();if(this.m_is_update&&!this.m_is_hide_mosaic){var a=ccSize(this);if(this.m_texture.begin(),null!=this.m_env_effect_bg&&this.m_env_effect_bg.visit(),this.m_skeleton_bg.visit(),this.m_skeleton.visit(),this.m_texture.end(),null==this.m_mosaic||null==this.m_mosaic)this.m_mosaic=new cc.Sprite(this.m_texture.getSprite().getTexture()),this.m_mosaic.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_mosaic.setFlippedY(!0),this.m_cliper.addChild(this.m_mosaic);else{var b=this.m_texture.getSprite().getSpriteFrame();this.m_mosaic.setSpriteFrame(b)}if(this.m_mosaic.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_mosaic.setFlippedY(!0),USE_POLYGON_MOSAIC){var c=ccCenter(a);if(null!=this.m_polygon_stencil){var d=new spine.SkeletonBounds,boundingBox=this.m_skeleton.getAttachment("mosaicbox","mosaicbox");this.m_skeleton.updateWorldTransform(),d.update(this.m_skeleton._skeleton,!0);for(var e=d.getPolygon(boundingBox),p1_vertice_list=[],i=0;i<e.length;i++)p1_vertice_list.push_back(e[i]);var f=[],index=0;for(i=0;i<p1_vertice_list.size();i+=2)x=c.x+p1_vertice_list.at(i),y=c.y+p1_vertice_list.at(i+1),f[index]=cc.p(x,y),index++;return this.m_polygon_stencil.clear(),this.m_polygon_stencil.drawPoly(f,cc.color.BLACK,0,cc.color.BLACK),void(f=null)}}var g=this.m_skeleton.findBone("mosaic");if(null!=g){this.m_stencil.getPreferredSize();var x=.5*a.width+g.x,y=.5*a.height+g.y;this.m_stencil.setPosition(x,y)}}},update:function(a){if(this.m_scene_mode==SCENE_MODE.NORMAL){if(this.m_status==STATUS_LOVE_CG.NONE){if(this.m_script_type==SCRIPT_TYPE.ANIMATION&&("0"!=this.m_last_animation&&null!=this.m_last_animation?this.mosaic():this.hideMosaic(),"finish"==this.m_current_animation.animation&&"0"!=this.m_current_animation.voice&&(this.m_script_delta_time+=a,this.m_current_animation.voice_duration<this.m_script_delta_time)))if(this.m_script_delta_time=0,this.m_script_index<this.m_animation_script_list.length){if(this.m_is_complete)return void this.autoLoveContentComplete();this.startLoveContentsAnimationScript()}else this.startLoveContentsAnimationScript();return}if(this.m_script_type==SCRIPT_TYPE.ANIMATION){if("0"!=this.m_last_animation&&null!=this.m_last_animation?this.mosaic():this.hideMosaic(),this.m_script_delta_time+=a,this.m_status==STATUS_LOVE_CG.FAST_FORWARD){if(this.m_script_delta_time>FAST_FORWARD_TIME)if(this.m_script_delta_time=0,this.m_current_voice_id=0,this.m_script_index<this.m_animation_script_list.length){if(this.m_is_complete)return void this.autoLoveContentComplete();this.startLoveContentsAnimationScript()}else this.startLoveContentsAnimationScript()}else if(this.m_status==STATUS_LOVE_CG.AUTO_FORWARD&&this.m_script_delta_time>AUTO_FORWARD_TIME){if("0"!=this.m_current_animation.voice&&this.m_current_animation.voice_duration>this.m_script_delta_time)return;if(!this.m_is_effect_playing)if(this.m_script_delta_time=0,this.m_current_voice_id=0,this.m_script_index<this.m_animation_script_list.length){if(this.m_is_complete)return void this.autoLoveContentComplete();this.startLoveContentsAnimationScript()}else this.startLoveContentsAnimationScript()}}else if(this.m_script_type==SCRIPT_TYPE.SCRIPT)if(this.m_script_delta_time+=a,this.m_status==STATUS_LOVE_CG.FAST_FORWARD){if(this.m_script_delta_time>FAST_FORWARD_TIME)if(this.m_script_delta_time=0,this.m_current_voice_id=0,this.m_script_index<this.m_script_list.length){if(this.m_is_complete)return void this.autoLoveContentComplete();this.startLoveContentsScript()}else this.autoLoveContentComplete()}else if(this.m_status==STATUS_LOVE_CG.AUTO_FORWARD&&this.m_script_delta_time>AUTO_FORWARD_TIME){if("0"!=this.m_current_script.voice&&this.m_current_script.voice_duration>this.m_script_delta_time)return;if(!this.m_is_effect_playing)if(this.m_script_delta_time=0,this.m_current_voice_id=0,this.m_script_index<this.m_script_list.size()){if(this.m_is_complete)return void this.autoLoveContentComplete();this.startLoveContentsScript()}else this.autoLoveContentComplete()}}else this.m_scene_mode==SCENE_MODE.WATCH&&(this.m_script_type==SCRIPT_TYPE.ANIMATION?0==this.m_screen_mosaic_visible&&this.mosaic():(this.m_script_type,SCRIPT_TYPE.SCRIPT))},showScriptLog:function(c){if(c){if(this.m_script_type==SCRIPT_TYPE.ANIMATION){for(var d=[],i=0;i<this.m_animation_script_list.length&&(d.push(this.m_animation_script_list[i]),this.m_is_complete||i!=this.m_script_index-1);i++);this.m_log_box.setContentSize(ccSize(this)),this.m_log_box._contentNode=function(a,m){var b=new cc.Layer,log=new LoveContentCGLogLayer;return log.setScriptData(d,this.m_script_type),log.setAnchorPoint(ANCHOR_MIDDLE()),log.setPosition(ccCenter(b)),b.addChild(log),b}.bind(this),this.m_log_box.is_show()&&this.m_log_box.hide(),this.m_log_box.show(),d=null}else if(this.m_script_type==SCRIPT_TYPE.SCRIPT){for(d=[],i=0;i<this.m_script_list.length&&(d.push(this.m_script_list[i]),this.m_is_complete||i!=this.m_script_index-1);i++);this.m_log_box.setContentSize(ccSize(this)),this.m_log_box._contentNode=function(a,m){var b=new cc.Layer,log=new LoveContentCGLogLayer;return log.setAnchorPoint(ANCHOR_MIDDLE()),log.setScriptData(d,this.m_script_type),log.setPosition(ccCenter(b)),b.addChild(log),b}.bind(this),this.m_log_box.is_show()&&this.m_log_box.hide(),this.m_log_box.show(),d=null}}else this.m_log_box.is_show()&&this.m_log_box.hide()},setStatus:function(a){this.m_status!=a&&(a==STATUS_LOVE_CG.NONE?(this.m_finger.isVisible()||this.m_finger.setVisible(!0),this.m_ff_icon.setVisible(!1),this.m_auto_icon.setVisible(!1),this.m_fast_forward_btns[0].setVisible(!0),this.m_fast_forward_btns[1].setVisible(!1),this.m_auto_forward_btns[0].setVisible(!0),this.m_auto_forward_btns[1].setVisible(!1),this.m_auto_effect.setVisible(!1),this.m_ff_effect.setVisible(!1)):(this.m_finger.isVisible()&&this.m_finger.setVisible(!1),a==STATUS_LOVE_CG.FAST_FORWARD?(this.m_ff_icon.setVisible(!0),this.m_auto_icon.setVisible(!1),this.m_auto_forward_btns[0].setVisible(!0),this.m_auto_forward_btns[1].setVisible(!1),this.m_auto_effect.setVisible(!1),this.m_ff_effect.setVisible(!0)):a==STATUS_LOVE_CG.AUTO_FORWARD&&(this.m_ff_icon.setVisible(!1),this.m_auto_icon.setVisible(!0),this.m_fast_forward_btns[0].setVisible(!0),this.m_fast_forward_btns[1].setVisible(!1),this.m_auto_effect.setVisible(!0),this.m_ff_effect.setVisible(!1))),this.m_status=a)},screenBlackOut:function(a){this.m_blink_layer.isRunning()&&(this.m_blink_layer.stopAllActions(),this.m_blink_layer.setVisible(!1)),this.m_blink_layer.setVisible(!0),this.m_blink_layer.setOpacity(0),this.m_blink_layer.setColor(cc.color.BLACK);var b=new cc.FadeIn(a),cb=new cc.CallFunc(this.cbScreenBlackOut.bind(this)),seq=new cc.Sequence(b,cb);this.m_blink_layer.runAction(seq),this.m_is_effect_playing=!0,this.showScript(!1)},cbScreenBlackOut:function(a){},screenWhiteDelay:function(a){this.m_blink_layer.isRunning()&&(this.m_blink_layer.stopAllActions(),this.m_blink_layer.setVisible(!1)),this.m_blink_layer.setVisible(!1);var b=new cc.DelayTime(a),cb=new cc.CallFunc(this.cbScrrenWhiteDelay.bind(this)),seq=new cc.Sequence(b,cb);this.m_blink_layer.runAction(seq),this.m_is_effect_playing=!0},cbScrrenWhiteDelay:function(a){this.m_is_effect_playing=!1;null!=a&&(a.setVisible(!1),this.m_status==STATUS_LOVE_CG.AUTO_FORWARD?this.m_script_delta_time=AUTO_FORWARD_TIME:this.m_status==STATUS_LOVE_CG.NONE&&(this.m_script_type==SCRIPT_TYPE.ANIMATION?this.startLoveContentsAnimationScript():this.m_script_type==SCRIPT_TYPE.SCRIPT&&this.startLoveContentsScript()))},screenFadeIn:function(a){this.m_blink_layer.isRunning()&&(this.m_blink_layer.stopAllActions(),this.m_blink_layer.setVisible(!1)),this.m_blink_layer.setVisible(!0),this.m_blink_layer.setOpacity(255),this.m_blink_layer.setColor(cc.color.WHITE);var b=cc.delayTime(a),f1=new cc.FadeOut(.3),cb=new cc.CallFunc(this.cbScreenFadeIn.bind(this)),seq=new cc.Sequence(b,f1,cb);this.m_blink_layer.runAction(seq),this.m_is_effect_playing=!0,this.showScript(!1),this.m_show_btn.setVisible(!1)},cbScreenFadeIn:function(a){this.showScript(!0),this.m_is_effect_playing=!1;null!=a&&(a.setVisible(!1),this.m_status==STATUS_LOVE_CG.AUTO_FORWARD?this.m_script_delta_time=AUTO_FORWARD_TIME:this.m_status==STATUS_LOVE_CG.NONE&&(this.m_script_type==SCRIPT_TYPE.ANIMATION?this.startLoveContentsAnimationScript():this.m_script_type==SCRIPT_TYPE.SCRIPT&&this.startLoveContentsScript()))},screenEmergency:function(a){this.m_blink_layer.isRunning()&&(this.m_blink_layer.stopAllActions(),this.m_blink_layer.setVisible(!1)),this.m_blink_layer.setVisible(!0),this.m_blink_layer.setOpacity(0),this.m_blink_layer.setColor(cc.color.WHITE);var b=new cc.FadeTo(.1,200),f2=new cc.FadeTo(.1,0),f_seq=new cc.Sequence(b,f2),fTimes=Math.ceil(a/.2),times=Math.round(fTimes);3<times&&(times=3);var c=new cc.Repeat(f_seq,times),cb=new cc.CallFunc(this.cbScreenEmergency.bind(this)),seq=new cc.Sequence(c,cb);this.m_blink_layer.runAction(seq),this.m_is_effect_playing=!0,this.showScript(!1)},cbScreenEmergency:function(a){this.showScript(!0),this.m_is_effect_playing=!1;null!=a&&(a.setVisible(!1),this.m_status==STATUS_LOVE_CG.AUTO_FORWARD?this.m_script_delta_time=AUTO_FORWARD_TIME:this.m_status==STATUS_LOVE_CG.NONE&&(this.m_script_type==SCRIPT_TYPE.ANIMATION?this.startLoveContentsAnimationScript():this.m_script_type==SCRIPT_TYPE.SCRIPT&&this.startLoveContentsScript()))},tolowerCase:function(a){return a.toLowerCase()},spAnimationState_getCurrent:function(a,b){return b.trackIndex>=a.tracks.length?0:a.tracks[b.trackIndex]},spineStartListener:function(a){var b=this.spAnimationState_getCurrent(this.m_skeleton.getState(),a);a>=this.m_skeleton.getCurrent()?b.timeScale=HSCENE_TIME_SCALE_2X:b.timeScale=HSCENE_TIME_SCALE_1X},spineEndListener:function(a){},spineCompleteListener:function(a,b){var c=this.spAnimationState_getCurrent(this.m_skeleton.getState(),a),animationName=c&&c.animation?c.animation.name:0;"finish"==animationName?this.m_scene_mode==SCENE_MODE.WATCH&&this.m_watch_status==WATCH_STATUS.FINISH&&(this.m_is_2x_speed&&this.speed2XChange(),0==USE_HSCENE_WATCH_MODE&&(this.m_2x_speed_btns[0].setVisible(!1),this.m_2x_speed_btns[1].setVisible(!1))):-1!=animationName.indexOf("between")&&this.m_scene_mode==SCENE_MODE.NORMAL&&this.m_script_type==SCRIPT_TYPE.ANIMATION&&this.m_script_index<this.m_animation_script_list.length&&this.startLoveContentsAnimationScript()},spineEventListener:function(a,b){this.spAnimationState_getCurrent(this.m_skeleton.getState(),a);var c=b.data.name;if("mosaic_size"==this.tolowerCase(c)&&null!=this.m_stencil&&null!=this.m_stencil&&null!=b.stringValue){var d=b.stringValue.split(",");if(2==d.length){var e=d[0],height=d[1];this.m_stencil.setPreferredSize(cc.size(e*this.mosaicSize,height*this.mosaicSize))}var f=b.floatValue;this.m_stencil.setRotation(-f)}},is_resource_ready:function(){return this.m_script_type==SCRIPT_TYPE.SCRIPT||null!=this.m_skeleton},resourceLoadingStart:function(){this.m_script_type==SCRIPT_TYPE.ANIMATION?this.startLoveContentsAnimationScript():this.m_script_type==SCRIPT_TYPE.SCRIPT&&this.startLoveContentsScript()},resourceLoading:function(c){if(this.m_resource_list.length<=0&&0==this.m_b_create){MasterManager.getInstance();var d=MasterTable.getInstance().get_LoveCgByGnrlId(this.m_gnrl_id);0!=d.bg_type&&this.m_env_effect_bg.setTexture(RES_CDN_DEFULT+"hscene_bg/"+d.bg_type+".png"),this.m_b_create=!0,this.createCommonLayout(),this.createWatchLayout()}if(this.m_resource_list.length<=0&&this.is_resource_ready()&&0==this.m_loading_modal_layer.m_is_update)return this.scheduleUpdate(),this.m_is_update=!0,this.scheduleOnce(this.resourceLoadingStart,3),void this.unschedule(this.resourceLoading);var e=ccSize(this),rd=this.m_resource_list[0];if(null!=rd&&null!=rd){switch(rd._resource_type){case ResourceType.RT_VOICE:var f=rd.path;resourceLoader(f,function(){this.m_resource_list.shift(),f=null}.bind(this));break;case ResourceType.RT_SKELETON2:this.m_resource_list.shift(),(h=[]).push(rd.bone),h.push(rd.atlas),h.push(rd.bg),resourceLoader(h,function(){h=null}.bind(this));break;case ResourceType.RT_SKELETON:this.m_resource_list.shift(),(h=[]).push(rd.bone),h.push(rd.atlas);for(var g=0;g<rd.png.length;g++)h.push(rd.png[g]);null!=rd.bg&&h.push(rd.bg),resourceLoader(h,function(){var a=this.readJsonSpine(rd.bone);this.m_skeleton_bg=cc.Sprite.create(),this.m_skeleton_bg.setPosition(.5*e.width,.5*e.height),this.m_script_body_layer.addChild(this.m_skeleton_bg,0),this.m_skeleton_bg.setVisible(!1),null!=rd.bg&&this.m_skeleton_bg.setTexture(rd.bg),this.m_skeleton=new sp.SkeletonAnimation(a,rd.atlas,.89,!0),this.m_skeleton.setPosition(.5*e.width,.5*e.height),this.m_skeleton.setEventListener(this.spineEventListener.bind(this)),this.m_skeleton.setEndListener(this.spineEndListener.bind(this)),this.m_skeleton.setCompleteListener(this.spineCompleteListener.bind(this)),this.m_skeleton.setStartListener(this.spineStartListener.bind(this)),this.m_script_body_layer.addChild(this.m_skeleton,2),this.m_skeleton.setVisible(!1);for(var b=this.m_skeleton._skeleton.data.animations.length,ani=this.m_skeleton._skeleton.data.animations,is_exist_loop=!1,i=0;i<b;i++){for(var k=0;k<b;k++)ani[i].name==ani[k].name!=1&&this.m_skeleton.setMix(ani[i].name,ani[k].name,.4);"loop"==ani[i].name==0&&(is_exist_loop=!0)}is_exist_loop&&this.m_skeleton.setAnimation(1,"loop",!0),this.createMosaicStencil(),h=a=ani=b=null}.bind(this));break;case ResourceType.RT_IMAGE:var h;(h=[]).push(rd.png),resourceLoader(h,function(){this.m_resource_list.shift(),h=null}.bind(this));break;case ResourceType.RT_TEXTURE:this.m_resource_list.shift()}this.m_loading_modal_layer.is_show()&&this.m_loading_modal_layer.addCompleteLoadedResource()}else this.m_loading_modal_layer.is_show()&&this.m_loading_modal_layer.addCompleteLoadedResource()},showLoadingLayer:function(){this.m_loading_modal_layer.is_show()||this.m_loading_modal_layer.show()},hideLoadingLayer:function(){this.m_loading_modal_layer.is_show()&&this.m_loading_modal_layer.hide();var a=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/BGM_love_loop.mp3";a.m_bgmPath!=path&&(a.stopBackgroundMusic(),a.playBackgroundMusic(path,!0)),this.m_btn_container.setVisible(!0)},setSceneMode:function(a){if(this.m_script_type==SCRIPT_TYPE.ANIMATION){this.m_scene_mode==SCENE_MODE.NORMAL&&(this.m_screen_mosaic_visible=!0),this.m_scene_mode=a,this.m_scene_mode==SCENE_MODE.WATCH&&(this.m_watch_status=WATCH_STATUS.PHASE);var b=AudioEngine.getInstance();b.stopEffectsAll(),b.releaseResourceEffects(),this.screenChangeMode(MODE_CHNAGE_TIME)}},screenChangeMode:function(a){this.m_blink_layer.isRunning()&&(this.m_blink_layer.stopAllActions(),this.m_blink_layer.setVisible(!1)),this.m_blink_layer.setVisible(!0),this.m_blink_layer.setOpacity(0),this.m_blink_layer.setColor(cc.color.WHITE);var b=new cc.FadeIn(a),cb=new cc.CallFunc(this.cbScreenChangeMode.bind(this)),seq=new cc.Sequence(b,cb);this.m_blink_layer.runAction(seq)},cbScreenChangeMode:function(){this.m_screen_mosaic_visible=!1,this.m_blink_layer.isRunning()&&(this.m_blink_layer.stopAllActions(),this.m_blink_layer.setVisible(!1)),this.m_blink_layer.setVisible(!0),this.m_blink_layer.setOpacity(255),this.m_blink_layer.setColor(cc.color.WHITE);var a=new cc.FadeOut(MODE_CHANGE_CLEAN_TIME);this.m_blink_layer.runAction(a),this.setStatus(STATUS_LOVE_CG.NONE),this.m_show_btn.setVisible(!1),this.m_btn_container.setVisible(!1),this.m_bg_frame.setVisible(!1),this.m_loop_ui_container.setVisible(!0),this.m_script_bg.setVisible(!1),this.m_left_body.setVisible(!1),this.m_middle_body.setVisible(!1),this.m_right_body.setVisible(!1),this.m_left_mask.setVisible(!0),this.m_right_mask.setVisible(!0),null!=this.m_env_effect_bg&&this.m_env_effect_bg.setVisible(!0),null!=this.m_back_particle&&this.m_back_particle.setVisible(!0),null!=this.m_front_particle&&this.m_front_particle.setVisible(!0),this.watchPhase()},showSkipCheck:function(){this.m_box.is_show()&&this.m_box.hide(!1);var b=MasterManager.getInstance().get_General(this.m_gnrl_id);this.m_box.setTitle("メニュー選択"),453!=b.gnrl_group?(this.m_box.setText("ご褒美イベントシーンを終了してゲームへ戻りますか。"),this.m_box.setText("\n"),this.m_box.setText("鑑賞モードとはアニメーションをループで"),this.m_box.setText("\n"),this.m_box.setText("再生し続ける事が出来るモードです。")):(this.m_box.setText("交流イベントシーンを終了してゲームに戻りますか？"),this.m_box.setText("\n")),this.m_box.addButtonInfo(new MessageButtonInfo("戻る",MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo("終了する",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(a){MainObserver.getInstance().postNotification(sceneStr[scene_LoveContentsCGScene],Contents_Skip)},0,"hscene_skip"),this.m_box.hide(!1)}.bind(this))),453!=b.gnrl_group&&this.m_box.addButtonInfo(new MessageButtonInfo("鑑賞モード",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.setSceneMode(SCENE_MODE.WATCH),this.m_box.hide(!1)}.bind(this))),this.m_box.show()},speed2XChange:function(){this.m_is_2x_speed=!this.m_is_2x_speed,0==USE_HSCENE_WATCH_MODE&&(this.m_2x_speed_btns[0].setVisible(!this.m_is_2x_speed),this.m_2x_speed_btns[1].setVisible(this.m_is_2x_speed)),this.m_ff_icon.setVisible(this.m_is_2x_speed),this.m_2x_effect.setVisible(this.m_is_2x_speed);var a=this.m_skeleton.getState().tracks[0];this.m_is_2x_speed?a.timeScale=HSCENE_TIME_SCALE_2X:a.timeScale=HSCENE_TIME_SCALE_1X,this.m_watch_status==WATCH_STATUS.PHASE&&this.playVoicePhase()},playVoicePhase:function(){var a=this.getMoaningVoice();if(""!=a){var b=AudioEngine.getInstance();b.stopEffectsAll(),b.stopVoiceAll(),b.playVoice(RES_CDN_SOUND+SND_TYPE+"voice_etc/"+a,!0)}},watchPhase:function(){if(this.m_is_hide_mosaic=!1,USE_HSCENE_WATCH_MODE)this.m_love_watch_mode_index=0,this.playWatchMode();else{MasterManager.getInstance();var b=MasterTable.getInstance().get_LoveCgByGnrlId(this.m_gnrl_id);null!=this.m_stencil&&null!=this.m_stencil&&this.m_stencil.setPreferredSize(cc.size(b.mosaic_w*this.mosaicSize,b.mosaic_h*this.mosaicSize)),this.m_skeleton_bg.setVisible(!0),this.m_skeleton.setVisible(!0),this.m_skeleton.setAnimation(0,b.watch_mode_animation,!0),this.scheduleOnce(function(a){this.playVoicePhase()}.bind(this),.5,"play_voice_phase")}this.m_finish_btn.setVisible(!0),0==USE_HSCENE_WATCH_MODE?(this.m_2x_speed_btns[0].setVisible(!0),this.m_2x_speed_btns[1].setVisible(!1)):(this.m_watch_mode_counting.setVisible(!0),this.m_left_arrow_btn.setVisible(!0),this.m_right_arrow_btn.setVisible(!0))},watchFinish:function(){if(this.m_watch_status==WATCH_STATUS.PHASE){MasterManager.getInstance();var a=MasterTable.getInstance().get_LoveCgByGnrlId(this.m_gnrl_id);null!=this.m_stencil&&null!=this.m_stencil&&this.m_stencil.setPreferredSize(cc.size(a.mosaic_w*this.mosaicSize,a.mosaic_h*this.mosaicSize)),this.m_skeleton.setAnimation(0,"finish",!1),this.m_skeleton.addAnimation(0,"after",!0);var b=AudioEngine.getInstance(),voice=this.getFinishVoice();""!=voice?(b.stopEffectsAll(),b.stopVoiceAll(),b.playVoice(RES_CDN_SOUND+SND_TYPE+"voice_love/"+voice,!1)):(b.stopEffectsAll(),b.stopVoiceAll()),this.m_watch_status=WATCH_STATUS.FINISH,this.m_finish_btn.setVisible(!1),USE_HSCENE_WATCH_MODE&&(this.m_watch_mode_counting.setVisible(!1),this.m_left_arrow_btn.setVisible(!1),this.m_right_arrow_btn.setVisible(!1))}},openOption:function(){this.m_scene_mode==SCENE_MODE.NORMAL&&this.setStatus(STATUS_LOVE_CG.NONE),MainObserver.getInstance().postNotification(sceneStr[scene_LoveContentsCGScene],NOTIFY_MENU_OPTION)},getFinishVoice:function(){for(var a="",idx=0;idx<this.m_animation_script_list.length;idx++){var s=this.m_animation_script_list[idx];if("finish"==s.animation&&""!=s.voice&&"0"!=s.voice){a=s.voice;break}s=null}return""!=a&&(a+=".mp3"),a},getMoaningVoice:function(){var a="",voice_list=MasterTable.getInstance().get_Voice(this.m_gnrl_id,13,0);return a=voice_list.voice,voice_list.duration,""!=a&&(a+=".mp3"),a},ORDER_ASC_LOVE_STORY_NUM_ASC:function(l,r){return l.order_number<r.order_number},ORDER_ASC_LOVE_ANIMATION_STORY_NUM_ASC:function(l,r){return l.order_number<r.order_number},skipScriptAndShowPhase:function(){for(var i=this.m_script_index;i<this.m_animation_script_list.length;i++){var s=this.m_animation_script_list.at(i);if(""!=s.animation&&"0"!=s.animation){this.m_script_index=i;break}}this.setFastForward(STATUS_LOVE_CG.NONE),this.startLoveContentsAnimationScript()},watchModeLeft:function(){this.m_love_watch_mode_index--,this.m_love_watch_mode_index<0&&(this.m_love_watch_mode_index=0),this.playWatchMode()},watchModeRight:function(){this.m_love_watch_mode_index++,this.m_love_watch_mode_index>this.m_love_watch_mode_list.size()-1&&(this.m_love_watch_mode_index=this.m_love_watch_mode_list.size()-1),this.playWatchMode()},playWatchMode:function(){var b=this.m_love_watch_mode_list.at(this.m_love_watch_mode_index);if(this.m_skeleton.setVisible(!0),this.m_skeleton.setAnimation(0,b.animation,!0),this.scheduleOnce(function(a){this.playVoicePhase()},.5,"play_voice_phase"),this.m_watch_mode_counting.setString(cmString("%d/%d",this.m_love_watch_mode_index+1,this.m_love_watch_mode_list.size())),this.m_love_watch_mode_index<=0?(this.m_left_arrow_btn.setEnabled(!1),this.m_right_arrow_btn.setEnabled(!0)):this.m_love_watch_mode_index>=this.m_love_watch_mode_list.length-1?(this.m_left_arrow_btn.setEnabled(!0),this.m_right_arrow_btn.setEnabled(!1)):(this.m_left_arrow_btn.setEnabled(!0),this.m_right_arrow_btn.setEnabled(!0)),!USE_POLYGON_MOSAIC||null==this.m_polygon_stencil){var c=MasterTable.getInstance().get_LoveCgByGnrlId(this.m_gnrl_id);null!=this.m_stencil&&this.m_stencil.setPreferredSize(cc.size(c.mosaic_w,c.mosaic_h))}},readJsonSpine:function(a){var b=RS_STR_HEX_KEY.split("."),set=String.fromCharCode(52);this.m_enc_load=a,this.m_enc_strng=cc.loader.getRes(a);var c=this.decrypt_love(this.m_enc_strng,b[4]+set);try{return c}finally{set=c=null}},decrypt_love:function(a,b){for(var c,inValue,outValue,cryptTable=RS_CRY_HEX_KEY,cryptLength=new Number(cryptTable.length-1),escape=!1,output="",arNumberPw=new Array,pwLength=b.length,inLength=a.length,pwIndex=0;pwIndex<pwLength;pwIndex++)arNumberPw[pwIndex]=cryptTable.indexOf(b.charAt(pwIndex));var d=0;for(pwIndex=0;d<inLength;d++,pwIndex++)pwLength<=pwIndex&&(pwIndex=0),c=a.charAt(d),-1==(inValue=cryptTable.indexOf(c))?outValue=c:escape?(inValue==cryptLength?(outValue=lineFeed,inValue=-1):"'"==c?(outValue=doubleQuote,inValue=-1):inValue+=cryptLength,escape=!1):inValue==cryptLength&&(escape=!0,pwIndex--,outValue="",inValue=-1),-1!=inValue&&(outValue=cryptTable.charAt(arNumberPw[pwIndex]^inValue)),output+=outValue;return output}}),AchievementService=function(){var m;function AchievementService(){}return AchievementService.prototype.loadUserAchievement=function(a){a},AchievementService.prototype.getUserAchievement=function(a){for(var b=[],m_user_achivement=NetService().getUserAchievementList(),keys=m_user_achivement.keys(),keys_length=keys.length,mt=MasterManager.getInstance(),idx=0;idx<keys_length;idx++)if(m_user_achivement.at(keys[idx]).achv_type==a){var c={achv_type:0,achv_id:0,new_yn:0,complete_yn:0,bonus_complete_yn:0,complete_popup_yn:0,complete_count:0,achv_name:"",content:"",bonus_type:0,bonus_count:0,next_achv_id:0,key_id:0,shortcuts_id:0,achv_cmplt_type:0,count:0,complete_name:0};c.achv_type=m_user_achivement.at(keys[idx]).achv_type,c.achv_id=m_user_achivement.at(keys[idx]).achv_id,c.new_yn=m_user_achivement.at(keys[idx]).new_yn,c.complete_yn=m_user_achivement.at(keys[idx]).complete_yn,c.bonus_complete_yn=m_user_achivement.at(keys[idx]).bonus_complete_yn,c.complete_popup_yn=m_user_achivement.at(keys[idx]).complete_popup_yn,c.complete_count=m_user_achivement.at(keys[idx]).complete_count;var d=mt.get_Achivement(c.achv_id);c.shortcuts_id=d.shortcuts_id;var e=mt.get_AchivementCompleteBonus(c.achv_id);c.bonus_type=e.bonus_type,c.bonus_count=e.bonus_count,c.next_achv_id=e.next_achv_id,c.key_id=e.key_id;var f=mt.get_AchivementCompleteCondition(c.achv_id);c.achv_cmplt_type=f.achv_cmplt_type,c.achv_cmplt_type==AchvCompType_UserLevel?c.count=1:c.achv_cmplt_type==AchvCompType_StoryClear?c.count=1:c.count=f.count;var g=mt.get_AchivementCompleteType(c.achv_cmplt_type);c.complete_name=g.name;var h=mt.get_BonusType(c.bonus_type);if(c.bonus_name=h.name,c.bonus_type==BONUS_TYPE_NAMING){h=mt.get_Naming(c.key_id);c.bonus_name=h.name;var i=mt.get_NamingType(h.naming_type);c.bonus_name=h.name+"("+i.name+")"}else{h=mt.get_BonusType(c.bonus_type);c.bonus_name=h.name}c.achv_type==ACHIEVEMENT_SEQ||c.achv_type==ACHIEVEMENT_NAMING||c.achv_type==ACHIEVEMENT_EVENTDUNGEON||c.achv_type==ACHIEVEMENT_EVENTDUNGEON_2ND||c.achv_type==ACHIEVEMENT_EVENTDUNGEON_3RD||c.achv_type==ACHIEVEMENT_RAID_BOSS||c.achv_type==ACHIEVEMENT_BEGINNER?c.achv_type==ACHIEVEMENT_BEGINNER&&0==c.next_achv_id?b.push(c):"n"==c.bonus_complete_yn&&b.push(c):b.push(c)}return b},AchievementService.prototype.getUserAchievementEventDungeon=function(a,b){var c=[],m_user_achivement=NetService().getUserAchievementList(),keys=m_user_achivement.keys(),keys_length=keys.length,user_achivement=[],idx=0;for(idx=0;idx<keys_length;idx++){var d=$.extend({},m_user_achivement.at(keys[idx]));m_user_achivement.at(keys[idx]).achv_type==a&&user_achivement.push(d)}var e=user_achivement.length;for(idx=0;idx<e;idx++){var f={achv_type:0,achv_id:0,new_yn:0,complete_yn:0,bonus_complete_yn:0,complete_popup_yn:0,complete_count:0,achv_name:"",content:"",bonus_type:0,bonus_count:0,next_achv_id:0,key_id:0,shortcuts_id:0,achv_cmplt_type:0,count:0,complete_name:0};if(MasterManager.getInstance().get_AchivementEventDungeonInfo(user_achivement[idx].achv_id).event_dungeon_period_idx==b){f.achv_type=user_achivement[idx].achv_type,f.achv_id=user_achivement[idx].achv_id,f.new_yn=user_achivement[idx].new_yn,f.complete_yn=user_achivement[idx].complete_yn,f.bonus_complete_yn=user_achivement[idx].bonus_complete_yn,f.complete_popup_yn=user_achivement[idx].complete_popup_yn,f.complete_count=user_achivement[idx].complete_count;var g=MasterManager.getInstance().get_Achivement(f.achv_id);f.shortcuts_id=g.shortcuts_id;var h=MasterManager.getInstance().get_AchivementCompleteBonus(f.achv_id);f.bonus_type=h.bonus_type,f.bonus_count=h.bonus_count,f.next_achv_id=h.next_achv_id,f.key_id=h.key_id;var i=MasterManager.getInstance().get_AchivementCompleteCondition(f.achv_id);f.achv_cmplt_type=i.achv_cmplt_type,f.achv_cmplt_type==AchvCompType_UserLevel?f.count=1:f.achv_cmplt_type==AchvCompType_StoryClear?f.count=1:f.count=i.count;var j=MasterManager.getInstance(),achv_cmplt_type=MasterManager.getInstance().get_AchivementCompleteType(f.achv_cmplt_type);f.complete_name=achv_cmplt_type.name;var k=null;if(f.bonus_type==BONUS_TYPE_NAMING){k=j.get_Naming(f.key_id),f.bonus_name=k.name;var l=j.get_NamingType(k.naming_type);f.bonus_name="("+l.name+")"}else k=j.get_BonusType(f.bonus_type),f.bonus_name=k.name;f.achv_type==ACHIEVEMENT_SEQ||f.achv_type==ACHIEVEMENT_NAMING||f.achv_type==ACHIEVEMENT_EVENTDUNGEON||f.achv_type==ACHIEVEMENT_EVENTDUNGEON_2ND||f.achv_type==ACHIEVEMENT_EVENTDUNGEON_3RD||f.achv_type==ACHIEVEMENT_RAID_BOSS?"n"==f.bonus_complete_yn&&c.push(f):c.push(f)}}return c},AchievementService.prototype.getUserAchivementInfo=function(a){for(var b=NetService().getUserAchievementList(),keys=b.keys(),keys_length=keys.length,idx=0;idx<keys_length&&b.at(keys[idx]).achv_id!=a;idx++);var c={achv_type:0,achv_id:0,new_yn:0,complete_yn:0,bonus_complete_yn:0,complete_popup_yn:0,complete_count:0,achv_name:"",content:"",bonus_type:0,bonus_count:0,next_achv_id:0,key_id:0,shortcuts_id:0,achv_cmplt_type:0,count:0,complete_name:0};c.achv_type=b.at(keys[idx]).achv_type,c.achv_id=b.at(keys[idx]).achv_id,c.new_yn=b.at(keys[idx]).new_yn,c.complete_yn=b.at(keys[idx]).complete_yn,c.bonus_complete_yn=b.at(keys[idx]).bonus_complete_yn,c.complete_popup_yn=b.at(keys[idx]).complete_popup_yn,c.complete_count=b.at(keys[idx]).complete_count;var d=MasterManager.getInstance().get_Achivement(c.achv_id);c.shortcuts_id=d.shortcuts_id;var e=MasterManager.getInstance().get_AchivementCompleteBonus(c.achv_id);c.bonus_type=e.bonus_type,c.bonus_count=e.bonus_count,c.next_achv_id=e.next_achv_id;var f=MasterManager.getInstance().get_AchivementCompleteCondition(c.achv_id);c.achv_cmplt_type=f.achv_cmplt_type,c.count=f.count;var g=MasterManager.getInstance().get_AchivementCompleteType(c.achv_cmplt_type);c.complete_name=g.name;var h=MasterManager.getInstance().get_BonusType(c.bonus_type);return c.bonus_name=h,c},AchievementService.prototype.getUserAchievementCompleteCount=function(a,b){for(var c=0,m_user_achivement=NetService().getUserAchievementList(),keys=m_user_achivement.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++){if(m_user_achivement.at(keys[idx]).achv_type==a&&"y"==m_user_achivement.at(keys[idx]).complete_yn&&"n"==m_user_achivement.at(keys[idx]).bonus_complete_yn)if(null!=b)MasterManager.getInstance().get_AchivementEventDungeonInfo(m_user_achivement.at(keys[idx]).achv_id).event_dungeon_period_idx==b&&c++;else c++}return c},AchievementService.prototype.isNewCompleteAchievement=function(){for(var a=0,m_user_achivement=NetService().getUserAchievementList(),keys=m_user_achivement.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++)if((m_user_achivement.at(keys[idx]).achv_type<ACHIEVEMENT_EVENTDUNGEON||m_user_achivement.at(keys[idx]).achv_type>ACHIEVEMENT_EVENTDUNGEON_3RD)&&"y"==m_user_achivement.at(keys[idx]).complete_yn&&"n"==m_user_achivement.at(keys[idx]).bonus_complete_yn){a++;break}return a},AchievementService.prototype.isNewCompleteAchievementEventDungeon=function(a){for(var b=NetService().getUserAchievementList(),is_new=!1,mt=MasterManager.getInstance(),ed_service=EventDungeonService.getInstance(),first_half_period_idx=(mt.get_EventDungeonPeriod(a),ed_service.getEventDungeonFirstHalfPeriodIdx(a)),middle_period_idx=ed_service.getEventDungeonMiddleHalfPeriodIdx(a),second_half_period_idx=ed_service.getEventDungeonSecondHalfPeriodIdx(a),keys=b.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++)if(b.at(keys[idx]).achv_type>=ACHIEVEMENT_EVENTDUNGEON&&b.at(keys[idx]).achv_type<=ACHIEVEMENT_EVENTDUNGEON_3RD&&"y"==b.at(keys[idx]).complete_yn&&"n"==b.at(keys[idx]).bonus_complete_yn){var c=mt.get_AchivementEventDungeonInfo(b.at(keys[idx]).achv_id);if(c.event_dungeon_period_idx==first_half_period_idx){is_new=!0;break}if(c.event_dungeon_period_idx==middle_period_idx){is_new=!0;break}if(c.event_dungeon_period_idx==second_half_period_idx){is_new=!0;break}}return is_new},AchievementService.prototype.isNewCompleteAchievementByType=function(a){for(var b=!1,m_user_achivement=NetService().getUserAchievementList(),keys=m_user_achivement.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++)m_user_achivement.at(keys[idx]).achv_type==a&&"y"==m_user_achivement.at(keys[idx]).complete_yn&&"n"==m_user_achivement.at(keys[idx]).bonus_complete_yn&&(b=!0);return b},AchievementService.prototype.getAchvType=function(a){var b=MasterManager.getInstance().get_Achivement(a);return null==b?0:b.achv_type},AchievementService.prototype.getValidAchvEventDungeonInfo=function(a){MasterManager.getInstance().get_AchivementEventDungeonInfo(a);return 0},AchievementService.prototype.getEventDungeonGroupPeriodCount=function(b){var c,mt=MasterManager.getInstance(),period=mt.get_EventDungeonPeriod(b),event_list=mt.get_All_EventDungeonPeriod().filter(function(a){if(a.event_dungeon_group_idx==period.event_dungeon_group_idx)return!0});return null==event_list&&(event_list=[]),c=event_list.length,event_list=null,c},AchievementService.prototype.checkAchievementPeriod=function(c){var d=!1,now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),nn=moment(now).valueOf();return null!=MasterManager.getInstance().get_All_AchievementPeriod().find(function(a){var b=moment(a.beg_dt).valueOf(),end_dt=moment(a.end_dt).valueOf();if(a.achv_type==c&&b<=nn&&nn<=end_dt)return!0})&&(d=!0),d},{getInstance:function(){return void 0===m&&(m=new AchievementService),m}}}();GreatWallService=function(){function GreatWallService(){return{getCurrentGreatWallPeriodIdx:function(){var a=MasterTable.getInstance().get_GreatWallDungeonPeriodList(),great_wall_dungeon_period_idx=0,n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf();for(var c in a){var p=a[c],bt=moment(p.begin_dt),et=moment(p.end_dt),b=bt.valueOf(),e=et.valueOf();if(b<=n&&n<=e){great_wall_dungeon_period_idx=p.great_wall_dungeon_period_idx;break}}return a=null,great_wall_dungeon_period_idx},getGreatWallDungeon:function(b,c,e,f){var m=MasterManager.getInstance();if(0!=b){m.get_GreatWallDungeonPeriod(b);var s=BattleService.getInstance(),d=m.get_GreatWallDungeon(e,c);f.great_wall_dungeon=d,f.great_wall_dungeon_idx=d.great_wall_dungeon_idx,f.great_wall_dungeon_group_idx=d.great_wall_dungeon_group_idx,f.great_wall_dungeon_step=d.step,f.stage_npc=new Map,s.getMasterGreatWallStepStageNpc(d.great_wall_dungeon_idx,d.great_wall_dungeon_group_idx,f);var g=NetService().get_great_wall_dungeon_list().dungeon_list,found=g.findIndex(function(a){return a.great_wall_dungeon_idx==f.great_wall_dungeon_idx&&a.great_wall_dungeon_group_idx==f.great_wall_dungeon_group_idx});if(-1!=found){var h=g[found];f.is_first_clear="y"==h.first_clear_yn,f.is_complete="y"==h.complete_yn,f.is_retry="y"==h.retry_yn;var i=f.stage_npc.at(f.current_stage);if(f.is_complete)for(var j=0;j<i.length;j++){(k=i[j]).is_dead=!0,k.remain_hp_rate=0}else for(i=f.stage_npc.at(f.current_stage),j=0;j<i.length;j++){var k=i[j],n_found=h.npc_list.findIndex(function(n){return n.position==k.position});-1!=n_found?(k.remain_hp_rate=h.npc_list[n_found].remain_hp_rate,k.is_dead="y"==h.npc_list[n_found].dead_yn):k.remain_hp_rate=1e4}}else f.is_first_clear=!1,f.is_complete=!1;g=null}},getGreatWallDungeonList:function(b,c,e){var m=MasterTable.getInstance();NetService().getGreatWallDungeonInfo();if(0!=b){for(var f=MasterManager.getInstance().get_GreatWallDungeonPeriod(b),dungeon_list=m.get_GreatWallDungeonList(c),s=BattleService.getInstance(),is_first_enable=!1,complete_count=0,i=0;i<dungeon_list.length;i++){var d=dungeon_list.at(i);if(d.step<=f.max_step){var g={};g.stage_npc=new Map,g.current_stage=1,g.great_wall_dungeon_idx=0,g.is_complete=!1,g.is_open_prev_dungeon=!1,g.is_enable=!1,s.getMasterGreatWallStepStageNpc(d.great_wall_dungeon_idx,d.great_wall_dungeon_group_idx,g);var h=NetService().get_great_wall_dungeon_list().dungeon_list,found=h.findIndex(function(a){return a.great_wall_dungeon_idx==g.great_wall_dungeon_idx&&a.great_wall_dungeon_group_idx==g.great_wall_dungeon_group_idx});if(-1!=found){var j=h[found];if(g.is_first_clear="y"==j.first_clear_yn,g.is_complete="y"==j.complete_yn,g.is_retry="y"==j.retry_yn,g.is_complete){for(var k=g.stage_npc.at(g.current_stage),npc_idx=0;npc_idx<k.length;npc_idx++){(l=k[npc_idx]).is_dead=!0,l.remain_hp_rate=0}complete_count++}else for(k=g.stage_npc.at(g.current_stage),npc_idx=0;npc_idx<k.length;npc_idx++){var l=k[npc_idx],n_found=j.npc_list.findIndex(function(n){return n.position==l.position});-1!=n_found?(l.remain_hp_rate=j.npc_list[n_found].remain_hp_rate,l.is_dead="y"==j.npc_list[n_found].dead_yn):l.remain_hp_rate=1e4}g.is_complete||is_first_enable||(is_first_enable=!0,g.is_enable=!0)}else g.is_first_clear=!1,g.is_complete=!1,g.is_complete||is_first_enable||(is_first_enable=!0,g.is_enable=!0);e.push_back(g)}}!is_first_enable&&0<e.size()&&f.max_step!=complete_count&&(is_first_enable=e.at(0).is_enable=!0),dungeon_list=null}},getGreatWallDungeonStepBonusList:function(a,b,c){for(var d=MasterManager.getInstance().get_GreatWallDungeonPeriod(a),dungeon_list=MasterTable.getInstance().get_GreatWallDungeonList(b),list=[],i=0;i<dungeon_list.size();i++){var e=dungeon_list.at(i);if(e.step<=d.max_step&&e.step==c){list=MasterTable.getInstance().get_GreatWallDungeonBonusItemList(e.great_wall_dungeon_bonus_idx);break}}return dungeon_list=null,list},getGreatWallDungeonBonusList:function(a,b){for(var m=MasterTable.getInstance(),period=MasterManager.getInstance().get_GreatWallDungeonPeriod(a),dungeon_list=m.get_GreatWallDungeonList(b),list=[],i=(NetService().getGreatWallDungeonInfo(),0);i<dungeon_list.length;i++){var c=dungeon_list.at(i);if(c.step<=period.max_step){var e=MasterTable.getInstance().get_GreatWallDungeonBonusItemList(c.great_wall_dungeon_bonus_idx),reward={bonus_list:[]};reward.great_wall_dungeon_bonus_item_idx=c.great_wall_dungeon_bonus_idx,reward.bonus_list.clear(),reward.is_rewarded=!1,reward.bonus_list=e,reward.step=c.step;var f=NetService().get_great_wall_dungeon_list().dungeon_list,found=f.findIndex(function(d){return d.great_wall_dungeon_idx==c.great_wall_dungeon_idx&&d.great_wall_dungeon_group_idx==c.great_wall_dungeon_group_idx});-1!=found&&"y"==f[found].first_clear_yn&&(reward.is_rewarded=!0),list.push_back(reward)}}return list},getGreatWallTroopsGeneralList:function(a){var b=[],greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return b;var c=greatWallDungeonInfo.troops_list.length;if(isUndefined(a))for(var i=0;i<c;i++)for(var d=(t=greatWallDungeonInfo.troops_list[i]).troops_generls.length,j=0;j<d;j++){var g=t.troops_generls[j],tt={};tt.gnrl_id=g.gnrl_id,tt.gnrl_num=g.gnrl_num,tt.troops_num=g.troops_num,tt.pos_type=g.position,tt.is_leader="y"==g.leader_yn,b.push_back(tt)}else for(i=0;i<c;i++){var t;if((t=greatWallDungeonInfo.troops_list[i]).troops_num==a)for(d=t.troops_generls.length,j=0;j<d;j++){g=t.troops_generls[j];var e={};e.gnrl_id=g.gnrl_id,e.gnrl_num=g.gnrl_num,e.troops_num=g.troops_num,e.pos_type=g.position,e.is_leader="y"==g.leader_yn,b.push_back(e)}}return b},removeCampUsingGnrlCheck:function(b){return b.filter(function(a){return!a.using_in_camp})},removeMaterialGnrlCheck:function(b){return b.filter(function(a){return 1==a.gnrl_type||3==a.gnrl_type})},getGreatWallTroopsFormationInfo:function(a){for(var b={},great_troops_list=NetService().get_great_wall_troops_info().troops_list,len=great_troops_list.length,i=0;i<len;i++){var t=great_troops_list[i];if(t.troops_num==a){b=MasterManager.getInstance().get_BattleFormation(t.formation_id);break}}return great_troops_list=null,b},getGreatWallTroopsCost:function(a){var b=0,m=MasterManager.getInstance(),greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return 0;for(var c=greatWallDungeonInfo.troops_list.length,i=0;i<c;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==a)for(var d=t.troops_generls.length,j=0;j<d;j++){var g=t.troops_generls[j];b+=m.get_General(g.gnrl_id).cost}}return b},getGreatWallTroopsTotalCost:function(a){var b=0,greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return 1;for(var c=greatWallDungeonInfo.troops_list.length,i=0;i<c;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==a){b=t;break}}return b},getGreatWallTroopsGeneralCount:function(a){var b=0,greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return 0;for(var c=greatWallDungeonInfo.troops_list.length,i=0;i<c;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==a)for(var d=t.troops_generls.length,j=0;j<d;j++)b++}return b},isExistGeneralInGreatWallTroops:function(a,b){var c=!1,greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return 0;for(var d=greatWallDungeonInfo.troops_list.length,i=0;i<d;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==a)for(var e=t.troops_generls.length,j=0;j<e;j++){if(t.troops_generls[j].gnrl_num==b){c=!0;break}}}return c},isExistGeneralInGreatWallPosType:function(a,b){var c=!1,greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return 1;for(var d=greatWallDungeonInfo.troops_list.length,i=0;i<d;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==a)for(var e=t.troops_generls.length,j=0;j<e;j++){if(t.troops_generls[j].position==b){c=!0;break}}}return c},isSameGeneralInGreatWallTroops:function(a,b,c){var d=!1,m=MasterManager.getInstance(),t_g=m.get_General(c.gnrl_id),greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return 1;for(var e=greatWallDungeonInfo.troops_list.length,i=0;i<e;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==a)for(var f=t.troops_generls.length,j=0;j<f;j++){var g=t.troops_generls[j];if(g.position!=b){var h=m.get_General(g.gnrl_id);t_g.gnrl_group==h.gnrl_group&&c.gnrl_num!=g.gnrl_num&&(d=!0,b=g.position)}}}return{result:d,pos:b}},isSameGeneralInGreatWallTroops2:function(a,b,c){var d=!1,m=db.MasterTable.getInstance(),t_g=m.get_General(b.gnrl_id),greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return 1;for(var e=greatWallDungeonInfo.troops_list.length,i=0;i<e;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==a)for(var f=t.troops_generls.length,j=0;j<f;j++){var g=t.troops_generls[j],gg=m.get_General(g.gnrl_id);if(t_g.gnrl_group==gg.gnrl_group&&b.gnrl_num!=g.gnrl_num){d=!0,g.position;break}}}return d},getGreatWallGeneralInTroops:function(a,b,c){for(var d=0;d<NetService().get_great_wall_troops_info().troops_list.length;d++){for(var t=NetService().get_great_wall_troops_info().troops_list[d],j=0;j<t.troops_generls.length;j++){var g=t.troops_generls[j];if(g.gnrl_id==a.gnrl_id&&g.gnrl_num==a.gnrl_num)return t.troops_num,g.position,!0}return!1}},checkGreatWallTroopsPosition:function(a){var b=!1,greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return 1;for(var c=greatWallDungeonInfo.troops_list.length,i=0;i<c;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==a.troops_num)for(var d=t.troops_generls.length,j=0;j<d;j++){var g=t.troops_generls[j];if(g.gnrl_num==a.gnrl_num&&g.position==a.pos_type){b=!0;break}}}return b},isCostOver:function(a,b){var c=!1,totalCost=this.getGreatWallTroopsTotalCost(b),cost=0,m=MasterManager.getInstance(),greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return!1;for(var d=greatWallDungeonInfo.troops_list.length,i=0;i<d;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==b)for(var e=t.troops_generls.length,j=0;j<e;j++){var g=t.troops_generls[j];g.position!=a.pos_type&&g.gnrl_num!=a.gnrl_num&&(cost+=m.get_General(g.gnrl_id).cost)}}return(cost+=m.get_General(a.gnrl_id).cost)>totalCost.cost&&(c=!0),c},getDelGeneralNumInGreatWallTroops:function(a,b){var c={gnrl_id:0,gnrl_num:0},greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return c.gnrl_id=0,c.gnrl_num=0,c;for(var d=greatWallDungeonInfo.troops_list.length,i=0;i<d;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==a)for(var e=t.troops_generls.length,j=0;j<e;j++){if((g=t.troops_generls[j]).position==b){c.gnrl_id=g.gnrl_id,c.gnrl_num=g.gnrl_num;break}}}var f=!1;for(i=0;i<d;i++)if(t.troops_num!=a){e=t.troops_generls.length;for(j=0;j<e;j++){var g;if((g=t.troops_generls[j]).gnrl_num==c.gnrl_num&&g.gnrl_id==c.gnrl_id){f=!0;break}}}return f&&(c.gnrl_id=0,c.gnrl_num=0),c},getGreatWallTroopsGeneral:function(a,b){var c=$.extend({},db.UserGeneralTroops),is_exist=!1,greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return!1;for(var d=greatWallDungeonInfo.troops_list.length,i=0;i<d;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==a){for(var e=t.troops_generls.length,j=0;j<e;j++){var g=t.troops_generls[j];if(g.position==b){c.gnrl_id=g.gnrl_id,c.gnrl_num=g.gnrl_num,c.troops_num=g.troops_num,c.pos_type=g.position,c.is_leader="y"==g.leader_yn,is_exist=!0;break}}if(is_exist)break}}return c},isEnableReleasePartInGeneral:function(a){var b=!0,greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.partin_generals)return!0;for(var c=greatWallDungeonInfo.partin_generals.length,i=0;i<c;i++){var g=greatWallDungeonInfo.partin_generals[i];if(g.gnrl_id==a.gnrl_id&&g.gnrl_num==a.gnrl_num&&"y"==g.battle_start_yn){b=!1;break}}return b},checkGreatWallDungeonPartInGenerals:function(a){var m=MasterManager.getInstance(),gs=GeneralService.getInstance(),great_wall_dungeon_period_idx=this.getCurrentGreatWallPeriodIdx();if(0!=great_wall_dungeon_period_idx){var b=m.get_GreatWallDungeonPeriod(great_wall_dungeon_period_idx),greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.partin_generals)return!0;greatWallDungeonInfo.partin_generals.length;for(var c=a.length,i=0;i<c;i++){var g=a[i],partin_list=greatWallDungeonInfo.partin_generals,found=partin_list.findIndex(function(p){return g.gnrl_id==p.gnrl_id&&g.gnrl_num==p.gnrl_num});if(g.remain_hp_rate=1e4,g.remain_skill_count=0,g.max_skill_count=0,g.is_dead=!1,g.is_battle_start=!1,g.is_force_release=!1,-1!=found){g.remain_hp_rate=partin_list[found].remain_hp_rate,g.remain_skill_count=partin_list[found].remain_skill_count,g.max_skill_count=partin_list[found].max_skill_count,g.is_dead="y"==partin_list[found].dead_yn,g.is_battle_start="y"==partin_list[found].battle_start_yn,g.is_force_release="y"==partin_list[found].drop_yn,g.using_in_great_wall_troops=!0;var d=new db.UserGeneralKey;d.gnrl_id=g.gnrl_id,d.gnrl_num=g.gnrl_num,this.getGreatWallGeneralInTroops(d,g.gw_troops_num,g.gw_position)}else{var e=MasterTable.getInstance().get_GreatWallGeneralSkillLimitCount(b.great_wall_dungeon_group_idx,g.gnrl_group);g.max_skill_count=e,g.remain_skill_count=e,g.gw_troops_num=0,g.gw_position=0,g.remain_hp_rate=1e4}g.max_hp=gs.getMaxHPGeneral(g)}}},checkGreatWallDungeonPartInGeneral:function(g){var m=MasterManager.getInstance(),gs=GeneralService.getInstance(),great_wall_dungeon_period_idx=this.getCurrentGreatWallPeriodIdx();if(0!=great_wall_dungeon_period_idx){var a=m.get_GreatWallDungeonPeriod(great_wall_dungeon_period_idx),user_partin_generals=NetService().get_great_wall_troops_info().partin_generals,found=user_partin_generals.findIndex(function(p){return g.gnrl_id==p.gnrl_id&&g.gnrl_num==p.gnrl_num});if(g.remain_hp_rate=1e4,g.remain_skill_count=0,g.max_skill_count=0,g.is_dead=!1,g.is_battle_start=!1,g.is_force_release=!1,-1!=found){var b=user_partin_generals[found];g.remain_hp_rate=b.remain_hp_rate,g.remain_skill_count=b.remain_skill_count,g.max_skill_count=b.max_skill_count,g.is_dead="y"==b.dead_yn,g.is_battle_start="y"==b.battle_start_yn,g.is_force_release="y"==b.drop_yn,g.using_in_great_wall_troops=!0;var c={};c.gnrl_id=g.gnrl_id,c.gnrl_num=g.gnrl_num,this.getGreatWallGeneralInTroops(c,g.gw_troops_num,g.gw_position)}else{var d=MasterTable.getInstance().get_GreatWallGeneralSkillLimitCount(a.great_wall_dungeon_group_idx,g.gnrl_group);g.max_skill_count=d,g.remain_skill_count=d,g.gw_troops_num=0,g.gw_position=0,g.remain_hp_rate=1e4}g.max_hp=gs.getMaxHPGeneral(g)}},getGreatWallTroopsGenerals:function(b,c){c.clear();for(var d=NetService().getUserGeneral([]),service=BattleService.getInstance(),troops_list=NetService().get_great_wall_troops_info().troops_list,idx=0;idx<troops_list.length;idx++){var t=troops_list[idx];if(t.troops_num==b)for(var e=0;e<t.troops_generls.length;e++){var g=t.troops_generls[e],gnrl=$.extend({},database.BattleGeneral);gnrl.gnrl_id=g.gnrl_id,gnrl.gnrl_num=g.gnrl_num,gnrl.position=g.position,gnrl.is_zoom="y"==g.leader_yn;var f;if(-1!=(f=d.findIndex(function(a){return g.gnrl_id==a.gnrl_id&&g.gnrl_num==a.gnrl_num}))){var h=d[f];gnrl.gnrl_level=h.gnrl_level,gnrl.exp=h.gnrl_exp,gnrl.love_level=h.love_level,gnrl.love_exp=h.love_exp,gnrl.limit_step_id=h.limit_step_id,gnrl.display_class=h.display_class;var i=MasterManager.getInstance().get_General(gnrl.gnrl_id);gnrl.base_attk=i.attk,gnrl.base_def=i.def,gnrl.base_hp=i.hp,gnrl.base_sp=i.sp,gnrl.base_cri_prcnt=i.cri_percent,gnrl.base_cri_ratio=i.cri_ratio,gnrl.base_guard_rate=i.guard_rate,gnrl.base_guard_decrease=i.guard_value;var j=-1,partin_generals=NetService().get_great_wall_troops_info().partin_generals;Array.isArray(partin_generals)&&-1!=(j=partin_generals.findIndex(function(p){return gnrl.gnrl_id==p.gnrl_id&&gnrl.gnrl_num==p.gnrl_num}))&&(gnrl.remain_skill_count=partin_generals[j].remain_skill_count,gnrl.remain_hp_rate=partin_generals[j].remain_hp_rate,gnrl.is_dead="y"==partin_generals[j].dead_yn,gnrl.is_force_release="y"==partin_generals[j].drop_yn,gnrl.max_skill_count=partin_generals[j].max_skill_count),service.getMasterGeneral(gnrl),service.getEquipmentOptions(gnrl)}c.push_back(gnrl)}}troops_list=d=null}}}var o;return{getInstance:function(){return void 0===o&&(o=new GreatWallService),o}}}();var BattleService=function(){function BattleService(){}var M;return BattleService.prototype.ORDER_DESC_BATTLE_POSITION=function(a,b){return a.position<b.position},BattleService.prototype.setRaidGenernalData=function(a,b,c){var m=MasterManager.getInstance();a.gnrl_id=b.gnrl_id,this.getMasterGeneral(a),a.gnrl_level=c.level,a.general.attk=c.attk,a.general.def=c.def,a.general.hp=c.hp,a.general.sp=c.sp,a.general.cri_percent=c.cri_percent,a.general.cri_ratio=c.cri_ratio,a.general.guard_rate=c.guard_rate,a.general.guard_value=c.guard_value,a.cri_resist=c.cri_resist,a.skill_attk_damage_inc=c.skill_attk_damage_inc,a.skill_def_damage_dec=c.skill_def_damage_dec,a.adv_attk_damage_inc=c.adv_attk_damage_inc,a.adv_def_damage_dec=c.adv_def_damage_dec,0!=b.element_type&&(a.general.element_type=b.element_type),a.active_skill=[];for(var i=0;i<3;i++){var d=0;switch(i){case 0:d=b.active_skill_id_1;break;case 1:d=b.active_skill_id_2;break;case 2:d=b.active_skill_id_3}if(99999!=d){var e,active_skill={gnrl_num:0,skill_id:0,skill:{},skill_action:{},onetime_effects:[],durability_effects:[],is_teamcooltime:0,skill_charge_count:0};m.get_ActiveSkill(a.general.active_skill_id);e=m.get_NpcActiveSkill(d),active_skill.skill.active_skill_id=e.active_skill_id,active_skill.skill.action_id=e.action_id,active_skill.skill.content=e.content,active_skill.skill.cool_time=e.cool_time,active_skill.skill.pre_cool_time=e.pre_cool_time,active_skill.skill.invoke_type1=e.invoke_type1,active_skill.skill.onetime_effect=e.onetime_effect,active_skill.skill.invoke_type2=e.invoke_type2,active_skill.skill.durability_effect=e.durability_effect,active_skill.skill.name=e.name,active_skill.skill.skill_group=e.skill_group;var f;f=m.get_ActionImplementation(active_skill.skill.action_id),this.convertActionImpl(f,active_skill.skill_action);var g=new database.BattleOneTimeEffect;g.gnrl_id=a.gnrl_id;var h=active_skill.skill.onetime_effect.split(",");for(var j in h){if(0<(o=h[j])){var k=m.get_OnetimeEffect(o);this.convertOneTimeEffect(k,g),active_skill.onetime_effects.push(g)}}var l={};l.gnrl_id=a.general.gnrl_id,l.end_effects=[],l.tick_effects=[];var n=active_skill.skill.durability_effect.split(",");for(j=0;j<n.length;j++){var o;if(0<(o=n[j])){k=m.get_OnetimeEffect(o);if(k=m.get_DurabilityEffect(o),this.convertDurabilityEffect(k,l),0<k.dura_end_effect){var p=m.get_OnetimeEffect(k.dura_end_effect),end_one=new database.BattleOneTimeEffect;end_one.gnrl_id=a.gnrl_id,this.convertOneTimeEffect(p,end_one),l.end_effects.push(end_one)}if(0<k.repeat_effect){p=m.get_OnetimeEffect(k.repeat_effect);var q=new database.BattleOneTimeEffect;q.gnrl_id=a.gnrl_id,this.convertOneTimeEffect(p,q),l.tick_effects.push(q)}0<l.effect_id&&active_skill.durability_effects.push(l)}}a.active_skill.push(active_skill)}}a.resistance=[];var r={};r.trans_type=database.BattleEffectTrans.Stun,r.resist_value=c.stun_resist,a.resistance.push(r);var t={};t.trans_type=database.BattleEffectTrans.Silence,t.resist_value=c.silence_resist,a.resistance.push(t);var u={};u.trans_type=database.BattleEffectTrans.New_Poison_Dmg_Rate,u.resist_value=c.poison_resist,a.resistance.push(u);var v={};v.trans_type=database.BattleEffectTrans.Damage_Reduce,v.resist_value=c.electric_resist,a.resistance.push(v);var w={};w.trans_type=database.BattleEffectTrans.Freeze,w.resist_value=c.frozen_resist,a.resistance.push(w);var x={};x.trans_type=database.BattleEffectTrans.After_Recv_Damage_Inc_Rate,x.resist_value=c.burn_resist,a.resistance.push(x);var y={};y.trans_type=database.BattleEffectTrans.Wound_Obstruct_Heal,y.resist_value=c.wound_resist,a.resistance.push_back(y);var z={};z.trans_type=database.BattleEffectTrans.Blind_Darkness,z.resist_value=c.blind_resist,a.resistance.push_back(z);var A=MasterTable.getInstance().get_NpcSpecialAbilities(b.raid_boss_info_idx);a.special_ability=[];for(var s=0;s<A.length;s++){var B={};B.special_ability_id=A[s].special_ability_id,B.special_ability_type=A[s].special_ability_type,B.ability_value=A[s].ability_value,a.special_ability.push(B)}},BattleService.prototype.setNpcGeneralData=function(n,o){var m=MasterManager.getInstance();if(null==o){if(0==n.npc_id)return;o=m.get_NpcGeneral(n.npc_id)}if(n.gnrl_id=o.gnrl_id,n.npc_id=o.npc_id,this.getMasterGeneral(n),n.gnrl_level=o.npc_level,n.general.attk=o.attk,n.general.def=o.def,n.general.hp=o.hp,n.general.sp=o.sp,n.general.cri_percent=o.cri_percent,n.general.cri_ratio=o.cri_attk_damage,n.general.guard_rate=o.guard_rate,n.general.guard_value=o.guard_value,n.cri_resist=o.cri_resist,n.skill_attk_damage_inc=o.skill_attk_damage_inc,n.skill_def_damage_dec=o.skill_def_damage_dec,n.adv_attk_damage_inc=o.adv_attk_damage_inc,n.adv_def_damage_dec=o.adv_def_damage_dec,n.npc_attk_dmg_type=o.attk_dmg_type,n.npc_attk_dmg_min_value=o.attk_dmg_min_value,0!=o.element_type&&(n.general.element_type=o.element_type),99999!=o.active_skill_id){var p=new database.BattleSkill;p.gnrl_num=0,p.skill_id=0,p.skill={},p.skill_action={},p.onetime_effects=[],p.durability_effects=[],n.active_skill=[];var q,origin_skill=m.get_ActiveSkill(n.general.active_skill_id);q=m.get_NpcActiveSkill(o.active_skill_id),p.skill.active_skill_id=q.active_skill_id,p.skill.action_id=q.action_id,p.skill.content=q.content,p.skill.cool_time=q.cool_time,p.skill.pre_cool_time=q.pre_cool_time,p.skill.invoke_type1=q.invoke_type1,p.skill.onetime_effect=q.onetime_effect,p.skill.invoke_type2=q.invoke_type2,p.skill.durability_effect=q.durability_effect,p.skill.name=q.name,p.skill.skill_group=q.skill_group,p.skill.enemy_skill_type=origin_skill.enemy_skill_type;var t=m.get_ActionImplementation(p.skill.action_id);this.convertActionImpl(t,p.skill_action);for(var u=p.skill.onetime_effect.split(","),one_id=0;one_id<u.length;one_id++){if(0<(x=u[one_id])){var v=new database.BattleOneTimeEffect;v.gnrl_id=n.gnrl_id,null!=(y=m.get_OnetimeEffect(x)).num&&this.convertOneTimeEffect(y,v),0<v.effect_id&&p.onetime_effects.push(v)}}for(var w=p.skill.durability_effect.split(","),dur_id=0;dur_id<w.length;dur_id++){var x;if(0<(x=w[dur_id])){var y,durability=new database.BattleDurabilityEffect;if(durability.gnrl_id=n.general.gnrl_id,null!=(y=m.get_DurabilityEffect(x)).num){if(this.convertDurabilityEffect(y,durability),0<y.dura_end_effect){var z=m.get_OnetimeEffect(y.dura_end_effect),end_one=new database.BattleOneTimeEffect;end_one.gnrl_id=n.gnrl_id,this.convertOneTimeEffect(z,end_one),durability.end_effects.push(end_one)}if(0<y.repeat_effect){z=database.OnetimeEffect();z=m.get_OnetimeEffect(y.repeat_effect);var A=new database.BattleOneTimeEffect;A.gnrl_id=n.gnrl_id,this.convertOneTimeEffect(z,A),durability.tick_effects.push(A)}0<durability.effect_id&&p.durability_effects.push(durability)}}}p.cooltime=0,p.is_cooltime=!1,p.is_prepared=!1,p.is_teamcooltime=!1,p.team_cooltime=0,p.skill_charge_count=0,n.active_skill.push(p)}o.active_sub_skill_id.split(",").forEach(function(f){var g=parseInt(f);if(99999!=g&&0!=g){n.active_sub_skill.clear();var h=new database.BattleSubSkill;h.sub_skill_id=o.active_sub_skill_id;var i=m.get_NpcActiveSubSkill(g);h.sub_skill.active_sub_skill_id=g,h.sub_skill.action_id=i.action_id,h.sub_skill.onetime_effect=i.onetime_effect,h.sub_skill.durability_effect=i.durability_effect;var j=m.get_ActionImplementation(h.sub_skill.action_id);this.convertActionImpl(j,h.skill_action);var k=new database.BattleOneTimeEffect;k.gnrl_id=n.gnrl_id,h.sub_skill.onetime_effect.split(",").forEach(function(a){var b=1*a;if(0<b){var c=m.get_OnetimeEffect(b);this.convertOneTimeEffect(c,k),0<k.effect_id&&h.onetime_effects.push_back(k)}}.bind(this));var l=new database.BattleDurabilityEffect;l.gnrl_id=n.general.gnrl_id,h.sub_skill.durability_effect.split(",").forEach(function(a){var b=1*a;if(0<b){var c=m.get_DurabilityEffect(b);if(this.convertDurabilityEffect(c,l),0<c.dura_end_effect){var d=m.get_OnetimeEffect(c.dura_end_effect),end_one=new database.BattleOneTimeEffect;end_one.gnrl_id=n.gnrl_id,this.convertOneTimeEffect(d,end_one),l.end_effects.push_back(end_one)}if(0<c.repeat_effect){d=MasterManager.getInstance().get_OnetimeEffect(c.repeat_effect);var e=new database.BattleOneTimeEffect;e.gnrl_id=n.gnrl_id,this.convertOneTimeEffect(d,e),l.tick_effects.push_back(e)}0<l.effect_id&&h.durability_effects.push_back(l)}}.bind(this)),n.active_sub_skill.push_back(h)}}.bind(this));var B=MasterTable.getInstance().get_NpcResistances(o.npc_id);n.resistance=[];for(var r=0;r<B.length;r++){var C={};C.resistance_id=B[r].resistance_id,C.trans_type=B[r].trans_type,C.resist_value=B[r].resist_value,n.resistance.push(C)}var D=MasterTable.getInstance().get_NpcSpecialAbilities(o.npc_id);n.special_ability=[];for(var s=0;s<D.length;s++){var E={};E.special_ability_id=D[s].special_ability_id,E.special_ability_type=D[s].special_ability_type,E.ability_value=D[s].ability_value,n.special_ability.push(E)}},BattleService.prototype.convertActionImpl=function(a,b){b.action_id=a.action_id,b.range_style=a.attack_style,b.our_enemy=a.enemy_me_type,b.self_other=a.me_other_type,b.target_count=a.target_count,b.hit_count=a.attack_count,b.hit_sound=a.hit_sound,b.action_sound=a.action_sound,b.enemy_action_sound=a.enemy_action_sound,b.priority_position=a.priority_position,b.damages=[];try{if(null!=a.damage_shared)if(-1!=a.damage_shared.indexOf(","))for(var c=a.damage_shared.split(","),i=0;i<c.length;i++)b.damages.push(c[i]);else b.damages.push(a.damage_shared)}catch(e){}},BattleService.prototype.convertOneTimeEffect=function(g,a){if(a.effect_id=g.num,a.onetime_effect=g,a.our_enemy=g.self_other,a.input_ability_type=g.input_ability,a.output_ability_type=g.output_ability,a.value=g.value,a.sub_value=g.sub_value,a.element_trans_type=g.trans_element_type,a.element_value=g.element_value,a.stat_trans=g.stat_trans,a.element_type=g.element_type,a.element_type_value=g.element_type_value,a.force_type=g.force_type,a.force_type_value=g.force_type_value,a.fight_type=g.fight_type,a.fight_type_value=g.fight_type_value,a.hp_check_type=g.hp_check_type,a.hp_check_value=g.hp_check_value,a.hp_increase_value=g.hp_increase_value,a.rate=g.rate,a.max_value=g.max_value,a.target_boss_types=[],null!=g.stack_count_wanko&&null!=g.stack_count_wanko?a.stack_count_wanko=g.stack_count_wanko:a.stack_count_wanko=0,""!=g.target_boss_type&&"0"!=g.target_boss_type&&null!=g.target_boss_type)for(var b=g.target_boss_type.split(","),idx=0;idx<b.length;idx++){if(""!=(t=b[idx])){var c=parseInt(t);a.target_boss_types.push_back(c)}}if(""!=g.state_type&&"0"!=g.state_type&&null!=g.state_type&&null!=g.state_type){var d=g.state_type.split(",");for(idx=0;idx<d.length;idx++){var t;if(""!=(t=d[idx])){var e=parseInt(t);a.state_types.push_back(e)}}}},BattleService.prototype.convertDurabilityEffect=function(a,b){if(b.effect_id=a.num,b.durability=a,b.up_down=a.up_down,b.our_enemy=a.self_other,b.trans_type=a.stat_trans,b.value=a.value,b.percent=a._percent,b.duration=a.duration_time,b.tick=a._repeat,b.icon_name=a.icon_name,b.resist_trans_type=a.resist_trans_type,b.arm_service_type=a.arm_service_type,b.element_type=a.element_type,b.fight_type=a.fight_type,b.invoke_type=a.invoke_type,b.action_id=a.action_id,null!=b.action_id&&0!=b.action_id&&99999!=b.action_id){var c=MasterTable.getInstance().getMasterTable().get_ActionImplementation(b.action_id);this.convertActionImpl(c,b.action)}},BattleService.prototype.getFriendEquipmentOptions=function(a,g){MasterTable.getInstance();EquipmentService.getInstance().getFriendEquipentsOnGeneral(g,a.equipment_list);for(var b=new Map,idx=0;idx<g.equipments.length;idx++){var e=g.equipments[idx];if(0!=e.equip_group){for(var c=-1,keys=b.keys(),kdx=0;kdx<keys.length;kdx++){b.at(keys[kdx]);if(e.equip_group==keys[kdx]){c=keys[kdx];break}}if(-1!=c){var d=b.at(c);d+=1,b.insert(c,d)}else b.insert(e.equip_group,1)}}if(0<b.size())for(var f=0;f<b.length;f++){var h=b[f];if(1<h){var i=h;3<i&&(i=3);var j=MasterManager.getInstance().get_EquipmentGroup(f,i);0!=j.equip_group_idx&&g.set_equipment_effect.push(j)}}},BattleService.prototype.getWorldWarEquipmentOptions=function(g){MasterTable.getInstance();EquipmentService.getInstance().getEquipmentsOnWorldWarGeneral(g);for(var a=new Map,idx=0;idx<g.equipments.length;idx++){var e=g.equipments[idx];if(0!=e.equip_group){for(var b=-1,keys=a.keys(),kdx=0;kdx<keys.length;kdx++){a.at(keys[kdx]);if(e.equip_group==keys[kdx]){b=keys[kdx];break}}if(-1!=b){var c=a.at(b);c+=1,a.insert(b,c)}else a.insert(e.equip_group,1)}}if(0<a.size())for(var d=a.keys(),jdx=0;jdx<d.length;jdx++){var f=a.at(d[jdx]);if(1<f){var h=f;3<h&&(h=3);var i=MasterManager.getInstance().get_EquipmentGroup(d[jdx],h);null!=i&&0!=i.equip_group_idx&&g.set_equipment_effect.push(i)}}},BattleService.prototype.getEquipmentOptions=function(g){MasterTable.getInstance();EquipmentService.getInstance().getEquipmentsOnGeneral(g);for(var a=new Map,idx=0;idx<g.equipments.length;idx++){var e=g.equipments[idx];if(0!=e.equip_group){for(var b=-1,keys=a.keys(),kdx=0;kdx<keys.length;kdx++){a.at(keys[kdx]);if(e.equip_group==keys[kdx]){b=keys[kdx];break}}if(-1!=b){var c=a.at(b);c+=1,a.insert(b,c)}else a.insert(e.equip_group,1)}}if(0<a.size())for(var d=a.keys(),jdx=0;jdx<d.length;jdx++){var f=a.at(d[jdx]);if(1<f){var h=f;3<h&&(h=3);var i=MasterManager.getInstance().get_EquipmentGroup(d[jdx],h);null!=i&&0!=i.equip_group_idx&&g.set_equipment_effect.push(i)}}},BattleService.prototype.getMasterGeneral=function(g){var m=MasterTable.getInstance().getMasterTable();g.general=m.get_General(g.gnrl_id),g.attack_action={},g.attack2_action={},g.attack3_action={},g.active_skill=[],g.active_sub_skill=[],g.passive_skill=[],g.resistance=[],g.trans_passive_skill=[],g.evt_dungeon_buff=[],g.equipments=[],g.set_equipment_effect=[],g.special_ability=new Array;var t=m.get_ActionImplementation(g.general.action_id1);this.convertActionImpl(t,g.attack_action);var u=m.get_ActionImplementation(g.general.action_id2);if(this.convertActionImpl(u,g.attack2_action),99999!=g.general.action_id3){var v=m.get_ActionImplementation(g.general.action_id3);this.convertActionImpl(v,g.attack3_action)}if(g.general.active_skill_id){var w={gnrl_num:0,skill_id:0,cooltime:0,is_cooltime:!1,is_prepared:!1,is_teamcooltime:!1,team_cooltime:0,skill_charge_count:0};w.skill=m.get_ActiveSkill(g.general.active_skill_id),w.skill_action={},w.onetime_effects=[],w.durability_effects=[];var x=m.get_ActionImplementation(w.skill.action_id);this.convertActionImpl(x,w.skill_action);var y=[];null!=w.skill.onetime_effect&&(y=w.skill.onetime_effect.split(","));for(var z=0;z<y.length;z++){if(0<(D=y[z])){var A={},one_time=new database.BattleOneTimeEffect;one_time.gnrl_id=g.gnrl_id,A=m.get_OnetimeEffect(D),this.convertOneTimeEffect(A,one_time),0<one_time.effect_id&&w.onetime_effects.push(one_time)}}var B=new Array;null!=w.skill.durability_effect&&(B=w.skill.durability_effect.split(","));for(var C=0;C<B.length;C++){var D;if(0<(D=B[C]))if(null!=(A=m.get_DurabilityEffect(D)).num){var E=new database.BattleDurabilityEffect;if(E.gnrl_id=g.general.gnrl_id,this.convertDurabilityEffect(A,E),0<A.dura_end_effect){var F=m.get_OnetimeEffect(A.dura_end_effect),end_one=new database.BattleOneTimeEffect;end_one.gnrl_id=g.gnrl_id,this.convertOneTimeEffect(F,end_one);var G=$.extend({},end_one);E.end_effects.push(G)}if(0<A.repeat_effect){F=m.get_OnetimeEffect(A.repeat_effect);var H=new database.BattleOneTimeEffect;H.gnrl_id=g.gnrl_id,this.convertOneTimeEffect(F,H);var I=$.extend({},H);E.tick_effects.push(I)}if(0<E.effect_id){var J=$.extend({},E);w.durability_effects.push(J)}}}g.active_skill.push(w)}g.general.active_sub_skill_id.split(",").forEach(function(a){var b=parseInt(a);if(99999!=b&&0!=b){var c={};c.sub_skill_id=b,c.sub_skill=m.get_ActiveSubSkill(b),c.onetime_effects=[],c.durability_effects=[],c.skill_action={};var d=m.get_ActionImplementation(c.sub_skill.action_id);this.convertActionImpl(d,c.skill_action);for(var e=c.sub_skill.onetime_effect.split(","),z=0;z<e.length;z++){if(0<(j=e[z])){var f=m.get_OnetimeEffect(j),one_time=new database.BattleOneTimeEffect;one_time.gnrl_id=g.gnrl_id,this.convertOneTimeEffect(f,one_time),0<one_time.effect_id&&c.onetime_effects.push(one_time)}}var h=[];null!=c.sub_skill.durability_effect&&(h=c.sub_skill.durability_effect.split(","));for(var i=0;i<h.length;i++){var j;if(0<(j=h[i])){var k=new database.BattleDurabilityEffect;k.gnrl_id=g.general.gnrl_id;f=m.get_DurabilityEffect(j);if(k.end_effects=[],k.tick_effects=[],null!=f.num){if(this.convertDurabilityEffect(f,k),0<f.dura_end_effect){var l=m.get_OnetimeEffect(f.dura_end_effect),end_one=new database.BattleOneTimeEffect;end_one.gnrl_id=g.gnrl_id,this.convertOneTimeEffect(l,end_one);var n=$.extend({},end_one);k.end_effects.push(n)}if(0<f.repeat_effect){l=m.get_OnetimeEffect(f.repeat_effect);var o=new database.BattleOneTimeEffect;o.gnrl_id=g.gnrl_id,this.convertOneTimeEffect(l,o);var p=$.extend({},o);k.tick_effects.push(p)}if(0<k.effect_id){var q=$.extend({},k);c.durability_effects.push(q)}}}}g.active_sub_skill.push(c)}}.bind(this)),99999!=g.general.passive_skill_id&&0!=g.general.passive_skill_id&&g.passive_skill.push(m.get_PassiveSkillV2(g.general.passive_skill_id)),g.general.trans_passive_skill_id.split(",").forEach(function(a){var b=parseInt(a);if(0!=b&&99999!=b){var c={};if(c.trans_passive_skill_id=b,c.trans_passive=m.get_TransPassiveSkill(b),c.action=new database.BattleActionImpl,9==c.trans_passive.invoke_type1||9==c.trans_passive.invoke_type2){var d;d=m.get_ActionImplementation(c.trans_passive.action_id),this.convertActionImpl(d,c.action)}if(c.durability_effects=[],0!=c.trans_passive.onetime_effect){var e=new database.BattleOneTimeEffect;e.gnrl_id=g.gnrl_id,c.onetime_effects=[];for(var f=c.trans_passive.onetime_effect.split(","),idx=0;idx<f.length;idx++){var h=f[idx];if("0"!=h&&""!=h){var n=parseInt(h),oe=m.get_OnetimeEffect(n);this.convertOneTimeEffect(oe,e);var i=$.extend({},e);c.onetime_effects.push(i)}}}if(0!=c.trans_passive.durability_effect){var j=new database.BattleDurabilityEffect,dlist=c.trans_passive.durability_effect.split(",");for(idx=0;idx<dlist.length;idx++){var k=dlist[idx];if("0"!=k&&""!=k){n=parseInt(k);var l=m.get_DurabilityEffect(n);if(this.convertDurabilityEffect(l,j),0<l.dura_end_effect){var o=m.get_OnetimeEffect(l.dura_end_effect),end_one=new database.BattleOneTimeEffect;end_one.gnrl_id=g.gnrl_id,this.convertOneTimeEffect(o,end_one);var p=$.extend({},end_one);j.end_effects.push(p)}if(0<l.repeat_effect){o=m.get_OnetimeEffect(l.repeat_effect);var q=new database.BattleOneTimeEffect;q.gnrl_id=g.gnrl_id,this.convertOneTimeEffect(o,q);var r=$.extend({},q);j.tick_effects.push(r)}var s=$.extend({},j);c.durability_effects.push(s)}}j=null}c.reborn_count=0,c.full_charge_count=0,c.mild_rabbit_count=0,g.trans_passive_skill.push(c)}}.bind(this));for(var K=MasterTable.getInstance().get_GeneralResistances(g.gnrl_id),r=0;r<K.length;r++){var L={};L.resistance_id=K[r].resistance_id,L.trans_type=K[r].trans_type,L.resist_value=K[r].resist_value,g.resistance.push(L)}},BattleService.prototype.getMainMissionTaskListCheck=function(a,b){for(var m=MasterManager.getInstance(),t=BattleTable.getInstance(),task_list=MasterTable.getInstance().get_MainMissionTaskList(a),i=0;i<task_list.length;i++){var c={};c.main_mission_id=a,c.task_id=task_list[i].task_id,c.bonus_type=task_list[i].bonus_type,c.bonus_value=task_list[i].bonus_count,c.task=m.get_Task(task_list[i].task_id),c.task_type=m.get_TaskType(c.task.task_type),b.push(c)}t.upd_UserMissionTaskListCheck(b)},BattleService.prototype.getMasterGreatWallStepStageNpc=function(a,b,c){null==c&&(c={});var m=MasterManager.getInstance(),step=m.get_GreatWallDungeon(a,b);c.great_wall_dungeon=step,c.great_wall_dungeon_idx=a,c.great_wall_dungeon_group_idx=b,c.great_wall_dungeon_step=step.step,c.stage_count=1;for(var d=0,i=0;i<c.stage_count;i++){d=i+1;var e=m.get_GreatWallDungeonNpc(a,b,d),npc_list=[];if(0<e.npc1_id){var f=m.get_NpcGeneral(e.npc1_id);(g=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Head,g.is_zoom=0<e.npc1_size,g.npc_boss_type=e.npc1_size,g.battle_stage=e.battle_num,this.setNpcGeneralData(g,f),npc_list.push(g)}if(0<e.npc2_id){f=m.get_NpcGeneral(e.npc2_id);(g=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_1,g.is_zoom=0<e.npc2_size,g.npc_boss_type=e.npc2_size,g.battle_stage=e.battle_num,this.setNpcGeneralData(g,f),npc_list.push(g)}if(0<e.npc3_id){f=m.get_NpcGeneral(e.npc3_id);(g=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_2,g.is_zoom=0<e.npc3_size,g.npc_boss_type=e.npc3_size,g.battle_stage=e.battle_num,this.setNpcGeneralData(g,f),npc_list.push(g)}if(0<e.npc4_id){f=m.get_NpcGeneral(e.npc4_id);(g=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_1,g.is_zoom=0<e.npc4_size,g.npc_boss_type=e.npc4_size,g.battle_stage=e.battle_num,this.setNpcGeneralData(g,f),npc_list.push(g)}if(0<e.npc5_id){var g;f=m.get_NpcGeneral(e.npc5_id);(g=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_2,g.is_zoom=0<e.npc5_size,g.npc_boss_type=e.npc5_size,g.battle_stage=e.battle_num,this.setNpcGeneralData(g,f),npc_list.push(g)}0!=npc_list.length&&(npc_list.sort(function(l,r){return l.position-r.position}),c.stage_npc.insert(d,npc_list))}},BattleService.prototype.getMasterMussangStepStageNpc=function(a,b){var m=MasterManager.getInstance(),step=m.get_MussangStep(a);b.mussang_idx=a,b.mussang=step,b.mussang_step=step.mussang_step,b.mussang_type=step.mussang_type,b.stage_count=3;for(var i=0;i<b.stage_count;i++){var c=m.get_MussangNpc(a,i+1),npc_list=[];if(0<c.npc1_id){var d=m.get_NpcGeneral(c.npc1_id);(e=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Head,e.is_zoom=0<c.npc1_size,e.npc_boss_type=c.npc1_size,e.battle_stage=c.battle_num,this.setNpcGeneralData(e,d),npc_list.push(e)}if(0<c.npc2_id){d=m.get_NpcGeneral(c.npc2_id);(e=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_1,e.is_zoom=0<c.npc2_size,e.npc_boss_type=c.npc2_size,e.battle_stage=c.battle_num,this.setNpcGeneralData(e,d),npc_list.push(e)}if(0<c.npc3_id){d=m.get_NpcGeneral(c.npc3_id);(e=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_2,e.is_zoom=0<c.npc3_size,e.npc_boss_type=c.npc3_size,e.battle_stage=c.battle_num,this.setNpcGeneralData(e,d),npc_list.push(e)}if(0<c.npc4_id){d=m.get_NpcGeneral(c.npc4_id);(e=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_1,e.is_zoom=0<c.npc4_size,e.npc_boss_type=c.npc4_size,e.battle_stage=c.battle_num,this.setNpcGeneralData(e,d),npc_list.push(e)}if(0<c.npc5_id){var e;d=m.get_NpcGeneral(c.npc5_id);(e=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_2,e.is_zoom=0<c.npc5_size,e.npc_boss_type=c.npc5_size,e.battle_stage=c.battle_num,this.setNpcGeneralData(e,d),npc_list.push(e)}0!=npc_list.length&&(npc_list.sort(function(l,r){return l.position-r.position}),b.stage_npc.insert(c.battle_num,npc_list))}},BattleService.prototype.getMasterEventDungeonOnceADayNpcInfo=function(a){for(var m=MasterManager.getInstance(),s=0;s<a.stage_count;s++){for(var b=s+1,npc_list=a.stage_npc.at(b),idx=0;idx<npc_list.length;idx++){var c=npc_list[idx];if(0!=c.npc_id){var n=m.get_NpcGeneral(c.npc_id);this.setNpcGeneralData(c,n)}}a.stage_npc.insert(b,npc_list)}},BattleService.prototype.getMasterEventDungeonNpcInfo=function(a){for(var m=MasterManager.getInstance(),s=0;s<a.stage_count;s++){for(var b=s+1,npc_list=a.stage_npc.at(b),idx=0;idx<npc_list.length;idx++){var c=npc_list[idx];if(0!=c.npc_id){var n=m.get_NpcGeneral(c.npc_id);this.setNpcGeneralData(c,n)}}a.stage_npc.insert(b,npc_list)}},BattleService.prototype.getMasterWeeklyDungeonStageNpc=function(a){for(var m=MasterManager.getInstance(),s=0;s<a.stage_count;s++){for(var b=s+1,npc_list=a.stage_npc.at(b),idx=0;idx<npc_list.length;idx++){var c=npc_list[idx];if(0!=c.npc_id){var n=m.get_NpcGeneral(c.npc_id);this.setNpcGeneralData(c,n)}}a.stage_npc.insert(b,npc_list)}},BattleService.prototype.getMasterWeeklyDifficultyStageNpc=function(a){for(var m=MasterTable.getInstance().getMasterTable(),idx=0;idx<a.weekly_difficulty.length;idx++){var b=a.weekly_difficulty[idx];b.stage_count=3;for(var s=0;s<b.stage_count;s++){var c=s+1,stage=m.get_WeeklyDungeonNpc(b.weekly_difficulty.dungeon_idx,c);if(null==stage)break;var d,npc_list=[];if(0<stage.npc1_id)(d=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Head,d.is_zoom=0<stage.npc1_size,d.npc_boss_type=stage.npc1_size,d.battle_stage=c,d.npc_id=stage.npc1_id,npc_list.push(d);if(0<stage.npc2_id)(d=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_1,d.is_zoom=0<stage.npc2_size,d.npc_boss_type=stage.npc2_size,d.battle_stage=c,d.npc_id=stage.npc2_id,npc_list.push(d);if(0<stage.npc3_id)(d=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_2,d.is_zoom=0<stage.npc3_size,d.npc_boss_type=stage.npc3_size,d.battle_stage=c,d.npc_id=stage.npc3_id,npc_list.push(d);if(0<stage.npc4_id)(d=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_1,d.is_zoom=0<stage.npc4_size,d.npc_boss_type=stage.npc4_size,d.battle_stage=c,d.npc_id=stage.npc4_id,npc_list.push(d);if(0<stage.npc5_id)(d=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_2,d.is_zoom=0<stage.npc5_size,d.npc_boss_type=stage.npc5_size,d.npc_id=stage.npc5_id,d.battle_stage=c,npc_list.push(d);0!=npc_list.length?(npc_list.sort(function(l,r){return l.position-r.position}),b.stage_npc.insert(c,npc_list)):cc.log("dd")}}},BattleService.prototype.getMainMissionAndNpc=function(a,b){var m=MasterTable.getInstance().getMasterTable();b.main_mission_id=a,b.mission=m.get_MainMission(b.main_mission_id),b.drop_gnrl_list=[],b.stage_npc=new Map,b.task_list=[],this.getMainMissionInfo(a,b),0<b.mission.gnrl_id1&&b.drop_gnrl_list.push(b.mission.gnrl_id1),0<b.mission.gnrl_id2&&b.drop_gnrl_list.push(b.mission.gnrl_id2),0<b.mission.gnrl_id3&&b.drop_gnrl_list.push(b.mission.gnrl_id3),0<b.mission.gnrl_id4&&b.drop_gnrl_list.push(b.mission.gnrl_id4),0<b.mission.gnrl_id5&&b.drop_gnrl_list.push(b.mission.gnrl_id5),0<b.mission.gnrl_id6&&b.drop_gnrl_list.push(b.mission.gnrl_id6),b.stage_count=3;for(var c=null,i=1;i<=b.stage_count;i++){var d=i,npc_list=[],mission_npc=m.get_MainMissionNpc(a,d);if(null!=mission_npc){var e;if(0<mission_npc.npc1_id)c=null,c=m.get_NpcGeneral(mission_npc.npc1_id),(e=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Head,e.is_zoom=0<mission_npc.npc1_size,e.npc_boss_type=mission_npc.npc1_size,e.battle_stage=d,this.setNpcGeneralData(e,c),npc_list.push(e);if(0<mission_npc.npc2_id)c=null,c=m.get_NpcGeneral(mission_npc.npc2_id),(e=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_1,e.is_zoom=0<mission_npc.npc2_size,e.npc_boss_type=mission_npc.npc2_size,e.battle_stage=d,this.setNpcGeneralData(e,c),npc_list.push(e);if(0<mission_npc.npc3_id)c=null,c=m.get_NpcGeneral(mission_npc.npc3_id),(e=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_2,e.is_zoom=0<mission_npc.npc3_size,e.npc_boss_type=mission_npc.npc3_size,e.battle_stage=d,this.setNpcGeneralData(e,c),npc_list.push(e);if(0<mission_npc.npc4_id)c=null,c=m.get_NpcGeneral(mission_npc.npc4_id),(e=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_1,e.is_zoom=0<mission_npc.npc4_size,e.npc_boss_type=mission_npc.npc4_size,e.battle_stage=d,this.setNpcGeneralData(e,c),npc_list.push(e);if(0<mission_npc.npc5_id)c=null,c=m.get_NpcGeneral(mission_npc.npc5_id),(e=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_2,e.is_zoom=0<mission_npc.npc5_size,e.npc_boss_type=mission_npc.npc5_size,e.battle_stage=d,this.setNpcGeneralData(e,c),npc_list.push(e)}0!=npc_list.length&&(npc_list.sort(function(l,r){return r.position-l.position}),b.stage_npc.insert(d,npc_list))}},BattleService.prototype.getTroopsGenerals=function(a,b){var c=[],netService=new NetService;netService.getUserGeneral(c);for(var d=netService.getUserPartyGeneral(),keys=d.keys(),idx=0;idx<keys.length;idx++)if(d.at(keys[idx]).troops_num==a)for(var e in c)if(c[e].gnrl_id==d.at(keys[idx]).gnrl_id&&c[e].gnrl_num==d.at(keys[idx]).gnrl_num){var g=$.extend({},database.BattleGeneral);g.gnrl_id=c[e].gnrl_id,g.gnrl_num=c[e].gnrl_num,g.gnrl_level=c[e].gnrl_level,g.exp=c[e].gnrl_exp,g.castle_id=c[e].castle_id,g.love_level=c[e].love_level,g.love_exp=c[e].love_exp,g.limit_step_id=c[e].limit_step_id,g.display_class=c[e].display_class,g.is_zoom="y"==d.at(keys[idx]).leader_yn,g.position=d.at(keys[idx]).position,this.getMasterGeneral(g),this.getEquipmentOptions(g),b.push_back(g);break}return b},BattleService.prototype.getFriendGeneral=function(a,b){b.gnrl_id=a.gnrl_id,b.gnrl_level=a.gnrl_level,b.love_level=a.gnrl_love_level,b.limit_step_id=a.gnrl_limit_step_id,this.getMasterGeneral(b)},BattleService.prototype.getMainMissionInfo=function(a,b){var t=BattleTable.getInstance();b.task_list=[],t.sel_UserMissionInfo(a,b),BattleService.prototype.getMainMissionTaskListCheck(a,b.task_list)},BattleService.prototype.getAutoPlayCostGold=function(a,b){},BattleService.prototype.getMissionWinCount=function(a){return BattleTable.getInstance().getMissionWinCount(a)},BattleService.prototype.getMasterFxPartList=function(a,b,c){var d=[];d=MasterTable.getInstance().get_EffectDefinitionList(a,b,d);for(var f=[],i=0;i<d.length;i++){var e=d[i],p=new database.BattleFxPart;p.fx_part_id=e.num,p.gnrl_group=e.gnrl_group,p.gnrl_type=e.gnrl_type,p.fx_layer=e.layer,p.fx_atlas=RES_CDN_DEFULT+e.atlas+".atlas",p.fx_bone=RES_CDN_DEFULT+e.bone+".json",f.length=0,f=RES_CDN_DEFULT+e.textures.split(","),p.fx_pngs=[];for(var j=0;j<f.length;j++){var t=f[j];p.fx_pngs.push(t+".png")}p.fx_id=e.fx_id,p.velocity=e.speed,p.hit_point=e.hit_point,p.is_throwing_object=0!=e.projection,p.is_target_pos_use=0!=e.bone_target,p.is_bezier_use=0!=e.curved,p.curved_height=e.curved_hight,p.is_base_parent_target=0!=e.parent_target,p.is_used_flip=0!=e.flip,p.fx_sound=e.sound,p.is_loop=0!=e.is_loop,c.push(p),p=null}},BattleService.prototype.getMasterLoveStat=function(a,b){return MasterTable.getInstance().get_LoveStatItem(a,b).idx},BattleService.prototype.getMasterMissionBonusList=function(a){var t=BattleTable.getInstance(),mission=MasterTable.getInstance().getMasterTable().get_MainMission(a);return t.sel_MasterMissionBonusList(mission.main_mission_bonus_id)},BattleService.prototype.getMasterWeeklyDungeon=function(a){var m=MasterTable.getInstance(),t=BattleTable.getInstance();t.sel_MasterWeeklyDungeon(a);for(var b=0;b<a.length;b++)this.getMasterWeeklyDifficultyStageNpc(a[b]);t.del_UserWeeklyDungeonOpenTime(m_user_id);for(var i=0;i<a.length;i++)a[i].weekly_period=t.sel_userWeeklyDungeonPeriod(a[i].weekly_dungeon.weekly_idx,a[i].weekly_period),a[i].weekly_period=stable(a[i].weekly_period,function(l,r){if(l.begin_date.valueOf()<r.begin_date.valueOf())return 1});for(var c=(new NetService).get_Weekly_TaskList(),db_task_list=[],listIdx=0;listIdx<a.length;listIdx++)for(var d=0;d<a[listIdx].weekly_difficulty.length;d++){a[listIdx].weekly_difficulty[d].task_list.clear(),db_task_list=m.get_WeeklyDungeonTaskList(a[listIdx].weekly_difficulty[d].weekly_difficulty.dungeon_idx);for(i=0;i<db_task_list.length;i++){var e=MasterManager.getInstance().get_WeeklyDungeonTaskDefine(db_task_list[i].weekly_dungeon_task_define_idx),new_task=$.extend({},database.BattleWeeklyDungeonTask);new_task.dungeon_idx=a[listIdx].weekly_difficulty[d].weekly_difficulty.dungeon_idx,new_task.num=db_task_list[i].num,new_task.task=db_task_list[i],new_task.task_define=e;for(var f=!1,foundIdx=new_task.clear_count=0,j=0;j<c.length;j++)if(db_task_list[i].dungeon_idx==c[j].weekly_idx&&db_task_list[i].num==c[j].num){f=!0,foundIdx=j;break}new_task.is_complete=1==f&&(new_task.clear_count=c[foundIdx].count,"y"==c[foundIdx].complete_yn),a[listIdx].weekly_difficulty[d].task_list.push_back(new_task)}}},BattleService.prototype.convertBonusInfoInternal=function(a,b,c,d){a>=BONUS_TYPE_HWANDAN_1&&a<=BONUS_TYPE_HWANDAN_7||a==BONUS_TYPE_YUBI_RARE?(d.item_type=database.BattleGainItemType.Hwandan,d.item_id=a,d.item_count=b):a==BONUS_TYPE_YUNHEE_FIX?(d.item_type=database.BattleGainItemType.General,d.item_id=b,d.item_level=1):a==BONUS_TYPE_EVOLVE_STONE?(d.item_type=database.BattleGainItemType.EvolveStone,d.item_id=a,d.item_count=b):a>=BONUS_TYPE_ATTK_POINT&&a<=BONUS_TYPE_CRI_DMG_POINT?(d.item_type=database.BattleGainItemType.FormationPropertyPoint,d.item_id=a,d.item_count=b):a>=BONUS_TYPE_EVOLVE_MELEE&&a<=BONUS_TYPE_EVOLVE_ARCHER?(d.item_type=database.BattleGainItemType.ForceTypeEvolveMtrl,d.item_id=a,d.item_count=b):a>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&a<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE?(d.item_type=database.BattleGainItemType.ForceTypeEvolveMtrl,d.item_id=a,d.item_count=b):a>=BONUS_TYPE_EVOLVE_MELEE_LOW&&a<=BONUS_TYPE_EVOLVE_ARCHER_LOW?(d.item_type=database.BattleGainItemType.ForceTypeEvolveMtrl,d.item_id=a,d.item_count=b):a==BONUS_TYPE_EVOLVE_ORB?(d.item_type=database.BattleGainItemType.EvolveOrb,d.item_id=a,d.item_count=b):a>=BONUS_TYPE_LOVE_ITEM_MELEE&&a<=BONUS_TYPE_LOVE_ITEM_CAKE||a==BONUS_TYPE_YUBI_LOVE_ITEM||a==BONUS_TYPE_SUPER_CHOCO_CAKE?(d.item_type=database.BattleGainItemType.LoveItem,d.item_id=a,d.item_count=b):a==BONUS_TYPE_GOLD?(d.item_type=database.BattleGainItemType.Gold,d.item_id=a,d.item_count=b):a==BONUS_TYPE_JADE?(d.item_type=database.BattleGainItemType.Jade,d.item_id=a,d.item_count=b):a==BONUS_TYPE_HEART?(d.item_type=database.BattleGainItemType.Heart,d.item_id=a,d.item_count=b):a==BONUS_TYPE_EVENT_POINT?(d.item_type=database.BattleGainItemType.EventPoint,d.item_id=a,d.item_count=b):a>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&a<=BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND?(d.item_type=database.BattleGainItemType.CraftMtrl,d.item_id=a,d.item_count=b):a==BONUS_TYPE_EQUIPMENT?(d.item_type=database.BattleGainItemType.Equipment,d.item_id=b,d.item_count=c):a==BONUS_TYPE_EVENT_DUNGEON_SPECIAL_POINT?(d.item_type=database.BattleGainItemType.SpecialPoint,d.item_id=a,d.item_count=b):a>=BONUS_TYPE_JADE_RANDOM_BOX&&a<=BONUS_TYPE_CHRISTMAS_GIFT_BOX||a>=BONUS_TYPE_SWORD_ORB_RANDDOM_BOX&&a<=BONUS_TYPE_ARCHER_ORB_RANDDOM_BOX?(d.item_type=database.BattleGainItemType.RandomBox,d.item_id=a):a==BONUS_TYPE_JADE_RANDOM_BOX||a==BONUS_TYPE_GOLD_RANDOM_BOX||a==BONUS_TYPE_LOVE_ITEM_RANDOM_BOX||a==BONUS_TYPE_RARE_HWANDAN_RANDOM_BOX||a==BONUS_TYPE_EXP_CARD_RANDOM_BOX||a==BONUS_TYPE_CHRISTMAS_GIFT_BOX||a==BONUS_TYPE_SWORD_ORB_RANDDOM_BOX||a==BONUS_TYPE_SPEAR_ORB_RANDDOM_BOX||a==BONUS_TYPE_ARCHER_ORB_RANDDOM_BOX||a==BONUS_TYPE_FORMATION_PROPERTY_POINT_RANDOM_BOX||a==BONUS_TYPE_FORMATION_PROPERTY_POINT_GIFT_BOX||a==BONUS_TYPE_EQUIPMENT_EXP_BOX_1||a==BONUS_TYPE_EQUIPMENT_EXP_BOX_2||a==BONUS_TYPE_EQUIPMENT_EXP_BOX_3||a==BONUS_TYPE_EQUIPMENT_EXP_BOX_4?(d.item_type=database.BattleGainItemType.RandomBox,d.item_id=a):a==BONUS_TYPE_R_RARE_TYPE_ENGAGE||a==BONUS_TYPE_HR_RARE_TYPE_ENGAGE||a==BONUS_TYPE_SR_RARE_TYPE_ENGAGE||a==BONUS_TYPE_SSR_RARE_TYPE_SELECT||a==BONUS_TYPE_SR_OVER_GACHA_TICKET?(d.item_type=database.BattleGainItemType.RandomBox,d.item_id=a):a==BONUS_TYPE_SR_LIMIT_OVER_MTRL||a==BONUS_TYPE_SSR_LIMIT_OVER_MTRL?(d.item_type=database.BattleGainItemType.LimitOverMtrl,d.item_id=a):a==BONUS_TYPE_MAGIC_KEY_MTRL?(d.item_type=database.BattleGainItemType.MagicKeyPiece,d.item_id=a):a==BONUS_TYPE_NAMING?(d.item_type=database.BattleGainItemType.HeroNaming,d.item_id=a,d.item_level=b):(a>=BONUS_TYPE_CHRISTMAS_RIBBON&&a<=BONUS_TYPE_CHRISTMAS_SNOWMAN?d.item_type=database.BattleGainItemType.ETC:a>=BONUS_TYPE_REBIRTH_MTRL_TYPE_1&&a<=BONUS_TYPE_REBIRTH_MTRL_TYPE_7||a>=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1&&a<=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6?d.item_type=database.BattleGainItemType.RebirthMtrl:a==BONUS_TYPE_GREAT_WALL_TICKET?d.item_type=database.BattleGainItemType.GreatWallTicket:a==BONUS_TYPE_JADE_PIECE?d.item_type=database.BattleGainItemType.JadePiece:a==BONUS_TYPE_RAID_TICKET?d.item_type=database.BattleGainItemType.ETC:a==BONUS_TYPE_RAID_HELP_TICKET?d.item_type=database.BattleGainItemType.ETC:a==BONUS_TYPE_SKIP_TICKET?d.item_type=database.BattleGainItemType.SkipTicket:a==BONUS_TYPE_FORMATION_POINT||a==BONUS_TYPE_ATTK_POINT||a==BONUS_TYPE_DEF_POINT||a==BONUS_TYPE_HP_POINT||a==BONUS_TYPE_CRI_PRCNT_POINT||a==BONUS_TYPE_CRI_DMG_POINT?d.item_type=database.BattleGainItemType.FormationPropertyPoint:a==BONUS_TYPE_WORLD_WAR_UNIQUE_EQUIPMENT_TICKET?d.item_type=database.BattleGainItemType.ETC:a==BONUS_TYPE_SSR_GACHA_TICKET?d.item_type=database.BattleGainItemType.GachaTicket:d.item_type=database.BattleGainItemType.ETC,d.item_id=a,d.item_count=b)},BattleService.prototype.convertBonusInfo=function(a,b){this.convertBonusInfoInternal(a.bonus_type,a.min_value,a.max_value,b),a.bonus_type!=BONUS_TYPE_EQUIPMENT&&b.item_count<a.min_value&&(b.item_count=a.min_value)},BattleService.prototype.convertBonusInfoEventMussangBossRewardInfo=function(a,b){this.convertBonusInfoInternal(a.bonus_type,a.min_value,a.max_value,b)},BattleService.prototype.convertBonusInfoTower=function(a,b){this.convertBonusInfoInternal(a.bonus_type,a.min_value,a.max_value,b),a.bonus_type==BONUS_TYPE_YUNHEE_FIX||a.bonus_type==BONUS_TYPE_JIN_FIX?b.item_count=1:a.bonus_type!=BONUS_TYPE_EQUIPMENT&&a.bonus_type!=BONUS_TYPE_EQUIPMENT&&b.item_count<a.min_value&&(b.item_count=a.min_value)},BattleService.prototype.convertBonusInfo3=function(b,a){this.convertBonusInfoInternal(b.bonus_type,b.min_value,b.max_value,a),b.bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX?a.item_count=1:b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER||b.bonus_type==BONUS_TYPE_YUBI_EVOLVE_HIGH?(a.item_count=b.min_value,a.item_level=1):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE||b.bonus_type==BONUS_TYPE_YUBI_EVOLVE_MIDDLE?(a.item_count=b.min_value,a.item_level=1):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW||b.bonus_type==BONUS_TYPE_YUBI_EVOLVE_LOW?(a.item_count=b.min_value,a.item_level=1):b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE||b.bonus_type==BONUS_TYPE_YUBI_LOVE_ITEM||b.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE?(a.item_count=b.min_value,a.item_level=1):a.item_count=b.min_value},BattleService.prototype.changeEventDungeonCutinStage=function(c,d,e){var m=MasterManager.getInstance(),cutin_info=m.get_EventDungeonCutinInfo(d);if(0!=cutin_info.event_dungeon_cutin_info_idx){var f=[],evt_npc=m.get_EventDungeonCutinNpc(cutin_info.event_dungeon_cutin_npc_idx);if(0<evt_npc.npc1_id){var g=m.get_NpcGeneral(evt_npc.npc1_id);(h=$.extend({},database.BattleGeneral)).is_cutin_npc=!0,h.position=db.BattlePosition.Head,h.is_zoom=0!=evt_npc.npc1_size,h.npc_boss_type=evt_npc.npc1_size,h.battle_stage=c,this.setNpcGeneralData(h,g),f.push(h)}if(0<evt_npc.npc2_id){g=m.get_NpcGeneral(evt_npc.npc2_id);(h=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_1,h.is_zoom=0!=evt_npc.npc2_size,h.npc_boss_type=evt_npc.npc2_size,h.battle_stage=c,this.setNpcGeneralData(h,g),f.push(h)}if(0<evt_npc.npc3_id){g=m.get_NpcGeneral(evt_npc.npc3_id);(h=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_2,h.is_zoom=0!=evt_npc.npc3_size,h.npc_boss_type=evt_npc.npc3_size,h.battle_stage=c,this.setNpcGeneralData(h,g),f.push(h)}if(0<evt_npc.npc4_id){g=m.get_NpcGeneral(evt_npc.npc4_id);(h=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_1,h.is_zoom=0!=evt_npc.npc4_size,h.npc_boss_type=evt_npc.npc4_size,h.battle_stage=c,this.setNpcGeneralData(h,g),f.push(h)}if(0<evt_npc.npc5_id){var h;g=m.get_NpcGeneral(evt_npc.npc5_id);(h=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_2,h.is_zoom=0!=evt_npc.npc5_size,h.npc_boss_type=evt_npc.npc5_size,h.battle_stage=c,this.setNpcGeneralData(h,g),f.push(h)}0<f.length&&(f.sort(function(a,b){return a.position>b.position?1:a.position<b.position?-1:0}),e.insert(c,f))}},BattleService.prototype.getMasterEventDungeonStageNpc=function(c,d){var m=MasterManager.getInstance();d.stage_count=3;for(var e=[],b=0;b<d.stage_count;b++){var f,battle_num=b+1,evt_npc=m.get_EventDungeonNpc(c,battle_num);if(e=[],0<evt_npc.npc1_id)(f=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Head,f.is_zoom=0!=evt_npc.npc1_size,f.npc_boss_type=evt_npc.npc1_size,f.battle_stage=battle_num,f.npc_id=evt_npc.npc1_id,e.push(f);if(0<evt_npc.npc2_id)(f=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_1,f.is_zoom=0!=evt_npc.npc2_size,f.npc_boss_type=evt_npc.npc2_size,f.battle_stage=battle_num,f.npc_id=evt_npc.npc2_id,e.push(f);if(0<evt_npc.npc3_id)(f=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_2,f.is_zoom=0!=evt_npc.npc3_size,f.npc_boss_type=evt_npc.npc3_size,f.battle_stage=battle_num,f.npc_id=evt_npc.npc3_id,e.push(f);if(0<evt_npc.npc4_id)(f=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_1,f.is_zoom=0!=evt_npc.npc4_size,f.npc_boss_type=evt_npc.npc4_size,f.battle_stage=battle_num,f.npc_id=evt_npc.npc4_id,e.push(f);if(0<evt_npc.npc5_id)(f=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_2,f.is_zoom=0!=evt_npc.npc5_size,f.npc_boss_type=evt_npc.npc5_size,f.battle_stage=battle_num,f.npc_id=evt_npc.npc5_id,e.push(f);0<e.length&&(e.sort(function(a,b){return a.position>b.position?1:a.position<b.position?-1:0}),d.stage_npc.insert(battle_num,e))}},BattleService.prototype.getUserEventDungeonOnceADay=function(a,b,c){var t=BattleTable.getInstance();t.sel_MasterEventDungeonOnceADay(a,b,c),this.getMasterEventDungeonOnceADayStageNpc(b,c),t.sel_UserEventDungeonOnceADay(m_user_id,c)},BattleService.prototype.getMasterEventDungeonOnceADayStageNpc=function(c,d){var m=MasterManager.getInstance();d.stage_count=3;for(var e=[],b=0;b<d.stage_count;b++){var f,battle_num=b+1,evt_npc=m.get_EventDungeonOnceADayNpc(c,battle_num);if(e=[],0<evt_npc.npc1_id)(f=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Head,f.is_zoom=0!=evt_npc.npc1_size,f.npc_boss_type=evt_npc.npc1_size,f.battle_stage=battle_num,f.npc_id=evt_npc.npc1_id,e.push(f);if(0<evt_npc.npc2_id)(f=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_1,f.is_zoom=0!=evt_npc.npc2_size,f.npc_boss_type=evt_npc.npc2_size,f.battle_stage=battle_num,f.npc_id=evt_npc.npc2_id,e.push(f);if(0<evt_npc.npc3_id)(f=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_2,f.is_zoom=0!=evt_npc.npc3_size,f.npc_boss_type=evt_npc.npc3_size,f.battle_stage=battle_num,f.npc_id=evt_npc.npc3_id,e.push(f);if(0<evt_npc.npc4_id)(f=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_1,f.is_zoom=0!=evt_npc.npc4_size,f.npc_boss_type=evt_npc.npc4_size,f.battle_stage=battle_num,f.npc_id=evt_npc.npc4_id,e.push(f);if(0<evt_npc.npc5_id)(f=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_2,f.is_zoom=0!=evt_npc.npc5_size,f.npc_boss_type=evt_npc.npc5_size,f.battle_stage=battle_num,f.npc_id=evt_npc.npc5_id,e.push(f);0<e.length&&(e.sort(function(a,b){return a.position>b.position?1:a.position<b.position?-1:0}),d.stage_npc.insert(battle_num,e))}},BattleService.prototype.getUserEventDungeonOnceADayList=function(b,c){for(var t=BattleTable.getInstance(),list=t.sel_MasterEventDungeonOnceADAyList(b,c),idx=0;idx<list.length;idx++){var d=list[idx];this.getMasterEventDungeonOnceADayStageNpc(d.dungeon.event_dungeon_once_a_day_idx,d),0==d.dungeon.open_preview_dungeon_idx&&(d.is_open_pre_event_dungeon=!0)}t.sel_UserEventDungeonOnceADayList(m_user_id,list);for(var f=[],i=0;i<list.length;i++){var e=list[i];-1==list.findIndex(function(a){return e.dungeon.open_preview_dungeon_idx==a.dungeon.event_dungeon_once_a_day_idx&&a.is_complete})&&0!=e.dungeon.open_preview_dungeon_idx||(e.is_open_pre_once_a_day_dungeon=!0),1!=e.is_complete&&f.push(e)}return list=f},BattleService.prototype.getUserEventDungeon=function(a,b,c){var t=BattleTable.getInstance();t.sel_MasterEventDungeon(a,b,c),this.getMasterEventDungeonStageNpc(b,c),t.sel_UserEventDungeon(m_user_id,c)},BattleService.prototype.getUserEventDungeonOnceADayList_v2=function(b){for(var t=BattleTable.getInstance(),list=t.sel_MasterEventDungeonOnceADAyList_v2(b),idx=0;idx<list.length;idx++){var d=list[idx];this.getMasterEventDungeonOnceADayStageNpc(d.dungeon.event_dungeon_once_a_day_idx,d),0==d.dungeon.open_preview_dungeon_idx&&(d.is_open_pre_once_a_day_dungeon=!0)}t.sel_UserEventDungeonOnceADayList(m_user_id,list);for(var i=0;i<list.length;i++){-1==list.findIndex(function(a){return list[i].dungeon.open_preview_dungeon_idx==a.dungeon.event_dungeon_once_a_day_idx&&a.is_complete})&&0!=list[i].dungeon.open_preview_dungeon_idx||(list[i].is_open_pre_once_a_day_dungeon=!0)}return list},BattleService.prototype.getUserEventDungeonList=function(b,c){var t=BattleTable.getInstance();c=t.sel_MasterEventDungeonList(b,c);for(var f=0;f<c.length;f++){var d=c[f];this.getMasterEventDungeonStageNpc(d.event_dungeon.event_dungeon_idx,d),0==d.event_dungeon.open_event_dungeon_idx&&(d.is_open_pre_event_dungeon=!0)}t.sel_UserEventDungeonList(c);for(var i=0;i<c.length;i++){var e=c[i];-1==c.findIndex(function(a){return e.event_dungeon.open_event_dungeon_idx==a.event_dungeon.event_dungeon_idx&&a.is_complete})&&0!=e.event_dungeon.open_event_dungeon_idx||(e.is_open_pre_event_dungeon=!0)}return c},BattleService.prototype.getRaidDungeonStageNpc=function(c,d){var m=MasterManager.getInstance();d.stage_count=1;var e=[],info=m.get_RaidBossInfo(d.data.raid_boss_info_idx),level_info=m.get_RaidBossLevelInfo(d.data.raid_boss_info_idx,d.data.boss_level),hero=$.extend({},database.BattleGeneral);d.limit_time=info.limit_time,hero.is_zoom=!0,hero.npc_boss_type=7,hero.position=db.BattlePosition.Head,this.setRaidGenernalData(hero,info,level_info),e.push(hero),0<e.length&&(e.sort(function(a,b){return a.position>b.position?1:a.position<b.position?-1:0}),d.stage_npc.insert(0,e))},BattleService.prototype.getMussangTowerTaskListCheck=function(a){for(var t=BattleTable.getInstance(),list=[],task_list=MasterTable.getInstance().get_MussangTowerTaskList(a),i=0;i<task_list.size();i++){var b=task_list[i],task=MasterManager.getInstance().get_Task(b.task_id),task_type=MasterManager.getInstance().get_TaskType(task.task_type),data=new database.BattleMussangTowerTask;data.mussang_tower_id=a,data.task_id=b.task_id,data.bonus_type=b.bonus_type,data.min_value=b.min_value,data.max_value=b.max_value,data.task=task,data.task_type=task_type,list.push_back(data)}return t.upd_UserMussangTowerTaskListCheck(list),list},BattleService.prototype.getMussangTowerLotusBonusLists=function(b){for(var c=MasterTable.getInstance().get_MussangTowerLotusBonusList(),idx=0;idx<c.length;idx++){var d=c[idx],found=b.findIndex(function(a){if(a.lotus_count==d.lotus_count)return!0});if(-1==found){var e=new database.BattleMussangTowerLotusBonus;e.lotus_count=d.lotus_count,e.lotus_bonus_list=[],e.lotus_bonus_list.push_back(d),b.push(e)}else b[found].lotus_bonus_list.push_back(d);BattleTable.getInstance().upd_UserMussangTowerLotusBonusCheck(m_user_id,b)}BattleTable.getInstance().upd_UserMussangTowerLotusBonusCheck(b)},BattleService.prototype.getWorldWarNpcDungeonStageNpc=function(a){var m=MasterManager.getInstance();a.stage_count=1,a.stage_npc=new Map;for(var b=0,i=0;i<a.stage_count;i++){b=i+1;var c=m.get_WorldWarNpc(a.npc_troops.world_war_npc_idx,b),npc_list=[];if(0<c.npc1_id){var d=m.get_NpcGeneral(c.npc1_id);(e=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Head,e.is_zoom=0<c.npc1_size,e.npc_boss_type=c.npc1_size,e.battle_stage=c.battle_num,-1!=(found=a.npc_troops.troops_generals.findIndex(function(n){return!!(e.gnrl_id=n.gnrl_id&&n.position==e.position)}))&&(e.remain_hp_rate=a.npc_troops.troops_generals[found].remain_hp),0<e.remain_hp_rate&&(this.setNpcGeneralData(e,d),npc_list.push(e))}if(0<c.npc2_id){d=m.get_NpcGeneral(c.npc2_id);(e=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_1,e.is_zoom=0<c.npc2_size,e.npc_boss_type=c.npc2_size,e.battle_stage=c.battle_num,-1!=(found=a.npc_troops.troops_generals.findIndex(function(n){return!!(e.gnrl_id=n.gnrl_id&&n.position==e.position)}))&&(e.remain_hp_rate=a.npc_troops.troops_generals[found].remain_hp),0<e.remain_hp_rate&&(this.setNpcGeneralData(e,d),npc_list.push(e))}if(0<c.npc3_id){d=m.get_NpcGeneral(c.npc3_id);(e=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_2,e.is_zoom=0<c.npc3_size,e.npc_boss_type=c.npc3_size,e.battle_stage=c.battle_num,-1!=(found=a.npc_troops.troops_generals.findIndex(function(n){return!!(e.gnrl_id=n.gnrl_id&&n.position==e.position)}))&&(e.remain_hp_rate=a.npc_troops.troops_generals[found].remain_hp),0<e.remain_hp_rate&&(this.setNpcGeneralData(e,d),npc_list.push(e))}if(0<c.npc4_id){d=m.get_NpcGeneral(c.npc4_id);(e=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_1,e.is_zoom=0<c.npc4_size,e.npc_boss_type=c.npc4_size,e.battle_stage=c.battle_num,-1!=(found=a.npc_troops.troops_generals.findIndex(function(n){return!!(e.gnrl_id=n.gnrl_id&&n.position==e.position)}))&&(e.remain_hp_rate=a.npc_troops.troops_generals[found].remain_hp),0<e.remain_hp_rate&&(this.setNpcGeneralData(e,d),npc_list.push(e))}if(0<c.npc5_id){var e,found;d=m.get_NpcGeneral(c.npc5_id);(e=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_2,e.is_zoom=0<c.npc5_size,e.npc_boss_type=c.npc5_size,e.battle_stage=c.battle_num,-1!=(found=a.npc_troops.troops_generals.findIndex(function(n){return!!(e.gnrl_id=n.gnrl_id&&n.position==e.position)}))&&(e.remain_hp_rate=a.npc_troops.troops_generals[found].remain_hp),0<e.remain_hp_rate&&(this.setNpcGeneralData(e,d),npc_list.push(e))}0!=npc_list.length&&(npc_list.sort(function(l,r){return l.position-r.position}),a.stage_npc.insert(c.battle_num,npc_list))}},BattleService.prototype.getMasterMussangTowerStepStageNpc=function(a,b){var m=MasterManager.getInstance(),tower_step=m.get_MussangTowerStep(a);b.mussang_tower_id=a,b.mussang_tower=tower_step,b.stage_count=1,b.stage_npc=new Map;for(var i=0;i<b.stage_count;i++){var c=m.get_MussangTowerNpc(a,i+1),npc_list=[];if(0<c.npc1_id){var d=m.get_NpcGeneral(c.npc1_id);(e=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Head,e.is_zoom=0<c.npc1_size,e.npc_boss_type=c.npc1_size,e.battle_stage=c.battle_num,this.setNpcGeneralData(e,d),npc_list.push_back(e)}if(0<c.npc2_id){d=m.get_NpcGeneral(c.npc2_id);(e=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_1,e.is_zoom=0<c.npc2_size,e.npc_boss_type=c.npc2_size,e.battle_stage=c.battle_num,this.setNpcGeneralData(e,d),npc_list.push_back(e)}if(0<c.npc3_id){d=m.get_NpcGeneral(c.npc3_id);(e=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_2,e.is_zoom=0<c.npc3_size,e.npc_boss_type=c.npc3_size,e.battle_stage=c.battle_num,this.setNpcGeneralData(e,d),npc_list.push_back(e)}if(0<c.npc4_id){d=m.get_NpcGeneral(c.npc4_id);(e=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_1,e.is_zoom=0<c.npc4_size,e.npc_boss_type=c.npc4_size,e.battle_stage=c.battle_num,this.setNpcGeneralData(e,d),npc_list.push_back(e)}if(0<c.npc5_id){var e;d=m.get_NpcGeneral(c.npc5_id);(e=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_2,e.is_zoom=0<c.npc5_size,e.npc_boss_type=c.npc5_size,e.battle_stage=c.battle_num,this.setNpcGeneralData(e,d),npc_list.push_back(e)}0!=npc_list.length&&(npc_list.sort(function(l,r){return l.position-r.position}),b.stage_npc.insert(c.battle_num,npc_list))}},BattleService.prototype.getEventMussangBossStageNpc=function(a,b){var m=MasterManager.getInstance();b.stage_count=1;var c=[];c.clear();m.get_EventDungeonMussangBossInfo(b.data.boss_dungeon_idx,b.data.event_dungeon_period_idx);var d=$.extend({},database.BattleGeneral),npc_info=m.get_EventDungeonMussangBossNpcInfo(b.data.boss_dungeon_idx,1);d.is_zoom=!0,d.npc_id=npc_info.npc1_id,d.npc_boss_type=11,d.position=db.BattlePosition.Head,this.setNpcGeneralData(d),c.push_back(d),c.empty()||(c.sort(function(l,r){return l.position-r.position}),b.stage_npc.insert(0,c))},BattleService.prototype.loadBattleScript=function(b,c,d,e){var f=new Worker(WEB_WORKER),file_name="",battle_type=0;battle_type="event_dungeon"==c?(file_name="event_dungeon_script",1):(file_name="main_mission_script",2),f.postMessage({cmd:"loadBattleScript",url:master_json+file_name+".jbin",key:{script_id:d,occured_type:e,type:c}}),f.onmessage=function(a){a.data.length,1==battle_type?MasterManager.getInstance().set_EventDungeonScript(a.data):MasterManager.getInstance().set_MainMissionScript(a.data),b.resolve(!0)}},{getInstance:function(){return void 0===M&&(M=new BattleService),M}}}(),MissionService=function(){var c,m_main_User_mission=[],m_main_User_story=[],m_main_User_missionTask=[],m_main_User_lotus_bonus_log=[];function MissionService(){}return MissionService.prototype.loadUserMainStroy=function(){m_main_User_story=[];for(var a=NetService().get_User_main_story(),keys=a.keys(),i=0;i<keys.length;i++)m_main_User_story.push(a.at(keys[i]))},MissionService.prototype.loadUserMainMission=function(){},MissionService.prototype.loadUserMainMissionTask=function(){},MissionService.prototype.loadUserMainLotusBonusLog=function(){m_main_User_lotus_bonus_log=[];for(var a=NetService().get_Main_Story_Lotus_Bonus_Log().keys(),i=0;i<a.length;i++){var b=NetService().get_Main_Story_Lotus_Bonus_Log().at(a[i]);m_main_User_lotus_bonus_log.push(b)}},MissionService.prototype.getUserMainStory=function(a){var b=MissionTable.getInstance().sel_MasterMainStoryV2List(a);return MissionTable.getInstance().sel_UserMainStoryV2List(b),b},MissionService.prototype.getNextMissionId=function(a){var m=MasterManager.getInstance().get_MainMission(a);return MissionTable.getInstance().sel_MasterNextMainMissionId(m.main_scene_id,m.main_story_id,a,m.difficulty_type,m.main_mission_num)},MissionService.prototype.IsOpenMainMission=function(a){return MissionTable.getInstance().sel_UserMainMissionOpenCheck(a)},{getInstance:function(){return void 0===c&&(c=new MissionService),c},getUserMissionList:function(){return m_main_User_mission},getUserStoryList:function(){return m_main_User_story},getUserMissionTaskList:function(){return m_main_User_missionTask},getUserLotusBonusLogList:function(){return m_main_User_lotus_bonus_log}}}(),GeneralService=function(){var x;function GeneralService(){[]}return GeneralService.prototype.getGeneral=function(a){return MasterManager.getInstance().get_General(a)},GeneralService.prototype.getGenralGropNum=function(a){return MasterTable.getInstance().get_General(a).gnrl_group},GeneralService.prototype.getGeneralFriendEffectContent=function(a){var m=MasterTable.getInstance(),general=m.get_General(a);return m.get_LeaderSkill(general.leader_skill_id).content},GeneralService.prototype.getUserGeneralInfo=function(c,d){var e={},gnrl_key={};gnrl_key.gnrl_id=c.gnrl_id,gnrl_key.gnrl_num=c.gnrl_num,e=NetService().getUserGeneral(e,gnrl_key);var f=[];NetService().getUserGeneral(f);var h=f.filter(function(g){if(5==g.limit_step_id)return!0}),mt=MasterManager.getInstance();d.gnrl_id=gnrl_key.gnrl_id,d.gnrl_num=gnrl_key.gnrl_num,d.gnrl_level=e.gnrl_level,d.gnrl_exp=e.gnrl_exp,d.castle_id=e.castle_id,d.love_level=e.love_level,d.love_exp=e.love_exp,d.limit_step_id=e.limit_step_id,d.is_lock="y"==e.lock_yn,d.using_in_camp="y"==e.using_in_camp,d.used_in_camp="y"==e.used_in_camp,d.buff_type=e.buff_type,d.passive_skill=[],d.trans_passive_skill=[],d.leader_skill=[],d.special_leader_skill=[];var i=mt.get_General(d.gnrl_id),gender=mt.get_GeneralDivision(i.gnrl_group);(0==e.display_class?d.display_class=i.gnrl_class:d.display_class=e.display_class,d.gender_type=gender.general_gender_type,d.arm_service_type=i.arm_service_type,d.fight_type=i.fight_type,d.name=i.name,d.base_attk=i.attk,d.base_def=i.def,d.base_hp=i.hp,d.base_sp=i.sp,d.base_cri_prcnt=i.cri_percent,d.base_cri_ratio=i.cri_ratio,d.base_guard_rate=i.guard_rate,d.base_guard_decrease=i.guard_value,d.element_type=i.element_type,d.active_skill=i.active_skill_id,d.class_type=i.gnrl_class,d.cost=i.cost,d.gnrl_type=i.gnrl_type,d.gnrl_group=i.gnrl_group,d.arm_service_type=i.arm_service_type,d.skin_id=i.skin_id,d.bone_id=i.bone_id,d.max_class_type=i.evolution_max_class_type,d.combo_group_num=i.combo_group_num,d.evolution_group_num=i.evolution_group_num,d.frnd_effect=i.friend_num,d.love_stat_group=i.love_stat_group,d.evolution_mtrl_num=i.evolution_mtrl_num,d.sell_gold=i.sell_gold,d.sell_yhpt=i.sell_yhpt,d.sell_heaven_pt=0,d.level_exp_group=i.level_exp_group,d.rare_type=i.rare_type,d.passive_skill=[],d.trans_passive_skill=[],d.passive_skill.push(i.passive_skill_id),i.trans_passive_skill_id.split(",").forEach(function(a){var b=parseInt(a);d.trans_passive_skill.push_back(b)}),d.leader_skill.push(i.leader_skill_id),d.special_leader_skill_id=[],i.special_leader_skill_id.split(",").forEach(function(a){var b=parseInt(a);d.special_leader_skill.push(b)}),d.attk=this.getUserGeneralAttk(d),d.def=this.getUserGeneralDef(d),d.hp=this.getUserGeneralHp(d),d.sp=d.base_sp,d.cri_prcnt=this.getUserGeneralCriPrcnt(d),d.cri_ratio=this.getUserGeneralCriDmg(d),d.guard_rate=this.getUserGeneralDefPrcnt(d),d.guard_decrease=this.getUserGeneralDefDecrease(d),d.master_type=i.master_type,d.state_type=i.state_type,d.total_attk_pwr=d.attk+d.def+d.hp,0<d.limit_step_id?d.max_level=this.getLimitOverMaxLevel(d.limit_step_id):d.max_level=i.max_level,d.isPartner=this.isPartner(d.gnrl_id,d.gnrl_num),d.is_friend_partner=this.isFriendPartner(d.gnrl_id,d.gnrl_num),d.isEnabledEvolve=!1,d.isEnabledLimitOver=!1,d.is_enable_rebirth=!1,d.is_heaven_pt=!1,this.getGeneralHeavnePtInfo(d,h),d.is_rebirth_object=this.isRebirthObject(d.class_type,d.gnrl_group,d.gnrl_type),d.max_level==d.gnrl_level)&&(d.isMaxLevel=!0,this.isEnabledEvolve(d)&&(d.isEnabledEvolve=!0),d.class_type>=d.max_class_type&&this.isEnabledLimitOver(d)&&(d.isEnabledLimitOver=!0));d.is_rebirth_object&&(this.isEnabledRebirth(d)&&(d.is_enable_rebirth=!0))},GeneralService.prototype.isExistGeneralInPosType=function(a,b){for(var c=!1,user_troops_general=NetService().getUserPartyGeneral(),keys=user_troops_general.keys(),idx=0;idx<keys.length;idx++)if(user_troops_general.at(keys[idx]).troops_num==a&&user_troops_general.at(keys[idx]).position==b){c=!0;break}return c},GeneralService.prototype.getBaseGeneralInfo=function(c,d){var e=MasterManager.getInstance();d.gnrl_id=c,d.gnrl_level=1,d.gnrl_exp=0,d.love_level=1,d.love_exp=0,d.limit_step_id=0,d.passive_skill=[],d.trans_passive_skill=[],d.leader_skill=[],d.special_leader_skill=[];var f=e.get_General(d.gnrl_id),gender=e.get_GeneralDivision(f.gnrl_group);d.gender_type=gender.general_gender_type,d.arm_service_type=f.arm_service_type,d.fight_type=f.fight_type,d.name=f.name,d.base_attk=f.attk,d.base_def=f.def,d.base_hp=f.hp,d.base_sp=f.sp,d.base_cri_prcnt=f.cri_percent,d.base_cri_ratio=f.cri_ratio,d.base_guard_rate=f.guard_rate,d.base_guard_decrease=f.guard_value,d.element_type=f.element_type,d.active_skill=f.active_skill_id,d.class_type=f.gnrl_class,d.cost=f.cost,d.gnrl_type=f.gnrl_type,d.gnrl_group=f.gnrl_group,d.arm_service_type=f.arm_service_type,d.skin_id=f.skin_id,d.bone_id=f.bone_id,d.max_class_type=f.evolution_max_class_type,d.combo_group_num=f.combo_group_num,d.evolution_group_num=f.evolution_group_num,d.frnd_effect=f.friend_num,d.love_stat_group=f.love_stat_group,d.evolution_mtrl_num=f.evolution_mtrl_num,d.sell_gold=f.sell_gold,d.sell_yhpt=f.sell_yhpt,d.level_exp_group=f.level_exp_group,d.rare_type=f.rare_type,d.passive_skill.push(f.passive_skill_id),f.trans_passive_skill_id.split(",").forEach(function(a){var b=parseInt(a);d.trans_passive_skill.push_back(b)}),d.leader_skill.push(f.leader_skill_id),f.special_leader_skill_id=f.special_leader_skill_id+"";for(var g=f.special_leader_skill_id.split(","),jdx=0;jdx<g.length;jdx++){var s=g[jdx];d.special_leader_skill.push_back(1*s)}d.attk=this.getUserGeneralAttk(d),d.def=this.getUserGeneralDef(d),d.hp=this.getUserGeneralHp(d),d.sp=d.base_sp,d.cri_prcnt=this.getUserGeneralCriPrcnt(d),d.cri_ratio=this.getUserGeneralCriDmg(d),d.guard_rate=this.getUserGeneralDefPrcnt(d),d.guard_decrease=this.getUserGeneralDefDecrease(d),d.master_type=f.master_type,d.state_type=f.state_type,d.max_level=f.max_level,d.isPartner=!1,d.isEnabledEvolve=!1,d.isEnabledLimitOver=!1,d.is_friend_partner=!1,d.is_enable_rebirth=!1,d.is_rebirth_object=!1},GeneralService.prototype.getYunheeSelectList=function(c){var d=MasterManager.getInstance(),own_list=[];NetService().getUserGeneral(own_list);for(var e=d.get_GachaTicketManagement(c),gnrl_ids=MasterTable.getInstance().get_GeneralChoiceTicketList(e.gnrl_choice_id),gnrl_choice_id=e.gnrl_choice_id,list=[],i=0;i<gnrl_ids.length;i++)if(gnrl_choice_id==gnrl_ids[i].gnrl_choice_id){var g=d.get_General(gnrl_ids[i].gnrl_id),info=new db.UserGeneralInfo;info.gnrl_id=g.gnrl_id,info.name=g.name,info.gnrl_type=g.gnrl_type,info.state_type=g.state_type,info.class_type=g.gnrl_class,info.gnrl_group=g.gnrl_group,info.max_level=g.max_level,info.element_type=g.element_type,info.arm_service_type=g.arm_service_type,info.fight_type=g.fight_type,info.cost=g.cost,info.attk=g.attk,info.def=g.def,info.hp=g.hp,info.sp=g.sp,info.gnrl_level=1,info.sell_gold=g.sell_gold,info.sell_yhpt=g.sell_yhpt,info.level_exp_group=g.level_exp_group,info.max_class_type=g.evolution_max_class_type,info.rare_type=g.rare_type,info.passive_skill.push(g.passive_skill_id),info.leader_skill.push(g.leader_skill_id),g.trans_passive_skill_id.split(",").forEach(function(a){var b=parseInt(a);info.trans_passive_skill.push_back(b)});for(var f=!1,idx=0;idx<own_list.length;idx++){var h=d.get_General(own_list[idx].gnrl_id);if(info.gnrl_group==h.gnrl_group&&h.gnrl_type==GENERAL_TYPE_YUNHEE){f=!0;break}}info.is_own=f,info.total_attk_pwr=info.attk+info.def+info.hp,g.special_leader_skill_id=g.special_leader_skill_id+"";for(var j=g.special_leader_skill_id.split(","),jdx=0;jdx<j.length;jdx++){var s=j[jdx];info.special_leader_skill.push_back(1*s)}list.push(info)}return list},GeneralService.prototype.getMaxLevel=function(a){return MasterManager.getInstance().get_General_freeze(a).max_level},GeneralService.prototype.getLimitOverMaxLevel=function(a){return MasterManager.getInstance().get_GeneralLimit(a).ext_level_id},GeneralService.prototype.getLimitOverMaxStep=function(){return 0},GeneralService.prototype.isExistHighClassGeneral=function(a){var b=MasterTable.getInstance();for(var c in a){if(5<=b.get_General_freeze(c.gnrl_id).gnrl_class)return!0}return!1},GeneralService.prototype.isSameGeneralInTroops=function(a,b,c){var d=this.getUserTroopsGeneralList(a),selectGnrlId=c.gnrl_id%1e3;for(var e in d){if(null==d[e].gnrl_id)break;var f=d[e].gnrl_id%1e3;if(d[e].pos_type!=b&&selectGnrlId==f&&d[e].gnrl_num!=c.gnrl_num)return{result:!0,pos:b=d[e].pos_type}}return{result:!1,pos:b=0}},GeneralService.prototype.getUserGeneralMaterialSellList=function(b,c){return null==c&&(c=0),0!=c?this.getUserGeneralMaterialInfoList(b,c):this.getUserGeneralMaterialInfoList(b),b=b.filter(function(l){var a={};return a.gnrl_id=l.gnrl_id,a.gnrl_num=l.gnrl_num,!l.is_lock&&!l.using_in_camp})},GeneralService.prototype.getUserGeneralSellList=function(g,h){if(null==h){this.getUserGeneralInfoList(g);var i=[];this.getUserTroopsGeneralDistinctList(i);var j=NetService().getUserWeeklyTroopsGeneral(),ns_v2=NetService(),event_keys=(m=ns_v2.get_User_Event_Dungeon_Search_Troops_Generals()).keys(),world_war_troops_generals=[];world_war_troops_generals=NetServiceV3.getInstance().getUserPartyGeneral();var k=WorldWarService.getInstance();g=(g=(g=g.filter(function(l){for(var a=0;a<i.length;a++){var b=i[a],key={};if(key.gnrl_id=l.gnrl_id,key.gnrl_num=l.gnrl_num,l.gnrl_num==b.gnrl_num||l.is_lock||l.using_in_camp)return!1}for(var c=0;c<event_keys.length;c++)for(var d=m.at(event_keys[c]),g_idx=0;g_idx<d.length;g_idx++){if(d[g_idx].gnrl_num==l.gnrl_num)return!1}for(var w=0;w<j.length;w++)if(j[w].gnrl_num==l.gnrl_num)return!1;for(var e=NetService().get_great_wall_troops_info().partin_generals,pg=0;pg<e.length;pg++)if(e[pg].gnrl_id==l.gnrl_id&&e[pg].gnrl_num==l.gnrl_num)return!1;if(!k.isWorldWarUnification()&&k.isWorldWarPeriodOpen())for(var f=world_war_troops_generals.keys(),tg=0;tg<f.length;tg++)if(world_war_troops_generals.at(f[tg]).gnrl_id==l.gnrl_id&&world_war_troops_generals.at(f[tg]).gnrl_num==l.gnrl_num)return!1;return!0})).filter(function(l){var a={};return a.gnrl_id=l.gnrl_id,a.gnrl_num=l.gnrl_num,!this.isPartnerGeneral(a)&&(!this.isFriendPartner(a.gnrl_id,a.gnrl_num)&&(!l.is_lock&&!l.using_in_camp))}.bind(this))).filter(function(l){var a={};return a.gnrl_id=l.gnrl_id,a.gnrl_num=l.gnrl_num,!this.isGnrlEquipping(a)}.bind(this))}else{this.getUserGeneralInfoList(g,h);i=[];this.getUserTroopsGeneralDistinctList(i);world_war_troops_generals=[];world_war_troops_generals=NetServiceV3.getInstance().getUserPartyGeneral();k=WorldWarService.getInstance();g=(g=(g=g.filter(function(l){for(var a=0;a<i.length;a++){var b=i[a],key={};if(key.gnrl_id=l.gnrl_id,key.gnrl_num=l.gnrl_num,l.gnrl_num==b.gnrl_num||l.is_lock||l.using_in_camp)return!1}return!0})).filter(function(l){var a={};return a.gnrl_id=l.gnrl_id,a.gnrl_num=l.gnrl_num,!this.isPartnerGeneral(a)&&(!this.isFriendPartner(a.gnrl_id,a.gnrl_num)&&(!l.is_lock&&!l.using_in_camp))}.bind(this))).filter(function(l){var a={};return a.gnrl_id=l.gnrl_id,a.gnrl_num=l.gnrl_num,!this.isGnrlEquipping(a)}.bind(this));event_keys=(m=NetService().get_User_Event_Dungeon_Search_Troops_Generals()).keys();g=g.filter(function(l){for(var a=0;a<event_keys.length;a++)for(var b=m.at(event_keys[a]),g_idx=0;g_idx<b.length;g_idx++){if(b[g_idx].gnrl_num==l.gnrl_num)return!1}return!0}.bind(this));var m=NetService().get_great_wall_troops_info().partin_generals;g=g.filter(function(l){for(var a=0;a<m.length;a++){var b=m[a];if(b.gnrl_id==l.gnrl_id&&b.gnrl_num==l.gnrl_num)return!1}if(!k.isWorldWarUnification()&&k.isWorldWarPeriodOpen())for(var c=world_war_troops_generals.keys(),tg=0;tg<c.length;tg++)if(world_war_troops_generals.at(c[tg]).gnrl_id==l.gnrl_id&&world_war_troops_generals.at(c[tg]).gnrl_num==l.gnrl_num)return!1;return!0}.bind(this))}return g},GeneralService.prototype.getPassiveSkill=function(a,b){return 0},GeneralService.prototype.getHwandanCount=function(a){var b={};return b.class_type=a,NetService.map_User_Hwandan_Info[b].hwandan_count},GeneralService.prototype.getLoveItemCount=function(a){return 0},GeneralService.prototype.getLoveItemName=function(a){return MasterManager.getInstance().get_LoveItem(a).name},GeneralService.prototype.getUserGeneralAttk=function(a){var m=MasterTable.getInstance().getMasterTable(),base_attk=a.base_attk;if(0!=a.limit_step_id){var b=m.get_GeneralLimitAbility(a.limit_step_id,a.rare_type);null==b&&cc.log(b.attk),base_attk*=b.attk}var g=m.get_General(a.gnrl_id),ab=MasterTable.getInstance().get_AbilityIncreaseInfo(g.rare_type,g.fight_type,g.gnrl_group);null==ab&&cc.log(ab.attk);var c=base_attk+(a.gnrl_level-1)*ab.attk;a.class_type>YUNHEE_MAX_CLASS_TYPE&&(c+=m.get_GeneralRebirthStatInfo(a.gnrl_group).attk);return c},GeneralService.prototype.getUserGeneralDef=function(a){var m=MasterTable.getInstance().getMasterTable(),base_def=a.base_def;0!=a.limit_step_id&&(base_def*=m.get_GeneralLimitAbility(a.limit_step_id,a.rare_type).def);var g=m.get_General(a.gnrl_id),ab=MasterTable.getInstance().get_AbilityIncreaseInfo(g.rare_type,g.fight_type,g.gnrl_group),def=base_def+(a.gnrl_level-1)*ab.def;a.class_type>YUNHEE_MAX_CLASS_TYPE&&(def+=m.get_GeneralRebirthStatInfo(a.gnrl_group).def);return def},GeneralService.prototype.getUserGeneralHp=function(a){var m=MasterTable.getInstance().getMasterTable(),base_hp=a.base_hp;0!=a.limit_step_id&&(base_hp*=m.get_GeneralLimitAbility(a.limit_step_id,a.rare_type).hp);var g=m.get_General(a.gnrl_id),ab=MasterTable.getInstance().get_AbilityIncreaseInfo(g.rare_type,g.fight_type,g.gnrl_group),hp=base_hp+(a.gnrl_level-1)*ab.hp;a.class_type>YUNHEE_MAX_CLASS_TYPE&&(hp+=m.get_GeneralRebirthStatInfo(a.gnrl_group).hp);return hp},GeneralService.prototype.getUserGeneralCriPrcnt=function(a){var m=MasterTable.getInstance().getMasterTable(),base_cri_prcnt=a.base_cri_prcnt;0!=a.limit_step_id&&(base_cri_prcnt*=m.get_GeneralLimitAbility(a.limit_step_id,a.rare_type).cri_prcnt);(base_cri_prcnt/=100,a.class_type>YUNHEE_MAX_CLASS_TYPE)&&(base_cri_prcnt+=m.get_GeneralRebirthStatInfo(a.gnrl_group).cri_prcnt/100);return base_cri_prcnt},GeneralService.prototype.getUserGeneralCriDmg=function(a){var m=MasterTable.getInstance().getMasterTable(),base_cri_ratio=a.base_cri_ratio;0!=a.limit_step_id&&(base_cri_ratio*=m.get_GeneralLimitAbility(a.limit_step_id,a.rare_type).cri_rate);(base_cri_ratio/=100,a.class_type>YUNHEE_MAX_CLASS_TYPE)&&(base_cri_ratio+=m.get_GeneralRebirthStatInfo(a.gnrl_group).cri_ratio/100);return base_cri_ratio},GeneralService.prototype.getUserGeneralDefPrcnt=function(a){var m=MasterTable.getInstance().getMasterTable(),base_def_prcnt=a.base_guard_rate;0!=a.limit_step_id&&(base_def_prcnt*=m.get_GeneralLimitAbility(a.limit_step_id,a.rare_type).guard_rate);(base_def_prcnt/=100,a.class_type>YUNHEE_MAX_CLASS_TYPE)&&(base_def_prcnt+=m.get_GeneralRebirthStatInfo(a.gnrl_group).guard_rate/100);return base_def_prcnt},GeneralService.prototype.getUserGeneralDefDecrease=function(a){var m=MasterTable.getInstance().getMasterTable(),base_def_decrease=a.base_guard_decrease;0!=a.limit_step_id&&(base_def_decrease*=m.get_GeneralLimitAbility(a.limit_step_id,a.rare_type).guard_decrease);(base_def_decrease/=100,a.class_type>YUNHEE_MAX_CLASS_TYPE)&&(base_def_decrease+=m.get_GeneralRebirthStatInfo(a.gnrl_group).guard_decrease/100);return base_def_decrease},GeneralService.prototype.geEvolveTypeToArmServiceType=function(a){var b=0;return a==EVOLVE_MTRL_TYPE_MELEE||a==EVOLVE_MTRL_TYPE_MELEE_MIDDLE||a==EVOLVE_MTRL_TYPE_MELEE_LOW?b=ARMSERVICETYPE_INFANTRY:a==EVOLVE_MTRL_TYPE_ARCHER||a==EVOLVE_MTRL_TYPE_ARCHER_MIDDLE||a==EVOLVE_MTRL_TYPE_ARCHER_LOW?b=ARMSERVICETYPE_ARCHER:a==EVOLVE_MTRL_TYPE_LANCER||a==EVOLVE_MTRL_TYPE_LANCER_MIDDLE||a==EVOLVE_MTRL_TYPE_LANCER_LOW?b=ARMSERVICETYPE_SPEAR:a!=EVOLVE_MTRL_TYPE_YUBI_LOW&&a!=EVOLVE_MTRL_TYPE_YUBI_MIDDLE&&a!=EVOLVE_MTRL_TYPE_YUBI_HIGH||(b=ARMSERVICETYPE_INFANTRY),b},GeneralService.prototype.geEvolveTypeToArmServiceClassType=function(a){var b=0;return a==EVOLVE_MTRL_TYPE_MELEE||a==EVOLVE_MTRL_TYPE_ARCHER||a==EVOLVE_MTRL_TYPE_LANCER?b=EVOLVE_ARM_SERVICE_CLASS_TYPE_HIGH:a==EVOLVE_MTRL_TYPE_MELEE_MIDDLE||a==EVOLVE_MTRL_TYPE_ARCHER_MIDDLE||a==EVOLVE_MTRL_TYPE_LANCER_MIDDLE?b=EVOLVE_ARM_SERVICE_CLASS_TYPE_MIDDLE:a==EVOLVE_MTRL_TYPE_MELEE_LOW||a==EVOLVE_MTRL_TYPE_ARCHER_LOW||a==EVOLVE_MTRL_TYPE_LANCER_LOW?b=EVOLVE_ARM_SERVICE_CLASS_TYPE_LOW:a==EVOLVE_MTRL_TYPE_YUBI_HIGH?b=EVOLVE_ARM_SERVICE_CLASS_TYPE_EVENT_HIGH:a==EVOLVE_MTRL_TYPE_YUBI_MIDDLE?b=EVOLVE_ARM_SERVICE_CLASS_TYPE_EVENT_MIDDLE:a==EVOLVE_MTRL_TYPE_YUBI_LOW&&(b=EVOLVE_ARM_SERVICE_CLASS_TYPE_EVENT_LOW),b},GeneralService.prototype.getEvolveTypeToBonusType=function(a){return a==EVOLVE_MTRL_TYPE_CLASS_1?BONUS_TYPE_HWANDAN_1:a==EVOLVE_MTRL_TYPE_CLASS_2?BONUS_TYPE_HWANDAN_2:a==EVOLVE_MTRL_TYPE_CLASS_3?BONUS_TYPE_HWANDAN_3:a==EVOLVE_MTRL_TYPE_CLASS_4?BONUS_TYPE_HWANDAN_4:a==EVOLVE_MTRL_TYPE_CLASS_5?BONUS_TYPE_HWANDAN_5:a==EVOLVE_MTRL_TYPE_CLASS_6?BONUS_TYPE_HWANDAN_6:a==EVOLVE_MTRL_TYPE_MELEE?BONUS_TYPE_EVOLVE_MELEE:a==EVOLVE_MTRL_TYPE_LANCER?BONUS_TYPE_EVOLVE_LANCER:a==EVOLVE_MTRL_TYPE_ARCHER?BONUS_TYPE_EVOLVE_ARCHER:a==EVOLVE_MTRL_TYPE_ORB?BONUS_TYPE_EVOLVE_ORB:a==EVOLVE_MTRL_TYPE_MELEE_MIDDLE?BONUS_TYPE_EVOLVE_MELEE_MIDDLE:a==EVOLVE_MTRL_TYPE_LANCER_MIDDLE?BONUS_TYPE_EVOLVE_LANCER_MIDDLE:a==EVOLVE_MTRL_TYPE_ARCHER_MIDDLE?BONUS_TYPE_EVOLVE_ARCHER_MIDDLE:a==EVOLVE_MTRL_TYPE_MELEE_LOW?BONUS_TYPE_EVOLVE_MELEE_LOW:a==EVOLVE_MTRL_TYPE_LANCER_LOW?BONUS_TYPE_EVOLVE_LANCER_LOW:a==EVOLVE_MTRL_TYPE_ARCHER_LOW?BONUS_TYPE_EVOLVE_ARCHER_LOW:a==EVOLVE_MTRL_TYPE_YUBI_LOW?BONUS_TYPE_YUBI_EVOLVE_LOW:a==EVOLVE_MTRL_TYPE_YUBI_MIDDLE?BONUS_TYPE_YUBI_EVOLVE_MIDDLE:a==EVOLVE_MTRL_TYPE_YUBI_HIGH?BONUS_TYPE_YUBI_EVOLVE_HIGH:a==EVOLVE_MTRL_TYPE_YUBI_RARE?BONUS_TYPE_YUBI_RARE:0},GeneralService.prototype.getRebirthMtrlTypeToBonusType=function(a){return a==REBIRTH_MTRL_TYPE_1?BONUS_TYPE_REBIRTH_MTRL_TYPE_1:a==REBIRTH_MTRL_TYPE_2?BONUS_TYPE_REBIRTH_MTRL_TYPE_2:a==REBIRTH_MTRL_TYPE_3?BONUS_TYPE_REBIRTH_MTRL_TYPE_3:a==REBIRTH_MTRL_TYPE_4?BONUS_TYPE_REBIRTH_MTRL_TYPE_4:a==REBIRTH_MTRL_TYPE_5?BONUS_TYPE_REBIRTH_MTRL_TYPE_5:a==REBIRTH_MTRL_TYPE_6?BONUS_TYPE_REBIRTH_MTRL_TYPE_6:a==REBIRTH_MTRL_TYPE_7?BONUS_TYPE_REBIRTH_MTRL_TYPE_7:a==REBIRTH_MTRL_TYPE_EVENT_1?BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1:a==REBIRTH_MTRL_TYPE_EVENT_2?BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2:a==REBIRTH_MTRL_TYPE_EVENT_3?BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3:a==REBIRTH_MTRL_TYPE_EVENT_4?BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4:a==REBIRTH_MTRL_TYPE_EVENT_5?BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5:a==REBIRTH_MTRL_TYPE_EVENT_6?BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6:0},GeneralService.prototype.getBonusTypeToRebirthMtrlType=function(a){return a==BONUS_TYPE_REBIRTH_MTRL_TYPE_1?REBIRTH_MTRL_TYPE_1:a==BONUS_TYPE_REBIRTH_MTRL_TYPE_2?REBIRTH_MTRL_TYPE_2:a==BONUS_TYPE_REBIRTH_MTRL_TYPE_3?REBIRTH_MTRL_TYPE_3:a==BONUS_TYPE_REBIRTH_MTRL_TYPE_4?REBIRTH_MTRL_TYPE_4:a==BONUS_TYPE_REBIRTH_MTRL_TYPE_5?REBIRTH_MTRL_TYPE_5:a==BONUS_TYPE_REBIRTH_MTRL_TYPE_6?REBIRTH_MTRL_TYPE_6:a==BONUS_TYPE_REBIRTH_MTRL_TYPE_7?REBIRTH_MTRL_TYPE_7:a==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1?REBIRTH_MTRL_TYPE_EVENT_1:a==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2?REBIRTH_MTRL_TYPE_EVENT_2:a==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3?REBIRTH_MTRL_TYPE_EVENT_3:a==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4?REBIRTH_MTRL_TYPE_EVENT_4:a==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5?REBIRTH_MTRL_TYPE_EVENT_5:a==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6?REBIRTH_MTRL_TYPE_EVENT_6:0},GeneralService.prototype.getComboStatToBonusType=function(a){return a==COMBO_STAT_ATTK?BONUS_TYPE_ATTK_POINT:a==COMBO_STAT_DEF?BONUS_TYPE_DEF_POINT:a==COMBO_STAT_HP?BONUS_TYPE_HP_POINT:a==COMBO_STAT_CRI_PRCNT?BONUS_TYPE_CRI_PRCNT_POINT:a==COMBO_STAT_CRI_DMG?BONUS_TYPE_CRI_DMG_POINT:0},GeneralService.prototype.getBonusTypeToPropertyType=function(a){return a==BONUS_TYPE_ATTK_POINT?FORMATION_PROPERTY_TYPE_ATTK:a==BONUS_TYPE_DEF_POINT?FORMATION_PROPERTY_TYPE_DEF:a==BONUS_TYPE_HP_POINT?FORMATION_PROPERTY_TYPE_HP:a==BONUS_TYPE_CRI_PRCNT_POINT?FORMATION_PROPERTY_TYPE_CRI_PRCNT:a==BONUS_TYPE_CRI_DMG_POINT?FORMATION_PROPERTY_TYPE_CRI_DMG:0},GeneralService.prototype.getBonusTypeToLoveId=function(a){return a==BONUS_TYPE_LOVE_ITEM_MELEE?1:a==BONUS_TYPE_LOVE_ITEM_LANCER?2:a==BONUS_TYPE_LOVE_ITEM_RANGER?3:a==BONUS_TYPE_LOVE_ITEM_CAKE?4:a==BONUS_TYPE_YUBI_LOVE_ITEM?5:a==BONUS_TYPE_CHRISTMAS_LOVE_ITEM?6:a==BONUS_TYPE_SUPER_CHOCO_CAKE?7:a==BONUS_TYPE_LOVE_ITEM_PARTNER_COCHOLATE?14:a==BONUS_TYPE_LOVE_ITEM_VD_COCHOLATE_A?9:a==BONUS_TYPE_LOVE_ITEM_VD_COCHOLATE_B?10:a==BONUS_TYPE_LOVE_MAX_CAKE?13:a==BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_01?15:a==BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_02?16:a==BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_03?17:a==BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_04?18:a==BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_05?19:a==BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_06?20:a==BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_07?21:a==BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_08?22:a==BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_09?23:a==BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_10?24:0},GeneralService.prototype.getBonusTypeToLimitOverMtrlType=function(a){return a==BONUS_TYPE_SR_LIMIT_OVER_MTRL?1:a==BONUS_TYPE_SSR_LIMIT_OVER_MTRL?2:0},GeneralService.prototype.getLimitOverMtrlTypeToBonusType=function(a){return 1==a?BONUS_TYPE_SR_LIMIT_OVER_MTRL:2==a?BONUS_TYPE_SSR_LIMIT_OVER_MTRL:0},GeneralService.prototype.getBonusTypeToCraftShopMtrlType=function(a){return a==BONUS_TYPE_CRAFT_SHOP_FIRST_LOW?CRAFT_SHOP_BONUS_TYPE_FIRST_LOW:a==BONUS_TYPE_CRAFT_SHOP_FIRST_MIDDLE?CRAFT_SHOP_BONUS_TYPE_FIRST_MIDDLE:a==BONUS_TYPE_CRAFT_SHOP_FIRST_HIGH?CRAFT_SHOP_BONUS_TYPE_FIRST_HIGH:a==BONUS_TYPE_CRAFT_SHOP_FIRST_UNIQUE?CRAFT_SHOP_BONUS_TYPE_FIRST_UNIQUE:a==BONUS_TYPE_CRAFT_SHOP_SECOND_MIDDLE?CRAFT_SHOP_BONUS_TYPE_SECOND_MIDDLE:a==BONUS_TYPE_CRAFT_SHOP_SECOND_HIGH?CRAFT_SHOP_BONUS_TYPE_SECOND_HIGH:a==BONUS_TYPE_CRAFT_SHOP_SECOND_UNIQUE?CRAFT_SHOP_BONUS_TYPE_SECOND_UNIQUE:a==BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND?CRAFT_SHOP_BONUS_TYPE_TOTAL_LEGEND:a==BONUS_TYPE_CHRISTMAS_RIBBON?CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_RIBBON:a==BONUS_TYPE_CHRISTMAS_STAR?CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_STAR:a==BONUS_TYPE_CHRISTMAS_BALL?CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_BALL:a==BONUS_TYPE_CHRISTMAS_BELL?CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_BELL:a==BONUS_TYPE_CHRISTMAS_ANGEL?CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_ANGEL:a==BONUS_TYPE_CHRISTMAS_LOLLIPOPS?CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_LOLLIPOPS:a==BONUS_TYPE_CHRISTMAS_COOKIE?CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_COOKIE:a==BONUS_TYPE_CHRISTMAS_SOCKS?CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_SOCKS:a==BONUS_TYPE_CHRISTMAS_TREE?CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_TREE:a==BONUS_TYPE_CHRISTMAS_APPLE?CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_APPLE:0},GeneralService.prototype.getCraftShopMtrlTypeToBonusType=function(a){return a==CRAFT_SHOP_BONUS_TYPE_FIRST_LOW?BONUS_TYPE_CRAFT_SHOP_FIRST_LOW:a==CRAFT_SHOP_BONUS_TYPE_FIRST_MIDDLE?BONUS_TYPE_CRAFT_SHOP_FIRST_MIDDLE:a==CRAFT_SHOP_BONUS_TYPE_FIRST_HIGH?BONUS_TYPE_CRAFT_SHOP_FIRST_HIGH:a==CRAFT_SHOP_BONUS_TYPE_FIRST_UNIQUE?BONUS_TYPE_CRAFT_SHOP_FIRST_UNIQUE:a==CRAFT_SHOP_BONUS_TYPE_SECOND_MIDDLE?BONUS_TYPE_CRAFT_SHOP_SECOND_MIDDLE:a==CRAFT_SHOP_BONUS_TYPE_SECOND_HIGH?BONUS_TYPE_CRAFT_SHOP_SECOND_HIGH:a==CRAFT_SHOP_BONUS_TYPE_SECOND_UNIQUE?BONUS_TYPE_CRAFT_SHOP_SECOND_UNIQUE:a==CRAFT_SHOP_BONUS_TYPE_TOTAL_LEGEND?BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND:a==CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_RIBBON?BONUS_TYPE_CHRISTMAS_RIBBON:a==CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_STAR?BONUS_TYPE_CHRISTMAS_STAR:a==CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_BALL?BONUS_TYPE_CHRISTMAS_BALL:a==CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_BELL?BONUS_TYPE_CHRISTMAS_BELL:a==CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_ANGEL?BONUS_TYPE_CHRISTMAS_ANGEL:a==CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_LOLLIPOPS?BONUS_TYPE_CHRISTMAS_LOLLIPOPS:a==CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_COOKIE?BONUS_TYPE_CHRISTMAS_COOKIE:a==CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_SOCKS?BONUS_TYPE_CHRISTMAS_SOCKS:a==CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_TREE?BONUS_TYPE_CHRISTMAS_TREE:a==CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_APPLE?BONUS_TYPE_CHRISTMAS_APPLE:0},GeneralService.prototype.getBonusTypeToEvolveType=function(a){return a==BONUS_TYPE_HWANDAN_1?EVOLVE_MTRL_TYPE_CLASS_1:a==BONUS_TYPE_HWANDAN_2?EVOLVE_MTRL_TYPE_CLASS_2:a==BONUS_TYPE_HWANDAN_3?EVOLVE_MTRL_TYPE_CLASS_3:a==BONUS_TYPE_HWANDAN_4?EVOLVE_MTRL_TYPE_CLASS_4:a==BONUS_TYPE_HWANDAN_5?EVOLVE_MTRL_TYPE_CLASS_5:a==BONUS_TYPE_HWANDAN_6?EVOLVE_MTRL_TYPE_CLASS_6:a==BONUS_TYPE_EVOLVE_MELEE?EVOLVE_MTRL_TYPE_MELEE:a==BONUS_TYPE_EVOLVE_LANCER?EVOLVE_MTRL_TYPE_LANCER:a==BONUS_TYPE_EVOLVE_ARCHER?EVOLVE_MTRL_TYPE_ARCHER:a==BONUS_TYPE_EVOLVE_ORB?EVOLVE_MTRL_TYPE_ORB:a==BONUS_TYPE_EVOLVE_MELEE_MIDDLE?EVOLVE_MTRL_TYPE_MELEE_MIDDLE:a==BONUS_TYPE_EVOLVE_LANCER_MIDDLE?EVOLVE_MTRL_TYPE_LANCER_MIDDLE:a==BONUS_TYPE_EVOLVE_ARCHER_MIDDLE?EVOLVE_MTRL_TYPE_ARCHER_MIDDLE:a==BONUS_TYPE_EVOLVE_MELEE_LOW?EVOLVE_MTRL_TYPE_MELEE_LOW:a==BONUS_TYPE_EVOLVE_LANCER_LOW?EVOLVE_MTRL_TYPE_LANCER_LOW:a==BONUS_TYPE_EVOLVE_ARCHER_LOW?EVOLVE_MTRL_TYPE_ARCHER_LOW:a==BONUS_TYPE_YUBI_EVOLVE_LOW?EVOLVE_MTRL_TYPE_YUBI_LOW:a==BONUS_TYPE_YUBI_EVOLVE_MIDDLE?EVOLVE_MTRL_TYPE_YUBI_MIDDLE:a==BONUS_TYPE_YUBI_EVOLVE_HIGH?EVOLVE_MTRL_TYPE_YUBI_HIGH:0},GeneralService.prototype.isEventDungeonTroopsGeneral=function(a){for(var b=NetService().get_User_Event_Dungeon_Search_Troops_Generals(),event_keys=b.keys(),eg_idx=0;eg_idx<event_keys.length;eg_idx++)for(var c=b.at(event_keys[eg_idx]),g_idx=0;g_idx<c.length;g_idx++){if(c[g_idx].gnrl_num==a.gnrl_num)return!0}return!1},GeneralService.prototype.getGeneralHeavnePtInfo=function(a,b){for(var c=MasterManager.getInstance(),idx=0;idx<b.length;idx++){var g=b.at(idx),general=c.get_General(g.gnrl_id);if(general.rare_type>=RARE_TYPE_R&&a.gnrl_group==general.gnrl_group&&5==g.limit_step_id){a.is_heaven_pt=!0;break}}if(a.is_heaven_pt){var d=(c=MasterManager.getInstance()).get_HeavenPt(a.gnrl_group,a.gnrl_type,a.class_type,a.limit_step_id);a.sell_heaven_pt=d.heaven_pt}else a.sell_heaven_pt=0},GeneralService.prototype.getUserGeneralHeavenPTSellList=function(c){var d=[],gnrls=[];NetService().getUserGeneral(gnrls);var e=MasterManager.getInstance(),hanven_gnrls=gnrls.filter(function(g){if(5==g.limit_step_id)return!0});gnrls.forEach(function(a){var g=e.get_General(a.gnrl_id),info=new db.UserGeneralInfo;info.gnrl_id=a.gnrl_id,info.gnrl_num=a.gnrl_num,info.gnrl_level=a.gnrl_level,info.gnrl_exp=a.gnrl_exp,info.castle_id=a.castle_id,info.is_lock="y"==a.lock_yn,info.love_level=a.love_level,info.love_exp=a.love_exp,info.limit_step_id=a.limit_step_id,info.using_in_camp="y"==a.using_in_camp,info.used_in_camp="y"==a.used_in_camp,info.buff_type=a.buff_type,info.name=g.name,info.element_type=g.element_type,info.class_type=g.gnrl_class,info.cost=g.cost,info.gnrl_type=g.gnrl_type,info.gnrl_group=g.gnrl_group,info.fight_type=g.fight_type,info.arm_service_type=g.arm_service_type,info.max_class_type=g.evolution_max_class_type,info.sell_gold=g.sell_gold,info.sell_yhpt=g.sell_yhpt,info.rare_type=g.rare_type;var b={};b.gnrl_id=info.gnrl_id,b.gnrl_num=info.gnrl_num,info.master_type=g.master_type,info.state_type=g.state_type,0<info.limit_step_id?info.max_level=this.getLimitOverMaxLevel(info.limit_step_id):info.max_level=g.max_level,info.isPartner=this.isPartner(info.gnrl_id,info.gnrl_num),info.is_friend_partner=this.isFriendPartner(info.gnrl_id,info.gnrl_num),this.getGeneralHeavnePtInfo(info,hanven_gnrls),d.push_back(info)}.bind(this));var f=NetService().getUserPartyGeneral(),user_event_dungeon_search_troops_general=NetService().get_User_Event_Dungeon_Search_Troops_Generals("list"),world_war_troops_generals=[];world_war_troops_generals=NetServiceV3.getInstance().getUserPartyGeneral();for(var h=WorldWarService.getInstance(),g_idx=0;g_idx<d.length;g_idx++){var g=d[g_idx];if(g.is_heaven_pt){if(17039==g.gnrl_id);for(var i=f.keys(),t_idx=0;t_idx<i.length;t_idx++){var t=f.at(i[t_idx]);if(t.gnrl_id==g.gnrl_id&&t.gnrl_num==g.gnrl_num){g.using_in_troops=!0;break}}for(var j=0;j<NetService().get_great_wall_troops_info().partin_generals.length;j++){var k=NetService().get_great_wall_troops_info().partin_generals[j];if(k.gnrl_id==g.gnrl_id&&k.gnrl_num==g.gnrl_num){g.using_in_great_wall_troops=!0;break}}for(var l=0;l<user_event_dungeon_search_troops_general.length;l++){var m=user_event_dungeon_search_troops_general[l];if(m.gnrl_id==g.gnrl_id&&m.gnrl_num==g.gnrl_num){g.using_in_search_troops=!0;break}}if(!h.isWorldWarUnification()&&h.isWorldWarPeriodOpen())for(var n=world_war_troops_generals.keys(),tg=0;tg<n.length;tg++)if(world_war_troops_generals.at(n[tg]).gnrl_id==g.gnrl_id&&world_war_troops_generals.at(n[tg]).gnrl_num==g.gnrl_num){g.using_in_world_war_troops=!0;break}var o={};o.gnrl_id=g.gnrl_id,o.gnrl_num=g.gnrl_num,g.is_equipping=this.isGnrlEquipping(o),c.push_back(g)}}},GeneralService.prototype.getUserLevelUpMaterialList=function(c,d,e){null==e&&(e=1);var f=[];NetService().getUserGeneral(f);var h=NetService().getUserPartyGeneral(),user_weekly_troops_general=NetService().getUserWeeklyTroopsGeneral(),world_war_troops_generals=NetServiceV3.getInstance().getUserPartyGeneral(),w_service=WorldWarService.getInstance(),mt=MasterManager.getInstance(),troops_key=h.keys();for(var i in f){var j=f[i];if(null==j.gnrl_id)break;var g=mt.get_General(j.gnrl_id);if((e!=GENERAL_TYPE_YUNHEE||g.gnrl_type==GENERAL_TYPE_YUNHEE||g.gnrl_type==GENERAL_TYPE_SOLDIER)&&(e!=GENERAL_TYPE_MATERIAL||g.gnrl_type==GENERAL_TYPE_MATERIAL)){var k=new db.UserGeneralKey;k.gnrl_id=j.gnrl_id,k.gnrl_num=j.gnrl_num;var l={};l.gnrl_id=j.gnrl_id,l.gnrl_num=j.gnrl_num;var m=this.isGnrlEquipping(l);if(!m&&!(m=this.isEventDungeonTroopsGeneral(k))&&(w_service.isWorldWarUnification()||!w_service.isWorldWarPeriodOpen()||!(m=this.isWorldWarGnrlEquipping(l)))&&j.gnrl_num!=c.gnrl_num){if(g.gnrl_type==GENERAL_TYPE_LIMIT_OVER)continue;var n=new db.UserGeneralInfo,isExist=!1;for(var o in troops_key){var p=h.at(troops_key[o]);if(null==p)break;if(p.gnrl_num==j.gnrl_num){isExist=!0;break}}if(!isExist)for(var w in user_weekly_troops_general)if(user_weekly_troops_general[w].gnrl_num==j.gnrl_num){isExist=!0;break}if(!isExist){var q=NetService().get_great_wall_troops_info().partin_generals;for(var r in q)if(q[r].gnrl_id==j.gnrl_id&&q[r].gnrl_num==j.gnrl_num){isExist=!0;break}}if(!w_service.isWorldWarUnification()&&w_service.isWorldWarPeriodOpen()&&!isExist)for(var s=world_war_troops_generals.keys(),tg=0;tg<s.length;tg++)if(world_war_troops_generals.at(s[tg]).gnrl_id==j.gnrl_id&&world_war_troops_generals.at(s[tg]).gnrl_num==j.gnrl_num){isExist=!0;break}var t=this.isPartnerGeneral(k),is_friend_partner=this.isFriendPartner(k.gnrl_id,k.gnrl_num);if((t||is_friend_partner||"y"==j.lock_yn||"y"==j.using_in_camp)&&(isExist=!0),!isExist){n.gnrl_id=j.gnrl_id,n.gnrl_num=j.gnrl_num,n.gnrl_level=j.gnrl_level,n.level=j.gnrl_level,n.gnrl_exp=j.gnrl_exp,n.limit_step_id=j.limit_step_id,n.love_level=j.love_level,0==j.display_class?n.display_class=g.gnrl_class:n.display_class=j.display_class;g=mt.get_General(n.gnrl_id);n.name=g.name,n.base_attk=g.attk,n.base_def=g.def,n.base_hp=g.hp,n.base_sp=g.sp,n.active_skill=g.active_skill_id,n.class_type=g.gnrl_class,n.element_type=g.element_type,n.cost=g.cost,n.gnrl_type=g.gnrl_type,n.gnrl_group=g.gnrl_group,n.level_exp_group=g.level_exp_group,n.fight_type=g.fight_type,n.bone_id=g.bone_id,(s=new db.UserGeneralKey).gnrl_id=n.gnrl_id,s.gnrl_num=n.gnrl_num,n.arm_service_type=g.arm_service_type,n.rare_type=g.rare_type,n.attk=this.getUserGeneralAttk(n),n.def=this.getUserGeneralDef(n),n.hp=this.getUserGeneralHp(n),n.sp=n.base_sp,n.master_type=g.master_type,n.state_type=g.state_type,0<n.limit_step_id?n.max_level=this.getLimitOverMaxLevel(n.limit_step_id):n.max_level=g.max_level,n.sell_gold=g.sell_gold,n.sell_yhpt=g.sell_yhpt,n.max_class_type=g.evolution_max_class_type,n.passive_skill.push(g.passive_skill_id),n.leader_skill.push(g.leader_skill_id),g.trans_passive_skill_id.split(",").forEach(function(a){var b=parseInt(a);n.trans_passive_skill.push_back(b)}),n.special_leader_skill.push(g.special_leader_skill_id),n.max_level==n.gnrl_level&&(n.isMaxLevel=!0);var u=mt.get_GeneralDivision(g.gnrl_group);n.gender_type=u.general_gender_type,d.push(n)}}}}},GeneralService.prototype.isWorldWarGnrlEquipping=function(a){var b=WorldWarService.getInstance();if(b.isWorldWarUnification())return!1;if(!b.isWorldWarPeriodOpen())return!1;for(var c=NetServiceV3.getInstance().get_list_User_World_War_General_Equipment_Item(),found_is=!1,key=c.keys(),idx=0;idx<key.length;idx++){var d=c.at(key[idx]);if(idx,a.gnrl_id==d.gnrl_id&&a.gnrl_num==d.gnrl_num){found_is=!0;break}}return 1==found_is},GeneralService.prototype.isGnrlEquipping=function(a){var b=NetService().getUserGnrlEquipmentList(a);return null!=b&&0!=b.length},GeneralService.prototype.getUserLimitOverMaterialList=function(c,d){var e=[];e=NetService().getUserGeneral(e);var f=NetService().getUserPartyGeneral(),world_war_troops_generals=[];world_war_troops_generals=NetServiceV3.getInstance().getUserPartyGeneral();for(var h=WorldWarService.getInstance(),mt=MasterManager.getInstance(),idx=0;idx<e.length;idx++){var i=e[idx];if(null!=i.gnrl_id){var g=mt.get_General(i.gnrl_id),b_g=mt.get_General_freeze(c.gnrl_id);if(g.gnrl_type==GENERAL_TYPE_LIMIT_OVER||!(g.gnrl_group!=b_g.gnrl_group||g.gnrl_class<YUNHEE_MAX_CLASS_TYPE)){var j=new db.UserGeneralKey;j.gnrl_id=i.gnrl_id,j.gnrl_num=i.gnrl_num;var k=new net.User_General_Key;if(k.gnrl_id=i.gnrl_id,k.gnrl_num=i.gnrl_num,!this.isGnrlEquipping(k))if(!this.isEventDungeonTroopsGeneral(j)&&(h.isWorldWarUnification()||!h.isWorldWarPeriodOpen()||!this.isWorldWarGnrlEquipping(k))&&i.gnrl_num!=c.gnrl_num){for(var l=new db.UserGeneralInfo,keys=f.keys(),jdx=0;jdx<keys.length;jdx++){if(f.at(keys[jdx]).gnrl_num==i.gnrl_num){l.using_in_troops=!0,l.using_enalbed=0;break}}var m=NetService().get_great_wall_troops_info().partin_generals;for(var n in m)if(m[n].gnrl_id==i.gnrl_id&&m[n].gnrl_num==i.gnrl_num){l.using_in_great_wall_troops=!0,l.using_enalbed=0;break}var o=NetService().get_User_Event_Dungeon_Search_Troops_Generals();for(var p in o)if(o[p].gnrl_id==i.gnrl_id&&o[p].gnrl_num==i.gnrl_num){l.using_in_search_troops=!0,l.using_enalbed=0;break}if(!h.isWorldWarUnification()&&h.isWorldWarPeriodOpen())for(var q=world_war_troops_generals.keys(),tg=0;tg<q.length;tg++)if(world_war_troops_generals.at(q[tg]).gnrl_id==i.gnrl_id&&world_war_troops_generals.at(q[tg]).gnrl_num==i.gnrl_num){l.using_in_world_war_troops=!0,l.using_enalbed=0;break}var r=this.isPartnerGeneral(j),is_friend_partner=this.isFriendPartner(j.gnrl_id,j.gnrl_num);if(r&&(l.isPartner=!0,l.using_enalbed=0),is_friend_partner&&(l.is_friend_partner=!0,l.using_enalbed=0),l.gnrl_id=i.gnrl_id,l.gnrl_num=i.gnrl_num,l.gnrl_level=i.gnrl_level,l.gnrl_exp=i.gnrl_exp,l.limit_step_id=i.limit_step_id,l.love_level=i.love_level,l.is_lock="y"==i.lock_yn,l.using_in_camp="y"==i.using_in_camp,l.buff_type=i.buff_type,(l.is_lock||l.using_in_camp)&&(l.using_enalbed=0),0==i.display_class?l.display_class=g.gnrl_class:l.display_class=i.display_class,g.gnrl_type==GENERAL_TYPE_LIMIT_OVER){if(g.rare_type!=b_g.rare_type)continue;var t=MasterTable.getInstance().get_LimitOverOnlyCardInfo2(g.gnrl_id),is_yunhee_only_card=!1;if(0!=t.only_gnrl_group&&(is_yunhee_only_card=!0),is_yunhee_only_card&&t.only_gnrl_group!=b_g.gnrl_group)continue;if(this.isExistLimitOverCardExceptList(b_g.gnrl_group)&&!is_yunhee_only_card)continue}l.name=g.name,l.base_attk=g.attk,l.base_def=g.def,l.base_hp=g.hp,l.base_sp=g.sp,l.active_skill=g.active_skill_id,l.class_type=g.gnrl_class,l.element_type=g.element_type,l.cost=g.cost,l.gnrl_type=g.gnrl_type,l.gnrl_group=g.gnrl_group,l.level_exp_group=g.level_exp_group;var u=mt.get_GeneralDivision(g.gnrl_group);l.gender_type=u.general_gender_type,(q=new db.UserGeneralKey).gnrl_id=l.gnrl_id,q.gnrl_num=l.gnrl_num,l.arm_service_type=g.arm_service_type,l.rare_type=g.rare_type,l.attk=this.getUserGeneralAttk(l),l.def=this.getUserGeneralDef(l),l.hp=this.getUserGeneralHp(l),l.sp=l.base_sp,l.master_type=g.master_type,l.state_type=g.state_type,0<l.limit_step_id?l.max_level=this.getLimitOverMaxLevel(l.limit_step_id):l.max_level=g.max_level,l.sell_gold=g.sell_gold,l.sell_yhpt=g.sell_yhpt,l.max_class_type=g.evolution_max_class_type,l.passive_skill.push(g.passive_skill_id),l.leader_skill.push(g.leader_skill_id),g.trans_passive_skill_id.split(",").forEach(function(a){var b=parseInt(a);l.trans_passive_skill.push_back(b)});var v=(g.special_leader_skill_id+"").split(",");for(jdx=0;jdx<v.length;jdx++){var s=v[jdx];l.special_leader_skill.push_back(1*s)}l.max_level==l.gnrl_level&&(l.isMaxLevel=!0),d.push(l)}}}}},GeneralService.prototype.isExistLimitOverCardExceptList=function(a){for(var b=MasterTable.getInstance().get_LimitOverCardExceptGeneral(),idx=0;idx<b.length;idx++)if(b[idx].gnrl_group==a&&b[idx].gnrl_type==GENERAL_TYPE_LIMIT_OVER)return!0;return!1},GeneralService.prototype.getMaxNum=function(){return 0},GeneralService.prototype.getGeneralState=function(a){return MasterTable.getInstance().get_General(a).state_type},GeneralService.prototype.getGeneralLevelUpExpPrcnt=function(a){var b=0,gnrl_key=new net.User_General_Key;gnrl_key.gnrl_id=a.gnrl_id,gnrl_key.gnrl_num=a.gnrl_num;var c={};c=NetService().getUserGeneral(c,gnrl_key);var m=MasterManager.getInstance(),general=m.get_General(c.gnrl_id),next_level=c.gnrl_level+1;if((0<c.limit_step_id?this.getLimitOverMaxLevel(c.limit_step_id):general.max_level)<next_level)return 1;var d=m.get_GeneralLevelupExpV2(general.level_exp_group,next_level),_gnrl_exp=m.get_GeneralLevelupExpV2(general.level_exp_group,c.gnrl_level),need_exp=d.need_exp;return c.gnrl_exp-=_gnrl_exp.accm_exp,0!=c.gnrl_exp&&(b=c.gnrl_exp/need_exp),b=Math.floor(1e3*b)/1e3},GeneralService.prototype.getGeneralLoveUpExpPrcnt=function(a){var b=0,gnrl_key=new net.User_General_Key;gnrl_key.gnrl_id=a.gnrl_id,gnrl_key.gnrl_num=a.gnrl_num;var c=NetService().getUserGeneral({},gnrl_key),m=MasterManager.getInstance(),general=m.get_General(c.gnrl_id),next_level=c.love_level+1;if(next_level>YUNHEE_MAX_LOVE_LEVEL)return 1;var d=m.get_LoveLevel(general.rare_type,next_level),_gnrl_love_exp=m.get_LoveLevel(general.rare_type,c.love_level),need_exp=d.need_exp;return c.love_exp-=_gnrl_love_exp.accm_exp,0!=c.love_exp&&(b=c.love_exp/need_exp),b=1e3*b/1e3},GeneralService.prototype.getGeneralLoveUpExpPrcntMtrl=function(a){return MasterManager.getInstance().get_GeneralLevelupExpV2(a.level_exp_group,a.gnrl_level).need_gold},GeneralService.prototype.getGeneralLevelUpExpense=function(a){return MasterTable.getInstance().getMasterTable().get_GeneralLevelupExpV2(a.level_exp_group,a.gnrl_level).need_gold},GeneralService.prototype.getGeneralLevelUpMaterialExp=function(a){return MasterTable.getInstance().getMasterTable().get_GeneralLevelupExpV2(a.level_exp_group,a.gnrl_level).mtrl_exp},GeneralService.prototype.geGeneralLevelUpAfterInfo=function(a,b,c,d){var e=new net.User_General_Key;e.gnrl_id=a.gnrl_id,e.gnrl_num=a.gnrl_num;var f={};f=NetService().getUserGeneral(f,e);var g=b;g+=a.level_exp;var m=MasterManager.getInstance(),general=m.get_General(a.gnrl_id),max_level=0;max_level=0<f.limit_step_id?this.getLimitOverMaxLevel(f.limit_step_id):general.max_level;var h=this.getGeneralLevel(general.level_exp_group,g),next_level=h+1;if(max_level<h)d=max_level,c=1;else{d=h,65<next_level&&(next_level=65);var i=m.get_GeneralLevelupExpV2(general.level_exp_group,next_level),_gnrl_exp=m.get_GeneralLevelupExpV2(general.level_exp_group,h),need_exp=i.need_exp;0!=(g-=_gnrl_exp.accm_exp)&&(c=g/need_exp),c=Math.floor(1e3*c)/1e3}return{level:d,prcnt:c}},GeneralService.prototype.getGeneralLevelUpRemoveAfterInfo=function(a,b,c,d){var e=new net.User_General_Key;e.gnrl_id=a.gnrl_id,e.gnrl_num=a.gnrl_num;var f=new net.User_General;f=NetService().getUserGeneral(f,e);var g=a.level_exp-b,m=MasterManager.getInstance(),general=m.get_General(a.gnrl_id),max_level=0;max_level=0<f.limit_step_id?this.getLimitOverMaxLevel(f.limit_step_id):general.max_level;var h=this.getGeneralLevel(general.level_exp_group,g),next_level=h+1;if(max_level<h)d=max_level,c=1;else{d=h;var i=m.get_GeneralLevelupExpV2(general.level_exp_group,next_level),_gnrl_exp=m.get_GeneralLevelupExpV2(general.level_exp_group,h),need_exp=i.need_exp;if(0!=(g-=_gnrl_exp.accm_exp))c=g/need_exp,c=Math.floor(1e3*c)/1e3;else c=0}return{level:d,prcnt:c}},GeneralService.prototype.geGeneralLoveUpAfterInfo=function(a,b,c,d){var e=b,after_level=0;e+=a.level_exp;for(var m=MasterTable.getInstance().getMasterTable(),max_level=YUNHEE_MAX_LOVE_LEVEL,i=2;i<=max_level;i++)if(i<=max_level){if(!(e>=(f=m.get_LoveLevel(a.rare_type,i)).need_exp)){var f;after_level=f.level,d=f.level-1;var g=1e3*(c=e/(f=m.get_LoveLevel(a.rare_type,after_level)).need_exp);c=0!=g?g/1e3:0;break}max_level<=i?(d=max_level,c=0):e-=f.need_exp}else d=max_level,c=0;return{level:d,prcnt:c}},GeneralService.prototype.getBookGeneralInfo=function(a,b){return 0},GeneralService.prototype.getGeneralLevel=function(a,b){var c=0,g=MasterManager.getInstance().get_AllGeneralLevelupExpV2().filter(function(t){if(t.level_exp_group==a&&t.accm_exp<=b)return!0});return 0!=g.length&&(g.sort(function(l,r){return l.gnrl_level<r.gnrl_level?1:l.gnrl_level>r.gnrl_level?-1:0}),c=g[0].gnrl_level),c},GeneralService.prototype.getGeneralLoveUpRemoveAfterInfo=function(a,b,c,d){for(var e=a.level_exp-b,after_level=0,m=MasterTable.getInstance(),max_level=YUNHEE_MAX_LOVE_LEVEL,i=2;i<=max_level;i++){if(!(e>=(f=m.get_LoveLevel(a.rare_type,i)).need_exp)){var f;after_level=f.level,d=f.level-1;var g=1e3*(e/(f=m.get_LoveLevel(a.rare_type,after_level)).need_exp);0!=g?g/1e3:0,d<1&&(d=1);break}e-=f.need_exp}},GeneralService.prototype.getUserYunheeCount=function(){return NetService().getUserGeneralCount()},GeneralService.prototype.getGeneralClassType=function(a){return MasterManager.getInstance().get_General(a).gnrl_class},GeneralService.prototype.getGeneralName=function(a){return MasterManager.getInstance().get_General(a).name},GeneralService.prototype.getCardInfo=function(a,b){var c=new net.User_General,gnrl_key=new net.User_General_Key;gnrl_key.gnrl_id=a.gnrl_id,gnrl_key.gnrl_num=a.gnrl_num,c=NetService().getUserGeneral({},gnrl_key),b.gnrl_id=c.gnrl_id,b.level=c.gnrl_level;var d=MasterManager.getInstance().get_General(c.gnrl_id),max_level=0;max_level=0<c.limit_step_id?this.getLimitOverMaxLevel(c.limit_step_id):d.max_level,c.gnrl_level==max_level&&(b.is_max_level=!0)},GeneralService.prototype.getCastleName=function(a){return MasterTable.getInstance().get_Unification(a).name},GeneralService.prototype.getGeneralArmpServiceType=function(a){switch(a){case ARMSERVICETYPE_INFANTRY:return"剣兵";case ARMSERVICETYPE_SPEAR:return"槍兵";case ARMSERVICETYPE_ARCHER:return"弓兵";case ARMSERVICETYPE_NONE:return""}return""},GeneralService.prototype.getGeneralStateType=function(a){switch(a){case STATE_TYPE_DONG:return"董";case STATE_TYPE_WIE:return"魏";case STATE_TYPE_CHOCK:return"蜀";case STATE_TYPE_O:return"呉";case STATE_TYPE_WON:return"袁";case STATE_TYPE_JAE:return"帝";case STATE_TYPE_WAE:return res_str("btn_label_wae")}return""},GeneralService.prototype.getLoveStat=function(a,b){var c=MasterTable.getInstance().getMasterTable().get_AllLoveStat();if(null==b){var d=[];for(var e in c)if(c[e].love_stat_group==a){var f={};f.idx=c[e].idx,f.love_stat_group=c[e].love_stat_group,f.love_level=c[e].love_level,f.content=c[e].content,d.push(f)}return d}for(var e in c)if(c[e].love_stat_group==a&&c[e].love_level==b)return c[e];return{idx:0,love_stat_group:0,love_level:0,content:"",stat_type_1:0,value_1:0,stat_type_2:0,value_2:0,stat_type_3:0,value_3:0}},GeneralService.prototype.getGeneralEvolutionInfo=function(a,b,c){var d=MasterTable.getInstance().getMasterTable().get_GeneralEvolution(a);c=d.evolution_need_gold;var e={};(f={slot_num:1}).slot_type=d.slot_1_type,f.slot_value_1=d.slot_1_value_1,f.slot_value_2=d.slot_1_value_2,e.mtrl_info=f,e.isExist=!1,0!=f.slot_type&&b.push(e);e={};(f={slot_num:2}).slot_type=d.slot_2_type,f.slot_value_1=d.slot_2_value_1,f.slot_value_2=d.slot_2_value_2,e.mtrl_info=f,e.isExist=!1,0!=f.slot_type&&b.push(e);e={};(f={slot_num:3}).slot_type=d.slot_3_type,f.slot_value_1=d.slot_3_value_1,f.slot_value_2=d.slot_3_value_2,e.mtrl_info=f,e.isExist=!1,0!=f.slot_type&&b.push(e);e={};(f={slot_num:4}).slot_type=d.slot_4_type,f.slot_value_1=d.slot_4_value_1,f.slot_value_2=d.slot_4_value_2,e.mtrl_info=f,e.isExist=!1,0!=f.slot_type&&b.push(e);var f;e={};return(f={slot_num:5}).slot_type=d.slot_5_type,f.slot_value_1=d.slot_5_value_1,f.slot_value_2=d.slot_5_value_2,e.mtrl_info=f,e.isExist=!1,0!=f.slot_type&&b.push(e),cc.log(f.slot_type),c},GeneralService.prototype.getGeneralRebirthInfo=function(a,b){var c=MasterManager.getInstance().get_GeneralRebirthInfo(a),need_gold=c.need_gold,info=new db.UserGeneralEvolutionMaterialInfo,ev_info=new db.GeneralEvolutionMaterialSlotInfo;ev_info.slot_num=1,ev_info.slot_type=c.slot_1_type,ev_info.slot_value_1=c.slot_1_value_1,ev_info.slot_value_2=c.slot_1_value_2,info.mtrl_info=ev_info,info.isExist=!1,0!=ev_info.slot_type&&b.push_back(info);var d=new db.UserGeneralEvolutionMaterialInfo,ev_info_2=new db.GeneralEvolutionMaterialSlotInfo;ev_info_2.slot_num=2,ev_info_2.slot_type=c.slot_2_type,ev_info_2.slot_value_1=c.slot_2_value_1,ev_info_2.slot_value_2=c.slot_2_value_2,d.mtrl_info=ev_info_2,d.isExist=!1,0!=ev_info_2.slot_type&&b.push_back(d);var e=new db.UserGeneralEvolutionMaterialInfo,ev_info_3=new db.GeneralEvolutionMaterialSlotInfo;ev_info_3.slot_num=3,ev_info_3.slot_type=c.slot_3_type,ev_info_3.slot_value_1=c.slot_3_value_1,ev_info_3.slot_value_2=c.slot_3_value_2,e.mtrl_info=ev_info_3,e.isExist=!1,0!=ev_info_3.slot_type&&b.push_back(e);var f=new db.UserGeneralEvolutionMaterialInfo,ev_info_4=new db.GeneralEvolutionMaterialSlotInfo;ev_info_4.slot_num=4,ev_info_4.slot_type=c.slot_4_type,ev_info_4.slot_value_1=c.slot_4_value_1,ev_info_4.slot_value_2=c.slot_4_value_2,f.mtrl_info=ev_info_4,f.isExist=!1,0!=ev_info_4.slot_type&&b.push_back(f);var g=new db.UserGeneralEvolutionMaterialInfo,ev_info_5=new db.GeneralEvolutionMaterialSlotInfo;return ev_info_5.slot_num=5,ev_info_5.slot_type=c.slot_5_type,ev_info_5.slot_value_1=c.slot_5_value_1,ev_info_5.slot_value_2=c.slot_5_value_2,g.mtrl_info=ev_info_5,g.isExist=!1,0!=ev_info_5.slot_type&&b.push_back(g),need_gold},GeneralService.prototype.isExistRebirthMtrl=function(a){var b=MasterManager.getInstance().get_GeneralRebirthInfo(a),mtrl_info=NetService().get_User_Rebirth_Mtrl_Info();null!=mtrl_info.mtrl_count&&null!=mtrl_info.mtrl_count||(mtrl_info.mtrl_count=0);for(var c=mtrl_info.keys(),idx=0;idx<c.length;idx++){var d=mtrl_info.at(c[idx]);if(b.slot_1_type==c[idx]){if(d.mtrl_count<b.slot_1_value_1)return!1}else if(b.slot_2_type==c[idx]){if(d.mtrl_count<b.slot_2_value_1)return!1}else if(b.slot_3_type==c[idx]){if(d.mtrl_count<b.slot_3_value_1)return!1}else if(b.slot_4_type==c[idx]){if(d.mtrl_count<b.slot_4_value_1)return!1}else if(b.slot_5_type==c[idx]&&d.mtrl_count<b.slot_5_value_1)return!1}return!0},GeneralService.prototype.isEnabledRebirth=function(a){var b=MasterManager.getInstance();if(a.class_type>=a.max_class_type&&(b.get_CountFunction(COUNT_FUNCTION_GENERAL_REBIRTH_ENABLE_LEVEL).value<=a.gnrl_level&&YUNHEE_MAX_LOVE_LEVEL<=a.love_level))return this.isExistRebirthMtrl(a.gnrl_group);return!1},GeneralService.prototype.isRebirthObject=function(a,b,c){if(a>YUNHEE_MAX_CLASS_TYPE)return!1;if(c!=GENERAL_TYPE_YUNHEE)return!1;var d=MasterManager.getInstance().get_GeneralRebirthInfo(b);return!(moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf()<moment(d.rebirth_beg_dt).valueOf())&&(0!=d.rebirth_gnrl_group&&null!=d.rebirth_gnrl_group)},GeneralService.prototype.getUserHwandanInfo=function(a){var b=arguments;switch(b.length){case 1:b[0];return a=NetService().get_User_Hwandan_Info();case 2:var c=b[0],info=b[1],key={};return key.class_type=c,null==(info=NetService().get_User_Hwandan_Info(key.class_type))&&((info={}).hwandan_class=c,info.hwandan_count=0),info;default:return}},GeneralService.prototype.getUserEvolveArmServiceMtrlInfo=function(a){var b=this.geEvolveTypeToArmServiceType(a),class_type=this.geEvolveTypeToArmServiceClassType(a),key={};key.arm_service_type=b,key.class_type=class_type;var c=NetService().get_User_Evolve_Arm_Service_Mtrl(key);return null==c&&((c={}).arm_service_type=b,c.class_type=class_type,c.mtrl_count=0),c},GeneralService.prototype.getUserLoveItem=function(a,b){var c=[];NetService().getUserLoveItem(c);var d=MasterManager.getInstance(),love_ids=[];if(this.isExistLoveItemInGnrlGroup(a,love_ids))for(var e in love_ids){var f=love_ids[e];for(var g in c){if(null==(i=c[g]).love_id)break;if(f.love_id==i.love_id){var h=d.get_LoveItem(i.love_id);(info=new db.UserLoveItemInfo).love_id=i.love_id,info.count=i.count,info.name=h.name,info.content=h.content,info.point=h.point,info.arm_service_type=h.arm_service_type,info.point_prcnt=h.point_prcnt,info.need_gold=h.need_gold,info.gnrl_id=i.gnrl_id,0!=info.count&&b.push(info)}}}else for(var g in c){var i,info;if(null==(i=c[g]).love_id)break;if(0==(h=d.get_LoveItem(i.love_id)).gnrl_group)(info=new db.UserLoveItemInfo).love_id=i.love_id,info.count=i.count,info.name=h.name,info.content=h.content,info.point=h.point,info.arm_service_type=h.arm_service_type,info.point_prcnt=h.point_prcnt,info.need_gold=h.need_gold,info.gnrl_id=i.gnrl_id,0!=info.count&&b.push(info)}},GeneralService.prototype.isExistLoveItemInGnrlGroup=function(a,b){var c=!1,love_items=[];love_items=MasterTable.getInstance().get_LoveItems(love_items);for(var d=0;d<love_items.length;d++)love_items[d].gnrl_group==a&&(b.push(love_items[d]),c=!0);return c},GeneralService.prototype.getLoveUpMaxLevelNeedItemCount=function(a,b){var c=0,item_exp=b.point,need_exp=MasterTable.getInstance().getMasterTable().get_LoveLevel(a.rare_type,YUNHEE_MAX_LOVE_LEVEL).accm_exp-a.love_exp;return a.arm_service_type==b.arm_service_type&&(item_exp=item_exp*b.point_prcnt/100),c=need_exp/item_exp,0<need_exp%item_exp&&(c+=1),Math.floor(c)},GeneralService.prototype.getEvolutionGnrlInfo=function(a){var b=a.gnrl_group,gnrl_class=a.class_type+1,map_general=MasterManager.getInstance().get_AllGeneral();for(var g in map_general)if(map_general[g].gnrl_group==b&&map_general[g].gnrl_class==gnrl_class)return map_general[g];return 0},GeneralService.prototype.getEvolutionMaterialInfo=function(a,b,c,d){var e=[];NetService().getUserGeneral(e);var f=MasterTable.getInstance(),partner=GameContext.getInstance().getUserGeneralPartner(),friend_partner=GameContext.getInstance().getUserFriendPartner();for(var h in e)if(!(partner.gnrl_num==h.gnrl_num&&partner.gnrl_id==h.gnrl_id||friend_partner.gnrl_num==h.gnrl_num&&friend_partner.gnrl_id==h.gnrl_id||b!=h.gnrl_id||"y"==h.lock_yn||h.gnrl_num==a||"y"==h.using_in_camp)){var i=new db.EvolveMaterialInfo;i.gnrl_id=h.gnrl_id,i.gnrl_num=h.gnrl_num,i.gnrl_level=h.gnrl_level;var g=f.get_General(i.gnrl_id);for(var j in i.name=g.name,i.class_type=g.gnrl_class,i.cost=g.cost,i.arm_service_type=g.arm_service_type,i.max_class_type=g.evolution_max_class_type,i.state_type=g.state_type,i.rare_type=g.rare_type,c)if(j.second.gnrl_id==h.gnrl_id&&j.second.gnrl_num==h.gnrl_num){i.slot_num=j.first;break}i.is_use=this.isExistGeneralInTroops(h.gnrl_num),d.push(i)}},GeneralService.prototype.getEvolutionMaterialInfoClassType=function(a,b,c,d,e){var f=[];NetService().getUserGeneral(f);var h=MasterTable.getInstance(),partner=GameContext.getInstance().getUserGeneralPartner(),friend_partner=GameContext.getInstance().getUserFriendPartner();for(var i in f)if(!(partner.gnrl_num==i.gnrl_num&&partner.gnrl_id==i.gnrl_id||friend_partner.gnrl_num==i.gnrl_num&&friend_partner.gnrl_id==i.gnrl_id||"y"==i.lock_yn||i.gnrl_num==a||"y"==i.using_in_camp||"y"==i.lock_yn||i.gnrl_num==a||"y"==i.using_in_camp)){var j=new db.EvolveMaterialInfo;j.gnrl_id=i.gnrl_id,j.gnrl_num=i.gnrl_num,j.gnrl_level=i.gnrl_level;var g=h.get_General(j.gnrl_id);if(j.name=g.name,j.class_type=g.gnrl_class,g.gnrl_class==c&&g.rare_type==b){for(var k in d)if(k.second.gnrl_id==i.gnrl_id&&k.second.gnrl_num==i.gnrl_num){j.slot_num=k.first;break}j.cost=g.cost,j.arm_service_type=g.arm_service_type,j.max_class_type=g.evolution_max_class_type,j.state_type=g.state_type,j.crrnt_rare_type=g.rare_type,j.rare_type=g.rare_type,j.is_use=this.isExistGeneralInTroops(i.gnrl_num),e.push(j)}}},GeneralService.prototype.getYunheeRetentionInfo=function(){var a=new MasterManager.getInstance,gf=a.get_GoodsFunction(GOODS_FUNCTION_YUNHEE_BOUND),value=gf.value,bonus_type=gf.bonus_type,bonus_type_name=a.get_BonusType(bonus_type).name,info={};return info.name=bonus_type_name,info.value=value,info},GeneralService.prototype.isEnableLimitOver=function(a,b){var c=new db.UserGeneralKey;c.gnrl_id=a,c.gnrl_num=b;var d=new db.UserGeneralInfo;return this.getUserGeneralInfo(c,d),!(d.class_type<d.max_class_type)&&!(d.gnrl_level<d.max_level)},GeneralService.prototype.isMaxLimitOver=function(a,b){var c=new db.UserGeneralKey;c.gnrl_id=a,c.gnrl_num=b;var d=new db.UserGeneralInfo;return this.getUserGeneralInfo(c,d),d.limit_step_id>=MAX_LIMIT_OVER_STEP},GeneralService.prototype.getLimitOverInfo=function(a){var b=MasterManager.getInstance(),next_limit_step_id=a.limit_step_id+1;return b.get_GeneralLimit(next_limit_step_id)},GeneralService.prototype.isExistEvolutionMtlrGeneral=function(a,b){var c=[];this.getCheckEvolutionGeneral(c);for(var d=[],i=0;i<c.length;i++){var g=new db.EvolutionMtrlCheckInfo;return rare_type==g.rare_type&&class_type==g.class_type&&g.gnrl_num!=key.gnrl_num?(d.push(!0),!0):(d.push(!1),!1)}return d!=c.end()},GeneralService.prototype.getCheckEvolutionGeneral=function(a){var b=[];NetService().getUserGeneral(b);var c=db.MasterTable.getInstance();for(var d in b){var e=new db.EvolutionMtrlCheckInfo;e.gnrl_id=d.gnrl_id,e.gnrl_num=d.gnrl_num;var g=c.get_General(e.gnrl_id);e.rare_type=g.rare_type,e.class_type=g.gnrl_class,a.push(e)}},GeneralService.prototype.getShortcutList=function(a){var b=MasterTable.getInstance().get_ShotCuts_V2(),list=[];for(var c in b){if(null==b[c])break;b[c].bonus_type==a&&list.push(b[c])}return list},GeneralService.prototype.getGnrlType=function(a){return MasterManager.getInstance().get_General(a).gnrl_type},GeneralService.prototype.getNextClassTypePassiveId=function(a,b){var c=0,next_class_type=b+1,map_general=MasterManager.getInstance().get_AllGeneral();for(var g in map_general)map_general[g].evolution_group_num==a&&map_general[g].gnrl_class==next_class_type&&(c=map_general[g].passive_skill_id);return c},GeneralService.prototype.getNextClassTypeTransPassiveId=function(c,d){var e=0,next_class_type=d+1,map_general=MasterManager.getInstance().get_AllGeneral(),info=[];for(var g in map_general){if(map_general[g].evolution_group_num==c&&map_general[g].gnrl_class==next_class_type)e=map_general[g].trans_passive_skill_id,map_general[g].trans_passive_skill_id.split(",").forEach(function(a){var b=parseInt(a);info.push_back(b)})}return 0<info.length&&(e=info[0]),e},GeneralService.prototype.getUserFormationPositionLevelUpCount=function(a){for(var b=0,i=0;i<5;++i){var c=0;0==i?c=COMBO_STAT_ATTK:1==i?c=COMBO_STAT_DEF:2==i?c=COMBO_STAT_HP:3==i?c=COMBO_STAT_CRI_PRCNT:4==i&&(c=COMBO_STAT_CRI_DMG);for(var d=0,m_user_battle_formation=NetService().get_User_Battle_Formation(),key=m_user_battle_formation.keys(),idx=0;idx<key.length;idx++)m_user_battle_formation.at(key[idx]).position_type==a&&m_user_battle_formation.at(key[idx]).combo_stat==c&&(d=m_user_battle_formation.at(key[idx]).formation_id);b+=MasterManager.getInstance().get_BattleFormationV2(d,a,c).formation_level-1}return b},GeneralService.prototype.getFormationMaxLevelUpCount=function(b){for(var c=0,i=0;i<5;++i){var d=0;0==i?d=COMBO_STAT_ATTK:1==i?d=COMBO_STAT_DEF:2==i?d=COMBO_STAT_HP:3==i?d=COMBO_STAT_CRI_PRCNT:4==i&&(d=COMBO_STAT_CRI_DMG);var f=MasterManager.getInstance().get_All_BattleFormationV2().filter(function(a){if(a.position_type==b&&a.combo_stat==d)return!0});f.sort(function(l,r){return l.formation_level<r.formation_level?1:l.formation_level>r.formation_level?-1:0});try{c+=f[0].formation_level-1}catch(e){c+=0}}return c},GeneralService.prototype.checkEvolveSlotTypeMtrl=function(a,b,c,d){var e=this.getUserHwandanInfo([]),orb_count=NetService().get_User_Evolve_Orb(),evolveArmServiceInfo=UserService.getInstance().getUserEvolveArmServiceMtrl();if(b==EVOLVE_MTRL_TYPE_CLASS_1||b==EVOLVE_MTRL_TYPE_CLASS_2||b==EVOLVE_MTRL_TYPE_CLASS_3||b==EVOLVE_MTRL_TYPE_CLASS_4||b==EVOLVE_MTRL_TYPE_CLASS_5||b==EVOLVE_MTRL_TYPE_CLASS_6||b==EVOLVE_MTRL_TYPE_YUBI_RARE)for(var f=e.keys(),hdx=0;hdx<f.length;hdx++){var g=e.at(f[hdx]);if(b==EVOLVE_MTRL_TYPE_CLASS_1&&g.hwandan_class==HWANDAN_CLASS_1)return!(c>g.hwandan_count);if(b==EVOLVE_MTRL_TYPE_CLASS_2&&g.hwandan_class==HWANDAN_CLASS_2)return!(c>g.hwandan_count);if(b==EVOLVE_MTRL_TYPE_CLASS_3&&g.hwandan_class==HWANDAN_CLASS_3)return!(c>g.hwandan_count);if(b==EVOLVE_MTRL_TYPE_CLASS_4&&g.hwandan_class==HWANDAN_CLASS_4)return!(c>g.hwandan_count);if(b==EVOLVE_MTRL_TYPE_CLASS_5&&g.hwandan_class==HWANDAN_CLASS_5)return!(c>g.hwandan_count);if(b==EVOLVE_MTRL_TYPE_CLASS_6&&g.hwandan_class==HWANDAN_CLASS_6)return!(c>g.hwandan_count);if(b==EVOLVE_MTRL_TYPE_YUBI_RARE&&g.hwandan_class==HWANDAN_CLASS_YUBI)return!(c>g.hwandan_count)}if(b==EVOLVE_MTRL_TYPE_ORB)return!(orb_count<c);if(b==EVOLVE_MTRL_TYPE_MELEE||b==EVOLVE_MTRL_TYPE_LANCER||b==EVOLVE_MTRL_TYPE_ARCHER||b==EVOLVE_MTRL_TYPE_MELEE_MIDDLE||b==EVOLVE_MTRL_TYPE_LANCER_MIDDLE||b==EVOLVE_MTRL_TYPE_ARCHER_MIDDLE||b==EVOLVE_MTRL_TYPE_MELEE_LOW||b==EVOLVE_MTRL_TYPE_LANCER_LOW||b==EVOLVE_MTRL_TYPE_ARCHER_LOW||b==EVOLVE_MTRL_TYPE_YUBI_HIGH||b==EVOLVE_MTRL_TYPE_YUBI_MIDDLE||b==EVOLVE_MTRL_TYPE_YUBI_LOW)for(var h=evolveArmServiceInfo.keys(),adx=0;adx<h.length;adx++){var i=evolveArmServiceInfo.at(h[adx]);if(b==EVOLVE_MTRL_TYPE_MELEE&&i.arm_service_type==ARMSERVICETYPE_INFANTRY&&i.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_HIGH)return!(c>i.mtrl_count);if(b==EVOLVE_MTRL_TYPE_LANCER&&i.arm_service_type==ARMSERVICETYPE_SPEAR&&i.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_HIGH)return!(c>i.mtrl_count);if(b==EVOLVE_MTRL_TYPE_ARCHER&&i.arm_service_type==ARMSERVICETYPE_ARCHER&&i.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_HIGH)return!(c>i.mtrl_count);if(b==EVOLVE_MTRL_TYPE_MELEE_MIDDLE&&i.arm_service_type==ARMSERVICETYPE_INFANTRY&&i.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_MIDDLE)return!(c>i.mtrl_count);if(b==EVOLVE_MTRL_TYPE_LANCER_MIDDLE&&i.arm_service_type==ARMSERVICETYPE_SPEAR&&i.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_MIDDLE)return!(c>i.mtrl_count);if(b==EVOLVE_MTRL_TYPE_ARCHER_MIDDLE&&i.arm_service_type==ARMSERVICETYPE_ARCHER&&i.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_MIDDLE)return!(c>i.mtrl_count);if(b==EVOLVE_MTRL_TYPE_MELEE_LOW&&i.arm_service_type==ARMSERVICETYPE_INFANTRY&&i.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_LOW)return!(c>i.mtrl_count);if(b==EVOLVE_MTRL_TYPE_LANCER_LOW&&i.arm_service_type==ARMSERVICETYPE_SPEAR&&i.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_LOW)return!(c>i.mtrl_count);if(b==EVOLVE_MTRL_TYPE_ARCHER_LOW&&i.arm_service_type==ARMSERVICETYPE_ARCHER&&i.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_LOW)return!(c>i.mtrl_count);if(b==EVOLVE_MTRL_TYPE_YUBI_HIGH&&i.arm_service_type==ARMSERVICETYPE_INFANTRY&&i.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_EVENT_HIGH)return!(c>i.mtrl_count);if(b==EVOLVE_MTRL_TYPE_YUBI_MIDDLE&&i.arm_service_type==ARMSERVICETYPE_INFANTRY&&i.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_EVENT_MIDDLE)return!(c>i.mtrl_count);if(b==EVOLVE_MTRL_TYPE_YUBI_LOW&&i.arm_service_type==ARMSERVICETYPE_INFANTRY&&i.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_EVENT_LOW)return!(c>i.mtrl_count)}return!1},GeneralService.prototype.isExistEvolutionMtrl=function(a,b){var c=[];this.getGeneralEvolutionInfo(b,c,0);for(var d=0;d<c.length;d++){var e=c[d];if(!this.checkEvolveSlotTypeMtrl(a,e.mtrl_info.slot_type,e.mtrl_info.slot_value_1,e.mtrl_info.slot_value_2))return!1}return!0},GeneralService.prototype.isEnabledLimitOver=function(a){if(a.class_type>=a.max_class_type&&a.gnrl_level>=a.max_level){if(a.limit_step_id<MAX_LIMIT_OVER_STEP){var b=this.isExistSameGeneral(a.gnrl_id,a.gnrl_num);return!!b||!!(b=this.isExistLimitOverCard(a))}return!1}return!1},GeneralService.prototype.isExistLimitOverCard=function(a){var b=MasterManager.getInstance(),m=MasterTable.getInstance(),general=b.get_General_freeze(a.gnrl_id),need_mtrl_list=[];if(this.isExistLimitOverCardExceptList(general.gnrl_group)){for(var c=!1,only_card_info_list=m.get_LimitOverOnlyCardList(),idx=0;idx<only_card_info_list.length;idx++){var d=only_card_info_list[idx];if(general.gnrl_group==d.only_gnrl_group&&d.rare_type==a.rare_type&&d.limit_over_step==a.limit_step_id){c=!0,need_mtrl_list.push_back(d);break}}if(!c)return!1}else for(only_card_info_list=m.get_LimitOverOnlyCardList(),idx=0;idx<only_card_info_list.length;idx++){d=only_card_info_list[idx];general.rare_type!=d.rare_type||a.limit_step_id!=d.limit_over_step||0!=d.only_gnrl_group&&d.only_gnrl_group!=general.gnrl_group||need_mtrl_list.push_back(d)}var e=[];NetService().getUserGeneral(e);for(idx=0;idx<need_mtrl_list.length;idx++){for(var f=need_mtrl_list[idx],count=0,jdx=0;jdx<e.length;jdx++){var g=e[jdx];b.get_General(g.gnrl_id).gnrl_id==f.need_mtrl_gnrl_id&&count++}if(0<f.need_count&&f.need_count<=count)return!0}return!1},GeneralService.prototype.isExistSameGeneral=function(a,b){var c=MasterManager.getInstance(),user_gnrls=[];NetService().getUserGeneral(user_gnrls);for(var d=c.get_General_freeze(a),idx=0;idx<user_gnrls.length;idx++){var e=user_gnrls[idx],mtrl_gnrl=c.get_General_freeze(e.gnrl_id);if(mtrl_gnrl.gnrl_group==d.gnrl_group&&mtrl_gnrl.gnrl_type!=GENERAL_TYPE_LIMIT_OVER&&mtrl_gnrl.gnrl_class>=YUNHEE_MAX_CLASS_TYPE&&e.gnrl_num!=b)return!0}return!1},GeneralService.prototype.isLeader=function(a,b,c){for(var g in NetService.list_User_Troops_General)if(g.troops_num==a&&g.gnrl_id==b&&g.gnrl_num==c)return"y"==g.leader_yn;return!1},GeneralService.prototype.isPartner=function(a,b){var c=GameContext.getInstance().getUserGeneralPartner();return c.gnrl_id==a&&c.gnrl_num==b},GeneralService.prototype.isFriendPartner=function(a,b){var c=GameContext.getInstance().getUserFriendPartner();return null!=c&&(c.gnrl_id==a&&c.gnrl_num==b)},GeneralService.prototype.isExistUserTroopsGeneral=function(a){var b=[];NetService().getUserPartyGeneral(b);for(var c=b.begin();c!=b.end();){if(c.troops_num==a.troops_num&&c.gnrl_id==a.gnrl_id&&c.gnrl_num==a.gnrl_num){!0;break}++c}return!1},GeneralService.prototype.isExistUserTroopsPos=function(a,b){for(var c=NetService().getUserPartyGeneral(),isExist=!1,key=c.keys(),idx=0;idx<key.length;idx++)if(c.at(key[idx]).troops_num==a&&c.at(key[idx]).position==b){isExist=!0;break}return isExist},GeneralService.prototype.getUserFriendPartnerId=function(){return GameContext.getInstance().getUserFriendPartner().gnrl_id},GeneralService.prototype.getUserFriendPartnerKey=function(){var a=GameContext.getInstance().getUserFriendPartner();(void 0).gnrl_id=a.gnrl_id,(void 0).gnrl_num=a.gnrl_num},GeneralService.prototype.getUserTroopsGeneralDistinctList=function(a){for(var b=new Set,user_troops_general=NetService().getUserPartyGeneral(),keys=user_troops_general.keys(),idx=0;idx<keys.length;idx++){var c=keys[idx],obj={id:user_troops_general.at(c).gnrl_id,num:user_troops_general.at(c).gnrl_num};if(!b.has(JSON.stringify(obj))){b.add(JSON.stringify(obj));var d={};d.gnrl_id=user_troops_general.at(c).gnrl_id,d.gnrl_num=user_troops_general.at(c).gnrl_num,d.troops_num=user_troops_general.at(c).troops_num,d.pos_type=user_troops_general.at(c).position,d.is_leader="y"==user_troops_general.at(c).leader_yn,a.push(d)}}},GeneralService.prototype.getUserTroopsGeneralList=function(a){for(var b=[],user_troops_general=NetService().getUserPartyGeneral(),keys=user_troops_general.keys(),idx=0;idx<keys.length;idx++){var c,key=keys[idx];if(null==user_troops_general.at(key).gnrl_id)break;if("number"==typeof a){if(user_troops_general.at(key).troops_num==a)(c={}).gnrl_id=user_troops_general.at(key).gnrl_id,c.gnrl_num=user_troops_general.at(key).gnrl_num,c.troops_num=user_troops_general.at(key).troops_num,c.pos_type=user_troops_general.at(key).position,c.is_leader="y"==user_troops_general.at(key).leader_yn,b.push(c)}else(c={}).gnrl_id=user_troops_general.at(key).gnrl_id,c.gnrl_num=user_troops_general.at(key).gnrl_num,c.troops_num=user_troops_general.at(key).troops_num,c.pos_type=user_troops_general.at(key).position,c.is_leader="y"==user_troops_general.at(key).leader_yn,b.push(c)}return b},GeneralService.prototype.getTroopsGeneralCount=function(a){for(var b=0,user_troops_general=NetService().getUserPartyGeneral(),key=user_troops_general.keys(),idx=0;idx<key.length;idx++)user_troops_general.at(key[idx]).troops_num==a&&b++;return b},GeneralService.prototype.isExistGeneralInTroops=function(a,b){var c=!1,user_troops_general=NetService().getUserPartyGeneral(),key=user_troops_general.keys();if(null==b){for(var d=0;d<key.length;d++)if(user_troops_general.at(key[d]).gnrl_num==a){c=!0;break}}else for(d=0;d<key.length;d++)if(user_troops_general.at(key[d]).gnrl_num==b&&user_troops_general.at(key[d]).troops_num==a){c=!0;break}return c},GeneralService.prototype.getUerTroopsGeneral=function(a,b,c){var d=NetService().getUserPartyGeneral();if(null!=b&&null!=b){for(var e=d.keys(),idx=0;idx<e.length;idx++)if(d.at(e[idx]).troops_num==b&&d.at(e[idx]).position==c){a.gnrl_id=d.at(e[idx]).gnrl_id,a.gnrl_num=d.at(e[idx]).gnrl_num,a.troops_num=d.at(e[idx]).troops_num,a.pos_type=d.at(e[idx]).position,a.is_leader="y"==d.at(e[idx]).leader_yn;break}}else for(e=d.keys(),idx=0;idx<e.length;idx++)if(d.at(e[idx]).gnrl_id==gnrl_id&&d.at(e[idx]).gnrl_num==gnrl_num&&d.at(e[idx]).troops_num==b){a.pos_type=d.at(e[idx]).position;break}},GeneralService.prototype.checkTroopsPosition=function(a){for(var b=NetService().getUserPartyGeneral(),isCrrntPos=!1,key=b.keys(),idx=0;idx<key.length;idx++)if(b.at(key[idx]).gnrl_num==a.gnrl_num&&b.at(key[idx]).troops_num==a.troops_num&&b.at(key[idx]).position==a.pos_type){isCrrntPos=!0;break}return isCrrntPos},GeneralService.prototype.getTroopsCost=function(a){for(var b=0,m=MasterManager.getInstance(),user_troops_general=NetService().getUserPartyGeneral(),gnrl_ids=[],key=user_troops_general.keys(),idx=0;idx<key.length;idx++)user_troops_general.at(key[idx]).troops_num==a&&gnrl_ids.push(user_troops_general.at(key[idx]));for(idx=0;idx<gnrl_ids.length;idx++){var c=gnrl_ids[idx];b+=m.get_General(c.gnrl_id).cost}return b},GeneralService.prototype.getUserTotalCost=function(a){var b=NetService().get_user_troops().at(a);return null==b&&(b={cost:0}),b},GeneralService.prototype.isCostOver=function(a,b){var c=!1,def=this.getUserTotalCost(b);null==def&&(def={cost:0});for(var d=0,totalCost=def.cost,m=MasterManager.getInstance(),user_troops_general=NetService().getUserPartyGeneral(),gnrl_ids=[],key=user_troops_general.keys(),idx=0;idx<key.length;idx++)if(user_troops_general.at(key[idx]).troops_num==a.troops_num&&user_troops_general.at(key[idx]).position!=a.pos_type&&user_troops_general.at(key[idx]).gnrl_num!=a.gnrl_num){var e=user_troops_general.at(key[idx]).gnrl_id;gnrl_ids.push(e)}gnrl_ids.push(a.gnrl_id);for(idx=0;idx<gnrl_ids.length;idx++){d+=m.get_General(gnrl_ids[idx]).cost}return totalCost<d?c=!0:c},GeneralService.prototype.getUserTroopsPartnerId=function(){return GameContext.getInstance().getUserGeneralPartner().gnrl_id},GeneralService.prototype.getUserTroopsPartnerKey=function(){var a=new db.UserGeneralKey,partner=GameContext.getInstance().getUserGeneralPartner();return a.gnrl_id=partner.gnrl_id,a.gnrl_num=partner.gnrl_num,a},GeneralService.prototype.getRareType=function(a){return MasterTable.getInstance().getMasterTable().get_General_freeze(a).rare_type},GeneralService.prototype.getElementType=function(a){return MasterManager.getInstance().get_General_freeze(a).element_type},GeneralService.prototype.getDelGeneralNumInTroops=function(a,b){for(var c=0,gnrl_id=0,user_troops_general=NetService().getUserPartyGeneral(),key=user_troops_general.keys(),idx=0;idx<key.length;idx++)if(user_troops_general.at(key[idx]).troops_num==a&&user_troops_general.at(key[idx]).position==b){c=user_troops_general.at(key[idx]).gnrl_num,gnrl_id=user_troops_general.at(key[idx]).gnrl_id;break}var d=!1;for(idx=0;idx<key.length;idx++)if(user_troops_general.at(key[idx]).gnrl_num==c&&user_troops_general.at(key[idx]).gnrl_id==gnrl_id){d=!0;break}return d&&(gnrl_id=c=0),(key=new db.UserGeneralKey).gnrl_id=gnrl_id,key.gnrl_num=c,key},GeneralService.prototype.getBattleFormationLevelUpNeedGoods=function(b,c){var d=MasterManager.getInstance().get_BattleFormationV2(b);return c.formation_level=d.formation_level,c.position_type=d.position_type,c.combo_stat=d.combo_stat,c.property_type=d.formation_property_type,c.max_level=0,c.next_level=0,c.max_level=this.getFormationMaxLevel(c.position_type,c.combo_stat),c.next_level=c.formation_level+1,c.max_level<=c.formation_level||(null!=(d=MasterManager.getInstance().get_All_BattleFormationV2().find(function(a){if(a.formation_level==c.next_level&&a.position_type==c.position_type&&a.combo_stat==c.combo_stat)return!0}))&&(c.need_formation_point=d.formation_point,c.need_gold=d.need_gold,c.property_point=d.property_point_count),!1)},GeneralService.prototype.getFormationLevel=function(a){var b=MasterManager.getInstance().get_BattleFormationV2(a);return $.extend({},b).formation_level},GeneralService.prototype.getFormationMaxLevel=function(b,c){var d=0,level_list=MasterManager.getInstance().get_All_BattleFormationV2().filter(function(a){if(a.position_type==b&&a.combo_stat==c)return!0});level_list.sort(function(l,r){return l.formation_level<r.formation_level?1:l.formation_level>r.formation_level?-1:0});try{d=level_list[0].formation_level}catch(e){d=0}return d},GeneralService.prototype.getYunheePostionName=function(a){return MasterManager.getInstance().get_PositionType(a).name},GeneralService.prototype.getBattleFormationValue=function(a){return MasterManager.getInstance().get_BattleFormationV2(a).value},GeneralService.prototype.getBattleFormationNextLevelValue=function(b,c){var d,combo_stat,value=0,formation=MasterManager.getInstance().get_BattleFormationV2(b);d=formation.position_type,combo_stat=formation.combo_stat;var e=MasterManager.getInstance().get_All_BattleFormationV2().find(function(a){if(a.formation_level==c&&a.position_type==d&&a.combo_stat==combo_stat)return!0});return null!=e&&(value=e.value),value},GeneralService.prototype.getUserBattleFormationId=function(a){return NetService().get_user_troops().at(a).formation_id},GeneralService.prototype.getUserBattleFormationInfo=function(a,b){var c=NetService().get_user_troops().at(a);return null==c&&(c={formation_id:0}),MasterManager.getInstance().get_BattleFormation(c.formation_id)},GeneralService.prototype.getUserBattleFormationList=function(){return NetService().get_User_Battle_Formation()},GeneralService.prototype.getBattleFormationLevelUpNeedGold=function(a){var b,m=MasterTable.getInstance();return b=m.get_BattleFormation(a).level+1,m.get_BattleFormationLevelupExpense(b).need_gold},GeneralService.prototype.getBattleFormationName=function(a){return MasterTable.getInstance().get_BattleFormation(a).name},GeneralService.prototype.getUserFormationLevelUpCount=function(){return 0},GeneralService.prototype.getBattleFormationNextLevelLimitUserLevel=function(a){return 0},GeneralService.prototype.isEnabledFormationInit=function(){for(var a=!1,list=this.getUserBattleFormationList(),keys=list.keys(),idx=0;idx<keys.length;idx++){if(1<this.getBattleFormationLevel(list.at(keys[idx]).formation_id)){a=!0;break}}return a},GeneralService.prototype.getBattleFormationLevel=function(a){return MasterManager.getInstance().get_BattleFormationV2(a).formation_level},GeneralService.prototype.getUserGeneralActiveSkill=function(a,b){new db.UserGeneralActiveSkillInfo;MasterTable.getInstance().get_ActiveSkill(a)},GeneralService.prototype.getNormalComboId=function(a,b,c,d){},GeneralService.prototype.getSpecialComboId=function(a,b){var c=[],combos=[];for(var i in this.getCombo(combos),combos){var d=new db.ComboGeneralState;d.combo_id=i.combo_id,0!=i.state_1&&(d.gnrl_states.push(i.state_1),0!=i.state_2&&d.gnrl_states.push(i.state_2),0!=i.state_3&&d.gnrl_states.push(i.state_3),0!=i.state_4&&d.gnrl_states.push(i.state_4),0!=i.state_5&&d.gnrl_states.push(i.state_5),0!=i.state_6&&d.gnrl_states.push(i.state_6),d.count=i.need_count,c.push(d))}for(var i in c){if(!i.gnrl_states.empty()){for(var e in a);if(0==i.count){var f=MasterTable.getInstance().get_Combo(i.combo_id),info=new db.ComboInfo;info.combo_id=i.combo_id,info.name=f.name,info.content=f.content,b.push(info)}}}},GeneralService.prototype.getCombo=function(){var a=arguments;switch(a.length){case 1:a[0];break;case 2:var b=a[0];a[1];MasterTable.getInstance().get_Combo(b);break;default:return}},GeneralService.prototype.getSpecialCombo=function(a,b){var c=[];for(var d in this.getCombo(c),c)if(d.state_1==a||d.state_2==a||d.state_3==a||d.state_4==a||d.state_5==a||d.state_6==a)return void d},GeneralService.prototype.getBookGeneralList=function(){for(var c=EventDungeonService.getInstance(),m=MasterManager.getInstance(),bookGenerals=MasterTable.getInstance().get_BookGenerals(),generals=[],idx=0;idx<bookGenerals.length;idx++){var d=bookGenerals[idx].first_second_half_type;if(0<d)if(!c.IsOpenEventDungeonBuff(d))continue;var e=m.get_General(bookGenerals[idx].gnrl_id),bookGeneral={passive_skill:[],leader_skill:[],trans_passive_skill:[],special_leader_skill:[]};bookGeneral.gnrl_id=e.gnrl_id,bookGeneral.book_num=bookGenerals[idx].num,bookGeneral.gnrl_class=e.gnrl_class,bookGeneral.gnrl_type=e.gnrl_type,bookGeneral.fight_type=e.fight_type,bookGeneral.arm_service_type=e.arm_service_type,bookGeneral.name=e.name,bookGeneral.state_type=e.state_type,bookGeneral.cost=e.cost,bookGeneral.gnrl_group=e.gnrl_group,bookGeneral.max_class_type=e.evolution_max_class_type,bookGeneral.rare_type=e.rare_type,bookGeneral.passive_skill.push(e.passive_skill_id),bookGeneral.leader_skill.push(e.leader_skill_id),e.trans_passive_skill_id.split(",").forEach(function(a){var b=parseInt(a);bookGeneral.trans_passive_skill.push_back(b)}),e.special_leader_skill_id=e.special_leader_skill_id+"";for(var f=e.special_leader_skill_id.split(","),jdx=0;jdx<f.length;jdx++){var s=f[jdx];bookGeneral.special_leader_skill.push_back(1*s)}bookGeneral.element_type=e.element_type;var g=m.get_GeneralDivision(e.gnrl_group);bookGeneral.gender_type=g.general_gender_type,this.getUserBookGeneral(bookGeneral),generals.push(bookGeneral)}return generals},GeneralService.prototype.getBookGeneralInfo=function(c,d){var m=MasterManager.getInstance(),bookGeneral=m.get_BookGeneral(c),general=m.get_General(bookGeneral.gnrl_id);d.gnrl_id=general.gnrl_id,d.gnrl_class=general.gnrl_class,d.gnrl_type=general.gnrl_type,d.fight_type=general.fight_type,d.arm_service_type=general.arm_service_type,d.name=general.name,d.state_type=general.state_type,d.cost=general.cost,d.active_skill=general.active_skill_id,d.bone_id=general.bone_id,d.skin_id=general.skin_id,d.max_level=general.max_level,d.master_type=general.master_type,d.gnrl_group=general.gnrl_group,d.gnrl_type=general.gnrl_type,d.max_class_type=general.evolution_max_class_type,d.frnd_effect=general.friend_num,d.rare_type=general.rare_type,d.element_type=general.element_type,d.passive_skill.push(general.passive_skill_id),d.leader_skill.push(general.leader_skill_id),general.trans_passive_skill_id.split(",").forEach(function(a){var b=parseInt(a);d.trans_passive_skill.push_back(b)}),general.special_leader_skill_id=general.special_leader_skill_id+"";for(var e=general.special_leader_skill_id.split(","),jdx=0;jdx<e.length;jdx++){var s=e[jdx];d.special_leader_skill.push_back(1*s)}d.content=bookGeneral.content,d.book_num=bookGeneral.num;var f=m.get_GeneralDivision(general.gnrl_group);d.gender_type=f.general_gender_type;var g=new db.UserGeneralInfo;g.gnrl_id=general.gnrl_id,g.rare_type=general.rare_type,g.arm_service_type=general.arm_service_type,g.base_attk=general.attk,g.base_def=general.def,g.base_hp=general.hp,g.base_sp=general.sp,g.base_cri_prcnt=general.cri_percent,g.base_cri_ratio=general.cri_ratio,g.base_guard_rate=general.guard_rate,g.base_guard_decrease=general.guard_value,g.gnrl_level=1,g.class_type=general.gnrl_class,g.gnrl_group=general.gnrl_group,g.passive_skill.push(general.passive_skill_id),g.leader_skill.push(general.leader_skill_id),general.trans_passive_skill_id.split(",").forEach(function(a){var b=parseInt(a);g.trans_passive_skill.push_back(b)}),general.special_leader_skill_id=general.special_leader_skill_id+"";for(e=general.special_leader_skill_id.split(","),jdx=0;jdx<e.length;jdx++){s=e[jdx];g.special_leader_skill.push_back(1*s)}d.attk=this.getUserGeneralAttk(g),d.def=this.getUserGeneralDef(g),d.hp=this.getUserGeneralHp(g),d.sp=general.sp,d.cri_prcnt=this.getUserGeneralCriPrcnt(g),d.cri_ratio=this.getUserGeneralCriDmg(g),d.guard_rate=this.getUserGeneralDefPrcnt(g),d.guard_decrease=this.getUserGeneralDefDecrease(g),this.getUserBookGeneral(d)},GeneralService.prototype.getUserBookGeneralNickname=function(a){var b=MasterManager.getInstance().get_AllBookGeneral();for(var c in b)if(b[c].gnrl_id==a)return b[c].nickname},GeneralService.prototype.getUserBookGeneral=function(a){var b=NetService().get_User_Book_General();a.is_gain=a.is_max_love_level=a.is_max_level=!0;for(var c=0;c<b.length;c++)b[c].gnrl_id==a.gnrl_id&&(a.is_max_level="y"==b[c].max_level_complete_yn,a.is_max_love_level="y"==b[c].love_max_level_complete_yn,a.is_gain=!0)},GeneralService.prototype.isPartnerGeneral=function(a){var b=!1,partner=GameContext.getInstance().getUserGeneralPartner();return partner.gnrl_id==a.gnrl_id&&partner.gnrl_num==a.gnrl_num&&(b=!0),b},GeneralService.prototype.getFakeGeneralId=function(){for(var c=MasterTable.getInstance().getMasterTable().get_AllGeneral(),m_map_general_division=MasterTable.getInstance().getMasterTable().get_AllGeneralDivision(),gnrl_ids=[],idx=0;idx<c.length;idx++)for(var a=c[idx],jdx=0;jdx<m_map_general_division.length;jdx++){var b=m_map_general_division[jdx];if(a.gnrl_group==b.gnrl_group&&1==b.general_gender_type&&1==a.gnrl_class&&a.gnrl_type==GENERAL_TYPE_YUNHEE&&a.rare_type<=RARE_TYPE_HR&&a.rare_type>=RARE_TYPE_R){var d=a.gnrl_id;gnrl_ids.push(d)}}return shuffle(gnrl_ids)[0]},GeneralService.prototype.getResistanceValueColor=function(a){return a<1?COLOR(1823):a<=33?COLOR(1824):a<=66?COLOR(1825):a<=99?COLOR(1826):COLOR(1827)},GeneralService.prototype.getResistanceValueToName=function(a){return a<1?"弱点":a<=33?"弱い":a<=66?"普通":a<=99?"強い":" 無効"},GeneralService.prototype.getUserGeneralInfoList=function(i,j){null==j&&(j=!1);var k,gnrls=[];!0===j?(new NetService).getFriendGeneral(gnrls):(new NetService).getUserGeneral(gnrls);k=gnrls.filter(function(g){if(5==g.limit_step_id)return!0});var l=MasterManager.getInstance();gnrls.some(function(c){var g=l.get_General_freeze(c.gnrl_id);if("number"==typeof j&&g.element_type!=j)return!1;if("boolean"==typeof j&&g.gnrl_type!=GENERAL_TYPE_YUNHEE&&g.gnrl_type!=GENERAL_TYPE_SOLDIER)return!1;var d=new db.UserGeneralInfo;d.gnrl_id=c.gnrl_id,d.gnrl_num=c.gnrl_num,d.gnrl_level=c.gnrl_level,d.gnrl_exp=c.gnrl_exp,d.castle_id=c.castle_id,d.is_lock="y"==c.lock_yn,d.love_level=c.love_level,d.love_exp=c.love_exp,d.limit_step_id=c.limit_step_id,d.using_in_camp="y"==c.using_in_camp,d.used_in_camp="y"==c.used_in_camp,d.buff_type=c.buff_type;var e=l.get_GeneralDivision(g.gnrl_group);0==c.display_class?d.display_class=g.gnrl_class:d.display_class=c.display_class,d.gender_type=e.general_gender_type,d.name=g.name,d.active_skill=g.active_skill_id,d.element_type=g.element_type,d.class_type=g.gnrl_class,d.cost=g.cost,d.gnrl_type=g.gnrl_type,d.gnrl_group=g.gnrl_group,d.base_attk=g.attk,d.base_def=g.def,d.base_hp=g.hp,d.base_sp=g.sp,d.base_cri_prcnt=g.cri_percent,d.base_cri_ratio=g.cri_ratio,d.base_guard_rate=g.guard_rate,d.base_guard_decrease=g.guard_value,d.fight_type=g.fight_type,d.arm_service_type=g.arm_service_type,d.skin_id=g.skin_id,d.bone_id=g.bone_id,d.max_class_type=g.evolution_max_class_type,d.combo_group_num=g.combo_group_num,d.evolution_group_num=g.evolution_group_num,d.frnd_effect=g.friend_num,d.love_stat_group=g.love_stat_group,d.evolution_mtrl_num=g.evolution_mtrl_num,d.sell_gold=g.sell_gold,d.sell_yhpt=g.sell_yhpt,d.level_exp_group=g.level_exp_group,d.rare_type=g.rare_type,d.passive_skill.push(g.passive_skill_id),d.leader_skill.push(g.leader_skill_id),g.trans_passive_skill_id.split(",").forEach(function(a){var b=parseInt(a);d.trans_passive_skill.push_back(b)});for(var f=(g.special_leader_skill_id+"").split(","),jdx=0;jdx<f.length;jdx++){var s=f[jdx];d.special_leader_skill.push_back(1*s)}var h={};(h.gnrl_id=d.gnrl_id,h.gnrl_num=d.gnrl_num,d.attk=this.getUserGeneralAttk(d),d.def=this.getUserGeneralDef(d),d.hp=this.getUserGeneralHp(d),d.sp=d.base_sp,d.cri_prcnt=this.getUserGeneralCriPrcnt(d),d.cri_ratio=this.getUserGeneralCriDmg(d),d.guard_rate=this.getUserGeneralDefPrcnt(d),d.guard_decrease=this.getUserGeneralDefDecrease(d),d.master_type=g.master_type,d.state_type=g.state_type,d.total_attk_pwr=d.attk+d.def+d.hp,this.getGeneralHeavnePtInfo(d,k),0<d.limit_step_id?d.max_level=this.getLimitOverMaxLevel(d.limit_step_id):d.max_level=g.max_level,d.isPartner=this.isPartner(d.gnrl_id,d.gnrl_num),d.is_friend_partner=this.isFriendPartner(d.gnrl_id,d.gnrl_num),d.isEnabledEvolve=!1,d.isEnabledLimitOver=!1,d.max_level==d.gnrl_level)&&(d.isMaxLevel=!0,this.isEnabledEvolve(d)&&(d.isEnabledEvolve=!0),d.class_type>=d.max_class_type&&this.isEnabledLimitOver(d)&&(d.isEnabledLimitOver=!0));(d.is_enable_rebirth=!1,d.is_rebirth_object=this.isRebirthObject(d.class_type,d.gnrl_group,d.gnrl_type),d.is_rebirth_object)&&(this.isEnabledRebirth(d)&&(d.is_enable_rebirth=!0));"number"==typeof j?d.element_type==j&&i.push(d):i.push(d)}.bind(this))},GeneralService.prototype.getUserGeneralMaterialInfoList=function(c,d){var e=[];NetService().getUserGeneral(e);for(var f=NetServiceV3.getInstance().get_list_User_World_War_Troops_General(),w_service=WorldWarService.getInstance(),hanven_gnrls=e.filter(function(g){if(5==g.limit_step_id)return!0}),mt=MasterManager.getInstance(),g_idx=0;g_idx<e.length;g_idx++){var h=e[g_idx],g=mt.get_General(h.gnrl_id);if(null==d){if(g.gnrl_type==GENERAL_TYPE_YUNHEE||g.gnrl_type==GENERAL_TYPE_SOLDIER)continue}else{if(g.gnrl_type==GENERAL_TYPE_YUNHEE||g.gnrl_type==GENERAL_TYPE_SOLDIER)continue;if(g.gnrl_type==GENERAL_TYPE_MATERIAL||g.gnrl_type==GENERAL_TYPE_LIMIT_OVER){if(d==YUNHEE_MATERIAL_TYPE_LEVEL_UP&&g.gnrl_type!=GENERAL_TYPE_MATERIAL)continue;if(d==YUNHEE_MATERIAL_TYPE_LIMIT_OVER&&g.gnrl_type!=GENERAL_TYPE_LIMIT_OVER)continue}}var i=new db.UserGeneralInfo;if(i.gnrl_id=h.gnrl_id,i.gnrl_num=h.gnrl_num,i.gnrl_level=h.gnrl_level,i.gnrl_exp=h.gnrl_exp,i.castle_id=h.castle_id,i.is_lock="y"==h.lock_yn,i.love_level=h.love_level,i.love_exp=h.love_exp,i.limit_step_id=h.limit_step_id,i.using_in_camp="y"==h.using_in_camp,i.used_in_camp="y"==h.used_in_camp,i.buff_type=h.buff_type,!w_service.isWorldWarUnification()&&w_service.isWorldWarPeriodOpen()){for(var j=f.keys(),found=!1,wwgnrl_idx=0;wwgnrl_idx<j.length;wwgnrl_idx++){var k=f.at(j[wwgnrl_idx]);if(k.gnrl_id==i.gnrl_id&&k.gnrl_num==i.gnrl_num){found=!0;break}}found&&(i.using_in_world_war_troops=!0)}var l=mt.get_GeneralDivision(g.gnrl_group);if(0==h.display_class?i.display_class=g.gnrl_class:i.display_class=h.display_class,i.gender_type=l.general_gender_type,i.name=g.name,i.active_skill=g.active_skill_id,i.element_type=g.element_type,i.class_type=g.gnrl_class,i.cost=g.cost,i.gnrl_type=g.gnrl_type,i.gnrl_group=g.gnrl_group,i.base_attk=g.attk,i.base_def=g.def,i.base_hp=g.hp,i.base_sp=g.sp,i.base_cri_prcnt=g.cri_percent,i.base_cri_ratio=g.cri_ratio,i.base_guard_rate=g.guard_rate,i.base_guard_decrease=g.guard_value,i.fight_type=g.fight_type,i.arm_service_type=g.arm_service_type,i.skin_id=g.skin_id,i.bone_id=g.bone_id,i.max_class_type=g.evolution_max_class_type,i.combo_group_num=g.combo_group_num,i.evolution_group_num=g.evolution_group_num,i.frnd_effect=g.friend_num,i.love_stat_group=g.love_stat_group,i.evolution_mtrl_num=g.evolution_mtrl_num,i.sell_gold=g.sell_gold,i.sell_yhpt=g.sell_yhpt,i.level_exp_group=g.level_exp_group,i.rare_type=g.rare_type,i.passive_skill.push_back(g.passive_skill_id),i.leader_skill.push_back(g.leader_skill_id),g.trans_passive_skill_id.split(",").forEach(function(a){var b=parseInt(a);i.trans_passive_skill.push_back(b)}),"number"==typeof g.special_leader_skill_id)i.special_leader_skill.push_back(g.special_leader_skill_id);else for(var m=g.special_leader_skill_id.split(","),jdx=0;jdx<m.length;jdx++){var s=m[jdx];i.special_leader_skill.push_back(1*s)}var n={};n.gnrl_id=i.gnrl_id,n.gnrl_num=i.gnrl_num,i.attk=i.base_attk,i.def=i.base_def,i.hp=i.base_hp,i.sp=i.base_sp,i.cri_prcnt=i.base_cri_prcnt,i.cri_ratio=i.base_cri_ratio,i.guard_rate=i.base_guard_rate,i.guard_decrease=i.base_guard_decrease,i.master_type=g.master_type,i.state_type=g.state_type,i.max_level=g.max_level,i.isPartner=!1,i.is_friend_partner=!1,i.isEnabledEvolve=!1,i.isEnabledLimitOver=!1,i.is_enable_rebirth=!1,i.is_rebirth_object=!1,this.getGeneralHeavnePtInfo(i,hanven_gnrls),c.push_back(i)}},GeneralService.prototype.isEnabledEvolve=function(a){var b={};return b.gnrl_id=a.gnrl_id,b.gnrl_num=a.gnrl_num,!(a.class_type>=a.max_class_type)&&(!!a.isMaxLevel&&!!this.isExistEvolutionMtrl(b,a.evolution_mtrl_num))},GeneralService.prototype.getLimitOverMaxLevel=function(a){return MasterManager.getInstance().get_GeneralLimit(a).ext_level_id},GeneralService.prototype.getUserGnrlDisplayClassInfo=function(a,b){var c=NetService().getUserGeneral({},a);b.gnrl_id=a.gnrl_id,b.gnrl_num=a.gnrl_num;var d=MasterManager.getInstance().get_General_freeze(a.gnrl_id);return 0==c.display_class?b.display_class=d.gnrl_class:b.display_class=c.display_class,c.display_class>YUNHEE_MAX_CLASS_TYPE&&(b.display_class=YUNHEE_MAX_CLASS_TYPE),b.gnrl_group=d.gnrl_group,b.class_type=d.gnrl_class,b},GeneralService.prototype.getEventLimitOverCardStandingGnrlId=function(a){var b=0,gnrl=MasterManager.getInstance().get_AllGeneral();for(var c in gnrl){var l=gnrl[c];if(l.gnrl_group==a&&l.gnrl_type==GENERAL_TYPE_YUNHEE){b=l.gnrl_id;break}}return b},GeneralService.prototype.getUserGeneralInfoListInSearchTroops=function(a){for(var b=NetService().get_User_Event_Dungeon_Search_Troops_Generals("list"),idx=0;idx<a.length;idx++)for(var c=a[idx],g_idx=0;g_idx<b.length;g_idx++){var d=b[g_idx];c.gnrl_num==d.gnrl_num&&(c.using_in_search_troops=!0,c.search_troops_num=d.troops_num)}},GeneralService.prototype.getMaxHPGeneral=function(a){var b,point=0,m=MasterManager.getInstance(),eq=EquipmentService.getInstance();m.get_General(a.gnrl_id);if(point=b=this.getUserGeneralHp(a),1<a.love_level){var c=BattleService.getInstance().getMasterLoveStat(a.love_stat_group,a.love_level);if(0<c){var d=m.get_LoveStat(c);0<d.stat_type_1&&(d.stat_type_1==LOVE_ITEM_STAT_TYPE_5?point+=b*d.value_1/100:d.stat_type_1==LOVE_ITEM_STAT_TYPE_6&&(point+=d.value_1)),0<d.stat_type_2&&(d.stat_type_2==LOVE_ITEM_STAT_TYPE_5?point+=b*d.value_2/100:d.stat_type_2==LOVE_ITEM_STAT_TYPE_6&&(point+=d.value_2)),0<d.stat_type_3&&(d.stat_type_3==LOVE_ITEM_STAT_TYPE_5?point+=b*d.value_3/100:d.stat_type_3==LOVE_ITEM_STAT_TYPE_6&&(point+=d.value_3))}}if(a.arm_service_type<db.GeneralArmServiceType.ArmServiceType_Captain){var e=CampService.getInstance().getUserCampBranchAbility(a.arm_service_type);1==CAMP_LOVE_STAT_TYPE?point+=b*(e.health/1e4):point+=e.health}for(var p=0,formation_list=this.getUserBattleFormationList(),keys=formation_list.keys(),idx=0;idx<keys.length;idx++)formation_list.at(keys[idx]).combo_stat==database.BattleChainStatType.ChainStatType_Hp_Rate&&formation_list.at(keys[idx]).position_type==a.position&&(p+=this.getBattleFormationValue(formation_list.at(keys[idx]).formation_id)),point+=b*p/100;var f={};return f.gnrl_id=a.gnrl_id,f.gnrl_num=a.gnrl_num,point+=eq.getEquipmentBuff(f,database.BattleChainStatType.ChainStatType_Hp_Value),point+=point*eq.getEquipmentBuff(f,database.BattleChainStatType.ChainStatType_Hp_Rate)/100,point+=eq.getEquipmentSetGroupBuff(f,database.BattleChainStatType.ChainStatType_Hp_Value),point+=point*eq.getEquipmentSetGroupBuff(f,database.BattleChainStatType.ChainStatType_Hp_Rate)/100},GeneralService.prototype.getMaxHPGeneral2=function(a){var c,point=0,b=BattleContext._getInstance(),m=MasterManager.getInstance(),eq=EquipmentService.getInstance();m.get_General(a.gnrl_id);if(point=c=b.calcBattleGeneralHPPoint(a),1<a.love_level){var d=BattleService.getInstance().getMasterLoveStat(a.love_stat_group,a.love_level);if(0<d){var e=m.get_LoveStat(d);0<e.stat_type_1&&(e.stat_type_1==LOVE_ITEM_STAT_TYPE_5?point+=c*e.value_1/100:e.stat_type_1==LOVE_ITEM_STAT_TYPE_6&&(point+=e.value_1)),0<e.stat_type_2&&(e.stat_type_2==LOVE_ITEM_STAT_TYPE_5?point+=c*e.value_2/100:e.stat_type_2==LOVE_ITEM_STAT_TYPE_6&&(point+=e.value_2)),0<e.stat_type_3&&(e.stat_type_3==LOVE_ITEM_STAT_TYPE_5?point+=c*e.value_3/100:e.stat_type_3==LOVE_ITEM_STAT_TYPE_6&&(point+=e.value_3))}}if(a.general.arm_service_type<db.GeneralArmServiceType.ArmServiceType_Captain){var f=CampService.getInstance().getUserCampBranchAbility(a.general.arm_service_type);1==CAMP_LOVE_STAT_TYPE?point+=c*(f.health/1e4):point+=f.health}for(var p=0,formation_list=this.getUserBattleFormationList(),keys=formation_list.keys(),idx=0;idx<keys.length;idx++)formation_list.at(keys[idx]).combo_stat==database.BattleChainStatType.ChainStatType_Hp_Rate&&formation_list.at(keys[idx]).position_type==a.position&&(p+=this.getBattleFormationValue(formation_list.at(keys[idx]).formation_id)),point+=c*p/100;var g={};return g.gnrl_id=a.gnrl_id,g.gnrl_num=a.gnrl_num,point+=eq.getEquipmentBuff(g,database.BattleChainStatType.ChainStatType_Hp_Value),point+=point*eq.getEquipmentBuff(g,database.BattleChainStatType.ChainStatType_Hp_Rate)/100,point+=eq.getEquipmentSetGroupBuff(g,database.BattleChainStatType.ChainStatType_Hp_Value),point+=point*eq.getEquipmentSetGroupBuff(g,database.BattleChainStatType.ChainStatType_Hp_Rate)/100},GeneralService.prototype.getLimitOverOnlyCardInfoList=function(b,c,d){var f=MasterTable.getInstance(),list=[];f.get_LimitOverOnlyCardInfoList(b,c,d,list);var g=f.get_LimitOverCardExceptGeneral();return list=list.filter(function(l){for(var a=0;a<g.length;a++){var e=g[a];if(e.gnrl_group==d&&e.gnrl_type==GENERAL_TYPE_LIMIT_OVER&&0==l.only_gnrl_group)return!1}return!0})},GeneralService.prototype.isExistGeneral=function(a){for(var b=NetService().getUser_General(),keys=b.keys(),i=0;i<keys.length;i++)if(b.at(keys[i]).gnrl_id==a)return!0;return!1},{getInstance:function(){return void 0===x&&(x=new GeneralService),x}}}(),NetServiceV3=function(){var l,list_User_World_War_Troops=null,list_User_World_War_Troops_General=null,list_User_World_War_Partin_General=null,list_User_World_War_General_Equipment_Item=null,list_User_World_War_Castle_Occupation_Info=null,list_User_World_War_Castle_Occupation_Special_Info=null,list_User_World_War_Npc_Troops=null,list_User_World_War_Npc_Troops_General=null,world_war_battle_continue_info=null,list_User_World_War_Unification_First_Clear_Reward_Log=null,map_user_world_war_items=null,map_user_world_war_data=null,vcBoxNode=null,world_war_period_idx=0,world_war_unique_equipment_ticket_count=0,world_war_user_info={};function NetServiceV3(){}return NetServiceV3.prototype.updateResponse_Res_Get_World_War_Season_Info=function(a){WorldWarService.getInstance().setWorldWarSeasonInfo(a.world_war_period_idx,a.season_type),this.deleteall_User_World_War_Troops_General(),0==WOLRD_WAR_SEASON_INFO_FIRST_LOAD?cc.log("################ WorldWar Season Info Data Start ################"):(cc.log("################ WorldWar Season Info Data Start ################"),this.updateResponse_Res_World_War_Npc_Troops(a)),this.updateResponse_Res_Get_World_War_Troops(a),this.updateResponse_Res_Get_World_War_User_Item_Info(a),this.updateResponse_Res_World_War_Castle_Occupation_Info(a),this.updateResponse_Res_World_War_Cell_Box_Info(a),this.updateResponse_Res_User_Unique_Equipment_Ticket(a),this.updateResponse_Res_Get_World_War_Info(a),this.updateResponse_Res_World_War_Battle_Continue_Info(a),this.updateResponse_Res_Get_World_War_Partin_Generals(a),this.updateResponse_Res_Get_World_War_General_Equipments(a),cc.log("################  WorldWar Season Info Data END  ################")},NetServiceV3.prototype.updateResponse_Res_Get_World_War_User_Item_Info=function(a){WorldWarService.getInstance().setWorldWarPeriodIdx(a.world_war_period_idx),0==this.exist_User_World_War_Items()?this.insert_User_World_War_Items(a):this.update_User_World_War_Items(a),NetService().upd_UserWorldWarTicket(a.user_world_war_ticket)},NetServiceV3.prototype.updateResponse_Res_Get_World_War_Troops=function(a){WorldWarService.getInstance().setWorldWarPeriodIdx(a.world_war_period_idx),this.deleteall_User_World_War_Troops(),this.insert_User_World_War_Troops(a.troops_list,a.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_Get_World_War_Partin_Generals=function(a){WorldWarService.getInstance().setWorldWarPeriodIdx(a.world_war_period_idx),this.deleteall_User_World_War_Partin_Generals(),this.insert_User_World_War_Partin_Generals(a.partin_generals,a.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_Get_World_War_General_Equipments=function(a){WorldWarService.getInstance().setWorldWarPeriodIdx(a.world_war_period_idx),this.deleteall_User_World_War_General_Equipment_Item(),this.insert_User_World_War_General_Equipment_Items(a.gnrl_equipments,a.world_war_period_idx),WorldWarService.getInstance().updateWorldWarUserEquipmentList()},NetServiceV3.prototype.updateResponse_Res_Get_World_War_Info=function(a){WorldWarService.getInstance().setWorldWarPeriodIdx(a.world_war_period_idx),0==this.exist_User_World_War_Data(a.world_war_period_idx)?this.insert_User_World_War_Data(a):this.update_User_World_War_Data(a),world_war_user_info=a},NetServiceV3.prototype.updateResponse_Res_World_War_Castle_Occupation_Info=function(a){WorldWarService.getInstance().setWorldWarPeriodIdx(a.world_war_period_idx),this.deleteall_User_World_War_Castle_Occupation_Info(),this.deleteall_User_World_War_Castle_Occupation_Special_Info(),this.insert_User_World_War_Castle_Occupation_Infos(a.castle_list,a.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Npc_Troops=function(a){this.deleteall_User_World_War_Npc_Troops(),this.deleteall_User_World_War_Npc_Troops_General();for(var b=[],m=MasterManager.getInstance(),period=m.get_WorldWarPeriod(a.world_war_period_idx),_WorldWarNpcArrangement=MasterTable.getInstance().all_map_WorldWarNpcArrangement(),idx=0;idx<_WorldWarNpcArrangement.length;idx++){var c=_WorldWarNpcArrangement[idx];if(c.world_war_group_idx==period.world_war_group_idx){var d=m.get_WorldWarNpc(c.world_war_npc_idx,1),troop={activity_type:3};troop.current_cell_info_idx=c.pos_base_value,troop.npc_type=2,troop.open_yn="n",troop.prev_cell_info_idx=c.pos_base_value,troop.troops_generals=[];var e=[];e.push(d.npc1_id),e.push(d.npc2_id),e.push(d.npc3_id),e.push(d.npc4_id),e.push(d.npc5_id),troop.troops_generals=[];for(var i=0;i<e.length;i++){var f=e[i];if(0<f){var g=m.get_NpcGeneral(f);troop.troops_generals.push(this.createUserWorldWarNpcTroopsGeneral(c,i+1,g.gnrl_id))}}troop.troops_num=CLIENT_CREATE_WW_NPC_TROOPS_NUM,troop.world_war_npc_idx=c.world_war_npc_idx,b.push(troop)}}this.insert_User_World_War_Npc_Troops(b,a.world_war_period_idx);for(i=0;i<a.npc_troops_list.length;i++){var h=a.npc_troops_list[i];if(this.exist_User_World_War_Npc_Troops(h,a.world_war_period_idx)){this.update_User_World_War_Npc_Troops(h,a.world_war_period_idx);for(var j=0;j<h.troops_generals.length;j++){var k=h.troops_generals[j];this.update_User_World_War_Npc_Troops_General(k,a.world_war_period_idx)}}}},NetServiceV3.prototype.updateResponse_Res_World_War_Troops_Set=function(a){WorldWarService.getInstance().setWorldWarPeriodIdx(a.world_war_period_idx),this.update_User_World_War_Troops_Generals(a.troops_num,a.troops_generals),this.deleteall_User_World_War_Partin_Generals(),this.insert_User_World_War_Partin_Generals(a.partin_generals,a.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Troops_Del=function(a){WorldWarService.getInstance().setWorldWarPeriodIdx(a.world_war_period_idx),this.update_User_World_War_Troops_Generals(a.troops_num,a.troops_generals),this.deleteall_User_World_War_Partin_Generals(),this.insert_User_World_War_Partin_Generals(a.partin_generals,a.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Troops_Leader_Set=function(a){WorldWarService.getInstance().setWorldWarPeriodIdx(a.world_war_period_idx),this.update_User_World_War_Troops_Generals(a.troops_num,a.troops_generals)},NetServiceV3.prototype.updateResponse_Res_World_War_Troops_General_Equipment_Item_Set=function(a){if(WorldWarService.getInstance().setWorldWarPeriodIdx(a.world_war_period_idx),0<a.release_equipment_key.equipment_item_idx){var b={};b.equipment_item_idx=a.release_equipment_key.equipment_item_idx,b.equip_num=a.release_equipment_key.equipment_num,b.gnrl_id=a.release_gnrl_key.gnrl_id,b.gnrl_num=a.release_gnrl_key.gnrl_num,this.delete_User_World_War_General_Equipment_Item(b,a.world_war_period_idx),WorldWarService.getInstance().setWorldWarUserEquipment(a.release_equipment_key.equipment_item_idx,a.release_equipment_key.equipment_num,!1)}var c={};c.gnrl_id=a.gnrl_key.gnrl_id,c.gnrl_num=a.gnrl_key.gnrl_num,c.equipment_item_idx=a.equipment_key.equipment_item_idx,c.equip_num=a.equipment_key.equipment_num,this.insert_User_World_War_General_Equipment_Item(c,a.world_war_period_idx),WorldWarService.getInstance().setWorldWarUserEquipment(a.equipment_key.equipment_item_idx,a.equipment_key.equipment_num,!0);var d=[];d.push_back(a.gnrl_info),this.update_User_World_War_Partin_Generals(d,a.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Troops_General_Equipment_Item_Del=function(a){WorldWarService.getInstance().setWorldWarPeriodIdx(a.world_war_period_idx);var b={};b.gnrl_id=a.gnrl_key.gnrl_id,b.equip_num=a.gnrl_key.gnrl_num,b.equipment_item_idx=a.equipment_key.equipment_item_idx,b.equip_num=a.equipment_key.equipment_num,this.delete_User_World_War_General_Equipment_Item(b,a.world_war_period_idx),WorldWarService.getInstance().setWorldWarUserEquipment(a.equipment_key.equipment_item_idx,a.equipment_key.equipment_num,!1);var c=[];c.push_back(a.gnrl_info),this.update_User_World_War_Partin_Generals(c,a.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Reset=function(a){WorldWarService.getInstance().setWorldWarSeasonInfo(a.world_war_period_idx,a.season_type)},NetServiceV3.prototype.updateResponse_Res_World_War_Troops_Move=function(a){WorldWarService.getInstance().setWorldWarPeriodIdx(a.world_war_period_idx),this.update_User_World_War_Data2(a),this.update_User_World_War_Troops(a.troops,a.world_war_period_idx),0<a.npc_troops.world_war_npc_idx&&(this.exist_User_World_War_Npc_Troops(a.npc_troops,a.world_war_period_idx)?this.update_User_World_War_Npc_Troops(a.npc_troops,a.world_war_period_idx):this.insert_User_World_War_Npc_Troops(a.npc_troops,a.world_war_period_idx)),a.bonus_item.size(),0!=a.box.world_war_cell_info_idx&&this.removeCellBox(a.box),0<a.castle.world_war_group_idx&&(this.exist_User_World_War_Castle_Occupation_Info(a.world_war_period_idx,a.castle.world_war_group_idx,a.castle.world_war_cell_info_idx)?this.update_User_World_War_Castle_Occupation_Info(a.castle,a.world_war_period_idx):this.insert_User_World_War_Castle_Occupation_Info(a.castle,a.world_war_period_idx))},NetServiceV3.prototype.updateResponse_Res_User_Unique_Equipment_Ticket=function(a){this.exist_User_Unique_Equipment_Ticket()?this.update_User_Unique_Equipment_Ticket(a.ticket_count):this.insert_User_Unique_Equipment_Ticket(a.ticket_count)},NetServiceV3.prototype.updateResponse_Res_Equipment_Unique_Equipment=function(a){NetService().insert_User_Equipment(a.unique_equip_info),this.update_User_Unique_Equipment_Ticket(a.equip_ticket_count)},NetServiceV3.prototype.updateResponse_Res_World_War_Battle_Continue_Info=function(a){var b={world_war_period_idx:a.world_war_period_idx,world_war_cell_info_idx:a.world_war_cell_info_idx,attacker_type:a.attacker_type,event_type:a.event_type,troops:a.troops,npc_troops:a.npc_troops};world_war_battle_continue_info=b},NetServiceV3.prototype.updateResponse_Res_World_War_Battle_Continue_Check=function(a){cc.log("CHeck")},NetServiceV3.prototype.updateResponse_Res_World_War_Move_Battle_Win=function(a){WorldWarService.getInstance().setWorldWarPeriodIdx(a.world_war_period_idx),this.update_User_World_War_Castle_Occupation_Count(a.castle_occupation_count,a.world_war_period_idx),this.update_User_World_War_Troops(a.troops,a.world_war_period_idx),this.update_User_World_War_Partin_Generals(a.partin_generals,a.world_war_period_idx);for(var i=0;i<a.castle_list.length;i++)this.exist_User_World_War_Castle_Occupation_Info(a.world_war_period_idx,a.castle_list[i].world_war_group_idx,a.castle_list[i].world_war_cell_info_idx)?this.update_User_World_War_Castle_Occupation_Info(a.castle_list[i],a.world_war_period_idx):this.insert_User_World_War_Castle_Occupation_Info(a.castle_list[i],a.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Move_Battle_Lose=function(a){WorldWarService.getInstance().setWorldWarPeriodIdx(a.world_war_period_idx),this.update_User_World_War_Troops(a.troops,a.world_war_period_idx),0<a.npc_troops.world_war_npc_idx&&(this.exist_User_World_War_Npc_Troops(a.npc_troops,a.world_war_period_idx)?this.update_User_World_War_Npc_Troops(a.npc_troops,a.world_war_period_idx):this.insert_User_World_War_Npc_Troops(a.npc_troops,a.world_war_period_idx)),this.update_User_World_War_Partin_Generals(a.partin_generals,a.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Move_Battle_Time_Out=function(a){WorldWarService.getInstance().setWorldWarPeriodIdx(a.world_war_period_idx),this.update_User_World_War_Troops(a.troops,a.world_war_period_idx),0<a.npc_troops.world_war_npc_idx&&(this.exist_User_World_War_Npc_Troops(a.npc_troops,a.world_war_period_idx)?this.update_User_World_War_Npc_Troops(a.npc_troops,a.world_war_period_idx):this.insert_User_World_War_Npc_Troops(a.npc_troops,a.world_war_period_idx)),this.update_User_World_War_Partin_Generals(a.partin_generals,a.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Castle_Special_Add=function(a){WorldWarService.getInstance().setWorldWarPeriodIdx(a.world_war_period_idx),this.delete_User_World_War_Castle_Occupation_Info(a),this.delete_User_World_War_Castle_Occupation_Special_Info(a),this.insert_User_World_War_Castle_Occupation_Info(a.castle,a.world_war_period_idx),this.insert_User_World_War_Troops(a.troops_list,a.world_war_period_idx),this.insert_User_World_War_Data(a)},NetServiceV3.prototype.updateResponse_Res_World_War_Main_Castle_Troops_Return=function(a){WorldWarService.getInstance().setWorldWarPeriodIdx(a.world_war_period_idx),this.update_User_World_War_Troops(a.troops,a.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_User_Team_Turn_End=function(a){WorldWarService.getInstance().setWorldWarPeriodIdx(a.world_war_period_idx);var b={world_war_period_idx:a.world_war_period_idx,castle_occupation_count:a.castle_occupation_count,accum_turn_count:a.accum_turn_count,remain_active_count:a.remain_active_count,max_active_count:a.max_active_count,roops_lose_count:a.troops_lose_count,npc_retreat_count:a.npc_retreat_count,ghost_retreat_count:a.ghost_retreat_count,evt_npc_retreat_count:a.evt_npc_retreat_count,unification_yn:a.unification_yn};this.update_User_World_War_Data(b);for(var i=0;i<a.troops_list.length;i++)this.update_User_World_War_Troops(a.troops_list[i],a.world_war_period_idx);this.update_User_World_War_Partin_Generals(a.partin_generals,a.world_war_period_idx);for(i=0;i<a.npc_troops_list.length;i++)this.exist_User_World_War_Npc_Troops(a.npc_troops_list[i],a.world_war_period_idx)?this.update_User_World_War_Npc_Troops(a.npc_troops_list[i],a.world_war_period_idx):this.insert_User_World_War_Npc_Troops(a.npc_troops_list[i],a.world_war_period_idx);this.update_User_World_War_Castle_Occupation_Infos(a.castle_list,a.world_war_period_idx),NetService().upd_UserWorldWarTicket(a.user_world_war_ticket),b=null},NetServiceV3.prototype.updateResponse_Res_World_War_Cell_Box_Info=function(a){vcBoxNode=a.box_list},NetServiceV3.prototype.updateResponse_Res_World_War_Unification_First_Clear_Reward=function(a){this.deleteall_User_World_War_Unification_First_Clear_Reward_Log(),this.insert_User_World_War_Unification_First_Clear_Reward_Log_List(a.reward_log,WorldWarService.getInstance().getWorldWarPeriodIndex())},NetServiceV3.prototype.updateResponse_Res_World_War_Buy_Box_Gacha=function(a){for(var m=MasterManager.getInstance(),i=0;i<a.bonus_item.length;i++){var b=a.bonus_item[i];switch(b.bonus_type){case BONUS_TYPE_EQUIPMENT:var c=m.get_EquipmentItem(b.equipment.equipment_item_idx);try{null!=c&&c.equipment_type!=EQUIPMENT_TYPE_EXP&&(b.equipment.level=1,NetService().insert_User_Equipment(b.equipment))}catch(e){}}}},NetServiceV3.prototype.updateResponse_Res_World_War_Unification_First_Clear_Log=function(a){this.deleteall_User_World_War_Unification_First_Clear_Reward_Log(),this.insert_User_World_War_Unification_First_Clear_Reward_Log_List(a.reward_log,WorldWarService.getInstance().getWorldWarPeriodIndex()),cc.log("!@#!@#!@#!@#!@#!@#!@#!@#!@#!@#!@#!@#!@!@#!@#!#!#!@#!#!@#!#!@#!@#!@#!@#!#!@#!@")},NetServiceV3.prototype.exist_User_World_War_Items=function(){return null!=map_user_world_war_items||null!=map_user_world_war_items||(map_user_world_war_items=new Map,!1)},NetServiceV3.prototype.insert_User_World_War_Items=function(a){var b={user_id:m_user_id,medal:a.medal,accum_medal:a.medal_accum};map_user_world_war_items.insert([m_user_id],b)},NetServiceV3.prototype.update_User_World_War_Items=function(a){var b={user_id:m_user_id,medal:a.medal,accum_medal:a.medal_accum};map_user_world_war_items.insert([m_user_id],b)},NetServiceV3.prototype.update_User_World_War_Items_medal=function(a){null==map_user_world_war_items&&null==map_user_world_war_items&&(map_user_world_war_items=new Map);var b=map_user_world_war_items.at([m_user_id]);null!=b&&(b.medal=a,map_user_world_war_items.insert([m_user_id],b))},NetServiceV3.prototype.exist_User_Unique_Equipment_Ticket=function(){return!(world_war_unique_equipment_ticket_count<=0)},NetServiceV3.prototype.insert_User_Unique_Equipment_Ticket=function(a){world_war_unique_equipment_ticket_count=a},NetServiceV3.prototype.update_User_Unique_Equipment_Ticket=function(a){world_war_unique_equipment_ticket_count=a},NetServiceV3.prototype.select_User_Unique_Equipment_Ticket=function(){return world_war_unique_equipment_ticket_count},NetServiceV3.prototype.deleteall_User_World_War_Troops=function(){null==list_User_World_War_Troops&&(list_User_World_War_Troops=new Map),list_User_World_War_Troops.clear()},NetServiceV3.prototype.insert_User_World_War_Troops=function(b,c){this.deleteall_User_World_War_Troops(),b.forEach(function(a){this.insert_User_World_War_Troop(a,c)}.bind(this))},NetServiceV3.prototype.insert_User_World_War_Troop=function(a,b){null==list_User_World_War_Troops&&(list_User_World_War_Troops=new Map),list_User_World_War_Troops.insert([m_user_id,b,a.troops_num],a),this.insert_User_World_War_Troops_Generals(a.troops_generals,b)},NetServiceV3.prototype.update_User_World_War_Troops=function(a,b){null==list_User_World_War_Troops&&(list_User_World_War_Troops=new Map),list_User_World_War_Troops.insert([m_user_id,b,a.troops_num],a)},NetServiceV3.prototype.deleteall_User_World_War_Troops_General=function(){null==list_User_World_War_Troops_General&&(list_User_World_War_Troops_General=new Map),list_User_World_War_Troops_General.clear()},NetServiceV3.prototype.delete_User_World_War_Troops_General=function(){null==list_User_World_War_Troops_General&&(list_User_World_War_Troops_General=new Map),list_User_World_War_Troops_General.clear()},NetServiceV3.prototype.insert_User_World_War_Troops_General=function(a,b){null==list_User_World_War_Troops_General&&(list_User_World_War_Troops_General=new Map),list_User_World_War_Troops_General.insert([m_user_id,b,a.troops_num,a.gnrl_id,a.gnrl_num],a)},NetServiceV3.prototype.insert_User_World_War_Troops_Generals=function(b,c){world_war_period_idx=c,b.forEach(function(a){this.insert_User_World_War_Troops_General(a,c)}.bind(this))},NetServiceV3.prototype.update_User_World_War_Troops_Generals=function(a,b){null==list_User_World_War_Troops&&(list_User_World_War_Troops=new Map);for(var c=list_User_World_War_Troops.keys(),tdx=0;tdx<c.length;tdx++)list_User_World_War_Troops.at(c[tdx]).troops_num==a&&(list_User_World_War_Troops.at(c[tdx]).troops_generals=b);null==list_User_World_War_Troops_General&&(list_User_World_War_Troops_General=new Map);for(var d=list_User_World_War_Troops_General.keys(),key_idx=0,remove_list=[],remove_is=!1;key_idx<d.length;)list_User_World_War_Troops_General.at(d[key_idx]).troops_num==a&&(remove_list.push(d[key_idx]),remove_is=!0),++key_idx;if(1==remove_is)for(var e=0;e<remove_list.length;e++)list_User_World_War_Troops_General.remove(remove_list[e]);for(var f=0;f<b.length;f++){var g=b[f];list_User_World_War_Troops_General.insert([m_user_id,world_war_period_idx,g.troops_num,g.gnrl_id,g.gnrl_num],g)}},NetServiceV3.prototype.deleteall_User_World_War_Partin_Generals=function(){null==list_User_World_War_Partin_General&&(list_User_World_War_Partin_General=new Map),list_User_World_War_Partin_General.clear()},NetServiceV3.prototype.insert_User_World_War_Partin_Generals=function(b,c){b.forEach(function(a){this.insert_User_World_War_Partin_General(a,c)}.bind(this))},NetServiceV3.prototype.insert_User_World_War_Partin_General=function(a,b){null==list_User_World_War_Partin_General&&(list_User_World_War_Partin_General=new Map),list_User_World_War_Partin_General.insert([m_user_id,b,a.gnrl_id,a.gnrl_num],a)},NetServiceV3.prototype.update_User_World_War_Partin_Generals=function(a,b){null==list_User_World_War_Partin_General&&(list_User_World_War_Partin_General=new Map);for(var c=list_User_World_War_Partin_General.keys(),gidx=0;gidx<c.length;gidx++){for(var d=list_User_World_War_Partin_General.at([c[gidx]]),isFound=!1,i=0;i<a.length;i++){var e=a[i];if(d.gnrl_id==e.gnrl_id&&d.gnrl_num==e.gnrl_num){isFound=!0,i;break}}isFound&&list_User_World_War_Partin_General.insert(c[gidx],e),d=null}c=null},NetServiceV3.prototype.deleteall_User_World_War_General_Equipment_Item=function(){null==list_User_World_War_General_Equipment_Item&&(list_User_World_War_General_Equipment_Item=new Map),list_User_World_War_General_Equipment_Item.clear()},NetServiceV3.prototype.delete_User_World_War_General_Equipment_Item=function(a,b){null!=list_User_World_War_General_Equipment_Item.at([m_user_id,b,a.equipment_item_idx,a.equip_num])&&list_User_World_War_General_Equipment_Item.erase([m_user_id,b,a.equipment_item_idx,a.equip_num])},NetServiceV3.prototype.insert_User_World_War_General_Equipment_Item=function(a,b){list_User_World_War_General_Equipment_Item.insert([m_user_id,b,a.equipment_item_idx,a.equip_num],a)},NetServiceV3.prototype.insert_User_World_War_General_Equipment_Items=function(b,c){b.forEach(function(a){this.insert_User_World_War_General_Equipment_Item(a,c)}.bind(this))},NetServiceV3.prototype.exist_User_World_War_Data=function(a){return null==map_user_world_war_data&&(map_user_world_war_data=new Map),null!=map_user_world_war_data.at([m_user_id,a])},NetServiceV3.prototype.insert_User_World_War_Data=function(a){var b={user_id:m_user_id,world_war_period_idx:a.world_war_period_idx,castle_occupation_count:a.castle_occupation_count,accum_turn_count:a.accum_turn_count,remain_active_count:a.remain_active_count,max_active_count:a.max_active_count,troops_lose_count:a.troops_lose_count,npc_retreat_count:a.npc_retreat_count,ghost_retreat_count:a.ghost_retreat_count,evt_npc_retreat_count:a.evt_npc_retreat_count,unification_yn:a.unification_yn};map_user_world_war_data.insert([m_user_id,b.world_war_period_idx],b)},NetServiceV3.prototype.update_User_World_War_Datas=function(a){var b=map_user_world_war_data.at([m_user_id,a.world_war_period_idx]);b.accum_turn_count=a.accum_turn_count,b.remain_active_count=a.remain_active_count,map_user_world_war_data.insert([m_user_id,a.world_war_period_idx],b)},NetServiceV3.prototype.update_User_World_War_Data=function(a){var b={user_id:m_user_id,world_war_period_idx:a.world_war_period_idx,castle_occupation_count:a.castle_occupation_count,accum_turn_count:a.accum_turn_count,remain_active_count:a.remain_active_count,max_active_count:a.max_active_count,troops_lose_count:a.troops_lose_count,npc_retreat_count:a.npc_retreat_count,ghost_retreat_count:a.ghost_retreat_count,evt_npc_retreat_count:a.evt_npc_retreat_count,unification_yn:a.unification_yn};map_user_world_war_data.insert([m_user_id,b.world_war_period_idx],b),b=[]},NetServiceV3.prototype.update_User_World_War_Data2=function(a){var b=map_user_world_war_data.at([m_user_id,a.world_war_period_idx]),world_war_data={user_id:m_user_id,world_war_period_idx:a.world_war_period_idx,castle_occupation_count:b.castle_occupation_count,accum_turn_count:a.accum_turn_count,remain_active_count:a.remain_active_count,max_active_count:b.max_active_count,troops_lose_count:b.troops_lose_count,npc_retreat_count:b.npc_retreat_count,ghost_retreat_count:b.ghost_retreat_count,evt_npc_retreat_count:b.evt_npc_retreat_count,unification_yn:b.unification_yn};map_user_world_war_data.insert([m_user_id,world_war_data.world_war_period_idx],world_war_data)},NetServiceV3.prototype.update_User_World_War_Castle_Occupation_Count=function(a,b){var c=map_user_world_war_data.at([m_user_id,b]);null!=c.castle_occupation_count&&(c.castle_occupation_count=a,map_user_world_war_data.insert([m_user_id,b],c))},NetServiceV3.prototype.delete_User_World_War_Castle_Occupation_Info=function(a){for(var b=!1,foundKey=0,keys=list_User_World_War_Castle_Occupation_Info.keys(),i=0;i<keys.length;i++){var c=list_User_World_War_Castle_Occupation_Info.at(keys[i]);if(a.castle.world_war_cell_info_idx==c.world_war_cell_info_idx){foundKey=i,b=!0;break}}b&&list_User_World_War_Castle_Occupation_Info.erase(keys[foundKey]),keys=null},NetServiceV3.prototype.deleteall_User_World_War_Castle_Occupation_Info=function(){null==list_User_World_War_Castle_Occupation_Info&&(list_User_World_War_Castle_Occupation_Info=new Map),list_User_World_War_Castle_Occupation_Info.clear()},NetServiceV3.prototype.insert_User_World_War_Castle_Occupation_Infos=function(a,b){for(var i=0;i<a.length;i++){var c=a[i];this.insert_User_World_War_Castle_Occupation_Info(c,b)}},NetServiceV3.prototype.insert_User_World_War_Castle_Occupation_Info=function(a,b){var c={user_id:m_user_id,world_war_period_idx:b,world_war_group_idx:a.world_war_group_idx,world_war_cell_info_idx:a.world_war_cell_info_idx,own_yn:a.own_yn,provision_count:a.provision_count,elapsed:a.elapsed,castle_durability_value:a.castle_durability_value,max_castle_durability_value:a.max_castle_durability_value,open_yn:a.open_yn,special_funcs:a.special_funcs};this.insert_User_World_War_Castle_Occupation_Special_Infos(a.special_funcs,b),list_User_World_War_Castle_Occupation_Info.insert([m_user_id,c.world_war_period_idx,c.world_war_group_idx,c.world_war_cell_info_idx],c),c=null},NetServiceV3.prototype.exist_User_World_War_Castle_Occupation_Info=function(a,b,c){return null!=list_User_World_War_Castle_Occupation_Info.at([m_user_id,a,b,c])},NetServiceV3.prototype.update_User_World_War_Castle_Occupation_Info=function(a,b){null==list_User_World_War_Castle_Occupation_Info&&(list_User_World_War_Castle_Occupation_Info=new Map);var c={user_id:m_user_id,own_yn:a.own_yn,castle_durability_value:a.castle_durability_value,open_yn:a.open_yn,world_war_group_idx:a.world_war_group_idx,world_war_cell_info_idx:a.world_war_cell_info_idx,world_war_period_idx:b,provision_count:a.provision_count,elapsed:a.elapsed,max_castle_durability_value:a.max_castle_durability_value,special_funcs:a.special_funcs};list_User_World_War_Castle_Occupation_Info.insert([m_user_id,c.world_war_period_idx,c.world_war_group_idx,c.world_war_cell_info_idx],c)},NetServiceV3.prototype.update_User_World_War_Castle_Occupation_Infos=function(b,c){list_User_World_War_Castle_Occupation_Info.clear(),b.forEach(function(a){this.exist_User_World_War_Castle_Occupation_Info(c,a.world_war_group_idx,a.world_war_cell_info_idx)?this.update_User_World_War_Castle_Occupation_Info(a,c):this.insert_User_World_War_Castle_Occupation_Info(a,c)}.bind(this))},NetServiceV3.prototype.delete_User_World_War_Castle_Occupation_Special_Info=function(a){for(var b=list_User_World_War_Castle_Occupation_Special_Info.keys(),isfoundKey=!1,foundKeyIdx=0,i=0;i<b.length;i++){var c=list_User_World_War_Castle_Occupation_Special_Info.at(b[i]);if(c.world_war_cell_info_idx==a.castle.world_war_cell_info_idx){isfoundKey=!0,foundKeyIdx=i;break}c={}}isfoundKey&&list_User_World_War_Castle_Occupation_Special_Info.at(b[foundKeyIdx]).erase(),b=null},NetServiceV3.prototype.deleteall_User_World_War_Castle_Occupation_Special_Info=function(){null==list_User_World_War_Castle_Occupation_Special_Info&&(list_User_World_War_Castle_Occupation_Special_Info=new Map),list_User_World_War_Castle_Occupation_Special_Info.clear()},NetServiceV3.prototype.insert_User_World_War_Castle_Occupation_Special_Info=function(a,b){null==list_User_World_War_Castle_Occupation_Special_Info&&(list_User_World_War_Castle_Occupation_Special_Info=new Map);var c={user_id:m_user_id,period_idx:b,num:a.num,world_war_cell_info_idx:a.world_war_cell_info_idx,world_war_castle_special_func_idx:a.world_war_castle_special_func_idx};list_User_World_War_Castle_Occupation_Special_Info.insert([m_user_id,b,a.world_war_cell_info_idx,a.num,a.world_war_castle_special_func_idx],c)},NetServiceV3.prototype.insert_User_World_War_Castle_Occupation_Special_Infos=function(b,c){b.forEach(function(a){this.insert_User_World_War_Castle_Occupation_Special_Info(a,c)}.bind(this))},NetServiceV3.prototype.deleteall_User_World_War_Npc_Troops=function(){null==list_User_World_War_Npc_Troops&&null==list_User_World_War_Npc_Troops&&(list_User_World_War_Npc_Troops=new Map),list_User_World_War_Npc_Troops.clear()},NetServiceV3.prototype.exist_User_World_War_Npc_Troops=function(a,b){return null!=list_User_World_War_Npc_Troops.at([m_user_id,b,a.world_war_npc_idx])},NetServiceV3.prototype.insert_User_World_War_Npc_Troops=function(a,b){for(var i=0;i<a.length;i++){var c=a[i];this.insert_User_World_War_Npc_Troop(c,b),this.insert_User_World_War_Npc_Troops_Generals(c.troops_generals,b)}},NetServiceV3.prototype.insert_User_World_War_Npc_Troop=function(a,b){null==list_User_World_War_Npc_Troops&&(list_User_World_War_Npc_Troops=new Map);var c={user_id:m_user_id,world_war_period_idx:b,world_war_npc_idx:a.world_war_npc_idx,troops_num:a.troops_num,current_cell_info_idx:a.current_cell_info_idx,prev_cell_info_idx:a.prev_cell_info_idx,activity_type:a.activity_type,npc_type:a.npc_type,open_yn:a.open_yn,troops_generals:a.troops_generals};list_User_World_War_Npc_Troops.insert([m_user_id,c.world_war_period_idx,c.world_war_npc_idx],a)},NetServiceV3.prototype.update_User_World_War_Npc_Troops=function(a,b){var c={};c.troops_num=a.troops_num,c.current_cell_info_idx=a.current_cell_info_idx,c.prev_cell_info_idx=a.prev_cell_info_idx,c.activity_type=a.activity_type,c.npc_type=a.npc_type,c.open_yn=a.open_yn,c.world_war_period_idx=b,c.world_war_npc_idx=a.world_war_npc_idx,c.troops_generals=a.troops_generals,this.insert_User_World_War_Npc_Troop(c,b),c=null},NetServiceV3.prototype.delete_User_World_War_Npc_Troops=function(a,b){list_User_World_War_Npc_Troops.erase([m_user_id,b,a.world_war_npc_idx])},NetServiceV3.prototype.deleteall_User_World_War_Npc_Troops_General=function(){null==list_User_World_War_Npc_Troops_General&&(list_User_World_War_Npc_Troops_General=new Map),list_User_World_War_Npc_Troops_General.clear()},NetServiceV3.prototype.insert_User_World_War_Npc_Troops_General=function(a,b){null==list_User_World_War_Npc_Troops_General&&(list_User_World_War_Npc_Troops_General=new Map);var c={user_id:m_user_id,world_war_period_idx:b,world_war_npc_idx:a.world_war_npc_idx,troops_num:a.troops_num,gnrl_id:a.gnrl_id,position:a.position,remain_hp:a.remain_hp,dead_yn:a.dead_yn,battle_point:a.battle_point};list_User_World_War_Npc_Troops_General.insert([m_user_id,c.world_war_period_idx,c.world_war_npc_idx,c.gnrl_id,c.position],c)},NetServiceV3.prototype.insert_User_World_War_Npc_Troops_Generals=function(b,c){b.forEach(function(a){this.insert_User_World_War_Npc_Troops_General(a,c)}.bind(this))},NetServiceV3.prototype.update_User_World_War_Npc_Troops_General=function(a,b){null==list_User_World_War_Npc_Troops_General&&(list_User_World_War_Npc_Troops_General=new Map);var c={user_id:m_user_id,world_war_period_idx:b,world_war_npc_idx:a.world_war_npc_idx,troops_num:a.troops_num,gnrl_id:a.gnrl_id,position:a.position,remain_hp:a.remain_hp,dead_yn:a.dead_yn,battle_point:a.battle_point};list_User_World_War_Npc_Troops_General.insert([m_user_id,c.world_war_period_idx,c.world_war_npc_idx,c.gnrl_id,c.position],c)},NetServiceV3.prototype.delete_User_World_War_Npc_Troops_General=function(a,b){1==list_User_World_War_Npc_Troops_General.find([m_user_id,b])&&list_User_World_War_Npc_Troops_General.remove([m_user_id,b])},NetServiceV3.prototype.update_Battle_Bouns_Item=function(a){for(var i=0;i<a.length;i++){var b=a[i];b.bonus_type==BONUS_TYPE_WORLD_WAR_MEDAL?this.plus_World_War_Medal(b.bonus_idx):b.bonus_type==BONUS_TYPE_WORLD_WAR_UNIQUE_EQUIPMENT_TICKET&&this.plus_Unique_Equipment_Ticket(b.bonus_idx)}},NetServiceV3.prototype.deleteall_User_World_War_Unification_First_Clear_Reward_Log=function(){list_User_World_War_Unification_First_Clear_Reward_Log=[]},NetServiceV3.prototype.insert_User_World_War_Unification_First_Clear_Reward_Log=function(a,b){var c={user_id:m_user_id,world_war_period_idx:a.world_war_period_idx,world_war_group_idx:a.world_war_group_idx,reward_y:a.reward_yn};a.world_war_period_idx==b&&list_User_World_War_Unification_First_Clear_Reward_Log.push(c)},NetServiceV3.prototype.insert_User_World_War_Unification_First_Clear_Reward_Log_List=function(a,b){if(!(a.length<=0))for(var i=0;i<a.length;i++)this.insert_User_World_War_Unification_First_Clear_Reward_Log(a[i],b)},NetServiceV3.prototype.createUserWorldWarNpcTroopsGeneral=function(a,b,c){var d={battle_point:0,dead_yn:"n"};return d.gnrl_id=c,d.position=b,d.remain_hp=1e4,d.troops_num=CLIENT_CREATE_WW_NPC_TROOPS_NUM,d.world_war_npc_idx=a.world_war_npc_idx,d},NetServiceV3.prototype.getBoxNode=function(a){if(vcBoxNode.empty())return null;for(var b=!1,i=0;i<vcBoxNode.size();i++)if(a==vcBoxNode[i].world_war_cell_info_idx)return b=!0,vcBoxNode[i];return b?void 0:null},NetServiceV3.prototype.removeCellBox=function(a){if(!vcBoxNode.empty()){var c=vcBoxNode.findIndex(function(b){if(a.world_war_group_idx==b.world_war_group_idx&&a.world_war_cell_info_idx==b.world_war_cell_info_idx)return!0});-1!=c&&vcBoxNode.erase(c)}},NetServiceV3.prototype.clearWorldWarBattleContinueInfo=function(){null==world_war_battle_continue_info&&(world_war_battle_continue_info=new Map),world_war_battle_continue_info=null},NetServiceV3.prototype.select_User_World_War_Items_medal=function(a){return this.get_user_world_war_items().at([m_user_id]).medal},NetServiceV3.prototype.plus_World_War_Medal=function(a){var b=this.select_User_World_War_Items_medal();b+=a,this.update_User_World_War_Items_medal(b)},NetServiceV3.prototype.plus_Unique_Equipment_Ticket=function(a){var b=this.select_User_Unique_Equipment_Ticket();b+=a,this.update_User_Unique_Equipment_Ticket(b)},NetServiceV3.prototype.getUserPartyGeneral=function(){return null==list_User_World_War_Troops_General&&(list_User_World_War_Troops_General=new Map),list_User_World_War_Troops_General},NetServiceV3.prototype.getCastleOccupationInfo=function(a,b){for(var c=list_User_World_War_Castle_Occupation_Info.keys(),idx=0;idx<c.length;idx++){var d=list_User_World_War_Castle_Occupation_Info.at(c[idx]);if(d.world_war_cell_info_idx==a){b=d;break}}return c=null,b},NetServiceV3.prototype.getCastleOccupationInfoList=function(a){a.clear();for(var b=list_User_World_War_Castle_Occupation_Info.keys(),idx=0;idx<b.length;idx++){var c=list_User_World_War_Castle_Occupation_Info.at(b[idx]);a.push_back(c)}b=null},NetServiceV3.prototype.getWorldWarUserGnrlEquipmentList=function(a,b){for(var c=[],keys=list_User_World_War_General_Equipment_Item.keys(),idx=0;idx<keys.length;idx++){var e=list_User_World_War_General_Equipment_Item.at(keys[idx]);if(e.gnrl_id==a.gnrl_id&&e.gnrl_num==a.gnrl_num){var d={};d.equipment_item_idx=e.equipment_item_idx,d.equipment_num=e.equip_num,d.gnrl_id=e.gnrl_id,d.gnrl_num=e.gnrl_num,c.push_back(d)}}return keys=null,c},NetServiceV3.prototype.getCastleSpecialFuncList=function(a){for(var m=MasterManager.getInstance(),keys=list_User_World_War_Castle_Occupation_Special_Info.keys(),list=[],i=0;i<keys.length;i++){var s=list_User_World_War_Castle_Occupation_Special_Info.at(keys[i]),special_func=m.get_WorldWarCastleSpecialFunc(s.world_war_castle_special_func_idx);0!=special_func.world_war_castle_special_func_idx&&(special_func.world_war_special_func_type==a&&list.push(special_func))}return keys=null,list},NetServiceV3.prototype.get_User_Unique_Equipment_Ticket=function(){return world_war_unique_equipment_ticket_count},NetServiceV3.prototype.get_Worldwar_User_Info=function(){return world_war_user_info},NetServiceV3.prototype.get_list_User_World_War_Troops=function(){return null==list_User_World_War_Troops&&(list_User_World_War_Troops=new Map),list_User_World_War_Troops},NetServiceV3.prototype.get_list_User_World_War_Troops_General=function(){return null==list_User_World_War_Troops_General&&(list_User_World_War_Troops_General=new Map),list_User_World_War_Troops_General},NetServiceV3.prototype.get_list_User_World_War_Partin_General=function(){return null==list_User_World_War_Partin_General&&(list_User_World_War_Partin_General=new Map),list_User_World_War_Partin_General},NetServiceV3.prototype.get_list_User_World_War_General_Equipment_Item=function(){return null==list_User_World_War_General_Equipment_Item&&(list_User_World_War_General_Equipment_Item=new Map),list_User_World_War_General_Equipment_Item},NetServiceV3.prototype.get_list_User_World_War_Castle_Occupation_Info=function(){return null==list_User_World_War_Castle_Occupation_Info&&(list_User_World_War_Castle_Occupation_Info=new Map),list_User_World_War_Castle_Occupation_Info},NetServiceV3.prototype.get_list_User_World_War_Castle_Occupation_Special_Info=function(){return null==list_User_World_War_Castle_Occupation_Special_Info&&(list_User_World_War_Castle_Occupation_Special_Info=new Map),list_User_World_War_Castle_Occupation_Special_Info},NetServiceV3.prototype.get_list_User_World_War_Npc_Troops=function(){return null==list_User_World_War_Npc_Troops&&(list_User_World_War_Npc_Troops=new Map),list_User_World_War_Npc_Troops},NetServiceV3.prototype.get_list_User_World_War_Npc_Troops_General=function(){return null==list_User_World_War_Npc_Troops_General&&(list_User_World_War_Npc_Troops_General=new Map),list_User_World_War_Npc_Troops_General},NetServiceV3.prototype.get_world_war_battle_continue_info=function(){return world_war_battle_continue_info},NetServiceV3.prototype.get_list_User_World_War_Unification_First_Clear_Reward_Log=function(){return null==list_User_World_War_Unification_First_Clear_Reward_Log&&(list_User_World_War_Unification_First_Clear_Reward_Log=[]),list_User_World_War_Unification_First_Clear_Reward_Log},NetServiceV3.prototype.get_user_world_war_items=function(){return null==map_user_world_war_items&&(map_user_world_war_items=new Map),map_user_world_war_items},NetServiceV3.prototype.get_map_user_world_war_data=function(){return null==map_user_world_war_data&&(map_user_world_war_data=new Map),map_user_world_war_data},{getInstance:function(){return void 0===l&&(l=new NetServiceV3),l}}}(),packetList=[10360,10400,10401,10411,10608,10430,10431,10442,10440,10456,11101,11103,11102,11104,10522,10598,10520,15780,11592,10613,10620,10433,10434,10444,10524,10450,10460,10464,10470,10474,10472,10525,10901,17304,17305,10445,10526,10447,15031,11003,10621,17315,17322,17316,17317,17318,17319,17320,17329,17328,17327,17330,18001,18004,18021,18020,18010,18301,18030,18070,18501,17325,18120,18122,18121,10607,18610,18800,10615,18810,18826,10910,18830,18840,18853,19154,17334,17335,19500,20106,20504,20622,20652,20902,20852,21e3,17401],loader_flg={master_loder:{is_finish:!1},packet_loader:{target:"",is_finish:!1}};function NetService(){var bu;return(bu=new(NetService=function(){return bu})).m_PacketList=[],bu.m_PacketListIndex=0,map_User_General=new Map,map_Friend_General=new Map,map_User_Cost_general=new Map,map_User_Camp_cost=new Map,map_User_Evolve_Arm_Service_Mtrl=new Map,map_User_Hwandan_Info=new Map,map_User_Illust_Book_List=[],list_User_Troops_General=new Map,list_User_Weekly_Troops_General=[],list_User_Mail=[],map_User_Love_Item=new Map,res_Get_Shop_Free_General=[],_config={},_config_v2={},_battle_dungeon_continue=null,_event_dungeon_achv_list=null,map_User_Limit_Over_Mtrl=new Map,_battle_config_v2={},_booster_event={},_exp_booster_item={},_user_shop_buy_info={},_session_msg={},_weekly_task={},list_Announce_Msg_Queue=[],list_Global_Booster_Event_V2=[],map_User_Equipment=new Map,map_User_Gnrl_Equipment=new Map,user_orb_count=0,list_User_book_General=[],list_User_camp_cost_slot=new Map,m_User_main_lotus_bonus_log=new Map,m_user_mussang_Info=[],m_User_Battle_formation=new Map,m_User_formation_property_point=new Map,m_daily_dungeon_open_period_info={daily_dungeon_open_period:[]},map_User_Equipment_option_option_change_temp=[],map_User_Equipment_bound=new Map,_get_Rolling_Banner_Info=[],User_Magic_Key_Mtrl=0,User_Key_Recovery_Make_Count=0,_get_Shop_Gacha_Period_Info=[],_get_Popup_Banner_Info=[],_great_wall_dungeon_info=null,_great_wall_dungeon_list={},_great_wall_troops_info=null,_event_box_gacha_info_v2=null,map_user_key_bound_increase=new Map,map_user_weekly_open=new Map,map_user_event_dungeon_reward=new Map,map_user_event_dungeon_reward_shop=new Map,map_user_event_dungeon_reward_board_info=new Map,map_user_event_dungeon_board_map_bonus=new Map,map_user_event_dungeon_global_reward_log=new Map,map_user_event_dungeon_marble_map_info=new Map,map_user_event_dungeon_marble_circuit_log=new Map,map_user_event_dungeon_special_point_shop_log=new Map,map_user_event_dungeon_cutin_accum_rate=new Map,map_user_event_dungeon_craft_shop_material=new Map,map_user_event_dungeon_persnal_point_bonus_log=new Map,map_user_event_dungeon=new Map,_user_Event_Dungeon_Craft_Shop_Product_Info=null,map_user_event_dungeon_point=new Map,map_user_camp_branch_ability=new Map,map_user_prologue_v2=new Map,map_user_event_dungeon_special_point=new Map,_raid_boss_list={},_raid_boss_history={},_step_up_gacha_buy_log={},_oneday_onetime_free_gacha_buy_log={},_oneuser_onetime_free_gacha_buy_log={},_event_panel_gacha_box_info={},_event_panel_gacha_box_pan_info={},_event_panel_gacha_box_pan_buy={},_event_panel_gacha_next_box={},_get_User_Vote_Info=[],m_Res_Get_Event_Dungeon_Vote_League_Ranking_Record=[],list_User_Event_Dungeon_Vote_League_Record=[],m_Res_Get_Event_Dungeon_Vote_Ranking_Info=[],map_notice_list=new Map,map_achievement_list=new Map,map_user_troops=new Map,m_user_yunhee_bound=new Map,m_user_illust=new Map,_user_gacha_ticket=new Map,_user_special_gacha_ticket=new Map,_user_exchange_ticket=0,list_User_Box_Gacha_Info=null,list_User_Box_Gacha_progress_Info=[],m_premium_login_dmm_point_key=null,m_Res_Get_User_Equipment_Box_Gacha_Info={equipment_box_gacha_item_info:[]},m_user_beginner_booster=new Map,m_user_mussang_tower=new Map,m_user_mussang_tower_task=new Map,m_user_mussang_tower_lotus_log=new Map,m_user_naming=new Map,map_User_Rebirth_Mtrl=new Map,map_User_Event_Dungeon_Search_Troops=new Map,map_User_Event_Dungeon_Search_Troops_Generals=new Map,map_Event_Dungeon_Search_Area_Info=new Map,m_Res_Get_User_Event_Dungeon_Christmas_Info=new db.Res_Get_User_Event_Dungeon_Christmas_Info,m_Res_Get_Event_Dungeon_Vote_League_Yunhee_Info=new Map,m_Res_Get_User_Event_Dungeon_Satisfaction_Info=[],map_user_event_dungeon_once_a_day=new Map,map_user_event_dungeon_task=new Map,map_user_event_dungeon_personal_point_bonus_log=new Map,map_user_event_dungeon_christmas_reward=new Map,map_user_event_dungeon_christmas_total_reward_info=new Map,map_user_ceiling_gacha_info=new Map,map_user_event_dungeon_marble_fortune=new Map,map_user_event_dungeon_marble_golden_box_gain_log=new Map,map_User_Extra_Box_Init_Info=new Map,list_User_Box_Gacha_Golden_Barrel_Info=[],map_User_Food_List=new Map,map_user_event_dungeon_vote_league_reward=new Map,map_user_event_dungeon_vote_league_use_point_reward=new Map,Mussang_Boss_Info=null,User_Mussang_boss_info={user_mussang_boss_infos:[],user_mussang_boss_npc_info:[]},User_Mussang_Boss_list_Cnt=0,User_Jade_Piece=0,User_Achieve_Info_list=[],Global_Raid_Boss_Info={},Global_Raid_Dungeon_info={},User_Box_Gacha_List={},_exchange_ticket_buy_log={},map_user_main_mission_task=[],map_user_main_mission=[],User_evolution_event={},User_game_state={},User_daily_dungeon=[],User_jade_first_buy_log=[],User_main_story=new Map,User_info={},User_item_info={},_evolve_Stone_Count=0,bu.start_PacketList=function(a){bu.request_PacketList(callback_PacketList,10360,a),USE_IMSI_SP,MasterManager.getInstance().pre_decrypt_master(),SceneManager.getInstance().getRunningScene().start_loader_chk()},bu.next_PacketList=function(a){var b=++bu.m_PacketListIndex;if(packetList.length<=b&&null!=a)return loader_flg.packet_loader.target=a,loader_flg.packet_loader.is_finish=!0,void(WOLRD_WAR_SEASON_INFO_FIRST_LOAD=!0);bu.request_PacketList(callback_PacketList,packetList[b],a)},bu.request_PacketList=function(b,c,d){var e=c,s_session_id=GameDefault.getInstance().getSessionId();s_session_id=null==s_session_id?"0":s_session_id;var f=m_user_id,url=SERVER_IP+"/Contact.aspx",xmlhttp=new XMLHttpRequest;xmlhttp.open("POST",url,!0),xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xmlhttp.onreadystatechange=function(){if(4==xmlhttp.readyState)if(200==xmlhttp.status){encodeURIComponent(xmlhttp.responseText);var a=Base64.decode(xmlhttp.responseText),json_en=base64DecodeUTF8(a);b(c,xmlhttp.readyState,JSON.parse(json_en),d),json_obj=json_en=a=null}else{if(400==xmlhttp.status)return 0==GameDefault.getInstance().getSessionPass()&&MainObserver.getInstance().postNotification(NOTIFY_SESSION_ERROR),void GameDefault.getInstance().setSessionPass(!0);xmlhttp.status,MainObserver.getInstance().postNotification(NOTIFY_NETWORK_ERROR)}};var g=JSON.stringify({opcode:e,session_id:s_session_id,user_id:f});if(18811==c||18810==c||18826==c){var h=GreatWallService.getInstance().getCurrentGreatWallPeriodIdx();g=JSON.stringify({opcode:e,session_id:s_session_id,user_id:f,great_wall_dungeon_period_idx:h})}18858==c&&(g=JSON.stringify({opcode:e,session_id:s_session_id,user_id:f,event_dungeon_period_idx:0}));var i=RSA_CHECKSUM(g);xmlhttp.setRequestHeader("Authorization",i);var j=encodeURIComponent(base64EncodingUTF8(g));xmlhttp.send(j),j=i=g=null},bu.User_Login=function(a,b){GameClient().write(b,a)},addMethod(bu,"updateResponse",function(h,k){switch(h){case"Res_Complete_Tutorial":break;case"Res_Get_Notice_List":bu.update_notice_list(k);break;case"Res_Get_User_Info":bu.insert_User_info(k.user_info);break;case"Res_Get_User_Tutorial_V2":bu.insert_User_Tutorial_V2(k.user_tutorial);break;case"Res_Get_User_Item":bu.insert_UserItem(k);break;case"Res_Get_User_Weekly_Dungeon_Task":_weekly_task=k;break;case"Res_Get_Event_Login_Bonus_Info":break;case"Res_Get_User_General":bu.delete_User_General(k);break;case"Res_Get_User_General_Partner":bu.setUserGeneralParnter(k);break;case"Res_Get_User_Battle_Formation_V2":bu.insert_User_Battle_Formation(k);break;case"Res_Get_User_Troops":bu.insert_User_Troops(k);break;case"Res_Get_Weekly_Dungeon_Open":bu.insert_User_weekly_open_time(k.weekly_dungeon_open_list);break;case"Res_Get_User_Main_Story":bu.insert_User_main_story(k.user_stories);break;case"Res_Get_User_Main_Mission":bu.insert_User_main_mission(k.user_missions);break;case"Res_Get_User_Main_Mission_Task":bu.insert_User_main_mission_task(k.user_mission_tasks);break;case"Res_Get_User_Main_Story_Lotus_Bonus_Log":bu.insert_User_Main_Story_Lotus_Bonus_Log(k.user_bonus_log);break;case"Res_Get_User_Mail":bu.delete_User_Mail(),bu.insert_User_Mail_V2(k);break;case"Res_Get_Add_User_Mail":bu.insert_User_Mail(k);break;case"Res_Get_User_Book":bu.init_User_Book_General(k.gnrls);break;case"Res_Get_User_Achievement":bu.init_User_Achievement(k.user_achivs);break;case"Res_Get_User_Config_V2":break;case"Res_Update_User_Config_V2":_config_v2.battle_end_vibrate_yn=k.battle_end_vibrate_yn,_config_v2.mission_auto_friend_select_yn=k.mission_auto_friend_select_yn,_config_v2.story_script_review_skip_yn=k.story_script_review_skip_yn,_config_v2.camp_complete_push_yn=k.camp_complete_push_yn,_config_v2.bg_sound_yn=k.bg_sound_yn,_config_v2.effect_sound_yn=k.effect_sound_yn;break;case"Res_Get_Booster_Event":bu.list_Global_Booster_Event_V2=k;break;case"Res_Get_User_Love_Item":bu.delete_User_Love_Item(),bu.insert_User_Love_Item(k.user_love_item);break;case"Res_Get_User_Hwandan":bu.delete_UserHwandan(),bu.insert_UserHwandan(k.user_hwandan);break;case"Res_Get_User_Evolve_Arm_Service_Mtrl":bu.delete_UserEvolveArmServiceMtrl(),bu.insert_UserEvolveArmServiceMtrl(k.user_arm_service_mtrl);break;case"Res_Get_User_Yunhee_Bound":bu.insert_User_Yunhee_Bound(k.user_yunhee_bound);break;case"Res_Get_User_Camp":bu.update_User_Camp(k.user_camp);break;case"Res_Get_User_Camp_Branch_Ability":bu.insert_User_Camp_Branch_Ability(k.branch_ability);break;case"Res_Get_User_Camp_Branch_Ability_General":bu.insert_User_Camp_Branch_Ability_General(k.branch_yunhees);break;case"Res_Get_User_Camp_Cost":bu.insert_User_Camp_Cost(k);break;case"Res_Get_User_Camp_Cost_General":bu.delete_User_Camp_Cost_General(),bu.insert_User_Camp_Cost_General(k);break;case"Res_Get_User_Camp_Cost_Slot":bu.delete_User_Camp_Cost_Slot(),bu.insert_User_Camp_Cost_Slot(k);break;case"Res_Get_User_Camp_Arbeit_V2":bu.delete_User_Camp_Arbeit(),bu.insert_User_Camp_Arbeit(k);break;case"Res_Get_User_Gacha_Count":bu.update_User_Gacha_Count(k),bu.update_User_Ceiling_Gacha_Counts(k.user_ceiling_gacha_info_list);break;case"Res_Get_User_Gacha_Ticket":for(var n=0;n<k.user_gahca_ticket.length;n++){var o=k.user_gahca_ticket[n];bu.update_User_Gacha_Ticket(o.shop_id,o.ticket_count),0==NOT_USE_SHOP_BUY_LOG_PARSING&&GameDefault.getInstance().setUserTicket(o)}break;case"Res_Get_User_Mussang":bu.delete_User_Mussang(),bu.insert_User_Mussang(k);break;case"Res_Get_User_Shop_Buy_Info":_user_shop_buy_info=k,0==NOT_USE_SHOP_BUY_LOG_PARSING&&GameDefault.getInstance().setUserBuyInit(k);break;case"Res_Shop_Buy_Gold":k.buy_type==SHOP_BUY_TYPE_JADE?(bu.upd_UserJade(k.user_jade),bu.upd_UserGold(k.user_gold),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):k.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(bu.upd_UserYunheePT(k.user_goods),bu.upd_UserGold(k.user_gold),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):k.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(bu.upd_UserHeavenPt(k.user_goods),bu.upd_UserGold(k.user_gold),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation));break;case"Res_Shop_Buy_Raid_Ticket":k.buy_type==SHOP_BUY_TYPE_JADE?(bu.upd_UserJade(k.user_goods),bu.upd_UserItemRaidTicket(k.user_raid_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_user_raid_ticket)):k.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(bu.upd_UserYunheePT(k.user_goods),bu.upd_UserItemRaidTicket(k.user_raid_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_user_raid_ticket)):k.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(bu.upd_UserHeavenPt(k.user_goods),bu.upd_UserItemRaidTicket(k.user_raid_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_user_raid_ticket));break;case"Res_Shop_Buy_World_War_Ticket":k.buy_type==SHOP_BUY_TYPE_JADE?(bu.upd_UserJade(k.user_goods),bu.upd_UserWorldWarTicket(k.user_world_war_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_world_war_update_status)):k.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(bu.upd_UserYunheePT(k.user_goods),bu.upd_UserWorldWarTicket(k.user_world_war_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_world_war_update_status)):k.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(bu.upd_UserHeavenPt(k.user_goods),bu.upd_UserWorldWarTicket(k.user_world_war_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_world_war_update_status));break;case"Res_Shop_Buy_Great_Wall_Ticket":k.buy_type==SHOP_BUY_TYPE_JADE?(bu.upd_UserJade(k.user_goods),bu.upd_UserGreatWall_Ticket(k.user_great_wall_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_user_great_wall_ticket)):k.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(bu.upd_UserYunheePT(k.user_goods),bu.upd_UserGreatWall_Ticket(k.user_great_wall_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_user_great_wall_ticket)):k.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(bu.upd_UserHeavenPt(k.user_goods),bu.upd_UserGreatWall_Ticket(k.user_great_wall_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_user_great_wall_ticket));break;case"Res_Shop_Buy_Raid_Help_Ticket":k.buy_type==SHOP_BUY_TYPE_JADE?(bu.upd_UserJade(k.user_goods),bu.upd_UserRaidHelpTicket(k.user_raid_help_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_user_raid_help_ticket)):k.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(bu.upd_UserYunheePT(k.user_goods),bu.upd_UserRaidHelpTicket(k.user_raid_help_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_user_raid_help_ticket)):k.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(bu.upd_UserHeavenPt(k.user_goods),bu.upd_UserRaidHelpTicket(k.user_raid_help_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_user_raid_help_ticket));break;case"Res_Shop_Buy_Food":bu.upd_UserJade(k.user_jade),bu.plus_User_Heart(k.user_heart),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);break;case"Res_Shop_Buy_Heart":break;case"Res_Shop_Buy_Jade":bu.upd_UserJade(k.user_jade),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);break;case"Res_Shop_Buy_Limit_Over_Mtrl":if(k.buy_type==SHOP_BUY_TYPE_JADE){bu.upd_UserJade(k.user_jade);var p=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(k.bonus_type);bu.plus_User_Limit_Over_Mtrl(p,k.mtrl_cnt),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)}else if(k.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT){bu.upd_UserYunheePT(k.user_goods);p=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(k.bonus_type);bu.plus_User_Limit_Over_Mtrl(p,k.mtrl_cnt),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)}else if(k.buy_type==SHOP_BUY_TYPE_HEAVEN_PT){bu.upd_UserHeavenPt(k.user_goods);p=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(k.bonus_type);bu.plus_User_Limit_Over_Mtrl(p,k.mtrl_cnt),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)}break;case"Res_Shop_Buy_Evolve_Orb":k.buy_type==SHOP_BUY_TYPE_JADE?(bu.upd_UserJade(k.user_goods),bu.plus_User_Evolve_Orb(k.orb_count),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):k.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(bu.upd_UserYunheePT(k.user_goods),bu.plus_User_Evolve_Orb(k.orb_count),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):k.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(bu.upd_UserHeavenPt(k.user_goods),bu.plus_User_Evolve_Orb(k.orb_count),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation));break;case"Res_Shop_Buy_Formation_Point":k.buy_type==SHOP_BUY_TYPE_JADE?(bu.upd_UserJade(k.user_goods),bu.plus_User_Formation_Point(k.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):k.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(bu.upd_UserYunheePT(k.user_goods),bu.plus_User_Formation_Point(k.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):k.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(bu.upd_UserHeavenPt(k.user_goods),bu.plus_User_Formation_Point(k.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation));break;case"Res_Shop_Buy_Evolve":bu.plus_User_Hwandan(k.bonus_type,k.evolve_count),k.buy_type==SHOP_BUY_TYPE_JADE?(bu.upd_UserJade(k.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):k.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(bu.upd_UserYunheePT(k.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):k.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(bu.upd_UserHeavenPt(k.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation));break;case"Res_Shop_Buy_Love_Item":bu.plus_User_Love_Item(k.love_item_id,k.love_item_count,k.gnrl_id),bu.upd_UserJade(k.user_jade),bu.plus_User_Heart(k.user_heart),bu.upd_UserYunheePT(k.user_yunhee_pt),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);break;case"Res_Shop_Buy_Yunhee_Fix":for(var i=0;i<k.new_user_generals.length;i++)bu.new_User_General(k.new_user_generals[i]),k.buy_type==SHOP_BUY_TYPE_JADE?(bu.upd_UserJade(k.user_jade),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):k.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(bu.upd_UserYunheePT(k.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):k.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(bu.upd_UserHeavenPt(k.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation));break;case"Res_Shop_Buy_Armservice_Evolve":case"Res_Shop_Buy_Formation_Property":k.buy_type==SHOP_BUY_TYPE_JADE?(bu.upd_UserJade(k.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):k.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(bu.upd_UserYunheePT(k.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):k.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(bu.upd_UserHeavenPt(k.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation));break;case"Res_Shop_Buy_Gacha_11_Complete":for(i=0;i<k.new_user_generals.length;i++)bu.new_User_General(k.new_user_generals[i]);bu.update_User_Gacha_Count(k.user_gacha_buy_count);break;case"Res_Shop_Buy_Ticket":k.buy_type==SHOP_BUY_TYPE_JADE?bu.upd_UserJade(k.user_goods):k.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?bu.upd_UserYunheePT(k.user_goods):k.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&bu.upd_UserHeavenPt(k.user_goods),bu.upd_UserItemTicket(k.user_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);break;case"Res_Shop_Buy_Key":k.buy_type==SHOP_BUY_TYPE_JADE?bu.upd_User_Key(k.user_key,k.user_goods):k.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?bu.upd_User_Key(k.user_key,void 0,k.user_goods):k.buy_type==SHOP_BUY_TYPE_HEAVEN_PT?bu.upd_UserHeavenPt(k.user_goods):bu.upd_User_Key(k.user_key),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);break;case"Res_Get_User_Shop_Jade_First_Buy_Info":bu.insert_User_Jade_First_Buy_Log(k.user_jade_first_buy_list);break;case"Res_Get_Battle_Dungeon_Continue":_battle_dungeon_continue=k;break;case"Res_Cancel_Battle_Dungeon_Continue":bu.clearBattleDungeonContinue();break;case"Res_Get_User_Evolution_Event":bu.insert_User_Evolution_Event(k);break;case"Res_Get_User_Event_Dungeon":bu.delete_User_Event_Dungeon(),bu.insert_User_Event_Dungeon(k.user_event_dungeon);break;case"Res_Get_User_Event_Dungeon_Point":bu.delete_User_Event_Dungeon_Point(),bu.insert_User_Event_Dungeon_Point(k.event_dungeon_points);break;case"Res_Get_User_Event_Dungeon_Point_Reward":bu.delete_User_Event_Dungeon_Reward(),bu.insert_User_Event_Dungeon_Reward(k.user_event_dungeon_reward);break;case"Res_Get_User_Event_Dungeon_Reward_Shop":bu.delete_User_Event_Dungeon_Reward_Shop(),bu.insert_User_Event_Dungeon_Reward_Shop(k.user_event_dungeon_reward_shop);break;case"Res_Get_User_Event_Dungeon_Reward_Board_Info":bu.delete_User_Event_Dungeon_Reward_Board_Info(),bu.insert_User_Event_Dungeon_Reward_Board_Info(k.user_event_dungeon_reward_board_info);break;case"Res_Get_User_Event_Dungeon_Reward_Board_Map":bu.delete_User_Event_Dungeon_Reward_Board_Map(),bu.insert_User_Event_Dungeon_Reward_Board_Map(k.user_event_dungeon_reward_board_map);break;case"Res_Get_User_Event_Dungeon_Open_Period_Info":bu._event_dungeon_open_period_info=k,(new GameDate).setServerTime(k.server_time),TimeEventEngine.getInstance().setTime(TIME_EVENT_SERVER_TIME,1e3*k.server_time);break;case"Res_Event_Dungeon_Open_Period_Info":bu._event_dungeon_open_period_info.event_dungeon_open_period=[],bu._event_dungeon_open_period_info.event_dungeon_open_period=k.event_dungeon_open_period,bu._event_dungeon_open_period_info.raid_boss_reward_mail_yn=k.raid_boss_reward_mail_yn,bu._event_dungeon_open_period_info.raid_boss_exist_yn=k.raid_boss_exist_yn,(new GameDate).resetServerTime(k.server_time),TimeEventEngine.getInstance().setTime(TIME_EVENT_SERVER_TIME,1e3*k.server_time);break;case"Res_Get_User_Event_Dungeon_Cutin_Accum_Point":bu.delete_User_Event_Dungeon_Cutin_Accum_Rate_Point();for(n=0;n<k.event_dungeon_cutin_accum_point.length;n++){var r=k.event_dungeon_cutin_accum_point[n];bu.update_User_Event_Dungeon_Cutin_Accum_Rate_Point(r.event_dungeon_period_idx,r.cutin_accum_rate)}break;case"Res_Get_User_Event_Dungeon_Global_Point_Reward_Info":bu.delete_User_Event_Dungeon_Global_Point_Info(),bu.insert_User_Event_Dungeon_Global_Point_Info(k.global_point_reward_list);break;case"Res_Get_User_Event_Dungeon_Special_Point":bu.delete_User_Event_Dungeon_Special_Point(),bu.insert_User_Event_Dungeon_Special_Point(k.event_dungeon_special_point);break;case"Res_Get_User_Event_Dungeon_Marble_Circuit_Info":bu.delete_User_Event_Dungeon_Marble_Circuit_Info(),bu.insert_User_Event_Dungeon_Marble_Circuit_Info(k.event_dungeon_marble_circuit_info);break;case"Res_Get_User_Event_Dungeon_Marble_Fortune":bu.delete_User_Event_Dungeon_Marble_Fortune(),bu.insert_User_Event_Dungeon_Marble_Fortune(k.event_dungeon_marble_fortune_info);break;case"Res_Get_User_Event_Dungeon_Marble_Golden_Box_Info":bu.delete_User_Event_Dungeon_Marble_Golden_Box_Info(),bu.insert_User_Event_Dungeon_Marble_Golden_Box_Info(k.event_dungeon_marble_golden_box_info);break;case"Res_Get_User_Event_Dungeon_Marble_Map_Info":bu.delete_User_Event_Dungeon_Marble_Map_Info(),bu.insert_User_Event_Dungeon_Marble_Map_Info(k.event_dungeon_marble_map_info);break;case"Res_Get_User_Event_Dungeon_Special_Point_Shop_Log":bu.delete_User_Event_Dungeon_Special_Point_Shop(),bu.insert_User_Event_Dungeon_Special_Point_Shop(k.event_dungeon_special_point_shop);break;case"Res_Get_User_Daily_Dungeon_Open_Period_Info":m_daily_dungeon_open_period_info.daily_dungeon_open_period=[],m_daily_dungeon_open_period_info.daily_dungeon_open_period=k.daily_dungeon_open_period;break;case"Res_Get_User_Daily_Dungeon":bu.insert_User_Daily_Dungeon(k.user_daily_dungeon);break;case"Res_General_Lock":map_User_General.at([k.gnrl_key.gnrl_id,k.gnrl_key.gnrl_num]).lock_yn="y",bu.update_user_Generals();break;case"Res_General_UnLock":map_User_General.at([k.gnrl_key.gnrl_id,k.gnrl_key.gnrl_num]).lock_yn="n",bu.update_user_Generals();break;case"Res_Unification_Bandit_Battle_Begin":(P=UserService.getInstance()).updateUserItemHeart(k.user_heart);break;case"Res_General_Change_Display_Class":map_User_General.at([k.gnrl_key.gnrl_id,k.gnrl_key.gnrl_num]).display_class=k.display_class,bu.update_user_Generals();break;case"Req_Login_Result":break;case"Res_User_Achievement_Bonus_Receive":bu.upd_User_Achievement_Bonus_Recevie(k),0!=k.naming_list.length&&(bu.delete_User_Naming_Info(),bu.insert_User_Naming_Info(k.naming_list));break;case"Res_User_Event_Dungeon_Achv_Bonus_Recv":bu.update_User_Event_Dungeon_Achv_Bonus(k.achv_bonus),GameContext.getInstance().setUserNewMail("y");break;case"Res_User_Event_Dungeon_Achv_Bonus_Recv_All":for(i=0;i<k.achv_bonus_list.length;i++)bu.update_User_Event_Dungeon_Achv_Bonus(k.achv_bonus_list[i]);if(0<k.achv_bonus_list.length)GameContext.getInstance().setUserNewMail("y");break;case"Res_User_Event_Dungeon_Achv_List":if(null!=_event_dungeon_achv_list&&null!=_event_dungeon_achv_list)if(null!=_event_dungeon_achv_list.achv_list)if(0==_event_dungeon_achv_list.achv_list.length){var q;0==_event_dungeon_achv_list.event_dungeon_period_idx&&null==_event_dungeon_achv_list.event_dungeon_period_idx||0<k.achv_bonus_list.length&&GameContext.getInstance().setCompleteEventDungeonAchvs(k.achv_bonus_list),(q={}).event_dungeon_period_idx=k.event_dungeon_period_idx,q.achv_list=k.achv_bonus_list,_event_dungeon_achv_list=$.extend({},q)}else{var s=[];for(i=0;i<k.achv_bonus_list.length;i++){for(var u=k.achv_bonus_list[i],found=!1,index=0,j=0;j<_event_dungeon_achv_list.achv_list.length;j++){var v=_event_dungeon_achv_list.achv_list[j];if(u.event_dungeon_period_idx==v.event_dungeon_period_idx&&u.event_dungeon_achv_list_idx==v.event_dungeon_achv_list_idx){found=!0,index=j;break}}1==found?(u.complete_yn!=_event_dungeon_achv_list.achv_list[index].complete_yn&&"y"==u.complete_yn&&"n"==u.bonus_complete_yn&&s.push(u),_event_dungeon_achv_list.achv_list[index]=u):(s.push(u),_event_dungeon_achv_list.achv_list.push(u))}0<s.length&&GameContext.getInstance().setCompleteEventDungeonAchvs(s)}else(q={}).event_dungeon_period_idx=k.event_dungeon_period_idx,q.achv_list=k.achv_bonus_list,_event_dungeon_achv_list=$.extend({},q);else(q={}).event_dungeon_period_idx=k.event_dungeon_period_idx,q.achv_list=k.achv_bonus_list,_event_dungeon_achv_list=$.extend({},q);break;case"Res_User_Achievement_Bonus_Receive_All":bu.upd_User_Achievement_Bonus_Receive_All(k),0!=k.naming_list.length&&(bu.delete_User_Naming_Info(),bu.insert_User_Naming_Info(k.naming_list)),GameContext.getInstance().setUserNewMail("y");break;case"Res_Troops_Set_General":break;case"Res_General_Sel":bu.upd_UserGold(k.user_gold),bu.upd_UserYunheePT(k.user_yhpt),bu.upd_UserHeavenPt(k.user_hvpt),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation),bu.remove_user_generals(k.gnrl_keys);break;case"Res_Troops_Del_General_V2":case"Res_Troops_Set_General_V2":bu.update_User_Troops_Generals(k.troops_num,k.troops_gnrls);break;case"Res_General_Love_Up":bu.upd_UserGold(k.user_gold),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation),bu.upd_User_General_Love_Up(k.gnrl_key,k.user_love_item,k.love_level,k.love_exp);break;case"Res_Shop_Buy_General":bu.new_User_General(k.new_user_generals),bu.upd_User_Item(k),bu.upd_User_Gacha_Count(k.user_gacha_buy_count),bu.update_User_Ceiling_Gacha_Counts(k.user_ceiling_gacha_info_list),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);break;case"Res_Main_Mission_Battle_Win_V2":bu.upd_Main_Mission_Battle_Win_V2(k);break;case"Res_User_Mail_All_Reward_Receive":bu.upd_User_Mail_All_Reward_Receive(k),0!=k.user_equip_list.length&&(bu.delete_User_Equipments(),bu.insert_User_Equipments(k.user_equip_list));break;case"Res_General_Level_Up":bu.upd_UserGold(k.user_gold),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation),bu.update_User_General_Level_Up(k.gnrl_key,k.level,k.exp),bu.remove_user_generals(k.mtrl_gnrl_keys);break;case"Res_Main_Mission_Battle_Begin_V2":bu.upd_Main_Mission_Battle_Begin_V2(k);break;case"Res_Shoten_Time_User_Camp_Branch_Ability":bu.upd_Shoten_Time_User_Camp_Branch_Ability(k);break;case"Res_Set_User_Camp_Branch_Ability":bu.upd_UserGold(k.user_gold),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation),bu.upd_User_Camp_Branch_Ability(k.branch_yunhee);break;case"Res_Cancel_User_Camp_Branch_Ability":bu.cancel_User_Camp_Branch_Ability(k);break;case"Res_Set_User_Camp_Cost_Slot":bu.upd_User_Camp_Cost_Slot(k);break;case"Res_Upgrade_User_Camp":bu.upd_User_Camp(k),null!=k.partin_generals&&(_great_wall_troops_info.partin_generals=k.partin_generals),null!=k.troops_list&&(_great_wall_troops_info.troops_list=k.troops_list);break;case"Res_Troops_Leader_Set":bu.update_User_Troops_Generals(k.troops_num,k.troops_gnrls);break;case"Res_Set_User_Camp_Cost":bu.set_User_Camp_Cost(k);break;case"Res_Remove_User_Camp_Cost_General":bu.remove_User_Camp_Cost_General(k);break;case"Res_General_Evolution":bu.upd_General_Evolution(k);break;case"Res_General_Limit_Over":bu.upd_General_Limit_Over(k);break;case"Res_All_Troops_Del_General":bu.remove_All_Troops_Del_General(k);break;case"Res_Main_Story_Lotus_Bonus_Get_V2":bu.upd_Main_Story_Lotus_Bonus_Get_V2(k);break;case"Res_Battle_Formation_Level_Up":bu.upd_Battle_Formation_Level_Up(k);break;case"Res_Battle_Formation_Init":bu.init_Battle_Formation_Level_Up(k);break;case"Res_Shop_Gacha_Bonus":bu.upd_shop_Gacha_bonus(k);break;case"Res_Achievement_Complete":bu.upd_User_Achievement_Complete(k);break;case"Res_User_Mail_Reward_Receive":bu.upd_User_Mail_Reward_Receive(k),0!=k.user_equip_list.length&&(bu.delete_User_Equipments(),bu.insert_User_Equipments(k.user_equip_list));break;case"Res_Weekly_Dungeon_Open":bu.upd_User_Weekly_Dungeon_Open(k);break;case"Res_Daily_Dungeon_Battle_Begin":bu.upd_Daily_Dungeon_Battle_Begin(k);break;case"Res_Daily_Dungeon_Battle_Result":bu.upd_Daily_Dungeon_Battle_Result(k);break;case"Res_Weekly_Dungeon_Battle_Begin":bu.upd_User_Key(k.user_key,k.user_jade);break;case"Res_Weekly_Dungeon_Battle_Lose":bu.upd_Weekly_Dungeon_Battle_Lose(k);break;case"Res_Weekly_Dungeon_Battle_Win":bu.upd_Weekly_Dungeon_Battle_Win(k);break;case"Res_Yunhee_Inventory_Increase":bu.upd_Yunhee_Inventory_Increase(k),bu.update_User_Yunhee_Bound(k.user_yunhee_bound);break;case"Res_Mussang_Step_Battle_Begin":bu.upd_Mussang_Step_Battle_Begin(k);break;case"Res_Mussang_Step_Battle_Win":bu.upd_Mussang_Step_Battle_Win(k);break;case"Res_Mussang_Step_Battle_Lose":bu.upd_Mussang_Step_Battle_Lose(k);break;case"Res_Main_Mission_Battle_Continue":bu.upd_UserJade(k.jade_count);break;case"Res_Weekly_Dungeon_Battle_Continue":bu.upd_UserJade(k.user_jade);break;case"Res_Get_User_Daily_Bonus":case"Res_Daily_Bonus_Recv":break;case"Res_Shop_Buy_Raid_Gacha":bu.upd_UserRaidPoint(k.user_raid_point),bu.insert_User_Equipments(k.new_equipment);break;case"Res_Shop_Buy_Equipment_Box_Gacha":bu.upd_UserRaidPoint(k.user_raid_point),bu.insert_User_Box_Gacha_Equipments(k.new_equipment_box_gacha_item);break;case"Res_Get_User_Equipment":bu.delete_User_Equipments(),bu.insert_User_Equipments(k.user_equip_list);break;case"Res_Get_User_General_Equipment":bu.delete_User_Gnrl_Equipments(),bu.insert_User_Gnrl_Equipments(k.user_gnrl_equip_list);break;case"Res_Get_User_Equipment_Bound":bu.update_User_Equipment_Bound(k.user_equipment_bound);break;case"Res_Equipment_General_Equip":0<k.release_equipment_key.equipment_item_idx&&bu.delete_User_Gnrl_Equipment(k.release_gnrl_key,k.release_equipment_key);var w=$.extend({},k.gnrl_key,k.equipment_key);bu.insert_User_Gnrl_Equipment(w),bu.upd_UserGold(k.user_gold),0<k.release_equipment_key.equipment_item_idx&&(map_User_Equipment.at([k.release_equipment_key.equipment_item_idx,k.release_equipment_key.equipment_num]).equip_yn="n"),map_User_Equipment.at([k.equipment_key.equipment_item_idx,k.equipment_key.equipment_num]).equip_yn="y";break;case"Res_Equipment_General_Release":bu.delete_User_Gnrl_Equipment(k.gnrl_key,k.equipment_key),bu.upd_UserGold(k.user_gold),map_User_Equipment.at([k.equipment_key.equipment_item_idx,k.equipment_key.equipment_num]).equip_yn="n";break;case"Res_Equipment_General_Change":bu.delete_User_Gnrl_Equipment(k.gnrl_key,k.release_equipment_key),0<k.release_gnrl_key.gnrl_id&&bu.delete_User_Gnrl_Equipment(k.release_gnrl_key,k.equipment_key);var x=$.extend({},k.gnrl_key,k.equipment_key);bu.insert_User_Gnrl_Equipment(x),bu.upd_UserGold(k.user_gold),map_User_Equipment.at([k.release_equipment_key.equipment_item_idx,k.release_equipment_key.equipment_num]).equip_yn="n",map_User_Equipment.at([k.equipment_key.equipment_item_idx,k.equipment_key.equipment_num]).equip_yn="y";break;case"Res_Equipment_Levelup":var y=map_User_Equipment.at([k.equipment_data.equipment_item_idx,k.equipment_data.equipment_num]);for(y.level=k.equipment_data.level,y.stat_value=k.equipment_data.stat_value,y.exp=k.equipment_data.exp,n=0;n<k.mtrl_equip_list.length;n++){var z=k.mtrl_equip_list[n];bu.delete_User_Equipment(z)}bu.upd_UserGold(k.user_gold);break;case"Res_Equipment_Lock":map_User_Equipment.at([k.equipment_key.equipment_item_idx,k.equipment_key.equipment_num]).lock_yn="y";break;case"Res_Equipment_Unlock":map_User_Equipment.at([k.equipment_key.equipment_item_idx,k.equipment_key.equipment_num]).lock_yn="n";break;case"Res_Equipment_Sell":for(n=0;n<k.equipment_list.length;n++)bu.delete_User_Equipment(k.equipment_list[n]);bu.upd_UserGold(k.user_gold);break;case"Res_Equipment_Inventory_Increase":bu.upd_UserJade(k.user_jade),this.update_User_Equipment_Bound(k.user_equip_bound);break;case"Res_Event_Dungeon_Battle_Begin":bu.upd_User_Key(k.user_key);var A=MasterManager.getInstance().get_EventDungeonPeriod(k.event_dungeon_period_idx);if(bu.update_User_Event_Dungeon_Cutin_Accum_Rate_Point(A.event_dungeon_group_idx,k.cutin_rate),null!=k.task_list)for(i=0;i<k.task_list.length;i++){var B=k.task_list[i];bu.update_User_Event_Dungeon_Task(B)}break;case"Res_Event_Dungeon_Vote_League_Voting":if(null!=k.event_dungeon_special_point&&bu.update_User_Event_Dungeon_Special_Point(k.event_dungeon_special_point),null!=k.event_dungeon_point&&bu.update_User_Event_Dungeon_Point(k.event_dungeon_point),-1!=(found=list_User_Event_Dungeon_Vote_League_Record.findIndex(function(m){return k.event_dungeon_period_idx==m.event_dungeon_period_idx&&k.league_idx==m.league_idx})))list_User_Event_Dungeon_Vote_League_Record[found].vote_cnt+=k.vote_count;else{A=(mt=MasterManager.getInstance()).get_EventDungeonPeriod(k.event_dungeon_period_idx);var C={};C.event_dungeon_group_idx=A.event_dungeon_group_idx,C.event_dungeon_period_idx=k.event_dungeon_period_idx,C.league_idx=k.league_idx,C.vote_cnt=k.vote_count,list_User_Event_Dungeon_Vote_League_Record.push_back(C)}break;case"Res_Get_Event_Dungeon_Vote_League_Yunhee_Info":m_Res_Get_Event_Dungeon_Vote_League_Yunhee_Info=k,(new GameDate).resetServerTime(k.server_time),TimeEventEngine.getInstance().setTime(TIME_EVENT_SERVER_TIME,1e3*k.server_time);break;case"Res_Vote_Event_Voting_V1":this.update_User_Event_Dungeon_Special_Point(k.event_dungeon_special_point);break;case"Res_Get_User_Event_Dungeon_Vote_Info_V1":_get_User_Vote_Info=k.event_dungeon_vote_ranking_info;break;case"Res_Get_Event_Dungeon_Vote_Ranking_Info":m_Res_Get_Event_Dungeon_Vote_League_Ranking_Info=k;break;case"Res_Get_Event_Dungeon_Vote_Ranking_Info_V1":m_Res_Get_Event_Dungeon_Vote_Ranking_Info=k;break;case"Res_Get_User_Event_Dungeon_Vote_Info":_get_User_Vote_Info=k.user_event_dungeon_vote_info;break;case"Res_Get_Event_Dungeon_Vote_League_Ranking_Record":m_Res_Get_Event_Dungeon_Vote_League_Ranking_Record=k;break;case"Res_Event_Dungeon_Battle_Win":bu.upd_User_Key(k.user_key);A=(m=MasterManager.getInstance()).get_EventDungeonPeriod(k.event_dungeon_period_idx);(P=UserService.getInstance()).updateUserItemEventDungeonPoint(k.user_event_dungeon_point,k.user_event_dungeon_accum_point,A.event_dungeon_point_period_idx);var D=!1;if((V={}).event_dungeon_period_idx=k.event_dungeon_period_idx,V.event_dungeon_point_period_idx=m.get_EventDungeonPeriod(k.event_dungeon_period_idx).event_dungeon_point_period_idx,V.point=k.user_special_point,V.accum_point=k.user_accum_special_point,(sp_list=[]).push(V),bu.insert_User_Event_Dungeon_Special_Point(sp_list),bu.upd_UserFormationPoint(k.user_formation_point),bu.upd_UserItemRaidTicket(k.user_raid_ticket),bu.upd_UserRaidHelpTicket(k.user_raid_help_ticket),bu.upd_UserJade(k.user_jade),bu.upd_UserGold(k.user_gold),bu.upd_UserHeart(k.user_heart),bu.upd_UserLevelExp(k.user_level,k.user_exp),null!=(user_event_dungeon=map_user_event_dungeon.at([m_user_id,k.event_dungeon_idx])))user_event_dungeon.win_count=k.win_count,user_event_dungeon.complete_yn="y",map_user_event_dungeon.insert([m_user_id,k.event_dungeon_idx],user_event_dungeon);else(user_data={}).user_id=m_user_id,user_data.event_dungeon_idx=k.event_dungeon_idx,user_data.challenge_count=k.challenge_count,user_data.win_count=k.win_count,user_data.complete_yn="y",map_user_event_dungeon.insert([m_user_id,k.event_dungeon_idx],user_data);for(n=0;n<k.bonus_items.length;n++){if((b=k.bonus_items[n]).bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX)(bv={}).gnrl_id=b.bonus_idx,bv.gnrl_num=b.bonus_num,bv.gnrl_level=b.bonus_level,bv.castle_id=b.castle_id,bu.insert_User_General(bv);else if(b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7)bu.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)bu.plus_User_Love_Item(b.bonus_idx,b.bonus_num);else if(b.bonus_type==BONUS_TYPE_HEART);else if(b.bonus_type==BONUS_TYPE_JADE);else if(b.bonus_type==BONUS_TYPE_GOLD);else if(b.bonus_type==BONUS_TYPE_KEY);else if(b.bonus_type==BONUS_TYPE_RAID_TICKET);else if(b.bonus_type==BONUS_TYPE_EVENT_POINT);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE)bu.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL)bu.plus_User_Magic_Key_Mtrl(b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&b.bonus_type<=BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND){var E=b.bonus_type-BONUS_TYPE_CRAFT_SHOP_FIRST_LOW+4;bu.plus_User_Craft_Shop_Material(E,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){var F=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(b.bonus_type);bu.plus_User_Rebirth_Mtrl(F,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EQUIPMENT)bu.insert_User_Equipment(b.equipment);else if(b.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||b.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL){p=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(b.bonus_type);bu.plus_User_Limit_Over_Mtrl(p,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EVENT_DUNGEON_SPECIAL_POINT);else if(b.bonus_type==BONUS_TYPE_USER_EXP);else if(b.bonus_type>=BONUS_TYPE_CHRISTMAS_RIBBON&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_APPLE){E=GeneralService.getInstance().getBonusTypeToCraftShopMtrlType(b.bonus_type);bu.plus_User_Craft_Shop_Material(E,b.bonus_idx)}else b.bonus_type>=BONUS_TYPE_CHRISTMAS_SANTA&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_SNOWMAN?bu.update_User_Christmas_Reward(b.bonus_type,b.bonus_num,A.event_dungeon_group_idx):b.bonus_type==BONUS_TYPE_GREAT_WALL_TICKET?D=!0:b.bonus_type!=BONUS_TYPE_RAID_TICKET&&b.bonus_type!=BONUS_TYPE_RAID_HELP_TICKET||(D=!0)}D||(D="y"==k.new_mail_yn),GameContext.getInstance().setUserNewMail(D?"y":"n"),bu.upd_UserGeneralLevelExp(k.gnrl_exp);var G=0,second_event_dungeon_period_idx=0;1==k.event_dungeon_period_idx%1e3?second_event_dungeon_period_idx=(G=k.event_dungeon_period_idx)+1:G=(second_event_dungeon_period_idx=k.event_dungeon_period_idx)-1;for(n=0;n<bu._event_dungeon_open_period_info.event_dungeon_open_period.length;n++){(A=bu._event_dungeon_open_period_info.event_dungeon_open_period[n]).event_dungeon_period_idx!=G&&A.event_dungeon_period_idx!=second_event_dungeon_period_idx||(A.event_dungeon_global_accum_point=k.total_global_event_point),A.event_dungeon_period_idx!=G&&A.event_dungeon_period_idx!=second_event_dungeon_period_idx||(A.event_dungeon_cutin_max_accum_damage_point=k.cutin_damage_accum_max_point)}if("y"==k.raid_boss_discovered_yn)if(-1==(found=_raid_boss_list.user_raid_boss_open_list.findIndex(function(r){return r.discovered_user_id==k.raid_boss_info.discovered_user_id&&r.raid_boss_period_idx==k.raid_boss_info.raid_boss_period_idx&&r.raid_boss_num==k.raid_boss_info.raid_boss_num}))){var H=_raid_boss_list.user_raid_boss_open_list.slice(0);_raid_boss_list.user_raid_boss_open_list.clear(),_raid_boss_list.user_raid_boss_open_list.push_back(k.raid_boss_info);for(i=0;i<H.size();i++)_raid_boss_list.user_raid_boss_open_list.push_back(H.at(i))}for(i=0;i<k.task_list.length;i++){B=k.task_list[i];bu.update_User_Event_Dungeon_Task(B)}break;case"Res_Event_Dungeon_Battle_Lose":break;case"Res_Event_Dungeon_Battle_Continue":bu.upd_UserJade(k.user_jade);break;case"Res_Get_Rolling_Banner_Info":_get_Rolling_Banner_Info=k;break;case"Res_Get_Shop_Gacha_Period_Info":_get_Shop_Gacha_Period_Info=k;break;case"Res_Get_Popup_Banner_Info":_get_Popup_Banner_Info=k;break;case"Res_Get_User_Limit_Over_Mtrl_Info":bu.insert_User_Limit_Over_Mtlr(k.user_limit_over_material);break;case"Res_Camp_Factory_Exchange_Item":bu.upd_Camp_Factory_Exchange_Item(k);break;case"Res_Get_User_Jade_Piece":bu.upd_Get_User_Jade_Piece(k);break;case"Res_Get_User_Magic_Key_Mtrl":User_Magic_Key_Mtrl=k.magic_key_mtrl_cnt,User_Key_Recovery_Make_Count=k.key_recovery_make_cnt;break;case"Res_Get_User_Event_Dungeon_Craft_Shop_Product_Info":_user_Event_Dungeon_Craft_Shop_Product_Info=k;break;case"Res_Get_User_Event_Dungeon_Craft_Shop_Material":map_user_event_dungeon_craft_shop_material.clear(),bu.insert_User_Event_Dungeon_Craft_Shop_Material(k.event_Dungeon_craft_shop_material);break;case"Res_Event_Dungeon_Craft_Shop_Material_Exchange":bu.update_User_Event_Dungeon_Craft_Shop_Material(k.event_Dungeon_craft_shop_material);break;case"Res_Get_User_Raid_Boss_List":_raid_boss_list=k;break;case"Res_Get_User_Raid_Boss_History":_raid_boss_history=k;break;case"Res_Raid_Boss_Battle_Check":"y"==k.battle_continue_clear_yn&&bu.clearBattleDungeonContinue(),bu.upd_UserItemRaidTicket(k.user_raid_ticket),bu.upd_UserRaidHelpTicket(k.user_raid_help_ticket);break;case"Res_Raid_Boss_Battle_Start":if(0==k.raid_boss_info.remain_hp){found=0;var I=!1;for(i=0;i<_raid_boss_list.user_raid_boss_open_list.length;i++){if(found=i,(J=_raid_boss_list.user_raid_boss_open_list[i]).discovered_user_id==k.raid_boss_info.discovered_user_id&&J.raid_boss_period_idx==k.raid_boss_info.raid_boss_period_idx&&J.raid_boss_num==k.raid_boss_info.raid_boss_num){I=!0;break}}1==I&&_raid_boss_list.user_raid_boss_open_list.splice(found,1)}else for(i=0;i<_raid_boss_list.user_raid_boss_open_list.length;i++){if((r=_raid_boss_list.user_raid_boss_open_list[i]).discovered_user_id==k.raid_boss_info.discovered_user_id&&r.raid_boss_period_idx==k.raid_boss_info.raid_boss_period_idx&&r.raid_boss_num==k.raid_boss_info.raid_boss_num){r.remain_hp=k.raid_boss_info.remain_hp;break}}bu.upd_UserItemRaidTicket(k.user_raid_ticket),bu.upd_UserRaidHelpTicket(k.user_raid_help_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);break;case"Res_Raid_Boss_Shared":for(i=0;i<_raid_boss_list.user_raid_boss_open_list.length;i++){if((r=_raid_boss_list.user_raid_boss_open_list[i]).discovered_user_id==k.raid_boss_info.discovered_user_id&&r.raid_boss_period_idx==k.raid_boss_info.raid_boss_period_idx&&r.raid_boss_num==k.raid_boss_info.raid_boss_num){r.shared_type=k.raid_boss_info.shared_type,r.remain_hp=k.raid_boss_info.remain_hp;break}}break;case"Res_Raid_Boss_Force_Retreat":for(found=0,I=!1,i=0;i<_raid_boss_list.user_raid_boss_open_list.length;i++){var J;if(found=i,(J=_raid_boss_list.user_raid_boss_open_list[i]).discovered_user_id==k.raid_boss_info.discovered_user_id&&J.raid_boss_period_idx==k.raid_boss_info.raid_boss_period_idx&&J.raid_boss_num==k.raid_boss_info.raid_boss_num){I=!0;break}}1==I&&_raid_boss_list.user_raid_boss_open_list.splice(found,1);break;case"Res_Raid_Boss_Partin_User_List":break;case"Res_Get_User_Book_V2":bu.init_User_Book_General(k.gnrls);break;case"Res_Get_User_Illust_Book":bu.update_User_Illust_Book(k.user_illust_list);break;case"Res_Event_Dungeon_Point_Reward_Board_Map":(P=UserService.getInstance()).updateUserItemEventDungeonPoint(k.user_event_dungeon_point,k.user_accum_event_dungeon_point,k.event_dungeon_period_idx),bu.update_User_Event_Dungeon_Point_Reward_Board_Map(k),GameContext.getInstance().setUserNewMail("y");break;case"Res_Equipment_General_Change":bu.update_User_Equipment_General_Change(k);break;case"Res_User_Prologue_V2_Complete":bu.update_User_Prologue_V2_Complete(k);break;case"Res_Get_User_Prologue_V2":bu.get_User_Prologue_V2(k);break;case"Res_Raid_Boss_Battle_Result":bu.set_Raid_Boss_Battle_Result(k);break;case"Res_Event_Dungeon_Point_Reward":bu.update_User_Event_Dungeon_Reward(k);break;case"Res_Event_Dungeon_Use_Point_Reward_Receive":k.event_dungeon_reward_success.forEach(function(r){bu.update_User_Event_Dungeon_Use_Point_Reward(r)}),GameContext.getInstance().setUserNewMail("y");break;case"Res_Announce_Msg":bu.update_Announce_List(k);break;case"Res_Event_Dungeon_Marble_Circuit_Reward":0!=k.event_dungeon_marble_circuit_info_all.length?bu.update_User_Event_Dungeon_Marble_Circuit_Info(k.event_dungeon_marble_circuit_info_all):bu.update_User_Event_Dungeon_Marble_Circuit_Info(k.event_dungeon_marble_circuit_info),bu.update_User_Event_Dungeon_Special_Point(k.event_dungeon_special_point),GameContext.getInstance().setUserNewMail("y");break;case"Res_Event_Dungeon_Marble_Throw_Dice":0<k.gain_special_point&&bu.update_User_Event_Dungeon_Special_Point(k.event_dungeon_special_point),bu.update_User_Event_Dungeon_Point(k.event_dungeon_point);var K={};K.event_dungeon_period_idx=k.event_dungeon_period_idx,K.event_dungeon_marble_map_info_idx=k.reach_event_dungeon_marble_map_info_idx,K.circuit_count=k.circuit_count;var L=[];L.push_back(K),bu.update_User_Event_Dungeon_Marble_Map_Info(L);var M={};M.event_dungeon_period_idx=k.event_dungeon_period_idx,M.fortune_type=k.fortune_type;var N=[];if(N.push_back(M),bu.update_User_Event_Dungeon_Marble_Fortune(N),0!=k.event_dungeon_marble_golden_box_info.length&&bu.update_User_Event_Dungeon_Marble_Golden_Box_Info(k.event_dungeon_marble_golden_box_info),0<k.bonus_items.length)GameContext.getInstance().setUserNewMail("y");break;case"Premium_Login_DMM_Point_Key":m_premium_login_dmm_point_key=k;break;case"Res_Equipment_Box_Gacha_Next_Box_Moving":m_Res_Get_User_Equipment_Box_Gacha_Info.equipment_box_gacha_item_info.clear(),m_Res_Get_User_Equipment_Box_Gacha_Info.arm_service_type=k.arm_service_type,m_Res_Get_User_Equipment_Box_Gacha_Info.equipment_parts_type=k.equipment_parts_type,m_Res_Get_User_Equipment_Box_Gacha_Info.user_round_count=k.user_round_count;break;case"Res_Get_User_Equipment_Box_Gacha_Info":m_Res_Get_User_Equipment_Box_Gacha_Info=k;break;case"Res_Check_Upgrade_User_Camp_Branch_Ability":bu.update_Check_Upgrade_User_Camp_Branch_Ability(k);break;case"Res_User_Check_Beginner_Booster":bu.delete_User_Beginner_Booster(),bu.insert_user_beginner_booster(k);break;case"Res_Great_Wall_Dungeon_Reset":_great_wall_dungeon_list.dungeon_list=k.dungeon_list,_great_wall_dungeon_list.last_reset_dt=k.last_reset_dt,_great_wall_dungeon_list.great_wall_dungeon_period_idx=k.great_wall_dungeon_period_idx,_great_wall_troops_info.great_wall_dungeon_period_idx=k.great_wall_dungeon_period_idx,_great_wall_troops_info.troops_list=k.troops_list,_great_wall_troops_info.partin_generals=k.partin_generals;break;case"Req_Great_Wall_Gnrl_Recovery":_great_wall_dungeon_list.great_wall_dungeon_period_idx==k.great_wall_dungeon_period_idx&&(_great_wall_dungeon_list.last_gnrl_recovery_dt=k.last_gnrl_recovery_dt),_great_wall_troops_info.great_wall_dungeon_period_idx==k.great_wall_dungeon_period_idx&&(_great_wall_troops_info.partin_generals=k.partin_generals);break;case"Res_Great_Wall_Troops_General_Force_Release":if(0==k.great_wall_dungeon_period_idx)return;_great_wall_troops_info.partin_generals=k.partin_generals;for(n=0;n<_great_wall_troops_info.troops_list.length;n++){if((t=_great_wall_troops_info.troops_list[n]).troops_num==k.troops_num){t.troops_generls=k.troops_generals;break}}break;case"Res_Great_Wall_Troops_Info":_great_wall_troops_info=k;break;case"Res_Great_Wall_Dungeon_List":_great_wall_dungeon_list=k;break;case"Res_Great_Wall_Dungeon_Info":_great_wall_dungeon_info=k,null==_great_wall_troops_info.npc_list&&(_great_wall_dungeon_info.npc_list=[]);break;case"Res_Great_Wall_Troops_Set":case"Res_Great_Wall_Troops_Del":if(0==k.great_wall_dungeon_period_idx)return;for(n=0;n<_great_wall_troops_info.troops_list.length;n++){if((t=_great_wall_troops_info.troops_list[n]).troops_num==k.troops_num){t.troops_generls=k.troops_generals;break}}_great_wall_troops_info.partin_generals=k.partin_generals;break;case"Res_Great_Wall_Troops_Leader_Set":if(0==k.great_wall_dungeon_period_idx)return;for(n=0;n<_great_wall_troops_info.troops_list.length;n++){var t;if((t=_great_wall_troops_info.troops_list[n]).troops_num==k.troops_num){t.troops_generls=k.troops_generals;break}}break;case"Res_Get_User_Event_Dungeon_Box_Gacha_Info":k.user_event_dungeon_extra_box_init_info.forEach(function(e){map_User_Extra_Box_Init_Info.insert(e.box_gacha_info_idx,e)}),list_User_Box_Gacha_Info=k.user_event_dungeon_box_gacha_info,bu.resetEventDungeonBoxGachaItemInfoList(),list_User_Box_Gacha_Golden_Barrel_Info=k.user_golden_barrel_info;break;case"Res_Event_Dungeon_Box_Gacha_Extra_Box_Init":var O={};O.box_gacha_info_idx=k.box_gacha_info_idx,O.init_count=k.init_count,map_User_Extra_Box_Init_Info.insert(k.box_gacha_info_idx,O),bu.resetEventDungeonBoxGachaItemInfoList();break;case"Res_Get_User_Event_Dungeon_Box_Gacha_Progress_Info":case"Res_Event_Dungeon_Box_Gacha_Moving":list_User_Box_Gacha_progress_Info=k.user_event_dungeon_box_gacha_progress_info;break;case"Res_Event_Dungeon_Box_Gacha_Reset_V2":case"Res_Event_Dungeon_Box_Gacha_Buy_Log_V2":break;case"Res_Event_Dungeon_Box_Gacha_Buy_V2":var P=UserService.getInstance();for(A=(m=MasterManager.getInstance()).get_EventDungeonPeriod(k.event_dungeon_period_idx),i=0;i<bu._event_box_gacha_info_v2.event_dungeon_box_gacha_info.length;i++){if((bJ=bu._event_box_gacha_info_v2.event_dungeon_box_gacha_info[i]).event_dungeon_period_idx==k.event_dungeon_period_idx&&bJ.event_dungeon_box_gacha_idx==k.event_dungeon_box_gacha_idx){for(j=0;j<k.buy_log.length;j++)bJ.buy_log.push(k.buy_log[j]);bJ.golden_barrel_log=[],bJ.golden_barrel_log=k.golden_barrel_log}}P.updateUserItemEventDungeonPoint(k.user_event_point,k.user_accum_event_point,k.event_dungeon_period_idx);for(j=0;j<k.reward_items.length;j++){var b=k.reward_items[j];MasterManager.getInstance().get_BonusType(b.bonus_type);b.bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX||(b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7?bu.plus_User_Hwandan(b.bonus_type,b.bonus_idx):b.bonus_type==BONUS_TYPE_LOVE_ITEM||(b.bonus_type==BONUS_TYPE_HEART?bu.plus_User_Heart(b.bonus_idx):b.bonus_type==BONUS_TYPE_JADE||(b.bonus_type==BONUS_TYPE_GOLD?bu.plus_User_Gold(b.bonus_idx):b.bonus_type==BONUS_TYPE_KEY||b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE||b.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE||(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER?bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE?bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW?bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx):b.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL||b.bonus_type>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&b.bonus_type<=BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6||b.bonus_type==BONUS_TYPE_EQUIPMENT||b.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||b.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL||b.bonus_type>=BONUS_TYPE_CHRISTMAS_RIBBON&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_APPLE||b.bonus_type>=BONUS_TYPE_CHRISTMAS_SANTA&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_SNOWMAN||b.bonus_type==BONUS_TYPE_EVOLVE_ORB||b.bonus_type==BONUS_TYPE_JADE_RANDOM_BOX||b.bonus_type==BONUS_TYPE_GOLD_RANDOM_BOX||b.bonus_type==BONUS_TYPE_LOVE_ITEM_RANDOM_BOX||b.bonus_type==BONUS_TYPE_RARE_HWANDAN_RANDOM_BOX||b.bonus_type==BONUS_TYPE_EXP_CARD_RANDOM_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_GIFT_BOX||b.bonus_type==BONUS_TYPE_SWORD_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_SPEAR_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_ARCHER_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_RANDOM_BOX||b.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_GIFT_BOX||b.bonus_type==BONUS_TYPE_EVENTDUNGEON_PRESENT_GIFT_BOX||b.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_R_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_HR_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_SR_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_HN_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_R_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_HR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_SR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_1||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_2||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_3||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_4||b.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_GACHA_REBORN_GNRL_TICKET||b.bonus_type==BONUS_TYPE_ALL_RARE_TYPE_GNRL_SELECT_TICKET||b.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET||b.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET_V2||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_2||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_3||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_4||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_5||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_6||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_7||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_8||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_9||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_10||b.bonus_type==BONUS_TYPE_KEY_REFILL||b.bonus_type==BONUS_TYPE_TICKET_REFILL||b.bonus_type==BONUS_TYPE_RAID_TICKET_REFILL||b.bonus_type==BONUS_TYPE_TICKET_REFILL||b.bonus_type==BONUS_TYPE_SKIP_TICKET||b.bonus_type==BONUS_TYPE_SKIP_TICKET||(b.bonus_type,BONUS_TYPE_EXP_SET_HIGH)))))}break;case"Res_Event_Dungeon_Box_Gacha_Info_V2":bu._event_box_gacha_info_v2=k;break;case"Res_Event_Raid_Dungeon_Achieve_Info":User_Achieve_Info_list=k;break;case"Res_Event_Raid_Dungeon_Achieve_Reward":User_Achieve_Info_list.event_raid_achieve=k.event_raid_achieve;break;case"Res_Event_Raid_Dungeon_Battle_Begin":Global_Raid_Boss_Info.event_dungeon_period_idx=k.event_dungeon_period_idx,null==Global_Raid_Boss_Info.event_raid_boss_info&&(Global_Raid_Boss_Info.event_raid_boss_info={},Global_Raid_Boss_Info.event_raid_boss_info.boss_damage=k.event_raid_boss_info.boss_damage),Global_Raid_Boss_Info.event_raid_boss_info.event_raid_dungeon_idx=k.event_raid_boss_info.event_raid_dungeon_idx,Global_Raid_Boss_Info.event_raid_boss_info.boss_num=k.event_raid_boss_info.boss_num,Global_Raid_Boss_Info.event_raid_boss_info.die_yn=k.event_raid_boss_info.die_yn,Global_Raid_Boss_Info.event_raid_boss_info.remain_hp=k.event_raid_boss_info.remain_hp,Global_Raid_Dungeon_info=k,(P=UserService.getInstance()).updateUserItemEventDungeonPoint(k.user_point,k.accum_point,k.event_dungeon_period_idx);break;case"Res_Event_Raid_Dungeon_Battle_Win":if(null!=User_Achieve_Info_list&&null!=User_Achieve_Info_list&&null!=User_Achieve_Info_list.event_raid_achieve)for(var Q=0;Q<User_Achieve_Info_list.event_raid_achieve.length;Q++)User_Achieve_Info_list.event_raid_achieve[Q].event_dungeon_period_idx==k.event_dungeon_period_idx&&(User_Achieve_Info_list.event_raid_achieve[Q].accum_damage=k.accum_damage,User_Achieve_Info_list.event_raid_achieve[Q].conquest_count=k.conquest_count);if("y"==k.die_yn){bu.upd_UserGold(k.user_gold);for(i=0;i<k.bonus_items.length;i++){if((b=k.bonus_items[i]).bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX){(bv={}).gnrl_id=b.bonus_idx,bv.gnrl_num=b.bonus_num,bv.gnrl_level=b.bonus_level,bv.castle_id=b.castle_id,bv.used_in_camp="n",bv.using_in_camp="n";var R=MasterManager.getInstance().get_General(bv.gnrl_id);R.gnrl_type!=GENERAL_TYPE_YUNHEE&&R.gnrl_type!=GENERAL_TYPE_LIMIT_OVER||R.rare_type!=RARE_TYPE_SSR?bv.lock_yn="n":bv.lock_yn="y",this.insert_User_General(bv)}else b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7?this.plus_User_Hwandan(b.bonus_type,b.bonus_idx):b.bonus_type==BONUS_TYPE_LOVE_ITEM?this.plus_User_Love_Item(b.bonus_idx,b.bonus_num):b.bonus_type==BONUS_TYPE_HEART?this.plus_User_Heart(b.bonus_idx):b.bonus_type==BONUS_TYPE_JADE?this.plus_User_Jade(b.bonus_idx):b.bonus_type==BONUS_TYPE_GOLD||(b.bonus_type==BONUS_TYPE_KEY?this.plus_User_Key(b.bonus_idx):b.bonus_type==BONUS_TYPE_EVENT_POINT||(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE?this.plus_User_Love_Item(b.bonus_level,b.bonus_idx):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER?this.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE?this.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW&&this.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx)))}}Global_Raid_Boss_Info.event_raid_boss_info.event_raid_dungeon_idx=k.event_raid_dungeon_idx,Global_Raid_Boss_Info.event_raid_boss_info.boss_num=k.boss_num,Global_Raid_Boss_Info.event_raid_boss_info.remain_hp=k.remain_hp,Global_Raid_Boss_Info.event_raid_boss_info.die_yn=k.die_yn;for(var S=0;S<Global_Raid_Boss_Info.event_raid_boss_info.boss_damage.length;S++)Global_Raid_Boss_Info.event_raid_boss_info.boss_damage[S].multiple_type==k.multiple_type&&(Global_Raid_Boss_Info.event_raid_boss_info.boss_damage[S].damage=k.maxdamage),"y"==k.die_yn&&(Global_Raid_Boss_Info.event_raid_boss_info.boss_damage[S].damage=0);break;case"Res_Event_Raid_Dungeon_Battle_Lose":if(0<User_Achieve_Info_list.length&&null!=User_Achieve_Info_list.event_raid_achieve)for(var T=0;T<User_Achieve_Info_list.event_raid_achieve.length;T++){var U=User_Achieve_Info_list.event_raid_achieve[T];U.event_dungeon_period_idx==k.event_dungeon_period_idx&&(U.accum_damage=k.accum_damage,U.conquest_count=k.conquest_count)}Global_Raid_Boss_Info.event_raid_boss_info.event_raid_dungeon_idx=k.event_raid_dungeon_idx,Global_Raid_Boss_Info.event_raid_boss_info.boss_num=k.boss_num,Global_Raid_Boss_Info.event_raid_boss_info.remain_hp=k.remain_hp,Global_Raid_Boss_Info.event_raid_boss_info.die_yn=k.die_yn;for(S=0;S<Global_Raid_Boss_Info.event_raid_boss_info.boss_damage.length;S++)Global_Raid_Boss_Info.event_raid_boss_info.boss_damage[S].multiple_type==k.multiple_type&&(Global_Raid_Boss_Info.event_raid_boss_info.boss_damage[S].damage=k.maxdamage),"y"==k.die_yn&&(Global_Raid_Boss_Info.event_raid_boss_info.boss_damage[S].damage=0);break;case"Res_Event_Raid_Dungeon_Boss_Info":Global_Raid_Boss_Info=k;break;case"Res_Event_Dungeon_Battle_Skip":var m=MasterManager.getInstance();P=UserService.getInstance();bu.upd_User_Key(k.user_key),bu.upd_UserSkipTicket(k.user_skip_ticket);A=m.get_EventDungeonPeriod(k.event_dungeon_period_idx);P.updateUserItemEventDungeonPoint(k.user_event_dungeon_point,k.user_event_dungeon_accum_point,A.event_dungeon_point_period_idx);var V,sp_list,user_event_dungeon,user_data;D=!1;if((V={}).event_dungeon_period_idx=k.event_dungeon_period_idx,V.event_dungeon_point_period_idx=m.get_EventDungeonPeriod(k.event_dungeon_period_idx).event_dungeon_point_period_idx,V.point=k.user_special_point,V.accum_point=k.user_accum_special_point,bu.update_User_Event_Dungeon_Cutin_Accum_Rate_Point(A.event_dungeon_group_idx,k.cutin_rate),(sp_list=[]).push(V),bu.insert_User_Event_Dungeon_Special_Point(sp_list),bu.upd_UserLevelExp(k.user_level,k.user_exp),bu.upd_UserJade(k.user_jade),bu.upd_UserGold(k.user_gold),bu.upd_UserFormationPoint(k.user_formation_point),bu.upd_UserHeart(k.user_heart),bu.upd_UserItemRaidTicket(k.user_raid_ticket),bu.upd_UserRaidHelpTicket(k.user_raid_help_ticket),null!=(user_event_dungeon=map_user_event_dungeon.at([m_user_id,k.event_dungeon_idx])))user_event_dungeon.win_count=k.win_count,user_event_dungeon.complete_yn="y",map_user_event_dungeon.insert([m_user_id,k.event_dungeon_idx],user_event_dungeon);else(user_data={}).user_id=m_user_id,user_data.event_dungeon_idx=k.event_dungeon_idx,user_data.challenge_count=k.challenge_count,user_data.win_count=k.win_count,user_data.complete_yn="y",map_user_event_dungeon.insert([m_user_id,k.event_dungeon_idx],user_data);for(n=0;n<k.bonus_items.length;n++){if((b=k.bonus_items[n]).bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX)(bv={}).gnrl_id=b.bonus_idx,bv.gnrl_num=b.bonus_num,bv.gnrl_level=b.bonus_level,bv.castle_id=b.castle_id,bu.insert_User_General(bv);else if(b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7)bu.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)bu.plus_User_Love_Item(b.bonus_idx,b.bonus_num);else if(b.bonus_type==BONUS_TYPE_HEART);else if(b.bonus_type==BONUS_TYPE_JADE);else if(b.bonus_type==BONUS_TYPE_GOLD);else if(b.bonus_type==BONUS_TYPE_KEY);else if(b.bonus_type==BONUS_TYPE_RAID_TICKET);else if(b.bonus_type==BONUS_TYPE_EVENT_POINT);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE)bu.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL)bu.plus_User_Magic_Key_Mtrl(b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&b.bonus_type<=BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND){E=b.bonus_type-BONUS_TYPE_CRAFT_SHOP_FIRST_LOW+4;bu.plus_User_Craft_Shop_Material(E,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){F=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(b.bonus_type);bu.plus_User_Rebirth_Mtrl(F,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EQUIPMENT)bu.insert_User_Equipment(b.equipment);else if(b.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||b.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL){p=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(b.bonus_type);bu.plus_User_Limit_Over_Mtrl(p,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EVENT_DUNGEON_SPECIAL_POINT);else if(b.bonus_type==BONUS_TYPE_USER_EXP);else if(b.bonus_type>=BONUS_TYPE_CHRISTMAS_RIBBON&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_APPLE){E=GeneralService.getInstance().getBonusTypeToCraftShopMtrlType(b.bonus_type);bu.plus_User_Craft_Shop_Material(E,b.bonus_idx)}else b.bonus_type>=BONUS_TYPE_CHRISTMAS_SANTA&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_SNOWMAN?bu.update_User_Christmas_Reward(b.bonus_type,b.bonus_num,A.event_dungeon_group_idx):b.bonus_type==BONUS_TYPE_GREAT_WALL_TICKET?D=!0:b.bonus_type!=BONUS_TYPE_RAID_TICKET&&b.bonus_type!=BONUS_TYPE_RAID_HELP_TICKET||(D=!0)}D||(D="y"==k.new_mail_yn),GameContext.getInstance().setUserNewMail(D?"y":"n"),bu.upd_UserGeneralLevelExp(k.gnrl_exp);G=0,second_event_dungeon_period_idx=0;1==k.event_dungeon_period_idx%1e3?second_event_dungeon_period_idx=(G=k.event_dungeon_period_idx)+1:G=(second_event_dungeon_period_idx=k.event_dungeon_period_idx)-1;for(n=0;n<bu._event_dungeon_open_period_info.event_dungeon_open_period.length;n++){(A=bu._event_dungeon_open_period_info.event_dungeon_open_period[n]).event_dungeon_period_idx!=G&&A.event_dungeon_period_idx!=second_event_dungeon_period_idx||(A.event_dungeon_global_accum_point=k.total_global_event_point)}break;case"Res_Story_Dungeon_Battle_Skip":bu.upd_User_Key(k.user_key),bu.upd_UserSkipTicket(k.user_skip_ticket);for(n=0;n<k.drop_bonus_items.length;n++){if((b=k.drop_bonus_items[n]).bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX)(bv={}).gnrl_id=b.bonus_idx,bv.gnrl_num=b.bonus_num,bv.gnrl_level=b.bonus_level,bv.castle_id=b.castle_id,bu.insert_User_General(bv);else if(b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7)bu.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)bu.plus_User_Love_Item(b.bonus_idx,1);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE)bu.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_ATTK_POINT&&b.bonus_type<=BONUS_TYPE_CRI_DMG_POINT)bu.plus_User_Formation_Property_Point(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){F=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(b.bonus_type);bu.plus_User_Rebirth_Mtrl(F,b.bonus_idx)}else b.bonus_type,BONUS_TYPE_GOLD}for(var W=0,cnt_user_mission_length=map_user_main_mission.length,uidx=0;uidx<cnt_user_mission_length;uidx++)map_user_main_mission[uidx].main_mission_id==k.mission_id&&(W+=1);if(0!=W){var X={main_mission_id:k.mission_id,new_yn:"n",complete_yn:"y",win_count:k.win_count};map_user_main_mission.push($.extend({},X)),X=null}else{X={main_mission_id:k.mission_id,new_yn:"n",complete_yn:"y",win_count:1};map_user_main_mission.push($.extend({},X)),X=null}bu.upd_UserLevelExp(k.user_level,k.user_exp),bu.upd_UserGold(k.user_gold),bu.upd_UserHeart(k.user_heart),bu.upd_UserFormationPoint(k.user_formation_point),bu.upd_UserGeneralLevelExp(k.gnrl_exp),"y"==k.is_user_level_up&&(bu.update_max_user_key_bound(k.user_level,k.user_raid_ticket),bu.upd_UserItemRaidTicket(k.user_raid_ticket),bu.upd_UserRaidHelpTicket(k.user_raid_help_ticket));break;case"Res_Event_Raid_Box_Gacha_Info":User_Box_Gacha_List=k;break;case"Res_Get_Step_Up_Gacha_Buy_Log":_step_up_gacha_buy_log=k;break;case"Res_Get_One_User_One_Time_Free_Gacha_Buy_Log":_oneuser_onetime_free_gacha_buy_log=k;break;case"Res_One_User_One_Time_Free_Gacha_Buy":bu.new_User_General(k.new_user_generals);for(found=!1,i=0;i<_oneuser_onetime_free_gacha_buy_log.buy_log.length;i++){if((Y=_oneuser_onetime_free_gacha_buy_log.buy_log[i]).shop_id==k.buy_log.shop_id&&Y.one_user_one_time_free_gacha_idx==k.buy_log.one_user_one_time_free_gacha_idx){found=!0;break}}1==found&&_oneuser_onetime_free_gacha_buy_log.buy_log.push(k.buy_log);break;case"Res_Get_One_Day_One_Time_Free_Gacha_Buy_Log":_oneday_onetime_free_gacha_buy_log=k;break;case"Res_One_Day_One_Time_Free_Gacha_Buy":bu.new_User_General(k.new_user_generals);for(found=!1,i=0;i<_oneday_onetime_free_gacha_buy_log.buy_log.length;i++){var Y;if((Y=_oneday_onetime_free_gacha_buy_log.buy_log[i]).shop_id==k.buy_log.shop_id&&Y.one_day_one_time_free_gacha_idx==k.buy_log.one_day_one_time_free_gacha_idx&&Y.buy_num==k.buy_log.buy_num){found=!0;break}}1==found&&_oneday_onetime_free_gacha_buy_log.buy_log.push(k.buy_log);break;case"Res_User_Event_Dungeon_Panel_Gacha_Box_Info":_event_panel_gacha_box_info=k;break;case"Res_User_Event_Dungeon_Panel_Gacha_Box_Pan_Info":_event_panel_gacha_box_pan_info=k;break;case"Res_User_Event_Dungeon_Panel_Gacha_Pan_Buy":_event_panel_gacha_box_pan_buy=k,(b={panel_pan_idx:0,reward_idx:0}).panel_pan_idx=k.panel_pan_idx,b.reward_idx=k.event_dungeon_panel_gacha_pan_buy_log[0].panel_pan_idx,_event_panel_gacha_box_pan_info.event_dungeon_panel_gacha_pan_info.push(b);break;case"Res_User_Event_Dungeon_Panel_Gacha_Next_Box":_event_panel_gacha_next_box=k,_event_panel_gacha_box_pan_info.event_dungeon_panel_gacha_box_idx=k.panel_box_idx,_event_panel_gacha_box_pan_info.event_dungeon_panel_gacha_pan_info=[];break;case"Res_Special_Ticket_Gacha_Buy":bu.new_User_General(k.new_user_generals),bu.update_User_Gacha_Count(k.user_gacha_buy_count),(X={}).special_ticket_gacha_idx=k.special_ticket_gacha_idx,X.ticket_cnt=k.user_special_gacha_ticket,bu.update_User_Special_Gacha_Ticket(X);break;case"Res_Get_Exchange_Ticket_Buy_Log":_exchange_ticket_buy_log=k;break;case"Res_Exchange_Ticket_Buy":bu.new_User_General(k.new_user_generals),bu.upd_UserExchangeTicket(k.exchange_ticket_count);for(i=0;i<k.buy_log.length;i++){found=!1,index=0;if(null!=_exchange_ticket_buy_log&&null!=_exchange_ticket_buy_log&&null!=_exchange_ticket_buy_log.buy_log&&0<_exchange_ticket_buy_log.buy_log.length)for(j=0;j<_exchange_ticket_buy_log.buy_log.length;j++)if(_exchange_ticket_buy_log.buy_log[j].shop_id==k.buy_log[i].shop_id&&_exchange_ticket_buy_log.buy_log[j].exchange_ticket_info_idx==k.buy_log[i].exchange_ticket_info_idx){found=!0,index=j;break}found?(_exchange_ticket_buy_log.buy_log[index].buy_count=k.buy_log[i].buy_count,_exchange_ticket_buy_log.buy_log[index].buy_enable_yn=k.buy_log[i].buy_enable_yn):_exchange_ticket_buy_log.buy_log.push(k.buy_log[i])}break;case"Res_Step_Up_Gacha_Dmm_Point_Buy_Complete":if(bu.new_User_General(k.new_user_generals),bu.update_User_Gacha_Count(k.user_gacha_buy_count),0<k.user_step_up_buy_log.length){found=!1;var Z=0;for(n=0;n<_step_up_gacha_buy_log.step_up_buy_log.length;n++){if((bJ=_step_up_gacha_buy_log.step_up_buy_log[n]).shop_id==k.shop_id&&bJ.step_up_gacha_idx==k.step_up_gacha_idx){found=!0,Z=n;break}}if(found)_step_up_gacha_buy_log.step_up_buy_log[Z].buy_log=[],_step_up_gacha_buy_log.step_up_buy_log[Z].reset_count=k.reset_count,_step_up_gacha_buy_log.step_up_buy_log[Z].buy_log=k.user_step_up_buy_log;else(bJ={}).shop_id=k.shop_id,bJ.step_up_gacha_idx=k.step_up_gacha_idx,bJ.reset_count=k.reset_count,bJ.buy_log=k.user_step_up_buy_log,_step_up_gacha_buy_log.step_up_buy_log.push(bJ)}else{for(found=!1,Z=0,n=0;n<_step_up_gacha_buy_log.step_up_buy_log.length;n++){if((bJ=_step_up_gacha_buy_log.step_up_buy_log[n]).shop_id==k.shop_id&&bJ.step_up_gacha_idx==k.step_up_gacha_idx){found=!0,Z=n;break}}if(found)_step_up_gacha_buy_log.step_up_buy_log[Z].buy_log=[],_step_up_gacha_buy_log.step_up_buy_log[Z].reset_count=k.reset_count;else(bJ={}).shop_id=k.shop_id,bJ.step_up_gacha_idx=k.step_up_gacha_idx,bJ.reset_count=k.reset_count,_step_up_gacha_buy_log.step_up_buy_log.push(bJ)}break;case"Res_Step_Up_Gacha_Dmm_Point_Buy_Payment_Info":case"Res_Step_Up_Gacha_Dmm_Point_Buy_Omission":break;case"Res_Step_Up_Gacha_Jade_Buy":bu.new_User_General(k.new_user_generals),bu.upd_User_Item(k);for(j=0;j<k.new_user_generals.length;j++)"y"==k.new_user_generals[j].is_new_yn&&this.new_User_Books_General(m_user_id,k.new_user_generals[j].gnrl_id);if(bu.upd_User_Gacha_Count(k.user_gacha_buy_count),0<_step_up_gacha_buy_log.step_up_buy_log.length){for(found=!1,Z=0,n=0;n<_step_up_gacha_buy_log.step_up_buy_log.length;n++){if((bJ=_step_up_gacha_buy_log.step_up_buy_log[n]).shop_id==k.shop_id&&bJ.step_up_gacha_idx==k.step_up_gacha_idx){found=!0,Z=n;break}}if(found)_step_up_gacha_buy_log.step_up_buy_log[Z].buy_log=[],_step_up_gacha_buy_log.step_up_buy_log[Z].reset_count=k.reset_count,_step_up_gacha_buy_log.step_up_buy_log[Z].buy_log=k.user_step_up_buy_log;else(bJ={}).shop_id=k.shop_id,bJ.step_up_gacha_idx=k.step_up_gacha_idx,bJ.reset_count=k.reset_count,bJ.buy_log=k.user_step_up_buy_log,_step_up_gacha_buy_log.step_up_buy_log.push(bJ)}else{for(found=!1,Z=0,n=0;n<_step_up_gacha_buy_log.step_up_buy_log.length;n++){if((bJ=_step_up_gacha_buy_log.step_up_buy_log[n]).shop_id==k.shop_id&&bJ.step_up_gacha_idx==k.step_up_gacha_idx){found=!0,Z=n;break}}if(found)_step_up_gacha_buy_log.step_up_buy_log[Z].buy_log=[],_step_up_gacha_buy_log.step_up_buy_log[Z].reset_count=k.reset_count;else(bJ={}).shop_id=k.shop_id,bJ.step_up_gacha_idx=k.step_up_gacha_idx,bJ.reset_count=k.reset_count,bJ.buy_log=k.user_step_up_buy_log,_step_up_gacha_buy_log.step_up_buy_log.push(bJ)}MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);break;case"Res_Weekly_Dungeon_Battle_Skip":bu.upd_User_Key(k.user_key),bu.upd_UserSkipTicket(k.user_skip_ticket);for(n=0;n<k.bonus_items.length;n++){var bv;if((b=k.bonus_items[n]).bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX)(bv={}).gnrl_id=b.bonus_idx,bv.gnrl_num=b.bonus_num,bv.gnrl_level=b.bonus_level,bv.castle_id=b.castle_id,bu.insert_User_General(bv);else if(b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7)bu.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)bu.plus_User_Love_Item(b.bonus_idx,b.bonus_num);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE)bu.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_ATTK_POINT&&b.bonus_type<=BONUS_TYPE_CRI_DMG_POINT)bu.plus_User_Formation_Property_Point(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_YUNHEE_PT)bu.plus_User_Yunhee_PT(b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_EVOLVE_ORB)bu.plus_User_Evolve_Orb(b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_GOLD);else if(b.bonus_type==BONUS_TYPE_JADE);else if(b.bonus_type==BONUS_TYPE_HEART);else if(b.bonus_type==BONUS_TYPE_USER_EXP);else if(b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){F=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(b.bonus_type);bu.plus_User_Rebirth_Mtrl(F,b.bonus_idx)}}bu.upd_UserLevelExp(k.user_level,k.user_exp),bu.upd_UserJade(k.user_jade),bu.upd_UserGold(k.user_gold),bu.upd_UserFormationPoint(k.user_formation_point),bu.upd_UserHeart(k.user_heart),bu.upd_UserItemRaidTicket(k.user_raid_ticket),bu.upd_UserRaidHelpTicket(k.user_raid_help_ticket);break;case"Res_Open_Event_Dungeon_Box_Gacha":var bw={};if(bw.box_gacha_info_idx=k.box_gacha_info_idx,bw.event_dungeon_period_idx=k.event_dungeon_period_idx,bw.item_idx=k.item_idx,bw.item_num=k.item_num,bw.random_bonus_type=k.random_bonus_type,bw.random_bonus_item_idx=k.random_item_idx,bw.random_bonus_count=k.random_bonus_count,bw.init_count=k.init_count,-1!=(found=list_User_Box_Gacha_Info.findIndex(function(m){return k.box_gacha_info_idx==m.box_gacha_info_idx&&k.init_count==m.init_count&&k.item_num==m.item_num}))||list_User_Box_Gacha_Info.push_back(bw),0!=k.random_bonus_type){var bx={};bx.bonus_type=k.random_bonus_type,bx.item_idx=k.random_item_idx,bx.item_count=k.random_bonus_count,bx.box_gacha_info_idx=k.box_gacha_info_idx,list_User_Box_Gacha_Golden_Barrel_Info.push_back(bx)}bu.update_User_Event_Dungeon_Point(k.event_dungeon_point);break;case"Res_Great_Wall_Troops_Recovery":break;case"Res_Great_Wall_Dungeon_Battle_Begin":bu.update_Great_Wall_Dungeon_Battle_Begin(k);break;case"Res_Great_Wall_Dungeon_Battle_Win":bu.update_Great_Wall_Dungeon_Battle_Win(k);break;case"Res_Great_Wall_Dungeon_Battle_Lose":bu.update_Great_Wall_Dungeon_Battle_Lose(k);break;case"Res_Great_Wall_Dungeon_Continue_Check":bu.update_Great_Wall_Dungeon_Battle_Check(k);break;case"Req_Get_Server_Time_Check":(new GameDate).resetServerTime(k.server_time),TimeEventEngine.getInstance().setTime(TIME_EVENT_SERVER_TIME,1e3*k.server_time),0<NetService().get_list_User_Mail().size()?GameContext.getInstance().setUserNewMail("y"):"y"<k.raid_boss_reward_mail_yn&&GameContext.getInstance().setUserNewMail("y"),MainObserver.getInstance().postNotification(NOTIFICATION_NEW_MAIL,message_new_mail),MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],message_new_raid_boss);break;case"Res_Get_User_Mussang_Tower_Info":bu.delete_User_Mussang_Tower(),bu.insert_User_Mussang_Tower(k.user_mussang_towers),bu.delete_User_Mussang_Tower_Task(),bu.insert_User_Mussang_Tower_Task(k.user_mussang_tower_tasks),bu.delete_User_Mussang_Tower_Lotus_Log(),bu.insert_User_Mussang_Tower_Lotus_Log(k.user_mussang_tower_lotus_logs);break;case"Res_User_Mussang_Tower_Recv_Lotus_Reward":var by=m_user_mussang_tower_lotus_log.at([m_user_id,k.period_idx,k.lotus_count]);by.complete_yn=k.complete_yn,by.new_yn="n";break;case"Res_Get_User_Rebirth_Mtrl_Info":bu.delete_User_Rebirth_Mtrl(),bu.insert_User_Rebirth_Mtrl(k.rebirth_mtrl_info);break;case"Res_Get_User_Naming_Info":bu.delete_User_Naming_Info(),bu.insert_User_Naming_Info(k.naming_list);break;case"Res_Set_User_Naming":var bz=bu.get_User_info();(X={}).user_id=bz.user_id,X.nickname=bz.nickname,X.state_type=bz.state_type,X.user_level=bz.user_level,X.user_exp=bz.user_exp,X.join_bonus_cmplt_yn=bz.join_bonus_cmplt_yn,X.naming=k.naming,bu.insert_User_info(X);break;case"Res_Get_User_Event_Dungeon_Growth_Info":m_Res_Get_User_Event_Dungeon_Growth_Info=k;break;case"Res_Event_Dungeon_Growth_Level_Up":bu.update_User_Event_Dungeon_Special_Point(k.event_dungeon_special_point),m_Res_Get_User_Event_Dungeon_Growth_Info.growth_level=k.growth_level,m_Res_Get_User_Event_Dungeon_Growth_Info.level_point=k.level_point,m_Res_Get_User_Event_Dungeon_Growth_Info.first_growth_yn=0;break;case"Res_Event_Dungeon_Point_Reward_Shop":(P=UserService.getInstance()).updateUserItemEventDungeonPoint(k.user_event_dungeon_point,k.user_accum_event_dungeon_point,k.event_dungeon_period_idx),(bI={}).event_dungeon_period_idx=k.event_dungeon_period_idx,bI.event_dungeon_reward_shop_idx=k.event_dungeon_reward_shop_idx,bI.buy_count=k.event_dungeon_reward_shop_item_count,bu.update_User_Event_Dungeon_Reward_Shop(bI),GameContext.getInstance().setUserNewMail("y");break;case"Res_Get_User_Event_Dungeon_Satisfaction_Info":m_Res_Get_User_Event_Dungeon_Satisfaction_Info=k;break;case"Res_Mussang_Tower_Battle_Begin":bu.upd_User_Key(k.user_key);break;case"Res_Mussang_Tower_Battle_Win":bu.update_Mussgang_Tower_Battle_Win(k);break;case"Res_Mussang_Tower_Battle_Lose":break;case"Res_Get_User_Event_Dungeon_Once_A_Day":bu.delete_User_Event_Dungeon_Once_A_Day();for(n=0;n<k.user_event_dungeon.length;n++){var d=k.user_event_dungeon[n];bu.update_User_Event_Dungeon_Once_A_Day(d)}break;case"Res_Event_Once_A_Day_Dungeon_Battle_Begin":bu.upd_User_Key(k.user_key);break;case"Res_Event_Once_A_Day_Dungeon_Battle_Win":bu.update_Event_Once_A_Day_Dungeon_Battle_Win(k);break;case"Res_Event_Once_A_Day_Dungeon_Battle_Lose":break;case"Res_Event_Dungeon_Satisfaction_Level_Up":bu.update_User_Event_Dungeon_Point(k.event_dungeon_point),m_Res_Get_User_Event_Dungeon_Satisfaction_Info.satisfaction_level=k.satisfaction_level,m_Res_Get_User_Event_Dungeon_Satisfaction_Info.level_point=k.level_point;break;case"Res_Event_Dungeon_Satisfaction_Reward":for(var bA=0;bA<k.reward_list.length;bA++){(bI={}).event_dungeon_group_idx=k.event_dungeon_period_idx,bI.reward_idx=k.reward_list[bA].reward_idx,m_Res_Get_User_Event_Dungeon_Satisfaction_Info.user_reward_list.push_back(bI)}break;case"Res_Event_Dungeon_Search_Area_Info":map_Event_Dungeon_Search_Area_Info.clear(),map_User_Event_Dungeon_Search_Troops.clear(),map_User_Event_Dungeon_Search_Troops_Generals.clear();for(n=0;n<k.event_dungeon_search_area_info.length;n++){var bB=k.event_dungeon_search_area_info[n];map_Event_Dungeon_Search_Area_Info.insert(bB.search_area_idx,bB)}for(var bC=0;bC<k.user_search_troops.length;bC++){var bD=k.user_search_troops[bC];map_User_Event_Dungeon_Search_Troops.insert(bD.troops_num,bD)}for(var bE=0;bE<k.user_search_troops_generals.length;bE++){var bF=k.user_search_troops_generals[bE];null==(bG=map_User_Event_Dungeon_Search_Troops_Generals.at(bF.troops_num))&&(bG=[]),bG.push_back(bF),map_User_Event_Dungeon_Search_Troops_Generals.insert(bF.troops_num,bG)}break;case"Res_Event_Dungeon_Search_Troops_Set":if(null!=(bG=map_User_Event_Dungeon_Search_Troops_Generals.at(k.troops_num))){bG=bG.filter(function(l){return l.troops_num!=k.troops_num||l.position!=k.position&&l.gnrl_num!=k.gnrl_key.gnrl_num});var g={};g.gnrl_id=k.gnrl_key.gnrl_id,g.gnrl_num=k.gnrl_key.gnrl_num,g.position=k.position,g.troops_num=k.troops_num,bG.push(g);for(bE=0;bE<bG.length;bE++){if((bF=bG[bE]).gnrl_id==k.leader_gnrl_key.gnrl_id&&bF.gnrl_num==k.leader_gnrl_key.gnrl_num){bF.leader_yn="y";break}}map_User_Event_Dungeon_Search_Troops_Generals.insert(k.troops_num,bG)}break;case"Res_Event_Dungeon_Search_Troops_Del":if(null!=(bG=map_User_Event_Dungeon_Search_Troops_Generals.at(k.troops_num))){bG=bG.filter(function(l){return l.troops_num!=k.troops_num||l.gnrl_id!=k.gnrl_key.gnrl_id||l.gnrl_num!=k.gnrl_key.gnrl_num});for(bE=0;bE<bG.length;bE++){if((bF=bG[bE]).gnrl_id==k.leader_gnrl_key.gnrl_id&&bF.gnrl_num==k.leader_gnrl_key.gnrl_num){bF.leader_yn="y";break}}map_User_Event_Dungeon_Search_Troops_Generals.insert(k.troops_num,bG)}break;case"Res_Event_Dungeon_Search_Troops_Leader_Set":var bG=map_User_Event_Dungeon_Search_Troops_Generals.at(k.troops_num);for(bE=0;bE<bG.length;bE++){(bF=bG[bE]).gnrl_id==k.leader_gnrl_key.gnrl_id&&bF.gnrl_num==k.leader_gnrl_key.gnrl_num?bF.leader_yn="y":bF.leader_yn="n"}break;case"Res_Event_Dungeon_Search_Result_Info":bu.update_User_Event_Dungeon_Point(k.event_dungeon_point),null!=(found=map_Event_Dungeon_Search_Area_Info.at(k.search_area_idx))&&map_Event_Dungeon_Search_Area_Info.remove(k.search_area_idx);break;case"Res_Event_Dungeon_Search_Begin":bu.update_User_Event_Dungeon_Point(k.event_dungeon_point),map_Event_Dungeon_Search_Area_Info.insert(k.search_area_idx,k.event_dungeon_search_area_info);break;case"Res_Event_Dungeon_Search_Cancel":bu.update_User_Event_Dungeon_Point(k.event_dungeon_point),null!=(found=map_Event_Dungeon_Search_Area_Info.at(k.search_area_idx))&&map_Event_Dungeon_Search_Area_Info.remove(k.search_area_idx);break;case"Res_Event_Dungeon_Search_Troops_Info":map_User_Event_Dungeon_Search_Troops.clear(),map_User_Event_Dungeon_Search_Troops_Generals.clear();for(bC=0;bC<k.user_search_troops.length;bC++){bD=k.user_search_troops[bC];map_User_Event_Dungeon_Search_Troops.insert(bD.troops_num,bD)}for(bE=0;bE<k.user_search_troops_generals.length;bE++){if(null!=(bF=k.user_search_troops_generals[bE]))null==(bG=map_User_Event_Dungeon_Search_Troops_Generals.at(bF.troops_num))&&(bG=[],map_User_Event_Dungeon_Search_Troops_Generals.insert(bF.troops_num,bG)),bG.push_back(bF)}break;case"Res_Event_Dungeon_Search_Troops_Auto_Pairing":null!=(found=map_User_Event_Dungeon_Search_Troops_Generals.at(k.troops_num))&&map_User_Event_Dungeon_Search_Troops_Generals.remove(k.troops_num);for(bG=[],bE=0;bE<k.gnrl_key_list.length;bE++)bG.push_back(k.gnrl_key_list[bE]);map_User_Event_Dungeon_Search_Troops_Generals.insert(k.troops_num,bG);break;case"Res_Event_Dungeon_Search_Troops_Batch_Off":null!=(found=map_User_Event_Dungeon_Search_Troops_Generals.at(k.troops_num))&&map_User_Event_Dungeon_Search_Troops_Generals.remove(k.troops_num);break;case"Res_Shop_Buy_Random_Box":case"Res_Shop_Buy_Normal_Gacha_Ticket":k.buy_type==SHOP_BUY_TYPE_JADE?(bu.upd_UserJade(k.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):k.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(bu.upd_UserYunheePT(k.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):k.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(bu.upd_UserHeavenPt(k.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation));break;case"Res_General_Rebirth":bu.update_General_Rebirth(k);break;case"Res_Event_Dungeon_Craft_Shop_Time_Reduction":bu.upd_UserJade(k.user_jade);break;case"Res_Get_User_Event_Dungeon_Vd_Info":bu.delete_User_Event_Dungeon_Vd_Yunhee(),bu.insert_User_Event_Dungeon_Vd_Yunhee(k),bu.delete_User_Event_Dungeon_Personal_Accm_Point(),bu.insert_User_Event_Dungeon_Personal_Accm_Point_Info(k.user_event_dungeon_personal_point_reward);break;case"Res_Get_User_Event_Dungeon_Personal_Accm_Point_Bonus_Info":bu.delete_User_Event_Dungeon_Personal_Accm_Point(),bu.insert_User_Event_Dungeon_Personal_Accm_Point_Info(k.user_event_dungeon_personal_point_reward);break;case"Res_Get_User_Event_Dungeon_Christmas_Info":m_Res_Get_User_Event_Dungeon_Christmas_Info=$.extend({},k),bu.delete_User_Christmas_Reward(m_Res_Get_User_Event_Dungeon_Christmas_Info.event_dungeon_group_idx);for(n=0;n<m_Res_Get_User_Event_Dungeon_Christmas_Info.user_event_dungeon_christmas_reward.length;n++){var bH=m_Res_Get_User_Event_Dungeon_Christmas_Info.user_event_dungeon_christmas_reward[n];bu.plus_User_Christmas_Reward(bH.bonus_type,bH.accum_count,bH.event_dungeon_group_idx)}bu.plus_User_Christmas_Personal_Point_Reward(m_Res_Get_User_Event_Dungeon_Christmas_Info.accum_count,m_Res_Get_User_Event_Dungeon_Christmas_Info.event_dungeon_group_idx);break;case"Res_Event_Dungeon_Christmas_Personal_Point_Reward":for(n=0;n<k.personal_point_reward_list.length;n++){var bI,personal_reward=k.personal_point_reward_list[n];(bI={}).event_dungeon_group_idx=k.event_dungeon_group_idx,bI.step=personal_reward.step,bI.rewarded_yn="y",bI.bonus_count=personal_reward.bonus_count,m_Res_Get_User_Event_Dungeon_Christmas_Info.user_event_dungeon_personal_point_reward.push_back(bI)}break;case"Res_Event_Dungeon_Global_Achv_Reward_Receive":k.global_point_reward_list.forEach(function(r){bu.update_User_Event_Dungeon_Global_Point_Info(r)}),GameContext.getInstance().setUserNewMail("y");break;case"Res_Shop_Buy_Rebirth_Mtrl":if(k.buy_type==SHOP_BUY_TYPE_JADE){bu.upd_UserJade(k.user_goods);F=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(k.bonus_type);bu.plus_User_Rebirth_Mtrl(F,k.rebirth_mtrl_count),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)}else if(k.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT){bu.upd_UserYunheePT(k.user_goods);F=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(k.bonus_type);bu.plus_User_Rebirth_Mtrl(F,k.rebirth_mtrl_count),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)}else if(k.buy_type==SHOP_BUY_TYPE_HEAVEN_PT){bu.upd_UserHeavenPt(k.user_goods);F=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(k.bonus_type);bu.plus_User_Rebirth_Mtrl(F,k.rebirth_mtrl_count),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)}break;case"Res_Get_User_Food":bu.delete_User_Food_Infos(),k.user_food_list.forEach(function(a){bu.insert_User_Food_Info(a)});break;case"Res_Get_User_Event_Dungeon_Vote_League_Reward":bu.delete_User_Event_Dungeon_Vote_League_Reward(),bu.insert_User_Event_Dungeon_Vote_League_Rewards(k.user_reward_list);break;case"Res_Get_User_Event_Dungeon_Use_Point_Reward":bu.delete_User_Event_Dungeon_Use_Point_Reward(),bu.insert_User_Event_Dungeon_Use_Point_Rewards(k.user_reward_list);break;case"Res_Get_User_Event_Dungeon_Vote_League_Record":list_User_Event_Dungeon_Vote_League_Record=k.user_vote_league_record_list,TimeEventEngine.getInstance().setTime(TIME_EVENT_SERVER_TIME,1e3*k.server_time);break;case"Res_Event_Dungeon_Vote_League_Reward_Receive":var bJ;A=MasterManager.getInstance().get_EventDungeonPeriod(k.event_dungeon_period_idx);(bJ={}).event_dungeon_group_idx=A.event_dungeon_group_idx,bJ.league_reward_idx=k.league_reward_idx,bJ.reward_yn="y",bu.insert_User_Event_Dungeon_Vote_League_Reward(bJ),GameContext.getInstance().setUserNewMail("y");break;case"Res_Event_Dungeon_Mussang_Boss_Battle_Begin":bu.upd_User_Key(k.user_key),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation),User_Mussang_boss_info.user_mussang_boss_npc_info.some(function(a){if(k.boss_dungeon_idx==a.boss_dungeon_idx)return a.remain_hp=k.remain_hp,!0});break;case"Res_Get_User_Event_Dungeon_Mussang_Boss_Info":User_Mussang_boss_info={},User_Mussang_boss_info.user_mussang_boss_infos=k.user_mussang_boss_infos,User_Mussang_boss_info.user_mussang_boss_npc_info=k.user_mussang_boss_npc_info;break;case"Res_Event_Dungeon_Mussang_Boss_Battle_Lose":User_Mussang_boss_info.user_mussang_boss_npc_info.some(function(a){if(k.boss_dungeon_idx==a.boss_dungeon_idx)return a.remain_hp=k.remain_hp,!0});break;case"Res_Event_Dungeon_Mussang_Boss_Battle_Win":User_Mussang_boss_info.user_mussang_boss_npc_info.some(function(a){if(k.boss_dungeon_idx==a.boss_dungeon_idx)return a.remain_hp=k.remain_hp,a.remain_hp<=0&&(a.dead_yn="y"),!0}),User_Mussang_boss_info.user_mussang_boss_infos.some(function(a){a.boss_dungeon_idx==k.boss_dungeon_idx&&(a.complete_yn="y")}),k.drop_bonus_items.forEach(function(b){if(b.bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX){var a={};a.gnrl_id=b.bonus_idx,a.gnrl_num=b.bonus_num,a.gnrl_level=b.bonus_level,a.castle_id=b.castle_id,a.used_in_camp="n",a.using_in_camp="n";var c=MasterManager.getInstance().get_General(a.gnrl_id);c.gnrl_type!=GENERAL_TYPE_YUNHEE&&c.gnrl_type!=GENERAL_TYPE_LIMIT_OVER||c.rare_type!=RARE_TYPE_SSR?a.lock_yn="n":a.lock_yn="y",bu.insert_User_General(a)}else if(b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7)bu.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)bu.plus_User_Love_Item(b.bonus_idx,b.bonus_num);else if(b.bonus_type==BONUS_TYPE_HEART);else if(b.bonus_type==BONUS_TYPE_JADE);else if(b.bonus_type==BONUS_TYPE_GOLD);else if(b.bonus_type==BONUS_TYPE_KEY);else if(b.bonus_type==BONUS_TYPE_RAID_TICKET);else if(b.bonus_type==BONUS_TYPE_EVENT_POINT);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE||b.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE)bu.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_EVOLVE_ORB)bu.plus_User_Evolve_Orb(b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL)bu.plus_User_Magic_Key_Mtrl(b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&b.bonus_type<=BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND){var d=b.bonus_type-BONUS_TYPE_CRAFT_SHOP_FIRST_LOW+4;bu.plus_User_Craft_Shop_Material(d,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EQUIPMENT)bu.insert_User_Equipment(b.equipment);else if(b.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||b.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL){var e=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(b.bonus_type);bu.plus_User_Limit_Over_Mtrl(e,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EVENT_DUNGEON_SPECIAL_POINT);else if(b.bonus_type==BONUS_TYPE_USER_EXP);else if(b.bonus_type==BONUS_TYPE_HN_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_R_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_HR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_SR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_R_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_HR_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_SR_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_HIGH_ENGAGE_TEN||b.bonus_type==BONUS_TYPE_NORMAL_ENGAGE_TEN||b.bonus_type==BONUS_TYPE_HIGH_ENGAGE||b.bonus_type==BONUS_TYPE_NORMAL_ENGAGE||b.bonus_type==BONUS_TYPE_HIGH_ENGAGE_TEN_ARMY||b.bonus_type==BONUS_TYPE_NORMAL_ENGAGE_TEN_ARMY||b.bonus_type==BONUS_TYPE_HIGH_ENGAGE_ARMY||b.bonus_type==BONUS_TYPE_NORMAL_ENGAGE_ARMY||b.bonus_type==BONUS_TYPE_RETURN_USER_GIFT_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_LOGIN_GIFT_BOX||b.bonus_type==BONUS_TYPE_JADE_RANDOM_BOX||b.bonus_type==BONUS_TYPE_GOLD_RANDOM_BOX||b.bonus_type==BONUS_TYPE_LOVE_ITEM_RANDOM_BOX||b.bonus_type==BONUS_TYPE_RARE_HWANDAN_RANDOM_BOX||b.bonus_type==BONUS_TYPE_EXP_CARD_RANDOM_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_GIFT_BOX||b.bonus_type==BONUS_TYPE_LUCKY_BOX||b.bonus_type==BONUS_TYPE_SWORD_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_SPEAR_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_ARCHER_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_RANDOM_BOX||b.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_GIFT_BOX||b.bonus_type==BONUS_TYPE_TREASURE_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_BOX_v2||b.bonus_type==BONUS_TYPE_CHRISTMAS_BOX_V3||b.bonus_type==BONUS_TYPE_EVENTDUNGEON_PRESENT_GIFT_BOX||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_1||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_2||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_3||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_4||b.bonus_type==BONUS_TYPE_GOLDEN_BOX||b.bonus_type==BONUS_TYPE_SILVER_BOX||b.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_GACHA_REBORN_GNRL_TICKET||b.bonus_type==BONUS_TYPE_ALL_RARE_TYPE_GNRL_SELECT_TICKET||b.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET||b.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET_V2||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_2||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_3||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_4||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_5||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_6||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_7||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_8||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_9||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_10);else if(b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){var f=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(b.bonus_type);bu.plus_User_Rebirth_Mtrl(f,b.bonus_idx)}else b.bonus_type==BONUS_TYPE_JADE_PIECE&&bu.plus_User_Jade_Piece(b.bonus_idx)});break;case"Res_Event_Raid_Box_Gacha_Buy":for(i=0;i<User_Box_Gacha_List.event_dungeon_box_gacha_info.length;i++)User_Box_Gacha_List.event_dungeon_box_gacha_info[i].event_dungeon_period_idx==k.event_dungeon_period_idx&&User_Box_Gacha_List.event_dungeon_box_gacha_info[i].delimiter==k.delimiter&&(User_Box_Gacha_List.event_dungeon_box_gacha_info[i].event_raid_box_gacha_ticket=k.event_raid_box_gacha_ticket,User_Box_Gacha_List.event_dungeon_box_gacha_info[i].box_list.clear(),User_Box_Gacha_List.event_dungeon_box_gacha_info[i].box_list=k.box_list);for(P=UserService.getInstance(),m=MasterManager.getInstance(),j=0;j<k.reward_items.length;j++){var bK=k.reward_items[j];m.get_BonusType(bK.bonus_type);bK.bonus_type==BONUS_TYPE_YUNHEE_FIX||bK.bonus_type==BONUS_TYPE_JIN_FIX||(bK.bonus_type==BONUS_TYPE_HWANDAN_1||bK.bonus_type==BONUS_TYPE_HWANDAN_2||bK.bonus_type==BONUS_TYPE_HWANDAN_3||bK.bonus_type==BONUS_TYPE_HWANDAN_4||bK.bonus_type==BONUS_TYPE_HWANDAN_5||bK.bonus_type==BONUS_TYPE_HWANDAN_6||bK.bonus_type==BONUS_TYPE_HWANDAN_7?bu.plus_User_Hwandan(bK.bonus_type,bK.bonus_idx):bK.bonus_type==BONUS_TYPE_LOVE_ITEM||(bK.bonus_type==BONUS_TYPE_HEART?bu.plus_User_Heart(bK.bonus_idx):bK.bonus_type==BONUS_TYPE_JADE||(bK.bonus_type==BONUS_TYPE_GOLD?bu.plus_User_Gold(bK.bonus_idx):bK.bonus_type==BONUS_TYPE_KEY||bK.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&bK.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE||bK.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE||(bK.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&bK.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER?bu.plus_User_Evolve_Arm_Service(bK.bonus_type,bK.bonus_idx):bK.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&bK.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE?bu.plus_User_Evolve_Arm_Service(bK.bonus_type,bK.bonus_idx):bK.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&bK.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW?bu.plus_User_Evolve_Arm_Service(bK.bonus_type,bK.bonus_idx):bK.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL||bK.bonus_type>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&bK.bonus_type<=BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND||bK.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||bK.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||bK.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||bK.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||bK.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||bK.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||bK.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||bK.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||bK.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||bK.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||bK.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||bK.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||bK.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6||bK.bonus_type==BONUS_TYPE_EQUIPMENT||bK.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||bK.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL||bK.bonus_type==BONUS_TYPE_EVOLVE_ORB||bK.bonus_type==BONUS_TYPE_JADE_PIECE||bK.bonus_type==BONUS_TYPE_JADE_RANDOM_BOX||bK.bonus_type==BONUS_TYPE_GOLD_RANDOM_BOX||bK.bonus_type==BONUS_TYPE_LOVE_ITEM_RANDOM_BOX||bK.bonus_type==BONUS_TYPE_RARE_HWANDAN_RANDOM_BOX||bK.bonus_type==BONUS_TYPE_EXP_CARD_RANDOM_BOX||bK.bonus_type==BONUS_TYPE_CHRISTMAS_GIFT_BOX||bK.bonus_type==BONUS_TYPE_SWORD_ORB_RANDDOM_BOX||bK.bonus_type==BONUS_TYPE_SPEAR_ORB_RANDDOM_BOX||bK.bonus_type==BONUS_TYPE_ARCHER_ORB_RANDDOM_BOX||bK.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_RANDOM_BOX||bK.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_GIFT_BOX||bK.bonus_type==BONUS_TYPE_EVENTDUNGEON_PRESENT_GIFT_BOX||bK.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||bK.bonus_type==BONUS_TYPE_R_RARE_TYPE_ENGAGE||bK.bonus_type==BONUS_TYPE_HR_RARE_TYPE_ENGAGE||bK.bonus_type==BONUS_TYPE_SR_RARE_TYPE_ENGAGE||bK.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_SELECT||bK.bonus_type==BONUS_TYPE_HN_RARE_TYPE_SELECT||bK.bonus_type==BONUS_TYPE_R_RARE_TYPE_SELECT||bK.bonus_type==BONUS_TYPE_HR_RARE_TYPE_SELECT||bK.bonus_type==BONUS_TYPE_SR_RARE_TYPE_SELECT||bK.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_1||bK.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_2||bK.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_3||bK.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_4||bK.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_GACHA_REBORN_GNRL_TICKET||bK.bonus_type==BONUS_TYPE_ALL_RARE_TYPE_GNRL_SELECT_TICKET||bK.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET||bK.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET_V2||bK.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET||bK.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_2||bK.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_3||bK.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_4||bK.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_5||bK.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_6||bK.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_7||bK.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_8||bK.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_9||bK.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_10||bK.bonus_type==BONUS_TYPE_KEY_REFILL||bK.bonus_type==BONUS_TYPE_TICKET_REFILL||bK.bonus_type==BONUS_TYPE_RAID_TICKET_REFILL||bK.bonus_type==BONUS_TYPE_TICKET_REFILL||bK.bonus_type==BONUS_TYPE_SKIP_TICKET||(bK.bonus_type,BONUS_TYPE_EXCHANGE_TICKET)))))}break;case"Res_Event_Dungeon_Mussang_Boss_Continue_Check":var bL=k.boss_dungeon_idx,dungeon_period_idx=k.event_dungeon_period_idx,remain_hp=k.remain_hp;k.position;BattleContext._getInstance().setEventDungeonPeriodIdX(dungeon_period_idx);var bM={};bM.boss_dungeon_idx=bL,bM.event_dungeon_period_idx=dungeon_period_idx,bM.complete_yn="n";var bN={},mt=MasterManager.getInstance(),mastertable_npcinfo=MasterTable.getInstance().get_EventDungeonMussangBossNpcList(bM.boss_dungeon_idx),npc=mt.get_NpcGeneral(mastertable_npcinfo.at(0).npc1_id);bN.boss_dungeon_idx=bL,bN.dead_yn="n",bN.position=1,bN.event_dungeon_period_idx=dungeon_period_idx,bN.max_hp=npc.hp,bN.remain_hp=remain_hp,User_Mussang_boss_info.user_mussang_boss_infos.push_back(bM),User_Mussang_boss_info.user_mussang_boss_npc_info.push_back(bN),bu.set_User_Mussang_Boss_list_Cnt(0);var bO=mt.get_EventDungeonMussangBossInfo(bL,dungeon_period_idx);BattleContext._getInstance().setEventDungeonMussangBossLimitTime(bO.time_limit);break;case"Res_Get_User_Game_State":bu.insert_User_Game_State(k.user_game_state);break;case"Res_Get_World_War_Season_Info":NetServiceV3.getInstance().updateResponse_Res_Get_World_War_Season_Info(k);break;case"Res_Get_World_War_User_Item_Info":NetServiceV3.getInstance().updateResponse_Res_Get_World_War_User_Item_Info(k);break;case"Res_Get_World_War_Troops":NetServiceV3.getInstance().updateResponse_Res_Get_World_War_Troops(k);break;case"Res_Get_World_War_Partin_Generals":NetServiceV3.getInstance().updateResponse_Res_Get_World_War_Partin_Generals(k);break;case"Res_Get_World_War_General_Equipments":NetServiceV3.getInstance().updateResponse_Res_Get_World_War_General_Equipments(k);break;case"Res_Get_World_War_Info":NetServiceV3.getInstance().updateResponse_Res_Get_World_War_Info(k);break;case"Res_World_War_Castle_Occupation_Info":NetServiceV3.getInstance().updateResponse_Res_World_War_Castle_Occupation_Info(k);break;case"Res_World_War_Npc_Troops":NetServiceV3.getInstance().updateResponse_Res_World_War_Npc_Troops(k);break;case"Res_World_War_Troops_Set":NetServiceV3.getInstance().updateResponse_Res_World_War_Troops_Set(k);break;case"Res_World_War_Troops_Del":NetServiceV3.getInstance().updateResponse_Res_World_War_Troops_Del(k);break;case"Res_World_War_Troops_Leader_Set":NetServiceV3.getInstance().updateResponse_Res_World_War_Troops_Leader_Set(k);break;case"Res_World_War_Troops_General_Equipment_Item_Set":NetServiceV3.getInstance().updateResponse_Res_World_War_Troops_General_Equipment_Item_Set(k);break;case"Res_World_War_Troops_General_Equipment_Item_Del":NetServiceV3.getInstance().updateResponse_Res_World_War_Troops_General_Equipment_Item_Del(k);break;case"Res_World_War_Reset":NetServiceV3.getInstance().updateResponse_Res_World_War_Reset(k);break;case"Res_World_War_Troops_Move":NetServiceV3.getInstance().updateResponse_Res_World_War_Troops_Move(k);break;case"Res_User_Unique_Equipment_Ticket":NetServiceV3.getInstance().updateResponse_Res_User_Unique_Equipment_Ticket(k);break;case"Res_Equipment_Unique_Equipment":NetServiceV3.getInstance().updateResponse_Res_Equipment_Unique_Equipment(k);break;case"Res_World_War_Battle_Continue_Info":NetServiceV3.getInstance().updateResponse_Res_World_War_Battle_Continue_Info(k);break;case"Res_World_War_Battle_Continue_Check":NetServiceV3.getInstance().updateResponse_Res_World_War_Battle_Continue_Check(k);break;case"Res_World_War_Move_Battle_Win":NetServiceV3.getInstance().updateResponse_Res_World_War_Move_Battle_Win(k);break;case"Res_World_War_Move_Battle_Lose":NetServiceV3.getInstance().updateResponse_Res_World_War_Move_Battle_Lose(k);break;case"Res_World_War_Move_Battle_Time_Out":NetServiceV3.getInstance().updateResponse_Res_World_War_Move_Battle_Time_Out(k);break;case"Res_World_War_Castle_Special_Add":NetServiceV3.getInstance().updateResponse_Res_World_War_Castle_Special_Add(k);break;case"Res_World_War_Main_Castle_Troops_Return":NetServiceV3.getInstance().updateResponse_Res_World_War_Main_Castle_Troops_Return(k);break;case"Res_World_War_User_Team_Turn_End":NetServiceV3.getInstance().updateResponse_Res_World_War_User_Team_Turn_End(k);break;case"Res_World_War_Cell_Box_Info":NetServiceV3.getInstance().updateResponse_Res_World_War_Cell_Box_Info(k);break;case"Res_World_War_Unification_First_Clear_Reward":NetServiceV3.getInstance().updateResponse_Res_World_War_Unification_First_Clear_Reward(k);break;case"Res_World_War_Buy_Box_Gacha":NetServiceV3.getInstance().updateResponse_Res_World_War_Buy_Box_Gacha(k);break;case"Res_World_War_Unification_First_Clear_Log":NetServiceV3.getInstance().updateResponse_Res_World_War_Unification_First_Clear_Log(k)}}),bu.delete_User_Mussang=function(){m_user_mussang_Info=[]},bu.insert_User_Mussang=function(a){for(var i=0;i<a.user_mussangs.length;i++)m_user_mussang_Info.push(a.user_mussangs[i])},bu.update_User_Mussang=function(a,b){for(var i=0;i<m_user_mussang_Info.length;i++)m_user_mussang_Info[i].mussang_type==b&&(m_user_mussang_Info[i].current_step=a)},bu.update_notice_list=function(a){for(var b=a.notices.length,i=0;i<b;i++)map_notice_list.insert(a.notices[i].num,a.notices[i])},bu.get_AllNotice=function(){return map_notice_list},bu.get_UserItemInfo_V2=function(){var a=$.extend({},db.UserItemInfo),user_item=bu.get_User_item_info(),user=NetService().get_User_info();a.jade_cnt=user_item.user_item.jade_count,a.heart_cnt=user_item.user_item.heart_count,a.gold_cnt=user_item.user_item.gold_count,a.lotus_cnt=user_item.user_item.lotus_count,a.yunhee_point=user_item.user_item.yunhee_point,a.formation_point=user_item.user_item.formation_point,a.heaven_pt_count=user_item.user_item.heaven_pt,a.key_cnt=user_item.user_item_key.key_cnt,a.raid_help_ticket_cnt=user_item.user_raid_help_ticket.ticket_cnt,a.skip_ticket_count=user_item.user_item_skip_ticket,a.raid_ticket_cnt=user_item.user_item_raid_ticket.ticket_cnt,a.ticket_cnt=user_item.user_item_ticket.ticket_cnt,a.great_wall_ticket_cnt=user_item.user_item_great_wall_ticket.ticket_cnt,a.world_war_ticket_cnt=user_item.user_item_world_war_ticket.ticket_cnt,a.exchange_ticket_count=user_item.user_item_exchange_ticket;var b=MasterManager.getInstance().get_UserLevel(user.user_level),plus_key_bount=bu.get_User_Plus_Key_Bound();return a.key_bound=b.key_bound+plus_key_bount,a.ticket_bound=b.ticket_bound,a.raid_ticket_bound=MasterManager.getInstance().get_CountFunction(6).value,a.raid_help_ticket_bound=MasterManager.getInstance().get_CountFunction(6).value,a.great_wall_ticket_bound=MasterManager.getInstance().get_CountFunction(25).value,a.world_war_ticket_bound=MasterManager.getInstance().get_WorldWarCountFunc(29).value,user_item=user=null,a},bu.get_User_item_info=function(){return User_item_info},bu.insert_UserItem=function(a){User_item_info={},null==a.user_item.skip_ticket&&(a.user_item.skip_ticket=0);var b={user_id:m_user_id,user_item:a.user_item,user_item_key:a.user_key,user_item_ticket:a.user_ticket,user_item_raid_ticket:a.user_raid_ticket,user_raid_help_ticket:a.user_raid_help_ticket,user_item_great_wall_ticket:a.user_great_wall_ticket,user_item_world_war_ticket:a.user_world_war_ticket,user_item_skip_ticket:a.user_item.skip_ticket,user_item_exchange_ticket:a.user_item.exchange_ticket,user_item_food:a.user_food,formation_point:a.user_item.formation_point};User_item_info=$.extend({},b),bu.update_User_Special_Gacha_Ticket(a.user_item.special_gacha_ticket),bu.udp_UserEvolveOrb(a.user_item.orb_count),bu.udp_UserPlusKeyBound(a.user_key.plus_key_bound);for(var i=0;i<a.user_formation_proterty_point.length;i++){var c=a.user_formation_proterty_point[i];m_User_formation_property_point.insert(c.property_type,c)}MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)},bu.update_UserFormationPropertyPoint=function(a){for(var i=0;i<a.length;i++){var b=new Object;b.point_count=a[i].point_count,b.property_type=a[i].property_type}},bu.setUserGeneralParnter=function(a){GameContext.getInstance().setUserGeneralParnter(a.user_partner)},bu.insert_User_Troops=function(a){for(var b=a.user_troops,idx=0;idx<b.length;idx++){var c=b[idx],data=$.extend({},c);map_user_troops.insert(data.troops_num,data)}bu.insert_User_Troops_General(a.user_troops_generals)},bu.delete_User_Troops_General=function(){list_User_Troops_General=null,list_User_Troops_General=new Map},bu.insert_User_Troops_General=function(a){for(var b=0;b<a.length;b++){var c=a[b];list_User_Troops_General.insert([c.troops_num,c.gnrl_id,c.gnrl_num],c)}},bu.delete_User_General=function(a){bu.insert_User_Generals(a)},bu.insert_User_Generals=function(a){for(var b=a.user_generals,m=MasterTable.getInstance(),buff_period_list=m.get_EventDungeonBuffPeriodList(),idx=0;idx<b.length;idx++){var c=b[idx],data=$.extend({},c),ugnrl=data;if(USE_CONVERT_GNRL_ID_TO_GROUP){var d=bu.convert_GnrlId_To_Group(c.gnrl_id);ugnrl.buff_type=m.get_GeneralDungeonBuffList(d,buff_period_list,ugnrl.buff_type)}else{var g=MasterManager.getInstance().get_General(c.gnrl_id);ugnrl.buff_type=m.get_GeneralDungeonBuffList(g.gnrl_group,buff_period_list,ugnrl.buff_type)}map_User_General.insert([data.gnrl_id,data.gnrl_num],ugnrl)}},bu.convert_GnrlId_To_Group=function(a){var b=cmString("%d",a);return 5==b.length?parseInt(b.substring(b.length-3,b.length)):6==b.length?parseInt(b.substring(b.length-4,b.length)):MasterManager.getInstance().get_General(res.gnrl_id)},bu.update_User_General_Limit_Step=function(a,b){for(var c=a-BONUS_TYPE_TEST_LIMIT_STEP_1_ALL_BOX+1,gnrl_level=MasterManager.getInstance().get_GeneralLimit(c).ext_level_id,idx=0;idx<b.length;idx++){var d=new net.User_General_Key;d.gnrl_id=b[idx].key_id,d.gnrl_num=b[idx].key_num;var e=MasterManager.getInstance().get_General(d.gnrl_id),general_level_mt=MasterManager.getInstance().get_GeneralLevelupExpV2(e.level_exp_group,gnrl_level);map_User_General.at([d.gnrl_id,d.gnrl_num]).gnrl_level=gnrl_level,map_User_General.at([d.gnrl_id,d.gnrl_num]).gnrl_exp=general_level_mt.accm_exp,map_User_General.at([d.gnrl_id,d.gnrl_num]).limit_step_id=c}},bu.insert_User_General=function(a){$.extend({},a);for(var b=0;b<a.length;b++){var c=a[b],lock_yn="n",general=MasterManager.getInstance().get_General(c.key_id);general.rare_type==RARE_TYPE_SSR&&(lock_yn="y"),general.limit_step_id=0,general.gnrl_num=c.key_num,general.gnrl_exp=0,general.gnrl_level=1,general.castle_id=c.key_castle_id,general.love_level=0,general.love_exp=0,general.used_in_camp="n",general.lock_yn=lock_yn,c.gnrl_id=c.key_id,c.gnrl_num=c.key_num;var d=general,m=MasterTable.getInstance(),g=MasterManager.getInstance().get_General(c.gnrl_id),buff_period_list=m.get_EventDungeonBuffPeriodList();d.buff_type=m.get_GeneralDungeonBuffList(g.gnrl_group,buff_period_list,d.buff_type),map_User_General.insert([general.gnrl_id,general.gnrl_num],d)}},bu.update_User_General=function(a){var b=new net.User_General_Key;b.gnrl_id=a.gnrl_id,b.gnrl_num=a.gnrl_num,map_User_General.insert([b.gnrl_id,b.gnrl_num],a)},bu.insert_User_General_Love_Setting=function(a){var b=MasterManager.getInstance(),growth_reward_info=b.get_EventDungeonGrowthLevelUpRewardInfo(a.key_id),user_gnrl={};user_gnrl.gnrl_id=a.bonus_key.at(0).key_id,user_gnrl.gnrl_num=a.bonus_key.at(0).key_num;var g=b.get_General(user_gnrl.gnrl_id);user_gnrl.gnrl_exp=0,user_gnrl.gnrl_level=1,user_gnrl.love_level=growth_reward_info.love_level;var c=b.get_General(user_gnrl.gnrl_id),love_mt=b.get_LoveLevel(c.rare_type,user_gnrl.love_level);user_gnrl.love_exp=love_mt.accm_exp;var d="n";g.rare_type!=RARE_TYPE_SSR||g.gnrl_type!=GENERAL_TYPE_YUNHEE&&g.gnrl_type!=GENERAL_TYPE_LIMIT_OVER||(d="y"),user_gnrl.lock_yn=d,user_gnrl.limit_step_id=0,user_gnrl.using_in_camp="n",user_gnrl.used_in_camp="n",user_gnrl.display_class=g.gnrl_class,this.insert_User_General_V2(user_gnrl),user_gnrl.love_level<YUNHEE_MAX_LOVE_LEVEL?this.new_User_Books_General(m_user_id,user_gnrl.gnrl_id):this.new_User_Books_General_Max_Love_Level(m_user_id,user_gnrl.gnrl_id)},bu.new_User_Books_General=function(b,c){for(var d=MasterManager.getInstance().get_General(c),general_list=MasterManager.getInstance().get_AllGeneral().filter(function(a){return d.gnrl_group==a.gnrl_group}),g_idx=0;g_idx<general_list.length;g_idx++){var g=general_list[g_idx];if(null==list_User_book_General.find(function(a){if(a.gnrl_id==g.gnrl_id)return!0})&&d.gnrl_class>=g.gnrl_class){var e={};e.gnrl_id=g.gnrl_id,e.max_level_complete_yn="n",e.love_max_level_complete_yn="n",list_User_book_General.push(e)}}},bu.new_User_Books_General_Max_Love_Level=function(b,c){var d=MasterManager.getInstance().get_General(c),map_general=MasterManager.getInstance().get_AllGeneral(),general_list=[];for(var g in map_general)map_general[g].gnrl_group==d.gnrl_group&&general_list.push($.extend({},map_general[g]));for(var e=0;e<general_list.length;e++){g=general_list[e];var f=list_User_book_General.find(function(a){if(a.gnrl_id==g.gnrl_id)return!0});if(null==f&&d.gnrl_class>=g.gnrl_class){var h="y",books_gnrl={};books_gnrl.gnrl_id=g.gnrl_id,books_gnrl.max_level_complete_yn="n",books_gnrl.love_max_level_complete_yn=h,list_User_book_General.push(books_gnrl)}else{h="y";f.love_max_level_complete_yn=h}}},bu.insert_User_General_V2=function(a){var b=$.extend({},a),ugnrl=b,m=MasterTable.getInstance(),g=MasterManager.getInstance().get_General(ugnrl.gnrl_id),buff_period_list=m.get_EventDungeonBuffPeriodList();ugnrl.buff_type=m.get_GeneralDungeonBuffList(g.gnrl_group,buff_period_list,ugnrl.buff_type),map_User_General.insert([b.gnrl_id,b.gnrl_num],ugnrl)},bu.insert_User_Battle_Formation=function(a){var b=a.user_battle_formation;m_User_Battle_formation=new Map;for(var c=0;c<b.length;c++){var d=b[c],data=new Object;data.formation_id=d.formation_id,data.position_type=d.position_type,data.combo_stat=d.combo_stat,m_User_Battle_formation.insert(data.formation_id,data)}},bu.insert_User_weekly_open_time=function(a){for(var b=0;b<a.length;b++){var c=a[b],data=$.extend({},c),key=data.weekly_idx+""+data.week_type;map_user_weekly_open.insert(key,data)}},bu.insert_User_main_mission=function(a){map_user_main_mission.clear();for(var b=a.length,idx=0;idx<b;idx++)map_user_main_mission.push($.extend({},a[idx]))},bu.insert_User_main_mission_task=function(a){map_user_main_mission_task.clear();for(var b=a.length,idx=0;idx<b;idx++)map_user_main_mission_task.push($.extend({},a[idx]))},bu.insert_User_Main_Story_Lotus_Bonus_Log=function(a){m_User_main_lotus_bonus_log.clear();for(var b=a.length,idx=0;idx<b;idx++){var c=null;(c=$.extend({},a[idx])).main_scene_id=a[idx].main_scene_id,c.main_story_id=a[idx].main_story_id,c.difficulty_type=a[idx].difficulty_type,c.complete_yn=a[idx].complete_yn,c.new_yn=a[idx].new_yn,m_User_main_lotus_bonus_log.insert([c.main_scene_id,c.main_story_id,c.difficulty_type,c.lotus_count],c)}},bu.insert_User_Mail_V2=function(a){0==list_User_Mail.length&&(list_User_Mail=$.extend([],a.items)),0==list_User_Mail.size()?GameContext.getInstance().setUserNewMail("n"):GameContext.getInstance().setUserNewMail("y")},bu.insert_User_Mail=function(a){for(var b=a.items.length,idx=0;idx<b;idx++){var c=a.items[idx];-1!=list_User_Mail.findIndex(function(m){return c.mail_num==m.mail_num})||list_User_Mail.push_back(c)}0==list_User_Mail.size()?GameContext.getInstance().setUserNewMail("n"):GameContext.getInstance().setUserNewMail("y")},bu.delete_User_Mail=function(){list_User_Mail.clear()},bu.delete_User_Book_General=function(){list_User_book_General.clear()},bu.init_User_Book_General=function(a){list_User_book_General=[];for(var b=0;b<a.length;b++){var c=$.extend({},a[b]);list_User_book_General.push(c)}},bu.update_User_Illust_Book=function(a){map_User_Illust_Book_List=[],map_User_Illust_Book_List=a},bu.insert_User_Book_General=function(b){for(var c=0;c<b.length;c++){var d={gnrl_id:b[c].key_id,gnrl_num:b[c].key_num},general=MasterManager.getInstance().get_General(d.gnrl_id),gnrl_ids=[],map_general=MasterManager.getInstance().get_AllGeneral();for(var g in map_general)map_general[g].gnrl_group==general.gnrl_group&&gnrl_ids.push({gnrl_id:map_general[g].gnrl_id,gnrl_num:map_general[g].gnrl_num,gnrl_class:map_general[g].gnrl_class});for(var i=0;i<gnrl_ids.length;i++){if(null==(f=list_User_book_General.find(function(a){if(a.gnrl_id==gnrl_ids[i].gnrl_id)return!0}))&&general.gnrl_class>=gnrl_ids[i].gnrl_class){for(var e="n",jdx=0;jdx<gnrl_ids.length;jdx++){var f;if(null!=(f=list_User_book_General.find(function(a){if(a.gnrl_id==gnrl_ids[jdx].gnrl_id)return!0}))&&"y"==f.love_max_level_complete_yn){e="y";break}}gnrl_ids[i].love_max_level_complete_yn=e,list_User_book_General.push(gnrl_ids[i])}}}},bu.delete_User_Achievement=function(){},bu.init_User_Achievement=function(a){map_achievement_list.clear(),bu.insert_User_Achievement(a)},bu.insert_User_Achievement=function(a){for(var b=0;b<a.length;b++){var c=a[b].achv_id;map_achievement_list.insert(c,a[b])}},bu.getUserAchievementList=function(){return map_achievement_list},bu.insert_User_Tutorial_V2=function(a){for(var b=a.length,idx=0;idx<b;idx++){var c=null;(c=$.extend({},a[idx])).user_id=m_user_id,c.tutorial_id=a[idx].tutorial_id,TutorialService.getInstance().add_User_tutorial_V2(c.tutorial_id,c)}},bu.insert_User_Camp_Cost=function(a){map_User_Camp_cost.clear();for(var i=0;i<a.cost_list.length;i++)bu.insert_User_Camp_Cost_ADD(a.cost_list[i].troops_num,a.cost_list[i].added_cost)},bu.insert_User_Camp_Cost_ADD=function(a,b){var c=new Object;c.troops_num=a,c.added_cost=b,map_User_Camp_cost.insert(c.troops_num,c)},bu.delete_User_Camp_Cost_General=function(){var a=arguments;switch(a.length){case 0:map_User_Cost_general.clear();break;case 1:for(var b=a[0],keys=map_User_Cost_general.keys(),idx=0;idx<keys.length;idx++)map_User_Cost_general.at(keys[idx]).troops_num==b&&map_User_Cost_general.remove(keys[idx])}},bu.insert_User_Camp_Cost_General=function(a){for(var b=0;b<a.cost_yunhees.length;b++)for(var c=a.cost_yunhees[b],jdx=0;jdx<c.gnrl_keys.length;jdx++){var d=c.gnrl_keys[jdx];bu.insert_User_Camp_Cost_General_ADD(d,c.troops_num,jdx)}},bu.insert_User_Camp_Cost_General_ADD=function(a,b,c){var d=new Object;d.user_id=m_user_id,d.troops_num=b,d.num=c,d.gnrl_id=a.gnrl_id,d.gnrl_num=a.gnrl_num,map_User_Cost_general.insert([d.troops_num,d.num],d)},bu.delete_User_Camp_Cost_Slot=function(){var a=arguments;switch(a.length){case 0:list_User_camp_cost_slot.clear();break;case 1:var b=a[0];list_User_camp_cost_slot.remove(b);for(var c=list_User_camp_cost_slot.keys(),i=0;i<c.length;i++)bu.insert_User_Camp_Cost_Slot_ADD(list_User_camp_cost_slot.at(c[i]))}},bu.insert_User_Camp_Cost_Slot=function(a){for(var i=0;i<a.cost_slot.length;i++)bu.insert_User_Camp_Cost_Slot_ADD(a.cost_slot[i])},bu.insert_User_Camp_Cost_Slot_ADD=function(a){var b=new Object;b.troops_num=a.troops_num,b.slots_0=a.slots[0],b.slots_1=a.slots[1],b.slots_2=a.slots[2],b.slots_3=a.slots[3],b.slots_4=a.slots[4],b.slots_5=a.slots[5],b.slots_6=a.slots[6],b.slots_7=a.slots[7],list_User_camp_cost_slot.insert(b.troops_num,b)},bu.delete_User_Event_Dungeon=function(){map_user_event_dungeon.clear()},bu.insert_User_Event_Dungeon=function(a){for(var i=0;i<a.length;i++){var b=new Object;b.user_id=m_user_id,b.event_dungeon_idx=a[i].event_dungeon_id,b.challenge_count=a[i].challenge_count,b.win_count=a[i].win_count,b.complete_yn=a[i].complete_yn,map_user_event_dungeon.insert([b.user_id,b.event_dungeon_idx],b)}for(i=0;i<a.length;i++)for(var d=a[i],j=0;j<d.task_list.length;j++){var t=d.task_list[j];bu.update_User_Event_Dungeon_Task(t)}},bu.delete_User_Event_Dungeon_Point=function(){map_user_event_dungeon_point.clear()},bu.insert_User_Event_Dungeon_Point=function(a){for(var i=0;i<a.length;i++){var b=new Object;b.event_dungeon_period_idx=a[i].event_dungeon_period_idx,b.event_point=a[i].event_point,b.accum_event_point=a[i].accum_event_point,map_user_event_dungeon_point.insert([m_user_id,b.event_dungeon_period_idx],b)}},bu.plus_User_Event_Point=function(a,b){var c=map_user_event_dungeon_point.at([m_user_id,a]);if(null!=c)c.event_point+=b,c.accum_event_point+=b;else{var d=new Object;d.event_dungeon_period_idx=a,d.event_point=b,d.accum_event_point=b,map_user_event_dungeon_point.insert([m_user_id,d.event_dungeon_period_idx],d)}},bu.update_User_Event_Dungeon_Point=function(a){var m=MasterManager.getInstance();if(0!=a.length)for(var b=0;b<a.length;b++){var c,sp=a[b],period=m.get_EventDungeonPeriod(sp.event_dungeon_period_idx),dungeon_point=map_user_event_dungeon_point.at([m_user_id,period.event_dungeon_period_idx]);if(null!=dungeon_point)dungeon_point.event_point=sp.event_point,dungeon_point.accum_event_point=sp.accum_event_point;else(c=new Object).event_dungeon_period_idx=sp.event_dungeon_period_idx,c.event_point=sp.event_point,c.accum_event_point=sp.accum_event_point,map_user_event_dungeon_point.insert([m_user_id,c.event_dungeon_period_idx],c)}else(c=new Object).event_dungeon_period_idx=0,c.event_point=0,c.accum_event_point=0,c.event_dungeon_point_period_idx=0,map_user_event_dungeon_point.insert([m_user_id,c.event_dungeon_period_idx],c)},bu.delete_User_Event_Dungeon_Reward=function(){map_user_event_dungeon_reward.clear()},bu.insert_User_Event_Dungeon_Reward=function(a){for(var i=0;i<a.length;i++){var b=new Object;b.user_id=m_user_id,b.event_dungeon_period_idx=a[i].event_dungeon_period_idx,b.event_dungeon_reward_idx=a[i].event_dungeon_reward_idx,b.rewarded_yn=a[i].rewarded_yn,map_user_event_dungeon_reward.insert([b.user_id,b.event_dungeon_period_idx,b.event_dungeon_reward_idx],b)}},bu.delete_User_Event_Dungeon_Reward_Shop=function(){map_user_event_dungeon_reward_shop.clear()},bu.insert_User_Event_Dungeon_Reward_Shop=function(a){for(var i=0;i<a.length;i++){var b=new Object;b.user_id=m_user_id,b.event_dungeon_period_idx=a[i].event_dungeon_period_idx,b.event_dungeon_reward_shop_idx=a[i].event_dungeon_reward_shop_idx,b.buy_count=a[i].buy_count,map_user_event_dungeon_reward_shop.insert([b.user_id,b.event_dungeon_period_idx,b.event_dungeon_reward_shop_idx],b)}},bu.delete_User_Event_Dungeon_Reward_Board_Info=function(){map_user_event_dungeon_reward_board_info.clear()},bu.insert_User_Event_Dungeon_Reward_Board_Info=function(a){for(var i=0;i<a.length;i++){var b=new Object;b.user_id=m_user_id,b.event_dungeon_period_idx=a[i].event_dungeon_period_idx,b.event_dungeon_reward_board_info_idx=a[i].event_dungeon_reward_board_info_idx,b.open_yn=a[i].open_yn,b.complete_yn=a[i].complete_yn,map_user_event_dungeon_reward_board_info.insert([b.event_dungeon_period_idx,b.event_dungeon_reward_board_info_idx],b)}},bu.delete_User_Event_Dungeon_Reward_Board_Map=function(){map_user_event_dungeon_board_map_bonus.clear()},bu.insert_User_Event_Dungeon_Reward_Board_Map=function(a){for(var i=0;i<a.length;i++){var b=new Object;b.user_id=m_user_id,b.event_dungeon_period_idx=a[i].event_dungeon_period_idx,b.event_dungeon_reward_board_info_idx=a[i].event_dungeon_reward_board_info_idx,b.event_dungeon_reward_board_map_idx=a[i].event_dungeon_reward_board_map_idx,b.rewarded_yn=a[i].rewarded_yn,map_user_event_dungeon_board_map_bonus.insert([b.user_id,b.event_dungeon_period_idx,b.event_dungeon_reward_board_info_idx,b.event_dungeon_reward_board_map_idx],b)}},bu.delete_User_Love_Item=function(){map_User_Love_Item.clear()},bu.insert_User_Love_Item=function(a){for(var b=a.length,i=0;i<b;i++)bu.insert_User_Love_Item_Add(a[i])},bu.insert_User_Love_Item_Add=function(a){var b={};b.love_id=a.love_id,b.count=a.count,b.gnrl_id=a.gnrl_id,map_User_Love_Item.insert(b.love_id+""+b.gnrl_id,b)},bu.delete_UserHwandan=function(){map_User_Hwandan_Info.clear()},bu.insert_UserHwandan=function(a){for(var b=a.length,i=0;i<b;i++)bu.insert_UserHwandan_Add(a[i])},bu.insert_UserHwandan_Add=function(a){var b=null;(b=$.extend({},net.User_Hwandan)).hwandan_class=a.hwandan_class,b.hwandan_count=a.hwandan_count,map_User_Hwandan_Info.insert(b.hwandan_class,b)},bu.delete_UserEvolveArmServiceMtrl=function(){map_User_Evolve_Arm_Service_Mtrl.clear()},bu.insert_UserEvolveArmServiceMtrl=function(a){for(var i=0;i<a.length;i++)bu.insert_UserEvolveArmServiceMtrl_Add(a[i])},bu.insert_UserEvolveArmServiceMtrl_Add=function(a){var b=null;(b=$.extend({},net.User_Evolve_Arm_Service_Key)).arm_service_type=a.arm_service_type,b.class_type=a.class_type;var c=null;(c=$.extend({},net.User_Hwandan)).class_type=a.class_type,c.mtrl_count=a.mtrl_count,map_User_Evolve_Arm_Service_Mtrl.insert([b.arm_service_type,b.class_type],a)},bu.insert_User_Camp_Branch_Ability_General=function(a){for(var b=a.length,idx=0;idx<b;idx++){var c=null;if(c=$.extend({},a[idx]),"y"==a[idx].complete_yn)for(var d in a[idx].gnrl_keys){var e=a[idx].gnrl_keys[d];if(0<e.gnrl_id)null!=map_User_General.at([e.gnrl_id,e.gnrl_num])&&map_User_General.remove([e.gnrl_id,e.gnrl_num])}c.complete_dt=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME))+1e3*c.remain_second,CampService.getInstance().insert_camp_branch_ability_log(c)}},bu.delete_User_Event_Dungeon_Cutin_Accum_Rate_Point=function(){map_user_event_dungeon_cutin_accum_rate.clear()},bu.delete_User_Event_Dungeon_Global_Point_Info=function(){map_user_event_dungeon_global_reward_log.clear()},bu.insert_User_Event_Dungeon_Global_Point_Info=function(a){for(var i=0;i<a.length;i++){var b=new Object;b.user_id=m_user_id,b.event_dungeon_global_point_idx=a[i].event_dungeon_global_point_idx,b.event_dungeon_period_idx=a[i].event_dungeon_period_idx,b.rewarded_yn=a[i].rewarded_yn,map_user_event_dungeon_global_reward_log.insert([b.user_id,b.event_dungeon_global_point_idx,b.event_dungeon_period_idx],b)}},bu.update_User_Event_Dungeon_Global_Point_Info=function(a){map_user_event_dungeon_global_reward_log.insert([m_user_id,a.event_dungeon_global_point_idx,a.event_dungeon_period_idx],a)},bu.delete_User_Event_Dungeon_Special_Point=function(){map_user_event_dungeon_special_point.clear()},bu.insert_User_Event_Dungeon_Special_Point=function(a){for(var i=0;i<a.length;i++){var b=new Object;b.user_id=m_user_id,b.event_dungeon_period_idx=a[i].event_dungeon_point_period_idx,b.point=a[i].point,b.accum_point=a[i].accum_point,map_user_event_dungeon_special_point.insert([b.user_id,b.event_dungeon_period_idx],b)}},bu.update_User_Event_Dungeon_Special_Point=function(a){for(var m=MasterManager.getInstance(),idx=0;idx<a.length;idx++){var b=a[idx],period=m.get_EventDungeonPeriod(b.event_dungeon_period_idx),special_point=map_user_event_dungeon_special_point.at([m_user_id,period.event_dungeon_point_period_idx]);if(null!=special_point)special_point.point=b.point,special_point.accum_point=b.accum_point;else{var c=new Object;c.user_id=m_user_id,c.event_dungeon_period_idx=period.event_dungeon_point_period_idx,c.point=b.point,c.accum_point=b.accum_point,map_user_event_dungeon_special_point.insert([c.user_id,c.event_dungeon_period_idx],c)}}},bu.delete_User_Event_Dungeon_Marble_Circuit_Info=function(){map_user_event_dungeon_marble_circuit_log.clear()},bu.insert_User_Event_Dungeon_Marble_Circuit_Info=function(a){for(var i=0;i<a.length;i++){var b=new Object;b.user_id=m_user_id,b.event_dungeon_period_idx=a[i].event_dungeon_period_idx,b.event_dungeon_marble_circuit_info_idx=a[i].event_dungeon_marble_circuit_info_idx,b.rewarded_yn=a[i].rewarded_yn,map_user_event_dungeon_marble_circuit_log.insert([b.user_id,b.event_dungeon_period_idx,b.event_dungeon_marble_circuit_info_idx],b)}},bu.delete_User_Event_Dungeon_Marble_Fortune=function(){map_user_event_dungeon_marble_fortune.clear()},bu.delete_User_Event_Dungeon_Marble_Golden_Box_Info=function(){map_user_event_dungeon_marble_golden_box_gain_log.clear()},bu.insert_User_Event_Dungeon_Marble_Fortune=function(a){if(null!=a)for(var i=0;i<a.length;i++){var b=new Object;b.user_id=m_user_id,b.event_dungeon_period_idx=a[i].event_dungeon_period_idx,b.fortune_type=a[i].fortune_type,map_user_event_dungeon_marble_fortune.insert([b.user_id,b.event_dungeon_period_idx],b)}},bu.insert_User_Event_Dungeon_Marble_Golden_Box_Info=function(a){if(null!=a)for(var i=0;i<a.length;i++){var b=new Object;b.user_id=m_user_id,b.event_dungeon_period_idx=a[i].event_dungeon_period_idx,b.golden_box_idx=a[i].golden_box_idx,b.gain_count=a[i].gain_count,map_user_event_dungeon_marble_golden_box_gain_log.insert([b.user_id,b.event_dungeon_period_idx,b.golden_box_idx],b)}},bu.update_User_Event_Dungeon_Marble_Fortune=function(a){for(var m=MasterManager.getInstance(),idx=0;idx<a.length;idx++){var b=a[idx],period=m.get_EventDungeonPeriod(b.event_dungeon_period_idx),marble_fortune=map_user_event_dungeon_marble_fortune.at([m_user_id,period.event_dungeon_point_period_idx]);if(null!=marble_fortune)marble_fortune.fortune_type=b.fortune_type;else{var c=new Object;c.user_id=m_user_id,c.event_dungeon_period_idx=period.event_dungeon_point_period_idx,c.fortune_type=b.fortune_type,map_user_event_dungeon_marble_fortune.insert([c.user_id,c.event_dungeon_period_idx],c)}}},bu.update_User_Event_Dungeon_Marble_Golden_Box_Info=function(a){for(var m=MasterManager.getInstance(),idx=0;idx<a.length;idx++){var b=a[idx],period=m.get_EventDungeonPeriod(b.event_dungeon_period_idx),golden_box_info=map_user_event_dungeon_marble_golden_box_gain_log.at([m_user_id,period.event_dungeon_point_period_idx,b.golden_box_idx]);if(null!=golden_box_info)golden_box_info.gain_count=b.gain_count;else{var c=new Object;c.user_id=m_user_id,c.event_dungeon_period_idx=period.event_dungeon_point_period_idx,c.golden_box_idx=b.golden_box_idx,c.gain_count=b.gain_count,map_user_event_dungeon_marble_golden_box_gain_log.insert([c.user_id,c.event_dungeon_period_idx,b.golden_box_idx],c)}}},bu.update_User_Event_Dungeon_Marble_Circuit_Info=function(a){for(var m=MasterManager.getInstance(),idx=0;idx<a.length;idx++){var b=a[idx],period=m.get_EventDungeonPeriod(b.event_dungeon_period_idx),circuit_log=map_user_event_dungeon_marble_circuit_log.at([m_user_id,period.event_dungeon_period_idx,b.event_dungeon_marble_circuit_info_idx]);if(null!=circuit_log)circuit_log.rewarded_yn=b.rewarded_yn;else{var c=new Object;c.user_id=m_user_id,c.event_dungeon_period_idx=period.event_dungeon_period_idx,c.event_dungeon_marble_circuit_info_idx=b.event_dungeon_marble_circuit_info_idx,c.rewarded_yn=b.rewarded_yn,map_user_event_dungeon_marble_circuit_log.insert([c.user_id,c.event_dungeon_period_idx,c.event_dungeon_marble_circuit_info_idx],c)}}},bu.delete_User_Event_Dungeon_Marble_Map_Info=function(){map_user_event_dungeon_marble_map_info.clear()},bu.insert_User_Event_Dungeon_Marble_Map_Info=function(a){if(null!=a.length)for(var i=0;i<a.length;i++){var b=new Object;b.user_id=m_user_id,b.event_dungeon_period_idx=a[i].event_dungeon_period_idx,b.event_dungeon_marble_map_info_idx=a[i].event_dungeon_marble_map_info_idx,b.circuit_count=a[i].circuit_count,map_user_event_dungeon_marble_map_info.insert([b.user_id,b.event_dungeon_period_idx],b)}},bu.update_User_Event_Dungeon_Marble_Map_Info=function(a){for(var m=MasterManager.getInstance(),idx=0;idx<a.length;idx++){var b=a[idx],period=m.get_EventDungeonPeriod(b.event_dungeon_period_idx),map_info=map_user_event_dungeon_marble_map_info.at([m_user_id,period.event_dungeon_point_period_idx]);if(null!=map_info)map_info.event_dungeon_marble_map_info_idx=b.event_dungeon_marble_map_info_idx,map_info.circuit_count=b.circuit_count;else{var c=new Object;c.user_id=m_user_id,c.event_dungeon_period_idx=period.event_dungeon_period_idx,c.event_dungeon_marble_map_info_idx=b.event_dungeon_marble_map_info_idx,c.circuit_count=b.circuit_count,map_user_event_dungeon_marble_map_info.insert([c.user_id,c.event_dungeon_period_idx],c)}}},bu.insert_User_Event_Dungeon_Craft_Shop_Material=function(a){for(var i=0;i<a.length;i++){var b={};b.user_id=m_user_id,b.craft_shop_bonus_type=a[i].craft_shop_bonus_type,b.material_count=a[i].material_count,map_user_event_dungeon_craft_shop_material.insert([b.user_id,b.craft_shop_bonus_type],b)}},bu.delete_User_Event_Dungeon_Persnal_Accm_Point=function(){map_user_event_dungeon_persnal_point_bonus_log.clear()},bu.insert_User_Event_Dungeon_Persnal_Accm_Point_Info=function(a){for(var i=0;i<a.length;i++){var b=new Object;b.user_id=m_user_id,b.event_dungeon_period_idx=a[i].event_dungeon_period_idx,b.point_info_id=a[i].point_info_id,b.reward_yn=a[i].reward_yn,map_user_event_dungeon_persnal_point_bonus_log.insert([b.user_id,b.event_dungeon_period_idx,b.point_info_id],b)}},bu.delete_User_Event_Dungeon_Special_Point_Shop=function(){map_user_event_dungeon_special_point_shop_log.clear()},bu.insert_User_Event_Dungeon_Special_Point_Shop=function(a){for(var i=0;i<a.length;i++){var b=new Object;b.user_id=m_user_id,b.event_dungeon_period_idx=a[i].event_dungeon_period_idx,b.event_dungeon_special_point_shop_idx=a[i].event_dungeon_special_point_shop_idx,b.buy_count=a[i].buy_count,map_user_event_dungeon_special_point_shop_log.insert([b.user_id,b.event_dungeon_period_idx,b.event_dungeon_special_point_shop_idx],b)}},bu.update_User_Event_Dungeon_Cutin_Accum_Rate_Point=function(a,b){var c=!1,m_cutin=map_user_event_dungeon_cutin_accum_rate.at([m_user_id,a]);if(m_cutin&&(c=!0),0==c){var d=new Object;d.user_id=m_user_id,d.event_dungeon_period_idx=a,d.cutin_accum_rate_point=b,map_user_event_dungeon_cutin_accum_rate.insert([m_user_id,d.event_dungeon_period_idx],d)}else m_cutin.cutin_accum_rate_point=b},bu.delete_User_Yunhee_Bound=function(){},bu.insert_User_Yunhee_Bound=function(a){var b={};b.user_id=m_user_id,b.bound=a,m_user_yunhee_bound.insert(m_user_id,b)},bu.insert_User_Illust=function(a){var b={};b.illust_idx=a[0].key_num,map_User_Illust_Book_List.push_back(b)},bu.update_User_Camp=function(a){CampService.getInstance().clear_camp();for(var b=a.length,idx=0;idx<b;idx++){var c=null;(c=$.extend({},a[idx])).user_id=m_user_id,CampService.getInstance().insert_camp(c)}},bu.delete_User_Camp_Branch_Ability=function(a,b){null==a?map_user_camp_branch_ability.clear():map_user_camp_branch_ability.remove(b)},bu.insert_User_Camp_Branch_Ability=function(a){if(Array.isArray(a))for(var b=a.length,idx=0;idx<b;idx++){var c=null;(c=$.extend({},a[idx])).user_id=m_user_id,map_user_camp_branch_ability.insert(c.branch_type,c)}else{c=null;(c=$.extend({},a)).user_id=m_user_id,map_user_camp_branch_ability.insert(c.branch_type,c)}},bu.update_User_Gacha_Count=function(a){User_gacha_count={},User_gacha_count.gacha_buy_bonus=a.gacha_count,User_gacha_count.user_ceiling_gacha_info_list=a.user_ceiling_gacha_info_list},bu.update_User_Ceiling_Gacha_Counts=function(a){for(var b=0;b<a.length;b++)bu.update_User_Ceiling_Gacha_Count(a[b])},bu.update_User_Ceiling_Gacha_Count=function(a){var b=map_user_ceiling_gacha_info.at([m_user_id,a.ceiling_gacha_idx]);null==b&&((b={}).user_id=m_user_id,b.ceiling_gacha_idx=a.ceiling_gacha_idx,b.ceiling_gacha_count=a.ceiling_gacha_count);b.ceiling_gacha_count;b.ceiling_gacha_count=a.ceiling_gacha_count,map_user_ceiling_gacha_info.insert([m_user_id,a.ceiling_gacha_idx],b)},bu.update_User_Gacha_Ticket=function(a,b){var c=new Object;c.shop_id=a,c.ticket_count=b,_user_gacha_ticket.insert(c.shop_id,c)},bu.update_User_Special_Gacha_Ticket=function(a){if(null!=a.length)for(var i=0;i<a.length;i++){var b={};b.special_ticket_gacha_idx=a[i].special_ticket_gacha_idx,b.ticket_cnt=a[i].ticket_cnt,_user_special_gacha_ticket.insert(b.special_ticket_gacha_idx,b)}else _user_special_gacha_ticket.insert(a.special_ticket_gacha_idx,a)},bu.plus_User_Special_Gacha_Ticket=function(a,b){var c,data=_user_special_gacha_ticket.at([a]);null!=data?(data.special_ticket_gacha_idx=a,data.ticket_cnt=data.ticket_cnt+b,_user_special_gacha_ticket.insert(data.special_ticket_gacha_idx,data)):(null!=_user_special_gacha_ticket||(_user_special_gacha_ticket=new Map),(c={}).special_ticket_gacha_idx=a,c.ticket_cnt=b,_user_special_gacha_ticket.insert(c.special_ticket_gacha_idx,c))},bu.upd_UserItemTicket=function(a){User_item_info.user_item_ticket.ticket_cnt=a.ticket_cnt,User_item_info.user_item_ticket.elapsed=a.elapsed},bu.upd_UserExchangeTicket=function(a){User_item_info.user_item.user_item_exchange_ticket=a},bu.get_User_Special_Gacha_Ticket=function(a){for(var b={},keys=_user_special_gacha_ticket.keys(),found=!1,i=0;i<keys.length;i++)if(keys[i]==a){b=_user_special_gacha_ticket.at([keys[i]]),found=!0;break}return 0==found&&(b=null),b},bu.get_User_Exchange_Ticket=function(){return User_item_info.user_item.user_item_exchange_ticket},bu.get_User_Exchange_Ticket_Buy_Log=function(){return _exchange_ticket_buy_log},bu.get_User_Daily_Dungeon=function(){return User_daily_dungeon},bu.delete_User_Event_Dungeon_Once_A_Day=function(){map_user_event_dungeon_once_a_day.clear()},bu.delete_User_Event_Dungeon_Personal_Accm_Point=function(){map_user_event_dungeon_personal_point_bonus_log.clear()},bu.insert_User_Event_Dungeon_Personal_Accm_Point_Info=function(a){for(var b=0;b<a.length;b++){var e=a[b];map_user_event_dungeon_personal_point_bonus_log.insert([m_user_id,e.event_dungeon_group_idx,e.step],e)}},bu.update_User_Event_Dungeon_Once_A_Day=function(a){var b=map_user_event_dungeon_once_a_day.at([m_user_id,a.event_dungeon_period_idx,a.event_dungeon_once_a_day_idx]);if(null!=b)b.complete_yn=a.complete_yn,map_user_event_dungeon_once_a_day.insert([m_user_id,a.event_dungeon_period_idx,a.event_dungeon_once_a_day_idx],b);else{var c={};c.user_id=m_user_id,c.event_dungeon_period_idx=a.event_dungeon_period_idx,c.event_dungeon_once_a_day_idx=a.event_dungeon_once_a_day_idx,c.complete_yn=a.complete_yn,map_user_event_dungeon_once_a_day.insert([m_user_id,a.event_dungeon_period_idx,a.event_dungeon_once_a_day_idx],c)}},bu.update_User_Event_Dungeon_Task=function(a){var b;null==map_user_event_dungeon_task.at([m_user_id,a.event_dungeon_period_idx,a.event_dungeon_id,a.num])?((b={}).user_id=m_user_id,b.event_dungeon_period_idx=a.event_dungeon_period_idx,b.event_dungeon_id=a.event_dungeon_id,b.num=a.num,b.count=a.count,b.complete_yn=a.complete_yn,map_user_event_dungeon_task.insert([m_user_id,b.event_dungeon_period_idx,b.event_dungeon_id,b.num],b)):((b={}).user_id=m_user_id,b.event_dungeon_period_idx=a.event_dungeon_period_idx,b.event_dungeon_id=a.event_dungeon_id,b.num=a.num,b.count=a.count,b.complete_yn=a.complete_yn,map_user_event_dungeon_task.remove([m_user_id,b.event_dungeon_period_idx,b.event_dungeon_id,b.num]),map_user_event_dungeon_task.insert([m_user_id,b.event_dungeon_period_idx,b.event_dungeon_id,b.num],b))},bu.get_User_Event_Dungeon_Task=function(){return map_user_event_dungeon_task},bu.get_user_event_dungeon_once_a_day=function(){return map_user_event_dungeon_once_a_day},bu.get_user_step_up_gacha_buy_log=function(){return _step_up_gacha_buy_log},bu.insert_User_Daily_Dungeon=function(a){User_daily_dungeon=[];for(var b=0;b<a.length;b++)User_daily_dungeon.push(a[b])},bu.delete_User_Food_Infos=function(){map_User_Food_List.clear()},bu.delete_User_Food_Info=function(a){map_User_Food_List.erase([m_user_id,a.food_id,a.food_num])},bu.insert_User_Food_Info=function(a){map_User_Food_List.insert([m_user_id,a.food_id,a.food_num],a)},bu.getUserFoodList=function(a){for(var b=map_User_Food_List.keys(),i=0;i<b.length;i++){var c=this.map_User_Food_List.at(b[i]);a.push_back(c)}},bu.getUserFood=function(a){return map_User_Food_List.at([m_user_id,a.food_id,a.food_num])},bu.getUserFoodCount=function(){return map_User_Food_List.size()},bu.get_User_Event_Dungeon_Vote_League_Record=function(){return list_User_Event_Dungeon_Vote_League_Record},bu.delete_User_Event_Dungeon_Vote_League_Reward=function(){map_user_event_dungeon_vote_league_reward.clear()},bu.insert_User_Event_Dungeon_Vote_League_Rewards=function(b){b.forEach(function(a){bu.insert_User_Event_Dungeon_Vote_League_Reward(a)})},bu.insert_User_Event_Dungeon_Vote_League_Reward=function(a){map_user_event_dungeon_vote_league_reward.insert([m_user_id,a.event_dungeon_group_idx,a.league_reward_idx],a)},bu.update_User_Event_Dungeon_Vote_League_Reward=function(){},bu.delete_User_Event_Dungeon_Use_Point_Reward=function(){map_user_event_dungeon_vote_league_use_point_reward.clear()},bu.get_user_event_dungeon_vote_league_reward=function(){return map_user_event_dungeon_vote_league_reward},bu.insert_User_Event_Dungeon_Use_Point_Rewards=function(b){b.forEach(function(a){bu.insert_User_Event_Dungeon_Use_Point_Reward(a)})},bu.insert_User_Event_Dungeon_Use_Point_Reward=function(a){map_user_event_dungeon_vote_league_use_point_reward.insert([m_user_id,a.event_dungeon_period_idx,a.reward_idx],a)},bu.update_User_Event_Dungeon_Use_Point_Reward=function(a){var b={event_dungeon_period_idx:a.event_dungeon_period_idx,reward_idx:a.event_dungeon_reward_idx,reward_yn:a.rewarded_yn};map_user_event_dungeon_vote_league_use_point_reward.insert([m_user_id,b.event_dungeon_period_idx,b.reward_idx],b)},bu.get_user_event_dungeon_vote_league_use_point_reward=function(){return map_user_event_dungeon_vote_league_use_point_reward},bu.update_User_Christmas_Reward=function(a,b,c){var d=!1;if(1==bu.plus_User_Christmas_Reward(a,b,c)){for(var e=0;e<m_Res_Get_User_Event_Dungeon_Christmas_Info.user_event_dungeon_christmas_reward.length;e++){var f=m_Res_Get_User_Event_Dungeon_Christmas_Info.user_event_dungeon_christmas_reward[e];if(c==f.event_dungeon_group_idx&&a==f.bonus_type){d=!0,f.bonus_count+=b,f.accum_count+=b;break}}if(0==d){var g={};g.event_dungeon_group_idx=c,g.bonus_type=a,g.bonus_count=b,g.accum_count=b,m_Res_Get_User_Event_Dungeon_Christmas_Info.user_event_dungeon_christmas_reward.push_back(g)}m_Res_Get_User_Event_Dungeon_Christmas_Info.event_dungeon_group_idx==c&&(m_Res_Get_User_Event_Dungeon_Christmas_Info.bonus_count+=b,m_Res_Get_User_Event_Dungeon_Christmas_Info.accum_count+=b),bu.plus_User_Christmas_Personal_Point_Reward(b,c)}},bu.delete_User_Christmas_Reward=function(a){map_user_event_dungeon_christmas_reward.remove([m_user_id,a]),map_user_event_dungeon_christmas_total_reward_info.remove([m_user_id,a])},bu.plus_User_Christmas_Reward=function(a,b,c){var d=map_user_event_dungeon_christmas_reward.at([m_user_id,c,a]);if(null!=d&&null==d.accum_count&&(d.accum_count=-1),null!=d&&-1<d.accum_count){var e=MasterManager.getInstance().get_CountFunction(COUNT_FUNCTION_CHRISTMAS_TREE_BONUS_MAX);if(d.accum_count>=e.value)return!1;d.accum_count+b>e.value&&(b=e.value-d.accum_count),d.bonus_count=d.bonus_count+b,d.accum_count=d.accum_count+b,map_user_event_dungeon_christmas_reward.insert([m_user_id,c,a],d)}else{var f={};f.user_id=m_user_id,f.event_dungeon_group_idx=c,f.bonus_type=a,f.bonus_count=b,f.accum_count=b,map_user_event_dungeon_christmas_reward.insert([m_user_id,c,f.bonus_type],f)}return!0},bu.plus_User_Christmas_Personal_Point_Reward=function(a,b){var c=map_user_event_dungeon_christmas_total_reward_info.at([m_user_id,b]);if(null!=c)c.bonus_count=c.bonus_count+a,c.accum_count=c.accum_count+a,map_user_event_dungeon_christmas_total_reward_info.insert([m_user_id,b],c);else{var d={};d.user_id=m_user_id,d.event_dungeon_group_idx=b,d.bonus_count=a,d.accum_count=a,map_user_event_dungeon_christmas_total_reward_info.insert([m_user_id,b],d)}},bu.update_Event_Once_A_Day_Dungeon_Battle_Win=function(a){var c=MasterManager.getInstance().get_EventDungeonPeriod(a.event_dungeon_period_idx);UserService.getInstance();bu.upd_User_Key(a.user_key),bu.upd_UserItemRaidTicket(a.user_raid_ticket),bu.upd_UserRaidHelpTicket(a.user_raid_help_ticket),bu.upd_UserJade(a.user_jade),bu.upd_UserGold(a.user_gold),bu.upd_UserHeart(a.user_heart),bu.upd_UserFormationPoint(a.user_formation_point),bu.upd_UserLevelExp(a.user_level,a.user_exp);var d={};d.event_dungeon_period_idx=a.event_dungeon_period_idx,d.event_dungeon_once_a_day_idx=a.event_dungeon_once_a_day_idx,d.complete_yn="y",bu.update_User_Event_Dungeon_Once_A_Day(d);for(var e=0;e<a.bonus_items.length;e++){var b=a.bonus_items[e];if(b.bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX){var f={};f.gnrl_id=b.bonus_idx,f.gnrl_num=b.bonus_num,f.gnrl_level=b.bonus_level,f.castle_id=b.castle_id,f.used_in_camp="n",f.using_in_camp="n",bu.insert_User_General_V2(f)}else if(b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7)bu.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)bu.plus_User_Love_Item(b.bonus_idx,b.bonus_num);else if(b.bonus_type==BONUS_TYPE_HEART);else if(b.bonus_type==BONUS_TYPE_JADE);else if(b.bonus_type==BONUS_TYPE_GOLD);else if(b.bonus_type==BONUS_TYPE_KEY);else if(b.bonus_type==BONUS_TYPE_RAID_TICKET);else if(b.bonus_type==BONUS_TYPE_EVENT_POINT)bu.plus_User_Event_Point(b.bonus_idx,b.bonus_num),cc.log(""+b.bonus_idx+b.bonus_num);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE||b.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE)bu.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_EVOLVE_ORB)bu.plus_User_Evolve_Orb(b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL)bu.plus_User_Magic_Key_Mtrl(b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&b.bonus_type<=BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND){var g=b.bonus_type-BONUS_TYPE_CRAFT_SHOP_FIRST_LOW+4;bu.plus_User_Craft_Shop_Material(g,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EQUIPMENT)bu.insert_User_Equipment(b.equipment);else if(b.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||b.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL){var h=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(b.bonus_type);bu.plus_User_Limit_Over_Mtrl(h,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EVENT_DUNGEON_SPECIAL_POINT);else if(b.bonus_type==BONUS_TYPE_USER_EXP);else if(b.bonus_type>=BONUS_TYPE_CHRISTMAS_RIBBON&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_APPLE){g=GeneralService.getInstance().getBonusTypeToCraftShopMtrlType(b.bonus_type);bu.plus_User_Craft_Shop_Material(g,b.bonus_idx)}else if(b.bonus_type>=BONUS_TYPE_CHRISTMAS_SANTA&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_SNOWMAN)bu.update_User_Christmas_Reward(b.bonus_type,b.bonus_num,c.event_dungeon_group_idx);else if(b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){var i=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(b.bonus_type);bu.plus_User_Rebirth_Mtrl(i,b.bonus_idx)}else b.bonus_type==BONUS_TYPE_SKIP_TICKET?bu.plus_User_Skip_Ticket(b.bonus_idx):b.bonus_type==BONUS_TYPE_EXCHANGE_TICKET?bu.plus_User_Exchange_Ticket(b.bonus_idx):b.bonus_type==BONUS_TYPE_SPECIAL_GACHA_TICKET&&bu.plus_User_Special_Gacha_Ticket(b.bonus_idx,b.bonus_level)}bu.upd_UserGeneralLevelExp(a.gnrl_exp)},bu.update_General_Rebirth=function(a){var b={};b.gnrl_id=a.del_gnrl_key.gnrl_id,b.gnrl_num=a.del_gnrl_key.gnrl_num;var c=this.getUserGeneral({},b);this.insert_User_General_V2(a.new_gnrl);var d=new db.UserGeneralInfo,new_gnrl_key={};new_gnrl_key.gnrl_id=a.new_gnrl.gnrl_id,new_gnrl_key.gnrl_num=a.new_gnrl.gnrl_num,(d=this.getUserGeneral({},new_gnrl_key)).gnrl_level=c.gnrl_level,d.gnrl_exp=c.gnrl_exp,d.love_level=c.love_level,d.love_exp=c.love_exp,d.limit_step_id=c.limit_step_id,d.lock_yn=c.lock_yn,d.using_in_camp=c.using_in_camp,d.used_in_camp=c.used_in_camp,d.display_class=c.display_class,this.update_User_General(d);var e=a.new_gnrl.gnrl_id,new_gnrl_num=a.new_gnrl.gnrl_num,partner=GameContext.getInstance().getUserGeneralPartner();if(partner.gnrl_id==a.del_gnrl_key.gnrl_id&&partner.gnrl_num==a.del_gnrl_key.gnrl_num){var f={};f.gnrl_id=e,f.gnrl_num=new_gnrl_num,GameContext.getInstance().setUserGeneralParnter(f)}var g=GameContext.getInstance().getUserFriendPartner();if(g.gnrl_id==a.del_gnrl_key.gnrl_id&&g.gnrl_num==a.del_gnrl_key.gnrl_num){var h={};h.gnrl_id=e,h.gnrl_num=new_gnrl_num,GameContext.getInstance().setUserFriendPartner(h)}this.updateEventDungeonSearchTroopsGeneralEvolution(a.del_gnrl_key,a.new_gnrl),"y"==a.new_yn&&this.insert_User_Book_General_Evolution(a.new_gnrl,"y"),bu.upd_UserGold(a.user_gold),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation),this.update_User_Gnrl_Equipment(a.del_gnrl_key,new_gnrl_key,a.equip_keys),this.remove_User_General(a.del_gnrl_key),bu.delete_User_Rebirth_Mtrl(),bu.insert_User_Rebirth_Mtrl(a.rebirth_mtrl_info)},bu.update_Mussgang_Tower_Battle_Win=function(a){bu.upd_UserJade(a.user_jade),bu.upd_UserGold(a.user_gold),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);for(var c=0;c<a.drop_bonus_items.length;c++){var b=a.drop_bonus_items[c];if(b.bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX){var d={};d.gnrl_id=b.bonus_idx,d.gnrl_num=b.bonus_num,d.gnrl_level=b.bonus_level,d.castle_id=b.castle_id,d.used_in_camp="n",d.using_in_camp="n",bu.insert_User_General(d)}else if(b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7)bu.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)bu.plus_User_Love_Item(b.bonus_idx,b.bonus_num);else if(b.bonus_type==BONUS_TYPE_HEART);else if(b.bonus_type==BONUS_TYPE_JADE);else if(b.bonus_type==BONUS_TYPE_GOLD);else if(b.bonus_type==BONUS_TYPE_KEY);else if(b.bonus_type==BONUS_TYPE_RAID_TICKET);else if(b.bonus_type==BONUS_TYPE_EVENT_POINT);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE||b.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE)bu.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_EVOLVE_ORB)bu.plus_User_Evolve_Orb(b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL)bu.plus_User_Magic_Key_Mtrl(b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&b.bonus_type<=BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND){var e=b.bonus_type-BONUS_TYPE_CRAFT_SHOP_FIRST_LOW+4;bu.plus_User_Craft_Shop_Material(e,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EQUIPMENT)bu.insert_User_Equipment(b.equipment);else if(b.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||b.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL){var f=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(b.bonus_type);bu.plus_User_Limit_Over_Mtrl(f,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EVENT_DUNGEON_SPECIAL_POINT);else if(b.bonus_type==BONUS_TYPE_USER_EXP);else if(b.bonus_type==BONUS_TYPE_HN_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_R_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_HR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_SR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_R_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_HR_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_SR_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_HIGH_ENGAGE_TEN||b.bonus_type==BONUS_TYPE_NORMAL_ENGAGE_TEN||b.bonus_type==BONUS_TYPE_HIGH_ENGAGE||b.bonus_type==BONUS_TYPE_NORMAL_ENGAGE||b.bonus_type==BONUS_TYPE_HIGH_ENGAGE_TEN_ARMY||b.bonus_type==BONUS_TYPE_NORMAL_ENGAGE_TEN_ARMY||b.bonus_type==BONUS_TYPE_HIGH_ENGAGE_ARMY||b.bonus_type==BONUS_TYPE_NORMAL_ENGAGE_ARMY||b.bonus_type==BONUS_TYPE_RETURN_USER_GIFT_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_LOGIN_GIFT_BOX||b.bonus_type==BONUS_TYPE_JADE_RANDOM_BOX||b.bonus_type==BONUS_TYPE_GOLD_RANDOM_BOX||b.bonus_type==BONUS_TYPE_LOVE_ITEM_RANDOM_BOX||b.bonus_type==BONUS_TYPE_RARE_HWANDAN_RANDOM_BOX||b.bonus_type==BONUS_TYPE_EXP_CARD_RANDOM_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_GIFT_BOX||b.bonus_type==BONUS_TYPE_LUCKY_BOX||b.bonus_type==BONUS_TYPE_SWORD_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_SPEAR_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_ARCHER_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_RANDOM_BOX||b.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_GIFT_BOX||b.bonus_type==BONUS_TYPE_TREASURE_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_BOX_v2||b.bonus_type==BONUS_TYPE_CHRISTMAS_BOX_V3||b.bonus_type==BONUS_TYPE_EVENTDUNGEON_PRESENT_GIFT_BOX||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_1||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_2||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_3||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_4||b.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_GACHA_REBORN_GNRL_TICKET||b.bonus_type==BONUS_TYPE_ALL_RARE_TYPE_GNRL_SELECT_TICKET||b.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET||b.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET_V2||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_2||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_3||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_4||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_5||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_6||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_7||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_8||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_9||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_10);else if(b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){var g=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(b.bonus_type);bu.plus_User_Rebirth_Mtrl(g,b.bonus_idx)}else b.bonus_type==BONUS_TYPE_FORMATION_POINT?bu.plus_User_Formation_Point(b.bonus_idx):b.bonus_type>=BONUS_TYPE_ATTK_POINT&&b.bonus_type<=BONUS_TYPE_CRI_DMG_POINT?bu.plus_User_Formation_Property_Point(b.bonus_type,b.bonus_idx):b.bonus_type==BONUS_TYPE_WORLD_WAR_UNIQUE_EQUIPMENT_TICKET&&NetServiceV3.getInstance().plus_Unique_Equipment_Ticket(b.bonus_idx)}var h={};h.period_idx=a.mussang_tower_period_idx,h.mussang_tower_id=a.mussang_tower_idx,h.win_count=a.win_count,h.new_yn="n",h.complete_yn=a.complete_yn,this.update_User_Mussang_Tower(h);var i=[];for(c=0;c<a.cmplt_task_ids.length;c++){if(0!=a.cmplt_task_ids[c]){var j={};j.period_idx=a.mussang_tower_period_idx,j.mussang_tower_id=a.mussang_tower_idx,j.task_id=a.cmplt_task_ids[c],i.push_back(j)}}if(this.update_User_Mussang_Tower_Task(i),"y"==a.lotus_bonus_new_yn){var k=m_user_mussang_tower_lotus_log.at([m_user_id,a.mussang_tower_period_idx,a.lotus_open_count]);if(null==k){var l={};l.user_id=m_user_id,l.period_idx=a.mussang_tower_period_idx,l.lotus_count=a.lotus_open_count,l.new_yn=a.lotus_bonus_new_yn,l.complete_yn="n",m_user_mussang_tower_lotus_log.insert([m_user_id,a.mussang_tower_period_idx,a.lotus_open_count],l)}else k.new_yn=a.lotus_bonus_new_yn,k.user_id=m_user_id,k.period_idx=a.mussang_tower_period_idx,k.lotus_count=a.lotus_open_count,m_user_mussang_tower_lotus_log.insert([m_user_id,a.mussang_tower_period_idx,a.lotus_open_count],k)}},bu.update_Mussgang_Tower_Battle_Lose=function(a){},bu.get_Map_User_Main_Mission_Task=function(){return map_user_main_mission_task},bu.get_Map_User_Main_Mission=function(){return map_user_main_mission},bu.get_User_Event_Dungeon_Satisfaction_Info=function(){return m_Res_Get_User_Event_Dungeon_Satisfaction_Info},bu.get_User_Event_Dungeon_Search_Troops=function(){return map_User_Event_Dungeon_Search_Troops},bu.get_User_Event_Dungeon_Search_Troops_Generals=function(a){if(null==a)return map_User_Event_Dungeon_Search_Troops_Generals;if("string"!=typeof a)return null==(c=map_User_Event_Dungeon_Search_Troops_Generals.at(a))&&(c=[]),c;for(var b=[],keys=map_User_Event_Dungeon_Search_Troops_Generals.keys(),idx=0;idx<keys.length;idx++)for(var c=map_User_Event_Dungeon_Search_Troops_Generals.at(keys[idx]),jdx=0;jdx<c.length;jdx++)b.push(c[jdx]);return b},bu.get_User_Event_Dungeon_Search_Area_Info=function(a){if(null==a)return map_Event_Dungeon_Search_Area_Info;for(var b={event_dungeon_period_idx:0,troops_num:0,search_area_idx:0,add_great_success:0,total_attk_pwr:0},area_keys=map_Event_Dungeon_Search_Area_Info.keys(),i=0;i<area_keys.length;i++)if(area_keys[i]==a){b=map_Event_Dungeon_Search_Area_Info.at(area_keys[i]);break}return b},bu.update_User_Mussang_Tower=function(a){var b=m_user_mussang_tower.at([m_user_id,a.period_idx,a.mussang_tower_id]);null==b?m_user_mussang_tower.insert([m_user_id,a.period_idx,a.mussang_tower_id],a):(b.win_count=a.win_count,b.new_yn=a.new_yn,b.complete_yn=a.complete_yn)},bu.update_User_Mussang_Tower_Task=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(null==m_user_mussang_tower_task.at([m_user_id,c.period_idx,c.mussang_tower_id,c.task_id])){var d={};d.user_id=m_user_id,d.period_idx=c.period_idx,d.mussang_tower_id=c.mussang_tower_id,d.task_id=c.task_id,m_user_mussang_tower_task.insert([m_user_id,d.period_idx,d.mussang_tower_id,d.task_id],d)}}},bu.update_User_Event_Dungeon_Reward_Shop=function(a){var b=map_user_event_dungeon_reward_shop.at([m_user_id,a.event_dungeon_period_idx,a.event_dungeon_reward_shop_idx]);null!=b?b.buy_count=a.buy_count:map_user_event_dungeon_reward_shop.insert([m_user_id,a.event_dungeon_period_idx,a.event_dungeon_reward_shop_idx],a)},bu.delete_User_Rebirth_Mtrl=function(){map_User_Rebirth_Mtrl.clear()},bu.insert_User_Rebirth_Mtrl=function(a){for(var b=0;b<a.length;b++){var c=a[b];map_User_Rebirth_Mtrl.insert(c.rebirth_mtrl_type,c)}},bu.update_User_Rebirth_Mtrl=function(a){map_User_Rebirth_Mtrl.insert(a.rebirth_mtrl_type,a)},bu.plus_User_Rebirth_Mtrl=function(a,b){if(null!=map_User_Rebirth_Mtrl.at(a))map_User_Rebirth_Mtrl.at(a).mtrl_count+=b;else{var c={};c.rebirth_mtrl_type=a,c.mtrl_count=b,map_User_Rebirth_Mtrl.insert(a,c)}},bu.delete_User_Naming_Info=function(){m_user_naming.clear()},bu.get_user_naming=function(){return m_user_naming},bu.insert_User_Naming_Info=function(a){for(var b=0;b<a.length;b++){var c=a[b];m_user_naming.insert(c.naming_id,c)}},bu.update_Great_Wall_Dungeon_Battle_Begin=function(a){if(0!=a.great_wall_dungeon_period_idx){var b=_great_wall_dungeon_list.dungeon_list.findIndex(function(d){return d.great_wall_dungeon_period_idx==a.great_wall_dungeon_period_idx&&d.great_wall_dungeon_group_idx==a.great_wall_dungeon_group_idx&&d.great_wall_dungeon_idx==a.great_wall_dungeon_idx});if(-1!=b)_great_wall_dungeon_list.dungeon_list[b].first_clear_yn=a.first_clear_yn,_great_wall_dungeon_list.dungeon_list[b].complete_yn=a.complete_yn,_great_wall_dungeon_list.dungeon_list[b].npc_list=a.npc_list;else{var c={};c.great_wall_dungeon_period_idx=a.great_wall_dungeon_period_idx,c.great_wall_dungeon_group_idx=a.great_wall_dungeon_group_idx,c.great_wall_dungeon_idx=a.great_wall_dungeon_idx,c.first_clear_yn=a.first_clear_yn,c.complete_yn=a.complete_yn,c.npc_list=a.npc_list,_great_wall_dungeon_list.dungeon_list.push_back(c)}bu.upd_UserGreatWall_Ticket(a.user_great_wall_ticket),_great_wall_troops_info.partin_generals=a.partin_generals}},bu.update_Great_Wall_Dungeon_Battle_Win=function(a){if(0!=a.great_wall_dungeon_period_idx){bu.clearBattleDungeonContinue(),_great_wall_troops_info.partin_generals=a.partin_generals;for(var c=0;c<_great_wall_troops_info.troops_list.length;c++){var t=_great_wall_troops_info.troops_list[c];t.troops_num==a.troops_num&&(t.troops_generls.clear(),t.troops_generls=a.troops_generals)}var e;if(-1!=(e=_great_wall_dungeon_list.dungeon_list.findIndex(function(d){return d.great_wall_dungeon_period_idx==a.great_wall_dungeon_period_idx&&d.great_wall_dungeon_idx==a.great_wall_dungeon_idx&&d.great_wall_dungeon_group_idx==a.great_wall_dungeon_group_idx}))&&(_great_wall_dungeon_list.dungeon_list[e].npc_list.clear(),_great_wall_dungeon_list.dungeon_list[e].complete_yn=a.complete_yn,_great_wall_dungeon_list.dungeon_list[e].first_clear_yn=a.first_clear_yn),bu.upd_UserJade(a.user_jade),bu.upd_UserGold(a.user_gold),bu.upd_UserHeart(a.user_heart),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation),-1!=(e=_great_wall_dungeon_list.dungeon_list.findIndex(function(d){return d.great_wall_dungeon_period_idx==a.great_wall_dungeon_period_idx&&d.great_wall_dungeon_group_idx==a.great_wall_dungeon_group_idx&&d.great_wall_dungeon_idx==a.great_wall_dungeon_idx})))_great_wall_dungeon_list.dungeon_list[e].first_clear_yn=a.first_clear_yn,_great_wall_dungeon_list.dungeon_list[e].complete_yn=a.complete_yn,_great_wall_dungeon_list.dungeon_list[e].npc_list.clear();else{var f={};f.great_wall_dungeon_period_idx=a.great_wall_dungeon_period_idx,f.great_wall_dungeon_group_idx=a.great_wall_dungeon_group_idx,f.great_wall_dungeon_idx=a.great_wall_dungeon_idx,f.first_clear_yn=a.first_clear_yn,f.complete_yn=a.complete_yn,_great_wall_dungeon_list.dungeon_list.push_back(f)}for(c=0;c<a.bonus_items.length;c++){var b=a.bonus_items[c];if(b.bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX){var g={};g.gnrl_id=b.bonus_idx,g.gnrl_num=b.bonus_num,g.gnrl_level=b.bonus_level,g.castle_id=b.castle_id,g.used_in_camp="n",g.using_in_camp="n",bu.insert_User_General_V2(g)}else if(b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7)bu.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)bu.plus_User_Love_Item(b.bonus_idx,b.bonus_num);else if(b.bonus_type==BONUS_TYPE_HEART);else if(b.bonus_type==BONUS_TYPE_JADE);else if(b.bonus_type==BONUS_TYPE_GOLD);else if(b.bonus_type==BONUS_TYPE_KEY);else if(b.bonus_type==BONUS_TYPE_RAID_TICKET);else if(b.bonus_type==BONUS_TYPE_EVENT_POINT);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE||b.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE)bu.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL)bu.plus_User_Magic_Key_Mtrl(b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_EVOLVE_ORB)bu.plus_User_Evolve_Orb(b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&b.bonus_type<=BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND){var h=b.bonus_type-BONUS_TYPE_CRAFT_SHOP_FIRST_LOW+4;bu.plus_User_Craft_Shop_Material(h,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EQUIPMENT){MasterManager.getInstance().get_EquipmentItem(b.equipment.equipment_item_idx).equipment_type!=EQUIPMENT_TYPE_EXP&&bu.insert_User_Equipment(b.equipment)}else if(b.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||b.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL){var i=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(b.bonus_type);bu.plus_User_Limit_Over_Mtrl(i,b.bonus_idx)}else b.bonus_type==BONUS_TYPE_EVENT_DUNGEON_SPECIAL_POINT||b.bonus_type==BONUS_TYPE_USER_EXP||b.bonus_type==BONUS_TYPE_JADE_RANDOM_BOX||b.bonus_type==BONUS_TYPE_GOLD_RANDOM_BOX||b.bonus_type==BONUS_TYPE_LOVE_ITEM_RANDOM_BOX||b.bonus_type==BONUS_TYPE_RARE_HWANDAN_RANDOM_BOX||b.bonus_type==BONUS_TYPE_EXP_CARD_RANDOM_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_GIFT_BOX||b.bonus_type==BONUS_TYPE_SWORD_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_SPEAR_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_ARCHER_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_RANDOM_BOX||b.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_GIFT_BOX||b.bonus_type==BONUS_TYPE_EVENTDUNGEON_PRESENT_GIFT_BOX||b.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_R_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_HR_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_SR_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_HN_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_R_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_HR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_SR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_1||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_2||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_3||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_4||b.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_GACHA_REBORN_GNRL_TICKET||b.bonus_type==BONUS_TYPE_ALL_RARE_TYPE_GNRL_SELECT_TICKET||b.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET||b.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET_V2||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_2||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_3||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_4||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_5||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_6||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_7||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_8||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_9||(b.bonus_type,BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_10)}}},bu.update_Great_Wall_Dungeon_Battle_Lose=function(a){if(0!=a.great_wall_dungeon_period_idx){bu.clearBattleDungeonContinue(),_great_wall_troops_info.partin_generals=a.partin_generals;var b=_great_wall_dungeon_list.dungeon_list.findIndex(function(d){return d.great_wall_dungeon_period_idx==a.great_wall_dungeon_period_idx&&d.great_wall_dungeon_idx==a.great_wall_dungeon_idx&&d.great_wall_dungeon_group_idx==a.great_wall_dungeon_group_idx});-1!=b&&(_great_wall_dungeon_list.dungeon_list[b].npc_list=a.npc_list);for(var c=0;c<_great_wall_troops_info.troops_list.length;c++){var t=_great_wall_troops_info.troops_list[c];t.troops_num==a.troops_num&&(t.troops_generls.clear(),t.troops_generls=a.troops_generals)}}},bu.update_Great_Wall_Dungeon_Battle_Check=function(a){"n"==a.battle_continue_yn&&bu.clearBattleDungeonContinue(),bu.upd_UserGreatWall_Ticket(a.user_great_wall_ticket)},bu.delete_User_Mussang_Tower=function(){m_user_mussang_tower.clear()},bu.insert_User_Mussang_Tower=function(a){for(var b=0;b<a.length;b++){var c=a[b],user_tower={};user_tower.user_id=m_user_id,user_tower.period_idx=c.period_idx,user_tower.mussang_tower_id=c.mussang_tower_id,user_tower.win_count=c.win_count,user_tower.new_yn=c.new_yn,user_tower.complete_yn=c.complete_yn,m_user_mussang_tower.insert([user_tower.user_id,user_tower.period_idx,user_tower.mussang_tower_id],user_tower)}},bu.delete_User_Mussang_Tower_Task=function(){m_user_mussang_tower_task.clear()},bu.insert_User_Mussang_Tower_Task=function(a){for(var b=0;b<a.length;b++){var c=a[b],user_tower={};user_tower.user_id=m_user_id,user_tower.period_idx=c.period_idx,user_tower.mussang_tower_id=c.mussang_tower_id,user_tower.task_id=c.task_id,m_user_mussang_tower_task.insert([user_tower.user_id,user_tower.period_idx,user_tower.mussang_tower_id,user_tower.task_id],user_tower)}},bu.delete_User_Mussang_Tower_Lotus_Log=function(){m_user_mussang_tower_lotus_log.clear()},bu.insert_User_Mussang_Tower_Lotus_Log=function(a){for(var b=0;b<a.length;b++){var c=a[b],user_tower={};user_tower.user_id=m_user_id,user_tower.period_idx=c.period_idx,user_tower.lotus_count=c.lotus_count,user_tower.new_yn=c.new_yn,user_tower.complete_yn=c.complete_yn,m_user_mussang_tower_lotus_log.insert([user_tower.user_id,user_tower.period_idx,user_tower.lotus_count],user_tower)}},bu.delete_User_Beginner_Booster=function(){m_user_beginner_booster.clear()},bu.insert_user_beginner_booster=function(a){var b=new Object;b.user_id=m_user_id,b.bound=a,b.complete_yn=a.complete_yn,b.user_level=a.user_level,b.deadline_dt=a.deadline_dt,m_user_beginner_booster.insert(m_user_id,b)},bu.update_Check_Upgrade_User_Camp_Branch_Ability=function(a){for(var b=CampService.getInstance().getCamp_branch_ability_log(),idx=0;idx<b.length;idx++){var c=b[idx];if(c.ability_id==a.branch_ability_id){c.complete_yn="y";for(var d=c.remain_second=0;d<c.gnrl_keys.length;d++){var e={};e.gnrl_id=c.gnrl_keys[d].gnrl_id,e.gnrl_num=c.gnrl_keys[d].gnrl_num,0<e.gnrl_id&&0<e.gnrl_num&&map_User_General.remove([e.gnrl_id,e.gnrl_num])}b[idx]=c}}"y"==a.complete_yn&&(bu.delete_User_Camp_Branch_Ability("",a.branch_ability.branch_type),bu.insert_User_Camp_Branch_Ability(a.branch_ability))},bu.clear_Announce_List=function(){list_Announce_Msg_Queue=[]},bu.get_Announce_List=function(){return list_Announce_Msg_Queue},bu.update_Announce_List=function(a){0<list_Announce_Msg_Queue.length?list_Announce_Msg_Queue[0]=a.notice:list_Announce_Msg_Queue.push(a.notice)},bu.set_Raid_Boss_Battle_Result=function(a){if(0==a.raid_boss_info.remain_hp){_raid_boss_list.user_raid_boss_open_list=_raid_boss_list.user_raid_boss_open_list.filter(function(r){return r.discovered_user_id!=a.raid_boss_info.discovered_user_id&&r.raid_boss_period_idx!=a.raid_boss_info.raid_boss_period_idx&&r.raid_boss_num!=a.raid_boss_info.raid_boss_num});var b=[];null!=_raid_boss_list.user_raid_boss_history_list&&(b=_raid_boss_history.user_raid_boss_history_list.slice(0)),_raid_boss_history.user_raid_boss_history_list=[],_raid_boss_history.user_raid_boss_history_list.push(a.raid_boss_info);for(var i=0;i<b.length;i++)_raid_boss_history.user_raid_boss_history_list.push(b[i])}else for(var c=0;c<_raid_boss_list.user_raid_boss_open_list.length;c++){var r=_raid_boss_list.user_raid_boss_open_list[c];if(r.discovered_user_id==a.raid_boss_info.discovered_user_id&&r.raid_boss_period_idx==a.raid_boss_info.raid_boss_period_idx&&r.raid_boss_num==a.raid_boss_info.raid_boss_num){r.remain_hp=a.raid_boss_info.remain_hp;break}}},bu.set_Raid_Boss_Shared=function(){for(var a=0;a<_raid_boss_list.user_raid_boss_open_list.length;a++){var r=_raid_boss_list.user_raid_boss_open_list[a];if(r.discovered_user_id==res.raid_boss_info.discovered_user_id&&r.raid_boss_period_idx==res.raid_boss_info.raid_boss_period_idx&&r.raid_boss_num==res.raid_boss_info.raid_boss_num){r.shared_type=res.raid_boss_info.shared_type,r.remain_hp=res.raid_boss_info.remain_hp;break}}},bu.get_User_Prologue_V2=function(a){map_user_prologue_v2.clear(),map_user_prologue_v2.insert(m_user_id,a.complete_yn)},bu.res_Raid_Boss_Battle_Check=function(a){a.battle_continue_clear_yn&&NetService().clearBattleDungeonContinue(),bu.upd_UserItemRaidTicket(a.user_raid_ticket)},bu.update_User_Prologue_V2_Complete=function(a){var b=map_user_prologue_v2.at(m_user_id);null!=b?b.complete_yn=a.complete_yn:map_user_prologue_v2.insert(m_user_id,a.complete_yn)},bu.update_User_Equipment_General_Change=function(){bu.delete_User_Gnrl_Equipment(res.gnrl_key,res.release_equipment_key),0<res.release_gnrl_key.gnrl_id&&delete_User_Gnrl_Equipment(res.release_gnrl_key,res.equipment_key),bu.insert_User_Gnrl_Equipment(res.gnrl_key,res.equipment_key);var a={equipment_item_idx:res.release_equipment_key.equipment_item_idx,equipment_num:res.release_equipment_key.equipment_num};map_User_Equipment.at([a.equipment_item_idx,a.equipment_num]).equip_yn="n";var b={equipment_item_idx:res.equipment_key.equipment_item_idx,equipment_num:res.equipment_key.equipment_num};map_User_Equipment.at([b.equipment_item_idx,b.equipment_num]).equip_yn="n",map_User_Equipment.at([a.equipment_item_idx,a.equipment_num]).equip_yn="n",map_User_Equipment.at([b.equipment_item_idx,b.equipment_num]).equip_yn="y"},bu.update_User_Event_Dungeon_Point_Reward_Board_Map=function(a){var b=MasterManager.getInstance().get_EventDungeonPeriod(a.event_dungeon_period_idx),borad_info=map_user_event_dungeon_reward_board_info.at([b.event_dungeon_point_period_idx,a.event_dungeon_reward_board_info_idx]);null!=borad_info?(borad_info.open_yn=a.board_open_yn,borad_info.complete_yn=a.board_complete_yn):((c=new Object).user_id=m_user_id,c.event_dungeon_period_idx=b.event_dungeon_point_period_idx,c.event_dungeon_reward_board_info_idx=a.event_dungeon_reward_board_info_idx,c.open_yn=a.board_open_yn,c.complete_yn=a.board_complete_yn,map_user_event_dungeon_reward_board_info.insert([b.event_dungeon_point_period_idx,a.event_dungeon_reward_board_info_idx],c));var c,map_bonus=map_user_event_dungeon_board_map_bonus.at([m_user_id,b.event_dungeon_point_period_idx,res.event_dungeon_reward_board_info_idx,res.event_dungeon_reward_board_map_idx]);null!=map_bonus?map_bonus.rewarded_yn=res.rewarded_yn:((c=new Object).user_id=m_user_id,c.event_dungeon_period_idx=b.event_dungeon_period_idx,c.event_dungeon_reward_board_info_idx=a.event_dungeon_reward_board_info_idx,c.event_dungeon_reward_board_map_idx=a.event_dungeon_reward_board_map_idx,c.rewarded_yn=a.rewarded_yn,map_user_event_dungeon_board_map_bonus.insert([c.user_id,c.event_dungeon_period_idx,c.event_dungeon_reward_board_info_idx,c.event_dungeon_reward_board_map_idx],c))},bu.update_User_Event_Dungeon_Craft_Shop_Material=function(a){for(var b=0;b<a.length;b++){var c=map_user_event_dungeon_craft_shop_material.at([m_user_id,a[b].craft_shop_bonus_type]);null!=c&&(c.material_count=a[b].material_count)}},bu.upd_Camp_Factory_Exchange_Item=function(a){if(a.factory_mtrl_type==CAMP_FACTORY_MTRL_LIMIT_OVER)a.need_mtrl_type!=LIMIT_OVER_MTRL_SR&&a.need_mtrl_type!=LIMIT_OVER_MTRL_SSR||bu.update_User_Limit_Over_Mtlr(a.need_mtrl_type,a.user_mtrl_count);else if(a.factory_mtrl_type==CAMP_FACTORY_MTRL_MAGIC_KEY){var f=MasterManager.getInstance().get_CampFactory(a.factor_id);f.cmplt_item_type==BONUS_TYPE_MAGIC_KEY?bu.udp_UserPlusKeyBound(a.plus_key_bound):f.cmplt_item_type==BONUS_TYPE_KEY_REFILL&&bu.update_User_Key_Recovery_Make_Count(a.key_recovery_make_count),bu.update_User_Magic_Key_Mtrl(a.user_mtrl_count)}else a.factory_mtrl_type==CAMP_FACTORY_MTRL_JADE_PIECE&&bu.update_User_Jade_Piece(a.user_mtrl_count)},bu.upd_Get_User_Jade_Piece=function(a){User_Jade_Piece=a.jade_piece_cnt},bu.getJadePieceCount=function(){return User_Jade_Piece},bu.plus_User_Jade_Piece=function(a){User_Jade_Piece+=a},bu.update_User_Jade_Piece=function(a){User_Jade_Piece=a},bu.update_User_Limit_Over_Mtlr=function(a,b){for(var c=map_User_Limit_Over_Mtrl.keys(),idx=0;idx<c.length;idx++){var d=map_User_Limit_Over_Mtrl.at(c[idx]);d.limit_over_mtrl_type==a&&(d.mtrl_cnt=b)}},bu.update_User_Magic_Key_Mtrl=function(a){User_Magic_Key_Mtrl=a},bu.update_User_Key_Recovery_Make_Count=function(a){User_Key_Recovery_Make_Count=a},bu.insert_User_Limit_Over_Mtlr=function(a){map_User_Limit_Over_Mtrl.clear();for(var b=0;b<a.length;b++){var c={};c.user_id=m_user_id,c.mtrl_cnt=a[b].mtrl_cnt,c.limit_over_mtrl_type=a[b].limit_over_mtrl_type;var d={};d.limit_over_mtrl_type=c.limit_over_mtrl_type,d.mtrl_cnt=c.mtrl_cnt,map_User_Limit_Over_Mtrl.insert(c.limit_over_mtrl_type,d)}},bu.delete_User_Equipments=function(){map_User_Equipment.clear()},bu.insert_User_Box_Gacha_Equipments=function(a){for(var b=0;b<a.length;b++)a[b].bonus_type==BONUS_TYPE_EQUIPMENT&&bu.insert_User_Equipment(a[b])},bu.insert_User_World_War_Box_Gacha_Equipments=function(a){for(var b=0;b<a.length;b++)a[b].bonus_type==BONUS_TYPE_EQUIPMENT&&bu.insert_User_Equipment(a[b])},bu.insert_User_Equipments=function(a){for(var b=0;b<a.length;b++)bu.insert_User_Equipment(a[b])},bu.insert_User_Equipment=function(a){var b=a.user_equipment_data;null==b&&(b=a);var c={};c.user_id=m_user_id,c.equipment_item_idx=b.equipment_item_idx,c.equipment_num=b.equipment_num,c.level=b.level,c.exp=b.exp,c.arm_service_type=b.arm_service_type,c.step=b.step,c.combo_stat=b.combo_stat,c.stat_value=b.stat_value,c.base_stat_level_id=b.base_stat_level_id,c.option_num1=b.option_num1,c.option_num2=b.option_num2,c.option_num3=b.option_num3,c.option_num4=b.option_num4,c.option_num5=b.option_num5,c.equip_yn=b.equip_yn,c.lock_yn=b.lock_yn,c.gnrl_group=b.gnrl_group;var d={};d.equipment_item_idx=b.equipment_item_idx,d.equipment_num=b.equipment_num,map_User_Equipment.insert([d.equipment_item_idx,d.equipment_num],b)},bu.delete_User_Equipment=function(a){1==map_User_Equipment.find([a.equipment_item_idx,a.equipment_num])&&map_User_Equipment.remove([a.equipment_item_idx,a.equipment_num])},bu.update_User_Gnrl_Equipment=function(b,c,d){null==d&&(d=[]);for(var e=0;e<d.length;e++){var f=d[e];1==map_User_Gnrl_Equipment.find([b.gnrl_id,b.gnrl_num])&&map_User_Gnrl_Equipment.remove([b.gnrl_id,b.gnrl_num]);var g={};g.equipment_item_idx=f.equipment_item_idx,g.equipment_num=f.equipment_num,g.gnrl_id=c.gnrl_id,g.gnrl_num=c.gnrl_num;var h=map_User_Gnrl_Equipment.at([c.gnrl_id,c.gnrl_num]);null==h&&(h=[]),0==h.filter(function(a){return a.equipment_item_idx==f.equipment_item_idx}).length&&(h.push(g),map_User_Gnrl_Equipment.insert([[c.gnrl_id,c.gnrl_num]],h))}},bu.getUserEquipment=function(a){return map_User_Equipment.at([a.equipment_item_idx,a.equipment_num])},bu.getUserEquipmentList=function(a){for(var b=map_User_Equipment.keys(),i=0;i<b.length;i++)a.push(map_User_Equipment.at(b[i]))},bu.getUserEquipmentCount=function(){return map_User_Equipment.size()},bu.getUserGnrlEquipmentList=function(a){return map_User_Gnrl_Equipment.at([a.gnrl_id,a.gnrl_num])},bu.get_user_gnrl_equipment=function(){return map_User_Gnrl_Equipment},bu.getUserGnrlEquipment=function(a,b,c){for(var d=map_User_Gnrl_Equipment.at([a.gnrl_id,a.gnrl_num]),found_thumb_is=!1,i=0;i<d.size();i++)if(d[i].equipment_item_idx==b.equipment_item_idx){found_thumb_is=!0;break}found_thumb_is!=d.end()&&d[i]},bu.delete_User_Gnrl_Equipment=function(b,c){var d=map_User_Gnrl_Equipment.at([b.gnrl_id,b.gnrl_num]);null==d&&(d=[]);var e=d.filter(function(a){return a.equipment_item_idx!=c.equipment_item_idx});map_User_Gnrl_Equipment.insert([[b.gnrl_id,b.gnrl_num]],e)},bu.delete_User_Gnrl_Equipments=function(){map_User_Gnrl_Equipment.clear()},bu.insert_User_Gnrl_Equipments=function(a){for(var b=0;b<a.length;b++){var c=a[b];bu.insert_User_Gnrl_Equipment(c)}},bu.insert_User_Gnrl_Equipment=function(b){var c={};c.user_id=m_user_id,c.equipment_item_idx=b.equipment_item_idx,c.equipment_num=b.equipment_num,c.gnrl_num=b.gnrl_num,c.gnrl_id=b.gnrl_id;var d={};d.gnrl_id=b.gnrl_id,d.gnrl_num=b.gnrl_num;var e=map_User_Gnrl_Equipment.at([d.gnrl_id,d.gnrl_num]);null==e&&(e=[]),-1==e.findIndex(function(a){return a.equipment_item_idx==b.equipment_item_idx})&&(e.push(c),map_User_Gnrl_Equipment.insert([d.gnrl_id,d.gnrl_num],e)),d=c=null},bu.upd_Yunhee_Inventory_Increase=function(a){bu.upd_UserJade(a.user_jade),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)},bu.update_User_Yunhee_Bound=function(a){var b={};b.user_id=m_user_id,b.bound=a,m_user_yunhee_bound.insert(m_user_id,b),b=null},bu.update_User_Equipment_Bound=function(a){map_User_Equipment_bound.clear();var b={};b.user_id=m_user_id,b.user_equipment_bound=a,map_User_Equipment_bound.insert(m_user_id,b)},bu.upd_Weekly_Dungeon_Battle_Win=function(a){bu.upd_User_Key(a.user_key),bu.upd_UserItemRaidTicket(a.user_raid_ticket),bu.upd_UserRaidHelpTicket(a.user_raid_help_ticket),bu.upd_UserJade(a.user_jade),bu.upd_UserGold(a.user_gold),bu.upd_UserHeart(a.user_heart),bu.upd_UserFormationPoint(a.user_formation_point),bu.upd_UserLevelExp(a.user_level,a.user_exp);for(var c=0;c<a.bonus_items.length;c++){var b=a.bonus_items[c];if(b.bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX){var d={};d.gnrl_id=b.bonus_idx,d.gnrl_num=b.bonus_num,d.gnrl_level=b.bonus_level,d.castle_id=b.castle_id,bu.insert_User_General_V2(d)}else if(b.bonus_type>=BONUS_TYPE_HWANDAN_1&&b.bonus_type<=BONUS_TYPE_HWANDAN_7)bu.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)bu.plus_User_Love_Item(b.bonus_idx,b.bonus_num);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE)bu.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_ATTK_POINT&&b.bonus_type<=BONUS_TYPE_CRI_DMG_POINT)bu.plus_User_Formation_Property_Point(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_YUNHEE_PT)bu.plus_User_Yunhee_PT(b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_EVOLVE_ORB)bu.plus_User_Evolve_Orb(b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_GOLD);else if(b.bonus_type==BONUS_TYPE_JADE);else if(b.bonus_type==BONUS_TYPE_HEART);else if(b.bonus_type==BONUS_TYPE_USER_EXP);else if(b.bonus_type>=BONUS_TYPE_REBIRTH_MTRL_TYPE_1&&b.bonus_type<=BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type>=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1&&b.bonus_type<=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){var e=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(b.bonus_type);bu.plus_User_Rebirth_Mtrl(e,b.bonus_idx)}}for(var i=0;i<a.task_list.length;i++){for(var f=a.task_list[i],found=!1,foundIndex=0,j=0;j<_weekly_task.task_list.length;j++){var t=_weekly_task.task_list[j];if(f.weekly_idx==t.weekly_idx&&f.num==t.num){found=!0,foundIndex=j;break}}1==found?(_weekly_task.task_list[foundIndex].count=f.count,_weekly_task.task_list[foundIndex].complete_yn=f.complete_yn):_weekly_task.task_list.push(f)}"y"==a.new_mail_yn&&GameContext.getInstance().setUserNewMail("y")},bu.get_Weekly_TaskList=function(){return _weekly_task.task_list},bu.upd_Weekly_Dungeon_Battle_Lose=function(){},bu.upd_Mussang_Step_Battle_Begin=function(a){bu.upd_User_Key(a.user_key),bu.upd_UserItemTicket(a.user_ticket),bu.upd_UserJade(a.user_jade)},bu.upd_Mussang_Step_Battle_Win=function(a){UserService.getInstance();bu.upd_User_Key(a.user_key),bu.upd_UserItemTicket(a.user_ticket),bu.update_User_Mussang(a.mussang_cur_step,a.mussang_type),bu.upd_UserItemRaidTicket(a.user_raid_ticket),bu.upd_UserRaidHelpTicket(a.user_raid_help_ticket),bu.upd_UserJade(a.user_jade),bu.upd_UserGold(a.user_gold),bu.upd_UserHeart(a.user_heart);for(var c=0;c<a.bonus_items.length;c++){var b=$.extend({},net.Battle_Bonus_Item);if((b=a.bonus_items[c]).bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX){var d={};d.gnrl_id=b.bonus_idx,d.gnrl_num=b.bonus_num,d.gnrl_level=b.bonus_level,d.castle_id=b.castle_id,d.gnrl_exp=0,d.love_level=0,d.love_exp=0,d.limit_step_id=0,bu.insert_User_General_V2(d)}else if(b.bonus_type>=BONUS_TYPE_HWANDAN_1&&b.bonus_type<=BONUS_TYPE_HWANDAN_7)bu.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)bu.plus_User_Love_Item(b.bonus_idx,b.bonus_num);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE)bu.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE||b.bonus_type==BONUS_TYPE_WHITE_CHOCO||b.bonus_type==BONUS_TYPE_COMEBACK_CAKE||b.bonus_type==BONUS_TYPE_LOVE_MAX_CAKE||b.bonus_type>=BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_01&&b.bonus_type<=BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_10)bu.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_ATTK_POINT&&b.bonus_type<=BONUS_TYPE_CRI_DMG_POINT)bu.plus_User_Formation_Property_Point(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_YUNHEE_PT)bu.plus_User_Yunhee_PT(b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_EVOLVE_ORB)bu.plus_User_Evolve_Orb(b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_GOLD);else if(b.bonus_type==BONUS_TYPE_JADE);else if(b.bonus_type==BONUS_TYPE_HEART);else if(b.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||b.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL){var e=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(b.bonus_type);bu.plus_User_Limit_Over_Mtrl(e,b.bonus_idx)}}},bu.upd_Mussang_Step_Battle_Lose=function(a){},bu.upd_Get_User_Mussang=function(a){},bu.update_User_Daily_Dungeon=function(a){for(var b=0;b<a.length;b++)User_daily_dungeon.push(a[b])},bu.upd_UserLevelExp=function(a,b){var c=bu.get_User_info(),data={};data.user_id=c.user_id,data.nickname=c.nickname,data.state_type=c.state_type,data.user_level=a,data.user_exp=b,data.join_bonus_cmplt_yn=c.join_bonus_cmplt_yn,data.naming=c.naming,bu.insert_User_info(data)},bu.upd_Daily_Dungeon_Battle_Result=function(a){UserService.getInstance();bu.upd_User_Key(a.user_key),bu.upd_UserItemRaidTicket(a.user_raid_ticket),bu.upd_UserRaidHelpTicket(a.user_raid_help_ticket),bu.upd_UserJade(a.user_jade),bu.upd_UserGold(a.user_gold),bu.upd_UserLevelExp(a.user_level,a.user_exp),bu.upd_UserFormationPoint(a.user_formation_point);for(var c=0;c<a.bonus_items.length;c++){var b=a.bonus_items[c];if(b.bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX){var d={};d.gnrl_id=b.bonus_idx,d.gnrl_num=b.bonus_num,d.gnrl_level=b.bonus_level,d.castle_id=b.castle_id,d.gnrl_exp=0,d.love_level=0,d.love_exp=0,d.limit_step_id=0,bu.insert_User_General_V2(d)}else b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7?bu.plus_User_Hwandan(b.bonus_type,b.bonus_idx):b.bonus_type==BONUS_TYPE_LOVE_ITEM?bu.plus_User_Love_Item(b.bonus_idx,b.bonus_num):b.bonus_type==BONUS_TYPE_HEART?bu.plus_User_Heart(b.bonus_idx):b.bonus_type==BONUS_TYPE_JADE||b.bonus_type==BONUS_TYPE_GOLD||b.bonus_type==BONUS_TYPE_KEY||b.bonus_type==BONUS_TYPE_RAID_TICKET||b.bonus_type==BONUS_TYPE_EVENT_POINT||(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE?bu.plus_User_Love_Item(b.bonus_level,b.bonus_idx):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER?bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE?bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW&&bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx))}var e=[],daily={};daily.daily_dungeon_id=a.daily_dungeon_idx,daily.daily_dungeon_period_idx=a.daily_dungeon_period_idx,daily.complete_yn=a.complete_yn,e.push(daily),bu.update_User_Daily_Dungeon(e),0<a.gnrl_exp.length&&bu.upd_UserGeneralLevelExp(a.gnrl_exp)},bu.upd_UserGeneralLevelExp=function(a){for(var b=0;b<a.length;b++){var c={};c.gnrl_id=a[b].gnrl_id,c.gnrl_num=a[b].gnrl_num,map_User_General.at([c.gnrl_id,c.gnrl_num]).gnrl_level=a[b].gnrl_level,map_User_General.at([c.gnrl_id,c.gnrl_num]).gnrl_exp=a[b].gnrl_exp}bu.update_user_Generals()},bu.upd_Daily_Dungeon_Battle_Begin=function(a){UserService.getInstance();bu.upd_User_Key(a.user_key),bu.upd_UserJade(a.user_jade);for(var b=!1,event_period=m_daily_dungeon_open_period_info.daily_dungeon_open_period,idx=0;idx<event_period.length;idx++){var p=event_period[idx];if(p.daily_dungeon_period_idx==a.daily_dungeon_period_idx&&p.challenge_dt==a.user_challenge_log.challenge_dt){p.key_cost_challenge_count=a.user_challenge_log.key_cost_challenge_count,p.jade_cost_challenge_count=a.user_challenge_log.jade_cost_challenge_count,b=!0;break}}b||m_daily_dungeon_open_period_info.daily_dungeon_open_period.push(a.user_challenge_log)},bu.upd_User_Weekly_Dungeon_Open=function(a){bu.upd_UserJade(a.user_jade),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);var b=$.extend({},a),key=b.weekly_idx+""+b.week_type;map_user_weekly_open.insert(key,b)},bu.upd_User_Achievement_Complete=function(a){for(var b=0;b<a.achv_ids.length;b++)bu.update_User_Achievement_Complete(a.achv_ids[b])},bu.update_User_Achievement_Complete=function(a){var b=MasterManager.getInstance().get_AchivementCompleteCondition(a),upd_achi={complete_yn:"y",complete_count:0};if(0==b.count?b.achv_cmplt_type==AchvCompType_StoryClear?upd_achi.complete_count=1:upd_achi.complete_count=0:b.achv_cmplt_type==AchvCompType_UserLevel?upd_achi.complete_count=1:b.achv_cmplt_type==AchvCompType_StoryClear?upd_achi.complete_count=1:upd_achi.complete_count=b.count,null!=map_achievement_list)for(var c=map_achievement_list.keys(),i=0;i<c.length;i++){var d=map_achievement_list.at(c[i]);if(d.achv_id==a){d.complete_yn=upd_achi.complete_yn,0!=upd_achi.complete_count&&(d.complete_count=upd_achi.complete_count);var e=d.achv_id;map_achievement_list.insert(e,d)}}},bu.upd_shop_Gacha_bonus=function(a){var b={};b.gacha_count=a.gacha_bonus_count,bu.update_User_Gacha_Count(b),GameContext.getInstance().setUserNewMail("y")},bu.init_Battle_Formation_Level_Up=function(a){bu.insert_User_Battle_Formation(a),bu.upd_UserJade(a.user_jade),bu.upd_UserGold(a.user_gold),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation),bu.upd_UserFormationPoint(a.user_formation_point);for(var i=0;i<a.payback_property_point.length;i++){var b=a.payback_property_point[i];0<b.point_count&&bu.upd_UserFormationPropertyPoint(b.property_type,a.user_formation_proterty_point[i].point_count)}},bu.upd_Battle_Formation_Level_Up=function(a){var b=$.extend({},m_User_Battle_formation.at(a.old_formation.formation_id));b.formation_id=a.new_formation.formation_id,m_User_Battle_formation.remove(a.old_formation.formation_id),m_User_Battle_formation.insert(b.formation_id,b),bu.upd_UserFormationPoint(a.user_formation_point),bu.upd_UserFormationPropertyPoint(a.formation_property_type,a.property_point_count),bu.upd_UserGold(a.user_gold),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)},bu.upd_UserFormationPoint=function(a){User_item_info.user_item.formation_point=a},bu.upd_UserFormationPropertyPoint=function(a,b){m_User_formation_property_point.at(a).point_count=b},bu.get_Main_Story_Lotus_Bonus_Log=function(){return m_User_main_lotus_bonus_log},bu.upd_Main_Story_Lotus_Bonus_Get_V2=function(a){var b=a.lotus_bonus_log.main_scene_id,main_story_id=a.lotus_bonus_log.main_story_id,difficulty_type=a.lotus_bonus_log.difficulty_type,lotus_count=a.lotus_bonus_log.lotus_count,bonus_log=m_User_main_lotus_bonus_log.at([b,main_story_id,difficulty_type,lotus_count]);if(null!=bonus_log)bonus_log.complete_yn=a.lotus_bonus_log.complete_yn,bonus_log.new_yn=a.lotus_bonus_log.new_yn;else{var c={main_scene_id:b=a.lotus_bonus_log.main_scene_id,main_story_id:main_story_id=a.lotus_bonus_log.main_story_id,difficulty_type:difficulty_type=a.lotus_bonus_log.difficulty_type,lotus_count:lotus_count=a.lotus_bonus_log.lotus_count,new_yn:a.lotus_bonus_log.new_yn,complete_yn:a.lotus_bonus_log.complete_yn};m_User_main_lotus_bonus_log.insert([c.main_scene_id,c.main_story_id,c.difficulty_type,c.lotus_count],c)}},bu.remove_All_Troops_Del_General=function(a){for(var b=0;b<a.troops_nums.length;b++){var c=a.troops_nums[b];bu.update_User_Troops_Generals(c,a.troops_gnrls)}for(b=0;b<a.weekly_troops_nums.length;b++){var d=a.weekly_troops_nums[b];bu.update_User_Weekly_Troops_Generals(d,a.weekly_troops_gnrls)}},bu.upd_General_Limit_Over=function(a){var b={gnrl_id:a.gnrl_key.gnrl_id,gnrl_num:a.gnrl_key.gnrl_num,limit_step_id:a.limit_step_id};map_User_General.at([b.gnrl_id,b.gnrl_num]).limit_step_id=b.limit_step_id,bu.upd_UserGold(a.user_gold),this.remove_user_generals(a.mtrl_key),bu.update_user_Generals()},bu.upd_General_Evolution=function(a){bu.insert_User_General_V2(a.new_gnrl);var b=a.new_gnrl.gnrl_id,new_gnrl_num=a.new_gnrl.gnrl_num,new_gnrl_key={};new_gnrl_key.gnrl_id=a.new_gnrl.gnrl_id,new_gnrl_key.gnrl_num=a.new_gnrl.gnrl_num;var c=GameContext.getInstance().getUserGeneralPartner();if(c.gnrl_id==a.del_gnrl_key.gnrl_id&&c.gnrl_num==a.del_gnrl_key.gnrl_num){var d={};d.gnrl_id=b,d.gnrl_num=new_gnrl_num,GameContext.getInstance().setUserGeneralParnter(d)}var e=GameContext.getInstance().getUserFriendPartner();if(e.gnrl_id==a.del_gnrl_key.gnrl_id&&e.gnrl_num==a.del_gnrl_key.gnrl_num){var f={};f.gnrl_id=b,f.gnrl_num=new_gnrl_num,GameContext.getInstance().setUserFriendPartner(f)}bu.updateEventDungeonSearchTroopsGeneralEvolution(a.del_gnrl_key,a.new_gnrl),bu.upd_UserGold(a.user_gold),bu.udp_UserEvolveOrb(a.user_evolve_orb),"y"==a.new_yn&&bu.insert_User_Book_General_Evolution(a.new_gnrl,a.love_level_max_yn),bu.update_User_Gnrl_Equipment(a.del_gnrl_key,new_gnrl_key,a.equip_keys),bu.update_hwandan(a.user_hwandan);var g=[];g.push(a.del_gnrl_key),bu.remove_user_generals(g),bu.remove_user_generals(a.mtrl_keys),bu.delete_UserEvolveArmServiceMtrl(),bu.insert_UserEvolveArmServiceMtrl(a.user_arm_service_mtrl)},bu.update_hwandan=function(a){bu.delete_UserHwandan(),bu.insert_UserHwandan(a)},bu.insert_User_Book_General_Evolution=function(a,b){var c=$.extend({},a);c.max_level_complete_yn="n",c.love_max_level_complete_yn=b,list_User_book_General.push(c)},bu.updateEventDungeonSearchTroopsGeneralEvolution=function(a,b){for(var c=map_User_Event_Dungeon_Search_Troops_Generals.keys(),idx=0;idx<c.length;idx++)for(var d=map_User_Event_Dungeon_Search_Troops_Generals.at(c[idx]),t_idx=0;t_idx<d.length;t_idx++){var g=d[t_idx];if(g.gnrl_id==a.gnrl_id&&g.gnrl_num==a.gnrl_num)return g.gnrl_id=b.gnrl_id,void(g.gnrl_num=b.gnrl_num)}},bu.remove_User_Camp_Cost_General=function(a){if(this.m_game_type!=db.BattleGameType.GreatWallDungeon)var b=MAX_TROOPS_NUM-1;for(var i=0;i<b;i++){var c=bu.update_User_Camp_Cost(i+1,a.added_cost);bu.update_User_Troops_Cost(i+1,a.added_cost,c)}(e={}).gnrl_id=a.removed_gnrl_key.gnrl_id,e.gnrl_num=a.removed_gnrl_key.gnrl_num,0<e.gnrl_id&&(map_User_General.at([e.gnrl_id,e.gnrl_num]).using_in_camp="n"),bu.delete_User_Camp_Cost_General(a.troops_num);for(var d=0;d<a.gnrl_keys.length;d++){var e=a.gnrl_keys[d];bu.insert_User_Camp_Cost_General_ADD(e,a.troops_num,d),0<e.gnrl_id&&(map_User_General.at([e.gnrl_id,e.gnrl_num]).using_in_camp="y",map_User_General.at([e.gnrl_id,e.gnrl_num]).used_in_camp="n")}bu.update_user_Generals(),_great_wall_troops_info.partin_generals=a.partin_generals,_great_wall_troops_info.troops_list=a.troops_list},bu.update_User_Camp_Cost=function(a,b){var c,user_camp=map_User_Camp_cost.at(a);if(null==user_camp){var d=new Object;d.troops_num=a,d.added_cost=0,map_User_Camp_cost.insert(a,d),user_camp=map_User_Camp_cost.at(a)}return c=user_camp.added_cost,user_camp.added_cost=b,c},bu.set_User_Camp_Cost=function(a){if(this.m_game_type!=db.BattleGameType.GreatWallDungeon)var b=MAX_TROOPS_NUM-1;for(var c=a.cost_yunhee.troops_num,keys=map_User_Cost_general.keys(),idx=0;idx<keys.length;idx++){var d=$.extend({},map_User_Cost_general.at(keys[idx]));d.troops_num==c&&0<d.gnrl_id&&0<d.gnrl_num&&(map_User_General.at([d.gnrl_id,d.gnrl_num]).using_in_camp="n")}a.bonus_type==BONUS_TYPE_GOLD?(bu.upd_UserGold(a.user_amount),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):a.bonus_type==BONUS_TYPE_JADE&&(bu.upd_UserJade(a.user_amount),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation));for(var i=0;i<b;i++){var e=bu.update_User_Camp_Cost(i+1,a.cost_yunhee.added_cost);bu.update_User_Troops_Cost(i+1,a.cost_yunhee.added_cost,e)}bu.delete_User_Camp_Cost_General(a.cost_yunhee.troops_num);for(idx=0;idx<a.cost_yunhee.gnrl_keys.length;idx++){var f=a.cost_yunhee.gnrl_keys[idx];bu.insert_User_Camp_Cost_General_ADD(f,a.cost_yunhee.troops_num,idx),0<f.gnrl_id&&(map_User_General.at([f.gnrl_id,f.gnrl_num]).using_in_camp="y",map_User_General.at([f.gnrl_id,f.gnrl_num]).used_in_camp="n")}bu.update_user_Generals(),null!=a.partin_generals&&(_great_wall_troops_info.partin_generals=a.partin_generals),null!=a.troops_list&&(_great_wall_troops_info.troops_list=a.troops_list)},bu.upd_User_Camp=function(a){if(this.m_game_type!=db.BattleGameType.GreatWallDungeon)var b=MAX_TROOPS_NUM-1;try{var c=CampService.getInstance().get_user_Camp(),camp=c.at(a.camp_type);if(camp.camp_level=a.camp_level,c.insert(a.camp_type,camp),a.bonus_type==BONUS_TYPE_GOLD?(bu.upd_UserGold(a.asset_amount),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):a.bonus_type==BONUS_TYPE_JADE&&(bu.upd_UserJade(a.asset_amount),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)),a.camp_type==CAMP_TYPE_COST)for(var i=1;i<=b;i++)bu.update_User_Troops_Cost(i,a.added_cost,0)}catch(e){}},bu.update_User_Troops_Cost=function(a,b,c){var d=map_user_troops.at(a),currCost=d.cost;d.cost=currCost+b-c,map_user_troops.insert(a,d)},bu.upd_User_Achievement_Bonus_Recevie=function(a){if(null!=map_achievement_list)for(var b=map_achievement_list.keys(),i=0;i<b.length;i++){var c=map_achievement_list.at(b[i]);if(c.achv_id==a.achv_bonus.achv_id){c.complete_count=a.achv_bonus.complete_count,c.next_id=a.achv_bonus.next_id,c.next_id_complete_yn=a.achv_bonus.next_id_complete_yn,c.bonus_complete_yn="y";var d=c.achv_id;map_achievement_list.insert(d,c),0!=a.achv_bonus.next_id&&bu.insert_Open_User_Achievement(a.achv_bonus.next_id,a.achv_bonus.complete_count,a.achv_bonus.next_id_complete_yn);break}}},bu.update_User_Event_Dungeon_Achv_Bonus=function(a){var m=MasterManager.getInstance();if(null!=_event_dungeon_achv_list){for(var b=!1,index=0,i=0;i<_event_dungeon_achv_list.achv_list.length;i++)if(a.event_dungeon_period_idx==_event_dungeon_achv_list.achv_list[i].event_dungeon_period_idx&&a.event_dungeon_achv_list_idx==_event_dungeon_achv_list.achv_list[i].event_dungeon_achv_list_idx){b=!0,index=i;break}if(b&&(_event_dungeon_achv_list.achv_list[index].bonus_complete_yn="y"),0!=a.next_achv_id){var c=m.get_EventDungeonAchvList(a.next_achv_id),new_achv={};new_achv.event_dungeon_achv_list_idx=a.next_achv_id,new_achv.event_dungeon_period_idx=a.event_dungeon_period_idx,new_achv.achv_type=c.achv_type,new_achv.new_yn="n",new_achv.complete_yn=a.next_achv_id_complete_yn,new_achv.complete_count=a.complete_count,new_achv.bonus_complete_yn=a.next_achv_id_bonus_complete_yn,_event_dungeon_achv_list.achv_list.push(new_achv)}}},bu.upd_User_Achievement_Bonus_Receive_All=function(a){var m=MasterManager.getInstance();if(null!=map_achievement_list)for(var b=map_achievement_list.keys(),i=0;i<b.length;i++)for(var c=map_achievement_list.at(b[i]),k=0;k<a.achv_bonus_list.length;k++)if(c.achv_id==a.achv_bonus_list[k].achv_id){c.complete_count=a.achv_bonus_list[k].complete_count,c.next_id=a.achv_bonus_list[k].next_id,c.next_id_complete_yn=a.achv_bonus_list[k].next_id_complete_yn,c.bonus_complete_yn="y",c.achv_type=a.achv_type;var d=c.achv_id;map_achievement_list.insert(d,c)}else{var e={};e.complete_count=a.achv_bonus_list[k].complete_count,e.next_id=a.achv_bonus_list[k].next_id,e.next_id_complete_yn=a.achv_bonus_list[k].next_id_complete_yn,e.bonus_complete_yn="y",e.achv_id=a.achv_bonus_list[k].achv_id,e.achv_type=a.achv_type;d=e.achv_id;map_achievement_list.insert(d,e)}for(k=0;k<a.achv_bonus_list.length;k++){var f=m.get_AchivementOccurCondition(a.achv_bonus_list[k].achv_id).achv_occur_type;0!=a.achv_bonus_list[k].next_id&&"n"==a.achv_bonus_list[k].next_id_complete_yn?bu.insert_Open_User_Achievement(a.achv_bonus_list[k].next_id,a.achv_bonus_list[k].complete_count,a.achv_bonus_list[k].next_id_complete_yn):0==a.achv_bonus_list[k].next_id&&1==f&&bu.insert_User_Last_Achievement_Complete(a.achv_bonus_list[k].achv_id,a.achv_bonus_list[k].complete_count)}},bu.insert_Open_User_Achievement=function(a,b,c){var d=MasterManager.getInstance().get_Achivement(a),item={};item.achv_id=a,item.complete_count=b,item.achv_type=d.achv_type,item.new_yn="n",item.complete_popup_yn="n",item.complete_yn=c,item.bonus_complete_yn="n",item.complete_count=b;var e=item.achv_id;map_achievement_list.insert(e,item)},bu.insert_User_Last_Achievement_Complete=function(a,b){var m=MasterManager.getInstance(),achv=m.get_Achivement(a),item=(m.get_AchivementCompleteCondition(a).count,{});item.achv_id=a,item.complete_count=b,item.achv_type=achv.achv_type,item.new_yn="n",item.complete_popup_yn="n",item.complete_yn="y",item.bonus_complete_yn="y",item.complete_count=b;var c=item.achv_id;map_achievement_list.insert(c,item)},bu.upd_User_Camp_Cost_Slot=function(a){bu.insert_User_Camp_Cost_Slot_ADD(a.cost_slot),a.bonus_type==BONUS_TYPE_GOLD?(bu.upd_UserGold(a.user_amount),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):a.bonus_type==BONUS_TYPE_JADE&&(bu.upd_UserJade(a.user_amount),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation))},bu.cancel_User_Camp_Branch_Ability=function(b){var c=b.branch_ability_id,m_camp_branch_ability_log=CampService.getInstance().getCamp_branch_ability_log(),branch_ability=m_camp_branch_ability_log.find(function(a){if(a.ability_id==c)return!0}),branch_Index=m_camp_branch_ability_log.findIndex(function(a){if(a.ability_id==c)return!0});-1!=branch_Index&&m_camp_branch_ability_log.splice(branch_Index,1);for(var d=0;d<branch_ability.gnrl_keys.length;d++){var e={};if(e.gnrl_id=branch_ability.gnrl_keys[d].gnrl_id,e.gnrl_num=branch_ability.gnrl_keys[d].gnrl_num,0<e.gnrl_id){var f=map_User_General.at([e.gnrl_id,e.gnrl_num]);null!=f&&(f.using_in_camp="n")}}},bu.upd_User_Camp_Branch_Ability=function(a){$.extend({},a),a.complete_dt=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME))+1e3*a.remain_second,CampService.getInstance().getCamp_branch_ability_log().push(a);for(var b=0;b<a.gnrl_keys.length;b++){var c=a.gnrl_keys[b];if(null==c.gnrl_id)break;0<c.gnrl_id&&(map_User_General.at([c.gnrl_id,c.gnrl_num]).using_in_camp="y")}bu.update_user_Generals()},bu.upd_Shoten_Time_User_Camp_Branch_Ability=function(a){for(var b=CampService.getInstance().getCamp_branch_ability_log(),idx=0;idx<b.length;idx++){(c=b[idx]).ability_id==a.branch_ability_id&&(c.complete_yn=a.complete_yn,c.remain_second=a.remain_second,c.complete_dt=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME))+1e3*c.remain_second,b[idx]=c)}if(bu.upd_UserJade(a.user_amount),"y"==a.complete_yn){for(idx=0;idx<b.length;idx++){var c;if((c=b[idx]).ability_id==a.branch_ability_id){var d={};null!=c.gnrl_keys[0]&&(d.gnrl_id=c.gnrl_keys[0].gnrl_id,d.gnrl_num=c.gnrl_keys[0].gnrl_num,0<d.gnrl_id&&map_User_General.remove([d.gnrl_id,d.gnrl_num]));d={};if(null!=c.gnrl_keys[1]&&(d.gnrl_id=c.gnrl_keys[1].gnrl_id,d.gnrl_num=c.gnrl_keys[1].gnrl_num,0<d.gnrl_id&&map_User_General.remove([d.gnrl_id,d.gnrl_num])),null!=c.gnrl_keys[2])(d={}).gnrl_id=c.gnrl_keys[2].gnrl_id,d.gnrl_num=c.gnrl_keys[2].gnrl_num,0<d.gnrl_id&&map_User_General.remove([d.gnrl_id,d.gnrl_num]);if(null!=c.gnrl_keys[3])(d={}).gnrl_id=c.gnrl_keys[3].gnrl_id,d.gnrl_num=c.gnrl_keys[3].gnrl_num,0<d.gnrl_id&&map_User_General.remove([d.gnrl_id,d.gnrl_num])}}bu.update_user_Generals(),"y"==a.complete_yn&&(bu.delete_User_Camp_Branch_Ability(),bu.insert_User_Camp_Branch_Ability(a.branch_ability))}},bu.remove_user_generals=function(a){for(var b=0;b<a.length;b++)bu.remove_User_General(a[b]);bu.update_user_Generals()},bu.update_user_Generals=function(){},bu.upd_Main_Mission_Battle_Begin_V2=function(a){var m=MasterManager.getInstance(),mission=$.extend({},database.MainMission);mission=m.get_MainMission(a.mission_id);UserService.getInstance();bu.upd_User_Key(a.user_key);for(var b=0,user_main_story=bu.get_User_main_story(),keys=user_main_story.keys(),i=0;i<keys.length;i++)user_main_story.at(keys[i]).main_story_id==mission.main_story_id&&user_main_story.at(keys[i]).difficulty_type==mission.difficulty_type&&user_main_story.at(keys[i]).main_scene_id==mission.main_scene_id&&(b+=1);if(0==b){var c=mission.main_scene_id+""+mission.main_story_id+mission.difficulty_type;mission.new_yn="n",mission.complete_yn="n",User_main_story.insert(c,mission)}b=0;for(var d=map_user_main_mission.length,uidx=0;uidx<d;uidx++)map_user_main_mission[uidx].main_mission_id==a.mission_id&&(b+=1);if(0==b){var e={main_mission_id:a.mission_id,new_yn:"y",complete_yn:"n",win_count:1};map_user_main_mission.push($.extend({},e)),e=null}bu.upd_UserHeart(a.user_heart)},bu.update_User_General_Level_Up=function(a,b,c){map_User_General.at([a.gnrl_id,a.gnrl_num]).gnrl_level=b,map_User_General.at([a.gnrl_id,a.gnrl_num]).gnrl_exp=c},bu.upd_User_Mail_Reward_Receive=function(c){for(var d=[],i=0;i<list_User_Mail.size();i++)list_User_Mail.at(i).mail_num==c.num&&d.push(i);for(i=0;i<d.length;i++)list_User_Mail.erase(d[i]);if(c.bonus_type==BONUS_TYPE_NORMAL_YUNHEE||c.bonus_type==BONUS_TYPE_HIGH_YUNHEE||c.bonus_type==BONUS_TYPE_HN_RARE_TYPE_SELECT||c.bonus_type==BONUS_TYPE_R_RARE_TYPE_SELECT||c.bonus_type==BONUS_TYPE_HR_RARE_TYPE_SELECT||c.bonus_type==BONUS_TYPE_SR_RARE_TYPE_SELECT||c.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||c.bonus_type==BONUS_TYPE_R_RARE_TYPE_ENGAGE||c.bonus_type==BONUS_TYPE_HR_RARE_TYPE_ENGAGE||c.bonus_type==BONUS_TYPE_SR_RARE_TYPE_ENGAGE||c.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_SELECT||c.bonus_type==BONUS_TYPE_JIN_FIX||c.bonus_type==BONUS_TYPE_YUNHEE_FIX||c.bonus_type==BONUS_TYPE_HIGH_ENGAGE_TEN||c.bonus_type==BONUS_TYPE_NORMAL_ENGAGE_TEN||c.bonus_type==BONUS_TYPE_HIGH_ENGAGE||c.bonus_type==BONUS_TYPE_NORMAL_ENGAGE||c.bonus_type==BONUS_TYPE_HIGH_ENGAGE_ARMY||c.bonus_type==BONUS_TYPE_HIGH_ENGAGE_TEN_ARMY||c.bonus_type==BONUS_TYPE_NORMAL_ENGAGE_ARMY||c.bonus_type==BONUS_TYPE_NORMAL_ENGAGE_TEN_ARMY||c.bonus_type==BONUS_TYPE_CHOCK_SELECT||c.bonus_type==BONUS_TYPE_WIE_SELECT||c.bonus_type==BONUS_TYPE_OH_SELECT||c.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT||c.bonus_type==BONUS_TYPE_JIN_5_CLASS_SELECT||c.bonus_type==BONUS_TYPE_HIGH_ENGAGE_SECOND_HALF||c.bonus_type==BONUS_TYPE_SR_OVER_GACHA_TICKET||c.bonus_type==BONUS_TYPE_SSR_GACHA_TICKET||c.bonus_type==BONUS_TYPE_MILEAGE_GACHA_TICKET_1||c.bonus_type==BONUS_TYPE_MILEAGE_GACHA_TICKET_2||c.bonus_type==BONUS_TYPE_MILEAGE_GACHA_TICKET_3||c.bonus_type==BONUS_TYPE_MILEAGE_GACHA_TICKET_4||c.bonus_type==BONUS_TYPE_MILEAGE_GACHA_TICKET_5||c.bonus_type==BONUS_TYPE_MILEAGE_GACHA_TICKET_10||c.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_NEW_YEAR_SELECT||c.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_NEW_YEAR_GACHA_TICKET||c.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_SELECT_NEW_RETURN_USER||c.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_SELECT_JAPAN_BATTLE||c.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_GACHA_REBORN_GNRL_TICKET||c.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_GACHA_2019_NEW_YEARS_TICKET||c.bonus_type==BONUS_TYPE_ALL_RARE_TYPE_GNRL_SELECT_TICKET||c.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET||c.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET_V2||c.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET||c.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_2||c.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_3||c.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_4||c.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_5||c.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_6||c.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_7||c.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_8||c.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_9||c.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_10)bu.insert_User_General(c.bonus_key),bu.insert_User_Book_General(c.bonus_key);else if(c.bonus_type==BONUS_TYPE_ILLUSTRATE_TICKET)bu.insert_User_Illust(c.bonus_key);else if(c.bonus_type==BONUS_TYPE_YUNHEE_SLOT_TICKET)this.update_User_Yunhee_Bound(c.bonus_key[0].count);else if(c.bonus_type==BONUS_TYPE_EQUIPMENT_SLOT_TICKET)this.update_User_Equipment_Bound(c.bonus_key[0].count);else if(c.bonus_type==BONUS_TYPE_TEST_LIMIT_STEP_1_ALL_BOX||c.bonus_type==BONUS_TYPE_TEST_LIMIT_STEP_2_ALL_BOX||c.bonus_type==BONUS_TYPE_TEST_LIMIT_STEP_3_ALL_BOX||c.bonus_type==BONUS_TYPE_TEST_LIMIT_STEP_4_ALL_BOX||c.bonus_type==BONUS_TYPE_TEST_LIMIT_STEP_5_ALL_BOX)this.insert_User_General(c.bonus_key),this.update_User_General_Limit_Step(c.bonus_type,c.bonus_key);else if(c.bonus_type==BONUS_TYPE_EVENT_DUNGEON_LOVE_SETTING_YUNHEE)this.insert_User_General_Love_Setting(c);else if(c.bonus_type==BONUS_TYPE_EXP_BOOSTER)_exp_booster_item.booster_id=c.bonus_key[0].key_id,_exp_booster_item.exp_inc=c.bonus_key[0].key_num,_exp_booster_item.remain_dt=c.bonus_key[0].count,_exp_booster_item.enabled_yn="y";else if(c.bonus_type==BONUS_TYPE_LOVE_ITEM||c.bonus_type==BONUS_TYPE_LOVE_ITEM_MELEE||c.bonus_type==BONUS_TYPE_LOVE_ITEM_LANCER||c.bonus_type==BONUS_TYPE_LOVE_ITEM_RANGER||c.bonus_type==BONUS_TYPE_LOVE_ITEM_CAKE||c.bonus_type==BONUS_TYPE_YUBI_LOVE_ITEM||c.bonus_type==BONUS_TYPE_CHRISTMAS_LOVE_ITEM||c.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE||c.bonus_type==BONUS_TYPE_WHITE_CHOCO||c.bonus_type==BONUS_TYPE_COMEBACK_CAKE||c.bonus_type==BONUS_TYPE_LOVE_MAX_CAKE||c.bonus_type>=BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_01&&c.bonus_type<=BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_10)bu.plus_User_Love_Item(c.bonus_key[0].key_id,c.bonus_count);else if(c.bonus_type==BONUS_TYPE_LOVE_ITEM_VD_COCHOLATE_A||c.bonus_type==BONUS_TYPE_LOVE_ITEM_VD_COCHOLATE_B||c.bonus_type==BONUS_TYPE_LOVE_ITEM_PARTNER_COCHOLATE){var f=GeneralService.getInstance().getBonusTypeToLoveId(c.bonus_key[0].key_bonus_type);bu.plus_User_Love_Item(f,c.bonus_count,c.bonus_key[0].key_id)}else if(c.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||c.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL)bu.plus_User_Limit_Over_Mtrl(c.bonus_key[0].key_id,c.bonus_count);else if(c.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL)bu.plus_User_Magic_Key_Mtrl(c.bonus_count);else if(c.bonus_type==BONUS_TYPE_RAID_POINT)bu.plus_User_Raid_Point(c.bonus_key[0].key_id,c.bonus_count);else if(c.bonus_type==BONUS_TYPE_CRAFT_SHOP_FIRST_LOW||c.bonus_type==BONUS_TYPE_CRAFT_SHOP_FIRST_MIDDLE||c.bonus_type==BONUS_TYPE_CRAFT_SHOP_FIRST_HIGH||c.bonus_type==BONUS_TYPE_CRAFT_SHOP_FIRST_UNIQUE||c.bonus_type==BONUS_TYPE_CRAFT_SHOP_SECOND_MIDDLE||c.bonus_type==BONUS_TYPE_CRAFT_SHOP_SECOND_HIGH||c.bonus_type==BONUS_TYPE_CRAFT_SHOP_SECOND_UNIQUE||c.bonus_type==BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND||c.bonus_type==BONUS_TYPE_CHRISTMAS_RIBBON||c.bonus_type==BONUS_TYPE_CHRISTMAS_STAR||c.bonus_type==BONUS_TYPE_CHRISTMAS_BALL||c.bonus_type==BONUS_TYPE_CHRISTMAS_BELL||c.bonus_type==BONUS_TYPE_CHRISTMAS_ANGEL||c.bonus_type==BONUS_TYPE_CHRISTMAS_LOLLIPOPS||c.bonus_type==BONUS_TYPE_CHRISTMAS_COOKIE||c.bonus_type==BONUS_TYPE_CHRISTMAS_SOCKS||c.bonus_type==BONUS_TYPE_CHRISTMAS_TREE||c.bonus_type==BONUS_TYPE_CHRISTMAS_APPLE){var g=GeneralService.getInstance().getBonusTypeToCraftShopMtrlType(c.bonus_type);bu.plus_User_Craft_Shop_Material(g,c.bonus_count)}else if(c.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||c.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||c.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||c.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||c.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||c.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||c.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||c.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||c.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||c.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||c.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||c.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||c.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){var h=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(c.bonus_type);bu.plus_User_Rebirth_Mtrl(h,c.bonus_count)}else if(c.bonus_type==BONUS_TYPE_CHRISTMAS_GACHA_TICKET_BOX)bu.update_User_Gacha_Ticket(c.key_id,c.bonus_count);else if(c.bonus_type==BONUS_TYPE_CHRISTMAS_GIFT_BOX||c.bonus_type==BONUS_TYPE_RETURN_USER_GIFT_BOX||c.bonus_type==BONUS_TYPE_CHRISTMAS_LOGIN_GIFT_BOX||c.bonus_type==BONUS_TYPE_JADE_RANDOM_BOX||c.bonus_type==BONUS_TYPE_GOLD_RANDOM_BOX||c.bonus_type==BONUS_TYPE_LOVE_ITEM_RANDOM_BOX||c.bonus_type==BONUS_TYPE_RARE_HWANDAN_RANDOM_BOX||c.bonus_type==BONUS_TYPE_EXP_CARD_RANDOM_BOX||c.bonus_type==BONUS_TYPE_SWORD_ORB_RANDDOM_BOX||c.bonus_type==BONUS_TYPE_SPEAR_ORB_RANDDOM_BOX||c.bonus_type==BONUS_TYPE_ARCHER_ORB_RANDDOM_BOX||c.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_RANDOM_BOX||c.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_GIFT_BOX||c.bonus_type==BONUS_TYPE_EXP_SET_HIGH||c.bonus_type==BONUS_TYPE_EVOLVE_MTRL_SET||c.bonus_type==BONUS_TYPE_TEST_BOX||c.bonus_type==BONUS_TYPE_TEST_SOLDIER_0_BOX||c.bonus_type==BONUS_TYPE_TEST_SOLDIER_1_BOX||c.bonus_type==BONUS_TYPE_TEST_SOLDIER_2_BOX||c.bonus_type==BONUS_TYPE_TEST_YUNHEE_0_BOX||c.bonus_type==BONUS_TYPE_TEST_YUNHEE_1_BOX||c.bonus_type==BONUS_TYPE_TEST_YUNHEE_2_BOX||c.bonus_type==BONUS_TYPE_TEST_SR_LIMIT_OVER_BOX||c.bonus_type==BONUS_TYPE_TEST_SSR_LIMIT_OVER_BOX||c.bonus_type==BONUS_TYPE_TREASURE_BOX||c.bonus_type==BONUS_TYPE_EVENTDUNGEON_PRESENT_GIFT_BOX||c.bonus_type==BONUS_TYPE_TEST_MELEE_BOX||c.bonus_type==BONUS_TYPE_TEST_LANCER_BOX||c.bonus_type==BONUS_TYPE_TEST_ARCHER_BOX||c.bonus_type==BONUS_TYPE_CHRISTMAS_BOX||c.bonus_type==BONUS_TYPE_SONKWON_EVOLUTION1_BOX||c.bonus_type==BONUS_TYPE_SONKWON_EVOLUTION2_BOX||c.bonus_type==BONUS_TYPE_GOLDEN_BOX||c.bonus_type==BONUS_TYPE_SILVER_BOX||c.bonus_type==BONUS_TYPE_CHRISTMAS_BOX_v2||c.bonus_type==BONUS_TYPE_CHRISTMAS_BOX_V3)for(i=0;i<c.bonus_key.length;i++)if(c.bonus_key[i].key_bonus_type==BONUS_TYPE_YUNHEE_FIX){var j={};j.gnrl_id=c.bonus_key[i].key_id,j.gnrl_num=c.bonus_key[i].key_num,j.castle_id=c.bonus_key[i].key_castle_id,j.gnrl_exp=0,j.gnrl_level=1,j.love_level=1,bu.insert_User_General_V2(j)}else if(c.bonus_key[i].key_bonus_type==BONUS_TYPE_LOVE_ITEM||c.bonus_key[i].key_bonus_type==BONUS_TYPE_LOVE_ITEM_MELEE||c.bonus_key[i].key_bonus_type==BONUS_TYPE_LOVE_ITEM_LANCER||c.bonus_key[i].key_bonus_type==BONUS_TYPE_LOVE_ITEM_RANGER||c.bonus_key[i].key_bonus_type==BONUS_TYPE_LOVE_ITEM_CAKE||c.bonus_key[i].key_bonus_type==BONUS_TYPE_YUBI_LOVE_ITEM||c.bonus_key[i].key_bonus_type==BONUS_TYPE_CHRISTMAS_LOVE_ITEM||c.bonus_key[i].key_bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE||c.bonus_key[i].key_bonus_type==BONUS_TYPE_WHITE_CHOCO||c.bonus_key[i].key_bonus_type==BONUS_TYPE_COMEBACK_CAKE||c.bonus_key[i].key_bonus_type==BONUS_TYPE_LOVE_MAX_CAKE||c.bonus_key[i].key_bonus_type>=BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_01&&c.bonus_key[i].key_bonus_type<=BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_10)bu.plus_User_Love_Item(c.bonus_key[i].key_id,c.bonus_key[i].count);else if(c.bonus_key[i].key_bonus_type==BONUS_TYPE_EVOLVE_MELEE_MIDDLE||c.bonus_key[i].key_bonus_type==BONUS_TYPE_EVOLVE_LANCER_MIDDLE||c.bonus_key[i].key_bonus_type==BONUS_TYPE_EVOLVE_ARCHER_MIDDLE||c.bonus_key[i].key_bonus_type==BONUS_TYPE_EVOLVE_MELEE_LOW||c.bonus_key[i].key_bonus_type==BONUS_TYPE_EVOLVE_LANCER_LOW||c.bonus_key[i].key_bonus_type==BONUS_TYPE_EVOLVE_ARCHER_LOW||c.bonus_key[i].key_bonus_type==BONUS_TYPE_EVOLVE_MELEE||c.bonus_key[i].key_bonus_type==BONUS_TYPE_EVOLVE_LANCER||c.bonus_key[i].key_bonus_type==BONUS_TYPE_EVOLVE_ARCHER)bu.plus_User_Evolve_Arm_Service(c.bonus_key[i].key_bonus_type,c.bonus_key[i].count);else if(i.key_bonus_type==BONUS_TYPE_ATTK_POINT||i.key_bonus_type==BONUS_TYPE_DEF_POINT||i.key_bonus_type==BONUS_TYPE_HP_POINT||i.key_bonus_type==BONUS_TYPE_CRI_PRCNT_POINT||i.key_bonus_type==BONUS_TYPE_CRI_DMG_POINT)bu.plus_User_Formation_Property_Point(c.bonus_key[i].key_bonus_type,c.bonus_key[i].count);else if(i.key_bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||i.key_bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL){var k=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(i.key_bonus_type);bu.plus_User_Limit_Over_Mtrl(k,c.bonus_key[i].count)}else if(c.bonus_key[i].key_bonus_type==BONUS_TYPE_RARE_HWANDAN_RANDOM_BOX)bu.plus_User_Hwandan(c.bonus_key[i].key_bonus_type,c.bonus_key[i].count);else if(c.bonus_key[i].key_bonus_type==BONUS_TYPE_EQUIPMENT){MasterManager.getInstance().get_EquipmentItem(c.bonus_key[i].key_id).equipment_type,EQUIPMENT_TYPE_EXP;var e={};e.equipment_item_idx=c.bonus_key[i].key_id,e.equipment_num=c.bonus_key[i].key_num,e.level=1,e.exp=0,e.arm_service_type=ARMSERVICETYPE_NONE,e.step=0,e.combo_stat=2,e.stat_value=1,e.option_num1=0,e.option_num2=0,e.option_num3=0,e.option_num4=0,e.option_num5=0,e.equip_yn="n",e.lock_yn="n",e.activity_type=1,e.base_stat_level_id=c.bonus_key[i].key_id,bu.insert_User_Equipment(e)}else bu.insert_User_Mail_Item(c.bonus_key[i].key_bonus_type,c.bonus_key[i].count);else if(c.bonus_type==BONUS_TYPE_CHRISTMAS_SANTA||c.bonus_type==BONUS_TYPE_CHRISTMAS_REINDEER||c.bonus_type==BONUS_TYPE_CHRISTMAS_SNOWMAN)bu.update_User_Christmas_Reward(c.bonus_type,c.bonus_count,c.key_id);else if(c.bonus_type==BONUS_TYPE_EQUIPMENT||c.bonus_type>=BONUS_TYPE_EQUIPMENT_EXP_BOX_1&&c.bonus_type<=BONUS_TYPE_EQUIPMENT_EXP_BOX_4){var l=MasterManager.getInstance();c.bonus_key.forEach(function(a){l.get_EquipmentItem(a.key_id).equipment_type,EQUIPMENT_TYPE_EXP;var b={};b.equipment_item_idx=a.key_id,b.equipment_num=a.key_num,b.level=1,b.exp=0,b.arm_service_type=ARMSERVICETYPE_NONE,b.step=0,b.combo_stat=2,b.stat_value=1,b.option_num1=0,b.option_num2=0,b.option_num3=0,b.option_num4=0,b.option_num5=0,b.equip_yn="n",b.lock_yn="n",b.activity_type=1,b.base_stat_level_id=a.key_id,bu.insert_User_Equipment(b)})}else c.bonus_type==BONUS_TYPE_WORLD_WAR_MEDAL?NetServiceV3.getInstance().plus_World_War_Medal(c.bonus_count):c.bonus_type==BONUS_TYPE_WORLD_WAR_UNIQUE_EQUIPMENT_TICKET?NetServiceV3.getInstance().plus_Unique_Equipment_Ticket(c.bonus_count):c.bonus_type==BONUS_TYPE_SKIP_TICKET?bu.plus_User_Skip_Ticket(c.bonus_count):c.bonus_type==BONUS_TYPE_EXCHANGE_TICKET?bu.plus_User_Exchange_Ticket(c.bonus_count):c.bonus_type==BONUS_TYPE_SPECIAL_GACHA_TICKET?bu.plus_User_Special_Gacha_Ticket(c.key_id,c.bonus_count):bu.insert_User_Mail_Item(c.bonus_type,c.bonus_count);var m=GameContext.getInstance();0<list_User_Mail.size()?m.setUserNewMail("y"):m.setUserNewMail("n")},bu.insert_User_Mail_Item=function(a,b,c,d){switch(a){case BONUS_TYPE_GOLD:bu.plus_User_Gold(b);break;case BONUS_TYPE_KEY:case BONUS_TYPE_KEY_REFILL:bu.plus_User_Key(b);break;case BONUS_TYPE_RAID_TICKET:case BONUS_TYPE_RAID_TICKET_REFILL:bu.plus_User_Raid_Ticket(b);break;case BONUS_TYPE_RAID_HELP_TICKET:bu.plus_User_Raid_Help_Ticket(b);break;case BONUS_TYPE_HEART:bu.plus_User_Heart(b);break;case BONUS_TYPE_JADE:bu.plus_User_Jade(b);break;case BONUS_TYPE_HWANDAN_1:case BONUS_TYPE_HWANDAN_2:case BONUS_TYPE_HWANDAN_3:case BONUS_TYPE_HWANDAN_4:case BONUS_TYPE_HWANDAN_5:case BONUS_TYPE_HWANDAN_6:case BONUS_TYPE_HWANDAN_7:case BONUS_TYPE_YUBI_RARE:bu.plus_User_Hwandan(a,b);break;case BONUS_TYPE_UNIFICATION_FOOD:break;case BONUS_TYPE_EVOLVE_STONE:bu.plus_User_Evolve_Stone(b);break;case BONUS_TYPE_YUNHEE_PT:bu.plus_User_Yunhee_PT(b);break;case BONUS_TYPE_HEAVEN_PT:bu.plus_User_Heaven_PT(b);break;case BONUS_TYPE_EVOLVE_MELEE:case BONUS_TYPE_EVOLVE_LANCER:case BONUS_TYPE_EVOLVE_ARCHER:case BONUS_TYPE_EVOLVE_MELEE_MIDDLE:case BONUS_TYPE_EVOLVE_LANCER_MIDDLE:case BONUS_TYPE_EVOLVE_ARCHER_MIDDLE:case BONUS_TYPE_EVOLVE_MELEE_LOW:case BONUS_TYPE_EVOLVE_LANCER_LOW:case BONUS_TYPE_EVOLVE_ARCHER_LOW:case BONUS_TYPE_YUBI_EVOLVE_HIGH:case BONUS_TYPE_YUBI_EVOLVE_MIDDLE:case BONUS_TYPE_YUBI_EVOLVE_LOW:bu.plus_User_Evolve_Arm_Service(a,b);break;case BONUS_TYPE_ATTK_POINT:case BONUS_TYPE_DEF_POINT:case BONUS_TYPE_HP_POINT:case BONUS_TYPE_CRI_PRCNT_POINT:case BONUS_TYPE_CRI_DMG_POINT:bu.plus_User_Formation_Property_Point(a,b);break;case BONUS_TYPE_EVOLVE_ORB:bu.plus_User_Evolve_Orb(b);break;case BONUS_TYPE_FORMATION_POINT:bu.plus_User_Formation_Point(b);break;case BONUS_TYPE_KEY_REFILL:bu.plus_User_Key(b);break;case BONUS_TYPE_TICKET_REFILL:break;case BONUS_TYPE_CRAFT_SHOP_FIRST_LOW:case BONUS_TYPE_CRAFT_SHOP_FIRST_MIDDLE:case BONUS_TYPE_CRAFT_SHOP_FIRST_HIGH:case BONUS_TYPE_CRAFT_SHOP_FIRST_UNIQUE:case BONUS_TYPE_CRAFT_SHOP_SECOND_MIDDLE:case BONUS_TYPE_CRAFT_SHOP_SECOND_HIGH:case BONUS_TYPE_CRAFT_SHOP_SECOND_UNIQUE:case BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND:case BONUS_TYPE_CHRISTMAS_RIBBON:case BONUS_TYPE_CHRISTMAS_STAR:case BONUS_TYPE_CHRISTMAS_BALL:case BONUS_TYPE_CHRISTMAS_BELL:case BONUS_TYPE_CHRISTMAS_ANGEL:case BONUS_TYPE_CHRISTMAS_LOLLIPOPS:case BONUS_TYPE_CHRISTMAS_COOKIE:case BONUS_TYPE_CHRISTMAS_SOCKS:case BONUS_TYPE_CHRISTMAS_TREE:case BONUS_TYPE_CHRISTMAS_APPLE:var e=GeneralService.getInstance().getBonusTypeToCraftShopMtrlType(a);bu.plus_User_Craft_Shop_Material(e,b);break;case BONUS_TYPE_REBIRTH_MTRL_TYPE_1:case BONUS_TYPE_REBIRTH_MTRL_TYPE_2:case BONUS_TYPE_REBIRTH_MTRL_TYPE_3:case BONUS_TYPE_REBIRTH_MTRL_TYPE_4:case BONUS_TYPE_REBIRTH_MTRL_TYPE_5:case BONUS_TYPE_REBIRTH_MTRL_TYPE_6:case BONUS_TYPE_REBIRTH_MTRL_TYPE_7:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6:var f=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(a);bu.plus_User_Rebirth_Mtrl(f,b);break;case BONUS_TYPE_RAID_POINT:bu.plus_User_Raid_Point(c,b);break;case BONUS_TYPE_MAGIC_KEY_MTRL:bu.plus_User_Magic_Key_Mtrl(b);break;case BONUS_TYPE_RAID_HELP_TICKET_REFILL:bu.plus_User_Raid_Help_Ticket(b);break;case BONUS_TYPE_GREAT_WALL_TICKET_REFILL:case BONUS_TYPE_GREAT_WALL_TICKET:bu.plus_User_Great_Wall_Ticket(b);break;case BONUS_TYPE_WORLD_WAR_TICKET_REFILL:bu.plus_User_World_War_Ticket(b);break;case BONUS_TYPE_JADE_PIECE:bu.plus_User_Jade_Piece(b);break;case BONUS_TYPE_SKIP_TICKET:bu.plus_User_Skip_Ticket(b);break;case BONUS_TYPE_EXCHANGE_TICKET:bu.plus_User_Exchange_Ticket(b);break;case BONUS_TYPE_SPECIAL_GACHA_TICKET:bu.plus_User_Special_Gacha_Ticket(c,b)}MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)},bu.upd_User_Mail_All_Reward_Receive=function(c){for(var d=GameContext.getInstance(),i=0;i<c.success_reward_list.length;i++)switch(c.success_reward_list[i].bonus_type){case BONUS_TYPE_GOLD:bu.plus_User_Gold(c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_JADE_PIECE:bu.plus_User_Jade_Piece(c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_WORLD_WAR_MEDAL:NetServiceV3.getInstance().plus_World_War_Medal(c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_WORLD_WAR_TICKET_REFILL:bu.plus_User_World_War_Ticket(c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_WORLD_WAR_UNIQUE_EQUIPMENT_TICKET:NetServiceV3.getInstance().plus_Unique_Equipment_Ticket(c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_SKIP_TICKET:bu.plus_User_Skip_Ticket(c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_EXCHANGE_TICKET:bu.plus_User_Exchange_Ticket(c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_SPECIAL_GACHA_TICKET:bu.plus_User_Special_Gacha_Ticket(c.success_reward_list[i].bonus_key[0].key_id,c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_KEY:bu.plus_User_Key(c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_RAID_TICKET:bu.plus_User_Raid_Ticket(c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_RAID_HELP_TICKET:bu.plus_User_Raid_Help_Ticket(c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_HEART:bu.plus_User_Heart(c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_JADE:bu.plus_User_Jade(c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_HWANDAN_1:case BONUS_TYPE_HWANDAN_2:case BONUS_TYPE_HWANDAN_3:case BONUS_TYPE_HWANDAN_4:case BONUS_TYPE_HWANDAN_5:case BONUS_TYPE_HWANDAN_6:case BONUS_TYPE_HWANDAN_7:case BONUS_TYPE_YUBI_RARE:bu.plus_User_Hwandan(c.success_reward_list[i].bonus_type,c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_EVOLVE_STONE:bu.plus_User_Evolve_Stone(c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_YUNHEE_PT:bu.plus_User_Yunhee_PT(c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_HEAVEN_PT:bu.plus_User_Heaven_PT(c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_EVOLVE_MELEE:case BONUS_TYPE_EVOLVE_LANCER:case BONUS_TYPE_EVOLVE_ARCHER:case BONUS_TYPE_EVOLVE_MELEE_MIDDLE:case BONUS_TYPE_EVOLVE_LANCER_MIDDLE:case BONUS_TYPE_EVOLVE_ARCHER_MIDDLE:case BONUS_TYPE_EVOLVE_MELEE_LOW:case BONUS_TYPE_EVOLVE_LANCER_LOW:case BONUS_TYPE_EVOLVE_ARCHER_LOW:case BONUS_TYPE_YUBI_EVOLVE_HIGH:case BONUS_TYPE_YUBI_EVOLVE_MIDDLE:case BONUS_TYPE_YUBI_EVOLVE_LOW:bu.plus_User_Evolve_Arm_Service(c.success_reward_list[i].bonus_type,c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_CRAFT_SHOP_FIRST_LOW:case BONUS_TYPE_CRAFT_SHOP_FIRST_MIDDLE:case BONUS_TYPE_CRAFT_SHOP_FIRST_HIGH:case BONUS_TYPE_CRAFT_SHOP_FIRST_UNIQUE:case BONUS_TYPE_CRAFT_SHOP_SECOND_MIDDLE:case BONUS_TYPE_CRAFT_SHOP_SECOND_HIGH:case BONUS_TYPE_CRAFT_SHOP_SECOND_UNIQUE:case BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND:case BONUS_TYPE_CHRISTMAS_RIBBON:case BONUS_TYPE_CHRISTMAS_STAR:case BONUS_TYPE_CHRISTMAS_BALL:case BONUS_TYPE_CHRISTMAS_BELL:case BONUS_TYPE_CHRISTMAS_ANGEL:case BONUS_TYPE_CHRISTMAS_LOLLIPOPS:case BONUS_TYPE_CHRISTMAS_COOKIE:case BONUS_TYPE_CHRISTMAS_SOCKS:case BONUS_TYPE_CHRISTMAS_TREE:case BONUS_TYPE_CHRISTMAS_APPLE:var e=GeneralService.getInstance().getBonusTypeToCraftShopMtrlType(c.success_reward_list[i].bonus_type);bu.plus_User_Craft_Shop_Material(e,c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_REBIRTH_MTRL_TYPE_1:case BONUS_TYPE_REBIRTH_MTRL_TYPE_2:case BONUS_TYPE_REBIRTH_MTRL_TYPE_3:case BONUS_TYPE_REBIRTH_MTRL_TYPE_4:case BONUS_TYPE_REBIRTH_MTRL_TYPE_5:case BONUS_TYPE_REBIRTH_MTRL_TYPE_6:case BONUS_TYPE_REBIRTH_MTRL_TYPE_7:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6:var f=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(c.success_reward_list[i].bonus_type);bu.plus_User_Rebirth_Mtrl(f,c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_ATTK_POINT:case BONUS_TYPE_DEF_POINT:case BONUS_TYPE_HP_POINT:case BONUS_TYPE_CRI_PRCNT_POINT:case BONUS_TYPE_CRI_DMG_POINT:bu.plus_User_Formation_Property_Point(c.success_reward_list[i].bonus_type,c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_EVOLVE_ORB:bu.plus_User_Evolve_Orb(c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_UNIFICATION_FOOD:break;case BONUS_TYPE_NORMAL_YUNHEE:case BONUS_TYPE_HIGH_YUNHEE:case BONUS_TYPE_HN_RARE_TYPE_SELECT:case BONUS_TYPE_R_RARE_TYPE_SELECT:case BONUS_TYPE_HR_RARE_TYPE_SELECT:case BONUS_TYPE_SR_RARE_TYPE_SELECT:case BONUS_TYPE_HN_RARE_TYPE_ENGAGE:case BONUS_TYPE_R_RARE_TYPE_ENGAGE:case BONUS_TYPE_HR_RARE_TYPE_ENGAGE:case BONUS_TYPE_SR_RARE_TYPE_ENGAGE:case BONUS_TYPE_SSR_RARE_TYPE_SELECT:case BONUS_TYPE_JIN_FIX:case BONUS_TYPE_YUNHEE_FIX:case BONUS_TYPE_HIGH_ENGAGE_TEN:case BONUS_TYPE_NORMAL_ENGAGE_TEN:case BONUS_TYPE_HIGH_ENGAGE:case BONUS_TYPE_NORMAL_ENGAGE:case BONUS_TYPE_HIGH_ENGAGE_ARMY:case BONUS_TYPE_HIGH_ENGAGE_TEN_ARMY:case BONUS_TYPE_NORMAL_ENGAGE_ARMY:case BONUS_TYPE_NORMAL_ENGAGE_TEN_ARMY:case BONUS_TYPE_CHOCK_SELECT:case BONUS_TYPE_WIE_SELECT:case BONUS_TYPE_OH_SELECT:case BONUS_TYPE_WIE_CHOCK_OH_SELECT:case BONUS_TYPE_JIN_5_CLASS_SELECT:case BONUS_TYPE_HIGH_ENGAGE_SECOND_HALF:case BONUS_TYPE_MILEAGE_GACHA_TICKET_1:case BONUS_TYPE_MILEAGE_GACHA_TICKET_2:case BONUS_TYPE_MILEAGE_GACHA_TICKET_3:case BONUS_TYPE_MILEAGE_GACHA_TICKET_4:case BONUS_TYPE_MILEAGE_GACHA_TICKET_5:case BONUS_TYPE_MILEAGE_GACHA_TICKET_10:case BONUS_TYPE_COMEBACK_GACHA_TICKET:case BONUS_TYPE_SR_OVER_GACHA_TICKET:case BONUS_TYPE_SSR_GACHA_TICKET:case BONUS_TYPE_SSR_RARE_TYPE_NEW_YEAR_SELECT:case BONUS_TYPE_SSR_RARE_TYPE_NEW_YEAR_GACHA_TICKET:case BONUS_TYPE_SSR_RARE_TYPE_GACHA_REBORN_GNRL_TICKET:case BONUS_TYPE_SSR_RARE_TYPE_GACHA_2019_NEW_YEARS_TICKET:case BONUS_TYPE_ALL_RARE_TYPE_GNRL_SELECT_TICKET:case BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET:case BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET_V2:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_2:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_3:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_4:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_5:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_6:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_7:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_8:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_9:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_10:bu.insert_User_General(c.success_reward_list[i].bonus_key),bu.insert_User_Book_General(c.success_reward_list[i].bonus_key);break;case BONUS_TYPE_ILLUSTRATE_TICKET:bu.insert_User_Illust(c.bonus_key);break;case BONUS_TYPE_EXP_BOOSTER:_exp_booster_item.booster_id=c.success_reward_list[i].bonus_key[0].key_id,_exp_booster_item.exp_inc=c.success_reward_list[i].bonus_key[0].key_num,_exp_booster_item.remain_dt=c.success_reward_list[i].bonus_key.at(0).count,_exp_booster_item.enabled_yn="y";break;case BONUS_TYPE_LOVE_ITEM:case BONUS_TYPE_LOVE_ITEM_MELEE:case BONUS_TYPE_LOVE_ITEM_LANCER:case BONUS_TYPE_LOVE_ITEM_RANGER:case BONUS_TYPE_LOVE_ITEM_CAKE:case BONUS_TYPE_YUBI_LOVE_ITEM:case BONUS_TYPE_CHRISTMAS_LOVE_ITEM:case BONUS_TYPE_SUPER_CHOCO_CAKE:case BONUS_TYPE_WHITE_CHOCO:case BONUS_TYPE_COMEBACK_CAKE:case BONUS_TYPE_LOVE_MAX_CAKE:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_01:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_02:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_03:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_04:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_05:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_06:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_07:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_08:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_09:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_10:bu.plus_User_Love_Item(c.success_reward_list[i].bonus_key[0].key_id,c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_LOVE_ITEM_PARTNER_COCHOLATE:case BONUS_TYPE_LOVE_ITEM_VD_COCHOLATE_A:case BONUS_TYPE_LOVE_ITEM_VD_COCHOLATE_B:var g=GeneralService.getInstance().getBonusTypeToLoveId(c.success_reward_list[i].bonus_key.at(0).key_bonus_type);bu.plus_User_Love_Item(g,c.success_reward_list[i].bonus_count,c.success_reward_list[i].bonus_key.at(0).key_id);break;case BONUS_TYPE_EVENT_POINT:break;case BONUS_TYPE_FORMATION_POINT:bu.plus_User_Formation_Point(c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_SR_LIMIT_OVER_MTRL:case BONUS_TYPE_SSR_LIMIT_OVER_MTRL:bu.plus_User_Limit_Over_Mtrl(c.success_reward_list[i].bonus_key[0].key_id,c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_MAGIC_KEY_MTRL:bu.plus_User_Magic_Key_Mtrl(c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_RAID_POINT:bu.plus_User_Raid_Point(c.success_reward_list[i].bonus_key[0].key_id,c.success_reward_list[i].bonus_count);break;case BONUS_TYPE_CHRISTMAS_SANTA:case BONUS_TYPE_CHRISTMAS_REINDEER:case BONUS_TYPE_CHRISTMAS_SNOWMAN:bu.update_User_Christmas_Reward(c.success_reward_list[i].bonus_type,c.success_reward_list[i].bonus_count,c.success_reward_list[i].bonus_key[0].key_id);case BONUS_TYPE_EQUIPMENT_EXP_BOX_1:case BONUS_TYPE_EQUIPMENT_EXP_BOX_2:case BONUS_TYPE_EQUIPMENT_EXP_BOX_3:case BONUS_TYPE_EQUIPMENT_EXP_BOX_4:case BONUS_TYPE_EQUIPMENT:c.success_reward_list[i].bonus_key.forEach(function(a){MasterManager.getInstance().get_EquipmentItem(a.key_id).equipment_type,EQUIPMENT_TYPE_EXP;var b={};b.equipment_item_idx=a.key_id,b.equipment_num=a.key_num,b.level=1,b.exp=0,b.arm_service_type=ARMSERVICETYPE_NONE,b.step=0,b.combo_stat=2,b.stat_value=1,b.option_num1=0,b.option_num2=0,b.option_num3=0,b.option_num4=0,b.option_num5=0,b.equip_yn="n",b.lock_yn="n",b.activity_type=1,b.base_stat_level_id=a.key_id,bu.insert_User_Equipment(b)})}for(var j=0;j<c.success_reward_list.length;j++)for(i=0;i<list_User_Mail.size();)list_User_Mail.at(i).mail_num==c.success_reward_list[j].num?list_User_Mail.erase(i):i++;for(j=0;j<c.failed_reward_list.length;j++)if(c.failed_reward_list[j].error==net.ERROR.NET_E_ALREADY_DONE_USER_MAIL)for(i=0;i<list_User_Mail.size();)list_User_Mail.at(i).mail_num==c.failed_reward_list[j].num?list_User_Mail.erase(i):i++;0<list_User_Mail.size()?d.setUserNewMail("y"):d.setUserNewMail("n")},bu.upd_Main_Mission_Battle_Win_V2=function(a){var m=MasterTable.getInstance().getMasterTable(),mission=$.extend({},database.MainMission);mission=m.get_MainMission(a.mission_id);for(var i=0;i<a.drop_bonus_items.length;i++){var b=$.extend({},net.Battle_Bonus_Item);if((b=a.drop_bonus_items[i]).bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX){var c=[],obj={};obj.gnrl_id=b.bonus_idx,obj.gnrl_num=b.bonus_num,obj.castle_id=b.castle_id,obj.gnrl_level=b.bonus_level,c.push(obj),bu.new_User_General(c)}else if(b.bonus_type>=BONUS_TYPE_HWANDAN_1&&b.bonus_type<=BONUS_TYPE_HWANDAN_7)bu.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)bu.plus_User_Love_Item(b.bonus_idx,1);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE)bu.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)bu.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_ATTK_POINT&&b.bonus_type<=BONUS_TYPE_CRI_DMG_POINT)bu.plus_User_Formation_Property_Point(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){var d=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(b.bonus_type);bu.plus_User_Rebirth_Mtrl(d,b.bonus_idx)}else b.bonus_type,BONUS_TYPE_GOLD}for(var e=0;e<a.cmplt_task_ids.length;e++)bu.ins_MainMission_Task(a.mission_id,a.cmplt_task_ids[e]);if("y"==a.lotus_bonus_new_yn){null==a.lotus_open_count&&(a.lotus_open_count=0);var f=m_User_main_lotus_bonus_log.at([mission.main_scene_id,mission.main_story_id,1,a.lotus_open_count]);if(null!=f)f.new_yn=a.lotus_bonus_new_yn;else{var g={main_scene_id:mission.main_scene_id,main_story_id:mission.main_story_id,difficulty_type:1,new_yn:"y",complete_yn:"n",lotus_count:a.lotus_open_count};m_User_main_lotus_bonus_log.insert([g.main_scene_id,g.main_story_id,g.difficulty_type,g.lotus_count],g)}}for(var h=!0,cnt_user_mission_length=map_user_main_mission.length,uidx=0;uidx<cnt_user_mission_length;uidx++)map_user_main_mission[uidx].main_mission_id==a.mission_id&&(map_user_main_mission[uidx].complete_yn="y",map_user_main_mission[uidx].new_yn="n",map_user_main_mission[uidx].win_count=a.win_count,h=!1);if(1==h){g={main_mission_id:a.mission_id,new_yn:"y",complete_yn:"n",win_count:a.win_count};map_user_main_mission.push($.extend({},g)),g=null}if("y"==a.story_complete_yn){h=!0;var j=bu.get_User_main_story(),keys=j.keys();for(i=0;i<keys.length;i++)if(j.at(keys[i]).main_scene_id==mission.main_scene_id&&j.at(keys[i]).main_story_id==mission.main_story_id){g=null;(g=$.extend({},j.at(keys[i]))).complete_yn="y",g.new_yn="n",User_main_story.insert(keys[i],g),h=!1}}bu.upd_UserLevelExp(a.user_level,a.user_exp),bu.upd_UserGold(a.user_gold),bu.upd_UserHeart(a.user_heart),bu.upd_UserFormationPoint(a.user_formation_point),bu.upd_UserGeneralLevelExp(a.gnrl_exp),"y"==a.is_user_level_up&&bu.update_max_user_key_bound(a.user_level,a.user_raid_ticket),bu.upd_UserItemRaidTicket(a.user_raid_ticket),bu.upd_UserRaidHelpTicket(a.user_raid_help_ticket)},bu.upd_User_Key=function(a,b,c){User_item_info.user_item_key.key_cnt=a.key_cnt,User_item_info.user_item_key.elapsed=a.elapsed,null!=b&&(User_item_info.user_item.jade_count=b),null!=c&&(User_item_info.user_item.yunhee_point=c)},bu.upd_UserItemRaidTicket=function(a){User_item_info.user_item_raid_ticket.ticket_cnt=a.ticket_cnt,User_item_info.user_item_raid_ticket.elapsed=a.elapsed},bu.update_max_user_key_bound=function(a,b){var c=User_item_info.user_item_key.key_cnt,max_key_bound=MasterManager.getInstance().get_UserLevel(a).key_bound;c<(max_key_bound+=NetService().get_User_Plus_Key_Bound())&&(User_item_info.user_item_key.key_cnt=max_key_bound,User_item_info.user_item_raid_ticket.ticket_cnt=b.ticket_cnt,User_item_info.user_item_raid_ticket.elapsed=b.elapsed,MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_user_raid_ticket))},bu.ins_MainMission_Task=function(a,b){for(var c=!1,cnt=map_user_main_mission_task.length,idx=0;idx<cnt;idx++)map_user_main_mission_task[idx].main_mission_id==a&&map_user_main_mission_task[idx].task_id==b&&(c=!0);if(0==c){var d={};d.main_mission_id=a,d.task_id=b,map_user_main_mission_task.push(d)}},bu.new_User_General=function(a){for(var b=a,new_gnrls=[],idx=0;idx<b.length;idx++){var c=b[idx],data=$.extend({},c),lock_yn="n",general=MasterManager.getInstance().get_General(data.gnrl_id);general.rare_type==RARE_TYPE_SSR&&general.gnrl_type==GENERAL_TYPE_YUNHEE&&(lock_yn="y"),general.limit_step_id=0,general.gnrl_num=data.gnrl_num,general.gnrl_exp=0,general.gnrl_level=1,general.castle_id=0,general.love_level=0,general.love_exp=0,general.used_in_camp="n",general.lock_yn=lock_yn;var d=MasterTable.getInstance().get_EventDungeonBuffPeriodList();general.buff_type=MasterTable.getInstance().get_GeneralDungeonBuffList(general.gnrl_group,d,general.buff_type),map_User_General.insert([data.gnrl_id,data.gnrl_num],general),new_gnrls.push(data)}bu.update_user_Generals()},bu.upd_User_Item=function(a){User_item_info.user_item.jade_count=a.user_jade,User_item_info.user_item.heart_count=a.user_heart,User_item_info.user_item.gold_count=a.user_gold},bu.update_User_Troops_Generals=function(a,b){for(var c=list_User_Troops_General.keys(),idx=0;idx<c.length;idx++)list_User_Troops_General.at(c[idx]).troops_num==a&&list_User_Troops_General.remove(c[idx]);for(idx=0;idx<b.length;idx++){var d=b[idx];list_User_Troops_General.insert([d.troops_num,d.gnrl_id,d.gnrl_num],d),d=null}c=null},bu.Load_User_Troops_General=function(){return list_User_Troops_General},bu.resetEventDungeonBoxGachaItemInfoList=function(){for(var a=map_User_Extra_Box_Init_Info.keys(),idx=0;idx<a.length;idx++){var e=map_User_Extra_Box_Init_Info.at(a[idx]);list_User_Box_Gacha_Info=list_User_Box_Gacha_Info.filter(function(l){return e.box_gacha_info_idx!=l.box_gacha_info_idx||e.init_count==l.init_count})}},bu.upd_User_General_Love_Up=function(a,b,c,d){map_User_General.at([a.gnrl_id,a.gnrl_num]).love_level=c,map_User_General.at([a.gnrl_id,a.gnrl_num]).love_exp=d,map_User_Love_Item.at(b.love_id+""+b.gnrl_id).count=b.count},bu.upd_UserGold=function(a){User_item_info.user_item.gold_count=a},bu.upd_UserJade=function(a){User_item_info.user_item.jade_count=a},bu.upd_UserHeart=function(a){User_item_info.user_item.heart_count=a},bu.remove_User_General=function(a){for(var b=map_User_General.keys(),idx=0;idx<b.length;idx++)null!=map_User_General.at(b[idx])&&map_User_General.at(b[idx]).gnrl_id==a.gnrl_id&&map_User_General.at(b[idx]).gnrl_num==a.gnrl_num&&map_User_General.remove(b[idx])},bu.upd_UserYunheePT=function(a){User_item_info.user_item.yunhee_point=a},bu.upd_UserHeavenPt=function(a){User_item_info.user_item.heaven_pt=a},bu.upd_UserSkipTicket=function(a){User_item_info.user_item_skip_ticket=a},bu.getUserGeneral=function(a,b){if(null==b){var c=map_User_General.keys();for(b=0;b<c.length;b++){var d=$.extend({},map_User_General.at(c[b]));null!=d&&a.push(d)}}else a=$.extend({},map_User_General.at([b.gnrl_id,b.gnrl_num]));return a},bu.getUserGeneralCount=function(){return map_User_General.size()},bu.getFriendGeneral=function(a){for(var i in map_Friend_General)a.push(i.second)},bu.get_User_formation_point=function(){return User_item_info.user_item.formation_point},bu.getUserWeeklyTroopsGeneral=function(){return list_User_Weekly_Troops_General},bu.getUserPartyGeneral=function(){return list_User_Troops_General},bu.getUserLoveItem=function(a){for(var b=map_User_Love_Item.keys(),idx=0;idx<b.length;idx++)a.push(map_User_Love_Item.at(b[idx]))},bu.getUsermail=function(a){if(null==a)return list_User_Mail;for(var b=[],list=MasterTable.getInstance().get_MailDivisionList(a),m_idx=0;m_idx<list_User_Mail.length;m_idx++)for(var m=list_User_Mail[m_idx],t_idx=0;t_idx<list.length;t_idx++){var t=list[t_idx];m.bonus_type==t.bonus_type&&b.push_back(m)}return list=null,b},bu.getUsermailCount=function(){return map_User_General.length},bu.isExistUsermail=function(a){for(var b in list_User_Mail)if(b.bonus_type==a)return!0;return!1},bu.getUserMailMaxNum=function(){if(list_User_Mail.empty())return 0;list_User_Mail.sort(function(a,b){return a.mail_num<b.mail_num?-1:a.mail_num>b.mail_num?1:0});new User_Mail;return list_User_Mail.back().mail_num},bu.getUserIllust=function(a){return!0;if(map_User_Illust_Book_List.empty())return!1;for(var b=0;b<map_User_Illust_Book_List.length;b++)if(map_User_Illust_Book_List[b].illust_idx==a)return!0},bu.upd_User_Gacha_Count=function(a){null!=User_gacha_count&&null!=User_gacha_count.gacha_buy_bonus&&(User_gacha_count.gacha_buy_bonus=a)},bu.clearBattleDungeonContinue=function(){_battle_dungeon_continue.battle_dungeon_type=0,_battle_dungeon_continue.troops_num=0,_battle_dungeon_continue.frnd_id="",_battle_dungeon_continue.value1=0,_battle_dungeon_continue.value2=0,_battle_dungeon_continue.value3=0,_battle_dungeon_continue.value4=0,_battle_dungeon_continue.drop_items=null},bu.plus_User_Gold=function(a){User_item_info.user_item.gold_count+=a},bu.plus_User_Craft_Shop_Material=function(a,b){var c=map_user_event_dungeon_craft_shop_material.at([m_user_id,a]);null!=c&&(c.material_count+=b)},bu.plus_User_Limit_Over_Mtrl=function(a,b){var c=map_User_Limit_Over_Mtrl.at(a),item={};item.mtrl_cnt=null!=c?(item.limit_over_mtrl_type=a,c.mtrl_cnt+b):(item.limit_over_mtrl_type=a,b),map_User_Limit_Over_Mtrl.insert(a,item)},bu.plus_User_Key=function(a){User_item_info.user_item_key.key_cnt+=a},bu.plus_User_Heart=function(a){User_item_info.user_item.heart_count+=a},bu.plus_User_Raid_Ticket=function(a){User_item_info.user_item_raid_ticket.ticket_cnt+=a},bu.upd_UserRaidHelpTicket=function(a){User_item_info.user_raid_help_ticket.ticket_cnt=a.ticket_cnt,User_item_info.user_raid_help_ticket.elapsed=a.elapsed},bu.plus_User_Raid_Help_Ticket=function(a){User_item_info.user_raid_help_ticket.ticket_cnt+=a},bu.upd_UserWorldWarTicket=function(a){var b;b=MasterManager.getInstance().get_CountFunction(29).value;var c=0;c=User_item_info.user_item_world_war_ticket.ticket_cnt,User_item_info.user_item_world_war_ticket.ticket_cnt="object"==typeof a?a.ticket_cnt:(b<=c||b<(c+=a)&&(c=b),c)},bu.plus_User_World_War_Ticket=function(a){User_item_info.user_item_world_war_ticket.ticket_count+=a},bu.upd_UserGreatWall_Ticket=function(a){var b;b=MasterManager.getInstance().get_CountFunction(25).value;var c=0;c=User_item_info.user_item_great_wall_ticket.ticket_cnt,User_item_info.user_item_great_wall_ticket.ticket_cnt="object"==typeof a?a.ticket_cnt:(b<=c||b<(c+=a)&&(c=b),c)},bu.plus_User_Great_Wall_Ticket=function(a){User_item_info.user_item_great_wall_ticket.ticket_cnt+=a},bu.plus_User_Jade=function(a){User_item_info.user_item.jade_count+=a},bu.plus_User_Evolve_Stone=function(a){_evolve_Stone_Count+=a},bu.get_User_Yunhee_PT=function(){return User_item_info.user_item.yunhee_point},bu.plus_User_Yunhee_PT=function(a){User_item_info.user_item.yunhee_point+=a},bu.plus_User_Heaven_PT=function(a){User_item_info.user_item.heaven_pt+=a},bu.get_User_Event_Dungeon_Christmas_Info=function(){return $.extend({},m_Res_Get_User_Event_Dungeon_Christmas_Info)},bu.get_User_Raid_Point=function(a){var b={};return b.raid_boss_period_idx=a,b.raid_point=0,User_item_info.user_item.raid_point.raid_boss_period_idx==a&&(b.raid_point=User_item_info.user_item.raid_point.raid_point),b.raid_point},bu.plus_User_Raid_Point=function(a,b){User_item_info.user_item.raid_point.raid_point+=b},bu.upd_UserRaidPoint=function(a){User_item_info.user_item.raid_point=a},bu.plus_User_Evolve_Arm_Service=function(a,b){var c=bu.bonusTypeToArmServiceType(a),evolve_arm_service_class_type=bu.bonusTypeToArmServiceClassType(a),key=net.User_Evolve_Arm_Service_Key;if(key.arm_service_type=c,key.class_type=evolve_arm_service_class_type,null!=map_User_Evolve_Arm_Service_Mtrl.at([key.arm_service_type,key.class_type]))map_User_Evolve_Arm_Service_Mtrl.at([key.arm_service_type,key.class_type]).mtrl_count+=b;else{var d={};d.arm_service_type=c,d.class_type=key.class_type,d.mtrl_count=b,map_User_Evolve_Arm_Service_Mtrl.insert([key.arm_service_type,key.class_type],d)}},bu.plus_User_Formation_Property_Point=function(a,b){var c=bu.bonusTypeToFormationPropertyType(a);for(var g in m_User_formation_property_point)if(m_User_formation_property_point[g].property_type==c){m_User_formation_property_point[g].point_count+=b;break}},bu.get_User_Event_Dungeon_Box_Gacha_Info_List=function(a){var b=[];if(null==a)return $.extend(!0,[],list_User_Box_Gacha_Info);for(var i=0;i<EVENT_DUNGEON_BOX_GACHA_CELL_COUNT;++i){(d={event_dungeon_period_idx:0,item_idx:0,box_gacha_info_idx:0}).item_num=i+1,b.push_back(d)}var c=map_User_Extra_Box_Init_Info.at(a);null==c&&(c={box_gacha_info_idx:0,init_count:0});for(i=0;i<b.size();++i)for(var d=b.at(i),idx=0;idx<list_User_Box_Gacha_Info.length;idx++){var e=list_User_Box_Gacha_Info[idx];e.box_gacha_info_idx==a&&(e.init_count!=c.init_count||e.item_num==d.item_num&&(b[i]=e))}return b},bu.get_User_Event_Dungeon_Box_Gacha_Golden_Barrel_info_List=function(){return $.extend(!0,[],list_User_Box_Gacha_Golden_Barrel_Info)},bu.get_User_Event_Dungeon_Extra_Box_Init_Info_List=function(){return $.extend(!0,[],map_User_Extra_Box_Init_Info)},bu.get_User_Event_Dungeon_Extra_Box_Init_Info=function(a){var b=map_User_Extra_Box_Init_Info.at(a);return null==b&&(b={box_gacha_info_idx:0,init_count:0}),b},bu.get_User_Event_Dungeon_Box_Gacha_Info_Progress_List=function(){return $.extend(!0,[],list_User_Box_Gacha_progress_Info)},bu.get_User_Event_Dungeon_Growth_Info=function(){return $.extend(!0,[],m_Res_Get_User_Event_Dungeon_Growth_Info)},bu.get_User_Rebirth_Mtrl_Info=function(a){return null==a?$.extend({},map_User_Rebirth_Mtrl):$.extend({},map_User_Rebirth_Mtrl.at(a))},bu.udp_UserPlusKeyBound=function(a){User_item_info.user_item_key.plus_key_bound=a},bu.get_User_Plus_Key_Bound=function(){return User_item_info.user_item_key.plus_key_bound},bu.udp_UserEvolveOrb=function(a){User_item_info.user_item.orb_count=a},bu.plus_User_Evolve_Orb=function(a){User_item_info.user_item.orb_count+=a},bu.plus_User_Love_Item=function(a,b,c){null==b&&(b=0),null==c&&(c=0),null==a&&(a=0);var d;d=map_User_Love_Item.find(a+""+c);var e={};e.love_id=a,e.gnrl_id=c,e.count=0,d?(map_User_Love_Item.at(a+""+c).count+=b,map_User_Love_Item.at(a+""+c).gnrl_id=c):(e.count=b,map_User_Love_Item.insert(e.love_id+""+e.gnrl_id,e))},bu.plus_User_Formation_Point=function(a){User_item_info.user_item.formation_point+=a,bu.upd_UserFormationPoint(User_item_info.user_item.formation_point)},bu.bonusTypeToEvolveMtrlType=function(a){return a==BONUS_TYPE_HWANDAN_1?HWANDAN_CLASS_1:a==BONUS_TYPE_HWANDAN_2?HWANDAN_CLASS_2:a==BONUS_TYPE_HWANDAN_3?HWANDAN_CLASS_3:a==BONUS_TYPE_HWANDAN_4?HWANDAN_CLASS_4:a==BONUS_TYPE_HWANDAN_5?HWANDAN_CLASS_5:a==BONUS_TYPE_HWANDAN_6?HWANDAN_CLASS_6:a==BONUS_TYPE_HWANDAN_7?HWANDAN_CLASS_7:a==BONUS_TYPE_YUBI_RARE?HWANDAN_CLASS_YUBI:0},bu.bonusTypeToArmServiceType=function(a){var b=0;return a==BONUS_TYPE_EVOLVE_MELEE||a==BONUS_TYPE_EVOLVE_MELEE_MIDDLE||a==BONUS_TYPE_EVOLVE_MELEE_LOW||a==BONUS_TYPE_YUBI_EVOLVE_HIGH||a==BONUS_TYPE_YUBI_EVOLVE_MIDDLE||a==BONUS_TYPE_YUBI_EVOLVE_LOW?b=ARMSERVICETYPE_INFANTRY:a==BONUS_TYPE_EVOLVE_ARCHER||a==BONUS_TYPE_EVOLVE_ARCHER_MIDDLE||a==BONUS_TYPE_EVOLVE_ARCHER_LOW?b=ARMSERVICETYPE_ARCHER:a!=BONUS_TYPE_EVOLVE_LANCER&&a!=BONUS_TYPE_EVOLVE_LANCER_MIDDLE&&a!=BONUS_TYPE_EVOLVE_LANCER_LOW||(b=ARMSERVICETYPE_SPEAR),b},bu.filterEventDungeonAchvList=function(a){},bu.bonusTypeToFormationPropertyType=function(a){var b=0;return a==BONUS_TYPE_ATTK_POINT?b=FORMATION_PROPERTY_TYPE_ATTK:a==BONUS_TYPE_DEF_POINT?b=FORMATION_PROPERTY_TYPE_DEF:a==BONUS_TYPE_HP_POINT?b=FORMATION_PROPERTY_TYPE_HP:a==BONUS_TYPE_CRI_PRCNT_POINT?b=FORMATION_PROPERTY_TYPE_CRI_PRCNT:a==BONUS_TYPE_CRI_DMG_POINT&&(b=FORMATION_PROPERTY_TYPE_CRI_DMG),b},bu.bonusTypeToArmServiceClassType=function(a){var b=0;return a==BONUS_TYPE_EVOLVE_MELEE||a==BONUS_TYPE_EVOLVE_ARCHER||a==BONUS_TYPE_EVOLVE_LANCER?b=EVOLVE_ARM_SERVICE_CLASS_TYPE_HIGH:a==BONUS_TYPE_EVOLVE_MELEE_MIDDLE||a==BONUS_TYPE_EVOLVE_ARCHER_MIDDLE||a==BONUS_TYPE_EVOLVE_LANCER_MIDDLE?b=EVOLVE_ARM_SERVICE_CLASS_TYPE_MIDDLE:a==BONUS_TYPE_EVOLVE_MELEE_LOW||a==BONUS_TYPE_EVOLVE_ARCHER_LOW||a==BONUS_TYPE_EVOLVE_LANCER_LOW?b=EVOLVE_ARM_SERVICE_CLASS_TYPE_LOW:a==BONUS_TYPE_YUBI_EVOLVE_HIGH?b=EVOLVE_ARM_SERVICE_CLASS_TYPE_EVENT_HIGH:a==BONUS_TYPE_YUBI_EVOLVE_MIDDLE?b=EVOLVE_ARM_SERVICE_CLASS_TYPE_EVENT_MIDDLE:a==BONUS_TYPE_YUBI_EVOLVE_LOW&&(b=EVOLVE_ARM_SERVICE_CLASS_TYPE_EVENT_LOW),b},bu.plus_User_Hwandan=function(a,b){var c=bu.bonusTypeToEvolveMtrlType(a),hwandan_key={};hwandan_key.class_type=c;var d=net.User_Hwandan;d.hwandan_class=hwandan_key.class_type,d.hwandan_count=b,null!=map_User_Hwandan_Info.at(hwandan_key.class_type)?map_User_Hwandan_Info.at(hwandan_key.class_type).hwandan_count+=b:map_User_Hwandan_Info.insert(hwandan_key.class_type,d)},bu.plus_User_Exchange_Ticket=function(a){var b=bu.get_User_Exchange_Ticket();b+=a,bu.upd_UserExchangeTicket(b)},bu.plus_User_Skip_Ticket=function(a){User_item_info.user_item_skip_ticket+=a},bu.get_Global_Booster_Event=function(){return list_Global_Booster_Event_V2},bu.get_daily_dungeon_open_period_info=function(){return m_daily_dungeon_open_period_info},bu.get_User_Cost_slot_list=function(){return list_User_camp_cost_slot},bu.get_User_Camp_cost_Log=function(){return map_User_Cost_general},bu.get_User_Evolve_Orb=function(){return User_item_info.user_item.orb_count},bu.getUserLimitOverMtrlCount=function(a){var b=map_User_Limit_Over_Mtrl.at(a);return null==b?0:b.mtrl_cnt},bu.get_User_Gacha_ticket=function(a){var b=_user_gacha_ticket.at(a);return null==b?0:b.ticket_count},bu.get_User_Special_Gacha_ticket=function(a){var b=_user_special_gacha_ticket.at(a);return null==b?0:b.ticket_cnt},bu.get_User_Limit_Over_Mtrl=function(){return map_User_Limit_Over_Mtrl},bu.get_User_Evevt_Dungeon_Achv_List=function(){return _event_dungeon_achv_list},bu.get_User_Hwandan_Info=function(a){return null==a?map_User_Hwandan_Info:map_User_Hwandan_Info.at(a)},bu.get_User_Evolve_Arm_Service_Mtrl=function(a){return map_User_Evolve_Arm_Service_Mtrl.at([a.arm_service_type,a.class_type])},bu.get_user_map_User_Evolve_Arm_Service_Mtrl=function(){return map_User_Evolve_Arm_Service_Mtrl},bu.get_user_ceiling_gacha_info=function(){return map_user_ceiling_gacha_info},bu.get_User_Battle_Formation=function(){return m_User_Battle_formation},bu.get_User_Formation_Property_Info=function(){return m_User_formation_property_point},bu.get_User_Mussang_Info=function(){return m_user_mussang_Info},bu.get_battle_dungeon_continue=function(a){return _battle_dungeon_continue},bu.get_list_User_Mail=function(){return list_User_Mail},bu.plus_User_Magic_Key_Mtrl=function(a){User_Magic_Key_Mtrl+=a},bu.getMagicKeyCount=function(){return User_Magic_Key_Mtrl},bu.getUserKeyRecoveryMakeCount=function(){return User_Key_Recovery_Make_Count},bu.get_Shop_Gacha_Period_Info=function(){return _get_Shop_Gacha_Period_Info},bu.get_user_shop_buy_info=function(){return _user_shop_buy_info},bu.get_Popup_Banner_Info=function(){return _get_Popup_Banner_Info},bu.get_user_weekly_open=function(){return map_user_weekly_open},bu.get_user_event_dungeon_point=function(){return map_user_event_dungeon_point},bu.get_User_Equipment_bound=function(){return map_User_Equipment_bound},bu.get_User_Equipment_item=function(){return map_User_Equipment},bu.get_User_Book_General=function(){return list_User_book_General},bu.get_raid_boss_history=function(){return _raid_boss_history},bu.get_user_event_dungeon_special_point=function(){return map_user_event_dungeon_special_point},bu.get_Event_Dungeon_Vote_League_Ranking_Refresh_Dt=function(a){return m_Res_Get_Event_Dungeon_Vote_League_Ranking_Record.ranking_refresh_dt},bu.get_Event_Dungeon_Vote_Ranking_Refresh_Dt=function(a){return m_Res_Get_Event_Dungeon_Vote_Ranking_Info.ranking_refresh_dt},bu.get_Event_Raid_BoxGacha_Info=function(a,b){for(var c={},i=0;i<User_Box_Gacha_List.event_dungeon_box_gacha_info.length;i++){var d=User_Box_Gacha_List.event_dungeon_box_gacha_info[i];d.event_dungeon_period_idx==a&&d.delimiter==b&&(c=d)}return c},bu.get_Event_Raid_Dungeon_num=function(){return Global_Raid_Dungeon_info.event_raid_dungeon_num},bu.get_Event_Raid_Dungeon_Info=function(){return Global_Raid_Boss_Info},bu.get_Event_Dungeon_Vote_League_Yunhee_Candidate_List=function(){return $.extend([],m_Res_Get_Event_Dungeon_Vote_League_Yunhee_Info.event_dungeon_vote_league_yunhee_candidate)},bu.get_Event_Dungeon_Vote_Current_League_Grop_Idx=function(){return m_Res_Get_Event_Dungeon_Vote_League_Yunhee_Info.league_group_idx},bu.get_great_wall_troops_info=function(){return _great_wall_troops_info},bu.get_Event_Dungeon_Vote_Ranking_Info_List=function(){var a=[];if(null!=m_Res_Get_Event_Dungeon_Vote_Ranking_Info&&null!=m_Res_Get_Event_Dungeon_Vote_Ranking_Info&&null!=m_Res_Get_Event_Dungeon_Vote_Ranking_Info.event_dungeon_vote_ranking_info){var b=m_Res_Get_Event_Dungeon_Vote_Ranking_Info.event_dungeon_vote_ranking_info;a=stable(b,function(l,r){return l.vote_yunhee_idx>r.vote_yunhee_idx}),a=stable(a,function(l,r){return l.ranking>r.ranking})}return a},bu.get_User_Event_Dungeon_Vote_Info_List=function(){var a=[];return null!=_get_User_Vote_Info&&(_get_User_Vote_Info=stable(_get_User_Vote_Info,function(l,r){return l.vote_yunhee_idx>r.vote_yunhee_idx}),_get_User_Vote_Info=stable(_get_User_Vote_Info,function(l,r){return l.ranking>r.ranking}),a=_get_User_Vote_Info),a},bu.get_Event_Dungeon_Vote_League_Ranking_Info_List=function(){var a=[];if(null!=m_Res_Get_Event_Dungeon_Vote_League_Ranking_Info&&null!=m_Res_Get_Event_Dungeon_Vote_League_Ranking_Info&&null!=m_Res_Get_Event_Dungeon_Vote_League_Ranking_Info.event_dungeon_vote_ranking_info){var b=m_Res_Get_Event_Dungeon_Vote_League_Ranking_Info.event_dungeon_vote_ranking_info;b=stable(b,function(l,r){return l.league_yunhee_idx-r.league_yunhee_idx}),a=stable(b,function(l,r){return l.ranking-r.ranking})}return a},bu.get_User_Event_Dungeon_Vote_League_Info_List=function(){var a=[];return null!=_get_User_Vote_League_Info&&null!=_get_User_Vote_League_Info&&0!=_get_User_Vote_League_Info.length&&(a=stable(_get_User_Vote_League_Info,function(l,r){return l.ranking-r.ranking})),a},bu.insert_User_Daily_Bonus=function(a){},bu.delete_User_Daily_Bonus=function(a){},bu.delete_User_Daily_Bonus_Recv=function(a){},bu.get_RollingBannerList=function(){var a=[],m=MasterManager.getInstance(),ss=ShopService.getInstance();null==_get_Rolling_Banner_Info.banner_info&&(_get_Rolling_Banner_Info.banner_info=[]);for(var b=0;b<_get_Rolling_Banner_Info.banner_info.length;b++){var r=_get_Rolling_Banner_Info.banner_info[b],is_display=!1,timeEngine=TimeEventEngine.getInstance(),beg_remain=0,end_remain=0;if(timeEngine.existTimeEvent(TIME_EVENT_ROLLING_BANNER_BEGIN+r.banner_idx)&&(beg_remain=timeEngine.getSecond(TIME_EVENT_ROLLING_BANNER_BEGIN+r.banner_idx)),timeEngine.existTimeEvent(TIME_EVENT_ROLLING_BANNER_END+r.banner_idx)&&(end_remain=timeEngine.getSecond(TIME_EVENT_ROLLING_BANNER_END+r.banner_idx)),r.banner_type==MAIN_BANNER_JOIN_BONUS)if(GameContext.getInstance().getJoinBonusComlete())continue;if(r.banner_type==MAIN_BANNER_RETURN_USER_BONUS){if(GameContext.getInstance().getReturnUserInfo().is_complete)continue;var c=m.get_Banner(r.banner_idx),b_period=m.get_BannerPeriod(c.banner_period_idx),add_time=24*m.get_TimeFunction(12).value*60*60*1e3,now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),end_date=b_period.end_dt;(end_remain=moment(end_date).valueOf()+add_time-n)<0&&(end_remain=0)}if(r.banner_type==MAIN_BANNER_NEW_USER_SUPPORT)if(0!=GameContext.getInstance().getCompleteEvoultionEvent())continue;if(r.banner_type==MAIN_BANNER_EVENT_VD_LOGIN){for(var d=GameContext.getInstance().getLoginBonus(),is_delete=!1,jdx=0;jdx<d.event_login_list.length;jdx++){if(28<=(i=d.event_login_list[jdx]).event_login_count){is_delete=!0;break}}if(is_delete)continue}if(r.banner_type!=MAIN_BANNER_BEGINNGER_INFO||UserService.getInstance().isBeginnerBooster()){if(r.banner_type==MAIN_BANNER_PREMIUM_LOGIN_BONUS){is_delete=!1;for(var e=MasterManager.getInstance(),pl_list=MasterTable.getInstance().get_PremiumLoginBonusList([]),lb=GameContext.getInstance().getLoginBonus(),plb=$.extend({},db.PremiumLoginBonus),iidx=0;iidx<pl_list.length;iidx++){var f=pl_list[iidx],banner=e.get_Banner(r.banner_idx);if(f.login_id==banner.rolling_banner_move_path){plb=f;n=(now=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME))).valueOf();var g=moment(f.beg_dt).valueOf(),ee=moment(f.end_dt).valueOf();(n<g||ee<n)&&(is_delete=!0);break}}if(!is_delete)for(var h=0;h<lb.event_login_list.length;h++)if(lb.event_login_list[h].event_login_id==plb.login_id){var k=UserService.getInstance().getEventLoginBonusMaxCount(lb.event_login_list[h].event_login_id);if(lb.event_login_list[h].event_login_count>=k){is_delete=!0;break}}if(is_delete)continue}if(r.banner_type==MAIN_BANNER_DMM_POINT_GACHA||r.banner_type==MAIN_BANNER_DMM_POINT_GACHA_THIRD||r.banner_type==MAIN_BANNER_DMM_POINT_FOURTH||r.banner_type==MAIN_BANNER_DMM_POINT_FIFTH||r.banner_type==MAIN_BANNER_DMM_POINT_GACHA_SECOND||r.banner_type==MAIN_BANNER_DMM_POINT_16_GACHA||r.banner_type==MAIN_BANNER_NEW_YEAR_LUCKY_BOX)if(NOT_USE_SHOP_BUY_LOG_PARSING){if(!ss.IsEnabledBuyDmmPointGacha(r.banner_type))continue}else{var o=!0,buy_info={};if(r.banner_type==MAIN_BANNER_DMM_POINT_GACHA?buy_info=GameDefault.getInstance().getUserBuy_Type(SHOP_TYPE_GACHA,GACHA_TAB_TYPE_DMM_POINT):r.banner_type==MAIN_BANNER_DMM_POINT_GACHA_THIRD?buy_info=GameDefault.getInstance().getUserBuy_Type(SHOP_TYPE_GACHA,GACHA_TAB_TYPE_DMM_POINT_THIRD):r.banner_type==MAIN_BANNER_DMM_POINT_FOURTH?buy_info=GameDefault.getInstance().getUserBuy_Type(SHOP_TYPE_GACHA,GACHA_TAB_TYPE_DMM_POINT_FOURTH):r.banner_type==MAIN_BANNER_DMM_POINT_FIFTH?buy_info=GameDefault.getInstance().getUserBuy_Type(SHOP_TYPE_GACHA,GACHA_TAB_TYPE_DMM_POINT_FIFTH):r.banner_type==MAIN_BANNER_DMM_POINT_GACHA_SECOND?buy_info=GameDefault.getInstance().getUserBuy_Type(SHOP_TYPE_GACHA,MAIN_BANNER_DMM_POINT_GACHA_SECOND):r.banner_type==MAIN_BANNER_DMM_POINT_16_GACHA?buy_info=GameDefault.getInstance().getUserBuy_Type(SHOP_TYPE_GACHA,MAIN_BANNER_DMM_POINT_16_GACHA):r.banner_type==MAIN_BANNER_NEW_YEAR_LUCKY_BOX&&(buy_info=GameDefault.getInstance().getUserBuy_Type(SHOP_TYPE_EVENT)),null!=buy_info&&(o=buy_info.is_buy),o)continue}if(r.banner_type==MAIN_BANNER_JADE_SHOP)if(UserService.getInstance().isCompleteJadeFirstBuyAll())continue;if(r.banner_type==MAIN_BANNER_NEW_YEAR_LUCKY_BOX){for(var p=(new NetService).get_user_shop_buy_info().user_shop_buy_info,shop_list=(e=MasterManager.getInstance(),ss.getShopList()),is_luck_buy=!0,i=0;i<shop_list.length;i++){var q=shop_list[i];if(q.shop_type==SHOP_TYPE_EVENT){if("Y"==q.display_yn){if(0==p.length){is_luck_buy=!0;break}for(var j=0;j<p.length;j++)if(p[j].shop_id==q.shop_id){if("n"==p[j].buy_enable_yn){is_luck_buy=!1;break}}else is_luck_buy=!0;break}is_luck_buy=!1}}if(!is_luck_buy)continue}if(r.banner_type==MAIN_BANNER_STEP_UP_GACHA_DMM_POINT_FIRST||r.banner_type==MAIN_BANNER_STEP_UP_GACHA_DMM_POINT_SECOND||r.banner_type==MAIN_BANNER_STEP_UP_GACHA_JADE_FIRST||r.banner_type==MAIN_BANNER_STEP_UP_GACHA_JADE_SECOND){if(!ss.IsEnableBuyStepUpGachaByBannerType(r.banner_type))continue}else if(r.banner_type==MAIN_BANNER_EXCHANGE_TICKET);else if(r.banner_type==MAIN_BANNER_SPECIAL_TICKET_GACHA);else if(r.banner_type==MAIN_BANNER_1_DAY_1_TIME_FREE_GACHA_FIRST||r.banner_type==MAIN_BANNER_1_DAY_1_TIME_FREE_GACHA_SECOND||r.banner_type==MAIN_BANNER_1_DAY_1_TIME_FREE_GACHA){if(!ss.IsEnableBuy1Day1TimeFreeGachaByBannerType(r.banner_type))continue}else if((r.banner_type==MAIN_BANNER_1_USER_1_TIME_FREE_GACHA_FIRST||r.banner_type==MAIN_BANNER_1_USER_1_TIME_FREE_GACHA_SECOND||r.banner_type==MAIN_BANNER_1_USER_1_TIME_FREE_GACHA)&&!ss.IsEnableBuy1User1TimeFreeGachaByBannerType(r.banner_type))continue;if(1==r.exp_condition?is_display=0<end_remain&&beg_remain<=0:2==r.exp_condition&&(is_display=!0,"n"==r.display_yn&&(is_display=0<end_remain)),is_display)(banner={}).banner_idx=r.banner_idx,banner.banner_type=r.banner_type,banner.img_path=r.img_path,banner.num=r.num,banner.comment=r.comment,a.push(banner)}}return a=stable(a,function(l,r){return l.num-r.num})},bu.get_user_event_dungeon_reward=function(){return map_user_event_dungeon_reward},bu.get_user_event_dungeon_reward_shop=function(){return map_user_event_dungeon_reward_shop},bu.get_user_event_dungeon_reward_board_info=function(){return map_user_event_dungeon_reward_board_info},bu.get_user_event_dungeon_board_map_bonus=function(){return map_user_event_dungeon_board_map_bonus},bu.get_user_event_dungeon_global_reward_log=function(){return map_user_event_dungeon_global_reward_log},bu.get_user_event_dungeon_marble_map_info=function(){return map_user_event_dungeon_marble_map_info},bu.get_user_event_dungeon_marble_circuit_log=function(){return map_user_event_dungeon_marble_circuit_log},bu.get_user_event_dungeon_special_point_shop_log=function(){return map_user_event_dungeon_special_point_shop_log},bu.get_user_event_dungeon_cutin_accum_rate=function(){return map_user_event_dungeon_cutin_accum_rate},bu.get_user_event_dungeon_craft_shop_material=function(){return map_user_event_dungeon_craft_shop_material},bu.get_user_event_dungeon_persnal_point_bonus_log=function(){return map_user_event_dungeon_persnal_point_bonus_log},bu.get_user_event_dungeon=function(){return map_user_event_dungeon},bu.get_user_Event_Dungeon_Craft_Shop_Product_Info=function(){return _user_Event_Dungeon_Craft_Shop_Product_Info},bu.get_user_camp_branch_ability=function(){return map_user_camp_branch_ability},bu.get_map_user_prologue_v2=function(){return map_user_prologue_v2},bu.get_raid_boss_list=function(){return _raid_boss_list},bu.get_user_troops=function(){return map_user_troops},bu.get_user_yunhee_bound=function(){if(m_user_yunhee_bound.size()<0)return 0;if(""!=m_user_id)return m_user_yunhee_bound.at(m_user_id).bound;var a=m_user_yunhee_bound.keys();return m_user_yunhee_bound.at(a[0]).bound},bu.get_user_illust=function(){return m_user_illust},bu.get_user_beginner_booster=function(){return m_user_beginner_booster},bu.get_User_Equipment_Box_Gacha_Info=function(){return m_Res_Get_User_Equipment_Box_Gacha_Info},bu.getUserPremiumDmmPointKey=function(){return m_premium_login_dmm_point_key},bu.setUserPremiumDmmPointKey=function(a){return m_premium_login_dmm_point_key=a},bu.getUserMussangTowerTask=function(){return m_user_mussang_tower_task},bu.getUserMussangTower=function(){return m_user_mussang_tower},bu.get_user_event_dungeon_marble_fortune=function(){return map_user_event_dungeon_marble_fortune},bu.get_user_event_dungeon_marble_golden_box_gain_log=function(){return map_user_event_dungeon_marble_golden_box_gain_log},bu.getUserMussangTowerLotusLog=function(){return m_user_mussang_tower_lotus_log},bu.get_great_wall_dungeon_list=function(){return _great_wall_dungeon_list},bu.update_User_Event_Dungeon_Reward=function(a){0<a.event_dungeon_reward_success.length&&bu.insert_User_Event_Dungeon_Reward(a.event_dungeon_reward_success),GameContext.getInstance().setUserNewMail("y")},bu.getGreatWallDungeonInfo=function(){return _great_wall_dungeon_info},bu.get_User_Mussang_Boss_info=function(){return $.extend({},User_Mussang_boss_info)},bu.set_User_Mussang_Boss_info=function(a){User_Mussang_boss_info={},User_Mussang_boss_info.user_mussang_boss_infos=$.extend([],a.user_mussang_boss_infos),User_Mussang_boss_info.user_mussang_boss_npc_info=$.extend([],a.user_mussang_boss_npc_info)},bu.get_User_Mussang_Boss_list_Cnt=function(){return User_Mussang_Boss_list_Cnt},bu.set_User_Mussang_Boss_list_Cnt=function(a){User_Mussang_Boss_list_Cnt=a},bu.set_User_Mussang_Boss_Hp=function(b,c,d){User_Mussang_boss_info.user_mussang_boss_npc_info.some(function(a){if(a.boss_dungeon_idx==b)return a.remain_hp-=c,a.remain_hp<=0&&(a.dead_yn="y"),!0}),User_Mussang_boss_info.user_mussang_boss_infos.some(function(a){a.boss_dungeon_idx==b&&(a.complete_yn=d)})},bu.get_User_Event_Raid_AccumDamage=function(a){var b=0;if(null!=User_Achieve_Info_list.event_raid_achieve)for(var i=0;i<User_Achieve_Info_list.event_raid_achieve.length;i++){var c=User_Achieve_Info_list.event_raid_achieve[i];if(c.event_dungeon_period_idx==a){b=c.accum_damage;break}}return parseInt(b)},bu.get_User_Event_Raid_ConquestCount=function(a){var b=0;if(null!=User_Achieve_Info_list.event_raid_achieve)for(var i=0;i<User_Achieve_Info_list.event_raid_achieve.length;i++){var c=User_Achieve_Info_list.event_raid_achieve[i];if(c.event_dungeon_period_idx==a){b=c.conquest_count;break}}return b},bu.get_Event_Raid_Dungeon_idx=function(){return Global_Raid_Boss_Info.event_raid_boss_info.event_raid_dungeon_idx},bu.get_Event_Raid_Dungeon_Period_idx=function(){return Global_Raid_Boss_Info.event_dungeon_period_idx},bu.get_Event_Raid_Dungeon_User_Info=function(){return User_Achieve_Info_list},bu.get_Event_Raid_Dungeon_Multiple_Type=function(){return Global_Raid_Dungeon_info.multiple_type},bu.get_User_Event_Raid_Achievement_List=function(a,b,c){for(var m=MasterTable.getInstance(),mt=MasterManager.getInstance(),m_list=(mt.get_EventDungeonName(b).name,m.get_EventRaidAchievementList(b)),i=0;i<m_list.length;i++){var d=m_list[i];if(a%2+1==d.delimiter){var e={};if(e.achv_type=d.delimiter,e.complete_count=d.complete_num,e.need_point=d.need_point,e.complete_yn="n",e.new_yn="y",a==ACHIEVEMENT_EVENTDUNGEON||a==ACHIEVEMENT_EVENTDUNGEON_2ND?1==d.delimiter?(e.achv_name=res_str("event_raid_quest_clear_1"),e.content=e.achv_name+cmString(res_str("event_raid_quest_count_1"),Number(e.need_point).toLocaleString("en"))):2==d.delimiter&&(e.achv_name=res_str("event_raid_quest_usecount_1"),e.content=e.achv_name+cmString(res_str("event_raid_quest_count_2"),Number(e.need_point).toLocaleString("en"))):a!=ACHIEVEMENT_EVENTDUNGEON_3RD&&a!=ACHIEVEMENT_EVENTDUNGEON_4RD||(1==d.delimiter?(e.achv_name=res_str("event_raid_quest_clear_2"),e.content=e.achv_name+cmString(res_str("event_raid_quest_count_1"),Number(e.need_point).toLocaleString("en"))):2==d.delimiter&&(e.achv_name=res_str("event_raid_quest_usecount_2"),e.content=e.achv_name+cmString(res_str("event_raid_quest_count_2"),Number(e.need_point).toLocaleString("en")))),null!=User_Achieve_Info_list.event_raid_achieve)for(var j=0;j<User_Achieve_Info_list.event_raid_achieve.length;j++){var f=User_Achieve_Info_list.event_raid_achieve[j];if(f.event_dungeon_period_idx==d.event_dungeon_period_idx)for(var k=0;k<f.achieve_complete.length;k++){var g=f.achieve_complete[k];g.delimiter==d.delimiter&&g.complete_num==d.complete_num&&(e.complete_yn="y","n"==g.complete_yn?e.new_yn="y":"y"==g.complete_yn&&(e.new_yn="n"))}}var h=mt.get_EventRaidAchieveCompleteBonus(b,d.delimiter,d.complete_num,1);e.bonus_type=h.bonus_type,e.bonus_type==BONUS_TYPE_YUNHEE_FIX?(e.bonus_id=h.min_value,e.bonus_count=h.max_value):e.bonus_count=h.min_value,c.push_back(e)}}},bu.getShopBuyCount=function(a){for(var b=0,i=0;i<_user_shop_buy_info.user_shop_buy_info.length;i++){var c=_user_shop_buy_info.user_shop_buy_info[i];if(c.shop_id==a){b=c.buy_count;break}}return b},bu.getUser_General=function(){return map_User_General},bu.get_Event_Panel_Gacha_Info=function(a){for(var b={},i=0;i<_event_panel_gacha_box_info.event_dungeon_panel_gacha_box_info.length;i++){var c=_event_panel_gacha_box_info.event_dungeon_panel_gacha_box_info[i];if(c.event_dungeon_period_idx==a){b=$.extend({},c);break}}return b},bu.get_Event_Panel_Gacha_Box_Idx=function(a){return _event_panel_gacha_box_pan_info.event_dungeon_panel_gacha_box_idx},bu.get_OneUser_OneTime_Free_Gacha_Buy_Log=function(){return _oneuser_onetime_free_gacha_buy_log},bu.get_OneDay_OneTime_Free_Gacha_Buy_Log=function(){return _oneday_onetime_free_gacha_buy_log},bu.insert_User_Evolution_Event=function(a){User_evolution_event={},User_evolution_event.gnrl_id=a.gnrl_key.gnrl_id,User_evolution_event.gnrl_num=a.gnrl_key.gnrl_num,User_evolution_event.state_type=a.state_type,User_evolution_event.complete_yn=a.complete_yn,User_evolution_event.recv_bonus_yn=a.recv_bonus_yn,User_evolution_event.delete_yn=a.delete_yn},bu.get_User_Evolution_Event=function(a){return User_evolution_event},bu.insert_User_Game_State=function(a){User_game_state={},User_game_state.game_state_type=a.game_state_type,User_game_state.tutorial_step=a.tutorial_step},bu.get_User_Game_State=function(a){return User_game_state},bu.insert_User_Jade_First_Buy_Log=function(a){User_jade_first_buy_log=[];for(var i=0;i<a.length;i++){var b={};b.shop_id=a[i].shop_id,b.buy_yn=a[i].buy_yn,User_jade_first_buy_log.push(b)}},bu.get_User_Jade_First_Buy_Log=function(){return User_jade_first_buy_log},bu.insert_User_main_story=function(a){User_main_story.clear();for(var b=0;b<a.length;b++){var c=a[b].main_scene_id+""+a[b].main_story_id+a[b].difficulty_type;User_main_story.insert(c,a[b])}},bu.get_User_main_story=function(){return User_main_story},bu.get_User_gacha_count=function(){return User_gacha_count},bu.get_User_info=function(){return User_info},bu.insert_User_info=function(a){User_info={};var b={};b.user_id=a.user_id,b.nickname=a.nickname,b.state_type=a.state_type,b.user_level=a.user_level,b.user_exp=a.user_exp,b.join_bonus_cmplt_yn=a.join_bonus_cmplt_yn,b.naming=a.naming,User_info=$.extend({},a)},bu.clear_object_all=function(){map_User_General=null,map_Friend_General=null,map_User_Cost_general=null,map_User_Camp_cost=null,map_User_Evolve_Arm_Service_Mtrl=null,map_User_Hwandan_Info=null,list_User_Troops_General=null,list_User_Weekly_Troops_General=null,list_User_Mail=null,map_User_Love_Item=null,res_Get_Shop_Free_General=null,_config=null,_config_v2=null,_battle_dungeon_continue=null,map_User_Limit_Over_Mtrl=null,_battle_config_v2=null,_booster_event=null,_exp_booster_item=null,_user_shop_buy_info=null,_session_msg=null,_weekly_task=null,list_Announce_Msg_Queue=null,list_Global_Booster_Event_V2=null,map_User_Equipment=null,map_User_Gnrl_Equipment=null,list_User_book_General=null,list_User_camp_cost_slot=null,m_User_main_lotus_bonus_log=null,m_user_mussang_Info=null,m_User_Battle_formation=null,m_User_formation_property_point=null,m_daily_dungeon_open_period_info=null,map_User_Equipment_option_option_change_temp=null,map_User_Equipment_bound=null,_get_Rolling_Banner_Info=null,User_Magic_Key_Mtrl=null,User_Key_Recovery_Make_Count=null,_get_Shop_Gacha_Period_Info=null,_get_Popup_Banner_Info=null,_get_User_Vote_Info=null,_get_User_Vote_League_Info=null,m_Res_Get_Event_Dungeon_Vote_Ranking_Info=null,m_Res_Get_Event_Dungeon_Vote_League_Ranking_Info=null,_great_wall_dungeon_info=null,_great_wall_dungeon_list=null,_great_wall_troops_info=null,_event_box_gacha_info_v2=null,map_user_key_bound_increase=null,map_user_weekly_open=null,map_user_event_dungeon_reward=null,map_user_event_dungeon_reward_shop=null,map_user_event_dungeon_reward_board_info=null,map_user_event_dungeon_board_map_bonus=null,map_user_event_dungeon_global_reward_log=null,map_user_event_dungeon_marble_map_info=null,map_user_event_dungeon_marble_circuit_log=null,map_user_event_dungeon_special_point_shop_log=null,map_user_event_dungeon_cutin_accum_rate=null,map_user_event_dungeon_craft_shop_material=null,map_user_event_dungeon_persnal_point_bonus_log=null,map_user_event_dungeon=null,_user_Event_Dungeon_Craft_Shop_Product_Info=null,map_user_event_dungeon_point=null,map_user_camp_branch_ability=null,map_user_prologue_v2=null,map_user_event_dungeon_special_point=null,_raid_boss_list=null,_raid_boss_history=null,_step_up_gacha_buy_log=null,_get_User_Vote_Info=null,m_Res_Get_Event_Dungeon_Vote_League_Ranking_Record=null,list_User_Event_Dungeon_Vote_League_Record=null,m_Res_Get_Event_Dungeon_Vote_Ranking_Info=null,map_notice_list=null,map_achievement_list=null,map_user_troops=null,m_user_yunhee_bound=null,m_user_illust=null,_user_gacha_ticket=null,_user_special_gacha_ticket=null,list_User_Box_Gacha_Info=null,list_User_Box_Gacha_progress_Info=null,m_premium_login_dmm_point_key=null,m_Res_Get_User_Equipment_Box_Gacha_Info=null,m_user_beginner_booster=null,m_user_mussang_tower=null,m_user_mussang_tower_task=null,m_user_mussang_tower_lotus_log=null,m_user_naming=null,map_User_Rebirth_Mtrl=null,map_User_Event_Dungeon_Search_Troops=null,map_User_Event_Dungeon_Search_Troops_Generals=null,map_Event_Dungeon_Search_Area_Info=null,m_Res_Get_User_Event_Dungeon_Christmas_Info=null,m_Res_Get_Event_Dungeon_Vote_League_Yunhee_Info=null,m_Res_Get_User_Event_Dungeon_Satisfaction_Info=null,map_user_event_dungeon_once_a_day=null,map_user_event_dungeon_personal_point_bonus_log=null,map_user_event_dungeon_christmas_reward=null,map_user_event_dungeon_christmas_total_reward_info=null,map_user_ceiling_gacha_info=null,map_user_event_dungeon_marble_fortune=null,map_user_event_dungeon_marble_golden_box_gain_log=null,map_User_Extra_Box_Init_Info=null,list_User_Box_Gacha_Golden_Barrel_Info=null,map_User_Food_List=null,map_user_event_dungeon_vote_league_reward=null,map_user_event_dungeon_vote_league_use_point_reward=null,map_user_main_mission_task=null,map_user_main_mission=null,User_evolution_event=null,User_game_state=null,User_daily_dungeon=null,User_jade_first_buy_log=null,User_main_story=null,User_info=null,User_item_info=null,_evolve_Stone_Count=null},bu}function addMethod(b,c,d){if(b[c]=b[c]||function(){var a=b[c].cache[arguments.length];if(a)return a.apply(this,arguments);throw new Error("Wrong number of arguments")},b[c].cache=b[c].cache||{},b[c].cache[d.length])throw new Error("Cannot define multiple '"+c+"' methods with the same number of arguments!");b[c].cache[d.length]=function(){return d.apply(this,arguments)}}var EventDungeonService,callback_PacketList=function(a,b,c,d){SceneManager.getInstance().getMainScene().onNetworkEvent(a,b,c),(new NetService).next_PacketList(d)},BOX_GACHA_ITEM_COUNT=80;EventDungeonService=function(){var o,m_event_dungeon_vote_prev_ranking_league_group_idx=0;function EventDungeonService(){return{getUserEventDungeonReward:function(a,b){for(var c=MasterTable.getInstance().get_EventDungeonReward(a),i=0;i<c.length;i++){var r=c[i],item=new db.UserEventDungeonReward;item.event_dungeon_reward_idx=r.event_dungeon_reward_idx,item.event_dungeon_period_idx=a,item.reward=r,b.push(item)}EventDungeonTable.getInstance().sel_UserEventDungeonReward(m_user_id,b)},getUserEventDungeonRewardShop:function(a,b){for(var c=MasterTable.getInstance().get_EventDungeonRewardShop(a),i=0;i<c.length;i++){var s=c[i],item=new db.UserEventDungeonRewardShop;item.event_dungeon_reward_shop_idx=s.event_dungeon_reward_shop_idx,item.event_dungeon_period_idx=a;var d=(item.reward=s).add_buy_count,add_event_dungeon_period_idx=s.add_event_dungeon_period_idx;this.IsOpenDungeon(add_event_dungeon_period_idx)&&(item.reward.buy_try_count=item.reward.buy_try_count+d),b.push(item)}EventDungeonTable.getInstance().sel_UserEventDungeonRewardShop(m_user_id,b)},getUserEventDungeonPersonalPointBonusInfo:function(a,b){b.clear();var m=MasterTable.getInstance(),step_list=m.get_EventDungeonPersonalPointInfo(a),point=new db.UserEventDungeonPoint;this.getUserEventDungeonPoint(a,point);for(var i=0;i<step_list.length;i++){var p=step_list[i],info=new db.UserEventDungeonPersonalAccmPointReward;info.point_info_idx=p.step,info.event_dungeon_period_idx=p.event_dungeon_group_idx,info.point_info=p,info.user_accum_event_dungeon_point=point.accum_event_point,info.accm_point=p.accm_point,m.get_EventDungeonPersonalPointBonusList(p.step,info.rewards),b.push(info)}EventDungeonTable.getInstance().sel_UserEventDungeonPersonalPointAccmReward(m_user_id,b)},getUserEventDungeonRewardBoardInfo:function(b,c){var d={};this.getUserEventDungeonPoint(b,d);for(var m=MasterTable.getInstance(),map_list=[],info_list=m.get_EventDungeonRewardBoardInfo(b),i=0;i<info_list.length;i++){var e=info_list[i];(h=new db.UserEventDungeonRewardBoardInfo).event_dungeon_period_idx=e.event_dungeon_period_idx,h.event_dungeon_reward_board_info_idx=e.event_dungeon_reward_board_info_idx,h.board_info=e,h.event_point=d.event_point,map_list=m.get_EventDungeonRewardBoardMap(e.event_dungeon_reward_board_info_idx);for(var a=0;a<map_list.length;a++){var f=map_list[a],board_map=new db.UserEventDungeonRewardBoardMap;board_map.event_dungeon_period_idx=e.event_dungeon_period_idx,board_map.event_dungeon_reward_board_info_idx=e.event_dungeon_reward_board_info_idx,board_map.event_dungeon_reward_board_map_idx=f.event_dungeon_reward_board_map_idx,board_map.event_point=d.event_point,board_map.map_info=f,board_map.reward_list=m.get_EventDungeonRewardBoardMapBonus(f.event_dungeon_reward_board_map_idx),h.map_list.push(board_map)}c.push(h)}var t=EventDungeonTable.getInstance();t.sel_UserEventDungeonRewardBoardInfo(m_user_id,c);for(var g=0;g<c.length;g++){var h=c[g];t.sel_UserEventDungeonRewardBoardMap(m_user_id,h.map_list)}},getUserEventDungeonGlobalPointInfo:function(a,b){for(var m=MasterTable.getInstance(),step_list=m.get_EventDungeonGlobalPoint(a),i=0;i<step_list.length;i++){var p=step_list[i],info=new db.UserEventDungeonGlobalPointInfo;info.event_dungeon_global_point_idx=p.event_dungeon_global_point_idx,info.event_dungeon_period_idx=p.event_dungeon_period_idx,info.point_info=p,info.rewards=m.get_EventDungeonGlobalPointBonus(p.event_dungeon_global_point_idx),b.push(info)}EventDungeonTable.getInstance().sel_UserEventDungeonGlobalPointInfo(m_user_id,b)},getUserEventDungeonMarbleMapInfo:function(a,b){if(EventDungeonTable.getInstance().sel_UserEventDungeonMarbleMapInfo(m_user_id,a,b),0==b.event_dungeon_marble_map_info_idx){var c=MasterTable.getInstance().get_EventDungeonMarbleMapInfoList(a);if(0<c.length){var d=c[0];b.event_dungeon_period_idx=d.event_dungeon_period_idx,b.event_dungeon_marble_map_info_idx=d.event_dungeon_marble_map_info_idx,b.circuit_count=0}}},getUserEventDungeonMarbleCircuitList:function(a,b){var m=MasterTable.getInstance(),map_info={};this.getUserEventDungeonMarbleMapInfo(a,map_info);for(var d=m.get_EventDungeonMarbleCircuitInfoList(a),i=0;i<d.length;i++){var c=d[i],info={};info.event_dungeon_period_idx=c.event_dungeon_period_idx,info.event_dungeon_marble_circuit_info_idx=c.event_dungeon_marble_circuit_info_idx,info.circuit_count=null!=map_info.circuit_count?map_info.circuit_count:0,info.circuit_info=c,info.bonus_list=m.get_EventDungeonMarbleCircuitBonusList(c.event_dungeon_marble_circuit_info_idx,info.bonus_list),b.push(info)}EventDungeonTable.getInstance().sel_UserEventDungeonMarbleCircuitInfo(m_user_id,b)},getUserEventDungeonMarbleFortune:function(a,b){EventDungeonTable.getInstance().sel_UserEventDungeonMarbleFortune(m_user_id,a,b)},getUserEventDungeonMarbleGoldenBoxInfo:function(a,c){MasterManager.getInstance();for(var d=MasterTable.getInstance().get_EventDungeonMarbleGoldenBoxList(a,18),g_idx=0;g_idx<d.length;g_idx++){var b=d[g_idx],info=new db.UserEventDungeonMarbleGoldenBoxInfo;info.event_dungeon_period_idx=b.event_dungeon_period_idx,info.golden_box_idx=b.golden_box_idx,info.gain_count=0,info.golden_box_info=b,c.push_back(info)}EventDungeonTable.getInstance().sel_UserEventDungeonMarbleGoldenBoxInfo(m_user_id,c)},getMaxEventDungeonMarbleCircuitCount:function(b){var c=MasterManager.getInstance().get_AllEventDungeonMarbleCircuitInfo().filter(function(a){return a.event_dungeon_period_idx==b});return c.sort(function(l,r){return r.target_count-l.target_count}),c[0].target_count},getUserEventDungeonSpecialPointShopList:function(a,b){var c={},shop_list=[];MasterTable.getInstance().get_EventDungeonSpecialPointShopList(a,shop_list);for(var i=0;i<shop_list.length;i++){var s=shop_list[i],info={};info.event_dungeon_period_idx=s.event_dungeon_period_idx,info.event_dungeon_special_point_shop_idx=s.event_dungeon_special_point_shop_idx,info.shop=s,info.user_special_point=c.special_point,info.user_accum_special__point=c.accum_special_point,b.push(info)}EventDungeonTable.getInstance().sel_UserEventDungeonSpecialPointShop(m_user_id,b)},getUserEventDungeonCraftShopMaterial:function(a){null==a&&(a=EVENT_DUNGEON_TYPE_LINLIN);for(var b=[],m_dungeon_craft_shop_material=NetService().get_user_event_dungeon_craft_shop_material(),keys=m_dungeon_craft_shop_material.keys(),idx=0;idx<keys.length;idx++){var m={},material=m_dungeon_craft_shop_material.at(keys[idx]);a==EVENT_DUNGEON_TYPE_LINLIN?material.craft_shop_bonus_type>CRAFT_SHOP_BONUS_TYPE_CRYSTAL_PIECE&&material.craft_shop_bonus_type<=CRAFT_SHOP_BONUS_TYPE_TOTAL_LEGEND&&(m.craft_shop_bonus_type=material.craft_shop_bonus_type,m.material_count=material.material_count,b.push_back(m)):material.craft_shop_bonus_type>CRAFT_SHOP_BONUS_TYPE_TOTAL_LEGEND&&(m.craft_shop_bonus_type=material.craft_shop_bonus_type,m.material_count=material.material_count,b.push_back(m))}return b},getMaxChangeCraftShopMaterialUnitCount:function(a,b){},getMaxChangeCraftShopEventPointUnitCount:function(a,b){},getEventDungeonCraftShopItemRecipeList:function(d,e){var f=MasterManager.getInstance().get_All_EventDungeonCraftShopProductRecipe(),m_event_dungeon_craft_shop_product_item=MasterManager.getInstance().get_All_EventDungeonCraftShopProductItem();f.forEach(function(c){m_event_dungeon_craft_shop_product_item.forEach(function(a){if(c.event_dungeon_period_idx==a.event_dungeon_period_idx&&c.product_recipe_id==a.product_recipe_id){var b={};b.product_recipe_id=c.product_recipe_id,b.product_item_id=a.product_item_id,b.event_dungeon_period_idx=c.event_dungeon_period_idx,b.mtrl_1=c.mtrl_1,b.need_cnt1=c.need_cnt_1,b.mtrl_2=c.mtrl_2,b.need_cnt2=c.need_cnt_2,b.mtrl_3=c.mtrl_3,b.need_cnt3=c.need_cnt_3,b.product_enable_cnt=c.product_enable_cnt,b.bonus_type=a.bonus_type,b.min_value=a.min_value,b.max_value=a.max_value,b.cool_time=a.cool_time,e.push(b)}})})},getUserEventDungeonSpecialPoint:function(a,b){var c=(new NetService).get_user_event_dungeon_special_point().at([m_user_id,a]);b.accum_special_point=null==c?(b.event_dungeon_period_idx=a,b.special_point=0):(b.event_dungeon_period_idx=c.event_dungeon_period_idx,b.special_point=c.point,c.accum_point)},getUserEventDungeonPoint:function(a,b){var c=(new NetService).get_user_event_dungeon_point().at([m_user_id,a]);b.accum_event_point=null==c?(b.event_dungeon_period_idx=a,b.event_point=0):(b.event_dungeon_period_idx=c.event_dungeon_period_idx,b.event_point=c.event_point,c.accum_event_point)},isEnableCraftShopMakeItem:function(a){for(var b=MasterManager.getInstance().get_EventDungeonCraftShopProductRecipe(a),craft_shop_material_list=this.getUserEventDungeonCraftShopMaterial(),idx=0;idx<craft_shop_material_list.length;idx++){var i=craft_shop_material_list[idx];if(i.craft_shop_bonus_type==b.mtrl_1){if(i.material_count<b.need_cnt_1)return!1}else if(i.craft_shop_bonus_type==b.mtrl_2){if(i.material_count<b.need_cnt_2)return!1}else if(i.craft_shop_bonus_type==b.mtrl_3&&i.material_count<b.need_cnt_3)return!1}return!0},getEventDungeonVDYunheeIdx:function(a){var b=0,y=MasterTable.getInstance().get_AllEventDungeonVdYunhee();for(var c in y)if(c.idx==a){b=c.idx;break}return b},getEventDungeonVDYunheeGnrlId:function(a){return MasterTable.getInstance().get_EventDungeonVdYunhee(a).gnrl_id},getEventDungeonVDYunheeList:function(c){var d=MasterTable.getInstance(),yunee_list=[];d.get_EventDungeonVdYunheeList(yunee_list);for(var e=0;e<yunee_list.length;e++){var f=yunee_list[e],g=d.get_General(f.gnrl_id),info=new db.UserGeneralInfo;info.gnrl_id=g.gnrl_id,info.name=g.name,info.gnrl_type=g.gnrl_type,info.state_type=g.state_type,info.class_type=g.gnrl_class,info.gnrl_group=g.gnrl_group,info.max_level=g.max_level,info.element_type=g.element_type,info.arm_service_type=g.arm_service_type,info.fight_type=g.fight_type,info.cost=g.cost,info.attk=g.attk,info.def=g.def,info.hp=g.hp,info.sp=g.sp,info.gnrl_level=1,info.sell_gold=g.sell_gold,info.sell_yhpt=g.sell_yhpt,info.level_exp_group=g.level_exp_group,info.max_class_type=g.evolution_max_class_type,info.rare_type=g.rare_type,info.passive_skill.push_back(g.passive_skill_id),info.leader_skill.push_back(g.leader_skill_id),g.trans_passive_skill_id.split(",").forEach(function(a){var b=parseInt(a);info.trans_passive_skill.push_back(b)}),g.special_leader_skill_id=g.special_leader_skill_id+"";for(var h=g.special_leader_skill_id.split(","),jdx=0;jdx<h.length;jdx++){var s=h[jdx];info.special_leader_skill.push_back(1*s)}c.push(info)}},getUserEventDungeonCutinAccumRatePoint:function(a,b){var c=MasterManager.getInstance().get_EventDungeonPeriod(a);EventDungeonTable.getInstance().sel_UserEventDungeonCutinAccumRatePoint(m_user_id,c.event_dungeon_group_idx,b)},getEventDungeonMiddleHalfPeriodIdx:function(a){for(var m=MasterTable.getInstance(),first_half_period_idx=this.getEventDungeonFirstHalfPeriodIdx(a),second_half_period_idx=this.getEventDungeonSecondHalfPeriodIdx(a),list=m.get_EventDungeonPeriodList(a),idx=0;idx<list.length;idx++){var p=list[idx];if(first_half_period_idx<p.event_dungeon_period_idx&&second_half_period_idx>p.event_dungeon_period_idx){p.event_dungeon_period_idx;break}}return second_half_period_idx-1},getEventDungeonSecondHalfPeriodIdx:function(a){var b=0,list=MasterTable.getInstance().get_EventDungeonPeriodList(a);return 0<(list=stable(list,function(l,r){return l.event_dungeon_period_idx>r.event_dungeon_period_idx})).length&&(b=list[list.length-1].event_dungeon_period_idx),b},getEventDungeonFirstHalfPeriodIdx:function(a){var b=0,list=MasterTable.getInstance().get_EventDungeonPeriodList(a);return 0<(list=stable(list,function(l,r){return l.event_dungeon_period_idx>r.event_dungeon_period_idx})).length&&(b=list[0].event_dungeon_period_idx),b},getEventDungeonGrowthRemainNextLevelNeedPoint:function(a,b,c){if(this.getEventDungeonGrowthMaxLevel(c)<=a)return 0;var d=a+1;return MasterManager.getInstance().get_EventDungeonGrowthLevel(d,c).accm_point-b},getEventDungeonGrowthRemainMaxtLevelNeedPoint:function(a,b,c){for(var d=MasterManager.getInstance(),target_level=0,standard_level=0,level_list=MasterTable.getInstance().get_EventDungeonGrowthLevelUpInfoList(c),max_level=(level_list=stable(level_list,function(l,r){return l.growth_level>r.growth_level}))[level_list.length-1].growth_level,i=0;i<level_list.length;i++)if(1==level_list[i].right_reward_yn){standard_level=level_list[i].growth_level;break}(target_level=standard_level)<=a&&(target_level=max_level);var e=d.get_EventDungeonGrowthLevel(target_level,c).accm_point,need_point=b;if(standard_level<=a){var f=d.get_EventDungeonGrowthLevel(standard_level,c);e-=f.accm_point,need_point-=f.accm_point}return e-need_point},getEventDungeonGrowthTargetLevel:function(a,b,c){MasterManager.getInstance();for(var d=0,level_list=MasterTable.getInstance().get_EventDungeonGrowthLevelUpInfoList(c),level_list_desc=stable(level_list,function(l,r){return l.growth_level>r.growth_level}),i=0;i<level_list_desc.length;i++)if(1==level_list_desc[i].right_reward_yn){d=level_list_desc[i].growth_level;break}return d},getEventDungeonGrowthNextLevelPercent:function(a,b,c){if(this.getEventDungeonGrowthMaxLevel(c)<=a)return 100;var d=a+1,next_level_info=MasterManager.getInstance().get_EventDungeonGrowthLevel(d,c),total_point=next_level_info.need_point;return(total_point-(next_level_info.accm_point-b))/total_point*100},IsOpenEventPointPeriod:function(a){var c=MasterManager.getInstance().get_EventDungeonPeriod(a),now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),b=moment(c.event_dungeon_point_beg_dt).valueOf();b+=1e3*c.begin_time;var e=moment(c.event_dungeon_point_end_dt).valueOf();return e+=1e3*c.end_time,b<=n&&n<=e},getEventDungeonGrowthMaxLevel:function(a,b,c){MasterManager.getInstance();if(1==arguments.length){c=a;var d=MasterTable.getInstance().get_EventDungeonGrowthLevelUpInfoList(c);return max_level=(d=stable(d,function(l,r){return l.growth_level>r.growth_level}))[d.length-1].growth_level}for(var e=0,standard_level=0,max_level=(d=MasterTable.getInstance().get_EventDungeonGrowthLevelUpInfoList(c),(d=stable(d,function(l,r){return l.growth_level>r.growth_level}))[d.length-1].growth_level),i=0;i<d.length;i++)if(1==d[i].right_reward_yn){standard_level=d[i].growth_level;break}return(e=standard_level)<=a&&(e=max_level),e},getEventDungeonGrowhthRightNotRewardBeginLevel:function(a){var b=MasterTable.getInstance().get_EventDungeonGrowthLevelUpInfoList(a);b.sort(function(l,r){return l.growth_level-r.growth_level});b[b.length-1].growth_level;for(var i=0;i<b.length;i++)if(1==b[i].right_reward_yn)return b[i].growth_level;return 0},getEventDungeonGrowthLevelFromLevelPoint:function(a,b){var c=0,level_list=MasterTable.getInstance().get_EventDungeonGrowthLevelList(a);level_list.sort(function(l,r){return l.growth_level-r.growth_level});for(var i=0;i<level_list.length;i++)level_list[i].accm_point<=b&&(c=level_list[i].growth_level);return c},getEventDungeonGrowthNextLevelPercent:function(a,b,c){var d=MasterManager.getInstance(),next_level=a+1,max_level=this.getEventDungeonGrowthMaxLevel(c);max_level<next_level&&(next_level=max_level);var e=d.get_EventDungeonGrowthLevel(next_level,c),total_point=e.need_point,prcnt=(total_point-(e.accm_point-b))/total_point*100;return 100<prcnt&&(prcnt=100),prcnt},getEventDungeonGrowthMaxLevelNeedPoint:function(a){var b=MasterTable.getInstance().get_EventDungeonGrowthLevelList(a);return b.sort(function(l,r){return l.growth_level-r.growth_level}),b[b.length-1].accm_point},getEventDungeonGrowthLevelPercent:function(a,b,c){for(var d=MasterManager.getInstance(),target_level=0,standard_level=0,level_list=MasterTable.getInstance().get_EventDungeonGrowthLevelUpInfoList(c),max_level=(level_list=stable(level_list,function(l,r){return l.growth_level>r.growth_level}))[level_list.length-1].growth_level,idx=0;idx<level_list.length;idx++){var e=level_list[idx];if(1==e.right_reward_yn){standard_level=e.growth_level;break}}(target_level=standard_level)<=a&&(target_level=max_level);var f=d.get_EventDungeonGrowthLevel(target_level,c).accm_point,need_point=b;if(standard_level<=a){var g=d.get_EventDungeonGrowthLevel(standard_level,c);f-=g.accm_point,need_point-=g.accm_point}var h=need_point/f*100;return max_level<=a&&(h=100),h},IsOpenDungeon:function(a){var c=MasterManager.getInstance().get_EventDungeonPeriod(a),now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),b=moment(c.begin_dt).valueOf();b+=1e3*c.begin_time;var e=moment(c.end_dt).valueOf();return e+=1e3*c.end_time,b<=n&&n<=e},IsOpenEventDungeonBuff:function(a){var c=MasterManager.getInstance().get_EventDungeonBuffPeriod(a),now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),b=moment(c.beg_dt).valueOf(),e=moment(c.end_dt).valueOf();return b<=n&&n<=e},IsExistDungeon:function(a){var b=MasterManager.getInstance().get_EventDungeonPeriod(a);return 0!=b.event_dungeon_period_idx&&null!=b.event_dungeon_period_idx},getUserEventDungeonBoxGachaGoldenBarrelCountInfo:function(c){var d=[],box_gacha=MasterManager.getInstance().get_EventDungeonBoxGachaInfo(c),user_box_gacha_golden_barrel_list=NetService().get_User_Event_Dungeon_Box_Gacha_Golden_Barrel_info_List(),item_list=MasterTable.getInstance().get_EventDungeonBoxGachaGoldenBarrelList(box_gacha.event_dungeon_period_idx),map_info=new Map;item_list.forEach(function(i){var a={};a.max_count=i.count,a.bonus_type=i.bonus_type,a.item_id=i.min_value,a.event_dungeon_period_idx=box_gacha.event_dungeon_period_idx,a.bonus_count=i.max_value,a.user_count=0,a.sort_num=i.sort_num,map_info.insert([i.bonus_type,i.min_value],a)});for(var e=map_info.keys(),idx=0;idx<e.length;idx++){var f=map_info.at(e[idx]);user_box_gacha_golden_barrel_list.forEach(function(a){var b={};b.bonus_type=a.bonus_type,b.min_value=a.item_idx,f.bonus_type==b.bonus_type&&f.item_id==b.min_value&&a.box_gacha_info_idx==c&&0<a.item_idx&&(f.user_count+=a.item_count)}),d.push_back(f)}return d.sort(function(l,r){return l.sort_num-r.sort_num}),d},MakeCountCraftShopMtrl:function(a){for(var b=MasterManager.getInstance(),g=GeneralService.getInstance(),c=b.get_EventDungeonMaterialExchange(a),craft_shop_mtrl_type_1=g.getBonusTypeToCraftShopMtrlType(c.bonus_type),craft_shop_mtrl_type_2=g.getBonusTypeToCraftShopMtrlType(c.bonus_type_2),list=this.getUserEventDungeonCraftShopMaterial(),mtrl_1_need_cnt=c.need_count,mtrl_2_need_cnt=c.need_count_2,mtrl_count_1=-1,mtrl_count_2=-1,i=0;i<list.length;i++)list[i].craft_shop_bonus_type==craft_shop_mtrl_type_1&&(mtrl_count_1=0<list[i].material_count?list[i].material_count/mtrl_1_need_cnt:0),list[i].craft_shop_bonus_type==craft_shop_mtrl_type_2&&0!=craft_shop_mtrl_type_2&&(mtrl_count_2=0<list[i].material_count?list[i].material_count/mtrl_2_need_cnt:0);return-1==mtrl_count_2?mtrl_count_1:mtrl_count_2<=mtrl_count_1?mtrl_count_2:mtrl_count_1},isMakeCraftShopMtrl:function(a,b){for(var d=MasterManager.getInstance(),g=GeneralService.getInstance(),c=d.get_EventDungeonMaterialExchange(a),craft_shop_mtrl_type_1=g.getBonusTypeToCraftShopMtrlType(c.bonus_type),craft_shop_mtrl_type_2=g.getBonusTypeToCraftShopMtrlType(c.bonus_type_2),mtrl_1_need_cnt=c.need_count*b,mtrl_2_need_cnt=c.need_count_2*b,list=this.getUserEventDungeonCraftShopMaterial(),idx=0;idx<list.length;idx++){var i=list[idx];if(i.craft_shop_bonus_type==craft_shop_mtrl_type_1&&i.material_count<mtrl_1_need_cnt)return!1;if(i.craft_shop_bonus_type==craft_shop_mtrl_type_2&&0!=craft_shop_mtrl_type_2&&i.material_count<mtrl_2_need_cnt)return!1}return!0},isMakeCraftShopMtrlFirstSecondHalf:function(a){for(var b=MasterTable.getInstance().get_EventDungeonCraftShopMtrlDisplayList(),event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),second_half_period_idx=this.getEventDungeonSecondHalfPeriodIdx(period.event_dungeon_group_idx),idx=0;idx<b.length;idx++){var l=b[idx];if(l.craft_shop_bonus_type==a){if(1==l.first_second_half)return!0;if(2==l.first_second_half&&this.IsOpenDungeon(second_half_period_idx))return!0}}},getUserEventDungeonBoxGachaCountInfo:function(a,b){for(var c=MasterManager.getInstance(),user_box_gacha_info_list=NetService().get_User_Event_Dungeon_Box_Gacha_Info_List(),item_list=MasterTable.getInstance().get_EventDungeonBoxGachaItemList(a),box_gacha_info=c.get_EventDungeonBoxGachaInfo(a),map_info=new Map,idx=0;idx<item_list.length;idx++){var i=item_list[idx],item_key=new Map,map_obj=map_info.at([i.bonus_type,i.min_value]),count=0;null==map_obj?count=1:(count=map_obj.max_count,count++),map_info.insert([i.bonus_type,i.min_value],{}),map_info.at([i.bonus_type,i.min_value]).max_count=count,map_info.at([i.bonus_type,i.min_value]).bonus_type=i.bonus_type,map_info.at([i.bonus_type,i.min_value]).item_id=i.min_value,map_info.at([i.bonus_type,i.min_value]).event_dungeon_period_idx=box_gacha_info.event_dungeon_period_idx,map_info.at([i.bonus_type,i.min_value]).box_gacha_info_idx=a,map_info.at([i.bonus_type,i.min_value]).bonus_count=i.max_value,map_info.at([i.bonus_type,i.min_value]).item_idx=i.item_idx,map_info.at([i.bonus_type,i.min_value]).user_count=0}var d=map_info.keys();for(idx=0;idx<d.length;idx++){for(var e=map_info.at(d[idx]),jdx=0;jdx<user_box_gacha_info_list.length;jdx++){var f=user_box_gacha_info_list[jdx],gacha_item=(item_key=new Map,c.get_EventDungeonBoxGachaItem(f.item_idx));item_key.insert(gacha_item.bonus_type,gacha_item.min_value),e.bonus_type==gacha_item.bonus_type&&e.item_id==gacha_item.min_value&&f.event_dungeon_period_idx==box_gacha_info.event_dungeon_period_idx&&f.box_gacha_info_idx==box_gacha_info.box_gacha_info_idx&&e.user_count++}b.push(e)}b.sort(function(l,r){return l.item_idx-r.item_idx})},isBoxGachaOpenItem:function(a){for(var b=GameContext.getInstance().getEventDungeonBoxGachaInfoIdx(),list=NetService().get_User_Event_Dungeon_Box_Gacha_Info_List(b),idx=0;idx<list.length;idx++)if(0!=list[idx].item_idx&&list[idx].item_num==a)return!0;return!1},isBoxGachaAllOpen:function(a){return-1==NetService().get_User_Event_Dungeon_Box_Gacha_Info_List(a).findIndex(function(r){return 0==r.item_idx})},isBoxGachaNotOpen:function(a){return-1==NetService().get_User_Event_Dungeon_Box_Gacha_Info_List(a).findIndex(function(r){return 0<r.item_idx})},getEventDungeonBoxGachaNeedPoint:function(){for(var a={},mt=MasterManager.getInstance(),netService=NetService(),box_gacha_info_idx=GameContext.getInstance().getEventDungeonBoxGachaInfoIdx(),progress_list=netService.get_User_Event_Dungeon_Box_Gacha_Info_Progress_List(),round_count=0,idx=0;idx<progress_list.length;idx++){var l=progress_list[idx];if(l.box_gacha_info_idx==box_gacha_info_idx){round_count=l.round_count,l.second_round_yn;break}}var b=mt.get_GoodsFunction(GOODS_FUNCTION_BOX_GACHA_MOVING),add_expense=b.value;add_expense=0<round_count?1*b.value:0*b.value,a=MasterTable.getInstance().get_EventDungeonBoxGachaExpenseInfo(box_gacha_info_idx);var c=parseInt(a.need_count_1)+parseInt(add_expense);a.need_count_1=c;var d=parseInt(a.need_count_2)+parseInt(add_expense);return a.need_count_2=d,a},isBoxGachaMainItem:function(a,b){for(var c=MasterManager.getInstance().get_EventDungeonBoxGachaMainItem(b),list=MasterTable.getInstance().get_EventDungeonBoxGachaMainItemGroup(c.main_item_group_idx),idx=0;idx<list.length;idx++){if(list[idx].main_item_idx==b)return!0}return!1},getEventDungeonNextBoxGachaIdx:function(){var b=MasterManager.getInstance(),box_gacha_info_idx=GameContext.getInstance().getEventDungeonBoxGachaInfoIdx(),box_gacha_info=b.get_EventDungeonBoxGachaInfo(box_gacha_info_idx),infolist=[],tampinfolist=[];return b.getAllEventDungeonBoxGachaInfo().forEach(function(a){a.event_dungeon_period_idx==box_gacha_info.event_dungeon_period_idx&&1!=box_gacha_info.extra_box&&infolist.push(a)}),infolist.sort(function(l,r){return l.box_gacha_info_idx<r.box_gacha_info_idx?1:l.box_gacha_info_idx>r.box_gacha_info_idx?-1:0}),(tampinfolist=infolist)[1].box_gacha_info_idx<=box_gacha_info_idx?tampinfolist.pop().box_gacha_info_idx:++box_gacha_info_idx},getEventDungeonMaxBoxGachaIdx:function(){var b=MasterTable.getInstance(),box_gacha_info_idx=GameContext.getInstance().getEventDungeonBoxGachaInfoIdx(),box_gacha_info=b.get_EventDungeonBoxGachaInfo(box_gacha_info_idx),infolist=[];return b.getAllEventDungeonBoxGachaInfo().forEach(function(a){a.event_dungeon_period_idx==box_gacha_info.event_dungeon_period_idx&&infolist.push(a)}),infolist.sort(function(l,r){return l.event_dungeon_period_idx<r.event_dungeon_period_idx?1:l.event_dungeon_period_idx>r.event_dungeon_period_idx?-1:0}),infolist[0].event_dungeon_period_idx},get_VoteEventYunheeList:function(a){for(var m=MasterTable.getInstance(),mt=MasterManager.getInstance(),vote_gnrl_list=m.get_VoteEventYunheeList(a),list=[],idx=0;idx<vote_gnrl_list.length;idx++){var b=vote_gnrl_list[idx],gnrl=mt.get_General(b.thumb_num),info=$.extend({},db.VoteEventYunheeInfo);info.event_dungeon_period_idx=b.event_dungeon_period_idx,info.vote_event_yunhee_idx=b.vote_event_yunhee_idx,info.thumb_num=b.thumb_num,info.gnrl_group=b.gnrl_group,info.name=b.name,info.img_num=b.img_num,info.state_type=gnrl.state_type,info.user_vote_ranking=1e3,info.name_sort_num=b.name_sort_num;for(var c=NetService().get_User_Event_Dungeon_Vote_Info_List(),i=0;i<c.length;i++)c[i].event_dungeon_period_idx==b.event_dungeon_period_idx&&c[i].vote_yunhee_idx==b.vote_event_yunhee_idx&&(info.user_vote_ranking=c[i].ranking);list.push(info)}return list},get_VoteEventVoteLeagueYunheeList:function(a){for(var b=NetService().get_Event_Dungeon_Vote_League_Yunhee_Candidate_List(),m=MasterTable.getInstance(),mt=MasterManager.getInstance(),list=[],idx=0;idx<b.length;idx++){var c=b[idx],vote_yunhee_info=m.get_EventDungeonVoteLeagueYunheeInfo(a,c.league_yunhee_idx),gnrl=mt.get_General(vote_yunhee_info.thumb_num),info=$.extend({},db.VoteEventYunheeInfo);info.event_dungeon_period_idx=vote_yunhee_info.event_dungeon_period_idx,info.vote_event_yunhee_idx=vote_yunhee_info.league_yunhee_idx,info.thumb_num=vote_yunhee_info.thumb_num,info.gnrl_group=vote_yunhee_info.gnrl_group,info.name=vote_yunhee_info.name,info.img_num=vote_yunhee_info.img_num,info.state_type=gnrl.state_type,info.user_vote_ranking=1e3,info.league_idx=c.league_idx,info.name_sort_num=c.display_num,list.push(info)}return list},getEventDungeonBoxGachaFirstBoxGachaInfoIdx:function(b){var c=MasterManager.getInstance(),box_gacha_info=c.get_EventDungeonBoxGachaInfoByPeroidIDX(b),infolist=[];c.getAllEventDungeonBoxGachaInfo().forEach(function(a){a.event_dungeon_period_idx==box_gacha_info.event_dungeon_period_idx&&infolist.push(a)}),infolist.sort(function(l,r){return l.event_dungeon_period_idx>r.event_dungeon_period_idx?1:l.event_dungeon_period_idx<r.event_dungeon_period_idx?-1:0});var d=infolist[0].box_gacha_info_idx;return infolist=null,d},getEventDungeonGrowthLevelUpBonusType:function(a,b){var c={},mt=MasterManager.getInstance(),level_list=MasterTable.getInstance().get_EventDungeonGrowthLevelUpInfoList(a);level_list.sort(function(l,r){return l.growth_level-r.growth_level});for(var d=0,idx=0;idx<level_list.length;idx++){var l=level_list[idx];1==l.right_reward_yn&&l.growth_level<=b&&(d=l.reward_idx)}var e=mt.get_EventDungeonGrowthLevelUpRewardInfo(d);return c.bonus_type=e.bonus_type,c.min_value=e.min_value,c.max_value=e.max_value,c},getUserEventDungeonGrowthLevelUpRewardInfo:function(a,b){for(var c=MasterManager.getInstance(),list=MasterTable.getInstance().get_EventDungeonGrowthLevelUpInfoList(a),idx=0;idx<list.length;idx++){var i=list[idx],reward=c.get_EventDungeonGrowthLevelUpRewardInfo(i.reward_idx),info={};info.event_dungeon_group_idx=i.event_dungeon_group_idx,info.growth_level=i.growth_level,info.reward_idx=i.reward_idx,info.right_reward_yn=i.right_reward_yn,info.is_user_level=!1,info.is_right_now_reward=!1,info.subject=reward.subject,b.push_back(info)}var d=NetService().get_User_Event_Dungeon_Growth_Info(d);b=stable(b,function(l,r){return l.growth_level<r.growth_level});for(idx=0;idx<b.length;idx++)if(b[idx].growth_level<=d.growth_level){b[idx].is_user_level=!0;break}b=stable(b,function(l,r){return l.growth_level>r.growth_level});for(idx=0;idx<b.length;idx++)if(1==b[idx].right_reward_yn){b[idx].is_right_now_reward=!0;break}},getEventDungeonSatisfactionMaxLevel:function(a){var b={max_level:0,max_point:0},level_list=MasterTable.getInstance().get_EventDungeonSatisfactionLeveList(a);return level_list.sort(function(l,r){return l.satisfaction_level-r.satisfaction_level}),b.max_level=level_list[level_list.length-1].satisfaction_level,b.max_point=level_list[level_list.length-1].accm_point,b},getEventDungeonSatisfactionLevelPercent:function(a,b,c,d){var e=MasterTable.getInstance();if(3==arguments.length){(h=e.get_EventDungeonSatisfactionLeveList(b)).sort(function(l,r){return l.satisfaction_level-r.satisfaction_level});var f=c+1;(j=h[h.length-1].satisfaction_level)<f&&(f=j);var g=MasterManager.getInstance().get_EventDungeonSatisfactionLevel(c),total_point=MasterManager.getInstance().get_EventDungeonSatisfactionLevel(f).need_point,prcnt=(a-g.accm_point)/total_point*100;return prcnt=100*prcnt/100,j<=c&&(prcnt=100),prcnt}if(4==arguments.length){var h;(h=e.get_EventDungeonSatisfactionLeveList(b)).sort(function(l,r){return l.satisfaction_level-r.satisfaction_level});for(var j=h[h.length-1].satisfaction_level,i=0;i<h.length;i++)h[i].accm_point<=a&&(c=h[i].satisfaction_level);return{prcnt:prcnt=this.getEventDungeonSatisfactionLevelPercent(a,b,c),level:c}}},getUserEventDungeonSatisfactionRewardShop:function(a,b){for(var m=MasterTable.getInstance(),satisfaction_info=NetService().get_User_Event_Dungeon_Satisfaction_Info(),reward_list=m.get_EventDungeonSatisfactionLevelUpInfoList(a),i=0;i<reward_list.size();i++){var s=reward_list.at(i),item=new db.UserEventDungeonSatisfactionRewardShop;item.reward_idx=s.reward_idx,item.event_dungeon_group_idx=a,item.event_dungeon_period_idx=s.event_dungeon_period_idx,item.satisfaction_level=s.satisfaction_level;var c=MasterManager.getInstance().get_EventDungeonSatisfactionLevelUpRewardInfo(item.reward_idx);item.reward=c;var d=MasterManager.getInstance().get_EventDungeonSatisfactionLevel(item.satisfaction_level);if(item.need_accum_point=d.accm_point,this.IsOpenDungeon(item.event_dungeon_period_idx)&&(item.is_open_yn=!0),0!=satisfaction_info.length&&null!=satisfaction_info)for(var e=0;e<satisfaction_info.user_reward_list.length;e++){if(satisfaction_info.user_reward_list[e].reward_idx==item.reward_idx){item.is_rewarded_yn=!0;break}}b.push_back(item)}},getEventDungeonSatisfactionNextRewardNeedPoint:function(a){var b,m=MasterManager.getInstance(),satisfaction_info=NetService().get_User_Event_Dungeon_Satisfaction_Info(),next_level=satisfaction_info.satisfaction_level+1,next_level_info=m.get_EventDungeonSatisfactionLevel(next_level),max_obj=this.getEventDungeonSatisfactionMaxLevel(a);return b=max_obj.max_level,max_obj.max_point,b<=satisfaction_info.satisfaction_level?0:next_level_info.accm_point-satisfaction_info.level_point},getEventDungeonSearchTroopsGeneralList:function(a){var b=[];if(1==arguments.length){null==(c=NetService().get_User_Event_Dungeon_Search_Troops_Generals(a))&&(c=[]);for(var i=0;i<c.length;i++){var g=c[i];(e=new db.UserGeneralTroops).gnrl_id=g.gnrl_id,e.gnrl_num=g.gnrl_num,e.troops_num=g.troops_num,e.pos_type=g.position,e.is_leader="y"==g.leader_yn,b.push_back(e)}}else{var c,keys=(c=NetService().get_User_Event_Dungeon_Search_Troops_Generals()).keys();for(i=0;i<keys.length;i++)for(var d=c.at(keys[i]),j=0;j<d.length;j++){var e;g=d[j];(e=new db.UserGeneralTroops).gnrl_id=g.gnrl_id,e.gnrl_num=g.gnrl_num,e.troops_num=g.troops_num,e.pos_type=g.position,e.is_leader="y"==g.leader_yn,b.push_back(e)}}return b},getEventDungeonSearchTroopsCost:function(a){for(var b=0,m=MasterManager.getInstance(),user_event_dungeon_search_troops_general=NetService().get_User_Event_Dungeon_Search_Troops_Generals(a),i=0;i<user_event_dungeon_search_troops_general.length;i++){var g=user_event_dungeon_search_troops_general[i];b+=m.get_General(g.gnrl_id).cost}return b},getEventDungeonSearchTroopsTotalCost:function(a){for(var b=0,user_event_dungeon_search_troops=NetService().get_User_Event_Dungeon_Search_Troops(),keys=user_event_dungeon_search_troops.keys(),i=0;i<keys.length;i++)if(keys[i]==a){b=user_event_dungeon_search_troops.at(keys[i]).cost;break}return b},getEventDungeonSearchTroopsGeneralCount:function(a){var b=0,troops_list=NetService().get_User_Event_Dungeon_Search_Troops_Generals(a);null==troops_list&&(troops_list=[]);for(var t=0;t<troops_list.length;t++)b++;return b},isExistGeneralInEventDungeonSearchTroops:function(a,b){if(null==b){for(var c=(troops_list=NetService().get_User_Event_Dungeon_Search_Troops_Generals()).keys(),t_idx=0;t_idx<c.length;t_idx++)for(var d=troops_list.at(c[t_idx]),g_idx=0;g_idx<d.length;g_idx++){if(d[g_idx].gnrl_num==b)return!0}return!1}for(var e=!1,troops_list=NetService().get_User_Event_Dungeon_Search_Troops_Generals(a),i=0;i<troops_list.length;i++){if(troops_list[i].gnrl_num==b){e=!0;break}}return e},isExistGeneralInEventDungeonSearchPosType:function(a,b){for(var c=!1,troops_list=NetService().get_User_Event_Dungeon_Search_Troops_Generals(a),i=0;i<troops_list.length;i++){if(troops_list[i].position==b){c=!0;break}}return c},isSameGeneralInEventDungeonSearchTroops:function(a,b,c){for(var d=!1,troops_list=(MasterManager.getInstance().get_General(c.gnrl_id),NetService().get_User_Event_Dungeon_Search_Troops_Generals(a)),selectGnrlId=c.gnrl_id%1e3,i=b=0;i<troops_list.length;i++){var g=troops_list[i];selectGnrlId==g.gnrl_id%1e3&&c.gnrl_num!=g.gnrl_num&&(b=g.position,d=!0)}return{result:d,pos:b}},isSameGeneraEventDungeonSearchOtherTroops:function(a){for(var b=!1,troops_list=(MasterManager.getInstance().get_General(a.gnrl_id),NetService().get_User_Event_Dungeon_Search_Troops_Generals("list")),t_idx=0;t_idx<troops_list.length;t_idx++){var g=troops_list[t_idx];if(a.troops_num!=g.troops_num&&a.gnrl_num==g.gnrl_num){b=!0;break}}return b},checkEventDungeonSearchTroopsPosition:function(a){for(var b=!1,troops_list=NetService().get_User_Event_Dungeon_Search_Troops_Generals(a.troops_num),i=0;i<troops_list.length;i++){var g=troops_list[i];if(g.gnrl_num==a.gnrl_num&&g.position==a.pos_type){b=!0;break}}return b},isCostOver:function(a,b){for(var c=!1,totalCost=this.getEventDungeonSearchTroopsTotalCost(b),cost=0,m=MasterManager.getInstance(),troops_list=NetService().get_User_Event_Dungeon_Search_Troops_Generals(b),i=0;i<troops_list.length;i++){var g=troops_list[i];if(g.position!=a.pos_type&&g.gnrl_num!=a.gnrl_num)cost+=m.get_General(g.gnrl_id).cost}return totalCost<(cost+=m.get_General(a.gnrl_id).cost)&&(c=!0),c},getUerEventDungeonSearchTroopsGeneral:function(a,b){for(var c=NetService().get_User_Event_Dungeon_Search_Troops_Generals(a),troops={},i=0;i<c.length;i++){var g=c[i];g.position==b&&(troops.gnrl_id=g.gnrl_id,troops.gnrl_num=g.gnrl_num,troops.pos_type=g.position,troops.troops_num=g.troops_num,troops.is_leader="y"==g.leader_yn)}return troops},getEventDungeonSearchTroopsTotalAttkPwr:function(a){GeneralService.getInstance();var b=NetService().get_User_Event_Dungeon_Search_Troops_Generals(a);null==b&&(b=[]);for(var c=0,i=0;i<b.length;i++){var g=b[i];c+=this.getEventDungeonSearchGeneralTotalAttkPwr(g.gnrl_id,g.gnrl_num)}return c},addComboStatValueForEquipment:function(a,b,c){switch(b){case COMBO_STAT_ATTK_PLUS:return c;case COMBO_STAT_ATTK:return a.attk*(c/1e4);case COMBO_STAT_DEF_PLUS:return c;case COMBO_STAT_DEF:return a.def*(c/1e4);case COMBO_STAT_HP_PLUS:return c;case COMBO_STAT_HP:return a.hp*(c/1e4);case 0:return 0}return 0},getEventDungeonSearchGeneralTotalAttkPwr:function(a,b){var c=MasterManager.getInstance(),total_attk_pwr=0,key=new db.UserGeneralKey;key.gnrl_id=a,key.gnrl_num=b;var d=new db.UserGeneralInfo;GeneralService.getInstance().getUserGeneralInfo(key,d),total_attk_pwr+=d.attk,total_attk_pwr+=d.def,total_attk_pwr+=d.hp;var g=c.get_General(a),loveStat=MasterTable.getInstance().get_LoveStatItem(g.love_stat_group,d.love_level);loveStat.stat_type_1==LOVE_STAT_TYPE_ATTK_PRCNT&&(total_attk_pwr+=d.attk*(loveStat.value_1/100)),loveStat.stat_type_2==LOVE_STAT_TYPE_ATTK_PRCNT&&(total_attk_pwr+=d.attk*(loveStat.value_2/100)),loveStat.stat_type_3==LOVE_STAT_TYPE_ATTK_PRCNT&&(total_attk_pwr+=d.attk*(loveStat.value_3/100)),loveStat.stat_type_1==LOVE_STAT_TYPE_ATTK_INC&&(total_attk_pwr+=loveStat.value_1),loveStat.stat_type_2==LOVE_STAT_TYPE_ATTK_INC&&(total_attk_pwr+=loveStat.value_2),loveStat.stat_type_2==LOVE_STAT_TYPE_ATTK_INC&&(total_attk_pwr+=loveStat.value_3),loveStat.stat_type_1==LOVE_STAT_TYPE_DEF_PRCNT&&(total_attk_pwr+=d.def*(loveStat.value_1/100)),loveStat.stat_type_2==LOVE_STAT_TYPE_DEF_PRCNT&&(total_attk_pwr+=d.def*(loveStat.value_2/100)),loveStat.stat_type_3==LOVE_STAT_TYPE_DEF_PRCNT&&(total_attk_pwr+=d.def*(loveStat.value_3/100)),loveStat.stat_type_1==LOVE_STAT_TYPE_DEF_INC&&(total_attk_pwr+=loveStat.value_1),loveStat.stat_type_2==LOVE_STAT_TYPE_DEF_INC&&(total_attk_pwr+=loveStat.value_2),loveStat.stat_type_3==LOVE_STAT_TYPE_DEF_INC&&(total_attk_pwr+=loveStat.value_3),loveStat.stat_type_1==LOVE_STAT_TYPE_HP_PRCNT&&(total_attk_pwr+=d.hp*(loveStat.value_1/100)),loveStat.stat_type_2==LOVE_STAT_TYPE_HP_PRCNT&&(total_attk_pwr+=d.hp*(loveStat.value_2/100)),loveStat.stat_type_3==LOVE_STAT_TYPE_HP_PRCNT&&(total_attk_pwr+=d.hp*(loveStat.value_3/100)),loveStat.stat_type_1==LOVE_STAT_TYPE_HP_INC&&(total_attk_pwr+=loveStat.value_1),loveStat.stat_type_2==LOVE_STAT_TYPE_HP_INC&&(total_attk_pwr+=loveStat.value_2),loveStat.stat_type_3==LOVE_STAT_TYPE_HP_INC&&(total_attk_pwr+=loveStat.value_3);var e=CampService.getInstance().getUserCampBranchAbility(d.arm_service_type);1==CAMP_LOVE_STAT_TYPE?(total_attk_pwr+=d.attk*(e.attack/1e4),total_attk_pwr+=d.def*(e.defense/1e4),total_attk_pwr+=d.hp*(e.health/1e4)):(total_attk_pwr+=e.attack,total_attk_pwr+=e.defense,total_attk_pwr+=e.health);for(var f=new Map,es=EquipmentService.getInstance(),equip_info_list=es.getUserGeneralEquipmentListInfo(key),idx=0;idx<equip_info_list.length;idx++){var h=equip_info_list[idx],equip_key={},user_equip_info={};equip_key.equipment_item_idx=h.equip_id,equip_key.equipment_num=h.equip_num;es.getUserEquipmentInfo(equip_key,user_equip_info,{}),total_attk_pwr+=this.addComboStatValueForEquipment(d,user_equip_info.combo_stat,user_equip_info.stat_value);var i=c.get_EquipmentItemOption(user_equip_info.option_id1,user_equip_info.option_num1);if(0==i.wear_element_type||d.element_type==i.wear_element_type){var j=c.get_EquipmentItemOptionLevel(i.level_idx,user_equip_info.level);total_attk_pwr+=this.addComboStatValueForEquipment(d,j.combo_stat,j.stat_value),total_attk_pwr+=this.addComboStatValueForEquipment(d,j.combo_stat_2,j.stat_value_2)}if(0==(i=c.get_EquipmentItemOption(user_equip_info.option_id2,user_equip_info.option_num2)).wear_element_type||d.element_type==i.wear_element_type){j=c.get_EquipmentItemOptionLevel(i.level_idx,user_equip_info.level);total_attk_pwr+=this.addComboStatValueForEquipment(d,j.combo_stat,j.stat_value),total_attk_pwr+=this.addComboStatValueForEquipment(d,j.combo_stat_2,j.stat_value_2)}if(0==(i=c.get_EquipmentItemOption(user_equip_info.option_id3,user_equip_info.option_num3)).wear_element_type||d.element_type==i.wear_element_type){j=c.get_EquipmentItemOptionLevel(i.level_idx,user_equip_info.level);total_attk_pwr+=this.addComboStatValueForEquipment(d,j.combo_stat,j.stat_value),total_attk_pwr+=this.addComboStatValueForEquipment(d,j.combo_stat_2,j.stat_value_2)}if(0==(i=c.get_EquipmentItemOption(user_equip_info.option_id4,user_equip_info.option_num4)).wear_element_type||d.element_type==i.wear_element_type){j=c.get_EquipmentItemOptionLevel(i.level_idx,user_equip_info.level);total_attk_pwr+=this.addComboStatValueForEquipment(d,j.combo_stat,j.stat_value),total_attk_pwr+=this.addComboStatValueForEquipment(d,j.combo_stat_2,j.stat_value_2)}if(0==(i=c.get_EquipmentItemOption(user_equip_info.option_id5,user_equip_info.option_num5)).wear_element_type||d.element_type==i.wear_element_type){j=c.get_EquipmentItemOptionLevel(i.level_idx,user_equip_info.level);total_attk_pwr+=this.addComboStatValueForEquipment(d,j.combo_stat,j.stat_value),total_attk_pwr+=this.addComboStatValueForEquipment(d,j.combo_stat_2,j.stat_value_2)}if(0<user_equip_info.equip_group)null==(set_count=f.at(user_equip_info.equip_group))&&(set_count={count:0},f.insert(user_equip_info.equip_group,set_count)),f.insert(user_equip_info.equip_group,set_count),set_count.count=set_count.count+1}var k=f.keys();for(idx=0;idx<k.length;idx++){for(var l={equip_count:0,combo_stat:0,added_value:0},set_count=f.at(k[idx]).count;null==(l=MasterManager.getInstance().get_EquipmentGroup(parseInt(k[idx]),set_count)).equip_count&&(l={equip_count:0,combo_stat:0,added_value:0}),0==l.equip_count&&0<set_count--;);total_attk_pwr+=this.addComboStatValueForEquipment(d,l.combo_stat,l.added_value)}return total_attk_pwr},getEventDungeonSearchAreaGreatSuccesRate:function(a,b,c){MasterManager.getInstance();for(var d=MasterTable.getInstance().get_EventDungeonSearchAreaList(a),great_success_max_rate=0,max_price_value=0,i=0;i<d.length;i++){var l=d[i];if(l.event_dungeon_group_idx==a&&l.search_area_idx==b){l.great_success_base_rate,great_success_max_rate=l.great_success_max_rate,max_price_value=l.max_price_value;break}}return c*(great_success_max_rate/max_price_value/100)},getUserEventDungeonSearchTroopsAutoPairingGeneralList:function(a,b,c){var d=MasterManager.getInstance(),list=[];GeneralService.getInstance().getUserGeneralInfoList(list);for(var e=NetService().get_User_Event_Dungeon_Search_Troops_Generals(),troops_general_keys=[],keys=e.keys(),t_idx=0;t_idx<keys.length;t_idx++){var f=e.at(keys[t_idx]);if(keys[t_idx]!=b)for(var i=0;i<f.length;i++){var h=new db.UserGeneralKey;h.gnrl_id=f[i].gnrl_id,h.gnrl_num=f[i].gnrl_num,troops_general_keys.push_back(h)}}list.sort(function(l,r){return r.total_attk_pwr-l.total_attk_pwr});for(var k=1,g_idx=0;g_idx<list.length;g_idx++){var g=list[g_idx];if(g.gnrl_type<=GENERAL_TYPE_SOLDIER){if(5<k)break;if(g.using_in_camp)continue;for(var m=!1,tg_idx=0;tg_idx<troops_general_keys.length;tg_idx++){if((f=troops_general_keys[tg_idx]).gnrl_id==g.gnrl_id&&f.gnrl_num==f.gnrl_num){m=!0;break}}if(m)continue;for(var n=0;n<c.length;n++){var j=c[n];if(d.get_General(j.gnrl_id).gnrl_group==g.gnrl_group){m=!0;break}}if(m)continue;var t={};t.gnrl_id=g.gnrl_id,t.gnrl_num=g.gnrl_num,t.position=k,t.troops_num=b,t.leader_yn=1==k?"y":"n",c.push_back(t),k++}}},removeMaterialGnrlCheck:function(b){for(var c=[],g_idx=0;g_idx<b.length;g_idx++){var g=b[g_idx];1!=g.gnrl_type&&3!=g.gnrl_type&&c.push_back(g),g.using_in_camp&&c.push_back(g)}if(0<c.size())for(var i=0;i<c.size();i++){var d=c.at(i),found=b.findIndex(function(a){return a.gnrl_id==d.gnrl_id&&a.gnrl_num==d.gnrl_num});-1!=found&&b.splice(found,1)}},checkEventDungeonBattleGeneralInSearchTroops:function(a,b){for(var c=GeneralService.getInstance().getUserTroopsGeneralList(b),user_event_dungeon_search_troops_general=NetService().get_User_Event_Dungeon_Search_Troops_Generals(),troops_general_keys=[],keys=user_event_dungeon_search_troops_general.keys(),tg_idx=0;tg_idx<keys.length;tg_idx++){var d=user_event_dungeon_search_troops_general.at(keys[tg_idx]);null==d&&(d=[]);for(var e=0;e<d.length;e++){var i=d[e],key={};key.gnrl_id=i.gnrl_id,key.gnrl_num=i.gnrl_num,troops_general_keys.push_back(key)}}for(var f=0;f<troops_general_keys.length;f++)for(i=0;i<c.length;i++){var g=c[i];if(troops_general_keys[f].gnrl_num==g.gnrl_num)return!0}return!1},isExistEventDUngeonSearchResult:function(b){for(var c=NetService().get_User_Event_Dungeon_Search_Area_Info(),now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),nn=moment(now).valueOf(),keys=c.keys(),idx=0;idx<keys.length;idx++){var a=c.at(keys[idx]);if(a.event_dungeon_period_idx==b)if(moment(a.end_dt,["MM-DD-YYYY hh:mm:ss a"]).valueOf()-nn<=0)return!0}return!1},getUserEventDungeonChristmasReward:function(a,b){for(var m=MasterManager.getInstance(),christmas_info=NetService().get_User_Event_Dungeon_Christmas_Info(),reward_info_list=MasterTable.getInstance().get_EventDungeonPersonalPointInfoList(a),idx=0;idx<reward_info_list.length;idx++){var c=reward_info_list[idx],item=new db.UserEventDungeonChristmasPersonalPointBonusLog,bonus_info=m.get_EventDungeonPersonalPointBonus(a,c.step);if(item.event_dungeon_group_idx=c.event_dungeon_group_idx,item.step=c.step,item.accum_point=c.accm_point,item.bonus_type=bonus_info.bonus_type,item.min_value=bonus_info.min_value,item.max_value=bonus_info.max_value,item.is_opened=christmas_info.accum_count>=c.accm_point,1==item.is_opened){for(var d=!1,jdx=0;jdx<christmas_info.user_event_dungeon_personal_point_reward.length;jdx++){var e=christmas_info.user_event_dungeon_personal_point_reward[jdx];e.event_dungeon_group_idx==c.event_dungeon_group_idx&&e.step==c.step&&(d="y"==e.rewarded_yn)}item.is_rewarded=d}else item.is_rewarded=!1;b.push_back(item)}},getEventDungeonVoteLeagueInfoList:function(a,b){for(var c=MasterTable.getInstance().get_EventDungeonVoteLeagueInfoList(),first_period_idx=this.getEventDungeonFirstHalfPeriodIdx(a),second_period_idx=this.getEventDungeonSecondHalfPeriodIdx(a),i=0;i<c.length;i++){var d=c[i];if(d.event_dungeon_period_idx==first_period_idx||d.event_dungeon_period_idx==second_period_idx){var e=b.at(d.league_group_idx);if(null==e){var f=[];f.push(d),b.insert(d.league_group_idx,f)}else e.push(d)}}},isEndEventDungeonVoteLeague:function(a){var b=MasterManager.getInstance().get_EventDungeonVoteLeaguePeriod(a),now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf();moment(b.beg_dt).valueOf();return moment(b.end_dt).valueOf()<n},isOpenEventDungeonVoteLeague:function(a){var c=MasterManager.getInstance().get_EventDungeonVoteLeaguePeriod(a),now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),b=moment(c.beg_dt).valueOf(),e=moment(c.end_dt).valueOf();return b<=n&&n<=e},getCurrentEventDungeonVoteLeagueGroupIdx:function(){var m=MasterTable.getInstance(),period_list=m.get_EventDungeonVoteLeaguePeriodList(),now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),current_period_idx=0;period_list.some(function(a){var b=moment(a.beg_dt).valueOf(),e=moment(a.end_dt).valueOf();if(b<n&&n<e)return current_period_idx=a.vote_league_period_idx,!0});var c=m.get_EventDungeonVoteLeagueInfoList(),found=c.findIndex(function(l){return l.vote_league_period_idx==current_period_idx});if(-1!=found)var d=c[found];else d={league_group_idx:0};return d.league_group_idx},getEventDungeonLastVoteLeagueGroupIdx:function(b){var c=MasterManager.getInstance().get_All_EventDungeonVoteLeagueInfo().filter(function(a){if(a.event_dungeon_group_idx==b)return!0});return c.sort(function(l,r){return l.league_group_idx-r.league_group_idx}),c[c.length-1].league_group_idx},getEventDungeonFirstVoteLeagueGroupIdx:function(b){var c=MasterManager.getInstance().get_All_EventDungeonVoteLeagueInfo().filter(function(a){if(a.event_dungeon_group_idx==b)return!0});return c.sort(function(l,r){return l.league_group_idx-r.league_group_idx}),c[0].league_group_idx},getEventDungeonVoteLeaguePeriodDateTime:function(a,b){var m=MasterTable.getInstance(),period=MasterManager.getInstance().get_EventDungeonPeriod(a),first_event_period_idx=this.getEventDungeonFirstHalfPeriodIdx(period.event_dungeon_group_idx),second_event_period_idx=this.getEventDungeonSecondHalfPeriodIdx(period.event_dungeon_group_idx),league_list=m.get_EventDungeonVoteLeagueInfoList(period.event_dungeon_period_idx,b);league_list.empty()&&(league_list=first_event_period_idx==a?m.get_EventDungeonVoteLeagueInfoList(second_event_period_idx,b):m.get_EventDungeonVoteLeagueInfoList(first_event_period_idx,b));var c=league_list.at(0);if(null==c)return"";var d=c.vote_league_period_idx,first_idx=this.getEventDungeonFirstVoteLeagueGroupIdx(period.event_dungeon_group_idx),last_idx=this.getEventDungeonLastVoteLeagueGroupIdx(period.event_dungeon_group_idx),league_period=MasterManager.getInstance().get_EventDungeonVoteLeaguePeriod(d),begin_date=moment(league_period.beg_dt),end_date=moment(league_period.end_dt),beg_month=(begin_date.year(),leadingZeros(begin_date.month()+1,2)),beg_day=leadingZeros(begin_date.date(),2),beg_hour=leadingZeros(begin_date.hours(),2),beg_minute=leadingZeros(begin_date.minutes(),2),end_month=(leadingZeros(begin_date.seconds(),2),end_date.year(),leadingZeros(end_date.month()+1,2)),end_day=leadingZeros(end_date.date(),2),end_hour=leadingZeros(end_date.hours(),2),end_minute=leadingZeros(end_date.minutes(),2);leadingZeros(end_date.seconds(),2);return c.league_group_idx==first_idx?cmString(res_str("label_event_dungeon_vote_league_period_dt_1"),beg_month,beg_day,end_month,end_day,end_hour,end_minute):c.league_group_idx==last_idx?cmString(res_str("label_event_dungeon_vote_league_period_dt_3"),beg_month,beg_day,beg_hour,beg_minute,end_month,end_day):cmString(res_str("label_event_dungeon_vote_league_period_dt_2"),beg_month,beg_day,beg_hour,beg_minute,end_month,end_day,end_hour,end_minute)},getUserEventDungeonUsePointReward:function(a,b){for(var c=MasterTable.getInstance().get_EventDungeonVoteLeagueUsePointRewardList(a),i=0;i<c.length;i++){var r=c.at(i),item=new db.UserEventDungeonUsePointReward;item.event_dungeon_reward_idx=r.reward_idx,item.event_dungeon_period_idx=a,item.reward=r,b.push_back(item)}EventDungeonTable.getInstance().sel_UserEventDungeonUsePointReward(m_user_id,b)},getUserEventDungeonUsePoint:function(b){var c=0;return NetService().get_User_Event_Dungeon_Vote_League_Record().forEach(function(a){a.event_dungeon_period_idx==b&&(c+=a.vote_cnt)}),c},setEventDungeonVoteLeaguePrevRankingLeagueIdx:function(a){m_event_dungeon_vote_prev_ranking_league_group_idx=a},getEventDungeonVoteLeaguePrevRankingLeagueIdx:function(){return m_event_dungeon_vote_prev_ranking_league_group_idx},getUserEventDungeonVoteLeagueReward:function(c,d,e){var m=MasterTable.getInstance(),period=MasterManager.getInstance().get_EventDungeonPeriod(c),reward_list=m.get_EventDungeonVoteLeagueRewardList(c),first_event_period_idx=this.getEventDungeonFirstHalfPeriodIdx(period.event_dungeon_group_idx),second_event_period_idx=this.getEventDungeonSecondHalfPeriodIdx(period.event_dungeon_group_idx),record_list=NetService().get_User_Event_Dungeon_Vote_League_Record();reward_list.forEach(function(r){if((r.event_dungeon_period_idx==first_event_period_idx||r.event_dungeon_period_idx==second_event_period_idx)&&r.league_tab_type==d){var a=new db.UserEventDungeonVoteLeagueReward;a.league_reward_idx=r.league_reward_idx,a.league_group_idx=r.league_tab_type,a.reward=r,record_list.forEach(function(l){r.league_idx==l.league_idx&&(a.user_use_event_dungeon_point+=l.vote_cnt)});var b=MasterManager.getInstance().get_EventDungeonPeriod(r.event_dungeon_period_idx);a.event_dungeon_group_idx=b.event_dungeon_group_idx,e.push_back(a)}}),EventDungeonTable.getInstance().sel_UserEventDungeonVoteLeagueReward(m_user_id,e)},getUserEventDungeonVoteLeagueReward2:function(c){var m=MasterTable.getInstance(),event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),reward_list=m.get_EventDungeonVoteLeagueRewardList(period.event_dungeon_group_idx),record_list=NetService().get_User_Event_Dungeon_Vote_League_Record();reward_list.forEach(function(r){var a=new db.UserEventDungeonVoteLeagueReward;a.league_reward_idx=r.league_reward_idx,a.league_group_idx=r.league_tab_type,a.reward=r,record_list.forEach(function(l){r.league_idx==l.league_idx&&(a.user_use_event_dungeon_point+=l.vote_cnt)});var b=MasterManager.getInstance().get_EventDungeonPeriod(r.event_dungeon_period_idx);a.event_dungeon_group_idx=b.event_dungeon_group_idx,c.push_back(a)}),EventDungeonTable.getInstance().sel_UserEventDungeonVoteLeagueReward(m_user_id,c)},getEventDungeonVoteLeagueFirstGroupIdx:function(b){var c=MasterManager.getInstance().get_All_EventDungeonVoteLeagueInfo().filter(function(a){if(a.event_dungeon_group_idx==b)return!0});return c.sort(function(r,l){return r.league_group_idx-l.league_group_idx}),c[0].league_group_idx},getEventDungeonPointUnitType:function(c,d){MasterTable.getInstance().get_EventDungeonPeriodList().forEach(function(a){if(this.IsOpenDungeon(a.event_dungeon_period_idx)){var b=MasterManager.getInstance().get_EventPointUnitType(a.event_point_unit_type);-1==d.findIndex(function(m){return m.event_point_unit_type==a.event_point_unit_type})&&d.push_back(b)}}.bind(this))},isNewUserEventDungeonUsePointReward:function(a){var b=MasterManager.getInstance(),first_period_idx=this.getEventDungeonFirstHalfPeriodIdx(a),second_period_idx=this.getEventDungeonSecondHalfPeriodIdx(a),first_point_period_idx=b.get_EventDungeonPeriod(first_period_idx).event_dungeon_point_period_idx,second_point_period_idx=b.get_EventDungeonPeriod(second_period_idx).event_dungeon_point_period_idx,reward_list=[];this.getUserEventDungeonUsePointReward(first_point_period_idx,reward_list);for(var c=this.getUserEventDungeonUsePoint(first_point_period_idx),idx=0;idx<reward_list.length;idx++){if(!(r=reward_list[idx]).is_rewarded_yn&&r.reward.accm_point<=c)return!0}if(first_point_period_idx!=second_point_period_idx){reward_list.clear(),this.getUserEventDungeonUsePointReward(second_point_period_idx,reward_list),c=this.getUserEventDungeonUsePoint(second_point_period_idx);for(idx=0;idx<reward_list.length;idx++){var r;if(!(r=reward_list[idx]).is_rewarded_yn&&r.reward.accm_point<=c)return!0}}return!1},getEventDungeonBoardRewardTypeList:function(b,c){MasterTable.getInstance().get_EventDungeonRewardBoardInfo(b).forEach(function(a){-1==c.findIndex(function(r){return a.board_reward_type==r})&&c.push_back(a.board_reward_type)})},IsExistPrevEventDungeon:function(a){var m=MasterManager.getInstance(),period=m.get_EventDungeonPeriod(a),prev_eveunt_dungeon_group_idx=period.prev_event_dungeon_group_idx;if(prev_eveunt_dungeon_group_idx<=0)return!1;period=m.get_EventDungeonPeriod(prev_eveunt_dungeon_group_idx);var n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),b=moment(period.event_dungeon_point_beg_dt).valueOf(),e=moment(period.event_dungeon_point_end_dt).valueOf();return b<=n&&n<=e},getFirstEventDungeonPeriodIdx:function(){var a=0,open_period_list=MasterTable.getInstance().get_EventDungeonPeriodOpenInfoList();return 0==open_period_list.length?a:a=open_period_list.front().event_dungeon_period_idx},getSecondEventDungeonPeriodIdx:function(){var a=0,open_period_list=MasterTable.getInstance().get_EventDungeonPeriodOpenInfoList();return open_period_list.length<2?a:a=open_period_list[open_period_list.length-1].event_dungeon_period_idx},getUserEventDungeonAchvList:function(a){var b=[],master_achv_list=(MasterManager.getInstance().get_EventDungeonPeriod(a),MasterTable.getInstance().get_EventDungeonAchievementList(a)),list=NetService().get_User_Evevt_Dungeon_Achv_List(),user_achv_list=[];null!=list&&null!=list.achv_list&&0<list.achv_list.length&&(user_achv_list=list.achv_list);for(var c=[],user_achv={},i=0;i<master_achv_list.length;i++){var d=master_achv_list[i];if(0==d.serial_achv_type)for(var e=0;e<user_achv_list.length;e++){var f=!1,index=0;if(d.event_dungeon_period_idx==user_achv_list[e].event_dungeon_period_idx&&d.event_dungeon_achv_list_idx==user_achv_list[e].event_dungeon_achv_list_idx){f=!0,index=e;break}if(f){var g=user_achv_list[e];user_achv.event_dungeon_achv_list_idx=d.event_dungeon_achv_list_idx,user_achv.event_dungeon_period_idx=d.event_dungeon_period_idx,user_achv.event_achv=d,user_achv.achv=MasterManager.getInstance().get_EventDungeonAchvList(d.event_dungeon_achv_list_idx),user_achv.rewards=MasterTable.getInstance().get_EventDungeonAchievementBonusList(user_achv.achv.bonus_idx),user_achv.complete_count=g.complete_count,user_achv.is_bonus_complete="y"==g.bonus_complete_yn,user_achv.is_complete="y"==g.complete_yn,user_achv.is_new="y"==g.new_yn,b.push($.extend({},user_achv))}else user_achv.event_dungeon_achv_list_idx=d.event_dungeon_achv_list_idx,user_achv.event_dungeon_period_idx=d.event_dungeon_period_idx,user_achv.event_achv=d,user_achv.achv=MasterManager.getInstance().get_EventDungeonAchvList(d.event_dungeon_achv_list_idx),user_achv.rewards=MasterTable.getInstance().get_EventDungeonAchievementBonusList(user_achv.achv.bonus_idx),user_achv.complete_count=0,user_achv.is_bonus_complete=!1,user_achv.is_complete=!1,user_achv.is_new=!1,b.push($.extend({},user_achv))}else{c=MasterTable.getInstance().get_EventDungeonSeqAchvList(d.event_dungeon_achv_list_idx);f=!1;for(var h=0,k=0;k<c.length;k++){for(var j=c[k],found=!1,kdx=(index=0,0);kdx<user_achv_list.length;kdx++)if(a==user_achv_list[kdx].event_dungeon_period_idx&&j.event_dungeon_achv_list_idx==user_achv_list[kdx].event_dungeon_achv_list_idx){found=!0,index=kdx;break}if(found){if("y"!=(g=user_achv_list[index]).complete_yn){f=!0,user_achv.event_dungeon_achv_list_idx=j.event_dungeon_achv_list_idx,user_achv.event_dungeon_period_idx=d.event_dungeon_period_idx,user_achv.event_achv=d,user_achv.achv=j,user_achv.rewards=MasterTable.getInstance().get_EventDungeonAchievementBonusList(user_achv.achv.bonus_idx),user_achv.complete_count=g.complete_count,user_achv.is_bonus_complete="y"==g.bonus_complete_yn,user_achv.is_complete="y"==g.complete_yn,user_achv.is_new="y"==g.new_yn,b.push($.extend({},user_achv));break}if("n"==g.bonus_complete_yn){f=!0,user_achv.event_dungeon_achv_list_idx=j.event_dungeon_achv_list_idx,user_achv.event_dungeon_period_idx=d.event_dungeon_period_idx,user_achv.event_achv=d,user_achv.achv=j,user_achv.rewards=MasterTable.getInstance().get_EventDungeonAchievementBonusList(user_achv.achv.bonus_idx),user_achv.complete_count=g.complete_count,user_achv.is_bonus_complete="y"==g.bonus_complete_yn,user_achv.is_complete="y"==g.complete_yn,user_achv.is_new="y"==g.new_yn,b.push($.extend({},user_achv));break}h++}}if(!f)if(h==c.length){var m=c[c.length-1];user_achv.event_dungeon_achv_list_idx=m.event_dungeon_achv_list_idx,user_achv.event_dungeon_period_idx=d.event_dungeon_period_idx,user_achv.event_achv=d,user_achv.achv=m,user_achv.rewards=MasterTable.getInstance().get_EventDungeonAchievementBonusList(user_achv.achv.bonus_idx),user_achv.complete_count=m.complete_count,user_achv.is_bonus_complete=!0,user_achv.is_complete=!0,user_achv.is_new=!1,b.push($.extend({},user_achv))}else{var n=c[0];user_achv.event_dungeon_achv_list_idx=n.event_dungeon_achv_list_idx,user_achv.event_dungeon_period_idx=d.event_dungeon_period_idx,user_achv.event_achv=d,user_achv.achv=n,user_achv.rewards=MasterTable.getInstance().get_EventDungeonAchievementBonusList(user_achv.achv.bonus_idx),user_achv.complete_count=0,user_achv.is_bonus_complete=!1,user_achv.is_complete=!1,user_achv.is_new=!1,b.push($.extend({},user_achv))}}}return b=stable(b,function(l,r){return l.is_complete<r.is_complete}),b=stable(b,function(l,r){return l.is_bonus_complete>r.is_bonus_complete})},IsEnableGainEventDungeonAchvReward:function(a){var b=!1,list=NetService().get_User_Evevt_Dungeon_Achv_List();if(null!=list&&null!=list.achv_list&&0<list.achv_list.length)for(var c=NetService().get_User_Evevt_Dungeon_Achv_List().achv_list,i=0;i<c.length;i++)if(c[i].event_dungeon_period_idx==a&&"y"==c[i].complete_yn&&"n"==c[i].bonus_complete_yn){b=!0;break}return b}}}return{getInstance:function(){return void 0===o&&(o=new EventDungeonService),o}}}();var MailService,RaidBossService,PurchaseLog=cc.Class.extend({purchase_log_id:0,action:0,shop_id:0,payload:"",payment_id:"",message:"",create_dt:""});MailService=function(){function MailService(){return{getUserMail:function(){for(var a=MasterManager.getInstance(),user_mails=NetService().getUsermail(),newlist=[],malis_length=user_mails.length,i=0;i<malis_length;i++){var b={};b.mail_type=user_mails.at(i).mail_type,b.num=user_mails.at(i).mail_num,b.bonus_type=user_mails.at(i).bonus_type,b.count=user_mails.at(i).count,b.new_yn=user_mails.at(i).new_yn,b.complete_yn=user_mails.at(i).complete_yn,b.period_type=user_mails.at(i).period_type,b.remain_second=user_mails.at(i).remain,b.key_id=user_mails.at(i).key_id,b.comment=user_mails.at(i).comment,b.end_dt=user_mails.at(i).end_dt;var c=a.get_MailType(b.mail_type);if(user_mails.at(i).mail_type_name=c.name,b.bonus_type==BONUS_TYPE_ILLUSTRATE_TICKET)user_mails.at(i).bonus_type_name=MasterTable.getInstance().get_IllustGroupName(b.key_id);else{var d=a.get_BonusType(b.bonus_type);user_mails.at(i).bonus_type_name=d.name}newlist.push($.extend({},user_mails.at(i)))}return newlist},checkAndAddRewardList:function(a,b){for(var c=MasterManager.getInstance(),mails_length=a.length,i=0;i<mails_length;i++){var d={};d.mail_type=a.at(i).mail_type,d.num=a.at(i).mail_num,d.bonus_type=a.at(i).bonus_type,d.count=a.at(i).count,d.new_yn=a.at(i).new_yn,d.complete_yn=a.at(i).complete_yn,d.period_type=a.at(i).period_type,d.remain_second=a.at(i).remain,d.key_id=a.at(i).key_id,d.comment=a.at(i).comment;var e=c.get_MailType(d.mail_type);d.mail_type_name=e.name;var f=c.get_BonusType(d.bonus_type);d.bonus_type_name=f.name,(d.bonus_type==BONUS_TYPE_GOLD||d.bonus_type==BONUS_TYPE_YUNHEE_FIX||d.bonus_type==BONUS_TYPE_HEART||d.bonus_type==BONUS_TYPE_JADE||d.bonus_type==BONUS_TYPE_HWANDAN_1||d.bonus_type==BONUS_TYPE_HWANDAN_2||d.bonus_type==BONUS_TYPE_HWANDAN_3||d.bonus_type==BONUS_TYPE_HWANDAN_4||d.bonus_type==BONUS_TYPE_HWANDAN_5||d.bonus_type==BONUS_TYPE_HWANDAN_6||d.bonus_type==BONUS_TYPE_HWANDAN_7||d.bonus_type==BONUS_TYPE_LOVE_ITEM||d.bonus_type==BONUS_TYPE_ATTK_POINT||d.bonus_type==BONUS_TYPE_DEF_POINT||d.bonus_type==BONUS_TYPE_HP_POINT||d.bonus_type==BONUS_TYPE_CRI_PRCNT_POINT||d.bonus_type==BONUS_TYPE_CRI_DMG_POINT||d.bonus_type==BONUS_TYPE_EVOLVE_MELEE||d.bonus_type==BONUS_TYPE_EVOLVE_LANCER||d.bonus_type==BONUS_TYPE_EVOLVE_ARCHER||d.bonus_type==BONUS_TYPE_EVOLVE_MELEE_MIDDLE||d.bonus_type==BONUS_TYPE_EVOLVE_LANCER_MIDDLE||d.bonus_type==BONUS_TYPE_EVOLVE_ARCHER_MIDDLE||d.bonus_type==BONUS_TYPE_EVOLVE_MELEE_LOW||d.bonus_type==BONUS_TYPE_EVOLVE_LANCER_LOW||d.bonus_type==BONUS_TYPE_EVOLVE_ARCHER_LOW||d.bonus_type==BONUS_TYPE_EVOLVE_ORB||d.bonus_type==BONUS_TYPE_EVOLVE_STONE||d.bonus_type==BONUS_TYPE_LOVE_ITEM_MELEE||d.bonus_type==BONUS_TYPE_LOVE_ITEM_LANCER||d.bonus_type==BONUS_TYPE_LOVE_ITEM_RANGER||d.bonus_type==BONUS_TYPE_LOVE_ITEM_CAKE||d.bonus_type==BONUS_TYPE_YUNHEE_PT||d.bonus_type==BONUS_TYPE_FORMATION_POINT||d.bonus_type==BONUS_TYPE_EVENT_POINT||d.bonus_type==BONUS_TYPE_JIN_FIX||d.bonus_type==BONUS_TYPE_YUBI_RARE||d.bonus_type==BONUS_TYPE_YUBI_EVOLVE_HIGH||d.bonus_type==BONUS_TYPE_YUBI_EVOLVE_MIDDLE||d.bonus_type==BONUS_TYPE_YUBI_EVOLVE_LOW||d.bonus_type==BONUS_TYPE_YUBI_LOVE_ITEM||d.bonus_type==BONUS_TYPE_CHRISTMAS_LOVE_ITEM||d.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE||d.bonus_type==BONUS_TYPE_LOVE_MAX_CAKE||d.bonus_type==BONUS_TYPE_WHITE_CHOCO||d.bonus_type>=BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_01&&d.bonus_type<=BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_10||d.bonus_type==BONUS_TYPE_LOVE_ITEM_VD_COCHOLATE_A||d.bonus_type==BONUS_TYPE_LOVE_ITEM_VD_COCHOLATE_B||d.bonus_type==BONUS_TYPE_LOVE_ITEM_PARTNER_COCHOLATE||d.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL||d.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||d.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL||d.bonus_type==BONUS_TYPE_CRAFT_SHOP_FIRST_LOW||d.bonus_type==BONUS_TYPE_CRAFT_SHOP_FIRST_MIDDLE||d.bonus_type==BONUS_TYPE_CRAFT_SHOP_FIRST_HIGH||d.bonus_type==BONUS_TYPE_CRAFT_SHOP_FIRST_UNIQUE||d.bonus_type==BONUS_TYPE_CRAFT_SHOP_SECOND_MIDDLE||d.bonus_type==BONUS_TYPE_CRAFT_SHOP_SECOND_HIGH||d.bonus_type==BONUS_TYPE_CRAFT_SHOP_SECOND_UNIQUE||d.bonus_type==BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND||d.bonus_type==BONUS_TYPE_CHRISTMAS_RIBBON||d.bonus_type==BONUS_TYPE_CHRISTMAS_STAR||d.bonus_type==BONUS_TYPE_CHRISTMAS_BALL||d.bonus_type==BONUS_TYPE_CHRISTMAS_BELL||d.bonus_type==BONUS_TYPE_CHRISTMAS_ANGEL||d.bonus_type==BONUS_TYPE_CHRISTMAS_LOLLIPOPS||d.bonus_type==BONUS_TYPE_CHRISTMAS_COOKIE||d.bonus_type==BONUS_TYPE_CHRISTMAS_SOCKS||d.bonus_type==BONUS_TYPE_CHRISTMAS_TREE||d.bonus_type==BONUS_TYPE_CHRISTMAS_APPLE||d.bonus_type==BONUS_TYPE_RAID_POINT||d.bonus_type==BONUS_TYPE_COMEBACK_CAKE||d.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||d.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||d.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||d.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||d.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||d.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||d.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||d.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||d.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||d.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||d.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||d.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||d.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6||d.bonus_type==BONUS_TYPE_CHRISTMAS_SANTA||d.bonus_type==BONUS_TYPE_CHRISTMAS_REINDEER||d.bonus_type==BONUS_TYPE_CHRISTMAS_SNOWMAN||d.bonus_type==BONUS_TYPE_EQUIPMENT||d.bonus_type==BONUS_TYPE_JADE_PIECE||d.bonus_type==BONUS_TYPE_WORLD_WAR_MEDAL||d.bonus_type==BONUS_TYPE_WORLD_WAR_UNIQUE_EQUIPMENT_TICKET||d.bonus_type==BONUS_TYPE_SKIP_TICKET||d.bonus_type==BONUS_TYPE_EXCHANGE_TICKET||d.bonus_type==BONUS_TYPE_SPECIAL_GACHA_TICKET)&&b.push_back(d)}},getUserMailAllRewardList:function(a,b){var c=NetService().getUsermail();null!=b&&(c=NetService().getUsermail(b)),this.checkAndAddRewardList(c,a)},getBonusTypeName:function(a){return MasterManager.getInstance().get_BonusType(a).name},getBonusTypeToBuyType:function(a){return a==BONUS_TYPE_CHRISTMAS_MELEE_GACHA_TICKET?SHOP_BUY_TYPE_CHRISTMAS_MELEE_GACHA_TICKET:a==BONUS_TYPE_CHRISTMAS_LANCER_GACHA_TICKET?SHOP_BUY_TYPE_CHRISTMAS_LANCER_GACHA_TICKET:a==BONUS_TYPE_CHRISTMAS_ARCHER_GACHA_TICKET?SHOP_BUY_TYPE_CHRISTMAS_ARCHER_GACHA_TICKET:0}}}var g;return{getInstance:function(){return void 0===g&&(g=new MailService),g}}}(),RaidBossService=function(){function RaidBossService(){}var f;return RaidBossService.prototype.getCurrentRaidBossPeriodInfo=function(a){for(var c=0,n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),period_list=[],idx=(period_list=MasterTable.getInstance().get_RaidBossPeriodInfoList(period_list)).length-1;0<=idx;idx--){if(a)var d=moment(period_list[idx].point_check_begin_dt),et=moment(period_list[idx].point_check_end_dt),b=d.valueOf()+1e3*period_list[idx].point_check_begin_time,e=et.valueOf()+1e3*period_list[idx].point_check_end_time;else d=moment(period_list[idx].begin_dt),et=moment(period_list[idx].end_dt),b=d.valueOf()+1e3*period_list[idx].begin_time,e=et.valueOf()+1e3*period_list[idx].end_time;if(b<=n&&n<=e){c=period_list[idx].raid_boss_period_idx;break}}return c},RaidBossService.prototype.IsOpenRaidBoss=function(){var a=this.getCurrentRaidBossPeriodInfo(!1);if(0==a)return!1;var c=MasterManager.getInstance().get_RaidBossPeriod(a);if(null==c)return!1;var n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),b=moment(c.begin_dt).valueOf();b+=1e3*c.begin_time;var e=moment(c.end_dt).valueOf();return e+=1e3*c.end_time,b<=n&&n<=e},{getInstance:function(){return void 0===f&&(f=new RaidBossService),f}}}();var AchievementScene=GameScene.extend({bg:null,title:null,back_btn:null,m_achievementLayer:null,_idx:0,m_gameObserver:null,achv_list:null,ctor:function(){this._super(scene_AchievementScene)},init:function(){var a=cc.director.getWinSize();this.m_gameObserver=MainObserver.getInstance(),this.bg=new cc.Sprite(RES_CDN_DEFULT+"common/bg_sub.png"),this.bg.setPosition(cc.p(a.width/2,a.height/2)),USE_SP_COMMON_SUB_BG_SCALE&&this.bg.setScale(2),this.addChild(this.bg);var b=GameContext.getInstance().getAchievementTap(),schvService=AchievementService.getInstance();schvService.loadUserAchievement(b),this.achv_list=schvService.getUserAchievement(b),this.m_achievementLayer=new AchievementLayer,this.m_achievementLayer.setAchivementList(this.achv_list),this.m_achievementLayer.initLayout(),this.m_achievementLayer.chageTapMenu(b),this.addChild(this.m_achievementLayer);var c=new StatusLayer(INVOKER_TYPE.normal);return c.ignoreAnchorPointForPosition(!1),c.setAnchorPoint(ANCHOR_TOP_RIGHT()),c.setPosition(ccWidth(this),ccHeight(this)),this.addChild(c),this.title=new cc.Sprite(RES_CDN_DEFULT+"menu_achievement/img_achievement_text_achievement.png"),this.title.setAnchorPoint(cc.p(0,0)),this.title.setPosition(cc.p(90,585)),this.addChild(this.title),this.back_btn=new ccui.Button,this.back_btn.setTouchEnabled(!0),this.back_btn.loadTextures("btn_home_off.png","btn_home_on.png","",ccui.Widget.PLIST_TEXTURE),this.back_btn.setAnchorPoint(cc.p(0,0)),this.back_btn.setPosition(cc.p(10,559)),this.back_btn.addClickEventListener(function(){this.back()}.bind(this)),this.addChild(this.back_btn),!0},onNotification:function(a){this._super(a);var b=[];switch(a){case ACHIEVEMENT_DAY:case ACHIEVEMENT_WEEK:case ACHIEVEMENT_SEQ:case ACHIEVEMENT_BEGINNER:case ACHIEVEMENT_COLLABO:case ACHIEVEMENT_NAMING:case ACHIEVEMENT_RAID_BOSS:GameContext.getInstance().setAchievementTap(a);var c=AchievementService.getInstance();AchievementService.getInstance().loadUserAchievement(a),b=c.getUserAchievement(a),this.m_achievementLayer.setAchivementList(b),this.m_achievementLayer.chageTapMenu(a);break;case NOTIFY_ACHIEVEMENT_RECIEVE:GameContext.getInstance().getAchievementTap();0==GameContext.getInstance().getAchvReceived()&&this.sendPacketAchievementReceive();break;case NOTIFY_ACHIEVEMENT_ALL_RECIEVE:this.sendPacketAchievementReceiveAll();break;case achive_btn_show_help:GameContext.getInstance().setHelpInfoIndexByCallIndex(25),PREV_MISSION=!0;var d=new HelpContentScene;SceneManager.getInstance().pushScene(d),d=null;break;case notification_not_open_mission:return this.showNotOpenMissionMsgBox(),!0}return!0},sendPacketAchievementReceive:function(){var a=GameContext.getInstance().getSelectAchv();GameContext.getInstance().setAchvReceived(!0);var b={};b.opcode=net.OP.op_user_achievement_bonus_receive,b.achv_id=a.achv_id,this.network_write(b)},sendPacketAchievementReceiveAll:function(){var a=GameContext.getInstance().getAllAchv(),req={};req.opcode=net.OP.op_user_achievement_bonus_receive_all,req.achv_type=a.at(0).achv_type,req.event_dungeon_period_idx=0,this.network_write(req)},onNetworkEvent:function(c,d,e){if(this._super(c,d,e),c==net.OP.op_user_achievement_bonus_receive)this.removeLayerProgress(),e.error==net.ERROR.NET_E_ALREADY_RECEIVED_REWARD||this.scheduleOnce(function(){var a=GameContext.getInstance().getAchievementTap(),achvService=AchievementService.getInstance();AchievementService.getInstance().loadUserAchievement(a);var b=achvService.getUserAchievement(a);this.m_achievementLayer.setAchivementList(b),this.m_achievementLayer.setUserAchivList(),this.showNoticeRewardReceive(e.achv_bonus.bonus_type)},.5,"achive");else if(c==net.OP.op_user_achievement_bonus_receive_all)this.scheduleOnce(function(){var a=GameContext.getInstance().getAchievementTap(),achv_list=AchievementService.getInstance().getUserAchievement(a);this.m_achievementLayer.setAchivementList(achv_list),this.m_achievementLayer.setUserAchivList(),0<e.achv_bonus_list.length&&(e.achv_type==ACHIEVEMENT_NAMING?this.showNoticeRewardReceive(BONUS_TYPE_NAMING):this.showNoticeRewardReceive(e.achv_bonus_list[0].bonus_type))}.bind(this),.5,"bonus_receive");else if(c==net.OP.op_get_user_mussang){SceneManager.getInstance().getRunningScene().initLayoutProgress();var f=new MussangRoadScene;SceneManager.getInstance().replaceScene(f),f=null}},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_AchievementScene]),PREV_MISSION=!1},onExit:function(){this._super(),1==BATTLE_TO_RETRY&&(BATTLE_TO_RETRY=!1),1!=PREV_MISSION&&MainObserver.getInstance().removeObserver(sceneStr[scene_AchievementScene])},back:function(){this.m_isPushScene?SceneManager.getInstance().popScene():this.onKeyBack(!0)},showNotOpenMissionMsgBox:function(){this.m_box.setTitle(res_str("label_achievement_shortcuts_not_open_title")),this.m_box.setText(res_str("label_achievement_shortcuts_not_open_text")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(a){this.m_box.hide(!1)},0,"btnOk")}.bind(this))),this.m_box.show()}}),AchieveListItemCell=cc.TableViewCell.extend({m_name_label:null,m_reward_label:null,m_content:null,m_gauge:null,m_count_label:null,m_bonus_icon:null,m_callback:null,m_shortcutCallback:null,m_list_bg:null,m_complete_btn_mask:null,m_complete_mask:null,m_btn_sprites:[],m_bonus_bg:null,m_btn_shortcuts:[],ctor:function(a,b){return this._super(),this.init(a,b),!0},init:function(a,b){this.m_callback=a,this.m_shortcutCallback=b,this.m_btn_sprites=[],this.m_btn_shortcuts=[],this.m_list_bg=new cc.Scale9Sprite(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero()),this.m_list_bg.setAnchorPoint(0,0),this.m_list_bg.setPosition(0,0),this.m_list_bg.setContentSize(924,94),this.addChild(this.m_list_bg),this.setContentSize(this.m_list_bg.getContentSize()),this.m_name_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2013),this.m_name_label.setAnchorPoint(0,0),this.m_name_label.setPosition(80,59),this.m_list_bg.addChild(this.m_name_label),this.m_reward_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1810),this.m_reward_label.setAnchorPoint(1,0),this.m_reward_label.setPosition(675,59),this.m_list_bg.addChild(this.m_reward_label),this.m_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.m_content.setAnchorPoint(ZERO()),this.m_content.setPosition(80,33),this.m_list_bg.addChild(this.m_content);var c=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero());c.setAnchorPoint(ZERO()),c.setPosition(4,5),c.setContentSize(916,16),this.m_list_bg.addChild(c),this.m_gauge=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green.png",RectZero()),this.m_gauge.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_gauge.setPosition(3,ccCenter(c).y),c.addChild(this.m_gauge),this.m_count_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_143),this.m_count_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_count_label.setPosition(ccCenter(c)),this.m_count_label.enableOutline(cc.color.BLACK,1),c.addChild(this.m_count_label),this.m_bonus_bg=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png"),this.m_bonus_bg.setAnchorPoint(ZERO()),this.m_bonus_bg.setPosition(4,21),this.m_list_bg.addChild(this.m_bonus_bg),this.m_bonus_icon=cc.Sprite.create(),this.m_bonus_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bonus_icon.setPosition(ccCenter(this.m_bonus_bg)),this.m_bonus_bg.addChild(this.m_bonus_icon),this.m_complete_btn_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero()),this.m_complete_btn_mask.setAnchorPoint(ZERO()),this.m_complete_btn_mask.setPosition(ZERO()),this.m_complete_btn_mask.setContentSize(924,94),this.m_list_bg.addChild(this.m_complete_btn_mask),this.m_complete_btn_mask.setVisible(!1),this.m_complete_mask=cc.Sprite.create(RES_CDN_DEFULT+"menu_achievement/img_achievement_complete.png"),this.m_complete_mask.setAnchorPoint(ANCHOR_MIDDLE()),this.m_complete_mask.setPosition(ccCenter(this.m_list_bg)),USE_SP_ACHIVEMENT_SCALE&&this.m_complete_mask.setScale(2),this.m_complete_mask.setVisible(!1),this.m_list_bg.addChild(this.m_complete_mask);var d=cc.Sprite.create("#btn_05_off.png");d.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),d.setPosition(ccWidth(this.m_list_bg)-13-115,30);var e=cmLabel.getLabel("報酬受取",LABEL_FONT_INDEX.FONT_241);e.setAnchorPoint(ANCHOR_MIDDLE()),e.setPosition(ccCenter(d)),d.addChild(e),this.m_list_bg.addChild(d),this.m_btn_sprites.push(d);var f=cc.Sprite.create("#btn_05_on.png");f.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),f.setPosition(ccWidth(this.m_list_bg)-13-115,30);var g=cmLabel.getLabel("報酬受取",LABEL_FONT_INDEX.FONT_242);g.setAnchorPoint(ANCHOR_MIDDLE()),g.setPosition(ccCenter(f)),f.addChild(g),this.m_list_bg.addChild(f),f.setVisible(!1),this.m_btn_sprites.push(f);var h=cc.Sprite.create("#btn_04_none.png");h.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),h.setPosition(ccWidth(this.m_list_bg)-13-115,30);var i=cmLabel.getLabel("報酬受取",LABEL_FONT_INDEX.FONT_242);i.setAnchorPoint(ANCHOR_MIDDLE()),i.setPosition(ccCenter(h)),h.addChild(i),this.m_list_bg.addChild(h),h.setVisible(!1),this.m_btn_sprites.push(h);var j=cc.Sprite.create("#btn_05_off.png");j.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),j.setPosition(ccWidth(this.m_list_bg)-13,30);var k=cmLabel.getLabel(res_str("label_shortcuts_move"),LABEL_FONT_INDEX.FONT_241);k.setAnchorPoint(ANCHOR_MIDDLE()),k.setPosition(ccCenter(j)),j.addChild(k),this.m_list_bg.addChild(j),this.m_btn_shortcuts.push(j);var l=cc.Sprite.create("#btn_05_on.png");l.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),l.setPosition(ccWidth(this.m_list_bg)-13,30);var m=cmLabel.getLabel(res_str("label_shortcuts_move"),LABEL_FONT_INDEX.FONT_242);m.setAnchorPoint(ANCHOR_MIDDLE()),m.setPosition(ccCenter(l)),l.addChild(m),this.m_list_bg.addChild(l),l.setVisible(!1),this.m_btn_shortcuts.push(l);var n=cc.Sprite.create("#btn_04_none.png");n.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),n.setPosition(ccWidth(this.m_list_bg)-13,30);var o=cmLabel.getLabel(res_str("label_shortcuts_move"),LABEL_FONT_INDEX.FONT_242);return o.setAnchorPoint(ANCHOR_MIDDLE()),o.setPosition(ccCenter(n)),n.addChild(o),this.m_list_bg.addChild(n),n.setVisible(!1),this.m_btn_shortcuts.push(n),!0},setUserAchievement:function(a,b){this.m_achieve=a,this.updateLayout(b)},updateLayout:function(a){var m=MasterManager.getInstance(),achv_info=GameDefault.getInstance().get_AchivementString(this.m_achieve.achv_id);if(this.m_name_label.setString(achv_info.name),this.m_achieve.bonus_type==BONUS_TYPE_YUNHEE_FIX){var b=m.get_General(this.m_achieve.key_id);this.m_reward_label.setString(cmString(res_str("label_reward_count"),b.name,Number(this.m_achieve.bonus_count).toLocaleString("en")))}else this.m_achieve.bonus_type==BONUS_TYPE_NAMING?this.m_reward_label.setString(cmString(res_str("label_achievement_reward"),this.m_achieve.bonus_name)):this.m_reward_label.setString(cmString(res_str("label_reward_count"),this.m_achieve.bonus_name,Number(this.m_achieve.bonus_count).toLocaleString("en")));this.m_content.setString(achv_info.content);var c=this.m_achieve.complete_count;if(this.m_achieve.count<c&&(c=this.m_achieve.count),0==this.m_achieve.count)this.m_gauge.setScaleX(0);else{var d=c/this.m_achieve.count;d*=910,this.m_gauge.setScaleX(d)}if(this.m_count_label.setString(Number(this.m_achieve.complete_count).toLocaleString("en")+"/"+Number(this.m_achieve.count).toLocaleString("en")),this.m_achieve.bonus_type==BONUS_TYPE_YUNHEE_FIX||this.m_achieve.bonus_type==BONUS_TYPE_JIN_FIX){var e=m.get_General(this.m_achieve.key_id);e.gnrl_type==GENERAL_TYPE_MATERIAL||e.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL?(this.m_bonus_bg.removeChild(this.m_bonus_icon),this.m_bonus_icon=null,this.m_bonus_icon=cc.Sprite.create(cmString("#m_%d.png",Number(e.bone_id)))):(this.m_bonus_bg.removeChild(this.m_bonus_icon),this.m_bonus_icon=null,this.m_bonus_icon=cc.Sprite.create(cmString("#m_%d.png",Number(e.gnrl_id)))),this.m_bonus_icon.setContentSize(100,100),this.m_bonus_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bonus_icon.setPosition(ccCenter(this.m_bonus_bg)),this.m_bonus_icon.setScale(DEF_TUMB_SCALE),this.m_bonus_bg.addChild(this.m_bonus_icon)}else if(this.m_achieve.bonus_type<=BONUS_TYPE_SSR_RARE_TYPE_SELECT||this.m_achieve.bonus_type>=BONUS_TYPE_HWANDAN_1&&this.m_achieve.bonus_type<=BONUS_TYPE_HWANDAN_6||this.m_achieve.bonus_type>=BONUS_TYPE_KEY_REFILL){var f=cc.spriteFrameCache.getSpriteFrame("img_reward_"+leadingZeros(this.m_achieve.bonus_type,2)+".png");this.m_bonus_icon.setSpriteFrame(f),this.m_bonus_icon.setScale(1)}else{f=cc.spriteFrameCache.getSpriteFrame("img_reward_yh.png");this.m_bonus_icon.setSpriteFrame(f)}"y"!=this.m_achieve.complete_yn?(this.m_btn_sprites[0].setVisible(!1),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!0),this.m_complete_btn_mask.setVisible(!1)):(this.m_btn_sprites[0].setVisible(!0),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!1),this.m_complete_btn_mask.setVisible(!0)),this.m_complete_mask.setVisible(!1),this.m_achieve.achv_type!=ACHIEVEMENT_SEQ&&"y"==this.m_achieve.bonus_complete_yn?(this.m_btn_sprites[0].setVisible(!1),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!0),this.m_complete_mask.setVisible(!0),this.m_complete_btn_mask.setVisible(!0)):(this.m_complete_mask.setVisible(!1),this.m_complete_btn_mask.setVisible(!1));var g=0;1==a&&(g=115);var h=this.m_reward_label.getPosition().y;this.m_reward_label.setPosition(790-g,h);for(var i=0;i<this.m_btn_sprites.length;i++)h=this.m_btn_sprites[i].getPosition().y,this.m_btn_sprites[i].setPosition(ccWidth(this.m_list_bg)-13-g,h);if(1==a)0<this.m_achieve.shortcuts_id?"y"==this.m_achieve.complete_yn&&"y"==this.m_achieve.bonus_complete_yn?(this.m_btn_shortcuts[0].setVisible(!1),this.m_btn_shortcuts[1].setVisible(!1),this.m_btn_shortcuts[2].setVisible(!0)):(this.m_btn_shortcuts[0].setVisible(!0),this.m_btn_shortcuts[1].setVisible(!1),this.m_btn_shortcuts[2].setVisible(!1)):(this.m_btn_shortcuts[0].setVisible(!1),this.m_btn_shortcuts[1].setVisible(!1),this.m_btn_shortcuts[2].setVisible(!0));else for(var j=0;j<this.m_btn_shortcuts.length;j++)this.m_btn_shortcuts[j].setVisible(!1);achv_info=null},highlightPosInCell:function(a){var b=this.m_btn_sprites[0],r=b.getBoundingBox();cc.rectContainsPoint(r,a)?"y"==this.m_achieve.complete_yn&&"n"==this.m_achieve.bonus_complete_yn?(this.m_btn_sprites[0].setVisible(!1),this.m_btn_sprites[1].setVisible(!0),this.m_btn_sprites[2].setVisible(!1)):(this.m_btn_sprites[0].setVisible(!1),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!0)):this.m_btn_shortcuts[0].isVisible()&&(r=(b=this.m_btn_shortcuts[0]).getBoundingBox(),cc.rectContainsPoint(r,a)&&(0<this.m_achieve.shortcuts_id?"y"==this.m_achieve.complete_yn&&"y"==this.m_achieve.bonus_complete_yn?(this.m_btn_shortcuts[0].setVisible(!1),this.m_btn_shortcuts[1].setVisible(!1),this.m_btn_shortcuts[2].setVisible(!0)):(this.m_btn_shortcuts[0].setVisible(!1),this.m_btn_shortcuts[1].setVisible(!0),this.m_btn_shortcuts[2].setVisible(!1)):(this.m_btn_shortcuts[0].setVisible(!1),this.m_btn_shortcuts[1].setVisible(!1),this.m_btn_shortcuts[2].setVisible(!0))))},unhighlightPosInCell:function(a){var r=this.m_btn_sprites[0].getBoundingBox();cc.rectContainsPoint(r,a),"y"==this.m_achieve.complete_yn&&"n"==this.m_achieve.bonus_complete_yn?(this.m_btn_sprites[0].setVisible(!0),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!1)):(this.m_btn_sprites[0].setVisible(!1),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!0)),this.m_btn_shortcuts[1].isVisible()&&(0<this.m_achieve.shortcuts_id?"y"==this.m_achieve.complete_yn&&"y"==this.m_achieve.bonus_complete_yn?(this.m_btn_shortcuts[0].setVisible(!1),this.m_btn_shortcuts[1].setVisible(!1),this.m_btn_shortcuts[2].setVisible(!0)):(this.m_btn_shortcuts[0].setVisible(!0),this.m_btn_shortcuts[1].setVisible(!1),this.m_btn_shortcuts[2].setVisible(!1)):(this.m_btn_shortcuts[0].setVisible(!1),this.m_btn_shortcuts[1].setVisible(!1),this.m_btn_shortcuts[2].setVisible(!0)))},touchPosInCell:function(a){var b=this.m_btn_sprites[0],r=b.getBoundingBox();if(cc.rectContainsPoint(r,a))if("y"==this.m_achieve.complete_yn&&"n"==this.m_achieve.bonus_complete_yn){if(AudioEngine.getInstance().playNormaButtonSound(),this.m_btn_sprites[0].setVisible(!0),this.m_btn_sprites[1].setVisible(!1),null!=this.m_callback)return void(0==GameContext.getInstance().getAchvReceived()&&this.m_callback(this.m_achieve,this.getIdx()))}else this.m_btn_sprites[0].setVisible(!1),this.m_btn_sprites[1].setVisible(!1),this.m_btn_sprites[2].setVisible(!0);else if(0<this.m_btn_shortcuts.length&&(r=(b=this.m_btn_shortcuts[0]).getBoundingBox(),cc.rectContainsPoint(r,a)))if(0<this.m_achieve.shortcuts_id){if("y"==this.m_achieve.complete_yn&&"y"==this.m_achieve.bonus_complete_yn)this.m_btn_shortcuts[0].setVisible(!1),this.m_btn_shortcuts[1].setVisible(!1),this.m_btn_shortcuts[2].setVisible(!0);else if(this.m_btn_shortcuts[0].setVisible(!0),this.m_btn_shortcuts[1].setVisible(!1),this.m_btn_shortcuts[2].setVisible(!1),null!=this.m_shortcutCallback)return void this.m_shortcutCallback(this.m_achieve,this.getIdx())}else this.m_btn_shortcuts[0].setVisible(!1),this.m_btn_shortcuts[1].setVisible(!1),this.m_btn_shortcuts[2].setVisible(!0)}});AchieveListItemCell.prototype.create=function(a,b){var c=new AchieveListItemCell;return null!=c&&c.init(a,b)?c:(CC_SAFE_RELEASE(c),c=null)};var achive_btn_show_help=700,notification_not_open_mission=701,AchievementLayer=cc.Layer.extend({m_tap_day:null,m_tap_week:null,m_tap_seq:null,m_beginner_new:null,m_collabo_new:null,m_day_new:null,m_week_new:null,m_seq_new:null,m_tap_beginner:null,m_tap_collabo:null,m_tableView:null,m_info_icon:null,m_info_text:null,m_useShortcut:null,m_user_achv_list:null,m_bgBoxLayer:null,help_btn:null,_idx:0,m_all_bonus_btn:null,m_all_achv_reward:!1,m_gameObserver:null,m_tap_naming:null,m_tap_raid_boss:null,m_naming_new:null,m_raid_boss_new:null,m_achive_cell_list:[],ctor:function(a){return this._super(cc.color(0,0,0,255),cc.color(70,130,180,255)),this._idx=a,this.m_user_achv_list=[],this.m_gameObserver=MainObserver.getInstance(),this.m_achive_cell_list=[],!0},setAchivementList:function(a){this.m_user_achv_list=a,this.m_user_achv_list=stable(this.m_user_achv_list,function(l,r){return l.complete_yn<r.complete_yn}),this.m_user_achv_list=stable(this.m_user_achv_list,function(l,r){return l.bonus_complete_yn>r.bonus_complete_yn}),this.m_all_achv_reward=!1;for(var i=0;i<this.m_user_achv_list.length;i++){var b=this.m_user_achv_list[i];if("y"==b.complete_yn&&"n"==b.bonus_complete_yn)return void(this.m_all_achv_reward=!0)}},initLayout:function(){var c=cc.director.getWinSize();this.m_bgBoxLayer=this.getAchieveBoxLayer(),this.m_bgBoxLayer.ignoreAnchorPointForPosition(!1),this.m_bgBoxLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bgBoxLayer.setPosition(ccCenter(this).x,0),this.addChild(this.m_bgBoxLayer),this.help_btn=new ccui.Button,this.help_btn.loadTextures("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE),this.help_btn.setAnchorPoint(1,.5),this.help_btn.setPosition(c.width-10,538),this.addChild(this.help_btn),this.help_btn.addClickEventListener(function(b){this.scheduleOnce(function(a){MainObserver.getInstance().postNotification(sceneStr[scene_AchievementScene],achive_btn_show_help)},0,"achive_btn_show_help")}.bind(this)),c=null},getAchieveBoxLayer:function(){var b=new cc.Layer,tap_index=GameContext.getInstance().getAchievementTap(),pos_x=17,btn_name_list=[];btn_name_list[0]="btn_27_on.png",btn_name_list[1]="btn_27_none.png",btn_name_list[2]="btn_27_off.png",this.m_tap_day=new LabelButton(btn_name_list[1],btn_name_list[0],btn_name_list[2],ccui.Widget.PLIST_TEXTURE),this.m_tap_day.setFont(LABEL_FONT_INDEX.FONT_241),this.m_tap_day.setString(res_str("btn_label_day_achievement")),this.m_tap_day.setAnchorPoint(ZERO()),this.m_tap_day.setPosition(pos_x,508),this.m_tap_day.addClickEventListener(function(a){this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],ACHIEVEMENT_DAY)}.bind(this)),b.addChild(this.m_tap_day),pos_x+=ccWidth(this.m_tap_day),this.m_tap_week=new LabelButton(btn_name_list[1],btn_name_list[0],btn_name_list[2],ccui.Widget.PLIST_TEXTURE),this.m_tap_week.setFont(LABEL_FONT_INDEX.FONT_241),this.m_tap_week.setString(res_str("btn_label_week_achievement")),this.m_tap_week.setAnchorPoint(ZERO()),this.m_tap_week.setPosition(pos_x,ccPosY(this.m_tap_day)),this.m_tap_week.addClickEventListener(function(a){this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],ACHIEVEMENT_WEEK)}.bind(this)),b.addChild(this.m_tap_week),pos_x+=ccWidth(this.m_tap_week),this.m_tap_seq=new LabelButton(btn_name_list[1],btn_name_list[0],btn_name_list[2],ccui.Widget.PLIST_TEXTURE),this.m_tap_seq.setFont(LABEL_FONT_INDEX.FONT_241),this.m_tap_seq.setString(res_str("btn_label_sequence_achievement")),this.m_tap_seq.setAnchorPoint(ZERO()),this.m_tap_seq.setPosition(pos_x,ccPosY(this.m_tap_day)),this.m_tap_seq.addClickEventListener(function(a){this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],ACHIEVEMENT_SEQ)}.bind(this)),b.addChild(this.m_tap_seq),pos_x+=ccWidth(this.m_tap_seq),this.m_tap_beginner=new LabelButton(btn_name_list[1],btn_name_list[0],btn_name_list[2],ccui.Widget.PLIST_TEXTURE),this.m_tap_beginner.setFont(LABEL_FONT_INDEX.FONT_241),this.m_tap_beginner.setString(res_str("btn_label_beginner_achievement")),this.m_tap_beginner.setAnchorPoint(ZERO()),this.m_tap_beginner.setPosition(pos_x,ccPosY(this.m_tap_day)),this.m_tap_beginner.addClickEventListener(function(a){this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],ACHIEVEMENT_BEGINNER)}.bind(this)),b.addChild(this.m_tap_beginner),pos_x+=ccWidth(this.m_tap_beginner),1==USE_COLLABO_ACHIEVEMENT&&AchievementService.getInstance().checkAchievementPeriod(ACHIEVEMENT_COLLABO)&&(this.m_tap_collabo=new LabelButton(btn_name_list[1],btn_name_list[0],btn_name_list[2],ccui.Widget.PLIST_TEXTURE),this.m_tap_collabo.setFont(LABEL_FONT_INDEX.FONT_201),this.m_tap_collabo.setString(res_str("btn_label_collabo_achievement")),this.m_tap_collabo.setAnchorPoint(ZERO()),this.m_tap_collabo.setPosition(pos_x,ccPosY(this.m_tap_day)),this.m_tap_collabo.addClickEventListener(function(a){this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],ACHIEVEMENT_COLLABO)}.bind(this)),b.addChild(this.m_tap_collabo),pos_x+=ccWidth(this.m_tap_collabo)),this.m_tap_naming=new LabelButton(btn_name_list[1],btn_name_list[0],btn_name_list[2],ccui.Widget.PLIST_TEXTURE),this.m_tap_naming.setFont(LABEL_FONT_INDEX.FONT_241),this.m_tap_naming.setString(res_str("btn_label_naming_achievement")),this.m_tap_naming.setAnchorPoint(ZERO()),this.m_tap_naming.setPosition(pos_x,ccPosY(this.m_tap_day)),this.m_tap_naming.addClickEventListener(function(a){this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],ACHIEVEMENT_NAMING)}.bind(this)),b.addChild(this.m_tap_naming),pos_x+=ccWidth(this.m_tap_day),AchievementService.getInstance().checkAchievementPeriod(ACHIEVEMENT_RAID_BOSS)&&(this.m_tap_raid_boss=new LabelButton(btn_name_list[1],btn_name_list[0],btn_name_list[2],ccui.Widget.PLIST_TEXTURE),this.m_tap_raid_boss.setFont(LABEL_FONT_INDEX.FONT_241),this.m_tap_raid_boss.setString(res_str("btn_label_raid_boss_achievement")),this.m_tap_raid_boss.setAnchorPoint(ZERO()),this.m_tap_raid_boss.setPosition(pos_x,ccPosY(this.m_tap_day)),this.m_tap_raid_boss.addClickEventListener(function(a){this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],ACHIEVEMENT_RAID_BOSS)}.bind(this)),b.addChild(this.m_tap_raid_boss),pos_x+=ccWidth(this.m_tap_raid_boss)),btn_name_list=null,this.m_day_new=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_day_new.setAnchorPoint(.5,.5),this.m_day_new.setPosition(this.m_tap_day.width-15,this.m_tap_day.height-7),this.m_day_new.setVisible(!1),this.m_tap_day.addChild(this.m_day_new),this.m_week_new=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_week_new.setAnchorPoint(.5,.5),this.m_week_new.setPosition(this.m_tap_week.width-15,this.m_tap_week.height-7),this.m_week_new.setVisible(!1),this.m_tap_week.addChild(this.m_week_new),this.m_seq_new=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_seq_new.setAnchorPoint(.5,.5),this.m_seq_new.setPosition(this.m_tap_seq.width-15,this.m_tap_seq.height-7),this.m_seq_new.setVisible(!1),this.m_tap_seq.addChild(this.m_seq_new),this.m_beginner_new=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_beginner_new.setAnchorPoint(ANCHOR_MIDDLE()),this.m_beginner_new.setPosition(ccWidth(this.m_tap_beginner)-15,ccHeight(this.m_tap_beginner)-7),this.m_tap_beginner.addChild(this.m_beginner_new),1==USE_COLLABO_ACHIEVEMENT&&null!=this.m_tap_collabo&&(this.m_collabo_new=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_collabo_new.setAnchorPoint(ANCHOR_MIDDLE()),this.m_collabo_new.setPosition(ccWidth(this.m_tap_collabo)-15,ccHeight(this.m_tap_collabo)-7),this.m_tap_collabo.addChild(this.m_collabo_new)),this.m_naming_new=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_naming_new.setAnchorPoint(ANCHOR_MIDDLE()),this.m_naming_new.setPosition(ccWidth(this.m_tap_naming)-15,ccHeight(this.m_tap_naming)-7),this.m_tap_naming.addChild(this.m_naming_new),null!=this.m_tap_raid_boss&&(this.m_raid_boss_new=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_raid_boss_new.setAnchorPoint(ANCHOR_MIDDLE()),this.m_raid_boss_new.setPosition(ccWidth(this.m_tap_raid_boss)-15,ccHeight(this.m_tap_raid_boss)-7),this.m_tap_raid_boss.addChild(this.m_raid_boss_new)),tap_index==ACHIEVEMENT_DAY?this.m_tap_day.setEnabled(!1):tap_index==ACHIEVEMENT_WEEK?this.m_tap_week.setEnabled(!1):tap_index==ACHIEVEMENT_SEQ?this.m_tap_seq.setEnabled(!1):tap_index==ACHIEVEMENT_BEGINNER?this.m_tap_beginner.setEnabled(!1):tap_index==ACHIEVEMENT_COLLABO?null!=this.m_tap_collabo&&this.m_tap_collabo.setEnabled(!1):tap_index==ACHIEVEMENT_NAMING?this.m_tap_naming.setEnabled(!1):tap_index==ACHIEVEMENT_RAID_BOSS&&null!=this.m_tap_raid_boss&&this.m_tap_raid_boss.setEnabled(!1),tap_index==ACHIEVEMENT_SEQ||tap_index==ACHIEVEMENT_NAMING||tap_index==ACHIEVEMENT_BEGINNER||tap_index==ACHIEVEMENT_COLLABO?this.m_useShortcut=!0:this.m_useShortcut=!1;var c=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));if(c.setPreferredSize(cc.size(958,515)),c.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),c.setPosition(0,0),b.addChild(c),b.setContentSize(c.getContentSize()),this.m_tableView=new cc.TableView(this,cc.size(924,432)),this.m_tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_tableView.scrollBarEnable(!0),this.m_tableView.setPosition(17,58),b.addChild(this.m_tableView),this.m_tableView.setDelegate(this),this.m_tableView.reloadData(),this.setTapNewIcon(),this.m_info_icon=new cc.Sprite(RES_CDN_DEFULT+"menu_friend/img_friend_text.png"),this.m_info_icon.setAnchorPoint(0,0),this.m_info_icon.setPosition(361,17),b.addChild(this.m_info_icon),this.m_info_text=cmLabel.getLabel("毎日午前４時に更新されます。",LABEL_FONT_INDEX.FONT_1613),this.m_info_text.setAnchorPoint(ZERO()),this.m_info_text.setPosition(ccPosX(this.m_info_icon)+ccWidth(this.m_info_icon),24),b.addChild(this.m_info_text),tap_index==ACHIEVEMENT_SEQ||tap_index==ACHIEVEMENT_NAMING||tap_index==ACHIEVEMENT_BEGINNER)this.m_info_icon.setVisible(!1),this.m_info_text.setVisible(!1);else if(tap_index==ACHIEVEMENT_WEEK)this.m_info_icon.setPosition(341,17),this.m_info_text.setPosition(ccPosX(this.m_info_icon)+ccWidth(this.m_info_icon),24),this.m_info_text.setString(res_str("label_achievement_info_text_week"));else if(tap_index==ACHIEVEMENT_COLLABO)this.m_info_icon.setPosition(268,17),this.m_info_text.setPosition(ccPosX(this.m_info_icon)+ccWidth(this.m_info_icon),24),this.m_info_text.setString(res_str("label_achievement_info_text_collabo"));else if(tap_index==ACHIEVEMENT_RAID_BOSS){var d=this.getAchvPeriodString(ACHIEVEMENT_RAID_BOSS);this.m_info_icon.setPosition(311,17),this.m_info_text.setPosition(ccPosX(this.m_info_icon)+ccWidth(this.m_info_icon),24),this.m_info_text.setString(d)}return this.m_all_bonus_btn=new LabelButton("btn_11_off.png","btn_11_on.png","btn_11_none.png",ccui.Widget.PLIST_TEXTURE),this.m_all_bonus_btn.setFont(LABEL_FONT_INDEX.FONT_201),this.m_all_bonus_btn.setString(res_str("btn_label_all_accept")),this.m_all_bonus_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_all_bonus_btn.setPosition(ccWidth(c)-17,18),this.m_all_bonus_btn.addClickEventListener(function(){this.sendRewardAllAchievement()}.bind(this)),this.m_all_bonus_btn.setEnabled(this.m_all_achv_reward),b.addChild(this.m_all_bonus_btn),pos_x=tap_index=null,btn_name_list=[],b},scrollViewDidScroll:function(a){},scrollViewDidZoom:function(a){},tableCellTouched:function(a,b){cc.log("cell touched at index: "+b.getIdx());null!=b&&b.touchPosInCell(b.getTouchPos())},tableCellUnhighlight:function(a,b){null!=b&&b.unhighlightPosInCell(b.getTouchPos())},tableCellEnded:function(){},tableCellHighlight:function(a,b){null!=b&&b.highlightPosInCell(b.getTouchPos())},tableCellSizeForIndex:function(a,b){return cc.size(924,94)},cellSizeForTable:function(a){return cc.size(924,94)},tableCellAtIndex:function(a,b){var c=a.dequeueCell(),cell=null;cell=null!=c?c:new AchieveListItemCell(this.sendRewardAchievement.bind(this),this.moveAchievementShortcuts.bind(this));var d=this.m_user_achv_list[b];return cell.setUserAchievement(d,this.m_useShortcut),this.m_achive_cell_list.push(cell),d=null,cell},numberOfCellsInTableView:function(a){return this.m_user_achv_list.length},sendRewardAchievement:function(a,b){AudioEngine.getInstance().playNormaButtonSound(),GameContext.getInstance().setSelectAchv(a),cc.log("RewardAchievement"),this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],NOTIFY_ACHIEVEMENT_RECIEVE)},sendRewardAllAchievement:function(){var a=AudioEngine.getInstance();a.stopVoice();var b=RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3";a.playEffect(b),GameContext.getInstance().setAllAchv(this.m_user_achv_list),MainObserver.getInstance().postNotification(NOTIFY_ACHIEVEMENT_ALL_RECIEVE)},moveAchievementShortcuts:function(b,c){if(0<b.shortcuts_id){var d=MasterManager.getInstance().get_AchievementShortcuts(b.shortcuts_id);if(d.shortcuts_type>SHORTCUTS_TYPE_NONE){var e=!0;if(d.shortcuts_type==SHORTCUTS_TYPE_MISSION&&0<d.dungeon_id&&(e=MissionService.getInstance().IsOpenMainMission(d.dungeon_id)),1==e)switch(d.shortcuts_type){case SHORTCUTS_TYPE_MISSION:if(SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene),0<d.dungeon_id){var f=BattleContext._getInstance();f.setGameType(db.BattleGameType.Mission),f.setMissionID(d.dungeon_id),f.showNextMissionPopup(!0)}SceneManager.getInstance().getRunningScene().initLayoutProgress(),(g=new StorySceneV2).get_story_deferred().done(function(){this.scheduleOnce(function(a){SceneManager.getInstance().replaceScene(g,!0),g=null},1.5,"main_layer_ready")}.bind(this));break;case SHORTCUTS_TYPE_WEEK:SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene),SceneManager.getInstance().getRunningScene().initLayoutProgress(),(g=new WeeklyEntryScene).get_story_deferred().done(function(){this.scheduleOnce(function(a){SceneManager.getInstance().replaceScene(g,!0),g=null},1.5,"main_layer_ready")}.bind(this));break;case SHORTCUTS_TYPE_EVENT_DUNGEON_1:if(SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene),0==(event_dungeon_period_idx=(h=EventDungeonService.getInstance()).getFirstEventDungeonPeriodIdx()))return;BattleContext._getInstance().setEventDungeonPeriodIdX(event_dungeon_period_idx),this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],NOTIFY_MENU_EVENT_DUNGEON_ENTRANCE);break;case SHORTCUTS_TYPE_SHOP:SceneManager.getInstance().getRunningScene().initLayoutProgress(),SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene);var g=new GachaScene_WebV2(!1,GACHA_TAB_TYPE_HEART);SceneManager.getInstance().replaceScene(g),g=null;break;case SHORTCUTS_TYPE_EVENT_DUNGEON_2:SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene);var h,event_dungeon_period_idx=(h=EventDungeonService.getInstance()).getFirstEventDungeonPeriodIdx();h.getSecondEventDungeonPeriodIdx();if(0==event_dungeon_period_idx)return;BattleContext._getInstance().setEventDungeonPeriodIdX(event_dungeon_period_idx),this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],NOTIFY_MENU_EVENT_DUNGEON_ENTRANCE);break;case SHORTCUTS_TYPE_MUSSANG_ROAD:SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene);var i={};i.opcode=net.OP.op_get_user_mussang;var j=SceneManager.getInstance().getMainScene();GameClient().write(i,j.onNetworkEvent,j);break;case SHORTCUTS_TYPE_DAILY_DUNGEON:SceneManager.getInstance().getRunningScene().initLayoutProgress(),SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene);var k=MasterTable.getInstance().get_DailyDungeonMaxPeriod();BattleContext._getInstance().setDailyDungeonPeriodIdx(k.daily_dungeon_period_idx);g=new DailyDungeonListScene;SceneManager.getInstance().replaceScene(g),g=null;break;case SHORTCUTS_TYPE_YUNHEE_SCENE:SceneManager.getInstance().getRunningScene().initLayoutProgress(),SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene),GameContext.getInstance().setElementTypeFilter(100),GameContext.getInstance().setYunheeTypeFilter(100),GameContext.getInstance().setYunheeTabType(1),GameContext.getInstance().setYunheePrevSceneId(scene_MainHomeScene);g=new YunheeScene;SceneManager.getInstance().replaceScene(g),g=null;break;case SHORTCUTS_TYPE_BATTLE_FORMATION:SceneManager.getInstance().getRunningScene().initLayoutProgress(),SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene);g=new BattleFormationScene;SceneManager.getInstance().replaceScene(g),g=null;break;case SHORTCUTS_TYPE_CAMP_MAGIC_KEY_EXCHANGE:SceneManager.getInstance().getRunningScene().initLayoutProgress(),SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene);g=new CampFactoryScene;SceneManager.getInstance().replaceScene(g),g=null}else this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],notification_not_open_mission)}}},chageTapMenu:function(a,b){switch(this.m_tap_day.setEnabled(!0),this.m_tap_week.setEnabled(!0),this.m_tap_seq.setEnabled(!0),this.m_tap_beginner.setEnabled(!0),1==USE_COLLABO_ACHIEVEMENT&&null!=this.m_tap_collabo&&this.m_tap_collabo.setEnabled(!0),this.m_tap_naming.setEnabled(!0),null!=this.m_tap_raid_boss&&this.m_tap_raid_boss.setEnabled(!0),a){case ACHIEVEMENT_DAY:this.m_tap_day.setEnabled(!1),this.m_info_icon.setVisible(!0),this.m_info_text.setVisible(!0),this.m_info_icon.setPosition(361,17),this.m_info_text.setPosition(ccPosX(this.m_info_icon)+ccWidth(this.m_info_icon),24),this.m_info_text.setString("毎日午前４時に更新されます。");break;case ACHIEVEMENT_WEEK:this.m_tap_week.setEnabled(!1),this.m_info_icon.setVisible(!0),this.m_info_text.setVisible(!0),this.m_info_icon.setPosition(341,17),this.m_info_text.setPosition(ccPosX(this.m_info_icon)+ccWidth(this.m_info_icon),24),this.m_info_text.setString("毎週月曜日午前４時に更新されます。");break;case ACHIEVEMENT_SEQ:this.m_tap_seq.setEnabled(!1),this.m_info_icon.setVisible(!1),this.m_info_text.setVisible(!1),this.m_info_icon.setPosition(341,17),this.m_info_text.setPosition(ccPosX(this.m_info_icon)+ccWidth(this.m_info_icon),24),this.m_info_text.setString("毎週月曜日午前４時に更新されます。");break;case ACHIEVEMENT_BEGINNER:this.m_tap_beginner.setEnabled(!1),this.m_info_icon.setVisible(!1),this.m_info_text.setVisible(!1),this.m_info_icon.setPosition(341,17),this.m_info_text.setPosition(ccPosX(this.m_info_icon)+ccWidth(this.m_info_icon),24),this.m_info_text.setString(res_str("label_achievement_info_text_beginner"));break;case ACHIEVEMENT_COLLABO:1==USE_COLLABO_ACHIEVEMENT&&null!=this.m_tap_collabo&&(this.m_tap_collabo.setEnabled(!1),this.m_info_icon.setVisible(!0),this.m_info_text.setVisible(!0),this.m_info_icon.setPosition(268,17),this.m_info_text.setPosition(ccPosX(this.m_info_icon)+ccWidth(this.m_info_icon),24),this.m_info_text.setString("※期間限定：3月8日から3月22日メンテナンス前まで。"));break;case ACHIEVEMENT_NAMING:this.m_tap_naming.setEnabled(!1),this.m_info_icon.setVisible(!1),this.m_info_text.setVisible(!1),this.m_info_icon.setPosition(341,17),this.m_info_text.setPosition(ccPosX(this.m_info_icon)+ccWidth(this.m_info_icon),24),this.m_info_text.setString("常時ミッション : 更新されません。");break;case ACHIEVEMENT_RAID_BOSS:if(null!=this.m_tap_raid_boss){var c=this.getAchvPeriodString(ACHIEVEMENT_RAID_BOSS);this.m_tap_raid_boss.setEnabled(!1),this.m_info_icon.setVisible(!0),this.m_info_text.setVisible(!0),this.m_info_icon.setPosition(311,17),this.m_info_text.setPosition(ccPosX(this.m_info_icon)+ccWidth(this.m_info_icon),24),this.m_info_text.setString(c)}}a==ACHIEVEMENT_BEGINNER||a==ACHIEVEMENT_COLLABO?this.m_useShortcut=!0:this.m_useShortcut=!1,this.m_tableView.setPosition(17,58),this.m_tableView.setViewSize(cc.size(924,438)),this.m_tableView.reloadData(),this.setTapNewIcon(),this.m_all_bonus_btn.setEnabled(this.m_all_achv_reward)},setTapNewIcon:function(){var a=AchievementService.getInstance(),day_count=a.getUserAchievementCompleteCount(ACHIEVEMENT_DAY);this.m_day_new.setVisible(day_count);var b=a.getUserAchievementCompleteCount(ACHIEVEMENT_WEEK);this.m_week_new.setVisible(b);var c=a.getUserAchievementCompleteCount(ACHIEVEMENT_SEQ);this.m_seq_new.setVisible(c);var d=a.getUserAchievementCompleteCount(ACHIEVEMENT_BEGINNER);null!=this.m_beginner_new&&this.m_beginner_new.setVisible(d);var e=a.getUserAchievementCompleteCount(ACHIEVEMENT_COLLABO);null!=this.m_collabo_new&&this.m_collabo_new.setVisible(e);var f=a.getUserAchievementCompleteCount(ACHIEVEMENT_NAMING);null!=this.m_naming_new&&this.m_naming_new.setVisible(f);var g=a.getUserAchievementCompleteCount(ACHIEVEMENT_RAID_BOSS);null!=this.m_raid_boss_new&&this.m_raid_boss_new.setVisible(g)},setUserAchivList:function(){var a=cc.p(this.m_tableView.getContentOffset().x,this.m_tableView.getContentOffset().y);this.m_tableView.reloadData(),a.y>this.m_tableView.minContainerOffset().y&&this.m_tableView.setContentOffset(a,!1),this.m_all_bonus_btn.setEnabled(this.m_all_achv_reward),this.setTapNewIcon()},getAchvPeriodString:function(a){var b,date_str="";if(0<(b=MasterTable.getInstance().get_AchievementPeriodByType(a)).period_id){var c=moment(b.end_dt).valueOf(),e=moment(c);date_str=cmString(cmString(res_str("label_achievement_info_text_raid_boss"),e.get("month")+1,e.get("date"),e.month(),e.date()))}else date_str=res_str("label_achievement_info_text_seq");return date_str},onExit:function(){this._super(),1!=PREV_MISSION&&(this.m_tap_day=null,this.m_tap_week=null,this.m_tap_seq=null,this.m_beginner_new=null,this.m_collabo_new=null,this.m_day_new=null,this.m_week_new=null,this.m_seq_new=null,this.m_tap_beginner=null,this.m_tap_collabo=null,this.m_tableView=null,this.m_info_icon=null,this.m_info_text=null,this.m_useShortcut=null,this.m_user_achv_list=null,this.m_bgBoxLayer=null,this.help_btn=null,this.m_gameObserver=null,this.m_tap_naming=null,this.m_naming_new=null,this.m_achive_cell_list.forEach(function(t){t.removeAllChildrenWithCleanup(!0)}),this.m_achive_cell_list=[])}}),BookGeneralEnum={btn_character_change:100,btn_voice:101,btn_yunhee_love_show:102,btn_character_love_level:103,btn_show_love_cg:104,btn_show_resistance_help:105,btn_show_standing_detail_view:106},BooksGeneralLayer=cc.Layer.extend({m_skeleton_action_index:null,m_scrollContentLayer:null,m_skeletonNode:null,m_resistanceLayer:null,m_scrollLayer:null,m_info_btn:null,m_resistance_btn:null,m_title_label:null,m_voiceScrollLayer:null,ctor:function(){this._super(),this.m_skeleton_action_index=0,this.m_scrollContentLayer=null,this.m_skeletonNode=null,this.m_resistanceLayer=null,this.m_scrollLayer=null,this.m_info_btn=null,this.m_resistance_btn=null,this.m_title_label=null,this.m_bookGeneral=null,this.m_voiceScrollLayer=null},initLayout:function(){var a=this.getLeftBottomLayer();a.setPosition(cc.p(0,0)),this.addChild(a);var b=this.getRightBoxLayer();b.ignoreAnchorPointForPosition(!1),b.setAnchorPoint(cc.p(1,0)),b.setPosition(this.width,0),this.addChild(b)},setBookGeneralInfo:function(a){this.m_bookGeneral=a},getLeftBottomLayer:function(){var c=new cc.Layer;c.setContentSize(this.width-478,320);var d=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_namebox.png");d.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),d.setPosition(c.width/2,0),c.addChild(d);var e=cmLabel.getLabel(this.m_bookGeneral.name,LABEL_FONT_INDEX.FONT_261);e.setAnchorPoint(ANCHOR_MIDDLE()),e.setPosition(ccCenter(d)),d.addChild(e),cmLabel.autoSizeFit(e,186,26);var f=this.getRareTypeSprite();f.setAnchorPoint(cc.p(.5,0)),f.setPosition(c.width/2,84),c.addChild(f);var h=new ccui.Button;h.loadTextures("btn_purple_circle_cg_off.png","btn_purple_circle_cg_on.png","",ccui.Widget.PLIST_TEXTURE),h.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),h.setPosition(cc.p(ccWidth(c)-6,9)),c.addChild(h),h.addClickEventListener(function(a){var g=MasterManager.getInstance().get_General(this.m_bookGeneral.gnrl_id);this.getParent().m_bookGeneral.is_max_love_level&&99999!=g.love_cg_num&&19!=g.gnrl_group&&0<g.love_cg_num&&(GameContext.getInstance().setLoveCgGnrlId(g.gnrl_id),MainObserver.getInstance().postNotification(sceneStr[scene_BooksGeneralScene],btn_yunhee_love_show))}.bind(this)),this.m_bookGeneral.gender_type==GENDER_TYPE_M&&h.loadTextures("btn_purple_circle_cgman_off.png","btn_purple_circle_cgman_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_bookGeneral.is_max_love_level&&this.m_bookGeneral.gnrl_type!=GENERAL_TYPE_SOLDIER||(h.loadTextures("btn_gray_circle_cg_off.png","btn_gray_circle_cg_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_bookGeneral.gender_type!=GENDER_TYPE_M&&this.m_bookGeneral.gnrl_type!=GENERAL_TYPE_SOLDIER||h.loadTextures("btn_gray_circle_cgman_off.png","btn_gray_circle_cgman_on.png","",ccui.Widget.PLIST_TEXTURE)),19==this.m_bookGeneral.gnrl_group&&h.loadTextures("btn_gray_circle_cgman_off.png","btn_gray_circle_cgman_on.png","",ccui.Widget.PLIST_TEXTURE);var i=new ccui.Button;i.loadTextures("btn_purple_circle_change_off.png","btn_purple_circle_change_on.png","",ccui.Widget.PLIST_TEXTURE),i.setAnchorPoint(cc.p(0,0)),i.setPosition(cc.p(6,9)),c.addChild(i),i.addClickEventListener(function(){MainObserver.getInstance().postNotification(sceneStr[scene_BooksGeneralScene],BookGeneralEnum.btn_character_change)}.bind(this)),453==this.m_bookGeneral.gnrl_group&&(h.loadTextures("btn_purple_circle_cgman_off.png","btn_purple_circle_cgman_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_bookGeneral.is_max_love_level&&this.m_bookGeneral.gnrl_type!=GENERAL_TYPE_SOLDIER||h.loadTextures("btn_gray_circle_cgman_off.png","btn_gray_circle_cgman_on.png","",ccui.Widget.PLIST_TEXTURE),i.loadTextures("btn_purple_circle_change_off.png","btn_purple_circle_change_on.png","",ccui.Widget.PLIST_TEXTURE));var j=new ccui.Button;return j.loadTextures("btn_purple_circle_zoom_off.png","btn_purple_circle_zoom_on.png","",ccui.Widget.PLIST_TEXTURE),j.setAnchorPoint(ZERO),j.setPosition(6,79),c.addChild(j),j.addClickEventListener(function(a){var b={};b.gnrl_id=this.m_bookGeneral.gnrl_id,b.gnrl_num=0,b.display_class=this.m_bookGeneral.gnrl_class,GameContext.getInstance().setDetailStandingGnrlId(b),MainObserver.getInstance().postNotification(sceneStr[scene_BooksGeneralScene],BookGeneralEnum.btn_show_standing_detail_view)}.bind(this)),c},getRightBoxLayer:function(){var b=new cc.Layer,right_bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));right_bg_box.setContentSize(478,568),right_bg_box.setAnchorPoint(ZERO()),right_bg_box.setPosition(ZERO()),b.addChild(right_bg_box),b.setContentSize(right_bg_box.getContentSize()),this.m_bookGeneral.gnrl_type!=GENERAL_TYPE_EVOLVE_MATERIAL&&this.m_bookGeneral.gnrl_type!=GENERAL_TYPE_MATERIAL&&this.m_bookGeneral.gnrl_type!=GENERAL_TYPE_LIMIT_OVER&&(this.m_info_btn=new LabelButton("btn_09_none.png","btn_10_on.png","btn_10_off.png",ccui.Widget.PLIST_TEXTURE),this.m_info_btn.setAnchorPoint(cc.p(1,0)),this.m_info_btn.setFont(LABEL_FONT_INDEX.FONT_221),this.m_info_btn.setString("情報"),this.m_info_btn.setPosition(cc.p(5,464)),right_bg_box.addChild(this.m_info_btn),this.m_info_btn.setEnabled(!1),this.m_info_btn.addClickEventListener(function(){this.m_resistance_btn.setEnabled(!0),this.m_info_btn.setEnabled(!1),1==USE_BOOK_DETAIL_VOICE&&this.m_voice_btn.setEnabled(!0),this.m_scrollLayer.setVisible(!0),this.m_scrollLayer.setContentOffset(OffsetType.jumpToTop),this.m_resistanceLayer.setVisible(!1),1==USE_BOOK_DETAIL_VOICE&&this.m_voiceScrollLayer.setVisible(!1),this.m_title_label.setString("情報")}.bind(this)),this.m_resistance_btn=new LabelButton("btn_09_none.png","btn_10_on.png","btn_10_off.png",ccui.Widget.PLIST_TEXTURE),this.m_resistance_btn.setAnchorPoint(cc.p(1,0)),this.m_resistance_btn.setFont(LABEL_FONT_INDEX.FONT_221),this.m_resistance_btn.setString("耐性"),this.m_resistance_btn.setPosition(cc.p(5,394)),right_bg_box.addChild(this.m_resistance_btn),this.m_resistance_btn.addClickEventListener(function(){this.m_resistance_btn.setEnabled(!1),this.m_info_btn.setEnabled(!0),1==USE_BOOK_DETAIL_VOICE&&this.m_voice_btn.setEnabled(!0),this.m_scrollLayer.setVisible(!1),this.m_resistanceLayer.setVisible(!0),1==USE_BOOK_DETAIL_VOICE&&this.m_voiceScrollLayer.setVisible(!1),this.m_title_label.setString("耐性")}.bind(this)),1==USE_BOOK_DETAIL_VOICE&&(this.m_voice_btn=new LabelButton("btn_09_none.png","btn_10_on.png","btn_10_off.png",ccui.Widget.PLIST_TEXTURE),this.m_voice_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_voice_btn.setFont(LABEL_FONT_INDEX.FONT_161),this.m_voice_btn.setString(res_str("btn_label_voice")),this.m_voice_btn.setPosition(5,324),right_bg_box.addChild(this.m_voice_btn),this.m_voice_btn.addClickEventListener(function(a){this.m_resistance_btn.setEnabled(!0),this.m_info_btn.setEnabled(!0),this.m_voice_btn.setEnabled(!1),this.m_scrollLayer.setVisible(!1),this.m_resistanceLayer.setVisible(!1),this.m_voiceScrollLayer.setVisible(!0),this.m_title_label.setString(res_str("voice_list_title"))}.bind(this))));var c=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");return c.setAnchorPoint(cc.p(0,0)),c.setPosition(8,509),right_bg_box.addChild(c),this.m_title_label=cmLabel.getLabel("情報",LABEL_FONT_INDEX.FONT_261),this.m_title_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_title_label.setPosition(ccCenter(c)),c.addChild(this.m_title_label),this.m_scrollLayer=new ScrollLayer,this.m_scrollLayer.setContentSize(447,487),this.m_scrollLayer.getItemNode=function(a,m){return this.m_scrollContentLayer=this.getDetailContentLayer(),this.m_scrollContentLayer}.bind(this),this.m_scrollLayer.initLayout(),this.m_scrollLayer.setPosition(17,15),right_bg_box.addChild(this.m_scrollLayer),this.m_resistanceLayer=this.getResistanceLayer(),this.m_resistanceLayer.ignoreAnchorPointForPosition(!1),this.m_resistanceLayer.setAnchorPoint(cc.p(.5,1)),this.m_resistanceLayer.setPosition(right_bg_box.width/2,right_bg_box.height-61),right_bg_box.addChild(this.m_resistanceLayer),cc.log(right_bg_box.getContentSize()),this.m_resistanceLayer.setVisible(!1),1==USE_BOOK_DETAIL_VOICE&&(this.m_voiceScrollLayer=this.getVoiceListLayer(),this.m_voiceScrollLayer.setPosition(17,23),right_bg_box.addChild(this.m_voiceScrollLayer),this.m_voiceScrollLayer.setVisible(!1)),b},getResistanceLayer:function(){var a=new cc.Layer,bg_box=new cc.Scale9Sprite(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",cc.Rect(20,20,20,20));bg_box.setContentSize(444,362),bg_box.setAnchorPoint(cc.p(0,0)),bg_box.setPosition(cc.p(0,0)),a.addChild(bg_box);var b=this.getTableLayer();b.setEnableMouseScroll(!1),b.setPosition(5,20),a.addChild(b),a.setContentSize(ccSize(bg_box));var c=new LabelButton("btn_21_off.png","btn_21_on.png","",ccui.Widget.PLIST_TEXTURE);return c.setAnchorPoint(cc.p(1,1)),c.setFont(LABEL_FONT_INDEX.FONT_221),c.setString("状態異常情報"),c.setPosition(cc.p(bg_box.width,0)),bg_box.addChild(c),c.addClickEventListener(function(){MainObserver.getInstance().postNotification(sceneStr[scene_BooksGeneralScene],BookGeneralEnum.btn_show_resistance_help)}),a},getVoiceListLayer:function(){MasterTable.getInstance();var c=new ScrollLayer;return c.setContentSize(447,487),c.getItemNode=function(a,m){var b=0,scrollLayer=new ScrollLayer,list=MasterTable.getInstance().get_Voice_List();list.reverse();for(var i=0;i<list.length;i++){var l=list[i],layer=this.getVoiceContentLayer(l);null!=layer&&(layer.setPosition(0,b),scrollLayer.addChild(layer),b+=ccHeight(layer))}if(scrollLayer.setContentSize(444,b),b<487){var y=487-b;scrollLayer.setPosition(0,y)}return scrollLayer}.bind(this),c.initLayout(),c},getVoiceContentLayer:function(b){var c=new cc.Layer,bg_box=(MasterTable.getInstance(),cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_5.png",cc.Rect(20,20,20,20)));bg_box.setAnchorPoint(ZERO()),bg_box.setContentSize(444,76),bg_box.setPosition(ZERO()),bg_box.setName("bg_box"),c.addChild(bg_box);var d=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_white.png");d.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),d.setPosition(15,ccCenter(bg_box).y),bg_box.addChild(d);var e=cmLabel.getLabel(b.list_name,LABEL_FONT_INDEX.FONT_201);e.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),e.setPosition(30,ccCenter(bg_box).y),bg_box.addChild(e);var f=new ccui.Button;return f.loadTextures("btn_voice_off.png","btn_voice_on.png","",ccui.Widget.PLIST_TEXTURE),f.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),f.setPosition(ccWidth(bg_box)-12,ccCenter(bg_box).y),bg_box.addChild(f),f.addClickEventListener(function(a){this.play_voice(b.list_type,b.list_division)}.bind(this)),c.setContentSize(ccSize(bg_box)),this.scheduleUpdate(),c},play_voice:function(a,b){var m=MasterTable.getInstance(),audio=AudioEngine.getInstance(),voice=m.get_Voice_V2(this.m_bookGeneral.gnrl_id,a,b,0);if(""!=voice&&null!=voice){var c=RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3";audio.playVoice(c,!1)}},update:function(a){},getTableLayer:function(){var d=new TableViewLayer;return d.setAnchorPoint(ZERO()),d.setContentSize(434,324),d.setColumnCount(1),d.setItemCount(8),d.getItemNode=function(a,b,c){return new YunheeResistanceItemLayer(a,this.m_bookGeneral.gnrl_id)}.bind(this),d.initLayout(),d.setTouchScrollEnabled(!1),d.onItemTouchBegin=function(a){return!0},d.onItemTouchMoved=function(a){return!0},d.onItemTouchEnd=function(a){return!0},d.onMouseScroll=function(){return!0},d},getDetailContentLayer:function(){var a=new cc.Layer,offset_y=0,voiceActorLayer=this.getVoiceActorLayer();voiceActorLayer.setPosition(0,offset_y),a.addChild(voiceActorLayer),offset_y+=ccHeight(voiceActorLayer);var b=this.getExplanationLayer();b.setPosition(0,offset_y),a.addChild(b),offset_y+=ccHeight(b);var c=this.getLeaderSkillLayer();c.setPosition(0,offset_y),a.addChild(c),offset_y+=ccHeight(c);var d=this.getPassiveSkillLayer();d.setPosition(0,offset_y),a.addChild(d),offset_y+=ccHeight(d);var e=this.getActiveSkillLayer();e.setPosition(0,offset_y),a.addChild(e),offset_y+=ccHeight(e);var f=this.getStatLayer();f.setPosition(0,offset_y),a.addChild(f),offset_y+=ccHeight(f);var g=this.getLevelGaugeLayer();return g.setPosition(0,offset_y),a.addChild(g),offset_y+=ccHeight(g),a.setContentSize(b.width,offset_y),a},getVoiceActorLayer:function(){var a=new cc.Layer,boxSize=cc.size(444,76),info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());info_box.setPreferredSize(boxSize),info_box.setAnchorPoint(cc.p(0,0)),info_box.setPosition(cc.p(0,0)),a.addChild(info_box);var b=cmLabel.getLabel("CV ",LABEL_FONT_INDEX.FONT_201);b.setPosition(26,ccCenter(info_box).y),info_box.addChild(b);var c=MasterTable.getInstance().getMasterTable().get_VoiceActor(this.m_bookGeneral.gnrl_id),offset_x=b.x+b.width+5,actor_label=cmLabel.getLabel(c.name,LABEL_FONT_INDEX.FONT_201);info_box.addChild(actor_label);var d=actor_label.getContentSize();return boxSize.height=Math.max(boxSize.height,d.height+30),76==boxSize.height?(b.setAnchorPoint(cc.p(0,.5)),actor_label.setAnchorPoint(cc.p(0,.5)),b.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),actor_label.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),b.setPosition(26,.5*boxSize.height),actor_label.setPosition(offset_x,.5*boxSize.height)):(b.setAnchorPoint(cc.p(0,1)),actor_label.setAnchorPoint(cc.p(0,1)),b.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),actor_label.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),b.setPosition(26,boxSize.height-15),actor_label.setPosition(offset_x,boxSize.height-15)),info_box.setPreferredSize(boxSize),a.setContentSize(boxSize),a},getExplanationLayer:function(){var a=new cc.Layer,info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());info_box.setContentSize(444,106),info_box.setInsetBottom(13),info_box.setInsetLeft(13),info_box.setInsetRight(13),info_box.setInsetTop(13),info_box.setAnchorPoint(cc.p(0,0)),info_box.setPosition(cc.p(0,0)),a.addChild(info_box);var b=cmLabel.getLabel(this.m_bookGeneral.content,LABEL_FONT_INDEX.FONT_161);return b.setAnchorPoint(cc.p(0,1)),b.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),b.setTextAreaSize(cc.size(400,0)),b.ignoreContentAdaptWithSize(!1),b.setPosition(18,info_box.height-20),info_box.addChild(b),info_box.setContentSize(444,b.height+40),b.setPosition(18,info_box.height-20),a.setContentSize(info_box.getContentSize()),a},getLeaderSkillLayer:function(){var a=new cc.Layer,m=MasterTable.getInstance().getMasterTable(),bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());bg_box.setPreferredSize(cc.size(444,132)),bg_box.setAnchorPoint(cc.p(0,0)),bg_box.setPosition(cc.p(0,0)),a.addChild(bg_box),a.setContentSize(bg_box.getContentSize());var b=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");b.setAnchorPoint(cc.p(0,0)),b.setPosition(14,23),bg_box.addChild(b);var c=!1,icon=cc.Sprite.create();icon.setAnchorPoint(cc.p(.5,.5)),icon.setPosition(b.width/2,b.height/2),b.addChild(icon);var d=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812);d.setAnchorPoint(cc.p(0,0)),d.setPosition(91,73),bg_box.addChild(d);var e=132,desc_height=64,desc=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_144);desc.setAnchorPoint(cc.p(0,1)),desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),desc.setTextAreaSize(cc.size(320,desc_height)),desc.ignoreContentAdaptWithSize(!1),desc.setPosition(91,73),bg_box.addChild(desc);c=!1;for(var f=0;f<this.m_bookGeneral.leader_skill.length;f++)if(0!=this.m_bookGeneral.leader_skill[f]&&99999!=this.m_bookGeneral.leader_skill[f]){var g=m.get_LeaderSkill(this.m_bookGeneral.leader_skill[f]);icon.setTexture(RES_CDN_DEFULT+"icon/leader/leader_"+g.skill_icon+".png");b.getContentSize;d.setString(g.name),desc.setString(g.content),c=!0;break}if(!c)for(f=0;f<this.m_bookGeneral.special_leader_skill.length;f++)if(0!=this.m_bookGeneral.special_leader_skill[f]&&99999!=this.m_bookGeneral.special_leader_skill[f]){g=m.get_SpecialLeaderSkill(this.m_bookGeneral.special_leader_skill[f]);icon.setTexture(RES_CDN_DEFULT+"icon/leader/leader_"+g.skill_icon+".png"),d.setString(g.name),desc.setString(g.content);break}var h=desc.getFontSize(),s_lengh=desc.getString().length;desc_height=Math.ceil((s_lengh*h+320)/320)*(h+2),64<ccHeight(desc)&&(e+=ccHeight(desc)-64),desc_height=Math.max(64,desc_height),desc.setTextAreaSize(cc.size(320,desc_height)),bg_box.setContentSize(444,e),a.setContentSize(ccSize(bg_box)),b.setPosition(14,ccHeight(bg_box)-109);var i=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_leader.png");i.setAnchorPoint(cc.p(0,0)),i.setPosition(17,ccHeight(bg_box)-28),bg_box.addChild(i);var j=cmLabel.getLabel("リーダースキル",LABEL_FONT_INDEX.FONT_2037);return j.setAnchorPoint(cc.p(0,0)),j.setPosition(30,ccHeight(bg_box)-34),bg_box.addChild(j),d.setPosition(91,ccHeight(bg_box)-59),desc.setPosition(91,ccHeight(bg_box)-59),a},getPassiveSkillLayer:function(){var a=new cc.Layer,m=MasterTable.getInstance().getMasterTable(),bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());bg_box.setAnchorPoint(cc.p(0,0)),bg_box.setPosition(cc.p(0,0)),a.addChild(bg_box);var b=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");b.setAnchorPoint(cc.p(0,0)),bg_box.addChild(b);var c=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812);c.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bg_box.addChild(c);var d=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_144);d.setAnchorPoint(ANCHOR_TOP_LEFT()),d.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),d.setTextAreaSize(cc.size(320,64)),d.ignoreContentAdaptWithSize(!1),bg_box.addChild(d);var e=cc.Sprite.create();e.setAnchorPoint(ANCHOR_MIDDLE()),e.setPosition(ccCenter(b)),b.addChild(e);for(var f=132,desc_height=64,is_exist_passive=!1,idx=0;idx<this.m_bookGeneral.passive_skill.length;idx++)if(99999!=this.m_bookGeneral.passive_skill[idx]&&0!=this.m_bookGeneral.passive_skill[idx]){if(0!=(i=m.get_PassiveSkillV2(this.m_bookGeneral.passive_skill[idx])).skill_icon&&null!=i.skill_icon&&null!=i.skill_icon){var g="passive_"+i.skill_icon+".png",icon_tex=cc.spriteFrameCache.getSpriteFrame(g);e.setSpriteFrame(icon_tex)}c.setString(i.name),d.setString(i.content);var h=d.getFontSize(),s_lengh=d.getString().length,line_length=320;desc_height=Math.ceil((s_lengh*h+line_length)/line_length)*(h+2),is_exist_passive=!0}if(!is_exist_passive&&1!=this.m_bookGeneral.gnrl_class)for(idx=0;idx<this.m_bookGeneral.trans_passive_skill.length;idx++)if(99999!=this.m_bookGeneral.trans_passive_skill[idx]&&0!=this.m_bookGeneral.trans_passive_skill[idx]){var i;g="passive_"+(i=m.get_TransPassiveSkill(this.m_bookGeneral.trans_passive_skill[idx])).skill_icon+".png",icon_tex=cc.spriteFrameCache.getSpriteFrame(g);e.setSpriteFrame(icon_tex),c.setString(i.name),d.setString(i.content);h=d.getFontSize(),s_lengh=d.getString().length,line_length=320;desc_height=Math.ceil((s_lengh*h+line_length)/line_length)*(h+2)}desc_height=Math.max(64,desc_height),d.setTextAreaSize(cc.size(320,desc_height)),64<ccHeight(d)&&(f+=ccHeight(d)-64),bg_box.setContentSize(444,f),a.setContentSize(ccSize(bg_box)),b.setPosition(14,ccHeight(bg_box)-109);var j=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_passive.png");j.setAnchorPoint(cc.p(0,0)),j.setPosition(17,ccHeight(bg_box)-28),bg_box.addChild(j);var k=cmLabel.getLabel(res_str("label_info_skill_passive"),LABEL_FONT_INDEX.FONT_2036);return k.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),k.setPosition(30,ccHeight(bg_box)-34),bg_box.addChild(k),c.setPosition(91,ccHeight(bg_box)-59),d.setPosition(91,ccHeight(bg_box)-59),a},getActiveSkillLayer:function(){var a=new cc.Layer,m=MasterManager.getInstance(),bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());bg_box.setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),a.addChild(bg_box);var b=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");b.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),b.setPosition(14,23),bg_box.addChild(b);var c=132,name=null,desc=null;if(0!=this.m_bookGeneral.active_skill){var d=m.get_ActiveSkill(this.m_bookGeneral.active_skill),icon=cc.Sprite.create("#active_"+d.skill_group+".png");icon.setAnchorPoint(cc.p(.5,.5)),icon.setPosition(b.width/2,b.height/2),b.addChild(icon),(name=cmLabel.getLabel(d.name,LABEL_FONT_INDEX.FONT_1812)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),name.setPosition(91,73),bg_box.addChild(name);var e=SKILLLINECOUNT(d,27);(desc=cmLabel.getLabel(d.content,LABEL_FONT_INDEX.FONT_144)).setAnchorPoint(ANCHOR_TOP_LEFT()),desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),desc.setTextAreaSize(cc.size(320,17*e)),desc.ignoreContentAdaptWithSize(!1),desc.setPosition(91,73),bg_box.addChild(desc),64<ccHeight(desc)&&(c+=ccHeight(desc)-64)}bg_box.setContentSize(444,c),a.setContentSize(ccSize(bg_box)),b.setPosition(14,ccHeight(bg_box)-109),0!=this.m_bookGeneral.active_skill&&(name.setPosition(91,ccHeight(bg_box)-59),desc.setPosition(91,ccHeight(bg_box)-59));var f=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_active.png");f.setAnchorPoint(cc.p(0,0)),f.setPosition(17,ccHeight(bg_box)-28),bg_box.addChild(f);var g=cmLabel.getLabel("アクティブスキル",LABEL_FONT_INDEX.FONT_2035);return g.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),g.setPosition(30,ccHeight(bg_box)-34),bg_box.addChild(g),a},getStatLayer:function(){var a=new cc.Layer,info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());info_box.setContentSize(444,238),info_box.setInsetBottom(13),info_box.setInsetLeft(13),info_box.setInsetRight(13),info_box.setInsetTop(13),info_box.setAnchorPoint(cc.p(0,0)),info_box.setPosition(cc.p(0,0)),a.addChild(info_box);for(var i=0;i<10;++i){var b=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero());b.setContentSize(208,38),b.setAnchorPoint(cc.p(0,0)),info_box.addChild(b);var c=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812);c.setAnchorPoint(cc.p(0,.5)),c.setPosition(8,b.height/2),b.addChild(c),0==i?(b.setPosition(11,182),c.setString("攻撃力")):1==i?(b.setPosition(11,141),c.setString("体力")):2==i?(b.setPosition(11,100),c.setString("会心発動率")):3==i?(b.setPosition(11,59),c.setString("盾発動率")):4==i?(b.setPosition(11,18),c.setString("兵科")):5==i?(b.setPosition(225,182),c.setString("防御力")):6==i?(b.setPosition(225,141),c.setString("攻速")):7==i?(b.setPosition(225,100),c.setString("会心上昇率")):8==i?(b.setPosition(225,59),c.setString("盾強度")):9==i&&(b.setPosition(225,18),c.setString("勢力"))}var d=cmLabel.getLabel(this.m_bookGeneral.attk.toLocaleString("en"),LABEL_FONT_INDEX.FONT_201);d.setAnchorPoint(cc.p(1,.5)),d.setPosition(212,202),info_box.addChild(d);var e=cmLabel.getLabel(this.m_bookGeneral.def.toLocaleString("en"),LABEL_FONT_INDEX.FONT_201);e.setAnchorPoint(cc.p(1,.5)),e.setPosition(426,202),info_box.addChild(e);var f=cmLabel.getLabel(this.m_bookGeneral.hp.toLocaleString("en"),LABEL_FONT_INDEX.FONT_201);f.setAnchorPoint(cc.p(1,.5)),f.setPosition(212,161),info_box.addChild(f);var g=cmLabel.getLabel(this.m_bookGeneral.sp.toLocaleString("en"),LABEL_FONT_INDEX.FONT_201);g.setAnchorPoint(cc.p(1,.5)),g.setPosition(426,161),info_box.addChild(g);var h=cmLabel.getLabel(this.m_bookGeneral.cri_prcnt.toFixed(1)+"%",LABEL_FONT_INDEX.FONT_201);h.setAnchorPoint(cc.p(1,.5)),h.setPosition(212,119),info_box.addChild(h);var j=cmLabel.getLabel(this.m_bookGeneral.cri_ratio.toFixed(1)+"%",LABEL_FONT_INDEX.FONT_201);j.setAnchorPoint(cc.p(1,.5)),j.setPosition(427,119),info_box.addChild(j);var k=cmLabel.getLabel(this.m_bookGeneral.guard_rate.toFixed(1)+"%",LABEL_FONT_INDEX.FONT_201);k.setAnchorPoint(cc.p(1,.5)),k.setPosition(212,78),info_box.addChild(k);var l=cmLabel.getLabel(this.m_bookGeneral.guard_decrease.toFixed(1)+"%",LABEL_FONT_INDEX.FONT_201);l.setAnchorPoint(cc.p(1,.5)),l.setPosition(427,78),info_box.addChild(l);var m=GeneralService.getInstance(),arm_service_type_name=m.getGeneralArmpServiceType(this.m_bookGeneral.arm_service_type),arm_service_type_label=cmLabel.getLabel(arm_service_type_name,LABEL_FONT_INDEX.FONT_201);arm_service_type_label.setAnchorPoint(cc.p(1,.5)),arm_service_type_label.setPosition(212,37),info_box.addChild(arm_service_type_label);var n=m.getGeneralStateType(this.m_bookGeneral.state_type),state_type_label=cmLabel.getLabel(n,LABEL_FONT_INDEX.FONT_201);return state_type_label.setAnchorPoint(cc.p(1,.5)),state_type_label.setPosition(426,37),info_box.addChild(state_type_label),a.setContentSize(info_box.getContentSize()),a},getLevelGaugeLayer:function(){var a=new cc.Layer,info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());info_box.setContentSize(444,56),info_box.setInsetBottom(13),info_box.setInsetLeft(13),info_box.setInsetRight(13),info_box.setInsetTop(13),info_box.setAnchorPoint(cc.p(0,0)),info_box.setPosition(cc.p(0,0)),a.addChild(info_box),a.setContentSize(info_box.getContentSize());var b=cmLabel.getLabel("COST",LABEL_FONT_INDEX.FONT_201);b.setAnchorPoint(cc.p(0,.5)),b.setPosition(27,info_box.height/2),info_box.addChild(b);var c=cmLabel.getLabel(this.m_bookGeneral.cost,LABEL_FONT_INDEX.FONT_261);return c.setAnchorPoint(cc.p(0,.5)),c.setPosition(94,a.height/2),a.addChild(c),a},getRareTypeSprite:function(){var a=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_unique_"+leadingZeros(this.m_bookGeneral.rare_type,2)+".png");if(this.m_bookGeneral.gnrl_type!=GENERAL_TYPE_MATERIAL){var b;this.m_bookGeneral.rare_type==RARE_TYPE_N||this.m_bookGeneral.rare_type==RARE_TYPE_HN?b=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_n.png":this.m_bookGeneral.rare_type==RARE_TYPE_R?b=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_r.png":this.m_bookGeneral.rare_type==RARE_TYPE_HR?b=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_hr.png":this.m_bookGeneral.rare_type==RARE_TYPE_SR?b=3<this.m_bookGeneral.gnrl_class?RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_ss_2.png":RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_s.png":this.m_bookGeneral.rare_type==RARE_TYPE_SSR&&(b=3<this.m_bookGeneral.gnrl_class?RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_ss_2.png":RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_ss.png");for(var c=new cc.Layer,i=1;i<this.m_bookGeneral.gnrl_class;++i){var d=cc.Sprite.create(b);d.setAnchorPoint(cc.p(0,0)),d.setPosition(28*(i-1),0),c.addChild(d)}c.setContentSize(28*(this.m_bookGeneral.gnrl_class-1),29),c.ignoreAnchorPointForPosition(!1),c.setAnchorPoint(cc.p(.5,0)),c.setPosition(a.width/2,67),a.addChild(c)}else{-1!=res_img_yh_exp.indexOf(this.m_bookGeneral.rare_type)&&a.setTexture(RES_CDN_DEFULT+"menu_yh/img_yh_exp_"+leadingZeros(this.m_bookGeneral.rare_type,2)+".png")}return a}}),GL_ONE=1,GL_ONE_MINUS_SRC_COLOR=769,btn_yunhee_love_show=102,btn_character_love_level=203,btn_character_change=200,BooksGeneralScene=GameScene.extend({m_isSpineMode:!1,m_voice_index:1,m_skeleton_action_index:0,m_character_skeleton:null,m_characterImg:null,m_bookGeneralLayer:null,m_downerror:0,m_res_download_count:0,m_totalzipcount:0,m_curzipcount:0,m_is_voice_playing:!1,m_voice_playing_delta:0,m_morph:null,m_sceneLayer:null,m_img_scale:1,m_deferred:null,m_gnrl_img:null,m_standing_view_modal_layer:null,m_resources:[],ctor:function(){this.m_isSpineMode=!1,this.m_voice_index=1,this.m_skeleton_action_index=0,this.m_character_skeleton=null,this.m_characterImg=null,this.m_characterLayer=null,this.m_bookGeneralLayer=null,this.m_downerror=0,this.m_res_download_count=0,this.m_totalzipcount=0,this.m_curzipcount=0,this.m_is_voice_playing=!1,this.m_voice_playing_delta=0,this.m_sceneLayer=null,this.m_morph=null,this.m_gnrl_img=null,this.m_resources=null,this.m_deferred=$.Deferred(),this._super(scene_BooksGeneralScene)},get_story_deferred:function(){return this.m_deferred},init:function(){this.m_resources=[],this.m_resources.push(RES_CDN_DEFULT+"common/bg_sub_4.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_mask.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_n.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_r.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_hr.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_s.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_ss.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_01.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_02.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_03.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_04.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_05.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_06.png"),resourceLoader(this.m_resources,function(){this.m_sceneLayer=new BooksGeneralSceneLayer(this.back.bind(this),this.m_deferred),this.addChild(this.m_sceneLayer),this.m_standing_view_modal_layer=new GameModalLayer,this.addChild(this.m_standing_view_modal_layer,100)}.bind(this))},back:function(){this.m_isPushScene?SceneManager.getInstance().popScene():this.onKeyBack()},onNotification:function(a){switch(this._super(a),a){case btn_yunhee_love_show:this.showYunheeLoveCGMsgBox();break;case BookGeneralEnum.btn_character_change:this.m_sceneLayer.changeCharacter();break;case BookGeneralEnum.btn_show_resistance_help:GameContext.getInstance().setHelpInfoIndexByCallIndex(11);var b=new HelpContentScene;SceneManager.getInstance().pushScene(b),b=null;break;case BookGeneralEnum.btn_show_standing_detail_view:var c=GameContext.getInstance().getDetailStandingGnrl();0!=c.gnrl_id&&this.showStandingDetailViewPopup(c)}},showStandingDetailViewPopup:function(c){this.m_standing_view_modal_layer.setContentSize(ccSize(this)),this.m_standing_view_modal_layer._contentNode=function(a,m){var b=new cc.Layer,viewer=new YunheeStandingViewLayer(c,this.hideStandingDetailViewPopup.bind(this));return b.addChild(viewer),b.setContentSize(ccSize(viewer)),b.setPosition(568,320),b.ignoreAnchorPointForPosition(!1),b.setAnchorPoint(ANCHOR_MIDDLE()),viewer.setPosition(ccCenter(b)),b}.bind(this),this.m_standing_view_modal_layer.is_show()&&this.m_standing_view_modal_layer.hide(),this.m_standing_view_modal_layer.show()},hideStandingDetailViewPopup:function(){this.m_standing_view_modal_layer.is_show()&&this.m_standing_view_modal_layer.hide()},showYunheeLoveCGMsgBox:function(){this.m_box.is_show()&&this.m_box.hide(!1),this.m_box.setTitle("ご褒美イベント"),this.m_box.setText("ご褒美イベントシーンを見ますか。"),this.m_box.setText("\n"),this.m_box.setText("※音量にご注意ください。"),this.m_box.addButtonInfo(new MessageButtonInfo("いいえ",MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo("はい",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(),this.showCheckLoveCG()}.bind(this))),this.m_box.show()},showCheckLoveCG:function(){this.m_box.is_show()&&this.m_box.hide(!1);var a=GameContext.getInstance().getLoveCgGnrlId(),scene=new LoveContentsCGScene(a);SceneManager.getInstance().pushScene(scene),scene=null},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_BooksGeneralScene])},onExit:function(){if(this._super(),MainObserver.getInstance().removeObserver(sceneStr[scene_BooksGeneralScene]),!this.m_isPushScene){if(null!=this.m_resources){for(var a=0;a<this.m_resources.length;a++)cc.loader.release(this.m_resources[a]);this.m_resources=null}this.m_sceneLayer.clearResource(),this.removeAllChildrenWithCleanup(!0),this.m_sceneLayer=null}}}),BooksGeneralSceneLayer=cc.Layer.extend({callback:null,m_skeletonNode:null,m_character_skeleton:null,m_characterLayer:null,m_touchEventLayer:null,m_sceneId:null,m_skeleton_action_index:null,m_deferred:null,m_standing_gnrl_id:null,m_skin_id:null,m_bg:null,ctor:function(f,g){this._super(),this.m_deferred=g,this.m_skeletonNode=null,this.m_character_skeleton=null,this.m_sceneId=scene_BooksGeneralScene,this.callback=f,this.m_bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub_4.png"),this.m_bg.setPosition(cc.p(this.width/2,this.height/2)),USE_SP_COMMON_SUB_BG_SCALE&&this.m_bg.setScale(2),this.addChild(this.m_bg);var h=GameContext.getInstance().getBookGeneral().book_num;this.m_bookGeneral=new db.UserBookGeneral,GeneralService.getInstance().getBookGeneralInfo(h,this.m_bookGeneral),this.m_skeleton_action_index=0,this.m_standing_gnrl_id=this.m_bookGeneral.gnrl_id,3<this.m_bookGeneral.gnrl_class&&(this.m_standing_gnrl_id-=1e3),this.m_skin_id=0,this.m_bookGeneral.bone_id!=this.m_bookGeneral.skin_id?this.m_skin_id=this.m_standing_gnrl_id:this.m_skin_id=this.m_bookGeneral.skin_id,this.m_morph=MasterTable.getInstance().get_MorphData(this.m_standing_gnrl_id);var i=MasterManager.getInstance().get_General(this.m_bookGeneral.bone_id);if("y"==this.m_morph.is_morph){var j=MasterManager.getInstance().get_General(this.m_morph.gnrl_id);if(this.m_gnrl_img=[],USE_PARTNER_GNRL_LOADING){if(SAVE_NOW_PARTNER_GNRL.gnrl_id!=this.m_morph.gnrl_id){if(null==(l=StandingMultiplePngList[this.m_morph.gnrl_id]))this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(j.gnrl_group,3)+"/standing/"+this.m_morph.gnrl_id+".png");else for(var k=0;k<l.length;k++)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(j.gnrl_group,3)+"/standing/"+l[k]+".png");this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(j.gnrl_group,3)+"/standing/"+j.gnrl_id+".atlas"),this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(j.gnrl_group,3)+"/standing/"+j.gnrl_id+".json")}}else{var l;if(null==(l=StandingMultiplePngList[this.m_morph.gnrl_id]))this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(j.gnrl_group,3)+"/standing/"+this.m_morph.gnrl_id+".png");else for(k=0;k<l.length;k++)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(j.gnrl_group,3)+"/standing/"+l[k]+".png");this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(j.gnrl_group,3)+"/standing/"+j.gnrl_id+".atlas"),this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(j.gnrl_group,3)+"/standing/"+j.gnrl_id+".json")}this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(i.gnrl_group,3)+"/sd/"+this.m_bookGeneral.skin_id+".atlas"),this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(i.gnrl_group,3)+"/sd/"+this.m_bookGeneral.skin_id+".json");var n=SDGeneralName[i.gnrl_group];for(k=0;k<n.length;k++)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(i.gnrl_group,3)+"/sd/"+n[k]+".png");resourceLoader(this.m_gnrl_img,function(){this.initGeneral()}.bind(this))}else{var o=MasterManager.getInstance().get_General(this.m_bookGeneral.gnrl_id);if(this.m_gnrl_img=[],USE_PARTNER_GNRL_LOADING){if(SAVE_NOW_PARTNER_GNRL.gnrl_id!=this.m_bookGeneral.gnrl_id)if(o.gnrl_type==GENERAL_TYPE_YUNHEE){if(MasterManager.getInstance().get_GeneralDivision(o.gnrl_group).general_gender_type==GENDER_TYPE_M){var p=getCardBody_ImageStr(o.gnrl_id);this.m_gnrl_img.push(p)}else{p=getCardBody_ImageStr(o.gnrl_id);this.m_gnrl_img.push(p)}}else{p=getCardBody_ImageStr(this.m_bookGeneral.gnrl_id);this.m_gnrl_img.push(p)}}else if(o.gnrl_type==GENERAL_TYPE_YUNHEE){if(MasterManager.getInstance().get_GeneralDivision(o.gnrl_group).general_gender_type==GENDER_TYPE_M){p=getCardBody_ImageStr(o.gnrl_id);this.m_gnrl_img.push(p)}else{p=getCardBody_ImageStr(o.gnrl_id);this.m_gnrl_img.push(p)}}else{p=getCardBody_ImageStr(this.m_bookGeneral.gnrl_id);this.m_gnrl_img.push(p)}this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(i.gnrl_group,3)+"/sd/"+this.m_bookGeneral.skin_id+".atlas"),this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(i.gnrl_group,3)+"/sd/"+this.m_bookGeneral.skin_id+".json");for(n=SDGeneralName[i.gnrl_group],k=0;k<n.length;k++)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(i.gnrl_group,3)+"/sd/"+n[k]+".png");cc.loader.load(this.m_gnrl_img,function(a,b){a?cc.log("Failed to load %s.",this.m_gnrl_img):this.initGeneral()}.bind(this))}var q=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(a,b){var c=cc.rect(this.m_touchEventLayer.getPosition().x,this.m_touchEventLayer.getPosition().y,this.m_touchEventLayer.getContentSize().width,this.m_touchEventLayer.getContentSize().height),pos=a.getLocation();return!!cc.rectContainsPoint(c,pos)}.bind(this),onTouchEnded:function(a,b){var m=MasterTable.getInstance();if(this.m_isSpineMode){2<this.m_skeleton_action_index&&(this.m_skeleton_action_index=1),0==this.m_skeleton_action_index?(this.m_skeletonNode.setAnimation(0,"prepare",!1),this.m_skeletonNode.addAnimation(0,"idle",!0)):1==this.m_skeleton_action_index?(this.m_skeletonNode.setAnimation(0,"attack1",!1),this.m_skeletonNode.addAnimation(0,"idle",!0)):2==this.m_skeleton_action_index&&(this.m_skeletonNode.setAnimation(0,"attack2",!1),this.m_skeletonNode.addAnimation(0,"idle",!0)),this.m_skeleton_action_index++;var c=0,ref={},voice=(d=m.get_Voice(this.m_bookGeneral.gnrl_id,voice_detail_sd_touch,ref)).voice;if(c=d.duration,!this.m_is_voice_playing)if(voice&&""!=voice)AudioEngine.getInstance().playVoice(RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3",!1),this.m_is_voice_playing=!0,this.m_voice_playing_delta=c}else{var d,is_voice_play=!1;c=0,ref={},voice=(d=m.get_Voice(this.m_bookGeneral.gnrl_id,voice_books_body_touch,ref)).voice;if(c=d.duration,null!=this.m_characterImg){this.m_characterImg.stopAllActions();var e=new cc.ScaleTo(.1,this.m_img_scale+.03,this.m_img_scale-.03),s2=new cc.ScaleTo(.2,this.m_img_scale-.03,this.m_img_scale+.03),s3=new cc.ScaleTo(.15,this.m_img_scale+.02,this.m_img_scale-.02),s4=new cc.ScaleTo(.8,this.m_img_scale,this.m_img_scale),callback=new cc.CallFunc(this.characterIdelAction,this),e4=new cc.EaseElasticOut(s4),seq=new cc.Sequence(e,s2,s3,e4,callback);this.m_characterImg.runAction(seq),is_voice_play=!0}else this.m_character_skeleton.setAnimation(0,"active",!1),this.m_character_skeleton.addAnimation(0,"basic",!0),is_voice_play=!0;if(is_voice_play)if(!this.m_is_voice_playing)if(voice&&""!=voice)AudioEngine.getInstance().playVoice(RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3",!1),this.m_is_voice_playing=!0,this.m_voice_playing_delta=c}}.bind(this)});cc.eventManager.addListener(q,this),this.scheduleUpdate()},onExit:function(){this._super()},clearResource:function(){if(1!=this.getParent().m_isPopupShow){if(null!=this.m_gnrl_img)if(1==USE_PARTNER_GNRL_LOADING)if(0<SAVE_NOW_PARTNER_GNRL.res_img.length)for(var a=0;a<this.m_gnrl_img.length;a++){for(var b=!1,jdx=0;jdx<SAVE_NOW_PARTNER_GNRL.res_img.length;jdx++)SAVE_NOW_PARTNER_GNRL.res_img[jdx]==this.m_gnrl_img[a]&&(b=!0);0==b&&cc.loader.release(this.m_gnrl_img[a])}else for(a=0;a<this.m_gnrl_img.length;a++)cc.loader.release(this.m_gnrl_img[a]);else{for(a=0;a<this.m_gnrl_img.length;a++)cc.loader.release(this.m_gnrl_img[a]);this.m_gnrl_img=null}null!=this.m_skeletonNode&&(this.removeChild(this.m_skeletonNode),this.m_skeletonNode._skeleton.data.animations=[],this.m_skeletonNode._skeleton.data.bones=[],this.m_skeletonNode._skeleton.data.events=[],this.m_skeletonNode._skeleton.data.slots=[],this.m_skeletonNode._skeleton.data.skins=[],this.m_skeletonNode._skeleton.slots=[],this.m_skeletonNode._spineComplete=null,this.m_skeletonNode._skeleton=null,this.m_skeletonNode=null),null!=this.m_character_skeleton&&(this.removeChild(this.m_character_skeleton),this.m_character_skeleton._skeleton.data.animations=[],this.m_character_skeleton._skeleton.data.bones=[],this.m_character_skeleton._skeleton.data.events=[],this.m_character_skeleton._skeleton.data.slots=[],this.m_character_skeleton._skeleton.data.skins=[],this.m_character_skeleton._skeleton.slots=[],this.m_character_skeleton._spineComplete=null,this.m_character_skeleton._skeleton=null,this.m_character_skeleton=null),null!=this.m_bg&&(this.removeChild(this.m_bg),this.m_bg=null)}},update:function(a){this.m_is_voice_playing&&(this.m_voice_playing_delta-=a,this.m_voice_playing_delta<0&&(this.m_is_voice_playing=!1,this.m_voice_playing_delta=0))},initGeneral:function(){var a=cc.director.getWinSize();this.m_characterLayer=this.getCharacterLayer(),this.m_characterLayer.ignoreAnchorPointForPosition(!1),this.m_characterLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_characterLayer.setPosition(cc.p((this.width-478)/2,0)),this.addChild(this.m_characterLayer);var b=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_mask.png");b.setAnchorPoint(cc.p(.5,0)),b.setPosition(this.width/2,0),this.addChild(b),this.m_bookGeneralLayer=new BooksGeneralLayer,this.m_bookGeneralLayer.setBookGeneralInfo(this.m_bookGeneral),this.m_bookGeneralLayer.initLayout(),this.m_bookGeneralLayer.setPosition(cc.p(0,0)),this.addChild(this.m_bookGeneralLayer),this.m_touchEventLayer=new cc.Layer,this.m_touchEventLayer.ignoreAnchorPointForPosition(!1),this.m_touchEventLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_touchEventLayer.setContentSize(cc.size(400,520)),this.m_touchEventLayer.setPosition(ccCenter(this.m_characterLayer).x,0),this.m_characterLayer.addChild(this.m_touchEventLayer);var c=new StatusLayer(INVOKER_TYPE.normal);c.ignoreAnchorPointForPosition(!1),c.setAnchorPoint(ANCHOR_TOP_RIGHT()),c.setPosition(cc.p(a.width,a.height)),this.addChild(c);var d=cc.Sprite.create(RES_CDN_DEFULT+"menu_book/img_book_text_book.png");d.setAnchorPoint(cc.p(0,0)),d.setPosition(cc.p(90,585)),this.addChild(d);var e=new ccui.Button;e.loadTextures("btn_home_off.png","btn_home_on.png","",ccui.Widget.PLIST_TEXTURE),e.setAnchorPoint(cc.p(0,0)),e.setPosition(cc.p(10,559)),e.addClickEventListener(this.callback),this.addChild(e)},changeCharacter:function(){var a=MasterManager.getInstance(),standing_gnrl_id=this.m_bookGeneral.gnrl_id;3<this.m_bookGeneral.gnrl_class&&(standing_gnrl_id-=1e3);var b=a.get_BodyPosition(standing_gnrl_id);if("y"==MasterTable.getInstance().get_MorphData(standing_gnrl_id).is_morph)this.m_character_skeleton.stopAllActions(),this.m_skeletonNode.stopAllActions(),this.m_isSpineMode?(this.m_skeletonNode.runAction(new cc.Sequence(new cc.MoveTo(.18,cc.p(-2048,120)),new cc.FadeOut(0))),this.m_character_skeleton.runAction(new cc.MoveTo(.2,Detail_pos(b.posx,b.posy))),this.m_isSpineMode=!1,this.m_character_skeleton.setAnimation(0,"active",!1),this.m_character_skeleton.addAnimation(0,"basic",!0),this.m_character_skeleton.addAnimation(1,"loop",!0)):(this.m_character_skeleton.runAction(new cc.MoveTo(.2,Detail_pos(-2048,b.posy))),this.m_skeletonNode.runAction(new cc.Sequence(new cc.FadeIn(0),new cc.MoveTo(.18,cc.p(243,120)))),this.m_isSpineMode=!0);else if(this.m_skeletonNode.stopAllActions(),this.m_characterImg.stopAllActions(),this.m_isSpineMode){this.m_skeletonNode.runAction(new cc.Sequence(new cc.MoveTo(.18,cc.p(-ccWidth(this.m_characterImg)*this.m_img_scale-100,120)),new cc.FadeOut(0)));var c=new cc.CallFunc(this.characterIdelAction,this);this.m_characterImg.runAction(new cc.Sequence(new cc.MoveTo(.2,Detail_pos(b.posx+ccWidth(this.m_characterImg)*this.m_img_scale/2,b.posy+ccHeight(this.m_characterImg)*this.m_img_scale/2)),c)),this.m_isSpineMode=!1}else this.m_characterImg.runAction(new cc.MoveTo(.2,Detail_pos(-ccWidth(this.m_characterImg)*this.m_img_scale*2-150,b.posy+ccHeight(this.m_characterImg)*this.m_img_scale/2))),this.m_skeletonNode.runAction(new cc.Sequence(new cc.FadeIn(0),new cc.MoveTo(.18,cc.p(243,120)))),this.m_isSpineMode=!0;this.m_is_voice_playing=!1,this.m_voice_playing_delta=0},getCharacterLayer:function(){var b=new cc.Layer;b.setContentSize(480,640);var c=this.m_bookGeneral.state_type,state_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_state_"+c+".png");state_img.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),state_img.setPosition(b.width/2,112),b.addChild(state_img),state_img.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR);var d=MasterManager.getInstance(),pos=d.get_BodyPosition(this.m_standing_gnrl_id);if(cc.log(pos),"y"==this.m_morph.is_morph){var f=d.get_General(this.m_morph.gnrl_id),gnrl_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(f.gnrl_group,3)+"/standing/"+f.gnrl_id+".json",gnrl_atals=RES_CDN_DEFULT+"gnrl_"+leadingZeros(f.gnrl_group,3)+"/standing/"+f.gnrl_id+".atlas";(g=[]).push(gnrl_json),g.push(gnrl_atals),resourceLoader(g,function(){this.m_character_skeleton=new sp.SkeletonAnimation(gnrl_json,gnrl_atals,.1),this.m_character_skeleton.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_character_skeleton.setPosition(Detail_pos(pos.posx,pos.posy)),cc.log("pos m_character_skeleton"+pos.posx,pos.posy),b.addChild(this.m_character_skeleton),this.m_character_skeleton.setMix("basic","active",.1),this.m_character_skeleton.setMix("active","basic",.1),this.m_character_skeleton.setAnimation(0,"active",!1),this.m_character_skeleton.addAnimation(0,"basic",!0),this.m_deferred.resolve(!0)}.bind(this))}else{var g,general=d.get_General(this.m_bookGeneral.gnrl_id);if(this.m_img_scale=1,general.gnrl_type==GENERAL_TYPE_YUNHEE){if(d.get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var h=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id)}else{h=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id)}}else{h=getCardBody_ImageStr(this.m_bookGeneral.gnrl_id);this.m_img_scale=getCardBody_Scale(this.m_bookGeneral.gnrl_id)}(g=[]).push(h),resourceLoader(g,function(){this.m_characterImg=cc.Sprite.create(h),this.m_characterImg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_characterImg.setScale(this.m_img_scale),this.m_characterImg.setPosition(Detail_pos(pos.posx+this.m_characterImg.width*this.m_img_scale/2,pos.posy+this.m_characterImg.height*this.m_img_scale/2)),b.addChild(this.m_characterImg);var a=new cc.CallFunc(this.characterIdelAction,this);this.m_characterImg.runAction(a),this.m_deferred.resolve(!0)}.bind(this))}var i=d.get_General(this.m_bookGeneral.bone_id),sd_atlas=RES_CDN_DEFULT+"gnrl_"+leadingZeros(i.gnrl_group,3)+"/sd/"+this.m_bookGeneral.skin_id+".atlas",sd_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(i.gnrl_group,3)+"/sd/"+this.m_bookGeneral.skin_id+".json";this.m_skeletonNode=new sp.SkeletonAnimation(sd_json,sd_atlas),this.m_skeletonNode.setScale(.55),null!=this.m_characterImg||null!=this.m_characterImg?this.m_skeletonNode.setPosition(-this.m_characterImg.width*this.m_img_scale,120):this.m_skeletonNode.setPosition(-2048,120),b.addChild(this.m_skeletonNode);try{var j=this.m_bookGeneral.gnrl_class;3<j&&(j=3),this.m_skeletonNode.setSkin(cmString("%d",j))}catch(e){this.m_skeletonNode.setSkin("default")}return this.m_skeletonNode.setAnimation(0,"basic",!0),this.m_skeletonNode.setMix("basic","prepare",.1),this.m_skeletonNode.setMix("prepare","basic",.1),this.m_skeletonNode.setMix("attack1","prepare",.1),this.m_skeletonNode.setMix("prepare","attack1",.1),this.m_skeletonNode.setMix("attack2","prepare",.1),this.m_skeletonNode.setMix("prepare","attack2",.1),this.m_skeletonNode.setMix("attack1","basic",.1),this.m_skeletonNode.setMix("basic","attack1",.1),this.m_skeletonNode.setMix("attack2","basic",.1),this.m_skeletonNode.setMix("basic","attack2",.1),this.m_skeletonNode.setMix("attack1","attack2",.1),this.m_skeletonNode.setMix("attack2","attack1",.1),this.m_skeletonNode.setOpacity(0),this.m_skeletonNode.setEventListener(this.spineEventListener.bind(this)),b},spineEventListener:function(a,b){a&&a.animation&&a.animation.name;var c=b.data.name.toLowerCase();"loop_show"==c?this.m_skeletonNode.setAnimation(2,"loop",!0):"loop_hide"==c&&this.m_skeletonNode.setAnimation(2,"loop_off",!0)},characterIdelAction:function(){var a=new cc.ScaleTo(.7,this.m_img_scale,this.m_img_scale+.01),scaleTo_2=new cc.ScaleTo(.7,this.m_img_scale,this.m_img_scale-.01),sequence=new cc.Sequence(a,scaleTo_2),repeat=new cc.RepeatForever(sequence);this.m_characterImg.runAction(repeat)}});STATE_TYPE={DONG:1,WIE:2,CHOCK:3,OH:4,WON:5,JAE:6};var BookGeneralItemLayer=cc.Layer.extend({m_info:null,layer:null,ctor:function(a){return this._super(),this.layer=null,this.initLayout(a),this},initLayout:function(a){var b=db.CardInfo;b.gnrl_id=a.gnrl_id,b.love_level=a.love_level,b.gender_type=a.gender_type,b.love_level=1==a.is_max_love_level?YUNHEE_MAX_LOVE_LEVEL:0;var c=MasterManager.getInstance().get_GeneralDivision(a.gnrl_group);b.gender_type=c.general_gender_type,this.layer=new cc.Layer;var d=(new Card).createCard(b,CARD_TYPE.type_card_book);return d.setAnchorPoint(cc.p(0,0)),d.setPosition(cc.p(0,0)),this.layer.addChild(d),a.is_gain||(this.m_mask=new cc.LayerColor(cc.color.BLACK),this.m_mask.setContentSize(cc.size(98,98)),this.m_mask.setAnchorPoint(cc.p(0,0)),this.m_mask.setOpacity(230),this.m_mask.setPosition(cc.p(0,0)),d.addChild(this.m_mask)),this.layer.setContentSize(d.width+6,d.height+6),this.m_info=a,this.setContentSize(d.width+6,d.height+6),this.addChild(this.layer),!0},getGnrlInfo:function(){return this.m_info},onEnter:function(){this._super()},onExit:function(){this._super()}}),BookIllustItemLayer=cc.Layer.extend({layer:null,ctor:function(a){this._super(),this.initLayout(a)},initLayout:function(a){var n=new NetService,layer=new cc.Layer,box=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_special/i_%d.png",a));if(box.setAnchorPoint(ZERO()),box.setPosition(ZERO()),layer.addChild(box),n.getUserIllust(a)){var b=cc.Sprite.create(RES_CDN_DEFULT+"menu_special/img_card_frame_special.png");b.setAnchorPoint(ANCHOR_MIDDLE()),b.setPosition(ccCenter(box)),box.addChild(b)}else{var c=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal_2.png",RectZero());c.setContentSize(ccSize(box)),c.setAnchorPoint(ZERO()),c.setPosition(ZERO()),box.addChild(c)}return layer.setContentSize(ccWidth(box)+6,ccHeight(box)+6),this.setContentSize(ccSize(layer)),this.addChild(layer),!0}}),NOTIFICATION_SELECT_BOOKS_GENERAL="notifictaion_select_books_general",NOTIFICATION_SELECT_BOOKS_ILLUST="notification_select_books_illust",BooksLayer=cc.Layer.extend({m_bookLayer:null,m_generalTableLayer:null,m_wie_tap:null,m_chock_tap:null,m_o_tap:null,m_won_tap:null,m_dong_tap:null,m_jae_tap:null,m_wae_tap:null,m_illust_tap:null,m_bookGenerals:null,m_bookGeneralItemLayers:null,m_tap_index:0,m_offsetVerticalPercent:0,m_stateGenrals:null,m_gameObserver:null,m_illust_List:[],ctor:function(){this._super(),this.m_illust_List=[]},getBookLayer:function(){var a=new cc.Layer;return a.setContentSize(960,488),this.m_gameObserver=MainObserver.getInstance(),this.m_wie_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_wie_tap.setAnchorPoint(cc.p(0,0)),this.m_wie_tap.setPosition(cc.p(17,488)),this.m_wie_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_wie_tap.setString("魏"),this.m_wie_tap.addClickEventListener(function(){this.setTapButton(STATE_TYPE.WIE)}.bind(this)),a.addChild(this.m_wie_tap),this.m_chock_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_chock_tap.setAnchorPoint(cc.p(0,0)),this.m_chock_tap.setPosition(cc.p(this.m_wie_tap.x+111,488)),this.m_chock_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_chock_tap.setString("蜀"),this.m_chock_tap.addClickEventListener(function(){this.setTapButton(STATE_TYPE.CHOCK)}.bind(this)),a.addChild(this.m_chock_tap),this.m_o_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_o_tap.setAnchorPoint(cc.p(0,0)),this.m_o_tap.setPosition(cc.p(this.m_chock_tap.x+111,488)),this.m_o_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_o_tap.setString("呉"),this.m_o_tap.addClickEventListener(function(){this.setTapButton(STATE_TYPE.OH)}.bind(this)),a.addChild(this.m_o_tap),this.m_won_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_won_tap.setAnchorPoint(cc.p(0,0)),this.m_won_tap.setPosition(cc.p(this.m_o_tap.x+111,488)),this.m_won_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_won_tap.setString("袁"),this.m_won_tap.addClickEventListener(function(){this.setTapButton(STATE_TYPE.WON)}.bind(this)),a.addChild(this.m_won_tap),this.m_dong_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_dong_tap.setAnchorPoint(cc.p(0,0)),this.m_dong_tap.setPosition(cc.p(this.m_won_tap.x+111,488)),this.m_dong_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_dong_tap.setString("董"),this.m_dong_tap.addClickEventListener(function(){this.setTapButton(STATE_TYPE.DONG)}.bind(this)),a.addChild(this.m_dong_tap),this.m_jae_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_jae_tap.setAnchorPoint(cc.p(0,0)),this.m_jae_tap.setPosition(cc.p(this.m_dong_tap.x+111,488)),this.m_jae_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_jae_tap.setString("帝"),this.m_jae_tap.addClickEventListener(function(){this.setTapButton(STATE_TYPE.JAE)}.bind(this)),a.addChild(this.m_jae_tap),this.m_wae_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_wae_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_wae_tap.setString(res_str("btn_label_wae")),this.m_wae_tap.setAnchorPoint(ZERO()),this.m_wae_tap.setPosition(ccPosX(this.m_jae_tap)+ccWidth(this.m_wie_tap),488),this.m_wae_tap.setSwallowTouches(!0),this.m_wae_tap.addClickEventListener(function(){this.setTapButton(STATE_TYPE_WAE)}.bind(this)),a.addChild(this.m_wae_tap),USE_3RD_ANNIVERSARY_CARD&&(this.m_illust_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_illust_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_illust_tap.setString(res_str("illust_book_tap_button_text")),this.m_illust_tap.setAnchorPoint(ZERO()),this.m_illust_tap.setPosition(ccPosX(this.m_wae_tap)+ccWidth(this.m_wie_tap),488),this.m_illust_tap.setSwallowTouches(!0),this.m_illust_tap.addClickEventListener(function(){this.setTapButton(STATE_TYPE_ILLUST)}.bind(this)),a.addChild(this.m_illust_tap,10)),a},initLayout:function(){var a=GameContext.getInstance().getBookTap();this.m_bookLayer=this.getBookLayer(),this.m_bookLayer.ignoreAnchorPointForPosition(!1),this.m_bookLayer.setAnchorPoint(cc.p(.5,0)),this.m_bookLayer.setPosition(cc.p(this.width/2,0)),this.addChild(this.m_bookLayer),this.setTapButton(a)},getBookGeneralTableLayer:function(){this.m_bookGeneralItemLayers=[];var e=new TableViewLayer;return e.setAnchorPoint(cc.p(0,0)),e.setContentSize(937,488),e.setItemCount(this.m_stateGenrals.length),e.setColumnCount(9),e.getItemNode=function(a,b,c){var d=this.m_stateGenrals[a],gnrlLayer=new BookGeneralItemLayer(d);return d=null,gnrlLayer}.bind(this),e.initLayout(),e.onItemTouchBegin=function(a){var b=this.m_stateGenrals[a];return b.is_gain?!(b=null):(b=null,!1)}.bind(this),e.onItemTouchMoved=function(a){}.bind(this),e.onItemTouchCancel=function(a){return!0}.bind(this),e.onItemTouchEnd=function(a){AudioEngine.getInstance().playNormaButtonSound();var b=this.m_stateGenrals[a],gnrl_id=b.gnrl_id,num=b.book_num;return GameContext.getInstance().setBookGeneral(num,gnrl_id),b=null,this.m_gameObserver.postNotification(sceneStr[scene_BooksScene],"NOTIFICATION_SELECT_BOOKS_GENERAL"),!0}.bind(this),e},getBookIllustTableLayer:function(){this.m_bookGeneralItemLayers=[];var m=MasterTable.getInstance();this.m_illust_List=m.get_IllustList();var n=new NetService,tableLayer=new TableViewLayer;return tableLayer.setAnchorPoint(ZERO()),tableLayer.setContentSize(937,488),tableLayer.setItemCount(this.m_illust_List.length),tableLayer.setColumnCount(9),tableLayer.getItemNode=function(a,b,m){var c=this.m_illust_List[a];return new BookIllustItemLayer(c.illust_idx)}.bind(this),tableLayer.initLayout(),tableLayer.onItemTouchBegin=function(a){return!!n.getUserIllust(this.m_illust_List.at(a).illust_idx)}.bind(this),tableLayer.onItemTouchMoved=function(a){}.bind(this),tableLayer.onItemTouchCancel=function(a){return!0}.bind(this),tableLayer.onItemTouchEnd=function(a){var b=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3";b.playEffect(path);var c=this.m_illust_List.at(a).illust_idx;MainObserver.getInstance().postNotification(NOTIFICATION_SELECT_BOOKS_ILLUST,c)}.bind(this),tableLayer},setVerticalPercent:function(){this.m_offsetVerticalPercent=this.m_generalTableLayer.getOffsetVerticalPercent()},setOffsetY:function(){this.m_generalTableLayer.setOffsetVertical(this.m_offsetVerticalPercent)},setTapButton:function(a){this.m_wie_tap.setEnabled(!0),this.m_chock_tap.setEnabled(!0),this.m_o_tap.setEnabled(!0),this.m_won_tap.setEnabled(!0),this.m_dong_tap.setEnabled(!0),this.m_jae_tap.setEnabled(!0),this.m_wae_tap.setEnabled(!0),USE_3RD_ANNIVERSARY_CARD&&this.m_illust_tap.setEnabled(!0),this.m_wie_tap.setBright(!0),this.m_chock_tap.setBright(!0),this.m_o_tap.setBright(!0),this.m_won_tap.setBright(!0),this.m_dong_tap.setBright(!0),this.m_jae_tap.setBright(!0),this.m_wae_tap.setBright(!0),USE_3RD_ANNIVERSARY_CARD&&this.m_illust_tap.setBright(!0),a==STATE_TYPE.WIE?(this.m_wie_tap.setEnabled(!1),this.m_wie_tap.setBright(!1)):a==STATE_TYPE.CHOCK?(this.m_chock_tap.setEnabled(!1),this.m_chock_tap.setBright(!1)):a==STATE_TYPE.OH?(this.m_o_tap.setEnabled(!1),this.m_o_tap.setBright(!1)):a==STATE_TYPE.WON?(this.m_won_tap.setEnabled(!1),this.m_won_tap.setBright(!1)):a==STATE_TYPE.DONG?(this.m_dong_tap.setEnabled(!1),this.m_dong_tap.setBright(!1)):a==STATE_TYPE.JAE?(this.m_jae_tap.setEnabled(!1),this.m_jae_tap.setBright(!1)):a==STATE_TYPE_WAE?(this.m_wae_tap.setEnabled(!1),this.m_wae_tap.setBright(!1)):a==STATE_TYPE_ILLUST?USE_3RD_ANNIVERSARY_CARD&&(this.m_illust_tap.setEnabled(!1),this.m_illust_tap.setBright(!1)):cc.log("error"),this.m_offsetVerticalPercent=0,this.m_tap_index=a,this.scheduleOnce(function(){this.m_gameObserver.postNotification(sceneStr[scene_BooksScene],this.m_tap_index)}.bind(this),0,"setTapButton")},setTapBook:function(a){null!=this.m_generalTableLayer&&(this.removeChild(this.m_generalTableLayer),this.m_generalTableLayer.removeAllChildren(),this.m_generalTableLayer=null),this.m_stateGenrals=[],this.m_stateGenrals=this.getBookGeneralList(a,this.m_stateGenrals),0!=this.m_stateGenrals.length&&(this.m_stateGenrals=stable(this.m_stateGenrals,function(l,r){return l.gnrl_class>r.gnrl_class?1:l.gnrl_class<r.gnrl_class?-1:0}),this.m_stateGenrals=stable(this.m_stateGenrals,function(l,r){return l.name<r.name?1:l.name>r.name?-1:0}),this.m_stateGenrals=stable(this.m_stateGenrals,function(l,r){return l.rare_type<r.rare_type?1:l.rare_type>r.rare_type?-1:0}),this.m_stateGenrals=stable(this.m_stateGenrals,function(l,r){return l.element_type>r.element_type?1:l.element_type<r.element_type?-1:0}),this.m_generalTableLayer=this.getBookGeneralTableLayer(),this.m_generalTableLayer.setPosition(cc.p(100,0)),this.m_generalTableLayer.setAnchorPoint(cc.p(0,0)),this.addChild(this.m_generalTableLayer),this.setOffsetY()),GameContext.getInstance().setBookTap(a)},getBookGeneralList:function(a,b){for(var c=0;c<this.m_bookGenerals.length;c++)this.m_bookGenerals[c].state_type==a&&b.push(this.m_bookGenerals[c]);return b},setBookGeneralList:function(a){this.m_bookGenerals=a,this.initLayout()},setTapIllustBook:function(a){null!=this.m_generalTableLayer&&(this.m_generalTableLayer.removeFromParent(),this.m_generalTableLayer=null),this.m_stateGenrals=[],this.m_generalTableLayer=this.getBookIllustTableLayer(),this.m_generalTableLayer.setAnchorPoint(ZERO()),this.m_generalTableLayer.setPosition(17,0),this.m_bookLayer.addChild(this.m_generalTableLayer),this.setOffsetY()},onEnter:function(){this._super(),this.m_generalTableLayer&&this.setOffsetY()},onExit:function(){this._super(),1!=this.getParent().m_isPushScene&&(this.m_bookGenerals=[],null!=this.m_generalTableLayer&&(this.m_generalTableLayer.removeAllChildren(),this.m_generalTableLayer=null))}}),BooksScene=GameScene.extend({m_bookLayer:null,m_itemModalLayer:null,m_illustInfoModalLayer:null,m_resources:[],ctor:function(){this._super(scene_BooksScene)},init:function(){this.m_bookLayer=null,this.m_itemModalLayer=null,this.m_illustInfoModalLayer=null,this.m_notification_id="notification_BooksScene";var g=cc.director.getWinSize();this.initLayoutProgress2(0),this.m_resources=[],this.m_resources.push(RES_CDN_DEFULT+"common/bg_sub_4.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/i_1001.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/i_1002.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/i_1003.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/bg_special.jpg"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/i_1001.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/i_1002.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/i_1003.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/i_1004.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/i_1005.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/i_1006.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/btn_special_zoomin_off.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/btn_special_zoomin_on.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/btn_special_zoomout_off.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/btn_special_zoomout_on.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_zoom_gauge.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_zoom_gauge_mint.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/img_card_frame_special.png"),resourceLoader(this.m_resources,function(){var a=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub_4.png");a.setPosition(cc.p(this.width/2,this.height/2)),USE_SP_COMMON_SUB_BG_SCALE&&a.setScale(2),this.addChild(a);var b=new StatusLayer(INVOKER_TYPE.normal);b.ignoreAnchorPointForPosition(!1),b.setAnchorPoint(ANCHOR_TOP_RIGHT()),b.setPosition(cc.p(g.width,g.height)),this.addChild(b,99);var c=GeneralService.getInstance().getBookGeneralList();this.m_bookLayer=new BooksLayer,this.m_bookLayer.setBookGeneralList(c),this.addChild(this.m_bookLayer);var d=cc.Sprite.create(RES_CDN_DEFULT+"menu_book/img_book_text_book.png");d.setAnchorPoint(cc.p(0,0)),d.setPosition(cc.p(90,585)),this.addChild(d,100);var e=new ccui.Button;e.loadTextures("btn_home_off.png","btn_home_on.png","",ccui.Widget.PLIST_TEXTURE),e.setAnchorPoint(cc.p(0,0)),e.setPosition(cc.p(10,559)),e.addClickEventListener(this.back.bind(this)),this.addChild(e,100);var f=new GameInputMessageBox(!1,!1);return this.addChild(f),USE_3RD_ANNIVERSARY_CARD&&(this.m_illustInfoModalLayer=new GameModalLayer,this.addChild(this.m_illustInfoModalLayer,100)),this.removeLayerProgress2(),!0}.bind(this))},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_BooksScene]),MainObserver.getInstance().addObserver(this.onNotifyBooksIllust,this,NOTIFICATION_SELECT_BOOKS_ILLUST)},onExit:function(){if(this._super(),MainObserver.getInstance().removeObserver(sceneStr[scene_BooksScene]),MainObserver.getInstance().removeObserver(NOTIFICATION_SELECT_BOOKS_ILLUST),null!=this.m_resources){for(var a=0;a<this.m_resources.length;a++)cc.loader.release(this.m_resources[a]);this.m_resources=[]}},back:function(){GameContext.getInstance().setBookTap(STATE_TYPE_WIE),this.onKeyBack(!0,!1)},onNotification:function(b){if(this._super(b),"NOTIFICATION_SELECT_BOOKS_GENERAL"==b){this.initLayoutProgress(),this.m_bookLayer.setVerticalPercent();var c=new BooksGeneralScene;c.get_story_deferred().done(function(){this.scheduleOnce(function(){var a=SceneManager.getInstance();this.m_isPushScene=!0,a.pushScene(c),c=null},1.5)}.bind(this))}switch(b){case STATE_TYPE_WIE:case STATE_TYPE_CHOCK:case STATE_TYPE_O:case STATE_TYPE_WON:case STATE_TYPE_DONG:case STATE_TYPE_JAE:case STATE_TYPE_WAE:return this.m_bookLayer.setTapBook(b),!0;case STATE_TYPE_ILLUST:return this.m_bookLayer.setTapIllustBook(b),!0}return!0},showIllustInfoLayer:function(d){this.m_illustInfoModalLayer.setContentSize(ccSize(this)),this.m_illustInfoModalLayer._contentNode=function(b,m){var c=new YunheeIllustInfoLayer(d),back_btn=new ccui.Button;back_btn.loadTextures("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE),back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(this)-10,ccHeight(this)-10),back_btn.addClickEventListener(function(){return this.scheduleOnce(function(a){this.m_illustInfoModalLayer.hide()},0,"m_illustInfoModalLayer"),c.addChild(back_btn),c}.bind(this)),this.m_illustInfoModalLayer.show()}.bind(this)},onNotifyBooksGeneral:function(a){this.m_bookLayer.getOffsetVerticalPercent();var b=this.m_bookLayer.getBookGeneralList();GameContext.getInstance().setBookGeneralList(b);var c=new BooksGeneralScene;SceneManager.getInstance().pushScene(c),c=null},onNotifyBooksIllust:function(d){var e=d;this.m_illustInfoModalLayer.setContentSize(ccSize(this)),this.m_illustInfoModalLayer._contentNode=function(b,m){var c=new YunheeIllustInfoLayer(e),back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);return back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(this)-10,ccHeight(this)-10),back_btn.addClickEventListener(function(){this.scheduleOnce(function(a){this.m_illustInfoModalLayer.hide()},0,"m_illustInfoModalLayer")}.bind(this)),c.addChild(back_btn),c}.bind(this),this.m_illustInfoModalLayer.show()}}),LoveContentLoadingLayer=GameModalLayer.extend({m_bar:null,m_label:null,total_resource_count:0,current_loaded_count:0,m_is_update:!1,ctor:function(){this._super(),this.initLayout()},initLayout:function(){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var a=new LoadingLayerV2(7);a.setPosition(ccCenter(this)),this.addChild(a);var b=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero());b.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),b.setPosition(ccCenter(this).x,80),b.setContentSize(480,16),this.addChild(b),this.m_bar=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green.png",RectZero()),this.m_bar.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_bar.setPosition(3,ccCenter(b).y),b.addChild(this.m_bar),this.m_label=cmLabel.getLabel("0%",LABEL_FONT_INDEX.FONT_143),this.m_label.enableOutline(cc.color.BLACK,1),this.m_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_label.setPosition(ccCenter(b)),b.addChild(this.m_label);var c=cc.Sprite.create(res.s_cm_img_text_loading);c.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),c.setPosition(ccCenter(this).x,106),this.addChild(c),this.scheduleUpdate(),this.m_is_update=!0},update:function(a){if(0<this.total_resource_count&&null!=this.m_bar){var b=this.current_loaded_count/this.total_resource_count,_per=474*b;this.m_bar.setScaleX(_per),this.m_label.setString(parseInt(100*b)+"%"),this.current_loaded_count>=this.total_resource_count&&(this.m_is_update&&(this.unscheduleUpdate(),this.m_is_update=!1),this.m_bar.setScaleX(474),this.m_label.setString("100%"))}},hide:function(){this.m_is_update&&(this.unscheduleUpdate(),this.m_is_update=!1),this._super()},setTotalResourceCount:function(a){this.total_resource_count=a,this.current_loaded_count=0},addCompleteLoadedResource:function(){this.current_loaded_count+=1,this.current_loaded_count>this.total_resource_count&&(this.current_loaded_count=this.total_resource_count)}}),LoveContentsCGScene=GameScene.extend({m_script_layer:null,m_worker:null,m_audio:null,m_gameObserver:null,ctor:function(a){this._super(scene_LoveContentsCGScene),this.m_worker=null,this.m_audio=null,this.m_script_layer=null,this.m_gameObserver=null,this.initLayout(a)},initLayout:function(c){this.initLayoutProgress2(255),this.m_worker=new Worker(WEB_WORKER);var d=(new Date).getTime(),cg=MasterTable.getInstance().get_LoveCgByGnrlId(c),file_name="",cg_type=0;cg_type="y"==cg.animation_yn?(cg.love_cg_story_num<=116e3?file_name="love_cg_animation_story_1":116001<=cg.love_cg_story_num&&cg.love_cg_story_num<=116200?file_name="love_cg_animation_story_2":116201<=cg.love_cg_story_num&&cg.love_cg_story_num<=116225?file_name="love_cg_animation_story_3":116226<=cg.love_cg_story_num&&cg.love_cg_story_num<=116250?file_name="love_cg_animation_story_4":116251<=cg.love_cg_story_num&&cg.love_cg_story_num<=116275?file_name="love_cg_animation_story_5":116276<=cg.love_cg_story_num&&cg.love_cg_story_num<=116300?file_name="love_cg_animation_story_6":116301<=cg.love_cg_story_num&&cg.love_cg_story_num<=116325?file_name="love_cg_animation_story_7":116326<=cg.love_cg_story_num&&cg.love_cg_story_num<=116350?file_name="love_cg_animation_story_8":116351<=cg.love_cg_story_num&&cg.love_cg_story_num<=116375?file_name="love_cg_animation_story_9":116376<=cg.love_cg_story_num&&cg.love_cg_story_num<=116400?file_name="love_cg_animation_story_10":116401<=cg.love_cg_story_num&&cg.love_cg_story_num<=116425?file_name="love_cg_animation_story_11":116426<=cg.love_cg_story_num&&cg.love_cg_story_num<=116450?file_name="love_cg_animation_story_12":116451<=cg.love_cg_story_num&&cg.love_cg_story_num<=116475&&(file_name="love_cg_animation_story_13"),1):(cg.love_cg_story_num<=115e3?file_name="love_cg_story_1":115001<=cg.love_cg_story_num&&cg.love_cg_story_num<=116e3?file_name="love_cg_story_2":116001<=cg.love_cg_story_num&&cg.love_cg_story_num<=116030?file_name="love_cg_story_3":116031<=cg.love_cg_story_num&&cg.love_cg_story_num<=116040?file_name="love_cg_story_4":116041<=cg.love_cg_story_num&&cg.love_cg_story_num<=116050?file_name="love_cg_story_5":116051<=cg.love_cg_story_num&&(file_name="love_cg_story_6"),2),this.m_worker.postMessage({cmd:"loveCgStory",url:master_json+file_name+".jbin",key:cg.love_cg_story_num}),this.m_worker.onmessage=function(a){var b=(new Date).getTime(),elapsed=b-d;cc.log("load finish loveCg_time ======== "+elapsed),0==a.data.length&&MainObserver.getInstance().postNotification(NOTIFY_NETWORK_ERROR),1==cg_type?MasterManager.getInstance().set_LoveCgAnimationStory(a.data):MasterManager.getInstance().set_LoveCgStory(a.data),a.data=null,elapsed=b=d=cg=null,this.removeLayerProgress2(),TUTO_LOAD_CHECK=!0,1!=USE_POLYGON_MOSAIC&&1!=USE_HSCENE_WATCH_MODE||(this.m_script_layer=new LoveContentsScriptLayer_V2(c)),this.addChild(this.m_script_layer)}.bind(this)},onEnter:function(){this._super(),MasterManager.getInstance().reset_LoveCgStory(),MasterManager.getInstance().reset_LoveCgAnimationStory(),this.m_gameObserver=MainObserver.getInstance(),this.m_gameObserver.addObserver(this.onNotification,this,sceneStr[scene_LoveContentsCGScene]),this.m_audio=AudioEngine.getInstance()},onExit:function(){this._super(),this.m_worker.terminate(),this.m_worker=null,delete this.m_worker,null!=this.m_gameObserver&&(this.m_gameObserver.removeObserver(sceneStr[scene_LoveContentsCGScene]),this.m_gameObserver=null),MasterManager.getInstance().reset_LoveCgStory(),MasterManager.getInstance().reset_LoveCgAnimationStory(),null!=this.m_audio&&(this.m_audio.stopVoiceAll(),this.m_audio.releaseResourceEffects(),this.m_audio=null),this.playMainBGM(),null!=this.m_script_layer&&null!=this.m_script_layer&&(this.removeChild(this.m_script_layer),this.m_script_layer=null),this.removeAllChildrenWithCleanup(!0)},back:function(){this.m_script_layer.stopUpdate(),this.scheduleOnce(function(a){this.m_audio.stopVoiceAll(),this.m_isPushScene?SceneManager.getInstance().popScene():this.onKeyBack(!0,!1)}.bind(this),0,"pop_scene")},onNotification:function(a){switch(a){case Contents_Skip:this.back();break;case Hide_Script_Log:this.m_script_layer.showScriptLog(!1);break;case NOTIFY_MENU_OPTION:case NOTIFY_NETWORK_ERROR:this._super(a)}},onTutorialEnter:function(a){this.setTutorialStep(a),a.tutorial_page==TUTORIAL_PAGE_4_LOVE_CG&&7==a.tutorial_step&&this.popTutorialLayer()}}),LoveContentCGLogLayer=cc.Layer.extend({m_is_voice_playing:!1,m_tableView:null,m_voice_playing_delta:0,m_cur_animation_script:0,m_cur_script:0,m_script_type:null,m_script_list:[],m_animation_script_list:[],ctor:function(){this._super(),this.m_script_list=[],this.m_animation_script_list=[],this.init()},onExit:function(){this._super()},init:function(){var b=cc.director.getWinSize(),mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",cc.Rect(1,1,1,1));mask.setAnchorPoint(ANCHOR_MIDDLE()),mask.setPreferredSize(b),mask.setPosition(ccCenter(b)),this.addChild(mask);var c=cc.size(960,640);this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE()),this.setContentSize(c);var d=cc.Rect(40,40,10,10),box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box.png",d);box.setPreferredSize(c),box.setPosition(ccCenter(this)),this.addChild(box);var e=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center.png");e.setAnchorPoint(ANCHOR_MIDDLE_TOP()),e.setPosition(.5*c.width,c.height-11),box.addChild(e);var f=new ccui.Button;f.loadTextures("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE),f.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),f.setPosition(ccWidth(e)-16,ccCenter(e).y+2),f.addClickEventListener(function(a){MainObserver.getInstance().postNotification(sceneStr[scene_LoveContentsCGScene],Hide_Script_Log)}),e.addChild(f);var g=cc.size(920,554);return this.m_tableView=new cc.TableView(this,g),this.m_tableView.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_tableView.setPosition(20,20),this.m_tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_tableView.setVerticalFillOrder(0),this.m_tableView.scrollBarEnable(!0),box.addChild(this.m_tableView),this.scheduleUpdate(),!0},tableCellSizeForIndex:function(){return cc.size(920,100)},setScriptData:function(a,b){b==SCRIPT_TYPE.ANIMATION?(this.m_script_type=SCRIPT_TYPE.ANIMATION,this.m_animation_script_list=a):(this.m_script_type=SCRIPT_TYPE.SCRIPT,this.m_script_list=a),this.m_tableView.reloadData(),this.m_tableView.setContentOffset(ZERO())},tableCellAtIndex:function(a,b){var c=a.dequeueCell(),cell=null;if(cell=null==c?new LoveContentLogCell(this):c,this.m_script_type==SCRIPT_TYPE.ANIMATION){var d=this.m_animation_script_list[b];cell.setScriptData(d,this.m_script_type)}else{d=this.m_script_list[b];cell.setScriptData(d,this.m_script_type)}return cell},numberOfCellsInTableView:function(a){return this.m_script_type==SCRIPT_TYPE.ANIMATION?this.m_animation_script_list.length:this.m_script_list.length},voicePlayAnimation:function(a){var b=AudioEngine.getInstance();b.stopEffectsAll(),this.m_cur_animation_script=a;var c=RES_CDN_SOUND+SND_TYPE+"voice_love/"+this.m_cur_animation_script.voice+".mp3";b.playVoice(c),this.m_is_voice_playing=!0,this.m_voice_playing_delta=0},voicePlay:function(a){var b=AudioEngine.getInstance();b.stopEffectsAll(),this.m_cur_script=a;var c=RES_CDN_SOUND+SND_TYPE+"voice_love/"+this.m_cur_script.voice+".mp3";b.playVoice(c),this.m_is_voice_playing=!0,this.m_voice_playing_delta=0},update:function(a){this.m_is_voice_playing&&(this.m_voice_playing_delta+=a,this.m_script_type==SCRIPT_TYPE.ANIMATION?this.m_voice_playing_delta>this.m_cur_animation_script.voice_duration&&(this.m_is_voice_playing=!1,this.m_voice_playing_delta=0):this.m_script_type==SCRIPT_TYPE.SCRIPT&&this.m_voice_playing_delta>this.m_cur_script.voice_duration&&(this.m_is_voice_playing=!1,this.m_voice_playing_delta=0))}}),LoveContentLogCell=cc.TableViewCell.extend({m_logLayer:null,m_cell_bg:null,m_voice_btn:null,ctor:function(a){this.m_logLayer=a,this._super(),this.init()},init:function(){this.setAnchorPoint(ANCHOR_BOTTOM_LEFT());var b=cc.size(920,100);this.m_cell_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box.png",RectZero()),this.m_cell_bg.setPreferredSize(b),this.m_cell_bg.setOpacity(0),this.m_cell_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_cell_bg.setPosition(ZERO()),this.addChild(this.m_cell_bg);var c=RES_CDN_DEFULT+"menu_cg/btn_voice_off.png",on=RES_CDN_DEFULT+"menu_cg/btn_voice_on.png";return this.m_voice_btn=new ccui.Button(c,on),this.m_voice_btn.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_voice_btn.setPosition(6,.5*b.height),this.addChild(this.m_voice_btn),this.m_voice_btn.addClickEventListener(function(a){this.playVoice()}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_voice_btn.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),this.m_name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2013),this.m_name.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_name.setPosition(75,.5*b.height),this.addChild(this.m_name),this.m_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_201),this.m_content.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_content.setPosition(220,.5*b.height),this.m_content.setTextAreaSize(cc.size(b.width-200,b.height-20)),this.m_content.ignoreContentAdaptWithSize(!1),this.addChild(this.m_content),!0},enter:function(){this.updateAnimationCell()},setScriptData:function(a,b){isUndefined(this.m_user_info)&&(this.m_user_info=NetService().get_User_info()),b==SCRIPT_TYPE.SCRIPT?(this.m_script_type=SCRIPT_TYPE.SCRIPT,this.m_script=a,this.m_voice_id=0,this.updateCell()):(this.m_script_type=SCRIPT_TYPE.ANIMATION,this.m_animation_script=a,this.m_voice_id=0,this.updateAnimationCell())},updateCell:function(){"0"==this.m_script.name?this.m_name.setString("字幕"):"1"==this.m_script.name?this.m_name.setString(this.m_user_info.nickname):this.m_name.setString(this.m_script.name),1==this.m_script.name_type?this.m_content.setString(v.sprintf(this.m_script.content,this.m_user_info.nickname)):this.m_content.setString(this.m_script.content);var a=this.m_content.getContentSize();this.m_cell_height=a.height+20,"0"==this.m_script.voice?this.m_voice_btn.setVisible(!1):this.m_voice_btn.setVisible(!0)},updateAnimationCell:function(){"0"==this.m_animation_script.name?this.m_name.setString("字幕"):"1"==this.m_animation_script.name?this.m_name.setString(this.m_user_info.nickname):this.m_name.setString(this.m_animation_script.name),1==this.m_animation_script.name_type?this.m_content.setString(v.sprintf(this.m_animation_script.content,this.m_user_info.nickname)):this.m_content.setString(this.m_animation_script.content);var a=this.m_content.getContentSize();this.m_cell_height=a.height+20,"0"==this.m_animation_script.voice?this.m_voice_btn.setVisible(!1):this.m_voice_btn.setVisible(!0)},playVoice:function(){(this.m_script_type=SCRIPT_TYPE.ANIMATION)?this.m_logLayer&&this.m_logLayer.voicePlayAnimation(this.m_animation_script):this.m_logLayer&&this.m_logLayer.voicePlay(this.m_script)}}),NpcInfoItemNode=cc.Node.extend({m_icon:null,tooltip_box:null,tooltip_title:null,tooltip_content:null,tooltip_btn:null,m_card_type:0,m_boss_mark:null,m_is_boss:!1,m_life_bar:null,m_game_type:0,m_ignore_def_icon:null,m_callback:null,tooltip_title_sprite:null,ctor:function(a,b,c,d){this._super(),this.init(a,b,c,d)},init:function(a,b,c,d){if(this.m_game_type=b,this.m_card_type=a,this.m_callback=c,this.m_cancel=d,this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_icon=cc.Sprite.create(),this.m_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_icon.setPosition(ZERO()),this.addChild(this.m_icon),this.m_boss_mark=cc.Sprite.create("#img_card_frame_small_boss.png"),this.m_boss_mark.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_boss_mark.setPosition(ZERO()),this.addChild(this.m_boss_mark,10),this.m_ignore_def_icon=cc.Sprite.create("#img_card_small_drill.png"),this.m_ignore_def_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_ignore_def_icon.setPosition(ZERO()),this.addChild(this.m_ignore_def_icon,11),this.m_ignore_def_icon.setVisible(!1),this.m_game_type==db.BattleGameType.GreatWallDungeon){var e=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero());e.setAnchorPoint(ANCHOR_TOP_LEFT()),e.setPreferredSize(cc.size(68,12)),e.setPosition(0,0),this.addChild(e,20),this.m_life_bar=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green.png",RectZero()),this.m_life_bar.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_life_bar.setPosition(3,5),e.addChild(this.m_life_bar)}return this.tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.tooltip_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.tooltip_box.setPosition(ZERO()),this.tooltip_box.setVisible(!1),this.addChild(this.tooltip_box,1e6),this.tooltip_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1810),this.tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_box.addChild(this.tooltip_title),this.tooltip_title_sprite=cc.Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png"),this.tooltip_title_sprite.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_title_sprite.setVisible(!1),this.tooltip_box.addChild(this.tooltip_title_sprite),this.tooltip_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.tooltip_content.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_box.addChild(this.tooltip_content),this.tooltip_btn=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(20,20,20,20))),this.tooltip_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.tooltip_btn.setPreferredSize(cc.size(0,0)),this.tooltip_btn.setPosition(ZERO()),this.addChild(this.tooltip_btn),this.tooltip_btn.addTargetWithActionForControlEvents(this,this.onTouchIcon,cc.CONTROL_EVENT_TOUCH_DOWN),this.tooltip_btn.addTargetWithActionForControlEvents(this,this.onTouchIcon,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),this.tooltip_btn.addTargetWithActionForControlEvents(this,this.onTouchIcon,cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE),this.tooltip_btn.addTargetWithActionForControlEvents(this,this.onTouchIcon,cc.CONTROL_EVENT_TOUCH_CANCEL),!0},onTouchIcon:function(a,b){b==cc.CONTROL_EVENT_TOUCH_DOWN?this.showTooltip():this.hideTooltip()},convertCardGeneral:function(a,b){b.gnrl_id=a.gnrl_id,b.level=1},showTooltip:function(){this.tooltip_box.setVisible(!0),this.tooltip_box.setLocalZOrder(1e4),this.setLocalZOrder(100001);var a=MasterTable.getInstance().get_TooltipGeneral(this.m_general.gnrl_id);if(111002!=this.m_general.gnrl_id){this.tooltip_title.setString(this.m_general.name),this.tooltip_content.setString(a.content);var b=ccSize(this.tooltip_title),cSize=ccSize(this.tooltip_content);if((e=cc.size(b.width+20,b.height+20)).width=Math.max(b.width+20,cSize.width+20),e.height=Math.max(64,e.height+cSize.height+5),this.tooltip_box.setContentSize(e),this.tooltip_box.setContentSize(e),this.tooltip_title.setPosition(10,e.height-10),this.tooltip_content.setPosition(10,e.height-15-b.height),this.tooltip_box){var c=this.tooltip_box.getParent().getParent().getParent().convertToWorldSpace(this.getPosition()),container_pos=this.tooltip_box.getParent().getParent().getPosition();c.x=c.x+this.tooltip_box.x+container_pos.x,c.y=c.y+this.tooltip_box.y+container_pos.y,null!=this.m_callback&&this.m_callback(c,Object.assign({},this.tooltip_box),this.tooltip_title.getString(),this.tooltip_content.getString())}}else{var d=RES_CDN_DEFULT+"common/font_1810.png",frame_texture=cc.textureCache.addImage(d),frame=new cc.SpriteFrame(frame_texture,cc.rect(0,0,frame_texture.getContentSize().width,frame_texture.getContentSize().height));this.tooltip_title_sprite.setSpriteFrame(frame),this.tooltip_title_sprite.setOpacity(255),this.tooltip_title_sprite.setVisible(!0),this.tooltip_content.setString(a.content);var e;b=ccSize(this.tooltip_title_sprite),cSize=ccSize(this.tooltip_content);if((e=cc.size(b.width+20,b.height+20)).width=Math.max(b.width+20,cSize.width+20),e.height=Math.max(64,e.height+cSize.height+5),this.tooltip_box.setContentSize(e),this.tooltip_box.setContentSize(e),this.tooltip_title_sprite.setPosition(10,e.height-10),this.tooltip_content.setPosition(10,e.height-15-b.height),this.tooltip_box){c=this.tooltip_box.getParent().getParent().getParent().convertToWorldSpace(this.getPosition()),container_pos=this.tooltip_box.getParent().getParent().getPosition();c.x=c.x+this.tooltip_box.x+container_pos.x,c.y=c.y+this.tooltip_box.y+container_pos.y,null!=this.m_callback&&this.m_callback(c,Object.assign({},this.tooltip_box),"",this.tooltip_content.getString())}}},hideTooltip:function(){this.tooltip_box.setVisible(!1),this.tooltip_title_sprite.setVisible(!1),this.setLocalZOrder(0),null!=this.m_cancel&&this.m_cancel()},setNpcData:function(a,b){var m=MasterTable.getInstance().getMasterTable();this.m_general=m.get_General(a.gnrl_id),this.m_is_boss=b,this.updateIcon()},setGeneralData:function(a,b){this.m_general=a,this.m_is_boss=b,this.updateIcon()},setBattleGeneralData:function(a,b){this.m_battle_general=a,this.m_is_boss=b,this.m_general=this.m_battle_general.general,this.updateIcon()},updateIcon:function(){null!=this.m_icon&&null!=this.m_icon.getParent()&&this.m_icon.removeFromParent();var a=db.CardInfo;this.convertCardGeneral(this.m_general,a),this.m_icon=(new Card).createCard(a,this.m_card_type),this.m_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_icon.setPosition(ZERO()),this.addChild(this.m_icon,0);var b=ccSize(this.m_icon);if(this.setContentSize(b),this.tooltip_btn.setPreferredSize(b),this.tooltip_box.setPosition(.5*b.width,b.height+5),this.m_boss_mark.setPosition(65,65),this.m_boss_mark.setVisible(this.m_is_boss),this.m_game_type==db.BattleGameType.GreatWallDungeon&&(this.m_ignore_def_icon.setVisible(1==this.m_battle_general.npc_attk_dmg_type),null!=this.m_life_bar)){var c=this.m_battle_general.general.hp,cur_life=c*this.m_battle_general.remain_hp_rate/1e4;this.m_battle_general.is_dead?cur_life=0:cur_life<0&&(cur_life=1);var d=cc.clampf(cur_life/c*62,0,62);this.m_life_bar.setPreferredSize(cc.size(d,6))}},setGlobalZOrderTooltip:function(a){null!=this.tooltip_box&&a&&(this.tooltip_box.setGlobalZOrder(1e6),this.tooltip_title.setGlobalZOrder(1000001),this.tooltip_content.setGlobalZOrder(1000002),this.tooltip_title_sprite.setGlobalZOrder(1000001))}}),WeeklyDeckReadyLeaderNode=cc.Node.extend({m_leader_placehold:null,m_leader_icon:null,m_leader_title:null,m_leader_content:null,m_leader_content_v2:null,ctor:function(){this._super(),this.init()},init:function(){this.m_leader_data={leader_skill_id:0},this.m_Sleader_data={special_leader_skill_id:0};var a=cc.size(409,68);this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(a);var b=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");b.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),b.setPosition(ZERO()),this.addChild(b);var c=cc.Sprite.create(RES_CDN_DEFULT+"icon/leader/leader_none.png");return c.setAnchorPoint(ANCHOR_MIDDLE()),c.setPosition(ccCenter(b)),b.addChild(c),this.m_leader_icon=cc.Sprite.create(RES_CDN_DEFULT+"icon/leader/leader_30001.png"),this.m_leader_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_leader_icon.setPosition(ccCenter(b)),b.addChild(this.m_leader_icon),this.m_leader_icon.setVisible(!1),this.m_leader_placehold=cmLabel.getLabel("リーダーが設定されていないためリーダースキ\nルが発動しません。",LABEL_FONT_INDEX.FONT_166),this.m_leader_placehold.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_leader_placehold.setPosition(75,.5*a.height),this.m_leader_placehold.setTextAreaSize(cc.size(a.width-75,0)),this.addChild(this.m_leader_placehold),this.m_leader_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812),this.m_leader_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_leader_title.setPosition(75,a.height),this.addChild(this.m_leader_title),this.m_leader_title.setVisible(!1),USE_LEADERSKILL_SCROLL?(this.m_leader_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_144),this.m_leader_content.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_leader_content.setTextAreaSize(cc.size(310,50)),this.m_leader_content.ignoreContentAdaptWithSize(!1),this.m_leader_content.setVisible(!1),this.m_leader_content_v2=new cc.ScrollView(cc.size(310,45),this.m_leader_content),this.m_leader_content_v2.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_leader_content_v2.setContentSize(this.m_leader_content.getContentSize()),this.m_leader_content_v2.setPosition(75,0),this.m_leader_content_v2.setContentOffset(cc.p(0,45-1*this.m_leader_content.getContentSize().height),!1),this.addChild(this.m_leader_content_v2)):(this.m_leader_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_144),this.m_leader_content.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_leader_content.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_leader_content.setTextAreaSize(cc.size(310,80)),this.m_leader_content.ignoreContentAdaptWithSize(!1),this.m_leader_content.setPosition(75,.5*(a.height-50)),this.addChild(this.m_leader_content),this.m_leader_content.setVisible(!1)),!0},setLeaderSkillId:function(a){if(0==a||99999==a)this.m_leader_data=null,this.clear();else{var m=MasterManager.getInstance();this.m_leader_data=m.get_LeaderSkill(a)}this.updateLeaderSlot()},setSLeaderSkillId:function(a){if(0==a||99999==a)this.m_leader_data=null,this.clear();else{var m=MasterManager.getInstance();this.m_leader_data=m.get_SpecialLeaderSkill(a)}this.updateLeaderSlot()},updateLeaderSlot:function(){if(null==this.m_leader_data)this.m_leader_icon.setVisible(!1),this.m_leader_placehold.setVisible(!0),this.m_leader_title.setVisible(!1),this.m_leader_content.setVisible(!1);else{var a=RES_CDN_DEFULT+"icon/leader/leader_"+this.m_leader_data.skill_icon+".png",frame_texture=cc.textureCache.addImage(a),frame=new cc.SpriteFrame(frame_texture,cc.rect(0,0,frame_texture.getContentSize().width,frame_texture.getContentSize().height));this.m_leader_icon.setSpriteFrame(frame),this.m_leader_icon.setVisible(!0),this.m_leader_placehold.setVisible(!1),this.m_leader_title.setString(this.m_leader_data.name),this.m_leader_title.setVisible(!0),this.m_leader_content.setString(this.m_leader_data.content),this.m_leader_content.setVisible(!0),USE_LEADERSKILL_SCROLL&&(this.m_leader_content_v2.setContentSize(this.m_leader_content.getContentSize()),this.m_leader_content_v2.setContentOffset(cc.p(0,45-1*this.m_leader_content.getContentSize().height),!1))}},clear:function(){null!=this.m_leader_data&&(this.m_leader_data.leader_skill_id=0,this.m_Sleader_data.special_leader_skill_id=0)},scrollViewDidScroll:function(a){},scrollViewDidZoom:function(a){}}),WeeklyEntryBgLayer=cc.Layer.extend({ctor:function(){this._super()},back:function(){cc.log("back click")}}),weekly_dungeon_show_help_v2=89898,weekly_dungeon_open=89899,weekly_dungeon_begin=89900,jade_lack=89901,UPDATE_INTERVAL_TIME=1,WeeklyEntryLayer=cc.Layer.extend({m_bg:null,m_base_layer:null,m_tableView:null,m_choice_week_day:0,m_right_layer:null,m_dungeon_name:null,m_choice_difficulty_type:-1,m_boss_img:null,m_dungeon_open_time:null,m_start_key_btn:null,m_need_key:null,m_boss_container:null,m_start_jade_btn:null,m_need_jade:null,m_message_box:null,m_update_min_delta:0,m_weekly_btns:[],m_difficulty_btns:[],m_npc_list:[],m_reward_list:[],m_week_day_dungeon_list:[],m_total_dungeon_list:[],m_gnrl_img:null,m_boyd_img_num:0,m_deferred:null,m_choice_stage_count:0,m_help_check:!1,m_mission_task_modal_layer:null,m_task_list:[],m_jade_btn_open:!1,ctor:function(a,b,c,d){this._super(),this.m_npc_list=[],this.m_reward_list=[],this.m_week_day_dungeon_list=[],this.m_total_dungeon_list=[],this.m_weekly_btns=[],this.m_difficulty_btns=[],this.m_task_list=[],this.m_deferred=a,this.m_jade_btn_open=!1,WEEKLY_DUNGEON_NOW=!1,this.init(b,c,d)},onExit:function(){if(this._super(),1!=PREV_MISSION&&1!=PREV_ACHIVE_WEEKLY)if(1!=WEEKLY_DUNGEON_NOW)if(1!=this.m_help_check){if(null!=this.m_gnrl_img){for(var a=0;a<this.m_gnrl_img.length;a++)cc.loader.release(this.m_gnrl_img[a]);this.m_gnrl_img=[]}this.m_npc_list=[],this.m_reward_list=[],this.m_week_day_dungeon_list=[],this.m_total_dungeon_list=[],this.m_weekly_btns=[],this.m_difficulty_btns=[],null!=this.m_boss_container&&this.m_boss_container.removeChild(this.m_boss_img),null!=this.m_right_layer&&(this.m_right_layer.removeChild(this.m_dungeon_name),this.m_right_layer.removeChild(this.m_start_key_btn),this.m_right_layer.removeChild(this.m_start_jade_btn),this.m_right_layer.removeAllChildrenWithCleanup(!0)),null!=this.m_base_layer&&(this.m_base_layer.removeChild(this.m_boss_container),this.m_base_layer.removeChild(this.m_tableView),this.m_base_layer.removeChild(this.m_right_layer),this.m_base_layer.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_base_layer)),null!=this.m_bg&&this.removeChild(this.m_bg),null!=this.m_message_box&&this.removeChild(this.m_message_box),this.removeAllChildrenWithCleanup(!0)}else this.m_help_check=!1;else WEEKLY_DUNGEON_NOW=!1},init:function(a,b,c){this.m_gnrl_img=[],this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var d=ccSize(this),service=BattleService.getInstance();this.m_total_dungeon_list=[],service.getMasterWeeklyDungeon(this.m_total_dungeon_list),this.m_bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub.png"),this.m_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bg.setPosition(ccCenter(d)),USE_SP_COMMON_SUB_BG_SCALE&&this.m_bg.setScale(2),this.addChild(this.m_bg),this.m_base_layer=new cc.Layer,this.m_base_layer.ignoreAnchorPointForPosition(!1),this.m_base_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_base_layer.setPosition(ccCenter(d)),this.addChild(this.m_base_layer),this.createDungeonBoss(),this.createLeftBox(),this.createRightBox(),a<0||6<a?this.m_choice_week_day=this.checkTodayWeekDay():(this.m_choice_week_day=a,this.m_choice_difficulty_type=b,this.m_choice_stage_count=c),this.choiceWeeklyDay(this.m_choice_week_day),this.choiceDifficultyType(this.m_choice_difficulty_type),this.choiceStage(this.m_choice_stage_count),this.updateRightInfo(),this.m_message_box=new CTGameMessageBox,this.addChild(this.m_message_box,11e4);var e=cc.size(d.width,640);return this.m_mission_task_modal_layer=new GameModalLayer,this.m_mission_task_modal_layer.setContentSize(e),this.addChild(this.m_mission_task_modal_layer,99998),this.scheduleUpdateWithPriority(1),this.m_tableView.reloadData(),this.m_deferred.resolve(!0),!0},getWeeklyDungeonOpenInfo:function(a,b,c){var d=this.getSelectedDungeon();return{idx:d.weekly_dungeon.weekly_idx,type:this.m_choice_week_day+1,time:d.weekly_dungeon.open_time}},createDungeonBoss:function(){var c=ccSize(this);this.m_boss_container=new cc.Node,this.m_boss_container.setPosition(c.width,0),this.m_base_layer.addChild(this.m_boss_container),this.m_boss_img=cc.Sprite.create(),this.m_boss_img.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_boss_img.setPosition(ZERO()),this.m_boss_img.setScale(2),this.m_boss_container.addChild(this.m_boss_img);var d=new cc.ScaleTo(.7,2,2.01),scaleTo_2=new cc.ScaleTo(.7,2,1.99),seq=new cc.Sequence(d,scaleTo_2),repeat=new cc.RepeatForever(seq);this.m_boss_img.runAction(repeat);var e=cc.Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal_4.png");e.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),e.setPosition(LP(this,300,0)),e.setScaleY(640),this.m_base_layer.addChild(e);var f=new ccui.Button;f.loadTextures("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE),f.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),f.setPosition(c.width-10,539),this.m_base_layer.addChild(f),f.addClickEventListener(function(b){this.scheduleOnce(function(a){this.m_help_check=!0,MainObserver.getInstance().postNotification(sceneStr[scene_WeeklyEntryScene],weekly_dungeon_show_help_v2)},0,"weekly_dungeon_show_help")}.bind(this))},createLeftBox:function(){var b=cc.size(476,488);this.m_tableView=new cc.TableView(this,b),this.m_tableView.ignoreAnchorPointForPosition(!1),this.m_tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_tableView.setVerticalFillOrder(0),this.m_tableView.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_tableView.setPosition(LP(this,0,10)),this.m_tableView.setDelegate(this),this.m_base_layer.addChild(this.m_tableView),this.m_tableView.scrollBarEnable(!0),this.m_tableView.reloadData();var c=[];c.push("日"),c.push("月"),c.push("火"),c.push("水"),c.push("木"),c.push("金"),c.push("土");for(var d=0,i=0;i<c.length;i++){var e=new LabelButton("btn_19_none.png","btn_19_on.png","btn_19_off.png",ccui.Widget.PLIST_TEXTURE);e.setFont(LABEL_FONT_INDEX.FONT_241),e.setString(c[i]),e.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),e.setPosition(LP(this,d,508)),this.m_base_layer.addChild(e),e.setTag(i),e.addClickEventListener(function(a){this.choiceWeeklyDay(a.getTag()),this.choiceDifficultyType(-1),this.updateRightInfo()}.bind(this)),this.m_weekly_btns.push(e),d+=ccWidth(e)}},createRightBox:function(){var b=ccSize(this),boxSize=cc.size(481,568);this.m_right_layer=new cc.Layer,this.m_right_layer.ignoreAnchorPointForPosition(!1),this.m_right_layer.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_right_layer.setContentSize(boxSize),this.m_right_layer.setPosition(.5*b.width+1,0),this.m_base_layer.addChild(this.m_right_layer),this.m_dungeon_name=cc.Sprite.create("#img_vs_day_text_title_01.png"),this.m_dungeon_name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_dungeon_name.setPosition(19,525),this.m_right_layer.addChild(this.m_dungeon_name);var c=[];c.push(res_str("label_weekly_easy")),c.push(res_str("label_weekly_easy_2x")),c.push(res_str("label_weekly_normal")),c.push(res_str("label_weekly_normal_2x")),c.push(res_str("label_weekly_hard")),c.push(res_str("label_weekly_hard_2x")),c.push(res_str("label_weekly_super_easy")),c.push(res_str("label_weekly_super_easy_2x"));for(var d=19,offset_y_diff=472,i=0;i<c.length;i++){offset_y_diff=i%2==0?472:427;var e=new LabelButton("btn_20_none.png","btn_20_on.png","btn_20_off.png",ccui.Widget.PLIST_TEXTURE);e.setFont(LABEL_FONT_INDEX.FONT_201),e.setString(c[i]),e.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),e.setPosition(d,offset_y_diff),this.m_right_layer.addChild(e),e.setTag(i),e.addClickEventListener(function(a){this.choiceDifficultyType(a.getTag()),this.updateRightInfo()}.bind(this)),this.m_difficulty_btns.push(e),i%2==1&&(d+=ccWidth(e)),cc.log("diff_types[i] = "+c[i])}(dot=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),dot.setPosition(19,395),this.m_right_layer.addChild(dot),(title=cmLabel.getLabel("ボスバトル敵情報",LABEL_FONT_INDEX.FONT_248)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(35,388),this.m_right_layer.addChild(title);var f=[];f.push(cc.p(19,269)),f.push(cc.p(91,305)),f.push(cc.p(91,233)),f.push(cc.p(163,305)),f.push(cc.p(163,233));for(i=0;i<f.length;i++){var g=new NpcInfoItemNode(CARD_TYPE.type_card_thumb);g.setPosition(f[i]),this.m_right_layer.addChild(g),this.m_npc_list.push(g),g=null}(h=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),h.setPosition(19,197),this.m_right_layer.addChild(h),f=h=title=dot=null,(dot=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),dot.setPosition(19,172),this.m_right_layer.addChild(dot),(title=cmLabel.getLabel("獲得報酬",LABEL_FONT_INDEX.FONT_248)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(35,164),this.m_right_layer.addChild(title);var h,dot,title,campaign=MasterTable.getInstance().get_RewardCampaignUi(CAMPAIGN_DUNGEON_TYPE_WEEKLY,CAMPAIGN_POSITION_TYPE_ENTERANCE_BOTTOM_REWARD_);null!=campaign.dugeon_type&&0!=campaign.dugeon_type&&((r=cc.Sprite.create(RES_CDN_DEFULT+cmString("common/%s",campaign.image_name))).setAnchorPoint(ZERO()),r.setPosition(127,161),this.m_right_layer.addChild(r),r=null);var k=19;for(i=0;i<6;i++){var l=new MissionPreviewBonusItemCell;l.setEnableToolTip(!0),l.setPosition(k,86),this.m_right_layer.addChild(l),k+=72,this.m_reward_list.push(l),l=null}title=dot=null,(h=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),h.setPosition(19,70),this.m_right_layer.addChild(h),(dot=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),dot.setPosition(19,40),this.m_right_layer.addChild(dot),(title=cmLabel.getLabel(res_str("label_task_title"),LABEL_FONT_INDEX.FONT_248)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(35,32),this.m_right_layer.addChild(title);for(var m=140,j=0;j<3;j++){var n=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_off.png");n.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),n.setPosition(m,28),this.m_right_layer.addChild(n),this.m_task_list.push_back(n),m+=36}var o=new ccui.Button("btn_help_small_off.png","btn_help_small_on.png","",ccui.Widget.PLIST_TEXTURE);o.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),o.setPosition(m,42),this.m_right_layer.addChild(o),o.addClickEventListener(function(a){this.showMissionTaskModalLayer()}.bind(this)),this.m_start_key_btn=new LabelButton("btn_07_off.png","btn_07_on.png","btn_07_none.png",ccui.Widget.PLIST_TEXTURE),this.m_start_key_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_start_key_btn.setPosition(LP(this,ccWidth(this.m_right_layer)-10,10)),this.m_start_key_btn.setPosition(320,10),this.m_start_key_btn.setFont(LABEL_FONT_INDEX.FONT_241),this.m_start_key_btn.setString("スタート"),this.m_start_key_btn.setOffsetX(-50);ccSize(this.m_start_key_btn);(q=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero())).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),q.setPosition(.5*ccWidth(this.m_start_key_btn)+18,.5*ccHeight(this.m_start_key_btn)),q.setPreferredSize(cc.size(66,38)),this.m_start_key_btn.addChild(q);var p=ccSize(q);(r=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_ic_key.png")).setAnchorPoint(ANCHOR_MIDDLE()),r.setPosition(0,.5*p.height),q.addChild(r),this.m_need_key=cmLabel.getLabel("3",LABEL_FONT_INDEX.FONT_2011),this.m_need_key.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_need_key.setPosition(p.width-10,.5*p.height),q.addChild(this.m_need_key),this.m_right_layer.addChild(this.m_start_key_btn),this.m_start_key_btn.addClickEventListener(function(a){this.startBattleReady()}.bind(this)),this.m_start_key_btn.setVisible(!1);var q,twice_event=cc.Sprite.create(RES_CDN_DEFULT+"menu_vs/img_vs_day_event_text_2.png");twice_event.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),twice_event.setPosition(ccWidth(this.m_start_key_btn),44),this.m_start_key_btn.addChild(twice_event),this.m_start_jade_btn=new LabelButton("btn_07_off.png","btn_07_on.png","btn_07_none.png",ccui.Widget.PLIST_TEXTURE),this.m_start_jade_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_start_jade_btn.setPosition(320,10),this.m_start_jade_btn.setFont(LABEL_FONT_INDEX.FONT_201),this.m_start_jade_btn.setString("購入（3分）",30),this.m_start_jade_btn.setOffsetX(-35),(q=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero())).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),q.setPosition(.5*ccWidth(this.m_start_key_btn)+36,.5*ccHeight(this.m_start_key_btn)),q.setPreferredSize(cc.size(66,38)),this.m_start_jade_btn.addChild(q);var r;p=ccSize(q);(r=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_jade.png")).setAnchorPoint(ANCHOR_MIDDLE()),r.setPosition(0,.5*p.height),q.addChild(r),this.m_need_jade=cmLabel.getLabel("3",LABEL_FONT_INDEX.FONT_2011),this.m_need_jade.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_need_jade.setPosition(p.width-10,.5*p.height),q.addChild(this.m_need_jade),this.m_right_layer.addChild(this.m_start_jade_btn),this.m_start_jade_btn.addClickEventListener(function(a){this.startBattleReady()}.bind(this))},startBattleReady:function(){if(this.IsEnableDungeonOpenTime()){var a=this.getSelectedDungeon(),difficulty=this.getSelectedDifficulty();BattleService.getInstance().getMasterWeeklyDungeonStageNpc(difficulty);var b=BattleContext._getInstance();b.setGameType(db.BattleGameType.WeeklyDungeon),b.setWeeklyDungeonData(a),b.setWeeklyDungeonDifficulty(difficulty),MainObserver.getInstance().postNotification(sceneStr[scene_WeeklyEntryScene],weekly_dungeon_begin)}else this.buyDungeonTime();this.m_update_min_delta=UPDATE_INTERVAL_TIME},buyDungeonTime:function(){var a=this.getSelectedDungeon(),userItemInfo=NetService().get_UserItemInfo_V2();if(userItemInfo.jade_cnt<a.weekly_dungeon.cost)return this.m_help_check=!0,cc.log("weekly_dungeon - buyDungeonTime() have_jade_cnt:"+userItemInfo.jade_cnt+", need cost:"+a.weekly_dungeon.cost),void MainObserver.getInstance().postNotification(sceneStr[scene_WeeklyEntryScene],jade_lack);this.showBuyOpenDungeon()},showBuyOpenDungeon:function(a){var b=this.getSelectedDungeon();this.m_message_box.setTitle("曜日無双購入");var c=(b.weekly_dungeon.open_time/60).toFixed(0);this.m_message_box.setText("翡翠",LABEL_FONT_INDEX.FONT_261),this.m_message_box.setText(b.weekly_dungeon.cost+"個",LABEL_FONT_INDEX.FONT_262),this.m_message_box.setText("で",LABEL_FONT_INDEX.FONT_261),this.m_message_box.setText(b.weekly_dungeon.name,LABEL_FONT_INDEX.FONT_262),this.m_message_box.setText("を",LABEL_FONT_INDEX.FONT_261),this.m_message_box.setText("\n"),this.m_message_box.setText(c+"分間",LABEL_FONT_INDEX.FONT_262),this.m_message_box.setText("購入しますか。",LABEL_FONT_INDEX.FONT_261),this.m_message_box.addButtonInfo(new MessageButtonInfo("いいえ",MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_message_box.hide()}.bind(this))),this.m_message_box.addButtonInfo(new MessageButtonInfo("はい",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_start_jade_btn.setEnabled(!1),this.scheduleOnce(function(){this.reqBuyOpenDungeon()},.2,"showBuyOpenDungeon"),this.m_message_box.hide()}.bind(this))),this.m_message_box.show()},reqBuyOpenDungeon:function(){this.IsEnableDungeonOpenTime()?this.showNotBuyOpenDundeon():MainObserver.getInstance().postNotification(sceneStr[scene_WeeklyEntryScene],weekly_dungeon_open)},showNotBuyOpenDundeon:function(){this.m_message_box.is_show()&&this.m_message_box.hide(),this.m_message_box.setTitle("曜日無双購入"),this.m_message_box.setText("販売期間ではありません。"),this.m_message_box.setText("\n"),this.m_message_box.addButtonInfo(new MessageButtonInfo("はい",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(){this.updateRightInfo(),this.m_update_min_delta=UPDATE_INTERVAL_TIME},.2,"showNotBuyOpenDundeon"),this.m_message_box.hide()}.bind(this))),this.m_message_box.show()},checkTodayWeekDay:function(){var a=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME);return moment(a).days()},choiceWeeklyDay:function(a){this.m_choice_week_day=a;for(var i=0;i<this.m_weekly_btns.length;i++)this.m_weekly_btns[i].setEnabled(this.m_choice_week_day!=i);this.checkUserOpenDungeonTime()?this.getUpdateDungeonList():this.filterWeekDayDataList(this.m_choice_week_day),this.m_tableView.reloadData()},choiceDifficultyType:function(a){var b=this.getSelectedDungeon();if(-1==a){for(var c=!1,i=0;i<b.weekly_difficulty.length;i++){var d=b.weekly_difficulty[i];if(c)d.is_selected=!1;else{var e="y"==d.weekly_difficulty.two_times_yn?1:0,index=2*(d.weekly_difficulty.difficulty_type-1)+e;this.m_choice_difficulty_type=index,c=d.is_selected=!0}}for(i=0;i<this.m_difficulty_btns.length;i++)this.m_difficulty_btns[i].setEnabled(this.m_choice_difficulty_type!=i)}else{this.m_choice_difficulty_type=a;var f=parseInt(a/2+1),is_twice=0<a%2?"y":"n";for(i=0;i<this.m_difficulty_btns.length;i++)this.m_difficulty_btns[i].setEnabled(this.m_choice_difficulty_type!=i);for(var j=0;j<this.m_week_day_dungeon_list.length;j++){if((d=this.m_week_day_dungeon_list[j]).is_selected)for(var k=0;k<d.weekly_difficulty.length;k++)d.weekly_difficulty[k].weekly_difficulty.difficulty_type==f&&d.weekly_difficulty[k].weekly_difficulty.two_times_yn==is_twice?d.weekly_difficulty[k].is_selected=!0:d.weekly_difficulty[k].is_selected=!1}}},getUpdateDungeonList:function(){var a=this.getSelectedDungeon(),service=BattleService.getInstance();this.m_total_dungeon_list=[],service.getMasterWeeklyDungeon(this.m_total_dungeon_list),this.filterWeekDayDataList(this.m_choice_week_day);for(var i=0;i<this.m_week_day_dungeon_list.length;i++)this.m_week_day_dungeon_list[i].is_selected=this.m_week_day_dungeon_list[i].weekly_dungeon.weekly_idx==a.weekly_dungeon.weekly_idx},checkUserOpenDungeonTime:function(){if(0==this.m_week_day_dungeon_list.length)return!1;for(var a=this.getSelectedDungeon(),now=(this.getSelectedDifficulty(),TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)),n=moment(now).valueOf(),is_user_close_time=!1,idx=0;idx<this.m_week_day_dungeon_list.length;idx++){if(null==(a=this.m_week_day_dungeon_list[idx]).weekly_period)break;for(var b=0;b<a.weekly_period.length;b++){var c=a.weekly_period[b];if(null!=c){if(null==c.is_user_period)break;if(c.is_user_period)if(c.end_date.valueOf()<n){is_user_close_time=!0;break}}}}return is_user_close_time},filterWeekDayDataList:function(a){this.m_week_day_dungeon_list=[];for(var b=0;b<this.m_total_dungeon_list.length;b++)for(var c=0;c<this.m_total_dungeon_list[b].weekly_period.length;c++)if(this.m_total_dungeon_list[b].weekly_period[c].week_day==a+1||8==this.m_total_dungeon_list[b].weekly_period[c].week_day){this.m_total_dungeon_list[b].is_selected=!1,this.m_week_day_dungeon_list.push($.extend({},this.m_total_dungeon_list[b]));break}0<this.m_week_day_dungeon_list.length&&(this.m_week_day_dungeon_list[0].is_selected=!0)},tableCellSizeForIndex:function(a,b){return cc.size(130,140)},tableCellEnded:function(){},tableCellHighlight:function(){},tableCellUnhighlight:function(){return!1},scrollViewDidScroll:function(){},scrollViewDidZoom:function(){},tableCellTouched:function(a,b){AudioEngine.getInstance().playNormaButtonSound();for(var c=b.getIdx(),i=0;i<this.m_week_day_dungeon_list.length;i++)this.m_week_day_dungeon_list[i].is_selected=c==i;var d=a.getContentOffset();a.reloadData(),a.setContentOffset(d),this.m_choice_stage_count=c,this.choiceDifficultyType(-1),this.updateRightInfo(),this.m_update_min_delta=UPDATE_INTERVAL_TIME},updateRightInfo:function(){var f=this.getSelectedDungeon(),difficulty=this.getSelectedDifficulty(),winSize=ccSize(this),service=BattleService.getInstance(),frame1=(MasterTable.getInstance(),cc.spriteFrameCache.getSpriteFrame("img_vs_day_text_title_"+leadingZeros(f.weekly_dungeon.img_num,2)+".png"));this.m_dungeon_name.setSpriteFrame(frame1);for(var i=0;i<this.m_difficulty_btns.length;i++)this.m_difficulty_btns[i].setVisible(!1);var g=0,count_2x=0;for(i=0;i<f.weekly_difficulty.length;i++){var h=f.weekly_difficulty[i],diff=h.weekly_difficulty.difficulty_type,doubles="y"==h.weekly_difficulty.two_times_yn?1:0,index=2*(diff-1)+doubles;if(index<this.m_difficulty_btns.length)if(this.m_difficulty_btns[index].setVisible(!0),0==doubles){var l=19+g*ccWidth(this.m_difficulty_btns[index]);this.m_difficulty_btns[index].setPositionX(l),g++}else{l=19+count_2x*ccWidth(this.m_difficulty_btns[index]);this.m_difficulty_btns[index].setPositionX(l),count_2x++}}this.m_boss_container.isRunning()&&this.m_boss_container.stopAllActions();for(var m=0;m<this.m_npc_list.length;m++)this.m_npc_list[m].setVisible(!1);for(m=0;m<difficulty.stage_npc.at(difficulty.stage_count).length;m++){var n=MasterManager.getInstance().get_NpcGeneral(difficulty.stage_npc.at(difficulty.stage_count)[m].npc_id);if(difficulty.stage_npc.at(difficulty.stage_count)[m].is_zoom){var o=n.gnrl_group,found=-1;found=o<100?this.m_gnrl_img.indexOf(RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(o,2)+".png"):this.m_gnrl_img.indexOf(RES_CDN_DEFULT+"card_war_boss/"+o+".png");var q=!1;if(-1==found)o<100?this.m_gnrl_img.push(RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(o,2)+".png"):this.m_gnrl_img.push(RES_CDN_DEFULT+"card_war_boss/"+o+".png"),q=!0,cc.loader.load(this.m_gnrl_img,function(a,b){if(!a){var c="";c=o<100?RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(o,2)+".png":RES_CDN_DEFULT+"card_war_boss/"+o+".png";var d=cc.textureCache.getTextureForKey(c),frame1=new cc.SpriteFrame(d,cc.rect(0,0,d.getContentSize().width,d.getContentSize().height));this.m_boss_img.setScale(2),this.m_boss_img.setSpriteFrame(frame1),this.m_boss_container.setPosition(winSize.width+this.m_boss_img.width,0);var e=new cc.MoveTo(.2,cc.p(winSize.width,0));this.m_boss_container.runAction(e),q=!1}}.bind(this));else if(0==q){var r="";r=o<100?RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(o,2)+".png":RES_CDN_DEFULT+"card_war_boss/"+o+".png";var s=cc.textureCache.getTextureForKey(r);frame1=new cc.SpriteFrame(s,cc.rect(0,0,s.getContentSize().width,s.getContentSize().height));this.m_boss_img.setScale(2),this.m_boss_img.setSpriteFrame(frame1),this.m_boss_container.setPosition(winSize.width+this.m_boss_img.width,0);var t=new cc.MoveTo(.2,cc.p(winSize.width,0));this.m_boss_container.runAction(t)}}var p=difficulty.stage_npc.at(difficulty.stage_count)[m].position-1,npc_icon=this.m_npc_list[p];npc_icon.setVisible(!0),npc_icon.setNpcData(n,difficulty.stage_npc.at(difficulty.stage_count)[m].is_zoom),npc_icon.setGlobalZOrderTooltip(!0)}for(m=0;m<this.m_reward_list.length;m++)this.m_reward_list[m].setVisible(!1);var u=0,weekly_bonus=[];for(m=0;m<difficulty.weekly_bonus.length;m++){var b=difficulty.weekly_bonus[m];if(-1==(found=weekly_bonus.findIndex(function(a){return a.bonus_type==b.bonus_type})))weekly_bonus.push_back(b);else if(b.bonus_type==BONUS_TYPE_YUNHEE_FIX)weekly_bonus.push_back(b);else{var v=weekly_bonus[found].min_value+b.min_value;weekly_bonus[found].min_value=v}}for(m=0;m<weekly_bonus.length;m++){var w={};service.convertBonusInfo(weekly_bonus[m],w);var x=this.m_reward_list[u];x.setVisible(!0),x.setEnableItemCount(!1),x.setGainItem(w),u++}for(var y=0,j=0;j<difficulty.task_list.length;j++){difficulty.task_list[j].is_complete&&(y+=1)}for(var k=0;k<this.m_task_list.length;k++){var z=this.m_task_list[k];if(k<y){var A=RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_on.png",frame2_texture=cc.textureCache.addImage(A),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));z.setSpriteFrame(frame2)}else{A=RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_off.png",frame2_texture=cc.textureCache.addImage(A),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));z.setSpriteFrame(frame2)}}this.updateStartBtnInfo()},IsEnableDungeonOpenTime:function(){for(var a=this.getSelectedDungeon(),now=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)),is_enable=!1,idx=0;idx<a.weekly_period.length;idx++){var p=a.weekly_period[idx];if(p.week_day==this.m_choice_week_day+1||8==p.week_day){var n=now.valueOf(),b=moment(p.begin_date).valueOf(),e=moment(p.end_date).valueOf();if(e<n)continue;if(b-1e3*(p.is_user_period?5:1)<=n&&n<=e+1){is_enable=!0,this.m_jade_btn_open=!1;break}}}return is_enable},setWeeklyDungeonOpen:function(a){var b={};b.weekly_idx=a.weekly_idx,b.week_day=a.week_type,b.begin_date=moment(a.begin_time),b.end_date=moment(a.end_time),b.is_user_period=!0;for(var i=0;i<this.m_total_dungeon_list.length;i++){if(this.m_total_dungeon_list[i].weekly_idx==a.weekly_idx)-1!=(c=this.m_total_dungeon_list[i].weekly_period.findIndex(function(p){return p.weekly_idx==b.weekly_idx&&p.week_day==b.week_day&&p.is_user_period}))&&this.m_total_dungeon_list[i].weekly_period.splice(c,1),this.m_total_dungeon_list[i].weekly_period.unshift(b),this.m_total_dungeon_list[i].weekly_period.sort(function(l,r){return l.begin_date.valueOf()>r.begin_date.valueOf()?1:l.begin_date.valueOf()<r.begin_date.valueOf()?-1:0})}for(i=0;i<this.m_week_day_dungeon_list.length;i++){var c;if(this.m_week_day_dungeon_list[i].weekly_idx==a.weekly_idx)-1!=(c=this.m_week_day_dungeon_list[i].weekly_period.findIndex(function(p){return p.weekly_idx==b.weekly_idx&&p.week_day==b.week_day&&p.is_user_period}))&&this.m_week_day_dungeon_list[i].weekly_period.splice(c,1),this.m_week_day_dungeon_list[i].weekly_period.unshift(b),this.m_week_day_dungeon_list[i].weekly_period.sort(function(l,r){return l.begin_date.valueOf()>r.begin_date.valueOf()?1:l.begin_date.valueOf()<r.begin_date.valueOf()?-1:0})}var d=this.m_tableView.getContentOffset();this.m_tableView.reloadData(),this.m_tableView.setContentOffset(d),this.updateStartBtnInfo()},getSelectedDungeon:function(){for(var a=0;a<this.m_week_day_dungeon_list.length;a++)if(this.m_week_day_dungeon_list[a].is_selected)return this.m_week_day_dungeon_list[a];return this.m_week_day_dungeon_list[0]},updateStartBtnInfo:function(){var a=this.getSelectedDungeon();this.getSelectedDifficulty();if(this.IsEnableDungeonOpenTime()){this.m_jade_btn_open=!1,this.m_start_jade_btn.setEnabled(!0),this.m_start_key_btn.setVisible(!0),this.m_start_jade_btn.setVisible(!1);var b=this.checkWeeklyNeedKey();this.m_need_key.setString(b)}else{this.m_start_key_btn.setVisible(!1),1==this.m_jade_btn_open&&this.m_start_jade_btn.setEnabled(!1),this.m_start_jade_btn.setVisible(!0),this.m_need_jade.setString(a.weekly_dungeon.cost);var c=(a.weekly_dungeon.open_time/60).toFixed(0);this.m_start_jade_btn.setString("購入（"+c+"分）")}},checkWeeklyNeedKey:function(){var a=0,dungeon=this.getSelectedDungeon(),difficulty=this.getSelectedDifficulty(),is_expense_dec=!1,nn=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),list_Global_Booster_Event_V2=NetService().get_Global_Booster_Event();for(var c in list_Global_Booster_Event_V2){var b=list_Global_Booster_Event_V2[c],bt=moment(b.begin_dt),et=moment(b.end_dt),bb=bt.valueOf(),ee=et.valueOf();if(bb<=nn&&nn<=ee&&b.booster_type==BOOSTER_TYPE_V2_WEEKLY_DUNGEON&&b.variation_type==BOOSTER_VARIATION_TYPE_V2_EXPENSE_DEC&&b.item_type==BOOSTER_ITEM_TYPE_V2_ENTRANCE_TICKET){if(0==b.value_1){a=difficulty.weekly_difficulty.need_key-difficulty.weekly_difficulty.need_key*b.variation_value/100,is_expense_dec=!0;break}if(b.value_1==dungeon.weekly_idx){a=difficulty.weekly_difficulty.need_key-difficulty.weekly_difficulty.need_key*b.variation_value/100,is_expense_dec=!0;break}}}return is_expense_dec&&(a=Math.max(a,1)),0==a&&(a=difficulty.weekly_difficulty.need_key),a},tableCellAtIndex:function(a,b){var c=a.dequeueCell(),cell=null;(cell=null!=c?c:new WeeklyEntryListCell).unSelected();var d=this.m_week_day_dungeon_list[b];return cell.setData(this.m_choice_week_day+1,d),cell},numberOfCellsInTableView:function(a){return this.m_week_day_dungeon_list.length},getSelectedDifficulty:function(){for(var a=0;a<this.m_week_day_dungeon_list.length;a++)if(this.m_week_day_dungeon_list[a].is_selected)for(var b=0;b<this.m_week_day_dungeon_list[a].weekly_difficulty.length;b++)if(this.m_week_day_dungeon_list[a].weekly_difficulty[b].is_selected)return this.m_week_day_dungeon_list[a].weekly_difficulty[b];return this.m_week_day_dungeon_list[0].weekly_difficulty[0]},update:function(a){if(this.m_update_min_delta-=a,this.m_update_min_delta<0){this.m_update_min_delta=UPDATE_INTERVAL_TIME,this.checkUserOpenDungeonTime()&&(this.getUpdateDungeonList(),this.choiceDifficultyType(this.m_choice_difficulty_type),this.updateRightInfo());var b=this.m_tableView.getContentOffset();this.m_tableView.reloadData(),this.m_tableView.setContentOffset(b),this.updateStartBtnInfo()}},getChoiceWeekDay:function(){return this.m_choice_week_day},getChoiceDifficultyType:function(){return this.m_choice_difficulty_type},getChoiceStageCount:function(){return this.m_choice_stage_count},cellSizeForTable:function(a){return cc.size(130,140)},choiceStage:function(a){for(var b=a,diff=parseInt(this.m_choice_difficulty_type/2)+1,is_twice=0<this.m_choice_difficulty_type%2?"y":"n",index=0,i=0;i<this.m_week_day_dungeon_list.size();i++){if(this.m_week_day_dungeon_list.at(i).is_selected=b==index,this.m_week_day_dungeon_list.at(i).is_selected)for(var j=0;j<this.m_week_day_dungeon_list.at(i).weekly_difficulty.length;j++)this.m_week_day_dungeon_list.at(i).weekly_difficulty[j].weekly_difficulty.difficulty_type==diff&&this.m_week_day_dungeon_list.at(i).weekly_difficulty[j].weekly_difficulty.two_times_yn==is_twice?this.m_week_day_dungeon_list.at(i).weekly_difficulty[j].is_selected=!0:this.m_week_day_dungeon_list.at(i).weekly_difficulty[j].is_selected=!1;index++}this.m_tableView.reloadData();var c=this.m_tableView.getContentOffset(),cSize=this.m_tableView.getContainer().getContentSize(),tSize=this.m_tableView.getViewSize(),cellSize=this.cellSizeForTable(this.m_tableView),min_offset_y=tSize.height-cSize.height,cell_height=b*cellSize.height;c.y=min_offset_y+cell_height,c.y<min_offset_y?c.y=min_offset_y:0<c.y&&(c.y=0),this.m_tableView.setContentOffset(c)},showMissionTaskModalLayer:function(){this.m_mission_task_modal_layer._contentNode=function(a,m){var b=this.getSelectedDifficulty().task_list,layer=new MissionTaskPopup(b,eDungeonTaskType.weekly_dungeon);return layer._callback_close_popup=this.hideMissionTaskModalLayer.bind(this),layer}.bind(this),this.m_mission_task_modal_layer.is_show()||this.m_mission_task_modal_layer.show()},hideMissionTaskModalLayer:function(){this.m_mission_task_modal_layer.is_show()&&this.m_mission_task_modal_layer.hide()}}),WeeklyEntryListCell=cc.TableViewCell.extend({m_bg_box:null,m_select_box:null,m_highlight:null,m_remain_time:null,m_gauge_bg:null,m_gauge:null,m_dungeon_name:null,m_dungeon_open_comment:null,m_disable_dim_cover:null,m_disable_cover:null,m_week_day:0,ctor:function(){this._super(),this.init()},init:function(){var a=cc.size(476,140);return this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(a),this.m_bg_box=cc.Sprite.create("#img_vs_day_list_01.png"),this.m_bg_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_bg_box.setPosition(ZERO()),this.addChild(this.m_bg_box),this.m_dungeon_name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2615),this.m_dungeon_name.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_dungeon_name.setPosition(a.width-10,30),this.m_bg_box.addChild(this.m_dungeon_name),this.m_dungeon_open_comment=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.m_dungeon_open_comment.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_dungeon_open_comment.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM),this.m_dungeon_open_comment.setPosition(a.width-10,59),this.m_bg_box.addChild(this.m_dungeon_open_comment),this.m_gauge_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",cc.rect(4,4,4,4)),this.m_gauge_bg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_gauge_bg.setPosition(.5*a.width,5),this.m_gauge_bg.setContentSize(a.width-8,16),this.m_bg_box.addChild(this.m_gauge_bg),this.m_gauge=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green.png",RectZero()),this.m_gauge.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_gauge.setPosition(3,ccCenter(this.m_gauge_bg).y),this.m_gauge_bg.addChild(this.m_gauge),this.m_remain_time=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161,!1),this.m_remain_time.setAnchorPoint(ANCHOR_MIDDLE()),this.m_remain_time.setPosition(ccCenter(this.m_gauge_bg)),this.m_remain_time.enableOutline(cc.color.BLACK,1),this.m_gauge_bg.addChild(this.m_remain_time),this.m_disable_dim_cover=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero()),this.m_disable_dim_cover.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_disable_dim_cover.setPosition(ZERO()),this.m_disable_dim_cover.setPreferredSize(a),this.addChild(this.m_disable_dim_cover),this.m_disable_dim_cover.setVisible(!1),this.m_disable_cover=cc.Sprite.create(RES_CDN_DEFULT+"common/img_list_lock.png"),this.m_disable_cover.setAnchorPoint(ANCHOR_MIDDLE()),this.m_disable_cover.setPosition(ccCenter(this.m_disable_dim_cover)),this.m_disable_dim_cover.addChild(this.m_disable_cover),this.m_highlight=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_1.png",cc.Rect(20,20,20,20)),this.m_highlight.setAnchorPoint(ANCHOR_MIDDLE()),this.m_highlight.setPosition(ccCenter(a)),this.m_highlight.setPreferredSize(a),this.m_highlight.setVisible(!1),this.addChild(this.m_highlight),this.m_select_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_2.png",cc.Rect(20,20,20,20)),this.m_select_box.setAnchorPoint(ANCHOR_MIDDLE()),this.m_select_box.setPosition(ccCenter(a)),this.m_select_box.setPreferredSize(a),this.m_select_box.setVisible(!1),this.addChild(this.m_select_box),!0},unSelected:function(){this.m_select_box.setVisible(!1),this.m_highlight.setVisible(!1)},selectedAnimation:function(){this.m_select_box.isRunning()&&this.m_select_box.stopAllActions();var a=new cc.FadeOut(1),fadein=new cc.FadeIn(1),seq=new cc.Sequence(a,fadein),repeat=new cc.RepeatForever(seq);this.m_select_box.runAction(repeat)},updateCell:function(){var a=cc.spriteFrameCache.getSpriteFrame("img_vs_day_list_"+leadingZeros(this.m_data.weekly_dungeon.img_num,2)+".png");this.m_bg_box.setSpriteFrame(a),this.m_dungeon_name.setString(this.m_data.weekly_dungeon.name);for(var c="",count=0,i=0;i<this.m_data.weekly_period.length;i++){null!=(p=this.m_data.weekly_period[i])&&(p.week_day!=this.m_week_day&&8!=p.week_day||(0<count&&(c+="\n"),c+="["+leadingZeros(moment(p.begin_date).get("hour"),2)+":"+leadingZeros(moment(p.begin_date).get("minute"),2)+"~"+leadingZeros(moment(p.end_date).get("hour"),2)+":"+leadingZeros(moment(p.end_date).get("minute"),2)+"]",count++))}this.m_dungeon_open_comment.setString(c),this.m_select_box.setVisible(this.m_data.is_selected),this.m_data.is_selected&&this.selectedAnimation(),this.m_highlight.setVisible(this.m_data.is_selected),this.m_remain_time.setString(""),this.m_data.is_enable=!1;for(var f=this.m_data.weekly_period.length-1;0<=f;f--){var p;if(null!=(p=this.m_data.weekly_period[f])&&(p.week_day==this.m_week_day||8==p.week_day)){var n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),b=p.begin_date.valueOf(),e=p.end_date.valueOf(),is_next_week=!1;if(e<n&&(b+=6048e5,e+=6048e5,is_next_week=!0),p.is_user_period,b-1e3*(p.is_user_period?5:1)<=n){if(n<=e+1){this.m_data.is_enable=!0;var g=e-n;0<(d=moment.duration(g)).days()?this.m_remain_time.setString("残り    "+leadingZeros(d.days(),2)+"日 "+leadingZeros(d.hours(),2)+":"+leadingZeros(d.minutes(),2)):0<d.hours()||0<d.minutes()?this.m_remain_time.setString("残り    "+leadingZeros(d.hours(),2)+":"+leadingZeros(d.minutes(),2)):this.m_remain_time.setString("残り    "+leadingZeros(d.seconds(),2)+"秒");var h=1-(n-b)/(e-b),gauge_size=ccSize(this.m_gauge_bg);this.m_gauge.setVisible(!0),this.m_gauge.setPreferredSize(cc.size((gauge_size.width-6)*h,10));break}}else{this.m_data.is_enable=!1;var d;g=b-n;if(0<(d=moment.duration(g)).days()?this.m_remain_time.setString("あと    "+leadingZeros(d.days(),2)+"日 "+leadingZeros(d.hours(),2)+":"+leadingZeros(d.minutes(),2)+"  後オープン"):0<d.hours()||0<d.minutes()?this.m_remain_time.setString("あと    "+leadingZeros(d.hours(),2)+":"+leadingZeros(d.minutes(),2)+"  後オープン"):this.m_remain_time.setString("残り    "+leadingZeros(d.seconds(),2)+"秒後オープン"),this.m_gauge.setVisible(!1),!is_next_week)continue}}}this.m_disable_dim_cover.setVisible(!this.m_data.is_enable)},setData:function(a,b){this.m_data=b,this.m_week_day=a,this.updateCell()}}),PREV_MISSION=(weekly_dungeon_begin=89100,!1),PREV_ACHIVE_WEEKLY=!1,PREV_HELP_WEEKLY=!1,WeeklyEntryScene=GameScene.extend({m_deferred:$.Deferred(),m_resource:[],ctor:function(){this._super(scene_WeeklyEntryScene),PREV_HELP_WEEKLY=PREV_ACHIVE_WEEKLY=!1},get_story_deferred:function(){return this.m_deferred},init:function(){this.m_gameObserver=MainObserver.getInstance(),this.m_resource=[],this.m_resource.push(RES_CDN_DEFULT+"menu_vs/"+MENU_VS_WEEKLY_ENTER_TEXTURE+".plist"),this.m_resource.push(RES_CDN_DEFULT+"menu_vs/"+MENU_VS_WEEKLY_ENTER_TEXTURE+".png"),this.m_resource.push(RES_CDN_DEFULT+"common/bg_sub.png"),this.m_resource.push(RES_CDN_DEFULT+"common/img_circle.png"),this.m_resource.push(RES_CDN_DEFULT+"common/img_line.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_on.png"),USE_SP_WEEKLY_SCALE?(this.m_resource.push(RES_CDN_DEFULT+"menu_vs/menu_vs_day_list_sp.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_vs/menu_vs_day_list_sp.plist")):(this.m_resource.push(RES_CDN_DEFULT+"menu_vs/menu_vs_day_list.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_vs/menu_vs_day_list.plist")),resourceLoader(this.m_resource,function(){cc.spriteFrameCache.addSpriteFrames(RES_CDN_DEFULT+"menu_vs/"+MENU_VS_WEEKLY_ENTER_TEXTURE+".plist"),USE_SP_WEEKLY_SCALE?cc.spriteFrameCache.addSpriteFrames(RES_CDN_DEFULT+"menu_vs/menu_vs_day_list_sp.plist"):cc.spriteFrameCache.addSpriteFrames(RES_CDN_DEFULT+"menu_vs/menu_vs_day_list.plist");var a=ccSize(this);this.m_entry_layer=new WeeklyEntryLayer(this.m_deferred,GameContext.getInstance().getChoiceWeekDayIdx(),GameContext.getInstance().getChoiceDifficultyType(),GameContext.getInstance().getChoiceStageCount()),this.m_entry_layer.setPosition(ccCenter(a)),this.addChild(this.m_entry_layer);var b=new StatusLayer(INVOKER_TYPE.normal);b.ignoreAnchorPointForPosition(!1),b.setAnchorPoint(ANCHOR_TOP_RIGHT()),b.setPosition(ccWidth(this),ccHeight(this)),this.addChild(b);var c=cc.Sprite.create(RES_CDN_DEFULT+"menu_vs/img_vs_text_day.png");c.setAnchorPoint(cc.p(0,0)),c.setPosition(cc.p(90,585)),this.addChild(c);var d=new ccui.Button;return d.loadTextures("btn_home_off.png","btn_home_on.png","",ccui.Widget.PLIST_TEXTURE),d.setAnchorPoint(cc.p(0,0)),d.setPosition(cc.p(10,559)),d.addClickEventListener(function(){this.back()}.bind(this)),this.addChild(d),!0}.bind(this))},back:function(){1==YUNHEE_PREV_SCENE?this.onKeyBack3():this.onKeyBack(!0,!1)},onNotification:function(c){switch(this._super(c),c){case weekly_dungeon_show_help_v2:GameContext.getInstance().setHelpInfoIndexByCallIndex(1);var d=new HelpContentScene;SceneManager.getInstance().pushScene(d),PREV_HELP_WEEKLY=!(d=null);break;case weekly_dungeon_open:(e={}).opcode=net.OP.op_get_server_time_check,this.network_write(e),this.scheduleOnce(function(a){this.reqWeeklyDungeonOpen()}.bind(this),.1,"weekly_Open");break;case jade_lack:this.showNotEnoughJade(!0);break;case weekly_dungeon_begin:var e;this.initLayoutProgress_weekly(),(e={}).opcode=net.OP.op_get_server_time_check,this.network_write(e),this.scheduleOnce(function(a){GameContext.getInstance().setChoiceWeekDayInfo(this.m_entry_layer.getChoiceWeekDay(),this.m_entry_layer.getChoiceDifficultyType(),this.m_entry_layer.getChoiceStageCount());var b=new FriendSelectScene;SceneManager.getInstance().replaceScene(b),this.removeLayerProgress_weekly(),b=null}.bind(this),.1,"weekly_begin")}return!0},onNetworkEvent:function(b,c,d){if(this._super(b,c,d),b==net.OP.op_weekly_dungeon_open&&(this.removeLayerProgress_weekly(),d.error==net.ERROR.NET_E_LACK_JADE?(this.m_entry_layer.m_jade_btn_open=!1,this.showNotEnoughJade()):this.scheduleOnce(function(a){this.m_entry_layer.setWeeklyDungeonOpen(d)},.1,"dungeon_refresh")),b==net.OP.op_mission_battle_friend_list){BattleContext._getInstance().setFriendList(d.frnd_list);var e=new FriendSelectScene;SceneManager.getInstance().replaceScene(e),e=null}},reqWeeklyDungeonOpen:function(){this.initLayoutProgress_weekly();var a=this.m_entry_layer.getWeeklyDungeonOpenInfo(0,0,0),register={};register.opcode=net.OP.op_weekly_dungeon_open,register.weekly_idx=a.idx,register.week_type=a.type,register.open_time=a.time,this.network_write(register)},onExit:function(){this._super(),1!=PREV_MISSION&&(1!=WEEKLY_DUNGEON_NOW?1!=PREV_ACHIVE_WEEKLY&&1!=PREV_HELP_WEEKLY&&(this.m_gameObserver.removeObserver(sceneStr[scene_WeeklyEntryScene]),cc.spriteFrameCache.removeSpriteFramesFromFile(RES_CDN_DEFULT+"menu_vs/"+MENU_VS_WEEKLY_ENTER_TEXTURE+".plist"),delete cc.spriteFrameCache._frameConfigCache[RES_CDN_DEFULT+"menu_vs/"+MENU_VS_WEEKLY_ENTER_TEXTURE+".plist"],USE_SP_WEEKLY_SCALE?(cc.spriteFrameCache.removeSpriteFramesFromFile(RES_CDN_DEFULT+"menu_vs/menu_vs_day_list_sp.plist"),delete cc.spriteFrameCache._frameConfigCache[RES_CDN_DEFULT+"menu_vs/menu_vs_day_list_sp.plist"]):(cc.spriteFrameCache.removeSpriteFramesFromFile(RES_CDN_DEFULT+"menu_vs/menu_vs_day_list.plist"),delete cc.spriteFrameCache._frameConfigCache[RES_CDN_DEFULT+"menu_vs/menu_vs_day_list.plist"]),null!=this.m_resource&&(this.m_resource.forEach(function(a){cc.loader.release(a)}),this.m_resource=null)):WEEKLY_DUNGEON_NOW=!1)},onEnter:function(){this._super(),this.playMainBGM(),this.m_gameObserver.addObserver(this.onNotification,this,sceneStr[scene_WeeklyEntryScene]),PREV_HELP_WEEKLY=PREV_ACHIVE_WEEKLY=!1}}),WeeklyTaskNode=cc.Node.extend({m_task:null,ctor:function(a){this._super(),this.m_task=a,this.init()},init:function(){return this.setContentSize(444,78),this.createTask(),!0},createTask:function(){var a=ccSize(this),box=new cc.Scale9Sprite(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",cc.Rect(16,16,16,16));box.setPosition(ZERO()),box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box.setPreferredSize(a),this.addChild(box);var b=cmLabel.getLabel(this.m_task.task_define.name,LABEL_FONT_INDEX.FONT_2013);b.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),b.setPosition(58,43),this.addChild(b);var c="";if(this.m_task.task_define.task_type==TaskActionType.Mission_Clear_Count){var d=this.m_task.clear_count;d>this.m_task.task_define.value1&&(d=this.m_task.task_define.value1),c=cmString(res_str("label_battle_task_content_win_count"),this.m_task.task_define.content,d,this.m_task.task_define.value1)}else c=this.m_task.task_define.content;var e=cmLabel.getLabel(c,LABEL_FONT_INDEX.FONT_161);e.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),e.setPosition(58,16),this.addChild(e);var f=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");f.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),f.setPosition(a.width-4,.5*a.height),this.addChild(f);var g="";if(this.m_task.task.bonus_type==BONUS_TYPE_LOVE_ITEM)g="#img_reward_love_item_"+leadingZeros(this.m_task.min_value,2)+".png";else if(this.m_task.task.bonus_type==BONUS_TYPE_YUNHEE_FIX||this.m_task.task.bonus_type==BONUS_TYPE_JIN_FIX){var h=MasterManager.getInstance().get_General(this.m_task.task.min_value);g=h.gnrl_type==GENERAL_TYPE_MATERIAL||h.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL?"#"+h.bone_id+".png":"#"+h.gnrl_id+".png"}else g=this.m_task.task.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||this.m_task.task.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT?"#img_reward_yh.png":"#img_reward_"+leadingZeros(this.m_task.task.bonus_type,2)+".png";if(""!=g){var i=cc.Sprite.create(g);i.setAnchorPoint(ANCHOR_MIDDLE()),i.setPosition(ccCenter(f)),f.addChild(i);var j=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_valuebox.png");j.setAnchorPoint(ANCHOR_MIDDLE()),j.setPosition(.5*ccWidth(i),2),i.addChild(j);var k=0;k=this.m_task.task.bonus_type==BONUS_TYPE_LOVE_ITEM?1:this.m_task.task.bonus_type==BONUS_TYPE_YUNHEE_FIX||this.m_task.task.bonus_type==BONUS_TYPE_JIN_FIX?1:this.m_task.task.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||this.m_task.task.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT?1:this.m_task.task.min_value;var l=cmLabel.getLabel("x"+Number(k).toLocaleString("en"),LABEL_FONT_INDEX.FONT_143);l.setAnchorPoint(ANCHOR_MIDDLE()),l.setPosition(ccCenter(j)),j.addChild(l)}if(this.m_task.is_complete){var m=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",cc.Rect(1,1,1,1));m.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),m.setPosition(ZERO()),m.setPreferredSize(a),this.addChild(m),(o=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_on.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),o.setPosition(14,39),this.addChild(o);var n=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_complete.png");n.setAnchorPoint(ANCHOR_MIDDLE()),n.setPosition(ccCenter(a)),this.addChild(n)}else{var o;(o=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_off.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),o.setPosition(14,39),this.addChild(o)}}}),FriendListCell=cc.TableViewCell.extend({m_box:null,m_select_cover:null,m_join_btn:null,m_release_btn:null,m_is_join:!1,m_gnrl_icon:null,m_frnd_name:null,m_heart_count_label:null,m_gnrl_name:null,m_namingLabel:null,_callback_choice_friend:null,m_helper_type_icon:null,m_heart_icon:null,m_release_sprite:[],m_join_sprite:[],m_game_type:null,m_event_dungeon:null,m_buff_frame:null,m_bg_box:null,m_buff_sprite:null,m_icon_touch:null,reward_effect_label_0:null,reward_effect_label_1:null,reward_effect_label_2:null,reward_effect_label_3:null,reward_effect_label_4:null,m_reward_effect_label_0:null,m_reward_effect_label_1:null,m_reward_effect_label_2:null,m_reward_effect_label_3:null,m_reward_effect_label_4:null,m_reward_effect_label_5:null,m_ablility_effect_label:null,ctor:function(){this._super(),this.m_box=null,this.m_join_btn=null,this.m_release_btn=null,this.m_is_join=null,this._callback_choice_friend=null,this.m_release_sprite=[],this.m_join_sprite=[],this.m_game_type=db.BattleGameType.Mission,this.m_buff_frame=null,this.m_bg_box=null,this.m_buff_sprite=null,this.init()},init:function(){var a,nor_label,on,on_label,cellSize=cc.size(444,124);this.setContentSize(cellSize),this.m_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero()),this.m_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_box.setPosition(ZERO()),this.m_box.setContentSize(cellSize),this.addChild(this.m_box),this.m_frnd_name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812),this.m_frnd_name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_frnd_name.setPosition(221,89),this.m_box.addChild(this.m_frnd_name),this.m_helper_type_icon=cc.Sprite.create(),this.m_helper_type_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_helper_type_icon.setPosition(115,88),this.m_box.addChild(this.m_helper_type_icon),this.m_heart_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_heart_small.png"),this.m_heart_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_heart_icon.setPosition(119,61),this.m_box.addChild(this.m_heart_icon),this.m_heart_count_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2011),this.m_heart_count_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_heart_count_label.setPosition(147,62),this.m_box.addChild(this.m_heart_count_label),this.m_gnrl_name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2011),this.m_gnrl_name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_gnrl_name.setPosition(119,39),this.m_box.addChild(this.m_gnrl_name),this.m_namingLabel=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2011),this.m_namingLabel.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_namingLabel.setPosition(119,16),this.m_box.addChild(this.m_namingLabel),(a=cc.Sprite.create("#btn_05_off.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),a.setPosition(cellSize.width-13,.5*cellSize.height),(nor_label=cmLabel.getLabel("同行する",LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_MIDDLE()),nor_label.setPosition(ccCenter(a)),a.addChild(nor_label),this.m_box.addChild(a),this.m_join_sprite.push(a),(on=new cc.Sprite("#btn_05_on.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),on.setPosition(cellSize.width-13,.5*cellSize.height),(on_label=cmLabel.getLabel("同行する",LABEL_FONT_INDEX.FONT_242)).setAnchorPoint(ANCHOR_MIDDLE()),on_label.setPosition(ccCenter(on)),on.addChild(on_label),this.m_box.addChild(on),on.setVisible(!1),this.m_join_sprite.push(on),(a=cc.Sprite.create("#btn_04_off.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),a.setPosition(cellSize.width-13,.5*cellSize.height),(nor_label=cmLabel.getLabel("解除する",LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_MIDDLE()),nor_label.setPosition(ccCenter(a)),a.addChild(nor_label),this.m_box.addChild(a),this.m_release_sprite.push(a),a.setVisible(!1),(on=cc.Sprite.create("#btn_04_on.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),on.setPosition(cellSize.width-13,.5*cellSize.height),(on_label=cmLabel.getLabel("解除する",LABEL_FONT_INDEX.FONT_242)).setAnchorPoint(ANCHOR_MIDDLE()),on_label.setPosition(ccCenter(on)),on.addChild(on_label),this.m_box.addChild(on),this.m_release_sprite.push(on),on.setVisible(!1),this.m_select_cover=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_2.png",RectZero()),this.m_select_cover.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_select_cover.setPosition(ZERO()),this.m_select_cover.setPreferredSize(cellSize),this.addChild(this.m_select_cover),this.m_select_cover.setVisible(!1);var b=new cc.FadeIn(1),fadeOut=new cc.FadeOut(1),seq=new cc.Sequence(b,fadeOut),repeat=new cc.RepeatForever(seq);return this.m_select_cover.runAction(repeat),!0},setGameType:function(a){this.m_game_type=a},setEventDungeon:function(a){this.m_event_dungeon=a},setFriendData:function(a,b){this.m_is_join=b,this.m_frnd_data=a,this.updateCellLayout()},updateCellLayout:function(){var m=MasterManager.getInstance(),mt=MasterTable.getInstance(),gnrl_buffs=[],gnrl_buffs_check_period=[],gnrl_reward_buffs=[],gnrl_reward_buffs_period=[],dungeon_list=[],dungeon_ids=[];null!=this.m_gnrl_icon&&this.m_gnrl_icon.removeFromParent(),null!=this.m_bg_box&&(this.m_bg_box.removeAllChildren(),this.removeChild(this.m_bg_box),this.m_bg_box=null),this.m_bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",cc.Rect(20,20,20,20)),this.m_bg_box.setContentSize(200,0),this.m_bg_box.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_bg_box.setPosition(120,this.m_box.getContentSize().height),this.addChild(this.m_bg_box),this.m_bg_box.setVisible(!1),this.reward_effect_label_0=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2028),this.reward_effect_label_0.setAnchorPoint(ZERO()),this.m_bg_box.addChild(this.reward_effect_label_0),this.reward_effect_label_1=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2028),this.reward_effect_label_1.setAnchorPoint(ZERO()),this.m_bg_box.addChild(this.reward_effect_label_1),this.reward_effect_label_2=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2028),this.reward_effect_label_2.setAnchorPoint(ZERO()),this.m_bg_box.addChild(this.reward_effect_label_2),this.reward_effect_label_3=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2028),this.reward_effect_label_3.setAnchorPoint(ZERO()),this.m_bg_box.addChild(this.reward_effect_label_3),this.reward_effect_label_4=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2011),this.reward_effect_label_4.setAnchorPoint(ZERO()),this.m_bg_box.addChild(this.reward_effect_label_4),this.m_reward_effect_label_0=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2028),this.m_reward_effect_label_0.setAnchorPoint(ZERO()),this.m_reward_effect_label_0.setTag(99),this.m_bg_box.addChild(this.m_reward_effect_label_0),this.m_reward_effect_label_1=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2028),this.m_reward_effect_label_1.setAnchorPoint(ZERO()),this.m_reward_effect_label_1.setTag(99),this.m_bg_box.addChild(this.m_reward_effect_label_1),this.m_reward_effect_label_2=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2028),this.m_reward_effect_label_2.setAnchorPoint(ZERO()),this.m_reward_effect_label_2.setTag(99),this.m_bg_box.addChild(this.m_reward_effect_label_2),this.m_reward_effect_label_3=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2028),this.m_reward_effect_label_3.setAnchorPoint(ZERO()),this.m_reward_effect_label_3.setTag(99),this.m_bg_box.addChild(this.m_reward_effect_label_3),this.m_reward_effect_label_4=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2028),this.m_reward_effect_label_4.setAnchorPoint(ZERO()),this.m_reward_effect_label_4.setTag(99),this.m_bg_box.addChild(this.m_reward_effect_label_4),this.m_reward_effect_label_5=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2028),this.m_reward_effect_label_5.setAnchorPoint(ZERO()),this.m_reward_effect_label_5.setTag(99),this.m_bg_box.addChild(this.m_reward_effect_label_5),this.m_ablility_effect_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2011),this.m_ablility_effect_label.setAnchorPoint(ZERO()),this.m_ablility_effect_label.setTag(99),this.m_bg_box.addChild(this.m_ablility_effect_label);var a={},g=m.get_General(this.m_frnd_data.partner_gnrl_id);if(this.convertCardInfo(g,a),this.m_gnrl_icon=(new Card).createCard(a,CARD_TYPE.type_common_card),this.m_gnrl_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_gnrl_icon.setPosition(12,13),this.m_box.addChild(this.m_gnrl_icon),this.m_frnd_name.setString(this.m_frnd_data.nickname),this.m_frnd_data.helper_type==HELPTER_TYPE_FRIEND){var b=m.get_GoodsFunction(GOODS_FUNCTION_BRING_FRND);this.m_heart_count_label.setString(b.value),this.m_helper_type_icon.setTexture(RES_CDN_DEFULT+"menu_friend/img_friend_text_2.png"),this.m_heart_icon.setVisible(!0)}else this.m_heart_count_label.setString(""),this.m_helper_type_icon.setTexture(RES_CDN_DEFULT+"menu_friend/img_friend_text_1.png"),this.m_heart_icon.setVisible(!1);if(this.m_gnrl_name.setString(g.name),cmLabel.autoSizeFit(this.m_gnrl_name,200,20),null!=this.m_namingLabel&&(null!=this.m_frnd_data.naming&&null!=this.m_frnd_data.naming?this.m_namingLabel.setString(this.m_frnd_data.naming):this.m_namingLabel.setString("")),this.m_is_join?(this.m_release_sprite[0].setVisible(!0),this.m_release_sprite[1].setVisible(!1),this.m_join_sprite[0].setVisible(!1),this.m_join_sprite[1].setVisible(!1)):(this.m_join_sprite[0].setVisible(!0),this.m_join_sprite[1].setVisible(!1),this.m_release_sprite[0].setVisible(!1),this.m_release_sprite[1].setVisible(!1)),this.m_select_cover.setVisible(this.m_is_join),USE_FRIEND_SPEICAL_EFFECT&&this.m_game_type==db.BattleGameType.EventDungeon){dungeon_list=mt.get_EventDungeonList(this.m_event_dungeon.event_dungeon_period.event_dungeon_period_idx);dungeon_ids=[];for(var i=0;i<dungeon_list.length;i++)dungeon_ids.push(dungeon_list[i].event_dungeon_idx);this.m_buff_sprite=cc.Sprite.create(),this.m_buff_sprite.setAnchorPoint(ANCHOR_MIDDLE()),this.m_buff_sprite.setPosition(cc.p(this.m_gnrl_icon.width/2,this.m_gnrl_icon.height/2)),this.m_gnrl_icon.addChild(this.m_buff_sprite),this.m_buff_sprite.setVisible(!1);var c=MainAnimation.getInstance().getAnimation(MAIN_ANI_TYPE.CardSpecialEff);if(NOT_USE_SP_MAIN_ANIMATION){this.m_buff_sprite.setScale(2),this.m_buff_sprite.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_card_special_07.png");var d=new cc.FadeOut(.7),fadeOut=new cc.FadeIn(.7,90);f=new cc.Sequence(d,fadeOut),repeat=new cc.RepeatForever(f);this.m_buff_sprite.runAction(repeat),repeat=f=fadeOut=d=null}else try{var f=new cc.Sequence(c,new cc.DelayTime(.1)),repeat=new cc.RepeatForever(f);this.m_buff_sprite.runAction(repeat)}catch(e){}}if(this.m_game_type==db.BattleGameType.EventDungeon){gnrl_buffs_check_period=mt.get_EventDungeonGeneralBuf(g.gnrl_group,dungeon_ids);for(i=0;i<gnrl_buffs_check_period.length;i++)EventDungeonService.getInstance().IsOpenEventDungeonBuff(gnrl_buffs_check_period[i].buff_period_idx)&&gnrl_buffs.push(gnrl_buffs_check_period[i]);gnrl_reward_buffs_period=mt.get_DungeonRewardBufGeneral(g.gnrl_group,dungeon_ids);for(i=0;i<gnrl_reward_buffs_period.length;i++)EventDungeonService.getInstance().IsOpenEventDungeonBuff(gnrl_reward_buffs_period[i].buff_period_idx)&&gnrl_reward_buffs.push(gnrl_reward_buffs_period[i])}if(0<gnrl_buffs.length||0<gnrl_reward_buffs.length){var h=!1;for(i=0;i<gnrl_buffs.length;i++)gnrl_buffs[i].dungeon_idx==this.m_event_dungeon.event_dungeon_idx&&(h=!0);for(i=0;i<gnrl_reward_buffs.length;i++)gnrl_reward_buffs[i].dungeon_idx==this.m_event_dungeon.event_dungeon_idx&&(h=!0);USE_FRIEND_SPEICAL_EFFECT&&null!=this.m_buff_sprite&&this.m_buff_sprite.setVisible(h)}var k={event_idx:0,dungeon_type:0,dungeon_idx:0,gnrl_group:0,buff_type:0,buff_value:0,trans_type:0,trans_resist_value:0,onoff:"n",special_buf_idx:0,buff_period_idx:0},gnrl_buff_stat=[];for(i=0;i<6;i++)gnrl_buff_stat.push($.extend({},k));for(var j=0;j<gnrl_buffs.length;j++)this.m_event_dungeon.event_dungeon_idx==gnrl_buffs[j].dungeon_idx&&(gnrl_buff_stat[gnrl_buffs[j].buff_type-1]=$.extend({},gnrl_buffs[j]));var l=-10;if(0<gnrl_reward_buffs.length){for(i=0;i<gnrl_reward_buffs.length;i++)if(1==this.m_event_dungeon.event_dungeon.event_dungeon_type&&gnrl_reward_buffs[i].dungeon_idx==this.m_event_dungeon.event_dungeon_idx)switch(g.rare_type){case 5:this.reward_effect_label_0.setPosition(10,0-l),this.reward_effect_label_0.setString(cmString("%s",res_str("friend_dungeon_reward_buff_rinrin"))),l-=30;break;case 6:this.reward_effect_label_1.setPosition(10,0-l),this.reward_effect_label_1.setString(cmString("%s",res_str("friend_dungeon_reward_buff_rinrin"))),l-=30}else if(1!=gnrl_reward_buffs[i].dungeon_type&&gnrl_reward_buffs[i].dungeon_idx==this.m_event_dungeon.event_dungeon_idx)switch(g.rare_type){case 5:this.reward_effect_label_2.setPosition(10,0-l),this.reward_effect_label_2.setString(cmString("%s",res_str("friend_dungeon_reward_buff_sr"))),l-=30;break;case 6:this.reward_effect_label_3.setPosition(10,0-l),this.reward_effect_label_3.setString(cmString("%s",res_str("friend_dungeon_reward_buff_ssr"))),l-=30}this.reward_effect_label_4.setPosition(10,0-l),this.reward_effect_label_4.setString(cmString("%s",res_str("friend_dungeon_reward_buff_text"))),l-=30}if(0<gnrl_buffs.length){for(var n=5;0<=n;n--){var o=!1,reward_effect_label="",buff=gnrl_buff_stat[n];if(0!=buff.buff_value&&buff.dungeon_idx==this.m_event_dungeon.event_dungeon_idx)switch(buff.buff_type){case COMBO_STAT_ATTK_PLUS:reward_effect_label=cmString(res_str("friend_dungeon_battle_buff_attack"),Math.floor(buff.buff_value/1e4)),o=!0;break;case COMBO_STAT_ATTK:reward_effect_label=cmString(res_str("friend_dungeon_battle_buff_attack"),Math.floor(buff.buff_value+1e4)/1e4),o=!0;break;case COMBO_STAT_DEF_PLUS:reward_effect_label=cmString(res_str("friend_dungeon_battle_buff_defence"),Math.floor(buff.buff_value/1e4)),o=!0;break;case COMBO_STAT_DEF:reward_effect_label=cmString(res_str("friend_dungeon_battle_buff_defence"),Math.floor(buff.buff_value+1e4)/1e4),o=!0;break;case COMBO_STAT_HP_PLUS:reward_effect_label=cmString(res_str("friend_dungeon_battle_buff_health"),Math.floor(buff.buff_value/1e4)),o=!0;break;case COMBO_STAT_HP:reward_effect_label=cmString(res_str("friend_dungeon_battle_buff_health"),Math.floor(buff.buff_value+1e4)/1e4),o=!0}o&&(5==n?(this.m_reward_effect_label_5.setPosition(10,0-l),this.m_reward_effect_label_5.setString(reward_effect_label)):4==n?(this.m_reward_effect_label_4.setPosition(10,0-l),this.m_reward_effect_label_4.setString(reward_effect_label)):3==n?(this.m_reward_effect_label_3.setPosition(10,0-l),this.m_reward_effect_label_3.setString(reward_effect_label)):2==n?(this.m_reward_effect_label_2.setPosition(10,0-l),this.m_reward_effect_label_2.setString(reward_effect_label)):1==n?(this.m_reward_effect_label_1.setPosition(10,0-l),this.m_reward_effect_label_1.setString(reward_effect_label)):0==n&&(this.m_reward_effect_label_0.setPosition(10,0-l),this.m_reward_effect_label_0.setString(reward_effect_label)),l-=30)}this.m_ablility_effect_label.setPosition(10,0-l),this.m_ablility_effect_label.setString(cmString("%s",res_str("friend_dungeon_battle_buff_text"))),l-=30}this.m_bg_box.setContentSize(200,0-l)},convertCardInfo:function(g,a){a.gnrl_id=this.m_frnd_data.partner_gnrl_id,a.level=this.m_frnd_data.partner_gnrl_lv,a.limit_step_id=this.m_frnd_data.partner_gnrl_limit_step_id},highlightPosInCell:function(a){var r=this.m_join_sprite[0].getBoundingBox();if(cc.rectContainsPoint(r,a)&&(this.m_is_join?(this.m_release_sprite[0].setVisible(!1),this.m_release_sprite[1].setVisible(!0)):(this.m_join_sprite[0].setVisible(!1),this.m_join_sprite[1].setVisible(!0))),USE_FRIEND_SPEICAL_EFFECT){r=this.m_gnrl_icon.getBoundingBox();cc.rectContainsPoint(r,a)&&null!=this.m_buff_sprite&&this.m_buff_sprite.isVisible()&&this.m_bg_box.setVisible(!0)}},unhighlightPosInCell:function(a){var r=this.m_join_sprite[0].getBoundingBox();if(cc.rectContainsPoint(r,a)&&(this.m_is_join?(this.m_release_sprite[0].setVisible(!0),this.m_release_sprite[1].setVisible(!1)):(this.m_join_sprite[0].setVisible(!0),this.m_join_sprite[1].setVisible(!1))),USE_FRIEND_SPEICAL_EFFECT){r=this.m_gnrl_icon.getBoundingBox();cc.rectContainsPoint(r,a)&&null!=this.m_buff_sprite&&this.m_buff_sprite.isVisible()&&1==this.m_bg_box.isVisible()&&this.m_bg_box.setVisible(!1)}},touchPosCell:function(a,b){if(USE_FRIEND_SPEICAL_EFFECT){var r=this.m_gnrl_icon.getBoundingBox();cc.rectContainsPoint(r,a)&&null!=this.m_buff_sprite&&this.m_bg_box.setVisible(!0)}},touchPosInCell:function(a){var b=TutorialContextV2.getInstance(),r=this.m_join_sprite[0].getBoundingBox();if(cc.rectContainsPoint(r,a)){if(AudioEngine.getInstance().playNormaButtonSound(),this.m_is_join)b.IsCompleteAllTutorial()&&(this.m_release_sprite[0].setVisible(!0),this.m_release_sprite[1].setVisible(!1)),null!=this._callback_choice_friend&&b.IsCompleteAllTutorial()&&this._callback_choice_friend(-1);else if(b.IsCompleteAllTutorial()&&(this.m_join_sprite[0].setVisible(!0),this.m_join_sprite[0].setVisible(!1)),null!=this._callback_choice_friend&&b.IsCompleteAllTutorial()){var c=this.getIdx();this._callback_choice_friend(c)}AudioEngine.getInstance().playEffect(RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3")}},HidePopUp:function(){USE_FRIEND_SPEICAL_EFFECT&&null!=this.m_buff_sprite&&this.m_buff_sprite.isVisible()&&this.m_bg_box.setVisible(!1)}}),SkipTicketInfo=cc.Class.extend({spend_ticket_count:0,spend_key_count:0,amount_skip_count:0,ctor:function(){this.spend_ticket_count=0,this.spend_key_count=0,this.amount_skip_count=0}}),LONG_CLICK="logn_click",GetFontSize=function(a){var b=12;return(b=1e3<=a?Math.floor(a/100):Math.floor(a/10))<12?b=12:80<b&&(b=80),b},FriendSelectLayer_V2=cc.Layer.extend({m_sort:null,m_isSortBtnVisible:!1,m_isSortDesc:!0,m_friend_select_idx:0,m_leader_node:null,m_layer:null,m_deckBoxLayer:null,m_npcdeckBoxLayer:null,m_leftLayer:null,m_rightLayer:null,m_sortLayer:null,m_user_cost_label:null,m_sort_label_on:null,m_sort_label_off:null,m_btn_battle_formation:null,m_btn_arrow_off:null,m_btn_arrow_on:null,m_btn_sort:null,m_btn_sort_2:null,m_btn_sort_2_off:null,m_btn_sort_2_on:null,m_key_ani_img:null,m_friend_select_tv:null,m_message_box:null,m_friend_select_scene:null,tooltip_box:null,tooltip_content:null,m_wp_tooltip_box:null,m_wp_tooltip_content:null,m_troops_btns:[],m_mussang:null,m_start_btn:null,m_tower_dungeon:null,m_weekly_dungeon:null,m_weekly_difficulty:null,m_mission:null,m_event_dungeon:null,m_daily_dungeon:null,m_great_wall_dungeon:null,m_once_a_day_dungeon:null,m_gnrl_body:null,m_boss_container:null,m_btn_battle_1:null,m_btn_battle_2:null,m_btn_battle_3:null,m_skip_ticket_count:1,m_skip_ticket_default:1,m_have_skip_ticket_count:0,m_boss_Damage:0,m_taskSakuraSprList:[],m_skipTicketCountLabel:null,m_haveSkipTicketCountLabel:null,m_haveSkipTicketLabel:null,m_startSkipTicketModalLayer:null,m_itemMinusBtn:null,m_itemPlusBtn:null,m_startBtn:null,m_task:null,m_long_touch_cell:null,m_isLongTouch:!1,ctor:function(){this.m_troops_btns=[],this.m_task=null,this.m_mission=$.extend({},database.BattleMainMission),this.m_mussang=$.extend({},database.BattleMussang),this.m_weekly_difficulty=$.extend({},database.BattleWeeklyDungeonDifficulty),this.m_event_dungeon=$.extend({},database.BattleEventDungeon),this._super()},initLayout:function(a){this.m_friend_select_scene=a;var b=TutorialContextV2.getInstance(),is_auto_friend_select=0!=GameDefault.getInstance().getOptionFriend();is_auto_friend_select&&b.IsCompleteAllTutorial()||(this.m_friend_select_idx=-1),this.m_layer=new cc.Layer,this.addChild(this.m_layer),this.m_game_type=BattleContext._getInstance().getGameType();var c=BattleContext._getInstance(),troops_num=this.getCurrentTroopsNum();if(this.m_game_type==db.BattleGameType.Mission){var d=c.getMissionID();BattleService.getInstance().getMainMissionAndNpc(d,this.m_mission)}else if(this.m_game_type==db.BattleGameType.WeeklyDungeon)this.m_weekly_difficulty=c.getWeeklyDungeonDifficulty(),this.m_weekly_dungeon=c.getWeeklyDungeonData();else if(this.m_game_type==db.BattleGameType.Mussang){var e=c.getMussangId();BattleService.getInstance().getMasterMussangStepStageNpc(e,this.m_mussang)}else if(this.m_game_type==db.BattleGameType.EventDungeon)this.m_event_dungeon=c.getEventDungeonData();else if(this.m_game_type==db.BattleGameType.DailyDungeon)this.m_daily_dungeon=c.getDailyDungeonData();else if(this.m_game_type==db.BattleGameType.GreatWallDungeon)this.m_great_wall_dungeon=c.getGreatWallDungeonData();else if(this.m_game_type==db.BattleGameType.TowerDungeon);else if(this.m_game_type==db.BattleGameType.OnceADayDungeon)this.m_once_a_day_dungeon=c.getEventOnceADayDungeonData();else if(this.m_game_type==db.BattleGameType.EventRaidDungeon){var f=ccSize(this);this.m_boss_container=new cc.Node,this.m_boss_container.setPosition(f.width,0),this.m_layer.addChild(this.m_boss_container),this.m_gnrl_body=cc.Sprite.create(),this.m_gnrl_body.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_gnrl_body.setScale(2),this.m_boss_container.addChild(this.m_gnrl_body);var g=cc.scaleTo(.7,2,2.01),scaleTo_2=cc.scaleTo(.7,2,1.99),sequence=cc.sequence(g,scaleTo_2),repeat=cc.repeatForever(sequence);this.m_gnrl_body.runAction(repeat);var h=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_normal_4.png",cc.rect());h.setContentSize(644,640),h.setAnchorPoint(ZERO()),h.setPosition(LP(this,300,0)),this.m_layer.addChild(h)}this.m_leftLayer=this.getLeftBoxLayer(),this.m_leftLayer.setAnchorPoint(ZERO()),this.m_leftLayer.setPosition((ccWidth(this)-533)/2-ccWidth(this.m_leftLayer)/2,0),this.m_layer.addChild(this.m_leftLayer,2),this.updateLeaderSkill(troops_num),this.m_game_type==db.BattleGameType.GreatWallDungeon?(this.m_rightLayer=this.getGreatWallRightBoxLayer(),this.m_rightLayer.ignoreAnchorPointForPosition(!1),this.m_rightLayer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_rightLayer.setPosition(ccWidth(this),0)):this.m_game_type==db.BattleGameType.EventRaidDungeon?(this.updateRightBoxBG(),USE_SP_EVENT_SCALE?this.m_rightLayer=this.getEventRaidRightBoxLayer_SP():this.m_rightLayer=this.getEventRaidRightBoxLayer(),this.m_rightLayer.ignoreAnchorPointForPosition(!1),this.m_rightLayer.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_rightLayer.setPosition(LP(this,479,0))):(this.m_rightLayer=this.getRightBoxLayer(),this.m_rightLayer.ignoreAnchorPointForPosition(!1),this.m_rightLayer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_rightLayer.setPosition(ccWidth(this),0)),this.m_layer.addChild(this.m_rightLayer),this.m_game_type!=db.BattleGameType.Mission&&this.m_game_type!=db.BattleGameType.EventDungeon||is_auto_friend_select&&0<this.m_frnd_list.length&&b.IsCompleteAllTutorial()&&this.choiceFriend(0),this.m_message_box=new GameMessageBox,this.addChild(this.m_message_box,11e4),this.m_startSkipTicketModalLayer=new GameMessageBox,this.addChild(this.m_startSkipTicketModalLayer,1e3)},getGreatWallRightBoxLayer:function(){MasterManager.getInstance();var c=BattleService.getInstance(),layer=new cc.Layer;layer.setContentSize(481,568),layer.setPosition(LP(this,479,0));for(var d=ccSize(layer),dungeon=BattleContext._getInstance().getGreatWallDungeonData(),npc_list=dungeon.stage_npc[1],gnrl_group=0,idx=0;idx<npc_list.length;idx++){var n=npc_list[idx];if(n.is_zoom){gnrl_group=n.general.gnrl_group;break}}var e="";e=gnrl_group<100?RES_CDN_DEFULT+cmString("card_war_boss/%02d.png",gnrl_group):RES_CDN_DEFULT+"card_war_boss/"+gnrl_group+".png",resourceLoader(e,function(){var a=cc.Sprite.create(e);a.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),a.setScaleX(2),a.setScaleY(2),a.setPosition(d.width,0),a.zIndex=-10,layer.addChild(a);var b=cc.scaleTo(.7,2,2.01),scaleTo_2=cc.scaleTo(.7,2,1.99),sequence=cc.sequence(b,scaleTo_2),repeat=cc.repeatForever(sequence);a.runAction(repeat)}.bind(this));var f=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_normal_4.png",RectZero());f.setContentSize(644,640),f.setAnchorPoint(ZERO()),f.setPosition(-200,0),layer.addChild(f);var h=cc.Sprite.create(RES_CDN_DEFULT+"menu_great_wall/img_great_wall_text_2.png");if(h.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),h.setPosition(19,525),layer.addChild(h),this.m_great_wall_dungeon.is_complete){var j=cc.Sprite.create(RES_CDN_DEFULT+"menu_great_wall/img_great_wall_complete_2.png");j.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),j.setPosition(207,493),USE_SP_GREATWALL_SCALE&&j.setScale(2),layer.addChild(j)}(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(circle_point),circle_point.setPosition(19,487);var k=cmLabel.getLabel(res_str("label_great_wall_stage_title"),LABEL_FONT_INDEX.FONT_248);k.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),k.setPosition(35,479),layer.addChild(k);var l=cmLabel.getLabel(cmString(res_str("label_great_wall_stage_step"),dungeon.great_wall_dungeon_step),LABEL_FONT_INDEX.FONT_241);l.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),l.setPosition(108,479),layer.addChild(l),(w=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(w),w.setPosition(19,465),(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(circle_point),circle_point.setPosition(19,436);var m=cmLabel.getLabel(res_str("label_mussang_enemy_title"),LABEL_FONT_INDEX.FONT_248);m.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),m.setPosition(35,428),layer.addChild(m);var o=[];o.push_back(cc.p(19,314)),o.push_back(cc.p(91,350)),o.push_back(cc.p(91,268)),o.push_back(cc.p(163,350)),o.push_back(cc.p(163,268));MasterManager.getInstance();for(var i=0;i<o.length;i++){var p=new NpcInfoItemNode(CARD_TYPE.type_card_thumb,this.m_game_type);p.setPosition(o.at(i)),p.setGlobalZOrderTooltip(!0),layer.addChild(p);var q=i+1;if(i<npc_list.length){var r=!0;p.setVisible(!0);for(idx=0;idx<npc_list.length;idx++){r=q==npc_list[i].position}if(r!=npc_list.end()){var g=npc_list[i];p.setBattleGeneralData(g,g.is_zoom),p.setVisible(!0)}else p.setVisible(!1)}else p.setVisible(!1)}var s=cc.Sprite.create("#btn_tip_off.png");s.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),s.setPosition(19,220),layer.addChild(s,99999);var t=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(1,1,1,1)));t.setAnchorPoint(ANCHOR_MIDDLE()),t.setPreferredSize(ccSize(s)),t.setPosition(ccCenter(s)),s.addChild(t),t.addTargetWithActionForControlEvents(this,this.onTouchWeakPointTooltip,cc.CONTROL_EVENT_TOUCH_DOWN),t.addTargetWithActionForControlEvents(this,this.onTouchWeakPointTooltip,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),t.addTargetWithActionForControlEvents(this,this.onTouchWeakPointTooltip,cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE),t.addTargetWithActionForControlEvents(this,this.onTouchWeakPointTooltip,cc.CONTROL_EVENT_TOUCH_CANCEL);var u=ccSize(s);if(null==this.m_wp_tooltip_box){this.m_wp_tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.m_wp_tooltip_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM());var v=layer.convertToWorldSpace(s.getPosition());v.x=v.x+2*u.width,v.y=v.y+u.height+5,this.m_wp_tooltip_box.setPosition(v),this.m_wp_tooltip_box.setVisible(!1),this.getParent().addChild(this.m_wp_tooltip_box)}null==this.m_wp_tooltip_content&&(this.m_wp_tooltip_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.m_wp_tooltip_content.setAnchorPoint(ANCHOR_MIDDLE()),this.m_wp_tooltip_box.addChild(this.m_wp_tooltip_content));var w,circle_point,boss_weak_point=cmLabel.getLabel(cmString(res_str("label_great_wall_dungeon_boss_weak_point"),dungeon.great_wall_dungeon.boss_weak_point),LABEL_FONT_INDEX.FONT_2014);boss_weak_point.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),boss_weak_point.setPosition(100,220),layer.addChild(boss_weak_point),(w=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ZERO()),layer.addChild(w),w.setPosition(19,212),(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(circle_point),circle_point.setPosition(19,182);var x=cmLabel.getLabel(res_str("label_reward_bonus"),LABEL_FONT_INDEX.FONT_248);if(x.setAnchorPoint(ZERO()),x.setPosition(35,174),layer.addChild(x),dungeon.is_first_clear){var y=MasterTable.getInstance().get_GreatWallDungeonReplaceBonusItemList(dungeon.great_wall_dungeon.great_wall_dungeon_replace_bonus_idx),offset_x=19;for(i=0;i<y.length;i++){var z=y.at(i),item={};c.convertBonusInfo3(z,item),(B=new MissionPreviewBonusItemCell).setEnableToolTip(!0),B.setEnableItemCount(!1),B.setEnableItemCount(1e4==z.bonus_gain_rate&&z.min_value==z.max_value),B.setPosition(offset_x,96),B.setGainItem(item),layer.addChild(B,999991),offset_x+=72}}else{var A=MasterTable.getInstance().get_GreatWallDungeonBonusItemList(dungeon.great_wall_dungeon.great_wall_dungeon_bonus_idx);for(offset_x=19,i=0;i<A.length;i++){var B;z=A.at(i),item={};c.convertBonusInfo3(z,item),(B=new MissionPreviewBonusItemCell).setEnableToolTip(!0),B.setEnableItemCount(1e4==z.bonus_gain_rate&&z.min_value==z.max_value),B.setPosition(offset_x,96),B.setGainItem(item),layer.addChild(B,999991),offset_x+=72}}this.checkNeedKeyGreatWallDungeon();var C=new LabelButton("btn_03_off.png","btn_03_on.png","",ccui.Widget.PLIST_TEXTURE);return C.setFont(LABEL_FONT_INDEX.FONT_241),C.setString(res_str("label_start_mission")),C.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),C.setPosition(.5*d.width,16),C.setSoundPath("SE_button_key.mp3"),C.addClickEventListener(function(a){this.battleStart()}.bind(this),.4,"battle_begin"),C.setEnabled(!this.m_great_wall_dungeon.is_complete),layer.addChild(C),layer},updateRightBoxBG:function(){var c=ccSize(this);this.m_boss_container.isRunning()&&this.m_boss_container.stopAllActions();var m=MasterManager.getInstance(),npc=m.get_EventRaidDungeonNpc(NetService().get_Event_Raid_Dungeon_idx(),1),n=m.get_NpcGeneral(npc.npc1_idx),boss_image=(m.get_General(n.gnrl_id),"");boss_image=n.gnrl_group<100?RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(n.gnrl_group,2)+".png":RES_CDN_DEFULT+"card_war_boss/"+n.gnrl_group+".png",resourceLoader(boss_image,function(){var a=cc.textureCache.addImage(boss_image),frame=new cc.SpriteFrame(a,cc.rect(0,0,a.getContentSize().width,a.getContentSize().height));this.m_gnrl_body.setSpriteFrame(frame),this.m_boss_container.setPosition(c.width+ccWidth(this.m_gnrl_body),0);var b=cc.p(c.width,0),move=new cc.MoveTo(.2,b);this.m_boss_container.runAction(move)}.bind(this))},getEventRaidRightBoxLayer:function(){var b=new cc.Layer;b.setContentSize(481,568);MasterTable.getInstance();var c=NetService(),service=EventDungeonService.getInstance(),event_raid_info=c.get_Event_Raid_Dungeon_Info(),period=(c.get_Event_Raid_Dungeon_User_Info(),MasterManager.getInstance().get_EventDungeonPeriod(event_raid_info.event_dungeon_period_idx)),e_service=EventDungeonService.getInstance(),first_idx=e_service.getEventDungeonFirstHalfPeriodIdx(period.event_dungeon_group_idx),second_idx=e_service.getEventDungeonSecondHalfPeriodIdx(period.event_dungeon_group_idx),is_second=!1,event_dungeon_point=(c.get_User_Event_Raid_ConquestCount(first_idx),c.get_User_Event_Raid_AccumDamage(first_idx),{});service.getUserEventDungeonPoint(first_idx,event_dungeon_point);var d=event_dungeon_point.accum_event_point-event_dungeon_point.event_point;event_raid_info.event_dungeon_period_idx==second_idx&&(is_second=!0,c.get_User_Event_Raid_ConquestCount(second_idx),c.get_User_Event_Raid_AccumDamage(second_idx),service.getUserEventDungeonPoint(second_idx,event_dungeon_point),d=event_dungeon_point.accum_event_point-event_dungeon_point.event_point);var e="",eventvs_banner=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_banner_raid.png",event_raid_info.event_dungeon_period_idx));eventvs_banner.setAnchorPoint(ANCHOR_TOP_LEFT()),eventvs_banner.setPosition(0,ccHeight(b)),b.addChild(eventvs_banner);var f=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_white.png");f.setAnchorPoint(ZERO()),f.setPosition(19,267),b.addChild(f),e="無双ボス[前半]",is_second&&(e="無双ボス[後半]");var g=new cmMultiLabel;g.addLabel(e,LABEL_FONT_INDEX.FONT_241),g.addLabel(" ("+Number(event_raid_info.event_raid_boss_info.boss_num).toLocaleString("en")+"体目)",LABEL_FONT_INDEX.FONT_2011),g.setLabel(),g.enableOutline(cc.color.BLACK,1),g.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),g.setPosition(33,270),b.addChild(g);var h=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_white.png");h.setAnchorPoint(ZERO()),h.setPosition(19,235),b.addChild(h);var i="精密パーツ使用数";is_second&&(i="再会の祝酒使用数");var j=new cmMultiLabel;j.addLabel(i,LABEL_FONT_INDEX.FONT_241),j.addLabel(" ("+Number(d).toLocaleString("en")+"個)",LABEL_FONT_INDEX.FONT_2011),j.enableOutline(cc.color.BLACK,1),j.setLabel(),j.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),j.setPosition(33,236),b.addChild(j);var k=6,offset_y=16,dungeon_idx=NetService().get_Event_Raid_Dungeon_idx(),base_point=MasterManager.getInstance().get_EventRaidDungeon(dungeon_idx).base_need_point,ticket_count_1=MasterManager.getInstance().get_EventRaidDungeon(dungeon_idx).multiple_1,ticket_count_2=MasterManager.getInstance().get_EventRaidDungeon(dungeon_idx).multiple_2,ticket_count_3=MasterManager.getInstance().get_EventRaidDungeon(dungeon_idx).multiple_3,btn_string_1=res_str("event_raid_start_1"),btn_string_2=cmString(res_str("event_raid_start_2"),ticket_count_2),btn_string_3=cmString(res_str("event_raid_start_2"),ticket_count_3),on=RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_raid_on.png",event_raid_info.event_dungeon_period_idx),off=RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_raid_off.png",event_raid_info.event_dungeon_period_idx),none=RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_raid_none.png",event_raid_info.event_dungeon_period_idx),btnSize=cc.size(156,78);this.m_btn_battle_1=new ccui.Button(off,on,none),this.m_btn_battle_1.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_btn_battle_1.setPosition(k,16),this.m_btn_battle_1.addClickEventListener(function(a){this.EventRaidBattleStart(ticket_count_1)}.bind(this)),b.addChild(this.m_btn_battle_1);var l=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());l.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),l.setPosition(.5*btnSize.width,9),l.setContentSize(104,26),this.m_btn_battle_1.addChild(l);var m=cmLabel.getLabel(Number(base_point*ticket_count_1).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810);m.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),m.setPosition(ccWidth(l)-10,.5*ccHeight(l)),l.addChild(m);var o=cc.Sprite.create(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_point.png",event_raid_info.event_dungeon_period_idx));o.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),o.setPosition(17,9),this.m_btn_battle_1.addChild(o);var p=cmLabel.getLabel(btn_string_1,LABEL_FONT_INDEX.FONT_221);p.enableOutline(cc.color.BLACK,2),p.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),p.setPosition(.5*btnSize.width,45),this.m_btn_battle_1.addChild(p),k+=btnSize.width,this.m_btn_battle_2=new ccui.Button(off,on,none),this.m_btn_battle_2.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_btn_battle_2.setPosition(k,16),this.m_btn_battle_2.addClickEventListener(function(a){this.EventRaidBattleStart(ticket_count_2)}.bind(this)),b.addChild(this.m_btn_battle_2);var q=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());q.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),q.setPosition(.5*btnSize.width,9),q.setContentSize(104,26),this.m_btn_battle_2.addChild(q);var r=cmLabel.getLabel(Number(base_point*ticket_count_2).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810);r.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),r.setPosition(ccWidth(q)-10,.5*ccHeight(q)),q.addChild(r);var s=cc.Sprite.create(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_point.png",event_raid_info.event_dungeon_period_idx));s.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),s.setPosition(17,9),this.m_btn_battle_2.addChild(s);var t=cmLabel.getLabel(btn_string_2,LABEL_FONT_INDEX.FONT_221);t.enableOutline(cc.color.BLACK,2),t.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),t.setPosition(.5*btnSize.width,45),this.m_btn_battle_2.addChild(t),k+=btnSize.width,this.m_btn_battle_3=new ccui.Button(off,on,none),this.m_btn_battle_3.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_btn_battle_3.setPosition(k,16),this.m_btn_battle_3.addClickEventListener(function(a){this.EventRaidBattleStart(ticket_count_3)}.bind(this)),b.addChild(this.m_btn_battle_3);var u=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());u.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),u.setPosition(.5*btnSize.width,9),u.setContentSize(104,26),this.m_btn_battle_3.addChild(u);var v=cmLabel.getLabel(Number(base_point*ticket_count_3).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810);v.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),v.setPosition(ccWidth(u)-10,.5*ccHeight(u)),u.addChild(v);var w=cc.Sprite.create(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_point.png",event_raid_info.event_dungeon_period_idx));w.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),w.setPosition(17,9),this.m_btn_battle_3.addChild(w);var x=cmLabel.getLabel(btn_string_3,LABEL_FONT_INDEX.FONT_221);x.enableOutline(cc.color.BLACK,2),x.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),x.setPosition(.5*btnSize.width,45),this.m_btn_battle_3.addChild(x),k+=btnSize.width,offset_y+=btnSize.height+12;var y=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_info_2.png",NetService().get_Event_Raid_Dungeon_Period_idx()));y.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),y.setPosition(19,offset_y),b.addChild(y);var z=cmLabel.getLabel(event_dungeon_point.event_point.toLocaleString("en"),LABEL_FONT_INDEX.FONT_165);z.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),z.setPosition(181,14),y.addChild(z),offset_y+=ccHeight(y)+14;var A=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_gauge.png");A.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),A.setPosition(0,150),b.addChild(A,100),offset_y+=ccHeight(A)+10;var B=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_gauge_red_3.png"),life_bar=new cc.ProgressTimer(B);life_bar.setAnchorPoint(ANCHOR_MIDDLE()),life_bar.setMidpoint(ANCHOR_MIDDLE_LEFT()),life_bar.setBarChangeRate(cc.p(1,0)),life_bar.setPosition(ccCenter(A)),life_bar.setType(cc.ProgressTimer.TYPE_BAR),A.addChild(life_bar);dungeon_idx=NetService().get_Event_Raid_Dungeon_idx();var C=MasterManager.getInstance().get_EventRaidDungeon(dungeon_idx),max_hp=C.boss_hp;null==C.boss_hp&&(max_hp=0);var D=Math.floor(event_raid_info.event_raid_boss_info.remain_hp/max_hp*100);life_bar.setPercentage(D);var E=cmLabel.getLabel(cmString(res_str("label_event_raid_ramain_life"),event_raid_info.event_raid_boss_info.remain_hp.toLocaleString("en"),max_hp.toLocaleString("en")),LABEL_FONT_INDEX.FONT_181);E.enableOutline(cc.color.BLACK,1),E.setAnchorPoint(ANCHOR_MIDDLE()),E.setPosition(ccCenter(A).x,ccCenter(A).y+1),A.addChild(E);var F=MasterManager.getInstance().get_EventRaidDungeonNpc(c.get_Event_Raid_Dungeon_idx(),1),n=MasterManager.getInstance().get_NpcGeneral(F.npc1_idx),gnrl=MasterManager.getInstance().get_General(n.gnrl_id),element=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_raid/img_raid_battletech_%d.png",gnrl.element_type));element.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),element.setPosition(19,180),b.addChild(element);var G=0;switch(gnrl.element_type){case 1:G=LABEL_FONT_INDEX.FONT_305;break;case 2:G=LABEL_FONT_INDEX.FONT_306;break;case 3:G=LABEL_FONT_INDEX.FONT_307;break;case 4:G=LABEL_FONT_INDEX.FONT_308;break;case 5:G=LABEL_FONT_INDEX.FONT_309}var H=cmLabel.getLabel(gnrl.name,G);return H.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),H.setPosition(79,185),b.addChild(H),b},getEventRaidRightBoxLayer_SP:function(){var b=new cc.Layer;b.setContentSize(481,568);MasterTable.getInstance();var c=NetService(),service=EventDungeonService.getInstance(),event_raid_info=c.get_Event_Raid_Dungeon_Info(),period=(c.get_Event_Raid_Dungeon_User_Info(),MasterManager.getInstance().get_EventDungeonPeriod(event_raid_info.event_dungeon_period_idx)),e_service=EventDungeonService.getInstance(),first_idx=e_service.getEventDungeonFirstHalfPeriodIdx(period.event_dungeon_group_idx),second_idx=e_service.getEventDungeonSecondHalfPeriodIdx(period.event_dungeon_group_idx),is_second=!1,event_dungeon_point=(c.get_User_Event_Raid_ConquestCount(first_idx),c.get_User_Event_Raid_AccumDamage(first_idx),{});service.getUserEventDungeonPoint(first_idx,event_dungeon_point);var d=event_dungeon_point.accum_event_point-event_dungeon_point.event_point;event_raid_info.event_dungeon_period_idx==second_idx&&(is_second=!0,c.get_User_Event_Raid_ConquestCount(second_idx),c.get_User_Event_Raid_AccumDamage(second_idx),service.getUserEventDungeonPoint(second_idx,event_dungeon_point),d=event_dungeon_point.accum_event_point-event_dungeon_point.event_point);var e="",eventvs_banner=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_banner_raid.png",event_raid_info.event_dungeon_period_idx));eventvs_banner.setAnchorPoint(ANCHOR_TOP_LEFT()),eventvs_banner.setPosition(0,ccHeight(b)),eventvs_banner.setScale(2),b.addChild(eventvs_banner);var f=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_white.png");f.setAnchorPoint(ZERO()),f.setPosition(19,267),b.addChild(f),e="無双ボス[前半]",is_second&&(e="無双ボス[後半]");var g=new cmMultiLabel;g.addLabel(e,LABEL_FONT_INDEX.FONT_241),g.addLabel(" ("+Number(event_raid_info.event_raid_boss_info.boss_num).toLocaleString("en")+"体目)",LABEL_FONT_INDEX.FONT_2011),g.setLabel(),g.enableOutline(cc.color.BLACK,1),g.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),g.setPosition(33,270),b.addChild(g);var h=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_white.png");h.setAnchorPoint(ZERO()),h.setPosition(19,235),b.addChild(h);var i="鮮麗な翠玉使用数";is_second&&(i="清艶な碧玉使用数");var j=new cmMultiLabel;j.addLabel(i,LABEL_FONT_INDEX.FONT_241),j.addLabel(" ("+Number(d).toLocaleString("en")+"個)",LABEL_FONT_INDEX.FONT_2011),j.enableOutline(cc.color.BLACK,1),j.setLabel(),j.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),j.setPosition(33,236),b.addChild(j);var k=6,offset_y=16,dungeon_idx=NetService().get_Event_Raid_Dungeon_idx(),base_point=MasterManager.getInstance().get_EventRaidDungeon(dungeon_idx).base_need_point,ticket_count_1=MasterManager.getInstance().get_EventRaidDungeon(dungeon_idx).multiple_1,ticket_count_2=MasterManager.getInstance().get_EventRaidDungeon(dungeon_idx).multiple_2,ticket_count_3=MasterManager.getInstance().get_EventRaidDungeon(dungeon_idx).multiple_3,btn_string_1=res_str("event_raid_start_1"),btn_string_2=cmString(res_str("event_raid_start_2"),ticket_count_2),btn_string_3=cmString(res_str("event_raid_start_2"),ticket_count_3),on=RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_raid_on.png",event_raid_info.event_dungeon_period_idx),off=RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_raid_off.png",event_raid_info.event_dungeon_period_idx),none=RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_raid_none.png",event_raid_info.event_dungeon_period_idx),btnSize=cc.size(156,78);this.m_btn_battle_1=new ccui.Button(off,on,none),this.m_btn_battle_1.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_btn_battle_1.setPosition(k,16),this.m_btn_battle_1.addClickEventListener(function(a){this.EventRaidBattleStart(ticket_count_1)}.bind(this)),this.m_btn_battle_1.setScale(2),b.addChild(this.m_btn_battle_1);var l=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());l.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),l.setPosition(.5*btnSize.width+575,26),l.setContentSize(104,26),this.addChild(l);var m=cmLabel.getLabel(Number(base_point*ticket_count_1).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810);m.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),m.setPosition(ccWidth(l)-10,.5*ccHeight(l)),l.addChild(m);var o=cc.Sprite.create(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_point.png",event_raid_info.event_dungeon_period_idx));o.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),o.setPosition(592,25),o.setScale(2),this.addChild(o);var p=cmLabel.getLabel(btn_string_1,LABEL_FONT_INDEX.FONT_221);p.enableOutline(cc.color.BLACK,2),p.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),p.setPosition(.5*btnSize.width+575,62),this.addChild(p),k+=btnSize.width,this.m_btn_battle_2=new ccui.Button(off,on,none),this.m_btn_battle_2.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_btn_battle_2.setPosition(k,16),this.m_btn_battle_2.addClickEventListener(function(a){this.EventRaidBattleStart(ticket_count_2)}.bind(this)),this.m_btn_battle_2.setScale(2),b.addChild(this.m_btn_battle_2);var q=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());q.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),q.setPosition(.5*btnSize.width+730,26),q.setContentSize(104,26),this.addChild(q);var r=cmLabel.getLabel(Number(base_point*ticket_count_2).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810);r.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),r.setPosition(ccWidth(q)-10,.5*ccHeight(q)),q.addChild(r);var s=cc.Sprite.create(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_point.png",event_raid_info.event_dungeon_period_idx));s.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),s.setPosition(747,25),s.setScale(2),this.addChild(s);var t=cmLabel.getLabel(btn_string_2,LABEL_FONT_INDEX.FONT_221);t.enableOutline(cc.color.BLACK,2),t.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),t.setPosition(.5*btnSize.width+730,62),this.addChild(t),k+=btnSize.width,this.m_btn_battle_3=new ccui.Button(off,on,none),this.m_btn_battle_3.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_btn_battle_3.setPosition(k,16),this.m_btn_battle_3.addClickEventListener(function(a){this.EventRaidBattleStart(ticket_count_3)}.bind(this)),this.m_btn_battle_3.setScale(2),b.addChild(this.m_btn_battle_3);var u=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());u.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),u.setPosition(.5*btnSize.width+885,26),u.setContentSize(104,26),this.addChild(u);var v=cmLabel.getLabel(Number(base_point*ticket_count_3).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810);v.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),v.setPosition(ccWidth(u)-10,.5*ccHeight(u)),u.addChild(v);var w=cc.Sprite.create(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_point.png",event_raid_info.event_dungeon_period_idx));w.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),w.setPosition(902,25),w.setScale(2),this.addChild(w);var x=cmLabel.getLabel(btn_string_3,LABEL_FONT_INDEX.FONT_221);x.enableOutline(cc.color.BLACK,2),x.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),x.setPosition(.5*btnSize.width+885,62),this.addChild(x),k+=btnSize.width,offset_y+=btnSize.height+12;var y=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_info_2.png",NetService().get_Event_Raid_Dungeon_Period_idx()));y.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),y.setPosition(19,offset_y),y.setScale(2),b.addChild(y);var z=cmLabel.getLabel(event_dungeon_point.event_point.toLocaleString("en"),LABEL_FONT_INDEX.FONT_165);z.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),z.setPosition(776,118),this.addChild(z),offset_y+=ccHeight(y)+14;var A=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_gauge.png");A.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),A.setPosition(0,150),b.addChild(A,100),offset_y+=ccHeight(A)+10;var B=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_gauge_red_3.png"),life_bar=new cc.ProgressTimer(B);life_bar.setAnchorPoint(ANCHOR_MIDDLE()),life_bar.setMidpoint(ANCHOR_MIDDLE_LEFT()),life_bar.setBarChangeRate(cc.p(1,0)),life_bar.setPosition(ccCenter(A)),life_bar.setType(cc.ProgressTimer.TYPE_BAR),A.addChild(life_bar);dungeon_idx=NetService().get_Event_Raid_Dungeon_idx();var C=MasterManager.getInstance().get_EventRaidDungeon(dungeon_idx),max_hp=C.boss_hp;null==C.boss_hp&&(max_hp=0);var D=Math.floor(event_raid_info.event_raid_boss_info.remain_hp/max_hp*100);life_bar.setPercentage(D);var E=cmLabel.getLabel(cmString(res_str("label_event_raid_ramain_life"),event_raid_info.event_raid_boss_info.remain_hp.toLocaleString("en"),max_hp.toLocaleString("en")),LABEL_FONT_INDEX.FONT_181);E.enableOutline(cc.color.BLACK,1),E.setAnchorPoint(ANCHOR_MIDDLE()),E.setPosition(ccCenter(A).x,ccCenter(A).y+1),A.addChild(E);var F=MasterManager.getInstance().get_EventRaidDungeonNpc(c.get_Event_Raid_Dungeon_idx(),1),n=MasterManager.getInstance().get_NpcGeneral(F.npc1_idx),gnrl=MasterManager.getInstance().get_General(n.gnrl_id),element=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_raid/img_raid_battletech_%d.png",gnrl.element_type));element.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),element.setPosition(19,180),b.addChild(element);var G=0;switch(gnrl.element_type){case 1:G=LABEL_FONT_INDEX.FONT_305;break;case 2:G=LABEL_FONT_INDEX.FONT_306;break;case 3:G=LABEL_FONT_INDEX.FONT_307;break;case 4:G=LABEL_FONT_INDEX.FONT_308;break;case 5:G=LABEL_FONT_INDEX.FONT_309}var H=cmLabel.getLabel(gnrl.name,G);return H.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),H.setPosition(79,185),b.addChild(H),b},getRightBoxLayer:function(){var a=new cc.Layer,m=MasterTable.getInstance(),gnrl_buffs=[],gnrl_reward_buffs=[],dungeon_list=[],dungeon_ids=[],gnrl_buffs_check_period=[],gnrl_reward_buffs_period=[],right_bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));right_bg_box.setContentSize(478,568),right_bg_box.setAnchorPoint(ZERO()),right_bg_box.setPosition(ZERO()),a.addChild(right_bg_box),a.setContentSize(ccSize(right_bg_box));var b=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");b.setAnchorPoint(ZERO()),b.setPosition(8,509),a.addChild(b,1e3);var c=this.getNaviSortLayer();c.setPosition(295,7),b.addChild(c);var d=cmLabel.getLabel("フレンド選択",LABEL_FONT_INDEX.FONT_261);if(d.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),d.setPosition(12,ccCenter(b).y+4),b.addChild(d),this.createStartBtn(a),this.m_game_type==db.BattleGameType.EventDungeon){if(0!=this.m_event_dungeon.task_list.length){var e=NetService().get_UserItemInfo_V2();this.m_have_skip_ticket_count=e.skip_ticket_count,this.createSkipTicketInfo(a,e),this.createStartSkipBtn(a)}}else{e=NetService().get_UserItemInfo_V2();this.m_have_skip_ticket_count=e.skip_ticket_count,this.createSkipTicketInfo(a,e),this.createStartSkipBtn(a)}if(this.m_frnd_list=BattleContext._getInstance().getFriendList(),this.m_game_type==db.BattleGameType.EventDungeon)for(var f=0;f<this.m_frnd_list.length;f++){gnrl_buffs=[],gnrl_reward_buffs=[],dungeon_list=[],dungeon_ids=[];dungeon_list=m.get_EventDungeonList(this.m_event_dungeon.event_dungeon_period.event_dungeon_period_idx);dungeon_ids=[];for(var i=0;i<dungeon_list.length;i++)dungeon_ids.push(dungeon_list[i].event_dungeon_idx);if(this.m_game_type==db.BattleGameType.EventDungeon){gnrl_buffs_check_period=m.get_EventDungeonGeneralBuf(this.m_frnd_list[f].partner_gnrl_id%1e3,dungeon_ids);for(i=0;i<gnrl_buffs_check_period.length;i++)EventDungeonService.getInstance().IsOpenEventDungeonBuff(gnrl_buffs_check_period[i].buff_period_idx)&&gnrl_buffs.push(gnrl_buffs_check_period[i]);gnrl_reward_buffs_period=m.get_DungeonRewardBufGeneral(this.m_frnd_list[f].partner_gnrl_id%1e3,dungeon_ids);for(var g=0;g<gnrl_reward_buffs_period.length;g++)EventDungeonService.getInstance().IsOpenEventDungeonBuff(gnrl_reward_buffs_period[g].buff_period_idx)&&gnrl_reward_buffs.push(gnrl_buffs_check_period[g])}(0<gnrl_buffs.length||0<gnrl_reward_buffs.length)&&(this.m_frnd_list[f].special_eff=1)}for(f=0;f<this.m_frnd_list.length;f++)this.m_frnd_list[f].partner_gnrl_class=GeneralService.getInstance().getGeneralClassType(this.m_frnd_list[f].partner_gnrl_id);if(this.m_frnd_list=stable(this.m_frnd_list,function(r,l){return l.partner_gnrl_class>r.partner_gnrl_class}),this.m_frnd_list=stable(this.m_frnd_list,function(r,l){return l.helper_type<r.helper_type}),this.m_game_type==db.BattleGameType.Mission||this.m_game_type==db.BattleGameType.EventDungeon){if(this.m_game_type==db.BattleGameType.EventDungeon&&0==this.m_event_dungeon.task_list.length){var h=cc.size(458,40),frnd_info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());frnd_info_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),frnd_info_box.setPosition(10,76),frnd_info_box.setPreferredSize(h),a.addChild(frnd_info_box);var j=cc.Sprite.create(RES_CDN_DEFULT+"menu_friend/img_friend_text.png");j.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),j.setPosition(52,.5*h.height),frnd_info_box.addChild(j);var k=cmLabel.getLabel("同行したフレンドは12時間後再同行できます。",LABEL_FONT_INDEX.FONT_1613);k.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),k.setPosition(88,.5*h.height),frnd_info_box.addChild(k)}var n=cc.size(444,376),t_pos=cc.p(17,120);this.m_game_type==db.BattleGameType.EventDungeon?0!=this.m_event_dungeon.task_list.length&&(n=cc.size(444,298),t_pos=cc.p(17,198)):(n=cc.size(444,298),t_pos=cc.p(17,198)),this.m_friend_select_tv=new cc.TableView(this,n),this.m_friend_select_tv.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_friend_select_tv.scrollBarEnable(!0),this.m_friend_select_tv.setVerticalFillOrder(0),this.m_friend_select_tv.setPosition(t_pos),this.m_friend_select_tv.setDelegate(this),a.addChild(this.m_friend_select_tv),this.m_friend_select_tv.reloadData()}else if(this.m_game_type==db.BattleGameType.EventRaidDungeon);else{var o=cc.Sprite.create(RES_CDN_DEFULT+"common/img_friend_off.png");o.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),o.setPosition(ccCenter(right_bg_box).x,76),right_bg_box.addChild(o),this.m_btn_sort.setVisible(!1),this.m_btn_sort_2.setVisible(!1)}return this.sort(),a},getNaviSortLayer:function(){var b=new cc.Layer;return this.m_btn_sort=new LabelButton("btn_02_off.png","btn_02_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort.setString("等級順"),this.m_btn_sort.setFont(LABEL_FONT_INDEX.FONT_201),this.m_sort=FriendSelectEnum.sort_class,USE_EVENT_DUNGEON_SAVE_FRIEND_SORT_INDEX&&this.m_game_type==db.BattleGameType.EventDungeon&&(this.m_sort=GameDefault.getInstance().GetEventDungeonFriendSortIdx()),this.initSort(this.m_sort),this.m_btn_sort.setAnchorPoint(ZERO()),this.m_btn_sort.setPosition(ZERO()),this.m_btn_sort.addClickEventListener(function(a){this.runActionSortButton()}.bind(this)),b.addChild(this.m_btn_sort),this.m_btn_sort_2_off="btn_align_bottom_off.png",this.m_btn_sort_2_on="btn_align_bottom_on.png",this.m_btn_sort_2=new ccui.Button,this.m_btn_sort_2.loadTextures(this.m_btn_sort_2_off,this.m_btn_sort_2_on,"",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_2.setAnchorPoint(ZERO()),this.m_btn_sort_2.setPosition(ccWidth(this.m_btn_sort),0),this.m_btn_sort_2.addClickEventListener(function(a){this.m_friend_select_idx=-1,this.setDesc()}.bind(this)),b.addChild(this.m_btn_sort_2),this.m_sortLayer=this.getSortLayer(),this.m_sortLayer.ignoreAnchorPointForPosition(!1),this.m_sortLayer.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_sortLayer.setPosition(ZERO()),this.m_sortLayer.setVisible(!1),b.addChild(this.m_sortLayer,100),b.setContentSize(ccSize(this.m_btn_sort)),b},cellSizeForTable:function(a){var b=cc.size(444,124);return cc.p(b.width,b.height)},onExit:function(){BATTLE_TO_SHOP||BATTLE_TO_MISSION||SceneManager.getInstance().getRunningScene().m_isPushScene||(null!=this.m_rightLayer&&this.m_rightLayer.removeAllChildrenWithCleanup(!0),null!=this.m_leftLayer&&this.m_leftLayer.removeAllChildrenWithCleanup(!0),this.removeAllChildrenWithCleanup(!0),this.m_troops_btns=null,this.m_rightLayer=null,this.m_leftLayer=null)},tableCellSizeForIndex:function(a,b){return cc.size(444,124)},tableCellEnded:function(a,b){return this.m_isLongTouch&&(this.m_isLongTouch=!1,null!=this.m_long_touch_cell&&null!=b&&b.HidePopUp()),!0},tableCellAtIndex:function(a,b){var c=a.dequeueCell(),cell=null;null!=c?cell=c:((cell=new FriendListCell)._callback_choice_friend=this.choiceFriend.bind(this),cell.setGameType(this.m_game_type),this.m_game_type==db.BattleGameType.EventDungeon&&cell.setEventDungeon(this.m_event_dungeon));var d=this.m_frnd_list[b];return cell.setFriendData(d,b==this.m_friend_select_idx),cell},numberOfCellsInTableView:function(a){return this.m_frnd_list.length},choiceFriend:function(a){this.m_friend_select_idx=a;var b=this.m_friend_select_tv.getCellsUsed();for(a=0;a<b.length;a++){var c=b[a];try{this.m_friend_select_tv.updateCellAtIndex(c.getIdx())}catch(e){}}var d={},helper_type=0;if(-1==this.m_friend_select_idx)d.gnrl_id=0,d.gnrl_num=0,BattleContext._getInstance().setFriendInfo("",d,helper_type);else if(this.m_frnd_list.length>this.m_friend_select_idx){var f=this.m_frnd_list[this.m_friend_select_idx];d.gnrl_id=f.partner_gnrl_id,d.gnrl_num=f.partner_gnrl_num,helper_type=f.helper_type,BattleContext._getInstance().setFriendInfo(f.user_id,d,helper_type),helper_type==HELPTER_TYPE_SUPPORTER&&BattleContext._getInstance().setBattleHelperInfo(f)}},tableCellTouched:function(a,b){this.m_game_type!=db.BattleGameType.Mission&&this.m_game_type!=db.BattleGameType.EventDungeon||null!=b&&(b.touchPosInCell(b.getTouchPos()),b.HidePopUp())},tableCellHighlight:function(c,d){if(this.m_game_type==db.BattleGameType.Mission||this.m_game_type==db.BattleGameType.EventDungeon){if(this.m_isLongTouch)return;this.m_long_touch_cell=d,this.scheduleOnce(function(a){if(this.m_isLongTouch=!0,null!=d&&(d.highlightPosInCell(d.getTouchPos()),null!=this.m_friend_select_tv.getDataSource()))for(var b=this.m_friend_select_tv.getCellsUsed(),jdx=0;jdx<b.length;jdx++)this.m_long_touch_cell==b[jdx]?b[jdx].setLocalZOrder(100):b[jdx].setLocalZOrder(0)}.bind(this),.4,LONG_CLICK)}},tableCellUnhighlight:function(a,b){this.m_game_type!=db.BattleGameType.Mission&&this.m_game_type!=db.BattleGameType.EventDungeon||(this.unschedule(LONG_CLICK),null!=b&&(b.unhighlightPosInCell(b.getTouchPos()),b.HidePopUp()))},initSort:function(a){switch(a){case FriendSelectEnum.sort_class:this.m_btn_sort.setString("等級順");break;case FriendSelectEnum.sort_lv:this.m_btn_sort.setString("レベル順");break;case FriendSelectEnum.sort_special_effect:this.m_game_type==db.BattleGameType.EventDungeon&&this.m_btn_sort.setString(res_str("btn_sort_dungeon_buff"))}},getLeftBoxLayer:function(){var b=new cc.Layer;b.setContentSize(427,640);var c=GeneralService.getInstance(),gw_service=GreatWallService.getInstance(),battle_form={},troops_num=this.getCurrentTroopsNum(),labelLayer=new cc.Layer;labelLayer.ignoreAnchorPointForPosition(!1),labelLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),labelLayer.setPosition(293,156),b.addChild(labelLayer,100);var d=0,btn_name=[];btn_name.push("1軍"),btn_name.push("2軍"),btn_name.push("3軍"),btn_name.push("4軍"),btn_name.push("5軍"),btn_name.push("6軍"),btn_name.push("7軍");for(var i=0;i<MAX_TROOPS_NUM;i++){(e=new LabelButton("btn_31_none.png","btn_31_on.png","btn_31_off.png",ccui.Widget.PLIST_TEXTURE)).setFont(LABEL_FONT_INDEX.FONT_241);var e=null;this.m_game_type==db.BattleGameType.GreatWallDungeon?(e=new LabelButton("btn_31_none.png","btn_31_on.png","btn_34_off.png",ccui.Widget.PLIST_TEXTURE)).setFont(LABEL_FONT_INDEX.FONT_221):(e=new LabelButton("btn_31_none.png","btn_31_on.png","btn_31_off.png",ccui.Widget.PLIST_TEXTURE)).setFont(LABEL_FONT_INDEX.FONT_241),e.setString(btn_name[i]),e.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),e.setPosition(d,508),e.setTag(NOTIFY_MENU_PARTY_1+i),e.addClickEventListener(function(a){MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],a.getTag())}.bind(this)),b.addChild(e),d+=ccWidth(e),this.m_troops_btns.push(e)}this.m_game_type!=db.BattleGameType.GreatWallDungeon&&this.m_troops_btns.at(6).setVisible(!1),this.updateTroopsBtns();var f=0,user_cost_bnd=0;user_cost_bnd=this.m_game_type==db.BattleGameType.GreatWallDungeon?(gw_service.getGreatWallTroopsFormationInfo(troops_num,battle_form),f=gw_service.getGreatWallTroopsCost(troops_num),gw_service.getGreatWallTroopsTotalCost(troops_num)):(c.getUserBattleFormationInfo(troops_num,battle_form),f=GeneralService.getInstance().getTroopsCost(troops_num),GeneralService.getInstance().getUserTotalCost(troops_num)),this.m_user_cost_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_301),this.m_user_cost_label.setAnchorPoint(ZERO()),this.m_user_cost_label.setPosition(17,470),b.addChild(this.m_user_cost_label),this.m_deckBoxLayer=this.getDeckLayer(),this.m_deckBoxLayer.setAnchorPoint(cc.p(0,0)),this.m_deckBoxLayer.setPosition(55,224),this.m_game_type==db.BattleGameType.GreatWallDungeon&&this.m_deckBoxLayer.setPosition(55,191),b.addChild(this.m_deckBoxLayer),c.getUserBattleFormationInfo(troops_num,battle_form),this.m_user_cost_label.setString("cost "+f+"/"+user_cost_bnd.cost);var g=cmLabel.getLabel("リーダースキル",LABEL_FONT_INDEX.FONT_2615);if(g.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),g.setPosition(17,172),b.addChild(g),this.m_game_type==db.BattleGameType.GreatWallDungeon){var h=cc.Sprite.create("#btn_warning_off.png");h.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),h.setPosition(372,160),b.addChild(h,999999);var j=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(1,1,1,1)));j.setAnchorPoint(ANCHOR_MIDDLE()),j.setPreferredSize(ccSize(h)),j.setPosition(ccCenter(h)),h.addChild(j),j.addTargetWithActionForControlEvents(this,this.onTouchWarningTooltip,cc.CONTROL_EVENT_TOUCH_DOWN),j.addTargetWithActionForControlEvents(this,this.onTouchWarningTooltip,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),j.addTargetWithActionForControlEvents(this,this.onTouchWarningTooltip,cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE),j.addTargetWithActionForControlEvents(this,this.onTouchWarningTooltip,cc.CONTROL_EVENT_TOUCH_CANCEL);var k=ccSize(h);null==this.tooltip_box&&(this.tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.tooltip_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.tooltip_box.setPosition(.5*k.width,k.height+5),this.tooltip_box.setVisible(!1),this.tooltip_box.setGlobalZOrder(1e6),h.addChild(this.tooltip_box)),null==this.tooltip_content&&(this.tooltip_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.tooltip_content.setAnchorPoint(ANCHOR_MIDDLE()),this.tooltip_box.addChild(this.tooltip_content),this.tooltip_content.setGlobalZOrder(1000002))}this.m_leader_node=new WeeklyDeckReadyLeaderNode,this.m_leader_node.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_leader_node.setPosition(17,98),b.addChild(this.m_leader_node),this.m_game_type==db.BattleGameType.GreatWallDungeon&&(g.setPosition(17,162),this.m_leader_node.setPosition(17,88));var l=new LabelButton("btn_16_off.png","btn_16_on.png","",ccui.Widget.PLIST_TEXTURE);l.setFont(LABEL_FONT_INDEX.FONT_241),l.setString("陣形"),l.setAnchorPoint(cc.p(0,0)),l.setPosition(0,16),b.addChild(l),l.addClickEventListener(function(a){TutorialContextV2.getInstance().IsCompleteAllTutorial()&&MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],NOTIFY_MENU_BATTLE_FORM)}.bind(this));var m=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);m.setFont(LABEL_FONT_INDEX.FONT_241),this.m_game_type==db.BattleGameType.GreatWallDungeon?m.setString(res_str("label_great_wall_dungeon_arrangement")):m.setString(res_str("btn_label_arrangement")),m.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),m.setPosition(ccWidth(l),16),m.addClickEventListener(function(a){TutorialContextV2.getInstance().IsCompleteAllTutorial()&&MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],NOTIFY_MENU_YUNHEE_SET)}.bind(this)),b.addChild(m);var n=new ccui.Button("btn_main_banner_arrow_off.png","btn_main_banner_arrow_on.png","",ccui.Widget.PLIST_TEXTURE);n.setAnchorPoint(ZERO()),n.setPosition(0,300),b.addChild(n),n.addClickEventListener(function(a){MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],btn_left_arrow)}.bind(this));var o=new ccui.Button("btn_main_banner_arrow_off.png","btn_main_banner_arrow_on.png","",ccui.Widget.PLIST_TEXTURE);o.setRotation(180),o.setAnchorPoint(ZERO()),o.setPosition(ccPosX(this.m_deckBoxLayer)+ccWidth(this.m_deckBoxLayer)+ccWidth(o)+7,300+ccHeight(o)),b.addChild(o,99999999999),o.addClickEventListener(function(a){MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],btn_right_arrow)}.bind(this));var p=cc.Sprite.create("#img_battletech.png");return p.setAnchorPoint(ZERO()),p.setPosition(343,402),b.addChild(p),b},getDeckLayer:function(){var a=new cc.Layer,troops_num=this.getCurrentTroopsNum(),partyContainer=new YunheeTroopsItemContainer;a.addChild(partyContainer);var b=[];GeneralService.getInstance().getUserGeneralInfoList(b),this.m_game_type==db.BattleGameType.GreatWallDungeon&&GreatWallService.getInstance().checkGreatWallDungeonPartInGenerals(b);for(var c=0;c<this.m_userTroopsList.length;c++)if(this.m_userTroopsList[c].troops_num==troops_num)for(var d=0;d<b.length;d++)this.m_userTroopsList[c].gnrl_num==b[d].gnrl_num&&partyContainer.addPartyItem(this.m_userTroopsList[c],b[d],this.m_game_type);return a.setContentSize(ccSize(partyContainer)),a},getNpcDeckLayer:function(){var b=new cc.Layer,m=MasterManager.getInstance(),npc=m.get_EventRaidDungeonNpc(NetService().get_Event_Raid_Dungeon_idx(),1),n=m.get_NpcGeneral(npc.npc1_idx),boss_image="";return boss_image=n.gnrl_group<100?RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(n.gnrl_group,2)+".png":RES_CDN_DEFULT+"card_war_boss/"+n.gnrl_group+".png",resourceLoader(boss_image,function(){var a=cc.Sprite.create(boss_image);a.setAnchorPoint(ANCHOR_TOP_RIGHT()),a.setPosition(ccWidth(b),ccHeight(b)),b.addChild(a)}.bind(this)),b},setUserGeneralTroopsInfo:function(a){this.m_userTroopsList=a},changeYhTeam:function(a){var b=GameDefault.getInstance(),troops_num=a;this.m_game_type==db.BattleGameType.Mission?b.setUserTroopsNum(troops_num):this.m_game_type==db.BattleGameType.WeeklyDungeon?b.setUserWeeklyTroopsNum(troops_num):this.m_game_type==db.BattleGameType.Mussang?b.setUserMussangTroopsNum(troops_num):this.m_game_type==db.BattleGameType.EventDungeon?b.setUserEventDungeonTroopsNum(troops_num):this.m_game_type==db.BattleGameType.DailyDungeon?b.setUserDailyDungeonTroopsNum(troops_num):this.m_game_type==db.BattleGameType.RaidDungeon?b.setUserRaidBossTroopsNum(troops_num):this.m_game_type==db.BattleGameType.GreatWallDungeon?b.setUserGreatWallTroopsNum(troops_num):this.m_game_type==db.BattleGameType.TowerDungeon?b.setUserTowerDungeonTroopsNum(troops_num):this.m_game_type==db.BattleGameType.OnceADayDungeon?b.setUserOnceADayDungeonTroopsNum(troops_num):this.m_game_type==db.BattleGameType.EventRaidDungeon&&b.setUserEventRaidDungeonTroopsNum(troops_num),this.updateTroopsBtns();var c=0,user_cost_bnd={};user_cost_bnd=this.m_game_type==db.BattleGameType.GreatWallDungeon?(c=GreatWallService.getInstance().getGreatWallTroopsCost(troops_num),GreatWallService.getInstance().getGreatWallTroopsTotalCost(troops_num)):(c=GeneralService.getInstance().getTroopsCost(troops_num),GeneralService.getInstance().getUserTotalCost(troops_num)),this.m_user_cost_label.setString("cost "+c+"/"+user_cost_bnd.cost),this.m_deckBoxLayer.removeFromParent(),this.m_deckBoxLayer=this.getDeckLayer(),this.m_deckBoxLayer.setAnchorPoint(ZERO()),this.m_deckBoxLayer.setPosition(55,224),this.m_game_type==db.BattleGameType.GreatWallDungeon&&this.m_deckBoxLayer.setPosition(55,191),this.m_leftLayer.addChild(this.m_deckBoxLayer),this.updateLeaderSkill(troops_num)},updateLeaderSkill:function(a){for(var b=0,idx=0;idx<this.m_userTroopsList.length;idx++)if(this.m_userTroopsList[idx].troops_num==a&&this.m_userTroopsList[idx].is_leader){b=this.m_userTroopsList[idx].gnrl_id;break}if(0==b)this.m_leader_node.setLeaderSkillId(0);else{var c=MasterManager.getInstance().get_General(b);if(0==c.leader_skill_id||99999==c.leader_skill_id){c.special_leader_skill_id=c.special_leader_skill_id+"";var d=c.special_leader_skill_id.split(",");if(0<d.size()){var e=1*d.at(0);this.m_leader_node.setSLeaderSkillId(e)}}else this.m_leader_node.setLeaderSkillId(c.leader_skill_id)}},getSortLayer:function(){var b=new cc.Layer,btn_class_sort=new LabelButton("btn_02_off.png","btn_02_on.png","",ccui.Widget.PLIST_TEXTURE);btn_class_sort.setFont(LABEL_FONT_INDEX.FONT_201),btn_class_sort.setString("等級順"),btn_class_sort.setAnchorPoint(ZERO()),btn_class_sort.setPosition(ZERO()),btn_class_sort.addClickEventListener(function(a){this.m_friend_select_idx=-1,this.setSort(FriendSelectEnum.sort_class)}.bind(this)),b.addChild(btn_class_sort);var c=new LabelButton("btn_02_off.png","btn_02_on.png","",ccui.Widget.PLIST_TEXTURE);if(c.setFont(LABEL_FONT_INDEX.FONT_201),c.setFont(LABEL_FONT_INDEX.FONT_202),c.setString("レベル順"),c.setAnchorPoint(ZERO()),c.setPosition(0,btn_class_sort.y+ccHeight(btn_class_sort)),c.addClickEventListener(function(a){this.m_friend_select_idx=-1,this.setSort(FriendSelectEnum.sort_lv)}.bind(this)),b.addChild(c),USE_FRIEND_SPEICAL_EFFECT&&this.m_game_type==db.BattleGameType.EventDungeon){var d=new LabelButton("btn_02_off.png","btn_02_on.png","",ccui.Widget.PLIST_TEXTURE);d.setFont(LABEL_FONT_INDEX.FONT_201),d.setString(res_str("btn_sort_dungeon_buff")),d.setAnchorPoint(ZERO()),d.setPosition(0,ccPosY(c)+ccHeight(c)),d.addClickEventListener(function(a){this.m_friend_select_idx=-1,this.setSort(FriendSelectEnum.sort_special_effect)}.bind(this)),b.addChild(d)}return this.m_game_type==db.BattleGameType.EventDungeon?b.setContentSize(111,120):b.setContentSize(111,80),b},runActionSortButton:function(){this.m_isSortBtnVisible?(this.m_sortLayer.setVisible(!1),this.m_isSortBtnVisible=!1):(this.m_sortLayer.setVisible(!0),this.m_isSortBtnVisible=!0)},setSort:function(a){if(this.m_sort!=a){switch(a){case FriendSelectEnum.sort_class:this.m_btn_sort.setString("等級順");break;case FriendSelectEnum.sort_lv:this.m_btn_sort.setString("レベル順");break;case FriendSelectEnum.sort_special_effect:this.m_game_type==db.BattleGameType.EventDungeon&&this.m_btn_sort.setString(res_str("btn_sort_dungeon_buff"))}this.m_sort=a,USE_EVENT_DUNGEON_SAVE_FRIEND_SORT_INDEX&&GameDefault.getInstance().SetEventDungeonFriendSortIdx(this.m_sort),this.sort()}this.runActionSortButton()},setDesc:function(){this.m_isSortDesc?(this.m_isSortDesc=!1,this.m_btn_sort_2.loadTexturePressed("btn_align_top_on.png",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_2.loadTextureNormal("btn_align_top_off.png",ccui.Widget.PLIST_TEXTURE)):(this.m_isSortDesc=!0,this.m_btn_sort_2.loadTexturePressed("btn_align_bottom_on.png",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_2.loadTextureNormal("btn_align_bottom_off.png",ccui.Widget.PLIST_TEXTURE)),this.sort()},sort:function(){0==this.m_isSortDesc?this.m_sort==FriendSelectEnum.sort_lv?(this.m_frnd_list=stable(this.m_frnd_list,function(l,r){return l.partner_gnrl_lv>r.partner_gnrl_lv}),this.m_frnd_list=stable(this.m_frnd_list,function(l,r){return l.helper_type>r.helper_type})):this.m_sort==FriendSelectEnum.sort_special_effect?this.m_frnd_list=stable(this.m_frnd_list,function(l,r){return null==l.special_eff&&(l.special_eff=0),null==r.special_eff&&(r.special_eff=0),l.special_eff>r.special_eff}):(this.m_frnd_list=stable(this.m_frnd_list,function(l,r){return l.partner_gnrl_class>r.partner_gnrl_class}),this.m_frnd_list=stable(this.m_frnd_list,function(l,r){return l.helper_type>r.helper_type})):this.m_sort==FriendSelectEnum.sort_lv?(this.m_frnd_list=stable(this.m_frnd_list,function(l,r){return l.partner_gnrl_lv<r.partner_gnrl_lv}),this.m_frnd_list=stable(this.m_frnd_list,function(l,r){return l.helper_type>r.helper_type})):this.m_sort==FriendSelectEnum.sort_special_effect?this.m_frnd_list=stable(this.m_frnd_list,function(l,r){return null==l.special_eff&&(l.special_eff=0),null==r.special_eff&&(r.special_eff=0),l.special_eff<r.special_eff}):(this.m_frnd_list=stable(this.m_frnd_list,function(l,r){return l.partner_gnrl_class<r.partner_gnrl_class}),this.m_frnd_list=stable(this.m_frnd_list,function(l,r){return l.helper_type>r.helper_type})),null!=this.m_friend_select_tv&&this.m_friend_select_tv.reloadData()},checkNeedKeyWeeklyDungeon:function(a){var c=a,is_expense_dec=!1,now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),nn=moment(now).valueOf();for(var b in list_Global_Booster_Event_V2){var d=moment(b.begin_dt),et=moment(b.end_dt),bb=d.valueOf(),ee=et.valueOf();if(bb<=nn&&nn<=ee&&b.booster_type==BOOSTER_TYPE_V2_WEEKLY_DUNGEON&&b.variation_type==BOOSTER_VARIATION_TYPE_V2_EXPENSE_DEC&&b.item_type==BOOSTER_ITEM_TYPE_V2_ENTRANCE_TICKET){if(0==b.value_1){c=this.m_weekly_difficulty.weekly_difficulty.need_key-this.m_weekly_difficulty.weekly_difficulty.need_key*b.variation_value/100,is_expense_dec=!0;break}if(b.value_1==this.m_weekly_difficulty.weekly_difficulty.weekly_idx){c=this.m_weekly_difficulty.weekly_difficulty.need_key-this.m_weekly_difficulty.weekly_difficulty.need_key*b.variation_value/100,is_expense_dec=!0;break}}}return is_expense_dec&&(c=Math.max(c,1)),0==c&&(c=this.m_weekly_difficulty.weekly_difficulty.need_key),c},checkNeedKeyGreatWallDungeon:function(){var a=0;return this.IsOpenGreatWallDungeon()&&(a=this.m_great_wall_dungeon.great_wall_dungeon.need_key),a},checkNeedKeyTicketMussang:function(){var a=0,need_ticket=0,is_expense_dec=!1,now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),nn=moment(now).valueOf(),list_Global_Booster_Event_V2=(new NetService).get_Global_Booster_Event();if(0!=list_Global_Booster_Event_V2.size())for(var b in list_Global_Booster_Event_V2){var c=moment(b.begin_dt),et=moment(b.end_dt),bb=c.valueOf(),ee=et.valueOf();if(bb<=nn&&nn<=ee&&b.booster_type==BOOSTER_TYPE_V2_MUSSANG&&b.variation_type==BOOSTER_VARIATION_TYPE_V2_EXPENSE_DEC&&b.item_type==BOOSTER_ITEM_TYPE_V2_ENTRANCE_TICKET){if(0==b.value_1){a=this.m_mussang.mussang.need_key-this.m_mussang.mussang.need_key*b.variation_value/100,need_ticket=this.m_mussang.mussang.need_ticket-this.m_mussang.mussang.need_ticket*b.variation_value/100,is_expense_dec=!0;break}if(b.value_1==this.m_mussang.mussang_step){a=this.m_mussang.mussang.need_key-this.m_mussang.mussang.need_key*b.variation_value/100,need_ticket=this.m_mussang.mussang.need_ticket-this.m_mussang.mussang.need_ticket*b.variation_value/100,is_expense_dec=!0;break}}}return is_expense_dec&&(a=Math.max(a,1),need_ticket=Math.max(need_ticket,1)),0==a&&(a=this.m_mussang.mussang.need_key),0==need_ticket&&(need_ticket=this.m_mussang.mussang.need_ticket),[a,need_ticket]},checkNeedKeyEventOnceADayDungeon:function(a){var b=0,is_expense_dec=!1,user_service=UserService.getInstance();if(user_service.isBeginnerBooster()){var c=user_service.getMtBeginnerBooster(BEGINNER_BOOSTER_TYPE_CONSUME_DECREASE,0,CONSUME_DECREASE_KEY);0<c.value&&(c.battle_type==BATTLE_DUNGEON_TYPE_ONCE_A_DAY_DUNGEON||c.battle_type==BATTLE_DUNGEON_TYPE_ALL)&&(b=Math.floor(this.m_once_a_day_dungeon.dungeon.need_key-this.m_once_a_day_dungeon.dungeon.need_key*c.value/1e4),is_expense_dec=!0)}is_expense_dec&&(b=Math.max(b,0)),0==b&&(b=this.m_once_a_day_dungeon.dungeon.need_key)},checkNeedKeyEventDungeon:function(a){var c=a,is_expense_dec=!1,now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),nn=moment(now).valueOf();for(var b in list_Global_Booster_Event_V2){var d=moment(b.begin_dt),et=moment(b.end_dt),bb=d.valueOf(),ee=et.valueOf();if(bb<=nn&&nn<=ee&&b.booster_type==BOOSTER_TYPE_V2_MARATHON_DUNGEON&&b.variation_type==BOOSTER_VARIATION_TYPE_V2_EXPENSE_DEC&&b.item_type==BOOSTER_ITEM_TYPE_V2_ENTRANCE_TICKET){if(0==b.value_1){c=this.m_event_dungeon.event_dungeon.need_key-this.m_event_dungeon.event_dungeon.need_key*b.variation_value/100,is_expense_dec=!0;break}if(b.value_1==this.m_event_dungeon.event_dungeon.event_dungeon_idx){c=this.m_event_dungeon.event_dungeon.need_key-this.m_event_dungeon.event_dungeon.need_key*b.variation_value/100,is_expense_dec=!0;break}}}var e=UserService.getInstance();if(e.isBeginnerBooster()){var f=[];0<(f=e.getMtBeginnerBooster(BEGINNER_BOOSTER_TYPE_CONSUME_DECREASE,0,CONSUME_DECREASE_KEY,f)).value&&(f.battle_type==BATTLE_DUNGEON_TYPE_EVENT_DUNGEON||f.battle_type==BATTLE_DUNGEON_TYPE_ALL)&&(c=Math.floor(this.m_event_dungeon.event_dungeon.need_key-this.m_event_dungeon.event_dungeon.need_key*f.value/1e4),is_expense_dec=!0)}return is_expense_dec&&(c=Math.max(c,0)),0==c&&(c=this.m_event_dungeon.event_dungeon.need_key),c},checkNeedKeyMission:function(a){var c=a,is_expense_dec=!1;if(TutorialContextV2.getInstance().IsCompleteAllTutorial()){var d=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),nn=moment(d).valueOf(),list_Global_Booster_Event_V2=(new NetService).get_Global_Booster_Event();if(0!=list_Global_Booster_Event_V2.size())for(var b in list_Global_Booster_Event_V2){var e=moment(b.begin_dt),et=moment(b.end_dt),bb=e.valueOf(),ee=et.valueOf();if(bb<=nn&&nn<=ee&&b.booster_type==BOOSTER_TYPE_V2_STORY&&b.variation_type==BOOSTER_VARIATION_TYPE_V2_EXPENSE_DEC&&b.item_type==BOOSTER_ITEM_TYPE_V2_ENTRANCE_TICKET){if(0==b.value_1){c=this.m_mission.mission.need_key-this.m_mission.mission.need_key*b.variation_value/100,is_expense_dec=!0;break}if(0==b.value_2){if(b.value_1==this.m_mission.mission.main_story_id){c=this.m_mission.mission.need_key-this.m_mission.mission.need_key*b.variation_value/100,is_expense_dec=!0;break}}else if(b.value_1==this.m_mission.mission.main_story_id&&b.value_2==this.m_mission.mission.main_mission_num){c=this.m_mission.mission.need_key-this.m_mission.mission.need_key*b.variation_value/100,is_expense_dec=!0;break}}}is_expense_dec&&(c=Math.max(c,1))}if(0==MasterManager.getInstance().get_TimeFunction(9).value){var f=UserService.getInstance();if(f.isBeginnerBooster()){var g=[];0<(g=f.getMtBeginnerBooster(BEGINNER_BOOSTER_TYPE_CONSUME_DECREASE,0,CONSUME_DECREASE_KEY,g)).value&&(g.battle_type==BATTLE_DUNGEON_TYPE_STORY||g.battle_type==BATTLE_DUNGEON_TYPE_ALL)&&(c=Math.floor(this.m_mission.mission.need_key-this.m_mission.mission.need_key*g.value/1e4),c=Math.max(c,1))}}return 0==c&&(c=this.m_mission.mission.need_key),c},reqMissionBegin:function(){var b=BattleContext._getInstance(),mission_id=b.getMissionID();if(0==mission_id)return this.m_message_box.setText("有効なステージIDではありません。"),this.m_message_box.setText("\n"),this.m_message_box.setText("ストーリーへ移動します。"),this.m_message_box.addButtonInfo(new MessageButtonInfo("確認",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.schedule(function(a){MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.back_scene)},0,0,0,"mission_id_invalid"),this.m_message_box.hide(!1)}.bind(this))),this.m_message_box.is_show()&&this.m_message_box.hide(!1),void this.m_message_box.show();var c="";c=""==b.getFriendID()?"":b.getFriendID();var d={};d.opcode=net.OP.op_main_mission_battle_begin_v2,d.troops_num=this.getCurrentTroopsNum(),d.mission_id=mission_id,d.frnd_user_id=c,d.helper_type=b.getHelperType(),this.getParent().network_write(d),this.m_friend_select_scene.setEnableBackBtn(!1)},reqWeeklyDungeonBegin:function(){var a=this.getCurrentTroopsNum();if(0<this.m_weekly_difficulty.weekly_difficulty.weekly_idx){var b={};b.opcode=net.OP.op_weekly_dungeon_battle_begin,b.weekly_idx=this.m_weekly_difficulty.weekly_difficulty.weekly_idx,b.weekly_difficulty_id=this.m_weekly_difficulty.weekly_difficulty.dungeon_idx,b.troops_num=a,SceneManager.getInstance().getRunningScene().network_write(b),this.m_friend_select_scene.setEnableBackBtn(!1)}},reqTowerDungeonBegin:function(){},reqMussangStepBegin:function(){var a=BattleContext._getInstance(),troops_num=this.getCurrentTroopsNum(),req={};(req.opcode=net.OP.op_mussang_step_battle_begin,req.mussang_id=a.getMussangId(),req.period_group_idx=a.getMussangPeriodGroupIdx(),req.period_idx=a.getMussangPeriodIdx(),req.troops_num=troops_num,0<req.mussang_id)&&(SceneManager.getInstance().getRunningScene().network_write(req),this.m_friend_select_scene.setEnableBackBtn(!1))},reqEventOnceADayDungeonBegin:function(){var a=BattleContext._getInstance(),troops_num=this.getCurrentTroopsNum(),dungeon=a.getEventOnceADayDungeonData(),req={};(req.opcode=net.OP.op_event_once_a_day_dungeon_battle_begin,req.event_dungeon_period_idx=dungeon.period.event_dungeon_period_idx,req.event_dungeon_once_a_day_idx=dungeon.dungeon.event_dungeon_once_a_day_idx,req.troops_num=troops_num,0!=req.event_dungeon_once_a_day_idx)&&(SceneManager.getInstance().getRunningScene().network_write(req),this.m_friend_select_scene.setEnableBackBtn(!1))},reqEventDungeonBegin:function(){var a=BattleContext._getInstance(),troops_num=this.getCurrentTroopsNum(),dungeon=a.getEventDungeonData();if(0<dungeon.event_dungeon_idx){if(EventDungeonService.getInstance().checkEventDungeonBattleGeneralInSearchTroops(dungeon.event_dungeon_period.event_dungeon_period_idx,troops_num))return void MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.troops_in_search_troops_general);var b={};b.opcode=net.OP.op_event_dungeon_battle_begin,b.event_dungeon_idx=dungeon.event_dungeon.event_dungeon_idx,b.event_dungeon_period_idx=dungeon.event_dungeon_period.event_dungeon_period_idx,b.frnd_user_id=a.getFriendID(),b.helper_type=a.getHelperType(),b.troops_num=troops_num,SceneManager.getInstance().getRunningScene().network_write(b),this.m_friend_select_scene.setEnableBackBtn(!1)}},reqGreatWallDungeonBegin:function(){var a=BattleContext._getInstance(),troops_num=this.getCurrentTroopsNum(),dungeon=a.getGreatWallDungeonData(),great_wall_dungeon_period_idx=GreatWallService.getInstance().getCurrentGreatWallPeriodIdx();if(0<great_wall_dungeon_period_idx){var b={};b.opcode=net.OP.op_great_wall_dungeon_battle_begin,b.great_wall_dungeon_period_idx=great_wall_dungeon_period_idx,b.great_wall_dungeon_group_idx=dungeon.great_wall_dungeon_group_idx,b.great_wall_dungeon_idx=dungeon.great_wall_dungeon_idx,b.troops_num=troops_num,SceneManager.getInstance().getRunningScene().network_write(b),this.m_friend_select_scene.setEnableBackBtn(!1)}},reqDailyDungeonBegin:function(){var a=BattleContext._getInstance(),troops_num=this.getCurrentTroopsNum(),dungeon=a.getDailyDungeonData();if(0<dungeon.daily_dungeon_idx){var b={};b.opcode=net.OP.op_daily_dungeon_battle_begin,b.daily_dungeon_idx=dungeon.daily_dungeon.daily_dungeon_idx,b.daily_dungeon_period_idx=dungeon.daily_dungeon_period.daily_dungeon_period_idx,b.troops_num=troops_num,b.cost_func=BONUS_TYPE_KEY;var c=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),today=moment(c).format("YYYY-MM-DD");b.today=today;var d=SceneManager.getInstance().getMainScene();GameClient().write(b,d.onNetworkEvent,d),this.m_friend_select_scene.setEnableBackBtn(!1)}},battleStart:function(){var a=NetService().get_UserItemInfo_V2(),troops_num=this.getCurrentTroopsNum();return this.IsEmptyTroops(troops_num)?(this.m_friend_select_scene.setEnableBackBtn(!0),void MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.popup_empty_troops)):UserService.getInstance().isEnoughYunheeBound()||UserService.getInstance().isEnoughMaterialBound()?UserService.getInstance().isEnoughYunheeBound()?UserService.getInstance().isEnoughMaterialBound()?this.IsEnoughtEquipmentBound()?void this.IsEnoughtYunheeBound(this.send_battle.bind(this),a):(this.m_friend_select_scene.setEnableBackBtn(!0),void MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.over_equipment_bound)):(this.m_friend_select_scene.setEnableBackBtn(!0),void MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.over_general_material_bound)):(this.m_friend_select_scene.setEnableBackBtn(!0),void MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.over_yunhee_bound)):(this.m_friend_select_scene.setEnableBackBtn(!0),void MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.over_all_bound))},send_battle:function(a){var b=0,need_ticket=0,troops_num=this.getCurrentTroopsNum();if(this.m_game_type==db.BattleGameType.Mission){if(b=this.checkNeedKeyMission(0),a.key_cnt<b)return this.m_start_btn.setEnabled(!0),this.m_friend_select_scene.setEnableBackBtn(!0),void SceneManager.getInstance().getRunningScene().showNotEnoughKey(b);this.reqMissionBegin()}else if(this.m_game_type==db.BattleGameType.WeeklyDungeon)if(this.IsOpenWeeklyDungeon()){if(b=this.checkNeedKeyWeeklyDungeon(b),a.key_cnt<b)return this.m_start_btn.setEnabled(!0),this.m_friend_select_scene.setEnableBackBtn(!0),void SceneManager.getInstance().getRunningScene().showNotEnoughKey(b);this.reqWeeklyDungeonBegin()}else this.m_start_btn.setEnabled(!0),this.m_friend_select_scene.setEnableBackBtn(!0),this.showNotOpenWeeklyDungeon();else if(this.m_game_type==db.BattleGameType.Mussang){var c=this.checkNeedKeyTicketMussang();if(b=c[0],need_ticket=c[1],a.key_cnt<b)return this.m_start_btn.setEnabled(!0),this.m_friend_select_scene.setEnableBackBtn(!0),void SceneManager.getInstance().getRunningScene().showNotEnoughKey(b);if(a.ticket_cnt<need_ticket)return this.m_start_btn.setEnabled(!0),this.m_friend_select_scene.setEnableBackBtn(!0),void SceneManager.getInstance().getRunningScene().showNotEnoughTicket(need_ticket);this.reqMussangStepBegin()}else if(this.m_game_type==db.BattleGameType.TowerDungeon)this.reqTowerDungeonBegin();else if(this.m_game_type==db.BattleGameType.EventDungeon)if(this.IsOpenEventDungeon()){if(b=this.checkNeedKeyEventDungeon(b),a.key_cnt<b)return this.m_start_btn.setEnabled(!0),this.m_friend_select_scene.setEnableBackBtn(!0),void SceneManager.getInstance().getRunningScene().showNotEnoughKey(b);this.reqEventDungeonBegin()}else this.m_start_btn.setEnabled(!0),this.m_friend_select_scene.setEnableBackBtn(!0),MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.invalid_entrance_running_time);else if(this.m_game_type==db.BattleGameType.OnceADayDungeon)if(this.IsOpenOnceADayDungeon()){if(this.checkNeedKeyEventOnceADayDungeon(b),a.key_cnt<b)return this.m_friend_select_scene.setEnableBackBtn(!0),this.m_start_btn.setEnabled(!0),void SceneManager.getInstance().getRunningScene().showNotEnoughKey(b);this.reqEventOnceADayDungeonBegin()}else this.m_friend_select_scene.setEnableBackBtn(!0),this.m_start_btn.setEnabled(!0),MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.invalid_entrance_running_time);else if(this.m_game_type==db.BattleGameType.DailyDungeon)if(this.IsOpenDailyDungeon()){var d=MasterManager.getInstance().get_DailyDungeonPeriod(this.m_daily_dungeon.daily_dungeon_period.daily_dungeon_period_idx);if(this.getTodayDailyDungeonPeriod(this.m_daily_dungeon.daily_dungeon_period.daily_dungeon_period_idx).key_cost_challenge_count>=d.enable_key_entrance_count)return this.m_friend_select_scene.setEnableBackBtn(!0),this.m_start_btn.setEnabled(!0),void MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.invalid_entrance_limit_over);this.reqDailyDungeonBegin()}else this.m_friend_select_scene.setEnableBackBtn(!0),this.m_start_btn.setEnabled(!0),MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.invalid_entrance_running_time);else if(this.m_game_type==db.BattleGameType.GreatWallDungeon&&this.IsOpenGreatWallDungeon()){for(var e=GreatWallService.getInstance().getGreatWallTroopsGeneralList(troops_num),partin_generals=NetService().get_great_wall_troops_info().partin_generals,is_first_battle_partin=!1,idx=0;idx<e.length;idx++){var g=e[idx],found=0,found_is=!1;for(var p in partin_generals)if(partin_generals[p].gnrl_id==g.gnrl_id&&partin_generals[p].gnrl_num==g.gnrl_num){found_is=!0,found=p;break}if(0!=found_is&&"n"==partin_generals[found].battle_start_yn){is_first_battle_partin=!0;break}}if(is_first_battle_partin)return void MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.great_wall_first_partin_battle);this.reqGreatWallDungeonBegin()}},battleSkipStart:function(){var a=NetService().get_UserItemInfo_V2(),troops_num=this.getCurrentTroopsNum(),need_key=0;if(this.IsEmptyTroops(troops_num))MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.popup_empty_troops);else if(UserService.getInstance().isEnoughYunheeBound()||UserService.getInstance().isEnoughMaterialBound())if(UserService.getInstance().isEnoughYunheeBound())if(UserService.getInstance().isEnoughMaterialBound())if(this.IsEnoughtEquipmentBound()){if(this.m_game_type==db.BattleGameType.Mission){need_key=this.checkNeedKeyMission(0);var b=this.m_skip_ticket_count*need_key;if(a.key_cnt<b)return void SceneManager.getInstance().getRunningScene().showNotEnoughKey(b);this.showDungeonSkipMsgBox(need_key)}else if(this.m_game_type==db.BattleGameType.WeeklyDungeon)if(this.IsOpenWeeklyDungeon()){need_key=this.checkNeedKeyWeeklyDungeon(need_key);b=this.m_skip_ticket_count*need_key;if(a.key_cnt<b)return void SceneManager.getInstance().getRunningScene().showNotEnoughKey(b);this.showDungeonSkipMsgBox(need_key)}else this.showNotOpenWeeklyDungeon();else if(this.m_game_type==db.BattleGameType.EventDungeon)if(this.IsOpenEventDungeon()){need_key=this.checkNeedKeyEventDungeon(need_key);b=this.m_skip_ticket_count*need_key;if(a.key_cnt<b)return void SceneManager.getInstance().getRunningScene().showNotEnoughKey(b);this.showDungeonSkipMsgBox(need_key)}else MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.invalid_entrance_running_time)}else MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.over_equipment_bound);else MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.over_general_material_bound);else MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.over_yunhee_bound);else MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.over_all_bound)},createStartBtn:function(c){var d=0,need_ticket=0;if(this.m_game_type==db.BattleGameType.Mission)d=this.checkNeedKeyMission(0);else if(this.m_game_type==db.BattleGameType.WeeklyDungeon)d=this.checkNeedKeyWeeklyDungeon(d);else if(this.m_game_type==db.BattleGameType.Mussang){var e=this.checkNeedKeyTicketMussang();d=e[0],need_ticket=e[1]}else this.m_game_type==db.BattleGameType.EventDungeon?d=this.checkNeedKeyEventDungeon(d):this.m_game_type==db.BattleGameType.DailyDungeon||this.m_game_type==db.BattleGameType.GreatWallDungeon||this.m_game_type==db.BattleGameType.TowerDungeon||this.m_game_type==db.BattleGameType.OnceADayDungeon&&this.checkNeedKeyEventOnceADayDungeon(d);var f=cc.Sprite.create("#btn_03_off.png");this.m_game_type==db.BattleGameType.EventDungeon?0!=this.m_event_dungeon.task_list.length?this.m_start_btn=new LabelButton("btn_45_off.png","btn_45_on.png","btn_45_none.png",ccui.Widget.PLIST_TEXTURE):this.m_start_btn=new LabelButton("btn_03_off.png","btn_03_on.png","",ccui.Widget.PLIST_TEXTURE):this.m_game_type==db.BattleGameType.WeeklyDungeon?0!=this.m_weekly_difficulty.task_list.length?this.m_start_btn=new LabelButton("btn_45_off.png","btn_45_on.png","btn_45_none.png",ccui.Widget.PLIST_TEXTURE):this.m_start_btn=new LabelButton("btn_03_off.png","btn_03_on.png","",ccui.Widget.PLIST_TEXTURE):this.m_game_type==db.BattleGameType.Mission&&0!=this.m_mission.task_list.length?this.m_start_btn=new LabelButton("btn_45_off.png","btn_45_on.png","btn_45_none.png",ccui.Widget.PLIST_TEXTURE):this.m_start_btn=new LabelButton("btn_03_off.png","btn_03_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_start_btn.setFont(LABEL_FONT_INDEX.FONT_241),this.m_start_btn.setString("スタート"),this.m_start_btn.setOffsetX(-50),this.m_start_btn.setAnchorPoint(ZERO()),this.m_start_btn.setPosition(17,16),this.m_start_btn.setSoundPath("SE_button_key.mp3"),this.m_start_btn.addClickEventListener(function(b){this.m_friend_select_scene.m_is_battle_start=!0,this.m_start_btn.setEnabled(!1),this.scheduleOnce(function(a){this.battleStart()},.4,"battle_begin")}.bind(this)),c.addChild(this.m_start_btn,2);var g={};if(g=MasterTable.getInstance().get_RewardCampaignUi(CAMPAIGN_DUNGEON_TYPE_STORY,CAMPAIGN_POSITION_TYPE_BATTLE_ENTERANCE_BTN,g),this.m_game_type==db.BattleGameType.Mission&&(1011==this.m_mission.mission.main_mission_id&&this.m_start_btn.setTutorialTag(TUTORIAL_TAG_PAGE_1_BATTLE_START),null!=g.dugeon_type&&0!=g.dugeon_type&&(g.value>=this.m_mission.mission.main_story_id||0==g.value))){var h=cc.Sprite.create(RES_CDN_DEFULT+cmString("common/%s",g.image_name));h.setAnchorPoint(ANCHOR_MIDDLE()),h.setPosition(ccCenter(this.m_start_btn).x,ccHeight(this.m_start_btn)),this.m_start_btn.addChild(h,2)}if(this.m_game_type==db.BattleGameType.Mussang){this.m_start_btn.setOffsetX(-100),(i=new cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",cc.Rect(10,10,10,10))).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),i.setPreferredSize(cc.size(66,38)),i.setPosition(.5*ccWidth(f)+50,.5*ccHeight(f)),this.m_start_btn.addChild(i),(n=cmLabel.getLabel(d,LABEL_FONT_INDEX.FONT_247)).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),n.setPosition(ccWidth(i)-10,.5*ccHeight(i)),i.addChild(n);var i,key_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_ic_key.png");key_icon.setAnchorPoint(ANCHOR_MIDDLE()),key_icon.setPosition(0,.5*ccHeight(i)),i.addChild(key_icon),(i=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",cc.Rect(10,10,10,10))).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),i.setPreferredSize(cc.size(66,38)),i.setPosition(.5*ccWidth(f)+70,.5*ccHeight(f)),this.m_start_btn.addChild(i);var j=cmLabel.getLabel(need_ticket,LABEL_FONT_INDEX.FONT_247);j.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),j.setPosition(ccWidth(i)-10,.5*ccHeight(i)),i.addChild(j);var k=cc.Sprite.create(RES_CDN_DEFULT+"menu_vs/img_vs_ic_key.png");k.setAnchorPoint(ANCHOR_MIDDLE()),k.setPosition(0,.5*ccHeight(i)),i.addChild(k)}else if(this.m_game_type==db.BattleGameType.OnceADayDungeon){(m=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero())).setContentSize(66,38),m.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),m.setPosition(240,ccCenter(this.m_start_btn).y),this.m_start_btn.addChild(m),(l=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_ic_key.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),l.setPosition(225,ccCenter(this.m_start_btn).y),this.m_start_btn.addChild(l),(n=cmLabel.getLabel(d,LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),n.setPosition(ccWidth(m)-10,ccCenter(m).y),m.addChild(n)}else if(this.m_game_type==db.BattleGameType.Mission||this.m_game_type==db.BattleGameType.WeeklyDungeon||this.m_game_type==db.BattleGameType.EventDungeon){var l;(m=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",cc.Rect(10,10,10,10))).setContentSize(66,38),m.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),m.setPosition(240,ccCenter(this.m_start_btn).y),this.m_start_btn.addChild(m),(l=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_ic_key.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),l.setPosition(225,ccCenter(this.m_start_btn).y),this.m_start_btn.addChild(l),(n=cmLabel.getLabel(d,LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),n.setPosition(ccWidth(m)-10,ccCenter(m).y),m.addChild(n)}else if(this.m_game_type==db.BattleGameType.DailyDungeon){var m;(m=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",cc.Rect(10,10,10,10))).setContentSize(66,38),m.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),m.setPosition(240,ccCenter(this.m_start_btn).y),this.m_start_btn.addChild(m);var n,period=MasterManager.getInstance().get_DailyDungeonPeriod(this.m_daily_dungeon.daily_dungeon_period.daily_dungeon_period_idx),challenge_log=this.getTodayDailyDungeonPeriod(this.m_daily_dungeon.daily_dungeon_period.daily_dungeon_period_idx),remain_try_count=period.enable_key_entrance_count-challenge_log.key_cost_challenge_count;remain_try_count<0&&(remain_try_count=0),(n=cmLabel.getLabel(remain_try_count+"/"+period.enable_key_entrance_count,LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),n.setPosition(ccWidth(m)-10,ccCenter(m).y),m.addChild(n)}else this.m_game_type==db.BattleGameType.TowerDungeon&&this.m_start_btn.setOffsetX(0)},createSkipTicketInfo:function(a,b){if(this.m_game_type==db.BattleGameType.Mission||this.m_game_type==db.BattleGameType.WeeklyDungeon||this.m_game_type==db.BattleGameType.EventDungeon){var c=cc.size(458,66),task_info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());if(task_info_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),task_info_box.setPosition(10,126),task_info_box.setPreferredSize(c),a.addChild(task_info_box),this.m_game_type!=db.BattleGameType.WeeklyDungeon){var d=cc.Sprite.create(RES_CDN_DEFULT+"menu_friend/img_friend_text.png");d.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),d.setScale(.6),d.setPosition(52,ccCenter(task_info_box).y+23),task_info_box.addChild(d);var e=cmLabel.getLabel(res_str("label_friend_helper_info_text"),LABEL_FONT_INDEX.FONT_1613);e.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),e.setPosition(88,ccCenter(task_info_box).y+23),task_info_box.addChild(e)}var f=cmLabel.getLabel(res_str("label_task_title"),LABEL_FONT_INDEX.FONT_201);f.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),f.setPosition(46,16),task_info_box.addChild(f);var g=this.getCompleteTaskCount(),task_offset_x=133,sakura_name="";sakura_name=this.m_game_type==db.BattleGameType.Mission?"sakura":"sakura_3",this.m_taskSakuraSprList.clear();for(var i=0;i<3;i++){var h=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_"+sakura_name+"_off.png");if(i<g){var j=RES_CDN_DEFULT+"menu_quest/img_story_"+sakura_name+"_on.png",frame2_texture=cc.textureCache.addImage(j),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));h.setSpriteFrame(frame2)}else{j=RES_CDN_DEFULT+"menu_quest/img_story_"+sakura_name+"_off.png",frame2_texture=cc.textureCache.addImage(j),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));h.setSpriteFrame(frame2)}h.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),h.setPosition(task_offset_x,13),h.setScale(.8),task_info_box.addChild(h),task_offset_x+=36,this.m_taskSakuraSprList.push(h)}this.m_have_skip_ticket_count=b.skip_ticket_count;var k=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_ic_skipticket.png");k.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),k.setPosition(269,6),k.setScale(.8),task_info_box.addChild(k),this.m_haveSkipTicketLabel=cmLabel.getLabel(cmString(res_str("label_task_skip_ticket_quantity")," "),LABEL_FONT_INDEX.FONT_201),this.m_haveSkipTicketLabel.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_haveSkipTicketLabel.setPosition(302,16),task_info_box.addChild(this.m_haveSkipTicketLabel),this.m_haveSkipTicketCountLabel=cmLabel.getLabel(Number(this.m_have_skip_ticket_count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_2011),this.m_haveSkipTicketCountLabel.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_haveSkipTicketCountLabel.setPosition(372,16),task_info_box.addChild(this.m_haveSkipTicketCountLabel)}},refrashSkipBtn:function(a){null!=this.m_rightLayer&&(this.m_have_skip_ticket_count=a,null!=this.m_haveSkipTicketCountLabel&&null!=this.m_haveSkipTicketCountLabel&&this.m_haveSkipTicketCountLabel.setString(Number(this.m_have_skip_ticket_count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_2011),this.createStartSkipBtn())},createStartSkipBtn:function(c){if(null!=c){if(this.m_game_type==db.BattleGameType.Mission||this.m_game_type==db.BattleGameType.WeeklyDungeon||this.m_game_type==db.BattleGameType.EventDungeon){this.m_itemMinusBtn=new ccui.Button("btn_spinner_minus_2_off.png","btn_spinner_minus_2_on.png","btn_spinner_minus_2_none.png",ccui.Widget.PLIST_TEXTURE),this.m_itemMinusBtn.setAnchorPoint(ZERO()),this.m_itemMinusBtn.setPosition(17,81),this.m_itemMinusBtn.addClickEventListener(function(a){this.onSkipTicketMinus()}.bind(this)),c.addChild(this.m_itemMinusBtn),this.m_itemPlusBtn=new ccui.Button("btn_spinner_plus_2_off.png","btn_spinner_plus_2_on.png","btn_spinner_plus_2_none.png",ccui.Widget.PLIST_TEXTURE),this.m_itemPlusBtn.setAnchorPoint(ZERO()),this.m_itemPlusBtn.setPosition(416,81),this.m_itemPlusBtn.addClickEventListener(function(a){this.onSkipTicketPlus()}.bind(this)),c.addChild(this.m_itemPlusBtn);var d=1;null!=this.m_weekly_difficulty&&(this.m_game_type==db.BattleGameType.EventDungeon?d="y"==this.m_event_dungeon.event_dungeon.two_times_yn?2:1:this.m_game_type==db.BattleGameType.WeeklyDungeon&&(d="y"==this.m_weekly_difficulty.weekly_difficulty.two_times_yn?2:1)),this.m_startBtn=new LabelButton("btn_46_off.png","btn_46_on.png","btn_46_none.png",ccui.Widget.PLIST_TEXTURE),this.m_startBtn.setFont(LABEL_FONT_INDEX.FONT_201),this.m_startBtn.setString(res_str("btn_label_skip")),this.m_startBtn.setOffsetX(-50),this.m_startBtn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_startBtn.setPosition(72,76),this.m_startBtn.setSoundPath("SE_button_key.mp3"),this.m_startBtn.addClickEventListener(function(b){this.scheduleOnce(function(a){this.battleSkipStart()}.bind(this),.4,"battle_begin")}.bind(this)),c.addChild(this.m_startBtn);var e=new cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero());e.setContentSize(cc.size(66,30)),e.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),e.setPosition(186,ccCenter(this.m_startBtn).y),this.m_startBtn.addChild(e);var f=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_ic_skipticket.png");f.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),f.setPosition(174,ccCenter(this.m_startBtn).y),this.m_startBtn.addChild(f),this.m_skipTicketCountLabel=cmLabel.getLabel(cmString("%d",d),LABEL_FONT_INDEX.FONT_2011),this.m_skipTicketCountLabel.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_skipTicketCountLabel.setPosition(ccWidth(e)-10,ccCenter(e).y),e.addChild(this.m_skipTicketCountLabel),(3!=this.getCompleteTaskCount()||this.getAmountSkipTicket(this.m_skip_ticket_count)>this.m_have_skip_ticket_count)&&(this.m_startBtn.setEnabled(!1),this.m_itemMinusBtn.setEnabled(!1),this.m_itemPlusBtn.setEnabled(!1))}}else(3!=this.getCompleteTaskCount()||this.getAmountSkipTicket(this.m_skip_ticket_count)>this.m_have_skip_ticket_count)&&(this.m_startBtn.setEnabled(!1),this.m_itemMinusBtn.setEnabled(!1),this.m_itemPlusBtn.setEnabled(!1))},createEventDungeonRaidStartBtn:function(b){var c=new LabelButton("btn_03_off.png","btn_03_on.png","",ccui.Widget.PLIST_TEXTURE);c.setFont(LABEL_FONT_INDEX.FONT_241),c.setString(res_str("label_start_mission")),c.setOffsetX(-50),c.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),c.setPosition(17,16),c.setSoundPath("SE_button_key.mp3"),c.addClickEventListener(function(a){this.battleStart()}.bind(this),.4,"battle_begin"),b.addChild(c,2)},initStartBtn:function(){null!=this.m_start_btn&&this.m_start_btn.setEnabled(!0)},updateTroopsBtns:function(){for(var a=this.getCurrentTroopsNum(),i=0;i<this.m_troops_btns.length;i++){var t=i+1;this.m_troops_btns[i].setEnabled(!(t==a))}},getCurrentTroopsNum:function(){var b=0,gd=GameDefault.getInstance();return this.m_game_type==db.BattleGameType.WeeklyDungeon?gd.getUserWeeklyTroopsNum().done(function(a){b=a}):this.m_game_type==db.BattleGameType.Mussang?gd.getUserMussangTroopsNum().done(function(a){b=a}):this.m_game_type==db.BattleGameType.Mission?1==USE_LOCAL_STORAGE_TROOPS_OFF?b=gd.getUserTroopsNum():gd.getUserTroopsNum().done(function(a){b=a}):this.m_game_type==db.BattleGameType.EventDungeon?gd.getUserEventDungeonTroopsNum().done(function(a){b=a}):this.m_game_type==db.BattleGameType.DailyDungeon?gd.getUserDailyDungeonTroopsNum().done(function(a){b=a}):this.m_game_type==db.BattleGameType.RaidDungeon?gd.getUserRaidBossTroopsNum().done(function(a){b=a}):this.m_game_type==db.BattleGameType.GreatWallDungeon?gd.getUserGreatWallTroopsNum().done(function(a){b=a}):this.m_game_type==db.BattleGameType.TowerDungeon?gd.getUserTowerDungeonTroopsNum().done(function(a){b=a}):this.m_game_type==db.BattleGameType.OnceADayDungeon?gd.getUserOnceADayDungeonTroopsNum().done(function(a){b=a}):this.m_game_type==db.BattleGameType.EventRaidDungeon&&gd.getUserEventRaidDungeonTroopsNum().done(function(a){b=a}),b},IsEmptyTroops:function(a){return 0==this.m_userTroopsList.filter(function(l){return l.troops_num==a}).length},IsOpenGreatWallDungeon:function(){var m=MasterManager.getInstance(),great_wall_dungeon_period_idx=GreatWallService.getInstance().getCurrentGreatWallPeriodIdx(),period=m.get_GreatWallDungeonPeriod(great_wall_dungeon_period_idx),now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),b=moment(period.begin_dt).valueOf(),e=moment(period.end_dt).valueOf();return b<=n&&n<=e},IsOpenDailyDungeon:function(){var a=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(a).valueOf(),b=this.m_daily_dungeon.daily_dungeon_period.begin_date,e=this.m_daily_dungeon.daily_dungeon_period.end_date;return b<=n&&n<=e},IsOpenOnceADayDungeon:function(){var a=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(a).valueOf(),b=moment(this.m_once_a_day_dungeon.dungeon.begin_dt,["YYYY-MM-DD hh:mm:ss"]).valueOf(),e=moment(this.m_once_a_day_dungeon.dungeon.end_dt,["YYYY-MM-DD hh:mm:ss"]).valueOf();return b<=n&&n<=e},IsOpenEventDungeon:function(){var a=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(a).valueOf(),b=this.m_event_dungeon.event_dungeon_period.begin_date.valueOf(),e=this.m_event_dungeon.event_dungeon_period.end_date.valueOf();return b<=n&&n<=e},IsOpenWeeklyDungeon:function(){for(var a=!1,idx=0;idx<this.m_weekly_dungeon.weekly_period.length;idx++){var d=this.m_weekly_dungeon.weekly_period[idx],now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),b=d.begin_date,e=d.end_date;if(!(n>e.valueOf())&&(b-(d.is_user_period?5:1)<=n&&n<=e+1)){a=!0;break}}return a},showNotOpenWeeklyDungeon:function(){var c=MasterManager.getInstance();this.m_message_box.setTitle(c.get_LanguageData("label_weekly_dungeon_open_title")),this.m_message_box.setText(c.get_LanguageData("label_weekly_dungeon_not_open")),this.m_message_box.setText("\n"),this.m_message_box.addButtonInfo(new MessageButtonInfo(res_str("label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(a){var b=SceneManager.getInstance().getRunningScene();b.initLayoutProgress(),b.back()},.1,"weekly_dungeon_cannot_buy_open"),this.m_message_box.hide()}.bind(this))),this.m_message_box.show()},IsEnoughtYunheeBound:function(a,b){UserService.getInstance().isEnoughYunheeBound()||UserService.getInstance().isEnoughMaterialBound()?a(b):(this.m_friend_select_scene.setEnableBackBtn(!0),MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.over_yunhee_bound))},IsEnoughtEquipmentBound:function(){return!EquipmentService.getInstance().isOverUserEquipmentBound()},getTodayDailyDungeonPeriod:function(a){for(var b=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),ts=moment(b).format("YYYY-MM-DD"),log={},open_priod=NetService().get_daily_dungeon_open_period_info().daily_dungeon_open_period,is_exist=!1,idx=0;idx<open_priod.length;idx++){var p=open_priod[idx];if(p.daily_dungeon_period_idx==a&&p.challenge_dt==ts){log=p,is_exist=!0;break}}return is_exist||(log.daily_dungeon_period_idx=a,log.challenge_dt=ts,log.key_cost_challenge_count=0,log.jade_cost_challenge_count=0),log},onTouchWarningTooltip:function(a,b){b==cc.CONTROL_EVENT_TOUCH_DOWN?this.showGreatWallWarningTooltip():this.hideGreatWallWarningTooltip()},showGreatWallWarningTooltip:function(){var a=cmString("%s\n%s\n%s\n%s",res_str("label_great_wall_leader_skill_warning_1"),res_str("label_great_wall_leader_skill_warning_2"),res_str("label_great_wall_leader_skill_warning_3"),res_str("label_great_wall_leader_skill_warning_4"));this.tooltip_content.setString(a);var b=ccSize(this.tooltip_content),bSize=cc.size(b.width+40,b.height+20);bSize.width=MAX(64,b.width+40),bSize.height=MAX(54,b.height+20),this.tooltip_box.setPreferredSize(bSize),this.tooltip_content.setPosition(ccCenter(bSize)),this.tooltip_box.setVisible(!0)},hideGreatWallWarningTooltip:function(){this.tooltip_box.setVisible(!1)},onTouchWeakPointTooltip:function(a,b){b==cc.CONTROL_EVENT_TOUCH_DOWN?this.showGreatWallWeakPointTooltip():this.hideGreatWallWeakPointTooltip()},showGreatWallWeakPointTooltip:function(){this.m_wp_tooltip_content.setString(this.m_great_wall_dungeon.great_wall_dungeon.stage_tip);var a=ccSize(this.m_wp_tooltip_content),bSize=cc.size(a.width+40,a.height+20);bSize.width=MAX(64,a.width+40),bSize.height=MAX(54,a.height+20),this.m_wp_tooltip_box.setPreferredSize(bSize),this.m_wp_tooltip_content.setPosition(ccCenter(bSize)),this.m_wp_tooltip_box.setVisible(!0)},hideGreatWallWeakPointTooltip:function(){this.m_wp_tooltip_box.setVisible(!1)},initLayoutProgress:function(c){if(!IS_NET_ERROR&&null==this.m_progres_bar){this.m_progres_bar=new cc.LayerColor(cc.color.BLACK),null==c&&(c=255),this.m_progres_bar.setOpacity(c),this.m_progres_bar.setContentSize(ccSize(this));var d=cc.Sprite.create(RES_CM+"img_progress_bg.png");d.setPosition(ccCenter(this));var e=cc.Sprite.create(RES_CM+"img_progress_arrow.png");e.setPosition(ccCenter(d)),d.addChild(e,1000001),this.m_progres_bar.addChild(d),this.addChild(this.m_progres_bar,1000001);var f=new cc.Sprite(res.s_cm_img_text_loading);f.setAnchorPoint(.5,0),f.setPosition(ccCenter(d).x,ccCenter(d).y-100),f.setOpacity(c),d.addChild(f,1000001);var g=new cc.RotateBy(.1,30),seq=new cc.Sequence(g),repeat=new cc.RepeatForever(seq);e.runAction(repeat);var h=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE});h.onTouchBegan=function(a,b){b.stopPropagation()}.bind(this);var i=cc.EventListener.create({event:cc.EventListener.MOUSE,onMouseScroll:function(a){a.stopPropagation()}.bind(this)});cc.eventManager.addListener(i,this.m_progres_bar),cc.eventManager.addListener(h,this.m_progres_bar)}},removeLayerProgress:function(){null!=this.m_progres_bar&&(cc.eventManager.removeListeners(this.m_progres_bar),this.removeChild(this.m_progres_bar),this.m_progres_bar=null)},reqEventDungeonRaidBegin:function(){MasterManager.getInstance();var a=NetService(),context=BattleContext._getInstance(),event_raid_info=a.get_Event_Raid_Dungeon_Info(),req={};req.opcode=net.OP.op_event_raid_dungeon_battle_begin,req.boss_num=event_raid_info.event_raid_boss_info.boss_num,req.event_dungeon_period_idx=event_raid_info.event_dungeon_period_idx,req.event_raid_dungeon_idx=event_raid_info.event_raid_boss_info.event_raid_dungeon_idx,req.multiple_type=context.getEventRaidDungeonBattleTicket(),req.troops_num=this.getCurrentTroopsNum();var b={event_raid_dungeon_idx:event_raid_info.event_raid_boss_info.event_raid_dungeon_idx,boss_num:0,remain_hp:0,die_yn:!1};BattleContext._getInstance().setEventRaidDungeonData(b);var c=SceneManager.getInstance().getMainScene(),client=GameClient(),troopNum=this.getCurrentTroopsNum();return BattleContext._getInstance().setBeforeBattleUserInfoByTroops(troopNum),client.write(req,c.onNetworkEvent,c),!0},EventRaidBattleStart:function(a){var m=MasterManager.getInstance(),nService=new NetService,service=EventDungeonService.getInstance(),context=BattleContext._getInstance(),troops_num=this.getCurrentTroopsNum(),base_need_point=m.get_EventRaidDungeon(nService.get_Event_Raid_Dungeon_idx()),event_dungeon_point={};if(service.getUserEventDungeonPoint(m.get_EventRaidDungeon(nService.get_Event_Raid_Dungeon_idx()).event_dungeon_period_idx,event_dungeon_point),this.IsEmptyTroops(troops_num))MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.popup_empty_troops);else if(event_dungeon_point.event_point<base_need_point*a)MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.popup_lack_event_point);else{context.setEventRaidDungeonBattleTicket(a);for(var b=nService.get_Event_Raid_Dungeon_Info(),i=0;i<b.event_raid_boss_info.boss_damage.length;i++){var c=b.event_raid_boss_info.boss_damage[i];c.multiple_type==a&&(0==c.damage?MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.event_raid_battle_start):(this.m_boss_Damage=c.damage,MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.event_raid_select_battle)))}}},getAmountSkipTicket:function(a){var b=1;return this.m_game_type==db.BattleGameType.EventDungeon?b="y"==this.m_event_dungeon.event_dungeon.two_times_yn?2:1:this.m_game_type==db.BattleGameType.WeeklyDungeon&&(b="y"==this.m_weekly_difficulty.weekly_difficulty.two_times_yn?2:1),a*b*this.m_skip_ticket_default},showDungeonSkipMsgBox:function(b){var c=NetService().get_UserItemInfo_V2(),skipTicketInfo={};skipTicketInfo.amount_skip_count=this.m_skip_ticket_count,skipTicketInfo.spend_ticket_count=this.getAmountSkipTicket(this.m_skip_ticket_count),skipTicketInfo.spend_key_count=b*this.m_skip_ticket_count,this.m_startSkipTicketModalLayer._contentNode=function(a,m){return this.getStartSkipTicketLayer(skipTicketInfo,c)}.bind(this),this.m_startSkipTicketModalLayer.show()},getCompleteTaskCount:function(){var a=BattleService.getInstance(),context=BattleContext._getInstance(),complete_task=0;if(this.m_game_type==db.BattleGameType.EventDungeon){var b=[],service=BattleService.getInstance(),event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();b=service.getUserEventDungeonList(event_dungeon_period_idx,b);for(var i=0;i<b.length;i++)b[i].event_dungeon_idx==this.m_event_dungeon.event_dungeon_idx&&(a.getMasterEventDungeonNpcInfo(b[i]),context.setEventDungeonData(b[i]));this.m_event_dungeon=context.getEventDungeonData();for(i=0;i<this.m_event_dungeon.task_list.length;i++)this.m_event_dungeon.task_list[i].is_complete&&(complete_task+=1)}else if(this.m_game_type==db.BattleGameType.WeeklyDungeon){var c=[];BattleService.getInstance().getMasterWeeklyDungeon(c);for(var e=!1,j=0;j<c.length;j++){var w=c[j];if(w.weekly_idx==this.m_weekly_difficulty.weekly_idx)for(var k=0;k<w.weekly_difficulty.length;k++){var d=w.weekly_difficulty[k];if(d.weekly_difficulty.dungeon_idx==this.m_weekly_difficulty.weekly_difficulty.dungeon_idx){context.setWeeklyDungeonData(w);var f=d;BattleService.getInstance().getMasterWeeklyDungeonStageNpc(f),context.setWeeklyDungeonDifficulty(f),e=!0;break}}}e&&(this.m_weekly_dungeon=context.getWeeklyDungeonData(),this.m_weekly_difficulty=context.getWeeklyDungeonDifficulty());for(i=0;i<this.m_weekly_difficulty.task_list.length;i++)this.m_weekly_difficulty.task_list[i].is_complete&&(complete_task+=1)}else if(this.m_game_type==db.BattleGameType.Mission){var g=context.getMissionID();this.m_mission={},(service=BattleService.getInstance()).getMainMissionAndNpc(g,this.m_mission);for(i=0;i<this.m_mission.task_list.length;i++)this.m_mission.task_list[i].is_cleared&&(complete_task+=1)}return complete_task},onSkipTicketPlus:function(){var a=NetService().get_UserItemInfo_V2(),ticket_count=this.m_skip_ticket_count+1,need_key=0;this.m_game_type==db.BattleGameType.Mission?need_key=this.checkNeedKeyMission(0):this.m_game_type==db.BattleGameType.EventDungeon?need_key=this.checkNeedKeyEventDungeon(0):this.m_game_type==db.BattleGameType.WeeklyDungeon&&(need_key=this.checkNeedKeyWeeklyDungeon(0)),this.getAmountSkipTicket(ticket_count)>this.m_have_skip_ticket_count?MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectSkipEnum.battle_skip_lack_ticket):a.key_cnt<need_key*ticket_count?a.key_cnt>a.key_bound?MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectSkipEnum.battle_skip_lack_key2):MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectSkipEnum.battle_skip_lack_key1):(this.m_skip_ticket_count++,this.m_skipTicketCountLabel.setString(cmString("%d",this.getAmountSkipTicket(this.m_skip_ticket_count))))},onSkipTicketMinus:function(){this.m_skip_ticket_count<=1?(this.m_skip_ticket_count=1,MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectSkipEnum.battle_skip_zero_ticket)):this.m_skip_ticket_count-=1,this.m_skipTicketCountLabel.setString(cmString("%d",this.getAmountSkipTicket(this.m_skip_ticket_count)))},updateSkipTicketCount:function(){if(!(this.m_game_type!=db.BattleGameType.Mission&&this.m_game_type!=db.BattleGameType.WeeklyDungeon&&this.m_game_type!=db.BattleGameType.EventDungeon||this.m_game_type==db.BattleGameType.Mission&&0==this.m_mission.task_list.length||this.m_game_type==db.BattleGameType.EventDungeon&&0==this.m_event_dungeon.task_list.length||this.m_game_type==db.BattleGameType.WeeklyDungeon&&0==this.m_weekly_difficulty.task_list.length||3!=this.m_taskSakuraSprList.length)){var a=NetService().get_UserItemInfo_V2();this.m_have_skip_ticket_count=a.skip_ticket_count,null!=this.m_haveSkipTicketCountLabel&&null!=this.m_haveSkipTicketCountLabel&&this.m_haveSkipTicketCountLabel.setString(Number(this.m_have_skip_ticket_count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_2011),this.m_skip_ticket_count=1;var b=this.getCompleteTaskCount();3!=b||this.getAmountSkipTicket(this.m_skip_ticket_count)>this.m_have_skip_ticket_count?(this.m_itemMinusBtn.setEnabled(!1),this.m_itemPlusBtn.setEnabled(!1),this.m_startBtn.setEnabled(!1)):(this.m_itemMinusBtn.setEnabled(!0),this.m_itemPlusBtn.setEnabled(!0),this.m_startBtn.setEnabled(!0)),null!=this.m_skipTicketCountLabel&&this.m_skipTicketCountLabel.setString(cmString("%d",this.getAmountSkipTicket(this.m_skip_ticket_count)));var c="";if(c=this.m_game_type==db.BattleGameType.Mission?"sakura":"sakura_3",this.m_taskSakuraSprList.clear(),3==this.m_taskSakuraSprList.length)for(var i=0;i<3;i++){var d=this.m_taskSakuraSprList[i];if(i<b){var e=RES_CDN_DEFULT+"menu_quest/img_story_"+c+"_on.png",frame2_texture=cc.textureCache.addImage(e),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));d.setSpriteFrame(frame2)}else{e=RES_CDN_DEFULT+"menu_quest/img_story_"+c+"_off.png",frame2_texture=cc.textureCache.addImage(e),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));d.setSpriteFrame(frame2)}}}},sendPacketStorySkip:function(){var a=BattleContext._getInstance().getMissionID(),req={};req.opcode=net.OP.op_story_dungeon_battle_skip,req.troops_num=this.getCurrentTroopsNum(),req.mission_id=a,req.skip_ticket=this.getAmountSkipTicket(this.m_skip_ticket_count),SceneManager.getInstance().getRunningScene().network_write(req),this.m_friend_select_scene.setEnableBackBtn(!1),this.choiceFriend(-1)},sendPacketEventSkip:function(){var a=BattleContext._getInstance(),troops_num=this.getCurrentTroopsNum(),dungeon=a.getEventDungeonData(),req={};req.opcode=net.OP.op_event_dungeon_battle_skip,req.event_dungeon_idx=dungeon.event_dungeon.event_dungeon_idx,req.event_dungeon_period_idx=dungeon.event_dungeon_period.event_dungeon_period_idx,req.troops_num=troops_num,req.skip_ticket=this.getAmountSkipTicket(this.m_skip_ticket_count),SceneManager.getInstance().getRunningScene().network_write(req),this.m_friend_select_scene.setEnableBackBtn(!1),this.choiceFriend(-1)},sendPacketWeeklySkip:function(){var a=this.getCurrentTroopsNum();if(0<this.m_weekly_difficulty.weekly_difficulty.weekly_idx){var b={};b.opcode=net.OP.op_weekly_dungeon_battle_skip,b.weekly_idx=this.m_weekly_difficulty.weekly_difficulty.weekly_idx,b.weekly_difficulty_id=this.m_weekly_difficulty.weekly_difficulty.dungeon_idx,b.troops_num=a,b.skip_ticket=this.getAmountSkipTicket(this.m_skip_ticket_count),SceneManager.getInstance().getRunningScene().network_write(b),this.m_friend_select_scene.setEnableBackBtn(!1)}},sendPacketSkipTicket:function(){this.m_game_type==db.BattleGameType.Mission?this.sendPacketStorySkip():this.m_game_type==db.BattleGameType.WeeklyDungeon?this.sendPacketWeeklySkip():this.m_game_type==db.BattleGameType.EventDungeon&&this.sendPacketEventSkip()},getStartSkipTicketLayer:function(c,d){var e=new cc.Layer,info=d,remain_ticket=info.skip_ticket_count-c.spend_ticket_count,remain_key=info.key_cnt-c.spend_key_count,rect=cc.Rect(40,40,10,10),bg=new cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",rect),friend_noti_offset=cc.p(0,0);USE_FRIEND_SPEICAL_EFFECT&&this.m_game_type==db.BattleGameType.EventDungeon?bg.setPreferredSize(cc.size(630,400)):(bg.setPreferredSize(cc.size(630,370)),friend_noti_offset=cc.p(0,-30)),bg.setPosition(ccCenter(e)),e.addChild(bg);var f=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_navi.png",RectZero());f.setInsetLeft(46),f.setInsetRight(46),f.setPreferredSize(cc.size(614,48)),f.setAnchorPoint(ANCHOR_MIDDLE_TOP()),f.setPosition(ccCenter(bg).x,ccHeight(bg)-11),bg.addChild(f);var g=cmLabel.getLabel(res_str("label_task_skip_use_confirm_popup_title"),LABEL_FONT_INDEX.FONT_261);g.setAnchorPoint(ANCHOR_MIDDLE()),g.setPosition(ccCenter(f).x,ccCenter(f).y+3),f.addChild(g);var h=new cmMultiLabel;h.addLabel("スキップチケット",LABEL_FONT_INDEX.FONT_221),h.addLabel(c.spend_ticket_count,LABEL_FONT_INDEX.FONT_227),h.addLabel("枚と鍵",LABEL_FONT_INDEX.FONT_221),h.addLabel(c.spend_key_count,LABEL_FONT_INDEX.FONT_227),h.addLabel("個を消費して",LABEL_FONT_INDEX.FONT_221),h.setLabel(),h.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),h.setPosition(ccCenter(bg).x-180,217+GetFontSize(LABEL_FONT_INDEX.FONT_221)+friend_noti_offset.y+60),bg.addChild(h);var i=new cmMultiLabel;i.addLabel("スキップクリアを",LABEL_FONT_INDEX.FONT_221),i.addLabel(c.amount_skip_count,LABEL_FONT_INDEX.FONT_227),i.addLabel("回実行します。",LABEL_FONT_INDEX.FONT_221),i.setLabel(),i.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),i.setPosition(ccCenter(bg).x-180,217+GetFontSize(LABEL_FONT_INDEX.FONT_221)+friend_noti_offset.y+40),bg.addChild(i);var j=new cmMultiLabel;j.addLabel("よろしいですか？",LABEL_FONT_INDEX.FONT_221),j.setLabel(),j.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),j.setPosition(ccCenter(bg).x-180,217+GetFontSize(LABEL_FONT_INDEX.FONT_221)+friend_noti_offset.y+20),bg.addChild(j);var k=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_ic_skipticket.png");k.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),k.setPosition(222,157+GetFontSize(LABEL_FONT_INDEX.FONT_241)+friend_noti_offset.y),bg.addChild(k);var l=new cmMultiLabel;if(l.addLabel(info.skip_ticket_count+" > ",LABEL_FONT_INDEX.FONT_241),l.addLabel(remain_ticket,LABEL_FONT_INDEX.FONT_247),l.setLabel(),l.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),l.setPosition(273,179+GetFontSize(LABEL_FONT_INDEX.FONT_241)+friend_noti_offset.y),bg.addChild(l),USE_FRIEND_SPEICAL_EFFECT&&this.m_game_type==db.BattleGameType.EventDungeon){var m=cmLabel.getLabel(res_str("skip_friend_buff_guide"),LABEL_FONT_INDEX.FONT_1821);m.setAnchorPoint(ANCHOR_MIDDLE()),m.setPosition(ccCenter(bg).x,82+GetFontSize(LABEL_FONT_INDEX.FONT_1821)),bg.addChild(m)}var n=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_ic_key.png");n.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),n.setPosition(218,97+GetFontSize(LABEL_FONT_INDEX.FONT_241)+friend_noti_offset.y),bg.addChild(n);var o=new cmMultiLabel;o.addLabel(info.key_cnt+" > ",LABEL_FONT_INDEX.FONT_241),o.addLabel(remain_key,LABEL_FONT_INDEX.FONT_247),o.setLabel(),o.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),o.setPosition(273,120+GetFontSize(LABEL_FONT_INDEX.FONT_241)+friend_noti_offset.y),bg.addChild(o);var p=new LabelButton("btn_08_off.png","btn_08_on.png","",ccui.Widget.PLIST_TEXTURE);p.setFont(LABEL_FONT_INDEX.FONT_241),p.setString(res_str("btn_label_cancel")),p.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),p.setPosition(ccCenter(bg).x-5,16),p.addClickEventListener(function(a){this.m_startSkipTicketModalLayer.hide()}.bind(this)),bg.addChild(p);var q=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);return q.setFont(LABEL_FONT_INDEX.FONT_241),q.setString(res_str("btn_label_confirm")),q.setAnchorPoint(ZERO()),q.setPosition(ccCenter(bg).x+5,16),bg.addChild(q),q.addClickEventListener(function(b){this.scheduleOnce(function(a){this.sendPacketSkipTicket()},0,"getStartSkipTicketLayer"),this.m_startSkipTicketModalLayer.hide()}.bind(this)),e},onTouchBegan:function(a,b){return!0},onTouchMoved:function(a,b){},onTouchEnded:function(a,b){},onTouchCancelled:function(a,b){}}),FRIEND_TO_FRIEND=!1,FriendSelectEnum={sort_class:1,sort_lv:2,sort_desc:3,sort_asc:4,sort_special_effect:5,menu_select_join:100,menu_select_release:101,popup_cancel:102,popup_buy_key:103,popup_empty_troops:104,back_scene:105,over_yunhee_bound:106,over_general_material_bound:107,over_all_bound:108,over_equipment_bound:109,invalid_entrance_running_time:110,invalid_entrance_limit_over:111,great_wall_first_partin_battle:112,troops_in_search_troops_general:113,popup_lack_event_point:114,event_raid_battle_start:115,event_raid_select_battle:116,event_raid_skip_battle_start:117},FriendSelectSkipEnum={battle_skip_retry:3e5,battle_skip_confirm:300001,battle_skip_story_map:300002,battle_skip_next_mission:300003,battle_skip_lack_key1:300101,battle_skip_lack_key2:300102,battle_skip_lack_ticket:300103,battle_skip_zero_ticket:300104},FriendSelectScene=GameScene.extend({m_isYunheeOverDisregar:!1,m_autoPlayModalLayer:null,m_FriendSelectLayer_V2:null,m_btn_back:null,m_need_equipment_bound_jade:0,m_deferred:$.Deferred(),m_is_battle_start:!1,m_mission_skip_game_result_modal_layer:null,m_selectBattleModalLayer:null,ctor:function(){this._super(scene_FriendSelectScene)},get_story_deferred:function(){return this.m_deferred},init:function(){this._super(),this.initLayoutProgress2(),this.m_game_type=BattleContext._getInstance().getGameType();var b=this.getCurrentTroopsNum(),generalService=GeneralService.getInstance(),bg=null;if(USE_SP_EVENT_SCALE)if(this.m_game_type==db.BattleGameType.EventRaidDungeon){var c=NetService();(bg=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/bg_eventvs_sub.jpg",c.get_Event_Raid_Dungeon_Period_idx()))).setScale(2)}else bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub.png");else if(this.m_game_type==db.BattleGameType.EventRaidDungeon){c=NetService();bg=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/bg_eventvs_sub.jpg",c.get_Event_Raid_Dungeon_Period_idx()))}else bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub.png");1==USE_SP_COMMON_SUB_BG_SCALE&&this.m_game_type!=db.BattleGameType.EventRaidDungeon&&bg.setScale(2),bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(this)),this.addChild(bg),this.m_FriendSelectLayer_V2=new FriendSelectLayer_V2,this.addChild(this.m_FriendSelectLayer_V2);var d,gw_service=GreatWallService.getInstance(),troops_list=(NetService().Load_User_Troops_General(),[]);if(troops_list=this.m_game_type==db.BattleGameType.GreatWallDungeon?gw_service.getGreatWallTroopsGeneralList(b):generalService.getUserTroopsGeneralList(b),this.m_FriendSelectLayer_V2.setUserGeneralTroopsInfo(troops_list),this.m_FriendSelectLayer_V2.initLayout(this),this.m_game_type==db.BattleGameType.Mussang)var e=new StatusLayer(INVOKER_TYPE.mussang);else if(this.m_game_type==db.BattleGameType.GreatWallDungeon)e=new StatusLayer(INVOKER_TYPE.great_wall);else if(this.m_game_type==db.BattleGameType.TowerDungeon)e=new StatusLayer(INVOKER_TYPE.mussang);else if(this.m_game_type==db.BattleGameType.EventRaidDungeon)e=new StatusLayer(INVOKER_TYPE.normal);else e=new StatusLayer(INVOKER_TYPE.normal);e.ignoreAnchorPointForPosition(!1),e.setAnchorPoint(ANCHOR_TOP_RIGHT()),e.setPosition(ccWidth(this),ccHeight(this)),this.addChild(e),this.m_game_type==db.BattleGameType.WeeklyDungeon?d=RES_CDN_DEFULT+"menu_vs/img_vs_text_day.png":this.m_game_type==db.BattleGameType.Mussang?d=RES_CDN_DEFULT+"menu_vs/img_vs_text_road.png":this.m_game_type==db.BattleGameType.Mission?d=RES_CDN_DEFULT+"menu_quest/img_story_text_story.png":this.m_game_type==db.BattleGameType.EventDungeon||this.m_game_type==db.BattleGameType.OnceADayDungeon?d=RES_CDN_DEFULT+"menu_eventvs/img_eventvs_text_event.png":this.m_game_type==db.BattleGameType.DailyDungeon?d=RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_status_title.png":this.m_game_type==db.BattleGameType.GreatWallDungeon?d=RES_CDN_DEFULT+"menu_great_wall/img_great_wall_status_title.png":this.m_game_type==db.BattleGameType.TowerDungeon?d=RES_CDN_DEFULT+"menu_tower/img_vs_tower_text.png":this.m_game_type==db.BattleGameType.EventRaidDungeon&&(d=RES_CDN_DEFULT+"menu_eventvs/img_eventvs_text_event.png");var f=cc.Sprite.create(d);f.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),f.setPosition(90,585),this.addChild(f,2),this.m_btn_back=new ccui.Button,this.m_btn_back.loadTextures("btn_home_off.png","btn_home_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_btn_back.setAnchorPoint(ZERO()),this.m_btn_back.setPosition(10,559),this.m_btn_back.addClickEventListener(function(a){this.initLayoutProgress(),this.back()}.bind(this)),this.addChild(this.m_btn_back);var g=ccSize(this);this.m_mission_skip_game_result_modal_layer=new GameModalLayer,this.m_mission_skip_game_result_modal_layer.setContentSize(g),this.m_mission_skip_game_result_modal_layer.ignoreAnchorPointForPosition(!1),this.m_mission_skip_game_result_modal_layer.setPosition(ccCenter(g)),this.addChild(this.m_mission_skip_game_result_modal_layer,99998),this.m_selectBattleModalLayer=new GameModalLayer,this.m_selectBattleModalLayer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_selectBattleModalLayer.setPosition(ccCenter(g).x,ccCenter(g).y+13),this.addChild(this.m_selectBattleModalLayer,99e3),this.scheduleOnce(this.removeProgressEnd,1)},removeProgressEnd:function(){this.removeLayerProgress2()},back:function(e,f){null==e&&(e=!0),null==f&&(f=!1),this.scheduleOnce(function(a){var b=BattleContext._getInstance();if(this.m_game_type==db.BattleGameType.EventDungeon){var c=b.getEventDungeonData();b.setEventDungeonPeriodIdX(c.event_dungeon_period.event_dungeon_period_idx)}if(this.m_game_type==db.BattleGameType.EventRaidDungeon)if(b.setGameType(db.BattleGameType.EventDungeon),b.getExitEventRaidDungeonDouble()){SceneManager.getInstance().reservedHistoryClearToScene(scene_EventDungeonEntranceScene);var d=new EventDungeonRaidEntranceScene;SceneManager.getInstance().replaceScene(d),d=null}else this.onKeyBack(!0);else this.m_game_type==db.BattleGameType.Mission?(cc.director.isPaused()&&cc.director.resume(),this.onKeyBack(e,f)):(this.onKeyBack(!0),this.removeLayerProgress3())}.bind(this),0,"back_scene")},setEnableBackBtn:function(a){this.m_btn_back.setEnabled(a),this.m_is_battle_start=!a},onTutorialEnter:function(a){this.setTutorialStep(a),a.tutorial_page,TUTORIAL_PAGE_1_STORY},onEnter:function(){this._super();var a=AudioEngine.getInstance(),context=BattleContext._getInstance(),master=MasterTable.getInstance();if(this.m_is_battle_start=!1,MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_FriendSelectScene]),this.m_game_type==db.BattleGameType.Mission){var b=[],bgm_ref_idx=BattleContext._getInstance().getMissionStage();b=master.get_Bgm(BGM_TYPE_CHANGE_STORY_STAGE_BGM,b,bgm_ref_idx);a=AudioEngine.getInstance();var c=RES_CDN_SOUND+SND_TYPE+"sound/"+b[0].sound_file_name;a.m_bgmPath!=c&&(a.stopBackgroundMusic(),a.playBackgroundMusic(c,!0)),this.hideBattleMissionSkipResultModalLayer()}else if(this.m_game_type==db.BattleGameType.EventDungeon){var d=context.getEventDungeonPeriodIdx(),period=MasterManager.getInstance().get_EventDungeonPeriod(d);c=RES_CDN_SOUND+SND_TYPE+"sound/"+cmString("BGM_marathon_loop_%d.mp3",period.event_dungeon_point_period_idx);a.m_bgmPath!=c&&(a.stopBackgroundMusic(),a.playBackgroundMusic(c,!0)),this.hideBattleMissionSkipResultModalLayer()}else if(this.m_game_type==db.BattleGameType.DailyDungeon)this.playMainBGM();else if(this.m_game_type==db.BattleGameType.EventRaidDungeon){d=context.getEventDungeonPeriodIdx(),period=MasterManager.getInstance().get_EventDungeonPeriod(d);var e=RES_CDN_SOUND+SND_TYPE+"sound/"+cmString("BGM_marathon_loop_%d.mp3",period.event_dungeon_point_period_idx);a.m_bgmPath!=e&&(a.stopBackgroundMusic(),a.playBackgroundMusic(e,!0))}else this.m_game_type==db.BattleGameType.WeeklyDungeon&&this.hideBattleMissionSkipResultModalLayer(),this.playMainBGM()},onExit:function(){(this._super(),BATTLE_TO_SHOP)?BATTLE_TO_SHOP=!1:(cc.log("=== FriendSelectTest ===="),BATTLE_TO_MISSION?BATTLE_TO_MISSION=!1:(cc.log("=== FriendSelectTest OK  ===="),1!=this.m_isPopupShow?FRIEND_TO_FRIEND?FRIEND_TO_FRIEND=!1:(MainObserver.getInstance().removeObserver(sceneStr[scene_FriendSelectScene]),this.removeAllChildrenWithCleanup(!0)):this.m_isPopupShow=!1))},onNotification:function(a){if(this._super(a),this.m_is_battle_start)return!1;BattleContext._getInstance();var b=GeneralService.getInstance(),gw_service=GreatWallService.getInstance(),troops_list=[];switch(this.removeLayerProgress(),this.m_FriendSelectLayer_V2.initStartBtn(),a){case FriendSelectEnum.popup_empty_troops:this.showNoGeneralInTroops();break;case FriendSelectEnum.back_scene:this.back();break;case FriendSelectEnum.over_yunhee_bound:this.showYunheeOverBound(GENERAL_TYPE_YUNHEE);break;case FriendSelectEnum.over_all_bound:this.showYunheeOverBound(0);break;case FriendSelectEnum.over_general_material_bound:this.showYunheeOverBound(GENERAL_TYPE_MATERIAL);break;case FriendSelectEnum.over_equipment_bound:this.showEquipmentOverBound();break;case FriendSelectEnum.invalid_entrance_running_time:USE_POPUP_INTERGRATION?this.showFriendSelectPopup(res_str("label_weekly_invalid_entrance"),res_str("label_weekly_invalid_entrance_time")):this.showInvalidEntranceTime();break;case FriendSelectEnum.invalid_entrance_limit_over:USE_POPUP_INTERGRATION?this.showFriendSelectPopup(res_str("label_weekly_invalid_entrance"),res_str("label_daily_dungeon_entrance_limit_over")):this.showEntranceLimitOver();break;case FriendSelectEnum.menu_select_join:case FriendSelectEnum.menu_select_release:break;case FriendSelectEnum.great_wall_first_partin_battle:this.showGreatWallFirstPartinGnrl();break;case FriendSelectEnum.troops_in_search_troops_general:USE_POPUP_INTERGRATION?this.showFriendSelectPopup(res_str("label_shop_buy_jade_omission_title"),res_str("label_event_dungeon_troops_in_search_troops_general_text_1"),res_str("label_event_dungeon_troops_in_search_troops_general_text_2"),res_str("label_event_dungeon_troops_in_search_troops_general_text_3")):this.showTroopsInSearchTroopsGeneral();break;case FriendSelectEnum.popup_cancel:this.m_box.is_show()&&this.m_box.hide(!1);break;case FriendSelectEnum.popup_buy_key:MainObserver.getInstance().postNotification(NOTIFY_MENU_SHOP_JADE,1),this.m_box.is_show()&&this.m_box.hide(!1);break;case FriendSelectEnum.popup_lack_event_point:this.showLackEventDungeonPoint();break;case FriendSelectEnum.event_raid_battle_start:BattleContext._getInstance().setEventRaidDungeonBattleSkip(!1),this.m_FriendSelectLayer_V2.reqEventDungeonRaidBegin();break;case FriendSelectEnum.event_raid_select_battle:this.showEventRaidDungeonBattleSelect();break;case FriendSelectEnum.event_raid_skip_battle_start:BattleContext._getInstance().setEventRaidDungeonBattleSkip(!0),this.m_FriendSelectLayer_V2.reqEventDungeonRaidBegin();break;case NOTIFY_MENU_PARTY_1:troops_list=this.m_game_type!=db.BattleGameType.GreatWallDungeon?b.getUserTroopsGeneralList(TROOPS_ENUM.troops_num_1):gw_service.getGreatWallTroopsGeneralList(TROOPS_ENUM.troops_num_1),this.m_FriendSelectLayer_V2.setUserGeneralTroopsInfo(troops_list),this.m_FriendSelectLayer_V2.changeYhTeam(TROOPS_ENUM.troops_num_1);break;case NOTIFY_MENU_PARTY_2:troops_list=this.m_game_type!=db.BattleGameType.GreatWallDungeon?b.getUserTroopsGeneralList(TROOPS_ENUM.troops_num_2):gw_service.getGreatWallTroopsGeneralList(TROOPS_ENUM.troops_num_2),this.m_FriendSelectLayer_V2.setUserGeneralTroopsInfo(troops_list),this.m_FriendSelectLayer_V2.changeYhTeam(TROOPS_ENUM.troops_num_2);break;case NOTIFY_MENU_PARTY_3:troops_list=this.m_game_type!=db.BattleGameType.GreatWallDungeon?b.getUserTroopsGeneralList(TROOPS_ENUM.troops_num_3):gw_service.getGreatWallTroopsGeneralList(TROOPS_ENUM.troops_num_3),this.m_FriendSelectLayer_V2.setUserGeneralTroopsInfo(troops_list),this.m_FriendSelectLayer_V2.changeYhTeam(TROOPS_ENUM.troops_num_3);break;case NOTIFY_MENU_PARTY_4:troops_list=this.m_game_type!=db.BattleGameType.GreatWallDungeon?b.getUserTroopsGeneralList(TROOPS_ENUM.troops_num_4):gw_service.getGreatWallTroopsGeneralList(TROOPS_ENUM.troops_num_4),this.m_FriendSelectLayer_V2.setUserGeneralTroopsInfo(troops_list),this.m_FriendSelectLayer_V2.changeYhTeam(TROOPS_ENUM.troops_num_4);break;case NOTIFY_MENU_PARTY_5:troops_list=this.m_game_type!=db.BattleGameType.GreatWallDungeon?b.getUserTroopsGeneralList(TROOPS_ENUM.troops_num_5):gw_service.getGreatWallTroopsGeneralList(TROOPS_ENUM.troops_num_5),this.m_FriendSelectLayer_V2.setUserGeneralTroopsInfo(troops_list),this.m_FriendSelectLayer_V2.changeYhTeam(TROOPS_ENUM.troops_num_5);break;case NOTIFY_MENU_PARTY_6:troops_list=this.m_game_type!=db.BattleGameType.GreatWallDungeon?b.getUserTroopsGeneralList(TROOPS_ENUM.troops_num_6):gw_service.getGreatWallTroopsGeneralList(TROOPS_ENUM.troops_num_6),this.m_FriendSelectLayer_V2.setUserGeneralTroopsInfo(troops_list),this.m_FriendSelectLayer_V2.changeYhTeam(TROOPS_ENUM.troops_num_6);break;case NOTIFY_MENU_PARTY_7:troops_list=this.m_game_type!=db.BattleGameType.GreatWallDungeon?b.getUserTroopsGeneralList(TROOPS_ENUM.troops_num_7):gw_service.getGreatWallTroopsGeneralList(TROOPS_ENUM.troops_num_7),this.m_FriendSelectLayer_V2.setUserGeneralTroopsInfo(troops_list),this.m_FriendSelectLayer_V2.changeYhTeam(TROOPS_ENUM.troops_num_7);break;case btn_left_arrow:var c=this.getCurrentTroopsNum(),max_troops_num=MAX_TROOPS_NUM;this.m_game_type!=db.BattleGameType.GreatWallDungeon&&(max_troops_num=MAX_TROOPS_NUM-1),1==c?c=max_troops_num:c--,troops_list=this.m_game_type==db.BattleGameType.GreatWallDungeon?gw_service.getGreatWallTroopsGeneralList(c):GeneralService.getInstance().getUserTroopsGeneralList(c),this.m_FriendSelectLayer_V2.setUserGeneralTroopsInfo(troops_list),this.m_FriendSelectLayer_V2.changeYhTeam(TROOPS_ENUM.troops_num_1+c-1);break;case btn_right_arrow:c=this.getCurrentTroopsNum(),max_troops_num=MAX_TROOPS_NUM;this.m_game_type!=db.BattleGameType.GreatWallDungeon&&(max_troops_num=MAX_TROOPS_NUM-1),c==max_troops_num?c=1:c++,troops_list=this.m_game_type==db.BattleGameType.GreatWallDungeon?gw_service.getGreatWallTroopsGeneralList(c):GeneralService.getInstance().getUserTroopsGeneralList(c),this.m_FriendSelectLayer_V2.setUserGeneralTroopsInfo(troops_list),this.m_FriendSelectLayer_V2.changeYhTeam(TROOPS_ENUM.troops_num_1+c-1);break;case NOTIFY_MENU_BATTLE_FORM:this.removeLayerProgress(),BattleContext._getInstance().setGameType(this.m_game_type);var d=new BattleFormationScene;SceneManager.getInstance().replaceScene(d),d=null;break;case NOTIFY_MENU_YUNHEE_SET:this.initLayoutProgress(),GameContext.getInstance().setYunheePrevSceneId(scene_FriendSelectScene);var e={};e.opcode=net.OP.op_get_user_general,this.network_write(e);break;case NOTIFY_BTN_COMBO:break;case BattleSceneFlag.weekly_result_ok:case BattleSceneFlag.menu_result_weekly_retry:case FriendSelectSkipEnum.battle_skip_retry:this.hideBattleMissionSkipResultModalLayer();break;case FriendSelectSkipEnum.battle_skip_confirm:case FriendSelectSkipEnum.battle_skip_story_map:case FriendSelectSkipEnum.battle_skip_next_mission:this.initLayoutProgress3(),this.hideBattleMissionSkipResultModalLayer(),this.back();break;case FriendSelectSkipEnum.battle_skip_lack_key1:this.showToastBox("",res_str("label_task_skip_use_lack_key_message_1"),2,ToastEnum.CENTER);break;case FriendSelectSkipEnum.battle_skip_lack_key2:this.showToastBox("",res_str("label_task_skip_use_lack_key_message_2"),2,ToastEnum.CENTER);break;case FriendSelectSkipEnum.battle_skip_lack_ticket:this.showToastBox("",res_str("label_task_skip_use_lack_ticket_message"),2,ToastEnum.CENTER);break;case FriendSelectSkipEnum.battle_skip_zero_ticket:this.showToastBox("",res_str("label_task_skip_use_cannot_zero_message"),2,ToastEnum.CENTER)}return!0},onNetworkEvent:function(g,h,i){if(this._super(g,h,i),i.error==net.ERROR.NET_E_INVALID_ENTRANCE_TIME)return this.m_game_type==db.BattleGameType.DailyDungeon?USE_POPUP_INTERGRATION?this.showFriendSelectPopup(res_str("label_weekly_invalid_entrance"),res_str("label_daily_dungeon_invalid_entrance_time_1"),res_str("label_daily_dungeon_invalid_entrance_time_2")):this.showDailyDungeonInvalidEntranceTime():USE_POPUP_INTERGRATION?this.showFriendSelectPopup(res_str("label_weekly_invalid_entrance"),res_str("label_weekly_invalid_entrance_time")):this.showInvalidEntranceTime(),void this.m_btn_back.setEnabled(!0);if(i.error!=net.ERROR.NET_E_LACK_EVENT_DUNGEON_POINT)if(i.error!=net.ERROR.NET_E_ALREADY_RETREAT){if(i.error==net.ERROR.NET_E_ENTRANCE_LIMIT_OVER)return USE_POPUP_INTERGRATION?this.showFriendSelectPopup(res_str("label_weekly_invalid_entrance"),res_str("label_daily_dungeon_entrance_limit_over")):this.showEntranceLimitOver(),void this.m_btn_back.setEnabled(!0);if(this.m_btn_back.setEnabled(!0),g==net.OP.op_main_mission_battle_begin_v2){var j=BattleContext._getInstance();if(0<i.frnd_gnrl.gnrl_id){var k=$.extend({},database.BattleGeneral);(q=BattleService.getInstance()).getFriendGeneral(i.frnd_gnrl,k),j.setFriendPartnerGeneral(k)}else j.clearFriendInfo();j.setBeforeBattleUserInfo(),cc.log("body.drop_items[0]",i.drop_items[0]),cc.log("body.drop_items[1]",i.drop_items[1]),cc.log("body.drop_items[2]",i.drop_items[2]),j.setDungeonDropItemCount(i.drop_items);var l=new BattleSceneLayer;SceneManager.getInstance().replaceScene(l),l=null}else if(g==net.OP.op_daily_dungeon_battle_begin){(j=BattleContext._getInstance()).setGameType(this.m_game_type),GameDefault.getInstance().getUserDailyDungeonTroopsNum().done(function(a){var b=a;j.setBeforeBattleUserInfoByTroops(b);var c=new BattleSceneLayer;SceneManager.getInstance().replaceScene(c),c=null})}else if(g==net.OP.op_great_wall_dungeon_battle_begin){if(i.error==net.ERROR.NET_E_SUCCESS){for(var m=(j=BattleContext._getInstance()).getGreatWallDungeonData(),npc_list=m.stage_npc.at(1),idx=0;idx<npc_list.length;idx++){var o=npc_list[idx],found=i.npc_list.findIndex(function(n){return o.position==n.position});-1!=found&&(o.remain_hp_rate=i.npc_list[found].remain_hp_rate,o.is_dead="y"==i.npc_list[found].dead_yn)}m.stage_npc.insert(1,npc_list),j.setGreatWallDungeonData(m),j.setBeforeGreatWallDungeonUserInfoByTroops(GameDefault.getInstance().getUserGreatWallTroopsNum());l=new BattleSceneLayer;SceneManager.getInstance().replaceScene(l),l=null}}else if(g==net.OP.op_get_user_general){this.m_game_type!=db.BattleGameType.None&&(GameContext.getInstance().setYunheeArrangeMode(!0),GameContext.getInstance().setYunheeTabType(YunheeLevelUpTapTypeEnum.tab_type_yunhee)),GameContext.getInstance().setOffsetVerticalPercent(null),BattleContext._getInstance().setGameType(this.m_game_type),(l=new YunheeScene).get_story_deferred().done(function(){this.scheduleOnce(function(a){SceneManager.getInstance().replaceScene(l,!0),l=null},YUNHEE_DELAY_TIME,"main_layer_ready")}.bind(this))}else if(g==net.OP.op_weekly_dungeon_battle_begin){(j=BattleContext._getInstance()).setGameType(this.m_game_type),GameDefault.getInstance().getUserWeeklyTroopsNum().done(function(a){var b=a;j.setBeforeBattleUserInfoByTroops(b),j.setDungeonDropItemCount(i.drop_items);var c=new BattleSceneLayer;SceneManager.getInstance().replaceScene(c),c=null})}else if(g==net.OP.op_mussang_step_battle_begin){(j=BattleContext._getInstance()).setGameType(this.m_game_type),j.setMussangId(i.mussang_id),GameDefault.getInstance().getUserMussangTroopsNum().done(function(a){var b=a;j.setBeforeBattleUserInfoByTroops(b);var c=new BattleSceneLayer;SceneManager.getInstance().replaceScene(c),c=null})}else if(g==net.OP.op_event_once_a_day_dungeon_battle_begin){if(i.error==net.ERROR.NET_E_SUCCESS){j=BattleContext._getInstance();GameDefault.getInstance().getUserOnceADayDungeonTroopsNum().done(function(a){var b=a;j.setBeforeBattleUserInfoByTroops(b);var c=new BattleSceneLayer;SceneManager.getInstance().replaceScene(c),c=null})}}else if(g==net.OP.op_story_dungeon_battle_skip){if(i.error==net.ERROR.NET_E_SUCCESS)(p={}).opcode=net.OP.op_get_user_item,this.network_write(p),(j=BattleContext._getInstance()).clearFriendInfo(),j.setBeforeBattleUserInfo_V2().done(function(a){1==a&&this.showBattleMissionSkipResultModalLayer(i,g)}.bind(this)),this.setEnableBackBtn(!0),this.m_is_battle_start=!1,this.m_FriendSelectLayer_V2.refrashSkipBtn(i.user_skip_ticket);else if(i.error==net.ERROR.NET_E_NOT_COMPLETE_TASKS){(r={}).push_back(res_str("label_task_skip_error_task_popup_text")),this.showMsgBox(r),r=null,this.setEnableBackBtn(!0),this.m_is_battle_start=!1}else if(i.error==net.ERROR.NET_E_LACK_SKIP_TICKET){(r={}).push_back(res_str("label_task_skip_error_ticket_popup_title")),this.showMsgBox(r),r=null,this.setEnableBackBtn(!0),this.m_is_battle_start=!1}}else if(g==net.OP.op_weekly_dungeon_battle_skip){if(i.error==net.ERROR.NET_E_SUCCESS)(p={}).opcode=net.OP.op_get_user_item,this.network_write(p),(j=BattleContext._getInstance()).setGameType(this.m_game_type),j.setBeforeBattleUserInfoByTroops_V2(i.troops_num).done(function(a){1==a&&this.showBattleMissionSkipResultModalLayer(i,g)}.bind(this)),this.setEnableBackBtn(!0),this.m_is_battle_start=!1,this.m_FriendSelectLayer_V2.refrashSkipBtn(i.user_skip_ticket);else if(i.error==net.ERROR.NET_E_NOT_COMPLETE_TASKS){(r={}).push_back(res_str("label_task_skip_error_task_popup_text")),this.showMsgBox(r),r=null,this.setEnableBackBtn(!0),this.m_is_battle_start=!1}else if(i.error==net.ERROR.NET_E_LACK_SKIP_TICKET){(r={}).push_back(res_str("label_task_skip_error_ticket_popup_title")),this.showMsgBox(r),r=null,this.setEnableBackBtn(!0),this.m_is_battle_start=!1}}else if(g==net.OP.op_event_dungeon_battle_skip){var p;if(i.error==net.ERROR.NET_E_SUCCESS)(p={}).opcode=net.OP.op_get_user_item,this.network_write(p),(j=BattleContext._getInstance()).setGameType(this.m_game_type),j.setBeforeBattleUserInfoByTroops_V2(i.troops_num).done(function(a){1==a&&this.showBattleMissionSkipResultModalLayer(i,g)}.bind(this)),this.setEnableBackBtn(!0),this.m_is_battle_start=!1,this.m_FriendSelectLayer_V2.refrashSkipBtn(i.user_skip_ticket);else if(i.error==net.ERROR.NET_E_NOT_COMPLETE_TASKS){(r={}).push_back(res_str("label_task_skip_error_task_popup_text")),this.showMsgBox(r),r=null,this.setEnableBackBtn(!0),this.m_is_battle_start=!1}else if(i.error==net.ERROR.NET_E_LACK_SKIP_TICKET){(r={}).push_back(res_str("label_task_skip_error_ticket_popup_title")),this.showMsgBox(r),r=null,this.setEnableBackBtn(!0),this.m_is_battle_start=!1}}else if(g==net.OP.op_event_dungeon_battle_begin){j=BattleContext._getInstance();var q=BattleService.getInstance();if(j.setGameType(this.m_game_type),0<i.frnd_gnrl.gnrl_id){k=$.extend({},database.BattleGeneral);q.getFriendGeneral(i.frnd_gnrl,k),j.setFriendPartnerGeneral(k)}else j.clearFriendInfo();GameDefault.getInstance().getUserEventDungeonTroopsNum().done(function(a){var b=a;if(j.setBeforeBattleUserInfoByTroops(b),j.setEventDungeonCutinStage(i.cutin_stage),0!=i.cutin_stage){var c=j.getEventDungeonData();BattleService.getInstance().getMasterEventDungeonNpcInfo(c),c.cutin_stage=i.cutin_stage,c.event_dungeon_cutin_info_idx=i.event_dungeon_cutin_info_idx;var d=MasterTable.getInstance().getMasterTable().get_EventDungeonCutinInfo(c.event_dungeon_cutin_info_idx);c.cutin_info=d,q.changeEventDungeonCutinStage(i.cutin_stage,i.event_dungeon_cutin_info_idx,c.stage_npc),j.setEventDungeonData(c),j.setEventDungeonCutinComplete(!1);var e=[];e.push(1),e.push(0),e.push(0),j.setDungeonDropItemCount(e)}else{(c=j.getEventDungeonData()).cutin_stage=i.cutin_stage,c.event_dungeon_cutin_info_idx=0,c.cutin_info={},c.cutin_info.event_dungeon_cutin_info_idx=0,q.getMasterEventDungeonStageNpc(c.event_dungeon.event_dungeon_idx,c),q.getMasterEventDungeonNpcInfo(c),j.setEventDungeonData(c),j.setEventDungeonCutinComplete(!1)}var f=new BattleSceneLayer;SceneManager.getInstance().replaceScene(f),f=null})}else if(g==net.OP.op_yunhee_inventory_increase)this.showInventoryIncreaseConfirm(i.user_yunhee_bound);else if(g==net.OP.op_equipment_inventory_increase)this.showEquipmentInventoryIncreaseConfirm(i.user_equip_bound);else if(g==net.OP.op_event_raid_dungeon_battle_begin){j=BattleContext._getInstance(),l=new BattleSceneLayer;SceneManager.getInstance().replaceScene(l),l=null}else if(g==net.OP.op_weekly_dungeon_battle_skip||res.opcode==net.OP.op_event_dungeon_battle_skip||res.opcode==net.OP.op_story_dungeon_battle_skip)if(i.error==net.ERROR.NET_E_SUCCESS)this.setEnableBackBtn(!0),this.m_is_battle_start=!1;else if(i.error==net.ERROR.NET_E_NOT_COMPLETE_TASKS){(r={}).push_back(res_str("label_task_skip_error_task_popup_text")),this.showMsgBox(r),r=null,this.setEnableBackBtn(!0),this.m_is_battle_start=!1}else if(i.error==net.ERROR.NET_E_LACK_SKIP_TICKET){var r;(r={}).push_back(res_str("label_task_skip_error_ticket_popup_title")),this.showMsgBox(r),r=null,this.setEnableBackBtn(!0),this.m_is_battle_start=!1}else i.error==net.ERROR.NET_E_LACK_KEY&&(this.showNotEnoughKey(!0),this.setEnableBackBtn(!0),this.m_is_battle_start=!1);else if(g==net.OP.op_event_raid_dungeon_boss_info){(j=BattleContext._getInstance()).setExitEventRaidDungeonDouble(!0),SceneManager.getInstance().reservedHistoryClearToScene(scene_EventDungeonRaidEntranceScene),SceneManager.getInstance().getRunningScene().m_sceneId==scene_FriendSelectScene&&(FRIEND_TO_FRIEND=!0);l=new FriendSelectScene;SceneManager.getInstance().replaceScene(l),l=null}}else g==net.OP.op_event_raid_dungeon_battle_begin&&this.showEventRaidDungeonClear();else g==net.OP.op_event_raid_dungeon_battle_begin&&((r=[]).push_back("イベントポイントが不足しています。"),this.showMsgBox(r),r=null)},showEquipmentOverBound:function(){var c=MasterManager.getInstance().get_CountFunction(COUNT_FUNCTION_EQUIPMENT_SLOT_BOUND);this.m_ctbox.setTitle("所持数オーバー");var d={need_jade:0,bonus_type_name:""},equip_service=EquipmentService.getInstance();if(equip_service.getEquipmentInventoryInfo(d),this.m_need_equipment_bound_jade=d.need_jade,equip_service.getUserEquipmentBound()>=c.value)this.m_ctbox.setText("装備の所持数が上限を超えている為、",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("戦闘に入場できません。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("所持数の上限もこれ以上拡張できません。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("売却・強化などの使用で",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("所持数を減らしてください。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.addButtonInfo(new MessageButtonInfo("確認",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_ctbox.hide()}.bind(this)));else{c=MasterManager.getInstance().get_CountFunction(COUNT_FUNCTION_EQUIPMENT_INVENTORY_INCREASE_SIZE);var e=equip_service.isOverUserEquipmentBound(EQUIP_BOUND_CHECK_NORMAL),is_over_equip_exp=equip_service.isOverUserEquipmentBound(EQUIP_BOUND_CHECK_EXP);1==e&&1==is_over_equip_exp?this.m_ctbox.setText(res_str("label_equipment_bound_over_all_text_1"),LABEL_FONT_INDEX.FONT_261):1==e?this.m_ctbox.setText(res_str("label_equipment_bound_over_normal_text_1"),LABEL_FONT_INDEX.FONT_261):this.m_ctbox.setText(res_str("label_equipment_bound_over_exp_text_1"),LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(res_str("label_raid_gacha_inventory_over_text_8"),LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(res_str("label_raid_gacha_inventory_over_text_12"),LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(d.bonus_type_name+this.m_need_equipment_bound_jade,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("使用",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("("+c.value+"スロット拡張)",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.addButtonInfo(new MessageButtonInfo("いいえ",MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_ctbox.hide()}.bind(this))),this.m_ctbox.addButtonInfo(new MessageButtonInfo("はい",MessageBoxButtonType.ButtonTypeNormal,0,function(){NetService().get_UserItemInfo_V2().jade_cnt<this.m_need_equipment_bound_jade?this.scheduleOnce(function(a){this.showNotEnoughJade()},0,"showNotEnoughJade"):(this.scheduleOnce(function(a){var b={};b.opcode=net.OP.op_equipment_inventory_increase,this.network_write(b)},0,"Req_Equipment_Inventory_Increase"),this.m_ctbox.hide(!1))}.bind(this)))}this.m_ctbox.show()},getCurrentTroopsNum:function(){var b=GameDefault.getInstance(),context=BattleContext._getInstance();this.m_game_type=context.getGameType();var c=1;if(this.m_game_type==db.BattleGameType.WeeklyDungeon)this.m_weekly_difficulty=context.getWeeklyDungeonDifficulty(),b.getUserWeeklyTroopsNum().done(function(a){c=a});else if(this.m_game_type==db.BattleGameType.Mussang){context.getMussangId();b.getUserMussangTroopsNum().done(function(a){c=a})}else if(this.m_game_type==db.BattleGameType.Mission){if(1==USE_LOCAL_STORAGE_TROOPS_OFF)c=b.getUserTroopsNum();else b.getUserTroopsNum().done(function(a){c=a})}else if(this.m_game_type==db.BattleGameType.EventDungeon){context.getEventDungeonId();this.m_event_dungeon=context.getEventDungeonData(),b.getUserEventDungeonTroopsNum().done(function(a){c=a})}else if(this.m_game_type==db.BattleGameType.DailyDungeon)this.m_daily_dungeon=context.getDailyDungeonData(),b.getUserDailyDungeonTroopsNum().done(function(a){c=a});else if(this.m_game_type==db.BattleGameType.RaidDungeon){b.getUserRaidBossTroopsNum().done(function(a){c=a})}else if(this.m_game_type==db.BattleGameType.GreatWallDungeon){b.getUserGreatWallTroopsNum().done(function(a){c=a})}else if(this.m_game_type==db.BattleGameType.TowerDungeon){b.getUserTowerDungeonTroopsNum().done(function(a){c=a})}else if(this.m_game_type==db.BattleGameType.OnceADayDungeon){b.getUserOnceADayDungeonTroopsNum().done(function(a){c=a})}else if(this.m_game_type==db.BattleGameType.EventRaidDungeon){b.getUserEventRaidDungeonTroopsNum().done(function(a){c=a})}return c},showGreatWallFirstPartinGnrl:function(){this.m_box.setTitle(res_str("label_information_title")),this.m_box.setText(res_str("label_great_wall_first_partin_msg_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_great_wall_first_partin_msg_2")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_great_wall_first_partin_msg_3")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_great_wall_first_partin_msg_4")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_cancel"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(){this.m_FriendSelectLayer_V2.reqGreatWallDungeonBegin()},0,"reqGreatWallDungeonBegin"),this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showEventRaidDungeonClear:function(){this.m_box.setTitle(res_str("label_common_information")),this.m_box.setText(res_str("event_raid_start_error_1")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide();var a={};a.opcode=net.OP.op_event_raid_dungeon_boss_info,a.event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),this.network_write(a)}.bind(this))),this.m_box.show()},showBattleMissionSkipResultModalLayer:function(c,d){this.m_mission_skip_game_result_modal_layer._contentNode=function(a,m){var b=new BattleMissionResultLayer_V2;return b.ignoreAnchorPointForPosition(!1),b.setAnchorPoint(ANCHOR_MIDDLE()),b.setGameScene(this),b.setPosition(ccCenter(this)),d==net.OP.op_weekly_dungeon_battle_skip?b.resultDataWeekly_Dungeon_Battle_Skip(c):d==net.OP.op_event_dungeon_battle_skip?b.resultDataEvent_Dungeon_Battle_Skip(c):d==net.OP.op_story_dungeon_battle_skip&&b.resultDataStory_Dungeon_Battle_Skip(c),b}.bind(this),this.m_mission_skip_game_result_modal_layer.show()},hideBattleMissionSkipResultModalLayer:function(){this.m_FriendSelectLayer_V2.updateSkipTicketCount(),this.refreshBgmSound(),this.skipAfterRefreshDeckInfo(),this.m_mission_skip_game_result_modal_layer.is_show()&&this.m_mission_skip_game_result_modal_layer.hide()},refreshBgmSound:function(){var a=MasterTable.getInstance();if(this.m_game_type==db.BattleGameType.Mission){var b=[],bgm_ref_idx=BattleContext._getInstance().getMissionStage();b=a.get_Bgm(BGM_TYPE_CHANGE_STORY_STAGE_BGM,b,bgm_ref_idx);var c=AudioEngine.getInstance(),b_path=RES_CDN_SOUND+SND_TYPE+"sound/"+b[0].sound_file_name;c.m_bgmPath!=b_path&&(c.stopBackgroundMusic(),c.playBackgroundMusic(b_path,!0))}else if(this.m_game_type==db.BattleGameType.EventDungeon){var d=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=MasterManager.getInstance().get_EventDungeonPeriod(d);b_path=RES_CDN_SOUND+SND_TYPE+"sound/"+cmString("BGM_marathon_loop_%d.mp3",period.event_dungeon_point_period_idx);(c=AudioEngine.getInstance()).m_bgmPath!=b_path&&(c.stopBackgroundMusic(),c.playBackgroundMusic(b_path,!0))}else this.m_game_type==db.BattleGameType.WeeklyDungeon&&this.playMainBGM()},showEventRaidDungeonBattleSelect:function(){this.m_selectBattleModalLayer._contentNode=function(a,m){return this.getSelectBattleLayer()}.bind(this),this.m_selectBattleModalLayer.show()},getSelectBattleLayer:function(){var c=new cc.Layer,m=MasterManager.getInstance(),nService=new NetService,context=BattleContext._getInstance(),win_size=cc.director.getWinSize(),bg=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",RectZero());bg.setInsetLeft(44),bg.setInsetRight(44),bg.setInsetTop(44),bg.setInsetBottom(44),bg.setPreferredSize(cc.size(680,405)),bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(win_size)),c.addChild(bg);var d=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_navi.png",RectZero());d.setInsetLeft(46),d.setInsetRight(46),d.setPreferredSize(cc.size(664,48)),d.setAnchorPoint(ANCHOR_MIDDLE_TOP()),d.setPosition(ccCenter(bg).x,ccHeight(bg)-11),bg.addChild(d);var e=cmLabel.getLabel(res_str("event_raid_start_skip_popup_title"),LABEL_FONT_INDEX.FONT_241);e.setAnchorPoint(ANCHOR_MIDDLE()),e.setPosition(ccCenter(d)),d.addChild(e);var f=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);f.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),f.setPosition(ccWidth(d)-11,7),f.addClickEventListener(function(a){this.m_selectBattleModalLayer.hide()}.bind(this)),d.addChild(f);var g=this.m_FriendSelectLayer_V2.m_boss_Damage,damage_text=new cmMultiLabel;damage_text.addLabel("[最大ダメージ： ",LABEL_FONT_INDEX.FONT_201),damage_text.addLabel(Number(parseInt(g)).toLocaleString("en"),LABEL_FONT_INDEX.FONT_247),damage_text.addLabel("]",LABEL_FONT_INDEX.FONT_201),damage_text.setLabel(),damage_text.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),damage_text.setPosition(250,314),bg.addChild(damage_text);var h=context.getEventRaidDungeonBattleTicket(),need_ticket=m.get_EventRaidDungeon(nService.get_Event_Raid_Dungeon_idx()).base_need_point*h,not_skip_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());not_skip_bg.setPreferredSize(cc.size(312,173)),not_skip_bg.setAnchorPoint(ZERO()),not_skip_bg.setPosition(21,117),bg.addChild(not_skip_bg);var i=cmLabel.getLabel(res_str("event_raid_start_skip_popup_text_1"),LABEL_FONT_INDEX.FONT_181);i.setAnchorPoint(ANCHOR_MIDDLE()),i.setPosition(ccCenter(not_skip_bg).x,ccCenter(not_skip_bg).y),not_skip_bg.addChild(i);var j=new ccui.Button("btn_38_off.png","btn_38_on.png","btn_38_none.png",ccui.Widget.PLIST_TEXTURE);j.setAnchorPoint(ZERO()),j.setPosition(28,35),j.addClickEventListener(function(b){this.m_selectBattleModalLayer.hide(),this.scheduleOnce(function(a){MainObserver.getInstance().postNotification(FriendSelectEnum.event_raid_battle_start)},0,"event_raid_battle_start")}.bind(this)),bg.addChild(j);var k=cmLabel.getLabel(res_str("event_raid_start_skip_popup_button_1"),LABEL_FONT_INDEX.FONT_181);k.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),k.setPosition(38,.5*ccHeight(j)),j.addChild(k),(q=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box.png",RectZero())).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),q.setPosition(156,.5*ccHeight(j)),q.setContentSize(76,28),j.addChild(q),(point_img=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_point.png",nService.get_Event_Raid_Dungeon_Period_idx()))).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),point_img.setPosition(144,17),j.addChild(point_img);var l=cmLabel.getLabel(cmString("%d",need_ticket),LABEL_FONT_INDEX.FONT_1810);l.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),l.setPosition(ccWidth(q)-10,.5*ccHeight(q)),q.addChild(l);var n=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());n.setPreferredSize(cc.size(312,173)),n.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),n.setPosition(ccWidth(bg)-21,117),bg.addChild(n);var o=cmLabel.getLabel(res_str("event_raid_start_skip_popup_text_2"),LABEL_FONT_INDEX.FONT_181);o.setAnchorPoint(ANCHOR_MIDDLE()),o.setPosition(ccCenter(n).x,ccCenter(n).y),n.addChild(o);var p=new ccui.Button("btn_38_off.png","btn_38_on.png","btn_38_none.png",ccui.Widget.PLIST_TEXTURE);p.setAnchorPoint(ZERO()),p.setPosition(380,35),p.addClickEventListener(function(b){this.m_selectBattleModalLayer.hide(),this.scheduleOnce(function(a){MainObserver.getInstance().postNotification(FriendSelectEnum.event_raid_skip_battle_start)},0,"event_raid_skip_battle_start")}.bind(this)),bg.addChild(p);var q,point_img,skip_label=cmLabel.getLabel(res_str("event_raid_start_skip_popup_button_2"),LABEL_FONT_INDEX.FONT_181);skip_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),skip_label.setPosition(18,.5*ccHeight(p)),p.addChild(skip_label),(q=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box.png",RectZero())).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),q.setPosition(156,.5*ccHeight(p)),q.setContentSize(76,28),p.addChild(q),(point_img=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_point.png",nService.get_Event_Raid_Dungeon_Period_idx()))).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),point_img.setPosition(144,17),p.addChild(point_img);var r=cmLabel.getLabel(cmString("%d",need_ticket),LABEL_FONT_INDEX.FONT_1810);return r.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),r.setPosition(ccWidth(q)-10,.5*ccHeight(q)),q.addChild(r),c},skipAfterRefreshDeckInfo:function(){var a=this.getCurrentTroopsNum();MainObserver.getInstance().postNotification(NOTIFY_MENU_PARTY_1+(a-1))},showFriendSelectPopup:function(){this.m_box.is_show()&&this.m_box.hide();for(var a=arguments,msg=[],i=1;i<a.length;i++)msg.push(a[i]);this.showMsgBox(a[0],msg),msg=null},showDailyDungeonInvalidEntranceTime:function(){this.m_box.setTitle(res_str("label_weekly_invalid_entrance")),this.m_box.setText(res_str("label_daily_dungeon_invalid_entrance_time_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_daily_dungeon_invalid_entrance_time_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showInvalidEntranceTime:function(){this.m_box.setTitle(res_str("label_weekly_invalid_entrance")),this.m_box.setText(res_str("label_weekly_invalid_entrance_time")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showTroopsInSearchTroopsGeneral:function(){this.m_box.setTitle(res_str("label_shop_buy_jade_omission_title")),this.m_box.setText(res_str("label_event_dungeon_troops_in_search_troops_general_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_event_dungeon_troops_in_search_troops_general_text_2")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_event_dungeon_troops_in_search_troops_general_text_3")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showEntranceLimitOver:function(){this.m_box.setTitle(res_str("label_weekly_invalid_entrance")),this.m_box.setText(res_str("label_daily_dungeon_entrance_limit_over")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()}}),StoryItemNodeV2=cc.Layer.extend({m_story_num_bg:null,m_lotus_bg:null,m_item_btn:null,m_story_num_label:null,m_focus_skeleteon:null,m_skeleton_node:null,m_boss_gnrl_id:0,m_touch_button:null,m_is_voice_playing:!1,m_voice_playing_delta:0,m_normal_img:null,m_press_img:null,m_disable_img:null,m_lotus_list:[],m_boss_list:[],m_skeleton_list:[],gnrl_img:[],sd_img:[],m_scene:null,ctor:function(a){this._super(),this.m_lotus_list=[],this.m_skeleton_list=[],this.m_boss_list=[],this.gnrl_img=[],this.sd_img=[],this.m_scene=a,this.m_voice_playing_delta=[],this.init()},init:function(){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE()),this.setContentSize(ZERO()),this.m_normal_img=RES_CDN_DEFULT+"menu_quest/img_story_normal_off.png",this.m_press_img=RES_CDN_DEFULT+"menu_quest/img_story_normal_on.png",this.m_disable_img=RES_CDN_DEFULT+"menu_quest/img_story_normal_off.png",this.m_item_btn=new ccui.Button,this.m_item_btn.loadTextures(RES_CDN_DEFULT+"menu_quest/img_story_normal_off.png",RES_CDN_DEFULT+"menu_quest/img_story_normal_on.png",RES_CDN_DEFULT+"menu_quest/img_story_normal_off.png"),this.m_item_btn.setAnchorPoint(ANCHOR_MIDDLE()),USE_SP_STORY_SCALE&&this.m_item_btn.setScale(2),this.m_item_btn.setPosition(ZERO()),this.m_item_btn.addClickEventListener(function(a){BattleContext._getInstance().setMainMissionV2(this.m_mission),MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_choice_difficulty_type_show)}.bind(this)),this.addChild(this.m_item_btn);var b=ccSize(this.m_item_btn);this.setContentSize(b),this.m_story_num_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_number.png"),this.m_story_num_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_story_num_bg.setPosition(0,-25),USE_SP_STORY_SCALE&&this.m_story_num_bg.setScale(2),this.addChild(this.m_story_num_bg),this.m_story_num_label=cmLabel.createWithTTF("",FONT_NAME_NOTOSANS_MEDIUM,20),this.m_story_num_label.setColor(cc.color(238,238,238)),this.m_story_num_label.setAnchorPoint(ANCHOR_MIDDLE()),USE_SP_STORY_SCALE?(this.m_story_num_label.setPosition(ccCenter(this.m_story_num_bg).x,ccCenter(this.m_story_num_bg).y+1),this.m_story_num_label.setScale(.5)):this.m_story_num_label.setPosition(ccCenter(this.m_story_num_bg).x,ccCenter(this.m_story_num_bg).y+3),this.m_story_num_bg.addChild(this.m_story_num_label),this.m_lotus_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_star_none.png"),this.m_lotus_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_lotus_bg.setPositionY(-50),this.addChild(this.m_lotus_bg);for(var c=[cc.p(7,13),cc.p(36,2),cc.p(64,13)],i=0;i<3;i++){var d=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_star_on_2.png");d.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),d.setPosition(c[i]),this.m_lotus_bg.addChild(d),this.m_lotus_list.push(d)}return this.scheduleUpdate(),!0},setMissionData:function(m){this.m_mission=m,this.showBtnEffect(!1),this.updateLayout();for(var a=0;a<this.m_mission.difficulty_mission.length;a++){1011==(m=this.m_mission.difficulty_mission[a]).mission.main_mission_id&&this.m_item_btn.setTutorialTag(TUTORIAL_TAG_PAGE_1_STAGE_1_1)}this.m_is_voice_playing=!1,this.m_voice_playing_delta=0},updateStarPoint:function(){for(var a=0,clear_count=0,idx=0;idx<this.m_mission.difficulty_mission.length;idx++){var m=this.m_mission.difficulty_mission[idx];"y"==m.complete_yn&&(clear_count+=1);for(var b=0,jdx=0;jdx<m.task_list.length;jdx++){m.task_list[jdx].is_cleared&&(b+=1)}3==b&&(a+=1)}0==a?0<clear_count?this.m_lotus_bg.setVisible(!0):this.m_lotus_bg.setVisible(!1):this.m_lotus_bg.setVisible(!0);for(var i=0;i<this.m_lotus_list.length;i++)i<a?this.m_lotus_list[i].setVisible(!0):this.m_lotus_list[i].setVisible(!1)},showBtnEffect:function(a){a&&null==this.m_focus_skeleteon&&(this.m_focus_skeleteon=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Story.json",RES_CDN_DEFULT+"effect/Story.atlas",1),this.m_focus_skeleteon.setPosition(ZERO()),this.addChild(this.m_focus_skeleteon),this.m_focus_skeleteon.setAnimation(0,"fx_1",!0),this.m_focus_skeleteon.setVisible(!1)),null!=this.m_focus_skeleteon&&this.m_focus_skeleteon.setVisible(a)},updateLayout:function(){var a=this.m_mission.num+"章";if(this.m_story_num_label.setString(a),null!=this.m_skeleton_node&&(this.m_skeleton_node.setVisible(!1),this.removeChild(this.m_skeleton_node),this.m_skeleton_node=null),this.hideSkeletonBoss(),this.hideSpriteBoss(),"y"==this.m_mission.complete_yn?(this.m_story_num_label.setColor(cc.color(238,238,238)),this.m_story_num_bg.setVisible(!0),this.m_item_btn.setEnabled(!0),this.m_mission.is_current?this.createPartner():5!=this.m_mission.num&&10!=this.m_mission.num||this.createBoss("y"==this.m_mission.complete_yn)):"y"==this.m_mission.new_yn?(this.createPartner(),this.m_story_num_label.setColor(cc.color(238,238,238)),this.m_story_num_bg.setVisible(!0),this.m_item_btn.setEnabled(!0),this.showBtnEffect(!0)):(5==this.m_mission.num||10==this.m_mission.num?this.createBoss("y"==this.m_mission.complete_yn):null!=this.m_skeleton_node&&this.m_skeleton_node.setVisible(!1),this.m_story_num_label.setColor(cc.color(129,129,129)),this.m_story_num_bg.setVisible(!1),this.m_item_btn.setEnabled(!1)),5==this.m_mission.num||10==this.m_mission.num)this.m_normal_img!=RES_CDN_DEFULT+"menu_quest/img_story_boss_off.png"&&(this.m_normal_img=RES_CDN_DEFULT+"menu_quest/img_story_boss_off.png",this.m_press_img=RES_CDN_DEFULT+"menu_quest/img_story_boss_on.png",this.m_disable_img=RES_CDN_DEFULT+"menu_quest/img_story_boss_off.png",this.m_item_btn.loadTextureNormal(this.m_normal_img),this.m_item_btn.loadTexturePressed(this.m_press_img),this.m_item_btn.loadTextureDisabled(this.m_disable_img));else if(this.m_normal_img!=RES_CDN_DEFULT+"menu_quest/img_story_normal_off.png"){this.m_normal_img=RES_CDN_DEFULT+"menu_quest/img_story_normal_off.png",this.m_press_img=RES_CDN_DEFULT+"menu_quest/img_story_normal_on.png",this.m_disable_img=RES_CDN_DEFULT+"menu_quest/img_story_normal_off.png";var b=cc.Sprite.create(this.m_normal_img),on=cc.Sprite.create(this.m_press_img),dis=cc.Sprite.create(this.m_disable_img);this.m_item_btn.loadTextureNormal(b),this.m_item_btn.loadTexturePressed(on),this.m_item_btn.loadTextureDisabled(dis)}this.updateStarPoint()},createPartner:function(){if(null==this.m_skeleton_node){MasterTable.getInstance().getMasterTable();var b=GeneralService.getInstance().getUserTroopsPartnerId();if(0!=b){var c=GameContext.getInstance().getUserGeneralPartner(),main_gnrl_key=new net.User_General_Key;main_gnrl_key.gnrl_id=c.gnrl_id,main_gnrl_key.gnrl_num=c.gnrl_num;var d,partner_gnrl=new db.UserGeneralInfo;GeneralService.getInstance().getUserGnrlDisplayClassInfo(main_gnrl_key,partner_gnrl),d=partner_gnrl.class_type>=AVAIL_EVOLUTION_CLASS_TYPE_LIMIT&&0!=partner_gnrl.display_class&&partner_gnrl.class_type!=partner_gnrl.display_class?partner_gnrl.gnrl_id-1e3*(partner_gnrl.class_type-partner_gnrl.display_class):partner_gnrl.gnrl_id;var f=MasterManager.getInstance().get_General(b),skin_id=f.bone_id!=f.skin_id?d:f.skin_id;if(USE_SP_SD_STORY)USE_SP_SD_DUMMY&&(skin_id=9999999),this.gnrl_img=[],this.gnrl_img.push(RES_CDN_DEFULT+"card_body_sp/"+skin_id+".png"),resourceLoader(this.gnrl_img,function(){this.m_skeleton_node=cc.Sprite.create(RES_CDN_DEFULT+"card_body_sp/"+skin_id+".png"),this.m_skeleton_node.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_skeleton_node.setPosition(ZERO()),this.m_skeleton_node.setFlippedX(!0),this.m_skeleton_node.setScale(.7),this.addChild(this.m_skeleton_node);var a=new cc.ScaleTo(.6,.7,.72),scaleTo_2=new cc.ScaleTo(.6,.7,.68),sequence=new cc.Sequence(a,scaleTo_2),repeat=new cc.RepeatForever(sequence);this.m_skeleton_node.runAction(repeat),MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],already_tutorial)}.bind(this));else{this.gnrl_img=[];for(var g=SDGeneralName[f.gnrl_group],idx=0;idx<g.length;idx++)this.gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(f.gnrl_group,3)+"/sd/"+g[idx]+".png");this.gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(f.gnrl_group,3)+"/sd/"+skin_id+".atlas"),this.gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(f.gnrl_group,3)+"/sd/"+skin_id+".json"),resourceLoader(this.gnrl_img,function(){var a=RES_CDN_DEFULT+"gnrl_"+leadingZeros(f.gnrl_group,3)+"/sd/"+skin_id+".atlas",sd_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(f.gnrl_group,3)+"/sd/"+skin_id+".json";if(this.m_skeleton_node=new sp.SkeletonAnimation(sd_json,a,.2),this.m_skeleton_node._skeleton.flipX=!0,this.m_skeleton_node.setPosition(ZERO()),this.m_skeleton_node.setEventListener(this.spineEventListener.bind(this)),this.addChild(this.m_skeleton_node),d!=b)try{this.m_skeleton_node.setSkin(partner_gnrl.display_class)}catch(e){}else try{this.m_skeleton_node.setSkin(f.gnrl_class)}catch(e){}this.m_skeleton_node.setAnimation(0,"run",!0),this.m_skeleton_node.setAnimation(1,"shadow_off",!0),MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],already_tutorial)}.bind(this))}}}null!=this.m_skeleton_node&&this.m_skeleton_node.setVisible(!0)},spineEventListener:function(a,b){var c=b.data.name.toLowerCase();"loop_show"==c?this.m_skeleton_node.setAnimation(2,"loop",!0):"loop_hide"==c&&this.m_skeleton_node.setAnimation(2,"loop_off",!0)},createBoss:function(a){var m=MasterManager.getInstance();this.m_boss_gnrl_id=0;for(var b=this.m_mission.difficulty_mission.length,npc_list=this.m_mission.difficulty_mission[b-1].stage_npc[3],e=0;e<npc_list.length;e++)if(npc_list[e].is_zoom){var c=m.get_NpcGeneral(npc_list[e].npc_id);this.m_boss_gnrl_id=c.gnrl_id;break}if(a){var d=!1;for(var e in this.m_boss_list)if(e==this.m_boss_gnrl_id){d=!0,this.m_boss_list[e].setVisible(!0);break}if(!d){(h=cc.Sprite.create(RES_CDN_DEFULT+"menu_boss/"+this.m_boss_gnrl_id+".png")).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),h.setPosition(ZERO(0)),this.addChild(h),this.m_boss_list[this.m_boss_gnrl_id]=h;var f=new cc.ScaleTo(1.2,1,1.03),scaleTo_2=new cc.ScaleTo(1.2,1,.97),sequence=new cc.Sequence(f,scaleTo_2),repeat=new cc.RepeatForever(sequence);h.runAction(repeat)}}else if(0!=this.m_boss_gnrl_id){d=!1;for(var e in this.m_skeleton_list)if(e==this.m_boss_gnrl_id){d=!0,this.m_skeleton_list[e].setVisible(!0);break}if(!d){var g=MasterManager.getInstance().get_General(this.m_boss_gnrl_id);if(USE_SP_SD_STORY_BOSS){var h;(h=cc.Sprite.create(RES_CDN_DEFULT+"menu_boss/"+this.m_boss_gnrl_id+".png")).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),h.setPosition(ZERO(0)),this.addChild(h),this.m_boss_list[this.m_boss_gnrl_id]=h;f=new cc.ScaleTo(1.2,1,1.03),scaleTo_2=new cc.ScaleTo(1.2,1,.97),sequence=new cc.Sequence(f,scaleTo_2),repeat=new cc.RepeatForever(sequence);h.runAction(repeat)}else{this.sd_img=[];var i=SDGeneralName[g.gnrl_group];for(e=0;e<i.length;e++)this.sd_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(g.gnrl_group,3)+"/sd/"+i[e]+".png");this.sd_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(g.gnrl_group,3)+"/sd/"+g.skin_id+".atlas"),this.sd_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(g.gnrl_group,3)+"/sd/"+g.skin_id+".json"),resourceLoader(this.sd_img,this.loadBoss.bind(this))}}}this.createTouchButton()},loadBoss:function(){var a=MasterManager.getInstance().get_General(this.m_boss_gnrl_id),sd_atlas=RES_CDN_DEFULT+"gnrl_"+leadingZeros(a.gnrl_group,3)+"/sd/"+a.gnrl_id+".atlas",sd_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(a.gnrl_group,3)+"/sd/"+a.gnrl_id+".json",skeleton=new sp.SkeletonAnimation(sd_json,sd_atlas,.23);skeleton.setPosition(ZERO()),this.addChild(skeleton);try{skeleton.setSkin(a.gnrl_class)}catch(e){}skeleton.setAnimation(0,"idle",!0),skeleton.setAnimation(1,"shadow_off",!0),skeleton._skeleton.data.findAnimation("loop")&&skeleton.setAnimation(1,"loop",!0),this.m_skeleton_list[this.m_boss_gnrl_id]=skeleton},hideSkeletonBoss:function(){for(var a in this.m_skeleton_list)this.m_skeleton_list.hasOwnProperty(a)&&this.m_skeleton_list[a].setVisible(!1)},hideSpriteBoss:function(){for(var a in this.m_boss_list)this.m_boss_list.hasOwnProperty(a)&&this.m_boss_list[a].setVisible(!1)},createTouchButton:function(){null==this.m_touch_button&&(this.m_touch_button=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png"),cc.Rect(1,1,1,1)),this.m_touch_button.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_touch_button.setPreferredSize(cc.size(78,110)),this.m_touch_button.setPosition(0,30),this.addChild(this.m_touch_button),this.m_touch_button.addTargetWithActionForControlEvents(this,this.onTouchBoss,cc.CONTROL_EVENT_TOUCH_UP_INSIDE))},onTouchBoss:function(a,b){if(!this.m_is_voice_playing&&0<this.m_boss_gnrl_id){var c=0,voice_list=MasterTable.getInstance().get_Voice(this.m_boss_gnrl_id,voice_main_body_touch,0,c),voice=voice_list.voice;c=voice_list.duration;var d=AudioEngine.getInstance();""!=voice&&null!=voice&&(d.playVoice(RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3",!1),this.m_is_voice_playing=!0,this.m_voice_playing_delta=c)}},update:function(a){this.m_is_voice_playing&&(this.m_voice_playing_delta-=a,this.m_voice_playing_delta<0&&(this.m_is_voice_playing=!1,this.m_voice_playing_delta=0))},onExit:function(){if(this._super(),1!=this.m_scene.m_isPopupShow){if(null!=this.gnrl_img){for(var a=0;a<this.gnrl_img.length;a++)cc.loader.release(this.gnrl_img[a]);this.gnrl_img=null}for(var i=0;i<this.sd_img.length;i++)cc.loader.release(this.sd_img[i]);this.sd_img=[],this.m_scene=null,this.removeChild(this.m_skeleton_node),this.m_skeleton_node=null,this.m_skeleton_list=null,this.m_lotus_bg=null,this.m_mission=null,this.removeAllChildrenWithCleanup(!0)}}}),story_choice_difficulty_type_show=100,story_choice_difficulty_type_hide=101,story_preview_mission_show=102,story_preview_mission_hide=103,story_friend_select=104,story_scene_req_lotus_bonus=300,story_scene_already_lotus_bonus_get=301,story_scene_lack_lotus_bonus_get=302,message_ok=1e3,StoryEnum={btn_show_help:303},btn_show_help=303,already_tutorial=220,StorySceneV2=GameScene.extend({m_story_layer:null,m_mission_choice_modal_layer:null,m_mission_ready_modal_layer:null,m_is_tuto_ready:!1,m_progres_bar:null,m_deferred:null,m_statusLayer:null,m_storyScene_res:[],m_resArray:[],ctor:function(){this._super(scene_StorySceneV2),this.m_deferred=$.Deferred(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_StorySceneV2])},finish_tutorial:function(){this.scheduleOnce(function(){this.m_is_tuto_ready=!0,this.removeChild(this.m_progres_bar)}.bind(this),1,"tutorial_ready")},init:function(){this.m_storyScene_res=[],this.m_storyScene_res.push(RES_CDN_DEFULT+"effect/Story.atlas"),this.m_storyScene_res.push(RES_CDN_DEFULT+"effect/Story.json"),this.m_storyScene_res.push(RES_CDN_DEFULT+"effect/Story.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_dailyvs/bg_daily_dungeon.png"),0==USE_SP_STORY_CLOUD&&(this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/bg_story_1_cloud.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/effect_cloud_2.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/effect_cloud_1.png")),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_reward_unlock.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_unlock.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_unlock.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_ready.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_ready.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_lock.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_lock.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_input_box.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_reward_box.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_boss_off.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_boss_on.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_normal_off.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_normal_on.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_number.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_star_on_2.png");for(var f=1;f<11;f++)this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_stage_text_door_"+f+".png");for(f=1;f<10;f++)this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_stage_text_"+f+".png");return NOT_USE_SP_MAIN_ANIMATION&&this.m_storyScene_res.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_new_01.png"),resourceLoader(this.m_storyScene_res,function(){this.m_story_layer=new StoryLayerV2(this),this.m_story_layer.setPosition(ccCenter(this)),this.addChild(this.m_story_layer,0);var b=cc.director.getWinSize();this.m_statusLayer=new StatusLayer(INVOKER_TYPE.normal),this.m_statusLayer.initLayout(),this.m_statusLayer.ignoreAnchorPointForPosition(!1),this.m_statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_statusLayer.setPosition(cc.p(b.width,b.height)),this.addChild(this.m_statusLayer,1);var c=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_text_story.png");c.setAnchorPoint(ZERO()),c.setPosition(90,585),this.addChild(c,2);var d=new ccui.Button;d.loadTextures("btn_home_off.png","btn_home_on.png","",ccui.Widget.PLIST_TEXTURE),d.setAnchorPoint(ZERO()),d.setPosition(10,559),d.addClickEventListener(function(a){1!=this.m_statusLayer.m_is_touch_disable&&this.back()}.bind(this)),this.addChild(d,3);var e=cc.size(b.width,640);this.m_mission_choice_modal_layer=new GameModalLayer,this.m_mission_choice_modal_layer.setContentSize(e),this.addChild(this.m_mission_choice_modal_layer,99998),this.m_mission_ready_modal_layer=new GameModalLayer,this.m_mission_ready_modal_layer.setContentSize(e),this.addChild(this.m_mission_ready_modal_layer,99999)}.bind(this)),!0},onEnter:function(){this._super()},get_story_deferred:function(){return this.m_deferred},onExit:function(){if(this._super(),1!=this.m_isPopupShow){if(null!=this.m_story_layer&&(this.m_story_layer.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_story_layer),this.m_story_layer=null),null!=this.m_mission_choice_modal_layer&&(this.m_mission_choice_modal_layer.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_mission_choice_modal_layer),this.m_mission_choice_modal_layer=null),null!=this.m_mission_ready_modal_layer&&(this.m_mission_ready_modal_layer.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_mission_ready_modal_layer),this.m_mission_ready_modal_layer=null),null!=this.m_storyScene_res){for(var i=0;i<this.m_storyScene_res.length;i++)cc.loader.release(this.m_storyScene_res[i]);this.m_storyScene_res=null}if(null!=this.m_resArray){for(var a=0;a<this.m_resArray.length;a++)cc.loader.release(this.m_resArray[a]);this.m_resArray=null}this.m_deferred=null,this.removeAllChildrenWithCleanup(!0),MainObserver.getInstance().removeObserver(sceneStr[scene_StorySceneV2])}else this.m_isPopupShow=!1},onEnterTransitionDidFinish:function(){this._super();var b=BattleContext._getInstance();b.IsNextMissionPopup()&&(0<b.getMissionID()?this.m_isShowAchivLayer?b.showNextMissionPopup(!1):this.scheduleOnce(function(a){this.m_isShowAchivLayer||MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_choice_difficulty_type_show)},.1,"next_mission_popup"):b.showNextMissionPopup(!1))},onNotification:function(a,b,c){if(!this._super(a)){switch(a){case story_choice_difficulty_type_show:this.initLayoutProgress2(0);for(var d=BattleContext._getInstance().getMainMissionV2(),idx=0;idx<this.m_resArray.length;idx++)cc.loader.release(this.m_resArray[idx]);this.m_resArray=[];for(var i=0;i<d.difficulty_mission.length;i++){var e=d.difficulty_mission[i];for(var f in e.stage_npc)if(3==f){var h=e.stage_npc[f];for(var g in h)if(h[g].is_zoom){f=MasterManager.getInstance().get_NpcGeneral(h[g].npc_id);var j=MasterManager.getInstance().get_General(f.gnrl_id);this.m_resArray.push(RES_CDN_DEFULT+"card_story_boss/"+leadingZeros(j.gnrl_group,2)+".png"),j=f=null}h=null}e=null}this.m_resArray.push(RES_CDN_DEFULT+"common/img_cloud_top.png"),this.m_resArray.push(RES_CDN_DEFULT+"common/img_cloud_bottom.png"),this.m_resArray.push(RES_CDN_DEFULT+"menu_quest/img_story_normal_large_off.png"),this.m_resArray.push(RES_CDN_DEFULT+"menu_quest/img_story_normal_large_off.png"),this.m_resArray.push(RES_CDN_DEFULT+"menu_quest/img_story_sakura_2_off.png"),this.m_resArray.push(RES_CDN_DEFULT+"menu_quest/img_story_door_1.png"),this.m_resArray.push(RES_CDN_DEFULT+"menu_quest/img_story_door_2.png"),this.m_resArray.push(RES_CDN_DEFULT+"menu_quest/img_story_door_3.png"),this.m_resArray.push(RES_CDN_DEFULT+"menu_quest/img_story_sakura_2_on.png"),this.m_resArray.push(RES_CDN_DEFULT+"menu_quest/img_story_normal_large_black.png"),this.m_resArray.push(RES_CDN_DEFULT+"menu_quest/img_story_reward_box_black.png"),this.m_resArray.push(RES_CDN_DEFULT+"menu_quest/img_story_lock.png"),resourceLoader(this.m_resArray,function(){this.showMainMIssionChoicePopup(),this.removeLayerProgress2()}.bind(this));break;case story_choice_difficulty_type_hide:this.hideMainMissionChoicePopup();break;case story_preview_mission_show:this.showMissionReadyModalLayer();break;case story_preview_mission_hide:this.hideMissionReadyModalLayer();break;case story_friend_select:this.initLayoutProgress3();var k={};k.opcode=net.OP.op_mission_battle_friend_list,this.network_write(k);break;case story_scene_req_lotus_bonus:this.reqLotusBonus();break;case story_scene_already_lotus_bonus_get:this.showToastBox("恋花報酬","既に報酬を獲得した箱です。",2);break;case story_scene_lack_lotus_bonus_get:this.showToastBox("恋花報酬","恋花が足りなくて箱を開けられません",2);break;case message_ok:this.m_box.is_show()&&this.m_box.hide();break;case StoryEnum.btn_show_help:this.m_isPopupShow=!0,GameContext.getInstance().setHelpInfoIndexByCallIndex(3);var l=new HelpContentScene;SceneManager.getInstance().pushScene(l),l=null;break;case already_tutorial:this.m_deferred.resolve(!0),this.finish_tutorial()}return!0}},onNetworkEvent:function(a,b,c){if(a==net.OP.op_mission_battle_friend_list){this.removeLayerProgress3(),BattleContext._getInstance().setFriendList(c.frnd_list);var d=new FriendSelectScene;SceneManager.getInstance().replaceScene(d),d=null}else if(a==net.OP.op_main_story_lotus_bonus_get_v2){var m=MasterManager.getInstance(),lotus_bonus=m.get_MainStoryLotusBonus(c.lotus_bonus_log.main_scene_id,c.lotus_bonus_log.main_story_id,c.lotus_bonus_log.difficulty_type,c.lotus_bonus_log.lotus_count),bonus=m.get_BonusType(lotus_bonus.bonus_type);this.m_box.setTitle("恋花報酬");var e="";if(lotus_bonus.bonus_type==BONUS_TYPE_LOVE_ITEM||lotus_bonus.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||lotus_bonus.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT)e="恋花獲得報酬で"+bonus.name+"1個を獲得しました。\nメールで受け取ってください。";else if(lotus_bonus.bonus_type==BONUS_TYPE_JIN_FIX||lotus_bonus.bonus_type==BONUS_TYPE_YUNHEE_FIX){e="恋花獲得報酬で"+m.get_General(lotus_bonus.bonus_count).name+"1個を獲得しました。\nメールで受け取ってください。"}else e="恋花獲得報酬で"+bonus.name+lotus_bonus.bonus_count+"個を獲得しました。\nメールで受け取ってください。";this.m_box.setText(e),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo("確認",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show(),this.m_story_layer.setLotusBonusResult(c)}},back:function(){this.onKeyBack(!0,!1)},onTutorialEnter:function(b){TutorialContextV2.getInstance();this.setTutorialStep(b),b.tutorial_page==TUTORIAL_PAGE_1_STORY&&(3==b.tutorial_step&&this.initLayoutProgress(),5==b.tutorial_step?(this.popTutorialLayer(),this.scheduleOnce(function(a){this.setTutorialStep(b)}.bind(this),.1,"tutorial_layer")):7==b.tutorial_step?(this.popTutorialLayer(),this.scheduleOnce(function(a){this.setTutorialStep(b)}.bind(this),.1,"tutorial_layer")):9==b.tutorial_step&&this.popTutorialLayer())},hideMainMissionChoicePopup:function(){this.m_mission_choice_modal_layer.is_show()&&this.m_mission_choice_modal_layer.hide()},showMainMIssionChoicePopup:function(){this.m_mission_choice_modal_layer._contentNode=function(a,m){var b=new cc.Layer,mainMission=BattleContext._getInstance().getMainMissionV2(),popup=new StorySelectionPopup(mainMission);return b.setContentSize(popup.getContentSize()),b.setPosition(.5*this.getContentSize()),b.ignoreAnchorPointForPosition(!1),b.setAnchorPoint(ANCHOR_MIDDLE()),b.addChild(popup),popup.setPosition(ccCenter(b)),this.m_mission_choice_modal_layer.setContentSize(b.getContentSize()),b}.bind(this),this.m_mission_choice_modal_layer.is_show()||this.m_mission_choice_modal_layer.show()},showMissionReadyModalLayer:function(){this.m_mission_ready_modal_layer._contentNode=function(a,m){var b=BattleContext._getInstance().getMissionID();return new MissionPreviewPopup(b)},this.m_mission_ready_modal_layer.is_show()||this.m_mission_ready_modal_layer.show()},hideMissionReadyModalLayer:function(){this.m_mission_ready_modal_layer.is_show()&&this.m_mission_ready_modal_layer.hide()},reqLotusBonus:function(){var a=BattleContext._getInstance(),req={};req.opcode=net.OP.op_main_story_lotus_bonus_get_v2,req.main_scene_id=a.getLotusBonusMainSceneID(),req.main_story_id=a.getLotusBonusMainStoryID(),req.difficulty_type=a.getLotusBonusDifficultyType(),req.lotus_count=a.getLotusBonusLotusCount(),this.network_write(req)},network_write:function(a){var b=SceneManager.getInstance().getMainScene();GameClient().write(a,b.onNetworkEvent,b)}}),StoryLayerV2=cc.Layer.extend({m_base_layer:null,m_cloud_layer:null,m_ui_layer:null,m_bg:null,m_story_title:null,m_cloud:null,m_main_scene_id:0,m_story_index:0,m_max_story_index:0,m_arrow_left:null,m_arrow_right:null,m_lotus_box_info_modal_layer:null,m_lotus_bonus_box:null,m_lotus_total_point:null,m_beginner_hint_box:null,m_lotus_box_light:[],m_story_item_list:[],m_lotus_box_btns:[],m_lotus_bonus_labels:[],m_story_list:[],m_scene:null,m_is_partner_load:!1,m_stroy_text:null,ctor:function(a){this._super(),this.m_lotus_box_light=[],this.m_lotus_box_btns=[],this.m_lotus_bonus_labels=[],this.m_story_list=[],this.m_story_item_list=[],this.m_scene=a,this.m_is_partner_load=!1,this.m_arrow_right=null,this.m_arrow_left=null,this.m_stroy_text=null,this.initLayout()},initLayout:function(){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var c=cc.size(this),context=BattleContext._getInstance();if(context.IsNextMissionPopup()){var d=context.getMissionID();this.getMainStoryListByMissionId(d)}else{0<(d=context.getMissionID())?this.getMainStoryListByMissionId(d):this.getMainStoryList()}this.m_base_layer=new cc.Layer,this.m_base_layer.ignoreAnchorPointForPosition(!1),this.m_base_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_base_layer.setPosition(ccCenter(c)),this.addChild(this.m_base_layer,0),this.m_cloud_layer=new cc.Layer,this.m_cloud_layer.ignoreAnchorPointForPosition(!1),this.m_cloud_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_cloud_layer.setPosition(ccCenter(c)),this.addChild(this.m_cloud_layer,100),this.m_ui_layer=new cc.Layer,this.m_ui_layer.ignoreAnchorPointForPosition(!1),this.m_ui_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_ui_layer.setPosition(ccCenter(c)),this.addChild(this.m_ui_layer,200);var e=RES_CDN_DEFULT+"menu_quest/bg_story_"+(this.m_story_index+1)+".jpg";this.m_bg=cc.Sprite.create(e),this.m_bg.setPosition(ccCenter(this.m_base_layer)),this.m_bg.setAnchorPoint(ANCHOR_MIDDLE()),USE_SP_STORY_SCALE&&this.m_bg.setScale(2),this.m_base_layer.addChild(this.m_bg);for(var f=MasterTable.getInstance().get_MainMissionStagePosList(this.m_main_scene_id,this.m_story_index+1),i=0;i<this.m_story_list[this.m_story_index].mission_list.length;i++){var g=f[i],item=new StoryItemNodeV2(this.m_scene);item.setPosition(g.x,g.y),USE_SP_STORY_SCALE?this.m_base_layer.addChild(item):this.m_bg.addChild(item),item.setMissionData(this.m_story_list[this.m_story_index].mission_list[i]),"y"==this.m_story_list[this.m_story_index].mission_list[i].new_yn&&(this.m_is_partner_load=!0),this.m_story_item_list.push(item),item=g=null}f=null,0==USE_SP_STORY_CLOUD&&this.createCloudScroll();var h=RES_CDN_DEFULT+"menu_quest/img_story_stage_text_"+(this.m_story_index+1)+".png";this.m_story_title=cc.Sprite.create(h),this.m_story_title.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_story_title.setPosition(.5*c.width,544),USE_SP_STORY_SCALE&&this.m_story_title.setScale(2),this.m_ui_layer.addChild(this.m_story_title),h=null,this.m_arrow_left=new ccui.Button("btn_castle_arrow_off.png","btn_castle_arrow_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_arrow_left.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_arrow_left.setFlippedX(!0),this.m_arrow_left.setPosition(10,.5*c.height),this.m_arrow_left.addClickEventListener(function(b){this.m_story_index--,this.m_story_index=Math.max(this.m_story_index,0),this.getParent().initLayoutProgress2(0),this.updateStoryLayout().done(function(a){1==a&&this.getParent().removeLayerProgress2()}.bind(this))}.bind(this)),this.m_arrow_left.setTag(this.m_story_index),this.m_ui_layer.addChild(this.m_arrow_left),this.m_arrow_right=new ccui.Button("btn_castle_arrow_off.png","btn_castle_arrow_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_arrow_right.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_arrow_right.setPosition(c.width-10,.5*c.height),this.m_arrow_right.addClickEventListener(function(b){this.m_story_index++,this.m_story_index=Math.min(this.m_story_index,this.m_max_story_index),this.getParent().initLayoutProgress2(0),this.updateStoryLayout().done(function(a){1==a&&this.getParent().removeLayerProgress2()}.bind(this))}.bind(this)),this.m_arrow_right.setTag(this.m_story_index),this.m_ui_layer.addChild(this.m_arrow_right),this.m_stroy_text=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_text_story.png"),this.m_stroy_text.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_stroy_text.setPosition(LP(this,83,579)),this.m_ui_layer.addChild(this.m_stroy_text),USE_SP_STORY_SCALE?this.createLotusBox_SP():this.createLotusBox(),this.updateLotusBox(),this.m_beginner_hint_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_banner_1.png"),this.m_beginner_hint_box.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_beginner_hint_box.setPosition(c.width-10,0),USE_SP_STORY_SCALE&&this.m_beginner_hint_box.setScale(2),this.m_ui_layer.addChild(this.m_beginner_hint_box),this.checkArrow(),this.m_lotus_box_info_modal_layer=new GameModalLayer,this.m_lotus_box_info_modal_layer.setContentSize(c),this.addChild(this.m_lotus_box_info_modal_layer,99999);var j=this.m_story_index+1,bgm_list=[];bgm_list=MasterTable.getInstance().get_Bgm(BGM_TYPE_CHANGE_STORY_STAGE_BGM,bgm_list,j);var k=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm_list[0].sound_file_name;k.m_bgmPath!=path&&k.playBackgroundMusic(path,!0),BattleContext._getInstance().setMissionStage(j),0==this.m_is_partner_load&&MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],already_tutorial)},onEnter:function(){this._super(),this.scheduleOnce(function(){this.checkLotusBonus()},1,"checkLotusBonus")},onExit:function(){this._super(),1!=this.m_scene.m_isPopupShow&&(null!=this.m_bg&&(this.m_bg.removeAllChildrenWithCleanup(!0),this.m_bg=null),null!=this.m_base_layer&&(this.m_base_layer.removeChild(this.m_bg),this.m_base_layer.removeAllChildrenWithCleanup(!0),this.m_base_layer=null,this.removeChild(this.m_base_layer)),null!=this.m_cloud&&(this.m_cloud.removeAllChildrenWithCleanup(!0),this.m_cloud_layer.removeChild(this.m_cloud),this.m_cloud=null),null!=this.m_cloud_layer&&(this.m_cloud_layer.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_cloud_layer),this.m_cloud_layer=null),null!=this.m_lotus_bonus_box&&(this.m_lotus_bonus_box.removeChild(this.m_lotus_total_point),this.m_lotus_bonus_box.removeAllChildrenWithCleanup(!0)),null!=this.m_ui_layer&&(this.m_ui_layer.removeChild(this.m_story_title),this.m_ui_layer.removeChild(this.m_arrow_left),this.m_ui_layer.removeChild(this.m_arrow_right),this.m_ui_layer.removeChild(this.m_stroy_text),this.m_ui_layer.removeChild(this.m_beginner_hint_box),this.m_ui_layer.removeChild(this.m_beginner_lotus_info),this.m_ui_layer.removeChild(this.m_lotus_bonus_box),this.m_ui_layer.removeAllChildrenWithCleanup(!0)),this.removeChild(this.m_ui_layer),this.m_ui_layer=null,this.removeChild(this.m_lotus_box_info_modal_layer),this.m_lotus_box_info_modal_layer=null,this.m_story_list=null,this.m_story_title=null,this.m_arrow_left=null,this.m_arrow_right=null,this.m_stroy_text=null,this.m_beginner_hint_box=null,this.m_beginner_lotus_info=null,this.m_lotus_bonus_box=null,this.m_lotus_total_point=null,this.m_lotus_box_light=null,this.m_lotus_bonus_labels=null,this.m_lotus_box_btns=null,this.m_story_item_list=null,this.removeAllChildrenWithCleanup(!0))},checkArrow:function(){null!=this.m_arrow_left&&(0==this.m_story_index?this.m_arrow_left.setVisible(!1):this.m_arrow_left.setVisible(!0)),null!=this.m_arrow_right&&(this.m_story_index>=this.m_max_story_index?this.m_arrow_right.setVisible(!1):this.m_arrow_right.setVisible(!0)),null!=this.m_beginner_hint_box&&this.m_beginner_hint_box.setVisible(0==this.m_story_index),null!=this.m_beginner_lotus_info&&this.m_beginner_lotus_info.setVisible(0==this.m_story_index)},getLotusBonus:function(a,b){var c=this.m_story_list[this.m_story_index].bonus[a];if("y"!=c.complete_yn){for(var d=0,i=0;i<this.m_story_list[this.m_story_index].mission_list.length;i++)for(var e=this.m_story_list[this.m_story_index].mission_list[i],mdx=0;mdx<e.difficulty_mission.length;mdx++){for(var m=e.difficulty_mission[mdx],complete_task_count=0,tdx=0;tdx<m.task_list.length;tdx++){m.task_list[tdx].is_cleared&&complete_task_count++}3==complete_task_count&&(d+=1)}if(d>=c.main_story_lotus.lotus_count){var f=BattleContext._getInstance();f.setLotusBonusMainSceneID(c.main_story_lotus.main_scene_id),f.setLotusBonusMainStoryID(c.main_story_lotus.main_story_id),f.setLotusBonusDifficultyType(c.main_story_lotus.difficulty_type),f.setLotusBonusLotusCount(c.main_story_lotus.lotus_count),MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_scene_req_lotus_bonus),b.loadTextureNormal(RES_CDN_DEFULT+"menu_quest/img_story_reward_unlock.png"),b.loadTexturePressed(RES_CDN_DEFULT+"menu_quest/img_story_reward_unlock.png")}else this.showLotusBoxModalLayer(c);c=null}else MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_scene_already_lotus_bonus_get)},createLotusBox:function(){this.m_beginner_lotus_info=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_banner_2.png"),this.m_beginner_lotus_info.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_beginner_lotus_info.setPosition(10,130),this.m_ui_layer.addChild(this.m_beginner_lotus_info),this.m_lotus_bonus_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_input_box.png"),this.m_lotus_bonus_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_lotus_bonus_box.setPosition(10,0),this.m_ui_layer.addChild(this.m_lotus_bonus_box),this.m_lotus_total_point=cmLabel.getLabel("0/30",LABEL_FONT_INDEX.FONT_181),this.m_lotus_total_point.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_lotus_total_point.setPosition(164,90),this.m_lotus_bonus_box.addChild(this.m_lotus_total_point);var b="";"y"==(e=this.m_story_list[this.m_story_index].bonus[0]).complete_yn?e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?b=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_unlock.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(b=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_unlock.png"):"y"==e.new_yn?e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?b=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_ready.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(b=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_ready.png"):e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?b=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_lock.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(b=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_lock.png"),cc.Sprite.create(b).setScale(1.1),(box=new ccui.Button).loadTextures(b,b),box.setPressedActionEnabled(!0),box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box.setPosition(26,41),box.addClickEventListener(function(a){this.getLotusBonus(0,a)}.bind(this)),this.m_lotus_bonus_box.addChild(box);var c="";e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?c="#effect_light_3.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(c="#effect_light_2.png"),(f=cc.Sprite.create(c)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),f.setPosition(10,29),f.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR),this.m_lotus_bonus_box.addChild(f),this.m_lotus_box_light.push(f);var d=cc.fadeOut(1),fadein=cc.fadeIn(1),seq=cc.sequence(d,fadein),repeat=cc.repeatForever(seq);f.runAction(repeat),(g=cmLabel.getLabel("10",LABEL_FONT_INDEX.FONT_181)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),g.setPosition(62,22),this.m_lotus_bonus_box.addChild(g),this.m_lotus_box_btns.push(box),this.m_lotus_bonus_labels.push(g),e=null;b="";"y"==(e=this.m_story_list[this.m_story_index].bonus[1]).complete_yn?e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?b=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_unlock.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(b=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_unlock.png"):"y"==e.new_yn?e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?b=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_ready.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(b=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_ready.png"):e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?b=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_lock.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(b=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_lock.png"),(box=new ccui.Button).loadTextures(b,b),box.setPressedActionEnabled(!0),box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box.setPosition(89,41),box.addClickEventListener(function(a){this.getLotusBonus(1,a)}.bind(this)),this.m_lotus_bonus_box.addChild(box);c="";e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?c="#effect_light_3.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(c="#effect_light_2.png"),(f=cc.Sprite.create(c)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),f.setPosition(73,29),f.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR),this.m_lotus_bonus_box.addChild(f),this.m_lotus_box_light.push(f);d=cc.fadeOut(1),fadein=cc.fadeIn(1),seq=cc.sequence(d,fadein),repeat=cc.repeatForever(seq);f.runAction(repeat),(g=cmLabel.getLabel("20",LABEL_FONT_INDEX.FONT_181)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),g.setPosition(124,22),this.m_lotus_bonus_box.addChild(g),this.m_lotus_box_btns.push(box),this.m_lotus_bonus_labels.push(g),c=e=null;var e,box;b="";"y"==(e=this.m_story_list[this.m_story_index].bonus[2]).complete_yn?e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?b=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_unlock.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(b=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_unlock.png"):"y"==e.new_yn?e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?b=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_ready.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(b=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_ready.png"):e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?b=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_lock.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(b=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_lock.png"),(box=new ccui.Button).loadTextures(b,b),box.setPressedActionEnabled(!0),box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box.setPosition(152,41),box.addClickEventListener(function(a){this.getLotusBonus(2,a)}.bind(this)),this.m_lotus_bonus_box.addChild(box);var f;c="";e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?c="#effect_light_3.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(c="#effect_light_2.png"),(f=cc.Sprite.create(c)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),f.setPosition(136,29),f.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR),this.m_lotus_bonus_box.addChild(f),this.m_lotus_box_light.push(f);var g;d=cc.fadeOut(1),fadein=cc.fadeIn(1),seq=cc.sequence(d,fadein),repeat=cc.repeatForever(seq);f.runAction(repeat),(g=cmLabel.getLabel("30",LABEL_FONT_INDEX.FONT_181)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),g.setPosition(187,22),this.m_lotus_bonus_box.addChild(g),this.m_lotus_box_btns.push(box),this.m_lotus_bonus_labels.push(g),c=b=e=null;var h=new ccui.Button;h.loadTextures("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE),h.setAnchorPoint(ANCHOR_TOP_RIGHT()),h.setPosition(ccWidth(this.m_lotus_bonus_box),ccHeight(this.m_lotus_bonus_box)),this.m_lotus_bonus_box.addChild(h),h.addClickEventListener(function(a){MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],StoryEnum.btn_show_help)},this)},createLotusBox_SP:function(){this.m_beginner_lotus_info=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_banner_2.png"),this.m_beginner_lotus_info.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_beginner_lotus_info.setPosition(10,130),this.m_beginner_lotus_info.setScale(2),this.m_ui_layer.addChild(this.m_beginner_lotus_info),this.m_lotus_bonus_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_input_box.png"),this.m_lotus_bonus_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_lotus_bonus_box.setScale(2),this.m_lotus_bonus_box.setPosition(10,0),this.m_ui_layer.addChild(this.m_lotus_bonus_box),this.m_lotus_total_point=cmLabel.getLabel("0/30",LABEL_FONT_INDEX.FONT_181),this.m_lotus_total_point.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_lotus_total_point.setPosition(174,90),this.m_ui_layer.addChild(this.m_lotus_total_point);var b="";"y"==(e=this.m_story_list[this.m_story_index].bonus[0]).complete_yn?e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?b=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_unlock.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(b=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_unlock.png"):"y"==e.new_yn?e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?b=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_ready.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(b=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_ready.png"):e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?b=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_lock.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(b=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_lock.png"),cc.Sprite.create(b).setScale(1.1),(box=new ccui.Button).loadTextures(b,b),box.setPressedActionEnabled(!0),box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box.setPosition(36,41),USE_SP_STORY_SCALE&&box.setScale(2),box.addClickEventListener(function(a){this.getLotusBonus(0,a)}.bind(this)),this.m_ui_layer.addChild(box);var c="";e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?c="#effect_light_3.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(c="#effect_light_2.png"),(f=cc.Sprite.create(c)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),f.setPosition(20,29),f.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR),this.m_ui_layer.addChild(f),this.m_lotus_box_light.push(f);var d=cc.fadeOut(1),fadein=cc.fadeIn(1),seq=cc.sequence(d,fadein),repeat=cc.repeatForever(seq);f.runAction(repeat),(g=cmLabel.getLabel("10",LABEL_FONT_INDEX.FONT_181)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),g.setPosition(72,22),this.m_ui_layer.addChild(g),this.m_lotus_box_btns.push(box),this.m_lotus_bonus_labels.push(g),e=null;b="";"y"==(e=this.m_story_list[this.m_story_index].bonus[1]).complete_yn?e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?b=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_unlock.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(b=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_unlock.png"):"y"==e.new_yn?e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?b=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_ready.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(b=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_ready.png"):e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?b=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_lock.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(b=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_lock.png"),(box=new ccui.Button).loadTextures(b,b),box.setPressedActionEnabled(!0),box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box.setPosition(99,41),USE_SP_STORY_SCALE&&box.setScale(2),box.addClickEventListener(function(a){this.getLotusBonus(1,a)}.bind(this)),this.m_ui_layer.addChild(box);c="";e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?c="#effect_light_3.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(c="#effect_light_2.png"),(f=cc.Sprite.create(c)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),f.setPosition(83,29),f.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR),this.m_ui_layer.addChild(f),this.m_lotus_box_light.push(f);d=cc.fadeOut(1),fadein=cc.fadeIn(1),seq=cc.sequence(d,fadein),repeat=cc.repeatForever(seq);f.runAction(repeat),(g=cmLabel.getLabel("20",LABEL_FONT_INDEX.FONT_181)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),g.setPosition(134,22),this.m_ui_layer.addChild(g),this.m_lotus_box_btns.push(box),this.m_lotus_bonus_labels.push(g),c=e=null;var e,box;b="";"y"==(e=this.m_story_list[this.m_story_index].bonus[2]).complete_yn?e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?b=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_unlock.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(b=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_unlock.png"):"y"==e.new_yn?e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?b=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_ready.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(b=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_ready.png"):e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?b=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_lock.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(b=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_lock.png"),(box=new ccui.Button).loadTextures(b,b),box.setPressedActionEnabled(!0),box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box.setPosition(162,41),USE_SP_STORY_SCALE&&box.setScale(2),box.addClickEventListener(function(a){this.getLotusBonus(2,a)}.bind(this)),this.m_ui_layer.addChild(box);var f;c="";e.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?c="#effect_light_3.png":e.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(c="#effect_light_2.png"),(f=cc.Sprite.create(c)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),f.setPosition(146,29),f.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR),this.m_ui_layer.addChild(f),this.m_lotus_box_light.push(f);var g;d=cc.fadeOut(1),fadein=cc.fadeIn(1),seq=cc.sequence(d,fadein),repeat=cc.repeatForever(seq);f.runAction(repeat),(g=cmLabel.getLabel("30",LABEL_FONT_INDEX.FONT_181)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),g.setPosition(197,22),this.m_ui_layer.addChild(g),this.m_lotus_box_btns.push(box),this.m_lotus_bonus_labels.push(g),c=b=e=null;var h=new ccui.Button;h.loadTextures("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE),h.setAnchorPoint(ANCHOR_TOP_RIGHT()),h.setPosition(2*ccWidth(this.m_lotus_bonus_box)+10,2*ccHeight(this.m_lotus_bonus_box)),this.m_ui_layer.addChild(h),h.addClickEventListener(function(a){MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],StoryEnum.btn_show_help)},this)},updateStoryLayout:function(){var g=$.Deferred(),bg_img=RES_CDN_DEFULT+"menu_quest/bg_story_"+(this.m_story_index+1)+".jpg",frame2_texture=cc.textureCache.addImage(bg_img),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));null!=frame2&&(this.m_bg.setSpriteFrame(frame2),USE_SP_STORY_SCALE&&this.m_bg.setScale(2)),this.m_story_title.removeFromParent(),this.m_story_title=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_stage_text_"+(this.m_story_index+1)+".png"),this.m_story_title.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_story_title.setPosition(.5*winSize.width,544),USE_SP_STORY_SCALE&&this.m_story_title.setScale(2),this.m_ui_layer.addChild(this.m_story_title);for(var h=[],resArraySpine=[],i=0;i<this.m_story_list[this.m_story_index].mission_list.length;i++){var j=$.extend({},this.m_story_list[this.m_story_index].mission_list[i]);if(5==j.num||10==j.num)for(var k=j.difficulty_mission.length,npc_list=j.difficulty_mission[k-1].stage_npc[3],idx=0;idx<npc_list.length;idx++)if(npc_list[idx].is_zoom){var l=MasterManager.getInstance().get_NpcGeneral(npc_list[idx].npc_id);if(!j.is_current)if(USE_SP_SD_STORY_BOSS)h.push(RES_CDN_DEFULT+"menu_boss/"+l.gnrl_id+".png");else if("y"==j.complete_yn)h.push(RES_CDN_DEFULT+"menu_boss/"+l.gnrl_id+".png");else{var m=MasterManager.getInstance().get_General(l.gnrl_id),sd_list=SDGeneralName[m.gnrl_group];for(idx=0;idx<sd_list.length;idx++)resArraySpine.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(m.gnrl_group,3)+"/sd/"+sd_list[idx]+".png");resArraySpine.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(m.gnrl_group,3)+"/sd/"+m.skin_id+".atlas"),resArraySpine.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(m.gnrl_group,3)+"/sd/"+m.skin_id+".json")}break}}var n=[];for(i=0;i<h.length;i++)n.push(h[i]);h=null;for(i=0;i<resArraySpine.length;i++)n.push(resArraySpine[i]);return resArraySpine=null,resourceLoader(n,function(){for(var a=MasterTable.getInstance().get_MainMissionStagePos(this.m_main_scene_id,this.m_story_index+1),is_curent=!1,i=0;i<this.m_story_list[this.m_story_index].mission_list.length;i++){var b=$.extend({},this.m_story_list[this.m_story_index].mission_list[i]);is_curent||"y"==b.complete_yn||("y"==b.new_yn?is_curent=!0:""==b.complete_yn&&""==b.new_yn&&(b.new_yn="y",is_curent=!0));var c=this.m_story_item_list[i];c.setMissionData(b);var d=a[i];c.setPosition(d.x,d.y),b=d=c=null}var e=this.m_story_index+1,bgm_list=[];bgm_list=MasterTable.getInstance().get_Bgm(BGM_TYPE_CHANGE_STORY_STAGE_BGM,bgm_list,e);var f=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm_list[0].sound_file_name;f.m_bgmPath!=path&&f.playBackgroundMusic(path,!0),BattleContext._getInstance().setMissionStage(e),this.updateLotusBox(),this.checkArrow(),a=null,g.resolve(!0)}.bind(this)),g},updateLotusBox:function(){for(var a=0,i=0;i<this.m_story_list[this.m_story_index].mission_list.length;i++){for(var b=this.m_story_list[this.m_story_index].mission_list[i],k=0;k<b.difficulty_mission.length;k++){for(var m=b.difficulty_mission[k],complete_task_count=0,idx=0;idx<m.task_list.length;idx++){m.task_list[idx].is_cleared&&(complete_task_count+=1)}3==complete_task_count&&(a+=1)}b=null}this.m_lotus_total_point.setString(a+"/30");var c="";for(i=0;i<this.m_story_list[this.m_story_index].bonus.length;i++){var d=this.m_story_list[this.m_story_index].bonus[i];"y"==d.complete_yn?d.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?c=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_unlock.png":d.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(c=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_unlock.png"):"y"==d.new_yn?d.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?c=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_ready.png":d.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(c=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_ready.png"):d.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?c=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_lock.png":d.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(c=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_lock.png");var e=c,on=c;this.m_lotus_bonus_labels[i].setString(d.main_story_lotus.lotus_count),a<d.main_story_lotus.lotus_count?this.m_lotus_bonus_labels[i].setColor(cc.color.RED):this.m_lotus_bonus_labels[i].setColor(cc.color.WHITE),this.m_lotus_box_btns[i].loadTextureNormal(e),this.m_lotus_box_btns[i].loadTexturePressed(on),"n"==d.complete_yn&&"y"==d.new_yn?this.m_lotus_box_light[i].setVisible(!0):this.m_lotus_box_light[i].setVisible(!1)}},createCloudScroll:function(){var s,winSize=cc.director.getWinSize();this.m_cloud=new ParallaxNode,this.m_cloud_layer.addChild(this.m_cloud),(s=new ScrollableNode).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),USE_SP_STORY_SCALE?(s.setRatio(cc.p(0,0)),s.setScale(2)):s.setRatio(cc.p(0,0)),s.setPosition(0,0),null!=(a=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/bg_story_1_cloud.png"))&&(a.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),a.getTexture().setAliasTexParameters(),s.addScrollableObject(a)),0<s.getScrollableObjectsLength()&&(this.m_cloud_layer.addChild(s,0),this.m_cloud.addParallaxObject(s)),(s=new ScrollableNode).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),USE_SP_STORY_SCALE?(s.setRatio(cc.p(-10,0)),s.setScale(2)):s.setRatio(cc.p(-20,0)),s.setPosition(0,0);for(var i=1;i<=2;i++){var a=null;null!=(a=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/effect_cloud_2.png"))&&(a.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),a.getTexture().setAliasTexParameters(),s.addScrollableObject(a))}0<s.getScrollableObjectsLength()&&(this.m_cloud_layer.addChild(s,5),this.m_cloud.addParallaxObject(s)),(s=new ScrollableNode).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),USE_SP_STORY_SCALE?(s.setRatio(cc.p(25,0)),s.setScale(2)):s.setRatio(cc.p(25,0)),s.setPosition(0,winSize.height-287);for(i=1;i<=2;i++){a=null;null!=(a=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/effect_cloud_1.png"))&&(a.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),a.getTexture().setAliasTexParameters(),s.addScrollableObject(a))}0<s.getScrollableObjectsLength()&&(this.m_cloud_layer.addChild(s,10),this.m_cloud.addParallaxObject(s)),this.m_cloud.startParallax(1)},getMainStoryListByMissionId:function(a){var b=BattleContext._getInstance(),mission=MasterManager.getInstance().get_MainMission(a);this.m_main_scene_id=mission.main_scene_id,this.m_story_index=Math.max(mission.main_story_id-1,0),this.m_story_list=MissionService.getInstance().getUserMainStory(this.m_main_scene_id),this.m_max_story_index=-1;for(var i=0;i<this.m_story_list.length;i++)if("n"==this.m_story_list[i].complete_yn||""==this.m_story_list[i].complete_yn){this.m_max_story_index=i;break}if(-1==this.m_max_story_index&&(this.m_max_story_index=this.m_story_list.length-1),b.IsNextMissionPopup())for(var c=0;c<this.m_story_list[this.m_story_index].mission_list.length;c++){mission=this.m_story_list[this.m_story_index].mission_list[c];for(var d=0;d<mission.difficulty_mission.length;d++){if(mission.difficulty_mission[d].main_mission_id==a){b.setMainMissionV2(mission);break}}}var e=!1;for(i=0;i<this.m_story_list[this.m_story_index].mission_list.length;i++){mission=this.m_story_list[this.m_story_index].mission_list[i];if(!e&&"y"!=mission.complete_yn){if("y"==mission.new_yn){e=!0;break}if(""==mission.new_yn){this.m_story_list[this.m_story_index].mission_list[i].new_yn="y",e=!0;break}}}},getMainStoryList:function(){this.m_main_scene_id=1,this.m_story_list=MissionService.getInstance().getUserMainStory(this.m_main_scene_id);for(var a=!(this.m_max_story_index=-1),i=0;i<this.m_story_list.length;i++)if("n"==this.m_story_list[i].complete_yn||""==this.m_story_list[i].complete_yn){this.m_story_index=i,this.m_max_story_index=i;for(var k=0;k<this.m_story_list[i].mission_list.length;k++){var b=this.m_story_list[i].mission_list[k];if(!a&&"y"!=b.complete_yn){if("y"==b.new_yn){a=!0;break}if(""==b.new_yn){this.m_story_list[i].mission_list[k].new_yn="y",a=!0;break}}}break}-1==this.m_max_story_index&&(this.m_story_index=this.m_story_list.length-1,this.m_max_story_index=this.m_story_list.length-1)},showLotusBoxModalLayer:function(d){this.m_lotus_box_info_modal_layer._contentNode=function(a,m,b){var c=new LotusBonusBox(d,this.hideLotusBoxModalLayer,this);return this.setContentSize(c.getContentSize()),this.getParent().m_statusLayer.setStatusDisable(!0),c}.bind(this),this.m_lotus_box_info_modal_layer.initLayout()},hideLotusBoxModalLayer:function(){this.m_lotus_box_info_modal_layer.is_show()&&(this.m_lotus_box_info_modal_layer.hide(),this.getParent().m_statusLayer.setStatusDisable(!1))},setLotusBonusResult:function(a){for(var b=0;b<this.m_story_list[this.m_story_index].bonus.length;b++){var c=this.m_story_list[this.m_story_index].bonus[b];if(null==c.main_story_lotus.main_scene_id)break;if(c.main_story_lotus.main_scene_id==a.lotus_bonus_log.main_scene_id&&c.main_story_lotus.main_story_id==a.lotus_bonus_log.main_story_id&&c.main_story_lotus.difficulty_type==a.lotus_bonus_log.difficulty_type&&c.main_story_lotus.lotus_count==a.lotus_bonus_log.lotus_count){c.complete_yn=a.lotus_bonus_log.complete_yn,c.new_yn=a.lotus_bonus_log.new_yn;break}}this.updateLotusBox()},checkLotusBonus:function(){for(var a=[],idx=0;idx<this.m_story_list.length;idx++){for(var b=0,story=this.m_story_list[idx],jdx=0;jdx<story.mission_list.length;jdx++)for(var c=story.mission_list[jdx],kdx=0;kdx<c.difficulty_mission.length;kdx++){for(var m=c.difficulty_mission[kdx],complete_task_count=0,mdx=0;mdx<m.task_list.length;mdx++){m.task_list[mdx].is_cleared&&complete_task_count++}3==complete_task_count&&(b+=1)}for(var d=0;d<story.bonus.length;d++){var f=story.bonus[d];if(("n"==f.complete_yn||""==f.complete_yn)&&b>=f.main_story_lotus.lotus_count){a.push(story.main_story_id);break}}}if(0<a.length){for(var g="",i=0;i<a.length;i++)g+=a[i]+"幕",i<a.length-1&&(g+=", ");var h=SceneManager.getInstance().getRunningScene();if(null!=h)try{h.showToastBox("恋花報酬",g+"にまだ受取待機中の総獲得報酬が残っています。\nマップに移動して受け取ってください",7)}catch(e){}}}}),MissionPreviewBonusItemCell=cc.TableViewCell.extend({m_item_icon:null,m_is_enable_tooltip:!1,tooltip_box:null,tooltip_title:null,tooltip_content:null,tooltip_btn:null,m_is_enable_item_count:!1,m_value_box:null,m_item_count:null,m_callbock:null,m_cancel:null,is_revision_y:!1,ctor:function(a,b){this._super(),this.m_callbock=a,this.m_cancel=b,this.initLayout()},initLayout:function(){this.setAnchorPoint(ANCHOR_BOTTOM_LEFT());var a=cc.size(68,68);this.setContentSize(a);var b=new ccui.Button(RES_CDN_DEFULT+"icon/img_icon_frame.png",RES_CDN_DEFULT+"icon/img_icon_frame.png");b.setAnchorPoint(ANCHOR_MIDDLE()),b.setPosition(ccCenter(this)),this.addChild(b,0),b.setSwallowTouches(!1),b.addTouchEventListener(this.onToolTipTouch,this),this.m_item_icon=cc.Sprite.create("#img_reward_01.png"),this.m_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_icon.setPosition(ccCenter(this)),this.addChild(this.m_item_icon,1)},setGainItem:function(a){switch(this.m_item=a,this.m_item.item_type){case database.BattleGainItemType.General:this.getGeneralCard();break;case database.BattleGainItemType.LoveItem:case database.BattleGainItemType.Hwandan:case database.BattleGainItemType.Jade:case database.BattleGainItemType.Gold:this.getGainItem();break;case database.BattleGainItemType.EventPoint:this.getEventPointItem();break;case database.BattleGainItemType.EvolveStone:case database.BattleGainItemType.EvolveOrb:case database.BattleGainItemType.ForceTypeEvolveMtrl:case database.BattleGainItemType.FormationPropertyPoint:case database.BattleGainItemType.Heart:case database.BattleGainItemType.RandomBox:this.getGainItem();break;case database.BattleGainItemType.SpecialPoint:this.getSpecialPointItem();break;case database.BattleGainItemType.UserExp:case database.BattleGainItemType.LimitOverMtrl:case database.BattleGainItemType.GachaTicket:case database.BattleGainItemType.MagicKeyPiece:case database.BattleGainItemType.CraftMtrl:this.getGainItem();break;case database.BattleGainItemType.Equipment:this.getEquipmentItem();break;case database.BattleGainItemType.KeyRefill:case database.BattleGainItemType.HeroNaming:case database.BattleGainItemType.RebirthMtrl:case database.BattleGainItemType.GreatWallTicket:case database.BattleGainItemType.ETC:case database.BattleGainItemType.JadePiece:case database.BattleGainItemType.SkipTicket:default:this.getGainItem()}this.m_is_enable_item_count&&this.updateItemCount()},updateItemCount:function(){null!=this.m_value_box&&this.m_value_box.setVisible(!1),this.m_is_enable_item_count&&0<this.m_item.item_count&&(this.m_value_box.setVisible(!0),this.m_item_count.setString(Number(this.m_item.item_count).toLocaleString("en")))},getSpecialPointItem:function(){null!=this.m_item_icon&&null!=this.m_item_icon.getParent()&&this.m_item_icon.removeFromParent(),this.m_item_icon=cc.Sprite.create("#img_reward_"+this.m_item.item_level+"_"+leadingZeros(this.m_item.item_id,2)+".png"),this.m_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_icon.setPosition(ccCenter(this)),this.addChild(this.m_item_icon)},getEventPointItem:function(){null!=this.m_item_icon&&null!=this.m_item_icon.getParent()&&this.m_item_icon.removeFromParent(),this.m_item_icon=cc.Sprite.create("#img_reward_"+this.m_item.item_level+"_"+leadingZeros(this.m_item.item_id,2)+".png"),this.m_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_icon.setPosition(ccCenter(this)),this.addChild(this.m_item_icon)},getGainItem:function(){null!=this.m_item_icon&&null!=this.m_item_icon.getParent()&&this.m_item_icon.removeFromParent(),this.m_item_icon=cc.Sprite.create("#img_reward_"+leadingZeros(this.m_item.item_id,2)+".png"),this.m_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_icon.setPosition(ccCenter(this)),this.addChild(this.m_item_icon)},getEquipmentItem:function(){this.m_item_icon&&this.m_item_icon.getParent()&&this.m_item_icon.removeFromParent();var a=MasterTable.getInstance().getMasterTable().get_EquipmentItem(this.m_item.item_id);this.m_item_icon=cc.Sprite.create("#"+a.reward_img+".png"),this.m_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),USE_SP_EQUIPMENT_ICON_SCALE&&this.m_item_icon.setScale(2),this.m_item_icon.setPosition(ccCenter(this)),this.addChild(this.m_item_icon)},getGeneralCard:function(){var a={};a.gnrl_id=this.m_item.item_id,null!=this.m_item_icon&&null!=this.m_item_icon.getParent()&&this.m_item_icon.removeFromParent(),this.m_item_icon=(new Card).createCard(a,CARD_TYPE.type_card_thumb),this.m_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_icon.setPosition(25,25),this.addChild(this.m_item_icon,1)},initTooltipBox:function(a){var b=ccSize(this);null==this.tooltip_box&&(this.tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.tooltip_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.tooltip_box.setPosition(.5*b.width,b.height+5),this.tooltip_box.setVisible(!1),this.addChild(this.tooltip_box),a&&this.tooltip_box.setGlobalZOrder(1e6)),null==this.tooltip_title&&(this.tooltip_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1810),this.tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_box.addChild(this.tooltip_title),a&&this.tooltip_title.setGlobalZOrder(1000001)),null==this.tooltip_content&&(this.tooltip_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.tooltip_content.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_box.addChild(this.tooltip_content),a&&this.tooltip_content.setGlobalZOrder(1000002))},setEnableToolTip:function(a,b){this.m_is_enable_tooltip=a,void 0===b&&(b=!0),this.m_is_enable_tooltip&&this.initTooltipBox(b)},onToolTipTouch:function(a,b){this.m_is_enable_tooltip&&(b==ccui.Widget.TOUCH_BEGAN?this.showTooltip():b==ccui.Widget.TOUCH_MOVED||this.hideTooltip())},showTooltip:function(){if(this.m_is_enable_tooltip){this.tooltip_box.setVisible(!0);var m=MasterTable.getInstance().getMasterTable();if(this.m_item.item_type==database.BattleGainItemType.General){var a=m.get_General(this.m_item.item_id);if((g=MasterTable.getInstance().get_TooltipGeneral(this.m_item.item_id)).content){this.tooltip_title.setString(a.name),this.tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_content.setString(g.content);c=ccSize(this.tooltip_title);var b=ccSize(this.tooltip_content);(i=cc.size(c.width+20,c.height+20)).width=Math.max(c.width+20,b.width+20),i.height=Math.max(64,i.height+b.height+5),this.tooltip_box.setPreferredSize(i),this.tooltip_title.setPosition(10,i.height-10),this.tooltip_content.setPosition(10,i.height-15-c.height)}else{this.tooltip_title.setString(a.name),this.tooltip_title.setAnchorPoint(ANCHOR_MIDDLE()),this.tooltip_content.setString("");var c=ccSize(this.tooltip_title);(i=cc.size(c.width+20,c.height+20)).width=Math.max(64,c.width+20),i.height=Math.max(54,i.height+10),this.tooltip_box.setPreferredSize(i),this.tooltip_title.setPosition(ccCenter(i))}}else if(this.m_item.item_type==database.BattleGainItemType.Equipment){var d=m.get_EquipmentItem(this.m_item.item_id);if((g=MasterTable.getInstance().get_TooltipInfo(4,this.m_item.item_id)).content){this.tooltip_title.setString(d.name),this.tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_content.setString(g.content);c=ccSize(this.tooltip_title),b=ccSize(this.tooltip_content);(i=cc.size(c.width+20,c.height+20)).width=MAX(c.width+20,b.width+20),i.height=MAX(64,i.height+b.height+5),this.tooltip_box.setContentSize(i),this.tooltip_title.setPosition(10,i.height-10),this.tooltip_content.setPosition(10,i.height-15-c.height)}else{this.tooltip_title.setString(d.name),this.tooltip_title.setAnchorPoint(ANCHOR_MIDDLE()),this.tooltip_content.setString("");var c=ccSize(this.tooltip_title);(i=cc.size(c.width+20,c.height+20)).width=MAX(64,c.width+20),i.height=MAX(54,i.height+10),this.tooltip_box.setContentSize(i),this.tooltip_title.setPosition(ccCenter(i))}}else if(this.m_item.item_type==database.BattleGainItemType.EventPoint){var e=EventDungeonService.getInstance(),period=m.get_EventDungeonPeriod(this.m_item.item_level),unit=m.get_EventPointUnitType(period.event_point_unit_type),first_period_idx=e.getEventDungeonFirstHalfPeriodIdx(period.event_dungeon_group_idx),second_period_idx=e.getEventDungeonSecondHalfPeriodIdx(period.event_dungeon_group_idx),middle_period_idx=e.getEventDungeonMiddleHalfPeriodIdx(period.event_dungeon_group_idx);null==period.event_dungeon_group_idx&&(middle_period_idx=second_period_idx=first_period_idx=0);var f=0;this.m_item.item_level==first_period_idx?f=1:this.m_item.item_level==second_period_idx?f=3:this.m_item.item_level==middle_period_idx&&(f=2);var g=MasterTable.getInstance().get_TooltipInfo(1,f);if(null!=unit.name?this.tooltip_title.setString(unit.name):this.tooltip_title.setString(""),g.content){this.tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_content.setString(g.content);c=ccSize(this.tooltip_title),b=ccSize(this.tooltip_content);(i=cc.size(c.width+20,c.height+20)).width=MAX(c.width+20,b.width+20),i.height=MAX(64,i.height+b.height+5),this.tooltip_box.setPreferredSize(i),this.tooltip_title.setPosition(10,i.height-10),this.tooltip_content.setPosition(10,i.height-15-c.height)}else{this.tooltip_title.setAnchorPoint(ANCHOR_MIDDLE()),this.tooltip_content.setString("");c=ccSize(this.tooltip_title);(i=cc.size(c.width+20,c.height+20)).width=MAX(64,c.width+20),i.height=MAX(54,i.height+10),this.tooltip_box.setPreferredSize(i),this.tooltip_title.setPosition(ccCenter(i))}}else{var h=m.get_BonusType(this.m_item.item_id);g=MasterTable.getInstance().get_TooltipItem(this.m_item.item_id);if(this.m_item.item_type==database.BattleGainItemType.HeroNaming&&(g=MasterTable.getInstance().get_TooltipNaming(this.m_item.item_level)),g.content){this.tooltip_title.setString(h.name),this.tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_content.setString(g.content);c=ccSize(this.tooltip_title),b=ccSize(this.tooltip_content);(i=cc.size(c.width+20,c.height+20)).width=Math.max(c.width+20,b.width+20),i.height=Math.max(64,i.height+b.height+5),this.tooltip_box.setPreferredSize(i),this.tooltip_title.setPosition(10,i.height-10),this.tooltip_content.setPosition(10,i.height-15-c.height)}else{this.tooltip_title.setString(h.name),this.tooltip_title.setAnchorPoint(ANCHOR_MIDDLE()),this.tooltip_content.setString("");var i;c=ccSize(this.tooltip_title);(i=cc.size(c.width+20,c.height+20)).width=Math.max(64,c.width+20),i.height=Math.max(54,i.height+10),this.tooltip_box.setPreferredSize(i),this.tooltip_title.setPosition(ccCenter(i))}}if(this.tooltip_box){var j=cc.director.getVisibleSize(),pos=this.tooltip_box.getPosition(),r=this.tooltip_box.getBoundingBox(),w_pos=this.convertToWorldSpace(r);if(w_pos.x<0)return this.tooltip_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),void this.tooltip_box.setPosition(0,pos.y);var o={x:r.x+r.width,y:r.y+r.height};(w_pos=this.convertToWorldSpace(o)).x>j.width&&(this.tooltip_box.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.tooltip_box.setPosition(this.getContentSize().width,pos.y));var k=this.tooltip_box.getParent().getParent().getParent().convertToWorldSpace(this.getPosition()),container_pos=this.tooltip_box.getParent().getParent().getPosition();k.x=k.x+this.tooltip_box.x+container_pos.x,k.y=k.y+this.tooltip_box.y+container_pos.y,null!=this.m_callbock&&this.m_callbock(k,Object.assign({},this.tooltip_box),this.tooltip_title.getString(),this.tooltip_content.getString())}}},hideTooltip:function(){this.m_is_enable_tooltip&&(null!=this.tooltip_box&&this.tooltip_box.setVisible(!1),null!=this.m_cancel&&this.m_cancel())},setEnableItemCount:function(a){this.m_is_enable_item_count=a,this.m_is_enable_item_count?this.createValueBox():null!=this.m_value_box&&this.m_value_box.setVisible(!1)},createValueBox:function(){if(null==this.m_value_box){var a=ccSize(this);this.m_value_box=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_valuebox.png");var b=0;this.is_revision_y&&(b=5),this.m_value_box.setPosition(ccCenter(a).x,b),this.addChild(this.m_value_box,5),this.m_value_box.setVisible(!1),this.m_item_count=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_143),this.m_item_count.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_count.setPosition(ccCenter(this.m_value_box)),this.m_value_box.addChild(this.m_item_count)}},setRevisionY:function(a){this.is_revision_y=a}}),TaskActionType={Mission_Clear_Count:10},MissionPreviewTask=cc.Node.extend({m_main_task:null,ctor:function(a){this._super(),this.m_main_task=a,this.init()},init:function(){this.setContentSize(444,78),this.createMainStoryTask()},createMainStoryTask:function(){var a=ccSize(this),box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",cc.Rect(16,16,16,16));box.setPosition(ZERO()),box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box.setPreferredSize(a),this.addChild(box);var b,task_title=cmLabel.getLabel(this.m_main_task.task.name,LABEL_FONT_INDEX.FONT_2013);if(task_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),task_title.setPosition(58,43),this.addChild(task_title),this.m_main_task.task_type.task_type==TaskActionType.Mission_Clear_Count){var c=this.m_main_task.mission_clear_count;c>this.m_main_task.task.accum_win_count&&(c=this.m_main_task.task.accum_win_count),b=this.m_main_task.task.content+"  ("+c+"/"+this.m_main_task.task.accum_win_count+")"}else b=this.m_main_task.task.content;var d=cmLabel.getLabel(b,LABEL_FONT_INDEX.FONT_161);d.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),d.setPosition(58,16),this.addChild(d);var e=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");e.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),e.setPosition(a.width-4,.5*a.height),this.addChild(e);var f="";if(this.m_main_task.bonus_type==BONUS_TYPE_YUNHEE_FIX||this.m_main_task.bonus_type==BONUS_TYPE_JIN_FIX){var g=MasterManager.getInstance().get_General(this.m_main_task.bonus_value);g.gnrl_type==GENERAL_TYPE_MATERIAL||g.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL?USE_SP_TUMB_SCALE&&(f=this.m_main_task.bonus_type==BONUS_TYPE_YUNHEE_FIX?"#m_"+g.bone_id+".png":"#"+g.bone_id+".png"):USE_SP_TUMB_SCALE&&(f=this.m_main_task.bonus_type==BONUS_TYPE_YUNHEE_FIX?"#m_"+g.gnrl_id+".png":"#"+g.gnrl_id+".png")}else f=this.m_main_task.bonus_type==BONUS_TYPE_LOVE_ITEM?"#img_reward_love_item_"+leadingZeros(this.m_main_task.bonus_value,2)+".png":this.m_main_task.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||this.m_main_task.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT?"#img_reward_yh.png":"#img_reward_"+leadingZeros(this.m_main_task.bonus_type,2)+".png";if(""!=f){var h=cc.Sprite.create(f);h.setAnchorPoint(ANCHOR_MIDDLE()),h.setPosition(ccCenter(e)),this.m_main_task.bonus_type==BONUS_TYPE_YUNHEE_FIX&&h.setScale(DEF_TUMB_SCALE),e.addChild(h),cc.log("ccWidth(reward_icon)"+ccWidth(h));var i=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_valuebox.png");i.setAnchorPoint(ANCHOR_MIDDLE()),i.setPosition(.5*ccWidth(h),2),this.m_main_task.bonus_type==BONUS_TYPE_YUNHEE_FIX&&i.setScale(1.5),h.addChild(i);var j=0;j=this.m_main_task.bonus_type==BONUS_TYPE_LOVE_ITEM?1:this.m_main_task.bonus_type==BONUS_TYPE_YUNHEE_FIX||this.m_main_task.bonus_type==BONUS_TYPE_JIN_FIX?1:this.m_main_task.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||this.m_main_task.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT?1:this.m_main_task.bonus_value;var k=cmLabel.getLabel("x"+Number(j).toLocaleString("en"),LABEL_FONT_INDEX.FONT_143);k.setAnchorPoint(ANCHOR_MIDDLE()),k.setPosition(ccCenter(i)),i.addChild(k)}if(this.m_main_task.is_cleared){var l=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",cc.Rect(1,1,1,1));l.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),l.setPosition(ZERO()),l.setPreferredSize(a),this.addChild(l),(n=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_on.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),n.setPosition(14,39),this.addChild(n);var m=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_complete.png");m.setAnchorPoint(ANCHOR_MIDDLE()),m.setPosition(ccCenter(a)),USE_SP_STORY_SCALE&&m.setScale(2),this.addChild(m)}else{var n;(n=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_off.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),n.setPosition(14,39),this.addChild(n)}}}),MissionPreviewPopup=cc.Layer.extend({m_main_mission:null,m_main_mission_id:0,ctor:function(a){this._super(),this.m_main_mission={main_mission_id:0,stage_count:0,current_stage:1,victory_count:0,complete_yn:"n",new_yn:"y",mission:{},task_list:[],stage_npc:Map,drop_gnrl_list:[]},this.m_main_mission.task_list=[],this.m_main_mission_id=a,this.initLayout()},initLayout:function(){var b=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());b.setPosition(ccCenter(this)),b.setContentSize(ccSize(this)),this.addChild(b);var c=BattleService.getInstance();MasterTable.getInstance();this.m_gain_item_list=[],this.m_gain_item_list=c.getMasterMissionBonusList(this.m_main_mission_id),c.getMainMissionAndNpc(this.m_main_mission_id,this.m_main_mission);for(var d=this.m_main_mission.stage_npc.at(3),idx=0;idx<d.length;idx++)if(d[idx].is_zoom){var e="";e=d[idx].general.gnrl_group<100?RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(d[idx].general.gnrl_group,2)+".png":RES_CDN_DEFULT+"card_war_boss/"+d[idx].general.gnrl_group+".png";var f=cc.Sprite.create(e);f.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),f.setPosition(ccWidth(this)+ccWidth(f),0),f.setScale(2),this.addChild(f);var g=new cc.ScaleTo(.7,2,2.01),scaleTo_2=new cc.ScaleTo(.7,2,1.99),sequence=new cc.Sequence(g,scaleTo_2),repeat=new cc.RepeatForever(sequence);f.runAction(repeat);var h=new cc.MoveTo(.2,cc.p(1136,0));f.runAction(h);break}var i=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal_4.png",RectZero());i.setContentSize(644,640),i.setAnchorPoint(ZERO()),i.setPosition(LP(this,300,0)),this.addChild(i);var j=this.getLeftBoxLayer();j.setPosition(LP(this,1,0)),this.addChild(j);var k=this.getRightBoxLayer();k.setPosition(LP(this,479,0)),this.addChild(k);var l=cc.Sprite.create(RES_CDN_DEFULT+"common/img_state_cloud.png");l.setAnchorPoint(ANCHOR_TOP_RIGHT()),l.setPosition(ccWidth(this),ccHeight(this)),this.addChild(l);var m=new ccui.Button;m.loadTextures("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE),m.setAnchorPoint(ANCHOR_TOP_RIGHT()),m.setPosition(ccWidth(this)-10,ccHeight(this)-10),m.addClickEventListener(function(a){MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_preview_mission_hide)}),this.addChild(m)},getLeftBoxLayer:function(){var a=new cc.Layer,bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));bg_box.setContentSize(478,568),bg_box.setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),a.addChild(bg_box),a.setContentSize(ccSize(bg_box));var b=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");b.setAnchorPoint(ZERO()),b.setPosition(8,509),bg_box.addChild(b);var c=cmLabel.getLabel("挑戦課題",LABEL_FONT_INDEX.FONT_261);c.setPosition(ccCenter(b).x,16),c.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),b.addChild(c);for(var i=0;i<this.m_main_mission.task_list.length;i++){var d=this.m_main_mission.task_list[i];d.mission_clear_count=this.m_main_mission.victory_count;var e=new MissionPreviewTask(d);e.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),e.setPosition(17,418-i*ccHeight(e)),bg_box.addChild(e)}var f=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_text.png");f.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),f.setPosition(22,80),USE_SP_STORY_SCALE&&f.setScale(2),bg_box.addChild(f);var g=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_text_2.png");return g.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),g.setPosition(11,27),USE_SP_STORY_SCALE&&g.setScale(2),bg_box.addChild(g),a},getRightBoxLayer:function(){var c=new cc.Layer;c.setContentSize(481,568);BattleService.getInstance();var m=MasterTable.getInstance().getMasterTable(),story_name=(m.get_MainStory(this.m_main_mission.mission.main_scene_id,this.m_main_mission.mission.main_story_id),cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_stage_text_"+this.m_main_mission.mission.main_story_id+".png"));story_name.setAnchorPoint(ZERO()),USE_SP_STORY_SCALE&&story_name.setScale(2),story_name.setPosition(19,525),c.addChild(story_name),this.scheduleOnce(function(a){var b=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_stage_text_door_"+this.m_main_mission.mission.main_mission_num+".png");b.setAnchorPoint(ZERO()),USE_SP_STORY_SCALE?(b.setPosition(story_name.x+2*ccWidth(story_name),story_name.y),b.setScale(2)):b.setPosition(story_name.x+ccWidth(story_name),story_name.y),c.addChild(b)},.1,"mission_name");var d=482;(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),c.addChild(circle_point),circle_point.setPosition(19,d+8);var e=cmLabel.getLabel("関門",LABEL_FONT_INDEX.FONT_248);e.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),e.setPosition(35,d),c.addChild(e);var f=cmLabel.getLabel("第"+this.m_main_mission.mission.difficulty_type+"関門",LABEL_FONT_INDEX.FONT_241);f.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),f.setPosition(257,d),c.addChild(f),(n=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT),c.addChild(n),n.setPosition(19,d-10),d-=53,(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),c.addChild(circle_point),circle_point.setPosition(19,d+8);var g=cmLabel.getLabel("ご主人様 Exp",LABEL_FONT_INDEX.FONT_248);g.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),g.setPosition(35,d),c.addChild(g);var h=m.get_MainMissionBonus(this.m_main_mission_id),gain_user_exp=0;if(TutorialContextV2.getInstance().IsCompleteAllTutorial()){var i=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),nn=moment(i).valueOf();for(var b in list_Global_Booster_Event_V2){var j,et;j=moment(b.begin_dt),et=moment(b.end_dt);var k=j.valueOf(),ee=et.valueOf();if(k<=nn&&nn<=ee&&b.booster_type==BOOSTER_TYPE_V2_STORY&&b.variation_type==BOOSTER_VARIATION_TYPE_V2_GAIN_INC&&(b.item_type==BOOSTER_ITEM_TYPE_V2_USER_EXP||b.item_type==BOOSTER_ITEM_TYPE_V2_REWARD_BONUS_ITEM))if(0==b.value_1){if(0==b.value_2||b.value_2==this.m_main_mission.mission.main_mission_num){gain_user_exp+=h.gain_user_exp*b.variation_value/100;break}}else if(0==b.value_2){if(b.value_1==this.m_main_mission.mission.main_story_id){gain_user_exp+=h.gain_user_exp*b.variation_value/100;break}}else if(b.value_1==this.m_main_mission.mission.main_story_id&&b.value_2==this.m_main_mission.mission.main_mission_num){gain_user_exp+=h.gain_user_exp*b.variation_value/100;break}}}0==gain_user_exp&&(gain_user_exp=h.gain_user_exp);var l=""+Number(gain_user_exp).toLocaleString("en"),gain_exp=cmLabel.getLabel(l,LABEL_FONT_INDEX.FONT_2423);gain_exp.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),gain_exp.setPosition(257,d),c.addChild(gain_exp),(n=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),c.addChild(n),n.setPosition(19,d-10),d-=53,(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),c.addChild(circle_point),circle_point.setPosition(19,d+8);var n,circle_point,appear_gnrl_title=cmLabel.getLabel("ボスバトル敵情報",LABEL_FONT_INDEX.FONT_248);appear_gnrl_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),appear_gnrl_title.setPosition(35,d),c.addChild(appear_gnrl_title),(n=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),c.addChild(n),n.setPosition(19,197),d=162,(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),c.addChild(circle_point),circle_point.setPosition(19,d+8);var o=cmLabel.getLabel("獲得報酬",LABEL_FONT_INDEX.FONT_248);o.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),o.setPosition(35,d),c.addChild(o);var p=new LabelButton("btn_03_off.png","btn_03_on.png","",ccui.Widget.PLIST_TEXTURE);p.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),p.setFont(LABEL_FONT_INDEX.FONT_241),p.setString("戦闘準備"),p.setPosition(19,16),c.addChild(p),p.addClickEventListener(function(a){BattleContext._getInstance().setMissionID(this.m_main_mission.mission.main_mission_id),MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_friend_select)}.bind(this)),1011==this.m_main_mission.main_mission_id&&p.setTutorialTag(TUTORIAL_TAG_PAGE_1_BATTLE_READY);var q=this.getAppearGeneralLayer();q.setPosition(19,212),c.addChild(q);var r=this.getRewardBonusLayer();r.setPosition(19,86),c.addChild(r);var s=MasterTable.getInstance().get_RewardCampaignUi(CAMPAIGN_DUNGEON_TYPE_STORY,CAMPAIGN_POSITION_TYPE_ENTERANCE_TOP_TEXT);if(null!=s.dugeon_type&&0!=s.dugeon_type&&(s.value>=this.m_main_mission.mission.main_story_id||0==s.value)){var t=cc.Sprite.create(RES_CDN_DEFULT+cmString("common/%s",s.image_name));t.setAnchorPoint(ZERO()),t.setPosition(27,451),c.addChild(t)}return c},getAppearGeneralLayer:function(){var a=new cc.Layer,list=this.m_main_mission.stage_npc.at(3),pos=[];pos.push(cc.p(0,41)),pos.push(cc.p(72,77)),pos.push(cc.p(72,5)),pos.push(cc.p(144,77)),pos.push(cc.p(144,5));for(var b=0;b<list.length;b++){var c=new NpcInfoItemNode(CARD_TYPE.type_card_thumb);c.setGeneralData(list[b].general,list[b].is_zoom);var p=list[b].position-1;c.setPosition(pos[p]),c.setGlobalZOrderTooltip(!0),a.addChild(c)}return a},getRewardBonusLayer:function(){for(var a=new cc.Layer,index=0,width=0,idx=0;idx<this.m_gain_item_list.length;idx++){var b=new MissionPreviewBonusItemCell;b.setGainItem(this.m_gain_item_list[idx]),b.setEnableToolTip(!0),a.addChild(b),cc.log(ccWidth(b)),b.setAnchorPoint(ZERO()),b.setPosition(index*(ccWidth(b)+4),0),index++,width+=ccWidth(b)}return a.setContentSize(width,68),a}}),StorySelectionItemNode=cc.Layer.extend({m_lotus_imgs:null,m_gain_item_list:null,_callback:null,m_mission:null,m_gnrl_body:null,m_title_img:null,m_bottom_img:null,m_focus_skeleteon:null,m_bonus_box_layer:null,m_btn_entrance:null,ctor:function(a,b){this._super(a),this.m_mission=$.extend({},a),this._callback=b,this.init()},init:function(){this.setContentSize(320,585),this.m_gain_item_list=BattleService.getInstance().getMasterMissionBonusList(this.m_mission.mission.main_mission_id),this.m_bottom_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_normal_large_off.png"),this.m_bottom_img.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bottom_img.setPosition(ccCenter(this).x,193),USE_SP_STORY_SCALE&&this.m_bottom_img.setScale(2),this.addChild(this.m_bottom_img),this.m_focus_skeleteon=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Story.json",RES_CDN_DEFULT+"effect/Story.atlas",1.9),this.m_focus_skeleteon.setPosition(161,237),this.addChild(this.m_focus_skeleteon),this.m_focus_skeleteon.setAnimation(0,"fx_1",!0),this.m_focus_skeleteon.setVisible(!1),this.m_gnrl_body=this.getGeneralBody(),this.m_gnrl_body.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_gnrl_body.setPosition(ccCenter(this).x,229),this.addChild(this.m_gnrl_body);var b=new cc.ScaleTo(.7,1,1.01),scaleTo_2=new cc.ScaleTo(.7,1,.99),sequence=new cc.Sequence(b,scaleTo_2),repeat=new cc.RepeatForever(sequence);this.m_gnrl_body.runAction(repeat),this.m_title_img=cc.Sprite.create(),this.m_title_img.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_title_img.setPosition(ccCenter(this).x,495),USE_SP_STORY_SCALE&&this.m_title_img.setScale(2),this.addChild(this.m_title_img),1==this.m_mission.mission.difficulty_type&&this.m_title_img.setTexture(RES_CDN_DEFULT+"menu_quest/img_story_door_1.png"),2==this.m_mission.mission.difficulty_type&&this.m_title_img.setTexture(RES_CDN_DEFULT+"menu_quest/img_story_door_2.png"),3==this.m_mission.mission.difficulty_type&&this.m_title_img.setTexture(RES_CDN_DEFULT+"menu_quest/img_story_door_3.png"),this.m_lotus_imgs=[];for(var i=0;i<3;++i){var c=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_2_off.png");c.setAnchorPoint(ZERO()),USE_SP_STORY_SCALE&&c.setScale(2),this.addChild(c),this.m_lotus_imgs[i]=c,0==i&&c.setPosition(79,189),1==i&&c.setPosition(133,179),2==i&&c.setPosition(187,189)}var d=0;for(i=0;i<this.m_mission.task_list.length;i++){this.m_mission.task_list[i].is_cleared&&(this.m_lotus_imgs[d].setTexture(RES_CDN_DEFULT+"menu_quest/img_story_sakura_2_on.png"),d++)}this.m_bonus_box_layer=this.getBonusBoxLayer(),this.m_bonus_box_layer.ignoreAnchorPointForPosition(!1),this.m_bonus_box_layer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),USE_SP_STORY_SCALE?this.m_bonus_box_layer.setPosition(ccCenter(this).x-80,55):this.m_bonus_box_layer.setPosition(ccCenter(this).x,55),this.addChild(this.m_bonus_box_layer),this.m_btn_entrance=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_btn_entrance.setFont(LABEL_FONT_INDEX.FONT_241),this.m_btn_entrance.setString("入場"),this.m_btn_entrance.setOffsetX(-50),this.m_btn_entrance.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_btn_entrance.setPosition(ccCenter(this).x,0),this.addChild(this.m_btn_entrance),this.m_btn_entrance.addClickEventListener(function(a){null!=this._callback&&this._callback(this.m_mission)}.bind(this));var e=MasterTable.getInstance().get_RewardCampaignUi(CAMPAIGN_DUNGEON_TYPE_STORY,CAMPAIGN_POSITION_TYPE_STORY_MISSION_PREVIEW);if(null!=e.dugeon_type&&0!=e.dugeon_type&&(e.value>=this.m_mission.mission.main_story_id||0==e.value)){var f=cc.Sprite.create(RES_CDN_DEFULT+cmString("common/%s",e.image_name));f.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),f.setPosition(ccCenter(this.m_btn_entrance).x,43),this.m_btn_entrance.addChild(f,1)}1011==this.m_mission.main_mission_id&&this.m_btn_entrance.setTutorialTag(TUTORIAL_TAG_PAGE_1_CHOIDE_DIFFICULTY_TYPE);var g=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero());g.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),g.setContentSize(66,38),g.setPosition(119,ccCenter(this.m_btn_entrance).y),this.m_btn_entrance.addChild(g);var h=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_ic_key.png");h.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),h.setPosition(104,ccCenter(this.m_btn_entrance).y),this.m_btn_entrance.addChild(h);var j=this.checkNeedKeyMission(0),need_key_label=cmLabel.getLabel(j,LABEL_FONT_INDEX.FONT_2011);return need_key_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),need_key_label.setPosition(ccWidth(g)-10,ccCenter(g).y),g.addChild(need_key_label),!0},setDifficultyEnable:function(a){if(!a){this.m_gnrl_body.setColor(cc.color(50,50,50));var b=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());b.setContentSize(ccSize(this.m_btn_entrance)),b.setAnchorPoint(ZERO()),b.setPosition(ZERO()),this.m_btn_entrance.addChild(b),this.m_btn_entrance.setEnabled(!1);for(var c=0;c<this.m_lotus_imgs.length;c++);1==this.m_mission.mission.difficulty_type&&this.m_title_img.setTexture(RES_CDN_DEFULT+"menu_quest/img_story_door_1_black.png"),2==this.m_mission.mission.difficulty_type&&this.m_title_img.setTexture(RES_CDN_DEFULT+"menu_quest/img_story_door_2_black.png"),3==this.m_mission.mission.difficulty_type&&this.m_title_img.setTexture(RES_CDN_DEFULT+"menu_quest/img_story_door_3_black.png"),this.m_bottom_img.setTexture(RES_CDN_DEFULT+"menu_quest/img_story_normal_large_black.png");var d=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_reward_box_black.png");d.setAnchorPoint(ZERO()),d.setPosition(ZERO()),USE_SP_STORY_SCALE&&d.setScale(2),this.m_bonus_box_layer.addChild(d);var e=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_lock.png");e.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),e.setPosition(ccCenter(this).x,250),USE_SP_STORY_SCALE&&e.setScale(2),this.addChild(e)}},setIsClear:function(){},setIsNew:function(){var a=cc.Sprite.create();if(a.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),a.setPosition(ccCenter(this).x,460),this.addChild(a),NOT_USE_SP_MAIN_ANIMATION){a.setScale(2),a.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_new_01.png");var b=new cc.ScaleTo(.3,2,2.03),scaleTo_2=new cc.ScaleTo(.3,2,1.97),sequence=new cc.Sequence(b,scaleTo_2);repeat=new cc.RepeatForever(sequence);a.runAction(repeat),repeat=sequence=scaleTo_2=b=null}else{var c=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.StoryNewIcon),repeat=new cc.RepeatForever(c);a.runAction(repeat)}this.m_focus_skeleteon.setVisible(!0)},checkNeedKeyMission:function(a){a=0;var c=!1;if(TutorialContextV2.getInstance().IsCompleteAllTutorial()){var d=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf();for(var b in NetService().list_Global_Booster_Event_V2){var e=moment(b.begin_dt),et=moment(b.end_dt),bb=e.valueOf(),ee=et.valueOf();if(bb<=d&&d<=ee&&b.booster_type==BOOSTER_TYPE_V2_STORY&&b.variation_type==BOOSTER_VARIATION_TYPE_V2_EXPENSE_DEC&&b.item_type==BOOSTER_ITEM_TYPE_V2_ENTRANCE_TICKET){if(0==b.value_1){a=this.m_mission.mission.need_key-this.m_mission.mission.need_key*b.variation_value/100,c=!0;break}if(0==b.value_2){if(b.value_1==this.m_mission.mission.main_story_id){a=this.m_mission.mission.need_key-this.m_mission.mission.need_key*b.variation_value/100,c=!0;break}}else if(b.value_1==this.m_mission.mission.main_story_id&&b.value_2==this.m_mission.mission.main_mission_num){a=this.m_mission.mission.need_key-this.m_mission.mission.need_key*b.variation_value/100,c=!0;break}}}c&&(a=Math.max(a,1))}if(0==MasterManager.getInstance().get_TimeFunction(9).value){var f=UserService.getInstance();if(f.isBeginnerBooster()){var g=[];0<(g=f.getMtBeginnerBooster(BEGINNER_BOOSTER_TYPE_CONSUME_DECREASE,0,CONSUME_DECREASE_KEY,g)).value&&(g.battle_type==BATTLE_DUNGEON_TYPE_STORY||g.battle_type==BATTLE_DUNGEON_TYPE_ALL)&&(a=Math.floor(this.m_mission.mission.need_key-this.m_mission.mission.need_key*g.value/1e4),a=Math.max(a,1))}}return 0==a&&(a=this.m_mission.mission.need_key),a},getBonusBoxLayer:function(){var a=new cc.Layer,bg_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_reward_box.png");bg_box.setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),USE_SP_STORY_SCALE&&bg_box.setScale(2),a.addChild(bg_box),a.setContentSize(ccSize(bg_box));for(var b=0,idx=0;idx<this.m_gain_item_list.length;idx++){var c=new MissionPreviewBonusItemCell;c.setGainItem(this.m_gain_item_list[idx]),c.setEnableToolTip(!0,!0),a.addChild(c),c.setAnchorPoint(ZERO()),c.setPosition(24+b*ccWidth(c),18),b++}return a},getGeneralBody:function(){var a=MasterManager.getInstance();for(var b in this.m_mission.stage_npc)if(3==b){var c=this.m_mission.stage_npc[b];for(var g in c)if(c[g].is_zoom){b=a.get_NpcGeneral(c[g].npc_id);var d=a.get_General(b.gnrl_id);return cc.Sprite.create(RES_CDN_DEFULT+"card_story_boss/"+leadingZeros(d.gnrl_group,2)+".png")}}return null}}),StorySelectionPopup=cc.Layer.extend({m_gameObserver:null,ctor:function(a){this._super(),this.init(a)},init:function(b){this.m_gameObserver=MainObserver.getInstance(),this.m_mission=b;var c=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());c.setAnchorPoint(ZERO()),c.setPosition(ZERO()),c.setContentSize(ccSize(this)),this.addChild(c),this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var d=cc.Sprite.create(RES_CDN_DEFULT+"common/img_cloud_top.png");d.setAnchorPoint(ANCHOR_TOP_LEFT()),d.setPosition(0,ccHeight(this)),this.addChild(d);var e=cc.Sprite.create(RES_CDN_DEFULT+"common/img_cloud_bottom.png");e.setAnchorPoint(ZERO()),e.setPosition(ZERO()),this.addChild(e);var f=cc.Sprite.create(RES_CDN_DEFULT+"common/img_cloud_top.png");f.setAnchorPoint(ANCHOR_TOP_RIGHT()),f.setPosition(ccWidth(this),ccHeight(this)),this.addChild(f),f.setFlippedX(!0);var g=cc.Sprite.create(RES_CDN_DEFULT+"common/img_cloud_bottom.png");g.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),g.setPosition(ccWidth(this),0),this.addChild(g),g.setFlippedX(!0),USE_SP_STORY_SCALE&&(d.setScale(2),e.setScale(2),f.setScale(2),g.setScale(2));var h=cc.Sprite.create(RES_CDN_DEFULT+"common/img_state_cloud.png");h.setAnchorPoint(ANCHOR_TOP_RIGHT()),h.setPosition(ccWidth(this),ccHeight(this)),this.addChild(h);var j=new ccui.Button;j.loadTextures("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE),j.setAnchorPoint(ANCHOR_TOP_RIGHT()),j.setPosition(ccWidth(this)-10,ccHeight(this)-10),j.addClickEventListener(function(a){this.m_gameObserver.postNotification(sceneStr[scene_StorySceneV2],story_choice_difficulty_type_hide)}.bind(this)),this.addChild(j);for(var i=0;i<this.m_mission.difficulty_mission.length;i++){var m=this.m_mission.difficulty_mission[i],item=new StorySelectionItemNode(m,this.choiceMissionStage);if(item.setPosition(LP(this,i*ccWidth(item),27.5)),this.addChild(item),0<i)"y"==this.m_mission.difficulty_mission[i-1].complete_yn?(item.setDifficultyEnable(!0),"y"!=m.complete_yn&&item.setIsNew()):item.setDifficultyEnable(!1);else 0==i&&(item.setDifficultyEnable(!0),"y"!=m.complete_yn&&item.setIsNew());item=null}return!0},onEnter:function(){this._super();var a=BattleContext._getInstance();a.IsNextMissionPopup()&&(a.showNextMissionPopup(!1),MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_preview_mission_show))},onExit:function(){this.m_mission=null},choiceMissionStage:function(a){var b=BattleContext._getInstance();b.setGameType(db.BattleGameType.Mission),b.setMissionID(a.main_mission_id),MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_preview_mission_show)}}),LotusBonusBox=cc.Layer.extend({m_bonus:null,_close_callback:null,ctor:function(a,b,c){this._super(),this.m_bonus=a,this._close_callback=b.bind(c),this.initLayout(a,b)},initLayout:function(){var b=cc.director.getWinSize(),boxSize=cc.size(630,370),box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",RectZero());box.setAnchorPoint(ANCHOR_MIDDLE()),box.setPreferredSize(boxSize),box.setPosition(ccCenter(b)),this.addChild(box);var c=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_3.png");c.setAnchorPoint(ANCHOR_MIDDLE_TOP()),c.setPosition(.5*boxSize.width,boxSize.height-11),box.addChild(c);var d=ccSize(c),title=cmLabel.getLabel("恋花報酬",LABEL_FONT_INDEX.FONT_301);title.setAnchorPoint(ANCHOR_MIDDLE()),title.setPosition(.5*d.width,.5*d.height+2),c.addChild(title);var e,icon_box=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");switch(icon_box.setAnchorPoint(ANCHOR_MIDDLE()),icon_box.setPosition(.5*boxSize.width,250),box.addChild(icon_box),this.m_bonus.main_story_lotus.bonus_type){case BONUS_TYPE_GOLD:case BONUS_TYPE_KEY:case BONUS_TYPE_HEART:case BONUS_TYPE_JADE:e="#img_reward_"+leadingZeros(this.m_bonus.main_story_lotus.bonus_type,2)+".png";break;case BONUS_TYPE_HN_RARE_TYPE_ENGAGE:e="#img_reward_yh.png";break;case BONUS_TYPE_YUNHEE_FIX:case BONUS_TYPE_JIN_FIX:case BONUS_TYPE_WIE_CHOCK_OH_SELECT:e="#img_reward_yh.png";break;case BONUS_TYPE_HWANDAN_1:case BONUS_TYPE_HWANDAN_2:case BONUS_TYPE_HWANDAN_3:case BONUS_TYPE_HWANDAN_4:case BONUS_TYPE_HWANDAN_5:e="#img_reward_"+leadingZeros(this.m_bonus.main_story_lotus.bonus_type,2)+".png";break;case BONUS_TYPE_LOVE_ITEM:e="#img_reward_love_item_"+leadingZeros(this.m_bonus.main_story_lotus.bonus_type,2)+".png"}var f=cc.Sprite.create(e);f.setAnchorPoint(ANCHOR_MIDDLE()),f.setPosition(ccCenter(icon_box)),icon_box.addChild(f);var t=MasterManager.getInstance().get_BonusType(this.m_bonus.main_story_lotus.bonus_type),bonus_str="";if(t.bonus_type==BONUS_TYPE_LOVE_ITEM||t.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||t.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT)bonus_str=t.name+" x1";else if(t.bonus_type==BONUS_TYPE_JIN_FIX||t.bonus_type==BONUS_TYPE_YUNHEE_FIX){bonus_str=MasterManager.getInstance().get_General(this.m_bonus.main_story_lotus.bonus_count).name+" x1"}else bonus_str=t.name+" x"+this.m_bonus.main_story_lotus.bonus_count;var g=cmLabel.getLabel(bonus_str,LABEL_FONT_INDEX.FONT_262);g.setAnchorPoint(ANCHOR_MIDDLE()),g.setPosition(.5*boxSize.width,190),box.addChild(g);var h=cmLabel.getLabel("挑戦課題をクリアして恋花が "+this.m_bonus.main_story_lotus.lotus_count+"になったら\n報酬を獲得できます。",LABEL_FONT_INDEX.FONT_241);h.setAnchorPoint(ANCHOR_MIDDLE()),h.setPosition(.5*boxSize.width,135),box.addChild(h);var i=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);i.setFont(LABEL_FONT_INDEX.FONT_241),i.setString("確認"),i.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),i.setPosition(.5*boxSize.width,16),box.addChild(i),i.addClickEventListener(function(a){null!=this._close_callback&&this._close_callback()}.bind(this))}}),eDungeonTaskType={none:0,weekly_dungeon:1,event_dungeon:2},MissionTaskPopup=cc.Layer.extend({m_mission_id:0,_callback_close_popup:null,m_task_type:eDungeonTaskType.none,m_gain_item_list:[],m_weekly_dungeon_task_list:[],m_event_dungeon_task_list:[],ctor:function(a,b){this._super(),b==eDungeonTaskType.weekly_dungeon?this.init_WeeklyDungeonTask(a,b):b==eDungeonTaskType.event_dungeon&&this.init_EventDungeonTask(a,b)},init_WeeklyDungeonTask:function(a,b){return this.m_weekly_dungeon_task_list.clear(),this.m_weekly_dungeon_task_list=a,this.m_task_type=b,this.initLayout(),!0},init_EventDungeonTask:function(a,b){return this.m_event_dungeon_task_list.clear(),this.m_event_dungeon_task_list=a,this.m_task_type=b,this.initLayout(),!0},initLayout:function(){var a=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());a.setPosition(ccCenter(this)),a.setContentSize(ccSize(this)),this.addChild(a),this.m_gain_item_list.clear();var b=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal_4.png",RectZero());b.setContentSize(644,640),b.setAnchorPoint(ZERO()),b.setPosition(LP(this,300,0)),this.addChild(b);var c=this.getLeftBoxLayer();c.ignoreAnchorPointForPosition(!1),c.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),c.setPosition(ccCenter(this).x,0),this.addChild(c)},getLeftBoxLayer:function(){var b=new cc.Layer,bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));bg_box.setContentSize(478,568),bg_box.setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),b.addChild(bg_box),b.setContentSize(ccSize(bg_box));var c=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");c.setAnchorPoint(ZERO()),c.setPosition(8,509),bg_box.addChild(c);var d=cmLabel.getLabel(res_str("label_task_title"),LABEL_FONT_INDEX.FONT_261);if(d.setPosition(ccCenter(c).x,16),d.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),c.addChild(d),this.m_task_type==eDungeonTaskType.weekly_dungeon)for(var i=0;i<this.m_weekly_dungeon_task_list.length;i++){var e=this.m_weekly_dungeon_task_list[i];(f=new WeeklyTaskNode(e)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),f.setPosition(17,418-i*ccHeight(f)),bg_box.addChild(f)}else if(this.m_task_type==eDungeonTaskType.event_dungeon)for(i=0;i<this.m_event_dungeon_task_list.size();i++){var f;e=this.m_event_dungeon_task_list[i];(f=new EventDungeonTaskNode(e)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),f.setPosition(17,418-i*ccHeight(f)),bg_box.addChild(f)}var g=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_text_2.png");g.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),g.setPosition(ccCenter(bg_box).x,20),USE_SP_STORY_SCALE&&g.setScale(2),bg_box.addChild(g);var h=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);return h.setAnchorPoint(ZERO()),h.setPosition(ccWidth(c)-ccWidth(h)-11,7),h.addClickEventListener(function(a){null!=this._callback_close_popup&&this._callback_close_popup()}.bind(this)),c.addChild(h),b},onEnter:function(){this._super()},onExit:function(){this._super()}}),DailyDungeonListCell=cc.TableViewCell.extend({m_select_box:null,m_highlight:null,m_disable_cover:null,m_dungeon_name:null,m_cell_bg:null,ctor:function(){this._super(),this.init()},init:function(){var a=cc.size(444,140);this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(a),USE_SP_DAILY_SCALE?(this.m_cell_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_01.png"),this.m_cell_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_cell_bg.setPosition(ccCenter(a)),this.m_cell_bg.setScale(2),this.addChild(this.m_cell_bg),this.m_dungeon_name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2615),this.m_dungeon_name.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_dungeon_name.setPosition(a.width-10,20),this.addChild(this.m_dungeon_name)):(this.m_cell_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_01.png"),this.m_cell_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_cell_bg.setPosition(ccCenter(a)),this.addChild(this.m_cell_bg),this.m_dungeon_name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2615),this.m_dungeon_name.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_dungeon_name.setPosition(a.width-10,20),this.m_cell_bg.addChild(this.m_dungeon_name)),this.m_disable_cover=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero()),this.m_disable_cover.setAnchorPoint(ANCHOR_MIDDLE()),this.m_disable_cover.setPosition(ccCenter(a)),this.m_disable_cover.setPreferredSize(a),this.addChild(this.m_disable_cover),this.m_disable_cover.setVisible(!1);var b=cc.Sprite.create(RES_CDN_DEFULT+"common/img_list_lock.png");return b.setAnchorPoint(ANCHOR_MIDDLE()),b.setPosition(ccCenter(this.m_disable_cover)),this.m_disable_cover.addChild(b),this.m_highlight=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_1.png",cc.Rect(20,20,20,20)),this.m_highlight.setAnchorPoint(ANCHOR_MIDDLE()),this.m_highlight.setPosition(ccCenter(a)),this.m_highlight.setPreferredSize(ccSize(this.m_cell_bg)),this.m_highlight.setVisible(!1),this.addChild(this.m_highlight),this.m_select_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_2.png",cc.rect(20,20,20,20)),this.m_select_box.setAnchorPoint(ANCHOR_MIDDLE()),this.m_select_box.setPosition(ccCenter(a)),this.m_select_box.setPreferredSize(ccSize(this.m_cell_bg)),this.m_select_box.setVisible(!1),this.addChild(this.m_select_box),!0},setData:function(a){this.m_data=a,this.updateCell()},updateCell:function(){ccSize(this);var a=RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_"+leadingZeros(this.m_data.daily_dungeon.bg_type,2)+".png",frame3_texture=cc.textureCache.addImage(a),frame3=new cc.SpriteFrame(frame3_texture,cc.rect(0,0,frame3_texture.getContentSize().width,frame3_texture.getContentSize().height));if(this.m_cell_bg.setSpriteFrame(frame3),this.m_dungeon_name.setString(this.m_data.daily_dungeon.name),this.m_select_box.setVisible(this.m_data.is_selected),this.m_highlight.setVisible(this.m_data.is_selected),this.m_data.is_selected&&this.selectedAnimation(),this.m_data.is_open_pre_daily_dungeon){var n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),b=moment(this.m_data.daily_dungeon_period.begin_date).valueOf(),e=moment(this.m_data.daily_dungeon_period.end_date).valueOf();b<=n?n<=e&&(this.m_data.is_enable=!0):this.m_data.is_enable=!1,this.m_disable_cover.setVisible(!this.m_data.is_enable)}else this.m_disable_cover.setVisible(!0)},selectedAnimation:function(){this.m_select_box.isRunning()&&this.m_select_box.stopAllActions();var a=new cc.FadeOut(1),fadein=new cc.FadeIn(1),seq=new cc.Sequence(a,fadein),repeat=new cc.RepeatForever(seq);this.m_select_box.runAction(repeat)},unSelected:function(){this.m_select_box.setVisible(!1),this.m_highlight.setVisible(!1)}}),daily_dungeon_battle_ready=8e4,daily_dungeon_invalid_entrance_time=80001,daily_dungeon_disable_pre_open_dungeon=80002,daily_dungeon_entrance_limit_over=80003,DailyDungeonListLayer=cc.Layer.extend({m_table_view:null,m_gnrl_body:null,m_content_label:null,m_boss_container:null,m_left_layer:null,m_right_layer:null,m_difficulty_name:null,m_spend_label:null,m_reward_item:null,m_daily_dungeon_list:[],m_gnrl_img:null,m_boyd_img_num:42,m_deferred:null,m_multiple_icon:null,ctor:function(a){this._super(),this.m_deferred=a,this.m_daily_dungeon_list=[],this.init()},onExit:function(){if(this._super(),null!=this.m_gnrl_img){for(var a=0;a<this.m_gnrl_img.length;a++)cc.loader.release(this.m_gnrl_img[a]);this.m_gnrl_img=null}},init:function(){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var c=ccSize(this);this.m_boss_container=new cc.Node,this.m_boss_container.setPosition(c.width,0),this.addChild(this.m_boss_container);var m=MasterTable.getInstance().getMasterTable(),context=BattleContext._getInstance();DailyDungeonTable.getInstance().load_user_daily_dungeon();var d=context.getDailyDungeonPeriodIdx();this.m_period=m.get_DailyDungeonPeriod(d);var e=DailyDungeonService.getInstance();this.m_daily_dungeon_list=e.getUserDailyDungeonList(d);var f=context.getLastDailyDungeonId(),last_open_dungeon_idx=0;if(0==f){if(0<this.m_daily_dungeon_list.length){for(var i=0;i<this.m_daily_dungeon_list.length;i++){this.m_daily_dungeon_list[i].is_open_pre_daily_dungeon&&(last_open_dungeon_idx=Math.max(i,0))}this.m_daily_dungeon_list[last_open_dungeon_idx].is_selected=!0}}else if(0<this.m_daily_dungeon_list.length){for(i=0;i<this.m_daily_dungeon_list.length;i++){this.m_daily_dungeon_list[i].daily_dungeon.daily_dungeon_idx==f&&(last_open_dungeon_idx=Math.max(i,0))}this.m_daily_dungeon_list[last_open_dungeon_idx].is_selected=!0}this.m_gnrl_img=[],this.m_gnrl_img.push(RES_CDN_DEFULT+"card_war_boss/42.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_text_title_01.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"common/img_circle.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"common/img_line.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_text_sub.png");for(var g=1;g<6;g++)this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_text_title_0"+g+".png");var h=this.getSelectedDungeon();if(0!=h.stage_npc.size())for(g=0;g<h.stage_npc.at(1).length;g++){var j=h.stage_npc.at(1);j[g].is_zoom&&(j[g].general.gnrl_group<100?this.m_gnrl_img.push(RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(j[g].general.gnrl_group,2)+".png"):this.m_gnrl_img.push(RES_CDN_DEFULT+"card_war_boss/"+j[g].general.gnrl_group+".png"),this.m_boyd_img_num=j[g].general.gnrl_group)}return this.m_gnrl_img.push(RES_CDN_DEFULT+"common/img_list_lock.png"),cc.loader.load(this.m_gnrl_img,function(a,b){a||this.start_init()}.bind(this)),!0},start_init:function(){this.m_boyd_img_num<100?this.m_gnrl_body=cc.Sprite.create(RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(this.m_boyd_img_num,2)+".png"):this.m_gnrl_body=cc.Sprite.create(RES_CDN_DEFULT+"card_war_boss/"+this.m_boyd_img_num+".png"),this.m_gnrl_body.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_gnrl_body.setPosition(ZERO()),this.m_gnrl_body.setVisible(!0),this.m_gnrl_body.setScale(2),this.m_boss_container.addChild(this.m_gnrl_body);var a=new cc.ScaleTo(.7,2,2.01),scaleTo_2=new cc.ScaleTo(.7,2,1.99),sequence=new cc.Sequence(a,scaleTo_2),repeat=new cc.RepeatForever(sequence);this.m_gnrl_body.runAction(repeat);var b=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal_4.png",RectZero());b.setContentSize(644,640),b.setAnchorPoint(ZERO()),b.setPosition(LP(this,300,0)),this.addChild(b);var c=cc.size(478,468);this.m_left_layer=new cc.Layer,this.m_left_layer.ignoreAnchorPointForPosition(!1),this.m_left_layer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_left_layer.setContentSize(c),this.m_left_layer.setPosition(.5*winSize.width-1,0),this.addChild(this.m_left_layer),this.createLeftBoxLayer(),this.m_right_layer=new cc.Layer,this.m_right_layer.ignoreAnchorPointForPosition(!1),this.m_right_layer.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_right_layer.setPosition(ZERO()),this.addChild(this.m_right_layer),this.createRightBoxLayer(),this.m_table_view.reloadData(),this.updateRightInfo(),this.m_deferred.resolve(!0)},cellSizeForTable:function(a){return cc.size(400,140)},tableCellEnded:function(a){return!0},tableCellHighlight:function(){return!0},tableCellUnhighlight:function(){return!1},tableCellAtIndex:function(a,b){var c=a.dequeueCell(),cell=null;(cell=null!=c?c:new DailyDungeonListCell).unSelected();var d=this.m_daily_dungeon_list[b];return cell.setData(d),cell},numberOfCellsInTableView:function(a){return this.m_daily_dungeon_list.length},tableCellTouched:function(a,b){AudioEngine.getInstance().playNormaButtonSound();for(var c=b.getIdx(),i=0;i<this.m_daily_dungeon_list.length;i++)this.m_daily_dungeon_list[i].is_selected=c==i;var d=a.getContentOffset();a.reloadData(),a.setContentOffset(d),this.updateRightInfo()},tableCellSizeForIndex:function(){return cc.size(400,140)},createLeftBoxLayer:function(){var a=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));a.setContentSize(478,568),a.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),a.setPosition(ZERO()),this.m_left_layer.addChild(a);var b=ccSize(a),left_navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");left_navi.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),left_navi.setPosition(.5*b.width,509),this.m_left_layer.addChild(left_navi);var c=ccSize(left_navi),navi_title=cmLabel.getLabel("ダンジョンリスト",LABEL_FONT_INDEX.FONT_261);navi_title.setAnchorPoint(ANCHOR_MIDDLE()),navi_title.setPosition(.5*c.width,.5*c.height+3),left_navi.addChild(navi_title);var d=cc.size(444,532-c.height);this.m_table_view=new cc.TableView(this,d),this.m_table_view.ignoreAnchorPointForPosition(!1),this.m_table_view.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_table_view.setVerticalFillOrder(0),this.m_table_view.scrollBarEnable(!0),this.m_table_view.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_table_view.setPosition(17,18),this.m_table_view.setDelegate(this),this.m_left_layer.addChild(this.m_table_view),this.m_table_view.reloadData()},createRightBoxLayer:function(){var b=new cc.Layer;b.setContentSize(481,568),b.setPosition(LP(this,479,0)),this.m_right_layer.addChild(b);var c,line,circle_point,title;this.getSelectedDungeon();(USE_SP_DAILY_SCALE?(this.m_difficulty_name=cc.Sprite.create(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_text_title_01.png"),this.m_difficulty_name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_difficulty_name.setPosition(19,525),this.m_difficulty_name.setScale(2)):(this.m_difficulty_name=cc.Sprite.create(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_text_title_01.png"),this.m_difficulty_name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_difficulty_name.setPosition(19,525)),b.addChild(this.m_difficulty_name),(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),b.addChild(circle_point),circle_point.setPosition(19,490),(title=cmLabel.getLabel("期間情報",LABEL_FONT_INDEX.FONT_248)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(35,482),b.addChild(title),this.m_content_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_201),this.m_content_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_content_label.setPosition(35,453),b.addChild(this.m_content_label),(line=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),line.setPosition(19,443),b.addChild(line),(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),b.addChild(circle_point),circle_point.setPosition(19,408),(title=cmLabel.getLabel("遊び方",LABEL_FONT_INDEX.FONT_248)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(35,400),b.addChild(title),USE_SP_DAILY_SCALE)?((c=cc.Sprite.create(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_text_sub.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),c.setPosition(19,218),c.setScale(2),b.addChild(c)):((c=cc.Sprite.create(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_text_sub.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),c.setPosition(19,218),b.addChild(c));(line=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),line.setPosition(19,197),b.addChild(line),(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),b.addChild(circle_point),circle_point.setPosition(19,172),(title=cmLabel.getLabel("獲得報酬",LABEL_FONT_INDEX.FONT_248)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(35,164),b.addChild(title),this.m_reward_item=new MissionPreviewBonusItemCell,this.m_reward_item.setEnableToolTip(!0),this.m_reward_item.setPosition(19,86),this.m_reward_item.setLocalZOrder(1),b.addChild(this.m_reward_item),this.m_multiple_icon=cc.Sprite.create(),this.m_multiple_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_multiple_icon.setPosition(127,161),b.addChild(this.m_multiple_icon),this.m_multiple_icon.setVisible(!1);var s=ccSize(b),btn=new ccui.Button;btn.loadTextures("btn_03_off.png","btn_03_on.png","btn_03_none.png",ccui.Widget.PLIST_TEXTURE),btn.addClickEventListener(function(a){this.battleReady()}.bind(this));var d=cmLabel.getLabel("スタート",LABEL_FONT_INDEX.FONT_241);d.setAnchorPoint(ANCHOR_MIDDLE()),d.setPosition(ccCenter(btn).x-50,ccCenter(btn).y),btn.addChild(d),btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn.setPosition(.5*s.width,16),b.addChild(btn);var e=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",cc.Rect(10,10,10,10));e.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),e.setPreferredSize(cc.size(66,38)),e.setPosition(.5*btn.width+16,.5*btn.height),btn.addChild(e),cc.log(btn.width),this.m_spend_label=cmLabel.getLabel("0",LABEL_FONT_INDEX.FONT_247),this.m_spend_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_spend_label.setPosition(e.width-10,.5*e.height),e.addChild(this.m_spend_label)},updateRightInfo:function(){MasterTable.getInstance().getMasterTable();var a=this.getSelectedDungeon(),winSize=ccSize(this);if(this.m_difficulty_name.setTexture(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_text_title_"+leadingZeros(a.daily_dungeon.bg_type,2)+".png"),this.m_content_label.setString(a.daily_dungeon.content),this.m_boss_container.isRunning()&&this.m_boss_container.stopAllActions(),0!=a.stage_npc.size())for(var b=0;b<a.stage_npc.at(1).length;b++){var c=a.stage_npc.at(1);if(c[b].is_zoom){if(c[b].general.gnrl_group<100){var d=new cc.SpriteFrame(RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(c[b].general.gnrl_group,2)+".png");this.m_gnrl_body.setScale(2),this.m_gnrl_body.setSpriteFrame(d)}else{d=new cc.SpriteFrame(RES_CDN_DEFULT+"card_war_boss/"+c[b].general.gnrl_group+".png");this.m_gnrl_body.setScale(2),this.m_gnrl_body.setSpriteFrame(d)}this.m_boss_container.setPosition(winSize.width+this.m_gnrl_body.width,0);var e=new cc.MoveTo(.2,cc.p(winSize.width,0));this.m_boss_container.runAction(e);break}}var f=MasterTable.getInstance().get_DailyDungeonBonusItemList(a.daily_dungeon.daily_dungeon_bonus_idx,1),reward_bonus_type=0;if(0<f.length){var g=f[0],item={};DailyDungeonService.getInstance().convertBonusInfo(g,item),this.m_reward_item.setGainItem(item),reward_bonus_type=g.bonus_type}var h=MasterTable.getInstance().get_RewardCampaignUi(CAMPAIGN_DUNGEON_TYPE_DAILY,CAMPAIGN_POSITION_TYPE_ENTERANCE_BOTTOM_REWARD_);if(null!=h.dugeon_type)if(0!=h.event_type){if(h.event_type==CAMPAIGN_EVENT_TYPE_ALL_GAIN_REWARD_DOUBLE){var i=RES_CDN_DEFULT+cmString("common/%s",h.image_name),frame_texture=cc.textureCache.addImage(i);null!=(j=new cc.SpriteFrame(frame_texture,cc.rect(0,0,frame_texture.getContentSize().width,frame_texture.getContentSize().height)))&&(this.m_multiple_icon.setSpriteFrame(j),this.m_multiple_icon.setVisible(!0))}else if(h.event_type==CAMPAIGN_EVENT_TYPE_DAILY_DUNGEON_ONLY_GOLD)if(reward_bonus_type==BONUS_TYPE_GOLD){var j;i=RES_CDN_DEFULT+cmString("common/%s",h.image_name),frame_texture=cc.textureCache.addImage(i);null!=(j=new cc.SpriteFrame(frame_texture,cc.rect(0,0,frame_texture.getContentSize().width,frame_texture.getContentSize().height)))&&(this.m_multiple_icon.setSpriteFrame(j),this.m_multiple_icon.setVisible(!0))}else this.m_multiple_icon.setVisible(!1)}else this.m_multiple_icon.setVisible(!1);var k={};this.getTodayDailyDungeonPeriod(a.daily_dungeon_period.daily_dungeon_period_idx,k);var l=this.m_period.enable_key_entrance_count-k.key_cost_challenge_count;l<0&&(l=0),this.m_spend_label.setString(l+"/"+this.m_period.enable_key_entrance_count)},getTodayDailyDungeonPeriod:function(a,b){for(var c=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),ts=moment(c).format("YYYY-MM-DD"),is_exist=!1,daily_dungeon_open_period=NetService().get_daily_dungeon_open_period_info(),idx=0;idx<daily_dungeon_open_period.daily_dungeon_open_period.length;idx++){var p=daily_dungeon_open_period.daily_dungeon_open_period[idx];if(p.daily_dungeon_period_idx==a&&p.challenge_dt==ts){b.daily_dungeon_period_idx=p.daily_dungeon_period_idx,b.challenge_dt=p.challenge_dt,b.key_cost_challenge_count=p.key_cost_challenge_count,b.jade_cost_challenge_count=p.jade_cost_challenge_count,is_exist=!0;break}}is_exist||(b.daily_dungeon_period_idx=a,b.challenge_dt=ts,b.key_cost_challenge_count=0,b.jade_cost_challenge_count=0)},battleReady:function(){var a=this.getSelectedDungeon(),challenge_log={};if(this.getTodayDailyDungeonPeriod(a.daily_dungeon_period.daily_dungeon_period_idx,challenge_log),challenge_log.key_cost_challenge_count>=this.m_period.enable_key_entrance_count)MainObserver.getInstance().postNotification(sceneStr[scene_DailyDungeonListScene],daily_dungeon_entrance_limit_over);else{var b=this.IsEnableEntrance();if(b!=daily_dungeon_disable_pre_open_dungeon){var c=BattleContext._getInstance();c.setGameType(db.BattleGameType.DailyDungeon),c.setDailyDungeonData(a),c.setDailyDungeonPeriodIdx(this.m_period.daily_dungeon_period_idx),c.setLastDailyDungeonId(a.daily_dungeon.daily_dungeon_idx),MainObserver.getInstance().postNotification(sceneStr[scene_DailyDungeonListScene],daily_dungeon_battle_ready)}else MainObserver.getInstance().postNotification(sceneStr[scene_DailyDungeonListScene],b)}},IsEnableEntrance:function(){var a=this.getSelectedDungeon();if(a.is_open_pre_daily_dungeon){var n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),b=moment(a.daily_dungeon_period.begin_date).valueOf(),e=moment(a.daily_dungeon_period.end_date).valueOf();return b<=n&&n<=e?daily_dungeon_battle_ready:daily_dungeon_invalid_entrance_time}return daily_dungeon_disable_pre_open_dungeon},checkNeedKeyDailyDungeon:function(a){a=0;var c=this.getSelectedDungeon(),is_expense_dec=!1,nn=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).time();for(var d in list_Global_Booster_Event_V2){var b=list_Global_Booster_Event_V2[d];if(null==b.begin_dt)break;var e=moment(b.begin_dt).format("YYYY-MM-DD"),et=moment(b.end_dt).format("YYYY-MM-DD"),bb=e.valueOf(),ee=et.valueOf();if(bb<=nn&&nn<=ee&&b.booster_type==BOOSTER_TYPE_V2_DAILY_DUNGEON&&b.variation_type==BOOSTER_VARIATION_TYPE_V2_EXPENSE_DEC&&b.item_type==BOOSTER_ITEM_TYPE_V2_ENTRANCE_TICKET){if(0==b.value_1){a=c.daily_dungeon.need_key-c.daily_dungeon.need_key*b.variation_value/100,is_expense_dec=!0;break}if(b.value_1==c.daily_dungeon.daily_dungeon_idx){a=c.daily_dungeon.need_key-c.daily_dungeon.need_key*b.variation_value/100,is_expense_dec=!0;break}}}is_expense_dec&&(a=Math.min(a,c.daily_dungeon.need_key)),0==a&&(a=c.daily_dungeon.need_key)},getSelectedDungeon:function(){for(var a=0;a<this.m_daily_dungeon_list.length;a++)if(this.m_daily_dungeon_list[a].is_selected)return this.m_daily_dungeon_list[a];return this.m_daily_dungeon_list[0]}}),DailyDungeonListScene=GameScene.extend({m_deferred:$.Deferred(),m_gameObserver:null,m_resource:[],ctor:function(){this._super(scene_DailyDungeonListScene),cc.log("CHECK DailyDungeonListScene")},get_story_deferred:function(){return this.m_deferred},init:function(){this.m_gameObserver=MainObserver.getInstance(),this.m_gameObserver.addObserver(this.onNotification,this,sceneStr[scene_DailyDungeonListScene]),this.initLayoutProgress2(),this.m_resource=[],this.m_resource.push(RES_CDN_DEFULT+"common/bg_sub.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_01.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_02.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_03.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_04.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_05.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_11.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_12.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_13.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_31.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_32.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_33.png"),resourceLoader(this.m_resource,function(){var b=cc.director.getWinSize(),bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub.png");bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(b)),USE_SP_COMMON_SUB_BG_SCALE&&bg.setScale(2),this.addChild(bg),this.m_dungeon_list_layer=new DailyDungeonListLayer(this.m_deferred),this.m_dungeon_list_layer.setPosition(ccCenter(b)),this.addChild(this.m_dungeon_list_layer);var c,statusLayer=new StatusLayer(INVOKER_TYPE.normal);(statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer),USE_SP_DAILY_SCALE)?((c=cc.Sprite.create(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_status_title.png")).setAnchorPoint(ZERO()),c.setPosition(90,585),c.setScale(2),this.addChild(c)):((c=cc.Sprite.create(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_status_title.png")).setAnchorPoint(ZERO()),c.setPosition(90,585),this.addChild(c));var d=new ccui.Button;return d.loadTextures("btn_home_off.png","btn_home_on.png","",ccui.Widget.PLIST_TEXTURE),d.setAnchorPoint(ZERO()),d.setPosition(10,559),d.addClickEventListener(function(a){this.back()}.bind(this)),this.addChild(d),this.removeLayerProgress2(),!0}.bind(this)),cc.log("CHECK DailyDungeonListScene Init")},onEnter:function(){this._super(),this.playMainBGM()},back:function(){this.onKeyBack(!0)},onExit:function(){if(this._super(),cc.log("CHECK DailyDungeonListScene Exit"),this.m_gameObserver.removeObserver(sceneStr[scene_DailyDungeonListScene]),null!=this.m_resource){for(var a=0;a<this.m_resource.length;a++)cc.loader.release(this.m_resource[a]);this.m_resource=null}},onNotification:function(a){switch(this._super(a),a){case daily_dungeon_battle_ready:var b=new FriendSelectScene;SceneManager.getInstance().replaceScene(b),b=null;break;case daily_dungeon_invalid_entrance_time:this.showInvalidEntranceTime();break;case daily_dungeon_disable_pre_open_dungeon:this.showInvalidEntrancePreOpen();break;case daily_dungeon_entrance_limit_over:this.showEntranceLimitOver()}return!0},showInvalidEntranceTime:function(){this.m_box.show()},showEntranceLimitOver:function(){var a=MasterManager.getInstance();this.m_box.setTitle(a.get_LanguageData("label_weekly_invalid_entrance")),this.m_box.setText(a.get_LanguageData("label_daily_dungeon_entrance_limit_over")),this.m_box.addButtonInfo(new MessageButtonInfo(a.get_LanguageData("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showInvalidEntrancePreOpen:function(){var a=MasterManager.getInstance();this.m_box.setTitle(a.get_LanguageData("label_weekly_invalid_entrance")),this.m_box.setText(a.get_LanguageData("label_weekly_invalid_entrance_pre_open")),this.m_box.addButtonInfo(new MessageButtonInfo(a.get_LanguageData("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()}});