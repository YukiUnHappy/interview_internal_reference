var GreatWallService,SCRIPT_TYPE={SCRIPT:0,ANIMATION:1,PROLOGUE:2,MISSION:3,EVENT:4},WATCH_STATUS={PHASE:0,FINISH:1},ResourceType={RT_IMAGE:1,RT_BGM:2,RT_SOUND:3,RT_VOICE:4,RT_SKELETON:5,RT_PARTICLE:6,RT_TEXTURE:10,RT_SKELETON2:8888},DIALOG_TYPE={NORMAL:1,COMPACT:2,VOICE:3},STATUS_LOVE_CG={NONE:0,FAST_FORWARD:1,AUTO_FORWARD:2},Contents_Skip=1e3,Hide_Script_Log=992e3,SCENE_MODE={NORMAL:0,WATCH:1},HSCNE_SCREEN_WIDTH=780,MOSAIC_CELL_SIZE=9,EFFECT_TYPE_NONE=0,EFFECT_TYPE_WHITE_BLINK=1,EFFECT_TYPE_WHITE_FADEIN=2,EFFECT_TYPE_DELAY_TIME=3,EFFECT_TYPE_WHITE_OUT=4,AUTO_FORWARD_TIME=1.5,FAST_FORWARD_TIME=.1,MODE_CHANGE_CLEAN_TIME=1,MODE_CHNAGE_TIME=1,HSCENE_TIME_SCALE_2X=2,HSCENE_TIME_SCALE_1X=1,DEV_TEST_SCRIPT=!1,HERO_LEFT=1,HERO_CENTER=2,HERO_RIGHT=3,LoveContentsScriptLayer_V3=cc.Layer.extend({m_label:null,m_script_index:0,m_bg_frame:null,m_bg_script_name:null,m_name_label:null,m_finger:null,m_is_complete:!1,m_script_bg:null,is_zooming:!1,m_show_btn:null,m_btn_container:null,m_status:null,m_script_delta_time:0,m_current_voice_id:0,m_log_box:null,m_blink_layer:null,m_test_label:null,m_auto_icon:null,m_ff_icon:null,m_ff_effect:null,m_auto_effect:null,m_script_type:null,m_left_body:null,m_middle_body:null,m_right_body:null,m_skeleton:null,m_skeleton_bg:null,m_script_body_layer:null,m_gnrl_id:null,m_cliper:null,m_stencil:null,m_mosaic:null,m_is_effect_playing:!1,m_loading_modal_layer:null,m_is_update:!1,m_script_bg_layer:null,m_loop_ui_container:null,m_scene_mode:null,m_2x_effect:null,m_box:null,m_is_2x_speed:!1,m_watch_status:null,m_left_mask:null,m_right_mask:null,m_finish_btn:null,m_front_particle:null,m_back_particle:null,m_env_effect_bg:null,m_2x_speed_btns:[],m_resource_list:[],m_resource_list_array:null,m_resource_list_array2:null,m_fast_forward_btns:[],m_auto_forward_btns:[],m_last_animation:null,last_script_bg:null,m_img_rd_temp1:null,m_img_rd_temp2:null,m_img_rd_temp3:null,m_Observer:null,shader:null,m_texture:null,m_enable_touch:!0,m_enable_touch_click:!0,m_b_create:!1,m_enc_load:null,m_enc_strng:null,m_texture_img:null,m_screen_mosaic_visible:!1,m_is_hide_mosaic:!1,m_bg_mask:null,m_event_touch:null,m_audio:null,m_optionWatch:null,m_skipWatch:null,m_speed_2x_start_Watch:null,m_speed_2x_stop_Watch:null,m_touch_button_Common:null,m_option_Common:null,m_skip_Common:null,m_hide_Common:null,m_log_Common:null,m_ff_start_Common:null,m_ff_stop_Common:null,m_auto_start_Common:null,m_auto_stop_Common:null,m_polygon_stencil:null,m_script_skip_and_phase_btn:null,m_love_watch_mode_index:0,m_watch_mode_counting:null,m_left_arrow_btn:null,m_right_arrow_btn:null,m_use_Add_Scale:1,m_load_complet:!1,m_cliper_2:null,m_stencil_2:null,m_mosaic_2:null,m_polygon_stencil_2:null,shader2:null,m_dialog_type:null,ctor:function(gnrl_id){this.m_enc_load=null,this.m_texture_img=null,this.m_b_create=!1,this.mosaicSize=1,this.m_2x_speed_btns=[],this.m_resource_list=[],this.m_resource_list_array=[],this.m_resource_list_array2=[],this.m_fast_forward_btns=[],this.m_auto_forward_btns=[],this.m_status=STATUS_LOVE_CG.NONE,this.m_scene_mode=SCENE_MODE.NORMAL,this.m_last_animation=null,this.m_current_animation={animation:0},this.m_img_rd_temp1=null,this.m_img_rd_temp2=null,this.m_img_rd_temp3=null,this.m_screen_mosaic_visible=!1,this.m_is_hide_mosaic=!1,this.m_bg_mask=null,this.m_event_touch=null,this.m_audio=AudioEngine.getInstance(),this.m_optionWatch=null,this.m_skipWatch=null,this.m_speed_2x_start_Watch=null,this.m_speed_2x_stop_Watch=null,this.m_touch_button_Common=null,this.m_option_Common=null,this.m_skip_Common=null,this.m_hide_Common=null,this.m_log_Common=null,this.m_ff_start_Common=null,this.m_ff_stop_Common=null,this.m_auto_start_Common=null,this.m_auto_stop_Common=null,this.m_polygon_stencil=null,this.m_polygon_stencil_2=null,this.m_script_skip_and_phase_btn=null,this.m_love_watch_mode_index=0,this.m_watch_mode_counting=null,this.m_left_arrow_btn=null,this.m_right_arrow_btn=null,this.m_bg_script_name=null,this.m_dialog_type=DIALOG_TYPE.NORMAL,USE_SP_CARD_SCRIPT_BODY_SCALE?this.m_use_Add_Scale=2:this.m_use_Add_Scale=1,this._super(),this.init(gnrl_id),this.last_script_bg=""},onEnter:function(){this._super(),MainObserver.getInstance().removeObserver(NOTIFICATION_LOVE_CONTENTS_SCRIPT_LAYER),MainObserver.getInstance().addObserver(this.onNotification,this,NOTIFICATION_LOVE_CONTENTS_SCRIPT_LAYER)},init:function(gnrl_id){this.m_load_complet=!1,this.m_Observer=MainObserver.getInstance(),this.m_gnrl_id=gnrl_id;var cg=MasterTable.getInstance().get_LoveCgByGnrlId(this.m_gnrl_id);if(this.m_love_watch_mode_list=MasterTable.getInstance().get_LoveWatchModeList(cg.love_cg_story_num),"y"==cg.animation_yn){this.m_script_type=SCRIPT_TYPE.ANIMATION,this.m_animation_script_list=MasterTable.getInstance().get_LoveCgAnimationStoryList(cg.love_cg_story_num),this.m_animation_script_list.sort(function(l,r){return l.order_number>r.order_number?1:l.order_number<r.order_number?-1:0});for(var resource_list=[],idx=0;idx<this.m_animation_script_list.length;idx++){if("0"!=this.m_animation_script_list[idx].voice){var img_rd={_resource_type:ResourceType.RT_VOICE,path:RES_CDN_SOUND+SND_TYPE+"voice_love/"+this.m_animation_script_list[idx].voice+".mp3"};resource_list.push(img_rd),img_rd=null}if("0"!=this.m_animation_script_list[idx].r_filename){img_rd={_resource_type:ResourceType.RT_IMAGE,png:RES_CDN_DEFULT+"card_script_body/"+this.m_animation_script_list[idx].r_filename+".png"};resource_list.push(img_rd),this.m_img_rd_temp1=new cc.Sprite(RES_CDN_DEFULT+"card_script_body/"+this.m_animation_script_list[idx].r_filename+".png"),this.m_img_rd_temp1.setVisible(!1),this.addChild(this.m_img_rd_temp1),img_rd=null}if("0"!=this.m_animation_script_list[idx].m_filename){img_rd={_resource_type:ResourceType.RT_IMAGE,png:RES_CDN_DEFULT+"card_script_body/"+this.m_animation_script_list[idx].m_filename+".png"};resource_list.push(img_rd),this.m_img_rd_temp2=new cc.Sprite(RES_CDN_DEFULT+"card_script_body/"+this.m_animation_script_list[idx].m_filename+".png"),this.m_img_rd_temp2.setVisible(!1),this.addChild(this.m_img_rd_temp2),img_rd=null}if("0"!=this.m_animation_script_list[idx].l_filename){img_rd={_resource_type:ResourceType.RT_IMAGE,png:RES_CDN_DEFULT+"card_script_body/"+this.m_animation_script_list[idx].l_filename+".png"};resource_list.push(img_rd),this.m_img_rd_temp3=new cc.Sprite(RES_CDN_DEFULT+"card_script_body/"+this.m_animation_script_list[idx].l_filename+".png"),this.m_img_rd_temp3.setVisible(!1),this.addChild(this.m_img_rd_temp3),img_rd=null}if("0"!=this.m_animation_script_list[idx].bg_img){img_rd={_resource_type:ResourceType.RT_IMAGE,png:RES_CDN_DEFULT+"card_script_bg/"+this.m_animation_script_list[idx].bg_img+".jpg"};resource_list.push(img_rd),img_rd=null}}if(0!=cg.bg_type){img_rd={_resource_type:ResourceType.RT_IMAGE,png:RES_CDN_DEFULT+"hscene_bg/"+cg.bg_type+".png"};resource_list.push(img_rd),img_rd=null}(hscene_common_img=[])[0]=RES_CDN_DEFULT+"menu_cg/img_auto.png",hscene_common_img[1]=RES_CDN_DEFULT+"menu_cg/img_foward.png",hscene_common_img[2]=RES_CDN_DEFULT+"menu_cg/btn_cglook_off.png",hscene_common_img[3]=RES_CDN_DEFULT+"menu_cg/btn_cglook_on.png",hscene_common_img[4]=RES_CDN_DEFULT+"menu_cg/btn_option_off.png",hscene_common_img[5]=RES_CDN_DEFULT+"menu_cg/btn_option_on.png",hscene_common_img[6]=RES_CDN_DEFULT+"menu_cg/btn_skip_off.png",hscene_common_img[7]=RES_CDN_DEFULT+"menu_cg/btn_skip_on.png",hscene_common_img[8]=RES_CDN_DEFULT+"menu_cg/btn_log_off.png",hscene_common_img[9]=RES_CDN_DEFULT+"menu_cg/btn_log_on.png",hscene_common_img[10]=RES_CDN_DEFULT+"menu_cg/btn_fast_forward_off.png",hscene_common_img[11]=RES_CDN_DEFULT+"menu_cg/btn_fast_forward_on.png",hscene_common_img[12]=RES_CDN_DEFULT+"menu_cg/btn_speed_none.png",hscene_common_img[13]=RES_CDN_DEFULT+"menu_cg/btn_speed_off.png",hscene_common_img[14]=RES_CDN_DEFULT+"menu_cg/btn_speed_on.png",hscene_common_img[15]=RES_CDN_DEFULT+"menu_cg/btn_finish_off.png",hscene_common_img[16]=RES_CDN_DEFULT+"menu_cg/btn_finish_on.png",hscene_common_img[17]=RES_CDN_DEFULT+"menu_cg/btn_fast_forward_none.png",hscene_common_img[18]=RES_CDN_DEFULT+"menu_cg/btn_auto_off.png",hscene_common_img[19]=RES_CDN_DEFULT+"menu_cg/btn_auto_none.png",hscene_common_img[20]=RES_CDN_DEFULT+"menu_cg/btn_auto_on.png",hscene_common_img[21]=RES_CDN_DEFULT+"card_script_body/10000.png";for(idx=0;idx<hscene_common_img.length;idx++){img_rd={_resource_type:ResourceType.RT_IMAGE,png:hscene_common_img[idx]};resource_list.push(img_rd.png),img_rd=null}this.m_resource_list=resource_list.reduce(function(a,b){if(0==a.length)return a.push(b),a;for(var is_chk=!1,idx=0;idx<a.length;idx++)a[idx].png==b.png&&(is_chk=!0);return 0==is_chk&&a.push(b),a},[]);for(idx=0;idx<this.m_resource_list.length;idx++)this.m_resource_list_array.push(this.m_resource_list[idx]);for(idx=0;idx<this.m_resource_list.length;idx++){if(this.m_resource_list[idx]._resource_type==ResourceType.RT_IMAGE&&this.m_resource_list_array2.push(this.m_resource_list[idx].png),this.m_resource_list[idx]._resource_type==ResourceType.RT_VOICE&&this.m_resource_list_array2.push(this.m_resource_list[idx].path),this.m_resource_list[idx]._resource_type==ResourceType.RT_SKELETON&&(null!=this.m_resource_list[idx].atlas&&null!=this.m_resource_list[idx].atlas&&this.m_resource_list_array2.push(this.m_resource_list[idx].atlas),null!=this.m_resource_list[idx].bone&&null!=this.m_resource_list[idx].bone&&this.m_resource_list_array2.push(this.m_resource_list[idx].bone),null!=this.m_resource_list[idx].bg&&null!=this.m_resource_list[idx].bg&&this.m_resource_list_array2.push(this.m_resource_list[idx].bg),null!=this.m_resource_list[idx].png&&null!=this.m_resource_list[idx].png))for(var jdx=0;jdx<this.m_resource_list[jdx].png.length;jdx++)this.m_resource_list_array2.push(this.m_resource_list[idx].png[jdx]);this.m_resource_list[idx]._resource_type==ResourceType.RT_SKELETON2&&(null!=this.m_resource_list[idx].atlas&&null!=this.m_resource_list[idx].atlas&&this.m_resource_list_array2.push(this.m_resource_list[idx].atlas),null!=this.m_resource_list[idx].bone&&null!=this.m_resource_list[idx].bone&&this.m_resource_list_array2.push(this.m_resource_list[idx].bone),null!=this.m_resource_list[idx].bg&&null!=this.m_resource_list[idx].bg&&this.m_resource_list_array2.push(this.m_resource_list[idx].bg))}resource_list=hscene_common_img=null}else{this.m_script_type=SCRIPT_TYPE.SCRIPT,this.m_script_list=MasterTable.getInstance().get_LoveCgStoryList(cg.love_cg_story_num),this.m_script_list.sort(function(l,r){return l.order_number>r.order_number?1:l.order_number<r.order_number?-1:0});for(idx=0;idx<this.m_script_list.length;idx++){if("0"!=this.m_script_list[idx].voice){img_rd={_resource_type:ResourceType.RT_VOICE,path:RES_CDN_SOUND+SND_TYPE+"voice_love/"+this.m_script_list[idx].voice+".mp3"};this.m_resource_list.push(img_rd),this.m_resource_list_array.push(img_rd),this.m_resource_list_array2.push(img_rd.path),img_rd=null}if(null!=this.m_script_list[idx].img){img_rd={_resource_type:ResourceType.RT_IMAGE,png:RES_CDN_DEFULT+"menu_cg/"+this.m_script_list[idx].img+".jpg"};this.m_resource_list.push(img_rd),this.m_resource_list_array.push(img_rd),this.m_resource_list_array2.push(img_rd.png),img_rd=null}}var hscene_common_img;(hscene_common_img=[])[0]=RES_CDN_DEFULT+"menu_cg/img_auto.png",hscene_common_img[1]=RES_CDN_DEFULT+"menu_cg/img_foward.png",hscene_common_img[2]=RES_CDN_DEFULT+"menu_cg/btn_cglook_off.png",hscene_common_img[3]=RES_CDN_DEFULT+"menu_cg/btn_cglook_on.png",hscene_common_img[4]=RES_CDN_DEFULT+"menu_cg/btn_option_off.png",hscene_common_img[5]=RES_CDN_DEFULT+"menu_cg/btn_option_on.png",hscene_common_img[6]=RES_CDN_DEFULT+"menu_cg/btn_skip_off.png",hscene_common_img[7]=RES_CDN_DEFULT+"menu_cg/btn_skip_on.png",hscene_common_img[8]=RES_CDN_DEFULT+"menu_cg/btn_log_off.png",hscene_common_img[9]=RES_CDN_DEFULT+"menu_cg/btn_log_on.png",hscene_common_img[10]=RES_CDN_DEFULT+"menu_cg/btn_fast_forward_off.png",hscene_common_img[11]=RES_CDN_DEFULT+"menu_cg/btn_fast_forward_on.png",hscene_common_img[12]=RES_CDN_DEFULT+"menu_cg/btn_speed_none.png",hscene_common_img[13]=RES_CDN_DEFULT+"menu_cg/btn_speed_off.png",hscene_common_img[14]=RES_CDN_DEFULT+"menu_cg/btn_speed_on.png",hscene_common_img[15]=RES_CDN_DEFULT+"menu_cg/btn_finish_off.png",hscene_common_img[16]=RES_CDN_DEFULT+"menu_cg/btn_finish_on.png",hscene_common_img[17]=RES_CDN_DEFULT+"menu_cg/btn_fast_forward_none.png",hscene_common_img[18]=RES_CDN_DEFULT+"menu_cg/btn_auto_off.png",hscene_common_img[19]=RES_CDN_DEFULT+"menu_cg/btn_auto_none.png",hscene_common_img[20]=RES_CDN_DEFULT+"menu_cg/btn_auto_on.png",hscene_common_img[21]=RES_CDN_DEFULT+"card_script_body/10000.png";for(idx=0;idx<hscene_common_img.length;idx++){img_rd={_resource_type:ResourceType.RT_IMAGE,png:hscene_common_img[idx]};this.m_resource_list_array2.push(img_rd.png),img_rd=null}}return cc.loader.load(this.m_resource_list_array2,function(err,results){if(!err){this.m_load_complet=!0;var winSize=cc.director.getWinSize();this.ignoreAnchorPointForPosition(!1),this.setContentSize(winSize),this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setPosition(ZERO()),this.m_user_info=NetService().get_User_info(),this.m_env_effect_bg=null,0!=cg.bg_type&&(this.m_env_effect_bg=cc.Sprite.create(),this.m_env_effect_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_env_effect_bg.setPosition(ccCenter(winSize)),this.addChild(this.m_env_effect_bg)),this.m_script_bg_layer=new cc.Layer,this.m_script_bg_layer.ignoreAnchorPointForPosition(!1),this.m_script_bg_layer.setContentSize(winSize),this.m_script_bg_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_script_bg_layer.setPosition(ccCenter(winSize)),this.addChild(this.m_script_bg_layer),this.m_script_bg=cc.Sprite.create(RES_CDN_DEFULT+"card_script_bg/116.jpg"),USE_SP_SCRIPT_BG_SCALE&&this.m_script_bg.setScale(2),this.m_script_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_script_bg.setPosition(ccCenter(winSize)),this.m_script_bg_layer.addChild(this.m_script_bg),this.m_script_type==SCRIPT_TYPE.ANIMATION&&(this.createAnimationTypeLoad(),this.createAnimationType()),this.m_loading_modal_layer=new LoveContentLoadingLayer,this.m_loading_modal_layer.setTotalResourceCount(this.m_resource_list.length+100),this.m_loading_modal_layer.setPosition(ccCenter(winSize)),this.addChild(this.m_loading_modal_layer,88888),this.m_box=new GameMessageBox,this.addChild(this.m_box,99999),this.showLoadingLayer(),this.m_log_box=new GameModalLayer,this.addChild(this.m_log_box,99999),this.schedule(this.resourceLoading,.1),winSize=cg=null}}.bind(this)),!0},onExit:function(){if(this._super(),this.m_audio.stopEffectsAll(),this.m_audio.releaseResourceEffects(),null!=this.m_enc_load&&(cc.loader.release(this.m_enc_load),this.m_enc_load=null),(this.m_enc_strng=null)!=this.m_resource_list_array2){for(var i=0;i<this.m_resource_list_array2.length;i++)cc.loader.release(this.m_resource_list_array2[i]);this.m_resource_list_array2=null}if(null!=this.m_resource_list_array){for(i=0;i<this.m_resource_list_array.length;i++){if(this.m_resource_list_array[i]._resource_type==ResourceType.RT_IMAGE&&(this.m_resource_list_array[i].png==RES_CDN_DEFULT+"card_script_body/24501.png"||cc.loader.release(this.m_resource_list_array[i].png),this.m_resource_list_array[i].png=null),this.m_resource_list_array[i]._resource_type==ResourceType.RT_VOICE&&(cc.loader.release(this.m_resource_list_array[i].path),this.m_resource_list_array[i].path=null),this.m_resource_list_array[i]._resource_type==ResourceType.RT_SKELETON&&(null!=this.m_resource_list_array[i].atlas&&null!=this.m_resource_list_array[i].atlas&&(cc.loader.release(this.m_resource_list_array[i].atlas),this.m_resource_list_array[i].atlas=null),null!=this.m_resource_list_array[i].bone&&null!=this.m_resource_list_array[i].bone&&(cc.loader.release(this.m_resource_list_array[i].bone),this.m_resource_list_array[i].bone=null),null!=this.m_resource_list_array[i].bg&&null!=this.m_resource_list_array[i].bg&&(cc.loader.release(this.m_resource_list_array[i].bg),this.m_resource_list_array[i].bg=null),null!=this.m_resource_list_array[i].png&&null!=this.m_resource_list_array[i].png)){for(var idx=0;idx<this.m_resource_list_array[i].png.length;idx++)cc.loader.release(this.m_resource_list_array[i].png[idx]);this.m_resource_list_array[i].png=null}this.m_resource_list_array[i]._resource_type==ResourceType.RT_SKELETON2&&(null!=this.m_resource_list_array[i].atlas&&null!=this.m_resource_list_array[i].atlas&&(cc.loader.release(this.m_resource_list_array[i].atlas),this.m_resource_list_array[i].atlas=null),null!=this.m_resource_list_array[i].bone&&null!=this.m_resource_list_array[i].bone&&(cc.loader.release(this.m_resource_list_array[i].bone),this.m_resource_list_array[i].bone=null),null!=this.m_resource_list_array[i].bg&&null!=this.m_resource_list_array[i].bg&&(cc.loader.release(this.m_resource_list_array[i].bg),this.m_resource_list_array[i].bg=null))}this.m_resource_list_array=null}this.m_resource_list=[],(this.m_enc_strng=null)!=this.m_img_rd_temp1&&(this.removeChild(this.m_img_rd_temp1),this.m_img_rd_temp1=null),null!=this.m_img_rd_temp2&&(this.removeChild(this.m_img_rd_temp2),this.m_img_rd_temp2=null),null!=this.m_img_rd_temp3&&(this.removeChild(this.m_img_rd_temp3),this.m_img_rd_temp3=null),null!=this.m_skeleton_bg&&null!=this.m_skeleton_bg&&(this.m_script_body_layer.removeChild(this.m_skeleton_bg),this.m_skeleton_bg=null),null!=this.m_skeleton&&null!=this.m_skeleton&&(this.m_script_body_layer.removeChild(this.m_skeleton),this.m_skeleton._skeleton.data.animations=[],this.m_skeleton._skeleton.data.bones=[],this.m_skeleton._skeleton.data.events=[],this.m_skeleton._skeleton.data.slots=[],this.m_skeleton._skeleton.data.skins=[],this.m_skeleton._skeleton.data=null,this.m_skeleton._spineComplete=null,this.m_skeleton=null),null!=this.m_left_body&&null!=this.m_left_body&&(this.m_script_body_layer.removeChild(this.m_left_body),this.m_left_body=null),null!=this.m_middle_body&&null!=this.m_middle_body&&(this.m_script_body_layer.removeChild(this.m_middle_body),this.m_middle_body=null),null!=this.m_right_body&&null!=this.m_right_body&&(this.m_script_body_layer.removeChild(this.m_right_body),this.m_right_body=null),null!=this.m_script_bg&&null!=this.m_script_bg&&(this.m_script_bg_layer.removeChild(this.m_script_bg),this.m_script_bg=null),this.m_script_bg_layer.removeAllChildrenWithCleanup(!0),this.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_script_bg_layer),this.m_2x_speed_btns=[],null!=this.m_optionWatch&&(this.m_loop_ui_container.removeChild(this.m_optionWatch),this.m_optionWatch=null),null!=this.m_skipWatch&&(this.m_loop_ui_container.removeChild(this.m_skipWatch),this.m_skipWatch=null),null!=this.m_speed_2x_start_Watch&&(this.m_loop_ui_container.removeChild(this.m_speed_2x_start_Watch),this.m_speed_2x_start_Watch=null),null!=this.m_speed_2x_stop_Watch&&(this.m_loop_ui_container.removeChild(this.m_speed_2x_stop_Watch),this.m_speed_2x_stop_Watch=null),null!=this.m_2x_effect&&(this.m_loop_ui_container.removeChild(this.m_2x_effect),this.m_2x_effect._skeleton.data.animations=[],this.m_2x_effect._skeleton.data.bones=[],this.m_2x_effect._skeleton.data.events=[],this.m_2x_effect._skeleton.data.slots=[],this.m_2x_effect._skeleton.data.skins=[],this.m_2x_effect._skeleton.slots=[],this.m_2x_effect._spineComplete=null,this.m_2x_effect._skeleton=null,this.m_2x_effect=null),null!=this.m_finish_btn&&(this.m_loop_ui_container.removeChild(this.m_finish_btn),this.m_finish_btn=null),null!=this.m_loop_ui_container&&(this.m_loop_ui_container.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_loop_ui_container),this.m_loop_ui_container=null),null!=this.m_event_touch&&(cc.eventManager.removeListener(this.m_event_touch),this.m_event_touch=null),null!=this.m_name_label&&(this.m_bg_frame.removeChild(this.m_name_label),this.m_name_label=null),null!=this.m_finger&&(this.m_bg_frame.removeChild(this.m_finger),this.m_finger=null),null!=this.m_label&&(this.m_bg_frame.removeChild(this.m_label),this.m_label=null),null!=this.m_bg_mask&&(this.m_bg_frame.removeChild(this.m_bg_mask),this.m_bg_mask=null),null!=this.m_auto_icon&&(this.removeChild(this.m_auto_icon),this.m_auto_icon=null),null!=this.m_show_btn&&(this.removeChild(this.m_show_btn),this.m_show_btn=null),null!=this.m_ff_icon&&(this.removeChild(this.m_ff_icon),this.m_ff_icon=null),null!=this.m_touch_button_Common&&(this.removeChild(this.m_touch_button_Common),this.m_touch_button_Common=null),null!=this.m_bg_frame&&(this.m_bg_frame.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_bg_frame),this.m_bg_frame=null),null!=this.m_ff_effect&&null!=this.m_ff_effect&&(this.m_btn_container.removeChild(this.m_ff_effect),this.m_ff_effect._skeleton.data.animations=[],this.m_ff_effect._skeleton.data.bones=[],this.m_ff_effect._skeleton.data.events=[],this.m_ff_effect._skeleton.data.slots=[],this.m_ff_effect._skeleton.data.skins=[],this.m_ff_effect._skeleton.slots=[],this.m_ff_effect._spineComplete=null,this.m_ff_effect._skeleton=null,this.m_ff_effect=null),null!=this.m_auto_effect&&null!=this.m_auto_effect&&(this.m_btn_container.removeChild(this.m_auto_effect),this.m_auto_effect._skeleton.data.animations=[],this.m_auto_effect._skeleton.data.bones=[],this.m_auto_effect._skeleton.data.events=[],this.m_auto_effect._skeleton.data.slots=[],this.m_auto_effect._skeleton.data.skins=[],this.m_auto_effect._skeleton.slots=[],this.m_auto_effect._spineComplete=null,this.m_auto_effect._skeleton=null,this.m_auto_effect=null),null!=this.m_option_Common&&(this.m_btn_container.removeChild(this.m_option_Common),this.m_option_Common=null),null!=this.m_skip_Common&&(this.m_btn_container.removeChild(this.m_skip_Common),this.m_skip_Common=null),null!=this.m_hide_Common&&(this.m_btn_container.removeChild(this.m_hide_Common),this.m_hide_Common=null),null!=this.m_log_Common&&(this.m_btn_container.removeChild(this.m_log_Common),this.m_log_Common=null),null!=this.m_ff_start_Common&&(this.m_btn_container.removeChild(this.m_ff_start_Common),this.m_ff_start_Common=null),null!=this.m_ff_stop_Common&&(this.m_btn_container.removeChild(this.m_ff_stop_Common),this.m_ff_stop_Common=null),null!=this.m_auto_start_Common&&(this.m_btn_container.removeChild(this.m_auto_start_Common),this.m_auto_start_Common=null),null!=this.m_auto_stop_Common&&(this.m_btn_container.removeChild(this.m_auto_stop_Common),this.m_auto_stop_Common=null),null!=this.m_btn_container&&(this.m_btn_container.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_btn_container),this.m_btn_container=null),this.m_auto_forward_btns=[],null!=this.m_loading_modal_layer&&(this.removeChild(this.m_loading_modal_layer),this.m_loading_modal_layer=null),null!=this.m_stencil&&(this.m_cliper.removeChild(this.m_stencil),this.m_stencil=null),null!=this.m_mosaic&&(this.m_cliper.removeChild(this.m_mosaic),this.m_mosaic=null),null!=this.m_mosaic_2&&(this.m_cliper_2.removeChild(this.m_mosaic_2),this.m_mosaic_2=null),null!=this.m_front_particle&&(this.m_script_body_layer.removeChild(this.m_front_particle),this.m_front_particle=null),null!=this.m_back_particle&&(this.m_script_body_layer.removeChild(this.m_back_particle),this.m_back_particle=null),null!=this.m_cliper&&(this.m_cliper.removeAllChildrenWithCleanup(!0),this.m_script_body_layer.removeChild(this.m_cliper),this.m_cliper=null),null!=this.m_cliper_2&&(this.m_cliper_2.removeAllChildrenWithCleanup(!0),this.m_script_body_layer.removeChild(this.m_cliper_2),this.m_cliper_2=null),null!=this.m_box&&(this.removeChild(this.m_box),this.m_box=null),null!=this.m_log_box&&(this.removeChild(this.m_log_box),this.m_log_box=null),null!=this.m_env_effect_bg&&(this.removeChild(this.m_env_effect_bg),this.m_env_effect_bg=null),null!=this.m_left_mask&&(this.removeChild(this.m_left_mask),this.m_left_mask=null),null!=this.m_right_mask&&(this.removeChild(this.m_right_mask),this.m_right_mask=null),null!=this.m_blink_layer&&(this.removeChild(this.m_blink_layer),this.m_blink_layer=null),null!=this.m_script_body_layer&&(this.m_script_body_layer.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_script_body_layer)),this.m_script_body_layer=null,this.m_fast_forward_btns=null,this.m_script_bg_layer=null,this.m_texture_img=null,this.m_texture=null,this.shader=null,this.shader2=null,this.m_animation_script_list=null,this.m_audio=null,this.m_script_list=null,this.m_script_skip_and_phase_btn=null,this.m_love_watch_mode_index=0,this.m_watch_mode_counting=null,this.m_left_arrow_btn=null,this.m_right_arrow_btn=null,this.m_bg_script_name=null},stopUpdate:function(){this.m_is_update&&(this.m_is_update=!1,this.unscheduleUpdate())},createAnimationTypeLoad:function(){var winSize=ccSize(this),m=MasterManager.getInstance(),cg=MasterTable.getInstance().get_LoveCgByGnrlId(this.m_gnrl_id),gnrl=m.get_General(this.m_gnrl_id);this.m_script_body_layer=new cc.Layer,this.m_script_body_layer.ignoreAnchorPointForPosition(!1),this.m_script_body_layer.setContentSize(winSize),this.m_script_body_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_script_body_layer.setPosition(ccCenter(winSize)),this.addChild(this.m_script_body_layer);var sk_rd={_resource_type:null,bone:null,atlas:null,png:[],bg:null};sk_rd._resource_type=ResourceType.RT_SKELETON,sk_rd.bone=RES_JBIN+cg.love_cg_story_num+".jbin",sk_rd.atlas=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/hscene/"+cg.love_cg_story_num+".atlas";for(var pngList=LoveCgGeneralName[gnrl.gnrl_group],idx=0;idx<pngList.length;idx++)sk_rd.png.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/hscene/"+pngList[idx]+".png");var bgList=res_hscene_bg_jpg_list.indexOf(cg.love_cg_story_num);-1!=bgList&&(sk_rd.bg=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/hscene/"+cg.love_cg_story_num+".jpg"),this.m_resource_list.push(sk_rd),this.m_resource_list_array.push(sk_rd),this.m_resource_list.sort(function(r,l){return l._resource_type-r._resource_type}),bgList=pngList=winSize=cg=m=gnrl=sk_rd=null},createAnimationType:function(){var winSize=ccSize(this),cg=MasterTable.getInstance().get_LoveCgByGnrlId(this.m_gnrl_id);this.m_back_particle=null,""!=cg.back_effect&&0==USE_SP_LOVE_CONTENT_PARTICLE&&(this.m_back_particle=new cc.ParticleSystem(RES_CDN_DEFULT+"env_effect/"+cg.back_effect+".plist"),this.m_back_particle.setPosition(winSize.width*cg.back_effect_x,winSize.height*cg.back_effect_y),this.m_back_particle.resetSystem(),this.m_back_particle.setVisible(!1),this.m_script_body_layer.addChild(this.m_back_particle,1)),this.m_front_particle=null,""!=cg.front_effect&&0==USE_SP_LOVE_CONTENT_PARTICLE&&(this.m_front_particle=new cc.ParticleSystem(RES_CDN_DEFULT+"env_effect/"+cg.front_effect+".plist"),this.m_front_particle.setPosition(cc.p(winSize.width*cg.front_effect_x,winSize.height*cg.front_effect_y)),this.m_front_particle.resetSystem(),this.m_front_particle.setVisible(!1),this.m_script_body_layer.addChild(this.m_front_particle,1)),this.m_left_body=cc.Sprite.create(RES_CDN_DEFULT+"card_script_body/10000.png"),this.m_left_body.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_left_body.setPosition(.5*ccWidth(this.m_left_body)*(1.4*this.m_use_Add_Scale),0),this.m_left_body.setScale(1.4*this.m_use_Add_Scale),this.m_left_body.setVisible(!1),this.m_script_body_layer.addChild(this.m_left_body,3),this.m_middle_body=cc.Sprite.create(RES_CDN_DEFULT+"card_script_body/10000.png"),this.m_middle_body.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_middle_body.setPosition(.5*winSize.width,0),this.m_middle_body.setScale(1.4*this.m_use_Add_Scale),this.m_middle_body.setVisible(!1),this.m_script_body_layer.addChild(this.m_middle_body,4),this.m_right_body=cc.Sprite.create(RES_CDN_DEFULT+"card_script_body/10000.png"),this.m_right_body.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_right_body.setPosition(winSize.width-.5*ccWidth(this.m_right_body)*(1.4*this.m_use_Add_Scale),0),this.m_right_body.setScale(1.4*this.m_use_Add_Scale),this.m_right_body.setVisible(!1),this.m_script_body_layer.addChild(this.m_right_body,5),this.m_front_particle=null,""!=cg.front_effect&&0==USE_SP_LOVE_CONTENT_PARTICLE&&(this.m_front_particle=new cc.ParticleSystem(RES_CDN_DEFULT+"env_effect/"+cg.front_effect+".plist"),this.m_front_particle.setPosition(cc.p(winSize.width*cg.front_effect_x,winSize.height*cg.front_effect_y)),this.m_front_particle.resetSystem(),this.m_front_particle.setVisible(!1),this.m_script_body_layer.addChild(this.m_front_particle,5)),this.m_blink_layer=new cc.LayerColor(cc.color.WHITE),this.m_blink_layer.setOpacity(0),this.m_blink_layer.ignoreAnchorPointForPosition(!1),this.m_blink_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_blink_layer.setPosition(ccCenter(winSize)),this.addChild(this.m_blink_layer),this.m_left_mask=new cc.LayerColor(cc.color.BLACK),this.m_left_mask.ignoreAnchorPointForPosition(!1),this.m_left_mask.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_left_mask.setPosition(ZERO()),this.m_left_mask.setContentSize(.5*(winSize.width-HSCNE_SCREEN_WIDTH),winSize.height),this.addChild(this.m_left_mask),this.m_left_mask.setVisible(!1),this.m_right_mask=new cc.LayerColor(cc.color.BLACK),this.m_right_mask.ignoreAnchorPointForPosition(!1),this.m_right_mask.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_right_mask.setPosition(winSize.width,0),this.m_right_mask.setContentSize(.5*(winSize.width-HSCNE_SCREEN_WIDTH),winSize.height),this.addChild(this.m_right_mask),this.m_right_mask.setVisible(!1),this.m_blink_layer=new cc.LayerColor(cc.color.WHITE),this.m_blink_layer.setOpacity(0),this.m_blink_layer.ignoreAnchorPointForPosition(!1),this.m_blink_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_blink_layer.setPosition(ccCenter(winSize)),this.addChild(this.m_blink_layer,100),this.m_texture=new cc.RenderTexture(winSize.width,winSize.height),this.m_texture.retain(),winSize=cg=null},createMosaicStencil:function(){var winSize=ccSize(this),cg=MasterTable.getInstance().get_LoveCgByGnrlId(this.m_gnrl_id);if(this.m_cliper=new cc.ClippingNode,this.m_cliper.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_cliper.setAlphaThreshold(1),this.m_cliper.setPosition(ZERO()),this.m_script_body_layer.addChild(this.m_cliper,6),this.m_cliper_2=new cc.ClippingNode,this.m_cliper_2.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_cliper_2.setAlphaThreshold(1),this.m_cliper_2.setPosition(ZERO()),this.m_script_body_layer.addChild(this.m_cliper_2,7),USE_POLYGON_MOSAIC){var boundingBox=this.m_skeleton.getAttachment("mosaicbox","mosaicbox");if(null!=boundingBox&&null!=boundingBox){var poly=[cc.p(100-winSize.width,100),cc.p(150-winSize.width,110),cc.p(160-winSize.width,170),cc.p(100-winSize.width,190),cc.p(50-winSize.width,150)];this.m_polygon_stencil=new cc.DrawNode,this.m_polygon_stencil.clear(),this.m_polygon_stencil.drawPoly(poly,cc.color.BLACK,0,cc.color.BLACK),this.m_cliper.setStencil(this.m_polygon_stencil)}else this.m_stencil=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box.png",cc.rect(10,10,10,10)),this.m_stencil.setAnchorPoint(ANCHOR_MIDDLE()),this.m_stencil.setPreferredSize(cc.size(cg.mosaic_w*this.mosaicSize,cg.mosaic_h*this.mosaicSize)),this.m_stencil.setPosition(-winSize.width,0),this.m_cliper.setStencil(this.m_stencil);var boundingBox2=this.m_skeleton.getAttachment("mosaicbox2","mosaicbox2");if(null!=boundingBox2&&null!=boundingBox2){var poly2=[cc.p(100-winSize.width,100),cc.p(150-winSize.width,110),cc.p(160-winSize.width,170),cc.p(100-winSize.width,190),cc.p(50-winSize.width,150)];this.m_polygon_stencil_2=new cc.DrawNode,this.m_polygon_stencil_2.clear(),this.m_polygon_stencil_2.drawPoly(poly2,cc.color.BLACK,0,cc.color.BLACK),this.m_cliper_2.setStencil(this.m_polygon_stencil_2)}}else this.m_stencil=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box.png",cc.rect(10,10,10,10)),this.m_stencil.setAnchorPoint(ANCHOR_MIDDLE()),this.m_stencil.setPreferredSize(cc.size(cg.mosaic_w*this.mosaicSize,cg.mosaic_h*this.mosaicSize)),this.m_stencil.setPosition(-winSize.width,0),this.m_cliper.setStencil(this.m_stencil);this.m_mosaic=cc.Sprite.create(),this.m_mosaic.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_mosaic.setPosition(ZERO()),this.m_cliper.addChild(this.m_mosaic),BattleShaderCache.getInstance().openShader(this.m_mosaic,SHADER_MOSAIC_V2_FSH,SHADER_HSCENE_VSH),this.shader=this.m_mosaic.getShaderProgram();var program=this.shader.getProgram(),f=new Float32Array(2);f[0]=winSize.width,f[1]=winSize.height;var u_resolution=gl.getUniformLocation(program,"u_resolution");this.shader.setUniformLocationWith2fv(u_resolution,f);var u_cell_size=gl.getUniformLocation(program,"u_cell_size");if(this.shader.setUniformLocationWith1f(u_cell_size,MOSAIC_CELL_SIZE),this.shader.updateUniforms(),u_cell_size=program=u_resolution=f=null,null!=this.m_polygon_stencil_2&&null!=this.m_polygon_stencil_2){this.m_mosaic_2=cc.Sprite.create(),this.m_mosaic_2.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_mosaic_2.setPosition(ZERO()),this.m_cliper_2.addChild(this.m_mosaic_2),BattleShaderCache.getInstance().openShader(this.m_mosaic_2,SHADER_MOSAIC_V2_FSH,SHADER_HSCENE_VSH),this.shader2=this.m_mosaic_2.getShaderProgram();var program2=this.shader2.getProgram(),f2=new Float32Array(2);f2[0]=winSize.width,f2[1]=winSize.height;var u_resolution2=gl.getUniformLocation(program2,"u_resolution");this.shader2.setUniformLocationWith2fv(u_resolution2,f2);var u_cell_size2=gl.getUniformLocation(program2,"u_cell_size");this.shader2.setUniformLocationWith1f(u_cell_size2,MOSAIC_CELL_SIZE),this.shader2.updateUniforms(),u_cell_size2=program2=u_resolution2=f2=null}},showSideMask:function(is_show){this.m_left_mask.setVisible(is_show),this.m_right_mask.setVisible(is_show)},createWatchLayout:function(){var winSize=ccSize(this);this.m_loop_ui_container=new cc.Node,this.m_loop_ui_container.setPosition(winSize.width-10,winSize.height-10),this.addChild(this.m_loop_ui_container),this.m_loop_ui_container.setVisible(!1);var offset_y=0,normal=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_option_off.png",selected=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_option_on.png";this.m_optionWatch=new ccui.Button,this.m_optionWatch.loadTextures(normal,selected),this.m_optionWatch.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_optionWatch.setPosition(0,offset_y),this.m_loop_ui_container.addChild(this.m_optionWatch),this.m_optionWatch.addClickEventListener(function(sender){this.openOption()}.bind(this)),offset_y-=68;normal=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_menu_off.png",selected=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_menu_on.png";if(this.m_skipWatch=new ccui.Button,this.m_skipWatch.loadTextures(normal,selected),this.m_skipWatch.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_skipWatch.setPosition(0,offset_y),this.m_loop_ui_container.addChild(this.m_skipWatch),this.m_skipWatch.addClickEventListener(function(sender){this.showSkipCheck()}.bind(this)),offset_y-=68,0==USE_HSCENE_WATCH_MODE){normal=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_fast_off.png",selected=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_fast_on.png";this.m_speed_2x_start_Watch=new ccui.Button,this.m_speed_2x_start_Watch.loadTextures(normal,selected),this.m_speed_2x_start_Watch.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_speed_2x_start_Watch.setPosition(0,offset_y),this.m_loop_ui_container.addChild(this.m_speed_2x_start_Watch),this.m_speed_2x_start_Watch.addClickEventListener(function(sender){this.speed2XChange()}.bind(this)),this.m_2x_speed_btns.push(this.m_speed_2x_start_Watch);normal=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_fast_none.png",selected=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_fast_on.png";this.m_speed_2x_stop_Watch=new ccui.Button,this.m_speed_2x_stop_Watch.loadTextures(normal,selected),this.m_speed_2x_stop_Watch.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_speed_2x_stop_Watch.setPosition(0,offset_y),this.m_speed_2x_stop_Watch.setVisible(!1),this.m_loop_ui_container.addChild(this.m_speed_2x_stop_Watch),this.m_speed_2x_stop_Watch.addClickEventListener(function(sender){this.speed2XChange()}.bind(this)),this.m_2x_speed_btns.push(this.m_speed_2x_stop_Watch),this.m_2x_effect=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/auto.json",RES_CDN_DEFULT+"effect/auto.atlas",1),this.m_2x_effect.setAnchorPoint(ANCHOR_MIDDLE()),this.m_2x_effect.setPosition(-29,offset_y-29),this.m_2x_effect.setVisible(!1),this.m_2x_effect.setAnimation(0,"fx_1",!0),this.m_loop_ui_container.addChild(this.m_2x_effect,100),offset_y-=68}normal=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_finish_off.png",selected=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_finish_on.png";if(this.m_finish_btn=new ccui.Button,this.m_finish_btn.loadTextures(normal,selected),this.m_finish_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_finish_btn.setPosition(0,offset_y),this.m_loop_ui_container.addChild(this.m_finish_btn),this.m_finish_btn.addClickEventListener(function(sender){this.watchFinish()}.bind(this)),USE_HSCENE_WATCH_MODE?offset_y-=150:offset_y-=68,USE_HSCENE_WATCH_MODE){offset_y=-(winSize.height-10),offset_y+=95;var off=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_page_left_off.png",on=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_page_left_on.png",none=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_page_left_none.png";this.m_left_arrow_btn=new ccui.Button,this.m_left_arrow_btn.loadTextures(off,on,none),this.m_left_arrow_btn.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_left_arrow_btn.setPosition(20-winSize.width,offset_y),this.m_loop_ui_container.addChild(this.m_left_arrow_btn),this.m_left_arrow_btn.addClickEventListener(function(sender){this.watchModeLeft()}.bind(this));off=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_page_right_off.png",on=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_page_right_on.png",none=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_page_right_none.png";this.m_right_arrow_btn=new ccui.Button,this.m_right_arrow_btn.loadTextures(off,on,none),this.m_right_arrow_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_right_arrow_btn.setPosition(0,offset_y),this.m_loop_ui_container.addChild(this.m_right_arrow_btn),this.m_right_arrow_btn.addClickEventListener(function(sender){this.watchModeRight()}.bind(this)),offset_y+=40,this.m_watch_mode_counting=cmLabel.getLabel(cmString("%d/%d",this.m_love_watch_mode_index+1,this.m_love_watch_mode_list.length),LABEL_FONT_INDEX.FONT_261),this.m_watch_mode_counting.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_watch_mode_counting.setPosition(-10,offset_y),this.m_loop_ui_container.addChild(this.m_watch_mode_counting)}winSize=null},createCommonLayout:function(){var winSize=ccSize(this),boxSize=cc.size(winSize.width,212);this.m_bg_frame=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_script.png",cc.Rect(40,40,44,40)),this.m_bg_frame.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bg_frame.setPreferredSize(boxSize),this.m_bg_frame.setPosition(.5*winSize.width,0),this.addChild(this.m_bg_frame),this.m_bg_script_name=new cc.Node,this.m_bg_script_name.setAnchorPoint(ZERO()),this.m_bg_script_name.setPosition(77,154),this.m_bg_script_name.setVisible(!1),this.m_bg_frame.addChild(this.m_bg_script_name);var ic_mark=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_txtmark.png");if(ic_mark.setAnchorPoint(ZERO()),ic_mark.setPosition(0,4),this.m_bg_script_name.addChild(ic_mark),this.m_name_label=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_2871,!1,!0,2,cc.color(0,0,0)),this.m_name_label.setAnchorPoint(ZERO()),this.m_name_label.setPosition(ccWidth(ic_mark)+7,-9),this.m_bg_script_name.addChild(this.m_name_label),this.m_label=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_2471,!1,!0,2,cc.color(0,0,0)),this.m_label.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_label.setPosition(98,ccHeight(this.m_bg_frame)-72),this.m_label.setTextAreaSize(cc.size(boxSize.width-200,120)),this.m_label.ignoreContentAdaptWithSize(!1),this.m_label.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_label.setTextHorizontalAlignment(cc.TEXT_ALIGNMENT_LEFT),this.m_bg_frame.addChild(this.m_label),this.m_finger=cc.Sprite.create(),IS_SP_BROWSER?(this.m_finger.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_finger.setPosition(winSize.width,10)):(this.m_finger.setAnchorPoint(ANCHOR_MIDDLE()),this.m_finger.setPosition(winSize.width-58,55)),this.addChild(this.m_finger),NOT_USE_SP_BATTLE_ANIMATION){this.m_finger.setScale(2),this.m_finger.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/img_script_dialog_01.png");var scaleTo_1=new cc.ScaleTo(.2,2.03,2.03),scaleTo_2=new cc.ScaleTo(.2,1.97,1.97),sequence=new cc.Sequence(scaleTo_1,scaleTo_2);repeat=new cc.RepeatForever(sequence);this.m_finger.runAction(repeat),repeat=sequence=scaleTo_2=scaleTo_1=null}else{var animate=BattleAni._getInstance().getAnimate(BattleAni_.EffectFinger),repeat=animate.repeatForever();this.m_finger.runAction(repeat),repeat=animate=null}repeat=animate=null,this.m_touch_button_Common=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(1,1,1,1))),this.m_touch_button_Common.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_touch_button_Common.setPreferredSize(cc.size(winSize.width,winSize.height)),this.m_touch_button_Common.setPosition(ZERO()),this.addChild(this.m_touch_button_Common),this.m_touch_button_Common.addTargetWithActionForControlEvents(this,this.onTouchTalkBox,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),this.m_event_touch=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE}),this.m_event_touch.onTouchBegan=this.onTouchTalkBox.bind(this),cc.eventManager.addListener(this.m_event_touch,this),this.m_auto_icon=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_story_auto.png"),this.m_auto_icon.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_auto_icon.setPosition(10,620),this.m_auto_icon.setVisible(!1),this.addChild(this.m_auto_icon),this.m_ff_icon=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_story_fast.png"),this.m_ff_icon.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_ff_icon.setPosition(0,640),this.m_ff_icon.setVisible(!1),this.addChild(this.m_ff_icon);var normal=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_look_off.png",selected=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_look_on.png";this.m_show_btn=new ccui.Button,this.m_show_btn.loadTextures(normal,selected),this.m_show_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_show_btn.setPosition(winSize.width-10,630),this.m_show_btn.setVisible(!1),this.addChild(this.m_show_btn),this.m_show_btn.addClickEventListener(function(sender){this.showScript(!0)}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_show_btn.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),this.m_btn_container=new cc.Node,this.m_btn_container.setPosition(winSize.width-10,winSize.height-10),this.m_btn_container.setVisible(!1),this.addChild(this.m_btn_container);var offset_y=0;normal=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_option_off.png",selected=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_option_on.png";this.m_option_Common=new ccui.Button,this.m_option_Common.loadTextures(normal,selected),this.m_option_Common.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_option_Common.setPosition(0,offset_y),this.m_btn_container.addChild(this.m_option_Common),this.m_option_Common.addClickEventListener(function(sender){this.openOption()}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_option_Common.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),offset_y-=68;normal=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_hide_off.png",selected=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_hide_on.png";this.m_hide_Common=new ccui.Button,this.m_hide_Common.loadTextures(normal,selected),this.m_hide_Common.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_hide_Common.setPosition(0,offset_y),this.m_btn_container.addChild(this.m_hide_Common),this.m_hide_Common.addClickEventListener(function(sender){this.setStatus(STATUS_LOVE_CG.NONE),this.showScript(!1)}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_hide_Common.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),offset_y-=68;normal=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_log_off.png",selected=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_log_on.png";this.m_log_Common=new ccui.Button,this.m_log_Common.loadTextures(normal,selected),this.m_log_Common.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_log_Common.setPosition(0,offset_y),this.m_btn_container.addChild(this.m_log_Common),this.m_log_Common.addClickEventListener(function(sender){this.setStatus(STATUS_LOVE_CG.NONE),this.showScriptLog(!0)}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_log_Common.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),offset_y-=68;normal=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_auto_off.png",selected=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_auto_on.png";this.m_auto_start_Common=new ccui.Button,this.m_auto_start_Common.loadTextures(normal,selected),this.m_auto_start_Common.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_auto_start_Common.setPosition(0,offset_y),this.m_btn_container.addChild(this.m_auto_start_Common),this.m_auto_start_Common.addClickEventListener(function(sender){this.setAutoForward(STATUS_LOVE_CG.AUTO_FORWARD)}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_auto_start_Common.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),this.m_auto_forward_btns.push(this.m_auto_start_Common);normal=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_auto_none.png",selected=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_auto_on.png";this.m_auto_stop_Common=new ccui.Button,this.m_auto_stop_Common.loadTextures(normal,selected),this.m_auto_stop_Common.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_auto_stop_Common.setPosition(0,offset_y),this.m_auto_stop_Common.setVisible(!1),this.m_btn_container.addChild(this.m_auto_stop_Common),this.m_auto_stop_Common.addClickEventListener(function(sender){this.setAutoForward(STATUS_LOVE_CG.NONE)}.bind(this)),this.m_auto_forward_btns.push(this.m_auto_stop_Common),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_auto_stop_Common.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),this.m_auto_effect=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/auto.json",RES_CDN_DEFULT+"effect/auto.atlas",1),this.m_auto_effect.setAnchorPoint(ANCHOR_MIDDLE()),this.m_auto_effect.setPosition(-29,offset_y-29),this.m_btn_container.addChild(this.m_auto_effect,100),this.m_auto_effect.setVisible(!1),this.m_auto_effect.setAnimation(0,"fx_1",!0),offset_y-=68;normal=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_fast_off.png",selected=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_fast_on.png";this.m_ff_start_Common=new ccui.Button,this.m_ff_start_Common.loadTextures(normal,selected),this.m_ff_start_Common.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_ff_start_Common.setPosition(0,offset_y),this.m_btn_container.addChild(this.m_ff_start_Common),this.m_ff_start_Common.addClickEventListener(function(sender){this.setFastForward(STATUS_LOVE_CG.FAST_FORWARD)}.bind(this)),this.m_fast_forward_btns.push(this.m_ff_start_Common),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_ff_start_Common.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS);normal=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_fast_none.png",selected=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_fast_on.png";this.m_ff_stop_Common=new ccui.Button,this.m_ff_stop_Common.loadTextures(normal,selected),this.m_ff_stop_Common.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_ff_stop_Common.setPosition(0,offset_y),this.m_ff_stop_Common.setVisible(!1),this.m_btn_container.addChild(this.m_ff_stop_Common),this.m_ff_stop_Common.addClickEventListener(function(sender){this.setFastForward(STATUS_LOVE_CG.NONE)}.bind(this)),this.m_fast_forward_btns.push(this.m_ff_stop_Common),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_ff_stop_Common.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),this.m_ff_effect=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/auto.json",RES_CDN_DEFULT+"effect/auto.atlas",1),this.m_ff_effect.setAnchorPoint(ANCHOR_MIDDLE()),this.m_ff_effect.setPosition(-29,offset_y-29),this.m_ff_effect.setVisible(!1),this.m_ff_effect.setAnimation(0,"fx_1",!0),this.m_btn_container.addChild(this.m_ff_effect,100),offset_y-=68;normal=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_menu_off.png",selected=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_menu_on.png";this.m_skip_Common=new ccui.Button,this.m_skip_Common.loadTextures(normal,selected),this.m_skip_Common.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_skip_Common.setPosition(0,offset_y),this.m_btn_container.addChild(this.m_skip_Common),this.m_skip_Common.addClickEventListener(function(sender){this.setFastForward(STATUS_LOVE_CG.NONE);var tuto=TutorialContextV2.getInstance();if(tuto.IsCompleteAllTutorial())this.sceneEnd();else{var step=tuto.getCurrentTutorialStep();if(step.tutorial_page==TUTORIAL_PAGE_4_LOVE_CG)step.action_type==TutorialAction.Ready?MainObserver.getInstance().postNotification(NOTIFICATION_TUTORIAL,message_complete_tutorial):this.sceneEnd();else this.sceneEnd()}}.bind(this)),this.m_skip_Common.setTutorialTag(TUTORIAL_TAG_PAGE_4_LOVE_EVENT_SKIP),offset_y-=68;var dialog_type,cg=MasterTable.getInstance().get_LoveCgByGnrlId(this.m_gnrl_id);if(USE_HSCENE_WATCH_MODE&&"y"==cg.animation_yn){var off=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_skip_off.png",on=RES_CDN_DEFULT+"new_common/btn/ori/btn_story_skip_on.png";this.m_script_skip_and_phase_btn=new ccui.Button,this.m_script_skip_and_phase_btn.loadTextures(off,on),this.m_script_skip_and_phase_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_script_skip_and_phase_btn.setPosition(0,offset_y),this.m_btn_container.addChild(this.m_script_skip_and_phase_btn),this.m_script_skip_and_phase_btn.addClickEventListener(function(sender){this.skipScriptAndShowPhase()}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_script_skip_and_phase_btn.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS)}(boxSize=winSize=null,USE_UI_3RD_OPTION)&&(GameDefault.getInstance().getUserScriptView().done(function(data){dialog_type=data}.bind(this)),this.m_dialog_type=dialog_type,cc.log("%%%% dialog_type = ",this.m_dialog_type))},startLoveContentsAnimationScript:function(){if(!this.m_is_complete){if(this.m_script_index<this.m_animation_script_list.length){var script=this.m_animation_script_list[this.m_script_index];if(this.m_status==STATUS_LOVE_CG.FAST_FORWARD&&"finish"==script.animation&&this.setStatus(STATUS_LOVE_CG.NONE),"0"!=script.bg_img){if(this.m_script_bg.setVisible(!0),this.last_script_bg!=script.bg_img){var body_img=RES_CDN_DEFULT+"card_script_bg/"+script.bg_img+".jpg";this.m_script_bg.setTexture(body_img),this.last_script_bg=script.bg_img}}else this.m_script_bg.setVisible(!1);if("0"==script.l_filename||""==script.l_filename)this.m_left_body.setVisible(!1);else{if(this.m_left_body.setVisible(!0),this.m_last_left_body!=script.l_filename){body_img=RES_CDN_DEFULT+"card_script_body/"+script.l_filename+".png";this.m_left_body.setTexture(body_img),this.m_last_left_body=script.l_filename}0==script.body_onoff||2==script.body_onoff||3==script.body_onoff?this.m_left_body.setColor(cc.color.GRAY):1!=script.body_onoff&&4!=script.body_onoff||this.m_left_body.setColor(cc.color.WHITE),0!=script.l_reverse?this.m_left_body.setFlippedX(!0):this.m_left_body.setFlippedX(!1)}if("0"==script.m_filename||""==script.m_filename)this.m_middle_body.setVisible(!1);else{if(this.m_middle_body.setVisible(!0),this.m_last_middle_body!=script.m_filename){body_img=RES_CDN_DEFULT+"card_script_body/"+script.m_filename+".png";this.m_middle_body.setTexture(body_img),this.m_last_middle_body=script.m_filename}0==script.body_onoff||1==script.body_onoff||2==script.body_onoff?this.m_middle_body.setColor(cc.color.GRAY):3!=script.body_onoff&&4!=script.body_onoff||this.m_middle_body.setColor(cc.color.WHITE)}if("0"==script.r_filename||""==script.r_filename)this.m_right_body.setVisible(!1);else{if(this.m_right_body.setVisible(!0),this.m_last_right_body!=script.r_filename){body_img=RES_CDN_DEFULT+"card_script_body/"+script.r_filename+".png";this.m_right_body.setTexture(body_img),this.m_last_right_body=script.r_filename}0==script.body_onoff||1==script.body_onoff||3==script.body_onoff?this.m_right_body.setColor(cc.color.GRAY):2!=script.body_onoff&&4!=script.body_onoff||this.m_right_body.setColor(cc.color.WHITE),0!=script.r_reverse?this.m_right_body.setFlippedX(!0):this.m_right_body.setFlippedX(!1)}if("0"==script.name||""==script.name?(this.m_name_label.setString(""),this.m_bg_script_name.setVisible(!1),USE_UI_3RD_OPTION&&(this.m_bg_frame.setVisible(!0),this.m_finger.setVisible(!0))):"1"==script.name?(this.m_name_label.setString(this.m_user_info.nickname),this.m_bg_script_name.setVisible(!0),USE_UI_3RD_OPTION&&(this.m_bg_frame.setVisible(!0),this.m_finger.setVisible(!0))):(this.m_name_label.setString(script.name),this.m_bg_script_name.setVisible(!0),USE_UI_3RD_OPTION&&(this.m_dialog_type==DIALOG_TYPE.NORMAL||this.m_dialog_type==DIALOG_TYPE.COMPACT?this.m_bg_frame.setVisible(!0):this.m_dialog_type==DIALOG_TYPE.VOICE&&("0"==script.voice?this.m_bg_frame.setVisible(!0):this.m_bg_frame.setVisible(!1)),this.m_finger.setVisible(!0))),1==script.name_type){var content=script.content.replace("%s",this.m_user_info.nickname);this.m_label.setString(content);var line=SCRIPTCOUNT(content,39);this.m_label.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_label.setTextAreaSize(cc.size(950,22*line+25)),this.m_label.ignoreContentAdaptWithSize(!1)}else{this.m_label.setString(script.content);line=SCRIPTCOUNT(script.content,39);this.m_label.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_label.setTextAreaSize(cc.size(950,22*line+25)),this.m_label.ignoreContentAdaptWithSize(!1)}if(USE_UI_3RD_OPTION&&(this.m_dialog_type==DIALOG_TYPE.NORMAL?(this.m_bg_frame.setPositionY(0),this.m_bg_frame.setOpacity(255)):(2<=line?this.m_bg_frame.setPositionY(-80):this.m_bg_frame.setPositionY(-110),this.m_bg_frame.setOpacity(0))),script.effect_type==EFFECT_TYPE_WHITE_BLINK?this.m_status!=STATUS_LOVE_CG.FAST_FORWARD&&this.screenEmergency(script.effect_value):script.effect_type==EFFECT_TYPE_WHITE_FADEIN?this.m_status!=STATUS_LOVE_CG.FAST_FORWARD&&this.screenFadeIn(script.effect_value):script.effect_type==EFFECT_TYPE_DELAY_TIME?this.m_status!=STATUS_LOVE_CG.FAST_FORWARD&&this.screenWhiteDelay(script.effect_value):script.effect_type==EFFECT_TYPE_WHITE_OUT?(this.m_status,STATUS_LOVE_CG.FAST_FORWARD):script.effect_type,"0"==script.animation||""==script.animation)this.m_skeleton_bg.setVisible(!1),this.m_skeleton.setVisible(!1),this.hideMosaic(),this.showSideMask(!1);else if(this.showSideMask(!0),this.m_skeleton_bg.setVisible(!0),this.m_skeleton.setVisible(!0),USE_HSCENE_WATCH_MODE&&null!=this.m_script_skip_and_phase_btn&&this.m_script_skip_and_phase_btn.setVisible(!1),this.m_last_animation!=script.animation){var cg=MasterTable.getInstance().get_LoveCgByGnrlId(this.m_gnrl_id);if(null!=this.m_stencil&&this.m_stencil.setPreferredSize(cc.size(cg.mosaic_w*this.mosaicSize,cg.mosaic_h*this.mosaicSize)),null!=this.m_env_effect_bg&&this.m_env_effect_bg.setVisible(!0),null!=this.m_back_particle&&this.m_back_particle.setVisible(!0),null!=this.m_front_particle&&this.m_front_particle.setVisible(!0),"finish"==script.animation)this.m_skeleton.setAnimation(0,script.animation,!1),this.setStatus(STATUS_LOVE_CG.NONE);else if("after"==script.animation)this.m_skeleton.setSlotsToSetupPose(),this.m_skeleton.setAnimation(0,script.animation,!0);else{-1!=script.animation.indexOf("between")?this.m_skeleton.setAnimation(0,script.animation,!1):this.m_skeleton.setAnimation(0,script.animation,!0)}this.m_last_animation=script.animation,this.m_is_hide_mosaic&&(this.m_is_hide_mosaic=!1)}if("0"!=script.voice&&this.m_status!=STATUS_LOVE_CG.FAST_FORWARD){var audio=AudioEngine.getInstance();audio.stopEffectsAll(),audio.stopVoiceAll();var path=RES_CDN_SOUND+SND_TYPE+"voice_love/"+script.voice+".mp3";audio.playVoice(path),this.m_script_delta_time=0}if(this.m_current_animation=script,this.m_script_index=this.m_script_index+1,this.m_script_index>=this.m_animation_script_list.length){this.m_script_index=this.m_animation_script_list.length-1,this.m_is_complete=!0,this.m_finger.setVisible(!1);var tuto=TutorialContextV2.getInstance();if(!tuto.IsCompleteAllTutorial()){var step=tuto.getCurrentTutorialStep();if(step.tutorial_page==TUTORIAL_PAGE_4_LOVE_CG)step.action_type==TutorialAction.Ready&&MainObserver.getInstance().postNotification(NOTIFICATION_TUTORIAL,message_complete_tutorial)}}script=null}this.scheduleOnce(this.hideLoadingLayer,.1)}},startLoveContentsScript:function(){if(!this.m_is_complete){if(this.m_script_index<this.m_script_list.length){var script=this.m_script_list[this.m_script_index];if(null!=script.img&&this.last_script_bg!=script.img){var body_img=RES_CDN_DEFULT+"menu_cg/"+script.img+".jpg";this.m_script_bg.setTexture(body_img),this.last_script_bg=script.bg_img}if("0"==script.name?(this.m_name_label.setString(""),this.m_bg_script_name.setVisible(!1),USE_UI_3RD_OPTION&&(this.m_bg_frame.setVisible(!0),this.m_finger.setVisible(!0))):"1"==script.name?(this.m_name_label.setString(this.m_user_info.nickname),this.m_bg_script_name.setVisible(!0),USE_UI_3RD_OPTION&&(this.m_bg_frame.setVisible(!0),this.m_finger.setVisible(!0))):(this.m_name_label.setString(script.name),this.m_bg_script_name.setVisible(!0),USE_UI_3RD_OPTION&&(this.m_dialog_type==DIALOG_TYPE.NORMAL||this.m_dialog_type==DIALOG_TYPE.COMPACT?this.m_bg_frame.setVisible(!0):this.m_dialog_type==DIALOG_TYPE.VOICE&&("0"==script.voice?this.m_bg_frame.setVisible(!0):this.m_bg_frame.setVisible(!1)),this.m_finger.setVisible(!0))),1==script.name_type){var content=script.content.replace("%s",this.m_user_info.nickname);this.m_label.setString(content);var line=SCRIPTCOUNT(content,39);this.m_label.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_label.setTextAreaSize(cc.size(950,22*line+25)),this.m_label.ignoreContentAdaptWithSize(!1)}else{this.m_label.setString(script.content);line=SCRIPTCOUNT(script.content,39);this.m_label.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_label.setTextAreaSize(cc.size(950,22*line+25)),this.m_label.ignoreContentAdaptWithSize(!1)}if(USE_UI_3RD_OPTION&&(this.m_dialog_type==DIALOG_TYPE.NORMAL?(this.m_bg_frame.setPositionY(0),this.m_bg_frame.setOpacity(255)):(2<=line?this.m_bg_frame.setPositionY(-80):this.m_bg_frame.setPositionY(-110),this.m_bg_frame.setOpacity(0))),script.effect_type==EFFECT_TYPE_WHITE_BLINK?this.m_status!=STATUS_LOVE_CG.FAST_FORWARD&&this.screenEmergency(script.effect_value):script.effect_type==EFFECT_TYPE_WHITE_FADEIN?this.m_status!=STATUS_LOVE_CG.FAST_FORWARD&&this.screenFadeIn(script.effect_value):script.effect_type==EFFECT_TYPE_DELAY_TIME?this.m_status!=STATUS_LOVE_CG.FAST_FORWARD&&this.screenWhiteDelay(script.effect_value):script.effect_type==EFFECT_TYPE_WHITE_OUT?(this.m_status,STATUS_LOVE_CG.FAST_FORWARD):script.effect_type,"0"!=script.voice&&this.m_status!=STATUS_LOVE_CG.FAST_FORWARD){var audio=AudioEngine.getInstance();audio.stopEffectsAll(),audio.stopVoiceAll();var path=RES_CDN_SOUND+SND_TYPE+"voice_love/"+script.voice+".mp3";this.m_current_voice_id=audio.playVoice(path)}if(this.m_current_script=script,this.m_script_index=this.m_script_index+1,this.m_script_index>=this.m_script_list.length){this.m_script_index=this.m_script_list.length-1,this.m_is_complete=!0;var tuto=TutorialContextV2.getInstance();if(!tuto.IsCompleteAllTutorial())if(this.step=tuto.getCurrentTutorialStep(),step.tutorial_page==TUTORIAL_PAGE_4_LOVE_CG)step.action_type==TutorialAction.Ready&&MainObserver.getInstance().postNotification(NOTIFICATION_TUTORIAL,message_complete_tutorial)}script=null}this.scheduleOnce(this.hideLoadingLayer,.1)}},touchTalkBoxDelay:function(){this.m_enable_touch=!0},onTouchTalkBox:function(sender,_event){if(0!=this.m_enable_touch_click){if(this.scheduleOnce(function(float){this.m_enable_touch=!0,this.m_enable_touch_click=!0}.bind(this),.5,"touchTalkBoxDelay"),1==this.m_enable_touch){if(this.m_enable_touch_click=!1,this.m_enable_touch=!1,!this.isVisible()||this.m_show_btn.isVisible())return;if(this.m_status!=STATUS_LOVE_CG.NONE)return;if(this.m_loading_modal_layer.is_show())return;if(this.m_box.is_show())return;if(this.m_scene_mode!=SCENE_MODE.NORMAL)return;var tuto=TutorialContextV2.getInstance();if(tuto.IsCompleteAllTutorial())this.m_script_type==SCRIPT_TYPE.ANIMATION?"end"==this.m_current_animation.animation?this.autoLoveContentComplete():"finish"!=this.m_current_animation.animation&&(this.m_is_complete?this.sceneEnd():this.startLoveContentsAnimationScript()):this.m_script_type==SCRIPT_TYPE.SCRIPT&&(this.m_is_complete?this.sceneEnd():this.startLoveContentsScript());else{var step=tuto.getCurrentTutorialStep();if(step.tutorial_page==TUTORIAL_PAGE_4_LOVE_CG)step.action_type==TutorialAction.Ready&&(this.m_script_type==SCRIPT_TYPE.ANIMATION?"end"==this.m_current_animation.animation?this.autoLoveContentComplete():"finish"!=this.m_current_animation.animation&&(this.m_is_complete?this.sceneEnd():this.startLoveContentsAnimationScript()):this.m_script_type==SCRIPT_TYPE.SCRIPT&&(this.startLoveContentsScript(),this.m_is_complete?this.sceneEnd():this.startLoveContentsScript()))}this.m_enable_touch=!1}cc.log("this.m_enalble_touch2 = "+this.m_enable_touch)}},showScript:function(isShow){USE_UI_3RD_OPTION?(GameDefault.getInstance().getUserScriptView().done(function(data){data}.bind(this)),isShow?(this.m_dialog_type==DIALOG_TYPE.NORMAL||this.m_dialog_type==DIALOG_TYPE.COMPACT?this.m_bg_frame.setVisible(!0):this.m_dialog_type==DIALOG_TYPE.VOICE&&this.m_bg_frame.setVisible(!1),this.m_finger.setVisible(!0)):(this.m_bg_frame.setVisible(isShow),this.m_finger.setVisible(isShow))):(this.m_bg_frame.setVisible(isShow),this.m_finger.setVisible(isShow));this.m_btn_container.setVisible(isShow),isShow?this.m_show_btn.setVisible(!1):this.m_show_btn.setVisible(!0)},setAutoForward:function(_status){this.setStatus(_status),this.m_script_delta_time=0,_status==STATUS_LOVE_CG.AUTO_FORWARD?(this.m_auto_forward_btns[0].setVisible(!1),this.m_auto_forward_btns[1].setVisible(!0),this.m_is_complete&&(this.m_script_index--,this.m_script_index=Math.max(this.m_script_index,0)),this.m_script_type==SCRIPT_TYPE.ANIMATION?this.startLoveContentsAnimationScript():this.m_script_type==SCRIPT_TYPE.SCRIPT&&this.startLoveContentsScript()):(this.m_auto_forward_btns[0].setVisible(!0),this.m_auto_forward_btns[1].setVisible(!1))},setFastForward:function(_status){AudioEngine.getInstance().stopVoice(),this.setStatus(_status),this.m_script_delta_time=0,_status==STATUS_LOVE_CG.FAST_FORWARD?(this.m_fast_forward_btns[0].setVisible(!1),this.m_fast_forward_btns[1].setVisible(!0)):(this.m_fast_forward_btns[0].setVisible(!0),this.m_fast_forward_btns[1].setVisible(!1))},autoLoveContentComplete:function(){this.m_script_delta_time=0,this.setStatus(STATUS_LOVE_CG.NONE);var tutorial=TutorialContextV2.getInstance();if(!tutorial.IsCompleteAllTutorial()){var step=tutorial.getCurrentTutorialStep();if(step.tutorial_page==TUTORIAL_PAGE_4_LOVE_CG)step.action_type==TutorialAction.Ready&&MainObserver.getInstance().postNotification(NOTIFICATION_TUTORIAL,message_complete_tutorial)}},sceneEnd:function(){this.m_script_type==SCRIPT_TYPE.ANIMATION?TutorialContextV2.getInstance().IsCompleteAllTutorial()?this.showSkipCheck():(this.m_is_update&&(this.m_is_update=!1,this.unscheduleUpdate()),MainObserver.getInstance().postNotification(sceneStr[scene_LoveContentsCGScene],Contents_Skip)):(this.m_is_update&&(this.m_is_update=!1,this.unscheduleUpdate()),MainObserver.getInstance().postNotification(sceneStr[scene_LoveContentsCGScene],Contents_Skip))},watchSceneEnd:function(){this.m_is_update&&(this.m_is_update=!1,this.unscheduleUpdate()),MainObserver.getInstance().postNotification(sceneStr[scene_LoveContentsCGScene],Contents_Skip)},hideMosaic:function(){if(this.m_is_hide_mosaic=!0,USE_POLYGON_MOSAIC){var winSize=ccSize(this);if(null!=this.m_polygon_stencil){var poly=[cc.p(100-winSize.width,100),cc.p(150-winSize.width,110),cc.p(160-winSize.width,170),cc.p(100-winSize.width,190),cc.p(50-winSize.width,150)];this.m_polygon_stencil.clear(),this.m_polygon_stencil.drawPoly(poly,cc.color.BLACK,0,cc.color.BLACK)}else null!=this.m_stencil&&this.m_stencil.setPosition(-2e3,0);if(null!=this.m_polygon_stencil_2){var poly2=[cc.p(100-winSize.width,100),cc.p(150-winSize.width,110),cc.p(160-winSize.width,170),cc.p(100-winSize.width,190),cc.p(50-winSize.width,150)];this.m_polygon_stencil_2.clear(),this.m_polygon_stencil_2.drawPoly(poly2,cc.color.BLACK,0,cc.color.BLACK)}}else null!=this.m_stencil&&this.m_stencil.setPosition(-2e3,0)},mosaic:function(){if(this.m_is_update&&!this.m_is_hide_mosaic){var size=ccSize(this);if(this.m_texture.begin(),null!=this.m_env_effect_bg&&this.m_env_effect_bg.visit(),this.m_skeleton_bg.visit(),this.m_skeleton.visit(),this.m_texture.end(),null==this.m_mosaic||null==this.m_mosaic)this.m_mosaic=new cc.Sprite(this.m_texture.getSprite().getTexture()),this.m_mosaic.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_mosaic.setFlippedY(!0),this.m_cliper.addChild(this.m_mosaic);else{var frame=this.m_texture.getSprite().getSpriteFrame();this.m_mosaic.setSpriteFrame(frame)}if(this.m_mosaic.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_mosaic.setFlippedY(!0),null!=this.m_mosaic_2){var frame2=this.m_texture.getSprite().getSpriteFrame();this.m_mosaic_2.setSpriteFrame(frame2),this.m_mosaic_2.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_mosaic_2.setFlippedY(!0)}if(USE_POLYGON_MOSAIC){var center=ccCenter(size);if(null!=this.m_polygon_stencil){var bounds=new spine.SkeletonBounds,boundingBox=this.m_skeleton.getAttachment("mosaicbox","mosaicbox");this.m_skeleton.updateWorldTransform(),bounds.update(this.m_skeleton._skeleton,!0);for(var polygon=bounds.getPolygon(boundingBox),p1_vertice_list=[],i=0;i<polygon.length;i++)p1_vertice_list.push_back(polygon[i]);var v_list=[],index=0;for(i=0;i<p1_vertice_list.size();i+=2)x=center.x+p1_vertice_list.at(i),y=center.y+p1_vertice_list.at(i+1),v_list[index]=cc.p(x,y),index++;this.m_polygon_stencil.clear(),this.m_polygon_stencil.drawPoly(v_list,cc.color.BLACK,0,cc.color.BLACK),v_list=null}if(null!=this.m_polygon_stencil_2){bounds=new spine.SkeletonBounds,boundingBox=this.m_skeleton.getAttachment("mosaicbox2","mosaicbox2");this.m_skeleton.updateWorldTransform(),bounds.update(this.m_skeleton._skeleton,!0);for(polygon=bounds.getPolygon(boundingBox),p1_vertice_list=[],i=0;i<polygon.length;i++)p1_vertice_list.push_back(polygon[i]);for(v_list=[],index=0,i=0;i<p1_vertice_list.size();i+=2)x=center.x+p1_vertice_list.at(i),y=center.y+p1_vertice_list.at(i+1),v_list[index]=cc.p(x,y),index++;this.m_polygon_stencil_2.clear(),this.m_polygon_stencil_2.drawPoly(v_list,cc.color.BLACK,0,cc.color.BLACK),v_list=null}}var mosaic=this.m_skeleton.findBone("mosaic");if(null!=mosaic&&null!=this.m_stencil){this.m_stencil.getPreferredSize();var x=.5*size.width+mosaic.x,y=.5*size.height+mosaic.y;this.m_stencil.setPosition(x,y)}}},update:function(dt){if(this.m_scene_mode==SCENE_MODE.NORMAL){if(this.m_status==STATUS_LOVE_CG.NONE){if(this.m_script_type==SCRIPT_TYPE.ANIMATION&&("0"!=this.m_last_animation&&null!=this.m_last_animation?this.mosaic():this.hideMosaic(),"finish"==this.m_current_animation.animation&&"0"!=this.m_current_animation.voice&&(this.m_script_delta_time+=dt,this.m_current_animation.voice_duration<this.m_script_delta_time)))if(this.m_script_delta_time=0,this.m_script_index<this.m_animation_script_list.length){if(this.m_is_complete)return void this.autoLoveContentComplete();this.startLoveContentsAnimationScript()}else this.startLoveContentsAnimationScript();return}if(this.m_script_type==SCRIPT_TYPE.ANIMATION){if("0"!=this.m_last_animation&&null!=this.m_last_animation?this.mosaic():this.hideMosaic(),this.m_script_delta_time+=dt,this.m_status==STATUS_LOVE_CG.FAST_FORWARD){if(this.m_script_delta_time>FAST_FORWARD_TIME)if(this.m_script_delta_time=0,this.m_current_voice_id=0,this.m_script_index<this.m_animation_script_list.length){if(this.m_is_complete)return void this.autoLoveContentComplete();this.startLoveContentsAnimationScript()}else this.startLoveContentsAnimationScript()}else if(this.m_status==STATUS_LOVE_CG.AUTO_FORWARD&&this.m_script_delta_time>AUTO_FORWARD_TIME){if("0"!=this.m_current_animation.voice&&this.m_current_animation.voice_duration>this.m_script_delta_time)return;if(!this.m_is_effect_playing)if(this.m_script_delta_time=0,this.m_current_voice_id=0,this.m_script_index<this.m_animation_script_list.length){if(this.m_is_complete)return void this.autoLoveContentComplete();this.startLoveContentsAnimationScript()}else this.startLoveContentsAnimationScript()}}else if(this.m_script_type==SCRIPT_TYPE.SCRIPT)if(this.m_script_delta_time+=dt,this.m_status==STATUS_LOVE_CG.FAST_FORWARD){if(this.m_script_delta_time>FAST_FORWARD_TIME)if(this.m_script_delta_time=0,this.m_current_voice_id=0,this.m_script_index<this.m_script_list.length){if(this.m_is_complete)return void this.autoLoveContentComplete();this.startLoveContentsScript()}else this.autoLoveContentComplete()}else if(this.m_status==STATUS_LOVE_CG.AUTO_FORWARD&&this.m_script_delta_time>AUTO_FORWARD_TIME){if("0"!=this.m_current_script.voice&&this.m_current_script.voice_duration>this.m_script_delta_time)return;if(!this.m_is_effect_playing)if(this.m_script_delta_time=0,this.m_current_voice_id=0,this.m_script_index<this.m_script_list.size()){if(this.m_is_complete)return void this.autoLoveContentComplete();this.startLoveContentsScript()}else this.autoLoveContentComplete()}}else this.m_scene_mode==SCENE_MODE.WATCH&&(this.m_script_type==SCRIPT_TYPE.ANIMATION?0==this.m_screen_mosaic_visible&&this.mosaic():(this.m_script_type,SCRIPT_TYPE.SCRIPT))},showScriptLog:function(is_show){if(is_show){if(this.m_script_type==SCRIPT_TYPE.ANIMATION){for(var list=[],i=0;i<this.m_animation_script_list.length&&(list.push(this.m_animation_script_list[i]),this.m_is_complete||i!=this.m_script_index-1);i++);this.m_log_box.setContentSize(ccSize(this)),this.m_log_box._contentNode=function(contentsSize,m){var layer=new cc.Layer,log=new LoveContentCGLogLayerV2;return log.setScriptData(list,this.m_script_type),log.setAnchorPoint(ANCHOR_MIDDLE()),log.setPosition(ccCenter(layer)),log.m_tableView.scrollBarEnable(5<log.numberOfCellsInTableView()),layer.addChild(log),layer}.bind(this),this.m_log_box.is_show()&&this.m_log_box.hide(),this.m_log_box.show(),list=null}else if(this.m_script_type==SCRIPT_TYPE.SCRIPT){for(list=[],i=0;i<this.m_script_list.length&&(list.push(this.m_script_list[i]),this.m_is_complete||i!=this.m_script_index-1);i++);this.m_log_box.setContentSize(ccSize(this)),this.m_log_box._contentNode=function(contentsSize,m){var layer=new cc.Layer,log=new LoveContentCGLogLayerV2;return log.setAnchorPoint(ANCHOR_MIDDLE()),log.setScriptData(list,this.m_script_type),log.setPosition(ccCenter(layer)),log.m_tableView.scrollBarEnable(5<log.numberOfCellsInTableView()),layer.addChild(log),layer}.bind(this),this.m_log_box.is_show()&&this.m_log_box.hide(),this.m_log_box.show(),list=null}}else this.m_log_box.is_show()&&this.m_log_box.hide()},setStatus:function(_status){this.m_status!=_status&&(_status==STATUS_LOVE_CG.NONE?(this.m_finger.isVisible()||this.m_finger.setVisible(!0),this.m_ff_icon.setVisible(!1),this.m_auto_icon.setVisible(!1),this.m_fast_forward_btns[0].setVisible(!0),this.m_fast_forward_btns[1].setVisible(!1),this.m_auto_forward_btns[0].setVisible(!0),this.m_auto_forward_btns[1].setVisible(!1),this.m_auto_effect.setVisible(!1),this.m_ff_effect.setVisible(!1)):(this.m_finger.isVisible()&&this.m_finger.setVisible(!1),_status==STATUS_LOVE_CG.FAST_FORWARD?(this.m_ff_icon.setVisible(!0),this.m_auto_icon.setVisible(!1),this.m_auto_forward_btns[0].setVisible(!0),this.m_auto_forward_btns[1].setVisible(!1),this.m_auto_effect.setVisible(!1),this.m_ff_effect.setVisible(!0)):_status==STATUS_LOVE_CG.AUTO_FORWARD&&(this.m_ff_icon.setVisible(!1),this.m_auto_icon.setVisible(!0),this.m_fast_forward_btns[0].setVisible(!0),this.m_fast_forward_btns[1].setVisible(!1),this.m_auto_effect.setVisible(!0),this.m_ff_effect.setVisible(!1))),this.m_status=_status)},screenBlackOut:function(duration){this.m_blink_layer.isRunning()&&(this.m_blink_layer.stopAllActions(),this.m_blink_layer.setVisible(!1)),this.m_blink_layer.setVisible(!0),this.m_blink_layer.setOpacity(0),this.m_blink_layer.setColor(cc.color.BLACK);var f1=new cc.FadeIn(duration),cb=new cc.CallFunc(this.cbScreenBlackOut.bind(this)),seq=new cc.Sequence(f1,cb);this.m_blink_layer.runAction(seq),this.m_is_effect_playing=!0,this.showScript(!1)},cbScreenBlackOut:function(sender){},screenWhiteDelay:function(duration){this.m_blink_layer.isRunning()&&(this.m_blink_layer.stopAllActions(),this.m_blink_layer.setVisible(!1)),this.m_blink_layer.setVisible(!1);var d1=new cc.DelayTime(duration),cb=new cc.CallFunc(this.cbScrrenWhiteDelay.bind(this)),seq=new cc.Sequence(d1,cb);this.m_blink_layer.runAction(seq),this.m_is_effect_playing=!0},cbScrrenWhiteDelay:function(sender){this.m_is_effect_playing=!1;null!=sender&&(sender.setVisible(!1),this.m_status==STATUS_LOVE_CG.AUTO_FORWARD?this.m_script_delta_time=AUTO_FORWARD_TIME:this.m_status==STATUS_LOVE_CG.NONE&&(this.m_script_type==SCRIPT_TYPE.ANIMATION?this.startLoveContentsAnimationScript():this.m_script_type==SCRIPT_TYPE.SCRIPT&&this.startLoveContentsScript()))},screenFadeIn:function(duration){this.m_blink_layer.isRunning()&&(this.m_blink_layer.stopAllActions(),this.m_blink_layer.setVisible(!1)),this.m_blink_layer.setVisible(!0),this.m_blink_layer.setOpacity(255),this.m_blink_layer.setColor(cc.color.WHITE);var delay=cc.delayTime(duration),f1=new cc.FadeOut(.3),cb=new cc.CallFunc(this.cbScreenFadeIn.bind(this)),seq=new cc.Sequence(delay,f1,cb);this.m_blink_layer.runAction(seq),this.m_is_effect_playing=!0,this.showScript(!1),this.m_show_btn.setVisible(!1)},cbScreenFadeIn:function(sender){this.showScript(!0),this.m_is_effect_playing=!1;null!=sender&&(sender.setVisible(!1),this.m_status==STATUS_LOVE_CG.AUTO_FORWARD?this.m_script_delta_time=AUTO_FORWARD_TIME:this.m_status==STATUS_LOVE_CG.NONE&&(this.m_script_type==SCRIPT_TYPE.ANIMATION?this.startLoveContentsAnimationScript():this.m_script_type==SCRIPT_TYPE.SCRIPT&&this.startLoveContentsScript()))},screenEmergency:function(duration){this.m_blink_layer.isRunning()&&(this.m_blink_layer.stopAllActions(),this.m_blink_layer.setVisible(!1)),this.m_blink_layer.setVisible(!0),this.m_blink_layer.setOpacity(0),this.m_blink_layer.setColor(cc.color.WHITE);var f1=new cc.FadeTo(.1,200),f2=new cc.FadeTo(.1,0),f_seq=new cc.Sequence(f1,f2),fTimes=Math.ceil(duration/.2),times=Math.round(fTimes);3<times&&(times=3);var repeat=new cc.Repeat(f_seq,times),cb=new cc.CallFunc(this.cbScreenEmergency.bind(this)),seq=new cc.Sequence(repeat,cb);this.m_blink_layer.runAction(seq),this.m_is_effect_playing=!0,this.showScript(!1)},cbScreenEmergency:function(sender){this.showScript(!0),this.m_is_effect_playing=!1;null!=sender&&(sender.setVisible(!1),this.m_status==STATUS_LOVE_CG.AUTO_FORWARD?this.m_script_delta_time=AUTO_FORWARD_TIME:this.m_status==STATUS_LOVE_CG.NONE&&(this.m_script_type==SCRIPT_TYPE.ANIMATION?this.startLoveContentsAnimationScript():this.m_script_type==SCRIPT_TYPE.SCRIPT&&this.startLoveContentsScript()))},tolowerCase:function(str){return str.toLowerCase()},spAnimationState_getCurrent:function(self,trackIndex){return trackIndex.trackIndex>=self.tracks.length?0:self.tracks[trackIndex.trackIndex]},spineStartListener:function(trackIndex){var entry=this.spAnimationState_getCurrent(this.m_skeleton.getState(),trackIndex);trackIndex>=this.m_skeleton.getCurrent()?entry.timeScale=HSCENE_TIME_SCALE_2X:entry.timeScale=HSCENE_TIME_SCALE_1X},spineEndListener:function(trackIndex){},spineCompleteListener:function(trackIndex,loopCount){var entry=this.spAnimationState_getCurrent(this.m_skeleton.getState(),trackIndex),animationName=entry&&entry.animation?entry.animation.name:0;"finish"==animationName?this.m_scene_mode==SCENE_MODE.WATCH&&this.m_watch_status==WATCH_STATUS.FINISH&&(this.m_is_2x_speed&&this.speed2XChange(),0==USE_HSCENE_WATCH_MODE&&(this.m_2x_speed_btns[0].setVisible(!1),this.m_2x_speed_btns[1].setVisible(!1))):-1!=animationName.indexOf("between")&&this.m_scene_mode==SCENE_MODE.NORMAL&&this.m_script_type==SCRIPT_TYPE.ANIMATION&&this.m_script_index<this.m_animation_script_list.length&&this.startLoveContentsAnimationScript()},spineEventListener:function(trackIndex,evt){this.spAnimationState_getCurrent(this.m_skeleton.getState(),trackIndex);var name=evt.data.name;if("mosaic_size"==this.tolowerCase(name)&&null!=this.m_stencil&&null!=this.m_stencil&&null!=evt.stringValue){var mosaic_size=evt.stringValue.split(",");if(2==mosaic_size.length){var width=mosaic_size[0],height=mosaic_size[1];this.m_stencil.setPreferredSize(cc.size(width*this.mosaicSize,height*this.mosaicSize))}var angle=evt.floatValue;this.m_stencil.setRotation(-angle)}},is_resource_ready:function(){return this.m_script_type==SCRIPT_TYPE.SCRIPT||null!=this.m_skeleton},resourceLoadingStart:function(){this.m_script_type==SCRIPT_TYPE.ANIMATION?this.startLoveContentsAnimationScript():this.m_script_type==SCRIPT_TYPE.SCRIPT&&this.startLoveContentsScript()},resourceLoading:function(dt){if(this.m_resource_list.length<=0&&0==this.m_b_create){MasterManager.getInstance();var cg=MasterTable.getInstance().get_LoveCgByGnrlId(this.m_gnrl_id);0!=cg.bg_type&&this.m_env_effect_bg.setTexture(RES_CDN_DEFULT+"hscene_bg/"+cg.bg_type+".png"),this.m_b_create=!0,this.createCommonLayout(),this.createWatchLayout()}if(this.m_resource_list.length<=0&&this.is_resource_ready()&&0==this.m_loading_modal_layer.m_is_update)return this.scheduleUpdate(),this.m_is_update=!0,this.scheduleOnce(this.resourceLoadingStart,3),void this.unschedule(this.resourceLoading);var winSize=ccSize(this),rd=this.m_resource_list[0];if(null!=rd&&null!=rd){switch(rd._resource_type){case ResourceType.RT_VOICE:var path=rd.path;resourceLoader(path,function(){this.m_resource_list.shift(),path=null}.bind(this));break;case ResourceType.RT_SKELETON2:this.m_resource_list.shift(),(gnrl=[]).push(rd.bone),gnrl.push(rd.atlas),gnrl.push(rd.bg),resourceLoader(gnrl,function(){gnrl=null}.bind(this));break;case ResourceType.RT_SKELETON:this.m_resource_list.shift(),(gnrl=[]).push(rd.bone),gnrl.push(rd.atlas);for(var idx=0;idx<rd.png.length;idx++)gnrl.push(rd.png[idx]);null!=rd.bg&&gnrl.push(rd.bg),resourceLoader(gnrl,function(){var de_bone=this.readJsonSpine(rd.bone);this.m_skeleton_bg=cc.Sprite.create(),this.m_skeleton_bg.setPosition(.5*winSize.width,.5*winSize.height),IS_SP_BROWSER&&this.m_skeleton_bg.setScale(2),this.m_script_body_layer.addChild(this.m_skeleton_bg,0),this.m_skeleton_bg.setVisible(!1),null!=rd.bg&&this.m_skeleton_bg.setTexture(rd.bg),this.m_skeleton=new sp.SkeletonAnimation(de_bone,rd.atlas,.89,!0),this.m_skeleton.setPosition(.5*winSize.width,.5*winSize.height),this.m_skeleton.setEventListener(this.spineEventListener.bind(this)),this.m_skeleton.setEndListener(this.spineEndListener.bind(this)),this.m_skeleton.setCompleteListener(this.spineCompleteListener.bind(this)),this.m_skeleton.setStartListener(this.spineStartListener.bind(this)),this.m_script_body_layer.addChild(this.m_skeleton,2),this.m_skeleton.setVisible(!1);for(var aniCount=this.m_skeleton._skeleton.data.animations.length,ani=this.m_skeleton._skeleton.data.animations,is_exist_loop=!1,i=0;i<aniCount;i++){for(var k=0;k<aniCount;k++)ani[i].name==ani[k].name!=1&&this.m_skeleton.setMix(ani[i].name,ani[k].name,.4);"loop"==ani[i].name==0&&(is_exist_loop=!0)}is_exist_loop&&this.m_skeleton.setAnimation(1,"loop",!0),this.createMosaicStencil(),gnrl=de_bone=ani=aniCount=null}.bind(this));break;case ResourceType.RT_IMAGE:var gnrl;(gnrl=[]).push(rd.png),resourceLoader(gnrl,function(){this.m_resource_list.shift(),gnrl=null}.bind(this));break;case ResourceType.RT_TEXTURE:this.m_resource_list.shift()}this.m_loading_modal_layer.is_show()&&this.m_loading_modal_layer.addCompleteLoadedResource()}else this.m_loading_modal_layer.is_show()&&this.m_loading_modal_layer.addCompleteLoadedResource()},showLoadingLayer:function(){this.m_loading_modal_layer.is_show()||this.m_loading_modal_layer.show()},hideLoadingLayer:function(){this.m_loading_modal_layer.is_show()&&this.m_loading_modal_layer.hide();var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/BGM_love_loop.mp3";audio.m_bgmPath!=path&&(audio.stopBackgroundMusic(),audio.playBackgroundMusic(path,!0)),this.m_btn_container.setVisible(!0)},setSceneMode:function(_mode){if(this.m_script_type==SCRIPT_TYPE.ANIMATION){this.m_scene_mode==SCENE_MODE.NORMAL&&(this.m_screen_mosaic_visible=!0),this.m_scene_mode=_mode,this.m_scene_mode==SCENE_MODE.WATCH&&(this.m_watch_status=WATCH_STATUS.PHASE);var audio=AudioEngine.getInstance();audio.stopEffectsAll(),audio.releaseResourceEffects(),this.screenChangeMode(MODE_CHNAGE_TIME)}},screenChangeMode:function(duration){this.m_blink_layer.isRunning()&&(this.m_blink_layer.stopAllActions(),this.m_blink_layer.setVisible(!1)),this.m_blink_layer.setVisible(!0),this.m_blink_layer.setOpacity(0),this.m_blink_layer.setColor(cc.color.WHITE);var f1=new cc.FadeIn(duration),cb=new cc.CallFunc(this.cbScreenChangeMode.bind(this)),seq=new cc.Sequence(f1,cb);this.m_blink_layer.runAction(seq)},cbScreenChangeMode:function(){this.m_screen_mosaic_visible=!1,this.m_blink_layer.isRunning()&&(this.m_blink_layer.stopAllActions(),this.m_blink_layer.setVisible(!1)),this.m_blink_layer.setVisible(!0),this.m_blink_layer.setOpacity(255),this.m_blink_layer.setColor(cc.color.WHITE);var f1=new cc.FadeOut(MODE_CHANGE_CLEAN_TIME);this.m_blink_layer.runAction(f1),this.setStatus(STATUS_LOVE_CG.NONE),this.m_show_btn.setVisible(!1),this.m_btn_container.setVisible(!1),this.m_bg_frame.setVisible(!1),this.m_finger.setVisible(!1),this.m_loop_ui_container.setVisible(!0),this.m_script_bg.setVisible(!1),this.m_left_body.setVisible(!1),this.m_middle_body.setVisible(!1),this.m_right_body.setVisible(!1),this.m_left_mask.setVisible(!0),this.m_right_mask.setVisible(!0),null!=this.m_env_effect_bg&&this.m_env_effect_bg.setVisible(!0),null!=this.m_back_particle&&this.m_back_particle.setVisible(!0),null!=this.m_front_particle&&this.m_front_particle.setVisible(!0),this.watchPhase()},showSkipCheck:function(){this.m_box.is_show()&&this.m_box.hide(!1);var gnrl=MasterManager.getInstance().get_General(this.m_gnrl_id);this.m_box.setTitle(""),453!=gnrl.gnrl_group?(this.m_box.setText(""),this.m_box.setText("\n"),this.m_box.setText(""),this.m_box.setText("\n"),this.m_box.setText("")):(this.m_box.setText(""),this.m_box.setText("\n")),this.m_box.addButtonInfo(new MessageButtonInfo("",MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo("",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_LoveContentsCGScene],Contents_Skip)},0,"hscene_skip"),this.m_box.hide(!1)}.bind(this))),453!=gnrl.gnrl_group&&this.m_box.addButtonInfo(new MessageButtonInfo("",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.setSceneMode(SCENE_MODE.WATCH),this.m_box.hide(!1)}.bind(this))),this.m_box.show()},speed2XChange:function(){this.m_is_2x_speed=!this.m_is_2x_speed,0==USE_HSCENE_WATCH_MODE&&(this.m_2x_speed_btns[0].setVisible(!this.m_is_2x_speed),this.m_2x_speed_btns[1].setVisible(this.m_is_2x_speed)),this.m_ff_icon.setVisible(this.m_is_2x_speed),this.m_2x_effect.setVisible(this.m_is_2x_speed);var entry=this.m_skeleton.getState().tracks[0];this.m_is_2x_speed?entry.timeScale=HSCENE_TIME_SCALE_2X:entry.timeScale=HSCENE_TIME_SCALE_1X,this.m_watch_status==WATCH_STATUS.PHASE&&this.playVoicePhase()},playVoicePhase:function(){var voice=this.getMoaningVoice();if(""!=voice){var audio=AudioEngine.getInstance();audio.stopEffectsAll(),audio.stopVoiceAll(),audio.playVoice(RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice,!0)}},watchPhase:function(){if(this.m_is_hide_mosaic=!1,USE_HSCENE_WATCH_MODE)this.m_love_watch_mode_index=0,this.m_skeleton_bg.setVisible(!0),this.playWatchMode();else{MasterManager.getInstance();var cg=MasterTable.getInstance().get_LoveCgByGnrlId(this.m_gnrl_id);null!=this.m_stencil&&null!=this.m_stencil&&this.m_stencil.setPreferredSize(cc.size(cg.mosaic_w*this.mosaicSize,cg.mosaic_h*this.mosaicSize)),this.m_skeleton_bg.setVisible(!0),this.m_skeleton.setVisible(!0),this.m_skeleton.setAnimation(0,cg.watch_mode_animation,!0),this.scheduleOnce(function(float){this.playVoicePhase()}.bind(this),.5,"play_voice_phase")}this.m_finish_btn.setVisible(!0),0==USE_HSCENE_WATCH_MODE?(this.m_2x_speed_btns[0].setVisible(!0),this.m_2x_speed_btns[1].setVisible(!1)):(this.m_watch_mode_counting.setVisible(!0),this.m_left_arrow_btn.setVisible(!0),this.m_right_arrow_btn.setVisible(!0))},watchFinish:function(){if(this.m_watch_status==WATCH_STATUS.PHASE){MasterManager.getInstance();var cg=MasterTable.getInstance().get_LoveCgByGnrlId(this.m_gnrl_id);null!=this.m_stencil&&null!=this.m_stencil&&this.m_stencil.setPreferredSize(cc.size(cg.mosaic_w*this.mosaicSize,cg.mosaic_h*this.mosaicSize)),this.m_skeleton.setAnimation(0,"finish",!1),this.m_skeleton.addAnimation(0,"after",!0);var audio=AudioEngine.getInstance(),voice=this.getFinishVoice();""!=voice?(audio.stopEffectsAll(),audio.stopVoiceAll(),audio.playVoice(RES_CDN_SOUND+SND_TYPE+"voice_love/"+voice,!1)):(audio.stopEffectsAll(),audio.stopVoiceAll()),this.m_watch_status=WATCH_STATUS.FINISH,this.m_finish_btn.setVisible(!1),USE_HSCENE_WATCH_MODE&&(this.m_watch_mode_counting.setVisible(!1),this.m_left_arrow_btn.setVisible(!1),this.m_right_arrow_btn.setVisible(!1))}},openOption:function(){this.m_scene_mode==SCENE_MODE.NORMAL&&this.setStatus(STATUS_LOVE_CG.NONE),MainObserver.getInstance().postNotification(sceneStr[scene_LoveContentsCGScene],NOTIFY_MENU_OPTION)},getFinishVoice:function(){for(var voice="",idx=0;idx<this.m_animation_script_list.length;idx++){var s=this.m_animation_script_list[idx];if("finish"==s.animation&&""!=s.voice&&"0"!=s.voice){voice=s.voice;break}s=null}return""!=voice&&(voice+=".mp3"),voice},getMoaningVoice:function(){var voice="",voice_list=MasterTable.getInstance().get_Voice(this.m_gnrl_id,13,0);return voice=voice_list.voice,voice_list.duration,""!=voice&&(voice+=".mp3"),voice},ORDER_ASC_LOVE_STORY_NUM_ASC:function(l,r){return l.order_number<r.order_number},ORDER_ASC_LOVE_ANIMATION_STORY_NUM_ASC:function(l,r){return l.order_number<r.order_number},skipScriptAndShowPhase:function(){for(var i=this.m_script_index;i<this.m_animation_script_list.length;i++){var s=this.m_animation_script_list.at(i);if(""!=s.animation&&"0"!=s.animation){this.m_script_index=i;break}}this.setFastForward(STATUS_LOVE_CG.NONE),this.startLoveContentsAnimationScript()},watchModeLeft:function(){this.m_love_watch_mode_index--,this.m_love_watch_mode_index<0&&(this.m_love_watch_mode_index=0),this.playWatchMode()},watchModeRight:function(){this.m_love_watch_mode_index++,this.m_love_watch_mode_index>this.m_love_watch_mode_list.size()-1&&(this.m_love_watch_mode_index=this.m_love_watch_mode_list.size()-1),this.playWatchMode()},playWatchMode:function(){var watch=this.m_love_watch_mode_list.at(this.m_love_watch_mode_index);if(this.m_skeleton.setVisible(!0),this.m_skeleton.setAnimation(0,watch.animation,!0),this.scheduleOnce(function(float){this.playVoicePhase()},.5,"play_voice_phase"),this.m_watch_mode_counting.setString(cmString("%d/%d",this.m_love_watch_mode_index+1,this.m_love_watch_mode_list.size())),this.m_love_watch_mode_index<=0?(this.m_left_arrow_btn.setEnabled(!1),this.m_right_arrow_btn.setEnabled(!0)):this.m_love_watch_mode_index>=this.m_love_watch_mode_list.length-1?(this.m_left_arrow_btn.setEnabled(!0),this.m_right_arrow_btn.setEnabled(!1)):(this.m_left_arrow_btn.setEnabled(!0),this.m_right_arrow_btn.setEnabled(!0)),!USE_POLYGON_MOSAIC||null==this.m_polygon_stencil){var cg=MasterTable.getInstance().get_LoveCgByGnrlId(this.m_gnrl_id);null!=this.m_stencil&&this.m_stencil.setPreferredSize(cc.size(cg.mosaic_w,cg.mosaic_h))}},onNotification:function(msg){if(msg==message_update_option&&USE_UI_3RD_OPTION){if(this.m_scene_mode==SCENE_MODE.WATCH)return void cc.log("watch mdoe %d.",this.m_watch_status);var dialog_type;GameDefault.getInstance().getUserScriptView().done(function(data){dialog_type=data}.bind(this)),this.m_dialog_type=dialog_type;var line=SCRIPTCOUNT(this.m_label.getString(),39),name=this.m_name_label.getString();if(this.m_dialog_type==DIALOG_TYPE.NORMAL||this.m_dialog_type==DIALOG_TYPE.COMPACT)this.m_bg_frame.setVisible(!0);else if(this.m_dialog_type==DIALOG_TYPE.VOICE)if(""==name)this.m_bg_frame.setVisible(!0);else{var bHaveVoice=!1;if(this.m_script_type==SCRIPT_TYPE.ANIMATION){"0"!=this.m_animation_script_list[this.m_script_index-1].voice&&(bHaveVoice=!0)}else if(this.m_script_type==SCRIPT_TYPE.SCRIPT){"0"!=this.m_script_list[this.m_script_index-1].voice&&(bHaveVoice=!0)}bHaveVoice?this.m_bg_frame.setVisible(!1):this.m_bg_frame.setVisible(!0)}this.m_dialog_type==DIALOG_TYPE.NORMAL?(this.m_bg_frame.setPositionY(0),this.m_bg_frame.setOpacity(255)):(2<=line?this.m_bg_frame.setPositionY(-80):this.m_bg_frame.setPositionY(-110),this.m_bg_frame.setOpacity(0)),this.m_finger.setVisible(!0)}},readJsonSpine:function(file){var strAtfer=RS_STR_HEX_KEY.split("."),set=String.fromCharCode(52);this.m_enc_load=file,this.m_enc_strng=cc.loader.getRes(file);var ori=this.decrypt_love(this.m_enc_strng,strAtfer[4]+set);try{return ori}finally{set=ori=null}},decrypt_love:function(input,password){for(var inChar,inValue,outValue,cryptTable=RS_CRY_HEX_KEY,cryptLength=new Number(cryptTable.length-1),escape=!1,output="",arNumberPw=new Array,pwLength=password.length,inLength=input.length,pwIndex=0;pwIndex<pwLength;pwIndex++)arNumberPw[pwIndex]=cryptTable.indexOf(password.charAt(pwIndex));var inIndex=0;for(pwIndex=0;inIndex<inLength;inIndex++,pwIndex++)pwLength<=pwIndex&&(pwIndex=0),inChar=input.charAt(inIndex),-1==(inValue=cryptTable.indexOf(inChar))?outValue=inChar:escape?(inValue==cryptLength?(outValue=lineFeed,inValue=-1):"'"==inChar?(outValue=doubleQuote,inValue=-1):inValue+=cryptLength,escape=!1):inValue==cryptLength&&(escape=!0,pwIndex--,outValue="",inValue=-1),-1!=inValue&&(outValue=cryptTable.charAt(arNumberPw[pwIndex]^inValue)),output+=outValue;return output}}),AchievementService=function(){var instance;function AchievementService(){}return AchievementService.prototype.loadUserAchievement=function(achv_type){achv_type},AchievementService.prototype.getUserAchievement=function(achv_type){for(var list=[],m_user_achivement=NetService().getUserAchievementList(),keys=m_user_achivement.keys(),keys_length=keys.length,mt=MasterManager.getInstance(),idx=0;idx<keys_length;idx++)if(m_user_achivement.at(keys[idx]).achv_type==achv_type){var user_achv={achv_type:0,achv_id:0,new_yn:0,complete_yn:0,bonus_complete_yn:0,complete_popup_yn:0,complete_count:0,achv_name:"",content:"",bonus_type:0,bonus_count:0,next_achv_id:0,key_id:0,shortcuts_id:0,achv_cmplt_type:0,count:0,complete_name:0};user_achv.achv_type=m_user_achivement.at(keys[idx]).achv_type,user_achv.achv_id=m_user_achivement.at(keys[idx]).achv_id,user_achv.new_yn=m_user_achivement.at(keys[idx]).new_yn,user_achv.complete_yn=m_user_achivement.at(keys[idx]).complete_yn,user_achv.bonus_complete_yn=m_user_achivement.at(keys[idx]).bonus_complete_yn,user_achv.complete_popup_yn=m_user_achivement.at(keys[idx]).complete_popup_yn,user_achv.complete_count=m_user_achivement.at(keys[idx]).complete_count;var achievement=mt.get_Achivement(user_achv.achv_id);user_achv.shortcuts_id=achievement.shortcuts_id;var achv_bonus=mt.get_AchivementCompleteBonus(user_achv.achv_id);user_achv.bonus_type=achv_bonus.bonus_type,user_achv.bonus_count=achv_bonus.bonus_count,user_achv.next_achv_id=achv_bonus.next_achv_id,user_achv.key_id=achv_bonus.key_id;var achv_condition=mt.get_AchivementCompleteCondition(user_achv.achv_id);user_achv.achv_cmplt_type=achv_condition.achv_cmplt_type,user_achv.achv_cmplt_type==AchvCompType_UserLevel?user_achv.count=1:user_achv.achv_cmplt_type==AchvCompType_StoryClear?user_achv.count=1:user_achv.count=achv_condition.count;var achv_cmplt_type=mt.get_AchivementCompleteType(user_achv.achv_cmplt_type);user_achv.complete_name=achv_cmplt_type.name;var bonus_type=mt.get_BonusType(user_achv.bonus_type);if(user_achv.bonus_name=bonus_type.name,user_achv.bonus_type==BONUS_TYPE_NAMING){bonus_type=mt.get_Naming(user_achv.key_id);user_achv.bonus_name=bonus_type.name;var naming_type=mt.get_NamingType(bonus_type.naming_type);user_achv.bonus_name=bonus_type.name+"("+naming_type.name+")"}else{bonus_type=mt.get_BonusType(user_achv.bonus_type);user_achv.bonus_name=bonus_type.name}user_achv.achv_type==ACHIEVEMENT_SEQ||user_achv.achv_type==ACHIEVEMENT_NAMING||user_achv.achv_type==ACHIEVEMENT_EVENTDUNGEON||user_achv.achv_type==ACHIEVEMENT_EVENTDUNGEON_2ND||user_achv.achv_type==ACHIEVEMENT_EVENTDUNGEON_3RD||user_achv.achv_type==ACHIEVEMENT_RAID_BOSS||user_achv.achv_type==ACHIEVEMENT_BEGINNER?user_achv.achv_type==ACHIEVEMENT_BEGINNER&&0==user_achv.next_achv_id?list.push(user_achv):"n"==user_achv.bonus_complete_yn&&list.push(user_achv):list.push(user_achv)}return list},AchievementService.prototype.getUserAchievementEventDungeon=function(achv_type,event_dungeon_period_idx){var list=[],m_user_achivement=NetService().getUserAchievementList(),keys=m_user_achivement.keys(),keys_length=keys.length,user_achivement=[],idx=0;for(idx=0;idx<keys_length;idx++){var achivement=$.extend({},m_user_achivement.at(keys[idx]));m_user_achivement.at(keys[idx]).achv_type==achv_type&&user_achivement.push(achivement)}var achivement_length=user_achivement.length;for(idx=0;idx<achivement_length;idx++){var user_achv={achv_type:0,achv_id:0,new_yn:0,complete_yn:0,bonus_complete_yn:0,complete_popup_yn:0,complete_count:0,achv_name:"",content:"",bonus_type:0,bonus_count:0,next_achv_id:0,key_id:0,shortcuts_id:0,achv_cmplt_type:0,count:0,complete_name:0};if(MasterManager.getInstance().get_AchivementEventDungeonInfo(user_achivement[idx].achv_id).event_dungeon_period_idx==event_dungeon_period_idx){user_achv.achv_type=user_achivement[idx].achv_type,user_achv.achv_id=user_achivement[idx].achv_id,user_achv.new_yn=user_achivement[idx].new_yn,user_achv.complete_yn=user_achivement[idx].complete_yn,user_achv.bonus_complete_yn=user_achivement[idx].bonus_complete_yn,user_achv.complete_popup_yn=user_achivement[idx].complete_popup_yn,user_achv.complete_count=user_achivement[idx].complete_count;var achievement=MasterManager.getInstance().get_Achivement(user_achv.achv_id);user_achv.shortcuts_id=achievement.shortcuts_id;var achv_bonus=MasterManager.getInstance().get_AchivementCompleteBonus(user_achv.achv_id);user_achv.bonus_type=achv_bonus.bonus_type,user_achv.bonus_count=achv_bonus.bonus_count,user_achv.next_achv_id=achv_bonus.next_achv_id,user_achv.key_id=achv_bonus.key_id;var achv_condition=MasterManager.getInstance().get_AchivementCompleteCondition(user_achv.achv_id);user_achv.achv_cmplt_type=achv_condition.achv_cmplt_type,user_achv.achv_cmplt_type==AchvCompType_UserLevel?user_achv.count=1:user_achv.achv_cmplt_type==AchvCompType_StoryClear?user_achv.count=1:user_achv.count=achv_condition.count;var mt=MasterManager.getInstance(),achv_cmplt_type=MasterManager.getInstance().get_AchivementCompleteType(user_achv.achv_cmplt_type);user_achv.complete_name=achv_cmplt_type.name;var bonus_type=null;if(user_achv.bonus_type==BONUS_TYPE_NAMING){bonus_type=mt.get_Naming(user_achv.key_id),user_achv.bonus_name=bonus_type.name;var naming_type=mt.get_NamingType(bonus_type.naming_type);user_achv.bonus_name="("+naming_type.name+")"}else bonus_type=mt.get_BonusType(user_achv.bonus_type),user_achv.bonus_name=bonus_type.name;user_achv.achv_type==ACHIEVEMENT_SEQ||user_achv.achv_type==ACHIEVEMENT_NAMING||user_achv.achv_type==ACHIEVEMENT_EVENTDUNGEON||user_achv.achv_type==ACHIEVEMENT_EVENTDUNGEON_2ND||user_achv.achv_type==ACHIEVEMENT_EVENTDUNGEON_3RD||user_achv.achv_type==ACHIEVEMENT_RAID_BOSS?"n"==user_achv.bonus_complete_yn&&list.push(user_achv):list.push(user_achv)}}return list},AchievementService.prototype.getUserAchivementInfo=function(achv_id){for(var m_user_achivement=NetService().getUserAchievementList(),keys=m_user_achivement.keys(),keys_length=keys.length,idx=0;idx<keys_length&&m_user_achivement.at(keys[idx]).achv_id!=achv_id;idx++);var achv={achv_type:0,achv_id:0,new_yn:0,complete_yn:0,bonus_complete_yn:0,complete_popup_yn:0,complete_count:0,achv_name:"",content:"",bonus_type:0,bonus_count:0,next_achv_id:0,key_id:0,shortcuts_id:0,achv_cmplt_type:0,count:0,complete_name:0};achv.achv_type=m_user_achivement.at(keys[idx]).achv_type,achv.achv_id=m_user_achivement.at(keys[idx]).achv_id,achv.new_yn=m_user_achivement.at(keys[idx]).new_yn,achv.complete_yn=m_user_achivement.at(keys[idx]).complete_yn,achv.bonus_complete_yn=m_user_achivement.at(keys[idx]).bonus_complete_yn,achv.complete_popup_yn=m_user_achivement.at(keys[idx]).complete_popup_yn,achv.complete_count=m_user_achivement.at(keys[idx]).complete_count;var achievement=MasterManager.getInstance().get_Achivement(achv.achv_id);achv.shortcuts_id=achievement.shortcuts_id;var achv_bonus=MasterManager.getInstance().get_AchivementCompleteBonus(achv.achv_id);achv.bonus_type=achv_bonus.bonus_type,achv.bonus_count=achv_bonus.bonus_count,achv.next_achv_id=achv_bonus.next_achv_id;var achv_condition=MasterManager.getInstance().get_AchivementCompleteCondition(achv.achv_id);achv.achv_cmplt_type=achv_condition.achv_cmplt_type,achv.count=achv_condition.count;var achv_cmplt_type=MasterManager.getInstance().get_AchivementCompleteType(achv.achv_cmplt_type);achv.complete_name=achv_cmplt_type.name;var bonus_type=MasterManager.getInstance().get_BonusType(achv.bonus_type);return achv.bonus_name=bonus_type,achv},AchievementService.prototype.getUserAchievementCompleteCount=function(achv_type,event_dungeon_period_idx){for(var count=0,m_user_achivement=NetService().getUserAchievementList(),keys=m_user_achivement.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++){if(m_user_achivement.at(keys[idx]).achv_type==achv_type&&"y"==m_user_achivement.at(keys[idx]).complete_yn&&"n"==m_user_achivement.at(keys[idx]).bonus_complete_yn)if(null!=event_dungeon_period_idx)MasterManager.getInstance().get_AchivementEventDungeonInfo(m_user_achivement.at(keys[idx]).achv_id).event_dungeon_period_idx==event_dungeon_period_idx&&count++;else count++}return count},AchievementService.prototype.isNewCompleteAchievement=function(){for(var count=0,m_user_achivement=NetService().getUserAchievementList(),keys=m_user_achivement.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++)if((m_user_achivement.at(keys[idx]).achv_type<ACHIEVEMENT_EVENTDUNGEON||m_user_achivement.at(keys[idx]).achv_type>ACHIEVEMENT_EVENTDUNGEON_3RD)&&"y"==m_user_achivement.at(keys[idx]).complete_yn&&"n"==m_user_achivement.at(keys[idx]).bonus_complete_yn){count++;break}return count},AchievementService.prototype.isNewCompleteAchievementEventDungeon=function(event_dungeon_group_idx){for(var m_user_achivement=NetService().getUserAchievementList(),is_new=!1,mt=MasterManager.getInstance(),ed_service=EventDungeonService.getInstance(),first_half_period_idx=(mt.get_EventDungeonPeriod(event_dungeon_group_idx),ed_service.getEventDungeonFirstHalfPeriodIdx(event_dungeon_group_idx)),middle_period_idx=ed_service.getEventDungeonMiddleHalfPeriodIdx(event_dungeon_group_idx),second_half_period_idx=ed_service.getEventDungeonSecondHalfPeriodIdx(event_dungeon_group_idx),keys=m_user_achivement.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++)if(m_user_achivement.at(keys[idx]).achv_type>=ACHIEVEMENT_EVENTDUNGEON&&m_user_achivement.at(keys[idx]).achv_type<=ACHIEVEMENT_EVENTDUNGEON_3RD&&"y"==m_user_achivement.at(keys[idx]).complete_yn&&"n"==m_user_achivement.at(keys[idx]).bonus_complete_yn){var achv_event_dungeon_info=mt.get_AchivementEventDungeonInfo(m_user_achivement.at(keys[idx]).achv_id);if(achv_event_dungeon_info.event_dungeon_period_idx==first_half_period_idx){is_new=!0;break}if(achv_event_dungeon_info.event_dungeon_period_idx==middle_period_idx){is_new=!0;break}if(achv_event_dungeon_info.event_dungeon_period_idx==second_half_period_idx){is_new=!0;break}}return is_new},AchievementService.prototype.isNewCompleteAchievementByType=function(achv_type){for(var is_new=!1,m_user_achivement=NetService().getUserAchievementList(),keys=m_user_achivement.keys(),keys_length=keys.length,idx=0;idx<keys_length;idx++)m_user_achivement.at(keys[idx]).achv_type==achv_type&&"y"==m_user_achivement.at(keys[idx]).complete_yn&&"n"==m_user_achivement.at(keys[idx]).bonus_complete_yn&&(is_new=!0);return is_new},AchievementService.prototype.getAchvType=function(achv_id){var achv=MasterManager.getInstance().get_Achivement(achv_id);return null==achv?0:achv.achv_type},AchievementService.prototype.getValidAchvEventDungeonInfo=function(achv_id){MasterManager.getInstance().get_AchivementEventDungeonInfo(achv_id);return 0},AchievementService.prototype.getEventDungeonGroupPeriodCount=function(period_id){var group_count,mt=MasterManager.getInstance(),period=mt.get_EventDungeonPeriod(period_id),event_list=mt.get_All_EventDungeonPeriod().filter(function(obj){if(obj.event_dungeon_group_idx==period.event_dungeon_group_idx)return!0});return null==event_list&&(event_list=[]),group_count=event_list.length,event_list=null,group_count},AchievementService.prototype.checkAchievementPeriod=function(achv_type){var valid_period=!1,now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),nn=moment(now).valueOf();return null!=MasterManager.getInstance().get_All_AchievementPeriod().find(function(obj){var beg_dt=moment(obj.beg_dt).valueOf(),end_dt=moment(obj.end_dt).valueOf();if(obj.achv_type==achv_type&&beg_dt<=nn&&nn<=end_dt)return!0})&&(valid_period=!0),valid_period},{getInstance:function(){return void 0===instance&&(instance=new AchievementService),instance}}}();GreatWallService=function(){function GreatWallService(){return{getCurrentGreatWallPeriodIdx:function(){var period_list=MasterTable.getInstance().get_GreatWallDungeonPeriodList(),great_wall_dungeon_period_idx=0,n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf();for(var idx in period_list){var p=period_list[idx],bt=moment(p.begin_dt),et=moment(p.end_dt),b=bt.valueOf(),e=et.valueOf();if(b<=n&&n<=e){great_wall_dungeon_period_idx=p.great_wall_dungeon_period_idx;break}}return period_list=null,great_wall_dungeon_period_idx},getGreatWallDungeon:function(great_wall_dungeon_period_idx,great_wall_dungeon_group_idx,great_wall_dungeon_idx,dungeon){var m=MasterManager.getInstance();if(0!=great_wall_dungeon_period_idx){m.get_GreatWallDungeonPeriod(great_wall_dungeon_period_idx);var s=BattleService.getInstance(),d=m.get_GreatWallDungeon(great_wall_dungeon_idx,great_wall_dungeon_group_idx);dungeon.great_wall_dungeon=d,dungeon.great_wall_dungeon_idx=d.great_wall_dungeon_idx,dungeon.great_wall_dungeon_group_idx=d.great_wall_dungeon_group_idx,dungeon.great_wall_dungeon_step=d.step,dungeon.stage_npc=new Map,s.getMasterGreatWallStepStageNpc(d.great_wall_dungeon_idx,d.great_wall_dungeon_group_idx,dungeon);var user_dungeon_list=NetService().get_great_wall_dungeon_list().dungeon_list,found=user_dungeon_list.findIndex(function(dd){return dd.great_wall_dungeon_idx==dungeon.great_wall_dungeon_idx&&dd.great_wall_dungeon_group_idx==dungeon.great_wall_dungeon_group_idx});if(-1!=found){var net_dungeon=user_dungeon_list[found];dungeon.is_first_clear="y"==net_dungeon.first_clear_yn,dungeon.is_complete="y"==net_dungeon.complete_yn,dungeon.is_retry="y"==net_dungeon.retry_yn;var stage_npc=dungeon.stage_npc.at(dungeon.current_stage);if(dungeon.is_complete)for(var npc_idx=0;npc_idx<stage_npc.length;npc_idx++){(npc=stage_npc[npc_idx]).is_dead=!0,npc.remain_hp_rate=0}else for(stage_npc=dungeon.stage_npc.at(dungeon.current_stage),npc_idx=0;npc_idx<stage_npc.length;npc_idx++){var npc=stage_npc[npc_idx],n_found=net_dungeon.npc_list.findIndex(function(n){return n.position==npc.position});-1!=n_found?(npc.remain_hp_rate=net_dungeon.npc_list[n_found].remain_hp_rate,npc.is_dead="y"==net_dungeon.npc_list[n_found].dead_yn):npc.remain_hp_rate=1e4}}else dungeon.is_first_clear=!1,dungeon.is_complete=!1;user_dungeon_list=null}},getGreatWallDungeonList:function(great_wall_dungeon_period_idx,great_wall_dungeon_group_idx,list){var m=MasterTable.getInstance();NetService().getGreatWallDungeonInfo();if(0!=great_wall_dungeon_period_idx){for(var period=MasterManager.getInstance().get_GreatWallDungeonPeriod(great_wall_dungeon_period_idx),dungeon_list=m.get_GreatWallDungeonList(great_wall_dungeon_group_idx),s=BattleService.getInstance(),is_first_enable=!1,complete_count=0,i=0;i<dungeon_list.length;i++){var d=dungeon_list.at(i);if(d.step<=period.max_step){var dungeon={};dungeon.stage_npc=new Map,dungeon.current_stage=1,dungeon.great_wall_dungeon_idx=0,dungeon.is_complete=!1,dungeon.is_open_prev_dungeon=!1,dungeon.is_enable=!1,s.getMasterGreatWallStepStageNpc(d.great_wall_dungeon_idx,d.great_wall_dungeon_group_idx,dungeon);var user_dungeon_list=NetService().get_great_wall_dungeon_list().dungeon_list,found=user_dungeon_list.findIndex(function(dd){return dd.great_wall_dungeon_idx==dungeon.great_wall_dungeon_idx&&dd.great_wall_dungeon_group_idx==dungeon.great_wall_dungeon_group_idx});if(-1!=found){var net_dungeon=user_dungeon_list[found];if(dungeon.is_first_clear="y"==net_dungeon.first_clear_yn,dungeon.is_complete="y"==net_dungeon.complete_yn,dungeon.is_retry="y"==net_dungeon.retry_yn,dungeon.is_complete){for(var stage_npc=dungeon.stage_npc.at(dungeon.current_stage),npc_idx=0;npc_idx<stage_npc.length;npc_idx++){(npc=stage_npc[npc_idx]).is_dead=!0,npc.remain_hp_rate=0}complete_count++}else for(stage_npc=dungeon.stage_npc.at(dungeon.current_stage),npc_idx=0;npc_idx<stage_npc.length;npc_idx++){var npc=stage_npc[npc_idx],n_found=net_dungeon.npc_list.findIndex(function(n){return n.position==npc.position});-1!=n_found?(npc.remain_hp_rate=net_dungeon.npc_list[n_found].remain_hp_rate,npc.is_dead="y"==net_dungeon.npc_list[n_found].dead_yn):npc.remain_hp_rate=1e4}dungeon.is_complete||is_first_enable||(is_first_enable=!0,dungeon.is_enable=!0)}else dungeon.is_first_clear=!1,dungeon.is_complete=!1,dungeon.is_complete||is_first_enable||(is_first_enable=!0,dungeon.is_enable=!0);list.push_back(dungeon)}}!is_first_enable&&0<list.size()&&period.max_step!=complete_count&&(is_first_enable=list.at(0).is_enable=!0),dungeon_list=null}},getGreatWallDungeonStepBonusList:function(great_wall_dungeon_period_idx,great_wall_dungeon_group_idx,great_wall_step){for(var period=MasterManager.getInstance().get_GreatWallDungeonPeriod(great_wall_dungeon_period_idx),dungeon_list=MasterTable.getInstance().get_GreatWallDungeonList(great_wall_dungeon_group_idx),list=[],i=0;i<dungeon_list.size();i++){var dungeon=dungeon_list.at(i);if(dungeon.step<=period.max_step&&dungeon.step==great_wall_step){list=MasterTable.getInstance().get_GreatWallDungeonBonusItemList(dungeon.great_wall_dungeon_bonus_idx);break}}return dungeon_list=null,list},getGreatWallDungeonBonusList:function(great_wall_dungeon_period_idx,great_wall_dungeon_group_idx){for(var m=MasterTable.getInstance(),period=MasterManager.getInstance().get_GreatWallDungeonPeriod(great_wall_dungeon_period_idx),dungeon_list=m.get_GreatWallDungeonList(great_wall_dungeon_group_idx),list=[],i=(NetService().getGreatWallDungeonInfo(),0);i<dungeon_list.length;i++){var dungeon=dungeon_list.at(i);if(dungeon.step<=period.max_step){var reward_list=MasterTable.getInstance().get_GreatWallDungeonBonusItemList(dungeon.great_wall_dungeon_bonus_idx),reward={bonus_list:[]};reward.great_wall_dungeon_bonus_item_idx=dungeon.great_wall_dungeon_bonus_idx,reward.bonus_list.clear(),reward.is_rewarded=!1,reward.bonus_list=reward_list,reward.step=dungeon.step;var user_dungeon_list=NetService().get_great_wall_dungeon_list().dungeon_list,found=user_dungeon_list.findIndex(function(d){return d.great_wall_dungeon_idx==dungeon.great_wall_dungeon_idx&&d.great_wall_dungeon_group_idx==dungeon.great_wall_dungeon_group_idx});-1!=found&&"y"==user_dungeon_list[found].first_clear_yn&&(reward.is_rewarded=!0),list.push_back(reward)}}return list},getGreatWallTroopsGeneralList:function(troops_num){var list=[],greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return list;var len=greatWallDungeonInfo.troops_list.length;if(isUndefined(troops_num))for(var i=0;i<len;i++)for(var g_len=(t=greatWallDungeonInfo.troops_list[i]).troops_generls.length,j=0;j<g_len;j++){var g=t.troops_generls[j],tt={};tt.gnrl_id=g.gnrl_id,tt.gnrl_num=g.gnrl_num,tt.troops_num=g.troops_num,tt.pos_type=g.position,tt.is_leader="y"==g.leader_yn,list.push_back(tt)}else for(i=0;i<len;i++){var t;if((t=greatWallDungeonInfo.troops_list[i]).troops_num==troops_num)for(g_len=t.troops_generls.length,j=0;j<g_len;j++){g=t.troops_generls[j];var troops={};troops.gnrl_id=g.gnrl_id,troops.gnrl_num=g.gnrl_num,troops.troops_num=g.troops_num,troops.pos_type=g.position,troops.is_leader="y"==g.leader_yn,list.push_back(troops)}}return list},removeCampUsingGnrlCheck:function(gnrls){return gnrls.filter(function(del){return!del.using_in_camp})},removeMaterialGnrlCheck:function(gnrls){return gnrls.filter(function(del){return 1==del.gnrl_type||3==del.gnrl_type})},getGreatWallTroopsFormationInfo:function(troops_num){for(var form={},great_troops_list=NetService().get_great_wall_troops_info().troops_list,len=great_troops_list.length,i=0;i<len;i++){var t=great_troops_list[i];if(t.troops_num==troops_num){form=MasterManager.getInstance().get_BattleFormation(t.formation_id);break}}return great_troops_list=null,form},getGreatWallTroopsCost:function(troops_num){var cost=0,m=MasterManager.getInstance(),greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return 0;for(var len=greatWallDungeonInfo.troops_list.length,i=0;i<len;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==troops_num)for(var g_len=t.troops_generls.length,j=0;j<g_len;j++){var g=t.troops_generls[j];cost+=m.get_General(g.gnrl_id).cost}}return cost},getGreatWallTroopsTotalCost:function(troops_num){var cost=0,greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return 1;for(var len=greatWallDungeonInfo.troops_list.length,i=0;i<len;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==troops_num){cost=t;break}}return cost},getGreatWallTroopsGeneralCount:function(troops_num){var count=0,greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return 0;for(var len=greatWallDungeonInfo.troops_list.length,i=0;i<len;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==troops_num)for(var g_len=t.troops_generls.length,j=0;j<g_len;j++)count++}return count},isExistGeneralInGreatWallTroops:function(troops_num,gnrl_num){var is_exist=!1,greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return 0;for(var len=greatWallDungeonInfo.troops_list.length,i=0;i<len;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==troops_num)for(var g_len=t.troops_generls.length,j=0;j<g_len;j++){if(t.troops_generls[j].gnrl_num==gnrl_num){is_exist=!0;break}}}return is_exist},isExistGeneralInGreatWallPosType:function(troops_num,pos_type){var is_exist=!1,greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return 1;for(var len=greatWallDungeonInfo.troops_list.length,i=0;i<len;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==troops_num)for(var g_len=t.troops_generls.length,j=0;j<g_len;j++){if(t.troops_generls[j].position==pos_type){is_exist=!0;break}}}return is_exist},isSameGeneralInGreatWallTroops:function(troops_num,position,troops){var is_exist=!1,m=MasterManager.getInstance(),t_g=m.get_General(troops.gnrl_id),greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return 1;for(var len=greatWallDungeonInfo.troops_list.length,i=0;i<len;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==troops_num)for(var g_len=t.troops_generls.length,j=0;j<g_len;j++){var g=t.troops_generls[j];if(g.position!=position){var gg=m.get_General(g.gnrl_id);t_g.gnrl_group==gg.gnrl_group&&troops.gnrl_num!=g.gnrl_num&&(is_exist=!0,position=g.position)}}}return{result:is_exist,pos:position}},isSameGeneralInGreatWallTroops2:function(troops_num,gnrl_key,position){var is_exist=!1,m=db.MasterTable.getInstance(),t_g=m.get_General(gnrl_key.gnrl_id),greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return 1;for(var len=greatWallDungeonInfo.troops_list.length,i=0;i<len;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==troops_num)for(var g_len=t.troops_generls.length,j=0;j<g_len;j++){var g=t.troops_generls[j],gg=m.get_General(g.gnrl_id);if(t_g.gnrl_group==gg.gnrl_group&&gnrl_key.gnrl_num!=g.gnrl_num){is_exist=!0,g.position;break}}}return is_exist},getGreatWallGeneralInTroops:function(gnrl_key,troops_num,position){for(var idx=0;idx<NetService().get_great_wall_troops_info().troops_list.length;idx++){for(var t=NetService().get_great_wall_troops_info().troops_list[idx],j=0;j<t.troops_generls.length;j++){var g=t.troops_generls[j];if(g.gnrl_id==gnrl_key.gnrl_id&&g.gnrl_num==gnrl_key.gnrl_num)return t.troops_num,g.position,!0}return!1}},checkGreatWallTroopsPosition:function(troops){var is_curr_pos=!1,greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return 1;for(var len=greatWallDungeonInfo.troops_list.length,i=0;i<len;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==troops.troops_num)for(var g_len=t.troops_generls.length,j=0;j<g_len;j++){var g=t.troops_generls[j];if(g.gnrl_num==troops.gnrl_num&&g.position==troops.pos_type){is_curr_pos=!0;break}}}return is_curr_pos},isCostOver:function(gnrl_troops,troops_num){var isOver=!1,totalCost=this.getGreatWallTroopsTotalCost(troops_num),cost=0,m=MasterManager.getInstance(),greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return!1;for(var len=greatWallDungeonInfo.troops_list.length,i=0;i<len;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==troops_num)for(var g_len=t.troops_generls.length,j=0;j<g_len;j++){var g=t.troops_generls[j];g.position!=gnrl_troops.pos_type&&g.gnrl_num!=gnrl_troops.gnrl_num&&(cost+=m.get_General(g.gnrl_id).cost)}}return(cost+=m.get_General(gnrl_troops.gnrl_id).cost)>totalCost.cost&&(isOver=!0),isOver},getDelGeneralNumInGreatWallTroops:function(troops_num,pos_type){var gnrl_key={gnrl_id:0,gnrl_num:0},greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return gnrl_key.gnrl_id=0,gnrl_key.gnrl_num=0,gnrl_key;for(var len=greatWallDungeonInfo.troops_list.length,i=0;i<len;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==troops_num)for(var g_len=t.troops_generls.length,j=0;j<g_len;j++){if((g=t.troops_generls[j]).position==pos_type){gnrl_key.gnrl_id=g.gnrl_id,gnrl_key.gnrl_num=g.gnrl_num;break}}}var is_exist=!1;for(i=0;i<len;i++)if(t.troops_num!=troops_num){g_len=t.troops_generls.length;for(j=0;j<g_len;j++){var g;if((g=t.troops_generls[j]).gnrl_num==gnrl_key.gnrl_num&&g.gnrl_id==gnrl_key.gnrl_id){is_exist=!0;break}}}return is_exist&&(gnrl_key.gnrl_id=0,gnrl_key.gnrl_num=0),gnrl_key},getGreatWallTroopsGeneral:function(troops_num,pos_type){var gnrl=$.extend({},db.UserGeneralTroops),is_exist=!1,greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.troops_list)return!1;for(var len=greatWallDungeonInfo.troops_list.length,i=0;i<len;i++){var t=greatWallDungeonInfo.troops_list[i];if(t.troops_num==troops_num){for(var g_len=t.troops_generls.length,j=0;j<g_len;j++){var g=t.troops_generls[j];if(g.position==pos_type){gnrl.gnrl_id=g.gnrl_id,gnrl.gnrl_num=g.gnrl_num,gnrl.troops_num=g.troops_num,gnrl.pos_type=g.position,gnrl.is_leader="y"==g.leader_yn,is_exist=!0;break}}if(is_exist)break}}return gnrl},isEnableReleasePartInGeneral:function(gnrl){var is_enable=!0,greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.partin_generals)return!0;for(var len=greatWallDungeonInfo.partin_generals.length,i=0;i<len;i++){var g=greatWallDungeonInfo.partin_generals[i];if(g.gnrl_id==gnrl.gnrl_id&&g.gnrl_num==gnrl.gnrl_num&&"y"==g.battle_start_yn){is_enable=!1;break}}return is_enable},checkGreatWallDungeonPartInGenerals:function(gnrls){var m=MasterManager.getInstance(),gs=GeneralService.getInstance(),great_wall_dungeon_period_idx=this.getCurrentGreatWallPeriodIdx();if(0!=great_wall_dungeon_period_idx){var period=m.get_GreatWallDungeonPeriod(great_wall_dungeon_period_idx),greatWallDungeonInfo=NetService().get_great_wall_troops_info();if(null==greatWallDungeonInfo.partin_generals)return!0;greatWallDungeonInfo.partin_generals.length;for(var g_len=gnrls.length,i=0;i<g_len;i++){var g=gnrls[i],partin_list=greatWallDungeonInfo.partin_generals,found=partin_list.findIndex(function(p){return g.gnrl_id==p.gnrl_id&&g.gnrl_num==p.gnrl_num});if(g.remain_hp_rate=1e4,g.remain_skill_count=0,g.max_skill_count=0,g.is_dead=!1,g.is_battle_start=!1,g.is_force_release=!1,-1!=found){g.remain_hp_rate=partin_list[found].remain_hp_rate,g.remain_skill_count=partin_list[found].remain_skill_count,g.max_skill_count=partin_list[found].max_skill_count,g.is_dead="y"==partin_list[found].dead_yn,g.is_battle_start="y"==partin_list[found].battle_start_yn,g.is_force_release="y"==partin_list[found].drop_yn,g.using_in_great_wall_troops=!0;var gnrl_key=new db.UserGeneralKey;gnrl_key.gnrl_id=g.gnrl_id,gnrl_key.gnrl_num=g.gnrl_num,this.getGreatWallGeneralInTroops(gnrl_key,g.gw_troops_num,g.gw_position)}else{var max_skill_count=MasterTable.getInstance().get_GreatWallGeneralSkillLimitCount(period.great_wall_dungeon_group_idx,g.gnrl_group);g.max_skill_count=max_skill_count,g.remain_skill_count=max_skill_count,g.gw_troops_num=0,g.gw_position=0,g.remain_hp_rate=1e4}g.max_hp=gs.getMaxHPGeneral(g)}}},checkGreatWallDungeonPartInGeneral:function(g){var m=MasterManager.getInstance(),gs=GeneralService.getInstance(),great_wall_dungeon_period_idx=this.getCurrentGreatWallPeriodIdx();if(0!=great_wall_dungeon_period_idx){var period=m.get_GreatWallDungeonPeriod(great_wall_dungeon_period_idx),user_partin_generals=NetService().get_great_wall_troops_info().partin_generals,found=user_partin_generals.findIndex(function(p){return g.gnrl_id==p.gnrl_id&&g.gnrl_num==p.gnrl_num});if(g.remain_hp_rate=1e4,g.remain_skill_count=0,g.max_skill_count=0,g.is_dead=!1,g.is_battle_start=!1,g.is_force_release=!1,-1!=found){var general=user_partin_generals[found];g.remain_hp_rate=general.remain_hp_rate,g.remain_skill_count=general.remain_skill_count,g.max_skill_count=general.max_skill_count,g.is_dead="y"==general.dead_yn,g.is_battle_start="y"==general.battle_start_yn,g.is_force_release="y"==general.drop_yn,g.using_in_great_wall_troops=!0;var gnrl_key={};gnrl_key.gnrl_id=g.gnrl_id,gnrl_key.gnrl_num=g.gnrl_num,this.getGreatWallGeneralInTroops(gnrl_key,g.gw_troops_num,g.gw_position)}else{var max_skill_count=MasterTable.getInstance().get_GreatWallGeneralSkillLimitCount(period.great_wall_dungeon_group_idx,g.gnrl_group);g.max_skill_count=max_skill_count,g.remain_skill_count=max_skill_count,g.gw_troops_num=0,g.gw_position=0,g.remain_hp_rate=1e4}g.max_hp=gs.getMaxHPGeneral(g)}},getGreatWallTroopsGenerals:function(troops_num,gnrl_list){gnrl_list.clear();for(var gnrls=NetService().getUserGeneral([]),service=BattleService.getInstance(),troops_list=NetService().get_great_wall_troops_info().troops_list,idx=0;idx<troops_list.length;idx++){var t=troops_list[idx];if(t.troops_num==troops_num)for(var jdx=0;jdx<t.troops_generls.length;jdx++){var g=t.troops_generls[jdx],gnrl=$.extend({},database.BattleGeneral);gnrl.gnrl_id=g.gnrl_id,gnrl.gnrl_num=g.gnrl_num,gnrl.position=g.position,gnrl.is_zoom="y"==g.leader_yn;var found;if(-1!=(found=gnrls.findIndex(function(ug){return g.gnrl_id==ug.gnrl_id&&g.gnrl_num==ug.gnrl_num}))){var ug=gnrls[found];gnrl.gnrl_level=ug.gnrl_level,gnrl.exp=ug.gnrl_exp,gnrl.love_level=ug.love_level,gnrl.love_exp=ug.love_exp,gnrl.limit_step_id=ug.limit_step_id,gnrl.display_class=ug.display_class;var general=MasterManager.getInstance().get_General(gnrl.gnrl_id);gnrl.base_attk=general.attk,gnrl.base_def=general.def,gnrl.base_hp=general.hp,gnrl.base_sp=general.sp,gnrl.base_cri_prcnt=general.cri_percent,gnrl.base_cri_ratio=general.cri_ratio,gnrl.base_guard_rate=general.guard_rate,gnrl.base_guard_decrease=general.guard_value;var partin=-1,partin_generals=NetService().get_great_wall_troops_info().partin_generals;Array.isArray(partin_generals)&&-1!=(partin=partin_generals.findIndex(function(p){return gnrl.gnrl_id==p.gnrl_id&&gnrl.gnrl_num==p.gnrl_num}))&&(gnrl.remain_skill_count=partin_generals[partin].remain_skill_count,gnrl.remain_hp_rate=partin_generals[partin].remain_hp_rate,gnrl.is_dead="y"==partin_generals[partin].dead_yn,gnrl.is_force_release="y"==partin_generals[partin].drop_yn,gnrl.max_skill_count=partin_generals[partin].max_skill_count),service.getMasterGeneral(gnrl),service.getEquipmentOptions(gnrl)}gnrl_list.push_back(gnrl)}}troops_list=gnrls=null}}}var instance;return{getInstance:function(){return void 0===instance&&(instance=new GreatWallService),instance}}}();var NewEquipService=function(){function NewEquipService(){}var instance;return NewEquipService.prototype.getUserNewEquipmentInfo=function(user_equip_data,user_equip_key,info){info.equip_idx=user_equip_key.equipment_item_idx,info.equip_num=user_equip_key.equipment_num,info.level=user_equip_data.level,info.smelt_level=user_equip_data.smelt_level,info.mount_yn="y"==user_equip_data.mount_yn,info.lock_yn="y"==user_equip_data.lock_yn,info.exp=user_equip_data.exp;var equipStat,mt=MasterTable.getInstance(),equip=mt.getMasterTable().get_NewEquipment(user_equip_key.equipment_item_idx);equipStat=mt.get_NewEquipmentStatInfo(equip.new_equipment_stat_group_idx,user_equip_data.smelt_level,user_equip_data.level),info.equip_group=equip.new_equipment_set_buff_group_idx,info.exp_group=equip.new_equipment_exp_group_idx,info.stat_group=equip.new_equipment_stat_group_idx,info.max_level=equip.max_level,info.max_smelt_level=equip.max_smelt_level,info.release_group=equip.new_equipment_release_group_idx,info.stat_group_info=equipStat,info.equip_name=equip.name,info.stat_type=1,info.equip_rare_type=equip.grade_type,info.equip_slot_type=equip.slot_type;var equipSkill=mt.get_NewEquipmentSkillList(equip.new_equipment_skill_group_idx)[0];info.equip_image=cmString("icon_test_%02d.png",equip.new_equipment_idx),info.equip_type=equipSkill.equip_type,info.equip_type_value=equipSkill.equip_type_value,info.frame_id=equipSkill.equip_type_value,info.skill_group=equip.new_equipment_skill_group_idx;var equip_expInfo=$.extend({},db.NewEquipmentExp),equip_expInfo_data=mt.get_NewEquipmentLvupExp(equip.new_equipment_exp_group_idx,user_equip_data.smelt_level,user_equip_data.level);0==equip_expInfo_data?cc.log("[%s] return error","get_NewEquipmentLvupExp"):(equip_expInfo=$.extend({},equip_expInfo_data),info.amount_gold_sale=equip_expInfo.sell_price)},NewEquipService.prototype.getUserNewEquipment=function(user_equip_key,info){for(var user_equipments=NetService().get_user_new_euipment_list().user_equipments,user_equip_data=null,it=0;it<user_equipments.length;it++)if(user_equip_key.equipment_num==user_equipments[it].equip_num){user_equip_data=user_equipments[it];break}info.equip_idx=user_equip_key.equipment_item_idx,info.equip_num=user_equip_key.equipment_num,info.level=user_equip_data.level,info.smelt_level=user_equip_data.smelt_level,info.mount_yn="y"==user_equip_data.mount_yn,info.lock_yn="y"==user_equip_data.lock_yn;var equip=MasterManager.getInstance().get_NewEquipment(user_equip_key.equipment_item_idx),equipStat=MasterTable.getInstance().get_NewEquipmentStatInfo(equip.new_equipment_stat_group_idx,user_equip_data.smelt_level,user_equip_data.level);info.equip_group=equip.new_equipment_set_buff_group_idx,info.exp_group=equip.new_equipment_exp_group_idx,info.stat_group=equip.new_equipment_stat_group_idx,info.max_level=equip.max_level,info.max_smelt_level=equip.max_smelt_level,info.release_group=equip.new_equipment_release_group_idx,info.stat_group_info=equipStat,info.equip_name=equip.name,info.stat_type=1,info.equip_rare_type=equip.grade_type,info.equip_slot_type=equip.slot_type;var equipSkill=MasterTable.getInstance().get_NewEquipmentSkillList(equip.new_equipment_skill_group_idx)[0];info.equip_image=cmString("icon_test_%02d.png",equip.new_equipment_idx),info.equip_type=equipSkill.equip_type,info.equip_type_value=equipSkill.equip_type_value,info.frame_id=equipSkill.equip_type_value,info.skill_group=equip.new_equipment_skill_group_idx},NewEquipService.prototype.getUserNewEquipmentList=function(gnrl_key,bMounted,bLocked){for(var user_equipments=NetService().get_user_new_euipment_list().user_equipments,equip_slot_type=GameContext.getInstance().getEquipmentParts(),info=[],it=0;it<user_equipments.length;it++){var equip_key={};equip_key.equipment_item_idx=user_equipments[it].new_equipment_idx,equip_key.equipment_num=user_equipments[it].equip_num;var user_equip={};this.getUserNewEquipmentInfo(user_equipments[it],equip_key,user_equip),bMounted&&user_equip.mount_yn||(bLocked&&user_equip.lock_yn||equip_slot_type!=EQUIPMENT_PARTS_ALL&&equip_slot_type!=user_equip.equip_slot_type||info.push(user_equip))}return info},NewEquipService.prototype.getUserGeneralEquipmentListInfo=function(key){var gnrl_key={};gnrl_key.gnrl_id=key.gnrl_id,gnrl_key.gnrl_num=key.gnrl_num;var mt=MasterManager.getInstance(),user_gnrl_equips=NetService().get_user_general_new_equipments().user_general_equips,info=[];if(null==user_gnrl_equips)return info;for(var i=0;i<user_gnrl_equips.length;i++){var gnrl_equip=user_gnrl_equips[i];if(gnrl_key.gnrl_num==gnrl_equip.gnrl_num){var equip=mt.get_NewEquipment(gnrl_equip.equipment_item_idx),user_gnrl_equip={};user_gnrl_equip.gnrl_id=gnrl_key.gnrl_id,user_gnrl_equip.gnrl_num=gnrl_key.gnrl_num,user_gnrl_equip.equip_id=gnrl_equip.equipment_item_idx,user_gnrl_equip.equip_num=gnrl_equip.equipment_num,user_gnrl_equip.equip_parts_type=equip.slot_type,user_gnrl_equip.image="",info.push(user_gnrl_equip)}}return info},NewEquipService.prototype.getEquipmentLevelupExpPct=function(userEquip){var mt=MasterTable.getInstance(),equip=mt.getMasterTable().get_NewEquipment(userEquip.equip_idx);if(userEquip.level>=equip.max_level)return 1;var cur_expInfo,next_expInfo,current_lv=userEquip.level;if(0==(cur_expInfo=mt.get_NewEquipmentLvupExp(userEquip.exp_group,userEquip.smelt_level,current_lv)))return 0;var next_lv=userEquip.level+1;if(0==(next_expInfo=mt.get_NewEquipmentLvupExp(userEquip.exp_group,userEquip.smelt_level,next_lv)))return 0;var need_exp_lvup=next_expInfo.need_exp,percent=(userEquip.exp-cur_expInfo.accum_exp)/need_exp_lvup;return 1<percent||percent<0?0:percent},NewEquipService.prototype.getUserGeneralEquipInfo=function(user_equip_key){for(var mt=MasterManager.getInstance(),user_gnrl_equips=NetService().get_user_general_new_equipments().user_general_equips,info={},i=0;i<user_gnrl_equips.length;i++){var gnrl_equip=user_gnrl_equips[i];if(user_equip_key.equipment_num==gnrl_equip.equipment_num){var equip=mt.get_NewEquipment(gnrl_equip.equipment_item_idx),user_gnrl_equip={};user_gnrl_equip.gnrl_id=gnrl_equip.gnrl_id,user_gnrl_equip.gnrl_num=gnrl_equip.gnrl_num,user_gnrl_equip.equip_id=gnrl_equip.equipment_item_idx,user_gnrl_equip.equip_num=gnrl_equip.equipment_num,user_gnrl_equip.equip_parts_type=equip.slot_type,user_gnrl_equip.image="",info=user_gnrl_equip;break}}return info},NewEquipService.prototype.getNewEquipmentOnGeneral=function(gnrl){var mt=MasterTable.getInstance(),m=MasterManager.getInstance(),list=[],gnrl_key=new net.User_General_Key;gnrl_key.gnrl_id=gnrl.gnrl_id,gnrl_key.gnrl_num=gnrl.gnrl_num;for(var equip_list=NetService().getNewEquipmentOnGeneral(gnrl_key),stat_list=[],idx=0;idx<equip_list.length;idx++){var equip=equip_list[idx],data=$.extend({},database.BattleNewEquipment);if(stat_list=[],data.new_equipment_idx=equip.new_equipment_idx,data.equip_num=equip.equip_num,data.equipment=equip,data.equip_level=equip.level,data.equip_exp=equip.exp,data.smelt_level=equip.smelt_level,data.equipment_data=m.get_NewEquipment(data.new_equipment_idx),0<(stat_list=mt.get_NewEquipmentStatInfo(data.equipment_data.new_equipment_stat_group_idx,data.smelt_level,data.equip_level)).size()){var stat=stat_list.at(0);data.stat_type=stat.stat_type,data.stat_value=stat.stat_type_value}if(0!=equip.enchant_opt_1){var opt=this.getNewEquipmentEnchantOpt(equip.enchant_opt_1);data.enchant_opt_list.push_back(opt)}if(0!=equip.enchant_opt_2){opt=this.getNewEquipmentEnchantOpt(equip.enchant_opt_2);data.enchant_opt_list.push_back(opt)}if(0!=equip.enchant_opt_3){opt=this.getNewEquipmentEnchantOpt(equip.enchant_opt_3);data.enchant_opt_list.push_back(opt)}if(0!=equip.enchant_opt_4){opt=this.getNewEquipmentEnchantOpt(equip.enchant_opt_4);data.enchant_opt_list.push_back(opt)}data.equip_skill=this.getNewEquipmentSkill(data.equipment_data.new_equipment_skill_group_idx,data.smelt_level,data.equip_level),list.push_back(data)}return list},NewEquipService.prototype.getNewEquipmentEnchantOpt=function(enchant_opt_idx){var opt=$.extend({},database.BattleMainMission),m=MasterManager.getInstance();return opt.new_equipment_enchant_random_item_idx=enchant_opt_idx,opt.enchant_opt_data=m.get_NewEquipmentEnchantRandomItem(opt.new_equipment_enchant_random_item_idx),opt.effect_type=opt.enchant_opt_data.effect,opt.effect_value=opt.enchant_opt_data.effect_value,opt},NewEquipService.prototype.getNewEquipmentSkill=function(skill_group_idx,smelt_lv,equip_lv){for(var skill_list=[],mt=MasterTable.getInstance(),m=MasterManager.getInstance(),service=BattleService.getInstance(),skill_data_list=mt.get_NewEquipmentSkillList(skill_group_idx),idx=0;idx<skill_data_list.length;idx++){var s=skill_data_list[idx],skill=new database.BattleNewEquipmentSkill;skill.skill=s;var effect_list=mt.get_NewEquipmentSkillEffectList(skill.skill.new_equipment_skill_effect_group_idx,smelt_lv,equip_lv);if(0<effect_list.size()){var effect=effect_list.at(0);if(skill.skill_effect=effect,skill.invoke_type=skill.skill_effect.invoke_type,skill.effect_type=effect.effect_type,skill.effect_type==database.NewEquipmentSkillEffectType.NewEquipmentSkillEffectType_Stat)skill.effect_sub_type=effect.value1,skill.effect_value=effect.value2;else if(skill.effect_type==database.NewEquipmentSkillEffectType.NewEquipmentSkillEffectType_OneTime){var one=m.get_OnetimeEffect(effect.value1),one_eff=new database.BattleOneTimeEffect;service.convertOneTimeEffect(one,one_eff),skill.onetime_effects.push_back(one_eff)}else if(skill.effect_type==database.NewEquipmentSkillEffectType.NewEquipmentSkillEffectType_Duration){var dur=m.get_DurabilityEffect(effect.value1),dur_eff=new database.BattleDurabilityEffect;service.convertDurabilityEffect(dur,dur_eff),skill.durability_effects.push_back(dur_eff)}}skill_list.push_back(skill)}return skill_list},NewEquipService.prototype.getUserNewEquipBound=function(){var mt=MasterManager.getInstance(),cur_slot_bound=100,cf_slot_base=mt.get_CountFunction(COUNT_FUNCTION_NEW_EQUIP_SLOT_BASE_BOUND),cf_slot_max=mt.get_CountFunction(COUNT_FUNCTION_NEW_EQUIP_SLOT_MAX_BOUND),user_slot_bound=NetService().get_user_new_equipment_bound().new_equipment_inc_bound;return(cur_slot_bound=parseInt(cf_slot_base.value)+user_slot_bound)>parseInt(cf_slot_max.value)&&(cur_slot_bound=parseInt(cf_slot_max.value)),cur_slot_bound},NewEquipService.prototype.getEquipBoundIncInfo=function(value,bonus_type_name){var mm=MasterManager.getInstance(),gf=mm.get_GoodsFunction(9);value=gf.value;var bonus_type=gf.bonus_type;return[value,mm.get_BonusType(bonus_type).name]},NewEquipService.prototype.getMakeNewEquipmentInfo=function(data){for(var mt=MasterTable.getInstance(),m=MasterManager.getInstance(),list=[],idx=0;idx<data.length;idx++){var info={};info.equip_idx=data[idx].new_equipment_idx,info.level=data[idx].default_level,info.smelt_level=data[idx].default_smelt_level;var equip=m.get_NewEquipment(data[idx].new_equipment_idx),equipStat=mt.get_NewEquipmentStatInfo(equip.new_equipment_stat_group_idx,info.smelt_level,info.level);info.equip_group=equip.new_equipment_set_buff_group_idx,info.stat_group=equip.new_equipment_stat_group_idx,info.max_level=equip.max_level,info.max_smelt_level=equip.max_smelt_level,info.stat_group_info=equipStat,info.equip_name=equip.name,info.stat_type=1,info.equip_rare_type=equip.grade_type,info.equip_slot_type=equip.slot_type;var equipSkill=mt.get_NewEquipmentSkillList(equip.new_equipment_skill_group_idx).at(0);info.equip_image=cmString("icon_test_%02d.png",equip.new_equipment_idx),info.equip_type=equipSkill.equip_type,info.equip_type_value=equipSkill.equip_type_value,info.frame_id=equipSkill.equip_type_value,info.skill_group=equip.new_equipment_skill_group_idx;var skill_desc_num=mt.get_BlackSmithSkillDesc(info.smelt_level,info.level),skillDec=m.get_NewEquipmentDesc(skill_desc_num);info.equip_skill=skillDec.description,list.push_back(info)}return list},NewEquipService.prototype.getSkillDescText=function(equip_id,smelt_level,level){var m=MasterManager.getInstance(),mt=MasterTable.getInstance(),equip=m.get_NewEquipment(equip_id),skill_list=mt.get_NewEquipmentSkillFxInfo(equip.new_equipment_skill_group_idx,smelt_level,level);return m.get_NewEquipmentDesc(skill_list.at(0).new_equipment_desc_idx).description},NewEquipService.prototype.getUserMakeNewMaterialCount=function(new_equipment_make_material_idx){var user_make_material=NetService().get_user_new_equipment_make_materials().user_make_materials,found=user_make_material.findIndex(function(m){return new_equipment_make_material_idx==m.new_equipment_make_material_idx});return-1!=found?user_make_material[found].count:0},NewEquipService.prototype.getUserSmeltNewMaterialCount=function(new_equipment_smelt_material_idx){var user_smelt_material=NetService().get_user_new_equipment_smelt_materials().user_smelt_materials,found=user_smelt_material.findIndex(function(m){return new_equipment_smelt_material_idx==m.new_equipment_smelt_material_idx});return-1!=found?user_smelt_material[found].count:0},NewEquipService.prototype.getCraftNeqEquiMaterials=function(userEquip){return MasterTable.getInstance().get_newEquipCraftMaterials(userEquip.equip_rare_type,userEquip.equip_slot_type,userEquip.smelt_level,userEquip.level)},NewEquipService.prototype.getUserEnhanceNewMaterialCount=function(new_equipment_enhance_material_idx){var user_enhance_material=NetService().get_user_new_equipment_enhance_materials().user_enhance_materials,found=user_enhance_material.findIndex(function(m){return new_equipment_enhance_material_idx==m.new_equipment_enhance_material_idx});return-1!=found?user_enhance_material[found].count:0},NewEquipService.prototype.getUserNewEquipmentEnchantTicketCount=function(new_equipment_enchant_ticket_idx){var user_equipment_enchant_tickets=NetService().get_user_new_equipment_enchant_tickets().user_enchant_tickets,found=user_equipment_enchant_tickets.findIndex(function(t){return new_equipment_enchant_ticket_idx==t.new_equipment_enchant_ticket_idx});return-1!=found?user_equipment_enchant_tickets[found].ticket_count:0},{getInstance:function(){return void 0===instance&&(instance=new NewEquipService),instance}}}(),BattleService=function(){function BattleService(){}var instance;return BattleService.prototype.ORDER_DESC_BATTLE_POSITION=function(left,right){return left.position<right.position},BattleService.prototype.setRaidGenernalData=function(gnrl,raid_info_db,npc){var m=MasterManager.getInstance();gnrl.gnrl_id=raid_info_db.gnrl_id,this.getMasterGeneral(gnrl),gnrl.gnrl_level=npc.level,gnrl.general.attk=npc.attk,gnrl.general.def=npc.def,gnrl.general.hp=npc.hp,gnrl.general.sp=npc.sp,gnrl.general.cri_percent=npc.cri_percent,gnrl.general.cri_ratio=npc.cri_ratio,gnrl.general.guard_rate=npc.guard_rate,gnrl.general.guard_value=npc.guard_value,gnrl.cri_resist=npc.cri_resist,gnrl.skill_attk_damage_inc=npc.skill_attk_damage_inc,gnrl.skill_def_damage_dec=npc.skill_def_damage_dec,gnrl.adv_attk_damage_inc=npc.adv_attk_damage_inc,gnrl.adv_def_damage_dec=npc.adv_def_damage_dec,0!=raid_info_db.element_type&&(gnrl.general.element_type=raid_info_db.element_type),gnrl.active_skill=[];for(var i=0;i<3;i++){var skill_id=0;switch(i){case 0:skill_id=raid_info_db.active_skill_id_1;break;case 1:skill_id=raid_info_db.active_skill_id_2;break;case 2:skill_id=raid_info_db.active_skill_id_3}if(99999!=skill_id){var npc_skill,active_skill={gnrl_num:0,skill_id:0,skill:{},skill_action:{},onetime_effects:[],durability_effects:[],is_teamcooltime:0,skill_charge_count:0};m.get_ActiveSkill(gnrl.general.active_skill_id);npc_skill=m.get_NpcActiveSkill(skill_id),active_skill.skill.active_skill_id=npc_skill.active_skill_id,active_skill.skill.action_id=npc_skill.action_id,active_skill.skill.content=npc_skill.content,active_skill.skill.cool_time=npc_skill.cool_time,active_skill.skill.pre_cool_time=npc_skill.pre_cool_time,active_skill.skill.invoke_type1=npc_skill.invoke_type1,active_skill.skill.onetime_effect=npc_skill.onetime_effect,active_skill.skill.invoke_type2=npc_skill.invoke_type2,active_skill.skill.durability_effect=npc_skill.durability_effect,active_skill.skill.name=npc_skill.name,active_skill.skill.skill_group=npc_skill.skill_group;var skill_action;skill_action=m.get_ActionImplementation(active_skill.skill.action_id),this.convertActionImpl(skill_action,active_skill.skill_action);var one_time=new database.BattleOneTimeEffect;one_time.gnrl_id=gnrl.gnrl_id;var one_time_effects=active_skill.skill.onetime_effect.split(",");for(var one_id in one_time_effects){if(0<(num=one_time_effects[one_id])){var fx=m.get_OnetimeEffect(num);this.convertOneTimeEffect(fx,one_time),active_skill.onetime_effects.push(one_time)}}var durability={};durability.gnrl_id=gnrl.general.gnrl_id,durability.end_effects=[],durability.tick_effects=[];var durability_effects=active_skill.skill.durability_effect.split(",");for(one_id=0;one_id<durability_effects.length;one_id++){var num;if(0<(num=durability_effects[one_id])){fx=m.get_OnetimeEffect(num);if(fx=m.get_DurabilityEffect(num),this.convertDurabilityEffect(fx,durability),0<fx.dura_end_effect){var one=m.get_OnetimeEffect(fx.dura_end_effect),end_one=new database.BattleOneTimeEffect;end_one.gnrl_id=gnrl.gnrl_id,this.convertOneTimeEffect(one,end_one),durability.end_effects.push(end_one)}if(0<fx.repeat_effect){one=m.get_OnetimeEffect(fx.repeat_effect);var repeat_one=new database.BattleOneTimeEffect;repeat_one.gnrl_id=gnrl.gnrl_id,this.convertOneTimeEffect(one,repeat_one),durability.tick_effects.push(repeat_one)}0<durability.effect_id&&active_skill.durability_effects.push(durability)}}gnrl.active_skill.push(active_skill)}}gnrl.resistance=[];var re={};re.trans_type=database.BattleEffectTrans.Stun,re.resist_value=npc.stun_resist,gnrl.resistance.push(re);var silence={};silence.trans_type=database.BattleEffectTrans.Silence,silence.resist_value=npc.silence_resist,gnrl.resistance.push(silence);var poison={};poison.trans_type=database.BattleEffectTrans.New_Poison_Dmg_Rate,poison.resist_value=npc.poison_resist,gnrl.resistance.push(poison);var electric={};electric.trans_type=database.BattleEffectTrans.Damage_Reduce,electric.resist_value=npc.electric_resist,gnrl.resistance.push(electric);var frozen={};frozen.trans_type=database.BattleEffectTrans.Freeze,frozen.resist_value=npc.frozen_resist,gnrl.resistance.push(frozen);var burn={};burn.trans_type=database.BattleEffectTrans.After_Recv_Damage_Inc_Rate,burn.resist_value=npc.burn_resist,gnrl.resistance.push(burn);var heal={};heal.trans_type=database.BattleEffectTrans.Wound_Obstruct_Heal,heal.resist_value=npc.wound_resist,gnrl.resistance.push_back(heal);var dark={};dark.trans_type=database.BattleEffectTrans.Blind_Darkness,dark.resist_value=npc.blind_resist,gnrl.resistance.push_back(dark);var sp_list=MasterTable.getInstance().get_NpcSpecialAbilities(raid_info_db.raid_boss_info_idx);gnrl.special_ability=[];for(var s=0;s<sp_list.length;s++){var sa={};sa.special_ability_id=sp_list[s].special_ability_id,sa.special_ability_type=sp_list[s].special_ability_type,sa.ability_value=sp_list[s].ability_value,gnrl.special_ability.push(sa)}},BattleService.prototype.setNpcGeneralData=function(gnrl,npc){var m=MasterManager.getInstance();if(null==npc){if(0==gnrl.npc_id)return;npc=m.get_NpcGeneral(gnrl.npc_id)}if(gnrl.gnrl_id=npc.gnrl_id,gnrl.npc_id=npc.npc_id,this.getMasterGeneral(gnrl),gnrl.gnrl_level=npc.npc_level,gnrl.general.attk=npc.attk,gnrl.general.def=npc.def,gnrl.general.hp=npc.hp,gnrl.general.sp=npc.sp,gnrl.general.cri_percent=npc.cri_percent,gnrl.general.cri_ratio=npc.cri_attk_damage,gnrl.general.guard_rate=npc.guard_rate,gnrl.general.guard_value=npc.guard_value,gnrl.cri_resist=npc.cri_resist,gnrl.skill_attk_damage_inc=npc.skill_attk_damage_inc,gnrl.skill_def_damage_dec=npc.skill_def_damage_dec,gnrl.adv_attk_damage_inc=npc.adv_attk_damage_inc,gnrl.adv_def_damage_dec=npc.adv_def_damage_dec,gnrl.npc_attk_dmg_type=npc.attk_dmg_type,gnrl.npc_attk_dmg_min_value=npc.attk_dmg_min_value,0!=npc.element_type&&(gnrl.general.element_type=npc.element_type),99999!=npc.active_skill_id){var active_skill=new database.BattleSkill;active_skill.gnrl_num=0,active_skill.skill_id=0,active_skill.skill={},active_skill.skill_action={},active_skill.onetime_effects=[],active_skill.durability_effects=[],gnrl.active_skill=[];var npc_skill,origin_skill=m.get_ActiveSkill(gnrl.general.active_skill_id);npc_skill=m.get_NpcActiveSkill(npc.active_skill_id),active_skill.skill.active_skill_id=npc_skill.active_skill_id,active_skill.skill.action_id=npc_skill.action_id,active_skill.skill.content=npc_skill.content,active_skill.skill.cool_time=npc_skill.cool_time,active_skill.skill.pre_cool_time=npc_skill.pre_cool_time,active_skill.skill.invoke_type1=npc_skill.invoke_type1,active_skill.skill.onetime_effect=npc_skill.onetime_effect,active_skill.skill.invoke_type2=npc_skill.invoke_type2,active_skill.skill.durability_effect=npc_skill.durability_effect,active_skill.skill.name=npc_skill.name,active_skill.skill.skill_group=npc_skill.skill_group,active_skill.skill.enemy_skill_type=origin_skill.enemy_skill_type;var skill_action=m.get_ActionImplementation(active_skill.skill.action_id);this.convertActionImpl(skill_action,active_skill.skill_action);for(var one_time_effects=active_skill.skill.onetime_effect.split(","),one_id=0;one_id<one_time_effects.length;one_id++){if(0<(num=one_time_effects[one_id])){var one_time=new database.BattleOneTimeEffect;one_time.gnrl_id=gnrl.gnrl_id,null!=(fx=m.get_OnetimeEffect(num)).num&&this.convertOneTimeEffect(fx,one_time),0<one_time.effect_id&&active_skill.onetime_effects.push(one_time)}}for(var durability_effects=active_skill.skill.durability_effect.split(","),dur_id=0;dur_id<durability_effects.length;dur_id++){var num;if(0<(num=durability_effects[dur_id])){var fx,durability=new database.BattleDurabilityEffect;if(durability.gnrl_id=gnrl.general.gnrl_id,null!=(fx=m.get_DurabilityEffect(num)).num){if(this.convertDurabilityEffect(fx,durability),0<fx.dura_end_effect){var one=m.get_OnetimeEffect(fx.dura_end_effect),end_one=new database.BattleOneTimeEffect;end_one.gnrl_id=gnrl.gnrl_id,this.convertOneTimeEffect(one,end_one),durability.end_effects.push(end_one)}if(0<fx.repeat_effect){one=database.OnetimeEffect();one=m.get_OnetimeEffect(fx.repeat_effect);var repeat_one=new database.BattleOneTimeEffect;repeat_one.gnrl_id=gnrl.gnrl_id,this.convertOneTimeEffect(one,repeat_one),durability.tick_effects.push(repeat_one)}0<durability.effect_id&&active_skill.durability_effects.push(durability)}}}active_skill.cooltime=0,active_skill.is_cooltime=!1,active_skill.is_prepared=!1,active_skill.is_teamcooltime=!1,active_skill.team_cooltime=0,active_skill.skill_charge_count=0,gnrl.active_skill.push(active_skill)}npc.active_sub_skill_id.split(",").forEach(function(s_id){var active_sub_skill_id=parseInt(s_id);if(99999!=active_sub_skill_id&&0!=active_sub_skill_id){gnrl.active_sub_skill.clear();var active_sub_skill=new database.BattleSubSkill;active_sub_skill.sub_skill_id=npc.active_sub_skill_id;var npc_sub=m.get_NpcActiveSubSkill(active_sub_skill_id);active_sub_skill.sub_skill.active_sub_skill_id=active_sub_skill_id,active_sub_skill.sub_skill.action_id=npc_sub.action_id,active_sub_skill.sub_skill.onetime_effect=npc_sub.onetime_effect,active_sub_skill.sub_skill.durability_effect=npc_sub.durability_effect;var skill_action=m.get_ActionImplementation(active_sub_skill.sub_skill.action_id);this.convertActionImpl(skill_action,active_sub_skill.skill_action);var one_time=new database.BattleOneTimeEffect;one_time.gnrl_id=gnrl.gnrl_id,active_sub_skill.sub_skill.onetime_effect.split(",").forEach(function(one_id){var num=1*one_id;if(0<num){var fx=m.get_OnetimeEffect(num);this.convertOneTimeEffect(fx,one_time),0<one_time.effect_id&&active_sub_skill.onetime_effects.push_back(one_time)}}.bind(this));var durability=new database.BattleDurabilityEffect;durability.gnrl_id=gnrl.general.gnrl_id,active_sub_skill.sub_skill.durability_effect.split(",").forEach(function(dur_id){var num=1*dur_id;if(0<num){var fx=m.get_DurabilityEffect(num);if(this.convertDurabilityEffect(fx,durability),0<fx.dura_end_effect){var one=m.get_OnetimeEffect(fx.dura_end_effect),end_one=new database.BattleOneTimeEffect;end_one.gnrl_id=gnrl.gnrl_id,this.convertOneTimeEffect(one,end_one),durability.end_effects.push_back(end_one)}if(0<fx.repeat_effect){one=MasterManager.getInstance().get_OnetimeEffect(fx.repeat_effect);var repeat_one=new database.BattleOneTimeEffect;repeat_one.gnrl_id=gnrl.gnrl_id,this.convertOneTimeEffect(one,repeat_one),durability.tick_effects.push_back(repeat_one)}0<durability.effect_id&&active_sub_skill.durability_effects.push_back(durability)}}.bind(this)),gnrl.active_sub_skill.push_back(active_sub_skill)}}.bind(this));var resist_list=MasterTable.getInstance().get_NpcResistances(npc.npc_id);gnrl.resistance=[];for(var r=0;r<resist_list.length;r++){var resist={};resist.resistance_id=resist_list[r].resistance_id,resist.trans_type=resist_list[r].trans_type,resist.resist_value=resist_list[r].resist_value,gnrl.resistance.push(resist)}var sp_list=MasterTable.getInstance().get_NpcSpecialAbilities(npc.npc_id);gnrl.special_ability=[];for(var s=0;s<sp_list.length;s++){var sa={};sa.special_ability_id=sp_list[s].special_ability_id,sa.special_ability_type=sp_list[s].special_ability_type,sa.ability_value=sp_list[s].ability_value,gnrl.special_ability.push(sa)}},BattleService.prototype.convertActionImpl=function(action,battle_action){battle_action.action_id=action.action_id,battle_action.range_style=action.attack_style,battle_action.our_enemy=action.enemy_me_type,battle_action.self_other=action.me_other_type,battle_action.target_count=action.target_count,battle_action.hit_count=action.attack_count,battle_action.hit_sound=action.hit_sound,battle_action.action_sound=action.action_sound,battle_action.enemy_action_sound=action.enemy_action_sound,battle_action.priority_position=action.priority_position,battle_action.damages=[];try{if(null!=action.damage_shared)if(-1!=action.damage_shared.indexOf(","))for(var damage_shared=action.damage_shared.split(","),i=0;i<damage_shared.length;i++)battle_action.damages.push(damage_shared[i]);else battle_action.damages.push(action.damage_shared)}catch(e){}},BattleService.prototype.convertOneTimeEffect=function(g,result){if(result.effect_id=g.num,result.onetime_effect=g,result.our_enemy=g.self_other,result.input_ability_type=g.input_ability,result.output_ability_type=g.output_ability,result.value=g.value,result.sub_value=g.sub_value,result.element_trans_type=g.trans_element_type,result.element_value=g.element_value,result.stat_trans=g.stat_trans,result.element_type=g.element_type,result.element_type_value=g.element_type_value,result.force_type=g.force_type,result.force_type_value=g.force_type_value,result.fight_type=g.fight_type,result.fight_type_value=g.fight_type_value,result.hp_check_type=g.hp_check_type,result.hp_check_value=g.hp_check_value,result.hp_increase_value=g.hp_increase_value,result.rate=g.rate,result.max_value=g.max_value,result.target_boss_types=[],null!=g.stack_count_wanko&&null!=g.stack_count_wanko?result.stack_count_wanko=g.stack_count_wanko:result.stack_count_wanko=0,""!=g.target_boss_type&&"0"!=g.target_boss_type&&null!=g.target_boss_type)for(var target_boss_types=g.target_boss_type.split(","),idx=0;idx<target_boss_types.length;idx++){if(""!=(t=target_boss_types[idx])){var bt=parseInt(t);result.target_boss_types.push_back(bt)}}if(""!=g.state_type&&"0"!=g.state_type&&null!=g.state_type&&null!=g.state_type){var state_types=g.state_type.split(",");for(idx=0;idx<state_types.length;idx++){var t;if(""!=(t=state_types[idx])){var st=parseInt(t);result.state_types.push_back(st)}}}},BattleService.prototype.convertDurabilityEffect=function(eff,result){if(result.effect_id=eff.num,result.durability=eff,result.up_down=eff.up_down,result.our_enemy=eff.self_other,result.trans_type=eff.stat_trans,result.value=eff.value,result.percent=eff._percent,result.duration=eff.duration_time,result.tick=eff._repeat,result.icon_name=eff.icon_name,result.resist_trans_type=eff.resist_trans_type,result.arm_service_type=eff.arm_service_type,result.element_type=eff.element_type,result.fight_type=eff.fight_type,result.invoke_type=eff.invoke_type,result.action_id=eff.action_id,null!=result.action_id&&0!=result.action_id&&99999!=result.action_id){var action_impl=MasterTable.getInstance().getMasterTable().get_ActionImplementation(result.action_id);this.convertActionImpl(action_impl,result.action)}},BattleService.prototype.getFriendEquipmentOptions=function(frnd_gnrl,g){MasterTable.getInstance();EquipmentService.getInstance().getFriendEquipentsOnGeneral(g,frnd_gnrl.equipment_list);for(var set_item_count_map=new Map,idx=0;idx<g.equipments.length;idx++){var e=g.equipments[idx];if(0!=e.equip_group){for(var found=-1,keys=set_item_count_map.keys(),kdx=0;kdx<keys.length;kdx++){set_item_count_map.at(keys[kdx]);if(e.equip_group==keys[kdx]){found=keys[kdx];break}}if(-1!=found){var set_item=set_item_count_map.at(found);set_item+=1,set_item_count_map.insert(found,set_item)}else set_item_count_map.insert(e.equip_group,1)}}if(0<set_item_count_map.size())for(var jdx=0;jdx<set_item_count_map.length;jdx++){var grp=set_item_count_map[jdx];if(1<grp){var set_item_count=grp;3<set_item_count&&(set_item_count=3);var equip_set_info=MasterManager.getInstance().get_EquipmentGroup(jdx,set_item_count);0!=equip_set_info.equip_group_idx&&g.set_equipment_effect.push(equip_set_info)}}},BattleService.prototype.getWorldWarEquipmentOptions=function(g){MasterTable.getInstance();EquipmentService.getInstance().getEquipmentsOnWorldWarGeneral(g);for(var set_item_count_map=new Map,idx=0;idx<g.equipments.length;idx++){var e=g.equipments[idx];if(0!=e.equip_group){for(var found=-1,keys=set_item_count_map.keys(),kdx=0;kdx<keys.length;kdx++){set_item_count_map.at(keys[kdx]);if(e.equip_group==keys[kdx]){found=keys[kdx];break}}if(-1!=found){var set_item=set_item_count_map.at(found);set_item+=1,set_item_count_map.insert(found,set_item)}else set_item_count_map.insert(e.equip_group,1)}}if(0<set_item_count_map.size())for(var map_keys=set_item_count_map.keys(),jdx=0;jdx<map_keys.length;jdx++){var grp=set_item_count_map.at(map_keys[jdx]);if(1<grp){var set_item_count=grp;3<set_item_count&&(set_item_count=3);var equip_set_info=MasterManager.getInstance().get_EquipmentGroup(map_keys[jdx],set_item_count);null!=equip_set_info&&0!=equip_set_info.equip_group_idx&&g.set_equipment_effect.push(equip_set_info)}}},BattleService.prototype.getNewEquipmentInfo=function(gnrl){var m=MasterTable.getInstance(),service=NewEquipService.getInstance();gnrl.new_equipments=service.getNewEquipmentOnGeneral(gnrl);for(var set_buff_group=[],idx=0;idx<gnrl.new_equipments.length;idx++){var group=gnrl.new_equipments[idx].equipment_data.new_equipment_set_buff_group_idx;if(-1==gnrl.new_equipment_set.findIndex(function(g){return g.set_group_data.new_equipment_set_buff_group_idx==group})){for(var cnt=0,i=0;i<gnrl.new_equipments.length;i++){gnrl.new_equipments[i].equipment_data.new_equipment_set_buff_group_idx==group&&cnt++}if(1<cnt)for(set_buff_group=m.get_NewEquipmentSetBuffData(group,cnt),i=0;i<set_buff_group.length;i++){var set=new database.BattleNewEquipmentSetGroup;set.set_group_data=set_buff_group[i],set.is_10000_percent_rate=1==set_buff_group[i].rate_yn,set.stat_type=set_buff_group[i].stat_type,set.stat_value=set_buff_group[i].stat_value,gnrl.new_equipment_set.push_back(set)}}}},BattleService.prototype.getEquipmentOptions=function(g){MasterTable.getInstance();EquipmentService.getInstance().getEquipmentsOnGeneral(g);for(var set_item_count_map=new Map,idx=0;idx<g.equipments.length;idx++){var e=g.equipments[idx];if(0!=e.equip_group){for(var found=-1,keys=set_item_count_map.keys(),kdx=0;kdx<keys.length;kdx++){set_item_count_map.at(keys[kdx]);if(e.equip_group==keys[kdx]){found=keys[kdx];break}}if(-1!=found){var set_item=set_item_count_map.at(found);set_item+=1,set_item_count_map.insert(found,set_item)}else set_item_count_map.insert(e.equip_group,1)}}if(0<set_item_count_map.size())for(var map_keys=set_item_count_map.keys(),jdx=0;jdx<map_keys.length;jdx++){var grp=set_item_count_map.at(map_keys[jdx]);if(1<grp){var set_item_count=grp;3<set_item_count&&(set_item_count=3);var equip_set_info=MasterManager.getInstance().get_EquipmentGroup(map_keys[jdx],set_item_count);null!=equip_set_info&&0!=equip_set_info.equip_group_idx&&g.set_equipment_effect.push(equip_set_info)}}},BattleService.prototype.getMasterGeneral=function(g){var m=MasterTable.getInstance().getMasterTable();g.general=m.get_General(g.gnrl_id),g.attack_action={},g.attack2_action={},g.attack3_action={},g.active_skill=[],g.active_sub_skill=[],g.passive_skill=[],g.resistance=[],g.trans_passive_skill=[],g.evt_dungeon_buff=[],g.equipments=[],g.set_equipment_effect=[],g.special_ability=new Array;var action=m.get_ActionImplementation(g.general.action_id1);this.convertActionImpl(action,g.attack_action);var action2=m.get_ActionImplementation(g.general.action_id2);if(this.convertActionImpl(action2,g.attack2_action),99999!=g.general.action_id3){var action3=m.get_ActionImplementation(g.general.action_id3);this.convertActionImpl(action3,g.attack3_action)}if(g.general.active_skill_id){var active_skill={gnrl_num:0,skill_id:0,cooltime:0,is_cooltime:!1,is_prepared:!1,is_teamcooltime:!1,team_cooltime:0,skill_charge_count:0};active_skill.skill=m.get_ActiveSkill(g.general.active_skill_id),active_skill.skill_action={},active_skill.onetime_effects=[],active_skill.durability_effects=[];var skill_action=m.get_ActionImplementation(active_skill.skill.action_id);this.convertActionImpl(skill_action,active_skill.skill_action);var one_time_effects=[];null!=active_skill.skill.onetime_effect&&(one_time_effects=active_skill.skill.onetime_effect.split(","));for(var one_id=0;one_id<one_time_effects.length;one_id++){if(0<(num=one_time_effects[one_id])){var fx={},one_time=new database.BattleOneTimeEffect;one_time.gnrl_id=g.gnrl_id,fx=m.get_OnetimeEffect(num),this.convertOneTimeEffect(fx,one_time),0<one_time.effect_id&&active_skill.onetime_effects.push(one_time)}}var durability_effects=new Array;null!=active_skill.skill.durability_effect&&(durability_effects=active_skill.skill.durability_effect.split(","));for(var dur_id=0;dur_id<durability_effects.length;dur_id++){var num;if(0<(num=durability_effects[dur_id]))if(null!=(fx=m.get_DurabilityEffect(num)).num){var durability=new database.BattleDurabilityEffect;if(durability.gnrl_id=g.general.gnrl_id,this.convertDurabilityEffect(fx,durability),0<fx.dura_end_effect){var one=m.get_OnetimeEffect(fx.dura_end_effect),end_one=new database.BattleOneTimeEffect;end_one.gnrl_id=g.gnrl_id,this.convertOneTimeEffect(one,end_one);var end_one_dur_eff=$.extend({},end_one);durability.end_effects.push(end_one_dur_eff)}if(0<fx.repeat_effect){one=m.get_OnetimeEffect(fx.repeat_effect);var repeat_one=new database.BattleOneTimeEffect;repeat_one.gnrl_id=g.gnrl_id,this.convertOneTimeEffect(one,repeat_one);var repeat_one_dur_eff=$.extend({},repeat_one);durability.tick_effects.push(repeat_one_dur_eff)}if(0<durability.effect_id){var durability_dur_eff=$.extend({},durability);active_skill.durability_effects.push(durability_dur_eff)}}}g.active_skill.push(active_skill)}g.general.active_sub_skill_id.split(",").forEach(function(s_id){var active_sub_skill_id=parseInt(s_id);if(99999!=active_sub_skill_id&&0!=active_sub_skill_id){var active_sub_skill={};active_sub_skill.sub_skill_id=active_sub_skill_id,active_sub_skill.sub_skill=m.get_ActiveSubSkill(active_sub_skill_id),active_sub_skill.onetime_effects=[],active_sub_skill.durability_effects=[],active_sub_skill.skill_action={};var skill_action=m.get_ActionImplementation(active_sub_skill.sub_skill.action_id);this.convertActionImpl(skill_action,active_sub_skill.skill_action);for(var one_time_effects=active_sub_skill.sub_skill.onetime_effect.split(","),one_id=0;one_id<one_time_effects.length;one_id++){if(0<(num=one_time_effects[one_id])){var fx=m.get_OnetimeEffect(num),one_time=new database.BattleOneTimeEffect;one_time.gnrl_id=g.gnrl_id,this.convertOneTimeEffect(fx,one_time),0<one_time.effect_id&&active_sub_skill.onetime_effects.push(one_time)}}var durability_effects=[];null!=active_sub_skill.sub_skill.durability_effect&&(durability_effects=active_sub_skill.sub_skill.durability_effect.split(","));for(var dur_id=0;dur_id<durability_effects.length;dur_id++){var num;if(0<(num=durability_effects[dur_id])){var durability=new database.BattleDurabilityEffect;durability.gnrl_id=g.general.gnrl_id;fx=m.get_DurabilityEffect(num);if(durability.end_effects=[],durability.tick_effects=[],null!=fx.num){if(this.convertDurabilityEffect(fx,durability),0<fx.dura_end_effect){var one=m.get_OnetimeEffect(fx.dura_end_effect),end_one=new database.BattleOneTimeEffect;end_one.gnrl_id=g.gnrl_id,this.convertOneTimeEffect(one,end_one);var end_one_dur=$.extend({},end_one);durability.end_effects.push(end_one_dur)}if(0<fx.repeat_effect){one=m.get_OnetimeEffect(fx.repeat_effect);var repeat_one=new database.BattleOneTimeEffect;repeat_one.gnrl_id=g.gnrl_id,this.convertOneTimeEffect(one,repeat_one);var repeat_one_dur=$.extend({},repeat_one);durability.tick_effects.push(repeat_one_dur)}if(0<durability.effect_id){var durability_sub=$.extend({},durability);active_sub_skill.durability_effects.push(durability_sub)}}}}g.active_sub_skill.push(active_sub_skill)}}.bind(this)),99999!=g.general.passive_skill_id&&0!=g.general.passive_skill_id&&g.passive_skill.push(m.get_PassiveSkillV2(g.general.passive_skill_id)),g.general.trans_passive_skill_id.split(",").forEach(function(p_id){var trans_passive_skill_id=parseInt(p_id);if(0!=trans_passive_skill_id&&99999!=trans_passive_skill_id){var trans_passive={};if(trans_passive.trans_passive_skill_id=trans_passive_skill_id,trans_passive.trans_passive=m.get_TransPassiveSkill(trans_passive_skill_id),trans_passive.action=new database.BattleActionImpl,9==trans_passive.trans_passive.invoke_type1||9==trans_passive.trans_passive.invoke_type2){var passive_action;passive_action=m.get_ActionImplementation(trans_passive.trans_passive.action_id),this.convertActionImpl(passive_action,trans_passive.action)}if(trans_passive.durability_effects=[],0!=trans_passive.trans_passive.onetime_effect){var onetime_effect=new database.BattleOneTimeEffect;onetime_effect.gnrl_id=g.gnrl_id,trans_passive.onetime_effects=[];for(var olist=trans_passive.trans_passive.onetime_effect.split(","),idx=0;idx<olist.length;idx++){var oid=olist[idx];if("0"!=oid&&""!=oid){var n=parseInt(oid),oe=m.get_OnetimeEffect(n);this.convertOneTimeEffect(oe,onetime_effect);var onetime_effedct_pass=$.extend({},onetime_effect);trans_passive.onetime_effects.push(onetime_effedct_pass)}}}if(0!=trans_passive.trans_passive.durability_effect){var dur_effect=new database.BattleDurabilityEffect,dlist=trans_passive.trans_passive.durability_effect.split(",");for(idx=0;idx<dlist.length;idx++){var did=dlist[idx];if("0"!=did&&""!=did){n=parseInt(did);var de=m.get_DurabilityEffect(n);if(this.convertDurabilityEffect(de,dur_effect),0<de.dura_end_effect){var one=m.get_OnetimeEffect(de.dura_end_effect),end_one=new database.BattleOneTimeEffect;end_one.gnrl_id=g.gnrl_id,this.convertOneTimeEffect(one,end_one);var end_one_pass=$.extend({},end_one);dur_effect.end_effects.push(end_one_pass)}if(0<de.repeat_effect){one=m.get_OnetimeEffect(de.repeat_effect);var repeat_one=new database.BattleOneTimeEffect;repeat_one.gnrl_id=g.gnrl_id,this.convertOneTimeEffect(one,repeat_one);var repeat_one_pass=$.extend({},repeat_one);dur_effect.tick_effects.push(repeat_one_pass)}var dur_effect_trans=$.extend({},dur_effect);trans_passive.durability_effects.push(dur_effect_trans)}}dur_effect=null}trans_passive.reborn_count=0,trans_passive.full_charge_count=0,trans_passive.mild_rabbit_count=0,g.trans_passive_skill.push(trans_passive)}}.bind(this));for(var resist_list=MasterTable.getInstance().get_GeneralResistances(g.gnrl_id),r=0;r<resist_list.length;r++){var resist={};resist.resistance_id=resist_list[r].resistance_id,resist.trans_type=resist_list[r].trans_type,resist.resist_value=resist_list[r].resist_value,g.resistance.push(resist)}},BattleService.prototype.getMainStoryHardModeMissionTaskListCheck=function(main_story_hard_mode_mission_idx,list){for(var m=MasterManager.getInstance(),task_list=MasterTable.getInstance().get_MainStoryHardModeMissionTaskList(main_story_hard_mode_mission_idx),i=0;i<task_list.length;i++){var t={};t.main_story_hard_mode_mission_idx=main_story_hard_mode_mission_idx,t.mission_task=task_list[i],t.task=m.get_Task(task_list[i].task_id),t.task_type=m.get_TaskType(t.task.task_type),t.task_id=task_list[i].task_id,t.is_cleared=!1,list.push_back(t)}BattleTable.getInstance().get_UserMainStoryHardModeMissionTaskListCheck(list)},BattleService.prototype.getMainMissionTaskListCheck=function(main_mission_id,list){for(var m=MasterManager.getInstance(),t=BattleTable.getInstance(),task_list=MasterTable.getInstance().get_MainMissionTaskList(main_mission_id),i=0;i<task_list.length;i++){var taskinfo={};taskinfo.main_mission_id=main_mission_id,taskinfo.task_id=task_list[i].task_id,taskinfo.bonus_type=task_list[i].bonus_type,taskinfo.bonus_value=task_list[i].bonus_count,taskinfo.task=m.get_Task(task_list[i].task_id),taskinfo.task_type=m.get_TaskType(taskinfo.task.task_type),list.push(taskinfo)}t.upd_UserMissionTaskListCheck(list)},BattleService.prototype.getMasterGreatWallStepStageNpc=function(great_wall_dungeon_idx,great_wall_dungeon_group_idx,dungeon){null==dungeon&&(dungeon={});var m=MasterManager.getInstance(),step=m.get_GreatWallDungeon(great_wall_dungeon_idx,great_wall_dungeon_group_idx);dungeon.great_wall_dungeon=step,dungeon.great_wall_dungeon_idx=great_wall_dungeon_idx,dungeon.great_wall_dungeon_group_idx=great_wall_dungeon_group_idx,dungeon.great_wall_dungeon_step=step.step,dungeon.stage_count=1;for(var battle_num=0,i=0;i<dungeon.stage_count;i++){battle_num=i+1;var stage=m.get_GreatWallDungeonNpc(great_wall_dungeon_idx,great_wall_dungeon_group_idx,battle_num),npc_list=[];if(0<stage.npc1_id){var npc=m.get_NpcGeneral(stage.npc1_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Head,hero.is_zoom=0<stage.npc1_size,hero.npc_boss_type=stage.npc1_size,hero.battle_stage=stage.battle_num,this.setNpcGeneralData(hero,npc),npc_list.push(hero)}if(0<stage.npc2_id){npc=m.get_NpcGeneral(stage.npc2_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_1,hero.is_zoom=0<stage.npc2_size,hero.npc_boss_type=stage.npc2_size,hero.battle_stage=stage.battle_num,this.setNpcGeneralData(hero,npc),npc_list.push(hero)}if(0<stage.npc3_id){npc=m.get_NpcGeneral(stage.npc3_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_2,hero.is_zoom=0<stage.npc3_size,hero.npc_boss_type=stage.npc3_size,hero.battle_stage=stage.battle_num,this.setNpcGeneralData(hero,npc),npc_list.push(hero)}if(0<stage.npc4_id){npc=m.get_NpcGeneral(stage.npc4_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_1,hero.is_zoom=0<stage.npc4_size,hero.npc_boss_type=stage.npc4_size,hero.battle_stage=stage.battle_num,this.setNpcGeneralData(hero,npc),npc_list.push(hero)}if(0<stage.npc5_id){var hero;npc=m.get_NpcGeneral(stage.npc5_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_2,hero.is_zoom=0<stage.npc5_size,hero.npc_boss_type=stage.npc5_size,hero.battle_stage=stage.battle_num,this.setNpcGeneralData(hero,npc),npc_list.push(hero)}0!=npc_list.length&&(npc_list.sort(function(l,r){return l.position-r.position}),dungeon.stage_npc.insert(battle_num,npc_list))}},BattleService.prototype.getMasterMussangStepStageNpc=function(mussang_id,mussang){var m=MasterManager.getInstance(),step=m.get_MussangStep(mussang_id);mussang.mussang_idx=mussang_id,mussang.mussang=step,mussang.mussang_step=step.mussang_step,mussang.mussang_type=step.mussang_type,mussang.stage_count=3;for(var i=0;i<mussang.stage_count;i++){var stage=m.get_MussangNpc(mussang_id,i+1),npc_list=[];if(0<stage.npc1_id){var npc=m.get_NpcGeneral(stage.npc1_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Head,hero.is_zoom=0<stage.npc1_size,hero.npc_boss_type=stage.npc1_size,hero.battle_stage=stage.battle_num,this.setNpcGeneralData(hero,npc),npc_list.push(hero)}if(0<stage.npc2_id){npc=m.get_NpcGeneral(stage.npc2_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_1,hero.is_zoom=0<stage.npc2_size,hero.npc_boss_type=stage.npc2_size,hero.battle_stage=stage.battle_num,this.setNpcGeneralData(hero,npc),npc_list.push(hero)}if(0<stage.npc3_id){npc=m.get_NpcGeneral(stage.npc3_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_2,hero.is_zoom=0<stage.npc3_size,hero.npc_boss_type=stage.npc3_size,hero.battle_stage=stage.battle_num,this.setNpcGeneralData(hero,npc),npc_list.push(hero)}if(0<stage.npc4_id){npc=m.get_NpcGeneral(stage.npc4_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_1,hero.is_zoom=0<stage.npc4_size,hero.npc_boss_type=stage.npc4_size,hero.battle_stage=stage.battle_num,this.setNpcGeneralData(hero,npc),npc_list.push(hero)}if(0<stage.npc5_id){var hero;npc=m.get_NpcGeneral(stage.npc5_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_2,hero.is_zoom=0<stage.npc5_size,hero.npc_boss_type=stage.npc5_size,hero.battle_stage=stage.battle_num,this.setNpcGeneralData(hero,npc),npc_list.push(hero)}0!=npc_list.length&&(npc_list.sort(function(l,r){return l.position-r.position}),mussang.stage_npc.insert(stage.battle_num,npc_list))}},BattleService.prototype.getMasterEventDungeonOnceADayNpcInfo=function(dungeon){for(var m=MasterManager.getInstance(),s=0;s<dungeon.stage_count;s++){for(var battle_num=s+1,npc_list=dungeon.stage_npc.at(battle_num),idx=0;idx<npc_list.length;idx++){var npc=npc_list[idx];if(0!=npc.npc_id){var n=m.get_NpcGeneral(npc.npc_id);this.setNpcGeneralData(npc,n)}}dungeon.stage_npc.insert(battle_num,npc_list)}},BattleService.prototype.getMasterEventDungeonNpcInfo=function(dungeon){for(var m=MasterManager.getInstance(),s=0;s<dungeon.stage_count;s++){for(var battle_num=s+1,npc_list=dungeon.stage_npc.at(battle_num),idx=0;idx<npc_list.length;idx++){var npc=npc_list[idx];if(0!=npc.npc_id){var n=m.get_NpcGeneral(npc.npc_id);this.setNpcGeneralData(npc,n)}}dungeon.stage_npc.insert(battle_num,npc_list)}},BattleService.prototype.getMasterWeeklyDungeonStageNpc=function(dungeon){for(var m=MasterManager.getInstance(),s=0;s<dungeon.stage_count;s++){for(var battle_num=s+1,npc_list=dungeon.stage_npc.at(battle_num),idx=0;idx<npc_list.length;idx++){var npc=npc_list[idx];if(0!=npc.npc_id){var n=m.get_NpcGeneral(npc.npc_id);this.setNpcGeneralData(npc,n)}}dungeon.stage_npc.insert(battle_num,npc_list)}},BattleService.prototype.getMasterWeeklyDifficultyStageNpc=function(dungeon){for(var m=MasterTable.getInstance().getMasterTable(),idx=0;idx<dungeon.weekly_difficulty.length;idx++){var wd=dungeon.weekly_difficulty[idx];wd.stage_count=3;for(var s=0;s<wd.stage_count;s++){var battle_num=s+1,stage=m.get_WeeklyDungeonNpc(wd.weekly_difficulty.dungeon_idx,battle_num);if(null==stage)break;var hero,npc_list=[];if(0<stage.npc1_id)(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Head,hero.is_zoom=0<stage.npc1_size,hero.npc_boss_type=stage.npc1_size,hero.battle_stage=battle_num,hero.npc_id=stage.npc1_id,npc_list.push(hero);if(0<stage.npc2_id)(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_1,hero.is_zoom=0<stage.npc2_size,hero.npc_boss_type=stage.npc2_size,hero.battle_stage=battle_num,hero.npc_id=stage.npc2_id,npc_list.push(hero);if(0<stage.npc3_id)(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_2,hero.is_zoom=0<stage.npc3_size,hero.npc_boss_type=stage.npc3_size,hero.battle_stage=battle_num,hero.npc_id=stage.npc3_id,npc_list.push(hero);if(0<stage.npc4_id)(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_1,hero.is_zoom=0<stage.npc4_size,hero.npc_boss_type=stage.npc4_size,hero.battle_stage=battle_num,hero.npc_id=stage.npc4_id,npc_list.push(hero);if(0<stage.npc5_id)(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_2,hero.is_zoom=0<stage.npc5_size,hero.npc_boss_type=stage.npc5_size,hero.npc_id=stage.npc5_id,hero.battle_stage=battle_num,npc_list.push(hero);0!=npc_list.length?(npc_list.sort(function(l,r){return l.position-r.position}),wd.stage_npc.insert(battle_num,npc_list)):cc.log("dd")}}},BattleService.prototype.getStoryHardModeMissionAndNpc=function(main_story_hard_mode_mission_idx,mission){var m=MasterTable.getInstance().getMasterTable();mission.main_story_hard_mode_mission_idx=main_story_hard_mode_mission_idx,mission.mission=m.get_MainStoryHardModeMission(mission.main_story_hard_mode_mission_idx),mission.drop_gnrl_list=[],mission.stage_npc=new Map,mission.task_list=[],this.getMainStoryHardModeMissionInfo(main_story_hard_mode_mission_idx,mission),mission.stage_count=3;for(var i=1;i<=mission.stage_count;i++){var stage_num=i,npc_list=[],mission_npc=m.get_MainStoryHardModeMissionNpc(main_story_hard_mode_mission_idx,stage_num),npc=null;if(null!=mission_npc){var hero;if(0<mission_npc.npc1_id)npc=null,npc=m.get_NpcGeneral(mission_npc.npc1_id),(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Head,hero.is_zoom=0<mission_npc.npc1_size,hero.npc_boss_type=mission_npc.npc1_size,hero.battle_stage=stage_num,this.setNpcGeneralData(hero,npc),npc_list.push(hero);if(0<mission_npc.npc2_id)npc=null,npc=m.get_NpcGeneral(mission_npc.npc2_id),(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_1,hero.is_zoom=0<mission_npc.npc2_size,hero.npc_boss_type=mission_npc.npc2_size,hero.battle_stage=stage_num,this.setNpcGeneralData(hero,npc),npc_list.push(hero);if(0<mission_npc.npc3_id)npc=null,npc=m.get_NpcGeneral(mission_npc.npc3_id),(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_2,hero.is_zoom=0<mission_npc.npc3_size,hero.npc_boss_type=mission_npc.npc3_size,hero.battle_stage=stage_num,this.setNpcGeneralData(hero,npc),npc_list.push(hero);if(0<mission_npc.npc4_id)npc=null,npc=m.get_NpcGeneral(mission_npc.npc4_id),(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_1,hero.is_zoom=0<mission_npc.npc4_size,hero.npc_boss_type=mission_npc.npc4_size,hero.battle_stage=stage_num,this.setNpcGeneralData(hero,npc),npc_list.push(hero);if(0<mission_npc.npc5_id)npc=null,npc=m.get_NpcGeneral(mission_npc.npc5_id),(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_2,hero.is_zoom=0<mission_npc.npc5_size,hero.npc_boss_type=mission_npc.npc5_size,hero.battle_stage=stage_num,this.setNpcGeneralData(hero,npc),npc_list.push(hero)}0!=npc_list.length&&(npc_list.sort(function(l,r){return r.position-l.position}),mission.stage_npc.insert(stage_num,npc_list))}},BattleService.prototype.getMainMissionAndNpc=function(main_mission_id,mission){var m=MasterTable.getInstance().getMasterTable();mission.main_mission_id=main_mission_id,mission.mission=m.get_MainMission(mission.main_mission_id),mission.drop_gnrl_list=[],mission.stage_npc=new Map,mission.task_list=[],this.getMainMissionInfo(main_mission_id,mission),0<mission.mission.gnrl_id1&&mission.drop_gnrl_list.push(mission.mission.gnrl_id1),0<mission.mission.gnrl_id2&&mission.drop_gnrl_list.push(mission.mission.gnrl_id2),0<mission.mission.gnrl_id3&&mission.drop_gnrl_list.push(mission.mission.gnrl_id3),0<mission.mission.gnrl_id4&&mission.drop_gnrl_list.push(mission.mission.gnrl_id4),0<mission.mission.gnrl_id5&&mission.drop_gnrl_list.push(mission.mission.gnrl_id5),0<mission.mission.gnrl_id6&&mission.drop_gnrl_list.push(mission.mission.gnrl_id6),mission.stage_count=3;for(var npc=null,i=1;i<=mission.stage_count;i++){var stage_num=i,npc_list=[],mission_npc=m.get_MainMissionNpc(main_mission_id,stage_num);if(null!=mission_npc){var hero;if(0<mission_npc.npc1_id)npc=null,npc=m.get_NpcGeneral(mission_npc.npc1_id),(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Head,hero.is_zoom=0<mission_npc.npc1_size,hero.npc_boss_type=mission_npc.npc1_size,hero.battle_stage=stage_num,this.setNpcGeneralData(hero,npc),npc_list.push(hero);if(0<mission_npc.npc2_id)npc=null,npc=m.get_NpcGeneral(mission_npc.npc2_id),(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_1,hero.is_zoom=0<mission_npc.npc2_size,hero.npc_boss_type=mission_npc.npc2_size,hero.battle_stage=stage_num,this.setNpcGeneralData(hero,npc),npc_list.push(hero);if(0<mission_npc.npc3_id)npc=null,npc=m.get_NpcGeneral(mission_npc.npc3_id),(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_2,hero.is_zoom=0<mission_npc.npc3_size,hero.npc_boss_type=mission_npc.npc3_size,hero.battle_stage=stage_num,this.setNpcGeneralData(hero,npc),npc_list.push(hero);if(0<mission_npc.npc4_id)npc=null,npc=m.get_NpcGeneral(mission_npc.npc4_id),(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_1,hero.is_zoom=0<mission_npc.npc4_size,hero.npc_boss_type=mission_npc.npc4_size,hero.battle_stage=stage_num,this.setNpcGeneralData(hero,npc),npc_list.push(hero);if(0<mission_npc.npc5_id)npc=null,npc=m.get_NpcGeneral(mission_npc.npc5_id),(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_2,hero.is_zoom=0<mission_npc.npc5_size,hero.npc_boss_type=mission_npc.npc5_size,hero.battle_stage=stage_num,this.setNpcGeneralData(hero,npc),npc_list.push(hero)}0!=npc_list.length&&(npc_list.sort(function(l,r){return r.position-l.position}),mission.stage_npc.insert(stage_num,npc_list))}},BattleService.prototype.getTroopsGenerals=function(troops_num,result_list){var gnrls=[],netService=new NetService;netService.getUserGeneral(gnrls);for(var troops_gnrls=netService.getUserPartyGeneral(),keys=troops_gnrls.keys(),idx=0;idx<keys.length;idx++)if(troops_gnrls.at(keys[idx]).troops_num==troops_num)for(var id in gnrls)if(gnrls[id].gnrl_id==troops_gnrls.at(keys[idx]).gnrl_id&&gnrls[id].gnrl_num==troops_gnrls.at(keys[idx]).gnrl_num){var g=$.extend({},database.BattleGeneral);g.new_equipments=[],g.new_equipment_set=[],g.gnrl_id=gnrls[id].gnrl_id,g.gnrl_num=gnrls[id].gnrl_num,g.gnrl_level=gnrls[id].gnrl_level,g.exp=gnrls[id].gnrl_exp,g.castle_id=gnrls[id].castle_id,g.love_level=gnrls[id].love_level,g.love_exp=gnrls[id].love_exp,g.limit_step_id=gnrls[id].limit_step_id,g.display_class=gnrls[id].display_class,g.is_zoom="y"==troops_gnrls.at(keys[idx]).leader_yn,g.position=troops_gnrls.at(keys[idx]).position,this.getMasterGeneral(g),this.getEquipmentOptions(g),this.getNewEquipmentInfo(g),result_list.push_back(g);break}return result_list},BattleService.prototype.getFriendGeneral=function(frnd_gnrl,gnrl){gnrl.gnrl_id=frnd_gnrl.gnrl_id,gnrl.gnrl_level=frnd_gnrl.gnrl_level,gnrl.love_level=frnd_gnrl.gnrl_love_level,gnrl.limit_step_id=frnd_gnrl.gnrl_limit_step_id,this.getMasterGeneral(gnrl)},BattleService.prototype.getMainStoryHardModeMissionInfo=function(main_story_hard_mode_mission_idx,mission){var t=BattleTable.getInstance();mission.task_list=[],t.sel_UserMainStoryHardModeMissionInfo(main_story_hard_mode_mission_idx,mission),BattleService.prototype.getMainStoryHardModeMissionTaskListCheck(main_story_hard_mode_mission_idx,mission.task_list)},BattleService.prototype.getMainMissionInfo=function(main_mission_id,mission){var t=BattleTable.getInstance();mission.task_list=[],t.sel_UserMissionInfo(main_mission_id,mission),BattleService.prototype.getMainMissionTaskListCheck(main_mission_id,mission.task_list)},BattleService.prototype.getAutoPlayCostGold=function(battle_type,cost_gold){},BattleService.prototype.getMissionWinCount=function(main_mission_id){return BattleTable.getInstance().getMissionWinCount(main_mission_id)},BattleService.prototype.getMasterFxPartList=function(gnrl_group,gnrl_type,list){var eff_list=[];eff_list=MasterTable.getInstance().get_EffectDefinitionList(gnrl_group,gnrl_type,eff_list);for(var texture_list=[],i=0;i<eff_list.length;i++){var e=eff_list[i],p=new database.BattleFxPart;p.fx_part_id=e.num,p.gnrl_group=e.gnrl_group,p.gnrl_type=e.gnrl_type,p.fx_layer=e.layer,p.fx_atlas=RES_CDN_DEFULT+e.atlas+".atlas",p.fx_bone=RES_CDN_DEFULT+e.bone+".json",texture_list.length=0,texture_list=RES_CDN_DEFULT+e.textures.split(","),p.fx_pngs=[];for(var j=0;j<texture_list.length;j++){var t=texture_list[j];p.fx_pngs.push(t+".png")}p.fx_id=e.fx_id,p.velocity=e.speed,p.hit_point=e.hit_point,p.is_throwing_object=0!=e.projection,p.is_target_pos_use=0!=e.bone_target,p.is_bezier_use=0!=e.curved,p.curved_height=e.curved_hight,p.is_base_parent_target=0!=e.parent_target,p.is_used_flip=0!=e.flip,p.fx_sound=e.sound,p.is_loop=0!=e.is_loop,list.push(p),p=null}},BattleService.prototype.getMasterLoveStat=function(stat_group,love_level){return MasterTable.getInstance().get_LoveStatItem(stat_group,love_level).idx},BattleService.prototype.getMasterMissionBonusList=function(main_mission_id){var t=BattleTable.getInstance(),mission=MasterTable.getInstance().getMasterTable().get_MainMission(main_mission_id);return t.sel_MasterMissionBonusList(mission.main_mission_bonus_id)},BattleService.prototype.getMasterStoryHardModeMissionBonusList=function(story_hard_mode_mission_idx,list){for(var mission=MasterTable.getInstance().getMasterTable().get_MainStoryHardModeMission(story_hard_mode_mission_idx),bonus_list=MasterTable.getInstance().get_MainStoryHardModeMissionRewardItemList(mission.main_story_hard_mode_mission_reward_idx),idx=0;idx<bonus_list.length;idx++)if(bonus_list[idx].bonus_type==BONUS_TYPE_GROUP);else if(bonus_list[idx].bonus_type>=BONUS_TYPE_HWANDAN_1&&bonus_list[idx].bonus_type<=BONUS_TYPE_HWANDAN_7){if(-1==list.findIndex(function(ss){if(ss.item_type==database.BattleGainItemType.Hwandan&&ss.item_id==bonus_list[idx].bonus_type)return!0}))(s=$.extend({},db.BattleGainItem)).item_type=database.BattleGainItemType.Hwandan,s.item_id=bonus_list[idx].bonus_type,list.push_back(s)}else if(bonus_list[idx].bonus_type==BONUS_TYPE_YUNHEE_FIX){if(-1==list.findIndex(function(ss){if(ss.item_type==database.BattleGainItemType.General&&ss.item_id==bonus_list[idx].min_value)return!0}))(s=$.extend({},db.BattleGainItem)).item_type=database.BattleGainItemType.General,s.item_id=bonus_list[idx].min_value,s.item_level=1,list.push_back(s)}else if(bonus_list[idx].bonus_type==BONUS_TYPE_EVOLVE_STONE){if(-1==list.findIndex(function(ss){if(ss.item_type==database.BattleGainItemType.EvolveStone&&ss.item_id==bonus_list[idx].bonus_type)return!0}))(s=$.extend({},db.BattleGainItem)).item_type=database.BattleGainItemType.EvolveStone,s.item_id=bonus_list[idx].bonus_type,list.push_back(s)}else if(bonus_list[idx].bonus_type>=BONUS_TYPE_ATTK_POINT&&bonus_list[idx].bonus_type<=BONUS_TYPE_CRI_DMG_POINT){if(-1==list.findIndex(function(ss){if(ss.item_type==database.BattleGainItemType.FormationPropertyPoint&&ss.item_id==bonus_list[idx].bonus_type)return!0}))(s=$.extend({},db.BattleGainItem)).item_type=database.BattleGainItemType.FormationPropertyPoint,s.item_id=bonus_list[idx].bonus_type,list.push_back(s)}else if(bonus_list[idx].bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&bonus_list[idx].bonus_type<=BONUS_TYPE_EVOLVE_ARCHER){if(-1==list.findIndex(function(ss){if(ss.item_type==database.BattleGainItemType.ForceTypeEvolveMtrl&&ss.item_id==bonus_list[idx].bonus_type)return!0}))(s=$.extend({},db.BattleGainItem)).item_type=database.BattleGainItemType.ForceTypeEvolveMtrl,s.item_id=bonus_list[idx].bonus_type,list.push_back(s)}else if(bonus_list[idx].bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&bonus_list[idx].bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE){if(-1==list.findIndex(function(ss){if(ss.item_type==database.BattleGainItemType.ForceTypeEvolveMtrl&&ss.item_id==bonus_list[idx].bonus_type)return!0}))(s=$.extend({},db.BattleGainItem)).item_type=database.BattleGainItemType.ForceTypeEvolveMtrl,s.item_id=bonus_list[idx].bonus_type,list.push_back(s)}else if(bonus_list[idx].bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&bonus_list[idx].bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW){if(-1==list.findIndex(function(ss){if(ss.item_type==database.BattleGainItemType.ForceTypeEvolveMtrl&&ss.item_id==bonus_list[idx].bonus_type)return!0}))(s=$.extend({},db.BattleGainItem)).item_type=database.BattleGainItemType.ForceTypeEvolveMtrl,s.item_id=bonus_list[idx].bonus_type,list.push_back(s)}else if(bonus_list[idx].bonus_type==BONUS_TYPE_EVOLVE_ORB){if(-1==list.findIndex(function(ss){if(ss.item_type==database.BattleGainItemType.EvolveOrb&&ss.item_id==bonus_list[idx].bonus_type)return!0}))(s=$.extend({},db.BattleGainItem)).item_type=database.BattleGainItemType.EvolveOrb,s.item_id=bonus_list[idx].bonus_type,list.push_back(s)}else if(bonus_list[idx].bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&bonus_list[idx].bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE){if(-1==list.findIndex(function(ss){if(ss.item_type==database.BattleGainItemType.LoveItem&&ss.item_id==bonus_list[idx].bonus_type)return!0}.bind(this)))(s=$.extend({},db.BattleGainItem)).item_type=database.BattleGainItemType.LoveItem,s.item_id=bonus_list[idx].bonus_type,list.push_back(s)}else if(bonus_list[idx].bonus_type>=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1&&bonus_list[idx].bonus_type<=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_7||bonus_list[idx].bonus_type>=BONUS_TYPE_REBIRTH_MTRL_TYPE_1&&bonus_list[idx].bonus_type<=BONUS_TYPE_REBIRTH_MTRL_TYPE_7){if(-1==list.findIndex(function(ss){if(ss.item_type==database.BattleGainItemType.RebirthMtrl&&ss.item_id==bonus_list[idx].bonus_type)return!0}))(s=$.extend({},db.BattleGainItem)).item_type=database.BattleGainItemType.RebirthMtrl,s.item_id=bonus_list[idx].bonus_type,list.push_back(s)}else if(bonus_list[idx].bonus_type==BONUS_TYPE_GNRL_PIECE){if(-1==list.findIndex(function(ss){if(ss.item_type==database.BattleGainItemType.GnrlPiece&&ss.item_id==bonus_list[idx].bonus_type&&ss.gnrl_group==bonus_list[idx].min_value)return!0}))(s=$.extend({},db.BattleGainItem)).item_type=database.BattleGainItemType.GnrlPiece,s.item_id=bonus_list[idx].bonus_type,s.gnrl_group=bonus_list[idx].min_value,list.push_back(s)}else if(bonus_list[idx].bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||bonus_list[idx].bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL){if(-1==list.findIndex(function(ss){if(ss.item_type==database.BattleGainItemType.LimitOverMtrl&&ss.item_id==bonus_list[idx].bonus_type)return!0}))(s=$.extend({},db.BattleGainItem)).item_type=database.BattleGainItemType.LimitOverMtrl,s.item_id=bonus_list[idx].bonus_type,list.push_back(s)}else if(bonus_list[idx].bonus_type==BONUS_TYPE_SKIP_TICKET){if(-1==list.findIndex(function(ss){if(ss.item_type==database.BattleGainItemType.SkipTicket&&ss.item_id==bonus_list[idx].bonus_type)return!0}))(s=$.extend({},db.BattleGainItem)).item_type=database.BattleGainItemType.SkipTicket,s.item_id=bonus_list[idx].bonus_type,list.push_back(s)}else if(bonus_list[idx].bonus_type==BONUS_TYPE_EQUIPMENT){var s;if(-1==list.findIndex(function(ss){if(ss.item_type==database.BattleGainItemType.Equipment&&ss.item_id==bonus_list[idx].min_value)return!0}))(s=$.extend({},db.BattleGainItem)).item_type=database.BattleGainItemType.Equipment,s.item_id=bonus_list[idx].min_value,list.push_back(s)}},BattleService.prototype.getMasterWeeklyDungeon=function(list){var m=MasterTable.getInstance(),t=BattleTable.getInstance();t.sel_MasterWeeklyDungeon(list);for(var idx=0;idx<list.length;idx++)this.getMasterWeeklyDifficultyStageNpc(list[idx]);t.del_UserWeeklyDungeonOpenTime(m_user_id);for(var i=0;i<list.length;i++)list[i].weekly_period=t.sel_userWeeklyDungeonPeriod(list[i].weekly_dungeon.weekly_idx,list[i].weekly_period),list[i].weekly_period=stable(list[i].weekly_period,function(l,r){if(l.begin_date.valueOf()<r.begin_date.valueOf())return 1});for(var weekly_task_list=(new NetService).get_Weekly_TaskList(),db_task_list=[],listIdx=0;listIdx<list.length;listIdx++)for(var diffIdx=0;diffIdx<list[listIdx].weekly_difficulty.length;diffIdx++){list[listIdx].weekly_difficulty[diffIdx].task_list.clear(),db_task_list=m.get_WeeklyDungeonTaskList(list[listIdx].weekly_difficulty[diffIdx].weekly_difficulty.dungeon_idx);for(i=0;i<db_task_list.length;i++){var task_define=MasterManager.getInstance().get_WeeklyDungeonTaskDefine(db_task_list[i].weekly_dungeon_task_define_idx),new_task=$.extend({},database.BattleWeeklyDungeonTask);new_task.dungeon_idx=list[listIdx].weekly_difficulty[diffIdx].weekly_difficulty.dungeon_idx,new_task.num=db_task_list[i].num,new_task.task=db_task_list[i],new_task.task_define=task_define;for(var found=!1,foundIdx=new_task.clear_count=0,j=0;j<weekly_task_list.length;j++)if(db_task_list[i].dungeon_idx==weekly_task_list[j].weekly_idx&&db_task_list[i].num==weekly_task_list[j].num){found=!0,foundIdx=j;break}new_task.is_complete=1==found&&(new_task.clear_count=weekly_task_list[foundIdx].count,"y"==weekly_task_list[foundIdx].complete_yn),list[listIdx].weekly_difficulty[diffIdx].task_list.push_back(new_task)}}},BattleService.prototype.convertBonusInfoInternal=function(bonus_type,min_value,max_value,item){bonus_type>=BONUS_TYPE_HWANDAN_1&&bonus_type<=BONUS_TYPE_HWANDAN_7||bonus_type==BONUS_TYPE_YUBI_RARE?(item.item_type=database.BattleGainItemType.Hwandan,item.item_id=bonus_type,item.item_count=min_value):bonus_type==BONUS_TYPE_YUNHEE_FIX?(item.item_type=database.BattleGainItemType.General,item.item_id=min_value,item.item_level=1):bonus_type==BONUS_TYPE_EVOLVE_STONE?(item.item_type=database.BattleGainItemType.EvolveStone,item.item_id=bonus_type,item.item_count=min_value):bonus_type>=BONUS_TYPE_ATTK_POINT&&bonus_type<=BONUS_TYPE_CRI_DMG_POINT?(item.item_type=database.BattleGainItemType.FormationPropertyPoint,item.item_id=bonus_type,item.item_count=min_value):bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&bonus_type<=BONUS_TYPE_EVOLVE_ARCHER?(item.item_type=database.BattleGainItemType.ForceTypeEvolveMtrl,item.item_id=bonus_type,item.item_count=min_value):bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE?(item.item_type=database.BattleGainItemType.ForceTypeEvolveMtrl,item.item_id=bonus_type,item.item_count=min_value):bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW?(item.item_type=database.BattleGainItemType.ForceTypeEvolveMtrl,item.item_id=bonus_type,item.item_count=min_value):bonus_type==BONUS_TYPE_EVOLVE_ORB?(item.item_type=database.BattleGainItemType.EvolveOrb,item.item_id=bonus_type,item.item_count=min_value):bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE||bonus_type==BONUS_TYPE_YUBI_LOVE_ITEM||bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE?(item.item_type=database.BattleGainItemType.LoveItem,item.item_id=bonus_type,item.item_count=min_value):bonus_type==BONUS_TYPE_GOLD?(item.item_type=database.BattleGainItemType.Gold,item.item_id=bonus_type,item.item_count=min_value):bonus_type==BONUS_TYPE_JADE?(item.item_type=database.BattleGainItemType.Jade,item.item_id=bonus_type,item.item_count=min_value):bonus_type==BONUS_TYPE_HEART?(item.item_type=database.BattleGainItemType.Heart,item.item_id=bonus_type,item.item_count=min_value):bonus_type==BONUS_TYPE_EVENT_POINT?(item.item_type=database.BattleGainItemType.EventPoint,item.item_id=bonus_type,item.item_count=min_value):bonus_type>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&bonus_type<=BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND?(item.item_type=database.BattleGainItemType.CraftMtrl,item.item_id=bonus_type,item.item_count=min_value):bonus_type==BONUS_TYPE_EQUIPMENT?(item.item_type=database.BattleGainItemType.Equipment,item.item_id=min_value,item.item_count=max_value):bonus_type==BONUS_TYPE_EVENT_DUNGEON_SPECIAL_POINT?(item.item_type=database.BattleGainItemType.SpecialPoint,item.item_id=bonus_type,item.item_count=min_value):bonus_type>=BONUS_TYPE_JADE_RANDOM_BOX&&bonus_type<=BONUS_TYPE_CHRISTMAS_GIFT_BOX||bonus_type>=BONUS_TYPE_SWORD_ORB_RANDDOM_BOX&&bonus_type<=BONUS_TYPE_ARCHER_ORB_RANDDOM_BOX?(item.item_type=database.BattleGainItemType.RandomBox,item.item_id=bonus_type):bonus_type==BONUS_TYPE_JADE_RANDOM_BOX||bonus_type==BONUS_TYPE_GOLD_RANDOM_BOX||bonus_type==BONUS_TYPE_LOVE_ITEM_RANDOM_BOX||bonus_type==BONUS_TYPE_RARE_HWANDAN_RANDOM_BOX||bonus_type==BONUS_TYPE_EXP_CARD_RANDOM_BOX||bonus_type==BONUS_TYPE_CHRISTMAS_GIFT_BOX||bonus_type==BONUS_TYPE_SWORD_ORB_RANDDOM_BOX||bonus_type==BONUS_TYPE_SPEAR_ORB_RANDDOM_BOX||bonus_type==BONUS_TYPE_ARCHER_ORB_RANDDOM_BOX||bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_RANDOM_BOX||bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_GIFT_BOX||bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_1||bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_2||bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_3||bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_4?(item.item_type=database.BattleGainItemType.RandomBox,item.item_id=bonus_type):bonus_type==BONUS_TYPE_R_RARE_TYPE_ENGAGE||bonus_type==BONUS_TYPE_HR_RARE_TYPE_ENGAGE||bonus_type==BONUS_TYPE_SR_RARE_TYPE_ENGAGE||bonus_type==BONUS_TYPE_SSR_RARE_TYPE_SELECT||bonus_type==BONUS_TYPE_SR_OVER_GACHA_TICKET?(item.item_type=database.BattleGainItemType.RandomBox,item.item_id=bonus_type):bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL?(item.item_type=database.BattleGainItemType.LimitOverMtrl,item.item_id=bonus_type,item.item_count=min_value):bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL?(item.item_type=database.BattleGainItemType.MagicKeyPiece,item.item_id=bonus_type):bonus_type==BONUS_TYPE_NAMING?(item.item_type=database.BattleGainItemType.HeroNaming,item.item_id=bonus_type,item.item_level=min_value):(bonus_type>=BONUS_TYPE_CHRISTMAS_RIBBON&&bonus_type<=BONUS_TYPE_CHRISTMAS_SNOWMAN?item.item_type=database.BattleGainItemType.ETC:bonus_type>=BONUS_TYPE_REBIRTH_MTRL_TYPE_1&&bonus_type<=BONUS_TYPE_REBIRTH_MTRL_TYPE_7||bonus_type>=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1&&bonus_type<=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6?item.item_type=database.BattleGainItemType.RebirthMtrl:bonus_type==BONUS_TYPE_GREAT_WALL_TICKET?item.item_type=database.BattleGainItemType.GreatWallTicket:bonus_type==BONUS_TYPE_JADE_PIECE?item.item_type=database.BattleGainItemType.JadePiece:bonus_type==BONUS_TYPE_RAID_TICKET?item.item_type=database.BattleGainItemType.ETC:bonus_type==BONUS_TYPE_RAID_HELP_TICKET?item.item_type=database.BattleGainItemType.ETC:bonus_type==BONUS_TYPE_SKIP_TICKET?item.item_type=database.BattleGainItemType.SkipTicket:bonus_type==BONUS_TYPE_FORMATION_POINT||bonus_type==BONUS_TYPE_ATTK_POINT||bonus_type==BONUS_TYPE_DEF_POINT||bonus_type==BONUS_TYPE_HP_POINT||bonus_type==BONUS_TYPE_CRI_PRCNT_POINT||bonus_type==BONUS_TYPE_CRI_DMG_POINT?item.item_type=database.BattleGainItemType.FormationPropertyPoint:bonus_type==BONUS_TYPE_WORLD_WAR_UNIQUE_EQUIPMENT_TICKET?item.item_type=database.BattleGainItemType.ETC:bonus_type==BONUS_TYPE_SSR_GACHA_TICKET?item.item_type=database.BattleGainItemType.GachaTicket:item.item_type=database.BattleGainItemType.ETC,item.item_id=bonus_type,item.item_count=min_value)},BattleService.prototype.convertBonusInfo=function(bonus,item){this.convertBonusInfoInternal(bonus.bonus_type,bonus.min_value,bonus.max_value,item),bonus.bonus_type!=BONUS_TYPE_EQUIPMENT&&item.item_count<bonus.min_value&&(item.item_count=bonus.min_value)},BattleService.prototype.convertBonusInfoEventMussangBossRewardInfo=function(bonus,item){this.convertBonusInfoInternal(bonus.bonus_type,bonus.min_value,bonus.max_value,item)},BattleService.prototype.convertBonusInfoTower=function(bonus,item){this.convertBonusInfoInternal(bonus.bonus_type,bonus.min_value,bonus.max_value,item),bonus.bonus_type==BONUS_TYPE_YUNHEE_FIX||bonus.bonus_type==BONUS_TYPE_JIN_FIX?item.item_count=bonus.max_value:bonus.bonus_type!=BONUS_TYPE_EQUIPMENT&&bonus.bonus_type!=BONUS_TYPE_EQUIPMENT&&item.item_count<bonus.min_value&&(item.item_count=bonus.min_value)},BattleService.prototype.convertBonusInfo3=function(b,item){this.convertBonusInfoInternal(b.bonus_type,b.min_value,b.max_value,item),b.bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX?item.item_count=1:b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER||b.bonus_type==BONUS_TYPE_YUBI_EVOLVE_HIGH?(item.item_count=b.min_value,item.item_level=1):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE||b.bonus_type==BONUS_TYPE_YUBI_EVOLVE_MIDDLE?(item.item_count=b.min_value,item.item_level=1):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW||b.bonus_type==BONUS_TYPE_YUBI_EVOLVE_LOW?(item.item_count=b.min_value,item.item_level=1):b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE||b.bonus_type==BONUS_TYPE_YUBI_LOVE_ITEM||b.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE?(item.item_count=b.min_value,item.item_level=1):item.item_count=b.min_value},BattleService.prototype.changeEventDungeonCutinStage=function(cutin_stage,event_dungeon_cutin_info_idx,stage_npc){var m=MasterManager.getInstance(),cutin_info=m.get_EventDungeonCutinInfo(event_dungeon_cutin_info_idx);if(0!=cutin_info.event_dungeon_cutin_info_idx){var npc_list=[],evt_npc=m.get_EventDungeonCutinNpc(cutin_info.event_dungeon_cutin_npc_idx);if(0<evt_npc.npc1_id){var npc=m.get_NpcGeneral(evt_npc.npc1_id);(hero=$.extend({},database.BattleGeneral)).is_cutin_npc=!0,hero.position=db.BattlePosition.Head,hero.is_zoom=0!=evt_npc.npc1_size,hero.npc_boss_type=evt_npc.npc1_size,hero.battle_stage=cutin_stage,this.setNpcGeneralData(hero,npc),npc_list.push(hero)}if(0<evt_npc.npc2_id){npc=m.get_NpcGeneral(evt_npc.npc2_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_1,hero.is_zoom=0!=evt_npc.npc2_size,hero.npc_boss_type=evt_npc.npc2_size,hero.battle_stage=cutin_stage,this.setNpcGeneralData(hero,npc),npc_list.push(hero)}if(0<evt_npc.npc3_id){npc=m.get_NpcGeneral(evt_npc.npc3_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_2,hero.is_zoom=0!=evt_npc.npc3_size,hero.npc_boss_type=evt_npc.npc3_size,hero.battle_stage=cutin_stage,this.setNpcGeneralData(hero,npc),npc_list.push(hero)}if(0<evt_npc.npc4_id){npc=m.get_NpcGeneral(evt_npc.npc4_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_1,hero.is_zoom=0!=evt_npc.npc4_size,hero.npc_boss_type=evt_npc.npc4_size,hero.battle_stage=cutin_stage,this.setNpcGeneralData(hero,npc),npc_list.push(hero)}if(0<evt_npc.npc5_id){var hero;npc=m.get_NpcGeneral(evt_npc.npc5_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_2,hero.is_zoom=0!=evt_npc.npc5_size,hero.npc_boss_type=evt_npc.npc5_size,hero.battle_stage=cutin_stage,this.setNpcGeneralData(hero,npc),npc_list.push(hero)}0<npc_list.length&&(npc_list.sort(function(left,right){return left.position>right.position?1:left.position<right.position?-1:0}),stage_npc.insert(cutin_stage,npc_list))}},BattleService.prototype.getMasterEventDungeonStageNpc=function(event_dungeon_idx,dungeon){var m=MasterManager.getInstance();dungeon.stage_count=3;for(var npc_list=[],b=0;b<dungeon.stage_count;b++){var hero,battle_num=b+1,evt_npc=m.get_EventDungeonNpc(event_dungeon_idx,battle_num);if(npc_list=[],0<evt_npc.npc1_id)(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Head,hero.is_zoom=0!=evt_npc.npc1_size,hero.npc_boss_type=evt_npc.npc1_size,hero.battle_stage=battle_num,hero.npc_id=evt_npc.npc1_id,npc_list.push(hero);if(0<evt_npc.npc2_id)(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_1,hero.is_zoom=0!=evt_npc.npc2_size,hero.npc_boss_type=evt_npc.npc2_size,hero.battle_stage=battle_num,hero.npc_id=evt_npc.npc2_id,npc_list.push(hero);if(0<evt_npc.npc3_id)(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_2,hero.is_zoom=0!=evt_npc.npc3_size,hero.npc_boss_type=evt_npc.npc3_size,hero.battle_stage=battle_num,hero.npc_id=evt_npc.npc3_id,npc_list.push(hero);if(0<evt_npc.npc4_id)(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_1,hero.is_zoom=0!=evt_npc.npc4_size,hero.npc_boss_type=evt_npc.npc4_size,hero.battle_stage=battle_num,hero.npc_id=evt_npc.npc4_id,npc_list.push(hero);if(0<evt_npc.npc5_id)(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_2,hero.is_zoom=0!=evt_npc.npc5_size,hero.npc_boss_type=evt_npc.npc5_size,hero.battle_stage=battle_num,hero.npc_id=evt_npc.npc5_id,npc_list.push(hero);0<npc_list.length&&(npc_list.sort(function(left,right){return left.position>right.position?1:left.position<right.position?-1:0}),dungeon.stage_npc.insert(battle_num,npc_list))}},BattleService.prototype.getUserEventDungeonOnceADay=function(event_dungeon_period_idx,event_dungeon_once_a_day_idx,dungeon){var t=BattleTable.getInstance();t.sel_MasterEventDungeonOnceADay(event_dungeon_period_idx,event_dungeon_once_a_day_idx,dungeon),this.getMasterEventDungeonOnceADayStageNpc(event_dungeon_once_a_day_idx,dungeon),t.sel_UserEventDungeonOnceADay(m_user_id,dungeon)},BattleService.prototype.getMasterEventDungeonOnceADayStageNpc=function(event_dungeon_once_a_day_idx,dungeon){var m=MasterManager.getInstance();dungeon.stage_count=3;for(var npc_list=[],b=0;b<dungeon.stage_count;b++){var hero,battle_num=b+1,evt_npc=m.get_EventDungeonOnceADayNpc(event_dungeon_once_a_day_idx,battle_num);if(npc_list=[],0<evt_npc.npc1_id)(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Head,hero.is_zoom=0!=evt_npc.npc1_size,hero.npc_boss_type=evt_npc.npc1_size,hero.battle_stage=battle_num,hero.npc_id=evt_npc.npc1_id,npc_list.push(hero);if(0<evt_npc.npc2_id)(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_1,hero.is_zoom=0!=evt_npc.npc2_size,hero.npc_boss_type=evt_npc.npc2_size,hero.battle_stage=battle_num,hero.npc_id=evt_npc.npc2_id,npc_list.push(hero);if(0<evt_npc.npc3_id)(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_2,hero.is_zoom=0!=evt_npc.npc3_size,hero.npc_boss_type=evt_npc.npc3_size,hero.battle_stage=battle_num,hero.npc_id=evt_npc.npc3_id,npc_list.push(hero);if(0<evt_npc.npc4_id)(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_1,hero.is_zoom=0!=evt_npc.npc4_size,hero.npc_boss_type=evt_npc.npc4_size,hero.battle_stage=battle_num,hero.npc_id=evt_npc.npc4_id,npc_list.push(hero);if(0<evt_npc.npc5_id)(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_2,hero.is_zoom=0!=evt_npc.npc5_size,hero.npc_boss_type=evt_npc.npc5_size,hero.battle_stage=battle_num,hero.npc_id=evt_npc.npc5_id,npc_list.push(hero);0<npc_list.length&&(npc_list.sort(function(left,right){return left.position>right.position?1:left.position<right.position?-1:0}),dungeon.stage_npc.insert(battle_num,npc_list))}},BattleService.prototype.getUserEventDungeonOnceADayList=function(event_dungeon_period_idx,dungeon_sub_type){for(var t=BattleTable.getInstance(),list=t.sel_MasterEventDungeonOnceADAyList(event_dungeon_period_idx,dungeon_sub_type),idx=0;idx<list.length;idx++){var d=list[idx];this.getMasterEventDungeonOnceADayStageNpc(d.dungeon.event_dungeon_once_a_day_idx,d),0==d.dungeon.open_preview_dungeon_idx&&(d.is_open_pre_event_dungeon=!0)}t.sel_UserEventDungeonOnceADayList(m_user_id,list);for(var user_list=[],i=0;i<list.length;i++){var e=list[i];-1==list.findIndex(function(dungeon){return e.dungeon.open_preview_dungeon_idx==dungeon.dungeon.event_dungeon_once_a_day_idx&&dungeon.is_complete})&&0!=e.dungeon.open_preview_dungeon_idx||(e.is_open_pre_once_a_day_dungeon=!0),1!=e.is_complete&&user_list.push(e)}return list=user_list},BattleService.prototype.getUserEventDungeon=function(event_dungeon_period_idx,event_dungeon_idx,dungeon){var t=BattleTable.getInstance();t.sel_MasterEventDungeon(event_dungeon_period_idx,event_dungeon_idx,dungeon),this.getMasterEventDungeonStageNpc(event_dungeon_idx,dungeon),t.sel_UserEventDungeon(m_user_id,dungeon)},BattleService.prototype.getUserEventDungeonOnceADayList_v2=function(event_dungeon_period_idx){for(var t=BattleTable.getInstance(),list=t.sel_MasterEventDungeonOnceADAyList_v2(event_dungeon_period_idx),idx=0;idx<list.length;idx++){var d=list[idx];this.getMasterEventDungeonOnceADayStageNpc(d.dungeon.event_dungeon_once_a_day_idx,d),0==d.dungeon.open_preview_dungeon_idx&&(d.is_open_pre_once_a_day_dungeon=!0)}t.sel_UserEventDungeonOnceADayList(m_user_id,list);for(var i=0;i<list.length;i++){-1==list.findIndex(function(dungeon){return list[i].dungeon.open_preview_dungeon_idx==dungeon.dungeon.event_dungeon_once_a_day_idx&&dungeon.is_complete})&&0!=list[i].dungeon.open_preview_dungeon_idx||(list[i].is_open_pre_once_a_day_dungeon=!0)}return list},BattleService.prototype.getUserEventDungeonList=function(event_dungeon_period_idx,list){var t=BattleTable.getInstance();list=t.sel_MasterEventDungeonList(event_dungeon_period_idx,list);for(var idx=0;idx<list.length;idx++){var d=list[idx];this.getMasterEventDungeonStageNpc(d.event_dungeon.event_dungeon_idx,d),0==d.event_dungeon.open_event_dungeon_idx&&(d.is_open_pre_event_dungeon=!0)}t.sel_UserEventDungeonList(list);for(var i=0;i<list.length;i++){var e=list[i];-1==list.findIndex(function(dungeon){return e.event_dungeon.open_event_dungeon_idx==dungeon.event_dungeon.event_dungeon_idx&&dungeon.is_complete})&&0!=e.event_dungeon.open_event_dungeon_idx||(e.is_open_pre_event_dungeon=!0)}return list},BattleService.prototype.getRaidDungeonStageNpc=function(main_mission_id,raid){var m=MasterManager.getInstance();raid.stage_count=1;var npc_list=[],info=m.get_RaidBossInfo(raid.data.raid_boss_info_idx),level_info=m.get_RaidBossLevelInfo(raid.data.raid_boss_info_idx,raid.data.boss_level),hero=$.extend({},database.BattleGeneral);raid.limit_time=info.limit_time,hero.is_zoom=!0,hero.npc_boss_type=7,hero.position=db.BattlePosition.Head,this.setRaidGenernalData(hero,info,level_info),npc_list.push(hero),0<npc_list.length&&(npc_list.sort(function(left,right){return left.position>right.position?1:left.position<right.position?-1:0}),raid.stage_npc.insert(0,npc_list))},BattleService.prototype.getMussangTowerTaskListCheck=function(mussang_tower_id){for(var t=BattleTable.getInstance(),list=[],task_list=MasterTable.getInstance().get_MussangTowerTaskList(mussang_tower_id),i=0;i<task_list.size();i++){var mussang_task=task_list[i],task=MasterManager.getInstance().get_Task(mussang_task.task_id),task_type=MasterManager.getInstance().get_TaskType(task.task_type),data=new database.BattleMussangTowerTask;data.mussang_tower_id=mussang_tower_id,data.task_id=mussang_task.task_id,data.bonus_type=mussang_task.bonus_type,data.min_value=mussang_task.min_value,data.max_value=mussang_task.max_value,data.task=task,data.task_type=task_type,list.push_back(data)}return t.upd_UserMussangTowerTaskListCheck(list),list},BattleService.prototype.getMussangTowerLotusBonusLists=function(list){for(var bonus_list=MasterTable.getInstance().get_MussangTowerLotusBonusList(),idx=0;idx<bonus_list.length;idx++){var bonus=bonus_list[idx],found=list.findIndex(function(lotus_bonus){if(lotus_bonus.lotus_count==bonus.lotus_count)return!0});if(-1==found){var lotus_bonus=new database.BattleMussangTowerLotusBonus;lotus_bonus.lotus_count=bonus.lotus_count,lotus_bonus.lotus_bonus_list=[],lotus_bonus.lotus_bonus_list.push_back(bonus),list.push(lotus_bonus)}else list[found].lotus_bonus_list.push_back(bonus);BattleTable.getInstance().upd_UserMussangTowerLotusBonusCheck(m_user_id,list)}BattleTable.getInstance().upd_UserMussangTowerLotusBonusCheck(list)},BattleService.prototype.getWorldWarNpcDungeonStageNpc=function(dungeon){var m=MasterManager.getInstance();dungeon.stage_count=1,dungeon.stage_npc=new Map;for(var battle_num=0,i=0;i<dungeon.stage_count;i++){battle_num=i+1;var stage=m.get_WorldWarNpc(dungeon.npc_troops.world_war_npc_idx,battle_num),npc_list=[];if(0<stage.npc1_id){var npc=m.get_NpcGeneral(stage.npc1_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Head,hero.is_zoom=0<stage.npc1_size,hero.npc_boss_type=stage.npc1_size,hero.battle_stage=stage.battle_num,-1!=(found=dungeon.npc_troops.troops_generals.findIndex(function(n){return!!(hero.gnrl_id=n.gnrl_id&&n.position==hero.position)}))&&(hero.remain_hp_rate=dungeon.npc_troops.troops_generals[found].remain_hp),0<hero.remain_hp_rate&&(this.setNpcGeneralData(hero,npc),npc_list.push(hero))}if(0<stage.npc2_id){npc=m.get_NpcGeneral(stage.npc2_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_1,hero.is_zoom=0<stage.npc2_size,hero.npc_boss_type=stage.npc2_size,hero.battle_stage=stage.battle_num,-1!=(found=dungeon.npc_troops.troops_generals.findIndex(function(n){return!!(hero.gnrl_id=n.gnrl_id&&n.position==hero.position)}))&&(hero.remain_hp_rate=dungeon.npc_troops.troops_generals[found].remain_hp),0<hero.remain_hp_rate&&(this.setNpcGeneralData(hero,npc),npc_list.push(hero))}if(0<stage.npc3_id){npc=m.get_NpcGeneral(stage.npc3_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_2,hero.is_zoom=0<stage.npc3_size,hero.npc_boss_type=stage.npc3_size,hero.battle_stage=stage.battle_num,-1!=(found=dungeon.npc_troops.troops_generals.findIndex(function(n){return!!(hero.gnrl_id=n.gnrl_id&&n.position==hero.position)}))&&(hero.remain_hp_rate=dungeon.npc_troops.troops_generals[found].remain_hp),0<hero.remain_hp_rate&&(this.setNpcGeneralData(hero,npc),npc_list.push(hero))}if(0<stage.npc4_id){npc=m.get_NpcGeneral(stage.npc4_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_1,hero.is_zoom=0<stage.npc4_size,hero.npc_boss_type=stage.npc4_size,hero.battle_stage=stage.battle_num,-1!=(found=dungeon.npc_troops.troops_generals.findIndex(function(n){return!!(hero.gnrl_id=n.gnrl_id&&n.position==hero.position)}))&&(hero.remain_hp_rate=dungeon.npc_troops.troops_generals[found].remain_hp),0<hero.remain_hp_rate&&(this.setNpcGeneralData(hero,npc),npc_list.push(hero))}if(0<stage.npc5_id){var hero,found;npc=m.get_NpcGeneral(stage.npc5_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_2,hero.is_zoom=0<stage.npc5_size,hero.npc_boss_type=stage.npc5_size,hero.battle_stage=stage.battle_num,-1!=(found=dungeon.npc_troops.troops_generals.findIndex(function(n){return!!(hero.gnrl_id=n.gnrl_id&&n.position==hero.position)}))&&(hero.remain_hp_rate=dungeon.npc_troops.troops_generals[found].remain_hp),0<hero.remain_hp_rate&&(this.setNpcGeneralData(hero,npc),npc_list.push(hero))}0!=npc_list.length&&(npc_list.sort(function(l,r){return l.position-r.position}),dungeon.stage_npc.insert(stage.battle_num,npc_list))}},BattleService.prototype.getMasterMussangTowerStepStageNpc=function(mussang_tower_id,mussang_tower){var m=MasterManager.getInstance(),tower_step=m.get_MussangTowerStep(mussang_tower_id);mussang_tower.mussang_tower_id=mussang_tower_id,mussang_tower.mussang_tower=tower_step,mussang_tower.stage_count=1,mussang_tower.stage_npc=new Map;for(var i=0;i<mussang_tower.stage_count;i++){var stage=m.get_MussangTowerNpc(mussang_tower_id,i+1),npc_list=[];if(0<stage.npc1_id){var npc=m.get_NpcGeneral(stage.npc1_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Head,hero.is_zoom=0<stage.npc1_size,hero.npc_boss_type=stage.npc1_size,hero.battle_stage=stage.battle_num,this.setNpcGeneralData(hero,npc),npc_list.push_back(hero)}if(0<stage.npc2_id){npc=m.get_NpcGeneral(stage.npc2_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_1,hero.is_zoom=0<stage.npc2_size,hero.npc_boss_type=stage.npc2_size,hero.battle_stage=stage.battle_num,this.setNpcGeneralData(hero,npc),npc_list.push_back(hero)}if(0<stage.npc3_id){npc=m.get_NpcGeneral(stage.npc3_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Body_2,hero.is_zoom=0<stage.npc3_size,hero.npc_boss_type=stage.npc3_size,hero.battle_stage=stage.battle_num,this.setNpcGeneralData(hero,npc),npc_list.push_back(hero)}if(0<stage.npc4_id){npc=m.get_NpcGeneral(stage.npc4_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_1,hero.is_zoom=0<stage.npc4_size,hero.npc_boss_type=stage.npc4_size,hero.battle_stage=stage.battle_num,this.setNpcGeneralData(hero,npc),npc_list.push_back(hero)}if(0<stage.npc5_id){var hero;npc=m.get_NpcGeneral(stage.npc5_id);(hero=$.extend({},database.BattleGeneral)).position=db.BattlePosition.Tail_2,hero.is_zoom=0<stage.npc5_size,hero.npc_boss_type=stage.npc5_size,hero.battle_stage=stage.battle_num,this.setNpcGeneralData(hero,npc),npc_list.push_back(hero)}0!=npc_list.length&&(npc_list.sort(function(l,r){return l.position-r.position}),mussang_tower.stage_npc.insert(stage.battle_num,npc_list))}},BattleService.prototype.getEventMussangBossStageNpc=function(MussangBoss_Dungeon_idx,dungeon){var m=MasterManager.getInstance();dungeon.stage_count=1;var npc_list=[];npc_list.clear();m.get_EventDungeonMussangBossInfo(dungeon.data.boss_dungeon_idx,dungeon.data.event_dungeon_period_idx);var hero=$.extend({},database.BattleGeneral),npc_info=m.get_EventDungeonMussangBossNpcInfo(dungeon.data.boss_dungeon_idx,1);hero.is_zoom=!0,hero.npc_id=npc_info.npc1_id,hero.npc_boss_type=11,hero.position=db.BattlePosition.Head,this.setNpcGeneralData(hero),npc_list.push_back(hero),npc_list.empty()||(npc_list.sort(function(l,r){return l.position-r.position}),dungeon.stage_npc.insert(0,npc_list))},BattleService.prototype.loadBattleScript=function(deferred,type,script_id,occured_type){var worker=new Worker(WEB_WORKER),file_name="",battle_type=0;battle_type="event_dungeon"==type?(file_name="event_dungeon_script",1):(file_name="main_mission_script",2),worker.postMessage({cmd:"loadBattleScript",url:master_json+file_name+".jbin",key:{script_id:script_id,occured_type:occured_type,type:type}}),worker.onmessage=function(evt){evt.data.length,1==battle_type?MasterManager.getInstance().set_EventDungeonScript(evt.data):MasterManager.getInstance().set_MainMissionScript(evt.data),deferred.resolve(!0)}},{getInstance:function(){return void 0===instance&&(instance=new BattleService),instance}}}(),MissionService=function(){var instance,m_main_User_mission=[],m_main_User_story=[],m_main_User_missionTask=[],m_main_User_lotus_bonus_log=[];function MissionService(){}return MissionService.prototype.loadUserMainStroy=function(){m_main_User_story=[];for(var user_main_story=NetService().get_User_main_story(),keys=user_main_story.keys(),i=0;i<keys.length;i++)m_main_User_story.push(user_main_story.at(keys[i]))},MissionService.prototype.loadUserMainMission=function(){},MissionService.prototype.loadUserMainMissionTask=function(){},MissionService.prototype.loadUserMainLotusBonusLog=function(){m_main_User_lotus_bonus_log=[];for(var keys=NetService().get_Main_Story_Lotus_Bonus_Log().keys(),i=0;i<keys.length;i++){var info=NetService().get_Main_Story_Lotus_Bonus_Log().at(keys[i]);m_main_User_lotus_bonus_log.push(info)}},MissionService.prototype.getUserMainStoryHardModeLotusLog=function(story){for(var user_lotus_log=NetService().get_user_main_story_hard_mode_lotus_reward_log().lotus_reward_log,i=0;i<story.lotus_rewards.length;i++)for(var idx=0;idx<user_lotus_log.length;idx++)user_lotus_log[idx].difficult==story.lotus_rewards[i].lotus_reward.difficult&&user_lotus_log[idx].main_story_id==story.lotus_rewards[i].lotus_reward.main_story_id&&user_lotus_log[idx].lotus_count==story.lotus_rewards[i].lotus_reward.lotus_count&&(story.lotus_rewards[i].is_complete="y"==user_lotus_log[idx].complete_yn,story.lotus_rewards[i].is_new="y"==user_lotus_log[idx].new_yn)},MissionService.prototype.getUserMainStoryHardMode=function(difficult){for(var m=MasterTable.getInstance(),list=MissionTable.getInstance().sel_MasterStoryHardModeList(difficult),i=0;i<list.length;i++){for(var story=list[i],im=0;im<story.mission_list.length;im++)this.getUserMainStoryHardModeMission(story.mission_list[im]);this.getUserMainStoryHardModeLotusLog(story);var prev_story=list.findIndex(function(s){return s.main_story.main_story_id==story.main_story.main_story_id-1}.bind(this)),next_story=list.findIndex(function(s){return s.main_story.main_story_id==story.main_story.main_story_id+1}.bind(this));if(-1!=prev_story){var is_open_cond_complete=!0;if(list[prev_story].is_complete)if(-1!=(not_complete_mission=story.mission_list.findIndex(function(mi){return!mi.is_complete}.bind(this)))){var open_cond_list=[];open_cond_list=m.get_MainStoryHardModeOpenCondList(story.difficult,story.main_story.main_story_id);for(var idx=0;idx<open_cond_list.length;idx++){if(1==(cond=open_cond_list[idx]).open_cond_type)if(1==cond.value1){if(!this.IsOpenMainMission(cond.value2)){is_open_cond_complete=!1;break}}else if(2==cond.value1)continue}story.is_complete=(story.is_new=!!is_open_cond_complete,!1)}else story.is_complete=!0,story.is_new=!1;else story.is_complete=!1,story.is_new=!1}else{var not_complete_mission=story.mission_list.findIndex(function(mi){return!mi.is_complete}.bind(this));story.is_complete=-1!=not_complete_mission?!(story.is_new=!0):!(story.is_new=!1)}}for(i=0;i<list.length;i++){story=list[i],open_cond_list=[];open_cond_list=m.get_MainStoryHardModeOpenCondList(story.difficult,story.main_story.main_story_id);var is_first_mission_open_cond_complete=!0;for(idx=0;idx<open_cond_list.size();idx++){if(1==(cond=open_cond_list[idx]).open_cond_type)if(1==cond.value1){if(!this.IsOpenMainMission(cond.value2)){is_first_mission_open_cond_complete=!1;break}}else if(2==cond.value1&&!this.IsOpenMainStoryHardModeMission(cond.value2)){is_first_mission_open_cond_complete=!1;break}}prev_story=list.findIndex(function(s){return s.main_story.main_story_id==story.main_story.main_story_id-1}.bind(this)),next_story=list.findIndex(function(s){return s.main_story.main_story_id==story.main_story.main_story_id+1}.bind(this));if(-1!=prev_story)for(list[prev_story],idx=0;idx<story.mission_list.length;idx++){var mission=story.mission_list[idx],prev_mission=story.mission_list.findIndex(function(mi){return mi.mission.mission_num==mission.mission.mission_num-1}.bind(this)),next_mission=story.mission_list.findIndex(function(mi){return mi.mission.mission_num==mission.mission.mission_num+1}.bind(this));if(-1!=prev_mission){if(!story.mission_list[prev_mission].is_complete){mission.is_new=!1;break}if(mission.is_complete)if(-1==next_mission)if(-1==next_story)mission.is_new=!0;else{var is_next_story_open_cond=!0;open_cond_list=[],open_cond_list=m.get_MainStoryHardModeOpenCondList(list[next_story].difficult,list[next_story].main_story.main_story_id);for(var icond=0;icond<open_cond_list.length;icond++){if(1==(cond=open_cond_list[icond]).open_cond_type)if(1==cond.value1){if(!this.IsOpenMainMission(cond.value2)){is_next_story_open_cond=!1;break}}else if(2==cond.value1&&!this.IsOpenMainStoryHardModeMission(cond.value2)){is_next_story_open_cond=!1;break}}is_next_story_open_cond&&(list[next_story].is_complete||list[next_story].is_new)?mission.is_new=!1:mission.is_new=!0}else mission.is_new=!1;else mission.is_new=!0}else is_first_mission_open_cond_complete?mission.is_complete?mission.is_new=!1:mission.is_new=!0:mission.is_new=!1}else for(idx=0;idx<story.mission_list.length;idx++){mission=story.mission_list[idx],prev_mission=story.mission_list.findIndex(function(mi){return mi.mission.mission_num==mission.mission.mission_num-1}.bind(this)),next_mission=story.mission_list.findIndex(function(mi){return mi.mission.mission_num==mission.mission.mission_num+1}.bind(this));if(-1!=prev_mission){if(!story.mission_list[prev_mission].is_complete){mission.is_new=!1;break}if(mission.is_complete)if(-1==next_mission){is_next_story_open_cond=!0;open_cond_list=m.get_MainStoryHardModeOpenCondList(list[next_story].difficult,list[next_story].main_story.main_story_id);for(icond=0;icond<open_cond_list.length;icond++){var cond;if(1==(cond=open_cond_list[icond]).open_cond_type)if(1==cond.value1){if(!this.IsOpenMainMission(cond.value2)){is_next_story_open_cond=!1;break}}else if(2==cond.value1&&!this.IsOpenMainStoryHardModeMission(cond.value2)){is_next_story_open_cond=!1;break}}is_next_story_open_cond&&(list[next_story].is_complete||list[next_story].is_new)?mission.is_new=!1:mission.is_new=!0}else mission.is_new=!1;else mission.is_new=!0}else{if(!mission.is_complete){mission.is_new=!0;break}mission.is_new=!1}}}return list},MissionService.prototype.getUserMainStoryHardModeMission=function(mission){var user_mission_task=NetService().get_user_main_story_hard_mode_mission_tasks().user_mission_tasks,user_mission=NetService().get_user_main_story_hard_mode_missions().user_missions,m=MasterTable.getInstance(),found=user_mission.findIndex(function(mi){return mi.main_story_hard_mode_mission_idx==mission.main_story_hard_mode_mission_idx}.bind(this));if(-1!=found){var mi=user_mission[found];mission.is_complete="y"==mi.complete_yn,mission.is_complete||(mission.is_new=!0),mission.try_count=mi.daily_try_count,mission.charge_count=mi.daily_charge_count,mission.is_try_complete=mi.daily_try_count>=mission.mission.daily_try_max_count,mission.charge_info=m.get_MainStoryHardModeEnterChargeInfoList(mission.mission.enter_charge_group_idx);for(var i=0;i<mission.task_list.length;i++){var task_found=user_mission_task.findIndex(function(t){return t.main_story_hard_mode_mission_idx==mission.main_story_hard_mode_mission_idx&&t.task_id==mission.task_list[i].mission_task.task_id}.bind(this));-1!=task_found&&(mission.task_list[i].is_cleared="y"==user_mission_task[task_found].complete_yn)}}},MissionService.prototype.getUserMainStory=function(main_scene_id){var list=MissionTable.getInstance().sel_MasterMainStoryV2List(main_scene_id);return MissionTable.getInstance().sel_UserMainStoryV2List(list),list},MissionService.prototype.getNextStoryHardModeMissionId=function(main_story_hard_mode_mission_idx){var m=MasterTable.getInstance(),mission=m.getMasterTable().get_MainStoryHardModeMission(main_story_hard_mode_mission_idx),next_id=mission.main_story_hard_mode_mission_idx+10,next_main_story_hard_mode_mission_idx=0,next_mission=m.getMasterTable().get_MainStoryHardModeMission(next_id);if(next_mission.main_story_hard_mode_mission_idx==next_id)return next_main_story_hard_mode_mission_idx=next_mission.main_story_hard_mode_mission_idx;var mission_list,next_story_id=mission.main_story_id+1;return 0<(mission_list=m.get_MainStoryHardModeMissionList(mission.difficult,next_story_id)).length?next_main_story_hard_mode_mission_idx=mission_list[0].main_story_hard_mode_mission_idx:next_main_story_hard_mode_mission_idx},MissionService.prototype.getNextMissionId=function(main_mission_id){var m=MasterManager.getInstance().get_MainMission(main_mission_id);return MissionTable.getInstance().sel_MasterNextMainMissionId(m.main_scene_id,m.main_story_id,main_mission_id,m.difficulty_type,m.main_mission_num)},MissionService.prototype.IsOpenMainMission=function(main_mission_id){return MissionTable.getInstance().sel_UserMainMissionOpenCheck(main_mission_id)},MissionService.prototype.IsOpenMainStoryHardModeMission=function(main_story_hard_mode_mission_idx){var is_open=!1,user_missions=NetService().get_user_main_story_hard_mode_missions().user_missions,found_mission=user_missions.findIndex(function(mi){return mi.main_story_hard_mode_mission_idx==main_story_hard_mode_mission_idx}.bind(this));return-1!=found_mission&&(is_open="y"==user_missions[found_mission].complete_yn),is_open},{getInstance:function(){return void 0===instance&&(instance=new MissionService),instance},getUserMissionList:function(){return m_main_User_mission},getUserStoryList:function(){return m_main_User_story},getUserMissionTaskList:function(){return m_main_User_missionTask},getUserLotusBonusLogList:function(){return m_main_User_lotus_bonus_log}}}(),GeneralService=function(){var instance;function GeneralService(){[]}return GeneralService.prototype.getGeneral=function(gnrl_id){return MasterManager.getInstance().get_General(gnrl_id)},GeneralService.prototype.getGenralGropNum=function(gnrl_id){return MasterTable.getInstance().get_General(gnrl_id).gnrl_group},GeneralService.prototype.getGeneralFriendEffectContent=function(gnrl_id){var m=MasterTable.getInstance(),general=m.get_General(gnrl_id);return m.get_LeaderSkill(general.leader_skill_id).content},GeneralService.prototype.getUserGeneralInfo=function(key,info){var gnrl={},gnrl_key={};gnrl_key.gnrl_id=key.gnrl_id,gnrl_key.gnrl_num=key.gnrl_num,gnrl=NetService().getUserGeneral(gnrl,gnrl_key);var gnrls=[];NetService().getUserGeneral(gnrls);var hanven_gnrls=gnrls.filter(function(g){if(5==g.limit_step_id)return!0}),mt=MasterManager.getInstance();info.gnrl_id=gnrl_key.gnrl_id,info.gnrl_num=gnrl_key.gnrl_num,info.gnrl_level=gnrl.gnrl_level,info.gnrl_exp=gnrl.gnrl_exp,info.castle_id=gnrl.castle_id,info.love_level=gnrl.love_level,info.love_exp=gnrl.love_exp,info.limit_step_id=gnrl.limit_step_id,info.is_lock="y"==gnrl.lock_yn,info.using_in_camp="y"==gnrl.using_in_camp,info.used_in_camp="y"==gnrl.used_in_camp,info.buff_type=gnrl.buff_type,info.passive_skill=[],info.trans_passive_skill=[],info.leader_skill=[],info.special_leader_skill=[];var general=mt.get_General(info.gnrl_id),gender=mt.get_GeneralDivision(general.gnrl_group);(0==gnrl.display_class?info.display_class=general.gnrl_class:info.display_class=gnrl.display_class,info.gender_type=gender.general_gender_type,info.arm_service_type=general.arm_service_type,info.fight_type=general.fight_type,info.name=general.name,info.base_attk=general.attk,info.base_def=general.def,info.base_hp=general.hp,info.base_sp=general.sp,info.base_cri_prcnt=general.cri_percent,info.base_cri_ratio=general.cri_ratio,info.base_guard_rate=general.guard_rate,info.base_guard_decrease=general.guard_value,info.element_type=general.element_type,info.active_skill=general.active_skill_id,info.class_type=general.gnrl_class,info.cost=general.cost,info.gnrl_type=general.gnrl_type,info.gnrl_group=general.gnrl_group,info.arm_service_type=general.arm_service_type,info.skin_id=general.skin_id,info.bone_id=general.bone_id,info.max_class_type=general.evolution_max_class_type,info.combo_group_num=general.combo_group_num,info.evolution_group_num=general.evolution_group_num,info.frnd_effect=general.friend_num,info.love_stat_group=general.love_stat_group,info.evolution_mtrl_num=general.evolution_mtrl_num,info.sell_gold=general.sell_gold,info.sell_yhpt=general.sell_yhpt,info.sell_heaven_pt=0,info.level_exp_group=general.level_exp_group,info.rare_type=general.rare_type,info.passive_skill=[],info.trans_passive_skill=[],info.passive_skill.push(general.passive_skill_id),general.trans_passive_skill_id.split(",").forEach(function(p_id){var trans_passive_skill_id=parseInt(p_id);info.trans_passive_skill.push_back(trans_passive_skill_id)}),info.leader_skill.push(general.leader_skill_id),info.special_leader_skill_id=[],general.special_leader_skill_id.split(",").forEach(function(p_id){var special_leader_skill_id=parseInt(p_id);info.special_leader_skill.push(special_leader_skill_id)}),info.attk=this.getUserGeneralAttk(info),info.def=this.getUserGeneralDef(info),info.hp=this.getUserGeneralHp(info),info.sp=info.base_sp,info.cri_prcnt=this.getUserGeneralCriPrcnt(info),info.cri_ratio=this.getUserGeneralCriDmg(info),info.guard_rate=this.getUserGeneralDefPrcnt(info),info.guard_decrease=this.getUserGeneralDefDecrease(info),info.master_type=general.master_type,info.state_type=general.state_type,info.total_attk_pwr=info.attk+info.def+info.hp,0<info.limit_step_id?info.max_level=this.getLimitOverMaxLevel(info.limit_step_id):info.max_level=general.max_level,info.isPartner=this.isPartner(info.gnrl_id,info.gnrl_num),info.is_friend_partner=this.isFriendPartner(info.gnrl_id,info.gnrl_num),info.isEnabledEvolve=!1,info.isEnabledLimitOver=!1,info.is_enable_rebirth=!1,info.is_heaven_pt=!1,this.getGeneralHeavnePtInfo(info,hanven_gnrls),info.is_rebirth_object=this.isRebirthObject(info.class_type,info.gnrl_group,info.gnrl_type),info.max_level==info.gnrl_level)&&(info.isMaxLevel=!0,this.isEnabledEvolve(info)&&(info.isEnabledEvolve=!0),info.class_type>=info.max_class_type&&this.isEnabledLimitOver(info)&&(info.isEnabledLimitOver=!0));info.is_rebirth_object&&(this.isEnabledRebirth(info)&&(info.is_enable_rebirth=!0))},GeneralService.prototype.isExistGeneralInPosType=function(troops_num,pos_type){for(var isExist=!1,user_troops_general=NetService().getUserPartyGeneral(),keys=user_troops_general.keys(),idx=0;idx<keys.length;idx++)if(user_troops_general.at(keys[idx]).troops_num==troops_num&&user_troops_general.at(keys[idx]).position==pos_type){isExist=!0;break}return isExist},GeneralService.prototype.getBaseGeneralInfo=function(gnrl_id,info){var mt=MasterManager.getInstance();info.gnrl_id=gnrl_id,info.gnrl_level=1,info.gnrl_exp=0,info.love_level=1,info.love_exp=0,info.limit_step_id=0,info.passive_skill=[],info.trans_passive_skill=[],info.leader_skill=[],info.special_leader_skill=[];var general=mt.get_General(info.gnrl_id),gender=mt.get_GeneralDivision(general.gnrl_group);info.gender_type=gender.general_gender_type,info.arm_service_type=general.arm_service_type,info.fight_type=general.fight_type,info.name=general.name,info.base_attk=general.attk,info.base_def=general.def,info.base_hp=general.hp,info.base_sp=general.sp,info.base_cri_prcnt=general.cri_percent,info.base_cri_ratio=general.cri_ratio,info.base_guard_rate=general.guard_rate,info.base_guard_decrease=general.guard_value,info.element_type=general.element_type,info.active_skill=general.active_skill_id,info.class_type=general.gnrl_class,info.cost=general.cost,info.gnrl_type=general.gnrl_type,info.gnrl_group=general.gnrl_group,info.arm_service_type=general.arm_service_type,info.skin_id=general.skin_id,info.bone_id=general.bone_id,info.max_class_type=general.evolution_max_class_type,info.combo_group_num=general.combo_group_num,info.evolution_group_num=general.evolution_group_num,info.frnd_effect=general.friend_num,info.love_stat_group=general.love_stat_group,info.evolution_mtrl_num=general.evolution_mtrl_num,info.sell_gold=general.sell_gold,info.sell_yhpt=general.sell_yhpt,info.level_exp_group=general.level_exp_group,info.rare_type=general.rare_type,info.passive_skill.push(general.passive_skill_id),general.trans_passive_skill_id.split(",").forEach(function(p_id){var trans_passive_skill_id=parseInt(p_id);info.trans_passive_skill.push_back(trans_passive_skill_id)}),info.leader_skill.push(general.leader_skill_id),general.special_leader_skill_id=general.special_leader_skill_id+"";for(var leader_skill_list=general.special_leader_skill_id.split(","),jdx=0;jdx<leader_skill_list.length;jdx++){var s=leader_skill_list[jdx];info.special_leader_skill.push_back(1*s)}info.attk=this.getUserGeneralAttk(info),info.def=this.getUserGeneralDef(info),info.hp=this.getUserGeneralHp(info),info.sp=info.base_sp,info.cri_prcnt=this.getUserGeneralCriPrcnt(info),info.cri_ratio=this.getUserGeneralCriDmg(info),info.guard_rate=this.getUserGeneralDefPrcnt(info),info.guard_decrease=this.getUserGeneralDefDecrease(info),info.master_type=general.master_type,info.state_type=general.state_type,info.max_level=general.max_level,info.isPartner=!1,info.isEnabledEvolve=!1,info.isEnabledLimitOver=!1,info.is_friend_partner=!1,info.is_enable_rebirth=!1,info.is_rebirth_object=!1},GeneralService.prototype.getYunheeSelectList=function(select_type){var mt=MasterManager.getInstance(),own_list=[];NetService().getUserGeneral(own_list);for(var gacha_mng=mt.get_GachaTicketManagement(select_type),gnrl_ids=MasterTable.getInstance().get_GeneralChoiceTicketList(gacha_mng.gnrl_choice_id),gnrl_choice_id=gacha_mng.gnrl_choice_id,list=[],i=0;i<gnrl_ids.length;i++)if(gnrl_choice_id==gnrl_ids[i].gnrl_choice_id){var g=mt.get_General(gnrl_ids[i].gnrl_id),info=new db.UserGeneralInfo;info.gnrl_id=g.gnrl_id,info.name=g.name,info.gnrl_type=g.gnrl_type,info.state_type=g.state_type,info.class_type=g.gnrl_class,info.gnrl_group=g.gnrl_group,info.max_level=g.max_level,info.element_type=g.element_type,info.arm_service_type=g.arm_service_type,info.fight_type=g.fight_type,info.cost=g.cost,info.attk=g.attk,info.def=g.def,info.hp=g.hp,info.sp=g.sp,info.gnrl_level=1,info.sell_gold=g.sell_gold,info.sell_yhpt=g.sell_yhpt,info.level_exp_group=g.level_exp_group,info.max_class_type=g.evolution_max_class_type,info.rare_type=g.rare_type,info.passive_skill.push(g.passive_skill_id),info.leader_skill.push(g.leader_skill_id),g.trans_passive_skill_id.split(",").forEach(function(p_id){var trans_passive_skill_id=parseInt(p_id);info.trans_passive_skill.push_back(trans_passive_skill_id)});for(var ret_isOwn=!1,idx=0;idx<own_list.length;idx++){var gg=mt.get_General(own_list[idx].gnrl_id);if(info.gnrl_group==gg.gnrl_group&&gg.gnrl_type==GENERAL_TYPE_YUNHEE){ret_isOwn=!0;break}}info.is_own=ret_isOwn,info.total_attk_pwr=info.attk+info.def+info.hp,g.special_leader_skill_id=g.special_leader_skill_id+"";for(var leader_skill_list=g.special_leader_skill_id.split(","),jdx=0;jdx<leader_skill_list.length;jdx++){var s=leader_skill_list[jdx];info.special_leader_skill.push_back(1*s)}list.push(info)}return list},GeneralService.prototype.getMaxLevel=function(gnrl_id){return MasterManager.getInstance().get_General_freeze(gnrl_id).max_level},GeneralService.prototype.getLimitOverMaxLevel=function(limit_step_id){return MasterManager.getInstance().get_GeneralLimit(limit_step_id).ext_level_id},GeneralService.prototype.getLimitOverMaxStep=function(){return 0},GeneralService.prototype.isExistHighClassGeneral=function(gnrl_keys){var mt=MasterTable.getInstance();for(var gnrl_key in gnrl_keys){if(5<=mt.get_General_freeze(gnrl_key.gnrl_id).gnrl_class)return!0}return!1},GeneralService.prototype.isSameGeneralInTroops=function(troops_num,position,troops){var troopsList=this.getUserTroopsGeneralList(troops_num),selectGnrlId=troops.gnrl_id%1e3;for(var item in troopsList){if(null==troopsList[item].gnrl_id)break;var id=troopsList[item].gnrl_id%1e3;if(troopsList[item].pos_type!=position&&selectGnrlId==id&&troopsList[item].gnrl_num!=troops.gnrl_num)return{result:!0,pos:position=troopsList[item].pos_type}}return{result:!1,pos:position=0}},GeneralService.prototype.getUserGeneralMaterialSellList=function(list,yunhee_type){return null==yunhee_type&&(yunhee_type=0),0!=yunhee_type?this.getUserGeneralMaterialInfoList(list,yunhee_type):this.getUserGeneralMaterialInfoList(list),list=list.filter(function(l){var key={};return key.gnrl_id=l.gnrl_id,key.gnrl_num=l.gnrl_num,!l.is_lock&&!l.using_in_camp})},GeneralService.prototype.getUserGeneralSellList=function(list,state_type){if(null==state_type){this.getUserGeneralInfoList(list);var troops_list=[];this.getUserTroopsGeneralDistinctList(troops_list);var user_weekly_troops_general=NetService().getUserWeeklyTroopsGeneral(),ns_v2=NetService(),event_keys=(event_generals=ns_v2.get_User_Event_Dungeon_Search_Troops_Generals()).keys(),world_war_troops_generals=[];world_war_troops_generals=NetServiceV3.getInstance().getUserPartyGeneral();var w_service=WorldWarService.getInstance();list=(list=(list=list.filter(function(l){for(var idx=0;idx<troops_list.length;idx++){var troops=troops_list[idx],key={};if(key.gnrl_id=l.gnrl_id,key.gnrl_num=l.gnrl_num,l.gnrl_num==troops.gnrl_num||l.is_lock||l.using_in_camp)return!1}for(var eg_idx=0;eg_idx<event_keys.length;eg_idx++)for(var gnrl_list=event_generals.at(event_keys[eg_idx]),g_idx=0;g_idx<gnrl_list.length;g_idx++){if(gnrl_list[g_idx].gnrl_num==l.gnrl_num)return!1}for(var w=0;w<user_weekly_troops_general.length;w++)if(user_weekly_troops_general[w].gnrl_num==l.gnrl_num)return!1;for(var partin_generals=NetService().get_great_wall_troops_info().partin_generals,pg=0;pg<partin_generals.length;pg++)if(partin_generals[pg].gnrl_id==l.gnrl_id&&partin_generals[pg].gnrl_num==l.gnrl_num)return!1;if(!w_service.isWorldWarUnification()&&w_service.isWorldWarPeriodOpen())for(var keys=world_war_troops_generals.keys(),tg=0;tg<keys.length;tg++)if(world_war_troops_generals.at(keys[tg]).gnrl_id==l.gnrl_id&&world_war_troops_generals.at(keys[tg]).gnrl_num==l.gnrl_num)return!1;return!0})).filter(function(l){var key={};return key.gnrl_id=l.gnrl_id,key.gnrl_num=l.gnrl_num,!this.isPartnerGeneral(key)&&(!this.isFriendPartner(key.gnrl_id,key.gnrl_num)&&(!l.is_lock&&!l.using_in_camp))}.bind(this))).filter(function(l){var key={};return key.gnrl_id=l.gnrl_id,key.gnrl_num=l.gnrl_num,!this.isGnrlEquipping(key)}.bind(this))}else{this.getUserGeneralInfoList(list,state_type);troops_list=[];this.getUserTroopsGeneralDistinctList(troops_list);world_war_troops_generals=[];world_war_troops_generals=NetServiceV3.getInstance().getUserPartyGeneral();w_service=WorldWarService.getInstance();list=(list=(list=list.filter(function(l){for(var idx=0;idx<troops_list.length;idx++){var troops=troops_list[idx],key={};if(key.gnrl_id=l.gnrl_id,key.gnrl_num=l.gnrl_num,l.gnrl_num==troops.gnrl_num||l.is_lock||l.using_in_camp)return!1}return!0})).filter(function(l){var key={};return key.gnrl_id=l.gnrl_id,key.gnrl_num=l.gnrl_num,!this.isPartnerGeneral(key)&&(!this.isFriendPartner(key.gnrl_id,key.gnrl_num)&&(!l.is_lock&&!l.using_in_camp))}.bind(this))).filter(function(l){var key={};return key.gnrl_id=l.gnrl_id,key.gnrl_num=l.gnrl_num,!this.isGnrlEquipping(key)}.bind(this));event_keys=(event_generals=NetService().get_User_Event_Dungeon_Search_Troops_Generals()).keys();list=list.filter(function(l){for(var eg_idx=0;eg_idx<event_keys.length;eg_idx++)for(var gnrl_list=event_generals.at(event_keys[eg_idx]),g_idx=0;g_idx<gnrl_list.length;g_idx++){if(gnrl_list[g_idx].gnrl_num==l.gnrl_num)return!1}return!0}.bind(this));var event_generals=NetService().get_great_wall_troops_info().partin_generals;list=list.filter(function(l){for(var g_idx=0;g_idx<event_generals.length;g_idx++){var pg=event_generals[g_idx];if(pg.gnrl_id==l.gnrl_id&&pg.gnrl_num==l.gnrl_num)return!1}if(!w_service.isWorldWarUnification()&&w_service.isWorldWarPeriodOpen())for(var keys=world_war_troops_generals.keys(),tg=0;tg<keys.length;tg++)if(world_war_troops_generals.at(keys[tg]).gnrl_id==l.gnrl_id&&world_war_troops_generals.at(keys[tg]).gnrl_num==l.gnrl_num)return!1;return!0}.bind(this))}return list},GeneralService.prototype.getPassiveSkill=function(gnrl_group,gnrl_class){return 0},GeneralService.prototype.getHwandanCount=function(hwandan_class){var key={};return key.class_type=hwandan_class,NetService.map_User_Hwandan_Info[key].hwandan_count},GeneralService.prototype.getLoveItemCount=function(hwandan_class){return 0},GeneralService.prototype.getLoveItemName=function(love_id){return MasterManager.getInstance().get_LoveItem(love_id).name},GeneralService.prototype.getUserGeneralAttk=function(info){var m=MasterTable.getInstance().getMasterTable(),base_attk=info.base_attk;if(0!=info.limit_step_id){var limit_ability=m.get_GeneralLimitAbility(info.limit_step_id,info.rare_type);null==limit_ability&&cc.log(limit_ability.attk),base_attk*=limit_ability.attk}var g=m.get_General(info.gnrl_id),ab=MasterTable.getInstance().get_AbilityIncreaseInfo(g.rare_type,g.fight_type,g.gnrl_group);null==ab&&cc.log(ab.attk);var attk=base_attk+(info.gnrl_level-1)*ab.attk;info.class_type>YUNHEE_MAX_CLASS_TYPE&&(attk+=m.get_GeneralRebirthStatInfo(info.gnrl_group).attk);return attk},GeneralService.prototype.getUserGeneralDef=function(info){var m=MasterTable.getInstance().getMasterTable(),base_def=info.base_def;0!=info.limit_step_id&&(base_def*=m.get_GeneralLimitAbility(info.limit_step_id,info.rare_type).def);var g=m.get_General(info.gnrl_id),ab=MasterTable.getInstance().get_AbilityIncreaseInfo(g.rare_type,g.fight_type,g.gnrl_group),def=base_def+(info.gnrl_level-1)*ab.def;info.class_type>YUNHEE_MAX_CLASS_TYPE&&(def+=m.get_GeneralRebirthStatInfo(info.gnrl_group).def);return def},GeneralService.prototype.getUserGeneralHp=function(info){var m=MasterTable.getInstance().getMasterTable(),base_hp=info.base_hp;0!=info.limit_step_id&&(base_hp*=m.get_GeneralLimitAbility(info.limit_step_id,info.rare_type).hp);var g=m.get_General(info.gnrl_id),ab=MasterTable.getInstance().get_AbilityIncreaseInfo(g.rare_type,g.fight_type,g.gnrl_group),hp=base_hp+(info.gnrl_level-1)*ab.hp;info.class_type>YUNHEE_MAX_CLASS_TYPE&&(hp+=m.get_GeneralRebirthStatInfo(info.gnrl_group).hp);return hp},GeneralService.prototype.getUserGeneralCriPrcnt=function(info){var m=MasterTable.getInstance().getMasterTable(),base_cri_prcnt=info.base_cri_prcnt;0!=info.limit_step_id&&(base_cri_prcnt*=m.get_GeneralLimitAbility(info.limit_step_id,info.rare_type).cri_prcnt);(base_cri_prcnt/=100,info.class_type>YUNHEE_MAX_CLASS_TYPE)&&(base_cri_prcnt+=m.get_GeneralRebirthStatInfo(info.gnrl_group).cri_prcnt/100);return base_cri_prcnt},GeneralService.prototype.getUserGeneralCriDmg=function(info){var m=MasterTable.getInstance().getMasterTable(),base_cri_ratio=info.base_cri_ratio;0!=info.limit_step_id&&(base_cri_ratio*=m.get_GeneralLimitAbility(info.limit_step_id,info.rare_type).cri_rate);(base_cri_ratio/=100,info.class_type>YUNHEE_MAX_CLASS_TYPE)&&(base_cri_ratio+=m.get_GeneralRebirthStatInfo(info.gnrl_group).cri_ratio/100);return base_cri_ratio},GeneralService.prototype.getUserGeneralDefPrcnt=function(info){var m=MasterTable.getInstance().getMasterTable(),base_def_prcnt=info.base_guard_rate;0!=info.limit_step_id&&(base_def_prcnt*=m.get_GeneralLimitAbility(info.limit_step_id,info.rare_type).guard_rate);(base_def_prcnt/=100,info.class_type>YUNHEE_MAX_CLASS_TYPE)&&(base_def_prcnt+=m.get_GeneralRebirthStatInfo(info.gnrl_group).guard_rate/100);return base_def_prcnt},GeneralService.prototype.getUserGeneralDefDecrease=function(info){var m=MasterTable.getInstance().getMasterTable(),base_def_decrease=info.base_guard_decrease;0!=info.limit_step_id&&(base_def_decrease*=m.get_GeneralLimitAbility(info.limit_step_id,info.rare_type).guard_decrease);(base_def_decrease/=100,info.class_type>YUNHEE_MAX_CLASS_TYPE)&&(base_def_decrease+=m.get_GeneralRebirthStatInfo(info.gnrl_group).guard_decrease/100);return base_def_decrease},GeneralService.prototype.geEvolveTypeToArmServiceType=function(evolve_type){var arm_service_type=0;return evolve_type==EVOLVE_MTRL_TYPE_MELEE||evolve_type==EVOLVE_MTRL_TYPE_MELEE_MIDDLE||evolve_type==EVOLVE_MTRL_TYPE_MELEE_LOW?arm_service_type=ARMSERVICETYPE_INFANTRY:evolve_type==EVOLVE_MTRL_TYPE_ARCHER||evolve_type==EVOLVE_MTRL_TYPE_ARCHER_MIDDLE||evolve_type==EVOLVE_MTRL_TYPE_ARCHER_LOW?arm_service_type=ARMSERVICETYPE_ARCHER:evolve_type==EVOLVE_MTRL_TYPE_LANCER||evolve_type==EVOLVE_MTRL_TYPE_LANCER_MIDDLE||evolve_type==EVOLVE_MTRL_TYPE_LANCER_LOW?arm_service_type=ARMSERVICETYPE_SPEAR:evolve_type!=EVOLVE_MTRL_TYPE_YUBI_LOW&&evolve_type!=EVOLVE_MTRL_TYPE_YUBI_MIDDLE&&evolve_type!=EVOLVE_MTRL_TYPE_YUBI_HIGH||(arm_service_type=ARMSERVICETYPE_INFANTRY),arm_service_type},GeneralService.prototype.geEvolveTypeToArmServiceClassType=function(evolve_type){var class_type=0;return evolve_type==EVOLVE_MTRL_TYPE_MELEE||evolve_type==EVOLVE_MTRL_TYPE_ARCHER||evolve_type==EVOLVE_MTRL_TYPE_LANCER?class_type=EVOLVE_ARM_SERVICE_CLASS_TYPE_HIGH:evolve_type==EVOLVE_MTRL_TYPE_MELEE_MIDDLE||evolve_type==EVOLVE_MTRL_TYPE_ARCHER_MIDDLE||evolve_type==EVOLVE_MTRL_TYPE_LANCER_MIDDLE?class_type=EVOLVE_ARM_SERVICE_CLASS_TYPE_MIDDLE:evolve_type==EVOLVE_MTRL_TYPE_MELEE_LOW||evolve_type==EVOLVE_MTRL_TYPE_ARCHER_LOW||evolve_type==EVOLVE_MTRL_TYPE_LANCER_LOW?class_type=EVOLVE_ARM_SERVICE_CLASS_TYPE_LOW:evolve_type==EVOLVE_MTRL_TYPE_YUBI_HIGH?class_type=EVOLVE_ARM_SERVICE_CLASS_TYPE_EVENT_HIGH:evolve_type==EVOLVE_MTRL_TYPE_YUBI_MIDDLE?class_type=EVOLVE_ARM_SERVICE_CLASS_TYPE_EVENT_MIDDLE:evolve_type==EVOLVE_MTRL_TYPE_YUBI_LOW&&(class_type=EVOLVE_ARM_SERVICE_CLASS_TYPE_EVENT_LOW),class_type},GeneralService.prototype.getEvolveTypeToBonusType=function(mtrl_type){return mtrl_type==EVOLVE_MTRL_TYPE_CLASS_1?BONUS_TYPE_HWANDAN_1:mtrl_type==EVOLVE_MTRL_TYPE_CLASS_2?BONUS_TYPE_HWANDAN_2:mtrl_type==EVOLVE_MTRL_TYPE_CLASS_3?BONUS_TYPE_HWANDAN_3:mtrl_type==EVOLVE_MTRL_TYPE_CLASS_4?BONUS_TYPE_HWANDAN_4:mtrl_type==EVOLVE_MTRL_TYPE_CLASS_5?BONUS_TYPE_HWANDAN_5:mtrl_type==EVOLVE_MTRL_TYPE_CLASS_6?BONUS_TYPE_HWANDAN_6:mtrl_type==EVOLVE_MTRL_TYPE_MELEE?BONUS_TYPE_EVOLVE_MELEE:mtrl_type==EVOLVE_MTRL_TYPE_LANCER?BONUS_TYPE_EVOLVE_LANCER:mtrl_type==EVOLVE_MTRL_TYPE_ARCHER?BONUS_TYPE_EVOLVE_ARCHER:mtrl_type==EVOLVE_MTRL_TYPE_ORB?BONUS_TYPE_EVOLVE_ORB:mtrl_type==EVOLVE_MTRL_TYPE_MELEE_MIDDLE?BONUS_TYPE_EVOLVE_MELEE_MIDDLE:mtrl_type==EVOLVE_MTRL_TYPE_LANCER_MIDDLE?BONUS_TYPE_EVOLVE_LANCER_MIDDLE:mtrl_type==EVOLVE_MTRL_TYPE_ARCHER_MIDDLE?BONUS_TYPE_EVOLVE_ARCHER_MIDDLE:mtrl_type==EVOLVE_MTRL_TYPE_MELEE_LOW?BONUS_TYPE_EVOLVE_MELEE_LOW:mtrl_type==EVOLVE_MTRL_TYPE_LANCER_LOW?BONUS_TYPE_EVOLVE_LANCER_LOW:mtrl_type==EVOLVE_MTRL_TYPE_ARCHER_LOW?BONUS_TYPE_EVOLVE_ARCHER_LOW:mtrl_type==EVOLVE_MTRL_TYPE_YUBI_LOW?BONUS_TYPE_YUBI_EVOLVE_LOW:mtrl_type==EVOLVE_MTRL_TYPE_YUBI_MIDDLE?BONUS_TYPE_YUBI_EVOLVE_MIDDLE:mtrl_type==EVOLVE_MTRL_TYPE_YUBI_HIGH?BONUS_TYPE_YUBI_EVOLVE_HIGH:mtrl_type==EVOLVE_MTRL_TYPE_YUBI_RARE?BONUS_TYPE_YUBI_RARE:0},GeneralService.prototype.getRebirthMtrlTypeToBonusType=function(mtrl_type){return mtrl_type==REBIRTH_MTRL_TYPE_1?BONUS_TYPE_REBIRTH_MTRL_TYPE_1:mtrl_type==REBIRTH_MTRL_TYPE_2?BONUS_TYPE_REBIRTH_MTRL_TYPE_2:mtrl_type==REBIRTH_MTRL_TYPE_3?BONUS_TYPE_REBIRTH_MTRL_TYPE_3:mtrl_type==REBIRTH_MTRL_TYPE_4?BONUS_TYPE_REBIRTH_MTRL_TYPE_4:mtrl_type==REBIRTH_MTRL_TYPE_5?BONUS_TYPE_REBIRTH_MTRL_TYPE_5:mtrl_type==REBIRTH_MTRL_TYPE_6?BONUS_TYPE_REBIRTH_MTRL_TYPE_6:mtrl_type==REBIRTH_MTRL_TYPE_7?BONUS_TYPE_REBIRTH_MTRL_TYPE_7:mtrl_type==REBIRTH_MTRL_TYPE_EVENT_1?BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1:mtrl_type==REBIRTH_MTRL_TYPE_EVENT_2?BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2:mtrl_type==REBIRTH_MTRL_TYPE_EVENT_3?BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3:mtrl_type==REBIRTH_MTRL_TYPE_EVENT_4?BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4:mtrl_type==REBIRTH_MTRL_TYPE_EVENT_5?BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5:mtrl_type==REBIRTH_MTRL_TYPE_EVENT_6?BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6:0},GeneralService.prototype.getBonusTypeToRebirthMtrlType=function(bonus_type){return bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1?REBIRTH_MTRL_TYPE_1:bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2?REBIRTH_MTRL_TYPE_2:bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3?REBIRTH_MTRL_TYPE_3:bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4?REBIRTH_MTRL_TYPE_4:bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5?REBIRTH_MTRL_TYPE_5:bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6?REBIRTH_MTRL_TYPE_6:bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7?REBIRTH_MTRL_TYPE_7:bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1?REBIRTH_MTRL_TYPE_EVENT_1:bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2?REBIRTH_MTRL_TYPE_EVENT_2:bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3?REBIRTH_MTRL_TYPE_EVENT_3:bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4?REBIRTH_MTRL_TYPE_EVENT_4:bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5?REBIRTH_MTRL_TYPE_EVENT_5:bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6?REBIRTH_MTRL_TYPE_EVENT_6:0},GeneralService.prototype.getComboStatToBonusType=function(combo_stat){return combo_stat==COMBO_STAT_ATTK?BONUS_TYPE_ATTK_POINT:combo_stat==COMBO_STAT_DEF?BONUS_TYPE_DEF_POINT:combo_stat==COMBO_STAT_HP?BONUS_TYPE_HP_POINT:combo_stat==COMBO_STAT_CRI_PRCNT?BONUS_TYPE_CRI_PRCNT_POINT:combo_stat==COMBO_STAT_CRI_DMG?BONUS_TYPE_CRI_DMG_POINT:0},GeneralService.prototype.getBonusTypeToPropertyType=function(combo_stat){return combo_stat==BONUS_TYPE_ATTK_POINT?FORMATION_PROPERTY_TYPE_ATTK:combo_stat==BONUS_TYPE_DEF_POINT?FORMATION_PROPERTY_TYPE_DEF:combo_stat==BONUS_TYPE_HP_POINT?FORMATION_PROPERTY_TYPE_HP:combo_stat==BONUS_TYPE_CRI_PRCNT_POINT?FORMATION_PROPERTY_TYPE_CRI_PRCNT:combo_stat==BONUS_TYPE_CRI_DMG_POINT?FORMATION_PROPERTY_TYPE_CRI_DMG:0},GeneralService.prototype.getBonusTypeToLoveId=function(bonus_type){return bonus_type==BONUS_TYPE_LOVE_ITEM_MELEE?1:bonus_type==BONUS_TYPE_LOVE_ITEM_LANCER?2:bonus_type==BONUS_TYPE_LOVE_ITEM_RANGER?3:bonus_type==BONUS_TYPE_LOVE_ITEM_CAKE?4:bonus_type==BONUS_TYPE_YUBI_LOVE_ITEM?5:bonus_type==BONUS_TYPE_CHRISTMAS_LOVE_ITEM?6:bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE?7:bonus_type==BONUS_TYPE_LOVE_ITEM_PARTNER_COCHOLATE?14:bonus_type==BONUS_TYPE_LOVE_ITEM_VD_COCHOLATE_A?9:bonus_type==BONUS_TYPE_LOVE_ITEM_VD_COCHOLATE_B?10:bonus_type==BONUS_TYPE_LOVE_MAX_CAKE?13:bonus_type==BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_01?15:bonus_type==BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_02?16:bonus_type==BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_03?17:bonus_type==BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_04?18:bonus_type==BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_05?19:bonus_type==BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_06?20:bonus_type==BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_07?21:bonus_type==BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_08?22:bonus_type==BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_09?23:bonus_type==BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_10?24:0},GeneralService.prototype.getBonusTypeToLimitOverMtrlType=function(bonus_type){return bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL?1:bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL?2:0},GeneralService.prototype.getLimitOverMtrlTypeToBonusType=function(limit_over_mtrl_type){return 1==limit_over_mtrl_type?BONUS_TYPE_SR_LIMIT_OVER_MTRL:2==limit_over_mtrl_type?BONUS_TYPE_SSR_LIMIT_OVER_MTRL:0},GeneralService.prototype.getBonusTypeToCraftShopMtrlType=function(bonus_type){return bonus_type==BONUS_TYPE_CRAFT_SHOP_FIRST_LOW?CRAFT_SHOP_BONUS_TYPE_FIRST_LOW:bonus_type==BONUS_TYPE_CRAFT_SHOP_FIRST_MIDDLE?CRAFT_SHOP_BONUS_TYPE_FIRST_MIDDLE:bonus_type==BONUS_TYPE_CRAFT_SHOP_FIRST_HIGH?CRAFT_SHOP_BONUS_TYPE_FIRST_HIGH:bonus_type==BONUS_TYPE_CRAFT_SHOP_FIRST_UNIQUE?CRAFT_SHOP_BONUS_TYPE_FIRST_UNIQUE:bonus_type==BONUS_TYPE_CRAFT_SHOP_SECOND_MIDDLE?CRAFT_SHOP_BONUS_TYPE_SECOND_MIDDLE:bonus_type==BONUS_TYPE_CRAFT_SHOP_SECOND_HIGH?CRAFT_SHOP_BONUS_TYPE_SECOND_HIGH:bonus_type==BONUS_TYPE_CRAFT_SHOP_SECOND_UNIQUE?CRAFT_SHOP_BONUS_TYPE_SECOND_UNIQUE:bonus_type==BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND?CRAFT_SHOP_BONUS_TYPE_TOTAL_LEGEND:bonus_type==BONUS_TYPE_CHRISTMAS_RIBBON?CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_RIBBON:bonus_type==BONUS_TYPE_CHRISTMAS_STAR?CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_STAR:bonus_type==BONUS_TYPE_CHRISTMAS_BALL?CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_BALL:bonus_type==BONUS_TYPE_CHRISTMAS_BELL?CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_BELL:bonus_type==BONUS_TYPE_CHRISTMAS_ANGEL?CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_ANGEL:bonus_type==BONUS_TYPE_CHRISTMAS_LOLLIPOPS?CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_LOLLIPOPS:bonus_type==BONUS_TYPE_CHRISTMAS_COOKIE?CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_COOKIE:bonus_type==BONUS_TYPE_CHRISTMAS_SOCKS?CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_SOCKS:bonus_type==BONUS_TYPE_CHRISTMAS_TREE?CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_TREE:bonus_type==BONUS_TYPE_CHRISTMAS_APPLE?CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_APPLE:0},GeneralService.prototype.getCraftShopMtrlTypeToBonusType=function(craft_shop_mtrl_type){return craft_shop_mtrl_type==CRAFT_SHOP_BONUS_TYPE_FIRST_LOW?BONUS_TYPE_CRAFT_SHOP_FIRST_LOW:craft_shop_mtrl_type==CRAFT_SHOP_BONUS_TYPE_FIRST_MIDDLE?BONUS_TYPE_CRAFT_SHOP_FIRST_MIDDLE:craft_shop_mtrl_type==CRAFT_SHOP_BONUS_TYPE_FIRST_HIGH?BONUS_TYPE_CRAFT_SHOP_FIRST_HIGH:craft_shop_mtrl_type==CRAFT_SHOP_BONUS_TYPE_FIRST_UNIQUE?BONUS_TYPE_CRAFT_SHOP_FIRST_UNIQUE:craft_shop_mtrl_type==CRAFT_SHOP_BONUS_TYPE_SECOND_MIDDLE?BONUS_TYPE_CRAFT_SHOP_SECOND_MIDDLE:craft_shop_mtrl_type==CRAFT_SHOP_BONUS_TYPE_SECOND_HIGH?BONUS_TYPE_CRAFT_SHOP_SECOND_HIGH:craft_shop_mtrl_type==CRAFT_SHOP_BONUS_TYPE_SECOND_UNIQUE?BONUS_TYPE_CRAFT_SHOP_SECOND_UNIQUE:craft_shop_mtrl_type==CRAFT_SHOP_BONUS_TYPE_TOTAL_LEGEND?BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND:craft_shop_mtrl_type==CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_RIBBON?BONUS_TYPE_CHRISTMAS_RIBBON:craft_shop_mtrl_type==CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_STAR?BONUS_TYPE_CHRISTMAS_STAR:craft_shop_mtrl_type==CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_BALL?BONUS_TYPE_CHRISTMAS_BALL:craft_shop_mtrl_type==CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_BELL?BONUS_TYPE_CHRISTMAS_BELL:craft_shop_mtrl_type==CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_ANGEL?BONUS_TYPE_CHRISTMAS_ANGEL:craft_shop_mtrl_type==CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_LOLLIPOPS?BONUS_TYPE_CHRISTMAS_LOLLIPOPS:craft_shop_mtrl_type==CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_COOKIE?BONUS_TYPE_CHRISTMAS_COOKIE:craft_shop_mtrl_type==CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_SOCKS?BONUS_TYPE_CHRISTMAS_SOCKS:craft_shop_mtrl_type==CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_TREE?BONUS_TYPE_CHRISTMAS_TREE:craft_shop_mtrl_type==CRAFT_SHOP_BONUS_TYPE_CHRISTMAS_APPLE?BONUS_TYPE_CHRISTMAS_APPLE:0},GeneralService.prototype.getBonusTypeToEvolveType=function(bonus_type){return bonus_type==BONUS_TYPE_HWANDAN_1?EVOLVE_MTRL_TYPE_CLASS_1:bonus_type==BONUS_TYPE_HWANDAN_2?EVOLVE_MTRL_TYPE_CLASS_2:bonus_type==BONUS_TYPE_HWANDAN_3?EVOLVE_MTRL_TYPE_CLASS_3:bonus_type==BONUS_TYPE_HWANDAN_4?EVOLVE_MTRL_TYPE_CLASS_4:bonus_type==BONUS_TYPE_HWANDAN_5?EVOLVE_MTRL_TYPE_CLASS_5:bonus_type==BONUS_TYPE_HWANDAN_6?EVOLVE_MTRL_TYPE_CLASS_6:bonus_type==BONUS_TYPE_EVOLVE_MELEE?EVOLVE_MTRL_TYPE_MELEE:bonus_type==BONUS_TYPE_EVOLVE_LANCER?EVOLVE_MTRL_TYPE_LANCER:bonus_type==BONUS_TYPE_EVOLVE_ARCHER?EVOLVE_MTRL_TYPE_ARCHER:bonus_type==BONUS_TYPE_EVOLVE_ORB?EVOLVE_MTRL_TYPE_ORB:bonus_type==BONUS_TYPE_EVOLVE_MELEE_MIDDLE?EVOLVE_MTRL_TYPE_MELEE_MIDDLE:bonus_type==BONUS_TYPE_EVOLVE_LANCER_MIDDLE?EVOLVE_MTRL_TYPE_LANCER_MIDDLE:bonus_type==BONUS_TYPE_EVOLVE_ARCHER_MIDDLE?EVOLVE_MTRL_TYPE_ARCHER_MIDDLE:bonus_type==BONUS_TYPE_EVOLVE_MELEE_LOW?EVOLVE_MTRL_TYPE_MELEE_LOW:bonus_type==BONUS_TYPE_EVOLVE_LANCER_LOW?EVOLVE_MTRL_TYPE_LANCER_LOW:bonus_type==BONUS_TYPE_EVOLVE_ARCHER_LOW?EVOLVE_MTRL_TYPE_ARCHER_LOW:bonus_type==BONUS_TYPE_YUBI_EVOLVE_LOW?EVOLVE_MTRL_TYPE_YUBI_LOW:bonus_type==BONUS_TYPE_YUBI_EVOLVE_MIDDLE?EVOLVE_MTRL_TYPE_YUBI_MIDDLE:bonus_type==BONUS_TYPE_YUBI_EVOLVE_HIGH?EVOLVE_MTRL_TYPE_YUBI_HIGH:0},GeneralService.prototype.isEventDungeonTroopsGeneral=function(key){for(var event_generals=NetService().get_User_Event_Dungeon_Search_Troops_Generals(),event_keys=event_generals.keys(),eg_idx=0;eg_idx<event_keys.length;eg_idx++)for(var gnrl_list=event_generals.at(event_keys[eg_idx]),g_idx=0;g_idx<gnrl_list.length;g_idx++){if(gnrl_list[g_idx].gnrl_num==key.gnrl_num)return!0}return!1},GeneralService.prototype.getGeneralHeavnePtInfo=function(info,haven_gnrals){for(var mt=MasterManager.getInstance(),idx=0;idx<haven_gnrals.length;idx++){var g=haven_gnrals.at(idx),general=mt.get_General(g.gnrl_id);if(general.rare_type>=RARE_TYPE_R&&info.gnrl_group==general.gnrl_group&&5==g.limit_step_id){info.is_heaven_pt=!0;break}}if(info.is_heaven_pt){var heaven_pt=(mt=MasterManager.getInstance()).get_HeavenPt(info.gnrl_group,info.gnrl_type,info.class_type,info.limit_step_id);info.sell_heaven_pt=heaven_pt.heaven_pt}else info.sell_heaven_pt=0},GeneralService.prototype.getUserGeneralHeavenPTSellList=function(info_list){var list=[],gnrls=[];NetService().getUserGeneral(gnrls);var mt=MasterManager.getInstance(),hanven_gnrls=gnrls.filter(function(g){if(5==g.limit_step_id)return!0});gnrls.forEach(function(gnrl){var g=mt.get_General(gnrl.gnrl_id),info=new db.UserGeneralInfo;info.gnrl_id=gnrl.gnrl_id,info.gnrl_num=gnrl.gnrl_num,info.gnrl_level=gnrl.gnrl_level,info.gnrl_exp=gnrl.gnrl_exp,info.castle_id=gnrl.castle_id,info.is_lock="y"==gnrl.lock_yn,info.love_level=gnrl.love_level,info.love_exp=gnrl.love_exp,info.limit_step_id=gnrl.limit_step_id,info.using_in_camp="y"==gnrl.using_in_camp,info.used_in_camp="y"==gnrl.used_in_camp,info.buff_type=gnrl.buff_type,info.name=g.name,info.element_type=g.element_type,info.class_type=g.gnrl_class,info.cost=g.cost,info.gnrl_type=g.gnrl_type,info.gnrl_group=g.gnrl_group,info.fight_type=g.fight_type,info.arm_service_type=g.arm_service_type,info.max_class_type=g.evolution_max_class_type,info.sell_gold=g.sell_gold,info.sell_yhpt=g.sell_yhpt,info.rare_type=g.rare_type;var key={};key.gnrl_id=info.gnrl_id,key.gnrl_num=info.gnrl_num,info.master_type=g.master_type,info.state_type=g.state_type,0<info.limit_step_id?info.max_level=this.getLimitOverMaxLevel(info.limit_step_id):info.max_level=g.max_level,info.isPartner=this.isPartner(info.gnrl_id,info.gnrl_num),info.is_friend_partner=this.isFriendPartner(info.gnrl_id,info.gnrl_num),this.getGeneralHeavnePtInfo(info,hanven_gnrls),list.push_back(info)}.bind(this));var user_troops_general=NetService().getUserPartyGeneral(),user_event_dungeon_search_troops_general=NetService().get_User_Event_Dungeon_Search_Troops_Generals("list"),world_war_troops_generals=[];world_war_troops_generals=NetServiceV3.getInstance().getUserPartyGeneral();for(var w_service=WorldWarService.getInstance(),g_idx=0;g_idx<list.length;g_idx++){var g=list[g_idx];if(g.is_heaven_pt){if(17039==g.gnrl_id);for(var troops_keys=user_troops_general.keys(),t_idx=0;t_idx<troops_keys.length;t_idx++){var t=user_troops_general.at(troops_keys[t_idx]);if(t.gnrl_id==g.gnrl_id&&t.gnrl_num==g.gnrl_num){g.using_in_troops=!0;break}}for(var pg_idx=0;pg_idx<NetService().get_great_wall_troops_info().partin_generals.length;pg_idx++){var pg=NetService().get_great_wall_troops_info().partin_generals[pg_idx];if(pg.gnrl_id==g.gnrl_id&&pg.gnrl_num==g.gnrl_num){g.using_in_great_wall_troops=!0;break}}for(var sg_idx=0;sg_idx<user_event_dungeon_search_troops_general.length;sg_idx++){var sg=user_event_dungeon_search_troops_general[sg_idx];if(sg.gnrl_id==g.gnrl_id&&sg.gnrl_num==g.gnrl_num){g.using_in_search_troops=!0;break}}if(!w_service.isWorldWarUnification()&&w_service.isWorldWarPeriodOpen())for(var key=world_war_troops_generals.keys(),tg=0;tg<key.length;tg++)if(world_war_troops_generals.at(key[tg]).gnrl_id==g.gnrl_id&&world_war_troops_generals.at(key[tg]).gnrl_num==g.gnrl_num){g.using_in_world_war_troops=!0;break}var gnrl_key={};gnrl_key.gnrl_id=g.gnrl_id,gnrl_key.gnrl_num=g.gnrl_num,g.is_equipping=this.isGnrlEquipping(gnrl_key),info_list.push_back(g)}}},GeneralService.prototype.getUserLevelUpMaterialList=function(m_key,list,gnrl_type){null==gnrl_type&&(gnrl_type=1);var gnrls=[];NetService().getUserGeneral(gnrls);var user_troops_general=NetService().getUserPartyGeneral(),user_weekly_troops_general=NetService().getUserWeeklyTroopsGeneral(),world_war_troops_generals=NetServiceV3.getInstance().getUserPartyGeneral(),w_service=WorldWarService.getInstance(),mt=MasterManager.getInstance(),troops_key=user_troops_general.keys();for(var idx in gnrls){var gnrl=gnrls[idx];if(null==gnrl.gnrl_id)break;var g=mt.get_General(gnrl.gnrl_id);if((gnrl_type!=GENERAL_TYPE_YUNHEE||g.gnrl_type==GENERAL_TYPE_YUNHEE||g.gnrl_type==GENERAL_TYPE_SOLDIER)&&(gnrl_type!=GENERAL_TYPE_MATERIAL||g.gnrl_type==GENERAL_TYPE_MATERIAL)){var gnrl_key=new db.UserGeneralKey;gnrl_key.gnrl_id=gnrl.gnrl_id,gnrl_key.gnrl_num=gnrl.gnrl_num;var gnrl_key_2={};gnrl_key_2.gnrl_id=gnrl.gnrl_id,gnrl_key_2.gnrl_num=gnrl.gnrl_num;var is_equpping=this.isGnrlEquipping(gnrl_key_2);if(!is_equpping&&!(is_equpping=this.isEventDungeonTroopsGeneral(gnrl_key))&&(w_service.isWorldWarUnification()||!w_service.isWorldWarPeriodOpen()||!(is_equpping=this.isWorldWarGnrlEquipping(gnrl_key_2)))&&gnrl.gnrl_num!=m_key.gnrl_num){if(g.gnrl_type==GENERAL_TYPE_LIMIT_OVER)continue;var info=new db.UserGeneralInfo,isExist=!1;for(var jdx in troops_key){var party=user_troops_general.at(troops_key[jdx]);if(null==party)break;if(party.gnrl_num==gnrl.gnrl_num){isExist=!0;break}}if(!isExist)for(var w in user_weekly_troops_general)if(user_weekly_troops_general[w].gnrl_num==gnrl.gnrl_num){isExist=!0;break}if(!isExist){var partin_generals=NetService().get_great_wall_troops_info().partin_generals;for(var pg in partin_generals)if(partin_generals[pg].gnrl_id==gnrl.gnrl_id&&partin_generals[pg].gnrl_num==gnrl.gnrl_num){isExist=!0;break}}if(!w_service.isWorldWarUnification()&&w_service.isWorldWarPeriodOpen()&&!isExist)for(var key=world_war_troops_generals.keys(),tg=0;tg<key.length;tg++)if(world_war_troops_generals.at(key[tg]).gnrl_id==gnrl.gnrl_id&&world_war_troops_generals.at(key[tg]).gnrl_num==gnrl.gnrl_num){isExist=!0;break}var isPartner=this.isPartnerGeneral(gnrl_key),is_friend_partner=this.isFriendPartner(gnrl_key.gnrl_id,gnrl_key.gnrl_num);if((isPartner||is_friend_partner||"y"==gnrl.lock_yn||"y"==gnrl.using_in_camp)&&(isExist=!0),!isExist){info.gnrl_id=gnrl.gnrl_id,info.gnrl_num=gnrl.gnrl_num,info.gnrl_level=gnrl.gnrl_level,info.level=gnrl.gnrl_level,info.gnrl_exp=gnrl.gnrl_exp,info.limit_step_id=gnrl.limit_step_id,info.love_level=gnrl.love_level,0==gnrl.display_class?info.display_class=g.gnrl_class:info.display_class=gnrl.display_class;g=mt.get_General(info.gnrl_id);info.name=g.name,info.base_attk=g.attk,info.base_def=g.def,info.base_hp=g.hp,info.base_sp=g.sp,info.active_skill=g.active_skill_id,info.class_type=g.gnrl_class,info.element_type=g.element_type,info.cost=g.cost,info.gnrl_type=g.gnrl_type,info.gnrl_group=g.gnrl_group,info.level_exp_group=g.level_exp_group,info.fight_type=g.fight_type,info.bone_id=g.bone_id,(key=new db.UserGeneralKey).gnrl_id=info.gnrl_id,key.gnrl_num=info.gnrl_num,info.arm_service_type=g.arm_service_type,info.rare_type=g.rare_type,info.attk=this.getUserGeneralAttk(info),info.def=this.getUserGeneralDef(info),info.hp=this.getUserGeneralHp(info),info.sp=info.base_sp,info.master_type=g.master_type,info.state_type=g.state_type,0<info.limit_step_id?info.max_level=this.getLimitOverMaxLevel(info.limit_step_id):info.max_level=g.max_level,info.sell_gold=g.sell_gold,info.sell_yhpt=g.sell_yhpt,info.max_class_type=g.evolution_max_class_type,info.passive_skill.push(g.passive_skill_id),info.leader_skill.push(g.leader_skill_id),g.trans_passive_skill_id.split(",").forEach(function(p_id){var trans_passive_skill_id=parseInt(p_id);info.trans_passive_skill.push_back(trans_passive_skill_id)}),info.special_leader_skill.push(g.special_leader_skill_id),info.max_level==info.gnrl_level&&(info.isMaxLevel=!0);var gender=mt.get_GeneralDivision(g.gnrl_group);info.gender_type=gender.general_gender_type,list.push(info)}}}}},GeneralService.prototype.isWorldWarGnrlEquipping=function(gnrl_key){var w_service=WorldWarService.getInstance();if(w_service.isWorldWarUnification())return!1;if(!w_service.isWorldWarPeriodOpen())return!1;for(var world_war_gnrl_equips=NetServiceV3.getInstance().get_list_User_World_War_General_Equipment_Item(),found_is=!1,key=world_war_gnrl_equips.keys(),idx=0;idx<key.length;idx++){var d=world_war_gnrl_equips.at(key[idx]);if(idx,gnrl_key.gnrl_id==d.gnrl_id&&gnrl_key.gnrl_num==d.gnrl_num){found_is=!0;break}}return 1==found_is},GeneralService.prototype.isGnrlEquipping=function(gnrl_key){var net_service=NetService(),equips=net_service.getUserGnrlEquipmentList(gnrl_key),new_equips=net_service.getNewEquipmentOnGeneral(gnrl_key);return null!=equips&&0!=equips.length&&null!=new_equips&&0!=new_equips.length},GeneralService.prototype.getUserLimitOverMaterialList=function(user_key,list){var gnrls=[];gnrls=NetService().getUserGeneral(gnrls);var user_troops_general=NetService().getUserPartyGeneral(),world_war_troops_generals=[];world_war_troops_generals=NetServiceV3.getInstance().getUserPartyGeneral();for(var w_service=WorldWarService.getInstance(),mt=MasterManager.getInstance(),idx=0;idx<gnrls.length;idx++){var gnrl=gnrls[idx];if(null!=gnrl.gnrl_id){var g=mt.get_General(gnrl.gnrl_id),b_g=mt.get_General_freeze(user_key.gnrl_id);if(g.gnrl_type==GENERAL_TYPE_LIMIT_OVER||!(g.gnrl_group!=b_g.gnrl_group||g.gnrl_class<YUNHEE_MAX_CLASS_TYPE)){var gnrl_key=new db.UserGeneralKey;gnrl_key.gnrl_id=gnrl.gnrl_id,gnrl_key.gnrl_num=gnrl.gnrl_num;var gnrl_key_2=new net.User_General_Key;if(gnrl_key_2.gnrl_id=gnrl.gnrl_id,gnrl_key_2.gnrl_num=gnrl.gnrl_num,!this.isGnrlEquipping(gnrl_key_2))if(!this.isEventDungeonTroopsGeneral(gnrl_key)&&(w_service.isWorldWarUnification()||!w_service.isWorldWarPeriodOpen()||!this.isWorldWarGnrlEquipping(gnrl_key_2))&&gnrl.gnrl_num!=user_key.gnrl_num){for(var info=new db.UserGeneralInfo,keys=user_troops_general.keys(),jdx=0;jdx<keys.length;jdx++){if(user_troops_general.at(keys[jdx]).gnrl_num==gnrl.gnrl_num){info.using_in_troops=!0,info.using_enalbed=0;break}}var partin_generals=NetService().get_great_wall_troops_info().partin_generals;for(var pg in partin_generals)if(partin_generals[pg].gnrl_id==gnrl.gnrl_id&&partin_generals[pg].gnrl_num==gnrl.gnrl_num){info.using_in_great_wall_troops=!0,info.using_enalbed=0;break}var user_event_dungeon_search_troops_general=NetService().get_User_Event_Dungeon_Search_Troops_Generals();for(var sg in user_event_dungeon_search_troops_general)if(user_event_dungeon_search_troops_general[sg].gnrl_id==gnrl.gnrl_id&&user_event_dungeon_search_troops_general[sg].gnrl_num==gnrl.gnrl_num){info.using_in_search_troops=!0,info.using_enalbed=0;break}if(!w_service.isWorldWarUnification()&&w_service.isWorldWarPeriodOpen())for(var key=world_war_troops_generals.keys(),tg=0;tg<key.length;tg++)if(world_war_troops_generals.at(key[tg]).gnrl_id==gnrl.gnrl_id&&world_war_troops_generals.at(key[tg]).gnrl_num==gnrl.gnrl_num){info.using_in_world_war_troops=!0,info.using_enalbed=0;break}var isPartner=this.isPartnerGeneral(gnrl_key),is_friend_partner=this.isFriendPartner(gnrl_key.gnrl_id,gnrl_key.gnrl_num);if(isPartner&&(info.isPartner=!0,info.using_enalbed=0),is_friend_partner&&(info.is_friend_partner=!0,info.using_enalbed=0),info.gnrl_id=gnrl.gnrl_id,info.gnrl_num=gnrl.gnrl_num,info.gnrl_level=gnrl.gnrl_level,info.gnrl_exp=gnrl.gnrl_exp,info.limit_step_id=gnrl.limit_step_id,info.love_level=gnrl.love_level,info.is_lock="y"==gnrl.lock_yn,info.using_in_camp="y"==gnrl.using_in_camp,info.buff_type=gnrl.buff_type,(info.is_lock||info.using_in_camp)&&(info.using_enalbed=0),0==gnrl.display_class?info.display_class=g.gnrl_class:info.display_class=gnrl.display_class,g.gnrl_type==GENERAL_TYPE_LIMIT_OVER){if(g.rare_type!=b_g.rare_type)continue;var only_card_info=MasterTable.getInstance().get_LimitOverOnlyCardInfo2(g.gnrl_id),is_yunhee_only_card=!1;if(0!=only_card_info.only_gnrl_group&&(is_yunhee_only_card=!0),is_yunhee_only_card&&only_card_info.only_gnrl_group!=b_g.gnrl_group)continue;if(this.isExistLimitOverCardExceptList(b_g.gnrl_group)&&!is_yunhee_only_card)continue}info.name=g.name,info.base_attk=g.attk,info.base_def=g.def,info.base_hp=g.hp,info.base_sp=g.sp,info.active_skill=g.active_skill_id,info.class_type=g.gnrl_class,info.element_type=g.element_type,info.cost=g.cost,info.gnrl_type=g.gnrl_type,info.gnrl_group=g.gnrl_group,info.level_exp_group=g.level_exp_group;var gender=mt.get_GeneralDivision(g.gnrl_group);info.gender_type=gender.general_gender_type,(key=new db.UserGeneralKey).gnrl_id=info.gnrl_id,key.gnrl_num=info.gnrl_num,info.arm_service_type=g.arm_service_type,info.rare_type=g.rare_type,info.attk=this.getUserGeneralAttk(info),info.def=this.getUserGeneralDef(info),info.hp=this.getUserGeneralHp(info),info.sp=info.base_sp,info.master_type=g.master_type,info.state_type=g.state_type,0<info.limit_step_id?info.max_level=this.getLimitOverMaxLevel(info.limit_step_id):info.max_level=g.max_level,info.sell_gold=g.sell_gold,info.sell_yhpt=g.sell_yhpt,info.max_class_type=g.evolution_max_class_type,info.passive_skill.push(g.passive_skill_id),info.leader_skill.push(g.leader_skill_id),g.trans_passive_skill_id.split(",").forEach(function(p_id){var trans_passive_skill_id=parseInt(p_id);info.trans_passive_skill.push_back(trans_passive_skill_id)});var leader_skill_list=(g.special_leader_skill_id+"").split(",");for(jdx=0;jdx<leader_skill_list.length;jdx++){var s=leader_skill_list[jdx];info.special_leader_skill.push_back(1*s)}info.max_level==info.gnrl_level&&(info.isMaxLevel=!0),list.push(info)}}}}},GeneralService.prototype.isExistLimitOverCardExceptList=function(gnrl_group){for(var list=MasterTable.getInstance().get_LimitOverCardExceptGeneral(),idx=0;idx<list.length;idx++)if(list[idx].gnrl_group==gnrl_group&&list[idx].gnrl_type==GENERAL_TYPE_LIMIT_OVER)return!0;return!1},GeneralService.prototype.getMaxNum=function(){return 0},GeneralService.prototype.getGeneralState=function(gnrl_id){return MasterTable.getInstance().get_General(gnrl_id).state_type},GeneralService.prototype.getGeneralLevelUpExpPrcnt=function(key){var prcnt=0,gnrl_key=new net.User_General_Key;gnrl_key.gnrl_id=key.gnrl_id,gnrl_key.gnrl_num=key.gnrl_num;var user_gnrl={};user_gnrl=NetService().getUserGeneral(user_gnrl,gnrl_key);var m=MasterManager.getInstance(),general=m.get_General(user_gnrl.gnrl_id),next_level=user_gnrl.gnrl_level+1;if((0<user_gnrl.limit_step_id?this.getLimitOverMaxLevel(user_gnrl.limit_step_id):general.max_level)<next_level)return 1;var gnrl_exp=m.get_GeneralLevelupExpV2(general.level_exp_group,next_level),_gnrl_exp=m.get_GeneralLevelupExpV2(general.level_exp_group,user_gnrl.gnrl_level),need_exp=gnrl_exp.need_exp;return user_gnrl.gnrl_exp-=_gnrl_exp.accm_exp,0!=user_gnrl.gnrl_exp&&(prcnt=user_gnrl.gnrl_exp/need_exp),prcnt=Math.floor(1e3*prcnt)/1e3},GeneralService.prototype.getGeneralLoveUpExpPrcnt=function(key){var prcnt=0,gnrl_key=new net.User_General_Key;gnrl_key.gnrl_id=key.gnrl_id,gnrl_key.gnrl_num=key.gnrl_num;var user_gnrl=NetService().getUserGeneral({},gnrl_key),m=MasterManager.getInstance(),general=m.get_General(user_gnrl.gnrl_id),next_level=user_gnrl.love_level+1;if(next_level>YUNHEE_MAX_LOVE_LEVEL)return 1;var gnrl_love_exp=m.get_LoveLevel(general.rare_type,next_level),_gnrl_love_exp=m.get_LoveLevel(general.rare_type,user_gnrl.love_level),need_exp=gnrl_love_exp.need_exp;return user_gnrl.love_exp-=_gnrl_love_exp.accm_exp,0!=user_gnrl.love_exp&&(prcnt=user_gnrl.love_exp/need_exp),prcnt=1e3*prcnt/1e3},GeneralService.prototype.getGeneralLoveUpExpPrcntMtrl=function(mtrl_info){return MasterManager.getInstance().get_GeneralLevelupExpV2(mtrl_info.level_exp_group,mtrl_info.gnrl_level).need_gold},GeneralService.prototype.getGeneralLevelUpExpense=function(mtrl_info){return MasterTable.getInstance().getMasterTable().get_GeneralLevelupExpV2(mtrl_info.level_exp_group,mtrl_info.gnrl_level).need_gold},GeneralService.prototype.getGeneralLevelUpMaterialExp=function(mtrl){return MasterTable.getInstance().getMasterTable().get_GeneralLevelupExpV2(mtrl.level_exp_group,mtrl.gnrl_level).mtrl_exp},GeneralService.prototype.geGeneralLevelUpAfterInfo=function(info,_exp,prcnt,level){var gnrl_key=new net.User_General_Key;gnrl_key.gnrl_id=info.gnrl_id,gnrl_key.gnrl_num=info.gnrl_num;var user_gnrl={};user_gnrl=NetService().getUserGeneral(user_gnrl,gnrl_key);var exp=_exp;exp+=info.level_exp;var m=MasterManager.getInstance(),general=m.get_General(info.gnrl_id),max_level=0;max_level=0<user_gnrl.limit_step_id?this.getLimitOverMaxLevel(user_gnrl.limit_step_id):general.max_level;var current_level=this.getGeneralLevel(general.level_exp_group,exp),next_level=current_level+1;if(max_level<current_level)level=max_level,prcnt=1;else{level=current_level,65<next_level&&(next_level=65);var gnrl_exp=m.get_GeneralLevelupExpV2(general.level_exp_group,next_level),_gnrl_exp=m.get_GeneralLevelupExpV2(general.level_exp_group,current_level),need_exp=gnrl_exp.need_exp;0!=(exp-=_gnrl_exp.accm_exp)&&(prcnt=exp/need_exp),prcnt=Math.floor(1e3*prcnt)/1e3}return{level:level,prcnt:prcnt}},GeneralService.prototype.getGeneralLevelUpRemoveAfterInfo=function(info,_exp,prcnt,level){var gnrl_key=new net.User_General_Key;gnrl_key.gnrl_id=info.gnrl_id,gnrl_key.gnrl_num=info.gnrl_num;var user_gnrl=new net.User_General;user_gnrl=NetService().getUserGeneral(user_gnrl,gnrl_key);var exp=info.level_exp-_exp,m=MasterManager.getInstance(),general=m.get_General(info.gnrl_id),max_level=0;max_level=0<user_gnrl.limit_step_id?this.getLimitOverMaxLevel(user_gnrl.limit_step_id):general.max_level;var current_level=this.getGeneralLevel(general.level_exp_group,exp),next_level=current_level+1;if(max_level<current_level)level=max_level,prcnt=1;else{level=current_level;var gnrl_exp=m.get_GeneralLevelupExpV2(general.level_exp_group,next_level),_gnrl_exp=m.get_GeneralLevelupExpV2(general.level_exp_group,current_level),need_exp=gnrl_exp.need_exp;if(0!=(exp-=_gnrl_exp.accm_exp))prcnt=exp/need_exp,prcnt=Math.floor(1e3*prcnt)/1e3;else prcnt=0}return{level:level,prcnt:prcnt}},GeneralService.prototype.geGeneralLoveUpAfterInfo=function(info,exp,prcnt,level){var gnrl_exp=exp,after_level=0;gnrl_exp+=info.level_exp;for(var m=MasterTable.getInstance().getMasterTable(),max_level=YUNHEE_MAX_LOVE_LEVEL,i=2;i<=max_level;i++)if(i<=max_level){if(!(gnrl_exp>=(loveLevel=m.get_LoveLevel(info.rare_type,i)).need_exp)){var loveLevel;after_level=loveLevel.level,level=loveLevel.level-1;var _prcnt=1e3*(prcnt=gnrl_exp/(loveLevel=m.get_LoveLevel(info.rare_type,after_level)).need_exp);prcnt=0!=_prcnt?_prcnt/1e3:0;break}max_level<=i?(level=max_level,prcnt=0):gnrl_exp-=loveLevel.need_exp}else level=max_level,prcnt=0;return{level:level,prcnt:prcnt}},GeneralService.prototype.getBookGeneralInfo=function(level_exp_group,accm_exp){return 0},GeneralService.prototype.getGeneralLevel=function(level_exp_group,accm_exp){var level=0,g=MasterManager.getInstance().get_AllGeneralLevelupExpV2().filter(function(t){if(t.level_exp_group==level_exp_group&&t.accm_exp<=accm_exp)return!0});return 0!=g.length&&(g.sort(function(l,r){return l.gnrl_level<r.gnrl_level?1:l.gnrl_level>r.gnrl_level?-1:0}),level=g[0].gnrl_level),level},GeneralService.prototype.getGeneralLoveUpRemoveAfterInfo=function(info,exp,prcnt,level){for(var love_exp=info.level_exp-exp,after_level=0,m=MasterTable.getInstance(),max_level=YUNHEE_MAX_LOVE_LEVEL,i=2;i<=max_level;i++){if(!(love_exp>=(gnrlExp=m.get_LoveLevel(info.rare_type,i)).need_exp)){var gnrlExp;after_level=gnrlExp.level,level=gnrlExp.level-1;var _prcnt=1e3*(love_exp/(gnrlExp=m.get_LoveLevel(info.rare_type,after_level)).need_exp);0!=_prcnt?_prcnt/1e3:0,level<1&&(level=1);break}love_exp-=gnrlExp.need_exp}},GeneralService.prototype.getUserYunheeCount=function(){return NetService().getUserGeneralCount()},GeneralService.prototype.getGeneralClassType=function(gnrl_id){return MasterManager.getInstance().get_General(gnrl_id).gnrl_class},GeneralService.prototype.getGeneralName=function(gnrl_id){return MasterManager.getInstance().get_General(gnrl_id).name},GeneralService.prototype.getCardInfo=function(key,cardInfo){var user_general=new net.User_General,gnrl_key=new net.User_General_Key;gnrl_key.gnrl_id=key.gnrl_id,gnrl_key.gnrl_num=key.gnrl_num,user_general=NetService().getUserGeneral({},gnrl_key),cardInfo.gnrl_id=user_general.gnrl_id,cardInfo.level=user_general.gnrl_level;var general=MasterManager.getInstance().get_General(user_general.gnrl_id),max_level=0;max_level=0<user_general.limit_step_id?this.getLimitOverMaxLevel(user_general.limit_step_id):general.max_level,user_general.gnrl_level==max_level&&(cardInfo.is_max_level=!0)},GeneralService.prototype.getCastleName=function(castle_id){return MasterTable.getInstance().get_Unification(castle_id).name},GeneralService.prototype.getGeneralArmpServiceType=function(arm_service_type){switch(arm_service_type){case ARMSERVICETYPE_INFANTRY:return"";case ARMSERVICETYPE_SPEAR:return"";case ARMSERVICETYPE_ARCHER:return"";case ARMSERVICETYPE_NONE:return""}return""},GeneralService.prototype.getGeneralStateType=function(state_type){switch(state_type){case STATE_TYPE_DONG:return"";case STATE_TYPE_WIE:return"";case STATE_TYPE_CHOCK:return"";case STATE_TYPE_O:return"";case STATE_TYPE_WON:return"";case STATE_TYPE_JAE:return"";case STATE_TYPE_WAE:return res_str("btn_label_wae");case STATE_TYPE_ETC:return res_str("label_country_name_8")}return""},GeneralService.prototype.getLoveStat=function(love_stat_group,level){var m_love_stat=MasterTable.getInstance().getMasterTable().get_AllLoveStat();if(null==level){var love_stats=[];for(var idx in m_love_stat)if(m_love_stat[idx].love_stat_group==love_stat_group){var love_stat={};love_stat.idx=m_love_stat[idx].idx,love_stat.love_stat_group=m_love_stat[idx].love_stat_group,love_stat.love_level=m_love_stat[idx].love_level,love_stat.content=m_love_stat[idx].content,love_stats.push(love_stat)}return love_stats}for(var idx in m_love_stat)if(m_love_stat[idx].love_stat_group==love_stat_group&&m_love_stat[idx].love_level==level)return m_love_stat[idx];return{idx:0,love_stat_group:0,love_level:0,content:"",stat_type_1:0,value_1:0,stat_type_2:0,value_2:0,stat_type_3:0,value_3:0}},GeneralService.prototype.getGeneralEvolutionInfo=function(evolition_mtrl_num,evolveInfoList,need_gold){var gnrlEv=MasterTable.getInstance().getMasterTable().get_GeneralEvolution(evolition_mtrl_num);need_gold=gnrlEv.evolution_need_gold;var info={};(ev_info={slot_num:1}).slot_type=gnrlEv.slot_1_type,ev_info.slot_value_1=gnrlEv.slot_1_value_1,ev_info.slot_value_2=gnrlEv.slot_1_value_2,info.mtrl_info=ev_info,info.isExist=!1,0!=ev_info.slot_type&&evolveInfoList.push(info);info={};(ev_info={slot_num:2}).slot_type=gnrlEv.slot_2_type,ev_info.slot_value_1=gnrlEv.slot_2_value_1,ev_info.slot_value_2=gnrlEv.slot_2_value_2,info.mtrl_info=ev_info,info.isExist=!1,0!=ev_info.slot_type&&evolveInfoList.push(info);info={};(ev_info={slot_num:3}).slot_type=gnrlEv.slot_3_type,ev_info.slot_value_1=gnrlEv.slot_3_value_1,ev_info.slot_value_2=gnrlEv.slot_3_value_2,info.mtrl_info=ev_info,info.isExist=!1,0!=ev_info.slot_type&&evolveInfoList.push(info);info={};(ev_info={slot_num:4}).slot_type=gnrlEv.slot_4_type,ev_info.slot_value_1=gnrlEv.slot_4_value_1,ev_info.slot_value_2=gnrlEv.slot_4_value_2,info.mtrl_info=ev_info,info.isExist=!1,0!=ev_info.slot_type&&evolveInfoList.push(info);var ev_info;info={};return(ev_info={slot_num:5}).slot_type=gnrlEv.slot_5_type,ev_info.slot_value_1=gnrlEv.slot_5_value_1,ev_info.slot_value_2=gnrlEv.slot_5_value_2,info.mtrl_info=ev_info,info.isExist=!1,0!=ev_info.slot_type&&evolveInfoList.push(info),cc.log(ev_info.slot_type),need_gold},GeneralService.prototype.getGeneralRebirthInfo=function(gnrl_group,rebirthInfoList){var gnrl_rebirth=MasterManager.getInstance().get_GeneralRebirthInfo(gnrl_group),need_gold=gnrl_rebirth.need_gold,info=new db.UserGeneralEvolutionMaterialInfo,ev_info=new db.GeneralEvolutionMaterialSlotInfo;ev_info.slot_num=1,ev_info.slot_type=gnrl_rebirth.slot_1_type,ev_info.slot_value_1=gnrl_rebirth.slot_1_value_1,ev_info.slot_value_2=gnrl_rebirth.slot_1_value_2,info.mtrl_info=ev_info,info.isExist=!1,0!=ev_info.slot_type&&rebirthInfoList.push_back(info);var info_2=new db.UserGeneralEvolutionMaterialInfo,ev_info_2=new db.GeneralEvolutionMaterialSlotInfo;ev_info_2.slot_num=2,ev_info_2.slot_type=gnrl_rebirth.slot_2_type,ev_info_2.slot_value_1=gnrl_rebirth.slot_2_value_1,ev_info_2.slot_value_2=gnrl_rebirth.slot_2_value_2,info_2.mtrl_info=ev_info_2,info_2.isExist=!1,0!=ev_info_2.slot_type&&rebirthInfoList.push_back(info_2);var info_3=new db.UserGeneralEvolutionMaterialInfo,ev_info_3=new db.GeneralEvolutionMaterialSlotInfo;ev_info_3.slot_num=3,ev_info_3.slot_type=gnrl_rebirth.slot_3_type,ev_info_3.slot_value_1=gnrl_rebirth.slot_3_value_1,ev_info_3.slot_value_2=gnrl_rebirth.slot_3_value_2,info_3.mtrl_info=ev_info_3,info_3.isExist=!1,0!=ev_info_3.slot_type&&rebirthInfoList.push_back(info_3);var info_4=new db.UserGeneralEvolutionMaterialInfo,ev_info_4=new db.GeneralEvolutionMaterialSlotInfo;ev_info_4.slot_num=4,ev_info_4.slot_type=gnrl_rebirth.slot_4_type,ev_info_4.slot_value_1=gnrl_rebirth.slot_4_value_1,ev_info_4.slot_value_2=gnrl_rebirth.slot_4_value_2,info_4.mtrl_info=ev_info_4,info_4.isExist=!1,0!=ev_info_4.slot_type&&rebirthInfoList.push_back(info_4);var info_5=new db.UserGeneralEvolutionMaterialInfo,ev_info_5=new db.GeneralEvolutionMaterialSlotInfo;return ev_info_5.slot_num=5,ev_info_5.slot_type=gnrl_rebirth.slot_5_type,ev_info_5.slot_value_1=gnrl_rebirth.slot_5_value_1,ev_info_5.slot_value_2=gnrl_rebirth.slot_5_value_2,info_5.mtrl_info=ev_info_5,info_5.isExist=!1,0!=ev_info_5.slot_type&&rebirthInfoList.push_back(info_5),need_gold},GeneralService.prototype.isExistRebirthMtrl=function(gnrl_group){var rebirth_mtrl_info=MasterManager.getInstance().get_GeneralRebirthInfo(gnrl_group),mtrl_info=NetService().get_User_Rebirth_Mtrl_Info();null!=mtrl_info.mtrl_count&&null!=mtrl_info.mtrl_count||(mtrl_info.mtrl_count=0);for(var mtrl_keys=mtrl_info.keys(),idx=0;idx<mtrl_keys.length;idx++){var mtrl=mtrl_info.at(mtrl_keys[idx]);if(rebirth_mtrl_info.slot_1_type==mtrl_keys[idx]){if(mtrl.mtrl_count<rebirth_mtrl_info.slot_1_value_1)return!1}else if(rebirth_mtrl_info.slot_2_type==mtrl_keys[idx]){if(mtrl.mtrl_count<rebirth_mtrl_info.slot_2_value_1)return!1}else if(rebirth_mtrl_info.slot_3_type==mtrl_keys[idx]){if(mtrl.mtrl_count<rebirth_mtrl_info.slot_3_value_1)return!1}else if(rebirth_mtrl_info.slot_4_type==mtrl_keys[idx]){if(mtrl.mtrl_count<rebirth_mtrl_info.slot_4_value_1)return!1}else if(rebirth_mtrl_info.slot_5_type==mtrl_keys[idx]&&mtrl.mtrl_count<rebirth_mtrl_info.slot_5_value_1)return!1}return!0},GeneralService.prototype.isEnabledRebirth=function(info){var mt=MasterManager.getInstance();if(info.class_type>=info.max_class_type&&(mt.get_CountFunction(COUNT_FUNCTION_GENERAL_REBIRTH_ENABLE_LEVEL).value<=info.gnrl_level&&YUNHEE_MAX_LOVE_LEVEL<=info.love_level))return this.isExistRebirthMtrl(info.gnrl_group);return!1},GeneralService.prototype.isRebirthObject=function(gnrl_class,gnrl_group,gnrl_type){if(gnrl_class>YUNHEE_MAX_CLASS_TYPE)return!1;if(gnrl_type!=GENERAL_TYPE_YUNHEE)return!1;var info=MasterManager.getInstance().get_GeneralRebirthInfo(gnrl_group);return!(moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf()<moment(info.rebirth_beg_dt).valueOf())&&(0!=info.rebirth_gnrl_group&&null!=info.rebirth_gnrl_group)},GeneralService.prototype.getUserHwandanInfo=function(list){var val=arguments;switch(val.length){case 1:val[0];return list=NetService().get_User_Hwandan_Info();case 2:var class_type=val[0],info=val[1],key={};return key.class_type=class_type,null==(info=NetService().get_User_Hwandan_Info(key.class_type))&&((info={}).hwandan_class=class_type,info.hwandan_count=0),info;default:return}},GeneralService.prototype.getUserEvolveArmServiceMtrlInfo=function(slot_type){var arm_service_type=this.geEvolveTypeToArmServiceType(slot_type),class_type=this.geEvolveTypeToArmServiceClassType(slot_type),key={};key.arm_service_type=arm_service_type,key.class_type=class_type;var info=NetService().get_User_Evolve_Arm_Service_Mtrl(key);return null==info&&((info={}).arm_service_type=arm_service_type,info.class_type=class_type,info.mtrl_count=0),info},GeneralService.prototype.getUserLoveItem=function(gnrl_group,item_list){var items=[];NetService().getUserLoveItem(items);var mt=MasterManager.getInstance(),love_ids=[];if(this.isExistLoveItemInGnrlGroup(gnrl_group,love_ids))for(var jdx in love_ids){var id=love_ids[jdx];for(var idx in items){if(null==(item=items[idx]).love_id)break;if(id.love_id==item.love_id){var love_item=mt.get_LoveItem(item.love_id);(info=new db.UserLoveItemInfo).love_id=item.love_id,info.count=item.count,info.name=love_item.name,info.content=love_item.content,info.point=love_item.point,info.arm_service_type=love_item.arm_service_type,info.point_prcnt=love_item.point_prcnt,info.need_gold=love_item.need_gold,info.gnrl_id=item.gnrl_id,0!=info.count&&item_list.push(info)}}}else for(var idx in items){var item,info;if(null==(item=items[idx]).love_id)break;if(0==(love_item=mt.get_LoveItem(item.love_id)).gnrl_group)(info=new db.UserLoveItemInfo).love_id=item.love_id,info.count=item.count,info.name=love_item.name,info.content=love_item.content,info.point=love_item.point,info.arm_service_type=love_item.arm_service_type,info.point_prcnt=love_item.point_prcnt,info.need_gold=love_item.need_gold,info.gnrl_id=item.gnrl_id,0!=info.count&&item_list.push(info)}},GeneralService.prototype.isExistLoveItemInGnrlGroup=function(gnrl_group,love_ids){var isExist=!1,love_items=[];love_items=MasterTable.getInstance().get_LoveItems(love_items);for(var idx=0;idx<love_items.length;idx++)love_items[idx].gnrl_group==gnrl_group&&(love_ids.push(love_items[idx]),isExist=!0);return isExist},GeneralService.prototype.getLoveUpMaxLevelNeedItemCount=function(gnrl_info,love_info){var count=0,item_exp=love_info.point,need_exp=MasterTable.getInstance().getMasterTable().get_LoveLevel(gnrl_info.rare_type,YUNHEE_MAX_LOVE_LEVEL).accm_exp-gnrl_info.love_exp;return gnrl_info.arm_service_type==love_info.arm_service_type&&(item_exp=item_exp*love_info.point_prcnt/100),count=need_exp/item_exp,0<need_exp%item_exp&&(count+=1),Math.floor(count)},GeneralService.prototype.getEvolutionGnrlInfo=function(info){var gnrl_group=info.gnrl_group,gnrl_class=info.class_type+1,map_general=MasterManager.getInstance().get_AllGeneral();for(var g in map_general)if(map_general[g].gnrl_group==gnrl_group&&map_general[g].gnrl_class==gnrl_class)return map_general[g];return 0},GeneralService.prototype.getEvolutionMaterialInfo=function(base_gnrl_num,mtrl_gnrl_id,keys,list){var gnrls=[];NetService().getUserGeneral(gnrls);var mt=MasterTable.getInstance(),partner=GameContext.getInstance().getUserGeneralPartner(),friend_partner=GameContext.getInstance().getUserFriendPartner();for(var gnrl in gnrls)if(!(partner.gnrl_num==gnrl.gnrl_num&&partner.gnrl_id==gnrl.gnrl_id||friend_partner.gnrl_num==gnrl.gnrl_num&&friend_partner.gnrl_id==gnrl.gnrl_id||mtrl_gnrl_id!=gnrl.gnrl_id||"y"==gnrl.lock_yn||gnrl.gnrl_num==base_gnrl_num||"y"==gnrl.using_in_camp)){var info=new db.EvolveMaterialInfo;info.gnrl_id=gnrl.gnrl_id,info.gnrl_num=gnrl.gnrl_num,info.gnrl_level=gnrl.gnrl_level;var g=mt.get_General(info.gnrl_id);for(var key in info.name=g.name,info.class_type=g.gnrl_class,info.cost=g.cost,info.arm_service_type=g.arm_service_type,info.max_class_type=g.evolution_max_class_type,info.state_type=g.state_type,info.rare_type=g.rare_type,keys)if(key.second.gnrl_id==gnrl.gnrl_id&&key.second.gnrl_num==gnrl.gnrl_num){info.slot_num=key.first;break}info.is_use=this.isExistGeneralInTroops(gnrl.gnrl_num),list.push(info)}},GeneralService.prototype.getEvolutionMaterialInfoClassType=function(base_gnrl_num,rare_type,class_type,keys,list){var gnrls=[];NetService().getUserGeneral(gnrls);var mt=MasterTable.getInstance(),partner=GameContext.getInstance().getUserGeneralPartner(),friend_partner=GameContext.getInstance().getUserFriendPartner();for(var gnrl in gnrls)if(!(partner.gnrl_num==gnrl.gnrl_num&&partner.gnrl_id==gnrl.gnrl_id||friend_partner.gnrl_num==gnrl.gnrl_num&&friend_partner.gnrl_id==gnrl.gnrl_id||"y"==gnrl.lock_yn||gnrl.gnrl_num==base_gnrl_num||"y"==gnrl.using_in_camp||"y"==gnrl.lock_yn||gnrl.gnrl_num==base_gnrl_num||"y"==gnrl.using_in_camp)){var info=new db.EvolveMaterialInfo;info.gnrl_id=gnrl.gnrl_id,info.gnrl_num=gnrl.gnrl_num,info.gnrl_level=gnrl.gnrl_level;var g=mt.get_General(info.gnrl_id);if(info.name=g.name,info.class_type=g.gnrl_class,g.gnrl_class==class_type&&g.rare_type==rare_type){for(var key in keys)if(key.second.gnrl_id==gnrl.gnrl_id&&key.second.gnrl_num==gnrl.gnrl_num){info.slot_num=key.first;break}info.cost=g.cost,info.arm_service_type=g.arm_service_type,info.max_class_type=g.evolution_max_class_type,info.state_type=g.state_type,info.crrnt_rare_type=g.rare_type,info.rare_type=g.rare_type,info.is_use=this.isExistGeneralInTroops(gnrl.gnrl_num),list.push(info)}}},GeneralService.prototype.getYunheeRetentionInfo=function(){var mt=new MasterManager.getInstance,gf=mt.get_GoodsFunction(GOODS_FUNCTION_YUNHEE_BOUND),value=gf.value,bonus_type=gf.bonus_type,bonus_type_name=mt.get_BonusType(bonus_type).name,info={};return info.name=bonus_type_name,info.value=value,info},GeneralService.prototype.isEnableLimitOver=function(gnrl_id,gnrl_num){var key=new db.UserGeneralKey;key.gnrl_id=gnrl_id,key.gnrl_num=gnrl_num;var info=new db.UserGeneralInfo;return this.getUserGeneralInfo(key,info),!(info.class_type<info.max_class_type)&&!(info.gnrl_level<info.max_level)},GeneralService.prototype.isMaxLimitOver=function(gnrl_id,gnrl_num){var key=new db.UserGeneralKey;key.gnrl_id=gnrl_id,key.gnrl_num=gnrl_num;var info=new db.UserGeneralInfo;return this.getUserGeneralInfo(key,info),info.limit_step_id>=MAX_LIMIT_OVER_STEP},GeneralService.prototype.getLimitOverInfo=function(info){var mt=MasterManager.getInstance(),next_limit_step_id=info.limit_step_id+1;return mt.get_GeneralLimit(next_limit_step_id)},GeneralService.prototype.isExistEvolutionMtlrGeneral=function(info,generalLimit){var list=[];this.getCheckEvolutionGeneral(list);for(var found=[],i=0;i<list.length;i++){var g=new db.EvolutionMtrlCheckInfo;return rare_type==g.rare_type&&class_type==g.class_type&&g.gnrl_num!=key.gnrl_num?(found.push(!0),!0):(found.push(!1),!1)}return found!=list.end()},GeneralService.prototype.getCheckEvolutionGeneral=function(list){var gnrls=[];NetService().getUserGeneral(gnrls);var mt=db.MasterTable.getInstance();for(var gnrl in gnrls){var info=new db.EvolutionMtrlCheckInfo;info.gnrl_id=gnrl.gnrl_id,info.gnrl_num=gnrl.gnrl_num;var g=mt.get_General(info.gnrl_id);info.rare_type=g.rare_type,info.class_type=g.gnrl_class,list.push(info)}},GeneralService.prototype.getShortcutList=function(bonus_type){var shortcuts_list=MasterTable.getInstance().get_ShotCuts_V2(),list=[];for(var shortcuts in shortcuts_list){if(null==shortcuts_list[shortcuts])break;shortcuts_list[shortcuts].bonus_type==bonus_type&&list.push(shortcuts_list[shortcuts])}return list},GeneralService.prototype.getGnrlType=function(gnrl_id){return MasterManager.getInstance().get_General(gnrl_id).gnrl_type},GeneralService.prototype.getNextClassTypePassiveId=function(evolution_group_num,class_type){var passive_id=0,next_class_type=class_type+1,map_general=MasterManager.getInstance().get_AllGeneral();for(var g in map_general)map_general[g].evolution_group_num==evolution_group_num&&map_general[g].gnrl_class==next_class_type&&(passive_id=map_general[g].passive_skill_id);return passive_id},GeneralService.prototype.getNextClassTypeTransPassiveId=function(evolution_group_num,class_type){var passive_id=0,next_class_type=class_type+1,map_general=MasterManager.getInstance().get_AllGeneral(),info=[];for(var g in map_general){if(map_general[g].evolution_group_num==evolution_group_num&&map_general[g].gnrl_class==next_class_type)passive_id=map_general[g].trans_passive_skill_id,map_general[g].trans_passive_skill_id.split(",").forEach(function(p_id){var trans_passive_skill_id=parseInt(p_id);info.push_back(trans_passive_skill_id)})}return 0<info.length&&(passive_id=info[0]),passive_id},GeneralService.prototype.getUserFormationPositionLevelUpCount=function(position_type){for(var count=0,i=0;i<5;++i){var combo_stat=0;0==i?combo_stat=COMBO_STAT_ATTK:1==i?combo_stat=COMBO_STAT_DEF:2==i?combo_stat=COMBO_STAT_HP:3==i?combo_stat=COMBO_STAT_CRI_PRCNT:4==i&&(combo_stat=COMBO_STAT_CRI_DMG);for(var formation_id=0,m_user_battle_formation=NetService().get_User_Battle_Formation(),key=m_user_battle_formation.keys(),idx=0;idx<key.length;idx++)m_user_battle_formation.at(key[idx]).position_type==position_type&&m_user_battle_formation.at(key[idx]).combo_stat==combo_stat&&(formation_id=m_user_battle_formation.at(key[idx]).formation_id);count+=MasterManager.getInstance().get_BattleFormationV2(formation_id,position_type,combo_stat).formation_level-1}return count},GeneralService.prototype.getFormationMaxLevelUpCount=function(position_type){for(var max_count=0,i=0;i<5;++i){var combo_stat=0;0==i?combo_stat=COMBO_STAT_ATTK:1==i?combo_stat=COMBO_STAT_DEF:2==i?combo_stat=COMBO_STAT_HP:3==i?combo_stat=COMBO_STAT_CRI_PRCNT:4==i&&(combo_stat=COMBO_STAT_CRI_DMG);var list_foramtion=MasterManager.getInstance().get_All_BattleFormationV2().filter(function(formation){if(formation.position_type==position_type&&formation.combo_stat==combo_stat)return!0});list_foramtion.sort(function(l,r){return l.formation_level<r.formation_level?1:l.formation_level>r.formation_level?-1:0});try{max_count+=list_foramtion[0].formation_level-1}catch(e){max_count+=0}}return max_count},GeneralService.prototype.checkEvolveSlotTypeMtrl=function(key,slot_type,value_1,value_2){var hwandanInfos=this.getUserHwandanInfo([]),orb_count=NetService().get_User_Evolve_Orb(),evolveArmServiceInfo=UserService.getInstance().getUserEvolveArmServiceMtrl();if(slot_type==EVOLVE_MTRL_TYPE_CLASS_1||slot_type==EVOLVE_MTRL_TYPE_CLASS_2||slot_type==EVOLVE_MTRL_TYPE_CLASS_3||slot_type==EVOLVE_MTRL_TYPE_CLASS_4||slot_type==EVOLVE_MTRL_TYPE_CLASS_5||slot_type==EVOLVE_MTRL_TYPE_CLASS_6||slot_type==EVOLVE_MTRL_TYPE_YUBI_RARE)for(var hwandan_keys=hwandanInfos.keys(),hdx=0;hdx<hwandan_keys.length;hdx++){var hwandan=hwandanInfos.at(hwandan_keys[hdx]);if(slot_type==EVOLVE_MTRL_TYPE_CLASS_1&&hwandan.hwandan_class==HWANDAN_CLASS_1)return!(value_1>hwandan.hwandan_count);if(slot_type==EVOLVE_MTRL_TYPE_CLASS_2&&hwandan.hwandan_class==HWANDAN_CLASS_2)return!(value_1>hwandan.hwandan_count);if(slot_type==EVOLVE_MTRL_TYPE_CLASS_3&&hwandan.hwandan_class==HWANDAN_CLASS_3)return!(value_1>hwandan.hwandan_count);if(slot_type==EVOLVE_MTRL_TYPE_CLASS_4&&hwandan.hwandan_class==HWANDAN_CLASS_4)return!(value_1>hwandan.hwandan_count);if(slot_type==EVOLVE_MTRL_TYPE_CLASS_5&&hwandan.hwandan_class==HWANDAN_CLASS_5)return!(value_1>hwandan.hwandan_count);if(slot_type==EVOLVE_MTRL_TYPE_CLASS_6&&hwandan.hwandan_class==HWANDAN_CLASS_6)return!(value_1>hwandan.hwandan_count);if(slot_type==EVOLVE_MTRL_TYPE_YUBI_RARE&&hwandan.hwandan_class==HWANDAN_CLASS_YUBI)return!(value_1>hwandan.hwandan_count)}if(slot_type==EVOLVE_MTRL_TYPE_ORB)return!(orb_count<value_1);if(slot_type==EVOLVE_MTRL_TYPE_MELEE||slot_type==EVOLVE_MTRL_TYPE_LANCER||slot_type==EVOLVE_MTRL_TYPE_ARCHER||slot_type==EVOLVE_MTRL_TYPE_MELEE_MIDDLE||slot_type==EVOLVE_MTRL_TYPE_LANCER_MIDDLE||slot_type==EVOLVE_MTRL_TYPE_ARCHER_MIDDLE||slot_type==EVOLVE_MTRL_TYPE_MELEE_LOW||slot_type==EVOLVE_MTRL_TYPE_LANCER_LOW||slot_type==EVOLVE_MTRL_TYPE_ARCHER_LOW||slot_type==EVOLVE_MTRL_TYPE_YUBI_HIGH||slot_type==EVOLVE_MTRL_TYPE_YUBI_MIDDLE||slot_type==EVOLVE_MTRL_TYPE_YUBI_LOW)for(var evolve_keys=evolveArmServiceInfo.keys(),adx=0;adx<evolve_keys.length;adx++){var arm_service=evolveArmServiceInfo.at(evolve_keys[adx]);if(slot_type==EVOLVE_MTRL_TYPE_MELEE&&arm_service.arm_service_type==ARMSERVICETYPE_INFANTRY&&arm_service.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_HIGH)return!(value_1>arm_service.mtrl_count);if(slot_type==EVOLVE_MTRL_TYPE_LANCER&&arm_service.arm_service_type==ARMSERVICETYPE_SPEAR&&arm_service.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_HIGH)return!(value_1>arm_service.mtrl_count);if(slot_type==EVOLVE_MTRL_TYPE_ARCHER&&arm_service.arm_service_type==ARMSERVICETYPE_ARCHER&&arm_service.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_HIGH)return!(value_1>arm_service.mtrl_count);if(slot_type==EVOLVE_MTRL_TYPE_MELEE_MIDDLE&&arm_service.arm_service_type==ARMSERVICETYPE_INFANTRY&&arm_service.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_MIDDLE)return!(value_1>arm_service.mtrl_count);if(slot_type==EVOLVE_MTRL_TYPE_LANCER_MIDDLE&&arm_service.arm_service_type==ARMSERVICETYPE_SPEAR&&arm_service.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_MIDDLE)return!(value_1>arm_service.mtrl_count);if(slot_type==EVOLVE_MTRL_TYPE_ARCHER_MIDDLE&&arm_service.arm_service_type==ARMSERVICETYPE_ARCHER&&arm_service.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_MIDDLE)return!(value_1>arm_service.mtrl_count);if(slot_type==EVOLVE_MTRL_TYPE_MELEE_LOW&&arm_service.arm_service_type==ARMSERVICETYPE_INFANTRY&&arm_service.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_LOW)return!(value_1>arm_service.mtrl_count);if(slot_type==EVOLVE_MTRL_TYPE_LANCER_LOW&&arm_service.arm_service_type==ARMSERVICETYPE_SPEAR&&arm_service.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_LOW)return!(value_1>arm_service.mtrl_count);if(slot_type==EVOLVE_MTRL_TYPE_ARCHER_LOW&&arm_service.arm_service_type==ARMSERVICETYPE_ARCHER&&arm_service.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_LOW)return!(value_1>arm_service.mtrl_count);if(slot_type==EVOLVE_MTRL_TYPE_YUBI_HIGH&&arm_service.arm_service_type==ARMSERVICETYPE_INFANTRY&&arm_service.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_EVENT_HIGH)return!(value_1>arm_service.mtrl_count);if(slot_type==EVOLVE_MTRL_TYPE_YUBI_MIDDLE&&arm_service.arm_service_type==ARMSERVICETYPE_INFANTRY&&arm_service.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_EVENT_MIDDLE)return!(value_1>arm_service.mtrl_count);if(slot_type==EVOLVE_MTRL_TYPE_YUBI_LOW&&arm_service.arm_service_type==ARMSERVICETYPE_INFANTRY&&arm_service.class_type==EVOLVE_ARM_SERVICE_CLASS_TYPE_EVENT_LOW)return!(value_1>arm_service.mtrl_count)}return!1},GeneralService.prototype.isExistEvolutionMtrl=function(key,evolution_mtrl_num){var evolveInfoList=[];this.getGeneralEvolutionInfo(evolution_mtrl_num,evolveInfoList,0);for(var idx=0;idx<evolveInfoList.length;idx++){var mtrl=evolveInfoList[idx];if(!this.checkEvolveSlotTypeMtrl(key,mtrl.mtrl_info.slot_type,mtrl.mtrl_info.slot_value_1,mtrl.mtrl_info.slot_value_2))return!1}return!0},GeneralService.prototype.isEnabledLimitOver=function(info){if(info.class_type>=info.max_class_type&&info.gnrl_level>=info.max_level){if(info.limit_step_id<MAX_LIMIT_OVER_STEP){var isExist=this.isExistSameGeneral(info.gnrl_id,info.gnrl_num);return!!isExist||!!(isExist=this.isExistLimitOverCard(info))}return!1}return!1},GeneralService.prototype.isExistLimitOverCard=function(info){var mt=MasterManager.getInstance(),m=MasterTable.getInstance(),general=mt.get_General_freeze(info.gnrl_id),need_mtrl_list=[];if(this.isExistLimitOverCardExceptList(general.gnrl_group)){for(var is_only_group_exist=!1,only_card_info_list=m.get_LimitOverOnlyCardList(),idx=0;idx<only_card_info_list.length;idx++){var only_card=only_card_info_list[idx];if(general.gnrl_group==only_card.only_gnrl_group&&only_card.rare_type==info.rare_type&&only_card.limit_over_step==info.limit_step_id){is_only_group_exist=!0,need_mtrl_list.push_back(only_card);break}}if(!is_only_group_exist)return!1}else for(only_card_info_list=m.get_LimitOverOnlyCardList(),idx=0;idx<only_card_info_list.length;idx++){only_card=only_card_info_list[idx];general.rare_type!=only_card.rare_type||info.limit_step_id!=only_card.limit_over_step||0!=only_card.only_gnrl_group&&only_card.only_gnrl_group!=general.gnrl_group||need_mtrl_list.push_back(only_card)}var user_gnrls=[];NetService().getUserGeneral(user_gnrls);for(idx=0;idx<need_mtrl_list.length;idx++){for(var need_mtrl=need_mtrl_list[idx],count=0,jdx=0;jdx<user_gnrls.length;jdx++){var gnrl=user_gnrls[jdx];mt.get_General(gnrl.gnrl_id).gnrl_id==need_mtrl.need_mtrl_gnrl_id&&count++}if(0<need_mtrl.need_count&&need_mtrl.need_count<=count)return!0}return!1},GeneralService.prototype.isExistSameGeneral=function(gnrl_id,gnrl_num){var mt=MasterManager.getInstance(),user_gnrls=[];NetService().getUserGeneral(user_gnrls);for(var base_gnrl=mt.get_General_freeze(gnrl_id),idx=0;idx<user_gnrls.length;idx++){var gnrl=user_gnrls[idx],mtrl_gnrl=mt.get_General_freeze(gnrl.gnrl_id);if(mtrl_gnrl.gnrl_group==base_gnrl.gnrl_group&&mtrl_gnrl.gnrl_type!=GENERAL_TYPE_LIMIT_OVER&&mtrl_gnrl.gnrl_class>=YUNHEE_MAX_CLASS_TYPE&&gnrl.gnrl_num!=gnrl_num)return!0}return!1},GeneralService.prototype.isLeader=function(troops_num,gnrl_id,gnrl_num){for(var g in NetService.list_User_Troops_General)if(g.troops_num==troops_num&&g.gnrl_id==gnrl_id&&g.gnrl_num==gnrl_num)return"y"==g.leader_yn;return!1},GeneralService.prototype.isPartner=function(gnrl_id,gnrl_num){var partner=GameContext.getInstance().getUserGeneralPartner();return partner.gnrl_id==gnrl_id&&partner.gnrl_num==gnrl_num},GeneralService.prototype.isFriendPartner=function(gnrl_id,gnrl_num){var friend_partner=GameContext.getInstance().getUserFriendPartner();return null!=friend_partner&&(friend_partner.gnrl_id==gnrl_id&&friend_partner.gnrl_num==gnrl_num)},GeneralService.prototype.isExistUserTroopsGeneral=function(troops){var user_troops_general=[];NetService().getUserPartyGeneral(user_troops_general);for(var iter=user_troops_general.begin();iter!=user_troops_general.end();){if(iter.troops_num==troops.troops_num&&iter.gnrl_id==troops.gnrl_id&&iter.gnrl_num==troops.gnrl_num){!0;break}++iter}return!1},GeneralService.prototype.isExistUserTroopsPos=function(troops_num,pos_type){for(var user_troops_general=NetService().getUserPartyGeneral(),isExist=!1,key=user_troops_general.keys(),idx=0;idx<key.length;idx++)if(user_troops_general.at(key[idx]).troops_num==troops_num&&user_troops_general.at(key[idx]).position==pos_type){isExist=!0;break}return isExist},GeneralService.prototype.getUserFriendPartnerId=function(){return GameContext.getInstance().getUserFriendPartner().gnrl_id},GeneralService.prototype.getUserFriendPartnerKey=function(){var friend_partner=GameContext.getInstance().getUserFriendPartner();(void 0).gnrl_id=friend_partner.gnrl_id,(void 0).gnrl_num=friend_partner.gnrl_num},GeneralService.prototype.getUserTroopsGeneralDistinctList=function(list){for(var set=new Set,user_troops_general=NetService().getUserPartyGeneral(),keys=user_troops_general.keys(),idx=0;idx<keys.length;idx++){var key=keys[idx],obj={id:user_troops_general.at(key).gnrl_id,num:user_troops_general.at(key).gnrl_num};if(!set.has(JSON.stringify(obj))){set.add(JSON.stringify(obj));var troops={};troops.gnrl_id=user_troops_general.at(key).gnrl_id,troops.gnrl_num=user_troops_general.at(key).gnrl_num,troops.troops_num=user_troops_general.at(key).troops_num,troops.pos_type=user_troops_general.at(key).position,troops.is_leader="y"==user_troops_general.at(key).leader_yn,list.push(troops)}}},GeneralService.prototype.getUserTroopsGeneralList=function(troops_num){for(var list=[],user_troops_general=NetService().getUserPartyGeneral(),keys=user_troops_general.keys(),idx=0;idx<keys.length;idx++){var troops,key=keys[idx];if(null==user_troops_general.at(key).gnrl_id)break;if("number"==typeof troops_num){if(user_troops_general.at(key).troops_num==troops_num)(troops={}).gnrl_id=user_troops_general.at(key).gnrl_id,troops.gnrl_num=user_troops_general.at(key).gnrl_num,troops.troops_num=user_troops_general.at(key).troops_num,troops.pos_type=user_troops_general.at(key).position,troops.is_leader="y"==user_troops_general.at(key).leader_yn,list.push(troops)}else(troops={}).gnrl_id=user_troops_general.at(key).gnrl_id,troops.gnrl_num=user_troops_general.at(key).gnrl_num,troops.troops_num=user_troops_general.at(key).troops_num,troops.pos_type=user_troops_general.at(key).position,troops.is_leader="y"==user_troops_general.at(key).leader_yn,list.push(troops)}return list},GeneralService.prototype.getTroopsGeneralCount=function(troops_num){for(var count=0,user_troops_general=NetService().getUserPartyGeneral(),key=user_troops_general.keys(),idx=0;idx<key.length;idx++)user_troops_general.at(key[idx]).troops_num==troops_num&&count++;return count},GeneralService.prototype.isExistGeneralInTroops=function(troops_num,gnrl_num){var isExist=!1,user_troops_general=NetService().getUserPartyGeneral(),key=user_troops_general.keys();if(null==gnrl_num){for(var idx=0;idx<key.length;idx++)if(user_troops_general.at(key[idx]).gnrl_num==troops_num){isExist=!0;break}}else for(idx=0;idx<key.length;idx++)if(user_troops_general.at(key[idx]).gnrl_num==gnrl_num&&user_troops_general.at(key[idx]).troops_num==troops_num){isExist=!0;break}return isExist},GeneralService.prototype.getUerTroopsGeneral=function(party,troops_num,pos_type){var user_troops_general=NetService().getUserPartyGeneral();if(null!=troops_num&&null!=troops_num){for(var key=user_troops_general.keys(),idx=0;idx<key.length;idx++)if(user_troops_general.at(key[idx]).troops_num==troops_num&&user_troops_general.at(key[idx]).position==pos_type){party.gnrl_id=user_troops_general.at(key[idx]).gnrl_id,party.gnrl_num=user_troops_general.at(key[idx]).gnrl_num,party.troops_num=user_troops_general.at(key[idx]).troops_num,party.pos_type=user_troops_general.at(key[idx]).position,party.is_leader="y"==user_troops_general.at(key[idx]).leader_yn;break}}else for(key=user_troops_general.keys(),idx=0;idx<key.length;idx++)if(user_troops_general.at(key[idx]).gnrl_id==gnrl_id&&user_troops_general.at(key[idx]).gnrl_num==gnrl_num&&user_troops_general.at(key[idx]).troops_num==troops_num){party.pos_type=user_troops_general.at(key[idx]).position;break}},GeneralService.prototype.checkTroopsPosition=function(troops){for(var user_troops_general=NetService().getUserPartyGeneral(),isCrrntPos=!1,key=user_troops_general.keys(),idx=0;idx<key.length;idx++)if(user_troops_general.at(key[idx]).gnrl_num==troops.gnrl_num&&user_troops_general.at(key[idx]).troops_num==troops.troops_num&&user_troops_general.at(key[idx]).position==troops.pos_type){isCrrntPos=!0;break}return isCrrntPos},GeneralService.prototype.getTroopsCost=function(troops_num){for(var cost=0,m=MasterManager.getInstance(),user_troops_general=NetService().getUserPartyGeneral(),gnrl_ids=[],key=user_troops_general.keys(),idx=0;idx<key.length;idx++)user_troops_general.at(key[idx]).troops_num==troops_num&&gnrl_ids.push(user_troops_general.at(key[idx]));for(idx=0;idx<gnrl_ids.length;idx++){var gnrl_id=gnrl_ids[idx];cost+=m.get_General(gnrl_id.gnrl_id).cost}return cost},GeneralService.prototype.getUserTotalCost=function(troops_num){var totalCost=NetService().get_user_troops().at(troops_num);return null==totalCost&&(totalCost={cost:0}),totalCost},GeneralService.prototype.isCostOver=function(gnrl_troops,troops_num){var isOver=!1,def=this.getUserTotalCost(troops_num);null==def&&(def={cost:0});for(var crrnt_cost=0,totalCost=def.cost,m=MasterManager.getInstance(),user_troops_general=NetService().getUserPartyGeneral(),gnrl_ids=[],key=user_troops_general.keys(),idx=0;idx<key.length;idx++)if(user_troops_general.at(key[idx]).troops_num==gnrl_troops.troops_num&&user_troops_general.at(key[idx]).position!=gnrl_troops.pos_type&&user_troops_general.at(key[idx]).gnrl_num!=gnrl_troops.gnrl_num){var gnrl_id=user_troops_general.at(key[idx]).gnrl_id;gnrl_ids.push(gnrl_id)}gnrl_ids.push(gnrl_troops.gnrl_id);for(idx=0;idx<gnrl_ids.length;idx++){crrnt_cost+=m.get_General(gnrl_ids[idx]).cost}return totalCost<crrnt_cost?isOver=!0:isOver},GeneralService.prototype.getUserTroopsPartnerId=function(){return GameContext.getInstance().getUserGeneralPartner().gnrl_id},GeneralService.prototype.getUserTroopsPartnerKey=function(){var key=new db.UserGeneralKey,partner=GameContext.getInstance().getUserGeneralPartner();return key.gnrl_id=partner.gnrl_id,key.gnrl_num=partner.gnrl_num,key},GeneralService.prototype.getRareType=function(gnrl_id){return MasterTable.getInstance().getMasterTable().get_General_freeze(gnrl_id).rare_type},GeneralService.prototype.getElementType=function(gnrl_id){return MasterManager.getInstance().get_General_freeze(gnrl_id).element_type},GeneralService.prototype.getDelGeneralNumInTroops=function(troops_num,pos_type){for(var gnrl_num=0,gnrl_id=0,user_troops_general=NetService().getUserPartyGeneral(),key=user_troops_general.keys(),idx=0;idx<key.length;idx++)if(user_troops_general.at(key[idx]).troops_num==troops_num&&user_troops_general.at(key[idx]).position==pos_type){gnrl_num=user_troops_general.at(key[idx]).gnrl_num,gnrl_id=user_troops_general.at(key[idx]).gnrl_id;break}var isExist=!1;for(idx=0;idx<key.length;idx++)if(user_troops_general.at(key[idx]).gnrl_num==gnrl_num&&user_troops_general.at(key[idx]).gnrl_id==gnrl_id){isExist=!0;break}return isExist&&(gnrl_id=gnrl_num=0),(key=new db.UserGeneralKey).gnrl_id=gnrl_id,key.gnrl_num=gnrl_num,key},GeneralService.prototype.getBattleFormationLevelUpNeedGoods=function(formation_id,format_info){var battle_formation=MasterManager.getInstance().get_BattleFormationV2(formation_id);return format_info.formation_level=battle_formation.formation_level,format_info.position_type=battle_formation.position_type,format_info.combo_stat=battle_formation.combo_stat,format_info.property_type=battle_formation.formation_property_type,format_info.max_level=0,format_info.next_level=0,format_info.max_level=this.getFormationMaxLevel(format_info.position_type,format_info.combo_stat),format_info.next_level=format_info.formation_level+1,format_info.max_level<=format_info.formation_level||(null!=(battle_formation=MasterManager.getInstance().get_All_BattleFormationV2().find(function(formation){if(formation.formation_level==format_info.next_level&&formation.position_type==format_info.position_type&&formation.combo_stat==format_info.combo_stat)return!0}))&&(format_info.need_formation_point=battle_formation.formation_point,format_info.need_gold=battle_formation.need_gold,format_info.property_point=battle_formation.property_point_count),!1)},GeneralService.prototype.getFormationLevel=function(formation_id){var m_battle_fomation=MasterManager.getInstance().get_BattleFormationV2(formation_id);return $.extend({},m_battle_fomation).formation_level},GeneralService.prototype.getFormationMaxLevel=function(position_type,combo_stat){var max_level=0,level_list=MasterManager.getInstance().get_All_BattleFormationV2().filter(function(formation){if(formation.position_type==position_type&&formation.combo_stat==combo_stat)return!0});level_list.sort(function(l,r){return l.formation_level<r.formation_level?1:l.formation_level>r.formation_level?-1:0});try{max_level=level_list[0].formation_level}catch(e){max_level=0}return max_level},GeneralService.prototype.getYunheePostionName=function(position_type){return MasterManager.getInstance().get_PositionType(position_type).name},GeneralService.prototype.getBattleFormationValue=function(formation_id){return MasterManager.getInstance().get_BattleFormationV2(formation_id).value},GeneralService.prototype.getBattleFormationNextLevelValue=function(before_formation_id,next_level){var position_type,combo_stat,value=0,formation=MasterManager.getInstance().get_BattleFormationV2(before_formation_id);position_type=formation.position_type,combo_stat=formation.combo_stat;var battle_formation=MasterManager.getInstance().get_All_BattleFormationV2().find(function(formation){if(formation.formation_level==next_level&&formation.position_type==position_type&&formation.combo_stat==combo_stat)return!0});return null!=battle_formation&&(value=battle_formation.value),value},GeneralService.prototype.getUserBattleFormationId=function(troops_num){return NetService().get_user_troops().at(troops_num).formation_id},GeneralService.prototype.getUserBattleFormationInfo=function(troops_num,bttlForm){var troops=NetService().get_user_troops().at(troops_num);return null==troops&&(troops={formation_id:0}),MasterManager.getInstance().get_BattleFormation(troops.formation_id)},GeneralService.prototype.getUserBattleFormationList=function(){return NetService().get_User_Battle_Formation()},GeneralService.prototype.getBattleFormationLevelUpNeedGold=function(formation_id){var next_level,m=MasterTable.getInstance();return next_level=m.get_BattleFormation(formation_id).level+1,m.get_BattleFormationLevelupExpense(next_level).need_gold},GeneralService.prototype.getBattleFormationName=function(formation_id){return MasterTable.getInstance().get_BattleFormation(formation_id).name},GeneralService.prototype.getUserFormationLevelUpCount=function(){return 0},GeneralService.prototype.getBattleFormationNextLevelLimitUserLevel=function(formation_id){return 0},GeneralService.prototype.isEnabledFormationInit=function(){for(var isEnabled=!1,list=this.getUserBattleFormationList(),keys=list.keys(),idx=0;idx<keys.length;idx++){if(1<this.getBattleFormationLevel(list.at(keys[idx]).formation_id)){isEnabled=!0;break}}return isEnabled},GeneralService.prototype.getBattleFormationLevel=function(formation_id){return MasterManager.getInstance().get_BattleFormationV2(formation_id).formation_level},GeneralService.prototype.getUserGeneralActiveSkill=function(skikll_id,active_skill){new db.UserGeneralActiveSkillInfo;MasterTable.getInstance().get_ActiveSkill(skikll_id)},GeneralService.prototype.getNormalComboId=function(state_type,arm_service_type,need_count,combo_list){},GeneralService.prototype.getSpecialComboId=function(gnrl_state_list,combo_list){var combo_states=[],combos=[];for(var i in this.getCombo(combos),combos){var state=new db.ComboGeneralState;state.combo_id=i.combo_id,0!=i.state_1&&(state.gnrl_states.push(i.state_1),0!=i.state_2&&state.gnrl_states.push(i.state_2),0!=i.state_3&&state.gnrl_states.push(i.state_3),0!=i.state_4&&state.gnrl_states.push(i.state_4),0!=i.state_5&&state.gnrl_states.push(i.state_5),0!=i.state_6&&state.gnrl_states.push(i.state_6),state.count=i.need_count,combo_states.push(state))}for(var i in combo_states){if(!i.gnrl_states.empty()){for(var state_type in gnrl_state_list);if(0==i.count){var combo=MasterTable.getInstance().get_Combo(i.combo_id),info=new db.ComboInfo;info.combo_id=i.combo_id,info.name=combo.name,info.content=combo.content,combo_list.push(info)}}}},GeneralService.prototype.getCombo=function(){var val=arguments;switch(val.length){case 1:val[0];break;case 2:var combo_id=val[0];val[1];MasterTable.getInstance().get_Combo(combo_id);break;default:return}},GeneralService.prototype.getSpecialCombo=function(gnrl_state,combo){var combos=[];for(var cb in this.getCombo(combos),combos)if(cb.state_1==gnrl_state||cb.state_2==gnrl_state||cb.state_3==gnrl_state||cb.state_4==gnrl_state||cb.state_5==gnrl_state||cb.state_6==gnrl_state)return void cb},GeneralService.prototype.getBookGeneralList=function(){for(var service=EventDungeonService.getInstance(),m=MasterManager.getInstance(),bookGenerals=MasterTable.getInstance().get_BookGenerals(),generals=[],idx=0;idx<bookGenerals.length;idx++){var period_idx=bookGenerals[idx].first_second_half_type;if(0<period_idx)if(!service.IsOpenEventDungeonBuff(period_idx))continue;var general=m.get_General(bookGenerals[idx].gnrl_id),bookGeneral={passive_skill:[],leader_skill:[],trans_passive_skill:[],special_leader_skill:[]};bookGeneral.gnrl_id=general.gnrl_id,bookGeneral.book_num=bookGenerals[idx].num,bookGeneral.gnrl_class=general.gnrl_class,bookGeneral.gnrl_type=general.gnrl_type,bookGeneral.fight_type=general.fight_type,bookGeneral.arm_service_type=general.arm_service_type,bookGeneral.name=general.name,bookGeneral.state_type=general.state_type,bookGeneral.cost=general.cost,bookGeneral.gnrl_group=general.gnrl_group,bookGeneral.max_class_type=general.evolution_max_class_type,bookGeneral.rare_type=general.rare_type,bookGeneral.passive_skill.push(general.passive_skill_id),bookGeneral.leader_skill.push(general.leader_skill_id),general.trans_passive_skill_id.split(",").forEach(function(p_id){var trans_passive_skill_id=parseInt(p_id);bookGeneral.trans_passive_skill.push_back(trans_passive_skill_id)}),general.special_leader_skill_id=general.special_leader_skill_id+"";for(var leader_skill_list=general.special_leader_skill_id.split(","),jdx=0;jdx<leader_skill_list.length;jdx++){var s=leader_skill_list[jdx];bookGeneral.special_leader_skill.push_back(1*s)}bookGeneral.element_type=general.element_type;var gnrl_gender_type=m.get_GeneralDivision(general.gnrl_group);bookGeneral.gender_type=gnrl_gender_type.general_gender_type,this.getUserBookGeneral(bookGeneral),generals.push(bookGeneral)}return generals},GeneralService.prototype.getBookGeneralInfo=function(num,userBookGeneral){var m=MasterManager.getInstance(),bookGeneral=m.get_BookGeneral(num),general=m.get_General(bookGeneral.gnrl_id);userBookGeneral.gnrl_id=general.gnrl_id,userBookGeneral.gnrl_class=general.gnrl_class,userBookGeneral.gnrl_type=general.gnrl_type,userBookGeneral.fight_type=general.fight_type,userBookGeneral.arm_service_type=general.arm_service_type,userBookGeneral.name=general.name,userBookGeneral.state_type=general.state_type,userBookGeneral.cost=general.cost,userBookGeneral.active_skill=general.active_skill_id,userBookGeneral.bone_id=general.bone_id,userBookGeneral.skin_id=general.skin_id,userBookGeneral.max_level=general.max_level,userBookGeneral.master_type=general.master_type,userBookGeneral.gnrl_group=general.gnrl_group,userBookGeneral.gnrl_type=general.gnrl_type,userBookGeneral.max_class_type=general.evolution_max_class_type,userBookGeneral.frnd_effect=general.friend_num,userBookGeneral.rare_type=general.rare_type,userBookGeneral.element_type=general.element_type,userBookGeneral.passive_skill.push(general.passive_skill_id),userBookGeneral.leader_skill.push(general.leader_skill_id),general.trans_passive_skill_id.split(",").forEach(function(p_id){var trans_passive_skill_id=parseInt(p_id);userBookGeneral.trans_passive_skill.push_back(trans_passive_skill_id)}),general.special_leader_skill_id=general.special_leader_skill_id+"";for(var leader_skill_list=general.special_leader_skill_id.split(","),jdx=0;jdx<leader_skill_list.length;jdx++){var s=leader_skill_list[jdx];userBookGeneral.special_leader_skill.push_back(1*s)}userBookGeneral.content=bookGeneral.content,userBookGeneral.book_num=bookGeneral.num;var general_diveision=m.get_GeneralDivision(general.gnrl_group);userBookGeneral.gender_type=general_diveision.general_gender_type;var info=new db.UserGeneralInfo;info.gnrl_id=general.gnrl_id,info.rare_type=general.rare_type,info.arm_service_type=general.arm_service_type,info.base_attk=general.attk,info.base_def=general.def,info.base_hp=general.hp,info.base_sp=general.sp,info.base_cri_prcnt=general.cri_percent,info.base_cri_ratio=general.cri_ratio,info.base_guard_rate=general.guard_rate,info.base_guard_decrease=general.guard_value,info.gnrl_level=1,info.class_type=general.gnrl_class,info.gnrl_group=general.gnrl_group,info.passive_skill.push(general.passive_skill_id),info.leader_skill.push(general.leader_skill_id),general.trans_passive_skill_id.split(",").forEach(function(p_id){var trans_passive_skill_id=parseInt(p_id);info.trans_passive_skill.push_back(trans_passive_skill_id)}),general.special_leader_skill_id=general.special_leader_skill_id+"";for(leader_skill_list=general.special_leader_skill_id.split(","),jdx=0;jdx<leader_skill_list.length;jdx++){s=leader_skill_list[jdx];info.special_leader_skill.push_back(1*s)}userBookGeneral.attk=this.getUserGeneralAttk(info),userBookGeneral.def=this.getUserGeneralDef(info),userBookGeneral.hp=this.getUserGeneralHp(info),userBookGeneral.sp=general.sp,userBookGeneral.cri_prcnt=this.getUserGeneralCriPrcnt(info),userBookGeneral.cri_ratio=this.getUserGeneralCriDmg(info),userBookGeneral.guard_rate=this.getUserGeneralDefPrcnt(info),userBookGeneral.guard_decrease=this.getUserGeneralDefDecrease(info),this.getUserBookGeneral(userBookGeneral)},GeneralService.prototype.getUserBookGeneralNickname=function(gnrl_id){var m_book_general=MasterManager.getInstance().get_AllBookGeneral();for(var idx in m_book_general)if(m_book_general[idx].gnrl_id==gnrl_id)return m_book_general[idx].nickname},GeneralService.prototype.getUserBookGeneral=function(userBookGeneral){var m_yh_user_BookGeneral=NetService().get_User_Book_General();userBookGeneral.is_gain=!1;for(var idx=0;idx<m_yh_user_BookGeneral.length;idx++)m_yh_user_BookGeneral[idx].gnrl_id==userBookGeneral.gnrl_id&&(userBookGeneral.is_max_level="y"==m_yh_user_BookGeneral[idx].max_level_complete_yn,userBookGeneral.is_max_love_level="y"==m_yh_user_BookGeneral[idx].love_max_level_complete_yn,userBookGeneral.is_gain=!0)},GeneralService.prototype.isPartnerGeneral=function(key){var isPartner=!1,partner=GameContext.getInstance().getUserGeneralPartner();return partner.gnrl_id==key.gnrl_id&&partner.gnrl_num==key.gnrl_num&&(isPartner=!0),isPartner},GeneralService.prototype.getFakeGeneralId=function(){for(var m_map_general=MasterTable.getInstance().getMasterTable().get_AllGeneral(),m_map_general_division=MasterTable.getInstance().getMasterTable().get_AllGeneralDivision(),gnrl_ids=[],idx=0;idx<m_map_general.length;idx++)for(var a=m_map_general[idx],jdx=0;jdx<m_map_general_division.length;jdx++){var b=m_map_general_division[jdx];if(a.gnrl_group==b.gnrl_group&&1==b.general_gender_type&&1==a.gnrl_class&&a.gnrl_type==GENERAL_TYPE_YUNHEE&&a.rare_type<=RARE_TYPE_HR&&a.rare_type>=RARE_TYPE_R){var gnrl_id=a.gnrl_id;gnrl_ids.push(gnrl_id)}}return shuffle(gnrl_ids)[0]},GeneralService.prototype.getResistanceValueColor=function(value){return value<1?COLOR(1877):value<=33?COLOR(1879):value<=66?COLOR(1871):value<=99?COLOR(1881):COLOR(1878)},GeneralService.prototype.getResistanceValueToName=function(value){return value<1?"":value<=33?"":value<=66?"":value<=99?"":" "},GeneralService.prototype.getUserGeneralInfoList=function(list,isFriend){null==isFriend&&(isFriend=!1);var hanven_gnrls,gnrls=[];!0===isFriend?(new NetService).getFriendGeneral(gnrls):(new NetService).getUserGeneral(gnrls);hanven_gnrls=gnrls.filter(function(g){if(5==g.limit_step_id)return!0});var mt=MasterManager.getInstance();gnrls.some(function(gnrl){var g=mt.get_General_freeze(gnrl.gnrl_id);if("number"==typeof isFriend&&g.element_type!=isFriend)return!1;if("boolean"==typeof isFriend&&g.gnrl_type!=GENERAL_TYPE_YUNHEE&&g.gnrl_type!=GENERAL_TYPE_SOLDIER)return!1;var info=new db.UserGeneralInfo;info.gnrl_id=gnrl.gnrl_id,info.gnrl_num=gnrl.gnrl_num,info.gnrl_level=gnrl.gnrl_level,info.gnrl_exp=gnrl.gnrl_exp,info.castle_id=gnrl.castle_id,info.is_lock="y"==gnrl.lock_yn,info.love_level=gnrl.love_level,info.love_exp=gnrl.love_exp,info.limit_step_id=gnrl.limit_step_id,info.using_in_camp="y"==gnrl.using_in_camp,info.used_in_camp="y"==gnrl.used_in_camp,info.buff_type=gnrl.buff_type;var gender=mt.get_GeneralDivision(g.gnrl_group);0==gnrl.display_class?info.display_class=g.gnrl_class:info.display_class=gnrl.display_class,info.gender_type=gender.general_gender_type,info.name=g.name,info.active_skill=g.active_skill_id,info.element_type=g.element_type,info.class_type=g.gnrl_class,info.cost=g.cost,info.gnrl_type=g.gnrl_type,info.gnrl_group=g.gnrl_group,info.base_attk=g.attk,info.base_def=g.def,info.base_hp=g.hp,info.base_sp=g.sp,info.base_cri_prcnt=g.cri_percent,info.base_cri_ratio=g.cri_ratio,info.base_guard_rate=g.guard_rate,info.base_guard_decrease=g.guard_value,info.fight_type=g.fight_type,info.arm_service_type=g.arm_service_type,info.skin_id=g.skin_id,info.bone_id=g.bone_id,info.max_class_type=g.evolution_max_class_type,info.combo_group_num=g.combo_group_num,info.evolution_group_num=g.evolution_group_num,info.frnd_effect=g.friend_num,info.love_stat_group=g.love_stat_group,info.evolution_mtrl_num=g.evolution_mtrl_num,info.sell_gold=g.sell_gold,info.sell_yhpt=g.sell_yhpt,info.level_exp_group=g.level_exp_group,info.rare_type=g.rare_type,info.passive_skill.push(g.passive_skill_id),info.leader_skill.push(g.leader_skill_id),g.trans_passive_skill_id.split(",").forEach(function(p_id){var trans_passive_skill_id=parseInt(p_id);info.trans_passive_skill.push_back(trans_passive_skill_id)});for(var leader_skill_list=(g.special_leader_skill_id+"").split(","),jdx=0;jdx<leader_skill_list.length;jdx++){var s=leader_skill_list[jdx];info.special_leader_skill.push_back(1*s)}var key={};(key.gnrl_id=info.gnrl_id,key.gnrl_num=info.gnrl_num,info.attk=this.getUserGeneralAttk(info),info.def=this.getUserGeneralDef(info),info.hp=this.getUserGeneralHp(info),info.sp=info.base_sp,info.cri_prcnt=this.getUserGeneralCriPrcnt(info),info.cri_ratio=this.getUserGeneralCriDmg(info),info.guard_rate=this.getUserGeneralDefPrcnt(info),info.guard_decrease=this.getUserGeneralDefDecrease(info),info.master_type=g.master_type,info.state_type=g.state_type,info.total_attk_pwr=info.attk+info.def+info.hp,this.getGeneralHeavnePtInfo(info,hanven_gnrls),0<info.limit_step_id?info.max_level=this.getLimitOverMaxLevel(info.limit_step_id):info.max_level=g.max_level,info.isPartner=this.isPartner(info.gnrl_id,info.gnrl_num),info.is_friend_partner=this.isFriendPartner(info.gnrl_id,info.gnrl_num),info.isEnabledEvolve=!1,info.isEnabledLimitOver=!1,info.max_level==info.gnrl_level)&&(info.isMaxLevel=!0,this.isEnabledEvolve(info)&&(info.isEnabledEvolve=!0),info.class_type>=info.max_class_type&&this.isEnabledLimitOver(info)&&(info.isEnabledLimitOver=!0));(info.is_enable_rebirth=!1,info.is_rebirth_object=this.isRebirthObject(info.class_type,info.gnrl_group,info.gnrl_type),info.is_rebirth_object)&&(this.isEnabledRebirth(info)&&(info.is_enable_rebirth=!0));"number"==typeof isFriend?info.element_type==isFriend&&list.push(info):list.push(info)}.bind(this))},GeneralService.prototype.getUserGeneralMaterialInfoList=function(list,yunhee_type){var gnrls=[];NetService().getUserGeneral(gnrls);for(var world_war_troops_generals=NetServiceV3.getInstance().get_list_User_World_War_Troops_General(),w_service=WorldWarService.getInstance(),hanven_gnrls=gnrls.filter(function(g){if(5==g.limit_step_id)return!0}),mt=MasterManager.getInstance(),g_idx=0;g_idx<gnrls.length;g_idx++){var gnrl=gnrls[g_idx],g=mt.get_General(gnrl.gnrl_id);if(null==yunhee_type){if(g.gnrl_type==GENERAL_TYPE_YUNHEE||g.gnrl_type==GENERAL_TYPE_SOLDIER)continue}else{if(g.gnrl_type==GENERAL_TYPE_YUNHEE||g.gnrl_type==GENERAL_TYPE_SOLDIER)continue;if(g.gnrl_type==GENERAL_TYPE_MATERIAL||g.gnrl_type==GENERAL_TYPE_LIMIT_OVER){if(yunhee_type==YUNHEE_MATERIAL_TYPE_LEVEL_UP&&g.gnrl_type!=GENERAL_TYPE_MATERIAL)continue;if(yunhee_type==YUNHEE_MATERIAL_TYPE_LIMIT_OVER&&g.gnrl_type!=GENERAL_TYPE_LIMIT_OVER)continue}}var info=new db.UserGeneralInfo;if(info.gnrl_id=gnrl.gnrl_id,info.gnrl_num=gnrl.gnrl_num,info.gnrl_level=gnrl.gnrl_level,info.gnrl_exp=gnrl.gnrl_exp,info.castle_id=gnrl.castle_id,info.is_lock="y"==gnrl.lock_yn,info.love_level=gnrl.love_level,info.love_exp=gnrl.love_exp,info.limit_step_id=gnrl.limit_step_id,info.using_in_camp="y"==gnrl.using_in_camp,info.used_in_camp="y"==gnrl.used_in_camp,info.buff_type=gnrl.buff_type,!w_service.isWorldWarUnification()&&w_service.isWorldWarPeriodOpen()){for(var keys=world_war_troops_generals.keys(),found=!1,wwgnrl_idx=0;wwgnrl_idx<keys.length;wwgnrl_idx++){var tg=world_war_troops_generals.at(keys[wwgnrl_idx]);if(tg.gnrl_id==info.gnrl_id&&tg.gnrl_num==info.gnrl_num){found=!0;break}}found&&(info.using_in_world_war_troops=!0)}var gender=mt.get_GeneralDivision(g.gnrl_group);if(0==gnrl.display_class?info.display_class=g.gnrl_class:info.display_class=gnrl.display_class,info.gender_type=gender.general_gender_type,info.name=g.name,info.active_skill=g.active_skill_id,info.element_type=g.element_type,info.class_type=g.gnrl_class,info.cost=g.cost,info.gnrl_type=g.gnrl_type,info.gnrl_group=g.gnrl_group,info.base_attk=g.attk,info.base_def=g.def,info.base_hp=g.hp,info.base_sp=g.sp,info.base_cri_prcnt=g.cri_percent,info.base_cri_ratio=g.cri_ratio,info.base_guard_rate=g.guard_rate,info.base_guard_decrease=g.guard_value,info.fight_type=g.fight_type,info.arm_service_type=g.arm_service_type,info.skin_id=g.skin_id,info.bone_id=g.bone_id,info.max_class_type=g.evolution_max_class_type,info.combo_group_num=g.combo_group_num,info.evolution_group_num=g.evolution_group_num,info.frnd_effect=g.friend_num,info.love_stat_group=g.love_stat_group,info.evolution_mtrl_num=g.evolution_mtrl_num,info.sell_gold=g.sell_gold,info.sell_yhpt=g.sell_yhpt,info.level_exp_group=g.level_exp_group,info.rare_type=g.rare_type,info.passive_skill.push_back(g.passive_skill_id),info.leader_skill.push_back(g.leader_skill_id),g.trans_passive_skill_id.split(",").forEach(function(p_id){var trans_passive_skill_id=parseInt(p_id);info.trans_passive_skill.push_back(trans_passive_skill_id)}),"number"==typeof g.special_leader_skill_id)info.special_leader_skill.push_back(g.special_leader_skill_id);else for(var leader_skill_list=g.special_leader_skill_id.split(","),jdx=0;jdx<leader_skill_list.length;jdx++){var s=leader_skill_list[jdx];info.special_leader_skill.push_back(1*s)}var key={};key.gnrl_id=info.gnrl_id,key.gnrl_num=info.gnrl_num,info.attk=info.base_attk,info.def=info.base_def,info.hp=info.base_hp,info.sp=info.base_sp,info.cri_prcnt=info.base_cri_prcnt,info.cri_ratio=info.base_cri_ratio,info.guard_rate=info.base_guard_rate,info.guard_decrease=info.base_guard_decrease,info.master_type=g.master_type,info.state_type=g.state_type,info.max_level=g.max_level,info.isPartner=!1,info.is_friend_partner=!1,info.isEnabledEvolve=!1,info.isEnabledLimitOver=!1,info.is_enable_rebirth=!1,info.is_rebirth_object=!1,this.getGeneralHeavnePtInfo(info,hanven_gnrls),list.push_back(info)}},GeneralService.prototype.isEnabledEvolve=function(info){var key={};return key.gnrl_id=info.gnrl_id,key.gnrl_num=info.gnrl_num,!(info.class_type>=info.max_class_type)&&(!!info.isMaxLevel&&!!this.isExistEvolutionMtrl(key,info.evolution_mtrl_num))},GeneralService.prototype.getLimitOverMaxLevel=function(limit_step_id){return MasterManager.getInstance().get_GeneralLimit(limit_step_id).ext_level_id},GeneralService.prototype.getUserGnrlDisplayClassInfo=function(gnrl_key,info){var user_gnrl=NetService().getUserGeneral({},gnrl_key);info.gnrl_id=gnrl_key.gnrl_id,info.gnrl_num=gnrl_key.gnrl_num;var mt_gnrl=MasterManager.getInstance().get_General_freeze(gnrl_key.gnrl_id);return 0==user_gnrl.display_class?info.display_class=mt_gnrl.gnrl_class:info.display_class=user_gnrl.display_class,user_gnrl.display_class>YUNHEE_MAX_CLASS_TYPE&&(info.display_class=YUNHEE_MAX_CLASS_TYPE),info.gnrl_group=mt_gnrl.gnrl_group,info.class_type=mt_gnrl.gnrl_class,info},GeneralService.prototype.getEventLimitOverCardStandingGnrlId=function(gnrl_group){var gnrl_id=0,gnrl=MasterManager.getInstance().get_AllGeneral();for(var idx in gnrl){var l=gnrl[idx];if(l.gnrl_group==gnrl_group&&l.gnrl_type==GENERAL_TYPE_YUNHEE){gnrl_id=l.gnrl_id;break}}return gnrl_id},GeneralService.prototype.getUserGeneralInfoListInSearchTroops=function(info_list){for(var user_event_dungeon_search_troops_general=NetService().get_User_Event_Dungeon_Search_Troops_Generals("list"),idx=0;idx<info_list.length;idx++)for(var info=info_list[idx],g_idx=0;g_idx<user_event_dungeon_search_troops_general.length;g_idx++){var ug=user_event_dungeon_search_troops_general[g_idx];info.gnrl_num==ug.gnrl_num&&(info.using_in_search_troops=!0,info.search_troops_num=ug.troops_num)}},GeneralService.prototype.getMaxHPGeneral=function(info){var origin_point,point=0,m=MasterManager.getInstance(),eq=EquipmentService.getInstance();m.get_General(info.gnrl_id);if(point=origin_point=this.getUserGeneralHp(info),1<info.love_level){var love_stat_idx=BattleService.getInstance().getMasterLoveStat(info.love_stat_group,info.love_level);if(0<love_stat_idx){var stat=m.get_LoveStat(love_stat_idx);0<stat.stat_type_1&&(stat.stat_type_1==LOVE_ITEM_STAT_TYPE_5?point+=origin_point*stat.value_1/100:stat.stat_type_1==LOVE_ITEM_STAT_TYPE_6&&(point+=stat.value_1)),0<stat.stat_type_2&&(stat.stat_type_2==LOVE_ITEM_STAT_TYPE_5?point+=origin_point*stat.value_2/100:stat.stat_type_2==LOVE_ITEM_STAT_TYPE_6&&(point+=stat.value_2)),0<stat.stat_type_3&&(stat.stat_type_3==LOVE_ITEM_STAT_TYPE_5?point+=origin_point*stat.value_3/100:stat.stat_type_3==LOVE_ITEM_STAT_TYPE_6&&(point+=stat.value_3))}}if(info.arm_service_type<db.GeneralArmServiceType.ArmServiceType_Captain){var abil=CampService.getInstance().getUserCampBranchAbility(info.arm_service_type);1==CAMP_LOVE_STAT_TYPE?point+=origin_point*(abil.health/1e4):point+=abil.health}for(var p=0,formation_list=this.getUserBattleFormationList(),keys=formation_list.keys(),idx=0;idx<keys.length;idx++)formation_list.at(keys[idx]).combo_stat==database.BattleChainStatType.ChainStatType_Hp_Rate&&formation_list.at(keys[idx]).position_type==info.position&&(p+=this.getBattleFormationValue(formation_list.at(keys[idx]).formation_id)),point+=origin_point*p/100;var key={};return key.gnrl_id=info.gnrl_id,key.gnrl_num=info.gnrl_num,point+=eq.getEquipmentBuff(key,database.BattleChainStatType.ChainStatType_Hp_Value),point+=point*eq.getEquipmentBuff(key,database.BattleChainStatType.ChainStatType_Hp_Rate)/100,point+=eq.getEquipmentSetGroupBuff(key,database.BattleChainStatType.ChainStatType_Hp_Value),point+=point*eq.getEquipmentSetGroupBuff(key,database.BattleChainStatType.ChainStatType_Hp_Rate)/100},GeneralService.prototype.getMaxHPGeneral2=function(info){var origin_point,point=0,b=BattleContext._getInstance(),m=MasterManager.getInstance(),eq=EquipmentService.getInstance();m.get_General(info.gnrl_id);if(point=origin_point=b.calcBattleGeneralHPPoint(info),1<info.love_level){var love_stat_idx=BattleService.getInstance().getMasterLoveStat(info.love_stat_group,info.love_level);if(0<love_stat_idx){var stat=m.get_LoveStat(love_stat_idx);0<stat.stat_type_1&&(stat.stat_type_1==LOVE_ITEM_STAT_TYPE_5?point+=origin_point*stat.value_1/100:stat.stat_type_1==LOVE_ITEM_STAT_TYPE_6&&(point+=stat.value_1)),0<stat.stat_type_2&&(stat.stat_type_2==LOVE_ITEM_STAT_TYPE_5?point+=origin_point*stat.value_2/100:stat.stat_type_2==LOVE_ITEM_STAT_TYPE_6&&(point+=stat.value_2)),0<stat.stat_type_3&&(stat.stat_type_3==LOVE_ITEM_STAT_TYPE_5?point+=origin_point*stat.value_3/100:stat.stat_type_3==LOVE_ITEM_STAT_TYPE_6&&(point+=stat.value_3))}}if(info.general.arm_service_type<db.GeneralArmServiceType.ArmServiceType_Captain){var abil=CampService.getInstance().getUserCampBranchAbility(info.general.arm_service_type);1==CAMP_LOVE_STAT_TYPE?point+=origin_point*(abil.health/1e4):point+=abil.health}for(var p=0,formation_list=this.getUserBattleFormationList(),keys=formation_list.keys(),idx=0;idx<keys.length;idx++)formation_list.at(keys[idx]).combo_stat==database.BattleChainStatType.ChainStatType_Hp_Rate&&formation_list.at(keys[idx]).position_type==info.position&&(p+=this.getBattleFormationValue(formation_list.at(keys[idx]).formation_id)),point+=origin_point*p/100;var key={};return key.gnrl_id=info.gnrl_id,key.gnrl_num=info.gnrl_num,point+=eq.getEquipmentBuff(key,database.BattleChainStatType.ChainStatType_Hp_Value),point+=point*eq.getEquipmentBuff(key,database.BattleChainStatType.ChainStatType_Hp_Rate)/100,point+=eq.getEquipmentSetGroupBuff(key,database.BattleChainStatType.ChainStatType_Hp_Value),point+=point*eq.getEquipmentSetGroupBuff(key,database.BattleChainStatType.ChainStatType_Hp_Rate)/100},GeneralService.prototype.getLimitOverOnlyCardInfoList=function(rare_type,limit_over_step,gnrl_group){var mt=MasterTable.getInstance(),list=[];mt.get_LimitOverOnlyCardInfoList(rare_type,limit_over_step,gnrl_group,list);var except_list=mt.get_LimitOverCardExceptGeneral();return list=list.filter(function(l){for(var idx=0;idx<except_list.length;idx++){var e=except_list[idx];if(e.gnrl_group==gnrl_group&&e.gnrl_type==GENERAL_TYPE_LIMIT_OVER&&0==l.only_gnrl_group)return!1}return!0})},GeneralService.prototype.isExistGeneral=function(gnrl_id){for(var user_gnrl=NetService().getUser_General(),keys=user_gnrl.keys(),i=0;i<keys.length;i++)if(user_gnrl.at(keys[i]).gnrl_id==gnrl_id)return!0;return!1},{getInstance:function(){return void 0===instance&&(instance=new GeneralService),instance}}}(),NetServiceV3=function(){var instance,list_User_World_War_Troops=null,list_User_World_War_Troops_General=null,list_User_World_War_Partin_General=null,list_User_World_War_General_Equipment_Item=null,list_User_World_War_Castle_Occupation_Info=null,list_User_World_War_Castle_Occupation_Special_Info=null,list_User_World_War_Npc_Troops=null,list_User_World_War_Npc_Troops_General=null,world_war_battle_continue_info=null,list_User_World_War_Unification_First_Clear_Reward_Log=null,map_user_world_war_items=null,map_user_world_war_data=null,vcBoxNode=null,world_war_period_idx=0,world_war_unique_equipment_ticket_count=0,world_war_user_info={};function NetServiceV3(){}return NetServiceV3.prototype.updateResponse_Res_Get_World_War_Season_Info=function(res){WorldWarService.getInstance().setWorldWarSeasonInfo(res.world_war_period_idx,res.season_type),this.deleteall_User_World_War_Troops_General(),0==WOLRD_WAR_SEASON_INFO_FIRST_LOAD?cc.log("################ WorldWar Season Info Data Start ################"):(cc.log("################ WorldWar Season Info Data Start ################"),this.updateResponse_Res_World_War_Npc_Troops(res)),this.updateResponse_Res_Get_World_War_Troops(res),this.updateResponse_Res_Get_World_War_User_Item_Info(res),this.updateResponse_Res_World_War_Castle_Occupation_Info(res),this.updateResponse_Res_World_War_Cell_Box_Info(res),this.updateResponse_Res_User_Unique_Equipment_Ticket(res),this.updateResponse_Res_Get_World_War_Info(res),this.updateResponse_Res_World_War_Battle_Continue_Info(res),this.updateResponse_Res_Get_World_War_Partin_Generals(res),this.updateResponse_Res_Get_World_War_General_Equipments(res),cc.log("################  WorldWar Season Info Data END  ################")},NetServiceV3.prototype.updateResponse_Res_Get_World_War_User_Item_Info=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),0==this.exist_User_World_War_Items()?this.insert_User_World_War_Items(res):this.update_User_World_War_Items(res),NetService().upd_UserWorldWarTicket(res.user_world_war_ticket)},NetServiceV3.prototype.updateResponse_Res_Get_World_War_Troops=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.deleteall_User_World_War_Troops(),this.insert_User_World_War_Troops(res.troops_list,res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_Get_World_War_Partin_Generals=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.deleteall_User_World_War_Partin_Generals(),this.insert_User_World_War_Partin_Generals(res.partin_generals,res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_Get_World_War_General_Equipments=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.deleteall_User_World_War_General_Equipment_Item(),this.insert_User_World_War_General_Equipment_Items(res.gnrl_equipments,res.world_war_period_idx),WorldWarService.getInstance().updateWorldWarUserEquipmentList()},NetServiceV3.prototype.updateResponse_Res_Get_World_War_Info=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),0==this.exist_User_World_War_Data(res.world_war_period_idx)?this.insert_User_World_War_Data(res):this.update_User_World_War_Data(res),world_war_user_info=res},NetServiceV3.prototype.updateResponse_Res_World_War_Castle_Occupation_Info=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.deleteall_User_World_War_Castle_Occupation_Info(),this.deleteall_User_World_War_Castle_Occupation_Special_Info(),this.insert_User_World_War_Castle_Occupation_Infos(res.castle_list,res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Npc_Troops=function(res){this.deleteall_User_World_War_Npc_Troops(),this.deleteall_User_World_War_Npc_Troops_General();for(var troops_list=[],m=MasterManager.getInstance(),period=m.get_WorldWarPeriod(res.world_war_period_idx),_WorldWarNpcArrangement=MasterTable.getInstance().all_map_WorldWarNpcArrangement(),idx=0;idx<_WorldWarNpcArrangement.length;idx++){var npcArr=_WorldWarNpcArrangement[idx];if(npcArr.world_war_group_idx==period.world_war_group_idx){var npcTroop=m.get_WorldWarNpc(npcArr.world_war_npc_idx,1),troop={activity_type:3};troop.current_cell_info_idx=npcArr.pos_base_value,troop.npc_type=2,troop.open_yn="n",troop.prev_cell_info_idx=npcArr.pos_base_value,troop.troops_generals=[];var vcNpcId=[];vcNpcId.push(npcTroop.npc1_id),vcNpcId.push(npcTroop.npc2_id),vcNpcId.push(npcTroop.npc3_id),vcNpcId.push(npcTroop.npc4_id),vcNpcId.push(npcTroop.npc5_id),troop.troops_generals=[];for(var i=0;i<vcNpcId.length;i++){var npc_id=vcNpcId[i];if(0<npc_id){var npc=m.get_NpcGeneral(npc_id);troop.troops_generals.push(this.createUserWorldWarNpcTroopsGeneral(npcArr,i+1,npc.gnrl_id))}}troop.troops_num=CLIENT_CREATE_WW_NPC_TROOPS_NUM,troop.world_war_npc_idx=npcArr.world_war_npc_idx,troops_list.push(troop)}}this.insert_User_World_War_Npc_Troops(troops_list,res.world_war_period_idx);for(i=0;i<res.npc_troops_list.length;i++){var npc_troop=res.npc_troops_list[i];if(this.exist_User_World_War_Npc_Troops(npc_troop,res.world_war_period_idx)){this.update_User_World_War_Npc_Troops(npc_troop,res.world_war_period_idx);for(var j=0;j<npc_troop.troops_generals.length;j++){var npc_troop_general=npc_troop.troops_generals[j];this.update_User_World_War_Npc_Troops_General(npc_troop_general,res.world_war_period_idx)}}}},NetServiceV3.prototype.updateResponse_Res_World_War_Troops_Set=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.update_User_World_War_Troops_Generals(res.troops_num,res.troops_generals),this.deleteall_User_World_War_Partin_Generals(),this.insert_User_World_War_Partin_Generals(res.partin_generals,res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Troops_Del=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.update_User_World_War_Troops_Generals(res.troops_num,res.troops_generals),this.deleteall_User_World_War_Partin_Generals(),this.insert_User_World_War_Partin_Generals(res.partin_generals,res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Troops_Leader_Set=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.update_User_World_War_Troops_Generals(res.troops_num,res.troops_generals)},NetServiceV3.prototype.updateResponse_Res_World_War_Troops_General_Equipment_Item_Set=function(res){if(WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),0<res.release_equipment_key.equipment_item_idx){var equipment_release={};equipment_release.equipment_item_idx=res.release_equipment_key.equipment_item_idx,equipment_release.equip_num=res.release_equipment_key.equipment_num,equipment_release.gnrl_id=res.release_gnrl_key.gnrl_id,equipment_release.gnrl_num=res.release_gnrl_key.gnrl_num,this.delete_User_World_War_General_Equipment_Item(equipment_release,res.world_war_period_idx),WorldWarService.getInstance().setWorldWarUserEquipment(res.release_equipment_key.equipment_item_idx,res.release_equipment_key.equipment_num,!1)}var equipment={};equipment.gnrl_id=res.gnrl_key.gnrl_id,equipment.gnrl_num=res.gnrl_key.gnrl_num,equipment.equipment_item_idx=res.equipment_key.equipment_item_idx,equipment.equip_num=res.equipment_key.equipment_num,this.insert_User_World_War_General_Equipment_Item(equipment,res.world_war_period_idx),WorldWarService.getInstance().setWorldWarUserEquipment(res.equipment_key.equipment_item_idx,res.equipment_key.equipment_num,!0);var partin_gnrls=[];partin_gnrls.push_back(res.gnrl_info),this.update_User_World_War_Partin_Generals(partin_gnrls,res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Troops_General_Equipment_Item_Del=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx);var equipment={};equipment.gnrl_id=res.gnrl_key.gnrl_id,equipment.equip_num=res.gnrl_key.gnrl_num,equipment.equipment_item_idx=res.equipment_key.equipment_item_idx,equipment.equip_num=res.equipment_key.equipment_num,this.delete_User_World_War_General_Equipment_Item(equipment,res.world_war_period_idx),WorldWarService.getInstance().setWorldWarUserEquipment(res.equipment_key.equipment_item_idx,res.equipment_key.equipment_num,!1);var partin_gnrls=[];partin_gnrls.push_back(res.gnrl_info),this.update_User_World_War_Partin_Generals(partin_gnrls,res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Reset=function(res){WorldWarService.getInstance().setWorldWarSeasonInfo(res.world_war_period_idx,res.season_type)},NetServiceV3.prototype.updateResponse_Res_World_War_Troops_Move=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.update_User_World_War_Data2(res),this.update_User_World_War_Troops(res.troops,res.world_war_period_idx),0<res.npc_troops.world_war_npc_idx&&(this.exist_User_World_War_Npc_Troops(res.npc_troops,res.world_war_period_idx)?this.update_User_World_War_Npc_Troops(res.npc_troops,res.world_war_period_idx):this.insert_User_World_War_Npc_Troops(res.npc_troops,res.world_war_period_idx)),res.bonus_item.size(),0!=res.box.world_war_cell_info_idx&&this.removeCellBox(res.box),0<res.castle.world_war_group_idx&&(this.exist_User_World_War_Castle_Occupation_Info(res.world_war_period_idx,res.castle.world_war_group_idx,res.castle.world_war_cell_info_idx)?this.update_User_World_War_Castle_Occupation_Info(res.castle,res.world_war_period_idx):this.insert_User_World_War_Castle_Occupation_Info(res.castle,res.world_war_period_idx))},NetServiceV3.prototype.updateResponse_Res_User_Unique_Equipment_Ticket=function(res){this.exist_User_Unique_Equipment_Ticket()?this.update_User_Unique_Equipment_Ticket(res.ticket_count):this.insert_User_Unique_Equipment_Ticket(res.ticket_count)},NetServiceV3.prototype.updateResponse_Res_Equipment_Unique_Equipment=function(res){NetService().insert_User_Equipment(res.unique_equip_info),this.update_User_Unique_Equipment_Ticket(res.equip_ticket_count)},NetServiceV3.prototype.updateResponse_Res_World_War_Battle_Continue_Info=function(res){var data={world_war_period_idx:res.world_war_period_idx,world_war_cell_info_idx:res.world_war_cell_info_idx,attacker_type:res.attacker_type,event_type:res.event_type,troops:res.troops,npc_troops:res.npc_troops};world_war_battle_continue_info=data},NetServiceV3.prototype.updateResponse_Res_World_War_Battle_Continue_Check=function(res){cc.log("CHeck")},NetServiceV3.prototype.updateResponse_Res_World_War_Move_Battle_Win=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.update_User_World_War_Castle_Occupation_Count(res.castle_occupation_count,res.world_war_period_idx),this.update_User_World_War_Troops(res.troops,res.world_war_period_idx),this.update_User_World_War_Partin_Generals(res.partin_generals,res.world_war_period_idx);for(var i=0;i<res.castle_list.length;i++)this.exist_User_World_War_Castle_Occupation_Info(res.world_war_period_idx,res.castle_list[i].world_war_group_idx,res.castle_list[i].world_war_cell_info_idx)?this.update_User_World_War_Castle_Occupation_Info(res.castle_list[i],res.world_war_period_idx):this.insert_User_World_War_Castle_Occupation_Info(res.castle_list[i],res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Move_Battle_Lose=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.update_User_World_War_Troops(res.troops,res.world_war_period_idx),0<res.npc_troops.world_war_npc_idx&&(this.exist_User_World_War_Npc_Troops(res.npc_troops,res.world_war_period_idx)?this.update_User_World_War_Npc_Troops(res.npc_troops,res.world_war_period_idx):this.insert_User_World_War_Npc_Troops(res.npc_troops,res.world_war_period_idx)),this.update_User_World_War_Partin_Generals(res.partin_generals,res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Move_Battle_Time_Out=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.update_User_World_War_Troops(res.troops,res.world_war_period_idx),0<res.npc_troops.world_war_npc_idx&&(this.exist_User_World_War_Npc_Troops(res.npc_troops,res.world_war_period_idx)?this.update_User_World_War_Npc_Troops(res.npc_troops,res.world_war_period_idx):this.insert_User_World_War_Npc_Troops(res.npc_troops,res.world_war_period_idx)),this.update_User_World_War_Partin_Generals(res.partin_generals,res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_Castle_Special_Add=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.delete_User_World_War_Castle_Occupation_Info(res),this.delete_User_World_War_Castle_Occupation_Special_Info(res),this.insert_User_World_War_Castle_Occupation_Info(res.castle,res.world_war_period_idx),this.insert_User_World_War_Troops(res.troops_list,res.world_war_period_idx),this.insert_User_World_War_Data(res)},NetServiceV3.prototype.updateResponse_Res_World_War_Main_Castle_Troops_Return=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx),this.update_User_World_War_Troops(res.troops,res.world_war_period_idx)},NetServiceV3.prototype.updateResponse_Res_World_War_User_Team_Turn_End=function(res){WorldWarService.getInstance().setWorldWarPeriodIdx(res.world_war_period_idx);var info={world_war_period_idx:res.world_war_period_idx,castle_occupation_count:res.castle_occupation_count,accum_turn_count:res.accum_turn_count,remain_active_count:res.remain_active_count,max_active_count:res.max_active_count,roops_lose_count:res.troops_lose_count,npc_retreat_count:res.npc_retreat_count,ghost_retreat_count:res.ghost_retreat_count,evt_npc_retreat_count:res.evt_npc_retreat_count,unification_yn:res.unification_yn};this.update_User_World_War_Data(info);for(var i=0;i<res.troops_list.length;i++)this.update_User_World_War_Troops(res.troops_list[i],res.world_war_period_idx);this.update_User_World_War_Partin_Generals(res.partin_generals,res.world_war_period_idx);for(i=0;i<res.npc_troops_list.length;i++)this.exist_User_World_War_Npc_Troops(res.npc_troops_list[i],res.world_war_period_idx)?this.update_User_World_War_Npc_Troops(res.npc_troops_list[i],res.world_war_period_idx):this.insert_User_World_War_Npc_Troops(res.npc_troops_list[i],res.world_war_period_idx);this.update_User_World_War_Castle_Occupation_Infos(res.castle_list,res.world_war_period_idx),NetService().upd_UserWorldWarTicket(res.user_world_war_ticket),info=null},NetServiceV3.prototype.updateResponse_Res_World_War_Cell_Box_Info=function(res){vcBoxNode=res.box_list},NetServiceV3.prototype.updateResponse_Res_World_War_Unification_First_Clear_Reward=function(res){this.deleteall_User_World_War_Unification_First_Clear_Reward_Log(),this.insert_User_World_War_Unification_First_Clear_Reward_Log_List(res.reward_log,WorldWarService.getInstance().getWorldWarPeriodIndex())},NetServiceV3.prototype.updateResponse_Res_World_War_Buy_Box_Gacha=function(res){for(var m=MasterManager.getInstance(),i=0;i<res.bonus_item.length;i++){var item=res.bonus_item[i];switch(item.bonus_type){case BONUS_TYPE_EQUIPMENT:var equip=m.get_EquipmentItem(item.equipment.equipment_item_idx);try{null!=equip&&equip.equipment_type!=EQUIPMENT_TYPE_EXP&&(item.equipment.level=1,NetService().insert_User_Equipment(item.equipment))}catch(e){}}}},NetServiceV3.prototype.updateResponse_Res_World_War_Unification_First_Clear_Log=function(res){this.deleteall_User_World_War_Unification_First_Clear_Reward_Log(),this.insert_User_World_War_Unification_First_Clear_Reward_Log_List(res.reward_log,WorldWarService.getInstance().getWorldWarPeriodIndex()),cc.log("!@#!@#!@#!@#!@#!@#!@#!@#!@#!@#!@#!@#!@!@#!@#!#!#!@#!#!@#!#!@#!@#!@#!@#!#!@#!@")},NetServiceV3.prototype.exist_User_World_War_Items=function(){return null!=map_user_world_war_items||null!=map_user_world_war_items||(map_user_world_war_items=new Map,!1)},NetServiceV3.prototype.insert_User_World_War_Items=function(userWorldWarItems){var world_war_item={user_id:m_user_id,medal:userWorldWarItems.medal,accum_medal:userWorldWarItems.medal_accum};map_user_world_war_items.insert([m_user_id],world_war_item)},NetServiceV3.prototype.update_User_World_War_Items=function(userWorldWarItems){var world_war_item={user_id:m_user_id,medal:userWorldWarItems.medal,accum_medal:userWorldWarItems.medal_accum};map_user_world_war_items.insert([m_user_id],world_war_item)},NetServiceV3.prototype.update_User_World_War_Items_medal=function(nMedal){null==map_user_world_war_items&&null==map_user_world_war_items&&(map_user_world_war_items=new Map);var world_war_item=map_user_world_war_items.at([m_user_id]);null!=world_war_item&&(world_war_item.medal=nMedal,map_user_world_war_items.insert([m_user_id],world_war_item))},NetServiceV3.prototype.exist_User_Unique_Equipment_Ticket=function(){return!(world_war_unique_equipment_ticket_count<=0)},NetServiceV3.prototype.insert_User_Unique_Equipment_Ticket=function(userUniqueEquipmentTicket){world_war_unique_equipment_ticket_count=userUniqueEquipmentTicket},NetServiceV3.prototype.update_User_Unique_Equipment_Ticket=function(nTicketCount){world_war_unique_equipment_ticket_count=nTicketCount},NetServiceV3.prototype.select_User_Unique_Equipment_Ticket=function(){return world_war_unique_equipment_ticket_count},NetServiceV3.prototype.deleteall_User_World_War_Troops=function(){null==list_User_World_War_Troops&&(list_User_World_War_Troops=new Map),list_User_World_War_Troops.clear()},NetServiceV3.prototype.insert_User_World_War_Troops=function(user_world_war_troops,period_idx){this.deleteall_User_World_War_Troops(),user_world_war_troops.forEach(function(item){this.insert_User_World_War_Troop(item,period_idx)}.bind(this))},NetServiceV3.prototype.insert_User_World_War_Troop=function(user_world_war_troops,period_idx){null==list_User_World_War_Troops&&(list_User_World_War_Troops=new Map),list_User_World_War_Troops.insert([m_user_id,period_idx,user_world_war_troops.troops_num],user_world_war_troops),this.insert_User_World_War_Troops_Generals(user_world_war_troops.troops_generals,period_idx)},NetServiceV3.prototype.update_User_World_War_Troops=function(user_world_war_troops,period_idx){null==list_User_World_War_Troops&&(list_User_World_War_Troops=new Map),list_User_World_War_Troops.insert([m_user_id,period_idx,user_world_war_troops.troops_num],user_world_war_troops)},NetServiceV3.prototype.deleteall_User_World_War_Troops_General=function(){null==list_User_World_War_Troops_General&&(list_User_World_War_Troops_General=new Map),list_User_World_War_Troops_General.clear()},NetServiceV3.prototype.delete_User_World_War_Troops_General=function(){null==list_User_World_War_Troops_General&&(list_User_World_War_Troops_General=new Map),list_User_World_War_Troops_General.clear()},NetServiceV3.prototype.insert_User_World_War_Troops_General=function(user_world_war_troops_general,period_idx){null==list_User_World_War_Troops_General&&(list_User_World_War_Troops_General=new Map),list_User_World_War_Troops_General.insert([m_user_id,period_idx,user_world_war_troops_general.troops_num,user_world_war_troops_general.gnrl_id,user_world_war_troops_general.gnrl_num],user_world_war_troops_general)},NetServiceV3.prototype.insert_User_World_War_Troops_Generals=function(user_world_war_troops_generals,period_idx){world_war_period_idx=period_idx,user_world_war_troops_generals.forEach(function(item){this.insert_User_World_War_Troops_General(item,period_idx)}.bind(this))},NetServiceV3.prototype.update_User_World_War_Troops_Generals=function(troops_num,user_world_war_troops_generals){null==list_User_World_War_Troops&&(list_User_World_War_Troops=new Map);for(var tdxKeys=list_User_World_War_Troops.keys(),tdx=0;tdx<tdxKeys.length;tdx++)list_User_World_War_Troops.at(tdxKeys[tdx]).troops_num==troops_num&&(list_User_World_War_Troops.at(tdxKeys[tdx]).troops_generals=user_world_war_troops_generals);null==list_User_World_War_Troops_General&&(list_User_World_War_Troops_General=new Map);for(var keys=list_User_World_War_Troops_General.keys(),key_idx=0,remove_list=[],remove_is=!1;key_idx<keys.length;)list_User_World_War_Troops_General.at(keys[key_idx]).troops_num==troops_num&&(remove_list.push(keys[key_idx]),remove_is=!0),++key_idx;if(1==remove_is)for(var kdx=0;kdx<remove_list.length;kdx++)list_User_World_War_Troops_General.remove(remove_list[kdx]);for(var idx=0;idx<user_world_war_troops_generals.length;idx++){var original=user_world_war_troops_generals[idx];list_User_World_War_Troops_General.insert([m_user_id,world_war_period_idx,original.troops_num,original.gnrl_id,original.gnrl_num],original)}},NetServiceV3.prototype.deleteall_User_World_War_Partin_Generals=function(){null==list_User_World_War_Partin_General&&(list_User_World_War_Partin_General=new Map),list_User_World_War_Partin_General.clear()},NetServiceV3.prototype.insert_User_World_War_Partin_Generals=function(user_world_war_partin_generals,period_idx){user_world_war_partin_generals.forEach(function(gnrls){this.insert_User_World_War_Partin_General(gnrls,period_idx)}.bind(this))},NetServiceV3.prototype.insert_User_World_War_Partin_General=function(user_world_war_partin_general,period_idx){null==list_User_World_War_Partin_General&&(list_User_World_War_Partin_General=new Map),list_User_World_War_Partin_General.insert([m_user_id,period_idx,user_world_war_partin_general.gnrl_id,user_world_war_partin_general.gnrl_num],user_world_war_partin_general)},NetServiceV3.prototype.update_User_World_War_Partin_Generals=function(user_world_war_partin_generals,period_idx){null==list_User_World_War_Partin_General&&(list_User_World_War_Partin_General=new Map);for(var keys=list_User_World_War_Partin_General.keys(),gidx=0;gidx<keys.length;gidx++){for(var p_general=list_User_World_War_Partin_General.at([keys[gidx]]),isFound=!1,i=0;i<user_world_war_partin_generals.length;i++){var info=user_world_war_partin_generals[i];if(p_general.gnrl_id==info.gnrl_id&&p_general.gnrl_num==info.gnrl_num){isFound=!0,i;break}}isFound&&list_User_World_War_Partin_General.insert(keys[gidx],info),p_general=null}keys=null},NetServiceV3.prototype.deleteall_User_World_War_General_Equipment_Item=function(){null==list_User_World_War_General_Equipment_Item&&(list_User_World_War_General_Equipment_Item=new Map),list_User_World_War_General_Equipment_Item.clear()},NetServiceV3.prototype.delete_User_World_War_General_Equipment_Item=function(user_world_war_general_equipment_item,period_idx){null!=list_User_World_War_General_Equipment_Item.at([m_user_id,period_idx,user_world_war_general_equipment_item.equipment_item_idx,user_world_war_general_equipment_item.equip_num])&&list_User_World_War_General_Equipment_Item.erase([m_user_id,period_idx,user_world_war_general_equipment_item.equipment_item_idx,user_world_war_general_equipment_item.equip_num])},NetServiceV3.prototype.insert_User_World_War_General_Equipment_Item=function(user_world_war_general_equipment_item,period_idx){list_User_World_War_General_Equipment_Item.insert([m_user_id,period_idx,user_world_war_general_equipment_item.equipment_item_idx,user_world_war_general_equipment_item.equip_num],user_world_war_general_equipment_item)},NetServiceV3.prototype.insert_User_World_War_General_Equipment_Items=function(user_world_war_general_equipment_items,period_idx){user_world_war_general_equipment_items.forEach(function(equipment){this.insert_User_World_War_General_Equipment_Item(equipment,period_idx)}.bind(this))},NetServiceV3.prototype.exist_User_World_War_Data=function(period_idx){return null==map_user_world_war_data&&(map_user_world_war_data=new Map),null!=map_user_world_war_data.at([m_user_id,period_idx])},NetServiceV3.prototype.insert_User_World_War_Data=function(userWorldWarInfo){var world_war_data={user_id:m_user_id,world_war_period_idx:userWorldWarInfo.world_war_period_idx,castle_occupation_count:userWorldWarInfo.castle_occupation_count,accum_turn_count:userWorldWarInfo.accum_turn_count,remain_active_count:userWorldWarInfo.remain_active_count,max_active_count:userWorldWarInfo.max_active_count,troops_lose_count:userWorldWarInfo.troops_lose_count,npc_retreat_count:userWorldWarInfo.npc_retreat_count,ghost_retreat_count:userWorldWarInfo.ghost_retreat_count,evt_npc_retreat_count:userWorldWarInfo.evt_npc_retreat_count,unification_yn:userWorldWarInfo.unification_yn};map_user_world_war_data.insert([m_user_id,world_war_data.world_war_period_idx],world_war_data)},NetServiceV3.prototype.update_User_World_War_Datas=function(userWorldWarTroopsMoveInfo){var war_data=map_user_world_war_data.at([m_user_id,userWorldWarTroopsMoveInfo.world_war_period_idx]);war_data.accum_turn_count=userWorldWarTroopsMoveInfo.accum_turn_count,war_data.remain_active_count=userWorldWarTroopsMoveInfo.remain_active_count,map_user_world_war_data.insert([m_user_id,userWorldWarTroopsMoveInfo.world_war_period_idx],war_data)},NetServiceV3.prototype.update_User_World_War_Data=function(userWorldWarInfo){var world_war_data={user_id:m_user_id,world_war_period_idx:userWorldWarInfo.world_war_period_idx,castle_occupation_count:userWorldWarInfo.castle_occupation_count,accum_turn_count:userWorldWarInfo.accum_turn_count,remain_active_count:userWorldWarInfo.remain_active_count,max_active_count:userWorldWarInfo.max_active_count,troops_lose_count:userWorldWarInfo.troops_lose_count,npc_retreat_count:userWorldWarInfo.npc_retreat_count,ghost_retreat_count:userWorldWarInfo.ghost_retreat_count,evt_npc_retreat_count:userWorldWarInfo.evt_npc_retreat_count,unification_yn:userWorldWarInfo.unification_yn};map_user_world_war_data.insert([m_user_id,world_war_data.world_war_period_idx],world_war_data),world_war_data=[]},NetServiceV3.prototype.update_User_World_War_Data2=function(userWorldWarInfo){var items=map_user_world_war_data.at([m_user_id,userWorldWarInfo.world_war_period_idx]),world_war_data={user_id:m_user_id,world_war_period_idx:userWorldWarInfo.world_war_period_idx,castle_occupation_count:items.castle_occupation_count,accum_turn_count:userWorldWarInfo.accum_turn_count,remain_active_count:userWorldWarInfo.remain_active_count,max_active_count:items.max_active_count,troops_lose_count:items.troops_lose_count,npc_retreat_count:items.npc_retreat_count,ghost_retreat_count:items.ghost_retreat_count,evt_npc_retreat_count:items.evt_npc_retreat_count,unification_yn:items.unification_yn};map_user_world_war_data.insert([m_user_id,world_war_data.world_war_period_idx],world_war_data)},NetServiceV3.prototype.update_User_World_War_Castle_Occupation_Count=function(nCount,nPeriodIdx){var war_data=map_user_world_war_data.at([m_user_id,nPeriodIdx]);null!=war_data.castle_occupation_count&&(war_data.castle_occupation_count=nCount,map_user_world_war_data.insert([m_user_id,nPeriodIdx],war_data))},NetServiceV3.prototype.delete_User_World_War_Castle_Occupation_Info=function(res){for(var isFound=!1,foundKey=0,keys=list_User_World_War_Castle_Occupation_Info.keys(),i=0;i<keys.length;i++){var info=list_User_World_War_Castle_Occupation_Info.at(keys[i]);if(res.castle.world_war_cell_info_idx==info.world_war_cell_info_idx){foundKey=i,isFound=!0;break}}isFound&&list_User_World_War_Castle_Occupation_Info.erase(keys[foundKey]),keys=null},NetServiceV3.prototype.deleteall_User_World_War_Castle_Occupation_Info=function(){null==list_User_World_War_Castle_Occupation_Info&&(list_User_World_War_Castle_Occupation_Info=new Map),list_User_World_War_Castle_Occupation_Info.clear()},NetServiceV3.prototype.insert_User_World_War_Castle_Occupation_Infos=function(user_world_war_castle_occupation_infos,period_idx){for(var i=0;i<user_world_war_castle_occupation_infos.length;i++){var item=user_world_war_castle_occupation_infos[i];this.insert_User_World_War_Castle_Occupation_Info(item,period_idx)}},NetServiceV3.prototype.insert_User_World_War_Castle_Occupation_Info=function(user_world_war_castle_occupation_info,period_idx){var world_war_data={user_id:m_user_id,world_war_period_idx:period_idx,world_war_group_idx:user_world_war_castle_occupation_info.world_war_group_idx,world_war_cell_info_idx:user_world_war_castle_occupation_info.world_war_cell_info_idx,own_yn:user_world_war_castle_occupation_info.own_yn,provision_count:user_world_war_castle_occupation_info.provision_count,elapsed:user_world_war_castle_occupation_info.elapsed,castle_durability_value:user_world_war_castle_occupation_info.castle_durability_value,max_castle_durability_value:user_world_war_castle_occupation_info.max_castle_durability_value,open_yn:user_world_war_castle_occupation_info.open_yn,special_funcs:user_world_war_castle_occupation_info.special_funcs};this.insert_User_World_War_Castle_Occupation_Special_Infos(user_world_war_castle_occupation_info.special_funcs,period_idx),list_User_World_War_Castle_Occupation_Info.insert([m_user_id,world_war_data.world_war_period_idx,world_war_data.world_war_group_idx,world_war_data.world_war_cell_info_idx],world_war_data),world_war_data=null},NetServiceV3.prototype.exist_User_World_War_Castle_Occupation_Info=function(period_idx,group_idx,cell_info_idx){return null!=list_User_World_War_Castle_Occupation_Info.at([m_user_id,period_idx,group_idx,cell_info_idx])},NetServiceV3.prototype.update_User_World_War_Castle_Occupation_Info=function(user_world_war_castle_occupation_info,period_idx){null==list_User_World_War_Castle_Occupation_Info&&(list_User_World_War_Castle_Occupation_Info=new Map);var world_war_data={user_id:m_user_id,own_yn:user_world_war_castle_occupation_info.own_yn,castle_durability_value:user_world_war_castle_occupation_info.castle_durability_value,open_yn:user_world_war_castle_occupation_info.open_yn,world_war_group_idx:user_world_war_castle_occupation_info.world_war_group_idx,world_war_cell_info_idx:user_world_war_castle_occupation_info.world_war_cell_info_idx,world_war_period_idx:period_idx,provision_count:user_world_war_castle_occupation_info.provision_count,elapsed:user_world_war_castle_occupation_info.elapsed,max_castle_durability_value:user_world_war_castle_occupation_info.max_castle_durability_value,special_funcs:user_world_war_castle_occupation_info.special_funcs};list_User_World_War_Castle_Occupation_Info.insert([m_user_id,world_war_data.world_war_period_idx,world_war_data.world_war_group_idx,world_war_data.world_war_cell_info_idx],world_war_data)},NetServiceV3.prototype.update_User_World_War_Castle_Occupation_Infos=function(infos,period_idx){list_User_World_War_Castle_Occupation_Info.clear(),infos.forEach(function(info){this.exist_User_World_War_Castle_Occupation_Info(period_idx,info.world_war_group_idx,info.world_war_cell_info_idx)?this.update_User_World_War_Castle_Occupation_Info(info,period_idx):this.insert_User_World_War_Castle_Occupation_Info(info,period_idx)}.bind(this))},NetServiceV3.prototype.delete_User_World_War_Castle_Occupation_Special_Info=function(res){for(var keys=list_User_World_War_Castle_Occupation_Special_Info.keys(),isfoundKey=!1,foundKeyIdx=0,i=0;i<keys.length;i++){var data=list_User_World_War_Castle_Occupation_Special_Info.at(keys[i]);if(data.world_war_cell_info_idx==res.castle.world_war_cell_info_idx){isfoundKey=!0,foundKeyIdx=i;break}data={}}isfoundKey&&list_User_World_War_Castle_Occupation_Special_Info.at(keys[foundKeyIdx]).erase(),keys=null},NetServiceV3.prototype.deleteall_User_World_War_Castle_Occupation_Special_Info=function(){null==list_User_World_War_Castle_Occupation_Special_Info&&(list_User_World_War_Castle_Occupation_Special_Info=new Map),list_User_World_War_Castle_Occupation_Special_Info.clear()},NetServiceV3.prototype.insert_User_World_War_Castle_Occupation_Special_Info=function(item,period_idx){null==list_User_World_War_Castle_Occupation_Special_Info&&(list_User_World_War_Castle_Occupation_Special_Info=new Map);var data={user_id:m_user_id,period_idx:period_idx,num:item.num,world_war_cell_info_idx:item.world_war_cell_info_idx,world_war_castle_special_func_idx:item.world_war_castle_special_func_idx};list_User_World_War_Castle_Occupation_Special_Info.insert([m_user_id,period_idx,item.world_war_cell_info_idx,item.num,item.world_war_castle_special_func_idx],data)},NetServiceV3.prototype.insert_User_World_War_Castle_Occupation_Special_Infos=function(user_world_war_castle_occupation_special_infos,period_idx){user_world_war_castle_occupation_special_infos.forEach(function(item){this.insert_User_World_War_Castle_Occupation_Special_Info(item,period_idx)}.bind(this))},NetServiceV3.prototype.deleteall_User_World_War_Npc_Troops=function(){null==list_User_World_War_Npc_Troops&&null==list_User_World_War_Npc_Troops&&(list_User_World_War_Npc_Troops=new Map),list_User_World_War_Npc_Troops.clear()},NetServiceV3.prototype.exist_User_World_War_Npc_Troops=function(user_world_war_npc_troops,period_idx){return null!=list_User_World_War_Npc_Troops.at([m_user_id,period_idx,user_world_war_npc_troops.world_war_npc_idx])},NetServiceV3.prototype.insert_User_World_War_Npc_Troops=function(user_world_war_npc_troops,period_idx){for(var i=0;i<user_world_war_npc_troops.length;i++){var item=user_world_war_npc_troops[i];this.insert_User_World_War_Npc_Troop(item,period_idx),this.insert_User_World_War_Npc_Troops_Generals(item.troops_generals,period_idx)}},NetServiceV3.prototype.insert_User_World_War_Npc_Troop=function(user_world_war_npc_troops,period_idx){null==list_User_World_War_Npc_Troops&&(list_User_World_War_Npc_Troops=new Map);var world_war_data={user_id:m_user_id,world_war_period_idx:period_idx,world_war_npc_idx:user_world_war_npc_troops.world_war_npc_idx,troops_num:user_world_war_npc_troops.troops_num,current_cell_info_idx:user_world_war_npc_troops.current_cell_info_idx,prev_cell_info_idx:user_world_war_npc_troops.prev_cell_info_idx,activity_type:user_world_war_npc_troops.activity_type,npc_type:user_world_war_npc_troops.npc_type,open_yn:user_world_war_npc_troops.open_yn,troops_generals:user_world_war_npc_troops.troops_generals};list_User_World_War_Npc_Troops.insert([m_user_id,world_war_data.world_war_period_idx,world_war_data.world_war_npc_idx],user_world_war_npc_troops)},NetServiceV3.prototype.update_User_World_War_Npc_Troops=function(user_world_war_npc_troops,period_idx){var world_war_data={};world_war_data.troops_num=user_world_war_npc_troops.troops_num,world_war_data.current_cell_info_idx=user_world_war_npc_troops.current_cell_info_idx,world_war_data.prev_cell_info_idx=user_world_war_npc_troops.prev_cell_info_idx,world_war_data.activity_type=user_world_war_npc_troops.activity_type,world_war_data.npc_type=user_world_war_npc_troops.npc_type,world_war_data.open_yn=user_world_war_npc_troops.open_yn,world_war_data.world_war_period_idx=period_idx,world_war_data.world_war_npc_idx=user_world_war_npc_troops.world_war_npc_idx,world_war_data.troops_generals=user_world_war_npc_troops.troops_generals,this.insert_User_World_War_Npc_Troop(world_war_data,period_idx),world_war_data=null},NetServiceV3.prototype.delete_User_World_War_Npc_Troops=function(user_world_war_npc_troops,period_idx){list_User_World_War_Npc_Troops.erase([m_user_id,period_idx,user_world_war_npc_troops.world_war_npc_idx])},NetServiceV3.prototype.deleteall_User_World_War_Npc_Troops_General=function(){null==list_User_World_War_Npc_Troops_General&&(list_User_World_War_Npc_Troops_General=new Map),list_User_World_War_Npc_Troops_General.clear()},NetServiceV3.prototype.insert_User_World_War_Npc_Troops_General=function(user_world_war_npc_troops_general,period_idx){null==list_User_World_War_Npc_Troops_General&&(list_User_World_War_Npc_Troops_General=new Map);var world_war_data={user_id:m_user_id,world_war_period_idx:period_idx,world_war_npc_idx:user_world_war_npc_troops_general.world_war_npc_idx,troops_num:user_world_war_npc_troops_general.troops_num,gnrl_id:user_world_war_npc_troops_general.gnrl_id,position:user_world_war_npc_troops_general.position,remain_hp:user_world_war_npc_troops_general.remain_hp,dead_yn:user_world_war_npc_troops_general.dead_yn,battle_point:user_world_war_npc_troops_general.battle_point};list_User_World_War_Npc_Troops_General.insert([m_user_id,world_war_data.world_war_period_idx,world_war_data.world_war_npc_idx,world_war_data.gnrl_id,world_war_data.position],world_war_data)},NetServiceV3.prototype.insert_User_World_War_Npc_Troops_Generals=function(user_world_war_npc_troops_generals,period_idx){user_world_war_npc_troops_generals.forEach(function(item){this.insert_User_World_War_Npc_Troops_General(item,period_idx)}.bind(this))},NetServiceV3.prototype.update_User_World_War_Npc_Troops_General=function(npc,period_idx){null==list_User_World_War_Npc_Troops_General&&(list_User_World_War_Npc_Troops_General=new Map);var world_war_data={user_id:m_user_id,world_war_period_idx:period_idx,world_war_npc_idx:npc.world_war_npc_idx,troops_num:npc.troops_num,gnrl_id:npc.gnrl_id,position:npc.position,remain_hp:npc.remain_hp,dead_yn:npc.dead_yn,battle_point:npc.battle_point};list_User_World_War_Npc_Troops_General.insert([m_user_id,world_war_data.world_war_period_idx,world_war_data.world_war_npc_idx,world_war_data.gnrl_id,world_war_data.position],world_war_data)},NetServiceV3.prototype.delete_User_World_War_Npc_Troops_General=function(npc_troops,period_idx){1==list_User_World_War_Npc_Troops_General.find([m_user_id,period_idx])&&list_User_World_War_Npc_Troops_General.remove([m_user_id,period_idx])},NetServiceV3.prototype.update_Battle_Bouns_Item=function(list){for(var i=0;i<list.length;i++){var item=list[i];item.bonus_type==BONUS_TYPE_WORLD_WAR_MEDAL?this.plus_World_War_Medal(item.bonus_idx):item.bonus_type==BONUS_TYPE_WORLD_WAR_UNIQUE_EQUIPMENT_TICKET&&this.plus_Unique_Equipment_Ticket(item.bonus_idx)}},NetServiceV3.prototype.deleteall_User_World_War_Unification_First_Clear_Reward_Log=function(){list_User_World_War_Unification_First_Clear_Reward_Log=[]},NetServiceV3.prototype.insert_User_World_War_Unification_First_Clear_Reward_Log=function(user_world_war_unification_first_clear_reward_log,period_idx){var rewardLogInfo={user_id:m_user_id,world_war_period_idx:user_world_war_unification_first_clear_reward_log.world_war_period_idx,world_war_group_idx:user_world_war_unification_first_clear_reward_log.world_war_group_idx,reward_y:user_world_war_unification_first_clear_reward_log.reward_yn};user_world_war_unification_first_clear_reward_log.world_war_period_idx==period_idx&&list_User_World_War_Unification_First_Clear_Reward_Log.push(rewardLogInfo)},NetServiceV3.prototype.insert_User_World_War_Unification_First_Clear_Reward_Log_List=function(user_world_war_unification_first_clear_reward_log,period_idx){if(!(user_world_war_unification_first_clear_reward_log.length<=0))for(var i=0;i<user_world_war_unification_first_clear_reward_log.length;i++)this.insert_User_World_War_Unification_First_Clear_Reward_Log(user_world_war_unification_first_clear_reward_log[i],period_idx)},NetServiceV3.prototype.createUserWorldWarNpcTroopsGeneral=function(npcArr,position,npc_id){var npc_gnrl={battle_point:0,dead_yn:"n"};return npc_gnrl.gnrl_id=npc_id,npc_gnrl.position=position,npc_gnrl.remain_hp=1e4,npc_gnrl.troops_num=CLIENT_CREATE_WW_NPC_TROOPS_NUM,npc_gnrl.world_war_npc_idx=npcArr.world_war_npc_idx,npc_gnrl},NetServiceV3.prototype.getBoxNode=function(id){if(vcBoxNode.empty())return null;for(var itfound=!1,i=0;i<vcBoxNode.size();i++)if(id==vcBoxNode[i].world_war_cell_info_idx)return itfound=!0,vcBoxNode[i];return itfound?void 0:null},NetServiceV3.prototype.removeCellBox=function(box){if(!vcBoxNode.empty()){var found=vcBoxNode.findIndex(function(b){if(box.world_war_group_idx==b.world_war_group_idx&&box.world_war_cell_info_idx==b.world_war_cell_info_idx)return!0});-1!=found&&vcBoxNode.erase(found)}},NetServiceV3.prototype.clearWorldWarBattleContinueInfo=function(){null==world_war_battle_continue_info&&(world_war_battle_continue_info=new Map),world_war_battle_continue_info=null},NetServiceV3.prototype.select_User_World_War_Items_medal=function(nTicketCount){return this.get_user_world_war_items().at([m_user_id]).medal},NetServiceV3.prototype.plus_World_War_Medal=function(add_medal){var cur_medal=this.select_User_World_War_Items_medal();cur_medal+=add_medal,this.update_User_World_War_Items_medal(cur_medal)},NetServiceV3.prototype.plus_Unique_Equipment_Ticket=function(add_ticket){var cur_ticket_count=this.select_User_Unique_Equipment_Ticket();cur_ticket_count+=add_ticket,this.update_User_Unique_Equipment_Ticket(cur_ticket_count)},NetServiceV3.prototype.getUserPartyGeneral=function(){return null==list_User_World_War_Troops_General&&(list_User_World_War_Troops_General=new Map),list_User_World_War_Troops_General},NetServiceV3.prototype.getCastleOccupationInfo=function(world_war_cell_info_idx,info){for(var keys=list_User_World_War_Castle_Occupation_Info.keys(),idx=0;idx<keys.length;idx++){var data=list_User_World_War_Castle_Occupation_Info.at(keys[idx]);if(data.world_war_cell_info_idx==world_war_cell_info_idx){info=data;break}}return keys=null,info},NetServiceV3.prototype.getCastleOccupationInfoList=function(infoList){infoList.clear();for(var keys=list_User_World_War_Castle_Occupation_Info.keys(),idx=0;idx<keys.length;idx++){var data=list_User_World_War_Castle_Occupation_Info.at(keys[idx]);infoList.push_back(data)}keys=null},NetServiceV3.prototype.getWorldWarUserGnrlEquipmentList=function(gnrl_key,user_gnrl_equips){for(var equip_list=[],keys=list_User_World_War_General_Equipment_Item.keys(),idx=0;idx<keys.length;idx++){var e=list_User_World_War_General_Equipment_Item.at(keys[idx]);if(e.gnrl_id==gnrl_key.gnrl_id&&e.gnrl_num==gnrl_key.gnrl_num){var data={};data.equipment_item_idx=e.equipment_item_idx,data.equipment_num=e.equip_num,data.gnrl_id=e.gnrl_id,data.gnrl_num=e.gnrl_num,equip_list.push_back(data)}}return keys=null,equip_list},NetServiceV3.prototype.getCastleSpecialFuncList=function(func_type){for(var m=MasterManager.getInstance(),keys=list_User_World_War_Castle_Occupation_Special_Info.keys(),list=[],i=0;i<keys.length;i++){var s=list_User_World_War_Castle_Occupation_Special_Info.at(keys[i]),special_func=m.get_WorldWarCastleSpecialFunc(s.world_war_castle_special_func_idx);0!=special_func.world_war_castle_special_func_idx&&(special_func.world_war_special_func_type==func_type&&list.push(special_func))}return keys=null,list},NetServiceV3.prototype.get_User_Unique_Equipment_Ticket=function(){return world_war_unique_equipment_ticket_count},NetServiceV3.prototype.get_Worldwar_User_Info=function(){return world_war_user_info},NetServiceV3.prototype.get_list_User_World_War_Troops=function(){return null==list_User_World_War_Troops&&(list_User_World_War_Troops=new Map),list_User_World_War_Troops},NetServiceV3.prototype.get_list_User_World_War_Troops_General=function(){return null==list_User_World_War_Troops_General&&(list_User_World_War_Troops_General=new Map),list_User_World_War_Troops_General},NetServiceV3.prototype.get_list_User_World_War_Partin_General=function(){return null==list_User_World_War_Partin_General&&(list_User_World_War_Partin_General=new Map),list_User_World_War_Partin_General},NetServiceV3.prototype.get_list_User_World_War_General_Equipment_Item=function(){return null==list_User_World_War_General_Equipment_Item&&(list_User_World_War_General_Equipment_Item=new Map),list_User_World_War_General_Equipment_Item},NetServiceV3.prototype.get_list_User_World_War_Castle_Occupation_Info=function(){return null==list_User_World_War_Castle_Occupation_Info&&(list_User_World_War_Castle_Occupation_Info=new Map),list_User_World_War_Castle_Occupation_Info},NetServiceV3.prototype.get_list_User_World_War_Castle_Occupation_Special_Info=function(){return null==list_User_World_War_Castle_Occupation_Special_Info&&(list_User_World_War_Castle_Occupation_Special_Info=new Map),list_User_World_War_Castle_Occupation_Special_Info},NetServiceV3.prototype.get_list_User_World_War_Npc_Troops=function(){return null==list_User_World_War_Npc_Troops&&(list_User_World_War_Npc_Troops=new Map),list_User_World_War_Npc_Troops},NetServiceV3.prototype.get_list_User_World_War_Npc_Troops_General=function(){return null==list_User_World_War_Npc_Troops_General&&(list_User_World_War_Npc_Troops_General=new Map),list_User_World_War_Npc_Troops_General},NetServiceV3.prototype.get_world_war_battle_continue_info=function(){return world_war_battle_continue_info},NetServiceV3.prototype.get_list_User_World_War_Unification_First_Clear_Reward_Log=function(){return null==list_User_World_War_Unification_First_Clear_Reward_Log&&(list_User_World_War_Unification_First_Clear_Reward_Log=[]),list_User_World_War_Unification_First_Clear_Reward_Log},NetServiceV3.prototype.get_user_world_war_items=function(){return null==map_user_world_war_items&&(map_user_world_war_items=new Map),map_user_world_war_items},NetServiceV3.prototype.get_map_user_world_war_data=function(){return null==map_user_world_war_data&&(map_user_world_war_data=new Map),map_user_world_war_data},{getInstance:function(){return void 0===instance&&(instance=new NetServiceV3),instance}}}(),packetList=[10360,10400,10401,10411,10608,10430,10431,10442,10440,10456,11101,11103,11102,11104,10522,10598,10520,15780,11592,10613,10620,10433,10434,10444,10524,10450,10460,10464,10470,10474,10472,10525,10901,17304,17305,10445,10526,10447,15031,11003,10621,17315,17322,17316,17317,17318,17319,17320,17329,17328,17327,17330,18001,18004,18021,18020,18010,18301,18030,18070,18501,17325,18120,18122,18121,10607,18610,18800,10615,18810,18826,10910,18830,18840,18853,19154,17334,17335,19500,18042,18043,22001,22002,22003,22003,20106,20504,20622,20652,20902,20852,21e3,22107,22108,22109,23011,23014,23015,23201,23202,17401],loader_flg={master_loder:{is_finish:!1},packet_loader:{target:"",is_finish:!1}};function NetService(){var Instance;return(Instance=new(NetService=function(){return Instance})).m_PacketList=[],Instance.m_PacketListIndex=0,map_User_General=new Map,map_Friend_General=new Map,map_User_Cost_general=new Map,map_User_Camp_cost=new Map,map_User_Evolve_Arm_Service_Mtrl=new Map,map_User_Hwandan_Info=new Map,map_User_Illust_Book_List=[],list_User_Troops_General=new Map,list_User_Weekly_Troops_General=[],list_User_Mail=[],map_User_Love_Item=new Map,res_Get_Shop_Free_General=[],_config={},_config_v2={},_battle_dungeon_continue=null,_event_dungeon_achv_list=null,map_User_Limit_Over_Mtrl=new Map,_battle_config_v2={},_booster_event={},_exp_booster_item={},_user_shop_buy_info={},_session_msg={},_weekly_task={},_user_gnrl_piece_item={},_user_camp_gnrl_factory_exchange_item={},_user_new_equipment_enhance_materials={},_user_new_equipment_make_materials={},_user_new_equipment_smelt_materials={},_user_new_equipment_enchant_tickets={},_user_new_euipment_list={},_user_general_new_equipments={},_user_new_equipment_bound={},_user_main_story_hard_mode_missions={},_user_main_story_hard_mode_mission_tasks={},_user_main_story_hard_mode_lotus_reward_log={},list_Announce_Msg_Queue=[],list_Global_Booster_Event_V2=[],map_User_Equipment=new Map,map_User_Gnrl_Equipment=new Map,user_orb_count=0,list_User_book_General=[],list_User_camp_cost_slot=new Map,m_User_main_lotus_bonus_log=new Map,m_user_mussang_Info=[],m_User_Battle_formation=new Map,m_User_formation_property_point=new Map,m_daily_dungeon_open_period_info={daily_dungeon_open_period:[]},map_User_Equipment_option_option_change_temp=[],map_User_Equipment_bound=new Map,_get_Rolling_Banner_Info=[],User_Magic_Key_Mtrl=0,User_Key_Recovery_Make_Count=0,_get_Shop_Gacha_Period_Info=[],_get_Popup_Banner_Info=[],_great_wall_dungeon_info=null,_great_wall_dungeon_list={},_great_wall_troops_info=null,_event_box_gacha_info_v2=null,map_user_key_bound_increase=new Map,map_user_weekly_open=new Map,map_user_event_dungeon_reward=new Map,map_user_event_dungeon_reward_shop=new Map,map_user_event_dungeon_reward_board_info=new Map,map_user_event_dungeon_board_map_bonus=new Map,map_user_event_dungeon_global_reward_log=new Map,map_user_event_dungeon_marble_map_info=new Map,map_user_event_dungeon_marble_circuit_log=new Map,map_user_event_dungeon_special_point_shop_log=new Map,map_user_event_dungeon_cutin_accum_rate=new Map,map_user_event_dungeon_craft_shop_material=new Map,map_user_event_dungeon_persnal_point_bonus_log=new Map,map_user_event_dungeon=new Map,_user_Event_Dungeon_Craft_Shop_Product_Info=null,map_user_event_dungeon_point=new Map,map_user_camp_branch_ability=new Map,map_user_prologue_v2=new Map,map_user_event_dungeon_special_point=new Map,_raid_boss_list={},_raid_boss_history={},_step_up_gacha_buy_log={},_oneday_onetime_free_gacha_buy_log={},_oneuser_onetime_free_gacha_buy_log={},_event_panel_gacha_box_info={},_event_panel_gacha_box_pan_info={},_event_panel_gacha_box_pan_buy={},_event_panel_gacha_next_box={},_event_vote_league_group_info_v3={},_user_event_dungeon_vote_v3={},_global_event_dungeon_vote_v3={},_user_event_dungeon_vote_gnrl_v3={},_user_event_vote_reward_info_v3={},_user_event_vote_reward_all_info_v3={},_new_raid_boss_point={},_new_raid_boss_sign_up={},_new_raid_boss_partner_user_list={},_new_raid_boss_dungeon_list=[],_new_raid_boss_shop_buy_log_list=[],_get_User_Vote_Info=[],m_Res_Get_Event_Dungeon_Vote_League_Ranking_Record=[],list_User_Event_Dungeon_Vote_League_Record=[],m_Res_Get_Event_Dungeon_Vote_Ranking_Info=[],map_notice_list=new Map,map_achievement_list=new Map,map_user_troops=new Map,m_user_yunhee_bound=new Map,m_user_illust=new Map,_user_gacha_ticket=new Map,_user_special_gacha_ticket=new Map,_user_exchange_ticket=0,list_User_Box_Gacha_Info=null,list_User_Box_Gacha_progress_Info=[],m_premium_login_dmm_point_key=null,m_Res_Get_User_Equipment_Box_Gacha_Info={equipment_box_gacha_item_info:[]},m_user_beginner_booster=new Map,m_user_mussang_tower=new Map,m_user_mussang_tower_task=new Map,m_user_mussang_tower_lotus_log=new Map,m_user_naming=new Map,map_User_Rebirth_Mtrl=new Map,map_User_Event_Dungeon_Search_Troops=new Map,map_User_Event_Dungeon_Search_Troops_Generals=new Map,map_Event_Dungeon_Search_Area_Info=new Map,m_Res_Get_User_Event_Dungeon_Christmas_Info=new db.Res_Get_User_Event_Dungeon_Christmas_Info,m_Res_Get_Event_Dungeon_Vote_League_Yunhee_Info=new Map,m_Res_Get_User_Event_Dungeon_Satisfaction_Info=[],map_user_event_dungeon_once_a_day=new Map,map_user_event_dungeon_task=new Map,map_user_event_dungeon_personal_point_bonus_log=new Map,map_user_event_dungeon_christmas_reward=new Map,map_user_event_dungeon_christmas_total_reward_info=new Map,map_user_ceiling_gacha_info=new Map,map_user_event_dungeon_marble_fortune=new Map,map_user_event_dungeon_marble_golden_box_gain_log=new Map,map_User_Extra_Box_Init_Info=new Map,list_User_Box_Gacha_Golden_Barrel_Info=[],map_User_Food_List=new Map,map_user_event_dungeon_vote_league_reward=new Map,map_user_event_dungeon_vote_league_use_point_reward=new Map,Mussang_Boss_Info=null,User_Mussang_boss_info={user_mussang_boss_infos:[],user_mussang_boss_npc_info:[]},User_Mussang_Boss_list_Cnt=0,User_Jade_Piece=0,User_Achieve_Info_list=[],Global_Raid_Boss_Info={},Global_Raid_Dungeon_info={},User_Box_Gacha_List={},_exchange_ticket_buy_log={},map_user_main_mission_task=[],map_user_main_mission=[],User_evolution_event={},User_game_state={},User_daily_dungeon=[],User_jade_first_buy_log=[],User_main_story=new Map,User_info={},User_item_info={},_evolve_Stone_Count=0,Instance.start_PacketList=function(target){Instance.request_PacketList(callback_PacketList,10360,target),USE_IMSI_SP||MasterManager.getInstance().pre_decrypt_master(),SceneManager.getInstance().getRunningScene().start_loader_chk()},Instance.next_PacketList=function(target){var idx=++Instance.m_PacketListIndex;if(packetList.length<=idx&&null!=target)return loader_flg.packet_loader.target=target,loader_flg.packet_loader.is_finish=!0,void(WOLRD_WAR_SEASON_INFO_FIRST_LOAD=!0);Instance.request_PacketList(callback_PacketList,packetList[idx],target)},Instance.request_PacketList=function(callback,opcode,target){var s_opcode=opcode,s_session_id=GameDefault.getInstance().getSessionId();s_session_id=null==s_session_id?"0":s_session_id;var s_user_id=m_user_id,url=SERVER_IP+"/Contact.aspx",xmlhttp=new XMLHttpRequest;xmlhttp.open("POST",url,!0),xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xmlhttp.onreadystatechange=function(){if(4==xmlhttp.readyState)if(200==xmlhttp.status){encodeURIComponent(xmlhttp.responseText);var decode_data=Base64.decode(xmlhttp.responseText),json_en=base64DecodeUTF8(decode_data);cc.log("**** json_en="+json_en),callback(opcode,xmlhttp.readyState,JSON.parse(json_en),target),json_en=decode_data=null,json_obj=null}else{if(400==xmlhttp.status)return 0==GameDefault.getInstance().getSessionPass()&&MainObserver.getInstance().postNotification(NOTIFY_SESSION_ERROR),void GameDefault.getInstance().setSessionPass(!0);xmlhttp.status,MainObserver.getInstance().postNotification(NOTIFY_NETWORK_ERROR)}};var data=JSON.stringify({opcode:s_opcode,session_id:s_session_id,user_id:s_user_id});if(cc.log("##DEBUG## : Send Message : "+data),18811==opcode||18810==opcode||18826==opcode){var great_wall_dungeon_period_idx=GreatWallService.getInstance().getCurrentGreatWallPeriodIdx();data=JSON.stringify({opcode:s_opcode,session_id:s_session_id,user_id:s_user_id,great_wall_dungeon_period_idx:great_wall_dungeon_period_idx})}18858==opcode&&(data=JSON.stringify({opcode:s_opcode,session_id:s_session_id,user_id:s_user_id,event_dungeon_period_idx:0}));var encodeHeader=RSA_CHECKSUM(data);xmlhttp.setRequestHeader("Authorization",encodeHeader);var base64_data=encodeURIComponent(base64EncodingUTF8(data));xmlhttp.send(base64_data),base64_data=encodeHeader=data=null},Instance.User_Login=function(callback,res){GameClient().write(res,callback)},addMethod(Instance,"updateResponse",function(fnName,res){switch(fnName){case"Res_Complete_Tutorial":break;case"Res_Get_Notice_List":Instance.update_notice_list(res);break;case"Res_Get_User_Info":Instance.insert_User_info(res.user_info);break;case"Res_Get_User_Tutorial_V2":Instance.insert_User_Tutorial_V2(res.user_tutorial);break;case"Res_Get_User_Item":Instance.insert_UserItem(res);break;case"Res_Get_User_Weekly_Dungeon_Task":_weekly_task=res;break;case"Res_Get_Event_Login_Bonus_Info":break;case"Res_Get_User_General":Instance.delete_User_General(res);break;case"Res_Get_User_General_Partner":Instance.setUserGeneralParnter(res);break;case"Res_Get_User_Battle_Formation_V2":Instance.insert_User_Battle_Formation(res);break;case"Res_Get_User_Troops":Instance.insert_User_Troops(res);break;case"Res_Get_Weekly_Dungeon_Open":Instance.insert_User_weekly_open_time(res.weekly_dungeon_open_list);break;case"Res_Get_User_Main_Story":Instance.insert_User_main_story(res.user_stories);break;case"Res_Get_User_Main_Mission":Instance.insert_User_main_mission(res.user_missions);break;case"Res_Get_User_Main_Mission_Task":Instance.insert_User_main_mission_task(res.user_mission_tasks);break;case"Res_Get_User_Main_Story_Lotus_Bonus_Log":Instance.insert_User_Main_Story_Lotus_Bonus_Log(res.user_bonus_log);break;case"Res_Get_User_Mail":Instance.delete_User_Mail(),Instance.insert_User_Mail_V2(res);break;case"Res_Get_Add_User_Mail":Instance.insert_User_Mail(res);break;case"Res_Get_User_Book":Instance.init_User_Book_General(res.gnrls);break;case"Res_Get_User_Achievement":Instance.init_User_Achievement(res.user_achivs);break;case"Res_Get_User_Config_V2":break;case"Res_Update_User_Config_V2":_config_v2.battle_end_vibrate_yn=res.battle_end_vibrate_yn,_config_v2.mission_auto_friend_select_yn=res.mission_auto_friend_select_yn,_config_v2.story_script_review_skip_yn=res.story_script_review_skip_yn,_config_v2.camp_complete_push_yn=res.camp_complete_push_yn,_config_v2.bg_sound_yn=res.bg_sound_yn,_config_v2.effect_sound_yn=res.effect_sound_yn;break;case"Res_Get_Booster_Event":Instance.list_Global_Booster_Event_V2=res;break;case"Res_Get_User_Love_Item":Instance.delete_User_Love_Item(),Instance.insert_User_Love_Item(res.user_love_item);break;case"Res_Get_User_Hwandan":Instance.delete_UserHwandan(),Instance.insert_UserHwandan(res.user_hwandan);break;case"Res_Get_User_Gnrl_Piece":_user_gnrl_piece_item=res;break;case"Res_Get_User_New_Equipment_Enhance_Material":_user_new_equipment_enhance_materials=res;break;case"Res_Get_User_New_Equipment_Make_Material":_user_new_equipment_make_materials=res;break;case"Res_Get_User_New_Equipment_Enchant_Ticket":_user_new_equipment_enchant_tickets=res;break;case"Res_Get_User_New_Equipment_Smelt_Material":_user_new_equipment_smelt_materials=res;break;case"Res_New_Equipment_Make":for(var idx=0;idx<res.new_equipment_list.length;idx++)Instance.addNewEquipmentItem(res.new_equipment_list[idx]);for(idx=0;idx<res.user_goods.length;idx++)if(res.user_goods[idx].bonus_type==BONUS_TYPE_GOLD)Instance.upd_UserGold(res.user_goods[idx].bonus_level);else if(res.user_goods[idx].bonus_type==BONUS_TYPE_NEW_EQUIPMENT_MAKE_MATERIAL){(mat={}).new_equipment_make_material_idx=res.user_goods[idx].bonus_idx,mat.count=res.user_goods[idx].bonus_level,Instance.updateNewEquipmentMakeMaterial(mat)}break;case"Res_New_Equipment_Level_Up_By_Materials":-1!=(found=_user_new_euipment_list.user_equipments.findIndex(function(obj){if(obj.new_equipment_idx==res.new_equipment_idx&&obj.equip_num==res.equip_num)return!0}))&&(_user_new_euipment_list.user_equipments[found].exp=res.equip_exp,_user_new_euipment_list.user_equipments[found].level=res.equip_level);for(idx=0;idx<res.user_materials.length;idx++)Instance.updateNewEquipmentEnhanceMaterial(res.user_materials[idx]);Instance.upd_UserGold(res.user_gold);break;case"Res_New_Equipment_Level_Up_By_New_Equips":-1!=(found=_user_new_euipment_list.user_equipments.findIndex(function(e){return e.new_equipment_idx==res.new_equipment_idx&&e.equip_num==res.equip_num}))&&(_user_new_euipment_list.user_equipments[found].exp=res.equip_exp,_user_new_euipment_list.user_equipments[found].level=res.equip_level);for(idx=0;idx<res.cost_equipments.length;idx++){var found_remove=_user_new_euipment_list.user_equipments.findIndex(function(e){return e.new_equipment_idx==res.cost_equipments[idx].equipment_item_idx&&e.equip_num==res.cost_equipments[idx].equipment_num});-1!=found_remove&&_user_new_euipment_list.user_equipments.splice(found_remove,1)}Instance.upd_UserGold(res.user_gold);break;case"Res_New_Equipment_Smelt":-1!=(found=_user_new_euipment_list.user_equipments.findIndex(function(e){return e.new_equipment_idx==res.new_equipment_idx&&e.equip_num==res.equip_num}))&&(_user_new_euipment_list.user_equipments[found].smelt_level=res.smelt_level);for(idx=0;idx<res.user_goods.length;idx++)if(res.user_goods[idx].bonus_type==BONUS_TYPE_GOLD)Instance.upd_UserGold(res.user_goods[idx].bonus_level);else if(res.user_goods[idx].bonus_type==BONUS_TYPE_NEW_EQUIPMENT_SMELT_MATERIAL){var mat;(mat={}).new_equipment_smelt_material_idx=res.user_goods[idx].bonus_idx,mat.count=res.user_goods[idx].bonus_level,Instance.updateNewEquipmentSmeltMaterial(mat)}break;case"Res_New_Equipment_Enchant":-1!=(equip_found=_user_new_euipment_list.user_equipments.findIndex(function(e){return e.new_equipment_idx==res.new_equipment_idx&&e.equip_num==res.equip_num}))&&(_user_new_euipment_list.user_equipments[equip_found].enchant_opt_1=res.enchant_option_1,_user_new_euipment_list.user_equipments[equip_found].enchant_opt_2=res.enchant_option_2,_user_new_euipment_list.user_equipments[equip_found].enchant_opt_3=res.enchant_option_3);var ticket_found=_user_new_equipment_enchant_tickets.user_enchant_tickets.findIndex(function(e){return e.new_equipment_enchant_ticket_idx==res.new_equipment_enchant_ticket_idx});-1!=ticket_found&&(_user_new_equipment_enchant_tickets.user_enchant_tickets[ticket_found].ticket_count=res.ticket_count),Instance.upd_UserGold(res.user_gold);break;case"Res_New_Equipment_Enchant_Option_Choice":var equip_found;-1!=(equip_found=_user_new_euipment_list.user_equipments.findIndex(function(e){return e.new_equipment_idx==res.new_equipment_idx&&e.equip_num==res.equip_num}))&&(_user_new_euipment_list.user_equipments[equip_found].enchant_opt_1=res.enchant_option_1,_user_new_euipment_list.user_equipments[equip_found].enchant_opt_2=res.enchant_option_2,_user_new_euipment_list.user_equipments[equip_found].enchant_opt_3=res.enchant_option_3);break;case"Res_New_Equipment_Slot_Open":_user_new_equipment_bound.new_equipment_inc_bound=res.user_new_equipment_bound,Instance.upd_UserJade(res.user_jade);break;case"Res_New_Equipment_General_Mount":for(var re_idx=0;re_idx<res.release_equipments.length;re_idx++){var release_found=_user_new_euipment_list.user_equipments.findIndex(function(e){return e.new_equipment_idx==res.release_equipments[re_idx].equipment_item_idx&&e.equip_num==res.release_equipments[re_idx].equipment_num});-1!=release_found&&(_user_new_euipment_list.user_equipments[release_found].mount_yn="n")}var mount_found=_user_new_euipment_list.user_equipments.findIndex(function(e){return e.new_equipment_idx==res.mount_equipment.equipment_item_idx&&e.equip_num==res.mount_equipment.equipment_num});-1!=mount_found&&(_user_new_euipment_list.user_equipments[mount_found].mount_yn="y"),-1==(gnrl_equip_found=_user_general_new_equipments.user_general_equips.findIndex(function(e){return e.equipment_item_idx==res.mount_equipment.equipment_item_idx&&e.equipment_num==res.mount_equipment.equipment_num&&e.gnrl_id==res.mount_equipment.gnrl_id&&e.gnrl_num==res.mount_equipment.gnrl_num}))&&_user_general_new_equipments.user_general_equips.push_back(res.mount_equipment);for(idx=0;idx<res.release_equipments.length;idx++){-1!=(gnrl_equip_found=_user_general_new_equipments.user_general_equips.findIndex(function(e){return e.equipment_item_idx==res.release_equipments[idx].equipment_item_idx&&e.equipment_num==res.release_equipments[idx].equipment_num&&e.gnrl_id==res.release_equipments[idx].gnrl_id&&e.gnrl_num==res.release_equipments[idx].gnrl_num}))&&_user_general_new_equipments.user_general_equips.splice(gnrl_equip_found,1)}for(idx=0;idx<res.user_goods.length;idx++)res.user_goods[idx].bonus_type==BONUS_TYPE_GOLD?Instance.upd_UserGold(res.user_goods[idx].bonus_level):(res.user_goods[idx].bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&res.user_goods[idx].bonus_type<=BONUS_TYPE_EVOLVE_ARCHER||res.user_goods[idx].bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&res.user_goods[idx].bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE||res.user_goods[idx].bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&res.user_goods[idx].bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)&&Instance.update_User_Evolve_Arm_Service(res.user_goods[idx].bonus_type,res.user_goods[idx].bonus_level);break;case"Res_New_Equipment_General_Release":var gnrl_equip_found;-1!=(found=_user_new_euipment_list.user_equipments.findIndex(function(e){return e.new_equipment_idx==res.release_equipment.equipment_item_idx&&e.equip_num==res.release_equipment.equipment_num}))&&(_user_new_euipment_list.user_equipments[found].mount_yn="n"),-1!=(gnrl_equip_found=_user_general_new_equipments.user_general_equips.findIndex(function(e){return e.equipment_item_idx==res.release_equipment.equipment_item_idx&&e.equipment_num==res.release_equipment.equipment_num&&e.gnrl_id==res.release_equipment.gnrl_id&&e.gnrl_num==res.release_equipment.gnrl_num}))&&_user_general_new_equipments.user_general_equips.splice(gnrl_equip_found,1);for(idx=0;idx<res.user_goods.length;idx++)res.user_goods[idx].bonus_type==BONUS_TYPE_GOLD?Instance.upd_UserGold(res.user_goods[idx].bonus_level):(res.user_goods[idx].bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&res.user_goods[idx].bonus_type<=BONUS_TYPE_EVOLVE_ARCHER||res.user_goods[idx].bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&res.user_goods[idx].bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE||res.user_goods[idx].bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&res.user_goods[idx].bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)&&Instance.update_User_Evolve_Arm_Service(res.user_goods[idx].bonus_type,res.user_goods[idx].bonus_level);break;case"Res_New_Equipment_Sell":for(idx=0;idx<res.sell_equipments.length;idx++){-1!=(found=_user_new_euipment_list.user_equipments.findIndex(function(e){return e.new_equipment_idx==res.sell_equipments[idx].equipment_item_idx&&e.equip_num==res.sell_equipments[idx].equipment_num}))&&_user_new_euipment_list.user_equipments.splice(found,1)}Instance.upd_UserGold(res.user_gold);break;case"Res_New_Equipment_Get":_user_new_euipment_list=res;break;case"Res_New_Equipment_Lock":-1!=(found=_user_new_euipment_list.user_equipments.findIndex(function(e){return e.new_equipment_idx==res.new_equipment_idx&&e.equip_num==res.equip_num}))&&(_user_new_euipment_list.user_equipments[found].lock_yn="y");break;case"Res_New_Equipment_Unlock":-1!=(found=_user_new_euipment_list.user_equipments.findIndex(function(e){return e.new_equipment_idx==res.new_equipment_idx&&e.equip_num==res.equip_num}))&&(_user_new_euipment_list.user_equipments[found].lock_yn="n");break;case"Res_New_Equipment_Get_Inc_Bound":_user_new_equipment_bound=res;break;case"Res_New_Equipment_Get_General_Mount":_user_general_new_equipments=res;break;case"Res_Get_User_Main_Story_Hard_Mode_Mission":_user_main_story_hard_mode_missions=res;break;case"Res_Get_User_Main_Story_Hard_Mode_Mission_Task":_user_main_story_hard_mode_mission_tasks=res;break;case"Res_Get_Main_Story_Hard_Mode_Lotus_Reward_Log":_user_main_story_hard_mode_lotus_reward_log=res;break;case"Res_Get_User_Evolve_Arm_Service_Mtrl":Instance.delete_UserEvolveArmServiceMtrl(),Instance.insert_UserEvolveArmServiceMtrl(res.user_arm_service_mtrl);break;case"Res_Get_User_Yunhee_Bound":Instance.insert_User_Yunhee_Bound(res.user_yunhee_bound);break;case"Res_Get_User_Camp":Instance.update_User_Camp(res.user_camp);break;case"Res_Get_User_Camp_Branch_Ability":Instance.insert_User_Camp_Branch_Ability(res.branch_ability);break;case"Res_Get_User_Camp_Branch_Ability_General":Instance.insert_User_Camp_Branch_Ability_General(res.branch_yunhees);break;case"Res_Get_User_Camp_Cost":Instance.insert_User_Camp_Cost(res);break;case"Res_Get_User_Camp_Cost_General":Instance.delete_User_Camp_Cost_General(),Instance.insert_User_Camp_Cost_General(res);break;case"Res_Get_User_Camp_Cost_Slot":Instance.delete_User_Camp_Cost_Slot(),Instance.insert_User_Camp_Cost_Slot(res);break;case"Res_Get_User_Camp_Arbeit_V2":Instance.delete_User_Camp_Arbeit(),Instance.insert_User_Camp_Arbeit(res);break;case"Res_Get_User_Gacha_Count":Instance.update_User_Gacha_Count(res),Instance.update_User_Ceiling_Gacha_Counts(res.user_ceiling_gacha_info_list);break;case"Res_Get_User_Gacha_Ticket":for(idx=0;idx<res.user_gahca_ticket.length;idx++){var ticket=res.user_gahca_ticket[idx];Instance.update_User_Gacha_Ticket(ticket.shop_id,ticket.ticket_count),0==NOT_USE_SHOP_BUY_LOG_PARSING&&GameDefault.getInstance().setUserTicket(ticket)}break;case"Res_Get_User_Mussang":Instance.delete_User_Mussang(),Instance.insert_User_Mussang(res);break;case"Res_Get_User_Shop_Buy_Info":_user_shop_buy_info=res,0==NOT_USE_SHOP_BUY_LOG_PARSING&&GameDefault.getInstance().setUserBuyInit(res);break;case"Res_Shop_Buy_Gold":res.buy_type==SHOP_BUY_TYPE_JADE?(Instance.upd_UserJade(res.user_jade),Instance.upd_UserGold(res.user_gold),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):res.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(Instance.upd_UserYunheePT(res.user_goods),Instance.upd_UserGold(res.user_gold),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):res.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(Instance.upd_UserHeavenPt(res.user_goods),Instance.upd_UserGold(res.user_gold),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation));break;case"Res_Shop_Buy_Raid_Ticket":res.buy_type==SHOP_BUY_TYPE_JADE?(Instance.upd_UserJade(res.user_goods),Instance.upd_UserItemRaidTicket(res.user_raid_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_user_raid_ticket)):res.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(Instance.upd_UserYunheePT(res.user_goods),Instance.upd_UserItemRaidTicket(res.user_raid_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_user_raid_ticket)):res.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(Instance.upd_UserHeavenPt(res.user_goods),Instance.upd_UserItemRaidTicket(res.user_raid_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_user_raid_ticket));break;case"Res_Shop_Buy_World_War_Ticket":res.buy_type==SHOP_BUY_TYPE_JADE?(Instance.upd_UserJade(res.user_goods),Instance.upd_UserWorldWarTicket(res.user_world_war_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_world_war_update_status)):res.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(Instance.upd_UserYunheePT(res.user_goods),Instance.upd_UserWorldWarTicket(res.user_world_war_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_world_war_update_status)):res.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(Instance.upd_UserHeavenPt(res.user_goods),Instance.upd_UserWorldWarTicket(res.user_world_war_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_world_war_update_status));break;case"Res_Shop_Buy_Great_Wall_Ticket":res.buy_type==SHOP_BUY_TYPE_JADE?(Instance.upd_UserJade(res.user_goods),Instance.upd_UserGreatWall_Ticket(res.user_great_wall_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_user_great_wall_ticket)):res.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(Instance.upd_UserYunheePT(res.user_goods),Instance.upd_UserGreatWall_Ticket(res.user_great_wall_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_user_great_wall_ticket)):res.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(Instance.upd_UserHeavenPt(res.user_goods),Instance.upd_UserGreatWall_Ticket(res.user_great_wall_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_user_great_wall_ticket));break;case"Res_Shop_Buy_Raid_Help_Ticket":res.buy_type==SHOP_BUY_TYPE_JADE?(Instance.upd_UserJade(res.user_goods),Instance.upd_UserRaidHelpTicket(res.user_raid_help_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_user_raid_help_ticket)):res.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(Instance.upd_UserYunheePT(res.user_goods),Instance.upd_UserRaidHelpTicket(res.user_raid_help_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_user_raid_help_ticket)):res.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(Instance.upd_UserHeavenPt(res.user_goods),Instance.upd_UserRaidHelpTicket(res.user_raid_help_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_user_raid_help_ticket));break;case"Res_Shop_Buy_Food":Instance.upd_UserJade(res.user_jade),Instance.plus_User_Heart(res.user_heart),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);break;case"Res_Shop_Buy_Heart":break;case"Res_Shop_Buy_Jade":Instance.upd_UserJade(res.user_jade),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);break;case"Res_Shop_Buy_Limit_Over_Mtrl":if(res.buy_type==SHOP_BUY_TYPE_JADE){Instance.upd_UserJade(res.user_jade);var limit_over_mtrl_type=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(res.bonus_type);Instance.plus_User_Limit_Over_Mtrl(limit_over_mtrl_type,res.mtrl_cnt),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)}else if(res.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT){Instance.upd_UserYunheePT(res.user_goods);limit_over_mtrl_type=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(res.bonus_type);Instance.plus_User_Limit_Over_Mtrl(limit_over_mtrl_type,res.mtrl_cnt),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)}else if(res.buy_type==SHOP_BUY_TYPE_HEAVEN_PT){Instance.upd_UserHeavenPt(res.user_goods);limit_over_mtrl_type=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(res.bonus_type);Instance.plus_User_Limit_Over_Mtrl(limit_over_mtrl_type,res.mtrl_cnt),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)}break;case"Res_Shop_Buy_Evolve_Orb":res.buy_type==SHOP_BUY_TYPE_JADE?(Instance.upd_UserJade(res.user_goods),Instance.plus_User_Evolve_Orb(res.orb_count),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):res.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(Instance.upd_UserYunheePT(res.user_goods),Instance.plus_User_Evolve_Orb(res.orb_count),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):res.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(Instance.upd_UserHeavenPt(res.user_goods),Instance.plus_User_Evolve_Orb(res.orb_count),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation));break;case"Res_Shop_Buy_Formation_Point":res.buy_type==SHOP_BUY_TYPE_JADE?(Instance.upd_UserJade(res.user_goods),Instance.plus_User_Formation_Point(res.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):res.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(Instance.upd_UserYunheePT(res.user_goods),Instance.plus_User_Formation_Point(res.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):res.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(Instance.upd_UserHeavenPt(res.user_goods),Instance.plus_User_Formation_Point(res.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation));break;case"Res_Shop_Buy_Evolve":Instance.plus_User_Hwandan(res.bonus_type,res.evolve_count),res.buy_type==SHOP_BUY_TYPE_JADE?(Instance.upd_UserJade(res.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):res.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(Instance.upd_UserYunheePT(res.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):res.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(Instance.upd_UserHeavenPt(res.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation));break;case"Res_Shop_Buy_New_Equipment_Enchant_Ticket":Instance.plus_User_New_Equipment_Enchant_Ticket(res.shop_sub_id,res.buy_total_count),res.buy_goods_type==BONUS_TYPE_JADE?Instance.upd_UserJade(res.user_goods_count):res.buy_goods_type==BONUS_TYPE_YUNHEE_PT&&Instance.upd_UserYunheePT(res.user_goods_count);break;case"Res_Shop_Buy_Love_Item":Instance.plus_User_Love_Item(res.love_item_id,res.love_item_count,res.gnrl_id),Instance.upd_UserJade(res.user_jade),Instance.plus_User_Heart(res.user_heart),Instance.upd_UserYunheePT(res.user_yunhee_pt),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);break;case"Res_Shop_Buy_Yunhee_Fix":for(var i=0;i<res.new_user_generals.length;i++)Instance.new_User_General(res.new_user_generals[i]),res.buy_type==SHOP_BUY_TYPE_JADE?(Instance.upd_UserJade(res.user_jade),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):res.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(Instance.upd_UserYunheePT(res.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):res.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(Instance.upd_UserHeavenPt(res.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation));break;case"Res_Shop_Buy_Armservice_Evolve":case"Res_Shop_Buy_Formation_Property":res.buy_type==SHOP_BUY_TYPE_JADE?(Instance.upd_UserJade(res.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):res.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(Instance.upd_UserYunheePT(res.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):res.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(Instance.upd_UserHeavenPt(res.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation));break;case"Res_Shop_Buy_Gacha_11_Complete":for(i=0;i<res.new_user_generals.length;i++)Instance.new_User_General(res.new_user_generals[i]);Instance.update_User_Gacha_Count(res.user_gacha_buy_count);break;case"Res_Shop_Buy_Ticket":res.buy_type==SHOP_BUY_TYPE_JADE?Instance.upd_UserJade(res.user_goods):res.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?Instance.upd_UserYunheePT(res.user_goods):res.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&Instance.upd_UserHeavenPt(res.user_goods),Instance.upd_UserItemTicket(res.user_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);break;case"Res_Shop_Buy_Key":res.buy_type==SHOP_BUY_TYPE_JADE?Instance.upd_User_Key(res.user_key,res.user_goods):res.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?Instance.upd_User_Key(res.user_key,void 0,res.user_goods):res.buy_type==SHOP_BUY_TYPE_HEAVEN_PT?Instance.upd_UserHeavenPt(res.user_goods):Instance.upd_User_Key(res.user_key),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);break;case"Res_Shop_Buy_New_Raid_Call_Ticket":res.buy_type==SHOP_BUY_TYPE_JADE?Instance.upd_UserJade(res.user_goods):res.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?Instance.upd_UserYunheePT(res.user_goods):res.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&Instance.upd_UserHeavenPt(res.user_goods),Instance.upd_UserItemNewRaidCallTicket(res.user_raid_ticket);break;case"Res_Shop_Buy_New_Raid_Conquest_Ticket":res.buy_type==SHOP_BUY_TYPE_JADE?Instance.upd_UserJade(res.user_goods):res.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?Instance.upd_UserYunheePT(res.user_goods):res.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&Instance.upd_UserHeavenPt(res.user_goods),Instance.upd_UserItemNewRaidConquestTicket(res.user_raid_ticket);break;case"Res_Get_User_Shop_Jade_First_Buy_Info":Instance.insert_User_Jade_First_Buy_Log(res.user_jade_first_buy_list);break;case"Res_Get_Battle_Dungeon_Continue":_battle_dungeon_continue=res;break;case"Res_Cancel_Battle_Dungeon_Continue":Instance.clearBattleDungeonContinue();break;case"Res_Get_User_Evolution_Event":Instance.insert_User_Evolution_Event(res);break;case"Res_Get_User_Event_Dungeon":Instance.delete_User_Event_Dungeon(),Instance.insert_User_Event_Dungeon(res.user_event_dungeon);break;case"Res_Get_User_Event_Dungeon_Point":Instance.delete_User_Event_Dungeon_Point(),Instance.insert_User_Event_Dungeon_Point(res.event_dungeon_points);break;case"Res_Get_User_Event_Dungeon_Point_Reward":Instance.delete_User_Event_Dungeon_Reward(),Instance.insert_User_Event_Dungeon_Reward(res.user_event_dungeon_reward);break;case"Res_Get_User_Event_Dungeon_Reward_Shop":Instance.delete_User_Event_Dungeon_Reward_Shop(),Instance.insert_User_Event_Dungeon_Reward_Shop(res.user_event_dungeon_reward_shop);break;case"Res_Get_User_Event_Dungeon_Reward_Board_Info":Instance.delete_User_Event_Dungeon_Reward_Board_Info(),Instance.insert_User_Event_Dungeon_Reward_Board_Info(res.user_event_dungeon_reward_board_info);break;case"Res_Get_User_Event_Dungeon_Reward_Board_Map":Instance.delete_User_Event_Dungeon_Reward_Board_Map(),Instance.insert_User_Event_Dungeon_Reward_Board_Map(res.user_event_dungeon_reward_board_map);break;case"Res_Get_User_Event_Dungeon_Open_Period_Info":Instance._event_dungeon_open_period_info=res,(new GameDate).setServerTime(res.server_time),TimeEventEngine.getInstance().setTime(TIME_EVENT_SERVER_TIME,1e3*res.server_time);break;case"Res_Event_Dungeon_Open_Period_Info":Instance._event_dungeon_open_period_info.event_dungeon_open_period=[],Instance._event_dungeon_open_period_info.event_dungeon_open_period=res.event_dungeon_open_period,Instance._event_dungeon_open_period_info.raid_boss_reward_mail_yn=res.raid_boss_reward_mail_yn,Instance._event_dungeon_open_period_info.raid_boss_exist_yn=res.raid_boss_exist_yn,(new GameDate).resetServerTime(res.server_time),TimeEventEngine.getInstance().setTime(TIME_EVENT_SERVER_TIME,1e3*res.server_time);break;case"Res_Get_User_Event_Dungeon_Cutin_Accum_Point":Instance.delete_User_Event_Dungeon_Cutin_Accum_Rate_Point();for(idx=0;idx<res.event_dungeon_cutin_accum_point.length;idx++){var r=res.event_dungeon_cutin_accum_point[idx];Instance.update_User_Event_Dungeon_Cutin_Accum_Rate_Point(r.event_dungeon_period_idx,r.cutin_accum_rate)}break;case"Res_Get_User_Event_Dungeon_Global_Point_Reward_Info":Instance.delete_User_Event_Dungeon_Global_Point_Info(),Instance.insert_User_Event_Dungeon_Global_Point_Info(res.global_point_reward_list);break;case"Res_Get_User_Event_Dungeon_Special_Point":Instance.delete_User_Event_Dungeon_Special_Point(),Instance.insert_User_Event_Dungeon_Special_Point(res.event_dungeon_special_point);break;case"Res_Get_User_Event_Dungeon_Marble_Circuit_Info":Instance.delete_User_Event_Dungeon_Marble_Circuit_Info(),Instance.insert_User_Event_Dungeon_Marble_Circuit_Info(res.event_dungeon_marble_circuit_info);break;case"Res_Get_User_Event_Dungeon_Marble_Fortune":Instance.delete_User_Event_Dungeon_Marble_Fortune(),Instance.insert_User_Event_Dungeon_Marble_Fortune(res.event_dungeon_marble_fortune_info);break;case"Res_Get_User_Event_Dungeon_Marble_Golden_Box_Info":Instance.delete_User_Event_Dungeon_Marble_Golden_Box_Info(),Instance.insert_User_Event_Dungeon_Marble_Golden_Box_Info(res.event_dungeon_marble_golden_box_info);break;case"Res_Get_User_Event_Dungeon_Marble_Map_Info":Instance.delete_User_Event_Dungeon_Marble_Map_Info(),Instance.insert_User_Event_Dungeon_Marble_Map_Info(res.event_dungeon_marble_map_info);break;case"Res_Get_User_Event_Dungeon_Special_Point_Shop_Log":Instance.delete_User_Event_Dungeon_Special_Point_Shop(),Instance.insert_User_Event_Dungeon_Special_Point_Shop(res.event_dungeon_special_point_shop);break;case"Res_Get_User_Daily_Dungeon_Open_Period_Info":m_daily_dungeon_open_period_info.daily_dungeon_open_period=[],m_daily_dungeon_open_period_info.daily_dungeon_open_period=res.daily_dungeon_open_period;break;case"Res_Get_User_Daily_Dungeon":Instance.insert_User_Daily_Dungeon(res.user_daily_dungeon);break;case"Res_General_Lock":map_User_General.at([res.gnrl_key.gnrl_id,res.gnrl_key.gnrl_num]).lock_yn="y",Instance.update_user_Generals();break;case"Res_General_UnLock":map_User_General.at([res.gnrl_key.gnrl_id,res.gnrl_key.gnrl_num]).lock_yn="n",Instance.update_user_Generals();break;case"Res_Unification_Bandit_Battle_Begin":(service=UserService.getInstance()).updateUserItemHeart(res.user_heart);break;case"Res_General_Change_Display_Class":map_User_General.at([res.gnrl_key.gnrl_id,res.gnrl_key.gnrl_num]).display_class=res.display_class,Instance.update_user_Generals();break;case"Req_Login_Result":break;case"Res_User_Achievement_Bonus_Receive":Instance.upd_User_Achievement_Bonus_Recevie(res),0!=res.naming_list.length&&(Instance.delete_User_Naming_Info(),Instance.insert_User_Naming_Info(res.naming_list));break;case"Res_User_Event_Dungeon_Achv_Bonus_Recv":Instance.update_User_Event_Dungeon_Achv_Bonus(res.achv_bonus),GameContext.getInstance().setUserNewMail("y");break;case"Res_User_Event_Dungeon_Achv_Bonus_Recv_All":for(i=0;i<res.achv_bonus_list.length;i++)Instance.update_User_Event_Dungeon_Achv_Bonus(res.achv_bonus_list[i]);if(0<res.achv_bonus_list.length)GameContext.getInstance().setUserNewMail("y");break;case"Res_User_Event_Dungeon_Achv_List":if(null!=_event_dungeon_achv_list&&null!=_event_dungeon_achv_list)if(null!=_event_dungeon_achv_list.achv_list)if(0==_event_dungeon_achv_list.achv_list.length){var obj;0==_event_dungeon_achv_list.event_dungeon_period_idx&&null==_event_dungeon_achv_list.event_dungeon_period_idx||0<res.achv_bonus_list.length&&GameContext.getInstance().setCompleteEventDungeonAchvs(res.achv_bonus_list),(obj={}).event_dungeon_period_idx=res.event_dungeon_period_idx,obj.achv_list=res.achv_bonus_list,_event_dungeon_achv_list=$.extend({},obj)}else{var new_complete_list=[];for(i=0;i<res.achv_bonus_list.length;i++){for(var ra=res.achv_bonus_list[i],found=!1,index=0,j=0;j<_event_dungeon_achv_list.achv_list.length;j++){var ua=_event_dungeon_achv_list.achv_list[j];if(ra.event_dungeon_period_idx==ua.event_dungeon_period_idx&&ra.event_dungeon_achv_list_idx==ua.event_dungeon_achv_list_idx){found=!0,index=j;break}}1==found?(ra.complete_yn!=_event_dungeon_achv_list.achv_list[index].complete_yn&&"y"==ra.complete_yn&&"n"==ra.bonus_complete_yn&&new_complete_list.push(ra),_event_dungeon_achv_list.achv_list[index]=ra):(new_complete_list.push(ra),_event_dungeon_achv_list.achv_list.push(ra))}0<new_complete_list.length&&GameContext.getInstance().setCompleteEventDungeonAchvs(new_complete_list)}else(obj={}).event_dungeon_period_idx=res.event_dungeon_period_idx,obj.achv_list=res.achv_bonus_list,_event_dungeon_achv_list=$.extend({},obj);else(obj={}).event_dungeon_period_idx=res.event_dungeon_period_idx,obj.achv_list=res.achv_bonus_list,_event_dungeon_achv_list=$.extend({},obj);break;case"Res_User_Achievement_Bonus_Receive_All":Instance.upd_User_Achievement_Bonus_Receive_All(res),0!=res.naming_list.length&&(Instance.delete_User_Naming_Info(),Instance.insert_User_Naming_Info(res.naming_list)),GameContext.getInstance().setUserNewMail("y");break;case"Res_Troops_Set_General":break;case"Res_General_Sel":Instance.upd_UserGold(res.user_gold),Instance.upd_UserYunheePT(res.user_yhpt),Instance.upd_UserHeavenPt(res.user_hvpt),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation),Instance.remove_user_generals(res.gnrl_keys);break;case"Res_Troops_Del_General_V2":case"Res_Troops_Set_General_V2":Instance.update_User_Troops_Generals(res.troops_num,res.troops_gnrls);break;case"Res_General_Love_Up":Instance.upd_UserGold(res.user_gold),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation),Instance.upd_User_General_Love_Up(res.gnrl_key,res.user_love_item,res.love_level,res.love_exp);break;case"Res_Shop_Buy_General":Instance.new_User_General(res.new_user_generals),Instance.upd_User_Item(res),Instance.upd_User_Gacha_Count(res.user_gacha_buy_count),Instance.update_User_Ceiling_Gacha_Counts(res.user_ceiling_gacha_info_list),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);break;case"Res_Main_Mission_Battle_Win_V2":Instance.upd_Main_Mission_Battle_Win_V2(res);break;case"Res_User_Mail_All_Reward_Receive":Instance.upd_User_Mail_All_Reward_Receive(res),0!=res.user_equip_list.length&&(Instance.delete_User_Equipments(),Instance.insert_User_Equipments(res.user_equip_list));break;case"Res_General_Level_Up":Instance.upd_UserGold(res.user_gold),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation),Instance.update_User_General_Level_Up(res.gnrl_key,res.level,res.exp),Instance.remove_user_generals(res.mtrl_gnrl_keys);break;case"Res_Main_Mission_Battle_Begin_V2":Instance.upd_Main_Mission_Battle_Begin_V2(res);break;case"Res_Shoten_Time_User_Camp_Branch_Ability":Instance.upd_Shoten_Time_User_Camp_Branch_Ability(res);break;case"Res_Set_User_Camp_Branch_Ability":Instance.upd_UserGold(res.user_gold),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation),Instance.upd_User_Camp_Branch_Ability(res.branch_yunhee);break;case"Res_Cancel_User_Camp_Branch_Ability":Instance.cancel_User_Camp_Branch_Ability(res);break;case"Res_Set_User_Camp_Cost_Slot":Instance.upd_User_Camp_Cost_Slot(res);break;case"Res_Upgrade_User_Camp":Instance.upd_User_Camp(res),null!=res.partin_generals&&(_great_wall_troops_info.partin_generals=res.partin_generals),null!=res.troops_list&&(_great_wall_troops_info.troops_list=res.troops_list);break;case"Res_Troops_Leader_Set":Instance.update_User_Troops_Generals(res.troops_num,res.troops_gnrls);break;case"Res_Set_User_Camp_Cost":Instance.set_User_Camp_Cost(res);break;case"Res_Remove_User_Camp_Cost_General":Instance.remove_User_Camp_Cost_General(res);break;case"Res_General_Evolution":Instance.upd_General_Evolution(res);break;case"Res_General_Limit_Over":Instance.upd_General_Limit_Over(res);break;case"Res_All_Troops_Del_General":Instance.remove_All_Troops_Del_General(res);break;case"Res_Main_Story_Lotus_Bonus_Get_V2":Instance.upd_Main_Story_Lotus_Bonus_Get_V2(res);break;case"Res_Battle_Formation_Level_Up":Instance.upd_Battle_Formation_Level_Up(res);break;case"Res_Battle_Formation_Init":Instance.init_Battle_Formation_Level_Up(res);break;case"Res_Shop_Gacha_Bonus":Instance.upd_shop_Gacha_bonus(res);break;case"Res_Achievement_Complete":Instance.upd_User_Achievement_Complete(res);break;case"Res_User_Mail_Reward_Receive":Instance.upd_User_Mail_Reward_Receive(res),0!=res.user_equip_list.length&&(Instance.delete_User_Equipments(),Instance.insert_User_Equipments(res.user_equip_list));break;case"Res_Weekly_Dungeon_Open":Instance.upd_User_Weekly_Dungeon_Open(res);break;case"Res_Daily_Dungeon_Battle_Begin":Instance.upd_Daily_Dungeon_Battle_Begin(res);break;case"Res_Daily_Dungeon_Battle_Result":Instance.upd_Daily_Dungeon_Battle_Result(res);break;case"Res_Weekly_Dungeon_Battle_Begin":Instance.upd_User_Key(res.user_key,res.user_jade);break;case"Res_Weekly_Dungeon_Battle_Lose":Instance.upd_Weekly_Dungeon_Battle_Lose(res);break;case"Res_Weekly_Dungeon_Battle_Win":Instance.upd_Weekly_Dungeon_Battle_Win(res);break;case"Res_Yunhee_Inventory_Increase":Instance.upd_Yunhee_Inventory_Increase(res),Instance.update_User_Yunhee_Bound(res.user_yunhee_bound);break;case"Res_Mussang_Step_Battle_Begin":Instance.upd_Mussang_Step_Battle_Begin(res);break;case"Res_Mussang_Step_Battle_Win":Instance.upd_Mussang_Step_Battle_Win(res);break;case"Res_Mussang_Step_Battle_Lose":Instance.upd_Mussang_Step_Battle_Lose(res);break;case"Res_Main_Mission_Battle_Continue":Instance.upd_UserJade(res.jade_count);break;case"Res_Main_Story_Hard_Mode_Mission_Battle_Begin":Instance.upd_User_Key(res.user_key);for(var found_mission=!1,found_mission_idx=0,hidx=0;hidx<_user_main_story_hard_mode_missions.user_missions.length;hidx++)if(_user_main_story_hard_mode_missions.user_missions[hidx].main_story_hard_mode_mission_idx==res.main_story_hard_mode_mission_idx){found_mission=!0,found_mission_idx=hidx;break}if(found_mission)_user_main_story_hard_mode_missions.user_missions[found_mission_idx].daily_try_count=res.daily_try_count,_user_main_story_hard_mode_missions.user_missions[found_mission_idx].daily_charge_count=res.daily_charge_count;else{var mission={};mission.main_story_hard_mode_mission_idx=res.main_story_hard_mode_mission_idx,mission.complete_yn="n",mission.win_count=0,mission.daily_try_count=res.daily_try_count,mission.daily_charge_count=res.daily_charge_count,_user_main_story_hard_mode_missions.user_missions.push_back($.extend({},mission))}Instance.upd_UserHeart(res.user_heart);break;case"Res_Main_Story_Hard_Mode_Mission_Battle_Win":Instance.upd_Main_Story_Hard_Mode_Mission_Battle_Win(res);break;case"Res_Main_Story_Hard_Mode_Mission_Battle_Continue":Instance.upd_UserJade(res.user_jade);break;case"Res_Main_Story_Hard_Mode_Mission_Charge":for(var found_mission_list=!1,found_mission_list_idx=0,kidx=0;kidx<_user_main_story_hard_mode_missions.user_missions.length;kidx++)if(_user_main_story_hard_mode_missions.user_missions[kidx].main_story_hard_mode_mission_idx==res.main_story_hard_mode_mission_idx){found_mission_list=!0,found_mission_list_idx=kidx;break}found_mission_list&&(_user_main_story_hard_mode_missions.user_missions[found_mission_list_idx].daily_try_count=res.daily_try_count,_user_main_story_hard_mode_missions.user_missions[found_mission_list_idx].daily_charge_count=res.daily_charge_count),res.use_goods_type==BONUS_TYPE_JADE?Instance.upd_UserJade(res.user_goods):res.use_goods_type==BONUS_TYPE_GOLD&&Instance.upd_UserGold(res.user_goods);break;case"Res_Weekly_Dungeon_Battle_Continue":Instance.upd_UserJade(res.user_jade);break;case"Res_Get_User_Daily_Bonus":case"Res_Daily_Bonus_Recv":break;case"Res_Shop_Buy_Raid_Gacha":Instance.upd_UserRaidPoint(res.user_raid_point),Instance.insert_User_Equipments(res.new_equipment);break;case"Res_Shop_Buy_Equipment_Box_Gacha":Instance.upd_UserRaidPoint(res.user_raid_point),Instance.insert_User_Box_Gacha_Equipments(res.new_equipment_box_gacha_item);break;case"Res_Get_User_Equipment":Instance.delete_User_Equipments(),Instance.insert_User_Equipments(res.user_equip_list);break;case"Res_Get_User_General_Equipment":Instance.delete_User_Gnrl_Equipments(),Instance.insert_User_Gnrl_Equipments(res.user_gnrl_equip_list);break;case"Res_Get_User_Equipment_Bound":Instance.update_User_Equipment_Bound(res.user_equipment_bound);break;case"Res_Equipment_General_Equip":0<res.release_equipment_key.equipment_item_idx&&Instance.delete_User_Gnrl_Equipment(res.release_gnrl_key,res.release_equipment_key);var equipment_key=$.extend({},res.gnrl_key,res.equipment_key);Instance.insert_User_Gnrl_Equipment(equipment_key),Instance.upd_UserGold(res.user_gold),0<res.release_equipment_key.equipment_item_idx&&(map_User_Equipment.at([res.release_equipment_key.equipment_item_idx,res.release_equipment_key.equipment_num]).equip_yn="n"),map_User_Equipment.at([res.equipment_key.equipment_item_idx,res.equipment_key.equipment_num]).equip_yn="y";break;case"Res_Equipment_General_Release":Instance.delete_User_Gnrl_Equipment(res.gnrl_key,res.equipment_key),Instance.upd_UserGold(res.user_gold),map_User_Equipment.at([res.equipment_key.equipment_item_idx,res.equipment_key.equipment_num]).equip_yn="n";break;case"Res_Equipment_General_Change":Instance.delete_User_Gnrl_Equipment(res.gnrl_key,res.release_equipment_key),0<res.release_gnrl_key.gnrl_id&&Instance.delete_User_Gnrl_Equipment(res.release_gnrl_key,res.equipment_key);var objC=$.extend({},res.gnrl_key,res.equipment_key);Instance.insert_User_Gnrl_Equipment(objC),Instance.upd_UserGold(res.user_gold),map_User_Equipment.at([res.release_equipment_key.equipment_item_idx,res.release_equipment_key.equipment_num]).equip_yn="n",map_User_Equipment.at([res.equipment_key.equipment_item_idx,res.equipment_key.equipment_num]).equip_yn="y";break;case"Res_Equipment_Levelup":var equipment=map_User_Equipment.at([res.equipment_data.equipment_item_idx,res.equipment_data.equipment_num]);for(equipment.level=res.equipment_data.level,equipment.stat_value=res.equipment_data.stat_value,equipment.exp=res.equipment_data.exp,idx=0;idx<res.mtrl_equip_list.length;idx++){var equip=res.mtrl_equip_list[idx];Instance.delete_User_Equipment(equip)}Instance.upd_UserGold(res.user_gold);break;case"Res_Equipment_Lock":map_User_Equipment.at([res.equipment_key.equipment_item_idx,res.equipment_key.equipment_num]).lock_yn="y";break;case"Res_Equipment_Unlock":map_User_Equipment.at([res.equipment_key.equipment_item_idx,res.equipment_key.equipment_num]).lock_yn="n";break;case"Res_Equipment_Sell":for(idx=0;idx<res.equipment_list.length;idx++)Instance.delete_User_Equipment(res.equipment_list[idx]);Instance.upd_UserGold(res.user_gold);break;case"Res_Equipment_Inventory_Increase":Instance.upd_UserJade(res.user_jade),this.update_User_Equipment_Bound(res.user_equip_bound);break;case"Res_Event_Dungeon_Battle_Begin":Instance.upd_User_Key(res.user_key);var period=MasterManager.getInstance().get_EventDungeonPeriod(res.event_dungeon_period_idx);if(Instance.update_User_Event_Dungeon_Cutin_Accum_Rate_Point(period.event_dungeon_group_idx,res.cutin_rate),null!=res.task_list)for(i=0;i<res.task_list.length;i++){var task=res.task_list[i];Instance.update_User_Event_Dungeon_Task(task)}break;case"Res_Event_Dungeon_Vote_League_Voting":if(null!=res.event_dungeon_special_point&&Instance.update_User_Event_Dungeon_Special_Point(res.event_dungeon_special_point),null!=res.event_dungeon_point&&Instance.update_User_Event_Dungeon_Point(res.event_dungeon_point),-1!=(found=list_User_Event_Dungeon_Vote_League_Record.findIndex(function(m){return res.event_dungeon_period_idx==m.event_dungeon_period_idx&&res.league_idx==m.league_idx})))list_User_Event_Dungeon_Vote_League_Record[found].vote_cnt+=res.vote_count;else{period=(mt=MasterManager.getInstance()).get_EventDungeonPeriod(res.event_dungeon_period_idx);var record={};record.event_dungeon_group_idx=period.event_dungeon_group_idx,record.event_dungeon_period_idx=res.event_dungeon_period_idx,record.league_idx=res.league_idx,record.vote_cnt=res.vote_count,list_User_Event_Dungeon_Vote_League_Record.push_back(record)}break;case"Res_Get_Event_Dungeon_Vote_League_Yunhee_Info":m_Res_Get_Event_Dungeon_Vote_League_Yunhee_Info=res,(new GameDate).resetServerTime(res.server_time),TimeEventEngine.getInstance().setTime(TIME_EVENT_SERVER_TIME,1e3*res.server_time);break;case"Res_Vote_Event_Voting_V1":this.update_User_Event_Dungeon_Special_Point(res.event_dungeon_special_point);break;case"Res_Get_User_Event_Dungeon_Vote_Info_V1":_get_User_Vote_Info=res.event_dungeon_vote_ranking_info;break;case"Res_Get_Event_Dungeon_Vote_Ranking_Info":m_Res_Get_Event_Dungeon_Vote_League_Ranking_Info=res;break;case"Res_Get_Event_Dungeon_Vote_Ranking_Info_V1":m_Res_Get_Event_Dungeon_Vote_Ranking_Info=res;break;case"Res_Get_User_Event_Dungeon_Vote_Info":_get_User_Vote_Info=res.user_event_dungeon_vote_info;break;case"Res_Get_Event_Dungeon_Vote_League_Ranking_Record":m_Res_Get_Event_Dungeon_Vote_League_Ranking_Record=res;break;case"Res_Event_Dungeon_Battle_Win":Instance.upd_User_Key(res.user_key);period=(m=MasterManager.getInstance()).get_EventDungeonPeriod(res.event_dungeon_period_idx);(service=UserService.getInstance()).updateUserItemEventDungeonPoint(res.user_event_dungeon_point,res.user_event_dungeon_accum_point,period.event_dungeon_point_period_idx);var is_new_mail=!1;if((sp={}).event_dungeon_period_idx=res.event_dungeon_period_idx,sp.event_dungeon_point_period_idx=m.get_EventDungeonPeriod(res.event_dungeon_period_idx).event_dungeon_point_period_idx,sp.point=res.user_special_point,sp.accum_point=res.user_accum_special_point,(sp_list=[]).push(sp),Instance.insert_User_Event_Dungeon_Special_Point(sp_list),Instance.upd_UserFormationPoint(res.user_formation_point),Instance.upd_UserItemRaidTicket(res.user_raid_ticket),Instance.upd_UserRaidHelpTicket(res.user_raid_help_ticket),USE_NEW_RAID_DUNGEON&&(Instance.upd_UserItemNewRaidCallTicket(res.user_new_raid_boss_call_key),Instance.upd_UserItemNewRaidConquestTicket(res.user_new_raid_boss_conquest_key)),Instance.upd_UserJade(res.user_jade),Instance.upd_UserGold(res.user_gold),Instance.upd_UserHeart(res.user_heart),Instance.upd_UserLevelExp(res.user_level,res.user_exp),null!=(user_event_dungeon=map_user_event_dungeon.at([m_user_id,res.event_dungeon_idx])))user_event_dungeon.win_count=res.win_count,user_event_dungeon.complete_yn="y",map_user_event_dungeon.insert([m_user_id,res.event_dungeon_idx],user_event_dungeon);else(user_data={}).user_id=m_user_id,user_data.event_dungeon_idx=res.event_dungeon_idx,user_data.challenge_count=res.challenge_count,user_data.win_count=res.win_count,user_data.complete_yn="y",map_user_event_dungeon.insert([m_user_id,res.event_dungeon_idx],user_data);for(idx=0;idx<res.bonus_items.length;idx++){if((b=res.bonus_items[idx]).bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX)(gnrl={}).gnrl_id=b.bonus_idx,gnrl.gnrl_num=b.bonus_num,gnrl.gnrl_level=b.bonus_level,gnrl.castle_id=b.castle_id,Instance.insert_User_General(gnrl);else if(b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7)Instance.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)Instance.plus_User_Love_Item(b.bonus_idx,b.bonus_num);else if(b.bonus_type==BONUS_TYPE_HEART);else if(b.bonus_type==BONUS_TYPE_JADE);else if(b.bonus_type==BONUS_TYPE_GOLD);else if(b.bonus_type==BONUS_TYPE_KEY);else if(b.bonus_type==BONUS_TYPE_RAID_TICKET);else if(b.bonus_type==BONUS_TYPE_EVENT_POINT);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE)Instance.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL)Instance.plus_User_Magic_Key_Mtrl(b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&b.bonus_type<=BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND){var craft_shop_bonus_type=b.bonus_type-BONUS_TYPE_CRAFT_SHOP_FIRST_LOW+4;Instance.plus_User_Craft_Shop_Material(craft_shop_bonus_type,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){var rebirth_mtrl_type=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(b.bonus_type);Instance.plus_User_Rebirth_Mtrl(rebirth_mtrl_type,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EQUIPMENT)Instance.insert_User_Equipment(b.equipment);else if(b.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||b.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL){limit_over_mtrl_type=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(b.bonus_type);Instance.plus_User_Limit_Over_Mtrl(limit_over_mtrl_type,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EVENT_DUNGEON_SPECIAL_POINT);else if(b.bonus_type==BONUS_TYPE_USER_EXP);else if(b.bonus_type>=BONUS_TYPE_CHRISTMAS_RIBBON&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_APPLE){craft_shop_bonus_type=GeneralService.getInstance().getBonusTypeToCraftShopMtrlType(b.bonus_type);Instance.plus_User_Craft_Shop_Material(craft_shop_bonus_type,b.bonus_idx)}else b.bonus_type>=BONUS_TYPE_CHRISTMAS_SANTA&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_SNOWMAN?Instance.update_User_Christmas_Reward(b.bonus_type,b.bonus_num,period.event_dungeon_group_idx):b.bonus_type==BONUS_TYPE_GREAT_WALL_TICKET?is_new_mail=!0:b.bonus_type!=BONUS_TYPE_RAID_TICKET&&b.bonus_type!=BONUS_TYPE_RAID_HELP_TICKET||(is_new_mail=!0)}is_new_mail||(is_new_mail="y"==res.new_mail_yn),GameContext.getInstance().setUserNewMail(is_new_mail?"y":"n"),Instance.upd_UserGeneralLevelExp(res.gnrl_exp);var first_event_dungeon_period_idx=0,second_event_dungeon_period_idx=0;1==res.event_dungeon_period_idx%1e3?second_event_dungeon_period_idx=(first_event_dungeon_period_idx=res.event_dungeon_period_idx)+1:first_event_dungeon_period_idx=(second_event_dungeon_period_idx=res.event_dungeon_period_idx)-1;for(idx=0;idx<Instance._event_dungeon_open_period_info.event_dungeon_open_period.length;idx++){(period=Instance._event_dungeon_open_period_info.event_dungeon_open_period[idx]).event_dungeon_period_idx!=first_event_dungeon_period_idx&&period.event_dungeon_period_idx!=second_event_dungeon_period_idx||(period.event_dungeon_global_accum_point=res.total_global_event_point),period.event_dungeon_period_idx!=first_event_dungeon_period_idx&&period.event_dungeon_period_idx!=second_event_dungeon_period_idx||(period.event_dungeon_cutin_max_accum_damage_point=res.cutin_damage_accum_max_point)}if("y"==res.raid_boss_discovered_yn)if(-1==(found=_raid_boss_list.user_raid_boss_open_list.findIndex(function(r){return r.discovered_user_id==res.raid_boss_info.discovered_user_id&&r.raid_boss_period_idx==res.raid_boss_info.raid_boss_period_idx&&r.raid_boss_num==res.raid_boss_info.raid_boss_num}))){var temp_list=_raid_boss_list.user_raid_boss_open_list.slice(0);_raid_boss_list.user_raid_boss_open_list.clear(),_raid_boss_list.user_raid_boss_open_list.push_back(res.raid_boss_info);for(i=0;i<temp_list.size();i++)_raid_boss_list.user_raid_boss_open_list.push_back(temp_list.at(i))}for(i=0;i<res.task_list.length;i++){task=res.task_list[i];Instance.update_User_Event_Dungeon_Task(task)}break;case"Res_Event_Dungeon_Battle_Lose":break;case"Res_Event_Dungeon_Battle_Continue":Instance.upd_UserJade(res.user_jade);break;case"Res_Get_Rolling_Banner_Info":_get_Rolling_Banner_Info=res;break;case"Res_Get_Shop_Gacha_Period_Info":_get_Shop_Gacha_Period_Info=res;break;case"Res_Get_Popup_Banner_Info":_get_Popup_Banner_Info=res;break;case"Res_Get_User_Limit_Over_Mtrl_Info":Instance.insert_User_Limit_Over_Mtlr(res.user_limit_over_material);break;case"Res_Camp_Factory_Exchange_Item":Instance.upd_Camp_Factory_Exchange_Item(res);break;case"Res_Camp_Factory_Gnrl_Exchange_Item":var gnrl_item={};gnrl_item.gnrl_factory_id=res.gnrl_factory_id,gnrl_item.exchange_count=res.exchange_count,gnrl_item.remain_exchange_count=res.remain_exchange_count,Instance.updateCampFactoryGnrlExchange($.extend({},gnrl_item));for(i=0;i<res.user_gnrl_piece.length;i++){var p=res.user_gnrl_piece[i];Instance.update_User_Gnrl_Piece(p)}for(var gnrl_list=[],r_idx=0;r_idx<res.reward_list.length;r_idx++){if(res.reward_list[r_idx].bonus_type==BONUS_TYPE_YUNHEE_FIX)(gnrl={}).gnrl_id=res.reward_list[r_idx].bonus_idx,gnrl.gnrl_num=res.reward_list[r_idx].bonus_num,gnrl.castle_id=res.reward_list[r_idx].castle_id,gnrl.gnrl_level=1,gnrl.used_in_camp="n",gnrl.using_in_camp="n",(g=MasterManager.getInstance().get_General(gnrl.gnrl_id)).gnrl_type!=GENERAL_TYPE_YUNHEE&&g.gnrl_type!=GENERAL_TYPE_LIMIT_OVER||g.rare_type!=RARE_TYPE_SSR?gnrl.lock_yn="n":gnrl.lock_yn="y",gnrl_list.push_back(gnrl)}Instance.insert_User_General(gnrl_list);break;case"Res_Get_Camp_Factory_Gnrl_Exchange_Item":_user_camp_gnrl_factory_exchange_item=res;break;case"Res_Main_Story_Hard_Mode_Lotus_Reward_Get":-1!=(found=_user_main_story_hard_mode_lotus_reward_log.lotus_reward_log.findIndex(function(obj){if(obj.main_story_hard_mode_lotus_reward_idx==res.lotus_reward_log.main_story_hard_mode_lotus_reward_idx&&obj.difficult==res.lotus_reward_log.difficult&&obj.main_story_id==res.lotus_reward_log.main_story_id&&obj.lotus_count==res.lotus_reward_log.lotus_count)return!0}))?(_user_main_story_hard_mode_lotus_reward_log.lotus_reward_log[found].complete_yn=res.lotus_reward_log.complete_yn,_user_main_story_hard_mode_lotus_reward_log.lotus_reward_log[found].new_yn=res.lotus_reward_log.new_yn):_user_main_story_hard_mode_lotus_reward_log.lotus_reward_log.push_back(res.lotus_reward_log);break;case"Res_Get_User_Jade_Piece":Instance.upd_Get_User_Jade_Piece(res);break;case"Res_Get_User_Magic_Key_Mtrl":User_Magic_Key_Mtrl=res.magic_key_mtrl_cnt,User_Key_Recovery_Make_Count=res.key_recovery_make_cnt;break;case"Res_Get_User_Event_Dungeon_Craft_Shop_Product_Info":_user_Event_Dungeon_Craft_Shop_Product_Info=res;break;case"Res_Get_User_Event_Dungeon_Craft_Shop_Material":map_user_event_dungeon_craft_shop_material.clear(),Instance.insert_User_Event_Dungeon_Craft_Shop_Material(res.event_Dungeon_craft_shop_material);break;case"Res_Event_Dungeon_Craft_Shop_Material_Exchange":Instance.update_User_Event_Dungeon_Craft_Shop_Material(res.event_Dungeon_craft_shop_material);break;case"Res_Get_User_Raid_Boss_List":_raid_boss_list=res;break;case"Res_Get_User_Raid_Boss_History":_raid_boss_history=res;break;case"Res_Raid_Boss_Battle_Check":"y"==res.battle_continue_clear_yn&&Instance.clearBattleDungeonContinue(),Instance.upd_UserItemRaidTicket(res.user_raid_ticket),Instance.upd_UserRaidHelpTicket(res.user_raid_help_ticket);break;case"Res_Raid_Boss_Battle_Start":if(0==res.raid_boss_info.remain_hp){found=0;var found_is=!1;for(i=0;i<_raid_boss_list.user_raid_boss_open_list.length;i++){if(found=i,(frnd=_raid_boss_list.user_raid_boss_open_list[i]).discovered_user_id==res.raid_boss_info.discovered_user_id&&frnd.raid_boss_period_idx==res.raid_boss_info.raid_boss_period_idx&&frnd.raid_boss_num==res.raid_boss_info.raid_boss_num){found_is=!0;break}}1==found_is&&_raid_boss_list.user_raid_boss_open_list.splice(found,1)}else for(i=0;i<_raid_boss_list.user_raid_boss_open_list.length;i++){if((r=_raid_boss_list.user_raid_boss_open_list[i]).discovered_user_id==res.raid_boss_info.discovered_user_id&&r.raid_boss_period_idx==res.raid_boss_info.raid_boss_period_idx&&r.raid_boss_num==res.raid_boss_info.raid_boss_num){r.remain_hp=res.raid_boss_info.remain_hp;break}}Instance.upd_UserItemRaidTicket(res.user_raid_ticket),Instance.upd_UserRaidHelpTicket(res.user_raid_help_ticket),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);break;case"Res_Raid_Boss_Shared":for(i=0;i<_raid_boss_list.user_raid_boss_open_list.length;i++){if((r=_raid_boss_list.user_raid_boss_open_list[i]).discovered_user_id==res.raid_boss_info.discovered_user_id&&r.raid_boss_period_idx==res.raid_boss_info.raid_boss_period_idx&&r.raid_boss_num==res.raid_boss_info.raid_boss_num){r.shared_type=res.raid_boss_info.shared_type,r.remain_hp=res.raid_boss_info.remain_hp;break}}break;case"Res_Raid_Boss_Force_Retreat":for(found=0,found_is=!1,i=0;i<_raid_boss_list.user_raid_boss_open_list.length;i++){var frnd;if(found=i,(frnd=_raid_boss_list.user_raid_boss_open_list[i]).discovered_user_id==res.raid_boss_info.discovered_user_id&&frnd.raid_boss_period_idx==res.raid_boss_info.raid_boss_period_idx&&frnd.raid_boss_num==res.raid_boss_info.raid_boss_num){found_is=!0;break}}1==found_is&&_raid_boss_list.user_raid_boss_open_list.splice(found,1);break;case"Res_Raid_Boss_Partin_User_List":break;case"Res_Get_User_Book_V2":Instance.init_User_Book_General(res.gnrls);break;case"Res_Get_User_Illust_Book":Instance.update_User_Illust_Book(res.user_illust_list);break;case"Res_Event_Dungeon_Point_Reward_Board_Map":(service=UserService.getInstance()).updateUserItemEventDungeonPoint(res.user_event_dungeon_point,res.user_accum_event_dungeon_point,res.event_dungeon_period_idx),Instance.update_User_Event_Dungeon_Point_Reward_Board_Map(res),GameContext.getInstance().setUserNewMail("y");break;case"Res_Equipment_General_Change":Instance.update_User_Equipment_General_Change(res);break;case"Res_User_Prologue_V2_Complete":Instance.update_User_Prologue_V2_Complete(res);break;case"Res_Get_User_Prologue_V2":Instance.get_User_Prologue_V2(res);break;case"Res_Raid_Boss_Battle_Result":Instance.set_Raid_Boss_Battle_Result(res);break;case"Res_Event_Dungeon_Point_Reward":Instance.update_User_Event_Dungeon_Reward(res);break;case"Res_Event_Dungeon_Use_Point_Reward_Receive":res.event_dungeon_reward_success.forEach(function(r){Instance.update_User_Event_Dungeon_Use_Point_Reward(r)}),GameContext.getInstance().setUserNewMail("y");break;case"Res_Announce_Msg":Instance.update_Announce_List(res);break;case"Res_Event_Dungeon_Marble_Circuit_Reward":0!=res.event_dungeon_marble_circuit_info_all.length?Instance.update_User_Event_Dungeon_Marble_Circuit_Info(res.event_dungeon_marble_circuit_info_all):Instance.update_User_Event_Dungeon_Marble_Circuit_Info(res.event_dungeon_marble_circuit_info),Instance.update_User_Event_Dungeon_Special_Point(res.event_dungeon_special_point),GameContext.getInstance().setUserNewMail("y");break;case"Res_Event_Dungeon_Marble_Throw_Dice":0<res.gain_special_point&&Instance.update_User_Event_Dungeon_Special_Point(res.event_dungeon_special_point),Instance.update_User_Event_Dungeon_Point(res.event_dungeon_point);var map={};map.event_dungeon_period_idx=res.event_dungeon_period_idx,map.event_dungeon_marble_map_info_idx=res.reach_event_dungeon_marble_map_info_idx,map.circuit_count=res.circuit_count;var map_list=[];map_list.push_back(map),Instance.update_User_Event_Dungeon_Marble_Map_Info(map_list);var fortune={};fortune.event_dungeon_period_idx=res.event_dungeon_period_idx,fortune.fortune_type=res.fortune_type;var fortune_list=[];if(fortune_list.push_back(fortune),Instance.update_User_Event_Dungeon_Marble_Fortune(fortune_list),0!=res.event_dungeon_marble_golden_box_info.length&&Instance.update_User_Event_Dungeon_Marble_Golden_Box_Info(res.event_dungeon_marble_golden_box_info),0<res.bonus_items.length)GameContext.getInstance().setUserNewMail("y");break;case"Premium_Login_DMM_Point_Key":m_premium_login_dmm_point_key=res;break;case"Res_Equipment_Box_Gacha_Next_Box_Moving":m_Res_Get_User_Equipment_Box_Gacha_Info.equipment_box_gacha_item_info.clear(),m_Res_Get_User_Equipment_Box_Gacha_Info.arm_service_type=res.arm_service_type,m_Res_Get_User_Equipment_Box_Gacha_Info.equipment_parts_type=res.equipment_parts_type,m_Res_Get_User_Equipment_Box_Gacha_Info.user_round_count=res.user_round_count;break;case"Res_Get_User_Equipment_Box_Gacha_Info":m_Res_Get_User_Equipment_Box_Gacha_Info=res;break;case"Res_Check_Upgrade_User_Camp_Branch_Ability":Instance.update_Check_Upgrade_User_Camp_Branch_Ability(res);break;case"Res_User_Check_Beginner_Booster":Instance.delete_User_Beginner_Booster(),Instance.insert_user_beginner_booster(res);break;case"Res_Great_Wall_Dungeon_Reset":_great_wall_dungeon_list.dungeon_list=res.dungeon_list,_great_wall_dungeon_list.last_reset_dt=res.last_reset_dt,_great_wall_dungeon_list.great_wall_dungeon_period_idx=res.great_wall_dungeon_period_idx,_great_wall_troops_info.great_wall_dungeon_period_idx=res.great_wall_dungeon_period_idx,_great_wall_troops_info.troops_list=res.troops_list,_great_wall_troops_info.partin_generals=res.partin_generals;break;case"Req_Great_Wall_Gnrl_Recovery":_great_wall_dungeon_list.great_wall_dungeon_period_idx==res.great_wall_dungeon_period_idx&&(_great_wall_dungeon_list.last_gnrl_recovery_dt=res.last_gnrl_recovery_dt),_great_wall_troops_info.great_wall_dungeon_period_idx==res.great_wall_dungeon_period_idx&&(_great_wall_troops_info.partin_generals=res.partin_generals);break;case"Res_Great_Wall_Troops_General_Force_Release":if(0==res.great_wall_dungeon_period_idx)return;_great_wall_troops_info.partin_generals=res.partin_generals;for(idx=0;idx<_great_wall_troops_info.troops_list.length;idx++){if((t=_great_wall_troops_info.troops_list[idx]).troops_num==res.troops_num){t.troops_generls=res.troops_generals;break}}break;case"Res_Great_Wall_Troops_Info":_great_wall_troops_info=res;break;case"Res_Great_Wall_Dungeon_List":_great_wall_dungeon_list=res;break;case"Res_Great_Wall_Dungeon_Info":_great_wall_dungeon_info=res,null==_great_wall_troops_info.npc_list&&(_great_wall_dungeon_info.npc_list=[]);break;case"Res_Great_Wall_Troops_Set":case"Res_Great_Wall_Troops_Del":if(0==res.great_wall_dungeon_period_idx)return;for(idx=0;idx<_great_wall_troops_info.troops_list.length;idx++){if((t=_great_wall_troops_info.troops_list[idx]).troops_num==res.troops_num){t.troops_generls=res.troops_generals;break}}_great_wall_troops_info.partin_generals=res.partin_generals;break;case"Res_Great_Wall_Troops_Leader_Set":if(0==res.great_wall_dungeon_period_idx)return;for(idx=0;idx<_great_wall_troops_info.troops_list.length;idx++){var t;if((t=_great_wall_troops_info.troops_list[idx]).troops_num==res.troops_num){t.troops_generls=res.troops_generals;break}}break;case"Res_Get_User_Event_Dungeon_Box_Gacha_Info":res.user_event_dungeon_extra_box_init_info.forEach(function(e){map_User_Extra_Box_Init_Info.insert(e.box_gacha_info_idx,e)}),list_User_Box_Gacha_Info=res.user_event_dungeon_box_gacha_info,Instance.resetEventDungeonBoxGachaItemInfoList(),list_User_Box_Gacha_Golden_Barrel_Info=res.user_golden_barrel_info;break;case"Res_Event_Dungeon_Box_Gacha_Extra_Box_Init":var extra_info={};extra_info.box_gacha_info_idx=res.box_gacha_info_idx,extra_info.init_count=res.init_count,map_User_Extra_Box_Init_Info.insert(res.box_gacha_info_idx,extra_info),Instance.resetEventDungeonBoxGachaItemInfoList();break;case"Res_Get_User_Event_Dungeon_Box_Gacha_Progress_Info":case"Res_Event_Dungeon_Box_Gacha_Moving":list_User_Box_Gacha_progress_Info=res.user_event_dungeon_box_gacha_progress_info;break;case"Res_Event_Dungeon_Box_Gacha_Reset_V2":case"Res_Event_Dungeon_Box_Gacha_Buy_Log_V2":break;case"Res_Event_Dungeon_Box_Gacha_Buy_V2":var service=UserService.getInstance();for(period=(m=MasterManager.getInstance()).get_EventDungeonPeriod(res.event_dungeon_period_idx),i=0;i<Instance._event_box_gacha_info_v2.event_dungeon_box_gacha_info.length;i++){if((info=Instance._event_box_gacha_info_v2.event_dungeon_box_gacha_info[i]).event_dungeon_period_idx==res.event_dungeon_period_idx&&info.event_dungeon_box_gacha_idx==res.event_dungeon_box_gacha_idx){for(j=0;j<res.buy_log.length;j++)info.buy_log.push(res.buy_log[j]);info.golden_barrel_log=[],info.golden_barrel_log=res.golden_barrel_log}}service.updateUserItemEventDungeonPoint(res.user_event_point,res.user_accum_event_point,res.event_dungeon_period_idx);for(j=0;j<res.reward_items.length;j++){var b=res.reward_items[j];MasterManager.getInstance().get_BonusType(b.bonus_type);b.bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX||(b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7?Instance.plus_User_Hwandan(b.bonus_type,b.bonus_idx):b.bonus_type==BONUS_TYPE_LOVE_ITEM||(b.bonus_type==BONUS_TYPE_HEART?Instance.plus_User_Heart(b.bonus_idx):b.bonus_type==BONUS_TYPE_JADE||(b.bonus_type==BONUS_TYPE_GOLD?Instance.plus_User_Gold(b.bonus_idx):b.bonus_type==BONUS_TYPE_KEY||b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE||b.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE||(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER?Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE?Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW?Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx):b.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL||b.bonus_type>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&b.bonus_type<=BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6||b.bonus_type==BONUS_TYPE_EQUIPMENT||b.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||b.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL||b.bonus_type>=BONUS_TYPE_CHRISTMAS_RIBBON&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_APPLE||b.bonus_type>=BONUS_TYPE_CHRISTMAS_SANTA&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_SNOWMAN||b.bonus_type==BONUS_TYPE_EVOLVE_ORB||b.bonus_type==BONUS_TYPE_JADE_RANDOM_BOX||b.bonus_type==BONUS_TYPE_GOLD_RANDOM_BOX||b.bonus_type==BONUS_TYPE_LOVE_ITEM_RANDOM_BOX||b.bonus_type==BONUS_TYPE_RARE_HWANDAN_RANDOM_BOX||b.bonus_type==BONUS_TYPE_EXP_CARD_RANDOM_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_GIFT_BOX||b.bonus_type==BONUS_TYPE_SWORD_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_SPEAR_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_ARCHER_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_RANDOM_BOX||b.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_GIFT_BOX||b.bonus_type==BONUS_TYPE_EVENTDUNGEON_PRESENT_GIFT_BOX||b.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_R_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_HR_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_SR_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_HN_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_R_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_HR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_SR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_1||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_2||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_3||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_4||b.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_GACHA_REBORN_GNRL_TICKET||b.bonus_type==BONUS_TYPE_ALL_RARE_TYPE_GNRL_SELECT_TICKET||b.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET||b.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET_V2||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_2||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_3||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_4||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_5||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_6||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_7||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_8||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_9||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_10||b.bonus_type>=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_11&&b.bonus_type<=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_23||b.bonus_type>=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_31&&b.bonus_type<=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_80||b.bonus_type==BONUS_TYPE_KEY_REFILL||b.bonus_type==BONUS_TYPE_TICKET_REFILL||b.bonus_type==BONUS_TYPE_RAID_TICKET_REFILL||b.bonus_type==BONUS_TYPE_TICKET_REFILL||b.bonus_type==BONUS_TYPE_SKIP_TICKET||b.bonus_type==BONUS_TYPE_SKIP_TICKET||(b.bonus_type,BONUS_TYPE_EXP_SET_HIGH)))))}break;case"Res_Event_Dungeon_Box_Gacha_Info_V2":Instance._event_box_gacha_info_v2=res;break;case"Res_Event_Raid_Dungeon_Achieve_Info":User_Achieve_Info_list=res;break;case"Res_Event_Raid_Dungeon_Achieve_Reward":User_Achieve_Info_list.event_raid_achieve=res.event_raid_achieve;break;case"Res_Event_Raid_Dungeon_Battle_Begin":Global_Raid_Boss_Info.event_dungeon_period_idx=res.event_dungeon_period_idx,null==Global_Raid_Boss_Info.event_raid_boss_info&&(Global_Raid_Boss_Info.event_raid_boss_info={},Global_Raid_Boss_Info.event_raid_boss_info.boss_damage=res.event_raid_boss_info.boss_damage),Global_Raid_Boss_Info.event_raid_boss_info.event_raid_dungeon_idx=res.event_raid_boss_info.event_raid_dungeon_idx,Global_Raid_Boss_Info.event_raid_boss_info.boss_num=res.event_raid_boss_info.boss_num,Global_Raid_Boss_Info.event_raid_boss_info.die_yn=res.event_raid_boss_info.die_yn,Global_Raid_Boss_Info.event_raid_boss_info.remain_hp=res.event_raid_boss_info.remain_hp,Global_Raid_Dungeon_info=res,(service=UserService.getInstance()).updateUserItemEventDungeonPoint(res.user_point,res.accum_point,res.event_dungeon_period_idx);break;case"Res_Event_Raid_Dungeon_Battle_Win":if(null!=User_Achieve_Info_list&&null!=User_Achieve_Info_list&&null!=User_Achieve_Info_list.event_raid_achieve)for(var win_i=0;win_i<User_Achieve_Info_list.event_raid_achieve.length;win_i++)User_Achieve_Info_list.event_raid_achieve[win_i].event_dungeon_period_idx==res.event_dungeon_period_idx&&(User_Achieve_Info_list.event_raid_achieve[win_i].accum_damage=res.accum_damage,User_Achieve_Info_list.event_raid_achieve[win_i].conquest_count=res.conquest_count);if("y"==res.die_yn){Instance.upd_UserGold(res.user_gold);for(i=0;i<res.bonus_items.length;i++){if((b=res.bonus_items[i]).bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX){(gnrl={}).gnrl_id=b.bonus_idx,gnrl.gnrl_num=b.bonus_num,gnrl.gnrl_level=b.bonus_level,gnrl.castle_id=b.castle_id,gnrl.used_in_camp="n",gnrl.using_in_camp="n";var gnrl_info=MasterManager.getInstance().get_General(gnrl.gnrl_id);gnrl_info.gnrl_type!=GENERAL_TYPE_YUNHEE&&gnrl_info.gnrl_type!=GENERAL_TYPE_LIMIT_OVER||gnrl_info.rare_type!=RARE_TYPE_SSR?gnrl.lock_yn="n":gnrl.lock_yn="y",this.insert_User_General(gnrl)}else b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7?this.plus_User_Hwandan(b.bonus_type,b.bonus_idx):b.bonus_type==BONUS_TYPE_LOVE_ITEM?this.plus_User_Love_Item(b.bonus_idx,b.bonus_num):b.bonus_type==BONUS_TYPE_HEART?this.plus_User_Heart(b.bonus_idx):b.bonus_type==BONUS_TYPE_JADE?this.plus_User_Jade(b.bonus_idx):b.bonus_type==BONUS_TYPE_GOLD||(b.bonus_type==BONUS_TYPE_KEY?this.plus_User_Key(b.bonus_idx):b.bonus_type==BONUS_TYPE_EVENT_POINT||(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE?this.plus_User_Love_Item(b.bonus_level,b.bonus_idx):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER?this.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE?this.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW&&this.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx)))}}Global_Raid_Boss_Info.event_raid_boss_info.event_raid_dungeon_idx=res.event_raid_dungeon_idx,Global_Raid_Boss_Info.event_raid_boss_info.boss_num=res.boss_num,Global_Raid_Boss_Info.event_raid_boss_info.remain_hp=res.remain_hp,Global_Raid_Boss_Info.event_raid_boss_info.die_yn=res.die_yn;for(var info_i=0;info_i<Global_Raid_Boss_Info.event_raid_boss_info.boss_damage.length;info_i++)Global_Raid_Boss_Info.event_raid_boss_info.boss_damage[info_i].multiple_type==res.multiple_type&&(Global_Raid_Boss_Info.event_raid_boss_info.boss_damage[info_i].damage=res.maxdamage),"y"==res.die_yn&&(Global_Raid_Boss_Info.event_raid_boss_info.boss_damage[info_i].damage=0);break;case"Res_Event_Raid_Dungeon_Battle_Lose":if(0<User_Achieve_Info_list.length&&null!=User_Achieve_Info_list.event_raid_achieve)for(var lose_i=0;lose_i<User_Achieve_Info_list.event_raid_achieve.length;lose_i++){(list=User_Achieve_Info_list.event_raid_achieve[lose_i]).event_dungeon_period_idx==res.event_dungeon_period_idx&&(list.accum_damage=res.accum_damage,list.conquest_count=res.conquest_count)}Global_Raid_Boss_Info.event_raid_boss_info.event_raid_dungeon_idx=res.event_raid_dungeon_idx,Global_Raid_Boss_Info.event_raid_boss_info.boss_num=res.boss_num,Global_Raid_Boss_Info.event_raid_boss_info.remain_hp=res.remain_hp,Global_Raid_Boss_Info.event_raid_boss_info.die_yn=res.die_yn;for(info_i=0;info_i<Global_Raid_Boss_Info.event_raid_boss_info.boss_damage.length;info_i++)Global_Raid_Boss_Info.event_raid_boss_info.boss_damage[info_i].multiple_type==res.multiple_type&&(Global_Raid_Boss_Info.event_raid_boss_info.boss_damage[info_i].damage=res.maxdamage),"y"==res.die_yn&&(Global_Raid_Boss_Info.event_raid_boss_info.boss_damage[info_i].damage=0);break;case"Res_Event_Raid_Dungeon_Boss_Info":Global_Raid_Boss_Info=res;break;case"Res_Event_Dungeon_Battle_Skip":var m=MasterManager.getInstance();service=UserService.getInstance();Instance.upd_User_Key(res.user_key),Instance.upd_UserSkipTicket(res.user_skip_ticket);period=m.get_EventDungeonPeriod(res.event_dungeon_period_idx);service.updateUserItemEventDungeonPoint(res.user_event_dungeon_point,res.user_event_dungeon_accum_point,period.event_dungeon_point_period_idx);var sp,sp_list,user_event_dungeon,user_data;is_new_mail=!1;if((sp={}).event_dungeon_period_idx=res.event_dungeon_period_idx,sp.event_dungeon_point_period_idx=m.get_EventDungeonPeriod(res.event_dungeon_period_idx).event_dungeon_point_period_idx,sp.point=res.user_special_point,sp.accum_point=res.user_accum_special_point,Instance.update_User_Event_Dungeon_Cutin_Accum_Rate_Point(period.event_dungeon_group_idx,res.cutin_rate),(sp_list=[]).push(sp),Instance.insert_User_Event_Dungeon_Special_Point(sp_list),Instance.upd_UserLevelExp(res.user_level,res.user_exp),Instance.upd_UserJade(res.user_jade),Instance.upd_UserGold(res.user_gold),Instance.upd_UserFormationPoint(res.user_formation_point),Instance.upd_UserHeart(res.user_heart),Instance.upd_UserItemRaidTicket(res.user_raid_ticket),Instance.upd_UserRaidHelpTicket(res.user_raid_help_ticket),USE_NEW_RAID_DUNGEON&&(Instance.upd_UserItemNewRaidCallTicket(res.user_new_raid_boss_call_key),Instance.upd_UserItemNewRaidConquestTicket(res.user_new_raid_boss_conquest_key)),null!=(user_event_dungeon=map_user_event_dungeon.at([m_user_id,res.event_dungeon_idx])))user_event_dungeon.win_count=res.win_count,user_event_dungeon.complete_yn="y",map_user_event_dungeon.insert([m_user_id,res.event_dungeon_idx],user_event_dungeon);else(user_data={}).user_id=m_user_id,user_data.event_dungeon_idx=res.event_dungeon_idx,user_data.challenge_count=res.challenge_count,user_data.win_count=res.win_count,user_data.complete_yn="y",map_user_event_dungeon.insert([m_user_id,res.event_dungeon_idx],user_data);for(idx=0;idx<res.bonus_items.length;idx++){if((b=res.bonus_items[idx]).bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX)(gnrl={}).gnrl_id=b.bonus_idx,gnrl.gnrl_num=b.bonus_num,gnrl.gnrl_level=b.bonus_level,gnrl.castle_id=b.castle_id,Instance.insert_User_General(gnrl);else if(b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7)Instance.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)Instance.plus_User_Love_Item(b.bonus_idx,b.bonus_num);else if(b.bonus_type==BONUS_TYPE_HEART);else if(b.bonus_type==BONUS_TYPE_JADE);else if(b.bonus_type==BONUS_TYPE_GOLD);else if(b.bonus_type==BONUS_TYPE_KEY);else if(b.bonus_type==BONUS_TYPE_RAID_TICKET);else if(b.bonus_type==BONUS_TYPE_EVENT_POINT);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE)Instance.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL)Instance.plus_User_Magic_Key_Mtrl(b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&b.bonus_type<=BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND){craft_shop_bonus_type=b.bonus_type-BONUS_TYPE_CRAFT_SHOP_FIRST_LOW+4;Instance.plus_User_Craft_Shop_Material(craft_shop_bonus_type,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){rebirth_mtrl_type=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(b.bonus_type);Instance.plus_User_Rebirth_Mtrl(rebirth_mtrl_type,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EQUIPMENT)Instance.insert_User_Equipment(b.equipment);else if(b.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||b.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL){limit_over_mtrl_type=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(b.bonus_type);Instance.plus_User_Limit_Over_Mtrl(limit_over_mtrl_type,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EVENT_DUNGEON_SPECIAL_POINT);else if(b.bonus_type==BONUS_TYPE_USER_EXP);else if(b.bonus_type>=BONUS_TYPE_CHRISTMAS_RIBBON&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_APPLE){craft_shop_bonus_type=GeneralService.getInstance().getBonusTypeToCraftShopMtrlType(b.bonus_type);Instance.plus_User_Craft_Shop_Material(craft_shop_bonus_type,b.bonus_idx)}else b.bonus_type>=BONUS_TYPE_CHRISTMAS_SANTA&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_SNOWMAN?Instance.update_User_Christmas_Reward(b.bonus_type,b.bonus_num,period.event_dungeon_group_idx):b.bonus_type==BONUS_TYPE_GREAT_WALL_TICKET?is_new_mail=!0:b.bonus_type!=BONUS_TYPE_RAID_TICKET&&b.bonus_type!=BONUS_TYPE_RAID_HELP_TICKET||(is_new_mail=!0)}is_new_mail||(is_new_mail="y"==res.new_mail_yn),GameContext.getInstance().setUserNewMail(is_new_mail?"y":"n"),Instance.upd_UserGeneralLevelExp(res.gnrl_exp);first_event_dungeon_period_idx=0,second_event_dungeon_period_idx=0;1==res.event_dungeon_period_idx%1e3?second_event_dungeon_period_idx=(first_event_dungeon_period_idx=res.event_dungeon_period_idx)+1:first_event_dungeon_period_idx=(second_event_dungeon_period_idx=res.event_dungeon_period_idx)-1;for(idx=0;idx<Instance._event_dungeon_open_period_info.event_dungeon_open_period.length;idx++){(period=Instance._event_dungeon_open_period_info.event_dungeon_open_period[idx]).event_dungeon_period_idx!=first_event_dungeon_period_idx&&period.event_dungeon_period_idx!=second_event_dungeon_period_idx||(period.event_dungeon_global_accum_point=res.total_global_event_point)}break;case"Res_Story_Dungeon_Battle_Skip":Instance.upd_User_Key(res.user_key),Instance.upd_UserSkipTicket(res.user_skip_ticket);for(idx=0;idx<res.drop_bonus_items.length;idx++){if((b=res.drop_bonus_items[idx]).bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX)(gnrl={}).gnrl_id=b.bonus_idx,gnrl.gnrl_num=b.bonus_num,gnrl.gnrl_level=b.bonus_level,gnrl.castle_id=b.castle_id,Instance.insert_User_General(gnrl);else if(b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7)Instance.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)Instance.plus_User_Love_Item(b.bonus_idx,1);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE)Instance.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_ATTK_POINT&&b.bonus_type<=BONUS_TYPE_CRI_DMG_POINT)Instance.plus_User_Formation_Property_Point(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){rebirth_mtrl_type=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(b.bonus_type);Instance.plus_User_Rebirth_Mtrl(rebirth_mtrl_type,b.bonus_idx)}else b.bonus_type,BONUS_TYPE_GOLD}for(var count=0,cnt_user_mission_length=map_user_main_mission.length,uidx=0;uidx<cnt_user_mission_length;uidx++)map_user_main_mission[uidx].main_mission_id==res.mission_id&&(count+=1);if(0!=count){var data={main_mission_id:res.mission_id,new_yn:"n",complete_yn:"y",win_count:res.win_count};map_user_main_mission.push($.extend({},data)),data=null}else{data={main_mission_id:res.mission_id,new_yn:"n",complete_yn:"y",win_count:0};map_user_main_mission.push($.extend({},data)),data=null}Instance.upd_UserLevelExp(res.user_level,res.user_exp),Instance.upd_UserGold(res.user_gold),Instance.upd_UserHeart(res.user_heart),Instance.upd_UserFormationPoint(res.user_formation_point),Instance.upd_UserGeneralLevelExp(res.gnrl_exp),"y"==res.is_user_level_up&&(Instance.update_max_user_key_bound(res.user_level,res.user_raid_ticket),Instance.upd_UserItemRaidTicket(res.user_raid_ticket),Instance.upd_UserRaidHelpTicket(res.user_raid_help_ticket),USE_NEW_RAID_DUNGEON&&(Instance.upd_UserItemNewRaidCallTicket(res.user_new_raid_boss_call_key),Instance.upd_UserItemNewRaidConquestTicket(res.user_new_raid_boss_conquest_key)));break;case"Res_Event_Raid_Box_Gacha_Info":User_Box_Gacha_List=res;break;case"Res_Get_Step_Up_Gacha_Buy_Log":_step_up_gacha_buy_log=res;break;case"Res_Get_One_User_One_Time_Free_Gacha_Buy_Log":_oneuser_onetime_free_gacha_buy_log=res;break;case"Res_One_User_One_Time_Free_Gacha_Buy":Instance.new_User_General(res.new_user_generals);for(found=!1,i=0;i<_oneuser_onetime_free_gacha_buy_log.buy_log.length;i++){if((log=_oneuser_onetime_free_gacha_buy_log.buy_log[i]).shop_id==res.buy_log.shop_id&&log.one_user_one_time_free_gacha_idx==res.buy_log.one_user_one_time_free_gacha_idx){found=!0;break}}1==found&&_oneuser_onetime_free_gacha_buy_log.buy_log.push(res.buy_log);break;case"Res_Get_One_Day_One_Time_Free_Gacha_Buy_Log":_oneday_onetime_free_gacha_buy_log=res;break;case"Res_One_Day_One_Time_Free_Gacha_Buy":Instance.new_User_General(res.new_user_generals);for(found=!1,i=0;i<_oneday_onetime_free_gacha_buy_log.buy_log.length;i++){if((log=_oneday_onetime_free_gacha_buy_log.buy_log[i]).shop_id==res.buy_log.shop_id&&log.one_day_one_time_free_gacha_idx==res.buy_log.one_day_one_time_free_gacha_idx&&log.buy_num==res.buy_log.buy_num){found=!0;break}}1==found&&_oneday_onetime_free_gacha_buy_log.buy_log.push(res.buy_log);break;case"Res_User_Event_Dungeon_Panel_Gacha_Box_Info":_event_panel_gacha_box_info=res;break;case"Res_User_Event_Dungeon_Panel_Gacha_Box_Pan_Info":_event_panel_gacha_box_pan_info=res;break;case"Res_User_Event_Dungeon_Panel_Gacha_Pan_Buy":_event_panel_gacha_box_pan_buy=res,(b={panel_pan_idx:0,reward_idx:0}).panel_pan_idx=res.panel_pan_idx,b.reward_idx=res.event_dungeon_panel_gacha_pan_buy_log[0].panel_pan_idx,_event_panel_gacha_box_pan_info.event_dungeon_panel_gacha_pan_info.push(b);break;case"Res_User_Event_Dungeon_Panel_Gacha_Next_Box":_event_panel_gacha_next_box=res,_event_panel_gacha_box_pan_info.event_dungeon_panel_gacha_box_idx=res.panel_box_idx,_event_panel_gacha_box_pan_info.event_dungeon_panel_gacha_pan_info=[];break;case"Res_Event_Vote_League_Group_Info_V3":_event_vote_league_group_info_v3=res;break;case"Res_User_Event_Dungeon_Vote_V3":_user_event_dungeon_vote_v3=res;break;case"Res_Global_Event_Dungeon_Vote_V3":_global_event_dungeon_vote_v3=res;break;case"Res_User_Event_Dungeon_Vote_Reward_Info_V3":_user_event_vote_reward_all_info_v3=res;break;case"Res_User_Event_Dungeon_Vote_Reward_V3":case"Res_User_Event_Dungeon_Vote_Reward_All_V3":found=!1;var found_i=0;for(i=0;i<_user_event_vote_reward_all_info_v3.vote_reward_info_list.length;i++){if((log=_user_event_vote_reward_all_info_v3.vote_reward_info_list[i]).event_dungeon_period_idx==res.event_dungeon_period_idx){found=!0,found_i=i;break}}1==found&&(_user_event_vote_reward_all_info_v3.vote_reward_info_list[found_i].reward_list=res.vote_reward_info);break;case"Res_New_Raid_Boss_Sign_Up":if(0<_new_raid_boss_sign_up.user_new_raid_boss_sign_up_list)if(-1!=(found=_new_raid_boss_sign_up.user_new_raid_boss_sign_up_list.findIndex(function(s){return s.new_raid_boss_period_idx==res.new_raid_boss_period_idx})))_new_raid_boss_sign_up.user_new_raid_boss_sign_up_list[found].is_sign_up=res.is_sign_up;else{var sign={};sign.new_raid_boss_period_idx=res.new_raid_boss_period_idx,sign.is_sign_up=res.is_sign_up,_new_raid_boss_sign_up.user_new_raid_boss_sign_up_list.push_back(sign)}break;case"Res_New_Raid_Boss_Call":if(-1!=(found_dungeon_list=_new_raid_boss_dungeon_list.findIndex(function(d){return 1==d.request_type})))_new_raid_boss_dungeon_list[found_dungeon_list].user_new_raid_boss_list.push_back(res.user_new_raid_boss);else(list={request_type:1}).new_raid_boss_period_idx=res.new_raid_boss_period_idx,list.user_new_raid_boss_list=[],list.user_new_raid_boss_list.push_back(res.user_new_raid_boss),_new_raid_boss_dungeon_list.push_back(list);Instance.updateNewRaidBossKey(res.cost_bonus_type,res.user_goods,res.user_goods_elapsed);break;case"Res_New_Raid_Boss_Dungeon_List":-1!=(found_dungeon_list=_new_raid_boss_dungeon_list.findIndex(function(d){return d.request_type==res.request_type&&d.new_raid_boss_period_idx==res.new_raid_boss_period_idx}))&&_new_raid_boss_dungeon_list.splice(found_dungeon_list,1),_new_raid_boss_dungeon_list.push_back(res);break;case"Res_New_Raid_Boss_Dungeon_Battle_Begin":var is_exist_dungeon=!1;if(-1!=(partin_dungeon_list=_new_raid_boss_dungeon_list.findIndex(function(d){return 1==d.request_type&&d.new_raid_boss_period_idx==res.new_raid_boss_period_idx})))if(-1!=(dungeon=_new_raid_boss_dungeon_list[partin_dungeon_list].user_new_raid_boss_list.findIndex(function(d){return d.discovered_user_id==res.discovered_user_id&&d.new_raid_boss_period_idx==res.new_raid_boss_period_idx&&d.new_raid_boss_dungeon_info_idx==res.new_raid_boss_dungeon_info_idx&&d.boss_num==res.boss_num}))){is_exist_dungeon=!0,_new_raid_boss_dungeon_list[partin_dungeon_list].user_new_raid_boss_list[dungeon].boss_data_list=[];for(var idx_dungeon=0;idx_dungeon<res.boss_data_list.length;idx_dungeon++)_new_raid_boss_dungeon_list[partin_dungeon_list].user_new_raid_boss_list[dungeon].boss_data_list.push(res.boss_data_list[idx_dungeon])}if(!is_exist_dungeon){var help_dungeon_list=_new_raid_boss_dungeon_list.findIndex(function(d){return 2==d.request_type&&d.new_raid_boss_period_idx==res.new_raid_boss_period_idx});if(-1!=help_dungeon_list)-1!=(dungeon=_new_raid_boss_dungeon_list[help_dungeon_list].user_new_raid_boss_list.findIndex(function(d){return d.discovered_user_id==res.discovered_user_id&&d.new_raid_boss_period_idx==res.new_raid_boss_period_idx&&d.new_raid_boss_dungeon_info_idx==res.new_raid_boss_dungeon_info_idx&&d.boss_num==res.boss_num}))&&_new_raid_boss_dungeon_list[partin_dungeon_list].user_new_raid_boss_list.push_back(_new_raid_boss_dungeon_list[help_dungeon_list].user_new_raid_boss_list[dungeon])}break;case"Res_New_Raid_Boss_Dungeon_Battle_Result":var partin_dungeon_list=_new_raid_boss_dungeon_list.findIndex(function(d){return 1==d.request_type&&d.new_raid_boss_period_idx==res.new_raid_boss_period_idx}),history_dungeon_list=_new_raid_boss_dungeon_list.findIndex(function(d){return 4==d.request_type&&d.new_raid_boss_period_idx==res.new_raid_boss_period_idx});if(-1!=partin_dungeon_list)if(-1!=(dungeon=_new_raid_boss_dungeon_list[partin_dungeon_list].user_new_raid_boss_list.findIndex(function(d){return d.discovered_user_id==res.discovered_user_id&&d.new_raid_boss_period_idx==res.new_raid_boss_period_idx&&d.new_raid_boss_dungeon_info_idx==res.new_raid_boss_dungeon_info_idx&&d.boss_num==res.boss_num}))){_new_raid_boss_dungeon_list[partin_dungeon_list].user_new_raid_boss_list[dungeon].boss_data_list=[];for(idx_dungeon=0;idx_dungeon<res.boss_data_list.length;idx_dungeon++)_new_raid_boss_dungeon_list[partin_dungeon_list].user_new_raid_boss_list[dungeon].boss_data_list.push(res.boss_data_list[idx_dungeon]);if(_new_raid_boss_dungeon_list[partin_dungeon_list].user_new_raid_boss_list[dungeon].boss_activity_type=res.result_boss_activity_type,0!=res.result_boss_activity_type){var clone_dungeon=_new_raid_boss_dungeon_list[partin_dungeon_list].user_new_raid_boss_list[dungeon];if(_new_raid_boss_dungeon_list[partin_dungeon_list].user_new_raid_boss_list.splice(dungeon,1),-1!=history_dungeon_list)_new_raid_boss_dungeon_list[history_dungeon_list].user_new_raid_boss_list.push_back($.extend({},clone_dungeon));else(data={request_type:4}).new_raid_boss_period_idx=res.new_raid_boss_period_idx,data.user_new_raid_boss_list=[],data.user_new_raid_boss_list.push_back($.extend({},clone_dungeon)),_new_raid_boss_dungeon_list.push_back($.extend({},data))}}for(i=0;i<res.reward_items.length;i++)res.reward_items[i].bonus_type==BONUS_TYPE_NEW_EQUIPMENT_ITEM?Instance.plus_Bonus_Type_Items(res.reward_items[i].bonus_type,res.reward_items[i].bonus_idx,res.reward_items[i].bonus_num):res.reward_items[i].bonus_type==BONUS_TYPE_YUNHEE_FIX?Instance.plus_Bonus_Type_Items(res.reward_items[i].bonus_type,res.reward_items[i].bonus_idx,res.reward_items[i].bonus_num):Instance.plus_Bonus_Type_Items(res.reward_items[i].bonus_type,res.reward_items[i].bonus_idx,res.reward_items[i].bonus_level);Instance.clearBattleDungeonContinue();break;case"Res_New_Raid_Boss_Dungeon_Retreat":if(-1!=(found_dungeon_list=_new_raid_boss_dungeon_list.findIndex(function(d){return 1==d.request_type&&d.new_raid_boss_period_idx==res.new_raid_boss_period_idx})))-1!=(dungeon=_new_raid_boss_dungeon_list[found_dungeon_list].user_new_raid_boss_list.findIndex(function(d){return m_user_id==d.discovered_user_id&&d.new_raid_boss_period_idx==res.new_raid_boss_period_idx&&d.new_raid_boss_dungeon_info_idx==res.new_raid_boss_dungeon_info_idx&&d.boss_num==res.boss_num}))&&_new_raid_boss_dungeon_list[found_dungeon_list].user_new_raid_boss_list.splice(dungeon,1);break;case"Res_New_Raid_Boss_Shop_Buy_Point_Item":var log_list=_new_raid_boss_shop_buy_log_list.findIndex(function(log){return log.new_raid_boss_shop_period_idx==res.new_raid_boss_shop_period_idx});if(-1!=log_list)for(idx=0;idx<res.buy_items.length;idx++){var item=res.buy_items.at(idx);if(-1!=(log=_new_raid_boss_shop_buy_log_list[log_list].user_shop_buy_log.findIndex(function(l){return l.new_raid_boss_shop_period_idx==res.new_raid_boss_shop_period_idx&&l.new_raid_boss_point_shop_item_idx==res.new_raid_boss_point_shop_item_idx})))_new_raid_boss_shop_buy_log_list[log_list].user_shop_buy_log[log].buy_count+=res.buy_count;else(data={}).new_raid_boss_shop_period_idx=res.new_raid_boss_shop_period_idx,data.new_raid_boss_point_shop_item_idx=res.new_raid_boss_point_shop_item_idx,data.bonus_type=item.bonus_type,data.sub_id=item.bonus_idx,data.buy_count=res.buy_count,_new_raid_boss_shop_buy_log_list[log_list].user_shop_buy_log.push_back(data)}else(log={}).new_raid_boss_shop_period_idx=res.new_raid_boss_shop_period_idx,log.user_shop_buy_log=[],(data={}).new_raid_boss_shop_period_idx=res.new_raid_boss_shop_period_idx,data.new_raid_boss_point_shop_item_idx=res.new_raid_boss_point_shop_item_idx,data.buy_count=res.buy_count,data.bonus_type=res.buy_items.at(0).bonus_type,data.sub_id=res.buy_items.at(0).bonus_idx,log.user_shop_buy_log.push_back(data),_new_raid_boss_shop_buy_log_list.push_back(log);Instance.updateNewRaidBossPoint(res.new_raid_boss_point.new_raid_boss_period_idx,res.new_raid_boss_point.point);for(idx=0;idx<res.buy_items.length;idx++)res.buy_items[idx].bonus_type==BONUS_TYPE_NEW_EQUIPMENT_ITEM?Instance.plus_Bonus_Type_Items(res.buy_items[idx].bonus_type,res.buy_items[idx].bonus_idx,res.buy_items[idx].bonus_num):res.buy_items[idx].bonus_type==BONUS_TYPE_YUNHEE_FIX?Instance.plus_Bonus_Type_Items(res.buy_items[idx].bonus_type,res.buy_items[idx].bonus_idx,res.buy_items[idx].bonus_num):Instance.plus_Bonus_Type_Items(res.buy_items[idx].bonus_type,res.buy_items[idx].bonus_idx,res.buy_items[idx].bonus_level);break;case"Res_New_Raid_Boss_Dungeon_Help":var found_dungeon_list;if(-1!=(found_dungeon_list=_new_raid_boss_dungeon_list.findIndex(function(d){return 1==d.request_type&&d.new_raid_boss_period_idx==res.new_raid_boss_period_idx})))-1!=(dungeon=_new_raid_boss_dungeon_list[found_dungeon_list].user_new_raid_boss_list.findIndex(function(d){return d.discovered_user_id==m_user_id&&d.new_raid_boss_period_idx==res.new_raid_boss_period_idx&&d.new_raid_boss_dungeon_info_idx==res.new_raid_boss_dungeon_info_idx&&d.boss_num==res.boss_num}.bind(this)))&&(_new_raid_boss_dungeon_list[found_dungeon_list].user_new_raid_boss_list[dungeon].shared_type=res.shared_type);break;case"Res_New_Raid_Boss_Battle_Check":var dungeon_list=_new_raid_boss_dungeon_list.findIndex(function(d){return 1==d.request_type&&d.new_raid_boss_period_idx==res.new_raid_boss_period_idx});if(-1!=dungeon_list)if(-1!=(dungeon=_new_raid_boss_dungeon_list[dungeon_list].user_new_raid_boss_list.findIndex(function(du){return du.new_raid_boss_period_idx==res.new_raid_boss_period_idx&&du.new_raid_boss_dungeon_info_idx==res.new_raid_boss_dungeon_info_idx&&du.boss_num==res.boss_num&&du.discovered_user_id==res.discovered_user_id})))"y"==res.battle_continue_clear_yn&&_new_raid_boss_dungeon_list[dungeon_list].user_new_raid_boss_list.splice(dungeon,1);else{(data={}).discovered_user_id=res.discovered_user_id,data.new_raid_boss_period_idx=res.new_raid_boss_period_idx,data.new_raid_boss_dungeon_info_idx=res.new_raid_boss_dungeon_info_idx,data.boss_num=res.boss_num,data.discovered_nickname=res.discovered_nickname,data.difficult=res.difficult,data.friend_yn=res.friend_yn,data.max_partner_count=res.max_partner_count,data.partner_count=res.partner_count,data.retreat_dt=res.retreat_dt,data.shared_type=res.share_type,data.boss_activity_type=res.boss_activity_type,data.boss_data_list=[];for(var assign_idx=0;assign_idx<res.boss_data_list.length;assign_idx++)data.boss_data_list.push(res.boss_data_list[assign_idx]);data.need_reward_get_yn="n",_new_raid_boss_dungeon_list[dungeon_list].user_new_raid_boss_list.push($.extend({},data))}else if("n"==res.battle_continue_clear_yn){(data={request_type:1}).new_raid_boss_period_idx=res.new_raid_boss_period_idx,data.user_new_raid_boss_list=[],(dungeon={}).discovered_user_id=res.discovered_user_id,dungeon.new_raid_boss_period_idx=res.new_raid_boss_period_idx,dungeon.new_raid_boss_dungeon_info_idx=res.new_raid_boss_dungeon_info_idx,dungeon.boss_num=res.boss_num,dungeon.discovered_nickname=res.discovered_nickname,dungeon.difficult=res.difficult,dungeon.friend_yn=res.friend_yn,dungeon.max_partner_count=res.max_partner_count,dungeon.partner_count=res.partner_count,dungeon.retreat_dt=res.retreat_dt,dungeon.shared_type=res.share_type,dungeon.boss_activity_type=res.boss_activity_type,dungeon.boss_data_list=[];for(assign_idx=0;assign_idx<res.boss_data_list.length;assign_idx++)dungeon.boss_data_list.push(res.boss_data_list[assign_idx]);dungeon.need_reward_get_yn="n",data.user_new_raid_boss_list.push(dungeon),_new_raid_boss_dungeon_list.push(data)}Instance.updateNewRaidBossKey(BONUS_TYPE_NEW_RAID_BOSS_BATTLE_KEY,res.user_conquest_ticket,res.user_conquest_ticket_elapsed);break;case"Res_New_Raid_Boss_Partner_User_List":_new_raid_boss_partner_user_list=res;break;case"Res_New_Raid_Boss_Conquest_Reward":var reward_dungeon_list=_new_raid_boss_dungeon_list.findIndex(function(d){return 3==d.request_type&&d.new_raid_boss_period_idx==res.new_raid_boss_period_idx});history_dungeon_list=_new_raid_boss_dungeon_list.findIndex(function(d){return 4==d.request_type&&d.new_raid_boss_period_idx==res.new_raid_boss_period_idx});if(-1!=reward_dungeon_list)for(idx=0;idx<res.dungeon_list.length;idx++){var dungeon;if(-1!=(dungeon=_new_raid_boss_dungeon_list[reward_dungeon_list].user_new_raid_boss_list.findIndex(function(du){return du.new_raid_boss_period_idx==res.dungeon_list[idx].new_raid_boss_period_idx&&du.new_raid_boss_dungeon_info_idx==res.dungeon_list[idx].new_raid_boss_dungeon_info_idx&&du.boss_num==res.dungeon_list[idx].boss_num&&du.discovered_user_id==res.dungeon_list[idx].discovered_user_id})))if(_new_raid_boss_dungeon_list[reward_dungeon_list].user_new_raid_boss_list.splice(dungeon,1),-1!=history_dungeon_list)_new_raid_boss_dungeon_list[history_dungeon_list].user_new_raid_boss_list.push_back(_new_raid_boss_dungeon_list[reward_dungeon_list].user_new_raid_boss_list[dungeon]);else(data={request_type:4}).new_raid_boss_period_idx=res.new_raid_boss_period_idx,data.user_new_raid_boss_list.push_back(_new_raid_boss_dungeon_list[reward_dungeon_list].user_new_raid_boss_list[dungeon]),_new_raid_boss_dungeon_list.push_back(data)}for(i=0;i<res.reward_items.length;i++)res.reward_items[i].bonus_type==BONUS_TYPE_NEW_EQUIPMENT_ITEM?Instance.plus_Bonus_Type_Items(res.reward_items[i].bonus_type,res.reward_items[i].bonus_idx,res.reward_items[i].bonus_num):res.reward_items[i].bonus_type==BONUS_TYPE_YUNHEE_FIX?Instance.plus_Bonus_Type_Items(res.reward_items[i].bonus_type,res.reward_items[i].bonus_idx,res.reward_items[i].bonus_num):Instance.plus_Bonus_Type_Items(res.reward_items[i].bonus_type,res.reward_items[i].bonus_idx,res.reward_items[i].bonus_level);break;case"Res_Get_New_Raid_Boss_Sign_Up":(_new_raid_boss_sign_up=res).user_new_raid_boss_data_list[0];var user_new_raid_boss_help_list=res.user_new_raid_boss_data_list[0].user_new_raid_boss_help_list,user_new_raid_boss_partin_list=res.user_new_raid_boss_data_list[0].user_new_raid_boss_partin_list;if(0<user_new_raid_boss_help_list.length&&null!=user_new_raid_boss_help_list){var list;(list={request_type:2}).new_raid_boss_period_idx=user_new_raid_boss_help_list[0].new_raid_boss_period_idx;for(var id=0;id<user_new_raid_boss_help_list.length;id++)list.user_new_raid_boss_list=[],list.user_new_raid_boss_list.push_back(user_new_raid_boss_help_list[id]);_new_raid_boss_dungeon_list.push_back($.extend({},list)),list=null}if(0<user_new_raid_boss_partin_list.length&&null!=user_new_raid_boss_partin_list){var list2={request_type:1};for(list2.new_raid_boss_period_idx=user_new_raid_boss_partin_list[0].new_raid_boss_period_idx,id=0;id<user_new_raid_boss_partin_list.length;id++)list2.user_new_raid_boss_list=[],list2.user_new_raid_boss_list.push_back(user_new_raid_boss_partin_list[id]);_new_raid_boss_dungeon_list.push_back($.extend({},list2)),list2=null}break;case"Res_Get_New_Raid_Boss_Point":_new_raid_boss_point=res;break;case"Res_New_Raid_Boss_Shop_Buy_Log":var log;if(-1!=(found=_new_raid_boss_shop_buy_log_list.findIndex(function(log){return res.new_raid_boss_shop_period_idx==log.new_raid_boss_shop_period_idx})))_new_raid_boss_shop_buy_log_list.splice(found,1),(log={}).new_raid_boss_shop_period_idx=res.new_raid_boss_shop_period_idx,log.user_shop_buy_log=[],Array.isArray(res.user_shop_buy_log)&&(log.user_shop_buy_log=res.user_shop_buy_log),_new_raid_boss_shop_buy_log_list.push_back(log);else(log={}).new_raid_boss_shop_period_idx=res.new_raid_boss_shop_period_idx,log.user_shop_buy_log=[],Array.isArray(res.user_shop_buy_log)&&(log.user_shop_buy_log=res.user_shop_buy_log),_new_raid_boss_shop_buy_log_list.push_back(log);break;case"Res_Get_Shop_Purchase_Jade_Log":Instance.upd_UserJade(res.user_jade),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);break;case"Res_User_Event_Dungeon_Vote_Gnrl_V3":_user_event_dungeon_vote_gnrl_v3=res,(service=UserService.getInstance()).updateUserItemEventDungeonPoint(res.user_event_point,res.user_accum_event_point,res.event_dungeon_period_idx);break;case"Res_Special_Ticket_Gacha_Buy":Instance.new_User_General(res.new_user_generals),Instance.update_User_Gacha_Count(res.user_gacha_buy_count),(data={}).special_ticket_gacha_idx=res.special_ticket_gacha_idx,data.ticket_cnt=res.user_special_gacha_ticket,Instance.update_User_Special_Gacha_Ticket(data);break;case"Res_Get_Exchange_Ticket_Buy_Log":_exchange_ticket_buy_log=res;break;case"Res_Exchange_Ticket_Buy":Instance.new_User_General(res.new_user_generals),Instance.upd_UserExchangeTicket(res.exchange_ticket_count);for(i=0;i<res.buy_log.length;i++){found=!1,index=0;if(null!=_exchange_ticket_buy_log&&null!=_exchange_ticket_buy_log&&null!=_exchange_ticket_buy_log.buy_log&&0<_exchange_ticket_buy_log.buy_log.length)for(j=0;j<_exchange_ticket_buy_log.buy_log.length;j++)if(_exchange_ticket_buy_log.buy_log[j].shop_id==res.buy_log[i].shop_id&&_exchange_ticket_buy_log.buy_log[j].exchange_ticket_info_idx==res.buy_log[i].exchange_ticket_info_idx){found=!0,index=j;break}found?(_exchange_ticket_buy_log.buy_log[index].buy_count=res.buy_log[i].buy_count,_exchange_ticket_buy_log.buy_log[index].buy_enable_yn=res.buy_log[i].buy_enable_yn):_exchange_ticket_buy_log.buy_log.push(res.buy_log[i])}break;case"Res_Step_Up_Gacha_Dmm_Point_Buy_Complete":if(Instance.new_User_General(res.new_user_generals),Instance.update_User_Gacha_Count(res.user_gacha_buy_count),0<res.user_step_up_buy_log.length){found=!1;var index_log=0;for(idx=0;idx<_step_up_gacha_buy_log.step_up_buy_log.length;idx++){if((info=_step_up_gacha_buy_log.step_up_buy_log[idx]).shop_id==res.shop_id&&info.step_up_gacha_idx==res.step_up_gacha_idx){found=!0,index_log=idx;break}}if(found)_step_up_gacha_buy_log.step_up_buy_log[index_log].buy_log=[],_step_up_gacha_buy_log.step_up_buy_log[index_log].reset_count=res.reset_count,_step_up_gacha_buy_log.step_up_buy_log[index_log].buy_log=res.user_step_up_buy_log;else(info={}).shop_id=res.shop_id,info.step_up_gacha_idx=res.step_up_gacha_idx,info.reset_count=res.reset_count,info.buy_log=res.user_step_up_buy_log,_step_up_gacha_buy_log.step_up_buy_log.push(info)}else{for(found=!1,index_log=0,idx=0;idx<_step_up_gacha_buy_log.step_up_buy_log.length;idx++){if((info=_step_up_gacha_buy_log.step_up_buy_log[idx]).shop_id==res.shop_id&&info.step_up_gacha_idx==res.step_up_gacha_idx){found=!0,index_log=idx;break}}if(found)_step_up_gacha_buy_log.step_up_buy_log[index_log].buy_log=[],_step_up_gacha_buy_log.step_up_buy_log[index_log].reset_count=res.reset_count;else(info={}).shop_id=res.shop_id,info.step_up_gacha_idx=res.step_up_gacha_idx,info.reset_count=res.reset_count,_step_up_gacha_buy_log.step_up_buy_log.push(info)}break;case"Res_Step_Up_Gacha_Dmm_Point_Buy_Payment_Info":case"Res_Step_Up_Gacha_Dmm_Point_Buy_Omission":break;case"Res_Step_Up_Gacha_Jade_Buy":Instance.new_User_General(res.new_user_generals),Instance.upd_User_Item(res);for(j=0;j<res.new_user_generals.length;j++)"y"==res.new_user_generals[j].is_new_yn&&this.new_User_Books_General(m_user_id,res.new_user_generals[j].gnrl_id);if(Instance.upd_User_Gacha_Count(res.user_gacha_buy_count),0<_step_up_gacha_buy_log.step_up_buy_log.length){for(found=!1,index_log=0,idx=0;idx<_step_up_gacha_buy_log.step_up_buy_log.length;idx++){if((info=_step_up_gacha_buy_log.step_up_buy_log[idx]).shop_id==res.shop_id&&info.step_up_gacha_idx==res.step_up_gacha_idx){found=!0,index_log=idx;break}}if(found)_step_up_gacha_buy_log.step_up_buy_log[index_log].buy_log=[],_step_up_gacha_buy_log.step_up_buy_log[index_log].reset_count=res.reset_count,_step_up_gacha_buy_log.step_up_buy_log[index_log].buy_log=res.user_step_up_buy_log;else(info={}).shop_id=res.shop_id,info.step_up_gacha_idx=res.step_up_gacha_idx,info.reset_count=res.reset_count,info.buy_log=res.user_step_up_buy_log,_step_up_gacha_buy_log.step_up_buy_log.push(info)}else{for(found=!1,index_log=0,idx=0;idx<_step_up_gacha_buy_log.step_up_buy_log.length;idx++){if((info=_step_up_gacha_buy_log.step_up_buy_log[idx]).shop_id==res.shop_id&&info.step_up_gacha_idx==res.step_up_gacha_idx){found=!0,index_log=idx;break}}if(found)_step_up_gacha_buy_log.step_up_buy_log[index_log].buy_log=[],_step_up_gacha_buy_log.step_up_buy_log[index_log].reset_count=res.reset_count;else(info={}).shop_id=res.shop_id,info.step_up_gacha_idx=res.step_up_gacha_idx,info.reset_count=res.reset_count,info.buy_log=res.user_step_up_buy_log,_step_up_gacha_buy_log.step_up_buy_log.push(info)}MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);break;case"Res_Weekly_Dungeon_Battle_Skip":Instance.upd_User_Key(res.user_key),Instance.upd_UserSkipTicket(res.user_skip_ticket);for(idx=0;idx<res.bonus_items.length;idx++){var gnrl;if((b=res.bonus_items[idx]).bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX)(gnrl={}).gnrl_id=b.bonus_idx,gnrl.gnrl_num=b.bonus_num,gnrl.gnrl_level=b.bonus_level,gnrl.castle_id=b.castle_id,Instance.insert_User_General(gnrl);else if(b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7)Instance.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)Instance.plus_User_Love_Item(b.bonus_idx,b.bonus_num);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE)Instance.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_ATTK_POINT&&b.bonus_type<=BONUS_TYPE_CRI_DMG_POINT)Instance.plus_User_Formation_Property_Point(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_YUNHEE_PT)Instance.plus_User_Yunhee_PT(b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_EVOLVE_ORB)Instance.plus_User_Evolve_Orb(b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_GOLD);else if(b.bonus_type==BONUS_TYPE_JADE);else if(b.bonus_type==BONUS_TYPE_HEART);else if(b.bonus_type==BONUS_TYPE_USER_EXP);else if(b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){rebirth_mtrl_type=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(b.bonus_type);Instance.plus_User_Rebirth_Mtrl(rebirth_mtrl_type,b.bonus_idx)}}Instance.upd_UserLevelExp(res.user_level,res.user_exp),Instance.upd_UserJade(res.user_jade),Instance.upd_UserGold(res.user_gold),Instance.upd_UserFormationPoint(res.user_formation_point),Instance.upd_UserHeart(res.user_heart),Instance.upd_UserItemRaidTicket(res.user_raid_ticket),Instance.upd_UserRaidHelpTicket(res.user_raid_help_ticket),USE_NEW_RAID_DUNGEON&&(Instance.upd_UserItemNewRaidCallTicket(res.user_new_raid_boss_call_key),Instance.upd_UserItemNewRaidConquestTicket(res.user_new_raid_boss_conquest_key));break;case"Res_Open_Event_Dungeon_Box_Gacha":var box_gacha_info={};if(box_gacha_info.box_gacha_info_idx=res.box_gacha_info_idx,box_gacha_info.event_dungeon_period_idx=res.event_dungeon_period_idx,box_gacha_info.item_idx=res.item_idx,box_gacha_info.item_num=res.item_num,box_gacha_info.random_bonus_type=res.random_bonus_type,box_gacha_info.random_bonus_item_idx=res.random_item_idx,box_gacha_info.random_bonus_count=res.random_bonus_count,box_gacha_info.init_count=res.init_count,-1!=(found=list_User_Box_Gacha_Info.findIndex(function(m){return res.box_gacha_info_idx==m.box_gacha_info_idx&&res.init_count==m.init_count&&res.item_num==m.item_num}))||list_User_Box_Gacha_Info.push_back(box_gacha_info),0!=res.random_bonus_type){var barrel_info={};barrel_info.bonus_type=res.random_bonus_type,barrel_info.item_idx=res.random_item_idx,barrel_info.item_count=res.random_bonus_count,barrel_info.box_gacha_info_idx=res.box_gacha_info_idx,list_User_Box_Gacha_Golden_Barrel_Info.push_back(barrel_info)}Instance.update_User_Event_Dungeon_Point(res.event_dungeon_point);break;case"Res_Great_Wall_Troops_Recovery":break;case"Res_Great_Wall_Dungeon_Battle_Begin":Instance.update_Great_Wall_Dungeon_Battle_Begin(res);break;case"Res_Great_Wall_Dungeon_Battle_Win":Instance.update_Great_Wall_Dungeon_Battle_Win(res);break;case"Res_Great_Wall_Dungeon_Battle_Lose":Instance.update_Great_Wall_Dungeon_Battle_Lose(res);break;case"Res_Great_Wall_Dungeon_Continue_Check":Instance.update_Great_Wall_Dungeon_Battle_Check(res);break;case"Req_Get_Server_Time_Check":cc.log("Check get_server_time_check service"),(new GameDate).resetServerTime(res.server_time),TimeEventEngine.getInstance().setTime(TIME_EVENT_SERVER_TIME,1e3*res.server_time),0<NetService().get_list_User_Mail().size()?GameContext.getInstance().setUserNewMail("y"):"y"<res.raid_boss_reward_mail_yn&&GameContext.getInstance().setUserNewMail("y"),MainObserver.getInstance().postNotification(NOTIFICATION_NEW_MAIL,message_new_mail),MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],message_new_raid_boss);break;case"Res_Get_User_Mussang_Tower_Info":Instance.delete_User_Mussang_Tower(),Instance.insert_User_Mussang_Tower(res.user_mussang_towers),Instance.delete_User_Mussang_Tower_Task(),Instance.insert_User_Mussang_Tower_Task(res.user_mussang_tower_tasks),Instance.delete_User_Mussang_Tower_Lotus_Log(),Instance.insert_User_Mussang_Tower_Lotus_Log(res.user_mussang_tower_lotus_logs);break;case"Res_User_Mussang_Tower_Recv_Lotus_Reward":var lotus_log=m_user_mussang_tower_lotus_log.at([m_user_id,res.period_idx,res.lotus_count]);lotus_log.complete_yn=res.complete_yn,lotus_log.new_yn="n";break;case"Res_Get_User_Rebirth_Mtrl_Info":Instance.delete_User_Rebirth_Mtrl(),Instance.insert_User_Rebirth_Mtrl(res.rebirth_mtrl_info);break;case"Res_Get_User_Naming_Info":Instance.delete_User_Naming_Info(),Instance.insert_User_Naming_Info(res.naming_list);break;case"Res_Set_User_Naming":var user_info=Instance.get_User_info();(data={}).user_id=user_info.user_id,data.nickname=user_info.nickname,data.state_type=user_info.state_type,data.user_level=user_info.user_level,data.user_exp=user_info.user_exp,data.join_bonus_cmplt_yn=user_info.join_bonus_cmplt_yn,data.naming=res.naming,Instance.insert_User_info(data);break;case"Res_Get_User_Event_Dungeon_Growth_Info":m_Res_Get_User_Event_Dungeon_Growth_Info=res;break;case"Res_Event_Dungeon_Growth_Level_Up":Instance.update_User_Event_Dungeon_Special_Point(res.event_dungeon_special_point),m_Res_Get_User_Event_Dungeon_Growth_Info.growth_level=res.growth_level,m_Res_Get_User_Event_Dungeon_Growth_Info.level_point=res.level_point,m_Res_Get_User_Event_Dungeon_Growth_Info.first_growth_yn=0;break;case"Res_Event_Dungeon_Point_Reward_Shop":(service=UserService.getInstance()).updateUserItemEventDungeonPoint(res.user_event_dungeon_point,res.user_accum_event_dungeon_point,res.event_dungeon_period_idx),(item={}).event_dungeon_period_idx=res.event_dungeon_period_idx,item.event_dungeon_reward_shop_idx=res.event_dungeon_reward_shop_idx,item.buy_count=res.event_dungeon_reward_shop_item_count,Instance.update_User_Event_Dungeon_Reward_Shop(item),GameContext.getInstance().setUserNewMail("y");break;case"Res_Get_User_Event_Dungeon_Satisfaction_Info":m_Res_Get_User_Event_Dungeon_Satisfaction_Info=res;break;case"Res_Mussang_Tower_Battle_Begin":Instance.upd_User_Key(res.user_key);break;case"Res_Mussang_Tower_Battle_Win":Instance.update_Mussgang_Tower_Battle_Win(res);break;case"Res_Mussang_Tower_Battle_Lose":break;case"Res_Get_User_Event_Dungeon_Once_A_Day":Instance.delete_User_Event_Dungeon_Once_A_Day();for(idx=0;idx<res.user_event_dungeon.length;idx++){var d=res.user_event_dungeon[idx];Instance.update_User_Event_Dungeon_Once_A_Day(d)}break;case"Res_Event_Once_A_Day_Dungeon_Battle_Begin":Instance.upd_User_Key(res.user_key);break;case"Res_Event_Once_A_Day_Dungeon_Battle_Win":Instance.update_Event_Once_A_Day_Dungeon_Battle_Win(res);break;case"Res_Event_Once_A_Day_Dungeon_Battle_Lose":break;case"Res_Event_Dungeon_Satisfaction_Level_Up":Instance.update_User_Event_Dungeon_Point(res.event_dungeon_point),m_Res_Get_User_Event_Dungeon_Satisfaction_Info.satisfaction_level=res.satisfaction_level,m_Res_Get_User_Event_Dungeon_Satisfaction_Info.level_point=res.level_point;break;case"Res_Event_Dungeon_Satisfaction_Reward":for(var i_idx=0;i_idx<res.reward_list.length;i_idx++){(item={}).event_dungeon_group_idx=res.event_dungeon_period_idx,item.reward_idx=res.reward_list[i_idx].reward_idx,m_Res_Get_User_Event_Dungeon_Satisfaction_Info.user_reward_list.push_back(item)}break;case"Res_Event_Dungeon_Search_Area_Info":map_Event_Dungeon_Search_Area_Info.clear(),map_User_Event_Dungeon_Search_Troops.clear(),map_User_Event_Dungeon_Search_Troops_Generals.clear();for(idx=0;idx<res.event_dungeon_search_area_info.length;idx++){var search=res.event_dungeon_search_area_info[idx];map_Event_Dungeon_Search_Area_Info.insert(search.search_area_idx,search)}for(var t_idx=0;t_idx<res.user_search_troops.length;t_idx++){var troops=res.user_search_troops[t_idx];map_User_Event_Dungeon_Search_Troops.insert(troops.troops_num,troops)}for(var g_idx=0;g_idx<res.user_search_troops_generals.length;g_idx++){var general=res.user_search_troops_generals[g_idx];null==(generals=map_User_Event_Dungeon_Search_Troops_Generals.at(general.troops_num))&&(generals=[]),generals.push_back(general),map_User_Event_Dungeon_Search_Troops_Generals.insert(general.troops_num,generals)}break;case"Res_Event_Dungeon_Search_Troops_Set":if(null!=(generals=map_User_Event_Dungeon_Search_Troops_Generals.at(res.troops_num))){var g;generals=generals.filter(function(l){return l.troops_num!=res.troops_num||l.position!=res.position&&l.gnrl_num!=res.gnrl_key.gnrl_num}),(g={}).gnrl_id=res.gnrl_key.gnrl_id,g.gnrl_num=res.gnrl_key.gnrl_num,g.position=res.position,g.troops_num=res.troops_num,generals.push(g);for(g_idx=0;g_idx<generals.length;g_idx++){if((general=generals[g_idx]).gnrl_id==res.leader_gnrl_key.gnrl_id&&general.gnrl_num==res.leader_gnrl_key.gnrl_num){general.leader_yn="y";break}}map_User_Event_Dungeon_Search_Troops_Generals.insert(res.troops_num,generals)}break;case"Res_Event_Dungeon_Search_Troops_Del":if(null!=(generals=map_User_Event_Dungeon_Search_Troops_Generals.at(res.troops_num))){generals=generals.filter(function(l){return l.troops_num!=res.troops_num||l.gnrl_id!=res.gnrl_key.gnrl_id||l.gnrl_num!=res.gnrl_key.gnrl_num});for(g_idx=0;g_idx<generals.length;g_idx++){if((general=generals[g_idx]).gnrl_id==res.leader_gnrl_key.gnrl_id&&general.gnrl_num==res.leader_gnrl_key.gnrl_num){general.leader_yn="y";break}}map_User_Event_Dungeon_Search_Troops_Generals.insert(res.troops_num,generals)}break;case"Res_Event_Dungeon_Search_Troops_Leader_Set":var generals=map_User_Event_Dungeon_Search_Troops_Generals.at(res.troops_num);for(g_idx=0;g_idx<generals.length;g_idx++){(general=generals[g_idx]).gnrl_id==res.leader_gnrl_key.gnrl_id&&general.gnrl_num==res.leader_gnrl_key.gnrl_num?general.leader_yn="y":general.leader_yn="n"}break;case"Res_Event_Dungeon_Search_Result_Info":Instance.update_User_Event_Dungeon_Point(res.event_dungeon_point),null!=(found=map_Event_Dungeon_Search_Area_Info.at(res.search_area_idx))&&map_Event_Dungeon_Search_Area_Info.remove(res.search_area_idx);break;case"Res_Event_Dungeon_Search_Begin":Instance.update_User_Event_Dungeon_Point(res.event_dungeon_point),map_Event_Dungeon_Search_Area_Info.insert(res.search_area_idx,res.event_dungeon_search_area_info);break;case"Res_Event_Dungeon_Search_Cancel":Instance.update_User_Event_Dungeon_Point(res.event_dungeon_point),null!=(found=map_Event_Dungeon_Search_Area_Info.at(res.search_area_idx))&&map_Event_Dungeon_Search_Area_Info.remove(res.search_area_idx);break;case"Res_Event_Dungeon_Search_Troops_Info":map_User_Event_Dungeon_Search_Troops.clear(),map_User_Event_Dungeon_Search_Troops_Generals.clear();for(t_idx=0;t_idx<res.user_search_troops.length;t_idx++){troops=res.user_search_troops[t_idx];map_User_Event_Dungeon_Search_Troops.insert(troops.troops_num,troops)}for(g_idx=0;g_idx<res.user_search_troops_generals.length;g_idx++){if(null!=(general=res.user_search_troops_generals[g_idx]))null==(generals=map_User_Event_Dungeon_Search_Troops_Generals.at(general.troops_num))&&(generals=[],map_User_Event_Dungeon_Search_Troops_Generals.insert(general.troops_num,generals)),generals.push_back(general)}break;case"Res_Event_Dungeon_Search_Troops_Auto_Pairing":null!=(found=map_User_Event_Dungeon_Search_Troops_Generals.at(res.troops_num))&&map_User_Event_Dungeon_Search_Troops_Generals.remove(res.troops_num);for(generals=[],g_idx=0;g_idx<res.gnrl_key_list.length;g_idx++)generals.push_back(res.gnrl_key_list[g_idx]);map_User_Event_Dungeon_Search_Troops_Generals.insert(res.troops_num,generals);break;case"Res_Event_Dungeon_Search_Troops_Batch_Off":null!=(found=map_User_Event_Dungeon_Search_Troops_Generals.at(res.troops_num))&&map_User_Event_Dungeon_Search_Troops_Generals.remove(res.troops_num);break;case"Res_Shop_Buy_Random_Box":case"Res_Shop_Buy_Normal_Gacha_Ticket":res.buy_type==SHOP_BUY_TYPE_JADE?(Instance.upd_UserJade(res.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):res.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT?(Instance.upd_UserYunheePT(res.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):res.buy_type==SHOP_BUY_TYPE_HEAVEN_PT&&(Instance.upd_UserHeavenPt(res.user_goods),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation));break;case"Res_General_Rebirth":Instance.update_General_Rebirth(res);break;case"Res_Event_Dungeon_Craft_Shop_Time_Reduction":Instance.upd_UserJade(res.user_jade);break;case"Res_Get_User_Event_Dungeon_Vd_Info":Instance.delete_User_Event_Dungeon_Vd_Yunhee(),Instance.insert_User_Event_Dungeon_Vd_Yunhee(res),Instance.delete_User_Event_Dungeon_Personal_Accm_Point(),Instance.insert_User_Event_Dungeon_Personal_Accm_Point_Info(res.user_event_dungeon_personal_point_reward);break;case"Res_Get_User_Event_Dungeon_Personal_Accm_Point_Bonus_Info":Instance.delete_User_Event_Dungeon_Personal_Accm_Point(),Instance.insert_User_Event_Dungeon_Personal_Accm_Point_Info(res.user_event_dungeon_personal_point_reward);break;case"Res_Get_User_Event_Dungeon_Christmas_Info":m_Res_Get_User_Event_Dungeon_Christmas_Info=$.extend({},res),Instance.delete_User_Christmas_Reward(m_Res_Get_User_Event_Dungeon_Christmas_Info.event_dungeon_group_idx);for(idx=0;idx<m_Res_Get_User_Event_Dungeon_Christmas_Info.user_event_dungeon_christmas_reward.length;idx++){var christmas_rewad=m_Res_Get_User_Event_Dungeon_Christmas_Info.user_event_dungeon_christmas_reward[idx];Instance.plus_User_Christmas_Reward(christmas_rewad.bonus_type,christmas_rewad.accum_count,christmas_rewad.event_dungeon_group_idx)}Instance.plus_User_Christmas_Personal_Point_Reward(m_Res_Get_User_Event_Dungeon_Christmas_Info.accum_count,m_Res_Get_User_Event_Dungeon_Christmas_Info.event_dungeon_group_idx);break;case"Res_Event_Dungeon_Christmas_Personal_Point_Reward":for(idx=0;idx<res.personal_point_reward_list.length;idx++){var personal_reward=res.personal_point_reward_list[idx];(item={}).event_dungeon_group_idx=res.event_dungeon_group_idx,item.step=personal_reward.step,item.rewarded_yn="y",item.bonus_count=personal_reward.bonus_count,m_Res_Get_User_Event_Dungeon_Christmas_Info.user_event_dungeon_personal_point_reward.push_back(item)}break;case"Res_Event_Dungeon_Global_Achv_Reward_Receive":res.global_point_reward_list.forEach(function(r){Instance.update_User_Event_Dungeon_Global_Point_Info(r)}),GameContext.getInstance().setUserNewMail("y");break;case"Res_Shop_Buy_Rebirth_Mtrl":if(res.buy_type==SHOP_BUY_TYPE_JADE){Instance.upd_UserJade(res.user_goods);rebirth_mtrl_type=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(res.bonus_type);Instance.plus_User_Rebirth_Mtrl(rebirth_mtrl_type,res.rebirth_mtrl_count),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)}else if(res.buy_type==SHOP_BUY_TYPE_YUNHEE_POINT){Instance.upd_UserYunheePT(res.user_goods);rebirth_mtrl_type=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(res.bonus_type);Instance.plus_User_Rebirth_Mtrl(rebirth_mtrl_type,res.rebirth_mtrl_count),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)}else if(res.buy_type==SHOP_BUY_TYPE_HEAVEN_PT){Instance.upd_UserHeavenPt(res.user_goods);rebirth_mtrl_type=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(res.bonus_type);Instance.plus_User_Rebirth_Mtrl(rebirth_mtrl_type,res.rebirth_mtrl_count),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)}break;case"Res_Get_User_Food":Instance.delete_User_Food_Infos(),res.user_food_list.forEach(function(food){Instance.insert_User_Food_Info(food)});break;case"Res_Get_User_Event_Dungeon_Vote_League_Reward":Instance.delete_User_Event_Dungeon_Vote_League_Reward(),Instance.insert_User_Event_Dungeon_Vote_League_Rewards(res.user_reward_list);break;case"Res_Get_User_Event_Dungeon_Use_Point_Reward":Instance.delete_User_Event_Dungeon_Use_Point_Reward(),Instance.insert_User_Event_Dungeon_Use_Point_Rewards(res.user_reward_list);break;case"Res_Get_User_Event_Dungeon_Vote_League_Record":list_User_Event_Dungeon_Vote_League_Record=res.user_vote_league_record_list,TimeEventEngine.getInstance().setTime(TIME_EVENT_SERVER_TIME,1e3*res.server_time);break;case"Res_Event_Dungeon_Vote_League_Reward_Receive":var info;period=MasterManager.getInstance().get_EventDungeonPeriod(res.event_dungeon_period_idx);(info={}).event_dungeon_group_idx=period.event_dungeon_group_idx,info.league_reward_idx=res.league_reward_idx,info.reward_yn="y",Instance.insert_User_Event_Dungeon_Vote_League_Reward(info),GameContext.getInstance().setUserNewMail("y");break;case"Res_Event_Dungeon_Mussang_Boss_Battle_Begin":Instance.upd_User_Key(res.user_key),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation),User_Mussang_boss_info.user_mussang_boss_npc_info.some(function(dungeon_npc_info){if(res.boss_dungeon_idx==dungeon_npc_info.boss_dungeon_idx)return dungeon_npc_info.remain_hp=res.remain_hp,!0});break;case"Res_Get_User_Event_Dungeon_Mussang_Boss_Info":User_Mussang_boss_info={},User_Mussang_boss_info.user_mussang_boss_infos=res.user_mussang_boss_infos,User_Mussang_boss_info.user_mussang_boss_npc_info=res.user_mussang_boss_npc_info;break;case"Res_Event_Dungeon_Mussang_Boss_Battle_Lose":User_Mussang_boss_info.user_mussang_boss_npc_info.some(function(dungeon_npc_info){if(res.boss_dungeon_idx==dungeon_npc_info.boss_dungeon_idx)return dungeon_npc_info.remain_hp=res.remain_hp,!0});break;case"Res_Event_Dungeon_Mussang_Boss_Battle_Win":User_Mussang_boss_info.user_mussang_boss_npc_info.some(function(npc_info){if(res.boss_dungeon_idx==npc_info.boss_dungeon_idx)return npc_info.remain_hp=res.remain_hp,npc_info.remain_hp<=0&&(npc_info.dead_yn="y"),!0}),User_Mussang_boss_info.user_mussang_boss_infos.some(function(dungeon_info){dungeon_info.boss_dungeon_idx==res.boss_dungeon_idx&&(dungeon_info.complete_yn="y")}),res.drop_bonus_items.forEach(function(b){if(b.bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX){var gnrl={};gnrl.gnrl_id=b.bonus_idx,gnrl.gnrl_num=b.bonus_num,gnrl.gnrl_level=b.bonus_level,gnrl.castle_id=b.castle_id,gnrl.used_in_camp="n",gnrl.using_in_camp="n";var gnrl_info=MasterManager.getInstance().get_General(gnrl.gnrl_id);gnrl_info.gnrl_type!=GENERAL_TYPE_YUNHEE&&gnrl_info.gnrl_type!=GENERAL_TYPE_LIMIT_OVER||gnrl_info.rare_type!=RARE_TYPE_SSR?gnrl.lock_yn="n":gnrl.lock_yn="y",Instance.insert_User_General(gnrl)}else if(b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7)Instance.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)Instance.plus_User_Love_Item(b.bonus_idx,b.bonus_num);else if(b.bonus_type==BONUS_TYPE_HEART);else if(b.bonus_type==BONUS_TYPE_JADE);else if(b.bonus_type==BONUS_TYPE_GOLD);else if(b.bonus_type==BONUS_TYPE_KEY);else if(b.bonus_type==BONUS_TYPE_RAID_TICKET);else if(b.bonus_type==BONUS_TYPE_EVENT_POINT);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE||b.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE)Instance.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_EVOLVE_ORB)Instance.plus_User_Evolve_Orb(b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL)Instance.plus_User_Magic_Key_Mtrl(b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&b.bonus_type<=BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND){var craft_shop_bonus_type=b.bonus_type-BONUS_TYPE_CRAFT_SHOP_FIRST_LOW+4;Instance.plus_User_Craft_Shop_Material(craft_shop_bonus_type,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EQUIPMENT)Instance.insert_User_Equipment(b.equipment);else if(b.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||b.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL){var limit_over_mtrl_type=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(b.bonus_type);Instance.plus_User_Limit_Over_Mtrl(limit_over_mtrl_type,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EVENT_DUNGEON_SPECIAL_POINT);else if(b.bonus_type==BONUS_TYPE_USER_EXP);else if(b.bonus_type==BONUS_TYPE_HN_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_R_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_HR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_SR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_R_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_HR_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_SR_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_HIGH_ENGAGE_TEN||b.bonus_type==BONUS_TYPE_NORMAL_ENGAGE_TEN||b.bonus_type==BONUS_TYPE_HIGH_ENGAGE||b.bonus_type==BONUS_TYPE_NORMAL_ENGAGE||b.bonus_type==BONUS_TYPE_HIGH_ENGAGE_TEN_ARMY||b.bonus_type==BONUS_TYPE_NORMAL_ENGAGE_TEN_ARMY||b.bonus_type==BONUS_TYPE_HIGH_ENGAGE_ARMY||b.bonus_type==BONUS_TYPE_NORMAL_ENGAGE_ARMY||b.bonus_type==BONUS_TYPE_RETURN_USER_GIFT_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_LOGIN_GIFT_BOX||b.bonus_type==BONUS_TYPE_JADE_RANDOM_BOX||b.bonus_type==BONUS_TYPE_GOLD_RANDOM_BOX||b.bonus_type==BONUS_TYPE_LOVE_ITEM_RANDOM_BOX||b.bonus_type==BONUS_TYPE_RARE_HWANDAN_RANDOM_BOX||b.bonus_type==BONUS_TYPE_EXP_CARD_RANDOM_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_GIFT_BOX||b.bonus_type==BONUS_TYPE_LUCKY_BOX||b.bonus_type==BONUS_TYPE_SWORD_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_SPEAR_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_ARCHER_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_RANDOM_BOX||b.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_GIFT_BOX||b.bonus_type==BONUS_TYPE_TREASURE_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_BOX_v2||b.bonus_type==BONUS_TYPE_CHRISTMAS_BOX_V3||b.bonus_type==BONUS_TYPE_EVENTDUNGEON_PRESENT_GIFT_BOX||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_1||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_2||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_3||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_4||b.bonus_type==BONUS_TYPE_GOLDEN_BOX||b.bonus_type==BONUS_TYPE_SILVER_BOX||b.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_GACHA_REBORN_GNRL_TICKET||b.bonus_type==BONUS_TYPE_ALL_RARE_TYPE_GNRL_SELECT_TICKET||b.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET||b.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET_V2||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_2||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_3||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_4||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_5||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_6||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_7||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_8||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_9||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_10||b.bonus_type>=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_11&&b.bonus_type<=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_23||b.bonus_type>=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_31&&b.bonus_type<=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_80);else if(b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){var rebirth_mtrl_type=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(b.bonus_type);Instance.plus_User_Rebirth_Mtrl(rebirth_mtrl_type,b.bonus_idx)}else b.bonus_type==BONUS_TYPE_JADE_PIECE&&Instance.plus_User_Jade_Piece(b.bonus_idx)});break;case"Res_Event_Raid_Box_Gacha_Buy":for(i=0;i<User_Box_Gacha_List.event_dungeon_box_gacha_info.length;i++)User_Box_Gacha_List.event_dungeon_box_gacha_info[i].event_dungeon_period_idx==res.event_dungeon_period_idx&&User_Box_Gacha_List.event_dungeon_box_gacha_info[i].delimiter==res.delimiter&&(User_Box_Gacha_List.event_dungeon_box_gacha_info[i].event_raid_box_gacha_ticket=res.event_raid_box_gacha_ticket,User_Box_Gacha_List.event_dungeon_box_gacha_info[i].box_list.clear(),User_Box_Gacha_List.event_dungeon_box_gacha_info[i].box_list=res.box_list);for(service=UserService.getInstance(),m=MasterManager.getInstance(),j=0;j<res.reward_items.length;j++){var reward=res.reward_items[j];m.get_BonusType(reward.bonus_type);reward.bonus_type==BONUS_TYPE_YUNHEE_FIX||reward.bonus_type==BONUS_TYPE_JIN_FIX||(reward.bonus_type==BONUS_TYPE_HWANDAN_1||reward.bonus_type==BONUS_TYPE_HWANDAN_2||reward.bonus_type==BONUS_TYPE_HWANDAN_3||reward.bonus_type==BONUS_TYPE_HWANDAN_4||reward.bonus_type==BONUS_TYPE_HWANDAN_5||reward.bonus_type==BONUS_TYPE_HWANDAN_6||reward.bonus_type==BONUS_TYPE_HWANDAN_7?Instance.plus_User_Hwandan(reward.bonus_type,reward.bonus_idx):reward.bonus_type==BONUS_TYPE_LOVE_ITEM||(reward.bonus_type==BONUS_TYPE_HEART?Instance.plus_User_Heart(reward.bonus_idx):reward.bonus_type==BONUS_TYPE_JADE||(reward.bonus_type==BONUS_TYPE_GOLD?Instance.plus_User_Gold(reward.bonus_idx):reward.bonus_type==BONUS_TYPE_KEY||reward.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&reward.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE||reward.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE||(reward.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&reward.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER?Instance.plus_User_Evolve_Arm_Service(reward.bonus_type,reward.bonus_idx):reward.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&reward.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE?Instance.plus_User_Evolve_Arm_Service(reward.bonus_type,reward.bonus_idx):reward.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&reward.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW?Instance.plus_User_Evolve_Arm_Service(reward.bonus_type,reward.bonus_idx):reward.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL||reward.bonus_type>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&reward.bonus_type<=BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND||reward.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||reward.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||reward.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||reward.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||reward.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||reward.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||reward.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||reward.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||reward.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||reward.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||reward.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||reward.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||reward.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6||reward.bonus_type==BONUS_TYPE_EQUIPMENT||reward.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||reward.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL||reward.bonus_type==BONUS_TYPE_EVOLVE_ORB||reward.bonus_type==BONUS_TYPE_JADE_PIECE||reward.bonus_type==BONUS_TYPE_JADE_RANDOM_BOX||reward.bonus_type==BONUS_TYPE_GOLD_RANDOM_BOX||reward.bonus_type==BONUS_TYPE_LOVE_ITEM_RANDOM_BOX||reward.bonus_type==BONUS_TYPE_RARE_HWANDAN_RANDOM_BOX||reward.bonus_type==BONUS_TYPE_EXP_CARD_RANDOM_BOX||reward.bonus_type==BONUS_TYPE_CHRISTMAS_GIFT_BOX||reward.bonus_type==BONUS_TYPE_SWORD_ORB_RANDDOM_BOX||reward.bonus_type==BONUS_TYPE_SPEAR_ORB_RANDDOM_BOX||reward.bonus_type==BONUS_TYPE_ARCHER_ORB_RANDDOM_BOX||reward.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_RANDOM_BOX||reward.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_GIFT_BOX||reward.bonus_type==BONUS_TYPE_EVENTDUNGEON_PRESENT_GIFT_BOX||reward.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||reward.bonus_type==BONUS_TYPE_R_RARE_TYPE_ENGAGE||reward.bonus_type==BONUS_TYPE_HR_RARE_TYPE_ENGAGE||reward.bonus_type==BONUS_TYPE_SR_RARE_TYPE_ENGAGE||reward.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_SELECT||reward.bonus_type==BONUS_TYPE_HN_RARE_TYPE_SELECT||reward.bonus_type==BONUS_TYPE_R_RARE_TYPE_SELECT||reward.bonus_type==BONUS_TYPE_HR_RARE_TYPE_SELECT||reward.bonus_type==BONUS_TYPE_SR_RARE_TYPE_SELECT||reward.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_1||reward.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_2||reward.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_3||reward.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_4||reward.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_GACHA_REBORN_GNRL_TICKET||reward.bonus_type==BONUS_TYPE_ALL_RARE_TYPE_GNRL_SELECT_TICKET||reward.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET||reward.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET_V2||reward.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET||reward.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_2||reward.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_3||reward.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_4||reward.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_5||reward.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_6||reward.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_7||reward.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_8||reward.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_9||reward.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_10||reward.bonus_type>=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_11&&reward.bonus_type<=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_23||reward.bonus_type>=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_31&&reward.bonus_type<=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_80||reward.bonus_type==BONUS_TYPE_KEY_REFILL||reward.bonus_type==BONUS_TYPE_TICKET_REFILL||reward.bonus_type==BONUS_TYPE_RAID_TICKET_REFILL||reward.bonus_type==BONUS_TYPE_TICKET_REFILL||reward.bonus_type==BONUS_TYPE_SKIP_TICKET||(reward.bonus_type,BONUS_TYPE_EXCHANGE_TICKET)))))}break;case"Res_Event_Dungeon_Mussang_Boss_Continue_Check":var dungeon_idx=res.boss_dungeon_idx,dungeon_period_idx=res.event_dungeon_period_idx,remain_hp=res.remain_hp;res.position;BattleContext._getInstance().setEventDungeonPeriodIdX(dungeon_period_idx);var dungeon_info={};dungeon_info.boss_dungeon_idx=dungeon_idx,dungeon_info.event_dungeon_period_idx=dungeon_period_idx,dungeon_info.complete_yn="n";var net_npc_info={},mt=MasterManager.getInstance(),mastertable_npcinfo=MasterTable.getInstance().get_EventDungeonMussangBossNpcList(dungeon_info.boss_dungeon_idx),npc=mt.get_NpcGeneral(mastertable_npcinfo.at(0).npc1_id);net_npc_info.boss_dungeon_idx=dungeon_idx,net_npc_info.dead_yn="n",net_npc_info.position=1,net_npc_info.event_dungeon_period_idx=dungeon_period_idx,net_npc_info.max_hp=npc.hp,net_npc_info.remain_hp=remain_hp,User_Mussang_boss_info.user_mussang_boss_infos.push_back(dungeon_info),User_Mussang_boss_info.user_mussang_boss_npc_info.push_back(net_npc_info),Instance.set_User_Mussang_Boss_list_Cnt(0);var mt_mussangbossinfo=mt.get_EventDungeonMussangBossInfo(dungeon_idx,dungeon_period_idx);BattleContext._getInstance().setEventDungeonMussangBossLimitTime(mt_mussangbossinfo.time_limit);break;case"Res_Get_User_Game_State":Instance.insert_User_Game_State(res.user_game_state);break;case"Res_Get_World_War_Season_Info":NetServiceV3.getInstance().updateResponse_Res_Get_World_War_Season_Info(res);break;case"Res_Get_World_War_User_Item_Info":NetServiceV3.getInstance().updateResponse_Res_Get_World_War_User_Item_Info(res);break;case"Res_Get_World_War_Troops":NetServiceV3.getInstance().updateResponse_Res_Get_World_War_Troops(res);break;case"Res_Get_World_War_Partin_Generals":NetServiceV3.getInstance().updateResponse_Res_Get_World_War_Partin_Generals(res);break;case"Res_Get_World_War_General_Equipments":NetServiceV3.getInstance().updateResponse_Res_Get_World_War_General_Equipments(res);break;case"Res_Get_World_War_Info":NetServiceV3.getInstance().updateResponse_Res_Get_World_War_Info(res);break;case"Res_World_War_Castle_Occupation_Info":NetServiceV3.getInstance().updateResponse_Res_World_War_Castle_Occupation_Info(res);break;case"Res_World_War_Npc_Troops":NetServiceV3.getInstance().updateResponse_Res_World_War_Npc_Troops(res);break;case"Res_World_War_Troops_Set":NetServiceV3.getInstance().updateResponse_Res_World_War_Troops_Set(res);break;case"Res_World_War_Troops_Del":NetServiceV3.getInstance().updateResponse_Res_World_War_Troops_Del(res);break;case"Res_World_War_Troops_Leader_Set":NetServiceV3.getInstance().updateResponse_Res_World_War_Troops_Leader_Set(res);break;case"Res_World_War_Troops_General_Equipment_Item_Set":NetServiceV3.getInstance().updateResponse_Res_World_War_Troops_General_Equipment_Item_Set(res);break;case"Res_World_War_Troops_General_Equipment_Item_Del":NetServiceV3.getInstance().updateResponse_Res_World_War_Troops_General_Equipment_Item_Del(res);break;case"Res_World_War_Reset":NetServiceV3.getInstance().updateResponse_Res_World_War_Reset(res);break;case"Res_World_War_Troops_Move":NetServiceV3.getInstance().updateResponse_Res_World_War_Troops_Move(res);break;case"Res_User_Unique_Equipment_Ticket":NetServiceV3.getInstance().updateResponse_Res_User_Unique_Equipment_Ticket(res);break;case"Res_Equipment_Unique_Equipment":NetServiceV3.getInstance().updateResponse_Res_Equipment_Unique_Equipment(res);break;case"Res_World_War_Battle_Continue_Info":NetServiceV3.getInstance().updateResponse_Res_World_War_Battle_Continue_Info(res);break;case"Res_World_War_Battle_Continue_Check":NetServiceV3.getInstance().updateResponse_Res_World_War_Battle_Continue_Check(res);break;case"Res_World_War_Move_Battle_Win":NetServiceV3.getInstance().updateResponse_Res_World_War_Move_Battle_Win(res);break;case"Res_World_War_Move_Battle_Lose":NetServiceV3.getInstance().updateResponse_Res_World_War_Move_Battle_Lose(res);break;case"Res_World_War_Move_Battle_Time_Out":NetServiceV3.getInstance().updateResponse_Res_World_War_Move_Battle_Time_Out(res);break;case"Res_World_War_Castle_Special_Add":NetServiceV3.getInstance().updateResponse_Res_World_War_Castle_Special_Add(res);break;case"Res_World_War_Main_Castle_Troops_Return":NetServiceV3.getInstance().updateResponse_Res_World_War_Main_Castle_Troops_Return(res);break;case"Res_World_War_User_Team_Turn_End":NetServiceV3.getInstance().updateResponse_Res_World_War_User_Team_Turn_End(res);break;case"Res_World_War_Cell_Box_Info":NetServiceV3.getInstance().updateResponse_Res_World_War_Cell_Box_Info(res);break;case"Res_World_War_Unification_First_Clear_Reward":NetServiceV3.getInstance().updateResponse_Res_World_War_Unification_First_Clear_Reward(res);break;case"Res_World_War_Buy_Box_Gacha":NetServiceV3.getInstance().updateResponse_Res_World_War_Buy_Box_Gacha(res);break;case"Res_World_War_Unification_First_Clear_Log":NetServiceV3.getInstance().updateResponse_Res_World_War_Unification_First_Clear_Log(res)}}),Instance.delete_User_Mussang=function(){m_user_mussang_Info=[]},Instance.insert_User_Mussang=function(res){for(var i=0;i<res.user_mussangs.length;i++)m_user_mussang_Info.push(res.user_mussangs[i])},Instance.update_User_Mussang=function(mussang_cur_step,mussang_type){for(var i=0;i<m_user_mussang_Info.length;i++)m_user_mussang_Info[i].mussang_type==mussang_type&&(m_user_mussang_Info[i].current_step=mussang_cur_step)},Instance.update_notice_list=function(res){for(var cnt=res.notices.length,i=0;i<cnt;i++)map_notice_list.insert(res.notices[i].num,res.notices[i])},Instance.get_AllNotice=function(){return map_notice_list},Instance.get_UserItemInfo_V2=function(){var item=$.extend({},db.UserItemInfo),user_item=Instance.get_User_item_info(),user=NetService().get_User_info();item.user_id=user.user_id,item.jade_cnt=user_item.user_item.jade_count,item.heart_cnt=user_item.user_item.heart_count,item.gold_cnt=user_item.user_item.gold_count,item.lotus_cnt=user_item.user_item.lotus_count,item.yunhee_point=user_item.user_item.yunhee_point,item.formation_point=user_item.user_item.formation_point,item.heaven_pt_count=user_item.user_item.heaven_pt,item.key_cnt=user_item.user_item_key.key_cnt,item.raid_help_ticket_cnt=user_item.user_raid_help_ticket.ticket_cnt,item.skip_ticket_count=user_item.user_item_skip_ticket,item.raid_ticket_cnt=user_item.user_item_raid_ticket.ticket_cnt,item.new_raid_conquest_ticket_cnt=user_item.user_new_raid_boss_conquest_key.ticket_cnt,item.new_raid_call_ticket_cnt=user_item.user_new_raid_boss_call_key.ticket_cnt,item.ticket_cnt=user_item.user_item_ticket.ticket_cnt,item.great_wall_ticket_cnt=user_item.user_item_great_wall_ticket.ticket_cnt,item.world_war_ticket_cnt=user_item.user_item_world_war_ticket.ticket_cnt,item.exchange_ticket_count=user_item.user_item_exchange_ticket;var ul=MasterManager.getInstance().get_UserLevel(user.user_level),plus_key_bount=Instance.get_User_Plus_Key_Bound();return item.key_bound=ul.key_bound+plus_key_bount,item.ticket_bound=ul.ticket_bound,item.raid_ticket_bound=MasterManager.getInstance().get_CountFunction(6).value,item.raid_help_ticket_bound=MasterManager.getInstance().get_CountFunction(6).value,item.great_wall_ticket_bound=MasterManager.getInstance().get_CountFunction(25).value,item.world_war_ticket_bound=MasterManager.getInstance().get_WorldWarCountFunc(29).value,item.new_raid_call_ticket_bound=MasterManager.getInstance().get_CountFunction(48).value,item.new_raid_conquest_ticket_bound=MasterManager.getInstance().get_CountFunction(49).value,user_item=user=null,item},Instance.get_User_item_info=function(){return User_item_info},Instance.insert_UserItem=function(res){User_item_info={},null==res.user_item.skip_ticket&&(res.user_item.skip_ticket=0);var iteminfo={user_id:m_user_id,user_item:res.user_item,user_item_key:res.user_key,user_item_ticket:res.user_ticket,user_item_raid_ticket:res.user_raid_ticket,user_raid_help_ticket:res.user_raid_help_ticket,user_item_great_wall_ticket:res.user_great_wall_ticket,user_item_world_war_ticket:res.user_world_war_ticket,user_item_skip_ticket:res.user_item.skip_ticket,user_item_exchange_ticket:res.user_item.exchange_ticket,user_item_food:res.user_food,formation_point:res.user_item.formation_point,user_new_raid_boss_call_key:res.user_new_raid_boss_call_key,user_new_raid_boss_conquest_key:res.user_new_raid_boss_conquest_key,user_item_new_raid_boss_conquest_key:res.user_new_raid_boss_conquest_key,user_item_new_raid_boss_call_key:res.user_new_raid_boss_call_key};User_item_info=$.extend({},iteminfo),Instance.update_User_Special_Gacha_Ticket(res.user_item.special_gacha_ticket),Instance.udp_UserEvolveOrb(res.user_item.orb_count),Instance.udp_UserPlusKeyBound(res.user_key.plus_key_bound);for(var i=0;i<res.user_formation_proterty_point.length;i++){var formation_point=res.user_formation_proterty_point[i];m_User_formation_property_point.insert(formation_point.property_type,formation_point)}MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)},Instance.update_UserFormationPropertyPoint=function(points){for(var i=0;i<points.length;i++){var data=new Object;data.point_count=points[i].point_count,data.property_type=points[i].property_type}},Instance.setUserGeneralParnter=function(res){GameContext.getInstance().setUserGeneralParnter(res.user_partner)},Instance.insert_User_Troops=function(res){for(var troops=res.user_troops,idx=0;idx<troops.length;idx++){var troop=troops[idx],data=$.extend({},troop);map_user_troops.insert(data.troops_num,data)}Instance.insert_User_Troops_General(res.user_troops_generals)},Instance.delete_User_Troops_General=function(){list_User_Troops_General=null,list_User_Troops_General=new Map},Instance.insert_User_Troops_General=function(generals){for(var idx=0;idx<generals.length;idx++){var original=generals[idx];list_User_Troops_General.insert([original.troops_num,original.gnrl_id,original.gnrl_num],original)}},Instance.delete_User_General=function(user){Instance.insert_User_Generals(user)},Instance.insert_User_Generals=function(user){for(var generals=user.user_generals,m=MasterTable.getInstance(),buff_period_list=m.get_EventDungeonBuffPeriodList(),idx=0;idx<generals.length;idx++){var res=generals[idx],data=$.extend({},res),ugnrl=data;if(USE_CONVERT_GNRL_ID_TO_GROUP){var group=Instance.convert_GnrlId_To_Group(res.gnrl_id);ugnrl.buff_type=m.get_GeneralDungeonBuffList(group,buff_period_list,ugnrl.buff_type)}else{var g=MasterManager.getInstance().get_General(res.gnrl_id);ugnrl.buff_type=m.get_GeneralDungeonBuffList(g.gnrl_group,buff_period_list,ugnrl.buff_type)}map_User_General.insert([data.gnrl_id,data.gnrl_num],ugnrl)}},Instance.convert_GnrlId_To_Group=function(gnrl_id){var id=cmString("%d",gnrl_id);return 5==id.length?parseInt(id.substring(id.length-3,id.length)):6==id.length?parseInt(id.substring(id.length-4,id.length)):MasterManager.getInstance().get_General(res.gnrl_id)},Instance.update_User_General_Limit_Step=function(bonus_type,bonus_keys){for(var limit_step_id=bonus_type-BONUS_TYPE_TEST_LIMIT_STEP_1_ALL_BOX+1,gnrl_level=MasterManager.getInstance().get_GeneralLimit(limit_step_id).ext_level_id,idx=0;idx<bonus_keys.length;idx++){var key=new net.User_General_Key;key.gnrl_id=bonus_keys[idx].key_id,key.gnrl_num=bonus_keys[idx].key_num;var general=MasterManager.getInstance().get_General(key.gnrl_id),general_level_mt=MasterManager.getInstance().get_GeneralLevelupExpV2(general.level_exp_group,gnrl_level);map_User_General.at([key.gnrl_id,key.gnrl_num]).gnrl_level=gnrl_level,map_User_General.at([key.gnrl_id,key.gnrl_num]).gnrl_exp=general_level_mt.accm_exp,map_User_General.at([key.gnrl_id,key.gnrl_num]).limit_step_id=limit_step_id}},Instance.insert_User_General=function(user){$.extend({},user);for(var idx=0;idx<user.length;idx++){var res=user[idx],lock_yn="n",general=MasterManager.getInstance().get_General(res.key_id);general.rare_type==RARE_TYPE_SSR&&(lock_yn="y"),general.limit_step_id=0,general.gnrl_num=res.key_num,general.gnrl_exp=0,general.gnrl_level=1,general.castle_id=res.key_castle_id,general.love_level=0,general.love_exp=0,general.used_in_camp="n",general.lock_yn=lock_yn,res.gnrl_id=res.key_id,res.gnrl_num=res.key_num;var ugnrl=general,m=MasterTable.getInstance(),g=MasterManager.getInstance().get_General(res.gnrl_id),buff_period_list=m.get_EventDungeonBuffPeriodList();ugnrl.buff_type=m.get_GeneralDungeonBuffList(g.gnrl_group,buff_period_list,ugnrl.buff_type),map_User_General.insert([general.gnrl_id,general.gnrl_num],ugnrl)}},Instance.update_User_General=function(user_gnrl){var key=new net.User_General_Key;key.gnrl_id=user_gnrl.gnrl_id,key.gnrl_num=user_gnrl.gnrl_num,map_User_General.insert([key.gnrl_id,key.gnrl_num],user_gnrl)},Instance.insert_User_General_Love_Setting=function(res){var mt=MasterManager.getInstance(),growth_reward_info=mt.get_EventDungeonGrowthLevelUpRewardInfo(res.key_id),user_gnrl={};user_gnrl.gnrl_id=res.bonus_key.at(0).key_id,user_gnrl.gnrl_num=res.bonus_key.at(0).key_num;var g=mt.get_General(user_gnrl.gnrl_id);user_gnrl.gnrl_exp=0,user_gnrl.gnrl_level=1,user_gnrl.love_level=growth_reward_info.love_level;var general=mt.get_General(user_gnrl.gnrl_id),love_mt=mt.get_LoveLevel(general.rare_type,user_gnrl.love_level);user_gnrl.love_exp=love_mt.accm_exp;var lock_yn="n";g.rare_type!=RARE_TYPE_SSR||g.gnrl_type!=GENERAL_TYPE_YUNHEE&&g.gnrl_type!=GENERAL_TYPE_LIMIT_OVER||(lock_yn="y"),user_gnrl.lock_yn=lock_yn,user_gnrl.limit_step_id=0,user_gnrl.using_in_camp="n",user_gnrl.used_in_camp="n",user_gnrl.display_class=g.gnrl_class,this.insert_User_General_V2(user_gnrl),user_gnrl.love_level<YUNHEE_MAX_LOVE_LEVEL?this.new_User_Books_General(m_user_id,user_gnrl.gnrl_id):this.new_User_Books_General_Max_Love_Level(m_user_id,user_gnrl.gnrl_id)},Instance.new_User_Books_General=function(user_id,gnrl_id){for(var general=MasterManager.getInstance().get_General(gnrl_id),general_list=MasterManager.getInstance().get_AllGeneral().filter(function(obj){return general.gnrl_group==obj.gnrl_group}),g_idx=0;g_idx<general_list.length;g_idx++){var g=general_list[g_idx];if(null==list_User_book_General.find(function(obj){if(obj.gnrl_id==g.gnrl_id)return!0})&&general.gnrl_class>=g.gnrl_class){var books_gnrl={};books_gnrl.gnrl_id=g.gnrl_id,books_gnrl.max_level_complete_yn="n",books_gnrl.love_max_level_complete_yn="n",list_User_book_General.push(books_gnrl)}}},Instance.new_User_Books_General_Max_Love_Level=function(m_user_id,gnrl_id){var general=MasterManager.getInstance().get_General(gnrl_id),map_general=MasterManager.getInstance().get_AllGeneral(),general_list=[];for(var g in map_general)map_general[g].gnrl_group==general.gnrl_group&&general_list.push($.extend({},map_general[g]));for(var g_idx=0;g_idx<general_list.length;g_idx++){g=general_list[g_idx];var bookGeneral=list_User_book_General.find(function(obj){if(obj.gnrl_id==g.gnrl_id)return!0});if(null==bookGeneral&&general.gnrl_class>=g.gnrl_class){var love_max_yn="y",books_gnrl={};books_gnrl.gnrl_id=g.gnrl_id,books_gnrl.max_level_complete_yn="n",books_gnrl.love_max_level_complete_yn=love_max_yn,list_User_book_General.push(books_gnrl)}else{love_max_yn="y";bookGeneral.love_max_level_complete_yn=love_max_yn}}},Instance.insert_User_General_V2=function(user){var data=$.extend({},user),ugnrl=data,m=MasterTable.getInstance(),g=MasterManager.getInstance().get_General(ugnrl.gnrl_id),buff_period_list=m.get_EventDungeonBuffPeriodList();ugnrl.buff_type=m.get_GeneralDungeonBuffList(g.gnrl_group,buff_period_list,ugnrl.buff_type),map_User_General.insert([data.gnrl_id,data.gnrl_num],ugnrl)},Instance.insert_User_Battle_Formation=function(generals){var form=generals.user_battle_formation;m_User_Battle_formation=new Map;for(var idx=0;idx<form.length;idx++){var res=form[idx],data=new Object;data.formation_id=res.formation_id,data.position_type=res.position_type,data.combo_stat=res.combo_stat,m_User_Battle_formation.insert(data.formation_id,data)}},Instance.insert_User_weekly_open_time=function(weekly_dungeon){for(var idx=0;idx<weekly_dungeon.length;idx++){var res=weekly_dungeon[idx],data=$.extend({},res),key=data.weekly_idx+""+data.week_type;map_user_weekly_open.insert(key,data)}},Instance.insert_User_main_mission=function(res){map_user_main_mission.clear();for(var cnt=res.length,idx=0;idx<cnt;idx++)map_user_main_mission.push($.extend({},res[idx]))},Instance.insert_User_main_mission_task=function(res){map_user_main_mission_task.clear();for(var cnt=res.length,idx=0;idx<cnt;idx++)map_user_main_mission_task.push($.extend({},res[idx]))},Instance.insert_User_Main_Story_Lotus_Bonus_Log=function(res){m_User_main_lotus_bonus_log.clear();for(var count=res.length,idx=0;idx<count;idx++){var data=null;(data=$.extend({},res[idx])).main_scene_id=res[idx].main_scene_id,data.main_story_id=res[idx].main_story_id,data.difficulty_type=res[idx].difficulty_type,data.complete_yn=res[idx].complete_yn,data.new_yn=res[idx].new_yn,m_User_main_lotus_bonus_log.insert([data.main_scene_id,data.main_story_id,data.difficulty_type,data.lotus_count],data)}},Instance.insert_User_Mail_V2=function(data){0==list_User_Mail.length&&(list_User_Mail=$.extend([],data.items)),0==list_User_Mail.size()?GameContext.getInstance().setUserNewMail("n"):GameContext.getInstance().setUserNewMail("y")},Instance.insert_User_Mail=function(data){for(var cnt=data.items.length,idx=0;idx<cnt;idx++){var item=data.items[idx];-1!=list_User_Mail.findIndex(function(m){return item.mail_num==m.mail_num})||list_User_Mail.push_back(item)}0==list_User_Mail.size()?GameContext.getInstance().setUserNewMail("n"):GameContext.getInstance().setUserNewMail("y")},Instance.delete_User_Mail=function(){list_User_Mail.clear()},Instance.delete_User_Book_General=function(){list_User_book_General.clear()},Instance.init_User_Book_General=function(book_data){list_User_book_General=[];for(var idx=0;idx<book_data.length;idx++){var data=$.extend({},book_data[idx]);list_User_book_General.push(data)}},Instance.update_User_Illust_Book=function(illust_list){map_User_Illust_Book_List=[],map_User_Illust_Book_List=illust_list},Instance.insert_User_Book_General=function(book_data){for(var idx=0;idx<book_data.length;idx++){var data={gnrl_id:book_data[idx].key_id,gnrl_num:book_data[idx].key_num},general=MasterManager.getInstance().get_General(data.gnrl_id),gnrl_ids=[],map_general=MasterManager.getInstance().get_AllGeneral();for(var g in map_general)map_general[g].gnrl_group==general.gnrl_group&&gnrl_ids.push({gnrl_id:map_general[g].gnrl_id,gnrl_num:map_general[g].gnrl_num,gnrl_class:map_general[g].gnrl_class});for(var i=0;i<gnrl_ids.length;i++){if(null==(bookGeneral=list_User_book_General.find(function(obj){if(obj.gnrl_id==gnrl_ids[i].gnrl_id)return!0}))&&general.gnrl_class>=gnrl_ids[i].gnrl_class){for(var love_max_yn="n",jdx=0;jdx<gnrl_ids.length;jdx++){var bookGeneral;if(null!=(bookGeneral=list_User_book_General.find(function(obj){if(obj.gnrl_id==gnrl_ids[jdx].gnrl_id)return!0}))&&"y"==bookGeneral.love_max_level_complete_yn){love_max_yn="y";break}}gnrl_ids[i].love_max_level_complete_yn=love_max_yn,list_User_book_General.push(gnrl_ids[i])}}}},Instance.delete_User_Achievement=function(){},Instance.init_User_Achievement=function(data){map_achievement_list.clear(),Instance.insert_User_Achievement(data)},Instance.insert_User_Achievement=function(data){for(var idx=0;idx<data.length;idx++){var key=data[idx].achv_id;map_achievement_list.insert(key,data[idx])}},Instance.getUserAchievementList=function(){return map_achievement_list},Instance.insert_User_Tutorial_V2=function(data){for(var count=data.length,idx=0;idx<count;idx++){var _data=null;(_data=$.extend({},data[idx])).user_id=m_user_id,_data.tutorial_id=data[idx].tutorial_id,TutorialService.getInstance().add_User_tutorial_V2(_data.tutorial_id,_data)}},Instance.insert_User_Camp_Cost=function(res){map_User_Camp_cost.clear();for(var i=0;i<res.cost_list.length;i++)Instance.insert_User_Camp_Cost_ADD(res.cost_list[i].troops_num,res.cost_list[i].added_cost)},Instance.insert_User_Camp_Cost_ADD=function(troops_num,added_cost){var data=new Object;data.troops_num=troops_num,data.added_cost=added_cost,map_User_Camp_cost.insert(data.troops_num,data)},Instance.delete_User_Camp_Cost_General=function(){var val=arguments;switch(val.length){case 0:map_User_Cost_general.clear();break;case 1:for(var troops_num=val[0],keys=map_User_Cost_general.keys(),idx=0;idx<keys.length;idx++)map_User_Cost_general.at(keys[idx]).troops_num==troops_num&&map_User_Cost_general.remove(keys[idx])}},Instance.insert_User_Camp_Cost_General=function(res){for(var idx=0;idx<res.cost_yunhees.length;idx++)for(var item=res.cost_yunhees[idx],jdx=0;jdx<item.gnrl_keys.length;jdx++){var gnrl_key=item.gnrl_keys[jdx];Instance.insert_User_Camp_Cost_General_ADD(gnrl_key,item.troops_num,jdx)}},Instance.insert_User_Camp_Cost_General_ADD=function(gnrl_key,troops_num,num){var data=new Object;data.user_id=m_user_id,data.troops_num=troops_num,data.num=num,data.gnrl_id=gnrl_key.gnrl_id,data.gnrl_num=gnrl_key.gnrl_num,map_User_Cost_general.insert([data.troops_num,data.num],data)},Instance.delete_User_Camp_Cost_Slot=function(){var val=arguments;switch(val.length){case 0:list_User_camp_cost_slot.clear();break;case 1:var troops_num=val[0];list_User_camp_cost_slot.remove(troops_num);for(var keys=list_User_camp_cost_slot.keys(),i=0;i<keys.length;i++)Instance.insert_User_Camp_Cost_Slot_ADD(list_User_camp_cost_slot.at(keys[i]))}},Instance.insert_User_Camp_Cost_Slot=function(res){for(var i=0;i<res.cost_slot.length;i++)Instance.insert_User_Camp_Cost_Slot_ADD(res.cost_slot[i])},Instance.insert_User_Camp_Cost_Slot_ADD=function(user_camp_cost_slot){var data=new Object;data.troops_num=user_camp_cost_slot.troops_num,data.slots_0=user_camp_cost_slot.slots[0],data.slots_1=user_camp_cost_slot.slots[1],data.slots_2=user_camp_cost_slot.slots[2],data.slots_3=user_camp_cost_slot.slots[3],data.slots_4=user_camp_cost_slot.slots[4],data.slots_5=user_camp_cost_slot.slots[5],data.slots_6=user_camp_cost_slot.slots[6],data.slots_7=user_camp_cost_slot.slots[7],list_User_camp_cost_slot.insert(data.troops_num,data)},Instance.delete_User_Event_Dungeon=function(){map_user_event_dungeon.clear()},Instance.insert_User_Event_Dungeon=function(event_dungeon){for(var i=0;i<event_dungeon.length;i++){var data=new Object;data.user_id=m_user_id,data.event_dungeon_idx=event_dungeon[i].event_dungeon_id,data.challenge_count=event_dungeon[i].challenge_count,data.win_count=event_dungeon[i].win_count,data.complete_yn=event_dungeon[i].complete_yn,map_user_event_dungeon.insert([data.user_id,data.event_dungeon_idx],data)}for(i=0;i<event_dungeon.length;i++)for(var d=event_dungeon[i],j=0;j<d.task_list.length;j++){var t=d.task_list[j];Instance.update_User_Event_Dungeon_Task(t)}},Instance.delete_User_Event_Dungeon_Point=function(){map_user_event_dungeon_point.clear()},Instance.insert_User_Event_Dungeon_Point=function(points){for(var i=0;i<points.length;i++){var data=new Object;data.event_dungeon_period_idx=points[i].event_dungeon_period_idx,data.event_point=points[i].event_point,data.accum_event_point=points[i].accum_event_point,map_user_event_dungeon_point.insert([m_user_id,data.event_dungeon_period_idx],data)}},Instance.plus_User_Event_Point=function(period_idx,count){var dungeon_point=map_user_event_dungeon_point.at([m_user_id,period_idx]);if(null!=dungeon_point)dungeon_point.event_point+=count,dungeon_point.accum_event_point+=count;else{var data=new Object;data.event_dungeon_period_idx=period_idx,data.event_point=count,data.accum_event_point=count,map_user_event_dungeon_point.insert([m_user_id,data.event_dungeon_period_idx],data)}},Instance.update_User_Event_Dungeon_Point=function(list){var m=MasterManager.getInstance();if(0!=list.length)for(var idx=0;idx<list.length;idx++){var data,sp=list[idx],period=m.get_EventDungeonPeriod(sp.event_dungeon_period_idx),dungeon_point=map_user_event_dungeon_point.at([m_user_id,period.event_dungeon_period_idx]);if(null!=dungeon_point)dungeon_point.event_point=sp.event_point,dungeon_point.accum_event_point=sp.accum_event_point;else(data=new Object).event_dungeon_period_idx=sp.event_dungeon_period_idx,data.event_point=sp.event_point,data.accum_event_point=sp.accum_event_point,map_user_event_dungeon_point.insert([m_user_id,data.event_dungeon_period_idx],data)}else(data=new Object).event_dungeon_period_idx=0,data.event_point=0,data.accum_event_point=0,data.event_dungeon_point_period_idx=0,map_user_event_dungeon_point.insert([m_user_id,data.event_dungeon_period_idx],data)},Instance.delete_User_Event_Dungeon_Reward=function(){map_user_event_dungeon_reward.clear()},Instance.insert_User_Event_Dungeon_Reward=function(rewards){for(var i=0;i<rewards.length;i++){var data=new Object;data.user_id=m_user_id,data.event_dungeon_period_idx=rewards[i].event_dungeon_period_idx,data.event_dungeon_reward_idx=rewards[i].event_dungeon_reward_idx,data.rewarded_yn=rewards[i].rewarded_yn,map_user_event_dungeon_reward.insert([data.user_id,data.event_dungeon_period_idx,data.event_dungeon_reward_idx],data)}},Instance.delete_User_Event_Dungeon_Reward_Shop=function(){map_user_event_dungeon_reward_shop.clear()},Instance.insert_User_Event_Dungeon_Reward_Shop=function(rewards){for(var i=0;i<rewards.length;i++){var data=new Object;data.user_id=m_user_id,data.event_dungeon_period_idx=rewards[i].event_dungeon_period_idx,data.event_dungeon_reward_shop_idx=rewards[i].event_dungeon_reward_shop_idx,data.buy_count=rewards[i].buy_count,map_user_event_dungeon_reward_shop.insert([data.user_id,data.event_dungeon_period_idx,data.event_dungeon_reward_shop_idx],data)}},Instance.delete_User_Event_Dungeon_Reward_Board_Info=function(){map_user_event_dungeon_reward_board_info.clear()},Instance.insert_User_Event_Dungeon_Reward_Board_Info=function(board_infos){for(var i=0;i<board_infos.length;i++){var data=new Object;data.user_id=m_user_id,data.event_dungeon_period_idx=board_infos[i].event_dungeon_period_idx,data.event_dungeon_reward_board_info_idx=board_infos[i].event_dungeon_reward_board_info_idx,data.open_yn=board_infos[i].open_yn,data.complete_yn=board_infos[i].complete_yn,map_user_event_dungeon_reward_board_info.insert([data.event_dungeon_period_idx,data.event_dungeon_reward_board_info_idx],data)}},Instance.delete_User_Event_Dungeon_Reward_Board_Map=function(){map_user_event_dungeon_board_map_bonus.clear()},Instance.insert_User_Event_Dungeon_Reward_Board_Map=function(rewards){for(var i=0;i<rewards.length;i++){var data=new Object;data.user_id=m_user_id,data.event_dungeon_period_idx=rewards[i].event_dungeon_period_idx,data.event_dungeon_reward_board_info_idx=rewards[i].event_dungeon_reward_board_info_idx,data.event_dungeon_reward_board_map_idx=rewards[i].event_dungeon_reward_board_map_idx,data.rewarded_yn=rewards[i].rewarded_yn,map_user_event_dungeon_board_map_bonus.insert([data.user_id,data.event_dungeon_period_idx,data.event_dungeon_reward_board_info_idx,data.event_dungeon_reward_board_map_idx],data)}},Instance.delete_User_Love_Item=function(){map_User_Love_Item.clear()},Instance.insert_User_Love_Item=function(user_love_item){for(var count=user_love_item.length,i=0;i<count;i++)Instance.insert_User_Love_Item_Add(user_love_item[i])},Instance.insert_User_Love_Item_Add=function(user_love_item){var key={};key.love_id=user_love_item.love_id,key.count=user_love_item.count,key.gnrl_id=user_love_item.gnrl_id,map_User_Love_Item.insert(key.love_id+""+key.gnrl_id,key)},Instance.delete_UserHwandan=function(){map_User_Hwandan_Info.clear()},Instance.insert_UserHwandan=function(user_hwandan){for(var cnt=user_hwandan.length,i=0;i<cnt;i++)Instance.insert_UserHwandan_Add(user_hwandan[i])},Instance.insert_UserHwandan_Add=function(user_hwandan){var data=null;(data=$.extend({},net.User_Hwandan)).hwandan_class=user_hwandan.hwandan_class,data.hwandan_count=user_hwandan.hwandan_count,map_User_Hwandan_Info.insert(data.hwandan_class,data)},Instance.delete_UserEvolveArmServiceMtrl=function(){map_User_Evolve_Arm_Service_Mtrl.clear()},Instance.insert_UserEvolveArmServiceMtrl=function(mtrls){for(var i=0;i<mtrls.length;i++)Instance.insert_UserEvolveArmServiceMtrl_Add(mtrls[i])},Instance.insert_UserEvolveArmServiceMtrl_Add=function(mtrl){var key=null;(key=$.extend({},net.User_Evolve_Arm_Service_Key)).arm_service_type=mtrl.arm_service_type,key.class_type=mtrl.class_type;var data=null;(data=$.extend({},net.User_Hwandan)).class_type=mtrl.class_type,data.mtrl_count=mtrl.mtrl_count,map_User_Evolve_Arm_Service_Mtrl.insert([key.arm_service_type,key.class_type],mtrl)},Instance.insert_User_Camp_Branch_Ability_General=function(res){for(var count=res.length,idx=0;idx<count;idx++){var data=null;if(data=$.extend({},res[idx]),"y"==res[idx].complete_yn)for(var jdx in res[idx].gnrl_keys){var gnrl_key=res[idx].gnrl_keys[jdx];if(0<gnrl_key.gnrl_id)null!=map_User_General.at([gnrl_key.gnrl_id,gnrl_key.gnrl_num])&&map_User_General.remove([gnrl_key.gnrl_id,gnrl_key.gnrl_num])}data.complete_dt=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME))+1e3*data.remain_second,CampService.getInstance().insert_camp_branch_ability_log(data)}},Instance.delete_User_Event_Dungeon_Cutin_Accum_Rate_Point=function(){map_user_event_dungeon_cutin_accum_rate.clear()},Instance.delete_User_Event_Dungeon_Global_Point_Info=function(){map_user_event_dungeon_global_reward_log.clear()},Instance.insert_User_Event_Dungeon_Global_Point_Info=function(info){for(var i=0;i<info.length;i++){var data=new Object;data.user_id=m_user_id,data.event_dungeon_global_point_idx=info[i].event_dungeon_global_point_idx,data.event_dungeon_period_idx=info[i].event_dungeon_period_idx,data.rewarded_yn=info[i].rewarded_yn,map_user_event_dungeon_global_reward_log.insert([data.user_id,data.event_dungeon_global_point_idx,data.event_dungeon_period_idx],data)}},Instance.update_User_Event_Dungeon_Global_Point_Info=function(info){map_user_event_dungeon_global_reward_log.insert([m_user_id,info.event_dungeon_global_point_idx,info.event_dungeon_period_idx],info)},Instance.delete_User_Event_Dungeon_Special_Point=function(){map_user_event_dungeon_special_point.clear()},Instance.insert_User_Event_Dungeon_Special_Point=function(list){for(var i=0;i<list.length;i++){var data=new Object;data.user_id=m_user_id,data.event_dungeon_period_idx=list[i].event_dungeon_point_period_idx,data.point=list[i].point,data.accum_point=list[i].accum_point,map_user_event_dungeon_special_point.insert([data.user_id,data.event_dungeon_period_idx],data)}},Instance.update_User_Event_Dungeon_Special_Point=function(list){for(var m=MasterManager.getInstance(),idx=0;idx<list.length;idx++){var sp=list[idx],period=m.get_EventDungeonPeriod(sp.event_dungeon_period_idx),special_point=map_user_event_dungeon_special_point.at([m_user_id,period.event_dungeon_point_period_idx]);if(null!=special_point)special_point.point=sp.point,special_point.accum_point=sp.accum_point;else{var data=new Object;data.user_id=m_user_id,data.event_dungeon_period_idx=period.event_dungeon_point_period_idx,data.point=sp.point,data.accum_point=sp.accum_point,map_user_event_dungeon_special_point.insert([data.user_id,data.event_dungeon_period_idx],data)}}},Instance.delete_User_Event_Dungeon_Marble_Circuit_Info=function(){map_user_event_dungeon_marble_circuit_log.clear()},Instance.insert_User_Event_Dungeon_Marble_Circuit_Info=function(list){for(var i=0;i<list.length;i++){var data=new Object;data.user_id=m_user_id,data.event_dungeon_period_idx=list[i].event_dungeon_period_idx,data.event_dungeon_marble_circuit_info_idx=list[i].event_dungeon_marble_circuit_info_idx,data.rewarded_yn=list[i].rewarded_yn,map_user_event_dungeon_marble_circuit_log.insert([data.user_id,data.event_dungeon_period_idx,data.event_dungeon_marble_circuit_info_idx],data)}},Instance.delete_User_Event_Dungeon_Marble_Fortune=function(){map_user_event_dungeon_marble_fortune.clear()},Instance.delete_User_Event_Dungeon_Marble_Golden_Box_Info=function(){map_user_event_dungeon_marble_golden_box_gain_log.clear()},Instance.insert_User_Event_Dungeon_Marble_Fortune=function(list){if(null!=list)for(var i=0;i<list.length;i++){var data=new Object;data.user_id=m_user_id,data.event_dungeon_period_idx=list[i].event_dungeon_period_idx,data.fortune_type=list[i].fortune_type,map_user_event_dungeon_marble_fortune.insert([data.user_id,data.event_dungeon_period_idx],data)}},Instance.insert_User_Event_Dungeon_Marble_Golden_Box_Info=function(list){if(null!=list)for(var i=0;i<list.length;i++){var data=new Object;data.user_id=m_user_id,data.event_dungeon_period_idx=list[i].event_dungeon_period_idx,data.golden_box_idx=list[i].golden_box_idx,data.gain_count=list[i].gain_count,map_user_event_dungeon_marble_golden_box_gain_log.insert([data.user_id,data.event_dungeon_period_idx,data.golden_box_idx],data)}},Instance.update_User_Event_Dungeon_Marble_Fortune=function(list){for(var m=MasterManager.getInstance(),idx=0;idx<list.length;idx++){var sp=list[idx],period=m.get_EventDungeonPeriod(sp.event_dungeon_period_idx),marble_fortune=map_user_event_dungeon_marble_fortune.at([m_user_id,period.event_dungeon_point_period_idx]);if(null!=marble_fortune)marble_fortune.fortune_type=sp.fortune_type;else{var data=new Object;data.user_id=m_user_id,data.event_dungeon_period_idx=period.event_dungeon_point_period_idx,data.fortune_type=sp.fortune_type,map_user_event_dungeon_marble_fortune.insert([data.user_id,data.event_dungeon_period_idx],data)}}},Instance.update_User_Event_Dungeon_Marble_Golden_Box_Info=function(list){for(var m=MasterManager.getInstance(),idx=0;idx<list.length;idx++){var sp=list[idx],period=m.get_EventDungeonPeriod(sp.event_dungeon_period_idx),golden_box_info=map_user_event_dungeon_marble_golden_box_gain_log.at([m_user_id,period.event_dungeon_point_period_idx,sp.golden_box_idx]);if(null!=golden_box_info)golden_box_info.gain_count=sp.gain_count;else{var data=new Object;data.user_id=m_user_id,data.event_dungeon_period_idx=period.event_dungeon_point_period_idx,data.golden_box_idx=sp.golden_box_idx,data.gain_count=sp.gain_count,map_user_event_dungeon_marble_golden_box_gain_log.insert([data.user_id,data.event_dungeon_period_idx,sp.golden_box_idx],data)}}},Instance.update_User_Event_Dungeon_Marble_Circuit_Info=function(list){for(var m=MasterManager.getInstance(),idx=0;idx<list.length;idx++){var sp=list[idx],period=m.get_EventDungeonPeriod(sp.event_dungeon_period_idx),circuit_log=map_user_event_dungeon_marble_circuit_log.at([m_user_id,period.event_dungeon_period_idx,sp.event_dungeon_marble_circuit_info_idx]);if(null!=circuit_log)circuit_log.rewarded_yn=sp.rewarded_yn;else{var data=new Object;data.user_id=m_user_id,data.event_dungeon_period_idx=period.event_dungeon_period_idx,data.event_dungeon_marble_circuit_info_idx=sp.event_dungeon_marble_circuit_info_idx,data.rewarded_yn=sp.rewarded_yn,map_user_event_dungeon_marble_circuit_log.insert([data.user_id,data.event_dungeon_period_idx,data.event_dungeon_marble_circuit_info_idx],data)}}},Instance.delete_User_Event_Dungeon_Marble_Map_Info=function(){map_user_event_dungeon_marble_map_info.clear()},Instance.insert_User_Event_Dungeon_Marble_Map_Info=function(info){if(null!=info.length)for(var i=0;i<info.length;i++){var data=new Object;data.user_id=m_user_id,data.event_dungeon_period_idx=info[i].event_dungeon_period_idx,data.event_dungeon_marble_map_info_idx=info[i].event_dungeon_marble_map_info_idx,data.circuit_count=info[i].circuit_count,map_user_event_dungeon_marble_map_info.insert([data.user_id,data.event_dungeon_period_idx],data)}},Instance.update_User_Event_Dungeon_Marble_Map_Info=function(list){for(var m=MasterManager.getInstance(),idx=0;idx<list.length;idx++){var sp=list[idx],period=m.get_EventDungeonPeriod(sp.event_dungeon_period_idx),map_info=map_user_event_dungeon_marble_map_info.at([m_user_id,period.event_dungeon_point_period_idx]);if(null!=map_info)map_info.event_dungeon_marble_map_info_idx=sp.event_dungeon_marble_map_info_idx,map_info.circuit_count=sp.circuit_count;else{var data=new Object;data.user_id=m_user_id,data.event_dungeon_period_idx=period.event_dungeon_period_idx,data.event_dungeon_marble_map_info_idx=sp.event_dungeon_marble_map_info_idx,data.circuit_count=sp.circuit_count,map_user_event_dungeon_marble_map_info.insert([data.user_id,data.event_dungeon_period_idx],data)}}},Instance.insert_User_Event_Dungeon_Craft_Shop_Material=function(list){for(var i=0;i<list.length;i++){var data={};data.user_id=m_user_id,data.craft_shop_bonus_type=list[i].craft_shop_bonus_type,data.material_count=list[i].material_count,map_user_event_dungeon_craft_shop_material.insert([data.user_id,data.craft_shop_bonus_type],data)}},Instance.delete_User_Event_Dungeon_Persnal_Accm_Point=function(){map_user_event_dungeon_persnal_point_bonus_log.clear()},Instance.insert_User_Event_Dungeon_Persnal_Accm_Point_Info=function(list){for(var i=0;i<list.length;i++){var data=new Object;data.user_id=m_user_id,data.event_dungeon_period_idx=list[i].event_dungeon_period_idx,data.point_info_id=list[i].point_info_id,data.reward_yn=list[i].reward_yn,map_user_event_dungeon_persnal_point_bonus_log.insert([data.user_id,data.event_dungeon_period_idx,data.point_info_id],data)}},Instance.delete_User_Event_Dungeon_Special_Point_Shop=function(){map_user_event_dungeon_special_point_shop_log.clear()},Instance.insert_User_Event_Dungeon_Special_Point_Shop=function(list){for(var i=0;i<list.length;i++){var data=new Object;data.user_id=m_user_id,data.event_dungeon_period_idx=list[i].event_dungeon_period_idx,data.event_dungeon_special_point_shop_idx=list[i].event_dungeon_special_point_shop_idx,data.buy_count=list[i].buy_count,map_user_event_dungeon_special_point_shop_log.insert([data.user_id,data.event_dungeon_period_idx,data.event_dungeon_special_point_shop_idx],data)}},Instance.update_User_Event_Dungeon_Cutin_Accum_Rate_Point=function(event_dungeon_period_idx,cutin_accum_rate_point){var is_exist=!1,m_cutin=map_user_event_dungeon_cutin_accum_rate.at([m_user_id,event_dungeon_period_idx]);if(m_cutin&&(is_exist=!0),0==is_exist){var cutin_accum_rate=new Object;cutin_accum_rate.user_id=m_user_id,cutin_accum_rate.event_dungeon_period_idx=event_dungeon_period_idx,cutin_accum_rate.cutin_accum_rate_point=cutin_accum_rate_point,map_user_event_dungeon_cutin_accum_rate.insert([m_user_id,cutin_accum_rate.event_dungeon_period_idx],cutin_accum_rate)}else m_cutin.cutin_accum_rate_point=cutin_accum_rate_point},Instance.delete_User_Yunhee_Bound=function(){},Instance.insert_User_Yunhee_Bound=function(res){var data={};data.user_id=m_user_id,data.bound=res,m_user_yunhee_bound.insert(m_user_id,data)},Instance.insert_User_Illust=function(bonus_key){var data={};data.illust_idx=bonus_key[0].key_num,map_User_Illust_Book_List.push_back(data)},Instance.update_User_Camp=function(res){CampService.getInstance().clear_camp();for(var cnt=res.length,idx=0;idx<cnt;idx++){var data=null;(data=$.extend({},res[idx])).user_id=m_user_id,CampService.getInstance().insert_camp(data)}},Instance.delete_User_Camp_Branch_Ability=function(key,branch_type){null==key?map_user_camp_branch_ability.clear():map_user_camp_branch_ability.remove(branch_type)},Instance.insert_User_Camp_Branch_Ability=function(branch_ability){if(Array.isArray(branch_ability))for(var cnt=branch_ability.length,idx=0;idx<cnt;idx++){var data=null;(data=$.extend({},branch_ability[idx])).user_id=m_user_id,map_user_camp_branch_ability.insert(data.branch_type,data)}else{data=null;(data=$.extend({},branch_ability)).user_id=m_user_id,map_user_camp_branch_ability.insert(data.branch_type,data)}},Instance.update_User_Gacha_Count=function(res){User_gacha_count={},User_gacha_count.gacha_buy_bonus=res.gacha_count,User_gacha_count.user_ceiling_gacha_info_list=res.user_ceiling_gacha_info_list},Instance.update_User_Ceiling_Gacha_Counts=function(list){for(var idx=0;idx<list.length;idx++)Instance.update_User_Ceiling_Gacha_Count(list[idx])},Instance.update_User_Ceiling_Gacha_Count=function(info){var ceiling_gacha_info=map_user_ceiling_gacha_info.at([m_user_id,info.ceiling_gacha_idx]);null==ceiling_gacha_info&&((ceiling_gacha_info={}).user_id=m_user_id,ceiling_gacha_info.ceiling_gacha_idx=info.ceiling_gacha_idx,ceiling_gacha_info.ceiling_gacha_count=info.ceiling_gacha_count);ceiling_gacha_info.ceiling_gacha_count;ceiling_gacha_info.ceiling_gacha_count=info.ceiling_gacha_count,map_user_ceiling_gacha_info.insert([m_user_id,info.ceiling_gacha_idx],ceiling_gacha_info)},Instance.update_User_Gnrl_Piece=function(item){var found=_user_gnrl_piece_item.user_gnrl_piece.findIndex(function(d){return item.bonus_type==d.bonus_type&&item.gnrl_group==d.gnrl_group});-1!=found?_user_gnrl_piece_item.user_gnrl_piece[found].count=item.count:_user_gnrl_piece_item.user_gnrl_piece.push_back(item)},Instance.updateNewEquipmentEnhanceMaterial=function(item){var found=_user_new_equipment_enhance_materials.user_enhance_materials.findIndex(function(d){return item.new_equipment_enhance_material_idx==d.new_equipment_enhance_material_idx});-1!=found?_user_new_equipment_enhance_materials.user_enhance_materials[found].count=item.count:_user_new_equipment_enhance_materials.user_enhance_materials.push_back(item)},Instance.updateNewEquipmentMakeMaterial=function(item){var found=_user_new_equipment_make_materials.user_make_materials.findIndex(function(d){return item.new_equipment_make_material_idx==d.new_equipment_make_material_idx});-1!=found?_user_new_equipment_make_materials.user_make_materials[found].count=item.count:_user_new_equipment_make_materials.user_make_materials.push_back(item)},Instance.updateNewEquipmentSmeltMaterial=function(item){var found=_user_new_equipment_smelt_materials.user_smelt_materials.findIndex(function(d){return item.new_equipment_smelt_material_idx==d.new_equipment_smelt_material_idx});-1!=found?_user_new_equipment_smelt_materials.user_smelt_materials[found].count=item.count:_user_new_equipment_smelt_materials.user_smelt_materials.push_back(item)},Instance.plus_User_New_Equipment_Make_Material=function(key_id,add_count){var found=_user_new_equipment_make_materials.user_make_materials.findIndex(function(m){return key_id==m.new_equipment_make_material_idx});if(-1!=found)_user_new_equipment_make_materials.user_make_materials[found].count+=add_count;else{var item={};item.new_equipment_make_material_idx=key_id,item.count=add_count,_user_new_equipment_make_materials.user_make_materials.push_back(item)}},Instance.plus_User_New_Equipment_Enhance_Material=function(key_id,add_count){var found=_user_new_equipment_enhance_materials.user_enhance_materials.findIndex(function(m){return key_id==m.new_equipment_enhance_material_idx});if(-1!=found)_user_new_equipment_enhance_materials.user_enhance_materials[found].count+=add_count;else{var item={};item.new_equipment_enhance_material_idx=key_id,item.count=add_count,_user_new_equipment_enhance_materials.user_enhance_materials.push_back(item)}},Instance.plus_User_New_Equipment_Smelt_Material=function(key_id,add_count){var found=_user_new_equipment_smelt_materials.user_smelt_materials.findIndex(function(m){return key_id==m.new_equipment_smelt_material_idx});if(-1!=found)_user_new_equipment_smelt_materials.user_smelt_materials[found].count+=add_count;else{var item={};item.new_equipment_smelt_material_idx=key_id,item.count=add_count,_user_new_equipment_smelt_materials.user_smelt_materials.push_back(item)}},Instance.plus_User_New_Equipment_Enchant_Ticket=function(key_id,add_count){var found=_user_new_equipment_enchant_tickets.user_enchant_tickets.findIndex(function(m){return key_id==m.new_equipment_enchant_ticket_idx});if(-1!=found)_user_new_equipment_enchant_tickets.user_enchant_tickets[found].ticket_count+=add_count;else{var ticket={};ticket.new_equipment_enchant_ticket_idx=key_id,ticket.ticket_count=add_count,_user_new_equipment_enchant_tickets.user_enchant_tickets.push_back(ticket)}},Instance.addNewEquipmentItem=function(equip){-1==_user_new_euipment_list.user_equipments.findIndex(function(e){return e.new_equipment_idx==equip.new_equipment_idx&&e.equip_num==equip.equip_num})&&_user_new_euipment_list.user_equipments.push_back(equip)},Instance.update_User_Gacha_Ticket=function(shop_id,ticket_count){var data=new Object;data.shop_id=shop_id,data.ticket_count=ticket_count,_user_gacha_ticket.insert(data.shop_id,data)},Instance.update_User_Special_Gacha_Ticket=function(res){if(null!=res.length)for(var i=0;i<res.length;i++){var data={};data.special_ticket_gacha_idx=res[i].special_ticket_gacha_idx,data.ticket_cnt=res[i].ticket_cnt,_user_special_gacha_ticket.insert(data.special_ticket_gacha_idx,data)}else _user_special_gacha_ticket.insert(res.special_ticket_gacha_idx,res)},Instance.plus_User_Special_Gacha_Ticket=function(special_ticket_gacha_idx,ticket_cnt){var ticket_data,data=_user_special_gacha_ticket.at([special_ticket_gacha_idx]);null!=data?(data.special_ticket_gacha_idx=special_ticket_gacha_idx,data.ticket_cnt=data.ticket_cnt+ticket_cnt,_user_special_gacha_ticket.insert(data.special_ticket_gacha_idx,data)):(null!=_user_special_gacha_ticket||(_user_special_gacha_ticket=new Map),(ticket_data={}).special_ticket_gacha_idx=special_ticket_gacha_idx,ticket_data.ticket_cnt=ticket_cnt,_user_special_gacha_ticket.insert(ticket_data.special_ticket_gacha_idx,ticket_data))},Instance.upd_UserItemTicket=function(user_ticket){User_item_info.user_item_ticket.ticket_cnt=user_ticket.ticket_cnt,User_item_info.user_item_ticket.elapsed=user_ticket.elapsed},Instance.upd_UserExchangeTicket=function(ticket_count){User_item_info.user_item.user_item_exchange_ticket=ticket_count},Instance.get_User_Special_Gacha_Ticket=function(special_ticket_gacha_idx){for(var data={},keys=_user_special_gacha_ticket.keys(),found=!1,i=0;i<keys.length;i++)if(keys[i]==special_ticket_gacha_idx){data=_user_special_gacha_ticket.at([keys[i]]),found=!0;break}return 0==found&&(data=null),data},Instance.get_User_Exchange_Ticket=function(){return User_item_info.user_item.user_item_exchange_ticket},Instance.get_User_Exchange_Ticket_Buy_Log=function(){return _exchange_ticket_buy_log},Instance.get_User_Daily_Dungeon=function(){return User_daily_dungeon},Instance.delete_User_Event_Dungeon_Once_A_Day=function(){map_user_event_dungeon_once_a_day.clear()},Instance.delete_User_Event_Dungeon_Personal_Accm_Point=function(){map_user_event_dungeon_personal_point_bonus_log.clear()},Instance.insert_User_Event_Dungeon_Personal_Accm_Point_Info=function(rewards){for(var idx=0;idx<rewards.length;idx++){var e=rewards[idx];map_user_event_dungeon_personal_point_bonus_log.insert([m_user_id,e.event_dungeon_group_idx,e.step],e)}},Instance.update_User_Event_Dungeon_Once_A_Day=function(dungeon){var my_once_a_day=map_user_event_dungeon_once_a_day.at([m_user_id,dungeon.event_dungeon_period_idx,dungeon.event_dungeon_once_a_day_idx]);if(null!=my_once_a_day)my_once_a_day.complete_yn=dungeon.complete_yn,map_user_event_dungeon_once_a_day.insert([m_user_id,dungeon.event_dungeon_period_idx,dungeon.event_dungeon_once_a_day_idx],my_once_a_day);else{var once_a_day={};once_a_day.user_id=m_user_id,once_a_day.event_dungeon_period_idx=dungeon.event_dungeon_period_idx,once_a_day.event_dungeon_once_a_day_idx=dungeon.event_dungeon_once_a_day_idx,once_a_day.complete_yn=dungeon.complete_yn,map_user_event_dungeon_once_a_day.insert([m_user_id,dungeon.event_dungeon_period_idx,dungeon.event_dungeon_once_a_day_idx],once_a_day)}},Instance.update_User_Event_Dungeon_Task=function(user_task){var user_evnetdungeon_task;null==map_user_event_dungeon_task.at([m_user_id,user_task.event_dungeon_period_idx,user_task.event_dungeon_id,user_task.num])?((user_evnetdungeon_task={}).user_id=m_user_id,user_evnetdungeon_task.event_dungeon_period_idx=user_task.event_dungeon_period_idx,user_evnetdungeon_task.event_dungeon_id=user_task.event_dungeon_id,user_evnetdungeon_task.num=user_task.num,user_evnetdungeon_task.count=user_task.count,user_evnetdungeon_task.complete_yn=user_task.complete_yn,map_user_event_dungeon_task.insert([m_user_id,user_evnetdungeon_task.event_dungeon_period_idx,user_evnetdungeon_task.event_dungeon_id,user_evnetdungeon_task.num],user_evnetdungeon_task)):((user_evnetdungeon_task={}).user_id=m_user_id,user_evnetdungeon_task.event_dungeon_period_idx=user_task.event_dungeon_period_idx,user_evnetdungeon_task.event_dungeon_id=user_task.event_dungeon_id,user_evnetdungeon_task.num=user_task.num,user_evnetdungeon_task.count=user_task.count,user_evnetdungeon_task.complete_yn=user_task.complete_yn,map_user_event_dungeon_task.remove([m_user_id,user_evnetdungeon_task.event_dungeon_period_idx,user_evnetdungeon_task.event_dungeon_id,user_evnetdungeon_task.num]),map_user_event_dungeon_task.insert([m_user_id,user_evnetdungeon_task.event_dungeon_period_idx,user_evnetdungeon_task.event_dungeon_id,user_evnetdungeon_task.num],user_evnetdungeon_task))},Instance.get_User_Event_Dungeon_Task=function(){return map_user_event_dungeon_task},Instance.get_user_event_dungeon_once_a_day=function(){return map_user_event_dungeon_once_a_day},Instance.get_user_step_up_gacha_buy_log=function(){return _step_up_gacha_buy_log},Instance.insert_User_Daily_Dungeon=function(res){User_daily_dungeon=[];for(var idx=0;idx<res.length;idx++)User_daily_dungeon.push(res[idx])},Instance.delete_User_Food_Infos=function(){map_User_Food_List.clear()},Instance.delete_User_Food_Info=function(food_key){map_User_Food_List.erase([m_user_id,food_key.food_id,food_key.food_num])},Instance.insert_User_Food_Info=function(user_food){map_User_Food_List.insert([m_user_id,user_food.food_id,user_food.food_num],user_food)},Instance.getUserFoodList=function(user_foods){for(var keys=map_User_Food_List.keys(),i=0;i<keys.length;i++){var food=this.map_User_Food_List.at(keys[i]);user_foods.push_back(food)}},Instance.getUserFood=function(key){return map_User_Food_List.at([m_user_id,key.food_id,key.food_num])},Instance.getUserFoodCount=function(){return map_User_Food_List.size()},Instance.get_User_Event_Dungeon_Vote_League_Record=function(){return list_User_Event_Dungeon_Vote_League_Record},Instance.delete_User_Event_Dungeon_Vote_League_Reward=function(){map_user_event_dungeon_vote_league_reward.clear()},Instance.insert_User_Event_Dungeon_Vote_League_Rewards=function(list){list.forEach(function(info){Instance.insert_User_Event_Dungeon_Vote_League_Reward(info)})},Instance.insert_User_Event_Dungeon_Vote_League_Reward=function(info){map_user_event_dungeon_vote_league_reward.insert([m_user_id,info.event_dungeon_group_idx,info.league_reward_idx],info)},Instance.update_User_Event_Dungeon_Vote_League_Reward=function(){},Instance.delete_User_Event_Dungeon_Use_Point_Reward=function(){map_user_event_dungeon_vote_league_use_point_reward.clear()},Instance.get_user_event_dungeon_vote_league_reward=function(){return map_user_event_dungeon_vote_league_reward},Instance.insert_User_Event_Dungeon_Use_Point_Rewards=function(list){list.forEach(function(info){Instance.insert_User_Event_Dungeon_Use_Point_Reward(info)})},Instance.insert_User_Event_Dungeon_Use_Point_Reward=function(info){map_user_event_dungeon_vote_league_use_point_reward.insert([m_user_id,info.event_dungeon_period_idx,info.reward_idx],info)},Instance.update_User_Event_Dungeon_Use_Point_Reward=function(info){var point_rewad_info={event_dungeon_period_idx:info.event_dungeon_period_idx,reward_idx:info.event_dungeon_reward_idx,reward_yn:info.rewarded_yn};map_user_event_dungeon_vote_league_use_point_reward.insert([m_user_id,point_rewad_info.event_dungeon_period_idx,point_rewad_info.reward_idx],point_rewad_info)},Instance.get_user_event_dungeon_vote_league_use_point_reward=function(){return map_user_event_dungeon_vote_league_use_point_reward},Instance.update_User_Christmas_Reward=function(bonus_type,count,event_dungeon_group_idx){var is_exist=!1;if(1==Instance.plus_User_Christmas_Reward(bonus_type,count,event_dungeon_group_idx)){for(var idx=0;idx<m_Res_Get_User_Event_Dungeon_Christmas_Info.user_event_dungeon_christmas_reward.length;idx++){var christmas_rewad=m_Res_Get_User_Event_Dungeon_Christmas_Info.user_event_dungeon_christmas_reward[idx];if(event_dungeon_group_idx==christmas_rewad.event_dungeon_group_idx&&bonus_type==christmas_rewad.bonus_type){is_exist=!0,christmas_rewad.bonus_count+=count,christmas_rewad.accum_count+=count;break}}if(0==is_exist){var reward={};reward.event_dungeon_group_idx=event_dungeon_group_idx,reward.bonus_type=bonus_type,reward.bonus_count=count,reward.accum_count=count,m_Res_Get_User_Event_Dungeon_Christmas_Info.user_event_dungeon_christmas_reward.push_back(reward)}m_Res_Get_User_Event_Dungeon_Christmas_Info.event_dungeon_group_idx==event_dungeon_group_idx&&(m_Res_Get_User_Event_Dungeon_Christmas_Info.bonus_count+=count,m_Res_Get_User_Event_Dungeon_Christmas_Info.accum_count+=count),Instance.plus_User_Christmas_Personal_Point_Reward(count,event_dungeon_group_idx)}},Instance.delete_User_Christmas_Reward=function(event_dungeon_group_idx){map_user_event_dungeon_christmas_reward.remove([m_user_id,event_dungeon_group_idx]),map_user_event_dungeon_christmas_total_reward_info.remove([m_user_id,event_dungeon_group_idx])},Instance.plus_User_Christmas_Reward=function(bonus_type,count,event_dungeon_group_idx){var christmas_reward=map_user_event_dungeon_christmas_reward.at([m_user_id,event_dungeon_group_idx,bonus_type]);if(null!=christmas_reward&&null==christmas_reward.accum_count&&(christmas_reward.accum_count=-1),null!=christmas_reward&&-1<christmas_reward.accum_count){var max_bonus_info=MasterManager.getInstance().get_CountFunction(COUNT_FUNCTION_CHRISTMAS_TREE_BONUS_MAX);if(christmas_reward.accum_count>=max_bonus_info.value)return!1;christmas_reward.accum_count+count>max_bonus_info.value&&(count=max_bonus_info.value-christmas_reward.accum_count),christmas_reward.bonus_count=christmas_reward.bonus_count+count,christmas_reward.accum_count=christmas_reward.accum_count+count,map_user_event_dungeon_christmas_reward.insert([m_user_id,event_dungeon_group_idx,bonus_type],christmas_reward)}else{var bonus={};bonus.user_id=m_user_id,bonus.event_dungeon_group_idx=event_dungeon_group_idx,bonus.bonus_type=bonus_type,bonus.bonus_count=count,bonus.accum_count=count,map_user_event_dungeon_christmas_reward.insert([m_user_id,event_dungeon_group_idx,bonus.bonus_type],bonus)}return!0},Instance.plus_User_Christmas_Personal_Point_Reward=function(count,event_dungeon_group_idx){var christmas_reward=map_user_event_dungeon_christmas_total_reward_info.at([m_user_id,event_dungeon_group_idx]);if(null!=christmas_reward)christmas_reward.bonus_count=christmas_reward.bonus_count+count,christmas_reward.accum_count=christmas_reward.accum_count+count,map_user_event_dungeon_christmas_total_reward_info.insert([m_user_id,event_dungeon_group_idx],christmas_reward);else{var bonus={};bonus.user_id=m_user_id,bonus.event_dungeon_group_idx=event_dungeon_group_idx,bonus.bonus_count=count,bonus.accum_count=count,map_user_event_dungeon_christmas_total_reward_info.insert([m_user_id,event_dungeon_group_idx],bonus)}},Instance.update_Event_Once_A_Day_Dungeon_Battle_Win=function(res){var period=MasterManager.getInstance().get_EventDungeonPeriod(res.event_dungeon_period_idx);UserService.getInstance();Instance.upd_User_Key(res.user_key),Instance.upd_UserItemRaidTicket(res.user_raid_ticket),Instance.upd_UserRaidHelpTicket(res.user_raid_help_ticket),USE_NEW_RAID_DUNGEON&&(Instance.upd_UserItemNewRaidCallTicket(res.user_new_raid_boss_call_key),Instance.upd_UserItemNewRaidConquestTicket(res.user_new_raid_boss_conquest_key)),Instance.upd_UserJade(res.user_jade),Instance.upd_UserGold(res.user_gold),Instance.upd_UserHeart(res.user_heart),Instance.upd_UserFormationPoint(res.user_formation_point),Instance.upd_UserLevelExp(res.user_level,res.user_exp);var dungeon={};dungeon.event_dungeon_period_idx=res.event_dungeon_period_idx,dungeon.event_dungeon_once_a_day_idx=res.event_dungeon_once_a_day_idx,dungeon.complete_yn="y",Instance.update_User_Event_Dungeon_Once_A_Day(dungeon);for(var idx=0;idx<res.bonus_items.length;idx++){var b=res.bonus_items[idx];if(b.bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX){var gnrl={};gnrl.gnrl_id=b.bonus_idx,gnrl.gnrl_num=b.bonus_num,gnrl.gnrl_level=b.bonus_level,gnrl.castle_id=b.castle_id,gnrl.used_in_camp="n",gnrl.using_in_camp="n",Instance.insert_User_General_V2(gnrl)}else if(b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7)Instance.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)Instance.plus_User_Love_Item(b.bonus_idx,b.bonus_num);else if(b.bonus_type==BONUS_TYPE_HEART);else if(b.bonus_type==BONUS_TYPE_JADE);else if(b.bonus_type==BONUS_TYPE_GOLD);else if(b.bonus_type==BONUS_TYPE_KEY);else if(b.bonus_type==BONUS_TYPE_RAID_TICKET);else if(b.bonus_type==BONUS_TYPE_EVENT_POINT)Instance.plus_User_Event_Point(b.bonus_idx,b.bonus_num),cc.log(""+b.bonus_idx+b.bonus_num);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE||b.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE)Instance.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_EVOLVE_ORB)Instance.plus_User_Evolve_Orb(b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL)Instance.plus_User_Magic_Key_Mtrl(b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&b.bonus_type<=BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND){var craft_shop_bonus_type=b.bonus_type-BONUS_TYPE_CRAFT_SHOP_FIRST_LOW+4;Instance.plus_User_Craft_Shop_Material(craft_shop_bonus_type,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EQUIPMENT)Instance.insert_User_Equipment(b.equipment);else if(b.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||b.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL){var limit_over_mtrl_type=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(b.bonus_type);Instance.plus_User_Limit_Over_Mtrl(limit_over_mtrl_type,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EVENT_DUNGEON_SPECIAL_POINT);else if(b.bonus_type==BONUS_TYPE_USER_EXP);else if(b.bonus_type>=BONUS_TYPE_CHRISTMAS_RIBBON&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_APPLE){craft_shop_bonus_type=GeneralService.getInstance().getBonusTypeToCraftShopMtrlType(b.bonus_type);Instance.plus_User_Craft_Shop_Material(craft_shop_bonus_type,b.bonus_idx)}else if(b.bonus_type>=BONUS_TYPE_CHRISTMAS_SANTA&&b.bonus_type<=BONUS_TYPE_CHRISTMAS_SNOWMAN)Instance.update_User_Christmas_Reward(b.bonus_type,b.bonus_num,period.event_dungeon_group_idx);else if(b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){var rebirth_mtrl_type=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(b.bonus_type);Instance.plus_User_Rebirth_Mtrl(rebirth_mtrl_type,b.bonus_idx)}else b.bonus_type==BONUS_TYPE_SKIP_TICKET?Instance.plus_User_Skip_Ticket(b.bonus_idx):b.bonus_type==BONUS_TYPE_EXCHANGE_TICKET?Instance.plus_User_Exchange_Ticket(b.bonus_idx):b.bonus_type==BONUS_TYPE_SPECIAL_GACHA_TICKET&&Instance.plus_User_Special_Gacha_Ticket(b.bonus_idx,b.bonus_level)}Instance.upd_UserGeneralLevelExp(res.gnrl_exp)},Instance.update_General_Rebirth=function(res){var before_gnrl_key={};before_gnrl_key.gnrl_id=res.del_gnrl_key.gnrl_id,before_gnrl_key.gnrl_num=res.del_gnrl_key.gnrl_num;var before_gnrl_info=this.getUserGeneral({},before_gnrl_key);this.insert_User_General_V2(res.new_gnrl);var new_gnrl_info=new db.UserGeneralInfo,new_gnrl_key={};new_gnrl_key.gnrl_id=res.new_gnrl.gnrl_id,new_gnrl_key.gnrl_num=res.new_gnrl.gnrl_num,(new_gnrl_info=this.getUserGeneral({},new_gnrl_key)).gnrl_level=before_gnrl_info.gnrl_level,new_gnrl_info.gnrl_exp=before_gnrl_info.gnrl_exp,new_gnrl_info.love_level=before_gnrl_info.love_level,new_gnrl_info.love_exp=before_gnrl_info.love_exp,new_gnrl_info.limit_step_id=before_gnrl_info.limit_step_id,new_gnrl_info.lock_yn=before_gnrl_info.lock_yn,new_gnrl_info.using_in_camp=before_gnrl_info.using_in_camp,new_gnrl_info.used_in_camp=before_gnrl_info.used_in_camp,new_gnrl_info.display_class=before_gnrl_info.display_class,this.update_User_General(new_gnrl_info);var new_gnrl_id=res.new_gnrl.gnrl_id,new_gnrl_num=res.new_gnrl.gnrl_num,partner=GameContext.getInstance().getUserGeneralPartner();if(partner.gnrl_id==res.del_gnrl_key.gnrl_id&&partner.gnrl_num==res.del_gnrl_key.gnrl_num){var new_partner={};new_partner.gnrl_id=new_gnrl_id,new_partner.gnrl_num=new_gnrl_num,GameContext.getInstance().setUserGeneralParnter(new_partner)}var main_gnrl=GameContext.getInstance().getUserFriendPartner();if(main_gnrl.gnrl_id==res.del_gnrl_key.gnrl_id&&main_gnrl.gnrl_num==res.del_gnrl_key.gnrl_num){var new_friend_partner={};new_friend_partner.gnrl_id=new_gnrl_id,new_friend_partner.gnrl_num=new_gnrl_num,GameContext.getInstance().setUserFriendPartner(new_friend_partner)}this.updateEventDungeonSearchTroopsGeneralEvolution(res.del_gnrl_key,res.new_gnrl),"y"==res.new_yn&&this.insert_User_Book_General_Evolution(res.new_gnrl,"y"),Instance.upd_UserGold(res.user_gold),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);for(var old_equips=[],i=0;i<res.equip_keys.length;i++)77777<=res.equip_keys[i].equipment_item_idx&&old_equips.push(res.equip_keys[i]);var new_equips=[];for(i=0;i<res.equip_keys.length;i++)res.equip_keys[i].equipment_item_idx<77777&&new_equips.push(res.equip_keys[i]);this.update_User_Gnrl_Equipment(res.del_gnrl_key,new_gnrl_key,old_equips);for(var idx=0;idx<new_equips.length;idx++){var found=_user_general_new_equipments.user_general_equips.findIndex(function(eq){return eq.equipment_item_idx==new_equips[idx].equipment_item_idx&&eq.equipment_num==new_equips[idx].equipment_num&&eq.gnrl_id==res.del_gnrl_key.gnrl_id&&eq.gnrl_num==res.del_gnrl_key.gnrl_num});-1!=found&&(_user_general_new_equipments.user_general_equips[found].gnrl_id=res.new_gnrl.gnrl_id,_user_general_new_equipments.user_general_equips[found].gnrl_num=res.new_gnrl.gnrl_num)}this.remove_User_General(res.del_gnrl_key),Instance.delete_User_Rebirth_Mtrl(),Instance.insert_User_Rebirth_Mtrl(res.rebirth_mtrl_info)},Instance.update_Mussgang_Tower_Battle_Win=function(res){Instance.upd_UserJade(res.user_jade),Instance.upd_UserGold(res.user_gold),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);for(var idx=0;idx<res.drop_bonus_items.length;idx++){var b=res.drop_bonus_items[idx];if(b.bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX){var gnrl={};gnrl.gnrl_id=b.bonus_idx,gnrl.gnrl_num=b.bonus_num,gnrl.gnrl_level=b.bonus_level,gnrl.castle_id=b.castle_id,gnrl.used_in_camp="n",gnrl.using_in_camp="n",Instance.insert_User_General(gnrl)}else if(b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7)Instance.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)Instance.plus_User_Love_Item(b.bonus_idx,b.bonus_num);else if(b.bonus_type==BONUS_TYPE_HEART);else if(b.bonus_type==BONUS_TYPE_JADE);else if(b.bonus_type==BONUS_TYPE_GOLD);else if(b.bonus_type==BONUS_TYPE_KEY);else if(b.bonus_type==BONUS_TYPE_RAID_TICKET);else if(b.bonus_type==BONUS_TYPE_EVENT_POINT);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE||b.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE)Instance.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_EVOLVE_ORB)Instance.plus_User_Evolve_Orb(b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL)Instance.plus_User_Magic_Key_Mtrl(b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&b.bonus_type<=BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND){var craft_shop_bonus_type=b.bonus_type-BONUS_TYPE_CRAFT_SHOP_FIRST_LOW+4;Instance.plus_User_Craft_Shop_Material(craft_shop_bonus_type,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EQUIPMENT)Instance.insert_User_Equipment(b.equipment);else if(b.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||b.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL){var limit_over_mtrl_type=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(b.bonus_type);Instance.plus_User_Limit_Over_Mtrl(limit_over_mtrl_type,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EVENT_DUNGEON_SPECIAL_POINT);else if(b.bonus_type==BONUS_TYPE_USER_EXP);else if(b.bonus_type==BONUS_TYPE_HN_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_R_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_HR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_SR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_R_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_HR_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_SR_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_HIGH_ENGAGE_TEN||b.bonus_type==BONUS_TYPE_NORMAL_ENGAGE_TEN||b.bonus_type==BONUS_TYPE_HIGH_ENGAGE||b.bonus_type==BONUS_TYPE_NORMAL_ENGAGE||b.bonus_type==BONUS_TYPE_HIGH_ENGAGE_TEN_ARMY||b.bonus_type==BONUS_TYPE_NORMAL_ENGAGE_TEN_ARMY||b.bonus_type==BONUS_TYPE_HIGH_ENGAGE_ARMY||b.bonus_type==BONUS_TYPE_NORMAL_ENGAGE_ARMY||b.bonus_type==BONUS_TYPE_RETURN_USER_GIFT_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_LOGIN_GIFT_BOX||b.bonus_type==BONUS_TYPE_JADE_RANDOM_BOX||b.bonus_type==BONUS_TYPE_GOLD_RANDOM_BOX||b.bonus_type==BONUS_TYPE_LOVE_ITEM_RANDOM_BOX||b.bonus_type==BONUS_TYPE_RARE_HWANDAN_RANDOM_BOX||b.bonus_type==BONUS_TYPE_EXP_CARD_RANDOM_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_GIFT_BOX||b.bonus_type==BONUS_TYPE_LUCKY_BOX||b.bonus_type==BONUS_TYPE_SWORD_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_SPEAR_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_ARCHER_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_RANDOM_BOX||b.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_GIFT_BOX||b.bonus_type==BONUS_TYPE_TREASURE_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_BOX_v2||b.bonus_type==BONUS_TYPE_CHRISTMAS_BOX_V3||b.bonus_type==BONUS_TYPE_EVENTDUNGEON_PRESENT_GIFT_BOX||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_1||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_2||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_3||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_4||b.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_GACHA_REBORN_GNRL_TICKET||b.bonus_type==BONUS_TYPE_ALL_RARE_TYPE_GNRL_SELECT_TICKET||b.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET||b.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET_V2||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_2||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_3||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_4||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_5||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_6||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_7||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_8||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_9||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_10||b.bonus_type>=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_11&&b.bonus_type<=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_23||b.bonus_type>=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_31&&b.bonus_type<=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_80);else if(b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){var rebirth_mtrl_type=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(b.bonus_type);Instance.plus_User_Rebirth_Mtrl(rebirth_mtrl_type,b.bonus_idx)}else b.bonus_type==BONUS_TYPE_FORMATION_POINT?Instance.plus_User_Formation_Point(b.bonus_idx):b.bonus_type>=BONUS_TYPE_ATTK_POINT&&b.bonus_type<=BONUS_TYPE_CRI_DMG_POINT?Instance.plus_User_Formation_Property_Point(b.bonus_type,b.bonus_idx):b.bonus_type==BONUS_TYPE_WORLD_WAR_UNIQUE_EQUIPMENT_TICKET&&NetServiceV3.getInstance().plus_Unique_Equipment_Ticket(b.bonus_idx)}var tower={};tower.period_idx=res.mussang_tower_period_idx,tower.mussang_tower_id=res.mussang_tower_idx,tower.win_count=res.win_count,tower.new_yn="n",tower.complete_yn=res.complete_yn,this.update_User_Mussang_Tower(tower);var task_list=[];for(idx=0;idx<res.cmplt_task_ids.length;idx++){if(0!=res.cmplt_task_ids[idx]){var task={};task.period_idx=res.mussang_tower_period_idx,task.mussang_tower_id=res.mussang_tower_idx,task.task_id=res.cmplt_task_ids[idx],task_list.push_back(task)}}if(this.update_User_Mussang_Tower_Task(task_list),"y"==res.lotus_bonus_new_yn){var lotus_log=m_user_mussang_tower_lotus_log.at([m_user_id,res.mussang_tower_period_idx,res.lotus_open_count]);if(null==lotus_log){var user_tower={};user_tower.user_id=m_user_id,user_tower.period_idx=res.mussang_tower_period_idx,user_tower.lotus_count=res.lotus_open_count,user_tower.new_yn=res.lotus_bonus_new_yn,user_tower.complete_yn="n",m_user_mussang_tower_lotus_log.insert([m_user_id,res.mussang_tower_period_idx,res.lotus_open_count],user_tower)}else lotus_log.new_yn=res.lotus_bonus_new_yn,lotus_log.user_id=m_user_id,lotus_log.period_idx=res.mussang_tower_period_idx,lotus_log.lotus_count=res.lotus_open_count,m_user_mussang_tower_lotus_log.insert([m_user_id,res.mussang_tower_period_idx,res.lotus_open_count],lotus_log)}},Instance.update_Mussgang_Tower_Battle_Lose=function(res){},Instance.get_Map_User_Main_Mission_Task=function(){return map_user_main_mission_task},Instance.get_user_main_story_hard_mode_missions=function(){return _user_main_story_hard_mode_missions},Instance.get_user_gnrl_piece_item=function(){return _user_gnrl_piece_item},Instance.get_user_new_equipment_make_materials=function(){return _user_new_equipment_make_materials},Instance.get_user_new_equipment_enhance_materials=function(){return _user_new_equipment_enhance_materials},Instance.get_user_new_equipment_enchant_tickets=function(){return _user_new_equipment_enchant_tickets},Instance.get_user_new_equipment_smelt_materials=function(){return _user_new_equipment_smelt_materials},Instance.get_user_camp_gnrl_factory_exchange_item=function(){return _user_camp_gnrl_factory_exchange_item},Instance.get_user_main_story_hard_mode_mission_tasks=function(){return _user_main_story_hard_mode_mission_tasks},Instance.get_user_main_story_hard_mode_lotus_reward_log=function(){return _user_main_story_hard_mode_lotus_reward_log},Instance.get_Map_User_Main_Mission=function(){return map_user_main_mission},Instance.get_User_Event_Dungeon_Satisfaction_Info=function(){return m_Res_Get_User_Event_Dungeon_Satisfaction_Info},Instance.get_User_Event_Dungeon_Search_Troops=function(){return map_User_Event_Dungeon_Search_Troops},Instance.get_User_Event_Dungeon_Search_Troops_Generals=function(troops_num){if(null==troops_num)return map_User_Event_Dungeon_Search_Troops_Generals;if("string"!=typeof troops_num)return null==(troops=map_User_Event_Dungeon_Search_Troops_Generals.at(troops_num))&&(troops=[]),troops;for(var troops_gnrls=[],keys=map_User_Event_Dungeon_Search_Troops_Generals.keys(),idx=0;idx<keys.length;idx++)for(var troops=map_User_Event_Dungeon_Search_Troops_Generals.at(keys[idx]),jdx=0;jdx<troops.length;jdx++)troops_gnrls.push(troops[jdx]);return troops_gnrls},Instance.get_User_Event_Dungeon_Search_Area_Info=function(search_area_idx){if(null==search_area_idx)return map_Event_Dungeon_Search_Area_Info;for(var user_event_dungeon_search_area_info={event_dungeon_period_idx:0,troops_num:0,search_area_idx:0,add_great_success:0,total_attk_pwr:0},area_keys=map_Event_Dungeon_Search_Area_Info.keys(),i=0;i<area_keys.length;i++)if(area_keys[i]==search_area_idx){user_event_dungeon_search_area_info=map_Event_Dungeon_Search_Area_Info.at(area_keys[i]);break}return user_event_dungeon_search_area_info},Instance.update_User_Mussang_Tower=function(tower){var my_tower=m_user_mussang_tower.at([m_user_id,tower.period_idx,tower.mussang_tower_id]);null==my_tower?m_user_mussang_tower.insert([m_user_id,tower.period_idx,tower.mussang_tower_id],tower):(my_tower.win_count=tower.win_count,my_tower.new_yn=tower.new_yn,my_tower.complete_yn=tower.complete_yn)},Instance.update_User_Mussang_Tower_Task=function(user_task){for(var idx=0;idx<user_task.length;idx++){var task=user_task[idx];if(null==m_user_mussang_tower_task.at([m_user_id,task.period_idx,task.mussang_tower_id,task.task_id])){var user_tower_task={};user_tower_task.user_id=m_user_id,user_tower_task.period_idx=task.period_idx,user_tower_task.mussang_tower_id=task.mussang_tower_id,user_tower_task.task_id=task.task_id,m_user_mussang_tower_task.insert([m_user_id,user_tower_task.period_idx,user_tower_task.mussang_tower_id,user_tower_task.task_id],user_tower_task)}}},Instance.update_User_Event_Dungeon_Reward_Shop=function(reward){var user_reward_shop=map_user_event_dungeon_reward_shop.at([m_user_id,reward.event_dungeon_period_idx,reward.event_dungeon_reward_shop_idx]);null!=user_reward_shop?user_reward_shop.buy_count=reward.buy_count:map_user_event_dungeon_reward_shop.insert([m_user_id,reward.event_dungeon_period_idx,reward.event_dungeon_reward_shop_idx],reward)},Instance.delete_User_Rebirth_Mtrl=function(){map_User_Rebirth_Mtrl.clear()},Instance.insert_User_Rebirth_Mtrl=function(list){for(var idx=0;idx<list.length;idx++){var user_rebirth_mtrl=list[idx];map_User_Rebirth_Mtrl.insert(user_rebirth_mtrl.rebirth_mtrl_type,user_rebirth_mtrl)}},Instance.update_User_Rebirth_Mtrl=function(user_rebirth_mtrl){map_User_Rebirth_Mtrl.insert(user_rebirth_mtrl.rebirth_mtrl_type,user_rebirth_mtrl)},Instance.plus_User_Rebirth_Mtrl=function(rebirth_mtrl_type,mtrl_count){if(null!=map_User_Rebirth_Mtrl.at(rebirth_mtrl_type))map_User_Rebirth_Mtrl.at(rebirth_mtrl_type).mtrl_count+=mtrl_count;else{var user_rebirth_mtrl={};user_rebirth_mtrl.rebirth_mtrl_type=rebirth_mtrl_type,user_rebirth_mtrl.mtrl_count=mtrl_count,map_User_Rebirth_Mtrl.insert(rebirth_mtrl_type,user_rebirth_mtrl)}},Instance.delete_User_Naming_Info=function(){m_user_naming.clear()},Instance.get_user_naming=function(){return m_user_naming},Instance.insert_User_Naming_Info=function(user_naming_list){for(var idx=0;idx<user_naming_list.length;idx++){var user_naming=user_naming_list[idx];m_user_naming.insert(user_naming.naming_id,user_naming)}},Instance.update_Great_Wall_Dungeon_Battle_Begin=function(res){if(0!=res.great_wall_dungeon_period_idx){var found=_great_wall_dungeon_list.dungeon_list.findIndex(function(d){return d.great_wall_dungeon_period_idx==res.great_wall_dungeon_period_idx&&d.great_wall_dungeon_group_idx==res.great_wall_dungeon_group_idx&&d.great_wall_dungeon_idx==res.great_wall_dungeon_idx});if(-1!=found)_great_wall_dungeon_list.dungeon_list[found].first_clear_yn=res.first_clear_yn,_great_wall_dungeon_list.dungeon_list[found].complete_yn=res.complete_yn,_great_wall_dungeon_list.dungeon_list[found].npc_list=res.npc_list;else{var dungeon={};dungeon.great_wall_dungeon_period_idx=res.great_wall_dungeon_period_idx,dungeon.great_wall_dungeon_group_idx=res.great_wall_dungeon_group_idx,dungeon.great_wall_dungeon_idx=res.great_wall_dungeon_idx,dungeon.first_clear_yn=res.first_clear_yn,dungeon.complete_yn=res.complete_yn,dungeon.npc_list=res.npc_list,_great_wall_dungeon_list.dungeon_list.push_back(dungeon)}Instance.upd_UserGreatWall_Ticket(res.user_great_wall_ticket),_great_wall_troops_info.partin_generals=res.partin_generals}},Instance.update_Great_Wall_Dungeon_Battle_Win=function(res){if(0!=res.great_wall_dungeon_period_idx){Instance.clearBattleDungeonContinue(),_great_wall_troops_info.partin_generals=res.partin_generals;for(var idx=0;idx<_great_wall_troops_info.troops_list.length;idx++){var t=_great_wall_troops_info.troops_list[idx];t.troops_num==res.troops_num&&(t.troops_generls.clear(),t.troops_generls=res.troops_generals)}var found;if(-1!=(found=_great_wall_dungeon_list.dungeon_list.findIndex(function(d){return d.great_wall_dungeon_period_idx==res.great_wall_dungeon_period_idx&&d.great_wall_dungeon_idx==res.great_wall_dungeon_idx&&d.great_wall_dungeon_group_idx==res.great_wall_dungeon_group_idx}))&&(_great_wall_dungeon_list.dungeon_list[found].npc_list.clear(),_great_wall_dungeon_list.dungeon_list[found].complete_yn=res.complete_yn,_great_wall_dungeon_list.dungeon_list[found].first_clear_yn=res.first_clear_yn),Instance.upd_UserJade(res.user_jade),Instance.upd_UserGold(res.user_gold),Instance.upd_UserHeart(res.user_heart),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation),-1!=(found=_great_wall_dungeon_list.dungeon_list.findIndex(function(d){return d.great_wall_dungeon_period_idx==res.great_wall_dungeon_period_idx&&d.great_wall_dungeon_group_idx==res.great_wall_dungeon_group_idx&&d.great_wall_dungeon_idx==res.great_wall_dungeon_idx})))_great_wall_dungeon_list.dungeon_list[found].first_clear_yn=res.first_clear_yn,_great_wall_dungeon_list.dungeon_list[found].complete_yn=res.complete_yn,_great_wall_dungeon_list.dungeon_list[found].npc_list.clear();else{var dungeon={};dungeon.great_wall_dungeon_period_idx=res.great_wall_dungeon_period_idx,dungeon.great_wall_dungeon_group_idx=res.great_wall_dungeon_group_idx,dungeon.great_wall_dungeon_idx=res.great_wall_dungeon_idx,dungeon.first_clear_yn=res.first_clear_yn,dungeon.complete_yn=res.complete_yn,_great_wall_dungeon_list.dungeon_list.push_back(dungeon)}for(idx=0;idx<res.bonus_items.length;idx++){var b=res.bonus_items[idx];if(b.bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX){var gnrl={};gnrl.gnrl_id=b.bonus_idx,gnrl.gnrl_num=b.bonus_num,gnrl.gnrl_level=b.bonus_level,gnrl.castle_id=b.castle_id,gnrl.used_in_camp="n",gnrl.using_in_camp="n",Instance.insert_User_General_V2(gnrl)}else if(b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7)Instance.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)Instance.plus_User_Love_Item(b.bonus_idx,b.bonus_num);else if(b.bonus_type==BONUS_TYPE_HEART);else if(b.bonus_type==BONUS_TYPE_JADE);else if(b.bonus_type==BONUS_TYPE_GOLD);else if(b.bonus_type==BONUS_TYPE_KEY);else if(b.bonus_type==BONUS_TYPE_RAID_TICKET);else if(b.bonus_type==BONUS_TYPE_EVENT_POINT);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE||b.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE)Instance.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL)Instance.plus_User_Magic_Key_Mtrl(b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_EVOLVE_ORB)Instance.plus_User_Evolve_Orb(b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_CRAFT_SHOP_FIRST_LOW&&b.bonus_type<=BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND){var craft_shop_bonus_type=b.bonus_type-BONUS_TYPE_CRAFT_SHOP_FIRST_LOW+4;Instance.plus_User_Craft_Shop_Material(craft_shop_bonus_type,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_EQUIPMENT){MasterManager.getInstance().get_EquipmentItem(b.equipment.equipment_item_idx).equipment_type!=EQUIPMENT_TYPE_EXP&&Instance.insert_User_Equipment(b.equipment)}else if(b.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||b.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL){var limit_over_mtrl_type=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(b.bonus_type);Instance.plus_User_Limit_Over_Mtrl(limit_over_mtrl_type,b.bonus_idx)}else b.bonus_type==BONUS_TYPE_EVENT_DUNGEON_SPECIAL_POINT||b.bonus_type==BONUS_TYPE_USER_EXP||b.bonus_type==BONUS_TYPE_JADE_RANDOM_BOX||b.bonus_type==BONUS_TYPE_GOLD_RANDOM_BOX||b.bonus_type==BONUS_TYPE_LOVE_ITEM_RANDOM_BOX||b.bonus_type==BONUS_TYPE_RARE_HWANDAN_RANDOM_BOX||b.bonus_type==BONUS_TYPE_EXP_CARD_RANDOM_BOX||b.bonus_type==BONUS_TYPE_CHRISTMAS_GIFT_BOX||b.bonus_type==BONUS_TYPE_SWORD_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_SPEAR_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_ARCHER_ORB_RANDDOM_BOX||b.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_RANDOM_BOX||b.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_GIFT_BOX||b.bonus_type==BONUS_TYPE_EVENTDUNGEON_PRESENT_GIFT_BOX||b.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_R_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_HR_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_SR_RARE_TYPE_ENGAGE||b.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_HN_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_R_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_HR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_SR_RARE_TYPE_SELECT||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_1||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_2||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_3||b.bonus_type==BONUS_TYPE_EQUIPMENT_EXP_BOX_4||b.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_GACHA_REBORN_GNRL_TICKET||b.bonus_type==BONUS_TYPE_ALL_RARE_TYPE_GNRL_SELECT_TICKET||b.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET||b.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET_V2||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_2||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_3||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_4||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_5||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_6||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_7||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_8||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_9||b.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_10||b.bonus_type>=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_11&&b.bonus_type<=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_23||b.bonus_type>=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_31&&(b.bonus_type,BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_80)}}},Instance.update_Great_Wall_Dungeon_Battle_Lose=function(res){if(0!=res.great_wall_dungeon_period_idx){Instance.clearBattleDungeonContinue(),_great_wall_troops_info.partin_generals=res.partin_generals;var found=_great_wall_dungeon_list.dungeon_list.findIndex(function(d){return d.great_wall_dungeon_period_idx==res.great_wall_dungeon_period_idx&&d.great_wall_dungeon_idx==res.great_wall_dungeon_idx&&d.great_wall_dungeon_group_idx==res.great_wall_dungeon_group_idx});-1!=found&&(_great_wall_dungeon_list.dungeon_list[found].npc_list=res.npc_list);for(var idx=0;idx<_great_wall_troops_info.troops_list.length;idx++){var t=_great_wall_troops_info.troops_list[idx];t.troops_num==res.troops_num&&(t.troops_generls.clear(),t.troops_generls=res.troops_generals)}}},Instance.update_Great_Wall_Dungeon_Battle_Check=function(res){"n"==res.battle_continue_yn&&Instance.clearBattleDungeonContinue(),Instance.upd_UserGreatWall_Ticket(res.user_great_wall_ticket)},Instance.delete_User_Mussang_Tower=function(){m_user_mussang_tower.clear()},Instance.insert_User_Mussang_Tower=function(user_towers){for(var idx=0;idx<user_towers.length;idx++){var tower=user_towers[idx],user_tower={};user_tower.user_id=m_user_id,user_tower.period_idx=tower.period_idx,user_tower.mussang_tower_id=tower.mussang_tower_id,user_tower.win_count=tower.win_count,user_tower.new_yn=tower.new_yn,user_tower.complete_yn=tower.complete_yn,m_user_mussang_tower.insert([user_tower.user_id,user_tower.period_idx,user_tower.mussang_tower_id],user_tower)}},Instance.delete_User_Mussang_Tower_Task=function(){m_user_mussang_tower_task.clear()},Instance.insert_User_Mussang_Tower_Task=function(user_tower_tasks){for(var idx=0;idx<user_tower_tasks.length;idx++){var tower=user_tower_tasks[idx],user_tower={};user_tower.user_id=m_user_id,user_tower.period_idx=tower.period_idx,user_tower.mussang_tower_id=tower.mussang_tower_id,user_tower.task_id=tower.task_id,m_user_mussang_tower_task.insert([user_tower.user_id,user_tower.period_idx,user_tower.mussang_tower_id,user_tower.task_id],user_tower)}},Instance.delete_User_Mussang_Tower_Lotus_Log=function(){m_user_mussang_tower_lotus_log.clear()},Instance.insert_User_Mussang_Tower_Lotus_Log=function(tower_lotus_logs){for(var idx=0;idx<tower_lotus_logs.length;idx++){var tower=tower_lotus_logs[idx],user_tower={};user_tower.user_id=m_user_id,user_tower.period_idx=tower.period_idx,user_tower.lotus_count=tower.lotus_count,user_tower.new_yn=tower.new_yn,user_tower.complete_yn=tower.complete_yn,m_user_mussang_tower_lotus_log.insert([user_tower.user_id,user_tower.period_idx,user_tower.lotus_count],user_tower)}},Instance.delete_User_Beginner_Booster=function(){m_user_beginner_booster.clear()},Instance.insert_user_beginner_booster=function(res){var data=new Object;data.user_id=m_user_id,data.bound=res,data.complete_yn=res.complete_yn,data.user_level=res.user_level,data.deadline_dt=res.deadline_dt,m_user_beginner_booster.insert(m_user_id,data)},Instance.update_Check_Upgrade_User_Camp_Branch_Ability=function(res){for(var m_camp_branch_ability_log=CampService.getInstance().getCamp_branch_ability_log(),idx=0;idx<m_camp_branch_ability_log.length;idx++){var original=m_camp_branch_ability_log[idx];if(original.ability_id==res.branch_ability_id){original.complete_yn="y";for(var kIdx=original.remain_second=0;kIdx<original.gnrl_keys.length;kIdx++){var gnrl_key={};gnrl_key.gnrl_id=original.gnrl_keys[kIdx].gnrl_id,gnrl_key.gnrl_num=original.gnrl_keys[kIdx].gnrl_num,0<gnrl_key.gnrl_id&&0<gnrl_key.gnrl_num&&map_User_General.remove([gnrl_key.gnrl_id,gnrl_key.gnrl_num])}m_camp_branch_ability_log[idx]=original}}"y"==res.complete_yn&&(Instance.delete_User_Camp_Branch_Ability("",res.branch_ability.branch_type),Instance.insert_User_Camp_Branch_Ability(res.branch_ability))},Instance.clear_Announce_List=function(){list_Announce_Msg_Queue=[]},Instance.get_Announce_List=function(){return list_Announce_Msg_Queue},Instance.get_User_Vote_Reward_Info_V3=function(event_dungeon_period_idx){for(var list=[],found=!1,found_i=0,i=0;i<_user_event_vote_reward_all_info_v3.vote_reward_info_list.length;i++){if(_user_event_vote_reward_all_info_v3.vote_reward_info_list[i].event_dungeon_period_idx==event_dungeon_period_idx){found=!0,found_i=i;break}}return 1==found&&(list=_user_event_vote_reward_all_info_v3.vote_reward_info_list[found_i].reward_list),list},Instance.update_Announce_List=function(res){0<list_Announce_Msg_Queue.length?list_Announce_Msg_Queue[0]=res.notice:list_Announce_Msg_Queue.push(res.notice)},Instance.set_Raid_Boss_Battle_Result=function(res){if(0==res.raid_boss_info.remain_hp){_raid_boss_list.user_raid_boss_open_list=_raid_boss_list.user_raid_boss_open_list.filter(function(r){return r.discovered_user_id!=res.raid_boss_info.discovered_user_id&&r.raid_boss_period_idx!=res.raid_boss_info.raid_boss_period_idx&&r.raid_boss_num!=res.raid_boss_info.raid_boss_num});var temp_list=[];null!=_raid_boss_list.user_raid_boss_history_list&&(temp_list=_raid_boss_history.user_raid_boss_history_list.slice(0)),_raid_boss_history.user_raid_boss_history_list=[],_raid_boss_history.user_raid_boss_history_list.push(res.raid_boss_info);for(var i=0;i<temp_list.length;i++)_raid_boss_history.user_raid_boss_history_list.push(temp_list[i])}else for(var idx=0;idx<_raid_boss_list.user_raid_boss_open_list.length;idx++){var r=_raid_boss_list.user_raid_boss_open_list[idx];if(r.discovered_user_id==res.raid_boss_info.discovered_user_id&&r.raid_boss_period_idx==res.raid_boss_info.raid_boss_period_idx&&r.raid_boss_num==res.raid_boss_info.raid_boss_num){r.remain_hp=res.raid_boss_info.remain_hp;break}}},Instance.set_Raid_Boss_Shared=function(){for(var idx=0;idx<_raid_boss_list.user_raid_boss_open_list.length;idx++){var r=_raid_boss_list.user_raid_boss_open_list[idx];if(r.discovered_user_id==res.raid_boss_info.discovered_user_id&&r.raid_boss_period_idx==res.raid_boss_info.raid_boss_period_idx&&r.raid_boss_num==res.raid_boss_info.raid_boss_num){r.shared_type=res.raid_boss_info.shared_type,r.remain_hp=res.raid_boss_info.remain_hp;break}}},Instance.get_User_Prologue_V2=function(res){map_user_prologue_v2.clear(),map_user_prologue_v2.insert(m_user_id,res.complete_yn)},Instance.res_Raid_Boss_Battle_Check=function(res){res.battle_continue_clear_yn&&NetService().clearBattleDungeonContinue(),Instance.upd_UserItemRaidTicket(res.user_raid_ticket)},Instance.update_User_Prologue_V2_Complete=function(res){var prolog=map_user_prologue_v2.at(m_user_id);null!=prolog?prolog.complete_yn=res.complete_yn:map_user_prologue_v2.insert(m_user_id,res.complete_yn)},Instance.update_User_Equipment_General_Change=function(){Instance.delete_User_Gnrl_Equipment(res.gnrl_key,res.release_equipment_key),0<res.release_gnrl_key.gnrl_id&&delete_User_Gnrl_Equipment(res.release_gnrl_key,res.equipment_key),Instance.insert_User_Gnrl_Equipment(res.gnrl_key,res.equipment_key);var release_equipment_key={equipment_item_idx:res.release_equipment_key.equipment_item_idx,equipment_num:res.release_equipment_key.equipment_num};map_User_Equipment.at([release_equipment_key.equipment_item_idx,release_equipment_key.equipment_num]).equip_yn="n";var equipment_key={equipment_item_idx:res.equipment_key.equipment_item_idx,equipment_num:res.equipment_key.equipment_num};map_User_Equipment.at([equipment_key.equipment_item_idx,equipment_key.equipment_num]).equip_yn="n",map_User_Equipment.at([release_equipment_key.equipment_item_idx,release_equipment_key.equipment_num]).equip_yn="n",map_User_Equipment.at([equipment_key.equipment_item_idx,equipment_key.equipment_num]).equip_yn="y"},Instance.update_User_Event_Dungeon_Point_Reward_Board_Map=function(body){var period=MasterManager.getInstance().get_EventDungeonPeriod(body.event_dungeon_period_idx),borad_info=map_user_event_dungeon_reward_board_info.at([period.event_dungeon_point_period_idx,body.event_dungeon_reward_board_info_idx]);null!=borad_info?(borad_info.open_yn=body.board_open_yn,borad_info.complete_yn=body.board_complete_yn):((data=new Object).user_id=m_user_id,data.event_dungeon_period_idx=period.event_dungeon_point_period_idx,data.event_dungeon_reward_board_info_idx=body.event_dungeon_reward_board_info_idx,data.open_yn=body.board_open_yn,data.complete_yn=body.board_complete_yn,map_user_event_dungeon_reward_board_info.insert([period.event_dungeon_point_period_idx,body.event_dungeon_reward_board_info_idx],data));var data,map_bonus=map_user_event_dungeon_board_map_bonus.at([m_user_id,period.event_dungeon_point_period_idx,res.event_dungeon_reward_board_info_idx,res.event_dungeon_reward_board_map_idx]);null!=map_bonus?map_bonus.rewarded_yn=res.rewarded_yn:((data=new Object).user_id=m_user_id,data.event_dungeon_period_idx=period.event_dungeon_period_idx,data.event_dungeon_reward_board_info_idx=body.event_dungeon_reward_board_info_idx,data.event_dungeon_reward_board_map_idx=body.event_dungeon_reward_board_map_idx,data.rewarded_yn=body.rewarded_yn,map_user_event_dungeon_board_map_bonus.insert([data.user_id,data.event_dungeon_period_idx,data.event_dungeon_reward_board_info_idx,data.event_dungeon_reward_board_map_idx],data))},Instance.update_User_Event_Dungeon_Craft_Shop_Material=function(list){for(var idx=0;idx<list.length;idx++){var user_material=map_user_event_dungeon_craft_shop_material.at([m_user_id,list[idx].craft_shop_bonus_type]);null!=user_material&&(user_material.material_count=list[idx].material_count)}},Instance.upd_Camp_Factory_Exchange_Item=function(body){if(body.factory_mtrl_type==CAMP_FACTORY_MTRL_LIMIT_OVER)body.need_mtrl_type!=LIMIT_OVER_MTRL_SR&&body.need_mtrl_type!=LIMIT_OVER_MTRL_SSR||Instance.update_User_Limit_Over_Mtlr(body.need_mtrl_type,body.user_mtrl_count);else if(body.factory_mtrl_type==CAMP_FACTORY_MTRL_MAGIC_KEY){var f=MasterManager.getInstance().get_CampFactory(body.factor_id);f.cmplt_item_type==BONUS_TYPE_MAGIC_KEY?Instance.udp_UserPlusKeyBound(body.plus_key_bound):f.cmplt_item_type==BONUS_TYPE_KEY_REFILL&&Instance.update_User_Key_Recovery_Make_Count(body.key_recovery_make_count),Instance.update_User_Magic_Key_Mtrl(body.user_mtrl_count)}else body.factory_mtrl_type==CAMP_FACTORY_MTRL_JADE_PIECE&&Instance.update_User_Jade_Piece(body.user_mtrl_count)},Instance.upd_Get_User_Jade_Piece=function(body){User_Jade_Piece=body.jade_piece_cnt},Instance.getJadePieceCount=function(){return User_Jade_Piece},Instance.plus_User_Jade_Piece=function(cnt){User_Jade_Piece+=cnt},Instance.update_User_Jade_Piece=function(cnt){User_Jade_Piece=cnt},Instance.update_User_Limit_Over_Mtlr=function(limit_over_mtrl_type,mtrl_count){for(var keys=map_User_Limit_Over_Mtrl.keys(),idx=0;idx<keys.length;idx++){var mtrl=map_User_Limit_Over_Mtrl.at(keys[idx]);mtrl.limit_over_mtrl_type==limit_over_mtrl_type&&(mtrl.mtrl_cnt=mtrl_count)}},Instance.update_User_Magic_Key_Mtrl=function(mtrl_cnt){User_Magic_Key_Mtrl=mtrl_cnt},Instance.update_User_Key_Recovery_Make_Count=function(make_cnt){User_Key_Recovery_Make_Count=make_cnt},Instance.insert_User_Limit_Over_Mtlr=function(user_limit_over_mtrl_list){map_User_Limit_Over_Mtrl.clear();for(var idx=0;idx<user_limit_over_mtrl_list.length;idx++){var original={};original.user_id=m_user_id,original.mtrl_cnt=user_limit_over_mtrl_list[idx].mtrl_cnt,original.limit_over_mtrl_type=user_limit_over_mtrl_list[idx].limit_over_mtrl_type;var item={};item.limit_over_mtrl_type=original.limit_over_mtrl_type,item.mtrl_cnt=original.mtrl_cnt,map_User_Limit_Over_Mtrl.insert(original.limit_over_mtrl_type,item)}},Instance.delete_User_Equipments=function(){map_User_Equipment.clear()},Instance.insert_User_Box_Gacha_Equipments=function(user_equipments){for(var item=0;item<user_equipments.length;item++)user_equipments[item].bonus_type==BONUS_TYPE_EQUIPMENT&&Instance.insert_User_Equipment(user_equipments[item])},Instance.insert_User_World_War_Box_Gacha_Equipments=function(user_equipments){for(var item=0;item<user_equipments.length;item++)user_equipments[item].bonus_type==BONUS_TYPE_EQUIPMENT&&Instance.insert_User_Equipment(user_equipments[item])},Instance.insert_User_Equipments=function(user_equipments){for(var item=0;item<user_equipments.length;item++)Instance.insert_User_Equipment(user_equipments[item])},Instance.insert_User_Equipment=function(equipment){var user_equipment=equipment.user_equipment_data;null==user_equipment&&(user_equipment=equipment);var data={};data.user_id=m_user_id,data.equipment_item_idx=user_equipment.equipment_item_idx,data.equipment_num=user_equipment.equipment_num,data.level=user_equipment.level,data.exp=user_equipment.exp,data.arm_service_type=user_equipment.arm_service_type,data.step=user_equipment.step,data.combo_stat=user_equipment.combo_stat,data.stat_value=user_equipment.stat_value,data.base_stat_level_id=user_equipment.base_stat_level_id,data.option_num1=user_equipment.option_num1,data.option_num2=user_equipment.option_num2,data.option_num3=user_equipment.option_num3,data.option_num4=user_equipment.option_num4,data.option_num5=user_equipment.option_num5,data.equip_yn=user_equipment.equip_yn,data.lock_yn=user_equipment.lock_yn,data.gnrl_group=user_equipment.gnrl_group;var key={};key.equipment_item_idx=user_equipment.equipment_item_idx,key.equipment_num=user_equipment.equipment_num,map_User_Equipment.insert([key.equipment_item_idx,key.equipment_num],user_equipment)},Instance.delete_User_Equipment=function(equip_key){1==map_User_Equipment.find([equip_key.equipment_item_idx,equip_key.equipment_num])&&map_User_Equipment.remove([equip_key.equipment_item_idx,equip_key.equipment_num])},Instance.update_User_Gnrl_Equipment=function(befor_gnrl_key,new_gnrl_key,user_equip_keys){null==user_equip_keys&&(user_equip_keys=[]);for(var idx=0;idx<user_equip_keys.length;idx++){var equip_key=user_equip_keys[idx];1==map_User_Gnrl_Equipment.find([befor_gnrl_key.gnrl_id,befor_gnrl_key.gnrl_num])&&map_User_Gnrl_Equipment.remove([befor_gnrl_key.gnrl_id,befor_gnrl_key.gnrl_num]);var user_gnrl_equip_data={};user_gnrl_equip_data.equipment_item_idx=equip_key.equipment_item_idx,user_gnrl_equip_data.equipment_num=equip_key.equipment_num,user_gnrl_equip_data.gnrl_id=new_gnrl_key.gnrl_id,user_gnrl_equip_data.gnrl_num=new_gnrl_key.gnrl_num;var e_list=map_User_Gnrl_Equipment.at([new_gnrl_key.gnrl_id,new_gnrl_key.gnrl_num]);null==e_list&&(e_list=[]),0==e_list.filter(function(obj){return obj.equipment_item_idx==equip_key.equipment_item_idx}).length&&(e_list.push(user_gnrl_equip_data),map_User_Gnrl_Equipment.insert([[new_gnrl_key.gnrl_id,new_gnrl_key.gnrl_num]],e_list))}},Instance.getUserEquipment=function(key){return map_User_Equipment.at([key.equipment_item_idx,key.equipment_num])},Instance.getUserEquipmentList=function(user_equipments){for(var keys=map_User_Equipment.keys(),i=0;i<keys.length;i++)user_equipments.push(map_User_Equipment.at(keys[i]))},Instance.getUserEquipmentCount=function(){return map_User_Equipment.size()},Instance.getUserGnrlEquipmentList=function(gnrl_key){return map_User_Gnrl_Equipment.at([gnrl_key.gnrl_id,gnrl_key.gnrl_num])},Instance.get_user_gnrl_equipment=function(){return map_User_Gnrl_Equipment},Instance.getUserGnrlEquipment=function(gnrl_key,equip_key,user_gnrl_equip){for(var e_list=map_User_Gnrl_Equipment.at([gnrl_key.gnrl_id,gnrl_key.gnrl_num]),found_thumb_is=!1,i=0;i<e_list.size();i++)if(e_list[i].equipment_item_idx==equip_key.equipment_item_idx){found_thumb_is=!0;break}found_thumb_is!=e_list.end()&&e_list[i]},Instance.delete_User_Gnrl_Equipment=function(gnrl_key,equip_key){var e_list=map_User_Gnrl_Equipment.at([gnrl_key.gnrl_id,gnrl_key.gnrl_num]);null==e_list&&(e_list=[]);var new_list=e_list.filter(function(obj){return obj.equipment_item_idx!=equip_key.equipment_item_idx});map_User_Gnrl_Equipment.insert([[gnrl_key.gnrl_id,gnrl_key.gnrl_num]],new_list)},Instance.delete_User_Gnrl_Equipments=function(){map_User_Gnrl_Equipment.clear()},Instance.insert_User_Gnrl_Equipments=function(user_gnrl_equips){for(var idx=0;idx<user_gnrl_equips.length;idx++){var item=user_gnrl_equips[idx];Instance.insert_User_Gnrl_Equipment(item)}},Instance.insert_User_Gnrl_Equipment=function(user_gnrl_equip){var data={};data.user_id=m_user_id,data.equipment_item_idx=user_gnrl_equip.equipment_item_idx,data.equipment_num=user_gnrl_equip.equipment_num,data.gnrl_num=user_gnrl_equip.gnrl_num,data.gnrl_id=user_gnrl_equip.gnrl_id;var key={};key.gnrl_id=user_gnrl_equip.gnrl_id,key.gnrl_num=user_gnrl_equip.gnrl_num;var e_list=map_User_Gnrl_Equipment.at([key.gnrl_id,key.gnrl_num]);null==e_list&&(e_list=[]),-1==e_list.findIndex(function(key){return key.equipment_item_idx==user_gnrl_equip.equipment_item_idx})&&(e_list.push(data),map_User_Gnrl_Equipment.insert([key.gnrl_id,key.gnrl_num],e_list)),key=data=null},Instance.upd_Yunhee_Inventory_Increase=function(res){Instance.upd_UserJade(res.user_jade),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)},Instance.update_User_Yunhee_Bound=function(yunhee_bound){var data={};data.user_id=m_user_id,data.bound=yunhee_bound,m_user_yunhee_bound.insert(m_user_id,data),data=null},Instance.update_User_Equipment_Bound=function(equipment_bound){map_User_Equipment_bound.clear();var data={};data.user_id=m_user_id,data.user_equipment_bound=equipment_bound,map_User_Equipment_bound.insert(m_user_id,data)},Instance.upd_Weekly_Dungeon_Battle_Win=function(res){Instance.upd_User_Key(res.user_key),Instance.upd_UserItemRaidTicket(res.user_raid_ticket),Instance.upd_UserRaidHelpTicket(res.user_raid_help_ticket),USE_NEW_RAID_DUNGEON&&(Instance.upd_UserItemNewRaidCallTicket(res.user_new_raid_boss_call_key),Instance.upd_UserItemNewRaidConquestTicket(res.user_new_raid_boss_conquest_key)),Instance.upd_UserJade(res.user_jade),Instance.upd_UserGold(res.user_gold),Instance.upd_UserHeart(res.user_heart),Instance.upd_UserFormationPoint(res.user_formation_point),Instance.upd_UserLevelExp(res.user_level,res.user_exp);for(var idx=0;idx<res.bonus_items.length;idx++){var b=res.bonus_items[idx];if(b.bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX){var gnrl={};gnrl.gnrl_id=b.bonus_idx,gnrl.gnrl_num=b.bonus_num,gnrl.gnrl_level=b.bonus_level,gnrl.castle_id=b.castle_id,Instance.insert_User_General_V2(gnrl)}else if(b.bonus_type>=BONUS_TYPE_HWANDAN_1&&b.bonus_type<=BONUS_TYPE_HWANDAN_7)Instance.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)Instance.plus_User_Love_Item(b.bonus_idx,b.bonus_num);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE)Instance.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_ATTK_POINT&&b.bonus_type<=BONUS_TYPE_CRI_DMG_POINT)Instance.plus_User_Formation_Property_Point(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_YUNHEE_PT)Instance.plus_User_Yunhee_PT(b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_EVOLVE_ORB)Instance.plus_User_Evolve_Orb(b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_GOLD);else if(b.bonus_type==BONUS_TYPE_JADE);else if(b.bonus_type==BONUS_TYPE_HEART);else if(b.bonus_type==BONUS_TYPE_USER_EXP);else if(b.bonus_type>=BONUS_TYPE_REBIRTH_MTRL_TYPE_1&&b.bonus_type<=BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type>=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1&&b.bonus_type<=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){var rebirth_mtrl_type=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(b.bonus_type);Instance.plus_User_Rebirth_Mtrl(rebirth_mtrl_type,b.bonus_idx)}}for(var i=0;i<res.task_list.length;i++){for(var task=res.task_list[i],found=!1,foundIndex=0,j=0;j<_weekly_task.task_list.length;j++){var t=_weekly_task.task_list[j];if(task.weekly_idx==t.weekly_idx&&task.num==t.num){found=!0,foundIndex=j;break}}1==found?(_weekly_task.task_list[foundIndex].count=task.count,_weekly_task.task_list[foundIndex].complete_yn=task.complete_yn):_weekly_task.task_list.push(task)}"y"==res.new_mail_yn&&GameContext.getInstance().setUserNewMail("y")},Instance.get_Weekly_TaskList=function(){return _weekly_task.task_list},Instance.upd_Weekly_Dungeon_Battle_Lose=function(){},Instance.upd_Mussang_Step_Battle_Begin=function(res){Instance.upd_User_Key(res.user_key),Instance.upd_UserItemTicket(res.user_ticket),Instance.upd_UserJade(res.user_jade)},Instance.upd_Mussang_Step_Battle_Win=function(res){UserService.getInstance();Instance.upd_User_Key(res.user_key),Instance.upd_UserItemTicket(res.user_ticket),Instance.update_User_Mussang(res.mussang_cur_step,res.mussang_type),Instance.upd_UserItemRaidTicket(res.user_raid_ticket),Instance.upd_UserRaidHelpTicket(res.user_raid_help_ticket),USE_NEW_RAID_DUNGEON&&(Instance.upd_UserItemNewRaidCallTicket(res.user_new_raid_boss_call_key),Instance.upd_UserItemNewRaidConquestTicket(res.user_new_raid_boss_conquest_key)),Instance.upd_UserJade(res.user_jade),Instance.upd_UserGold(res.user_gold),Instance.upd_UserHeart(res.user_heart);for(var idx=0;idx<res.bonus_items.length;idx++){var b=$.extend({},net.Battle_Bonus_Item);if((b=res.bonus_items[idx]).bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX){var gnrl={};gnrl.gnrl_id=b.bonus_idx,gnrl.gnrl_num=b.bonus_num,gnrl.gnrl_level=b.bonus_level,gnrl.castle_id=b.castle_id,gnrl.gnrl_exp=0,gnrl.love_level=0,gnrl.love_exp=0,gnrl.limit_step_id=0,Instance.insert_User_General_V2(gnrl)}else if(b.bonus_type>=BONUS_TYPE_HWANDAN_1&&b.bonus_type<=BONUS_TYPE_HWANDAN_7)Instance.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)Instance.plus_User_Love_Item(b.bonus_idx,b.bonus_num);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE)Instance.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE||b.bonus_type==BONUS_TYPE_WHITE_CHOCO||b.bonus_type==BONUS_TYPE_COMEBACK_CAKE||b.bonus_type==BONUS_TYPE_LOVE_MAX_CAKE||b.bonus_type>=BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_01&&b.bonus_type<=BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_10)Instance.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_ATTK_POINT&&b.bonus_type<=BONUS_TYPE_CRI_DMG_POINT)Instance.plus_User_Formation_Property_Point(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_YUNHEE_PT)Instance.plus_User_Yunhee_PT(b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_EVOLVE_ORB)Instance.plus_User_Evolve_Orb(b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_GOLD);else if(b.bonus_type==BONUS_TYPE_JADE);else if(b.bonus_type==BONUS_TYPE_HEART);else if(b.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||b.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL){var limit_over_mtrl_type=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(b.bonus_type);Instance.plus_User_Limit_Over_Mtrl(limit_over_mtrl_type,b.bonus_idx)}}},Instance.upd_Main_Story_Hard_Mode_Mission_Battle_Win=function(res){for(var idx=0;idx<res.drop_bonus_items.length;idx++){var b=res.drop_bonus_items[idx];if(b.bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX){var gnrl={};gnrl.gnrl_id=b.bonus_idx,gnrl.gnrl_num=b.bonus_num,gnrl.castle_id=b.castle_id,gnrl.gnrl_level=b.bonus_level,gnrl.used_in_camp="n",gnrl.using_in_camp="n";var gnrl_info=MasterManager.getInstance().get_General(gnrl.gnrl_id);gnrl_info.gnrl_type!=GENERAL_TYPE_YUNHEE&&gnrl_info.gnrl_type!=GENERAL_TYPE_LIMIT_OVER||gnrl_info.rare_type!=RARE_TYPE_SSR?gnrl.lock_yn="n":gnrl.lock_yn="y",Instance.insert_User_General_V2(gnrl)}else if(b.bonus_type>=BONUS_TYPE_HWANDAN_1&&b.bonus_type<=BONUS_TYPE_HWANDAN_7)Instance.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)Instance.plus_User_Love_Item(b.bonus_idx,1);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE)Instance.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_ATTK_POINT&&b.bonus_type<=BONUS_TYPE_CRI_DMG_POINT)Instance.plus_User_Formation_Property_Point(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_REBIRTH_MTRL_TYPE_1&&b.bonus_type<=BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type>=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1&&b.bonus_type<=BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){var rebirth_mtrl_type=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(b.bonus_type);Instance.plus_User_Rebirth_Mtrl(rebirth_mtrl_type,b.bonus_idx)}else if(b.bonus_type==BONUS_TYPE_GOLD);else if(b.bonus_type==BONUS_TYPE_GNRL_PIECE)Instance.plus_User_Gnrl_Piece(b.bonus_idx,b.bonus_level);else if(b.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_MAKE_MATERIAL)Instance.plus_User_New_Equipment_Make_Material(b.bonus_idx,b.bonus_level);else if(b.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_ENHANCE_MATERIAL)Instance.plus_User_New_Equipment_Enhance_Material(b.bonus_idx,b.bonus_level);else if(b.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_SMELT_MATERIAL)Instance.plus_User_New_Equipment_Smelt_Material(b.bonus_idx,b.bonus_level);else if(b.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_ENCHANT_TICKET)Instance.plus_User_New_Equipment_Enchant_Ticket(b.bonus_idx,b.bonus_level);else if(b.bonus_type==BONUS_TYPE_EQUIPMENT){MasterManager.getInstance().get_EquipmentItem(b.equipment.equipment_item_idx).equipment_type,EQUIPMENT_TYPE_EXP;var user_equipment={};user_equipment.equipment_item_idx=b.equipment.equipment_item_idx,user_equipment.equipment_num=b.equipment.equipment_num,user_equipment.level=b.equipment.level,user_equipment.exp=0,user_equipment.arm_service_type=b.equipment.arm_service_type,user_equipment.step=b.equipment.step,user_equipment.combo_stat=b.equipment.combo_stat,user_equipment.stat_value=b.equipment.stat_value,user_equipment.option_num1=b.equipment.option_num1,user_equipment.option_num2=b.equipment.option_num2,user_equipment.option_num3=b.equipment.option_num3,user_equipment.option_num4=b.equipment.option_num4,user_equipment.option_num5=b.equipment.option_num5,user_equipment.equip_yn=b.equipment.equip_yn,user_equipment.lock_yn=b.equipment.lock_yn,user_equipment.activity_type=b.equipment.activity_type,user_equipment.base_stat_level_id=b.equipment.base_stat_level_id,Instance.insert_User_Equipment(user_equipment)}else b.bonus_type==BONUS_TYPE_SKIP_TICKET&&Instance.plus_User_Skip_Ticket(b.bonus_idx)}Instance.upd_UserLevelExp(res.user_level,res.user_exp),Instance.upd_UserGold(res.user_gold),Instance.upd_UserHeart(res.user_heart),Instance.upd_UserFormationPoint(res.user_formation_point),Instance.upd_UserItemRaidTicket(res.user_raid_ticket),Instance.upd_UserRaidHelpTicket(res.user_raid_help_ticket),USE_NEW_RAID_DUNGEON&&(Instance.upd_UserItemNewRaidCallTicket(res.user_new_raid_boss_call_key),Instance.upd_UserItemNewRaidConquestTicket(res.user_new_raid_boss_conquest_key)),Instance.upd_User_Key(res.user_key);for(var i=0;i<res.cmplt_task_ids.length;i++){for(var task_id=res.cmplt_task_ids[i],found_mission=!1,found_mission_idx=0,hidx=0;hidx<_user_main_story_hard_mode_mission_tasks.user_mission_tasks.length;hidx++)if(_user_main_story_hard_mode_mission_tasks.user_mission_tasks[hidx].main_story_hard_mode_mission_idx==res.main_story_hard_mode_mission_idx&&_user_main_story_hard_mode_mission_tasks.user_mission_tasks[hidx].task_id==task_id){found_mission=!0,found_mission_idx=hidx;break}if(found_mission)_user_main_story_hard_mode_mission_tasks.user_mission_tasks[found_mission_idx].complete_yn="y";else{var task={};task.main_story_hard_mode_mission_idx=res.main_story_hard_mode_mission_idx,task.task_id=task_id,task.complete_yn="y",_user_main_story_hard_mode_mission_tasks.user_mission_tasks.push_back($.extend({},task))}}if("y"==res.lotus_bonus_new_yn){for(var mission=MasterManager.getInstance().get_MainStoryHardModeMission(res.main_story_hard_mode_mission_idx),lotus=MasterTable.getInstance().get_MainStoryHardModeLotusReward(mission.difficult,mission.main_story_id,res.lotus_open_count),found=!1,found_idx=0,fidx=0;fidx<_user_main_story_hard_mode_lotus_reward_log.lotus_reward_log.length;fidx++)if(_user_main_story_hard_mode_lotus_reward_log.lotus_reward_log[fidx].main_story_hard_mode_lotus_reward_idx==lotus.main_story_hard_mode_lotus_reward_idx&&_user_main_story_hard_mode_lotus_reward_log.lotus_reward_log[fidx].main_story_id==lotus.main_story_id&&_user_main_story_hard_mode_lotus_reward_log.lotus_reward_log[fidx].difficult==lotus.difficult&&_user_main_story_hard_mode_lotus_reward_log.lotus_reward_log[fidx].lotus_count==lotus.lotus_count){found=!0,found_idx=fidx;break}if(found)_user_main_story_hard_mode_lotus_reward_log.lotus_reward_log[found_idx].new_yn=res.lotus_bonus_new_yn;else{var log={};log.main_story_hard_mode_lotus_reward_idx=mission.main_story_hard_mode_mission_reward_idx,log.difficult=mission.difficult,log.main_story_id=mission.main_story_id,log.lotus_count=res.lotus_open_count,log.new_yn="y",log.complete_yn="n",_user_main_story_hard_mode_lotus_reward_log.lotus_reward_log.push_back(log)}}for(var found_mission2=!1,found_mission2_idx=0,kidx=0;kidx<_user_main_story_hard_mode_missions.user_missions.length;kidx++)if(_user_main_story_hard_mode_missions.user_missions[kidx].main_story_hard_mode_mission_idx==res.main_story_hard_mode_mission_idx){found_mission2=!0,found_mission2_idx=kidx;break}if(found_mission2)_user_main_story_hard_mode_missions.user_missions[found_mission2_idx].complete_yn="y",_user_main_story_hard_mode_missions.user_missions[found_mission2_idx].daily_try_count=res.daily_try_count,_user_main_story_hard_mode_missions.user_missions[found_mission2_idx].daily_charge_count=res.daily_charge_count,_user_main_story_hard_mode_missions.user_missions[found_mission2_idx].win_count=res.win_count;else{var mi={};mi.main_story_hard_mode_mission_idx=res.main_story_hard_mode_mission_idx,mi.complete_yn="y",mi.daily_try_count=res.daily_try_count,mi.daily_charge_count=res.daily_charge_count,mi.win_count=res.win_count,_user_main_story_hard_mode_missions.user_missions.push_back(mi)}Instance.upd_UserGeneralLevelExp(res.gnrl_exp)},Instance.upd_Mussang_Step_Battle_Lose=function(res){},Instance.upd_Get_User_Mussang=function(res){},Instance.update_User_Daily_Dungeon=function(daily_dungeon){for(var idx=0;idx<daily_dungeon.length;idx++)User_daily_dungeon.push(daily_dungeon[idx])},Instance.upd_UserLevelExp=function(user_level,exp){var user_info=Instance.get_User_info(),data={};data.user_id=user_info.user_id,data.nickname=user_info.nickname,data.state_type=user_info.state_type,data.user_level=user_level,data.user_exp=exp,data.join_bonus_cmplt_yn=user_info.join_bonus_cmplt_yn,data.naming=user_info.naming,Instance.insert_User_info(data)},Instance.upd_Daily_Dungeon_Battle_Result=function(res){UserService.getInstance();Instance.upd_User_Key(res.user_key),Instance.upd_UserItemRaidTicket(res.user_raid_ticket),Instance.upd_UserRaidHelpTicket(res.user_raid_help_ticket),USE_NEW_RAID_DUNGEON&&(Instance.upd_UserItemNewRaidCallTicket(res.user_new_raid_boss_call_key),Instance.upd_UserItemNewRaidConquestTicket(res.user_new_raid_boss_conquest_key)),Instance.upd_UserJade(res.user_jade),Instance.upd_UserGold(res.user_gold),Instance.upd_UserLevelExp(res.user_level,res.user_exp),Instance.upd_UserFormationPoint(res.user_formation_point);for(var idx=0;idx<res.bonus_items.length;idx++){var b=res.bonus_items[idx];if(b.bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX){var gnrl={};gnrl.gnrl_id=b.bonus_idx,gnrl.gnrl_num=b.bonus_num,gnrl.gnrl_level=b.bonus_level,gnrl.castle_id=b.castle_id,gnrl.gnrl_exp=0,gnrl.love_level=0,gnrl.love_exp=0,gnrl.limit_step_id=0,Instance.insert_User_General_V2(gnrl)}else b.bonus_type==BONUS_TYPE_HWANDAN_1||b.bonus_type==BONUS_TYPE_HWANDAN_2||b.bonus_type==BONUS_TYPE_HWANDAN_3||b.bonus_type==BONUS_TYPE_HWANDAN_4||b.bonus_type==BONUS_TYPE_HWANDAN_5||b.bonus_type==BONUS_TYPE_HWANDAN_6||b.bonus_type==BONUS_TYPE_HWANDAN_7?Instance.plus_User_Hwandan(b.bonus_type,b.bonus_idx):b.bonus_type==BONUS_TYPE_LOVE_ITEM?Instance.plus_User_Love_Item(b.bonus_idx,b.bonus_num):b.bonus_type==BONUS_TYPE_HEART?Instance.plus_User_Heart(b.bonus_idx):b.bonus_type==BONUS_TYPE_JADE||b.bonus_type==BONUS_TYPE_GOLD||b.bonus_type==BONUS_TYPE_KEY||b.bonus_type==BONUS_TYPE_RAID_TICKET||b.bonus_type==BONUS_TYPE_EVENT_POINT||(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE?Instance.plus_User_Love_Item(b.bonus_level,b.bonus_idx):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER?Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE?Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx):b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW&&Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx))}var daily_dungeon=[],daily={};daily.daily_dungeon_id=res.daily_dungeon_idx,daily.daily_dungeon_period_idx=res.daily_dungeon_period_idx,daily.complete_yn=res.complete_yn,daily_dungeon.push(daily),Instance.update_User_Daily_Dungeon(daily_dungeon),0<res.gnrl_exp.length&&Instance.upd_UserGeneralLevelExp(res.gnrl_exp)},Instance.upd_UserGeneralLevelExp=function(gnrlExps){for(var idx=0;idx<gnrlExps.length;idx++){var key={};key.gnrl_id=gnrlExps[idx].gnrl_id,key.gnrl_num=gnrlExps[idx].gnrl_num,map_User_General.at([key.gnrl_id,key.gnrl_num]).gnrl_level=gnrlExps[idx].gnrl_level,map_User_General.at([key.gnrl_id,key.gnrl_num]).gnrl_exp=gnrlExps[idx].gnrl_exp}Instance.update_user_Generals()},Instance.upd_Daily_Dungeon_Battle_Begin=function(res){UserService.getInstance();Instance.upd_User_Key(res.user_key),Instance.upd_UserJade(res.user_jade);for(var is_exist=!1,event_period=m_daily_dungeon_open_period_info.daily_dungeon_open_period,idx=0;idx<event_period.length;idx++){var p=event_period[idx];if(p.daily_dungeon_period_idx==res.daily_dungeon_period_idx&&p.challenge_dt==res.user_challenge_log.challenge_dt){p.key_cost_challenge_count=res.user_challenge_log.key_cost_challenge_count,p.jade_cost_challenge_count=res.user_challenge_log.jade_cost_challenge_count,is_exist=!0;break}}is_exist||m_daily_dungeon_open_period_info.daily_dungeon_open_period.push(res.user_challenge_log)},Instance.upd_User_Weekly_Dungeon_Open=function(res){Instance.upd_UserJade(res.user_jade),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation);var data=$.extend({},res),key=data.weekly_idx+""+data.week_type;map_user_weekly_open.insert(key,data)},Instance.upd_User_Achievement_Complete=function(body){for(var idx=0;idx<body.achv_ids.length;idx++)Instance.update_User_Achievement_Complete(body.achv_ids[idx])},Instance.update_User_Achievement_Complete=function(achv_id){var cc=MasterManager.getInstance().get_AchivementCompleteCondition(achv_id),upd_achi={complete_yn:"y",complete_count:0};if(0==cc.count?cc.achv_cmplt_type==AchvCompType_StoryClear?upd_achi.complete_count=1:upd_achi.complete_count=0:cc.achv_cmplt_type==AchvCompType_UserLevel?upd_achi.complete_count=1:cc.achv_cmplt_type==AchvCompType_StoryClear?upd_achi.complete_count=1:upd_achi.complete_count=cc.count,null!=map_achievement_list)for(var keys=map_achievement_list.keys(),i=0;i<keys.length;i++){var original=map_achievement_list.at(keys[i]);if(original.achv_id==achv_id){original.complete_yn=upd_achi.complete_yn,0!=upd_achi.complete_count&&(original.complete_count=upd_achi.complete_count);var key=original.achv_id;map_achievement_list.insert(key,original)}}},Instance.upd_shop_Gacha_bonus=function(body){var obj={};obj.gacha_count=body.gacha_bonus_count,Instance.update_User_Gacha_Count(obj),GameContext.getInstance().setUserNewMail("y")},Instance.init_Battle_Formation_Level_Up=function(body){Instance.insert_User_Battle_Formation(body),Instance.upd_UserJade(body.user_jade),Instance.upd_UserGold(body.user_gold),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation),Instance.upd_UserFormationPoint(body.user_formation_point);for(var i=0;i<body.payback_property_point.length;i++){var payback_point=body.payback_property_point[i];0<payback_point.point_count&&Instance.upd_UserFormationPropertyPoint(payback_point.property_type,body.user_formation_proterty_point[i].point_count)}},Instance.upd_Battle_Formation_Level_Up=function(body){var battle_formation=$.extend({},m_User_Battle_formation.at(body.old_formation.formation_id));battle_formation.formation_id=body.new_formation.formation_id,m_User_Battle_formation.remove(body.old_formation.formation_id),m_User_Battle_formation.insert(battle_formation.formation_id,battle_formation),Instance.upd_UserFormationPoint(body.user_formation_point),Instance.upd_UserFormationPropertyPoint(body.formation_property_type,body.property_point_count),Instance.upd_UserGold(body.user_gold),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)},Instance.upd_UserFormationPoint=function(point){User_item_info.user_item.formation_point=point},Instance.IsSignUpNewRaidBoss=function(new_raid_boss_period_idx){if(0<_new_raid_boss_sign_up.user_new_raid_boss_sign_up_list.length&&-1!=_new_raid_boss_sign_up.user_new_raid_boss_sign_up_list.findIndex(function(s){return s.new_raid_boss_period_idx==new_raid_boss_period_idx&&"y"==s.is_sign_up}))return!0;return!1},Instance.updateNewRaidBossKey=function(bonus_type,key_count,elapsed){var ticket={};ticket.ticket_cnt=key_count,ticket.elapsed=elapsed,bonus_type==BONUS_TYPE_NEW_RAID_BOSS_CALL_KEY?Instance.upd_UserItemNewRaidCallTicket(ticket):bonus_type==BONUS_TYPE_NEW_RAID_BOSS_BATTLE_KEY&&Instance.upd_UserItemNewRaidConquestTicket(ticket)},Instance.updateNewRaidBossPoint=function(new_raid_boss_shop_period_idx,point){var found=_new_raid_boss_point.user_new_raid_boss_points.findIndex(function(p){return p.new_raid_boss_period_idx==new_raid_boss_shop_period_idx});if(-1!=found)_new_raid_boss_point.user_new_raid_boss_points[found].point=point;else{var p={};p.new_raid_boss_period_idx=new_raid_boss_shop_period_idx,p.point=point,_new_raid_boss_point.user_new_raid_boss_points.push_back(p)}},Instance.plus_User_New_Raid_Boss_Point=function(new_raid_boss_shop_period_idx,add_point){var found=_new_raid_boss_point.user_new_raid_boss_points.findIndex(function(p){return p.new_raid_boss_period_idx==new_raid_boss_shop_period_idx});if(-1!=found)_new_raid_boss_point.user_new_raid_boss_points[found].point+=add_point;else{var p={};p.new_raid_boss_period_idx=new_raid_boss_shop_period_idx,p.point=add_point,_new_raid_boss_point.user_new_raid_boss_points.push_back(p)}},Instance.IsExistUserDiscoveredNewRaidBoss=function(new_raid_boss_period_idx,data){var dungeon_list=_new_raid_boss_dungeon_list.findIndex(function(d){return 1==d.request_type&&d.new_raid_boss_period_idx==new_raid_boss_period_idx});if(-1!=dungeon_list){var dungeon=_new_raid_boss_dungeon_list[dungeon_list].user_new_raid_boss_list.findIndex(function(d){return d.discovered_user_id==m_user_id});if(-1!=dungeon)if(moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf()<moment(_new_raid_boss_dungeon_list[dungeon_list].user_new_raid_boss_list[dungeon].retreat_dt).valueOf())return _new_raid_boss_dungeon_list[dungeon_list].user_new_raid_boss_list[dungeon],!0}return!1},Instance.getNewRaidBossDungeonData=function(request_type,discovered_user_id,new_raid_boss_period_idx,new_raid_boss_dungeon_info_idx,boss_num){var data=$.extend({},net.New_Raid_Boss_Dungeon_Data),dungeon_list=_new_raid_boss_dungeon_list.findIndex(function(d){return d.request_type==request_type&&d.new_raid_boss_period_idx==new_raid_boss_period_idx});if(-1!=dungeon_list){var dungeon=_new_raid_boss_dungeon_list[dungeon_list].user_new_raid_boss_list.findIndex(function(d){return d.discovered_user_id==discovered_user_id&&d.new_raid_boss_period_idx==new_raid_boss_period_idx&&d.new_raid_boss_dungeon_info_idx==new_raid_boss_dungeon_info_idx&&d.boss_num==boss_num});-1!=dungeon&&(data=_new_raid_boss_dungeon_list[dungeon_list].user_new_raid_boss_list[dungeon])}return data},Instance.checkPartinTimeRetreatDungeon=function(period_idx){var partin_dungeon_list=_new_raid_boss_dungeon_list.findIndex(function(d){return 1==d.request_type&&d.new_raid_boss_period_idx==period_idx});if(-1!=partin_dungeon_list){for(var delete_dungeon=[],now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),i=0;i<_new_raid_boss_dungeon_list[partin_dungeon_list].user_new_raid_boss_list.length;i++){var d=_new_raid_boss_dungeon_list[partin_dungeon_list].user_new_raid_boss_list;moment(d.retreat_dt).valueOf()<n&&delete_dungeon.push(_new_raid_boss_dungeon_list[partin_dungeon_list].user_new_raid_boss_list)}for(var idx=0;idx<delete_dungeon.length;idx++){var dungeon=delete_dungeon[idx],delete_found=_new_raid_boss_dungeon_list[partin_dungeon_list].user_new_raid_boss_list.findIndex(function(d){return d.new_raid_boss_period_idx==dungeon.new_raid_boss_period_idx&&d.new_raid_boss_dungeon_info_idx==dungeon.new_raid_boss_dungeon_info_idx&&d.boss_num==dungeon.boss_num&&d.discovered_user_id==dungeon.discovered_user_id});-1!=delete_found&&_new_raid_boss_dungeon_list[partin_dungeon_list].user_new_raid_boss_list.splice(delete_found,1);var conquest_dungeon_list=_new_raid_boss_dungeon_list.findIndex(function(d){return 3==d.request_type&&d.new_raid_boss_period_idx==period_idx});if(-1!=conquest_dungeon_list)_new_raid_boss_dungeon_list[conquest_dungeon_list].user_new_raid_boss_list.push_back(delete_dungeon[idx]);else{var list={request_type:3};list.new_raid_boss_period_idx=period_idx,list.user_new_raid_boss_list.push_back(delete_dungeon[idx]),_new_raid_boss_dungeon_list.push_back(list)}}}},Instance.checkHelpTimeRetreatDungeon=function(period_idx){var help_dungeon_list=_new_raid_boss_dungeon_list.findIndex(function(d){return 2==d.request_type&&d.new_raid_boss_period_idx==period_idx});if(-1!=help_dungeon_list){for(var delete_dungeon={},now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),i=0;i<_new_raid_boss_dungeon_list[help_dungeon_list].user_new_raid_boss_list.length;i++){var d=_new_raid_boss_dungeon_list[help_dungeon_list].user_new_raid_boss_list;moment(d.retreat_dt).valueOf()<n&&delete_dungeon.push(_new_raid_boss_dungeon_list[help_dungeon_list].user_new_raid_boss_list)}for(var idx=0;idx<delete_dungeon.length;idx++){var dungeon=delete_dungeon[idx],delete_found=_new_raid_boss_dungeon_list[help_dungeon_list].user_new_raid_boss_list.findIndex(function(d){return d.new_raid_boss_period_idx==dungeon.new_raid_boss_period_idx&&d.new_raid_boss_dungeon_info_idx==dungeon.new_raid_boss_dungeon_info_idx&&d.boss_num==dungeon.boss_num&&d.discovered_user_id==dungeon.discovered_user_id});-1!=delete_found&&_new_raid_boss_dungeon_list[help_dungeon_list].user_new_raid_boss_list.splice(delete_found,1)}}},Instance.plus_Bonus_Type_Items=function(bonus_type,key_id,add_count){switch(bonus_type){case BONUS_TYPE_NEW_RAID_BOSS_POINT:Instance.plus_User_New_Raid_Boss_Point(key_id,add_count);break;case BONUS_TYPE_NEW_EQUIPMENT_MAKE_MATERIAL:Instance.plus_User_New_Equipment_Make_Material(key_id,add_count);break;case BONUS_TYPE_NEW_EQUIPMENT_ENHANCE_MATERIAL:Instance.plus_User_New_Equipment_Enhance_Material(key_id,add_count);break;case BONUS_TYPE_NEW_EQUIPMENT_SMELT_MATERIAL:Instance.plus_User_New_Equipment_Smelt_Material(key_id,add_count);break;case BONUS_TYPE_NEW_EQUIPMENT_ENCHANT_TICKET:Instance.plus_User_New_Equipment_Enchant_Ticket(key_id,add_count);break;case BONUS_TYPE_NEW_EQUIPMENT_ITEM:var equip={};equip.new_equipment_idx=key_id,equip.equip_num=add_count,equip.level=1,equip.lock_yn="n",equip.mount_yn="n",Instance.addNewEquipmentItem(equip);break;case BONUS_TYPE_JADE:Instance.plus_User_Jade(add_count);break;case BONUS_TYPE_YUNHEE_FIX:var gnrl={};gnrl.gnrl_id=key_id,gnrl.gnrl_num=add_count,gnrl.gnrl_level=1,gnrl.castle_id=0,gnrl.used_in_camp="n",gnrl.using_in_camp="n";var gnrl_info=MasterManager.getInstance().get_General(gnrl.gnrl_id);gnrl_info.gnrl_type!=GENERAL_TYPE_YUNHEE&&gnrl_info.gnrl_type!=GENERAL_TYPE_LIMIT_OVER||gnrl_info.rare_type!=RARE_TYPE_SSR?gnrl.lock_yn="n":gnrl.lock_yn="y",Instance.insert_User_General(gnrl);break;case BONUS_TYPE_SKIP_TICKET:Instance.plus_User_Skip_Ticket(add_count)}},Instance.upd_UserFormationPropertyPoint=function(type,count){m_User_formation_property_point.at(type).point_count=count},Instance.get_Main_Story_Lotus_Bonus_Log=function(){return m_User_main_lotus_bonus_log},Instance.upd_Main_Story_Lotus_Bonus_Get_V2=function(res){var main_scene_id=res.lotus_bonus_log.main_scene_id,main_story_id=res.lotus_bonus_log.main_story_id,difficulty_type=res.lotus_bonus_log.difficulty_type,lotus_count=res.lotus_bonus_log.lotus_count,bonus_log=m_User_main_lotus_bonus_log.at([main_scene_id,main_story_id,difficulty_type,lotus_count]);if(null!=bonus_log)bonus_log.complete_yn=res.lotus_bonus_log.complete_yn,bonus_log.new_yn=res.lotus_bonus_log.new_yn;else{var bonus={main_scene_id:main_scene_id=res.lotus_bonus_log.main_scene_id,main_story_id:main_story_id=res.lotus_bonus_log.main_story_id,difficulty_type:difficulty_type=res.lotus_bonus_log.difficulty_type,lotus_count:lotus_count=res.lotus_bonus_log.lotus_count,new_yn:res.lotus_bonus_log.new_yn,complete_yn:res.lotus_bonus_log.complete_yn};m_User_main_lotus_bonus_log.insert([bonus.main_scene_id,bonus.main_story_id,bonus.difficulty_type,bonus.lotus_count],bonus)}},Instance.remove_All_Troops_Del_General=function(res){for(var idx=0;idx<res.troops_nums.length;idx++){var num=res.troops_nums[idx];Instance.update_User_Troops_Generals(num,res.troops_gnrls)}for(idx=0;idx<res.weekly_troops_nums.length;idx++){var weekly_num=res.weekly_troops_nums[idx];Instance.update_User_Weekly_Troops_Generals(weekly_num,res.weekly_troops_gnrls)}},Instance.upd_General_Limit_Over=function(res){var key={gnrl_id:res.gnrl_key.gnrl_id,gnrl_num:res.gnrl_key.gnrl_num,limit_step_id:res.limit_step_id};map_User_General.at([key.gnrl_id,key.gnrl_num]).limit_step_id=key.limit_step_id,Instance.upd_UserGold(res.user_gold),this.remove_user_generals(res.mtrl_key),Instance.update_user_Generals()},Instance.upd_General_Evolution=function(res){Instance.insert_User_General_V2(res.new_gnrl);var new_gnrl_id=res.new_gnrl.gnrl_id,new_gnrl_num=res.new_gnrl.gnrl_num,new_gnrl_key={};new_gnrl_key.gnrl_id=res.new_gnrl.gnrl_id,new_gnrl_key.gnrl_num=res.new_gnrl.gnrl_num;var partner=GameContext.getInstance().getUserGeneralPartner();if(partner.gnrl_id==res.del_gnrl_key.gnrl_id&&partner.gnrl_num==res.del_gnrl_key.gnrl_num){var new_partner={};new_partner.gnrl_id=new_gnrl_id,new_partner.gnrl_num=new_gnrl_num,GameContext.getInstance().setUserGeneralParnter(new_partner)}var main_gnrl=GameContext.getInstance().getUserFriendPartner();if(main_gnrl.gnrl_id==res.del_gnrl_key.gnrl_id&&main_gnrl.gnrl_num==res.del_gnrl_key.gnrl_num){var new_friend_partner={};new_friend_partner.gnrl_id=new_gnrl_id,new_friend_partner.gnrl_num=new_gnrl_num,GameContext.getInstance().setUserFriendPartner(new_friend_partner)}Instance.updateEventDungeonSearchTroopsGeneralEvolution(res.del_gnrl_key,res.new_gnrl),Instance.upd_UserGold(res.user_gold),Instance.udp_UserEvolveOrb(res.user_evolve_orb),"y"==res.new_yn&&Instance.insert_User_Book_General_Evolution(res.new_gnrl,res.love_level_max_yn);for(var old_equips=[],i=0;i<res.equip_keys.length;i++)77777<=res.equip_keys[i].equipment_item_idx&&old_equips.push(res.equip_keys[i]);var new_equips=[];for(i=0;i<res.equip_keys.length;i++)res.equip_keys[i].equipment_item_idx<77777&&new_equips.push(res.equip_keys[i]);this.update_User_Gnrl_Equipment(res.del_gnrl_key,new_gnrl_key,old_equips);for(var idx=0;idx<new_equips.length;idx++){var found=_user_general_new_equipments.user_general_equips.findIndex(function(eq){return eq.equipment_item_idx==new_equips[idx].equipment_item_idx&&eq.equipment_num==new_equips[idx].equipment_num&&eq.gnrl_id==res.del_gnrl_key.gnrl_id&&eq.gnrl_num==res.del_gnrl_key.gnrl_num});-1!=found&&(_user_general_new_equipments.user_general_equips[found].gnrl_id=res.new_gnrl.gnrl_id,_user_general_new_equipments.user_general_equips[found].gnrl_num=res.new_gnrl.gnrl_num)}Instance.update_hwandan(res.user_hwandan);var genrals=[];genrals.push(res.del_gnrl_key),Instance.remove_user_generals(genrals),Instance.remove_user_generals(res.mtrl_keys),Instance.delete_UserEvolveArmServiceMtrl(),Instance.insert_UserEvolveArmServiceMtrl(res.user_arm_service_mtrl)},Instance.update_hwandan=function(user_hwandans){Instance.delete_UserHwandan(),Instance.insert_UserHwandan(user_hwandans)},Instance.insert_User_Book_General_Evolution=function(gnrl,love_level_max_yn){var data=$.extend({},gnrl);data.max_level_complete_yn="n",data.love_max_level_complete_yn=love_level_max_yn,list_User_book_General.push(data)},Instance.updateEventDungeonSearchTroopsGeneralEvolution=function(key,new_general){for(var keys=map_User_Event_Dungeon_Search_Troops_Generals.keys(),idx=0;idx<keys.length;idx++)for(var troops=map_User_Event_Dungeon_Search_Troops_Generals.at(keys[idx]),t_idx=0;t_idx<troops.length;t_idx++){var g=troops[t_idx];if(g.gnrl_id==key.gnrl_id&&g.gnrl_num==key.gnrl_num)return g.gnrl_id=new_general.gnrl_id,void(g.gnrl_num=new_general.gnrl_num)}},Instance.remove_User_Camp_Cost_General=function(res){if(this.m_game_type!=db.BattleGameType.GreatWallDungeon)var max_troops_num=MAX_TROOPS_NUM-1;for(var i=0;i<max_troops_num;i++){var oldAddedCost=Instance.update_User_Camp_Cost(i+1,res.added_cost);Instance.update_User_Troops_Cost(i+1,res.added_cost,oldAddedCost)}(gnrl_key={}).gnrl_id=res.removed_gnrl_key.gnrl_id,gnrl_key.gnrl_num=res.removed_gnrl_key.gnrl_num,0<gnrl_key.gnrl_id&&(map_User_General.at([gnrl_key.gnrl_id,gnrl_key.gnrl_num]).using_in_camp="n"),Instance.delete_User_Camp_Cost_General(res.troops_num);for(var idx=0;idx<res.gnrl_keys.length;idx++){var gnrl_key=res.gnrl_keys[idx];Instance.insert_User_Camp_Cost_General_ADD(gnrl_key,res.troops_num,idx),0<gnrl_key.gnrl_id&&(map_User_General.at([gnrl_key.gnrl_id,gnrl_key.gnrl_num]).using_in_camp="y",map_User_General.at([gnrl_key.gnrl_id,gnrl_key.gnrl_num]).used_in_camp="n")}Instance.update_user_Generals(),_great_wall_troops_info.partin_generals=res.partin_generals,_great_wall_troops_info.troops_list=res.troops_list},Instance.update_User_Camp_Cost=function(troops_num,added_cost){var oldAddedCost,user_camp=map_User_Camp_cost.at(troops_num);if(null==user_camp){var data=new Object;data.troops_num=troops_num,data.added_cost=0,map_User_Camp_cost.insert(troops_num,data),user_camp=map_User_Camp_cost.at(troops_num)}return oldAddedCost=user_camp.added_cost,user_camp.added_cost=added_cost,oldAddedCost},Instance.set_User_Camp_Cost=function(res){if(this.m_game_type!=db.BattleGameType.GreatWallDungeon)var max_troops_num=MAX_TROOPS_NUM-1;for(var troops_num=res.cost_yunhee.troops_num,keys=map_User_Cost_general.keys(),idx=0;idx<keys.length;idx++){var general=$.extend({},map_User_Cost_general.at(keys[idx]));general.troops_num==troops_num&&0<general.gnrl_id&&0<general.gnrl_num&&(map_User_General.at([general.gnrl_id,general.gnrl_num]).using_in_camp="n")}res.bonus_type==BONUS_TYPE_GOLD?(Instance.upd_UserGold(res.user_amount),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):res.bonus_type==BONUS_TYPE_JADE&&(Instance.upd_UserJade(res.user_amount),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation));for(var i=0;i<max_troops_num;i++){var oldAddedCost=Instance.update_User_Camp_Cost(i+1,res.cost_yunhee.added_cost);Instance.update_User_Troops_Cost(i+1,res.cost_yunhee.added_cost,oldAddedCost)}Instance.delete_User_Camp_Cost_General(res.cost_yunhee.troops_num);for(idx=0;idx<res.cost_yunhee.gnrl_keys.length;idx++){var gnrl_key=res.cost_yunhee.gnrl_keys[idx];Instance.insert_User_Camp_Cost_General_ADD(gnrl_key,res.cost_yunhee.troops_num,idx),0<gnrl_key.gnrl_id&&(map_User_General.at([gnrl_key.gnrl_id,gnrl_key.gnrl_num]).using_in_camp="y",map_User_General.at([gnrl_key.gnrl_id,gnrl_key.gnrl_num]).used_in_camp="n")}Instance.update_user_Generals(),null!=res.partin_generals&&(_great_wall_troops_info.partin_generals=res.partin_generals),null!=res.troops_list&&(_great_wall_troops_info.troops_list=res.troops_list)},Instance.upd_User_Camp=function(res){if(this.m_game_type!=db.BattleGameType.GreatWallDungeon)var max_troops_num=MAX_TROOPS_NUM-1;try{var m_user_camp=CampService.getInstance().get_user_Camp(),camp=m_user_camp.at(res.camp_type);if(camp.camp_level=res.camp_level,m_user_camp.insert(res.camp_type,camp),res.bonus_type==BONUS_TYPE_GOLD?(Instance.upd_UserGold(res.asset_amount),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):res.bonus_type==BONUS_TYPE_JADE&&(Instance.upd_UserJade(res.asset_amount),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)),res.camp_type==CAMP_TYPE_COST)for(var i=1;i<=max_troops_num;i++)Instance.update_User_Troops_Cost(i,res.added_cost,0)}catch(e){}},Instance.update_User_Troops_Cost=function(troops_num,new_added_cost,old_added_cost){var original=map_user_troops.at(troops_num),currCost=original.cost;original.cost=currCost+new_added_cost-old_added_cost,map_user_troops.insert(troops_num,original)},Instance.upd_User_Achievement_Bonus_Recevie=function(res){if(null!=map_achievement_list)for(var keys=map_achievement_list.keys(),i=0;i<keys.length;i++){var original=map_achievement_list.at(keys[i]);if(original.achv_id==res.achv_bonus.achv_id){original.complete_count=res.achv_bonus.complete_count,original.next_id=res.achv_bonus.next_id,original.next_id_complete_yn=res.achv_bonus.next_id_complete_yn,original.bonus_complete_yn="y";var key=original.achv_id;map_achievement_list.insert(key,original),0!=res.achv_bonus.next_id&&Instance.insert_Open_User_Achievement(res.achv_bonus.next_id,res.achv_bonus.complete_count,res.achv_bonus.next_id_complete_yn);break}}},Instance.update_User_Event_Dungeon_Achv_Bonus=function(bonus){var m=MasterManager.getInstance();if(null!=_event_dungeon_achv_list){for(var found=!1,index=0,i=0;i<_event_dungeon_achv_list.achv_list.length;i++)if(bonus.event_dungeon_period_idx==_event_dungeon_achv_list.achv_list[i].event_dungeon_period_idx&&bonus.event_dungeon_achv_list_idx==_event_dungeon_achv_list.achv_list[i].event_dungeon_achv_list_idx){found=!0,index=i;break}if(found&&(_event_dungeon_achv_list.achv_list[index].bonus_complete_yn="y"),0!=bonus.next_achv_id){var achv=m.get_EventDungeonAchvList(bonus.next_achv_id),new_achv={};new_achv.event_dungeon_achv_list_idx=bonus.next_achv_id,new_achv.event_dungeon_period_idx=bonus.event_dungeon_period_idx,new_achv.achv_type=achv.achv_type,new_achv.new_yn="n",new_achv.complete_yn=bonus.next_achv_id_complete_yn,new_achv.complete_count=bonus.complete_count,new_achv.bonus_complete_yn=bonus.next_achv_id_bonus_complete_yn,_event_dungeon_achv_list.achv_list.push(new_achv)}}},Instance.upd_User_Achievement_Bonus_Receive_All=function(res){var m=MasterManager.getInstance();if(null!=map_achievement_list)for(var keys=map_achievement_list.keys(),i=0;i<keys.length;i++)for(var original=map_achievement_list.at(keys[i]),k=0;k<res.achv_bonus_list.length;k++)if(original.achv_id==res.achv_bonus_list[k].achv_id){original.complete_count=res.achv_bonus_list[k].complete_count,original.next_id=res.achv_bonus_list[k].next_id,original.next_id_complete_yn=res.achv_bonus_list[k].next_id_complete_yn,original.bonus_complete_yn="y",original.achv_type=res.achv_type;var key=original.achv_id;map_achievement_list.insert(key,original)}else{var original2={};original2.complete_count=res.achv_bonus_list[k].complete_count,original2.next_id=res.achv_bonus_list[k].next_id,original2.next_id_complete_yn=res.achv_bonus_list[k].next_id_complete_yn,original2.bonus_complete_yn="y",original2.achv_id=res.achv_bonus_list[k].achv_id,original2.achv_type=res.achv_type;key=original2.achv_id;map_achievement_list.insert(key,original2)}for(k=0;k<res.achv_bonus_list.length;k++){var Occur_Type=m.get_AchivementOccurCondition(res.achv_bonus_list[k].achv_id).achv_occur_type;0!=res.achv_bonus_list[k].next_id&&"n"==res.achv_bonus_list[k].next_id_complete_yn?Instance.insert_Open_User_Achievement(res.achv_bonus_list[k].next_id,res.achv_bonus_list[k].complete_count,res.achv_bonus_list[k].next_id_complete_yn):0==res.achv_bonus_list[k].next_id&&1==Occur_Type&&Instance.insert_User_Last_Achievement_Complete(res.achv_bonus_list[k].achv_id,res.achv_bonus_list[k].complete_count)}},Instance.insert_Open_User_Achievement=function(achv_id,complete_count,complete_yn){var achv=MasterManager.getInstance().get_Achivement(achv_id),item={};item.achv_id=achv_id,item.complete_count=complete_count,item.achv_type=achv.achv_type,item.new_yn="n",item.complete_popup_yn="n",item.complete_yn=complete_yn,item.bonus_complete_yn="n",item.complete_count=complete_count;var key=item.achv_id;map_achievement_list.insert(key,item)},Instance.insert_User_Last_Achievement_Complete=function(achv_id,complete_count){var m=MasterManager.getInstance(),achv=m.get_Achivement(achv_id),item=(m.get_AchivementCompleteCondition(achv_id).count,{});item.achv_id=achv_id,item.complete_count=complete_count,item.achv_type=achv.achv_type,item.new_yn="n",item.complete_popup_yn="n",item.complete_yn="y",item.bonus_complete_yn="y",item.complete_count=complete_count;var key=item.achv_id;map_achievement_list.insert(key,item)},Instance.upd_User_Camp_Cost_Slot=function(res){Instance.insert_User_Camp_Cost_Slot_ADD(res.cost_slot),res.bonus_type==BONUS_TYPE_GOLD?(Instance.upd_UserGold(res.user_amount),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)):res.bonus_type==BONUS_TYPE_JADE&&(Instance.upd_UserJade(res.user_amount),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation))},Instance.cancel_User_Camp_Branch_Ability=function(req){var branch_id=req.branch_ability_id,m_camp_branch_ability_log=CampService.getInstance().getCamp_branch_ability_log(),branch_ability=m_camp_branch_ability_log.find(function(obj){if(obj.ability_id==branch_id)return!0}),branch_Index=m_camp_branch_ability_log.findIndex(function(obj){if(obj.ability_id==branch_id)return!0});-1!=branch_Index&&m_camp_branch_ability_log.splice(branch_Index,1);for(var kIndex=0;kIndex<branch_ability.gnrl_keys.length;kIndex++){var gnrl_key={};if(gnrl_key.gnrl_id=branch_ability.gnrl_keys[kIndex].gnrl_id,gnrl_key.gnrl_num=branch_ability.gnrl_keys[kIndex].gnrl_num,0<gnrl_key.gnrl_id){var general=map_User_General.at([gnrl_key.gnrl_id,gnrl_key.gnrl_num]);null!=general&&(general.using_in_camp="n")}}},Instance.upd_User_Camp_Branch_Ability=function(branch_yunhee){$.extend({},branch_yunhee),branch_yunhee.complete_dt=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME))+1e3*branch_yunhee.remain_second,CampService.getInstance().getCamp_branch_ability_log().push(branch_yunhee);for(var idx=0;idx<branch_yunhee.gnrl_keys.length;idx++){var gnrl_key=branch_yunhee.gnrl_keys[idx];if(null==gnrl_key.gnrl_id)break;0<gnrl_key.gnrl_id&&(map_User_General.at([gnrl_key.gnrl_id,gnrl_key.gnrl_num]).using_in_camp="y")}Instance.update_user_Generals()},Instance.upd_Shoten_Time_User_Camp_Branch_Ability=function(res){for(var m_branch_ability_log=CampService.getInstance().getCamp_branch_ability_log(),idx=0;idx<m_branch_ability_log.length;idx++){(original=m_branch_ability_log[idx]).ability_id==res.branch_ability_id&&(original.complete_yn=res.complete_yn,original.remain_second=res.remain_second,original.complete_dt=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME))+1e3*original.remain_second,m_branch_ability_log[idx]=original)}if(Instance.upd_UserJade(res.user_amount),"y"==res.complete_yn){for(idx=0;idx<m_branch_ability_log.length;idx++){var original;if((original=m_branch_ability_log[idx]).ability_id==res.branch_ability_id){var gnrl_key={};null!=original.gnrl_keys[0]&&(gnrl_key.gnrl_id=original.gnrl_keys[0].gnrl_id,gnrl_key.gnrl_num=original.gnrl_keys[0].gnrl_num,0<gnrl_key.gnrl_id&&map_User_General.remove([gnrl_key.gnrl_id,gnrl_key.gnrl_num]));gnrl_key={};if(null!=original.gnrl_keys[1]&&(gnrl_key.gnrl_id=original.gnrl_keys[1].gnrl_id,gnrl_key.gnrl_num=original.gnrl_keys[1].gnrl_num,0<gnrl_key.gnrl_id&&map_User_General.remove([gnrl_key.gnrl_id,gnrl_key.gnrl_num])),null!=original.gnrl_keys[2])(gnrl_key={}).gnrl_id=original.gnrl_keys[2].gnrl_id,gnrl_key.gnrl_num=original.gnrl_keys[2].gnrl_num,0<gnrl_key.gnrl_id&&map_User_General.remove([gnrl_key.gnrl_id,gnrl_key.gnrl_num]);if(null!=original.gnrl_keys[3])(gnrl_key={}).gnrl_id=original.gnrl_keys[3].gnrl_id,gnrl_key.gnrl_num=original.gnrl_keys[3].gnrl_num,0<gnrl_key.gnrl_id&&map_User_General.remove([gnrl_key.gnrl_id,gnrl_key.gnrl_num])}}Instance.update_user_Generals(),"y"==res.complete_yn&&(Instance.delete_User_Camp_Branch_Ability(),Instance.insert_User_Camp_Branch_Ability(res.branch_ability))}},Instance.remove_user_generals=function(gnrls){for(var idx=0;idx<gnrls.length;idx++)Instance.remove_User_General(gnrls[idx]);Instance.update_user_Generals()},Instance.update_user_Generals=function(){},Instance.upd_Main_Mission_Battle_Begin_V2=function(res){var m=MasterManager.getInstance(),mission=$.extend({},database.MainMission);mission=m.get_MainMission(res.mission_id);UserService.getInstance();Instance.upd_User_Key(res.user_key);for(var count=0,user_main_story=Instance.get_User_main_story(),keys=user_main_story.keys(),i=0;i<keys.length;i++)user_main_story.at(keys[i]).main_story_id==mission.main_story_id&&user_main_story.at(keys[i]).difficulty_type==mission.difficulty_type&&user_main_story.at(keys[i]).main_scene_id==mission.main_scene_id&&(count+=1);if(0==count){var key=mission.main_scene_id+""+mission.main_story_id+mission.difficulty_type;mission.new_yn="n",mission.complete_yn="n",User_main_story.insert(key,mission)}count=0;for(var cnt_user_mission_length=map_user_main_mission.length,uidx=0;uidx<cnt_user_mission_length;uidx++)map_user_main_mission[uidx].main_mission_id==res.mission_id&&(count+=1);if(0==count){var data={main_mission_id:res.mission_id,new_yn:"y",complete_yn:"n",win_count:0};map_user_main_mission.push($.extend({},data)),data=null}Instance.upd_UserHeart(res.user_heart)},Instance.update_User_General_Level_Up=function(gnrl_key,level,exp){map_User_General.at([gnrl_key.gnrl_id,gnrl_key.gnrl_num]).gnrl_level=level,map_User_General.at([gnrl_key.gnrl_id,gnrl_key.gnrl_num]).gnrl_exp=exp},Instance.upd_User_Mail_Reward_Receive=function(res){for(var idx=[],i=0;i<list_User_Mail.size();i++)list_User_Mail.at(i).mail_num==res.num&&idx.push(i);for(i=0;i<idx.length;i++)list_User_Mail.erase(idx[i]);if(res.bonus_type==BONUS_TYPE_NORMAL_YUNHEE||res.bonus_type==BONUS_TYPE_HIGH_YUNHEE||res.bonus_type==BONUS_TYPE_HN_RARE_TYPE_SELECT||res.bonus_type==BONUS_TYPE_R_RARE_TYPE_SELECT||res.bonus_type==BONUS_TYPE_HR_RARE_TYPE_SELECT||res.bonus_type==BONUS_TYPE_SR_RARE_TYPE_SELECT||res.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||res.bonus_type==BONUS_TYPE_R_RARE_TYPE_ENGAGE||res.bonus_type==BONUS_TYPE_HR_RARE_TYPE_ENGAGE||res.bonus_type==BONUS_TYPE_SR_RARE_TYPE_ENGAGE||res.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_SELECT||res.bonus_type==BONUS_TYPE_JIN_FIX||res.bonus_type==BONUS_TYPE_YUNHEE_FIX||res.bonus_type==BONUS_TYPE_HIGH_ENGAGE_TEN||res.bonus_type==BONUS_TYPE_NORMAL_ENGAGE_TEN||res.bonus_type==BONUS_TYPE_HIGH_ENGAGE||res.bonus_type==BONUS_TYPE_NORMAL_ENGAGE||res.bonus_type==BONUS_TYPE_HIGH_ENGAGE_ARMY||res.bonus_type==BONUS_TYPE_HIGH_ENGAGE_TEN_ARMY||res.bonus_type==BONUS_TYPE_NORMAL_ENGAGE_ARMY||res.bonus_type==BONUS_TYPE_NORMAL_ENGAGE_TEN_ARMY||res.bonus_type==BONUS_TYPE_CHOCK_SELECT||res.bonus_type==BONUS_TYPE_WIE_SELECT||res.bonus_type==BONUS_TYPE_OH_SELECT||res.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT||res.bonus_type==BONUS_TYPE_JIN_5_CLASS_SELECT||res.bonus_type==BONUS_TYPE_HIGH_ENGAGE_SECOND_HALF||res.bonus_type==BONUS_TYPE_SR_OVER_GACHA_TICKET||res.bonus_type==BONUS_TYPE_SSR_GACHA_TICKET||res.bonus_type==BONUS_TYPE_MILEAGE_GACHA_TICKET_1||res.bonus_type==BONUS_TYPE_MILEAGE_GACHA_TICKET_2||res.bonus_type==BONUS_TYPE_MILEAGE_GACHA_TICKET_3||res.bonus_type==BONUS_TYPE_MILEAGE_GACHA_TICKET_4||res.bonus_type==BONUS_TYPE_MILEAGE_GACHA_TICKET_5||res.bonus_type==BONUS_TYPE_MILEAGE_GACHA_TICKET_10||res.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_NEW_YEAR_SELECT||res.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_NEW_YEAR_GACHA_TICKET||res.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_SELECT_NEW_RETURN_USER||res.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_SELECT_JAPAN_BATTLE||res.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_GACHA_REBORN_GNRL_TICKET||res.bonus_type==BONUS_TYPE_SSR_RARE_TYPE_GACHA_2019_NEW_YEARS_TICKET||res.bonus_type==BONUS_TYPE_ALL_RARE_TYPE_GNRL_SELECT_TICKET||res.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET||res.bonus_type==BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET_V2||res.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET||res.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_2||res.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_3||res.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_4||res.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_5||res.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_6||res.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_7||res.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_8||res.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_9||res.bonus_type==BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_10||res.bonus_type>=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_11&&res.bonus_type<=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_23||res.bonus_type>=BONUS_TYPE_DUMMY_GACHA_TICKET_1&&res.bonus_type<=BONUS_TYPE_DUMMY_GACHA_TICKET_20||res.bonus_type>=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_31&&res.bonus_type<=BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_80)Instance.insert_User_General(res.bonus_key),Instance.insert_User_Book_General(res.bonus_key);else if(res.bonus_type==BONUS_TYPE_ILLUSTRATE_TICKET)Instance.insert_User_Illust(res.bonus_key);else if(res.bonus_type==BONUS_TYPE_YUNHEE_SLOT_TICKET)this.update_User_Yunhee_Bound(res.bonus_key[0].count);else if(res.bonus_type==BONUS_TYPE_EQUIPMENT_SLOT_TICKET)this.update_User_Equipment_Bound(res.bonus_key[0].count);else if(res.bonus_type==BONUS_TYPE_TEST_LIMIT_STEP_1_ALL_BOX||res.bonus_type==BONUS_TYPE_TEST_LIMIT_STEP_2_ALL_BOX||res.bonus_type==BONUS_TYPE_TEST_LIMIT_STEP_3_ALL_BOX||res.bonus_type==BONUS_TYPE_TEST_LIMIT_STEP_4_ALL_BOX||res.bonus_type==BONUS_TYPE_TEST_LIMIT_STEP_5_ALL_BOX)this.insert_User_General(res.bonus_key),this.update_User_General_Limit_Step(res.bonus_type,res.bonus_key);else if(res.bonus_type==BONUS_TYPE_EVENT_DUNGEON_LOVE_SETTING_YUNHEE)this.insert_User_General_Love_Setting(res);else if(res.bonus_type==BONUS_TYPE_EXP_BOOSTER)_exp_booster_item.booster_id=res.bonus_key[0].key_id,_exp_booster_item.exp_inc=res.bonus_key[0].key_num,_exp_booster_item.remain_dt=res.bonus_key[0].count,_exp_booster_item.enabled_yn="y";else if(res.bonus_type==BONUS_TYPE_LOVE_ITEM||res.bonus_type==BONUS_TYPE_LOVE_ITEM_MELEE||res.bonus_type==BONUS_TYPE_LOVE_ITEM_LANCER||res.bonus_type==BONUS_TYPE_LOVE_ITEM_RANGER||res.bonus_type==BONUS_TYPE_LOVE_ITEM_CAKE||res.bonus_type==BONUS_TYPE_YUBI_LOVE_ITEM||res.bonus_type==BONUS_TYPE_CHRISTMAS_LOVE_ITEM||res.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE||res.bonus_type==BONUS_TYPE_WHITE_CHOCO||res.bonus_type==BONUS_TYPE_COMEBACK_CAKE||res.bonus_type==BONUS_TYPE_LOVE_MAX_CAKE||res.bonus_type>=BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_01&&res.bonus_type<=BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_10)Instance.plus_User_Love_Item(res.bonus_key[0].key_id,res.bonus_count);else if(res.bonus_type==BONUS_TYPE_LOVE_ITEM_VD_COCHOLATE_A||res.bonus_type==BONUS_TYPE_LOVE_ITEM_VD_COCHOLATE_B||res.bonus_type==BONUS_TYPE_LOVE_ITEM_PARTNER_COCHOLATE){var love_id=GeneralService.getInstance().getBonusTypeToLoveId(res.bonus_key[0].key_bonus_type);Instance.plus_User_Love_Item(love_id,res.bonus_count,res.bonus_key[0].key_id)}else if(res.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||res.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL)Instance.plus_User_Limit_Over_Mtrl(res.bonus_key[0].key_id,res.bonus_count);else if(res.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL)Instance.plus_User_Magic_Key_Mtrl(res.bonus_count);else if(res.bonus_type==BONUS_TYPE_RAID_POINT)Instance.plus_User_Raid_Point(res.bonus_key[0].key_id,res.bonus_count);else if(res.bonus_type==BONUS_TYPE_CRAFT_SHOP_FIRST_LOW||res.bonus_type==BONUS_TYPE_CRAFT_SHOP_FIRST_MIDDLE||res.bonus_type==BONUS_TYPE_CRAFT_SHOP_FIRST_HIGH||res.bonus_type==BONUS_TYPE_CRAFT_SHOP_FIRST_UNIQUE||res.bonus_type==BONUS_TYPE_CRAFT_SHOP_SECOND_MIDDLE||res.bonus_type==BONUS_TYPE_CRAFT_SHOP_SECOND_HIGH||res.bonus_type==BONUS_TYPE_CRAFT_SHOP_SECOND_UNIQUE||res.bonus_type==BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND||res.bonus_type==BONUS_TYPE_CHRISTMAS_RIBBON||res.bonus_type==BONUS_TYPE_CHRISTMAS_STAR||res.bonus_type==BONUS_TYPE_CHRISTMAS_BALL||res.bonus_type==BONUS_TYPE_CHRISTMAS_BELL||res.bonus_type==BONUS_TYPE_CHRISTMAS_ANGEL||res.bonus_type==BONUS_TYPE_CHRISTMAS_LOLLIPOPS||res.bonus_type==BONUS_TYPE_CHRISTMAS_COOKIE||res.bonus_type==BONUS_TYPE_CHRISTMAS_SOCKS||res.bonus_type==BONUS_TYPE_CHRISTMAS_TREE||res.bonus_type==BONUS_TYPE_CHRISTMAS_APPLE){var craft_shop_bonus_type=GeneralService.getInstance().getBonusTypeToCraftShopMtrlType(res.bonus_type);Instance.plus_User_Craft_Shop_Material(craft_shop_bonus_type,res.bonus_count)}else if(res.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||res.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||res.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||res.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||res.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||res.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||res.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||res.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||res.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||res.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||res.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||res.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||res.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){var rebirth_mtrl_type=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(res.bonus_type);Instance.plus_User_Rebirth_Mtrl(rebirth_mtrl_type,res.bonus_count)}else if(res.bonus_type==BONUS_TYPE_CHRISTMAS_GACHA_TICKET_BOX)Instance.update_User_Gacha_Ticket(res.key_id,res.bonus_count);else if(res.bonus_type==BONUS_TYPE_CHRISTMAS_GIFT_BOX||res.bonus_type==BONUS_TYPE_RETURN_USER_GIFT_BOX||res.bonus_type==BONUS_TYPE_CHRISTMAS_LOGIN_GIFT_BOX||res.bonus_type==BONUS_TYPE_JADE_RANDOM_BOX||res.bonus_type==BONUS_TYPE_GOLD_RANDOM_BOX||res.bonus_type==BONUS_TYPE_LOVE_ITEM_RANDOM_BOX||res.bonus_type==BONUS_TYPE_RARE_HWANDAN_RANDOM_BOX||res.bonus_type==BONUS_TYPE_EXP_CARD_RANDOM_BOX||res.bonus_type==BONUS_TYPE_SWORD_ORB_RANDDOM_BOX||res.bonus_type==BONUS_TYPE_SPEAR_ORB_RANDDOM_BOX||res.bonus_type==BONUS_TYPE_ARCHER_ORB_RANDDOM_BOX||res.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_RANDOM_BOX||res.bonus_type==BONUS_TYPE_FORMATION_PROPERTY_POINT_GIFT_BOX||res.bonus_type==BONUS_TYPE_EXP_SET_HIGH||res.bonus_type==BONUS_TYPE_EVOLVE_MTRL_SET||res.bonus_type==BONUS_TYPE_TEST_BOX||res.bonus_type==BONUS_TYPE_TEST_SOLDIER_0_BOX||res.bonus_type==BONUS_TYPE_TEST_SOLDIER_1_BOX||res.bonus_type==BONUS_TYPE_TEST_SOLDIER_2_BOX||res.bonus_type==BONUS_TYPE_TEST_YUNHEE_0_BOX||res.bonus_type==BONUS_TYPE_TEST_YUNHEE_1_BOX||res.bonus_type==BONUS_TYPE_TEST_YUNHEE_2_BOX||res.bonus_type==BONUS_TYPE_TEST_SR_LIMIT_OVER_BOX||res.bonus_type==BONUS_TYPE_TEST_SSR_LIMIT_OVER_BOX||res.bonus_type==BONUS_TYPE_TREASURE_BOX||res.bonus_type==BONUS_TYPE_EVENTDUNGEON_PRESENT_GIFT_BOX||res.bonus_type==BONUS_TYPE_TEST_MELEE_BOX||res.bonus_type==BONUS_TYPE_TEST_LANCER_BOX||res.bonus_type==BONUS_TYPE_TEST_ARCHER_BOX||res.bonus_type==BONUS_TYPE_CHRISTMAS_BOX||res.bonus_type==BONUS_TYPE_SONKWON_EVOLUTION1_BOX||res.bonus_type==BONUS_TYPE_SONKWON_EVOLUTION2_BOX||res.bonus_type==BONUS_TYPE_GOLDEN_BOX||res.bonus_type==BONUS_TYPE_SILVER_BOX||res.bonus_type==BONUS_TYPE_CHRISTMAS_BOX_v2||res.bonus_type==BONUS_TYPE_CHRISTMAS_BOX_V3||res.bonus_type==BONUS_TYPE_CHRISTMAS_EVE_LOGIN_BONUS_BOX||res.bonus_type==BONUS_TYPE_SPECIAL_EXP_CARD_BOX||res.bonus_type==BONUS_TYPE_DUMMY_BONUS_BOX_1||res.bonus_type==BONUS_TYPE_DUMMY_BONUS_BOX_2||res.bonus_type==BONUS_TYPE_DUMMY_BONUS_BOX_3||res.bonus_type==BONUS_TYPE_DUMMY_BONUS_BOX_4||res.bonus_type>=BONUS_TYPE_GIFT_BOX_DUMMY_01&&res.bonus_type<=BONUS_TYPE_GIFT_BOX_DUMMY_10)for(i=0;i<res.bonus_key.length;i++)if(res.bonus_key[i].key_bonus_type==BONUS_TYPE_YUNHEE_FIX){var user_gnrl={};user_gnrl.gnrl_id=res.bonus_key[i].key_id,user_gnrl.gnrl_num=res.bonus_key[i].key_num,user_gnrl.castle_id=res.bonus_key[i].key_castle_id,user_gnrl.gnrl_exp=0,user_gnrl.gnrl_level=1,user_gnrl.love_level=1,Instance.insert_User_General_V2(user_gnrl)}else if(res.bonus_key[i].key_bonus_type==BONUS_TYPE_LOVE_ITEM||res.bonus_key[i].key_bonus_type==BONUS_TYPE_LOVE_ITEM_MELEE||res.bonus_key[i].key_bonus_type==BONUS_TYPE_LOVE_ITEM_LANCER||res.bonus_key[i].key_bonus_type==BONUS_TYPE_LOVE_ITEM_RANGER||res.bonus_key[i].key_bonus_type==BONUS_TYPE_LOVE_ITEM_CAKE||res.bonus_key[i].key_bonus_type==BONUS_TYPE_YUBI_LOVE_ITEM||res.bonus_key[i].key_bonus_type==BONUS_TYPE_CHRISTMAS_LOVE_ITEM||res.bonus_key[i].key_bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE||res.bonus_key[i].key_bonus_type==BONUS_TYPE_WHITE_CHOCO||res.bonus_key[i].key_bonus_type==BONUS_TYPE_COMEBACK_CAKE||res.bonus_key[i].key_bonus_type==BONUS_TYPE_LOVE_MAX_CAKE||res.bonus_key[i].key_bonus_type>=BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_01&&res.bonus_key[i].key_bonus_type<=BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_10)Instance.plus_User_Love_Item(res.bonus_key[i].key_id,res.bonus_key[i].count);else if(res.bonus_key[i].key_bonus_type==BONUS_TYPE_EVOLVE_MELEE_MIDDLE||res.bonus_key[i].key_bonus_type==BONUS_TYPE_EVOLVE_LANCER_MIDDLE||res.bonus_key[i].key_bonus_type==BONUS_TYPE_EVOLVE_ARCHER_MIDDLE||res.bonus_key[i].key_bonus_type==BONUS_TYPE_EVOLVE_MELEE_LOW||res.bonus_key[i].key_bonus_type==BONUS_TYPE_EVOLVE_LANCER_LOW||res.bonus_key[i].key_bonus_type==BONUS_TYPE_EVOLVE_ARCHER_LOW||res.bonus_key[i].key_bonus_type==BONUS_TYPE_EVOLVE_MELEE||res.bonus_key[i].key_bonus_type==BONUS_TYPE_EVOLVE_LANCER||res.bonus_key[i].key_bonus_type==BONUS_TYPE_EVOLVE_ARCHER)Instance.plus_User_Evolve_Arm_Service(res.bonus_key[i].key_bonus_type,res.bonus_key[i].count);else if(i.key_bonus_type==BONUS_TYPE_ATTK_POINT||i.key_bonus_type==BONUS_TYPE_DEF_POINT||i.key_bonus_type==BONUS_TYPE_HP_POINT||i.key_bonus_type==BONUS_TYPE_CRI_PRCNT_POINT||i.key_bonus_type==BONUS_TYPE_CRI_DMG_POINT)Instance.plus_User_Formation_Property_Point(res.bonus_key[i].key_bonus_type,res.bonus_key[i].count);else if(i.key_bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||i.key_bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL){var limit_over_mtrl_type=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(i.key_bonus_type);Instance.plus_User_Limit_Over_Mtrl(limit_over_mtrl_type,res.bonus_key[i].count)}else if(res.bonus_key[i].key_bonus_type==BONUS_TYPE_RARE_HWANDAN_RANDOM_BOX)Instance.plus_User_Hwandan(res.bonus_key[i].key_bonus_type,res.bonus_key[i].count);else if(res.bonus_key[i].key_bonus_type==BONUS_TYPE_EQUIPMENT){MasterManager.getInstance().get_EquipmentItem(res.bonus_key[i].key_id).equipment_type,EQUIPMENT_TYPE_EXP;var e={};e.equipment_item_idx=res.bonus_key[i].key_id,e.equipment_num=res.bonus_key[i].key_num,e.level=1,e.exp=0,e.arm_service_type=ARMSERVICETYPE_NONE,e.step=0,e.combo_stat=2,e.stat_value=1,e.option_num1=0,e.option_num2=0,e.option_num3=0,e.option_num4=0,e.option_num5=0,e.equip_yn="n",e.lock_yn="n",e.activity_type=1,e.base_stat_level_id=res.bonus_key[i].key_id,Instance.insert_User_Equipment(e)}else if(res.bonus_key[i].key_bonus_type==BONUS_TYPE_NEW_EQUIPMENT_ITEM){(user_equip_data={}).new_equipment_idx=res.bonus_key[i].key_id,user_equip_data.equip_num=res.bonus_key[i].key_num,user_equip_data.level=1,user_equip_data.exp=0,user_equip_data.smelt_level=0,user_equip_data.enchant_opt_1=0,user_equip_data.enchant_opt_2=0,user_equip_data.enchant_opt_3=0,user_equip_data.enchant_opt_4=0,user_equip_data.mount_yn="n",user_equip_data.lock_yn="n",user_equip_data.activity_type=1,Instance.insert_New_User_Equipment($.extend({},user_equip_data))}else Instance.insert_User_Mail_Item(res.bonus_key[i].key_bonus_type,res.bonus_key[i].count);else if(res.bonus_type==BONUS_TYPE_CHRISTMAS_SANTA||res.bonus_type==BONUS_TYPE_CHRISTMAS_REINDEER||res.bonus_type==BONUS_TYPE_CHRISTMAS_SNOWMAN)Instance.update_User_Christmas_Reward(res.bonus_type,res.bonus_count,res.key_id);else if(res.bonus_type==BONUS_TYPE_EQUIPMENT||res.bonus_type>=BONUS_TYPE_EQUIPMENT_EXP_BOX_1&&res.bonus_type<=BONUS_TYPE_EQUIPMENT_EXP_BOX_4){var mt=MasterManager.getInstance();res.bonus_key.forEach(function(bonus_key){mt.get_EquipmentItem(bonus_key.key_id).equipment_type,EQUIPMENT_TYPE_EXP;var user_equipment={};user_equipment.equipment_item_idx=bonus_key.key_id,user_equipment.equipment_num=bonus_key.key_num,user_equipment.level=1,user_equipment.exp=0,user_equipment.arm_service_type=ARMSERVICETYPE_NONE,user_equipment.step=0,user_equipment.combo_stat=2,user_equipment.stat_value=1,user_equipment.option_num1=0,user_equipment.option_num2=0,user_equipment.option_num3=0,user_equipment.option_num4=0,user_equipment.option_num5=0,user_equipment.equip_yn="n",user_equipment.lock_yn="n",user_equipment.activity_type=1,user_equipment.base_stat_level_id=bonus_key.key_id,Instance.insert_User_Equipment(user_equipment)})}else if(res.bonus_type==BONUS_TYPE_WORLD_WAR_MEDAL)NetServiceV3.getInstance().plus_World_War_Medal(res.bonus_count);else if(res.bonus_type==BONUS_TYPE_WORLD_WAR_UNIQUE_EQUIPMENT_TICKET)NetServiceV3.getInstance().plus_Unique_Equipment_Ticket(res.bonus_count);else if(res.bonus_type==BONUS_TYPE_SKIP_TICKET)Instance.plus_User_Skip_Ticket(res.bonus_count);else if(res.bonus_type==BONUS_TYPE_EXCHANGE_TICKET)Instance.plus_User_Exchange_Ticket(res.bonus_count);else if(res.bonus_type==BONUS_TYPE_SPECIAL_GACHA_TICKET)Instance.plus_User_Special_Gacha_Ticket(res.key_id,res.bonus_count);else if(res.bonus_type==BONUS_TYPE_GNRL_PIECE)Instance.plus_User_Gnrl_Piece(res.key_id,res.bonus_count);else if(res.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_MAKE_MATERIAL)Instance.plus_User_New_Equipment_Make_Material(res.key_id,res.bonus_count);else if(res.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_ENHANCE_MATERIAL)Instance.plus_User_New_Equipment_Enhance_Material(res.key_id,res.bonus_count);else if(res.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_SMELT_MATERIAL)Instance.plus_User_New_Equipment_Smelt_Material(res.key_id,res.bonus_count);else if(res.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_ENCHANT_TICKET)Instance.plus_User_New_Equipment_Enchant_Ticket(res.key_id,res.bonus_count);else if(res.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_ITEM)for(var bonus_key_idx=0;bonus_key_idx<res.bonus_key.length;bonus_key_idx++){var user_equip_data;(user_equip_data={}).new_equipment_idx=bonus_key.key_id,user_equip_data.equip_num=bonus_key.key_num,user_equip_data.level=1,user_equip_data.exp=0,user_equip_data.smelt_level=0,user_equip_data.enchant_opt_1=0,user_equip_data.enchant_opt_2=0,user_equip_data.enchant_opt_3=0,user_equip_data.enchant_opt_4=0,user_equip_data.mount_yn="n",user_equip_data.lock_yn="n",user_equip_data.activity_type=1,Instance.insert_New_User_Equipment($.extend({},user_equip_data))}else res.bonus_type==BONUS_TYPE_NEW_RAID_BOSS_POINT?Instance.plus_User_New_Raid_Point(res.key_id,res.bonus_count):Instance.insert_User_Mail_Item(res.bonus_type,res.bonus_count);var context=GameContext.getInstance();0<list_User_Mail.size()?context.setUserNewMail("y"):context.setUserNewMail("n")},Instance.insert_New_User_Equipment=function(user_new_equipment){-1!=_user_new_euipment_list.user_equipments.findIndex(function(e){return e.new_equipment_idx==user_new_equipment.new_equipment_idx&&e.equip_num==user_new_equipment.equip_num})&&_user_new_euipment_list.user_equipments.push_back(user_new_equipment)},Instance.getNewEquipmentOnGeneral=function(gnrl){for(var equips=[],gnrl_equip_list=[],i=0;i<_user_general_new_equipments.user_general_equips.length;i++){var k=_user_general_new_equipments.user_general_equips[i];k.gnrl_id==gnrl.gnrl_id&&k.gnrl_num==gnrl.gnrl_num&&gnrl_equip_list.push(k)}if(0<gnrl_equip_list.size())for(var idx=0;idx<gnrl_equip_list.length;idx++){var found_equip=_user_new_euipment_list.user_equipments.findIndex(function(e){return e.new_equipment_idx==gnrl_equip_list[idx].equipment_item_idx&&e.equip_num==gnrl_equip_list[idx].equipment_num});-1!=found_equip&&equips.push_back(_user_new_euipment_list.user_equipments[found_equip])}return equips},Instance.insert_User_Mail_Item=function(bonus_type,bonus_count,item_id,item_num){switch(bonus_type){case BONUS_TYPE_GOLD:Instance.plus_User_Gold(bonus_count);break;case BONUS_TYPE_KEY:case BONUS_TYPE_KEY_REFILL:Instance.plus_User_Key(bonus_count);break;case BONUS_TYPE_RAID_TICKET:case BONUS_TYPE_RAID_TICKET_REFILL:Instance.plus_User_Raid_Ticket(bonus_count);break;case BONUS_TYPE_RAID_HELP_TICKET:Instance.plus_User_Raid_Help_Ticket(bonus_count);break;case BONUS_TYPE_NEW_RAID_BOSS_CALL_KEY:Instance.plus_User_New_Raid_Call_Ticket(bonus_count);break;case BONUS_TYPE_NEW_RAID_BOSS_BATTLE_KEY:Instance.plus_User_New_Raid_Conquest_Ticket(bonus_count);break;case BONUS_TYPE_HEART:Instance.plus_User_Heart(bonus_count);break;case BONUS_TYPE_JADE:Instance.plus_User_Jade(bonus_count);break;case BONUS_TYPE_HWANDAN_1:case BONUS_TYPE_HWANDAN_2:case BONUS_TYPE_HWANDAN_3:case BONUS_TYPE_HWANDAN_4:case BONUS_TYPE_HWANDAN_5:case BONUS_TYPE_HWANDAN_6:case BONUS_TYPE_HWANDAN_7:case BONUS_TYPE_YUBI_RARE:Instance.plus_User_Hwandan(bonus_type,bonus_count);break;case BONUS_TYPE_UNIFICATION_FOOD:break;case BONUS_TYPE_EVOLVE_STONE:Instance.plus_User_Evolve_Stone(bonus_count);break;case BONUS_TYPE_YUNHEE_PT:Instance.plus_User_Yunhee_PT(bonus_count);break;case BONUS_TYPE_HEAVEN_PT:Instance.plus_User_Heaven_PT(bonus_count);break;case BONUS_TYPE_EVOLVE_MELEE:case BONUS_TYPE_EVOLVE_LANCER:case BONUS_TYPE_EVOLVE_ARCHER:case BONUS_TYPE_EVOLVE_MELEE_MIDDLE:case BONUS_TYPE_EVOLVE_LANCER_MIDDLE:case BONUS_TYPE_EVOLVE_ARCHER_MIDDLE:case BONUS_TYPE_EVOLVE_MELEE_LOW:case BONUS_TYPE_EVOLVE_LANCER_LOW:case BONUS_TYPE_EVOLVE_ARCHER_LOW:case BONUS_TYPE_YUBI_EVOLVE_HIGH:case BONUS_TYPE_YUBI_EVOLVE_MIDDLE:case BONUS_TYPE_YUBI_EVOLVE_LOW:Instance.plus_User_Evolve_Arm_Service(bonus_type,bonus_count);break;case BONUS_TYPE_ATTK_POINT:case BONUS_TYPE_DEF_POINT:case BONUS_TYPE_HP_POINT:case BONUS_TYPE_CRI_PRCNT_POINT:case BONUS_TYPE_CRI_DMG_POINT:Instance.plus_User_Formation_Property_Point(bonus_type,bonus_count);break;case BONUS_TYPE_EVOLVE_ORB:Instance.plus_User_Evolve_Orb(bonus_count);break;case BONUS_TYPE_FORMATION_POINT:Instance.plus_User_Formation_Point(bonus_count);break;case BONUS_TYPE_KEY_REFILL:Instance.plus_User_Key(bonus_count);break;case BONUS_TYPE_TICKET_REFILL:break;case BONUS_TYPE_CRAFT_SHOP_FIRST_LOW:case BONUS_TYPE_CRAFT_SHOP_FIRST_MIDDLE:case BONUS_TYPE_CRAFT_SHOP_FIRST_HIGH:case BONUS_TYPE_CRAFT_SHOP_FIRST_UNIQUE:case BONUS_TYPE_CRAFT_SHOP_SECOND_MIDDLE:case BONUS_TYPE_CRAFT_SHOP_SECOND_HIGH:case BONUS_TYPE_CRAFT_SHOP_SECOND_UNIQUE:case BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND:case BONUS_TYPE_CHRISTMAS_RIBBON:case BONUS_TYPE_CHRISTMAS_STAR:case BONUS_TYPE_CHRISTMAS_BALL:case BONUS_TYPE_CHRISTMAS_BELL:case BONUS_TYPE_CHRISTMAS_ANGEL:case BONUS_TYPE_CHRISTMAS_LOLLIPOPS:case BONUS_TYPE_CHRISTMAS_COOKIE:case BONUS_TYPE_CHRISTMAS_SOCKS:case BONUS_TYPE_CHRISTMAS_TREE:case BONUS_TYPE_CHRISTMAS_APPLE:var craft_shop_bonus_type=GeneralService.getInstance().getBonusTypeToCraftShopMtrlType(bonus_type);Instance.plus_User_Craft_Shop_Material(craft_shop_bonus_type,bonus_count);break;case BONUS_TYPE_REBIRTH_MTRL_TYPE_1:case BONUS_TYPE_REBIRTH_MTRL_TYPE_2:case BONUS_TYPE_REBIRTH_MTRL_TYPE_3:case BONUS_TYPE_REBIRTH_MTRL_TYPE_4:case BONUS_TYPE_REBIRTH_MTRL_TYPE_5:case BONUS_TYPE_REBIRTH_MTRL_TYPE_6:case BONUS_TYPE_REBIRTH_MTRL_TYPE_7:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6:var rebirth_mtrl_type=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(bonus_type);Instance.plus_User_Rebirth_Mtrl(rebirth_mtrl_type,bonus_count);break;case BONUS_TYPE_RAID_POINT:Instance.plus_User_Raid_Point(item_id,bonus_count);break;case BONUS_TYPE_MAGIC_KEY_MTRL:Instance.plus_User_Magic_Key_Mtrl(bonus_count);break;case BONUS_TYPE_RAID_HELP_TICKET_REFILL:Instance.plus_User_Raid_Help_Ticket(bonus_count);break;case BONUS_TYPE_GREAT_WALL_TICKET_REFILL:case BONUS_TYPE_GREAT_WALL_TICKET:Instance.plus_User_Great_Wall_Ticket(bonus_count);break;case BONUS_TYPE_WORLD_WAR_TICKET_REFILL:Instance.plus_User_World_War_Ticket(bonus_count);break;case BONUS_TYPE_JADE_PIECE:Instance.plus_User_Jade_Piece(bonus_count);break;case BONUS_TYPE_SKIP_TICKET:Instance.plus_User_Skip_Ticket(bonus_count);break;case BONUS_TYPE_EXCHANGE_TICKET:Instance.plus_User_Exchange_Ticket(bonus_count);break;case BONUS_TYPE_SPECIAL_GACHA_TICKET:Instance.plus_User_Special_Gacha_Ticket(item_id,bonus_count)}MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)},Instance.upd_User_Mail_All_Reward_Receive=function(res){for(var context=GameContext.getInstance(),i=0;i<res.success_reward_list.length;i++)switch(res.success_reward_list[i].bonus_type){case BONUS_TYPE_GOLD:Instance.plus_User_Gold(res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_JADE_PIECE:Instance.plus_User_Jade_Piece(res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_WORLD_WAR_MEDAL:NetServiceV3.getInstance().plus_World_War_Medal(res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_WORLD_WAR_TICKET_REFILL:Instance.plus_User_World_War_Ticket(res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_WORLD_WAR_UNIQUE_EQUIPMENT_TICKET:NetServiceV3.getInstance().plus_Unique_Equipment_Ticket(res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_SKIP_TICKET:Instance.plus_User_Skip_Ticket(res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_EXCHANGE_TICKET:Instance.plus_User_Exchange_Ticket(res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_SPECIAL_GACHA_TICKET:Instance.plus_User_Special_Gacha_Ticket(res.success_reward_list[i].bonus_key[0].key_id,res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_KEY:Instance.plus_User_Key(res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_RAID_TICKET:Instance.plus_User_Raid_Ticket(res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_RAID_HELP_TICKET:Instance.plus_User_Raid_Help_Ticket(res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_HEART:Instance.plus_User_Heart(res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_JADE:Instance.plus_User_Jade(res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_HWANDAN_1:case BONUS_TYPE_HWANDAN_2:case BONUS_TYPE_HWANDAN_3:case BONUS_TYPE_HWANDAN_4:case BONUS_TYPE_HWANDAN_5:case BONUS_TYPE_HWANDAN_6:case BONUS_TYPE_HWANDAN_7:case BONUS_TYPE_YUBI_RARE:Instance.plus_User_Hwandan(res.success_reward_list[i].bonus_type,res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_EVOLVE_STONE:Instance.plus_User_Evolve_Stone(res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_YUNHEE_PT:Instance.plus_User_Yunhee_PT(res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_HEAVEN_PT:Instance.plus_User_Heaven_PT(res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_EVOLVE_MELEE:case BONUS_TYPE_EVOLVE_LANCER:case BONUS_TYPE_EVOLVE_ARCHER:case BONUS_TYPE_EVOLVE_MELEE_MIDDLE:case BONUS_TYPE_EVOLVE_LANCER_MIDDLE:case BONUS_TYPE_EVOLVE_ARCHER_MIDDLE:case BONUS_TYPE_EVOLVE_MELEE_LOW:case BONUS_TYPE_EVOLVE_LANCER_LOW:case BONUS_TYPE_EVOLVE_ARCHER_LOW:case BONUS_TYPE_YUBI_EVOLVE_HIGH:case BONUS_TYPE_YUBI_EVOLVE_MIDDLE:case BONUS_TYPE_YUBI_EVOLVE_LOW:Instance.plus_User_Evolve_Arm_Service(res.success_reward_list[i].bonus_type,res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_CRAFT_SHOP_FIRST_LOW:case BONUS_TYPE_CRAFT_SHOP_FIRST_MIDDLE:case BONUS_TYPE_CRAFT_SHOP_FIRST_HIGH:case BONUS_TYPE_CRAFT_SHOP_FIRST_UNIQUE:case BONUS_TYPE_CRAFT_SHOP_SECOND_MIDDLE:case BONUS_TYPE_CRAFT_SHOP_SECOND_HIGH:case BONUS_TYPE_CRAFT_SHOP_SECOND_UNIQUE:case BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND:case BONUS_TYPE_CHRISTMAS_RIBBON:case BONUS_TYPE_CHRISTMAS_STAR:case BONUS_TYPE_CHRISTMAS_BALL:case BONUS_TYPE_CHRISTMAS_BELL:case BONUS_TYPE_CHRISTMAS_ANGEL:case BONUS_TYPE_CHRISTMAS_LOLLIPOPS:case BONUS_TYPE_CHRISTMAS_COOKIE:case BONUS_TYPE_CHRISTMAS_SOCKS:case BONUS_TYPE_CHRISTMAS_TREE:case BONUS_TYPE_CHRISTMAS_APPLE:var craft_shop_bonus_type=GeneralService.getInstance().getBonusTypeToCraftShopMtrlType(res.success_reward_list[i].bonus_type);Instance.plus_User_Craft_Shop_Material(craft_shop_bonus_type,res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_REBIRTH_MTRL_TYPE_1:case BONUS_TYPE_REBIRTH_MTRL_TYPE_2:case BONUS_TYPE_REBIRTH_MTRL_TYPE_3:case BONUS_TYPE_REBIRTH_MTRL_TYPE_4:case BONUS_TYPE_REBIRTH_MTRL_TYPE_5:case BONUS_TYPE_REBIRTH_MTRL_TYPE_6:case BONUS_TYPE_REBIRTH_MTRL_TYPE_7:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5:case BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6:var rebirth_mtrl_type=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(res.success_reward_list[i].bonus_type);Instance.plus_User_Rebirth_Mtrl(rebirth_mtrl_type,res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_ATTK_POINT:case BONUS_TYPE_DEF_POINT:case BONUS_TYPE_HP_POINT:case BONUS_TYPE_CRI_PRCNT_POINT:case BONUS_TYPE_CRI_DMG_POINT:Instance.plus_User_Formation_Property_Point(res.success_reward_list[i].bonus_type,res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_EVOLVE_ORB:Instance.plus_User_Evolve_Orb(res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_UNIFICATION_FOOD:break;case BONUS_TYPE_NORMAL_YUNHEE:case BONUS_TYPE_HIGH_YUNHEE:case BONUS_TYPE_HN_RARE_TYPE_SELECT:case BONUS_TYPE_R_RARE_TYPE_SELECT:case BONUS_TYPE_HR_RARE_TYPE_SELECT:case BONUS_TYPE_SR_RARE_TYPE_SELECT:case BONUS_TYPE_HN_RARE_TYPE_ENGAGE:case BONUS_TYPE_R_RARE_TYPE_ENGAGE:case BONUS_TYPE_HR_RARE_TYPE_ENGAGE:case BONUS_TYPE_SR_RARE_TYPE_ENGAGE:case BONUS_TYPE_SSR_RARE_TYPE_SELECT:case BONUS_TYPE_JIN_FIX:case BONUS_TYPE_YUNHEE_FIX:case BONUS_TYPE_HIGH_ENGAGE_TEN:case BONUS_TYPE_NORMAL_ENGAGE_TEN:case BONUS_TYPE_HIGH_ENGAGE:case BONUS_TYPE_NORMAL_ENGAGE:case BONUS_TYPE_HIGH_ENGAGE_ARMY:case BONUS_TYPE_HIGH_ENGAGE_TEN_ARMY:case BONUS_TYPE_NORMAL_ENGAGE_ARMY:case BONUS_TYPE_NORMAL_ENGAGE_TEN_ARMY:case BONUS_TYPE_CHOCK_SELECT:case BONUS_TYPE_WIE_SELECT:case BONUS_TYPE_OH_SELECT:case BONUS_TYPE_WIE_CHOCK_OH_SELECT:case BONUS_TYPE_JIN_5_CLASS_SELECT:case BONUS_TYPE_HIGH_ENGAGE_SECOND_HALF:case BONUS_TYPE_MILEAGE_GACHA_TICKET_1:case BONUS_TYPE_MILEAGE_GACHA_TICKET_2:case BONUS_TYPE_MILEAGE_GACHA_TICKET_3:case BONUS_TYPE_MILEAGE_GACHA_TICKET_4:case BONUS_TYPE_MILEAGE_GACHA_TICKET_5:case BONUS_TYPE_MILEAGE_GACHA_TICKET_10:case BONUS_TYPE_COMEBACK_GACHA_TICKET:case BONUS_TYPE_SR_OVER_GACHA_TICKET:case BONUS_TYPE_SSR_GACHA_TICKET:case BONUS_TYPE_SSR_RARE_TYPE_NEW_YEAR_SELECT:case BONUS_TYPE_SSR_RARE_TYPE_NEW_YEAR_GACHA_TICKET:case BONUS_TYPE_SSR_RARE_TYPE_GACHA_REBORN_GNRL_TICKET:case BONUS_TYPE_SSR_RARE_TYPE_GACHA_2019_NEW_YEARS_TICKET:case BONUS_TYPE_ALL_RARE_TYPE_GNRL_SELECT_TICKET:case BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET:case BONUS_TYPE_BATTLE_COUNTRY_GNRL_SELECT_TICKET_V2:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_2:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_3:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_4:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_5:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_6:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_7:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_8:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_9:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_10:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_11:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_12:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_13:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_14:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_15:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_16:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_17:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_18:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_19:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_20:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_21:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_22:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_23:case BONUS_TYPE_DUMMY_GACHA_TICKET_1:case BONUS_TYPE_DUMMY_GACHA_TICKET_2:case BONUS_TYPE_DUMMY_GACHA_TICKET_3:case BONUS_TYPE_DUMMY_GACHA_TICKET_4:case BONUS_TYPE_DUMMY_GACHA_TICKET_5:case BONUS_TYPE_DUMMY_GACHA_TICKET_6:case BONUS_TYPE_DUMMY_GACHA_TICKET_7:case BONUS_TYPE_DUMMY_GACHA_TICKET_8:case BONUS_TYPE_DUMMY_GACHA_TICKET_9:case BONUS_TYPE_DUMMY_GACHA_TICKET_10:case BONUS_TYPE_DUMMY_GACHA_TICKET_11:case BONUS_TYPE_DUMMY_GACHA_TICKET_12:case BONUS_TYPE_DUMMY_GACHA_TICKET_13:case BONUS_TYPE_DUMMY_GACHA_TICKET_14:case BONUS_TYPE_DUMMY_GACHA_TICKET_15:case BONUS_TYPE_DUMMY_GACHA_TICKET_16:case BONUS_TYPE_DUMMY_GACHA_TICKET_17:case BONUS_TYPE_DUMMY_GACHA_TICKET_18:case BONUS_TYPE_DUMMY_GACHA_TICKET_19:case BONUS_TYPE_DUMMY_GACHA_TICKET_20:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_31:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_32:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_33:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_34:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_35:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_36:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_37:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_38:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_39:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_40:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_41:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_42:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_43:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_44:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_45:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_46:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_47:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_48:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_49:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_50:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_51:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_52:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_53:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_54:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_55:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_56:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_57:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_58:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_59:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_60:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_61:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_62:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_63:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_64:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_65:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_66:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_67:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_68:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_69:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_70:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_71:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_72:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_73:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_74:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_75:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_76:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_77:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_78:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_79:case BONUS_TYPE_LUCKBOX_YUNHEE_SELECT_TICKET_80:Instance.insert_User_General(res.success_reward_list[i].bonus_key),Instance.insert_User_Book_General(res.success_reward_list[i].bonus_key);break;case BONUS_TYPE_ILLUSTRATE_TICKET:Instance.insert_User_Illust(res.bonus_key);break;case BONUS_TYPE_EXP_BOOSTER:_exp_booster_item.booster_id=res.success_reward_list[i].bonus_key[0].key_id,_exp_booster_item.exp_inc=res.success_reward_list[i].bonus_key[0].key_num,_exp_booster_item.remain_dt=res.success_reward_list[i].bonus_key.at(0).count,_exp_booster_item.enabled_yn="y";break;case BONUS_TYPE_LOVE_ITEM:case BONUS_TYPE_LOVE_ITEM_MELEE:case BONUS_TYPE_LOVE_ITEM_LANCER:case BONUS_TYPE_LOVE_ITEM_RANGER:case BONUS_TYPE_LOVE_ITEM_CAKE:case BONUS_TYPE_YUBI_LOVE_ITEM:case BONUS_TYPE_CHRISTMAS_LOVE_ITEM:case BONUS_TYPE_SUPER_CHOCO_CAKE:case BONUS_TYPE_WHITE_CHOCO:case BONUS_TYPE_COMEBACK_CAKE:case BONUS_TYPE_LOVE_MAX_CAKE:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_01:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_02:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_03:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_04:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_05:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_06:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_07:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_08:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_09:case BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_10:Instance.plus_User_Love_Item(res.success_reward_list[i].bonus_key[0].key_id,res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_LOVE_ITEM_PARTNER_COCHOLATE:case BONUS_TYPE_LOVE_ITEM_VD_COCHOLATE_A:case BONUS_TYPE_LOVE_ITEM_VD_COCHOLATE_B:var love_id=GeneralService.getInstance().getBonusTypeToLoveId(res.success_reward_list[i].bonus_key.at(0).key_bonus_type);Instance.plus_User_Love_Item(love_id,res.success_reward_list[i].bonus_count,res.success_reward_list[i].bonus_key.at(0).key_id);break;case BONUS_TYPE_EVENT_POINT:break;case BONUS_TYPE_FORMATION_POINT:Instance.plus_User_Formation_Point(res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_SR_LIMIT_OVER_MTRL:case BONUS_TYPE_SSR_LIMIT_OVER_MTRL:Instance.plus_User_Limit_Over_Mtrl(res.success_reward_list[i].bonus_key[0].key_id,res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_MAGIC_KEY_MTRL:Instance.plus_User_Magic_Key_Mtrl(res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_RAID_POINT:Instance.plus_User_Raid_Point(res.success_reward_list[i].bonus_key[0].key_id,res.success_reward_list[i].bonus_count);break;case BONUS_TYPE_CHRISTMAS_SANTA:case BONUS_TYPE_CHRISTMAS_REINDEER:case BONUS_TYPE_CHRISTMAS_SNOWMAN:Instance.update_User_Christmas_Reward(res.success_reward_list[i].bonus_type,res.success_reward_list[i].bonus_count,res.success_reward_list[i].bonus_key[0].key_id);case BONUS_TYPE_EQUIPMENT_EXP_BOX_1:case BONUS_TYPE_EQUIPMENT_EXP_BOX_2:case BONUS_TYPE_EQUIPMENT_EXP_BOX_3:case BONUS_TYPE_EQUIPMENT_EXP_BOX_4:case BONUS_TYPE_EQUIPMENT:res.success_reward_list[i].bonus_key.forEach(function(bonus_key){MasterManager.getInstance().get_EquipmentItem(bonus_key.key_id).equipment_type,EQUIPMENT_TYPE_EXP;var user_equipment={};user_equipment.equipment_item_idx=bonus_key.key_id,user_equipment.equipment_num=bonus_key.key_num,user_equipment.level=1,user_equipment.exp=0,user_equipment.arm_service_type=ARMSERVICETYPE_NONE,user_equipment.step=0,user_equipment.combo_stat=2,user_equipment.stat_value=1,user_equipment.option_num1=0,user_equipment.option_num2=0,user_equipment.option_num3=0,user_equipment.option_num4=0,user_equipment.option_num5=0,user_equipment.equip_yn="n",user_equipment.lock_yn="n",user_equipment.activity_type=1,user_equipment.base_stat_level_id=bonus_key.key_id,Instance.insert_User_Equipment(user_equipment)});break;case BONUS_TYPE_GNRL_PIECE:res.success_reward_list[i].bonus_key.forEach(function(bonus_key){Instance.plus_User_Gnrl_Piece(bonus_key.key_id,bonus_key.count)});break;case BONUS_TYPE_NEW_EQUIPMENT_MAKE_MATERIAL:res.success_reward_list[i].bonus_key.forEach(function(bonus_key){Instance.plus_User_New_Equipment_Make_Material(bonus_key.key_id,bonus_key.count)});break;case BONUS_TYPE_NEW_EQUIPMENT_ENHANCE_MATERIAL:res.success_reward_list[i].bonus_key.forEach(function(bonus_key){Instance.plus_User_New_Equipment_Enhance_Material(bonus_key.key_id,bonus_key.count)});break;case BONUS_TYPE_NEW_EQUIPMENT_SMELT_MATERIAL:res.success_reward_list[i].bonus_key.forEach(function(bonus_key){Instance.plus_User_New_Equipment_Smelt_Material(bonus_key.key_id,bonus_key.count)});break;case BONUS_TYPE_NEW_EQUIPMENT_ENCHANT_TICKET:res.success_reward_list[i].bonus_key.forEach(function(bonus_key){Instance.plus_User_New_Equipment_Enchant_Ticket(bonus_key.key_id,bonus_key.count)});break;case BONUS_TYPE_NEW_RAID_BOSS_POINT:res.success_reward_list[i].bonus_key.forEach(function(bonus_key){Instance.plus_User_New_Raid_Point(bonus_key.key_id,bonus_key.count)})}for(var j=0;j<res.success_reward_list.length;j++)for(i=0;i<list_User_Mail.size();)list_User_Mail.at(i).mail_num==res.success_reward_list[j].num?list_User_Mail.erase(i):i++;for(j=0;j<res.failed_reward_list.length;j++)if(res.failed_reward_list[j].error==net.ERROR.NET_E_ALREADY_DONE_USER_MAIL)for(i=0;i<list_User_Mail.size();)list_User_Mail.at(i).mail_num==res.failed_reward_list[j].num?list_User_Mail.erase(i):i++;0<list_User_Mail.size()?context.setUserNewMail("y"):context.setUserNewMail("n")},Instance.upd_Main_Mission_Battle_Win_V2=function(res){var m=MasterTable.getInstance().getMasterTable(),mission=$.extend({},database.MainMission);mission=m.get_MainMission(res.mission_id);for(var i=0;i<res.drop_bonus_items.length;i++){var b=$.extend({},net.Battle_Bonus_Item);if((b=res.drop_bonus_items[i]).bonus_type==BONUS_TYPE_YUNHEE_FIX||b.bonus_type==BONUS_TYPE_JIN_FIX){var gnrl=[],obj={};obj.gnrl_id=b.bonus_idx,obj.gnrl_num=b.bonus_num,obj.castle_id=b.castle_id,obj.gnrl_level=b.bonus_level,gnrl.push(obj),Instance.new_User_General(gnrl)}else if(b.bonus_type>=BONUS_TYPE_HWANDAN_1&&b.bonus_type<=BONUS_TYPE_HWANDAN_7)Instance.plus_User_Hwandan(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_LOVE_ITEM)Instance.plus_User_Love_Item(b.bonus_idx,1);else if(b.bonus_type>=BONUS_TYPE_LOVE_ITEM_MELEE&&b.bonus_type<=BONUS_TYPE_LOVE_ITEM_CAKE)Instance.plus_User_Love_Item(b.bonus_level,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_MIDDLE&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_MIDDLE)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_EVOLVE_MELEE_LOW&&b.bonus_type<=BONUS_TYPE_EVOLVE_ARCHER_LOW)Instance.plus_User_Evolve_Arm_Service(b.bonus_type,b.bonus_idx);else if(b.bonus_type>=BONUS_TYPE_ATTK_POINT&&b.bonus_type<=BONUS_TYPE_CRI_DMG_POINT)Instance.plus_User_Formation_Property_Point(b.bonus_type,b.bonus_idx);else if(b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||b.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6){var rebirth_mtrl_type=GeneralService.getInstance().getBonusTypeToRebirthMtrlType(b.bonus_type);Instance.plus_User_Rebirth_Mtrl(rebirth_mtrl_type,b.bonus_idx)}else b.bonus_type,BONUS_TYPE_GOLD}for(var idx=0;idx<res.cmplt_task_ids.length;idx++)Instance.ins_MainMission_Task(res.mission_id,res.cmplt_task_ids[idx]);if("y"==res.lotus_bonus_new_yn){null==res.lotus_open_count&&(res.lotus_open_count=0);var bonus_log=m_User_main_lotus_bonus_log.at([mission.main_scene_id,mission.main_story_id,1,res.lotus_open_count]);if(null!=bonus_log)bonus_log.new_yn=res.lotus_bonus_new_yn;else{var data={main_scene_id:mission.main_scene_id,main_story_id:mission.main_story_id,difficulty_type:1,new_yn:"y",complete_yn:"n",lotus_count:res.lotus_open_count};m_User_main_lotus_bonus_log.insert([data.main_scene_id,data.main_story_id,data.difficulty_type,data.lotus_count],data)}}for(var is_new=!0,cnt_user_mission_length=map_user_main_mission.length,uidx=0;uidx<cnt_user_mission_length;uidx++)map_user_main_mission[uidx].main_mission_id==res.mission_id&&(map_user_main_mission[uidx].complete_yn="y",map_user_main_mission[uidx].new_yn="n",map_user_main_mission[uidx].win_count=res.win_count,is_new=!1);if(1==is_new){data={main_mission_id:res.mission_id,new_yn:"y",complete_yn:"n",win_count:res.win_count};map_user_main_mission.push($.extend({},data)),data=null}if("y"==res.story_complete_yn){is_new=!0;var user_main_story=Instance.get_User_main_story(),keys=user_main_story.keys();for(i=0;i<keys.length;i++)if(user_main_story.at(keys[i]).main_scene_id==mission.main_scene_id&&user_main_story.at(keys[i]).main_story_id==mission.main_story_id){data=null;(data=$.extend({},user_main_story.at(keys[i]))).complete_yn="y",data.new_yn="n",User_main_story.insert(keys[i],data),is_new=!1}}Instance.upd_UserLevelExp(res.user_level,res.user_exp),Instance.upd_UserGold(res.user_gold),Instance.upd_UserHeart(res.user_heart),Instance.upd_UserFormationPoint(res.user_formation_point),Instance.upd_UserGeneralLevelExp(res.gnrl_exp),"y"==res.is_user_level_up&&Instance.update_max_user_key_bound(res.user_level,res.user_raid_ticket),Instance.upd_UserItemRaidTicket(res.user_raid_ticket),Instance.upd_UserRaidHelpTicket(res.user_raid_help_ticket),USE_NEW_RAID_DUNGEON&&(Instance.upd_UserItemNewRaidCallTicket(res.user_new_raid_boss_call_key),Instance.upd_UserItemNewRaidConquestTicket(res.user_new_raid_boss_conquest_key))},Instance.upd_User_Key=function(user_key,jade_count,yunhee_point){User_item_info.user_item_key.key_cnt=user_key.key_cnt,User_item_info.user_item_key.elapsed=user_key.elapsed,null!=jade_count&&(User_item_info.user_item.jade_count=jade_count),null!=yunhee_point&&(User_item_info.user_item.yunhee_point=yunhee_point)},Instance.upd_UserItemRaidTicket=function(user_raid_ticket){User_item_info.user_item_raid_ticket.ticket_cnt=user_raid_ticket.ticket_cnt,User_item_info.user_item_raid_ticket.elapsed=user_raid_ticket.elapsed},Instance.upd_UserItemNewRaidCallTicket=function(user_raid_ticket){User_item_info.user_new_raid_boss_call_key.ticket_cnt=user_raid_ticket.ticket_cnt,User_item_info.user_new_raid_boss_call_key.elapsed=user_raid_ticket.elapsed},Instance.upd_UserItemNewRaidConquestTicket=function(user_raid_ticket){User_item_info.user_new_raid_boss_conquest_key.ticket_cnt=user_raid_ticket.ticket_cnt,User_item_info.user_new_raid_boss_conquest_key.elapsed=user_raid_ticket.elapsed},Instance.update_max_user_key_bound=function(level,raid_ticket){var current_key_count=User_item_info.user_item_key.key_cnt,max_key_bound=MasterManager.getInstance().get_UserLevel(level).key_bound;current_key_count<(max_key_bound+=NetService().get_User_Plus_Key_Bound())&&(User_item_info.user_item_key.key_cnt=max_key_bound,User_item_info.user_item_raid_ticket.ticket_cnt=raid_ticket.ticket_cnt,User_item_info.user_item_raid_ticket.elapsed=raid_ticket.elapsed,MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_user_raid_ticket))},Instance.ins_MainMission_Task=function(main_mission_id,task_id){for(var exist=!1,cnt=map_user_main_mission_task.length,idx=0;idx<cnt;idx++)map_user_main_mission_task[idx].main_mission_id==main_mission_id&&map_user_main_mission_task[idx].task_id==task_id&&(exist=!0);if(0==exist){var data={};data.main_mission_id=main_mission_id,data.task_id=task_id,map_user_main_mission_task.push(data)}},Instance.new_User_General=function(new_user_generals){for(var generals=new_user_generals,new_gnrls=[],idx=0;idx<generals.length;idx++){var res=generals[idx],data=$.extend({},res),lock_yn="n",general=MasterManager.getInstance().get_General(data.gnrl_id);general.rare_type==RARE_TYPE_SSR&&general.gnrl_type==GENERAL_TYPE_YUNHEE&&(lock_yn="y"),general.limit_step_id=0,general.gnrl_num=data.gnrl_num,general.gnrl_exp=0,general.gnrl_level=1,general.castle_id=0,general.love_level=0,general.love_exp=0,general.used_in_camp="n",general.lock_yn=lock_yn;var buff_period_list=MasterTable.getInstance().get_EventDungeonBuffPeriodList();general.buff_type=MasterTable.getInstance().get_GeneralDungeonBuffList(general.gnrl_group,buff_period_list,general.buff_type),map_User_General.insert([data.gnrl_id,data.gnrl_num],general),new_gnrls.push(data)}Instance.update_user_Generals()},Instance.upd_User_Item=function(res){User_item_info.user_item.jade_count=res.user_jade,User_item_info.user_item.heart_count=res.user_heart,User_item_info.user_item.gold_count=res.user_gold},Instance.update_User_Troops_Generals=function(troops_num,user_troops_general_list){for(var keys=list_User_Troops_General.keys(),idx=0;idx<keys.length;idx++)list_User_Troops_General.at(keys[idx]).troops_num==troops_num&&list_User_Troops_General.remove(keys[idx]);for(idx=0;idx<user_troops_general_list.length;idx++){var original=user_troops_general_list[idx];list_User_Troops_General.insert([original.troops_num,original.gnrl_id,original.gnrl_num],original),original=null}keys=null},Instance.Load_User_Troops_General=function(){return list_User_Troops_General},Instance.resetEventDungeonBoxGachaItemInfoList=function(){for(var keys=map_User_Extra_Box_Init_Info.keys(),idx=0;idx<keys.length;idx++){var e=map_User_Extra_Box_Init_Info.at(keys[idx]);list_User_Box_Gacha_Info=list_User_Box_Gacha_Info.filter(function(l){return e.box_gacha_info_idx!=l.box_gacha_info_idx||e.init_count==l.init_count})}},Instance.upd_User_General_Love_Up=function(gnrl_key,item_key,love_level,love_exp){map_User_General.at([gnrl_key.gnrl_id,gnrl_key.gnrl_num]).love_level=love_level,map_User_General.at([gnrl_key.gnrl_id,gnrl_key.gnrl_num]).love_exp=love_exp,map_User_Love_Item.at(item_key.love_id+""+item_key.gnrl_id).count=item_key.count},Instance.upd_UserGold=function(user_gold){User_item_info.user_item.gold_count=user_gold},Instance.upd_UserJade=function(user_amount){User_item_info.user_item.jade_count=user_amount},Instance.upd_UserHeart=function(user_heart){User_item_info.user_item.heart_count=user_heart},Instance.remove_User_General=function(gnrl){for(var keys=map_User_General.keys(),idx=0;idx<keys.length;idx++)null!=map_User_General.at(keys[idx])&&map_User_General.at(keys[idx]).gnrl_id==gnrl.gnrl_id&&map_User_General.at(keys[idx]).gnrl_num==gnrl.gnrl_num&&map_User_General.remove(keys[idx])},Instance.upd_UserYunheePT=function(user_yunhee_pt){User_item_info.user_item.yunhee_point=user_yunhee_pt},Instance.upd_UserHeavenPt=function(user_heaven_pt){User_item_info.user_item.heaven_pt=user_heaven_pt},Instance.upd_UserSkipTicket=function(user_skip_ticket){User_item_info.user_item_skip_ticket=user_skip_ticket},Instance.getUserGeneral=function(gnrl,key){if(null==key){var keys=map_User_General.keys();for(key=0;key<keys.length;key++){var gn=$.extend({},map_User_General.at(keys[key]));null!=gn&&gnrl.push(gn)}}else gnrl=$.extend({},map_User_General.at([key.gnrl_id,key.gnrl_num]));return gnrl},Instance.getUserGeneralCount=function(){return map_User_General.size()},Instance.getFriendGeneral=function(gnrls){for(var i in map_Friend_General)gnrls.push(i.second)},Instance.get_User_formation_point=function(){return User_item_info.user_item.formation_point},Instance.getUserWeeklyTroopsGeneral=function(){return list_User_Weekly_Troops_General},Instance.getUserPartyGeneral=function(){return list_User_Troops_General},Instance.getUserLoveItem=function(love_items){for(var keys=map_User_Love_Item.keys(),idx=0;idx<keys.length;idx++)love_items.push(map_User_Love_Item.at(keys[idx]))},Instance.getUsermail=function(mail_tab_type){if(null==mail_tab_type)return list_User_Mail;for(var user_mail=[],list=MasterTable.getInstance().get_MailDivisionList(mail_tab_type),m_idx=0;m_idx<list_User_Mail.length;m_idx++)for(var m=list_User_Mail[m_idx],t_idx=0;t_idx<list.length;t_idx++){var t=list[t_idx];m.bonus_type==t.bonus_type&&user_mail.push_back(m)}return list=null,user_mail},Instance.getUsermailCount=function(){return map_User_General.length},Instance.isExistUsermail=function(bonus_type){for(var mail in list_User_Mail)if(mail.bonus_type==bonus_type)return!0;return!1},Instance.getUserMailMaxNum=function(){if(list_User_Mail.empty())return 0;list_User_Mail.sort(function(a,b){return a.mail_num<b.mail_num?-1:a.mail_num>b.mail_num?1:0});new User_Mail;return list_User_Mail.back().mail_num},Instance.getUserIllust=function(illust_idx){if(map_User_Illust_Book_List.empty())return!1;for(var idx=0;idx<map_User_Illust_Book_List.length;idx++)if(map_User_Illust_Book_List[idx].illust_idx==illust_idx)return!0},Instance.upd_User_Gacha_Count=function(count){null!=User_gacha_count&&null!=User_gacha_count.gacha_buy_bonus&&(User_gacha_count.gacha_buy_bonus=count)},Instance.clearBattleDungeonContinue=function(){_battle_dungeon_continue.battle_dungeon_type=0,_battle_dungeon_continue.troops_num=0,_battle_dungeon_continue.frnd_id="",_battle_dungeon_continue.value1=0,_battle_dungeon_continue.value2=0,_battle_dungeon_continue.value3=0,_battle_dungeon_continue.value4=0,_battle_dungeon_continue.drop_items=null},Instance.plus_User_Gold=function(count){User_item_info.user_item.gold_count+=count},Instance.plus_User_Craft_Shop_Material=function(craft_shop_bonus_type,count){var user_material=map_user_event_dungeon_craft_shop_material.at([m_user_id,craft_shop_bonus_type]);null!=user_material&&(user_material.material_count+=count)},Instance.plus_User_Limit_Over_Mtrl=function(limit_over_mtrl_type,count){var current_mtrl=map_User_Limit_Over_Mtrl.at(limit_over_mtrl_type),item={};item.mtrl_cnt=null!=current_mtrl?(item.limit_over_mtrl_type=limit_over_mtrl_type,current_mtrl.mtrl_cnt+count):(item.limit_over_mtrl_type=limit_over_mtrl_type,count),map_User_Limit_Over_Mtrl.insert(limit_over_mtrl_type,item)},Instance.plus_User_Key=function(count){User_item_info.user_item_key.key_cnt+=count},Instance.plus_User_Heart=function(count){User_item_info.user_item.heart_count+=count},Instance.plus_User_Raid_Ticket=function(count){User_item_info.user_item_raid_ticket.ticket_cnt+=count},Instance.plus_User_New_Raid_Call_Ticket=function(count){User_item_info.user_new_raid_boss_call_key.ticket_cnt+=count},Instance.plus_User_New_Raid_Conquest_Ticket=function(count){User_item_info.user_new_raid_boss_conquest_key.ticket_cnt+=count},Instance.upd_UserRaidHelpTicket=function(raid_help_ticket){User_item_info.user_raid_help_ticket.ticket_cnt=raid_help_ticket.ticket_cnt,User_item_info.user_raid_help_ticket.elapsed=raid_help_ticket.elapsed},Instance.plus_User_Raid_Help_Ticket=function(count){User_item_info.user_raid_help_ticket.ticket_cnt+=count},Instance.upd_UserWorldWarTicket=function(up_count){var ticket_bound;ticket_bound=MasterManager.getInstance().get_CountFunction(29).value;var ticket_count=0;ticket_count=User_item_info.user_item_world_war_ticket.ticket_cnt,User_item_info.user_item_world_war_ticket.ticket_cnt="object"==typeof up_count?up_count.ticket_cnt:(ticket_bound<=ticket_count||ticket_bound<(ticket_count+=up_count)&&(ticket_count=ticket_bound),ticket_count)},Instance.plus_User_World_War_Ticket=function(count){User_item_info.user_item_world_war_ticket.ticket_count+=count},Instance.upd_UserGreatWall_Ticket=function(up_count){var ticket_bound;ticket_bound=MasterManager.getInstance().get_CountFunction(25).value;var ticket_count=0;ticket_count=User_item_info.user_item_great_wall_ticket.ticket_cnt,User_item_info.user_item_great_wall_ticket.ticket_cnt="object"==typeof up_count?up_count.ticket_cnt:(ticket_bound<=ticket_count||ticket_bound<(ticket_count+=up_count)&&(ticket_count=ticket_bound),ticket_count)},Instance.plus_User_Great_Wall_Ticket=function(count){User_item_info.user_item_great_wall_ticket.ticket_cnt+=count},Instance.plus_User_Jade=function(count){User_item_info.user_item.jade_count+=count},Instance.plus_User_Evolve_Stone=function(count){_evolve_Stone_Count+=count},Instance.get_User_Yunhee_PT=function(){return User_item_info.user_item.yunhee_point},Instance.plus_User_Yunhee_PT=function(count){User_item_info.user_item.yunhee_point+=count},Instance.plus_User_Heaven_PT=function(count){User_item_info.user_item.heaven_pt+=count},Instance.get_User_Event_Dungeon_Christmas_Info=function(){return $.extend({},m_Res_Get_User_Event_Dungeon_Christmas_Info)},Instance.get_User_Raid_Point=function(raid_boss_period_idx){var point={};return point.raid_boss_period_idx=raid_boss_period_idx,point.raid_point=0,User_item_info.user_item.raid_point.raid_boss_period_idx==raid_boss_period_idx&&(point.raid_point=User_item_info.user_item.raid_point.raid_point),point.raid_point},Instance.plus_User_New_Raid_Point=function(new_raid_boss_period_idx,count){var found=_new_raid_boss_point.user_new_raid_boss_points.findIndex(function(p){return p.new_raid_boss_period_idx==new_raid_boss_period_idx});-1!=found&&(_new_raid_boss_point.user_new_raid_boss_points[found].point+=count)},Instance.plus_User_Raid_Point=function(raid_boss_period_idx,count){User_item_info.user_item.raid_point.raid_point+=count},Instance.plus_User_Gnrl_Piece=function(gnrl_group,add_count){var found=_user_gnrl_piece_item.user_gnrl_piece.findIndex(function(d){return gnrl_group==d.gnrl_group});if(-1!=found)_user_gnrl_piece_item.user_gnrl_piece[found].count+=add_count;else{var item={};item.bonus_type=BONUS_TYPE_GNRL_PIECE,item.gnrl_group=gnrl_group,item.count=add_count,_user_gnrl_piece_item.user_gnrl_piece.push_back(item)}},Instance.upd_UserRaidPoint=function(user_raid_point){User_item_info.user_item.raid_point=user_raid_point},Instance.plus_User_Evolve_Arm_Service=function(bonus_type,count){var arm_service_type=Instance.bonusTypeToArmServiceType(bonus_type),evolve_arm_service_class_type=Instance.bonusTypeToArmServiceClassType(bonus_type),key=net.User_Evolve_Arm_Service_Key;if(key.arm_service_type=arm_service_type,key.class_type=evolve_arm_service_class_type,null!=map_User_Evolve_Arm_Service_Mtrl.at([key.arm_service_type,key.class_type]))map_User_Evolve_Arm_Service_Mtrl.at([key.arm_service_type,key.class_type]).mtrl_count+=count;else{var mtrl={};mtrl.arm_service_type=arm_service_type,mtrl.class_type=key.class_type,mtrl.mtrl_count=count,map_User_Evolve_Arm_Service_Mtrl.insert([key.arm_service_type,key.class_type],mtrl)}},Instance.plus_User_Formation_Property_Point=function(bonus_type,count){var formation_property_type=Instance.bonusTypeToFormationPropertyType(bonus_type);for(var g in m_User_formation_property_point)if(m_User_formation_property_point[g].property_type==formation_property_type){m_User_formation_property_point[g].point_count+=count;break}},Instance.get_User_Event_Dungeon_Box_Gacha_Info_List=function(box_gacha_info_idx){var list=[];if(null==box_gacha_info_idx)return $.extend(!0,[],list_User_Box_Gacha_Info);for(var i=0;i<EVENT_DUNGEON_BOX_GACHA_CELL_COUNT;++i){(info={event_dungeon_period_idx:0,item_idx:0,box_gacha_info_idx:0}).item_num=i+1,list.push_back(info)}var extra_init_info=map_User_Extra_Box_Init_Info.at(box_gacha_info_idx);null==extra_init_info&&(extra_init_info={box_gacha_info_idx:0,init_count:0});for(i=0;i<list.size();++i)for(var info=list.at(i),idx=0;idx<list_User_Box_Gacha_Info.length;idx++){var user_info=list_User_Box_Gacha_Info[idx];user_info.box_gacha_info_idx==box_gacha_info_idx&&(user_info.init_count!=extra_init_info.init_count||user_info.item_num==info.item_num&&(list[i]=user_info))}return list},Instance.get_User_Event_Dungeon_Box_Gacha_Golden_Barrel_info_List=function(){return $.extend(!0,[],list_User_Box_Gacha_Golden_Barrel_Info)},Instance.get_User_Event_Dungeon_Extra_Box_Init_Info_List=function(){return $.extend(!0,[],map_User_Extra_Box_Init_Info)},Instance.get_User_Event_Dungeon_Extra_Box_Init_Info=function(box_gacha_info_idx){var extra_init_info=map_User_Extra_Box_Init_Info.at(box_gacha_info_idx);return null==extra_init_info&&(extra_init_info={box_gacha_info_idx:0,init_count:0}),extra_init_info},Instance.get_User_Event_Dungeon_Box_Gacha_Info_Progress_List=function(){return $.extend(!0,[],list_User_Box_Gacha_progress_Info)},Instance.get_User_Event_Dungeon_Growth_Info=function(){return $.extend(!0,[],m_Res_Get_User_Event_Dungeon_Growth_Info)},Instance.get_User_Rebirth_Mtrl_Info=function(mtrl_type){return null==mtrl_type?$.extend({},map_User_Rebirth_Mtrl):$.extend({},map_User_Rebirth_Mtrl.at(mtrl_type))},Instance.udp_UserPlusKeyBound=function(count){User_item_info.user_item_key.plus_key_bound=count},Instance.get_User_Plus_Key_Bound=function(){return User_item_info.user_item_key.plus_key_bound},Instance.udp_UserEvolveOrb=function(count){User_item_info.user_item.orb_count=count},Instance.plus_User_Evolve_Orb=function(count){User_item_info.user_item.orb_count+=count},Instance.update_User_Evolve_Arm_Service=function(bonus_type,count){var arm_service_type=Instance.bonusTypeToArmServiceType(bonus_type),evolve_arm_service_class_type=Instance.bonusTypeToArmServiceClassType(bonus_type),key=net.User_Evolve_Arm_Service_Key;if(key.arm_service_type=arm_service_type,key.class_type=evolve_arm_service_class_type,null!=map_User_Evolve_Arm_Service_Mtrl.at([key.arm_service_type,key.class_type]))map_User_Evolve_Arm_Service_Mtrl.at([key.arm_service_type,key.class_type]).mtrl_count=count;else{var mtrl={};mtrl.arm_service_type=arm_service_type,mtrl.class_type=key.class_type,mtrl.mtrl_count=count,map_User_Evolve_Arm_Service_Mtrl.insert([key.arm_service_type,key.class_type],mtrl)}},Instance.plus_User_Love_Item=function(love_id,count,gnrl_id){null==count&&(count=0),null==gnrl_id&&(gnrl_id=0),null==love_id&&(love_id=0);var is_exist;is_exist=map_User_Love_Item.find(love_id+""+gnrl_id);var key={};key.love_id=love_id,key.gnrl_id=gnrl_id,key.count=0,is_exist?(map_User_Love_Item.at(love_id+""+gnrl_id).count+=count,map_User_Love_Item.at(love_id+""+gnrl_id).gnrl_id=gnrl_id):(key.count=count,map_User_Love_Item.insert(key.love_id+""+key.gnrl_id,key))},Instance.plus_User_Formation_Point=function(formation_point){User_item_info.user_item.formation_point+=formation_point,Instance.upd_UserFormationPoint(User_item_info.user_item.formation_point)},Instance.bonusTypeToEvolveMtrlType=function(bonus_type){return bonus_type==BONUS_TYPE_HWANDAN_1?HWANDAN_CLASS_1:bonus_type==BONUS_TYPE_HWANDAN_2?HWANDAN_CLASS_2:bonus_type==BONUS_TYPE_HWANDAN_3?HWANDAN_CLASS_3:bonus_type==BONUS_TYPE_HWANDAN_4?HWANDAN_CLASS_4:bonus_type==BONUS_TYPE_HWANDAN_5?HWANDAN_CLASS_5:bonus_type==BONUS_TYPE_HWANDAN_6?HWANDAN_CLASS_6:bonus_type==BONUS_TYPE_HWANDAN_7?HWANDAN_CLASS_7:bonus_type==BONUS_TYPE_YUBI_RARE?HWANDAN_CLASS_YUBI:0},Instance.bonusTypeToArmServiceType=function(bonus_type){var arm_service_type=0;return bonus_type==BONUS_TYPE_EVOLVE_MELEE||bonus_type==BONUS_TYPE_EVOLVE_MELEE_MIDDLE||bonus_type==BONUS_TYPE_EVOLVE_MELEE_LOW||bonus_type==BONUS_TYPE_YUBI_EVOLVE_HIGH||bonus_type==BONUS_TYPE_YUBI_EVOLVE_MIDDLE||bonus_type==BONUS_TYPE_YUBI_EVOLVE_LOW?arm_service_type=ARMSERVICETYPE_INFANTRY:bonus_type==BONUS_TYPE_EVOLVE_ARCHER||bonus_type==BONUS_TYPE_EVOLVE_ARCHER_MIDDLE||bonus_type==BONUS_TYPE_EVOLVE_ARCHER_LOW?arm_service_type=ARMSERVICETYPE_ARCHER:bonus_type!=BONUS_TYPE_EVOLVE_LANCER&&bonus_type!=BONUS_TYPE_EVOLVE_LANCER_MIDDLE&&bonus_type!=BONUS_TYPE_EVOLVE_LANCER_LOW||(arm_service_type=ARMSERVICETYPE_SPEAR),arm_service_type},Instance.filterEventDungeonAchvList=function(bonus_type){},Instance.bonusTypeToFormationPropertyType=function(bonus_type){var formation_property_type=0;return bonus_type==BONUS_TYPE_ATTK_POINT?formation_property_type=FORMATION_PROPERTY_TYPE_ATTK:bonus_type==BONUS_TYPE_DEF_POINT?formation_property_type=FORMATION_PROPERTY_TYPE_DEF:bonus_type==BONUS_TYPE_HP_POINT?formation_property_type=FORMATION_PROPERTY_TYPE_HP:bonus_type==BONUS_TYPE_CRI_PRCNT_POINT?formation_property_type=FORMATION_PROPERTY_TYPE_CRI_PRCNT:bonus_type==BONUS_TYPE_CRI_DMG_POINT&&(formation_property_type=FORMATION_PROPERTY_TYPE_CRI_DMG),formation_property_type},Instance.bonusTypeToArmServiceClassType=function(bonus_type){var class_type=0;return bonus_type==BONUS_TYPE_EVOLVE_MELEE||bonus_type==BONUS_TYPE_EVOLVE_ARCHER||bonus_type==BONUS_TYPE_EVOLVE_LANCER?class_type=EVOLVE_ARM_SERVICE_CLASS_TYPE_HIGH:bonus_type==BONUS_TYPE_EVOLVE_MELEE_MIDDLE||bonus_type==BONUS_TYPE_EVOLVE_ARCHER_MIDDLE||bonus_type==BONUS_TYPE_EVOLVE_LANCER_MIDDLE?class_type=EVOLVE_ARM_SERVICE_CLASS_TYPE_MIDDLE:bonus_type==BONUS_TYPE_EVOLVE_MELEE_LOW||bonus_type==BONUS_TYPE_EVOLVE_ARCHER_LOW||bonus_type==BONUS_TYPE_EVOLVE_LANCER_LOW?class_type=EVOLVE_ARM_SERVICE_CLASS_TYPE_LOW:bonus_type==BONUS_TYPE_YUBI_EVOLVE_HIGH?class_type=EVOLVE_ARM_SERVICE_CLASS_TYPE_EVENT_HIGH:bonus_type==BONUS_TYPE_YUBI_EVOLVE_MIDDLE?class_type=EVOLVE_ARM_SERVICE_CLASS_TYPE_EVENT_MIDDLE:bonus_type==BONUS_TYPE_YUBI_EVOLVE_LOW&&(class_type=EVOLVE_ARM_SERVICE_CLASS_TYPE_EVENT_LOW),class_type},Instance.plus_User_Hwandan=function(bonus_type,count){var class_type=Instance.bonusTypeToEvolveMtrlType(bonus_type),hwandan_key={};hwandan_key.class_type=class_type;var hwandan=net.User_Hwandan;hwandan.hwandan_class=hwandan_key.class_type,hwandan.hwandan_count=count,null!=map_User_Hwandan_Info.at(hwandan_key.class_type)?map_User_Hwandan_Info.at(hwandan_key.class_type).hwandan_count+=count:map_User_Hwandan_Info.insert(hwandan_key.class_type,hwandan)},Instance.plus_User_Exchange_Ticket=function(count){var exchange_ticket=Instance.get_User_Exchange_Ticket();exchange_ticket+=count,Instance.upd_UserExchangeTicket(exchange_ticket)},Instance.plus_User_Skip_Ticket=function(count){User_item_info.user_item_skip_ticket+=count},Instance.get_Global_Booster_Event=function(){return list_Global_Booster_Event_V2},Instance.get_daily_dungeon_open_period_info=function(){return m_daily_dungeon_open_period_info},Instance.get_User_Cost_slot_list=function(){return list_User_camp_cost_slot},Instance.get_User_Camp_cost_Log=function(){return map_User_Cost_general},Instance.get_User_Evolve_Orb=function(){return User_item_info.user_item.orb_count},Instance.getUserLimitOverMtrlCount=function(mtrl_type){var mtrl=map_User_Limit_Over_Mtrl.at(mtrl_type);return null==mtrl?0:mtrl.mtrl_cnt},Instance.get_User_Gacha_ticket=function(shop_id){var count=_user_gacha_ticket.at(shop_id);return null==count?0:count.ticket_count},Instance.get_User_Special_Gacha_ticket=function(special_ticket_gacha_idx){var count=_user_special_gacha_ticket.at(special_ticket_gacha_idx);return null==count?0:count.ticket_cnt},Instance.get_User_Limit_Over_Mtrl=function(){return map_User_Limit_Over_Mtrl},Instance.get_User_Evevt_Dungeon_Achv_List=function(){return _event_dungeon_achv_list},Instance.get_New_Raid_Boss_Dungeon_List=function(){return _new_raid_boss_dungeon_list},Instance.get_New_Raid_Boss_Point=function(){return _new_raid_boss_point},Instance.get_User_Hwandan_Info=function(key){return null==key?map_User_Hwandan_Info:map_User_Hwandan_Info.at(key)},Instance.get_User_Evolve_Arm_Service_Mtrl=function(key){return map_User_Evolve_Arm_Service_Mtrl.at([key.arm_service_type,key.class_type])},Instance.get_user_map_User_Evolve_Arm_Service_Mtrl=function(){return map_User_Evolve_Arm_Service_Mtrl},Instance.get_user_ceiling_gacha_info=function(){return map_user_ceiling_gacha_info},Instance.get_User_Battle_Formation=function(){return m_User_Battle_formation},Instance.get_User_Formation_Property_Info=function(){return m_User_formation_property_point},Instance.get_User_Mussang_Info=function(){return m_user_mussang_Info},Instance.get_battle_dungeon_continue=function(res){return _battle_dungeon_continue},Instance.get_list_User_Mail=function(){return list_User_Mail},Instance.plus_User_Magic_Key_Mtrl=function(mtrl_cnt){User_Magic_Key_Mtrl+=mtrl_cnt},Instance.getMagicKeyCount=function(){return User_Magic_Key_Mtrl},Instance.getUserKeyRecoveryMakeCount=function(){return User_Key_Recovery_Make_Count},Instance.get_Shop_Gacha_Period_Info=function(){return _get_Shop_Gacha_Period_Info},Instance.get_user_shop_buy_info=function(){return _user_shop_buy_info},Instance.get_Popup_Banner_Info=function(){return _get_Popup_Banner_Info},Instance.get_user_weekly_open=function(){return map_user_weekly_open},Instance.get_user_event_dungeon_point=function(){return map_user_event_dungeon_point},Instance.get_User_Equipment_bound=function(){return map_User_Equipment_bound},Instance.get_User_Equipment_item=function(){return map_User_Equipment},Instance.get_User_Book_General=function(){return list_User_book_General},Instance.get_raid_boss_history=function(){return _raid_boss_history},Instance.get_user_event_dungeon_special_point=function(){return map_user_event_dungeon_special_point},Instance.get_Event_Dungeon_Vote_League_Ranking_Refresh_Dt=function(refresh_dt){return m_Res_Get_Event_Dungeon_Vote_League_Ranking_Record.ranking_refresh_dt},Instance.get_Event_Dungeon_Vote_Ranking_Refresh_Dt=function(refresh_dt){return m_Res_Get_Event_Dungeon_Vote_Ranking_Info.ranking_refresh_dt},Instance.get_Event_Raid_BoxGacha_Info=function(period_idx,delimiter){for(var boxgacha_info={},i=0;i<User_Box_Gacha_List.event_dungeon_box_gacha_info.length;i++){var info=User_Box_Gacha_List.event_dungeon_box_gacha_info[i];info.event_dungeon_period_idx==period_idx&&info.delimiter==delimiter&&(boxgacha_info=info)}return boxgacha_info},Instance.get_Event_Raid_Dungeon_num=function(){return Global_Raid_Dungeon_info.event_raid_dungeon_num},Instance.get_Event_Raid_Dungeon_Info=function(){return Global_Raid_Boss_Info},Instance.get_Event_Dungeon_Vote_League_Yunhee_Candidate_List=function(){return $.extend([],m_Res_Get_Event_Dungeon_Vote_League_Yunhee_Info.event_dungeon_vote_league_yunhee_candidate)},Instance.get_Event_Dungeon_Vote_Current_League_Grop_Idx=function(){return m_Res_Get_Event_Dungeon_Vote_League_Yunhee_Info.league_group_idx},Instance.get_great_wall_troops_info=function(){return _great_wall_troops_info},Instance.get_Event_Dungeon_Vote_Ranking_Info_List=function(){var list=[];if(null!=m_Res_Get_Event_Dungeon_Vote_Ranking_Info&&null!=m_Res_Get_Event_Dungeon_Vote_Ranking_Info&&null!=m_Res_Get_Event_Dungeon_Vote_Ranking_Info.event_dungeon_vote_ranking_info){var Ranking_info_list=m_Res_Get_Event_Dungeon_Vote_Ranking_Info.event_dungeon_vote_ranking_info;list=stable(Ranking_info_list,function(l,r){return l.vote_yunhee_idx>r.vote_yunhee_idx}),list=stable(list,function(l,r){return l.ranking>r.ranking})}return list},Instance.get_User_Event_Dungeon_Vote_Info_List=function(){var list=[];return null!=_get_User_Vote_Info&&(_get_User_Vote_Info=stable(_get_User_Vote_Info,function(l,r){return l.vote_yunhee_idx>r.vote_yunhee_idx}),_get_User_Vote_Info=stable(_get_User_Vote_Info,function(l,r){return l.ranking>r.ranking}),list=_get_User_Vote_Info),list},Instance.get_User_Vote_Gnrl_List=function(league_idx){var list=[];null==_user_event_dungeon_vote_v3.gnrl_vote_list&&(_user_event_dungeon_vote_v3.gnrl_vote_list=[]);for(var idx=0;idx<_user_event_dungeon_vote_v3.gnrl_vote_list.length;idx++)if(_user_event_dungeon_vote_v3.gnrl_vote_list[idx].vote_league_idx==league_idx){list=_user_event_dungeon_vote_v3.gnrl_vote_list[idx].vote_leage_gnrl_list;break}return list},Instance.get_Global_Vote_Gnrl_List=function(league_idx){var list=[];null==_global_event_dungeon_vote_v3.gnrl_vote_list&&(_global_event_dungeon_vote_v3.gnrl_vote_list=[]);for(var idx=0;idx<_global_event_dungeon_vote_v3.gnrl_vote_list.length;idx++)if(_global_event_dungeon_vote_v3.gnrl_vote_list[idx].vote_league_idx==league_idx){list=_global_event_dungeon_vote_v3.gnrl_vote_list[idx].vote_leage_gnrl_list;break}return list},Instance.get_Event_Dungeon_Vote_League_Ranking_Info_List=function(){var list=[];if(null!=m_Res_Get_Event_Dungeon_Vote_League_Ranking_Info&&null!=m_Res_Get_Event_Dungeon_Vote_League_Ranking_Info&&null!=m_Res_Get_Event_Dungeon_Vote_League_Ranking_Info.event_dungeon_vote_ranking_info){var user_vote_list=m_Res_Get_Event_Dungeon_Vote_League_Ranking_Info.event_dungeon_vote_ranking_info;user_vote_list=stable(user_vote_list,function(l,r){return l.league_yunhee_idx-r.league_yunhee_idx}),list=stable(user_vote_list,function(l,r){return l.ranking-r.ranking})}return list},Instance.get_User_Event_Dungeon_Vote_League_Info_List=function(){var user_vote_list=[];return null!=_get_User_Vote_League_Info&&null!=_get_User_Vote_League_Info&&0!=_get_User_Vote_League_Info.length&&(user_vote_list=stable(_get_User_Vote_League_Info,function(l,r){return l.ranking-r.ranking})),user_vote_list},Instance.insert_User_Daily_Bonus=function(res){},Instance.delete_User_Daily_Bonus=function(res){},Instance.delete_User_Daily_Bonus_Recv=function(res){},Instance.get_RollingBannerList=function(){var banner_list=[],m=MasterManager.getInstance(),ss=ShopService.getInstance();null==_get_Rolling_Banner_Info.banner_info&&(_get_Rolling_Banner_Info.banner_info=[]);for(var idx=0;idx<_get_Rolling_Banner_Info.banner_info.length;idx++){var r=_get_Rolling_Banner_Info.banner_info[idx],is_display=!1,timeEngine=TimeEventEngine.getInstance(),beg_remain=0,end_remain=0;if(timeEngine.existTimeEvent(TIME_EVENT_ROLLING_BANNER_BEGIN+r.banner_idx)&&(beg_remain=timeEngine.getSecond(TIME_EVENT_ROLLING_BANNER_BEGIN+r.banner_idx)),timeEngine.existTimeEvent(TIME_EVENT_ROLLING_BANNER_END+r.banner_idx)&&(end_remain=timeEngine.getSecond(TIME_EVENT_ROLLING_BANNER_END+r.banner_idx)),r.banner_type==MAIN_BANNER_JOIN_BONUS)if(GameContext.getInstance().getJoinBonusComlete())continue;if(r.banner_type==MAIN_BANNER_RETURN_USER_BONUS){if(GameContext.getInstance().getReturnUserInfo().is_complete)continue;var rolling_banner=m.get_Banner(r.banner_idx),b_period=m.get_BannerPeriod(rolling_banner.banner_period_idx),add_time=24*m.get_TimeFunction(12).value*60*60*1e3,now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),end_date=b_period.end_dt;(end_remain=moment(end_date).valueOf()+add_time-n)<0&&(end_remain=0)}if(r.banner_type==MAIN_BANNER_NEW_USER_SUPPORT)if(0!=GameContext.getInstance().getCompleteEvoultionEvent())continue;if(r.banner_type==MAIN_BANNER_EVENT_VD_LOGIN){for(var user_login_bonus=GameContext.getInstance().getLoginBonus(),is_delete=!1,jdx=0;jdx<user_login_bonus.event_login_list.length;jdx++){if(28<=(i=user_login_bonus.event_login_list[jdx]).event_login_count){is_delete=!0;break}}if(is_delete)continue}if(r.banner_type!=MAIN_BANNER_BEGINNGER_INFO||UserService.getInstance().isBeginnerBooster()){if(r.banner_type==MAIN_BANNER_PREMIUM_LOGIN_BONUS){is_delete=!1;for(var mt=MasterManager.getInstance(),pl_list=MasterTable.getInstance().get_PremiumLoginBonusList([]),lb=GameContext.getInstance().getLoginBonus(),plb=$.extend({},db.PremiumLoginBonus),iidx=0;iidx<pl_list.length;iidx++){var pl=pl_list[iidx],banner=mt.get_Banner(r.banner_idx);if(pl.login_id==banner.rolling_banner_move_path){plb=pl;n=(now=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME))).valueOf();var bb=moment(pl.beg_dt).valueOf(),ee=moment(pl.end_dt).valueOf();(n<bb||ee<n)&&(is_delete=!0);break}}if(!is_delete)for(var ydx=0;ydx<lb.event_login_list.length;ydx++)if(lb.event_login_list[ydx].event_login_id==plb.login_id){var max_count=UserService.getInstance().getEventLoginBonusMaxCount(lb.event_login_list[ydx].event_login_id);if(lb.event_login_list[ydx].event_login_count>=max_count){is_delete=!0;break}}if(is_delete)continue}if(r.banner_type==MAIN_BANNER_DMM_POINT_GACHA||r.banner_type==MAIN_BANNER_DMM_POINT_GACHA_THIRD||r.banner_type==MAIN_BANNER_DMM_POINT_FOURTH||r.banner_type==MAIN_BANNER_DMM_POINT_FIFTH||r.banner_type==MAIN_BANNER_DMM_POINT_GACHA_SECOND||r.banner_type==MAIN_BANNER_DMM_POINT_16_GACHA||r.banner_type==MAIN_BANNER_NEW_YEAR_LUCKY_BOX)if(NOT_USE_SHOP_BUY_LOG_PARSING){if(!ss.IsEnabledBuyDmmPointGacha(r.banner_type))continue}else{var is_buy=!0,buy_info={};if(r.banner_type==MAIN_BANNER_DMM_POINT_GACHA?buy_info=GameDefault.getInstance().getUserBuy_Type(SHOP_TYPE_GACHA,GACHA_TAB_TYPE_DMM_POINT):r.banner_type==MAIN_BANNER_DMM_POINT_GACHA_THIRD?buy_info=GameDefault.getInstance().getUserBuy_Type(SHOP_TYPE_GACHA,GACHA_TAB_TYPE_DMM_POINT_THIRD):r.banner_type==MAIN_BANNER_DMM_POINT_FOURTH?buy_info=GameDefault.getInstance().getUserBuy_Type(SHOP_TYPE_GACHA,GACHA_TAB_TYPE_DMM_POINT_FOURTH):r.banner_type==MAIN_BANNER_DMM_POINT_FIFTH?buy_info=GameDefault.getInstance().getUserBuy_Type(SHOP_TYPE_GACHA,GACHA_TAB_TYPE_DMM_POINT_FIFTH):r.banner_type==MAIN_BANNER_DMM_POINT_GACHA_SECOND?buy_info=GameDefault.getInstance().getUserBuy_Type(SHOP_TYPE_GACHA,MAIN_BANNER_DMM_POINT_GACHA_SECOND):r.banner_type==MAIN_BANNER_DMM_POINT_16_GACHA?buy_info=GameDefault.getInstance().getUserBuy_Type(SHOP_TYPE_GACHA,MAIN_BANNER_DMM_POINT_16_GACHA):r.banner_type==MAIN_BANNER_NEW_YEAR_LUCKY_BOX&&(buy_info=GameDefault.getInstance().getUserBuy_Type(SHOP_TYPE_EVENT)),null!=buy_info&&(is_buy=buy_info.is_buy),is_buy)continue}if(r.banner_type==MAIN_BANNER_JADE_SHOP)if(UserService.getInstance().isCompleteJadeFirstBuyAll())continue;if(r.banner_type==MAIN_BANNER_NEW_YEAR_LUCKY_BOX){for(var user_infos=(new NetService).get_user_shop_buy_info().user_shop_buy_info,shop_list=(mt=MasterManager.getInstance(),ss.getShopList()),is_luck_buy=!0,i=0;i<shop_list.length;i++){var shop=shop_list[i];if(shop.shop_type==SHOP_TYPE_EVENT){if("Y"==shop.display_yn){if(0==user_infos.length){is_luck_buy=!0;break}for(var j=0;j<user_infos.length;j++)if(user_infos[j].shop_id==shop.shop_id){if("n"==user_infos[j].buy_enable_yn){is_luck_buy=!1;break}}else is_luck_buy=!0;break}is_luck_buy=!1}}if(!is_luck_buy)continue}if(r.banner_type==MAIN_BANNER_STEP_UP_GACHA_DMM_POINT_FIRST||r.banner_type==MAIN_BANNER_STEP_UP_GACHA_DMM_POINT_FIRST_2||r.banner_type==MAIN_BANNER_STEP_UP_GACHA_DMM_POINT_SECOND||r.banner_type==MAIN_BANNER_STEP_UP_GACHA_DMM_POINT_SECOND_2||r.banner_type==MAIN_BANNER_STEP_UP_GACHA_JADE_FIRST||r.banner_type==MAIN_BANNER_STEP_UP_GACHA_JADE_SECOND){if(!ss.IsEnableBuyStepUpGachaByBannerType(r.banner_type))continue}else if(r.banner_type==MAIN_BANNER_EXCHANGE_TICKET);else if(r.banner_type==MAIN_BANNER_SPECIAL_TICKET_GACHA);else if(r.banner_type==MAIN_BANNER_1_DAY_1_TIME_FREE_GACHA_FIRST||r.banner_type==MAIN_BANNER_1_DAY_1_TIME_FREE_GACHA_SECOND||r.banner_type==MAIN_BANNER_1_DAY_1_TIME_FREE_GACHA){if(!ss.IsEnableBuy1Day1TimeFreeGachaByBannerType(r.banner_type))continue}else if((r.banner_type==MAIN_BANNER_1_USER_1_TIME_FREE_GACHA_FIRST||r.banner_type==MAIN_BANNER_1_USER_1_TIME_FREE_GACHA_SECOND||r.banner_type==MAIN_BANNER_1_USER_1_TIME_FREE_GACHA)&&!ss.IsEnableBuy1User1TimeFreeGachaByBannerType(r.banner_type))continue;if(1==r.exp_condition?is_display=0<end_remain&&beg_remain<=0:2==r.exp_condition&&(is_display=!0,"n"==r.display_yn&&(is_display=0<end_remain)),is_display)(banner={}).banner_idx=r.banner_idx,banner.banner_type=r.banner_type,banner.img_path=r.img_path,banner.num=r.num,banner.comment=r.comment,banner_list.push(banner)}}return banner_list=stable(banner_list,function(l,r){return l.num-r.num})},Instance.get_user_event_dungeon_reward=function(){return map_user_event_dungeon_reward},Instance.get_user_event_dungeon_reward_shop=function(){return map_user_event_dungeon_reward_shop},Instance.get_user_event_dungeon_reward_board_info=function(){return map_user_event_dungeon_reward_board_info},Instance.get_user_event_dungeon_board_map_bonus=function(){return map_user_event_dungeon_board_map_bonus},Instance.get_user_event_dungeon_global_reward_log=function(){return map_user_event_dungeon_global_reward_log},Instance.get_user_event_dungeon_marble_map_info=function(){return map_user_event_dungeon_marble_map_info},Instance.get_user_event_dungeon_marble_circuit_log=function(){return map_user_event_dungeon_marble_circuit_log},Instance.get_user_event_dungeon_special_point_shop_log=function(){return map_user_event_dungeon_special_point_shop_log},Instance.get_user_event_dungeon_cutin_accum_rate=function(){return map_user_event_dungeon_cutin_accum_rate},Instance.get_user_event_dungeon_craft_shop_material=function(){return map_user_event_dungeon_craft_shop_material},Instance.get_user_event_dungeon_persnal_point_bonus_log=function(){return map_user_event_dungeon_persnal_point_bonus_log},Instance.get_user_new_euipment_list=function(){return _user_new_euipment_list},Instance.get_user_general_new_equipments=function(){return _user_general_new_equipments},Instance.get_user_new_equipment_bound=function(){return _user_new_equipment_bound},Instance.get_user_event_dungeon=function(){return map_user_event_dungeon},Instance.get_user_Event_Dungeon_Craft_Shop_Product_Info=function(){return _user_Event_Dungeon_Craft_Shop_Product_Info},Instance.get_user_camp_branch_ability=function(){return map_user_camp_branch_ability},Instance.get_map_user_prologue_v2=function(){return map_user_prologue_v2},Instance.get_raid_boss_list=function(){return _raid_boss_list},Instance.get_user_troops=function(){return map_user_troops},Instance.get_user_yunhee_bound=function(){if(m_user_yunhee_bound.size()<0)return 0;if(""!=m_user_id)return m_user_yunhee_bound.at(m_user_id).bound;var keys=m_user_yunhee_bound.keys();return m_user_yunhee_bound.at(keys[0]).bound},Instance.get_user_illust=function(){return m_user_illust},Instance.get_user_beginner_booster=function(){return m_user_beginner_booster},Instance.get_User_Equipment_Box_Gacha_Info=function(){return m_Res_Get_User_Equipment_Box_Gacha_Info},Instance.getUserPremiumDmmPointKey=function(){return m_premium_login_dmm_point_key},Instance.setUserPremiumDmmPointKey=function(key){return m_premium_login_dmm_point_key=key},Instance.getUserMussangTowerTask=function(){return m_user_mussang_tower_task},Instance.getUserMussangTower=function(){return m_user_mussang_tower},Instance.get_user_event_dungeon_marble_fortune=function(){return map_user_event_dungeon_marble_fortune},Instance.get_user_event_dungeon_marble_golden_box_gain_log=function(){return map_user_event_dungeon_marble_golden_box_gain_log},Instance.getUserMussangTowerLotusLog=function(){return m_user_mussang_tower_lotus_log},Instance.get_great_wall_dungeon_list=function(){return _great_wall_dungeon_list},Instance.update_User_Event_Dungeon_Reward=function(res){0<res.event_dungeon_reward_success.length&&Instance.insert_User_Event_Dungeon_Reward(res.event_dungeon_reward_success),GameContext.getInstance().setUserNewMail("y")},Instance.getGreatWallDungeonInfo=function(){return _great_wall_dungeon_info},Instance.get_User_Mussang_Boss_info=function(){return $.extend({},User_Mussang_boss_info)},Instance.set_User_Mussang_Boss_info=function(res){User_Mussang_boss_info={},User_Mussang_boss_info.user_mussang_boss_infos=$.extend([],res.user_mussang_boss_infos),User_Mussang_boss_info.user_mussang_boss_npc_info=$.extend([],res.user_mussang_boss_npc_info)},Instance.get_User_Mussang_Boss_list_Cnt=function(){return User_Mussang_Boss_list_Cnt},Instance.set_User_Mussang_Boss_list_Cnt=function(Cnt){User_Mussang_Boss_list_Cnt=Cnt},Instance.set_User_Mussang_Boss_Hp=function(dungeon_idx,hp_value,is_win){User_Mussang_boss_info.user_mussang_boss_npc_info.some(function(npc_info){if(npc_info.boss_dungeon_idx==dungeon_idx)return npc_info.remain_hp-=hp_value,npc_info.remain_hp<=0&&(npc_info.dead_yn="y"),!0}),User_Mussang_boss_info.user_mussang_boss_infos.some(function(dungeon_info){dungeon_info.boss_dungeon_idx==dungeon_idx&&(dungeon_info.complete_yn=is_win)})},Instance.get_User_Event_Raid_AccumDamage=function(period_idx){var Accum_Damage=0;if(null!=User_Achieve_Info_list.event_raid_achieve)for(var i=0;i<User_Achieve_Info_list.event_raid_achieve.length;i++){var list=User_Achieve_Info_list.event_raid_achieve[i];if(list.event_dungeon_period_idx==period_idx){Accum_Damage=list.accum_damage;break}}return parseInt(Accum_Damage)},Instance.get_User_Event_Raid_ConquestCount=function(period_idx){var Conquest_count=0;if(null!=User_Achieve_Info_list.event_raid_achieve)for(var i=0;i<User_Achieve_Info_list.event_raid_achieve.length;i++){var list=User_Achieve_Info_list.event_raid_achieve[i];if(list.event_dungeon_period_idx==period_idx){Conquest_count=list.conquest_count;break}}return Conquest_count},Instance.get_Event_Raid_Dungeon_idx=function(){return Global_Raid_Boss_Info.event_raid_boss_info.event_raid_dungeon_idx},Instance.get_Event_Raid_Dungeon_Period_idx=function(){return Global_Raid_Boss_Info.event_dungeon_period_idx},Instance.get_Event_Raid_Dungeon_User_Info=function(){return User_Achieve_Info_list},Instance.get_Event_Raid_Dungeon_Multiple_Type=function(){return Global_Raid_Dungeon_info.multiple_type},Instance.get_User_Event_Raid_Achievement_List=function(achv_type,event_dungeon_period_idx,list){for(var m=MasterTable.getInstance(),mt=MasterManager.getInstance(),m_list=(mt.get_EventDungeonName(event_dungeon_period_idx).name,m.get_EventRaidAchievementList(event_dungeon_period_idx)),i=0;i<m_list.length;i++){var achieve_list=m_list[i];if(achv_type%2+1==achieve_list.delimiter){var achieve={};if(achieve.achv_type=achieve_list.delimiter,achieve.complete_count=achieve_list.complete_num,achieve.need_point=achieve_list.need_point,achieve.complete_yn="n",achieve.new_yn="y",achv_type==ACHIEVEMENT_EVENTDUNGEON||achv_type==ACHIEVEMENT_EVENTDUNGEON_2ND?1==achieve_list.delimiter?(achieve.achv_name=res_str("event_raid_quest_clear_1"),achieve.content=achieve.achv_name+cmString(res_str("event_raid_quest_count_1"),Number(achieve.need_point).toLocaleString("en"))):2==achieve_list.delimiter&&(achieve.achv_name=res_str("event_raid_quest_usecount_1"),achieve.content=achieve.achv_name+cmString(res_str("event_raid_quest_count_2"),Number(achieve.need_point).toLocaleString("en"))):achv_type!=ACHIEVEMENT_EVENTDUNGEON_3RD&&achv_type!=ACHIEVEMENT_EVENTDUNGEON_4RD||(1==achieve_list.delimiter?(achieve.achv_name=res_str("event_raid_quest_clear_2"),achieve.content=achieve.achv_name+cmString(res_str("event_raid_quest_count_1"),Number(achieve.need_point).toLocaleString("en"))):2==achieve_list.delimiter&&(achieve.achv_name=res_str("event_raid_quest_usecount_2"),achieve.content=achieve.achv_name+cmString(res_str("event_raid_quest_count_2"),Number(achieve.need_point).toLocaleString("en")))),null!=User_Achieve_Info_list.event_raid_achieve)for(var j=0;j<User_Achieve_Info_list.event_raid_achieve.length;j++){var u_list=User_Achieve_Info_list.event_raid_achieve[j];if(u_list.event_dungeon_period_idx==achieve_list.event_dungeon_period_idx)for(var k=0;k<u_list.achieve_complete.length;k++){var complete=u_list.achieve_complete[k];complete.delimiter==achieve_list.delimiter&&complete.complete_num==achieve_list.complete_num&&(achieve.complete_yn="y","n"==complete.complete_yn?achieve.new_yn="y":"y"==complete.complete_yn&&(achieve.new_yn="n"))}}var bonus_item=mt.get_EventRaidAchieveCompleteBonus(event_dungeon_period_idx,achieve_list.delimiter,achieve_list.complete_num,1);achieve.bonus_type=bonus_item.bonus_type,achieve.bonus_type==BONUS_TYPE_YUNHEE_FIX?(achieve.bonus_id=bonus_item.min_value,achieve.bonus_count=bonus_item.max_value):achieve.bonus_count=bonus_item.min_value,list.push_back(achieve)}}},Instance.getShopBuyCount=function(shop_id){for(var buy_count=0,i=0;i<_user_shop_buy_info.user_shop_buy_info.length;i++){var info=_user_shop_buy_info.user_shop_buy_info[i];if(info.shop_id==shop_id){buy_count=info.buy_count;break}}return buy_count},Instance.getUser_General=function(){return map_User_General},Instance.updateCampFactoryGnrlExchange=function(item){var found=_user_camp_gnrl_factory_exchange_item.user_gnrl_exchange_item.findIndex(function(obj){if(obj.gnrl_factory_id==item.gnrl_factory_id)return!0});-1!=found?(_user_camp_gnrl_factory_exchange_item.user_gnrl_exchange_item[found].exchange_count=item.exchange_count,_user_camp_gnrl_factory_exchange_item.user_gnrl_exchange_item[found].remain_exchange_count=item.remain_exchange_count):_user_camp_gnrl_factory_exchange_item.user_gnrl_exchange_item.push_back(item)},Instance.get_Event_Panel_Gacha_Info=function(period_idx){for(var Panel_Box_Info={},i=0;i<_event_panel_gacha_box_info.event_dungeon_panel_gacha_box_info.length;i++){var info=_event_panel_gacha_box_info.event_dungeon_panel_gacha_box_info[i];if(info.event_dungeon_period_idx==period_idx){Panel_Box_Info=$.extend({},info);break}}return Panel_Box_Info},Instance.get_Event_Panel_Gacha_Box_Idx=function(period_idx){return _event_panel_gacha_box_pan_info.event_dungeon_panel_gacha_box_idx},Instance.get_Event_Vote_League_Group_Idx_V3=function(){return _event_vote_league_group_info_v3.vote_league_group_idx},Instance.get_OneUser_OneTime_Free_Gacha_Buy_Log=function(){return _oneuser_onetime_free_gacha_buy_log},Instance.get_OneDay_OneTime_Free_Gacha_Buy_Log=function(){return _oneday_onetime_free_gacha_buy_log},Instance.insert_User_Evolution_Event=function(res){User_evolution_event={},User_evolution_event.gnrl_id=res.gnrl_key.gnrl_id,User_evolution_event.gnrl_num=res.gnrl_key.gnrl_num,User_evolution_event.state_type=res.state_type,User_evolution_event.complete_yn=res.complete_yn,User_evolution_event.recv_bonus_yn=res.recv_bonus_yn,User_evolution_event.delete_yn=res.delete_yn},Instance.get_User_Evolution_Event=function(res){return User_evolution_event},Instance.insert_User_Game_State=function(res){User_game_state={},User_game_state.game_state_type=res.game_state_type,User_game_state.tutorial_step=res.tutorial_step},Instance.get_User_Game_State=function(res){return User_game_state},Instance.insert_User_Jade_First_Buy_Log=function(res){User_jade_first_buy_log=[];for(var i=0;i<res.length;i++){var data={};data.shop_id=res[i].shop_id,data.buy_yn=res[i].buy_yn,User_jade_first_buy_log.push(data)}},Instance.get_User_Jade_First_Buy_Log=function(){return User_jade_first_buy_log},Instance.insert_User_main_story=function(res){User_main_story.clear();for(var idx=0;idx<res.length;idx++){var key=res[idx].main_scene_id+""+res[idx].main_story_id+res[idx].difficulty_type;User_main_story.insert(key,res[idx])}},Instance.get_User_main_story=function(){return User_main_story},Instance.get_new_raid_boss_shop_buy_log_list=function(){return _new_raid_boss_shop_buy_log_list},Instance.get_new_raid_boss_partner_user_list=function(){return _new_raid_boss_partner_user_list},Instance.get_User_gacha_count=function(){return User_gacha_count},Instance.get_User_info=function(){return User_info},Instance.insert_User_info=function(res){User_info={};var data={};data.user_id=res.user_id,data.nickname=res.nickname,data.state_type=res.state_type,data.user_level=res.user_level,data.user_exp=res.user_exp,data.join_bonus_cmplt_yn=res.join_bonus_cmplt_yn,data.naming=res.naming,User_info=$.extend({},res)},Instance.clear_object_all=function(){map_User_General=null,map_Friend_General=null,map_User_Cost_general=null,map_User_Camp_cost=null,map_User_Evolve_Arm_Service_Mtrl=null,map_User_Hwandan_Info=null,list_User_Troops_General=null,list_User_Weekly_Troops_General=null,list_User_Mail=null,map_User_Love_Item=null,res_Get_Shop_Free_General=null,_config=null,_config_v2=null,_battle_dungeon_continue=null,map_User_Limit_Over_Mtrl=null,_battle_config_v2=null,_booster_event=null,_exp_booster_item=null,_user_shop_buy_info=null,_session_msg=null,_weekly_task=null,_user_gnrl_piece_item=null,_user_camp_gnrl_factory_exchange_item=null,_user_new_equipment_enhance_materials=null,_user_new_equipment_enchant_tickets=null,_user_new_equipment_make_materials=null,_user_new_equipment_smelt_materials=null,_user_new_euipment_list=null,_user_general_new_equipments=null,_user_new_equipment_bound=null,_user_main_story_hard_mode_missions=null,_user_main_story_hard_mode_mission_tasks=null,_user_main_story_hard_mode_lotus_reward_log=null,list_Announce_Msg_Queue=null,list_Global_Booster_Event_V2=null,map_User_Equipment=null,map_User_Gnrl_Equipment=null,list_User_book_General=null,list_User_camp_cost_slot=null,m_User_main_lotus_bonus_log=null,m_user_mussang_Info=null,m_User_Battle_formation=null,m_User_formation_property_point=null,m_daily_dungeon_open_period_info=null,map_User_Equipment_option_option_change_temp=null,map_User_Equipment_bound=null,_get_Rolling_Banner_Info=null,User_Magic_Key_Mtrl=null,User_Key_Recovery_Make_Count=null,_get_Shop_Gacha_Period_Info=null,_get_Popup_Banner_Info=null,_get_User_Vote_Info=null,_get_User_Vote_League_Info=null,m_Res_Get_Event_Dungeon_Vote_Ranking_Info=null,m_Res_Get_Event_Dungeon_Vote_League_Ranking_Info=null,_great_wall_dungeon_info=null,_great_wall_dungeon_list=null,_great_wall_troops_info=null,_event_box_gacha_info_v2=null,map_user_key_bound_increase=null,map_user_weekly_open=null,map_user_event_dungeon_reward=null,map_user_event_dungeon_reward_shop=null,map_user_event_dungeon_reward_board_info=null,map_user_event_dungeon_board_map_bonus=null,map_user_event_dungeon_global_reward_log=null,map_user_event_dungeon_marble_map_info=null,map_user_event_dungeon_marble_circuit_log=null,map_user_event_dungeon_special_point_shop_log=null,map_user_event_dungeon_cutin_accum_rate=null,map_user_event_dungeon_craft_shop_material=null,map_user_event_dungeon_persnal_point_bonus_log=null,map_user_event_dungeon=null,_user_Event_Dungeon_Craft_Shop_Product_Info=null,map_user_event_dungeon_point=null,map_user_camp_branch_ability=null,map_user_prologue_v2=null,map_user_event_dungeon_special_point=null,_raid_boss_list=null,_raid_boss_history=null,_step_up_gacha_buy_log=null,_get_User_Vote_Info=null,m_Res_Get_Event_Dungeon_Vote_League_Ranking_Record=null,list_User_Event_Dungeon_Vote_League_Record=null,m_Res_Get_Event_Dungeon_Vote_Ranking_Info=null,map_notice_list=null,map_achievement_list=null,map_user_troops=null,m_user_yunhee_bound=null,m_user_illust=null,_user_gacha_ticket=null,_user_special_gacha_ticket=null,list_User_Box_Gacha_Info=null,list_User_Box_Gacha_progress_Info=null,m_premium_login_dmm_point_key=null,m_Res_Get_User_Equipment_Box_Gacha_Info=null,m_user_beginner_booster=null,m_user_mussang_tower=null,m_user_mussang_tower_task=null,m_user_mussang_tower_lotus_log=null,m_user_naming=null,map_User_Rebirth_Mtrl=null,map_User_Event_Dungeon_Search_Troops=null,map_User_Event_Dungeon_Search_Troops_Generals=null,map_Event_Dungeon_Search_Area_Info=null,m_Res_Get_User_Event_Dungeon_Christmas_Info=null,m_Res_Get_Event_Dungeon_Vote_League_Yunhee_Info=null,m_Res_Get_User_Event_Dungeon_Satisfaction_Info=null,map_user_event_dungeon_once_a_day=null,map_user_event_dungeon_personal_point_bonus_log=null,map_user_event_dungeon_christmas_reward=null,map_user_event_dungeon_christmas_total_reward_info=null,map_user_ceiling_gacha_info=null,map_user_event_dungeon_marble_fortune=null,map_user_event_dungeon_marble_golden_box_gain_log=null,map_User_Extra_Box_Init_Info=null,list_User_Box_Gacha_Golden_Barrel_Info=null,map_User_Food_List=null,map_user_event_dungeon_vote_league_reward=null,map_user_event_dungeon_vote_league_use_point_reward=null,map_user_main_mission_task=null,map_user_main_mission=null,User_evolution_event=null,User_game_state=null,User_daily_dungeon=null,User_jade_first_buy_log=null,User_main_story=null,User_info=null,User_item_info=null,_evolve_Stone_Count=null},Instance}function addMethod(obj,name,fn){if(obj[name]=obj[name]||function(){var method=obj[name].cache[arguments.length];if(method)return method.apply(this,arguments);throw new Error("Wrong number of arguments")},obj[name].cache=obj[name].cache||{},obj[name].cache[fn.length])throw new Error("Cannot define multiple '"+name+"' methods with the same number of arguments!");obj[name].cache[fn.length]=function(){return fn.apply(this,arguments)}}var EventDungeonService,callback_PacketList=function(opcode,state,body,target){SceneManager.getInstance().getMainScene().onNetworkEvent(opcode,state,body),(new NetService).next_PacketList(target)},BOX_GACHA_ITEM_COUNT=80;EventDungeonService=function(){var instance,m_event_dungeon_vote_prev_ranking_league_group_idx=0;function EventDungeonService(){return{getUserEventDungeonReward:function(event_dungeon_period_idx,list){for(var reward_list=MasterTable.getInstance().get_EventDungeonReward(event_dungeon_period_idx),i=0;i<reward_list.length;i++){var r=reward_list[i],item=new db.UserEventDungeonReward;item.event_dungeon_reward_idx=r.event_dungeon_reward_idx,item.event_dungeon_period_idx=event_dungeon_period_idx,item.reward=r,list.push(item)}EventDungeonTable.getInstance().sel_UserEventDungeonReward(m_user_id,list)},getUserEventDungeonRewardShop:function(event_dungeon_period_idx,list){for(var reward_list=MasterTable.getInstance().get_EventDungeonRewardShop(event_dungeon_period_idx),i=0;i<reward_list.length;i++){var s=reward_list[i],item=new db.UserEventDungeonRewardShop;item.event_dungeon_reward_shop_idx=s.event_dungeon_reward_shop_idx,item.event_dungeon_period_idx=event_dungeon_period_idx;var add_buy_count=(item.reward=s).add_buy_count,add_event_dungeon_period_idx=s.add_event_dungeon_period_idx;this.IsOpenDungeon(add_event_dungeon_period_idx)&&(item.reward.buy_try_count=item.reward.buy_try_count+add_buy_count),list.push(item)}EventDungeonTable.getInstance().sel_UserEventDungeonRewardShop(m_user_id,list)},getUserEventDungeonPersonalPointBonusInfo:function(event_dungeon_point_period_idx,list){list.clear();var m=MasterTable.getInstance(),step_list=m.get_EventDungeonPersonalPointInfo(event_dungeon_point_period_idx),point=new db.UserEventDungeonPoint;this.getUserEventDungeonPoint(event_dungeon_point_period_idx,point);for(var i=0;i<step_list.length;i++){var p=step_list[i],info=new db.UserEventDungeonPersonalAccmPointReward;info.point_info_idx=p.step,info.event_dungeon_period_idx=p.event_dungeon_group_idx,info.point_info=p,info.user_accum_event_dungeon_point=point.accum_event_point,info.accm_point=p.accm_point,m.get_EventDungeonPersonalPointBonusList(p.step,info.rewards),list.push(info)}EventDungeonTable.getInstance().sel_UserEventDungeonPersonalPointAccmReward(m_user_id,list)},getUserEventDungeonRewardBoardInfo:function(event_dungeon_period_idx,list){var user_event_point={};this.getUserEventDungeonPoint(event_dungeon_period_idx,user_event_point);for(var m=MasterTable.getInstance(),map_list=[],info_list=m.get_EventDungeonRewardBoardInfo(event_dungeon_period_idx),i=0;i<info_list.length;i++){var info=info_list[i];(board=new db.UserEventDungeonRewardBoardInfo).event_dungeon_period_idx=info.event_dungeon_period_idx,board.event_dungeon_reward_board_info_idx=info.event_dungeon_reward_board_info_idx,board.board_info=info,board.event_point=user_event_point.event_point,map_list=m.get_EventDungeonRewardBoardMap(info.event_dungeon_reward_board_info_idx);for(var a=0;a<map_list.length;a++){var map=map_list[a],board_map=new db.UserEventDungeonRewardBoardMap;board_map.event_dungeon_period_idx=info.event_dungeon_period_idx,board_map.event_dungeon_reward_board_info_idx=info.event_dungeon_reward_board_info_idx,board_map.event_dungeon_reward_board_map_idx=map.event_dungeon_reward_board_map_idx,board_map.event_point=user_event_point.event_point,board_map.map_info=map,board_map.reward_list=m.get_EventDungeonRewardBoardMapBonus(map.event_dungeon_reward_board_map_idx),board.map_list.push(board_map)}list.push(board)}var t=EventDungeonTable.getInstance();t.sel_UserEventDungeonRewardBoardInfo(m_user_id,list);for(var idx=0;idx<list.length;idx++){var board=list[idx];t.sel_UserEventDungeonRewardBoardMap(m_user_id,board.map_list)}},getUserEventDungeonGlobalPointInfo:function(event_dungeon_period_idx,list){for(var m=MasterTable.getInstance(),step_list=m.get_EventDungeonGlobalPoint(event_dungeon_period_idx),i=0;i<step_list.length;i++){var p=step_list[i],info=new db.UserEventDungeonGlobalPointInfo;info.event_dungeon_global_point_idx=p.event_dungeon_global_point_idx,info.event_dungeon_period_idx=p.event_dungeon_period_idx,info.point_info=p,info.rewards=m.get_EventDungeonGlobalPointBonus(p.event_dungeon_global_point_idx),list.push(info)}EventDungeonTable.getInstance().sel_UserEventDungeonGlobalPointInfo(m_user_id,list)},getUserEventDungeonMarbleMapInfo:function(event_dungeon_period_idx,map){if(EventDungeonTable.getInstance().sel_UserEventDungeonMarbleMapInfo(m_user_id,event_dungeon_period_idx,map),0==map.event_dungeon_marble_map_info_idx){var map_list=MasterTable.getInstance().get_EventDungeonMarbleMapInfoList(event_dungeon_period_idx);if(0<map_list.length){var first=map_list[0];map.event_dungeon_period_idx=first.event_dungeon_period_idx,map.event_dungeon_marble_map_info_idx=first.event_dungeon_marble_map_info_idx,map.circuit_count=0}}},getUserEventDungeonMarbleCircuitList:function(event_dungeon_period_idx,list){var m=MasterTable.getInstance(),map_info={};this.getUserEventDungeonMarbleMapInfo(event_dungeon_period_idx,map_info);for(var circuit_list=m.get_EventDungeonMarbleCircuitInfoList(event_dungeon_period_idx),i=0;i<circuit_list.length;i++){var c=circuit_list[i],info={};info.event_dungeon_period_idx=c.event_dungeon_period_idx,info.event_dungeon_marble_circuit_info_idx=c.event_dungeon_marble_circuit_info_idx,info.circuit_count=null!=map_info.circuit_count?map_info.circuit_count:0,info.circuit_info=c,info.bonus_list=m.get_EventDungeonMarbleCircuitBonusList(c.event_dungeon_marble_circuit_info_idx,info.bonus_list),list.push(info)}EventDungeonTable.getInstance().sel_UserEventDungeonMarbleCircuitInfo(m_user_id,list)},getUserEventDungeonMarbleFortune:function(event_dungeon_period_idx,fortune){EventDungeonTable.getInstance().sel_UserEventDungeonMarbleFortune(m_user_id,event_dungeon_period_idx,fortune)},getUserEventDungeonMarbleGoldenBoxInfo:function(event_dungeon_period_idx,list){MasterManager.getInstance();for(var golden_box_list=MasterTable.getInstance().get_EventDungeonMarbleGoldenBoxList(event_dungeon_period_idx,18),g_idx=0;g_idx<golden_box_list.length;g_idx++){var b=golden_box_list[g_idx],info=new db.UserEventDungeonMarbleGoldenBoxInfo;info.event_dungeon_period_idx=b.event_dungeon_period_idx,info.golden_box_idx=b.golden_box_idx,info.gain_count=0,info.golden_box_info=b,list.push_back(info)}EventDungeonTable.getInstance().sel_UserEventDungeonMarbleGoldenBoxInfo(m_user_id,list)},getMaxEventDungeonMarbleCircuitCount:function(event_dungeon_period_idx){var list=MasterManager.getInstance().get_AllEventDungeonMarbleCircuitInfo().filter(function(obj){return obj.event_dungeon_period_idx==event_dungeon_period_idx});return list.sort(function(l,r){return r.target_count-l.target_count}),list[0].target_count},getUserEventDungeonSpecialPointShopList:function(event_dungeon_period_idx,list){var sp={},shop_list=[];MasterTable.getInstance().get_EventDungeonSpecialPointShopList(event_dungeon_period_idx,shop_list);for(var i=0;i<shop_list.length;i++){var s=shop_list[i],info={};info.event_dungeon_period_idx=s.event_dungeon_period_idx,info.event_dungeon_special_point_shop_idx=s.event_dungeon_special_point_shop_idx,info.shop=s,info.user_special_point=sp.special_point,info.user_accum_special__point=sp.accum_special_point,list.push(info)}EventDungeonTable.getInstance().sel_UserEventDungeonSpecialPointShop(m_user_id,list)},getUserEventDungeonCraftShopMaterial:function(event_dungeon_type){null==event_dungeon_type&&(event_dungeon_type=EVENT_DUNGEON_TYPE_LINLIN);for(var list=[],m_dungeon_craft_shop_material=NetService().get_user_event_dungeon_craft_shop_material(),keys=m_dungeon_craft_shop_material.keys(),idx=0;idx<keys.length;idx++){var m={},material=m_dungeon_craft_shop_material.at(keys[idx]);event_dungeon_type==EVENT_DUNGEON_TYPE_LINLIN?material.craft_shop_bonus_type>CRAFT_SHOP_BONUS_TYPE_CRYSTAL_PIECE&&material.craft_shop_bonus_type<=CRAFT_SHOP_BONUS_TYPE_TOTAL_LEGEND&&(m.craft_shop_bonus_type=material.craft_shop_bonus_type,m.material_count=material.material_count,list.push_back(m)):material.craft_shop_bonus_type>CRAFT_SHOP_BONUS_TYPE_TOTAL_LEGEND&&(m.craft_shop_bonus_type=material.craft_shop_bonus_type,m.material_count=material.material_count,list.push_back(m))}return list},getMaxChangeCraftShopMaterialUnitCount:function(event_dungeon_period_idx,craft_shop_bonus_type){},getMaxChangeCraftShopEventPointUnitCount:function(event_dungeon_period_idx,craft_shop_bonus_type){},getEventDungeonCraftShopItemRecipeList:function(event_dungeon_period_idx,list){var m_event_dungeon_craft_shop_product_recipe=MasterManager.getInstance().get_All_EventDungeonCraftShopProductRecipe(),m_event_dungeon_craft_shop_product_item=MasterManager.getInstance().get_All_EventDungeonCraftShopProductItem();m_event_dungeon_craft_shop_product_recipe.forEach(function(recipe){m_event_dungeon_craft_shop_product_item.forEach(function(product_item){if(recipe.event_dungeon_period_idx==product_item.event_dungeon_period_idx&&recipe.product_recipe_id==product_item.product_recipe_id){var item={};item.product_recipe_id=recipe.product_recipe_id,item.product_item_id=product_item.product_item_id,item.event_dungeon_period_idx=recipe.event_dungeon_period_idx,item.mtrl_1=recipe.mtrl_1,item.need_cnt1=recipe.need_cnt_1,item.mtrl_2=recipe.mtrl_2,item.need_cnt2=recipe.need_cnt_2,item.mtrl_3=recipe.mtrl_3,item.need_cnt3=recipe.need_cnt_3,item.product_enable_cnt=recipe.product_enable_cnt,item.bonus_type=product_item.bonus_type,item.min_value=product_item.min_value,item.max_value=product_item.max_value,item.cool_time=product_item.cool_time,list.push(item)}})})},getUserEventDungeonSpecialPoint:function(event_dungeon_period_idx,point){var d_point=(new NetService).get_user_event_dungeon_special_point().at([m_user_id,event_dungeon_period_idx]);point.accum_special_point=null==d_point?(point.event_dungeon_period_idx=event_dungeon_period_idx,point.special_point=0):(point.event_dungeon_period_idx=d_point.event_dungeon_period_idx,point.special_point=d_point.point,d_point.accum_point)},getUserEventDungeonPoint:function(event_dungeon_period_idx,point){var d_point=(new NetService).get_user_event_dungeon_point().at([m_user_id,event_dungeon_period_idx]);point.accum_event_point=null==d_point?(point.event_dungeon_period_idx=event_dungeon_period_idx,point.event_point=0):(point.event_dungeon_period_idx=d_point.event_dungeon_period_idx,point.event_point=d_point.event_point,d_point.accum_event_point)},isEnableCraftShopMakeItem:function(product_recipe_id){for(var recipe=MasterManager.getInstance().get_EventDungeonCraftShopProductRecipe(product_recipe_id),craft_shop_material_list=this.getUserEventDungeonCraftShopMaterial(),idx=0;idx<craft_shop_material_list.length;idx++){var i=craft_shop_material_list[idx];if(i.craft_shop_bonus_type==recipe.mtrl_1){if(i.material_count<recipe.need_cnt_1)return!1}else if(i.craft_shop_bonus_type==recipe.mtrl_2){if(i.material_count<recipe.need_cnt_2)return!1}else if(i.craft_shop_bonus_type==recipe.mtrl_3&&i.material_count<recipe.need_cnt_3)return!1}return!0},getEventDungeonVDYunheeIdx:function(event_dungeon_period_idx){var yunhee_idx=0,y=MasterTable.getInstance().get_AllEventDungeonVdYunhee();for(var id in y)if(id.idx==event_dungeon_period_idx){yunhee_idx=id.idx;break}return yunhee_idx},getEventDungeonVDYunheeGnrlId:function(yunhee_idx){return MasterTable.getInstance().get_EventDungeonVdYunhee(yunhee_idx).gnrl_id},getEventDungeonVDYunheeList:function(list){var mt=MasterTable.getInstance(),yunee_list=[];mt.get_EventDungeonVdYunheeList(yunee_list);for(var idx=0;idx<yunee_list.length;idx++){var yunhee=yunee_list[idx],g=mt.get_General(yunhee.gnrl_id),info=new db.UserGeneralInfo;info.gnrl_id=g.gnrl_id,info.name=g.name,info.gnrl_type=g.gnrl_type,info.state_type=g.state_type,info.class_type=g.gnrl_class,info.gnrl_group=g.gnrl_group,info.max_level=g.max_level,info.element_type=g.element_type,info.arm_service_type=g.arm_service_type,info.fight_type=g.fight_type,info.cost=g.cost,info.attk=g.attk,info.def=g.def,info.hp=g.hp,info.sp=g.sp,info.gnrl_level=1,info.sell_gold=g.sell_gold,info.sell_yhpt=g.sell_yhpt,info.level_exp_group=g.level_exp_group,info.max_class_type=g.evolution_max_class_type,info.rare_type=g.rare_type,info.passive_skill.push_back(g.passive_skill_id),info.leader_skill.push_back(g.leader_skill_id),g.trans_passive_skill_id.split(",").forEach(function(p_id){var trans_passive_skill_id=parseInt(p_id);info.trans_passive_skill.push_back(trans_passive_skill_id)}),g.special_leader_skill_id=g.special_leader_skill_id+"";for(var leader_skill_list=g.special_leader_skill_id.split(","),jdx=0;jdx<leader_skill_list.length;jdx++){var s=leader_skill_list[jdx];info.special_leader_skill.push_back(1*s)}list.push(info)}},getUserEventDungeonCutinAccumRatePoint:function(event_dungeon_period_idx,point){var period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx);EventDungeonTable.getInstance().sel_UserEventDungeonCutinAccumRatePoint(m_user_id,period.event_dungeon_group_idx,point)},getEventDungeonMiddleHalfPeriodIdx:function(event_dungeon_group_idx){for(var m=MasterTable.getInstance(),first_half_period_idx=this.getEventDungeonFirstHalfPeriodIdx(event_dungeon_group_idx),second_half_period_idx=this.getEventDungeonSecondHalfPeriodIdx(event_dungeon_group_idx),list=m.get_EventDungeonPeriodList(event_dungeon_group_idx),idx=0;idx<list.length;idx++){var p=list[idx];if(first_half_period_idx<p.event_dungeon_period_idx&&second_half_period_idx>p.event_dungeon_period_idx){p.event_dungeon_period_idx;break}}return second_half_period_idx-1},getEventDungeonSecondHalfPeriodIdx:function(event_dungeon_group_idx){var event_dungeon_period_idx=0,list=MasterTable.getInstance().get_EventDungeonPeriodList(event_dungeon_group_idx);return 0<(list=stable(list,function(l,r){return l.event_dungeon_period_idx>r.event_dungeon_period_idx})).length&&(event_dungeon_period_idx=list[list.length-1].event_dungeon_period_idx),event_dungeon_period_idx},getEventDungeonFirstHalfPeriodIdx:function(event_dungeon_group_idx){var event_dungeon_period_idx=0,list=MasterTable.getInstance().get_EventDungeonPeriodList(event_dungeon_group_idx);return 0<(list=stable(list,function(l,r){return l.event_dungeon_period_idx>r.event_dungeon_period_idx})).length&&(event_dungeon_period_idx=list[0].event_dungeon_period_idx),event_dungeon_period_idx},getEventDungeonGrowthRemainNextLevelNeedPoint:function(current_level,current_point,event_dungeon_group_idx){if(this.getEventDungeonGrowthMaxLevel(event_dungeon_group_idx)<=current_level)return 0;var next_level=current_level+1;return MasterManager.getInstance().get_EventDungeonGrowthLevel(next_level,event_dungeon_group_idx).accm_point-current_point},getEventDungeonGrowthRemainMaxtLevelNeedPoint:function(current_level,current_point,event_dungeon_group_idx){for(var mt=MasterManager.getInstance(),target_level=0,standard_level=0,level_list=MasterTable.getInstance().get_EventDungeonGrowthLevelUpInfoList(event_dungeon_group_idx),max_level=(level_list=stable(level_list,function(l,r){return l.growth_level>r.growth_level}))[level_list.length-1].growth_level,i=0;i<level_list.length;i++)if(1==level_list[i].right_reward_yn){standard_level=level_list[i].growth_level;break}(target_level=standard_level)<=current_level&&(target_level=max_level);var total_point=mt.get_EventDungeonGrowthLevel(target_level,event_dungeon_group_idx).accm_point,need_point=current_point;if(standard_level<=current_level){var standard_level_info=mt.get_EventDungeonGrowthLevel(standard_level,event_dungeon_group_idx);total_point-=standard_level_info.accm_point,need_point-=standard_level_info.accm_point}return total_point-need_point},getEventDungeonGrowthTargetLevel:function(current_level,current_point,event_dungeon_group_idx){MasterManager.getInstance();for(var target_level=0,level_list=MasterTable.getInstance().get_EventDungeonGrowthLevelUpInfoList(event_dungeon_group_idx),level_list_desc=stable(level_list,function(l,r){return l.growth_level>r.growth_level}),i=0;i<level_list_desc.length;i++)if(1==level_list_desc[i].right_reward_yn){target_level=level_list_desc[i].growth_level;break}return target_level},getEventDungeonGrowthNextLevelPercent:function(current_level,current_point,event_dungeon_group_idx){if(this.getEventDungeonGrowthMaxLevel(event_dungeon_group_idx)<=current_level)return 100;var next_level=current_level+1,next_level_info=MasterManager.getInstance().get_EventDungeonGrowthLevel(next_level,event_dungeon_group_idx),total_point=next_level_info.need_point;return(total_point-(next_level_info.accm_point-current_point))/total_point*100},IsOpenEventPointPeriod:function(event_dungeon_period_idx){var period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),b=moment(period.event_dungeon_point_beg_dt).valueOf();b+=1e3*period.begin_time;var e=moment(period.event_dungeon_point_end_dt).valueOf();return e+=1e3*period.end_time,b<=n&&n<=e},getEventDungeonGrowthMaxLevel:function(current_level,current_point,event_dungeon_group_idx){MasterManager.getInstance();if(1==arguments.length){event_dungeon_group_idx=current_level;var level_list=MasterTable.getInstance().get_EventDungeonGrowthLevelUpInfoList(event_dungeon_group_idx);return max_level=(level_list=stable(level_list,function(l,r){return l.growth_level>r.growth_level}))[level_list.length-1].growth_level}for(var target_level=0,standard_level=0,max_level=(level_list=MasterTable.getInstance().get_EventDungeonGrowthLevelUpInfoList(event_dungeon_group_idx),(level_list=stable(level_list,function(l,r){return l.growth_level>r.growth_level}))[level_list.length-1].growth_level),i=0;i<level_list.length;i++)if(1==level_list[i].right_reward_yn){standard_level=level_list[i].growth_level;break}return(target_level=standard_level)<=current_level&&(target_level=max_level),target_level},getEventDungeonGrowhthRightNotRewardBeginLevel:function(event_dungeon_group_idx){var level_list=MasterTable.getInstance().get_EventDungeonGrowthLevelUpInfoList(event_dungeon_group_idx);level_list.sort(function(l,r){return l.growth_level-r.growth_level});level_list[level_list.length-1].growth_level;for(var i=0;i<level_list.length;i++)if(1==level_list[i].right_reward_yn)return level_list[i].growth_level;return 0},getEventDungeonGrowthLevelFromLevelPoint:function(event_dungeon_group_idx,level_point){var growth_level=0,level_list=MasterTable.getInstance().get_EventDungeonGrowthLevelList(event_dungeon_group_idx);level_list.sort(function(l,r){return l.growth_level-r.growth_level});for(var i=0;i<level_list.length;i++)level_list[i].accm_point<=level_point&&(growth_level=level_list[i].growth_level);return growth_level},getEventDungeonGrowthNextLevelPercent:function(current_level,current_point,event_dungeon_group_idx){var mt=MasterManager.getInstance(),next_level=current_level+1,max_level=this.getEventDungeonGrowthMaxLevel(event_dungeon_group_idx);max_level<next_level&&(next_level=max_level);var next_level_info=mt.get_EventDungeonGrowthLevel(next_level,event_dungeon_group_idx),total_point=next_level_info.need_point,prcnt=(total_point-(next_level_info.accm_point-current_point))/total_point*100;return 100<prcnt&&(prcnt=100),prcnt},getEventDungeonGrowthMaxLevelNeedPoint:function(event_dungeon_group_idx){var level_list=MasterTable.getInstance().get_EventDungeonGrowthLevelList(event_dungeon_group_idx);return level_list.sort(function(l,r){return l.growth_level-r.growth_level}),level_list[level_list.length-1].accm_point},getEventDungeonGrowthLevelPercent:function(current_level,current_point,event_dungeon_group_idx){for(var mt=MasterManager.getInstance(),target_level=0,standard_level=0,level_list=MasterTable.getInstance().get_EventDungeonGrowthLevelUpInfoList(event_dungeon_group_idx),max_level=(level_list=stable(level_list,function(l,r){return l.growth_level>r.growth_level}))[level_list.length-1].growth_level,idx=0;idx<level_list.length;idx++){var level=level_list[idx];if(1==level.right_reward_yn){standard_level=level.growth_level;break}}(target_level=standard_level)<=current_level&&(target_level=max_level);var total_point=mt.get_EventDungeonGrowthLevel(target_level,event_dungeon_group_idx).accm_point,need_point=current_point;if(standard_level<=current_level){var standard_level_info=mt.get_EventDungeonGrowthLevel(standard_level,event_dungeon_group_idx);total_point-=standard_level_info.accm_point,need_point-=standard_level_info.accm_point}var prcnt=need_point/total_point*100;return max_level<=current_level&&(prcnt=100),prcnt},IsOpenDungeon:function(event_dungeon_period_idx){var period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),b=moment(period.begin_dt).valueOf();b+=1e3*period.begin_time;var e=moment(period.end_dt).valueOf();return e+=1e3*period.end_time,b<=n&&n<=e},IsOpenEventDungeonBuff:function(buff_period_idx){var period=MasterManager.getInstance().get_EventDungeonBuffPeriod(buff_period_idx),now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),b=moment(period.beg_dt).valueOf(),e=moment(period.end_dt).valueOf();return b<=n&&n<=e},IsExistDungeon:function(event_dungeon_period_idx){var period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx);return 0!=period.event_dungeon_period_idx&&null!=period.event_dungeon_period_idx},getUserEventDungeonBoxGachaGoldenBarrelCountInfo:function(box_gacha_info_idx){var list=[],box_gacha=MasterManager.getInstance().get_EventDungeonBoxGachaInfo(box_gacha_info_idx),user_box_gacha_golden_barrel_list=NetService().get_User_Event_Dungeon_Box_Gacha_Golden_Barrel_info_List(),item_list=MasterTable.getInstance().get_EventDungeonBoxGachaGoldenBarrelList(box_gacha.event_dungeon_period_idx),map_info=new Map;item_list.forEach(function(i){var map_item={};map_item.max_count=i.count,map_item.bonus_type=i.bonus_type,map_item.item_id=i.min_value,map_item.event_dungeon_period_idx=box_gacha.event_dungeon_period_idx,map_item.bonus_count=i.max_value,map_item.user_count=0,map_item.sort_num=i.sort_num,map_info.insert([i.bonus_type,i.min_value],map_item)});for(var keys=map_info.keys(),idx=0;idx<keys.length;idx++){var info=map_info.at(keys[idx]);user_box_gacha_golden_barrel_list.forEach(function(user){var item_key={};item_key.bonus_type=user.bonus_type,item_key.min_value=user.item_idx,info.bonus_type==item_key.bonus_type&&info.item_id==item_key.min_value&&user.box_gacha_info_idx==box_gacha_info_idx&&0<user.item_idx&&(info.user_count+=user.item_count)}),list.push_back(info)}return list.sort(function(l,r){return l.sort_num-r.sort_num}),list},MakeCountCraftShopMtrl:function(mtrl_exchange_id){for(var mt=MasterManager.getInstance(),g=GeneralService.getInstance(),c=mt.get_EventDungeonMaterialExchange(mtrl_exchange_id),craft_shop_mtrl_type_1=g.getBonusTypeToCraftShopMtrlType(c.bonus_type),craft_shop_mtrl_type_2=g.getBonusTypeToCraftShopMtrlType(c.bonus_type_2),list=this.getUserEventDungeonCraftShopMaterial(),mtrl_1_need_cnt=c.need_count,mtrl_2_need_cnt=c.need_count_2,mtrl_count_1=-1,mtrl_count_2=-1,i=0;i<list.length;i++)list[i].craft_shop_bonus_type==craft_shop_mtrl_type_1&&(mtrl_count_1=0<list[i].material_count?list[i].material_count/mtrl_1_need_cnt:0),list[i].craft_shop_bonus_type==craft_shop_mtrl_type_2&&0!=craft_shop_mtrl_type_2&&(mtrl_count_2=0<list[i].material_count?list[i].material_count/mtrl_2_need_cnt:0);return-1==mtrl_count_2?mtrl_count_1:mtrl_count_2<=mtrl_count_1?mtrl_count_2:mtrl_count_1},isMakeCraftShopMtrl:function(mtrl_exchange_id,count){for(var mt=MasterManager.getInstance(),g=GeneralService.getInstance(),c=mt.get_EventDungeonMaterialExchange(mtrl_exchange_id),craft_shop_mtrl_type_1=g.getBonusTypeToCraftShopMtrlType(c.bonus_type),craft_shop_mtrl_type_2=g.getBonusTypeToCraftShopMtrlType(c.bonus_type_2),mtrl_1_need_cnt=c.need_count*count,mtrl_2_need_cnt=c.need_count_2*count,list=this.getUserEventDungeonCraftShopMaterial(),idx=0;idx<list.length;idx++){var i=list[idx];if(i.craft_shop_bonus_type==craft_shop_mtrl_type_1&&i.material_count<mtrl_1_need_cnt)return!1;if(i.craft_shop_bonus_type==craft_shop_mtrl_type_2&&0!=craft_shop_mtrl_type_2&&i.material_count<mtrl_2_need_cnt)return!1}return!0},isMakeCraftShopMtrlFirstSecondHalf:function(craft_shop_bonus_type){for(var list=MasterTable.getInstance().get_EventDungeonCraftShopMtrlDisplayList(),event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),second_half_period_idx=this.getEventDungeonSecondHalfPeriodIdx(period.event_dungeon_group_idx),idx=0;idx<list.length;idx++){var l=list[idx];if(l.craft_shop_bonus_type==craft_shop_bonus_type){if(1==l.first_second_half)return!0;if(2==l.first_second_half&&this.IsOpenDungeon(second_half_period_idx))return!0}}},getUserEventDungeonBoxGachaCountInfo:function(box_gacha_info_idx,list){for(var mt=MasterManager.getInstance(),user_box_gacha_info_list=NetService().get_User_Event_Dungeon_Box_Gacha_Info_List(),item_list=MasterTable.getInstance().get_EventDungeonBoxGachaItemList(box_gacha_info_idx),box_gacha_info=mt.get_EventDungeonBoxGachaInfo(box_gacha_info_idx),map_info=new Map,idx=0;idx<item_list.length;idx++){var i=item_list[idx],item_key=new Map,map_obj=map_info.at([i.bonus_type,i.min_value]),count=0;null==map_obj?count=1:(count=map_obj.max_count,count++),map_info.insert([i.bonus_type,i.min_value],{}),map_info.at([i.bonus_type,i.min_value]).max_count=count,map_info.at([i.bonus_type,i.min_value]).bonus_type=i.bonus_type,map_info.at([i.bonus_type,i.min_value]).item_id=i.min_value,map_info.at([i.bonus_type,i.min_value]).event_dungeon_period_idx=box_gacha_info.event_dungeon_period_idx,map_info.at([i.bonus_type,i.min_value]).box_gacha_info_idx=box_gacha_info_idx,map_info.at([i.bonus_type,i.min_value]).bonus_count=i.max_value,map_info.at([i.bonus_type,i.min_value]).item_idx=i.item_idx,map_info.at([i.bonus_type,i.min_value]).user_count=0}var info_keys=map_info.keys();for(idx=0;idx<info_keys.length;idx++){for(var info=map_info.at(info_keys[idx]),jdx=0;jdx<user_box_gacha_info_list.length;jdx++){var user=user_box_gacha_info_list[jdx],gacha_item=(item_key=new Map,mt.get_EventDungeonBoxGachaItem(user.item_idx));item_key.insert(gacha_item.bonus_type,gacha_item.min_value),info.bonus_type==gacha_item.bonus_type&&info.item_id==gacha_item.min_value&&user.event_dungeon_period_idx==box_gacha_info.event_dungeon_period_idx&&user.box_gacha_info_idx==box_gacha_info.box_gacha_info_idx&&info.user_count++}list.push(info)}list.sort(function(l,r){return l.item_idx-r.item_idx})},isBoxGachaOpenItem:function(item_num){for(var box_gacha_info_idx=GameContext.getInstance().getEventDungeonBoxGachaInfoIdx(),list=NetService().get_User_Event_Dungeon_Box_Gacha_Info_List(box_gacha_info_idx),idx=0;idx<list.length;idx++)if(0!=list[idx].item_idx&&list[idx].item_num==item_num)return!0;return!1},isBoxGachaAllOpen:function(box_gacha_info_idx){return-1==NetService().get_User_Event_Dungeon_Box_Gacha_Info_List(box_gacha_info_idx).findIndex(function(r){return 0==r.item_idx})},isBoxGachaNotOpen:function(box_gacha_info_idx){return-1==NetService().get_User_Event_Dungeon_Box_Gacha_Info_List(box_gacha_info_idx).findIndex(function(r){return 0<r.item_idx})},getEventDungeonBoxGachaNeedPoint:function(){for(var expense={},mt=MasterManager.getInstance(),netService=NetService(),box_gacha_info_idx=GameContext.getInstance().getEventDungeonBoxGachaInfoIdx(),progress_list=netService.get_User_Event_Dungeon_Box_Gacha_Info_Progress_List(),round_count=0,idx=0;idx<progress_list.length;idx++){var l=progress_list[idx];if(l.box_gacha_info_idx==box_gacha_info_idx){round_count=l.round_count,l.second_round_yn;break}}var func=mt.get_GoodsFunction(GOODS_FUNCTION_BOX_GACHA_MOVING),add_expense=func.value;add_expense=0<round_count?1*func.value:0*func.value,expense=MasterTable.getInstance().get_EventDungeonBoxGachaExpenseInfo(box_gacha_info_idx);var need_count_1=parseInt(expense.need_count_1)+parseInt(add_expense);expense.need_count_1=need_count_1;var need_count_2=parseInt(expense.need_count_2)+parseInt(add_expense);return expense.need_count_2=need_count_2,expense},isBoxGachaMainItem:function(box_gacha_info_idx,item_idx){for(var main_item=MasterManager.getInstance().get_EventDungeonBoxGachaMainItem(item_idx),list=MasterTable.getInstance().get_EventDungeonBoxGachaMainItemGroup(main_item.main_item_group_idx),idx=0;idx<list.length;idx++){if(list[idx].main_item_idx==item_idx)return!0}return!1},getEventDungeonNextBoxGachaIdx:function(){var mt=MasterManager.getInstance(),box_gacha_info_idx=GameContext.getInstance().getEventDungeonBoxGachaInfoIdx(),box_gacha_info=mt.get_EventDungeonBoxGachaInfo(box_gacha_info_idx),infolist=[],tampinfolist=[];return mt.getAllEventDungeonBoxGachaInfo().forEach(function(box_gacha){box_gacha.event_dungeon_period_idx==box_gacha_info.event_dungeon_period_idx&&1!=box_gacha_info.extra_box&&infolist.push(box_gacha)}),infolist.sort(function(l,r){return l.box_gacha_info_idx<r.box_gacha_info_idx?1:l.box_gacha_info_idx>r.box_gacha_info_idx?-1:0}),(tampinfolist=infolist)[1].box_gacha_info_idx<=box_gacha_info_idx?tampinfolist.pop().box_gacha_info_idx:++box_gacha_info_idx},getEventDungeonMaxBoxGachaIdx:function(){var mt=MasterTable.getInstance(),box_gacha_info_idx=GameContext.getInstance().getEventDungeonBoxGachaInfoIdx(),box_gacha_info=mt.get_EventDungeonBoxGachaInfo(box_gacha_info_idx),infolist=[];return mt.getAllEventDungeonBoxGachaInfo().forEach(function(box_gacha){box_gacha.event_dungeon_period_idx==box_gacha_info.event_dungeon_period_idx&&infolist.push(box_gacha)}),infolist.sort(function(l,r){return l.event_dungeon_period_idx<r.event_dungeon_period_idx?1:l.event_dungeon_period_idx>r.event_dungeon_period_idx?-1:0}),infolist[0].event_dungeon_period_idx},get_VoteEventYunheeList:function(event_dungeon_period_idx){for(var m=MasterTable.getInstance(),mt=MasterManager.getInstance(),vote_gnrl_list=m.get_VoteEventYunheeList(event_dungeon_period_idx),list=[],idx=0;idx<vote_gnrl_list.length;idx++){var vote_gnrl=vote_gnrl_list[idx],gnrl=mt.get_General(vote_gnrl.thumb_num),info=$.extend({},db.VoteEventYunheeInfo);info.event_dungeon_period_idx=vote_gnrl.event_dungeon_period_idx,info.vote_event_yunhee_idx=vote_gnrl.vote_event_yunhee_idx,info.thumb_num=vote_gnrl.thumb_num,info.gnrl_group=vote_gnrl.gnrl_group,info.name=vote_gnrl.name,info.img_num=vote_gnrl.img_num,info.state_type=gnrl.state_type,info.user_vote_ranking=1e3,info.name_sort_num=vote_gnrl.name_sort_num;for(var ranking=NetService().get_User_Event_Dungeon_Vote_Info_List(),i=0;i<ranking.length;i++)ranking[i].event_dungeon_period_idx==vote_gnrl.event_dungeon_period_idx&&ranking[i].vote_yunhee_idx==vote_gnrl.vote_event_yunhee_idx&&(info.user_vote_ranking=ranking[i].ranking);list.push(info)}return list},get_VoteEventVoteLeagueYunheeList:function(event_dungeon_point_period_idx){for(var yunhee_list=NetService().get_Event_Dungeon_Vote_League_Yunhee_Candidate_List(),m=MasterTable.getInstance(),mt=MasterManager.getInstance(),list=[],idx=0;idx<yunhee_list.length;idx++){var yunhee=yunhee_list[idx],vote_yunhee_info=m.get_EventDungeonVoteLeagueYunheeInfo(event_dungeon_point_period_idx,yunhee.league_yunhee_idx),gnrl=mt.get_General(vote_yunhee_info.thumb_num),info=$.extend({},db.VoteEventYunheeInfo);info.event_dungeon_period_idx=vote_yunhee_info.event_dungeon_period_idx,info.vote_event_yunhee_idx=vote_yunhee_info.league_yunhee_idx,info.thumb_num=vote_yunhee_info.thumb_num,info.gnrl_group=vote_yunhee_info.gnrl_group,info.name=vote_yunhee_info.name,info.img_num=vote_yunhee_info.img_num,info.state_type=gnrl.state_type,info.user_vote_ranking=1e3,info.league_idx=yunhee.league_idx,info.name_sort_num=yunhee.display_num,list.push(info)}return list},getEventDungeonBoxGachaFirstBoxGachaInfoIdx:function(event_dungeon_period_idx){var mt=MasterManager.getInstance(),box_gacha_info=mt.get_EventDungeonBoxGachaInfoByPeroidIDX(event_dungeon_period_idx),infolist=[];mt.getAllEventDungeonBoxGachaInfo().forEach(function(box_gacha){box_gacha.event_dungeon_period_idx==box_gacha_info.event_dungeon_period_idx&&infolist.push(box_gacha)}),infolist.sort(function(l,r){return l.event_dungeon_period_idx>r.event_dungeon_period_idx?1:l.event_dungeon_period_idx<r.event_dungeon_period_idx?-1:0});var box_gacha_info_idx=infolist[0].box_gacha_info_idx;return infolist=null,box_gacha_info_idx},getEventDungeonGrowthLevelUpBonusType:function(event_dungeon_group_idx,growth_level){var bonustype={},mt=MasterManager.getInstance(),level_list=MasterTable.getInstance().get_EventDungeonGrowthLevelUpInfoList(event_dungeon_group_idx);level_list.sort(function(l,r){return l.growth_level-r.growth_level});for(var reward_idx=0,idx=0;idx<level_list.length;idx++){var l=level_list[idx];1==l.right_reward_yn&&l.growth_level<=growth_level&&(reward_idx=l.reward_idx)}var reward_info=mt.get_EventDungeonGrowthLevelUpRewardInfo(reward_idx);return bonustype.bonus_type=reward_info.bonus_type,bonustype.min_value=reward_info.min_value,bonustype.max_value=reward_info.max_value,bonustype},getUserEventDungeonGrowthLevelUpRewardInfo:function(event_dungeon_group_idx,user_list){for(var mt=MasterManager.getInstance(),list=MasterTable.getInstance().get_EventDungeonGrowthLevelUpInfoList(event_dungeon_group_idx),idx=0;idx<list.length;idx++){var i=list[idx],reward=mt.get_EventDungeonGrowthLevelUpRewardInfo(i.reward_idx),info={};info.event_dungeon_group_idx=i.event_dungeon_group_idx,info.growth_level=i.growth_level,info.reward_idx=i.reward_idx,info.right_reward_yn=i.right_reward_yn,info.is_user_level=!1,info.is_right_now_reward=!1,info.subject=reward.subject,user_list.push_back(info)}var res=NetService().get_User_Event_Dungeon_Growth_Info(res);user_list=stable(user_list,function(l,r){return l.growth_level<r.growth_level});for(idx=0;idx<user_list.length;idx++)if(user_list[idx].growth_level<=res.growth_level){user_list[idx].is_user_level=!0;break}user_list=stable(user_list,function(l,r){return l.growth_level>r.growth_level});for(idx=0;idx<user_list.length;idx++)if(1==user_list[idx].right_reward_yn){user_list[idx].is_right_now_reward=!0;break}},getEventDungeonSatisfactionMaxLevel:function(event_dungeon_group_idx){var max_obj={max_level:0,max_point:0},level_list=MasterTable.getInstance().get_EventDungeonSatisfactionLeveList(event_dungeon_group_idx);return level_list.sort(function(l,r){return l.satisfaction_level-r.satisfaction_level}),max_obj.max_level=level_list[level_list.length-1].satisfaction_level,max_obj.max_point=level_list[level_list.length-1].accm_point,max_obj},getEventDungeonSatisfactionLevelPercent:function(current_point,event_dungeon_group_idx,current_level,prcn){var mt=MasterTable.getInstance();if(3==arguments.length){(level_list=mt.get_EventDungeonSatisfactionLeveList(event_dungeon_group_idx)).sort(function(l,r){return l.satisfaction_level-r.satisfaction_level});var next_level=current_level+1;(max_level=level_list[level_list.length-1].satisfaction_level)<next_level&&(next_level=max_level);var currunt_level_info=MasterManager.getInstance().get_EventDungeonSatisfactionLevel(current_level),total_point=MasterManager.getInstance().get_EventDungeonSatisfactionLevel(next_level).need_point,prcnt=(current_point-currunt_level_info.accm_point)/total_point*100;return prcnt=100*prcnt/100,max_level<=current_level&&(prcnt=100),prcnt}if(4==arguments.length){var level_list;(level_list=mt.get_EventDungeonSatisfactionLeveList(event_dungeon_group_idx)).sort(function(l,r){return l.satisfaction_level-r.satisfaction_level});for(var max_level=level_list[level_list.length-1].satisfaction_level,i=0;i<level_list.length;i++)level_list[i].accm_point<=current_point&&(current_level=level_list[i].satisfaction_level);return{prcnt:prcnt=this.getEventDungeonSatisfactionLevelPercent(current_point,event_dungeon_group_idx,current_level),level:current_level}}},getUserEventDungeonSatisfactionRewardShop:function(event_dungeon_group_idx,list){for(var m=MasterTable.getInstance(),satisfaction_info=NetService().get_User_Event_Dungeon_Satisfaction_Info(),reward_list=m.get_EventDungeonSatisfactionLevelUpInfoList(event_dungeon_group_idx),i=0;i<reward_list.size();i++){var s=reward_list.at(i),item=new db.UserEventDungeonSatisfactionRewardShop;item.reward_idx=s.reward_idx,item.event_dungeon_group_idx=event_dungeon_group_idx,item.event_dungeon_period_idx=s.event_dungeon_period_idx,item.satisfaction_level=s.satisfaction_level;var reward=MasterManager.getInstance().get_EventDungeonSatisfactionLevelUpRewardInfo(item.reward_idx);item.reward=reward;var level_info=MasterManager.getInstance().get_EventDungeonSatisfactionLevel(item.satisfaction_level);if(item.need_accum_point=level_info.accm_point,this.IsOpenDungeon(item.event_dungeon_period_idx)&&(item.is_open_yn=!0),0!=satisfaction_info.length&&null!=satisfaction_info)for(var u_idx=0;u_idx<satisfaction_info.user_reward_list.length;u_idx++){if(satisfaction_info.user_reward_list[u_idx].reward_idx==item.reward_idx){item.is_rewarded_yn=!0;break}}list.push_back(item)}},getEventDungeonSatisfactionNextRewardNeedPoint:function(event_dungeon_group_idx){var max_level,m=MasterManager.getInstance(),satisfaction_info=NetService().get_User_Event_Dungeon_Satisfaction_Info(),next_level=satisfaction_info.satisfaction_level+1,next_level_info=m.get_EventDungeonSatisfactionLevel(next_level),max_obj=this.getEventDungeonSatisfactionMaxLevel(event_dungeon_group_idx);return max_level=max_obj.max_level,max_obj.max_point,max_level<=satisfaction_info.satisfaction_level?0:next_level_info.accm_point-satisfaction_info.level_point},getEventDungeonSearchTroopsGeneralList:function(troops_num){var list=[];if(1==arguments.length){null==(user_event_dungeon_search_troops_general=NetService().get_User_Event_Dungeon_Search_Troops_Generals(troops_num))&&(user_event_dungeon_search_troops_general=[]);for(var i=0;i<user_event_dungeon_search_troops_general.length;i++){var g=user_event_dungeon_search_troops_general[i];(tt=new db.UserGeneralTroops).gnrl_id=g.gnrl_id,tt.gnrl_num=g.gnrl_num,tt.troops_num=g.troops_num,tt.pos_type=g.position,tt.is_leader="y"==g.leader_yn,list.push_back(tt)}}else{var user_event_dungeon_search_troops_general,keys=(user_event_dungeon_search_troops_general=NetService().get_User_Event_Dungeon_Search_Troops_Generals()).keys();for(i=0;i<keys.length;i++)for(var toops_genrals=user_event_dungeon_search_troops_general.at(keys[i]),j=0;j<toops_genrals.length;j++){var tt;g=toops_genrals[j];(tt=new db.UserGeneralTroops).gnrl_id=g.gnrl_id,tt.gnrl_num=g.gnrl_num,tt.troops_num=g.troops_num,tt.pos_type=g.position,tt.is_leader="y"==g.leader_yn,list.push_back(tt)}}return list},getEventDungeonSearchTroopsCost:function(troops_num){for(var cost=0,m=MasterManager.getInstance(),user_event_dungeon_search_troops_general=NetService().get_User_Event_Dungeon_Search_Troops_Generals(troops_num),i=0;i<user_event_dungeon_search_troops_general.length;i++){var g=user_event_dungeon_search_troops_general[i];cost+=m.get_General(g.gnrl_id).cost}return cost},getEventDungeonSearchTroopsTotalCost:function(troops_num){for(var cost=0,user_event_dungeon_search_troops=NetService().get_User_Event_Dungeon_Search_Troops(),keys=user_event_dungeon_search_troops.keys(),i=0;i<keys.length;i++)if(keys[i]==troops_num){cost=user_event_dungeon_search_troops.at(keys[i]).cost;break}return cost},getEventDungeonSearchTroopsGeneralCount:function(troops_num){var count=0,troops_list=NetService().get_User_Event_Dungeon_Search_Troops_Generals(troops_num);null==troops_list&&(troops_list=[]);for(var t=0;t<troops_list.length;t++)count++;return count},isExistGeneralInEventDungeonSearchTroops:function(troops_num,gnrl_num){if(null==gnrl_num){for(var keys=(troops_list=NetService().get_User_Event_Dungeon_Search_Troops_Generals()).keys(),t_idx=0;t_idx<keys.length;t_idx++)for(var troops=troops_list.at(keys[t_idx]),g_idx=0;g_idx<troops.length;g_idx++){if(troops[g_idx].gnrl_num==gnrl_num)return!0}return!1}for(var is_exist=!1,troops_list=NetService().get_User_Event_Dungeon_Search_Troops_Generals(troops_num),i=0;i<troops_list.length;i++){if(troops_list[i].gnrl_num==gnrl_num){is_exist=!0;break}}return is_exist},isExistGeneralInEventDungeonSearchPosType:function(troops_num,pos_type){for(var is_exist=!1,troops_list=NetService().get_User_Event_Dungeon_Search_Troops_Generals(troops_num),i=0;i<troops_list.length;i++){if(troops_list[i].position==pos_type){is_exist=!0;break}}return is_exist},isSameGeneralInEventDungeonSearchTroops:function(troops_num,position,troops){for(var is_exist=!1,troops_list=(MasterManager.getInstance().get_General(troops.gnrl_id),NetService().get_User_Event_Dungeon_Search_Troops_Generals(troops_num)),selectGnrlId=troops.gnrl_id%1e3,i=position=0;i<troops_list.length;i++){var g=troops_list[i];selectGnrlId==g.gnrl_id%1e3&&troops.gnrl_num!=g.gnrl_num&&(position=g.position,is_exist=!0)}return{result:is_exist,pos:position}},isSameGeneraEventDungeonSearchOtherTroops:function(troops){for(var is_exist=!1,troops_list=(MasterManager.getInstance().get_General(troops.gnrl_id),NetService().get_User_Event_Dungeon_Search_Troops_Generals("list")),t_idx=0;t_idx<troops_list.length;t_idx++){var g=troops_list[t_idx];if(troops.troops_num!=g.troops_num&&troops.gnrl_num==g.gnrl_num){is_exist=!0;break}}return is_exist},checkEventDungeonSearchTroopsPosition:function(troops){for(var is_curr_pos=!1,troops_list=NetService().get_User_Event_Dungeon_Search_Troops_Generals(troops.troops_num),i=0;i<troops_list.length;i++){var g=troops_list[i];if(g.gnrl_num==troops.gnrl_num&&g.position==troops.pos_type){is_curr_pos=!0;break}}return is_curr_pos},isCostOver:function(gnrl_troops,troops_num){for(var isOver=!1,totalCost=this.getEventDungeonSearchTroopsTotalCost(troops_num),cost=0,m=MasterManager.getInstance(),troops_list=NetService().get_User_Event_Dungeon_Search_Troops_Generals(troops_num),i=0;i<troops_list.length;i++){var g=troops_list[i];if(g.position!=gnrl_troops.pos_type&&g.gnrl_num!=gnrl_troops.gnrl_num)cost+=m.get_General(g.gnrl_id).cost}return totalCost<(cost+=m.get_General(gnrl_troops.gnrl_id).cost)&&(isOver=!0),isOver},getUerEventDungeonSearchTroopsGeneral:function(troops_num,pos_type){for(var troops_list=NetService().get_User_Event_Dungeon_Search_Troops_Generals(troops_num),troops={},i=0;i<troops_list.length;i++){var g=troops_list[i];g.position==pos_type&&(troops.gnrl_id=g.gnrl_id,troops.gnrl_num=g.gnrl_num,troops.pos_type=g.position,troops.troops_num=g.troops_num,troops.is_leader="y"==g.leader_yn)}return troops},getEventDungeonSearchTroopsTotalAttkPwr:function(troops_num){GeneralService.getInstance();var troops_list=NetService().get_User_Event_Dungeon_Search_Troops_Generals(troops_num);null==troops_list&&(troops_list=[]);for(var total_attk_pwr=0,i=0;i<troops_list.length;i++){var g=troops_list[i];total_attk_pwr+=this.getEventDungeonSearchGeneralTotalAttkPwr(g.gnrl_id,g.gnrl_num)}return total_attk_pwr},addComboStatValueForEquipment:function(info,combo_stat_type,stat_value){switch(combo_stat_type){case COMBO_STAT_ATTK_PLUS:return stat_value;case COMBO_STAT_ATTK:return info.attk*(stat_value/1e4);case COMBO_STAT_DEF_PLUS:return stat_value;case COMBO_STAT_DEF:return info.def*(stat_value/1e4);case COMBO_STAT_HP_PLUS:return stat_value;case COMBO_STAT_HP:return info.hp*(stat_value/1e4);case 0:return 0}return 0},getEventDungeonSearchGeneralTotalAttkPwr:function(gnrl_id,gnrl_num){var mt=MasterManager.getInstance(),total_attk_pwr=0,key=new db.UserGeneralKey;key.gnrl_id=gnrl_id,key.gnrl_num=gnrl_num;var info=new db.UserGeneralInfo;GeneralService.getInstance().getUserGeneralInfo(key,info),total_attk_pwr+=info.attk,total_attk_pwr+=info.def,total_attk_pwr+=info.hp;var g=mt.get_General(gnrl_id),loveStat=MasterTable.getInstance().get_LoveStatItem(g.love_stat_group,info.love_level);loveStat.stat_type_1==LOVE_STAT_TYPE_ATTK_PRCNT&&(total_attk_pwr+=info.attk*(loveStat.value_1/100)),loveStat.stat_type_2==LOVE_STAT_TYPE_ATTK_PRCNT&&(total_attk_pwr+=info.attk*(loveStat.value_2/100)),loveStat.stat_type_3==LOVE_STAT_TYPE_ATTK_PRCNT&&(total_attk_pwr+=info.attk*(loveStat.value_3/100)),loveStat.stat_type_1==LOVE_STAT_TYPE_ATTK_INC&&(total_attk_pwr+=loveStat.value_1),loveStat.stat_type_2==LOVE_STAT_TYPE_ATTK_INC&&(total_attk_pwr+=loveStat.value_2),loveStat.stat_type_2==LOVE_STAT_TYPE_ATTK_INC&&(total_attk_pwr+=loveStat.value_3),loveStat.stat_type_1==LOVE_STAT_TYPE_DEF_PRCNT&&(total_attk_pwr+=info.def*(loveStat.value_1/100)),loveStat.stat_type_2==LOVE_STAT_TYPE_DEF_PRCNT&&(total_attk_pwr+=info.def*(loveStat.value_2/100)),loveStat.stat_type_3==LOVE_STAT_TYPE_DEF_PRCNT&&(total_attk_pwr+=info.def*(loveStat.value_3/100)),loveStat.stat_type_1==LOVE_STAT_TYPE_DEF_INC&&(total_attk_pwr+=loveStat.value_1),loveStat.stat_type_2==LOVE_STAT_TYPE_DEF_INC&&(total_attk_pwr+=loveStat.value_2),loveStat.stat_type_3==LOVE_STAT_TYPE_DEF_INC&&(total_attk_pwr+=loveStat.value_3),loveStat.stat_type_1==LOVE_STAT_TYPE_HP_PRCNT&&(total_attk_pwr+=info.hp*(loveStat.value_1/100)),loveStat.stat_type_2==LOVE_STAT_TYPE_HP_PRCNT&&(total_attk_pwr+=info.hp*(loveStat.value_2/100)),loveStat.stat_type_3==LOVE_STAT_TYPE_HP_PRCNT&&(total_attk_pwr+=info.hp*(loveStat.value_3/100)),loveStat.stat_type_1==LOVE_STAT_TYPE_HP_INC&&(total_attk_pwr+=loveStat.value_1),loveStat.stat_type_2==LOVE_STAT_TYPE_HP_INC&&(total_attk_pwr+=loveStat.value_2),loveStat.stat_type_3==LOVE_STAT_TYPE_HP_INC&&(total_attk_pwr+=loveStat.value_3);var user_branch_ability=CampService.getInstance().getUserCampBranchAbility(info.arm_service_type);1==CAMP_LOVE_STAT_TYPE?(total_attk_pwr+=info.attk*(user_branch_ability.attack/1e4),total_attk_pwr+=info.def*(user_branch_ability.defense/1e4),total_attk_pwr+=info.hp*(user_branch_ability.health/1e4)):(total_attk_pwr+=user_branch_ability.attack,total_attk_pwr+=user_branch_ability.defense,total_attk_pwr+=user_branch_ability.health);for(var set_effect_info=new Map,es=EquipmentService.getInstance(),equip_info_list=es.getUserGeneralEquipmentListInfo(key),idx=0;idx<equip_info_list.length;idx++){var equip=equip_info_list[idx],equip_key={},user_equip_info={};equip_key.equipment_item_idx=equip.equip_id,equip_key.equipment_num=equip.equip_num;es.getUserEquipmentInfo(equip_key,user_equip_info,{}),total_attk_pwr+=this.addComboStatValueForEquipment(info,user_equip_info.combo_stat,user_equip_info.stat_value);var equip_option_info=mt.get_EquipmentItemOption(user_equip_info.option_id1,user_equip_info.option_num1);if(0==equip_option_info.wear_element_type||info.element_type==equip_option_info.wear_element_type){var equip_option_level_info=mt.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);total_attk_pwr+=this.addComboStatValueForEquipment(info,equip_option_level_info.combo_stat,equip_option_level_info.stat_value),total_attk_pwr+=this.addComboStatValueForEquipment(info,equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2)}if(0==(equip_option_info=mt.get_EquipmentItemOption(user_equip_info.option_id2,user_equip_info.option_num2)).wear_element_type||info.element_type==equip_option_info.wear_element_type){equip_option_level_info=mt.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);total_attk_pwr+=this.addComboStatValueForEquipment(info,equip_option_level_info.combo_stat,equip_option_level_info.stat_value),total_attk_pwr+=this.addComboStatValueForEquipment(info,equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2)}if(0==(equip_option_info=mt.get_EquipmentItemOption(user_equip_info.option_id3,user_equip_info.option_num3)).wear_element_type||info.element_type==equip_option_info.wear_element_type){equip_option_level_info=mt.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);total_attk_pwr+=this.addComboStatValueForEquipment(info,equip_option_level_info.combo_stat,equip_option_level_info.stat_value),total_attk_pwr+=this.addComboStatValueForEquipment(info,equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2)}if(0==(equip_option_info=mt.get_EquipmentItemOption(user_equip_info.option_id4,user_equip_info.option_num4)).wear_element_type||info.element_type==equip_option_info.wear_element_type){equip_option_level_info=mt.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);total_attk_pwr+=this.addComboStatValueForEquipment(info,equip_option_level_info.combo_stat,equip_option_level_info.stat_value),total_attk_pwr+=this.addComboStatValueForEquipment(info,equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2)}if(0==(equip_option_info=mt.get_EquipmentItemOption(user_equip_info.option_id5,user_equip_info.option_num5)).wear_element_type||info.element_type==equip_option_info.wear_element_type){equip_option_level_info=mt.get_EquipmentItemOptionLevel(equip_option_info.level_idx,user_equip_info.level);total_attk_pwr+=this.addComboStatValueForEquipment(info,equip_option_level_info.combo_stat,equip_option_level_info.stat_value),total_attk_pwr+=this.addComboStatValueForEquipment(info,equip_option_level_info.combo_stat_2,equip_option_level_info.stat_value_2)}if(0<user_equip_info.equip_group)null==(set_count=set_effect_info.at(user_equip_info.equip_group))&&(set_count={count:0},set_effect_info.insert(user_equip_info.equip_group,set_count)),set_effect_info.insert(user_equip_info.equip_group,set_count),set_count.count=set_count.count+1}var keys=set_effect_info.keys();for(idx=0;idx<keys.length;idx++){for(var mt_set_effect={equip_count:0,combo_stat:0,added_value:0},set_count=set_effect_info.at(keys[idx]).count;null==(mt_set_effect=MasterManager.getInstance().get_EquipmentGroup(parseInt(keys[idx]),set_count)).equip_count&&(mt_set_effect={equip_count:0,combo_stat:0,added_value:0}),0==mt_set_effect.equip_count&&0<set_count--;);total_attk_pwr+=this.addComboStatValueForEquipment(info,mt_set_effect.combo_stat,mt_set_effect.added_value)}return total_attk_pwr},getEventDungeonSearchAreaGreatSuccesRate:function(event_dungeon_group_idx,search_area_idx,event_dungeon_point){MasterManager.getInstance();for(var list=MasterTable.getInstance().get_EventDungeonSearchAreaList(event_dungeon_group_idx),great_success_max_rate=0,max_price_value=0,i=0;i<list.length;i++){var l=list[i];if(l.event_dungeon_group_idx==event_dungeon_group_idx&&l.search_area_idx==search_area_idx){l.great_success_base_rate,great_success_max_rate=l.great_success_max_rate,max_price_value=l.max_price_value;break}}return event_dungeon_point*(great_success_max_rate/max_price_value/100)},getUserEventDungeonSearchTroopsAutoPairingGeneralList:function(event_dungeon_group_idx,troops_num,troops_list){var mt=MasterManager.getInstance(),list=[];GeneralService.getInstance().getUserGeneralInfoList(list);for(var user_event_dungeon_search_troops_general=NetService().get_User_Event_Dungeon_Search_Troops_Generals(),troops_general_keys=[],keys=user_event_dungeon_search_troops_general.keys(),t_idx=0;t_idx<keys.length;t_idx++){var tg=user_event_dungeon_search_troops_general.at(keys[t_idx]);if(keys[t_idx]!=troops_num)for(var i=0;i<tg.length;i++){var key=new db.UserGeneralKey;key.gnrl_id=tg[i].gnrl_id,key.gnrl_num=tg[i].gnrl_num,troops_general_keys.push_back(key)}}list.sort(function(l,r){return r.total_attk_pwr-l.total_attk_pwr});for(var position=1,g_idx=0;g_idx<list.length;g_idx++){var g=list[g_idx];if(g.gnrl_type<=GENERAL_TYPE_SOLDIER){if(5<position)break;if(g.using_in_camp)continue;for(var is_exist=!1,tg_idx=0;tg_idx<troops_general_keys.length;tg_idx++){if((tg=troops_general_keys[tg_idx]).gnrl_id==g.gnrl_id&&tg.gnrl_num==tg.gnrl_num){is_exist=!0;break}}if(is_exist)continue;for(var j_idx=0;j_idx<troops_list.length;j_idx++){var j=troops_list[j_idx];if(mt.get_General(j.gnrl_id).gnrl_group==g.gnrl_group){is_exist=!0;break}}if(is_exist)continue;var t={};t.gnrl_id=g.gnrl_id,t.gnrl_num=g.gnrl_num,t.position=position,t.troops_num=troops_num,t.leader_yn=1==position?"y":"n",troops_list.push_back(t),position++}}},removeMaterialGnrlCheck:function(gnrls){for(var delete_list=[],g_idx=0;g_idx<gnrls.length;g_idx++){var g=gnrls[g_idx];1!=g.gnrl_type&&3!=g.gnrl_type&&delete_list.push_back(g),g.using_in_camp&&delete_list.push_back(g)}if(0<delete_list.size())for(var i=0;i<delete_list.size();i++){var del=delete_list.at(i),found=gnrls.findIndex(function(info){return info.gnrl_id==del.gnrl_id&&info.gnrl_num==del.gnrl_num});-1!=found&&gnrls.splice(found,1)}},checkEventDungeonBattleGeneralInSearchTroops:function(event_dungeon_period_idx,troops_num){for(var troops=GeneralService.getInstance().getUserTroopsGeneralList(troops_num),user_event_dungeon_search_troops_general=NetService().get_User_Event_Dungeon_Search_Troops_Generals(),troops_general_keys=[],keys=user_event_dungeon_search_troops_general.keys(),tg_idx=0;tg_idx<keys.length;tg_idx++){var tg=user_event_dungeon_search_troops_general.at(keys[tg_idx]);null==tg&&(tg=[]);for(var i_idx=0;i_idx<tg.length;i_idx++){var i=tg[i_idx],key={};key.gnrl_id=i.gnrl_id,key.gnrl_num=i.gnrl_num,troops_general_keys.push_back(key)}}for(var t_idx=0;t_idx<troops_general_keys.length;t_idx++)for(i=0;i<troops.length;i++){var g=troops[i];if(troops_general_keys[t_idx].gnrl_num==g.gnrl_num)return!0}return!1},isExistEventDUngeonSearchResult:function(event_dungeon_group_idx){for(var user_event_dungeon_search_area_info=NetService().get_User_Event_Dungeon_Search_Area_Info(),now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),nn=moment(now).valueOf(),keys=user_event_dungeon_search_area_info.keys(),idx=0;idx<keys.length;idx++){var a=user_event_dungeon_search_area_info.at(keys[idx]);if(a.event_dungeon_period_idx==event_dungeon_group_idx)if(moment(a.end_dt,["MM-DD-YYYY hh:mm:ss a"]).valueOf()-nn<=0)return!0}return!1},getUserEventDungeonChristmasReward:function(event_dungeon_group_idx,list){for(var m=MasterManager.getInstance(),christmas_info=NetService().get_User_Event_Dungeon_Christmas_Info(),reward_info_list=MasterTable.getInstance().get_EventDungeonPersonalPointInfoList(event_dungeon_group_idx),idx=0;idx<reward_info_list.length;idx++){var reward_info=reward_info_list[idx],item=new db.UserEventDungeonChristmasPersonalPointBonusLog,bonus_info=m.get_EventDungeonPersonalPointBonus(event_dungeon_group_idx,reward_info.step);if(item.event_dungeon_group_idx=reward_info.event_dungeon_group_idx,item.step=reward_info.step,item.accum_point=reward_info.accm_point,item.bonus_type=bonus_info.bonus_type,item.min_value=bonus_info.min_value,item.max_value=bonus_info.max_value,item.is_opened=christmas_info.accum_count>=reward_info.accm_point,1==item.is_opened){for(var is_rewarded=!1,jdx=0;jdx<christmas_info.user_event_dungeon_personal_point_reward.length;jdx++){var user_reward=christmas_info.user_event_dungeon_personal_point_reward[jdx];user_reward.event_dungeon_group_idx==reward_info.event_dungeon_group_idx&&user_reward.step==reward_info.step&&(is_rewarded="y"==user_reward.rewarded_yn)}item.is_rewarded=is_rewarded}else item.is_rewarded=!1;list.push_back(item)}},getEventDungeonVoteLeagueInfoList:function(event_dungeon_group_idx,list){for(var info_list=MasterTable.getInstance().get_EventDungeonVoteLeagueInfoList(),first_period_idx=this.getEventDungeonFirstHalfPeriodIdx(event_dungeon_group_idx),second_period_idx=this.getEventDungeonSecondHalfPeriodIdx(event_dungeon_group_idx),i=0;i<info_list.length;i++){var info=info_list[i];if(info.event_dungeon_period_idx==first_period_idx||info.event_dungeon_period_idx==second_period_idx){var league_info=list.at(info.league_group_idx);if(null==league_info){var info_array=[];info_array.push(info),list.insert(info.league_group_idx,info_array)}else league_info.push(info)}}},isEndEventDungeonVoteLeague:function(league_period_idx){var period=MasterManager.getInstance().get_EventDungeonVoteLeaguePeriod(league_period_idx),now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf();moment(period.beg_dt).valueOf();return moment(period.end_dt).valueOf()<n},isOpenEventDungeonVoteLeague:function(league_period_idx){var period=MasterManager.getInstance().get_EventDungeonVoteLeaguePeriod(league_period_idx),now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),b=moment(period.beg_dt).valueOf(),e=moment(period.end_dt).valueOf();return b<=n&&n<=e},getCurrentEventDungeonVoteLeagueGroupIdx:function(){var m=MasterTable.getInstance(),period_list=m.get_EventDungeonVoteLeaguePeriodList(),now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),current_period_idx=0;period_list.some(function(period){var b=moment(period.beg_dt).valueOf(),e=moment(period.end_dt).valueOf();if(b<n&&n<e)return current_period_idx=period.vote_league_period_idx,!0});var league_list=m.get_EventDungeonVoteLeagueInfoList(),found=league_list.findIndex(function(l){return l.vote_league_period_idx==current_period_idx});if(-1!=found)var league_info=league_list[found];else league_info={league_group_idx:0};return league_info.league_group_idx},getEventDungeonLastVoteLeagueGroupIdx:function(event_dungeon_group_idx){var league_group=MasterManager.getInstance().get_All_EventDungeonVoteLeagueInfo().filter(function(league){if(league.event_dungeon_group_idx==event_dungeon_group_idx)return!0});return league_group.sort(function(l,r){return l.league_group_idx-r.league_group_idx}),league_group[league_group.length-1].league_group_idx},getEventDungeonFirstVoteLeagueGroupIdx:function(event_dungeon_group_idx){var league_group=MasterManager.getInstance().get_All_EventDungeonVoteLeagueInfo().filter(function(league){if(league.event_dungeon_group_idx==event_dungeon_group_idx)return!0});return league_group.sort(function(l,r){return l.league_group_idx-r.league_group_idx}),league_group[0].league_group_idx},getEventDungeonVoteLeaguePeriodDateTime:function(event_dungeon_period_idx,league_group_idx){var m=MasterTable.getInstance(),period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),first_event_period_idx=this.getEventDungeonFirstHalfPeriodIdx(period.event_dungeon_group_idx),second_event_period_idx=this.getEventDungeonSecondHalfPeriodIdx(period.event_dungeon_group_idx),league_list=m.get_EventDungeonVoteLeagueInfoList(period.event_dungeon_period_idx,league_group_idx);league_list.empty()&&(league_list=first_event_period_idx==event_dungeon_period_idx?m.get_EventDungeonVoteLeagueInfoList(second_event_period_idx,league_group_idx):m.get_EventDungeonVoteLeagueInfoList(first_event_period_idx,league_group_idx));var league_info=league_list.at(0);if(null==league_info)return"";var vote_league_period_idx=league_info.vote_league_period_idx,first_idx=this.getEventDungeonFirstVoteLeagueGroupIdx(period.event_dungeon_group_idx),last_idx=this.getEventDungeonLastVoteLeagueGroupIdx(period.event_dungeon_group_idx),league_period=MasterManager.getInstance().get_EventDungeonVoteLeaguePeriod(vote_league_period_idx),begin_date=moment(league_period.beg_dt),end_date=moment(league_period.end_dt),beg_month=(begin_date.year(),leadingZeros(begin_date.month()+1,2)),beg_day=leadingZeros(begin_date.date(),2),beg_hour=leadingZeros(begin_date.hours(),2),beg_minute=leadingZeros(begin_date.minutes(),2),end_month=(leadingZeros(begin_date.seconds(),2),end_date.year(),leadingZeros(end_date.month()+1,2)),end_day=leadingZeros(end_date.date(),2),end_hour=leadingZeros(end_date.hours(),2),end_minute=leadingZeros(end_date.minutes(),2);leadingZeros(end_date.seconds(),2);return league_info.league_group_idx==first_idx?cmString(res_str("label_event_dungeon_vote_league_period_dt_1"),beg_month,beg_day,end_month,end_day,end_hour,end_minute):league_info.league_group_idx==last_idx?cmString(res_str("label_event_dungeon_vote_league_period_dt_3"),beg_month,beg_day,beg_hour,beg_minute,end_month,end_day):cmString(res_str("label_event_dungeon_vote_league_period_dt_2"),beg_month,beg_day,beg_hour,beg_minute,end_month,end_day,end_hour,end_minute)},getUserEventDungeonUsePointReward:function(event_dungeon_point_period_idx,list){for(var reward_list=MasterTable.getInstance().get_EventDungeonVoteLeagueUsePointRewardList(event_dungeon_point_period_idx),i=0;i<reward_list.length;i++){var r=reward_list.at(i),item=new db.UserEventDungeonUsePointReward;item.event_dungeon_reward_idx=r.reward_idx,item.event_dungeon_period_idx=event_dungeon_point_period_idx,item.reward=r,list.push_back(item)}EventDungeonTable.getInstance().sel_UserEventDungeonUsePointReward(m_user_id,list)},getUserEventDungeonUsePoint:function(event_dungeon_point_period_idx){var point=0;return NetService().get_User_Event_Dungeon_Vote_League_Record().forEach(function(info){info.event_dungeon_period_idx==event_dungeon_point_period_idx&&(point+=info.vote_cnt)}),point},setEventDungeonVoteLeaguePrevRankingLeagueIdx:function(league_group_idx){m_event_dungeon_vote_prev_ranking_league_group_idx=league_group_idx},getEventDungeonVoteLeaguePrevRankingLeagueIdx:function(){return m_event_dungeon_vote_prev_ranking_league_group_idx},getUserEventDungeonVoteLeagueReward:function(event_dungeon_period_idx,league_group_idx,list){var m=MasterTable.getInstance(),period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),reward_list=m.get_EventDungeonVoteLeagueRewardList(event_dungeon_period_idx),first_event_period_idx=this.getEventDungeonFirstHalfPeriodIdx(period.event_dungeon_group_idx),second_event_period_idx=this.getEventDungeonSecondHalfPeriodIdx(period.event_dungeon_group_idx),record_list=NetService().get_User_Event_Dungeon_Vote_League_Record();reward_list.forEach(function(r){if((r.event_dungeon_period_idx==first_event_period_idx||r.event_dungeon_period_idx==second_event_period_idx)&&r.league_tab_type==league_group_idx){var item=new db.UserEventDungeonVoteLeagueReward;item.league_reward_idx=r.league_reward_idx,item.league_group_idx=r.league_tab_type,item.reward=r,record_list.forEach(function(l){r.league_idx==l.league_idx&&(item.user_use_event_dungeon_point+=l.vote_cnt)});var period=MasterManager.getInstance().get_EventDungeonPeriod(r.event_dungeon_period_idx);item.event_dungeon_group_idx=period.event_dungeon_group_idx,list.push_back(item)}}),EventDungeonTable.getInstance().sel_UserEventDungeonVoteLeagueReward(m_user_id,list)},getUserEventDungeonVoteLeagueReward2:function(list){var m=MasterTable.getInstance(),event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),reward_list=m.get_EventDungeonVoteLeagueRewardList(period.event_dungeon_group_idx),record_list=NetService().get_User_Event_Dungeon_Vote_League_Record();reward_list.forEach(function(r){var item=new db.UserEventDungeonVoteLeagueReward;item.league_reward_idx=r.league_reward_idx,item.league_group_idx=r.league_tab_type,item.reward=r,record_list.forEach(function(l){r.league_idx==l.league_idx&&(item.user_use_event_dungeon_point+=l.vote_cnt)});var period=MasterManager.getInstance().get_EventDungeonPeriod(r.event_dungeon_period_idx);item.event_dungeon_group_idx=period.event_dungeon_group_idx,list.push_back(item)}),EventDungeonTable.getInstance().sel_UserEventDungeonVoteLeagueReward(m_user_id,list)},getEventDungeonVoteLeagueFirstGroupIdx:function(event_dungeon_group_idx){var list=MasterManager.getInstance().get_All_EventDungeonVoteLeagueInfo().filter(function(obj){if(obj.event_dungeon_group_idx==event_dungeon_group_idx)return!0});return list.sort(function(r,l){return r.league_group_idx-l.league_group_idx}),list[0].league_group_idx},getEventDungeonPointUnitType:function(event_dungeon_group_idx,unit_types){MasterTable.getInstance().get_EventDungeonPeriodList().forEach(function(period){if(this.IsOpenDungeon(period.event_dungeon_period_idx)){var unit_type=MasterManager.getInstance().get_EventPointUnitType(period.event_point_unit_type);-1==unit_types.findIndex(function(m){return m.event_point_unit_type==period.event_point_unit_type})&&unit_types.push_back(unit_type)}}.bind(this))},isNewUserEventDungeonUsePointReward:function(event_dungeon_group_idx){var mt=MasterManager.getInstance(),first_period_idx=this.getEventDungeonFirstHalfPeriodIdx(event_dungeon_group_idx),second_period_idx=this.getEventDungeonSecondHalfPeriodIdx(event_dungeon_group_idx),first_point_period_idx=mt.get_EventDungeonPeriod(first_period_idx).event_dungeon_point_period_idx,second_point_period_idx=mt.get_EventDungeonPeriod(second_period_idx).event_dungeon_point_period_idx,reward_list=[];this.getUserEventDungeonUsePointReward(first_point_period_idx,reward_list);for(var user_use_point=this.getUserEventDungeonUsePoint(first_point_period_idx),idx=0;idx<reward_list.length;idx++){if(!(r=reward_list[idx]).is_rewarded_yn&&r.reward.accm_point<=user_use_point)return!0}if(first_point_period_idx!=second_point_period_idx){reward_list.clear(),this.getUserEventDungeonUsePointReward(second_point_period_idx,reward_list),user_use_point=this.getUserEventDungeonUsePoint(second_point_period_idx);for(idx=0;idx<reward_list.length;idx++){var r;if(!(r=reward_list[idx]).is_rewarded_yn&&r.reward.accm_point<=user_use_point)return!0}}return!1},getEventDungeonBoardRewardTypeList:function(event_dungeon_group_idx,board_reward_type_list){MasterTable.getInstance().get_EventDungeonRewardBoardInfo(event_dungeon_group_idx).forEach(function(info){-1==board_reward_type_list.findIndex(function(r){return info.board_reward_type==r})&&board_reward_type_list.push_back(info.board_reward_type)})},IsExistPrevEventDungeon:function(event_dungeon_group_idx){var m=MasterManager.getInstance(),period=m.get_EventDungeonPeriod(event_dungeon_group_idx),prev_eveunt_dungeon_group_idx=period.prev_event_dungeon_group_idx;if(prev_eveunt_dungeon_group_idx<=0)return!1;period=m.get_EventDungeonPeriod(prev_eveunt_dungeon_group_idx);var n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),b=moment(period.event_dungeon_point_beg_dt).valueOf(),e=moment(period.event_dungeon_point_end_dt).valueOf();return b<=n&&n<=e},getFirstEventDungeonPeriodIdx:function(){var period_idx=0,open_period_list=MasterTable.getInstance().get_EventDungeonPeriodOpenInfoList();return 0==open_period_list.length?period_idx:period_idx=open_period_list.front().event_dungeon_period_idx},getSecondEventDungeonPeriodIdx:function(){var period_idx=0,open_period_list=MasterTable.getInstance().get_EventDungeonPeriodOpenInfoList();return open_period_list.length<2?period_idx:period_idx=open_period_list[open_period_list.length-1].event_dungeon_period_idx},getUserEventDungeonAchvList:function(event_dungeon_period_idx){var achv_list=[],master_achv_list=(MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),MasterTable.getInstance().get_EventDungeonAchievementList(event_dungeon_period_idx)),list=NetService().get_User_Evevt_Dungeon_Achv_List(),user_achv_list=[];null!=list&&null!=list.achv_list&&0<list.achv_list.length&&(user_achv_list=list.achv_list);for(var seq_achv_list=[],user_achv={},i=0;i<master_achv_list.length;i++){var ma=master_achv_list[i];if(0==ma.serial_achv_type)for(var idx=0;idx<user_achv_list.length;idx++){var is_exist=!1,index=0;if(ma.event_dungeon_period_idx==user_achv_list[idx].event_dungeon_period_idx&&ma.event_dungeon_achv_list_idx==user_achv_list[idx].event_dungeon_achv_list_idx){is_exist=!0,index=idx;break}if(is_exist){var ua=user_achv_list[idx];user_achv.event_dungeon_achv_list_idx=ma.event_dungeon_achv_list_idx,user_achv.event_dungeon_period_idx=ma.event_dungeon_period_idx,user_achv.event_achv=ma,user_achv.achv=MasterManager.getInstance().get_EventDungeonAchvList(ma.event_dungeon_achv_list_idx),user_achv.rewards=MasterTable.getInstance().get_EventDungeonAchievementBonusList(user_achv.achv.bonus_idx),user_achv.complete_count=ua.complete_count,user_achv.is_bonus_complete="y"==ua.bonus_complete_yn,user_achv.is_complete="y"==ua.complete_yn,user_achv.is_new="y"==ua.new_yn,achv_list.push($.extend({},user_achv))}else user_achv.event_dungeon_achv_list_idx=ma.event_dungeon_achv_list_idx,user_achv.event_dungeon_period_idx=ma.event_dungeon_period_idx,user_achv.event_achv=ma,user_achv.achv=MasterManager.getInstance().get_EventDungeonAchvList(ma.event_dungeon_achv_list_idx),user_achv.rewards=MasterTable.getInstance().get_EventDungeonAchievementBonusList(user_achv.achv.bonus_idx),user_achv.complete_count=0,user_achv.is_bonus_complete=!1,user_achv.is_complete=!1,user_achv.is_new=!1,achv_list.push($.extend({},user_achv))}else{seq_achv_list=MasterTable.getInstance().get_EventDungeonSeqAchvList(ma.event_dungeon_achv_list_idx);is_exist=!1;for(var bonus_complete_count=0,k=0;k<seq_achv_list.length;k++){for(var seq=seq_achv_list[k],found=!1,kdx=(index=0,0);kdx<user_achv_list.length;kdx++)if(event_dungeon_period_idx==user_achv_list[kdx].event_dungeon_period_idx&&seq.event_dungeon_achv_list_idx==user_achv_list[kdx].event_dungeon_achv_list_idx){found=!0,index=kdx;break}if(found){if("y"!=(ua=user_achv_list[index]).complete_yn){is_exist=!0,user_achv.event_dungeon_achv_list_idx=seq.event_dungeon_achv_list_idx,user_achv.event_dungeon_period_idx=ma.event_dungeon_period_idx,user_achv.event_achv=ma,user_achv.achv=seq,user_achv.rewards=MasterTable.getInstance().get_EventDungeonAchievementBonusList(user_achv.achv.bonus_idx),user_achv.complete_count=ua.complete_count,user_achv.is_bonus_complete="y"==ua.bonus_complete_yn,user_achv.is_complete="y"==ua.complete_yn,user_achv.is_new="y"==ua.new_yn,achv_list.push($.extend({},user_achv));break}if("n"==ua.bonus_complete_yn){is_exist=!0,user_achv.event_dungeon_achv_list_idx=seq.event_dungeon_achv_list_idx,user_achv.event_dungeon_period_idx=ma.event_dungeon_period_idx,user_achv.event_achv=ma,user_achv.achv=seq,user_achv.rewards=MasterTable.getInstance().get_EventDungeonAchievementBonusList(user_achv.achv.bonus_idx),user_achv.complete_count=ua.complete_count,user_achv.is_bonus_complete="y"==ua.bonus_complete_yn,user_achv.is_complete="y"==ua.complete_yn,user_achv.is_new="y"==ua.new_yn,achv_list.push($.extend({},user_achv));break}bonus_complete_count++}}if(!is_exist)if(bonus_complete_count==seq_achv_list.length){var last_achv=seq_achv_list[seq_achv_list.length-1];user_achv.event_dungeon_achv_list_idx=last_achv.event_dungeon_achv_list_idx,user_achv.event_dungeon_period_idx=ma.event_dungeon_period_idx,user_achv.event_achv=ma,user_achv.achv=last_achv,user_achv.rewards=MasterTable.getInstance().get_EventDungeonAchievementBonusList(user_achv.achv.bonus_idx),user_achv.complete_count=last_achv.complete_count,user_achv.is_bonus_complete=!0,user_achv.is_complete=!0,user_achv.is_new=!1,achv_list.push($.extend({},user_achv))}else{var first_achv=seq_achv_list[0];user_achv.event_dungeon_achv_list_idx=first_achv.event_dungeon_achv_list_idx,user_achv.event_dungeon_period_idx=ma.event_dungeon_period_idx,user_achv.event_achv=ma,user_achv.achv=first_achv,user_achv.rewards=MasterTable.getInstance().get_EventDungeonAchievementBonusList(user_achv.achv.bonus_idx),user_achv.complete_count=0,user_achv.is_bonus_complete=!1,user_achv.is_complete=!1,user_achv.is_new=!1,achv_list.push($.extend({},user_achv))}}}return achv_list=stable(achv_list,function(l,r){return l.is_complete<r.is_complete}),achv_list=stable(achv_list,function(l,r){return l.is_bonus_complete>r.is_bonus_complete})},IsEnableGainEventDungeonAchvReward:function(event_dungeon_period_idx){var is_enable=!1,list=NetService().get_User_Evevt_Dungeon_Achv_List();if(null!=list&&null!=list.achv_list&&0<list.achv_list.length)for(var user_achv_list=NetService().get_User_Evevt_Dungeon_Achv_List().achv_list,i=0;i<user_achv_list.length;i++)if(user_achv_list[i].event_dungeon_period_idx==event_dungeon_period_idx&&"y"==user_achv_list[i].complete_yn&&"n"==user_achv_list[i].bonus_complete_yn){is_enable=!0;break}return is_enable}}}return{getInstance:function(){return void 0===instance&&(instance=new EventDungeonService),instance}}}();var MailService,RaidBossService,PurchaseLog=cc.Class.extend({purchase_log_id:0,action:0,shop_id:0,payload:"",payment_id:"",message:"",create_dt:""});MailService=function(){function MailService(){return{getUserMail:function(){for(var masterTable=MasterManager.getInstance(),user_mails=NetService().getUsermail(),newlist=[],malis_length=user_mails.length,i=0;i<malis_length;i++){var mail={};mail.mail_type=user_mails.at(i).mail_type,mail.num=user_mails.at(i).mail_num,mail.bonus_type=user_mails.at(i).bonus_type,mail.count=user_mails.at(i).count,mail.new_yn=user_mails.at(i).new_yn,mail.complete_yn=user_mails.at(i).complete_yn,mail.period_type=user_mails.at(i).period_type,mail.remain_second=user_mails.at(i).remain,mail.key_id=user_mails.at(i).key_id,mail.comment=user_mails.at(i).comment,mail.end_dt=user_mails.at(i).end_dt;var mailType=masterTable.get_MailType(mail.mail_type);if(user_mails.at(i).mail_type_name=mailType.name,mail.bonus_type==BONUS_TYPE_ILLUSTRATE_TICKET)user_mails.at(i).bonus_type_name=MasterTable.getInstance().get_IllustGroupName(mail.key_id);else{var bonusType=masterTable.get_BonusType(mail.bonus_type);user_mails.at(i).bonus_type_name=bonusType.name}newlist.push($.extend({},user_mails.at(i)))}return newlist},checkAndAddRewardList:function(user_mails,list){for(var masterTable=MasterManager.getInstance(),mails_length=user_mails.length,i=0;i<mails_length;i++){var item={};item.mail_type=user_mails.at(i).mail_type,item.num=user_mails.at(i).mail_num,item.bonus_type=user_mails.at(i).bonus_type,item.count=user_mails.at(i).count,item.new_yn=user_mails.at(i).new_yn,item.complete_yn=user_mails.at(i).complete_yn,item.period_type=user_mails.at(i).period_type,item.remain_second=user_mails.at(i).remain,item.key_id=user_mails.at(i).key_id,item.comment=user_mails.at(i).comment;var mailType=masterTable.get_MailType(item.mail_type);item.mail_type_name=mailType.name;var bonusType=masterTable.get_BonusType(item.bonus_type);item.bonus_type_name=bonusType.name,(item.bonus_type==BONUS_TYPE_GOLD||item.bonus_type==BONUS_TYPE_YUNHEE_FIX||item.bonus_type==BONUS_TYPE_HEART||item.bonus_type==BONUS_TYPE_JADE||item.bonus_type==BONUS_TYPE_HWANDAN_1||item.bonus_type==BONUS_TYPE_HWANDAN_2||item.bonus_type==BONUS_TYPE_HWANDAN_3||item.bonus_type==BONUS_TYPE_HWANDAN_4||item.bonus_type==BONUS_TYPE_HWANDAN_5||item.bonus_type==BONUS_TYPE_HWANDAN_6||item.bonus_type==BONUS_TYPE_HWANDAN_7||item.bonus_type==BONUS_TYPE_LOVE_ITEM||item.bonus_type==BONUS_TYPE_ATTK_POINT||item.bonus_type==BONUS_TYPE_DEF_POINT||item.bonus_type==BONUS_TYPE_HP_POINT||item.bonus_type==BONUS_TYPE_CRI_PRCNT_POINT||item.bonus_type==BONUS_TYPE_CRI_DMG_POINT||item.bonus_type==BONUS_TYPE_EVOLVE_MELEE||item.bonus_type==BONUS_TYPE_EVOLVE_LANCER||item.bonus_type==BONUS_TYPE_EVOLVE_ARCHER||item.bonus_type==BONUS_TYPE_EVOLVE_MELEE_MIDDLE||item.bonus_type==BONUS_TYPE_EVOLVE_LANCER_MIDDLE||item.bonus_type==BONUS_TYPE_EVOLVE_ARCHER_MIDDLE||item.bonus_type==BONUS_TYPE_EVOLVE_MELEE_LOW||item.bonus_type==BONUS_TYPE_EVOLVE_LANCER_LOW||item.bonus_type==BONUS_TYPE_EVOLVE_ARCHER_LOW||item.bonus_type==BONUS_TYPE_EVOLVE_ORB||item.bonus_type==BONUS_TYPE_EVOLVE_STONE||item.bonus_type==BONUS_TYPE_LOVE_ITEM_MELEE||item.bonus_type==BONUS_TYPE_LOVE_ITEM_LANCER||item.bonus_type==BONUS_TYPE_LOVE_ITEM_RANGER||item.bonus_type==BONUS_TYPE_LOVE_ITEM_CAKE||item.bonus_type==BONUS_TYPE_YUNHEE_PT||item.bonus_type==BONUS_TYPE_FORMATION_POINT||item.bonus_type==BONUS_TYPE_EVENT_POINT||item.bonus_type==BONUS_TYPE_JIN_FIX||item.bonus_type==BONUS_TYPE_YUBI_RARE||item.bonus_type==BONUS_TYPE_YUBI_EVOLVE_HIGH||item.bonus_type==BONUS_TYPE_YUBI_EVOLVE_MIDDLE||item.bonus_type==BONUS_TYPE_YUBI_EVOLVE_LOW||item.bonus_type==BONUS_TYPE_YUBI_LOVE_ITEM||item.bonus_type==BONUS_TYPE_CHRISTMAS_LOVE_ITEM||item.bonus_type==BONUS_TYPE_SUPER_CHOCO_CAKE||item.bonus_type==BONUS_TYPE_LOVE_MAX_CAKE||item.bonus_type==BONUS_TYPE_WHITE_CHOCO||item.bonus_type>=BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_01&&item.bonus_type<=BONUS_TYPE_DUMMY_LOVE_ITEM_CHOCO_CAKE_10||item.bonus_type==BONUS_TYPE_LOVE_ITEM_VD_COCHOLATE_A||item.bonus_type==BONUS_TYPE_LOVE_ITEM_VD_COCHOLATE_B||item.bonus_type==BONUS_TYPE_LOVE_ITEM_PARTNER_COCHOLATE||item.bonus_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL||item.bonus_type==BONUS_TYPE_SR_LIMIT_OVER_MTRL||item.bonus_type==BONUS_TYPE_MAGIC_KEY_MTRL||item.bonus_type==BONUS_TYPE_CRAFT_SHOP_FIRST_LOW||item.bonus_type==BONUS_TYPE_CRAFT_SHOP_FIRST_MIDDLE||item.bonus_type==BONUS_TYPE_CRAFT_SHOP_FIRST_HIGH||item.bonus_type==BONUS_TYPE_CRAFT_SHOP_FIRST_UNIQUE||item.bonus_type==BONUS_TYPE_CRAFT_SHOP_SECOND_MIDDLE||item.bonus_type==BONUS_TYPE_CRAFT_SHOP_SECOND_HIGH||item.bonus_type==BONUS_TYPE_CRAFT_SHOP_SECOND_UNIQUE||item.bonus_type==BONUS_TYPE_CRAFT_SHOP_TOTAL_LEGEND||item.bonus_type==BONUS_TYPE_CHRISTMAS_RIBBON||item.bonus_type==BONUS_TYPE_CHRISTMAS_STAR||item.bonus_type==BONUS_TYPE_CHRISTMAS_BALL||item.bonus_type==BONUS_TYPE_CHRISTMAS_BELL||item.bonus_type==BONUS_TYPE_CHRISTMAS_ANGEL||item.bonus_type==BONUS_TYPE_CHRISTMAS_LOLLIPOPS||item.bonus_type==BONUS_TYPE_CHRISTMAS_COOKIE||item.bonus_type==BONUS_TYPE_CHRISTMAS_SOCKS||item.bonus_type==BONUS_TYPE_CHRISTMAS_TREE||item.bonus_type==BONUS_TYPE_CHRISTMAS_APPLE||item.bonus_type==BONUS_TYPE_RAID_POINT||item.bonus_type==BONUS_TYPE_COMEBACK_CAKE||item.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_1||item.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_2||item.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_3||item.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_4||item.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_5||item.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_6||item.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_7||item.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_1||item.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_2||item.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_3||item.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_4||item.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_5||item.bonus_type==BONUS_TYPE_REBIRTH_MTRL_TYPE_EVENT_6||item.bonus_type==BONUS_TYPE_CHRISTMAS_SANTA||item.bonus_type==BONUS_TYPE_CHRISTMAS_REINDEER||item.bonus_type==BONUS_TYPE_CHRISTMAS_SNOWMAN||item.bonus_type==BONUS_TYPE_EQUIPMENT||item.bonus_type==BONUS_TYPE_JADE_PIECE||item.bonus_type==BONUS_TYPE_WORLD_WAR_MEDAL||item.bonus_type==BONUS_TYPE_WORLD_WAR_UNIQUE_EQUIPMENT_TICKET||item.bonus_type==BONUS_TYPE_SKIP_TICKET||item.bonus_type==BONUS_TYPE_EXCHANGE_TICKET||item.bonus_type==BONUS_TYPE_SPECIAL_GACHA_TICKET||item.bonus_type==BONUS_TYPE_HEAVEN_PT||item.bonus_type==BONUS_TYPE_NEW_RAID_BOSS_POINT||item.bonus_type==BONUS_TYPE_GNRL_PIECE||item.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_MAKE_MATERIAL||item.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_ENHANCE_MATERIAL||item.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_SMELT_MATERIAL||item.bonus_type==BONUS_TYPE_NEW_EQUIPMENT_ENCHANT_TICKET)&&list.push_back(item)}},getUserMailAllRewardList:function(list,mail_tab_type){var user_mails=NetService().getUsermail();null!=mail_tab_type&&(user_mails=NetService().getUsermail(mail_tab_type)),this.checkAndAddRewardList(user_mails,list)},getBonusTypeName:function(bonus_type){return MasterManager.getInstance().get_BonusType(bonus_type).name},getBonusTypeToBuyType:function(bonus_type){return bonus_type==BONUS_TYPE_CHRISTMAS_MELEE_GACHA_TICKET?SHOP_BUY_TYPE_CHRISTMAS_MELEE_GACHA_TICKET:bonus_type==BONUS_TYPE_CHRISTMAS_LANCER_GACHA_TICKET?SHOP_BUY_TYPE_CHRISTMAS_LANCER_GACHA_TICKET:bonus_type==BONUS_TYPE_CHRISTMAS_ARCHER_GACHA_TICKET?SHOP_BUY_TYPE_CHRISTMAS_ARCHER_GACHA_TICKET:0}}}var instance;return{getInstance:function(){return void 0===instance&&(instance=new MailService),instance}}}(),RaidBossService=function(){function RaidBossService(){}var instance;return RaidBossService.prototype.getCurrentRaidBossPeriodInfo=function(isPoint){for(var raid_boss_period_idx=0,n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),period_list=[],idx=(period_list=MasterTable.getInstance().get_RaidBossPeriodInfoList(period_list)).length-1;0<=idx;idx--){if(isPoint)var bt=moment(period_list[idx].point_check_begin_dt),et=moment(period_list[idx].point_check_end_dt),b=bt.valueOf()+1e3*period_list[idx].point_check_begin_time,e=et.valueOf()+1e3*period_list[idx].point_check_end_time;else bt=moment(period_list[idx].begin_dt),et=moment(period_list[idx].end_dt),b=bt.valueOf()+1e3*period_list[idx].begin_time,e=et.valueOf()+1e3*period_list[idx].end_time;if(b<=n&&n<=e){raid_boss_period_idx=period_list[idx].raid_boss_period_idx;break}}return raid_boss_period_idx},RaidBossService.prototype.IsOpenRaidBoss=function(){var raid_boss_period_idx=this.getCurrentRaidBossPeriodInfo(!1);if(0==raid_boss_period_idx)return!1;var period=MasterManager.getInstance().get_RaidBossPeriod(raid_boss_period_idx);if(null==period)return!1;var n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),b=moment(period.begin_dt).valueOf();b+=1e3*period.begin_time;var e=moment(period.end_dt).valueOf();return e+=1e3*period.end_time,b<=n&&n<=e},{getInstance:function(){return void 0===instance&&(instance=new RaidBossService),instance}}}();var NewRaidBossService=function(){var instance,m_CurrentBossData=null;function NewRaidBossService(){return{isOpen:function(){return 0<MasterTable.getInstance().get_NewRaidBossOpenPeriodIdx()},GetCurrentBoss:function(){return m_CurrentBossData},isHavMyBoss:function(){var user_info=NetService().get_User_info(),CurrentPerriodIdx=this.GetCurrentPeriodIdx(),new_raid_dungeon_list=NetService().get_New_Raid_Boss_Dungeon_List();if(0<new_raid_dungeon_list.length){var dungeon_found=new_raid_dungeon_list.findIndex(function(d){return 1==d.request_type&&d.new_raid_boss_period_idx==CurrentPerriodIdx});if(-1!=dungeon_found)for(var dungeon_list=new_raid_dungeon_list[dungeon_found].user_new_raid_boss_list,idx=0;idx<dungeon_list.length;idx++){var boss_data_list_num=dungeon_list[idx].boss_data_list;if(null!=boss_data_list_num&&null!=boss_data_list_num||(boss_data_list_num=[]),user_info.user_id==dungeon_list[idx].discovered_user_id&&0<boss_data_list_num.length)return!0}}return!1},GetMyBossList:function(RequestType){var list=[],CurrentPerriodIdx=this.GetCurrentPeriodIdx(),new_raid_dungeon_list=NetService().get_New_Raid_Boss_Dungeon_List(),dungeon_found=new_raid_dungeon_list.findIndex(function(d){return d.request_type==RequestType&&d.new_raid_boss_period_idx==CurrentPerriodIdx});if(-1!=dungeon_found)for(var dungeon_list=new_raid_dungeon_list[dungeon_found].user_new_raid_boss_list,idx=0;idx<dungeon_list.length;idx++)list.push_back(dungeon_list[idx]);return list},GetMyBoss:function(){var Data=null,user_info=NetService().get_User_info(),CurrentPerriodIdx=this.GetCurrentPeriodIdx(),new_raid_dungeon_list=NetService().get_New_Raid_Boss_Dungeon_List(),dungeon_found=new_raid_dungeon_list.findIndex(function(d){return 1==d.request_type&&d.new_raid_boss_period_idx==CurrentPerriodIdx});if(-1!=dungeon_found)for(var dungeon_list=new_raid_dungeon_list[dungeon_found].user_new_raid_boss_list,idx=0;idx<dungeon_list.length;idx++)if(user_info.user_id==dungeon_list[idx].discovered_user_id){Data=dungeon_list[idx];break}return Data},SetCurrentBoss:function(Data){m_CurrentBossData=Data},GetCurrentPeriodIdx:function(){return MasterTable.getInstance().get_NewRaidBossOpenPeriodIdx()},GetCurrentShopPeriodIdx:function(){return MasterTable.getInstance().get_NewRaidBossOpenPeriodIdx()},GetNewRaidBossDungeonListCount:function(RequestType){var RaidCount=0,CurrentPerriodIdx=this.GetCurrentPeriodIdx(),new_raid_dungeon_list=NetService().get_New_Raid_Boss_Dungeon_List();if(0<new_raid_dungeon_list.length){var dungeon_found=new_raid_dungeon_list.findIndex(function(d){return d.request_type==RequestType&&d.new_raid_boss_period_idx==CurrentPerriodIdx});if(-1!=dungeon_found)RaidCount=new_raid_dungeon_list[dungeon_found].user_new_raid_boss_list.length}return RaidCount},GetCurrentBossPoint:function(){var CurrentPerriodIdx=this.GetCurrentPeriodIdx(),new_raid_boss_point=NetService().get_New_Raid_Boss_Point(),found=new_raid_boss_point.user_new_raid_boss_points.findIndex(function(p){return p.new_raid_boss_period_idx==CurrentPerriodIdx});return-1!=found?new_raid_boss_point.user_new_raid_boss_points[found].point:0},GetNewRaidBossDungeonStageNpc:function(new_raid_boss_period_idx,new_raid_boss_dungeon_info_idx,dungeon){var m=MasterManager.getInstance(),mt=MasterTable.getInstance();dungeon.stage_count=1;var npc_list=[];dungeon.dungeon_data=m.get_NewRaidBossDungeonInfo(new_raid_boss_dungeon_info_idx),dungeon.dungeon_skill_data=mt.get_NewRaidBossDungeonSkillList(dungeon.dungeon_data.dungeon_skill_group_idx);for(var i=0;i<dungeon.dungeon_skill_data.length;i++){var stat_trans=mt.get_NewRaidBossDungeonSkillRefStatTransInfoList(dungeon.dungeon_skill_data[i].new_raid_boss_dungeon_skill_info_idx);0<stat_trans.size()&&dungeon.ref_stat_trans_map.insert(dungeon.dungeon_skill_data[i].new_raid_boss_dungeon_skill_info_idx,stat_trans)}var npc_groups=mt.get_NewRaidBossNpcGroupList(dungeon.dungeon_data.new_raid_boss_npc_group_idx);dungeon.limit_time=dungeon.dungeon_data.battle_limit_time;for(var idx=0;idx<npc_groups.length;idx++){var boss=$.extend({},database.BattleGeneral);this.setNewRaidBossGeneralData(npc_groups[idx],boss),npc_list.push_back(boss)}npc_list.empty()||(npc_list.sort(function(l,r){return l.position-r.position}),dungeon.stage_npc.insert(dungeon.current_stage,npc_list))},setNewRaidBossGeneralData:function(npc_gruop,gnrl){var m=MasterManager.getInstance(),npc=m.get_NpcGeneral(npc_gruop.npc_id),service=BattleService.getInstance();gnrl.npc_id=npc_gruop.idx,gnrl.gnrl_id=npc.gnrl_id,service.getMasterGeneral(gnrl),gnrl.active_skill=[],gnrl.active_sub_skill=[],gnrl.gnrl_level=npc.npc_level,gnrl.general.attk=npc.attk,gnrl.general.def=npc.def,gnrl.general.hp=npc.hp,gnrl.general.sp=npc.sp,gnrl.general.cri_percent=npc.cri_percent,gnrl.general.cri_ratio=npc.cri_attk_damage,gnrl.general.guard_rate=npc.guard_rate,gnrl.general.guard_value=npc.guard_value,gnrl.cri_resist=npc.cri_resist,gnrl.skill_attk_damage_inc=npc.skill_attk_damage_inc,gnrl.skill_def_damage_dec=npc.skill_def_damage_dec,gnrl.adv_attk_damage_inc=npc.adv_attk_damage_inc,gnrl.adv_def_damage_dec=npc.adv_def_damage_dec,gnrl.is_zoom=1<npc_gruop.boss_yn,gnrl.is_zoom&&(gnrl.npc_boss_type=13),gnrl.position=parseInt(npc_gruop.position),0!=npc.element_type&&(gnrl.general.element_type=npc.element_type),gnrl.active_skill.clear();for(var i=0;i<4;i++){var skill_id=0;switch(i){case 0:skill_id=npc_gruop.npc_active_skill_id_1;break;case 1:skill_id=npc_gruop.npc_active_skill_id_2;break;case 2:skill_id=npc_gruop.npc_active_skill_id_3;break;case 3:skill_id=npc_gruop.npc_active_skill_id_4}if(0!=skill_id){var active_skill=new database.BattleSkill;active_skill.gnrl_num=0,active_skill.skill_id=0,active_skill.skill={},active_skill.skill_action={},active_skill.onetime_effects=[],active_skill.durability_effects=[];var npc_skill=m.get_ActiveSkill(skill_id);active_skill.skill.active_skill_id=npc_skill.active_skill_id,active_skill.skill.action_id=npc_skill.action_id,active_skill.skill.content=npc_skill.content,active_skill.skill.cool_time=npc_skill.cool_time,active_skill.skill.pre_cool_time=npc_skill.pre_cool_time,active_skill.skill.invoke_type1=npc_skill.invoke_type1,active_skill.skill.onetime_effect=npc_skill.onetime_effect,active_skill.skill.invoke_type2=npc_skill.invoke_type2,active_skill.skill.durability_effect=npc_skill.durability_effect,active_skill.skill.name=npc_skill.name,active_skill.skill.skill_group=npc_skill.skill_group;var skill_action=m.get_ActionImplementation(active_skill.skill.action_id);service.convertActionImpl(skill_action,active_skill.skill_action),(one_time=new database.BattleOneTimeEffect).gnrl_id=gnrl.gnrl_id;for(var one_time_effects=active_skill.skill.onetime_effect.split(","),one_id=0;one_id<one_time_effects.length;one_id++){if(0<(num=parseInt(one_time_effects[one_id])))null!=(fx=m.get_OnetimeEffect(num)).num&&service.convertOneTimeEffect(fx,one_time),0<one_time.effect_id&&active_skill.onetime_effects.push_back(one_time)}for(var durability_effects=active_skill.skill.durability_effect.split(","),dur_id=0;dur_id<durability_effects.length;dur_id++){if((durability=new database.BattleDurabilityEffect).gnrl_id=gnrl.general.gnrl_id,0<(num=parseInt(durability_effects[dur_id]))){var fx=m.get_DurabilityEffect(num);if(service.convertDurabilityEffect(fx,durability),0<fx.dura_end_effect){var one=m.get_OnetimeEffect(fx.dura_end_effect);(end_one=new database.BattleOneTimeEffect).gnrl_id=gnrl.gnrl_id,service.convertOneTimeEffect(one,end_one),durability.end_effects.push(end_one)}if(0<fx.repeat_effect){one=database.OnetimeEffect();one=m.get_OnetimeEffect(fx.repeat_effect),(repeat_one=new database.BattleOneTimeEffect).gnrl_id=gnrl.gnrl_id,service.convertOneTimeEffect(one,repeat_one),durability.tick_effects.push(repeat_one)}0<durability.effect_id&&active_skill.durability_effects.push(durability)}}gnrl.active_skill.push_back(active_skill)}}var sub_skills=[];sub_skills.push(npc_gruop.npc_active_sub_skill_id_1),sub_skills.push(npc_gruop.npc_active_sub_skill_id_2),sub_skills.push(npc_gruop.npc_active_sub_skill_id_3),sub_skills.push(npc_gruop.npc_active_sub_skill_id_4);for(var active_sub_skill_id=0;active_sub_skill_id<sub_skills.length;active_sub_skill_id++)if(0!=sub_skills[active_sub_skill_id]){gnrl.active_sub_skill={};var active_sub_skill={};active_sub_skill.sub_skill_id=sub_skills[active_sub_skill_id];var npc_sub=m.get_ActiveSubSkill(sub_skills[active_sub_skill_id]);active_sub_skill.sub_skill.active_sub_skill_id=sub_skills[active_sub_skill_id],active_sub_skill.sub_skill.action_id=npc_sub.action_id,active_sub_skill.sub_skill.onetime_effect=npc_sub.onetime_effect,active_sub_skill.sub_skill.durability_effect=npc_sub.durability_effect;var one_time,durability;skill_action=m.get_ActionImplementation(active_sub_skill.sub_skill.action_id);service.convertActionImpl(skill_action,active_sub_skill.skill_action),(one_time=new database.BattleOneTimeEffect).gnrl_id=gnrl.gnrl_id;for(one_time_effects=active_sub_skill.sub_skill.onetime_effect.split(","),one_id=0;one_id<one_time_effects.length;one_id++){if(0<(num=one_time_effects[one_id]))null!=(fx=m.get_OnetimeEffect(num)).num&&service.convertOneTimeEffect(fx,one_time),0<one_time.effect_id&&active_skill.onetime_effects.push(one_time)}(durability=new database.BattleDurabilityEffect).gnrl_id=gnrl.general.gnrl_id;for(durability_effects=active_skill.skill.durability_effect.split(","),dur_id=0;dur_id<durability_effects.length;dur_id++){var num;if(0<(num=durability_effects[dur_id]))if(null!=(fx=m.get_DurabilityEffect(num)).num){if(service.convertDurabilityEffect(fx,durability),0<fx.dura_end_effect){var end_one;one=m.get_OnetimeEffect(fx.dura_end_effect);(end_one=new database.BattleOneTimeEffect).gnrl_id=gnrl.gnrl_id,service.convertOneTimeEffect(one,end_one),durability.end_effects.push(end_one)}if(0<fx.repeat_effect){var repeat_one;one=database.OnetimeEffect();one=m.get_OnetimeEffect(fx.repeat_effect),(repeat_one=new database.BattleOneTimeEffect).gnrl_id=gnrl.gnrl_id,service.convertOneTimeEffect(one,repeat_one),durability.tick_effects.push(repeat_one)}0<durability.effect_id&&active_skill.durability_effects.push(durability)}}gnrl.active_sub_skill.push_back(active_sub_skill)}var resist_list=MasterTable.getInstance().get_NpcResistances(npc.npc_id);gnrl.resistance=[];for(var r=0;r<resist_list.length;r++){var resist={};resist.resistance_id=resist_list[r].resistance_id,resist.trans_type=resist_list[r].trans_type,resist.resist_value=resist_list[r].resist_value,gnrl.resistance.push(resist)}var sp_list=MasterTable.getInstance().get_NpcSpecialAbilities(npc.npc_id);gnrl.special_ability=[];for(var s=0;s<sp_list.length;s++){var sa={};sa.special_ability_id=sp_list[s].special_ability_id,sa.special_ability_type=sp_list[s].special_ability_type,sa.ability_value=sp_list[s].ability_value,gnrl.special_ability.push(sa)}},GetNewRaidBossDropRewardList:function(){for(var list=[],m=MasterTable.getInstance(),dungeon_list=m.get_NewRaidBossDungeonListData(this.GetCurrentPeriodIdx()),idx=0;idx<dungeon_list.length;idx++)list=m.get_NewRaidBossDropRewardList(dungeon_list[idx].new_raid_boss_drop_reward_info_group_idx);return list},GetCurrentBossMaxAddedLife:function(){for(var m=MasterManager.getInstance(),mt=MasterTable.getInstance(),DungeonInfo=m.get_NewRaidBossDungeonInfo(m_CurrentBossData.new_raid_boss_dungeon_info_idx),State_Data=m_CurrentBossData.boss_data_list[0],npc_groups=mt.get_NewRaidBossNpcGroupList(DungeonInfo.new_raid_boss_npc_group_idx),addLife=0,idx=0;idx<npc_groups.length;idx++)if(npc_groups[idx].new_raid_boss_npc_group_idx==DungeonInfo.new_raid_boss_npc_group_idx&&npc_groups[idx].idx==State_Data.boss_idx){addLife=npc_groups[idx].added_life;break}return addLife},GetBossMaxAddedLife:function(new_raid_boss_dungeon_info_idx,State_Data){for(var DungeonInfo=MasterManager.getInstance().get_NewRaidBossDungeonInfo(new_raid_boss_dungeon_info_idx),npc_groups=MasterTable.getInstance().get_NewRaidBossNpcGroupList(DungeonInfo.new_raid_boss_npc_group_idx),addLife=0,i=0;i<npc_groups.length;i++)if(npc_groups[i].new_raid_boss_npc_group_idx==DungeonInfo.new_raid_boss_npc_group_idx&&npc_groups[i].idx==State_Data.boss_idx){addLife=npc_groups[i].added_life;break}return addLife},GetBossRemainTime:function(BossData){var now=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)),n=moment(now).valueOf(),diff=moment(BossData.retreat_dt).valueOf()-n;return diff<0&&(diff=0),moment.duration(diff)},GetCurrentBossBattleReqType:function(){var user_info=NetService().get_User_info();if(m_CurrentBossData.discovered_user_id==user_info.user_id)return 1;var dungeon_found,raid_boss_dungeon_list=NetService().get_New_Raid_Boss_Dungeon_List();return-1!=(dungeon_found=raid_boss_dungeon_list.findIndex(function(d){return 1==d.request_type&&d.new_raid_boss_period_idx==m_CurrentBossData.new_raid_boss_period_idx}))&&-1!=raid_boss_dungeon_list[dungeon_found].user_new_raid_boss_list.findIndex(function(d){return d.boss_num==m_CurrentBossData.boss_num})?1:-1!=(dungeon_found=raid_boss_dungeon_list.findIndex(function(d){return 2==d.request_type&&d.new_raid_boss_period_idx==m_CurrentBossData.new_raid_boss_period_idx}))&&-1!=raid_boss_dungeon_list[dungeon_found].user_new_raid_boss_list.findIndex(function(d){return d.boss_num==m_CurrentBossData.boss_num})?2:1},GetRemainTime:function(data){var now=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)),n=moment(now).valueOf();return moment(data.retreat_dt).valueOf()-n}}}return{getInstance:function(){return void 0===instance&&(instance=new NewRaidBossService),instance}}}(),AchievementScene=GameScene.extend({bg:null,title:null,back_btn:null,m_achievementLayer:null,_idx:0,m_gameObserver:null,achv_list:null,ctor:function(){this._super(scene_AchievementScene)},init:function(){var winSize=cc.director.getWinSize();this.m_gameObserver=MainObserver.getInstance(),this.bg=new cc.Sprite(RES_CDN_DEFULT+"new_common/bg_sub_4.png"),this.bg.setPosition(cc.p(winSize.width/2,winSize.height/2)),USE_SP_COMMON_SUB_BG_SCALE&&this.bg.setScale(2),this.addChild(this.bg);var achv_type=GameContext.getInstance().getAchievementTap(),schvService=AchievementService.getInstance();schvService.loadUserAchievement(achv_type),this.achv_list=schvService.getUserAchievement(achv_type),this.m_achievementLayer=new AchievementLayer,this.m_achievementLayer.setAchivementList(this.achv_list),this.m_achievementLayer.initLayout(),this.m_achievementLayer.chageTapMenu(achv_type),this.addChild(this.m_achievementLayer);var statusLayer=new StatusLayer(INVOKER_TYPE.normal);return statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer),this.back_btn=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png",""),this.back_btn.setTouchEnabled(!0),this.back_btn.setAnchorPoint(cc.p(0,0)),this.back_btn.setPosition(0,ccHeight(this)-ccHeight(this.back_btn)),this.back_btn.addClickEventListener(function(){this.back()}.bind(this)),this.addChild(this.back_btn),this.title=new cc.Sprite(RES_CDN_DEFULT+"new_img_txt/img_menu_mission.png"),this.title.setAnchorPoint(cc.p(0,0)),this.title.setPosition(cc.p(ccWidth(this.back_btn),ccHeight(this)-ccHeight(this.back_btn))),this.addChild(this.title),!0},onNotification:function(msg){this._super(msg);var achv_list=[];switch(msg){case ACHIEVEMENT_DAY:case ACHIEVEMENT_WEEK:case ACHIEVEMENT_SEQ:case ACHIEVEMENT_BEGINNER:case ACHIEVEMENT_COLLABO:case ACHIEVEMENT_NAMING:case ACHIEVEMENT_RAID_BOSS:GameContext.getInstance().setAchievementTap(msg);var achvService=AchievementService.getInstance();AchievementService.getInstance().loadUserAchievement(msg),achv_list=achvService.getUserAchievement(msg),this.m_achievementLayer.setAchivementList(achv_list),this.m_achievementLayer.chageTapMenu(msg);break;case NOTIFY_ACHIEVEMENT_RECIEVE:GameContext.getInstance().getAchievementTap();0==GameContext.getInstance().getAchvReceived()&&this.sendPacketAchievementReceive();break;case NOTIFY_ACHIEVEMENT_ALL_RECIEVE:this.sendPacketAchievementReceiveAll();break;case achive_btn_show_help:GameContext.getInstance().setHelpInfoIndexByCallIndex(25),PREV_MISSION=!0;var scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null;break;case notification_not_open_mission:return this.showNotOpenMissionMsgBox(),!0}return!0},sendPacketAchievementReceive:function(){var user_achv=GameContext.getInstance().getSelectAchv();GameContext.getInstance().setAchvReceived(!0);var res={};res.opcode=net.OP.op_user_achievement_bonus_receive,res.achv_id=user_achv.achv_id,this.network_write(res)},sendPacketAchievementReceiveAll:function(){var user_achv=GameContext.getInstance().getAllAchv(),req={};req.opcode=net.OP.op_user_achievement_bonus_receive_all,req.achv_type=user_achv.at(0).achv_type,req.event_dungeon_period_idx=0,this.network_write(req)},onNetworkEvent:function(opcode,state,body){if(this._super(opcode,state,body),opcode==net.OP.op_user_achievement_bonus_receive)this.removeLayerProgress(),body.error==net.ERROR.NET_E_ALREADY_RECEIVED_REWARD||this.scheduleOnce(function(){var achv_type=GameContext.getInstance().getAchievementTap(),achvService=AchievementService.getInstance();AchievementService.getInstance().loadUserAchievement(achv_type);var achv_list=achvService.getUserAchievement(achv_type);this.m_achievementLayer.setAchivementList(achv_list),this.m_achievementLayer.setUserAchivList(),this.showNoticeRewardReceive(body.achv_bonus.bonus_type)},.5,"achive");else if(opcode==net.OP.op_user_achievement_bonus_receive_all)this.scheduleOnce(function(){var achv_type=GameContext.getInstance().getAchievementTap(),achv_list=AchievementService.getInstance().getUserAchievement(achv_type);this.m_achievementLayer.setAchivementList(achv_list),this.m_achievementLayer.setUserAchivList(),0<body.achv_bonus_list.length&&(body.achv_type==ACHIEVEMENT_NAMING?this.showNoticeRewardReceive(BONUS_TYPE_NAMING):this.showNoticeRewardReceive(body.achv_bonus_list[0].bonus_type))}.bind(this),.5,"bonus_receive");else if(opcode==net.OP.op_get_user_mussang){SceneManager.getInstance().getRunningScene().initLayoutProgress();var scene=new MussangRoadScene;SceneManager.getInstance().replaceScene(scene),scene=null}},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_AchievementScene]),PREV_MISSION=!1},onExit:function(){this._super(),1==BATTLE_TO_RETRY&&(BATTLE_TO_RETRY=!1),1!=PREV_MISSION&&MainObserver.getInstance().removeObserver(sceneStr[scene_AchievementScene])},back:function(){this.m_isPushScene?SceneManager.getInstance().popScene():this.onKeyBack(!0)},showNotOpenMissionMsgBox:function(){this.m_box.setTitle(res_str("label_achievement_shortcuts_not_open_title")),this.m_box.setText(res_str("label_achievement_shortcuts_not_open_text")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.m_box.hide(!1)},0,"btnOk")}.bind(this))),this.m_box.show()}}),SHORTCUTS_BTN_WIDTH=156,AchieveListItemCell=cc.TableViewCell.extend({m_name_label:null,m_reward_label:null,m_content:null,m_gauge:null,m_count_label:null,m_bonus_icon:null,m_callback:null,m_shortcutCallback:null,m_list_bg:null,m_complete_btn_mask:null,m_complete_mask:null,m_btn_sprites:[],m_bonus_bg:null,m_btn_shortcuts:[],m_btn:null,m_btn_shortcut:null,m_all_btn_rect:null,ctor:function(_callback,_shortcuts_callback){return this._super(),this.init(_callback,_shortcuts_callback),!0},init:function(_callback,_shortcuts_callback){this.m_callback=_callback,this.m_shortcutCallback=_shortcuts_callback,this.m_btn_sprites=[],this.m_btn_shortcuts=[],this.m_list_bg=new cc.Scale9Sprite(RES_CDN_DEFULT+"new_common/img_9p_frame_in_1.png",RectZero()),this.m_list_bg.setAnchorPoint(0,0),this.m_list_bg.setPosition(0,10),this.m_list_bg.setContentSize(960,98),this.addChild(this.m_list_bg),this.setContentSize(this.m_list_bg.getContentSize()),IS_SP_BROWSER,this.m_name_label=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_2075),this.m_name_label.enableOutline(new cc.c4b(0,0,0,255),2),this.m_name_label.setAnchorPoint(0,0),this.m_name_label.setPosition(101,63),this.m_list_bg.addChild(this.m_name_label),this.m_reward_label=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_2075),this.m_reward_label.enableOutline(new cc.c4b(0,0,0,255),2),this.m_reward_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_reward_label.setPosition(675,59),this.m_list_bg.addChild(this.m_reward_label),this.m_content=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_1871),this.m_content.enableOutline(new cc.c4b(0,0,0,255),2),this.m_content.setAnchorPoint(ZERO()),this.m_content.setPosition(101,34),this.m_list_bg.addChild(this.m_content);var gauge_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_gauge.png",RectZero());return gauge_bg.setAnchorPoint(ZERO()),gauge_bg.setPosition(103,13),gauge_bg.setContentSize(528,15),this.m_list_bg.addChild(gauge_bg),this.m_gauge=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_gauge_orange.png",RectZero()),this.m_gauge.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_gauge.setPosition(0,8),this.m_gauge.setContentSize(528,15),gauge_bg.addChild(this.m_gauge),this.m_count_label=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_1671),this.m_count_label.enableOutline(new cc.c4b(0,0,0,255),2),this.m_count_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_count_label.setPosition(ccCenter(gauge_bg)),gauge_bg.addChild(this.m_count_label),this.m_bonus_bg=cc.Sprite.create(RES_CDN_DEFULT+"new_icon/img_icon_frame.png"),this.m_bonus_bg.setAnchorPoint(ZERO()),this.m_bonus_bg.setPosition(11,10),this.m_list_bg.addChild(this.m_bonus_bg),this.m_bonus_icon=cc.Sprite.create(),this.m_bonus_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bonus_icon.setPosition(ccCenter(this.m_bonus_bg)),this.m_bonus_bg.addChild(this.m_bonus_icon),this.m_complete_btn_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_alpha_1.png",RectZero()),this.m_complete_btn_mask.setAnchorPoint(ZERO()),this.m_complete_btn_mask.setPosition(ZERO()),this.m_complete_btn_mask.setContentSize(960,98),this.m_list_bg.addChild(this.m_complete_btn_mask),this.m_complete_btn_mask.setVisible(!1),this.m_complete_mask=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_mission_complete.png"),this.m_complete_mask.setAnchorPoint(ANCHOR_MIDDLE()),this.m_complete_mask.setPosition(ccCenter(this.m_list_bg)),this.m_complete_mask.setVisible(!1),this.m_list_bg.addChild(this.m_complete_mask),this.m_btn=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_1_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_1_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_1_none.png"),this.m_btn.setPosition(ccWidth(this.m_list_bg)-13-0,48),this.m_btn.ignoreContentAdaptWithSize(!1),this.m_all_btn_rect=cc.Rect(16,16,26,26),this.m_btn.setTitleFont(this.m_all_btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255)),this.m_btn.setTitleText(res_str("btn_label_reward")),this.m_btn.setBright(!0),this.m_btn.setContentSize(146,58),this.m_btn.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_btn.addClickEventListener(function(sender){this.m_callback(this.m_achieve,this.getIdx())}.bind(this)),this.m_list_bg.addChild(this.m_btn),this.m_btn_shortcut=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_1_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_1_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_1_none.png"),this.m_btn_shortcut.setPosition(ccWidth(this.m_list_bg)-13,48),this.m_btn_shortcut.ignoreContentAdaptWithSize(!1),this.m_btn_shortcut.setTitleFont(this.m_all_btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255)),this.m_btn_shortcut.setTitleText(res_str("label_shortcuts_move")),this.m_btn_shortcut.setBright(!0),this.m_btn_shortcut.setContentSize(146,58),this.m_btn_shortcut.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_btn_shortcut.addClickEventListener(function(sender){this.m_shortcutCallback(this.m_achieve,this.getIdx())}.bind(this)),this.m_list_bg.addChild(this.m_btn_shortcut),this.m_btn_shortcut.setVisible(!1),this.m_btn_shortcut.setEnabled(!1),!0},setUserAchievement:function(achieve,use_shortcut){this.m_achieve=achieve,this.updateLayout(use_shortcut)},updateLayout:function(use_shortcut){var m=MasterManager.getInstance(),achv_info=GameDefault.getInstance().get_AchivementString(this.m_achieve.achv_id);if(this.m_name_label.setString(achv_info.name),this.m_achieve.bonus_type==BONUS_TYPE_YUNHEE_FIX){var gnrl=m.get_General(this.m_achieve.key_id);this.m_reward_label.setString(cmString(res_str("label_reward_count"),gnrl.name,Number(this.m_achieve.bonus_count).toLocaleString("en")))}else this.m_achieve.bonus_type==BONUS_TYPE_NAMING?this.m_reward_label.setString(cmString(res_str("label_achievement_reward"),this.m_achieve.bonus_name)):this.m_reward_label.setString(cmString(res_str("label_reward_count"),this.m_achieve.bonus_name,Number(this.m_achieve.bonus_count).toLocaleString("en")));this.m_content.setString(achv_info.content);var complete_count=this.m_achieve.complete_count;if(this.m_achieve.count<complete_count&&(complete_count=this.m_achieve.count),0==this.m_achieve.count)this.m_gauge.setScaleX(0);else if(this.m_gauge.setScaleX(1),complete_count>=this.m_achieve.count)this.m_gauge.setContentSize(528,15);else{var _gauge=complete_count/this.m_achieve.count;_gauge*=528,this.m_gauge.setContentSize(_gauge,15),_gauge<1&&this.m_gauge.setScaleX(0)}if(this.m_count_label.setString(Number(this.m_achieve.complete_count).toLocaleString("en")+" / "+Number(this.m_achieve.count).toLocaleString("en")),this.m_achieve.bonus_type==BONUS_TYPE_YUNHEE_FIX||this.m_achieve.bonus_type==BONUS_TYPE_JIN_FIX){var general=m.get_General(this.m_achieve.key_id);if(general.gnrl_type==GENERAL_TYPE_MATERIAL||general.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL)if(IS_SP_BROWSER)if(DISABLE_SPB_TP)this.m_bonus_icon.setTexture(RES_CDN_CARD_MEDIUM_NTP+"m_"+general.bone_id+".png"),this.m_bonus_icon.setScale(DEF_TUMB_SCALE);else{var frame=cc.spriteFrameCache.getSpriteFrame("m_"+general.bone_id+".png");this.m_bonus_icon.setSpriteFrame(frame),this.m_bonus_icon.setScale(DEF_TUMB_SCALE)}else{frame=cc.spriteFrameCache.getSpriteFrame("m_"+general.bone_id+".png");this.m_bonus_icon.setSpriteFrame(frame),this.m_bonus_icon.setScale(DEF_TUMB_SCALE)}else if(IS_SP_BROWSER)if(DISABLE_SPB_TP)this.m_bonus_icon.setTexture(RES_CDN_CARD_MEDIUM_NTP+"m_"+general.gnrl_id+".png"),this.m_bonus_icon.setScale(DEF_TUMB_SCALE);else{frame=cc.spriteFrameCache.getSpriteFrame("m_"+general.gnrl_id+".png");this.m_bonus_icon.setSpriteFrame(frame),this.m_bonus_icon.setScale(DEF_TUMB_SCALE)}else{frame=cc.spriteFrameCache.getSpriteFrame("m_"+general.gnrl_id+".png");this.m_bonus_icon.setSpriteFrame(frame),this.m_bonus_icon.setScale(DEF_TUMB_SCALE)}}else if(this.m_achieve.bonus_type<=BONUS_TYPE_SSR_RARE_TYPE_SELECT||this.m_achieve.bonus_type>=BONUS_TYPE_HWANDAN_1&&this.m_achieve.bonus_type<=BONUS_TYPE_HWANDAN_6||this.m_achieve.bonus_type>=BONUS_TYPE_KEY_REFILL){frame=cc.spriteFrameCache.getSpriteFrame("img_reward_"+leadingZeros(this.m_achieve.bonus_type,2)+"_n.png");this.m_bonus_icon.setSpriteFrame(frame),this.m_bonus_icon.setScale(.5),this.m_bonus_icon.setPosition(ccCenter(this.m_bonus_bg))}else{frame=cc.spriteFrameCache.getSpriteFrame("img_reward_yh_n.png");this.m_bonus_icon.setSpriteFrame(frame),this.m_bonus_icon.setPosition(ccCenter(this.m_bonus_bg)),this.m_bonus_icon.setScale(.5)}"y"!=this.m_achieve.complete_yn?(this.m_btn.setNomalTitleColor(2,cc.color(176,176,176,255)),this.m_btn.setEnabled(!1)):(this.m_btn.setNomalTitleColor(2,cc.color(255,255,255,255)),this.m_btn.setEnabled(!0)),this.m_achieve.achv_type!=ACHIEVEMENT_SEQ&&"y"==this.m_achieve.bonus_complete_yn?(this.m_btn.setNomalTitleColor(2,cc.color(176,176,176,255)),this.m_btn.setEnabled(!1),this.m_complete_mask.setVisible(!0),this.m_complete_btn_mask.setVisible(!0)):(this.m_complete_mask.setVisible(!1),this.m_complete_btn_mask.setVisible(!1));var offset_x=0;1==use_shortcut&&(offset_x=SHORTCUTS_BTN_WIDTH);var pos_y=this.m_reward_label.getPosition().y;this.m_reward_label.setPosition(790-offset_x,pos_y),pos_y=this.m_btn.getPosition().y,this.m_btn.setPosition(ccWidth(this.m_list_bg)-13-offset_x,pos_y),1==use_shortcut&&0<this.m_achieve.shortcuts_id?"y"==this.m_achieve.complete_yn&&"y"==this.m_achieve.bonus_complete_yn?(this.m_btn_shortcut.setVisible(!0),this.m_btn_shortcut.setNomalTitleColor(2,cc.color(176,176,176,255)),this.m_btn_shortcut.setEnabled(!1)):(this.m_btn_shortcut.setVisible(!0),this.m_btn_shortcut.setNomalTitleColor(2,cc.color(255,255,255,255)),this.m_btn_shortcut.setEnabled(!0)):(this.m_btn_shortcut.setVisible(!1),this.m_btn_shortcut.setNomalTitleColor(2,cc.color(176,176,176,255)),this.m_btn_shortcut.setEnabled(!1)),achv_info=null},highlightPosInCell:function(pos){},unhighlightPosInCell:function(pos){},touchPosInCell:function(pos){}});AchieveListItemCell.prototype.create=function(_callback,use_shortcut){var node=new AchieveListItemCell;return null!=node&&node.init(_callback,use_shortcut)?node:(CC_SAFE_RELEASE(node),node=null)};var achive_btn_show_help=700,notification_not_open_mission=701,AchievementLayer=cc.Layer.extend({m_tap_day:null,m_tap_week:null,m_tap_seq:null,m_beginner_new:null,m_collabo_new:null,m_day_new:null,m_week_new:null,m_seq_new:null,m_tap_beginner:null,m_tap_collabo:null,m_tableView:null,m_info_icon:null,m_info_text:null,m_useShortcut:null,m_user_achv_list:null,m_bgBoxLayer:null,help_btn:null,_idx:0,m_all_bonus_btn:null,m_all_achv_reward:!1,m_gameObserver:null,m_tap_naming:null,m_tap_raid_boss:null,m_naming_new:null,m_raid_boss_new:null,m_achive_cell_list:[],ctor:function(idx){return this._super(cc.color(0,0,0,255),cc.color(70,130,180,255)),this._idx=idx,this.m_user_achv_list=[],this.m_gameObserver=MainObserver.getInstance(),this.m_achive_cell_list=[],!0},setAchivementList:function(list){this.m_user_achv_list=list,this.m_user_achv_list=stable(this.m_user_achv_list,function(l,r){return l.complete_yn<r.complete_yn}),this.m_user_achv_list=stable(this.m_user_achv_list,function(l,r){return l.bonus_complete_yn>r.bonus_complete_yn}),this.m_all_achv_reward=!1;for(var i=0;i<this.m_user_achv_list.length;i++){var achv_list=this.m_user_achv_list[i];if("y"==achv_list.complete_yn&&"n"==achv_list.bonus_complete_yn)return void(this.m_all_achv_reward=!0)}},initLayout:function(){cc.director.getWinSize();this.m_bgBoxLayer=this.getAchieveBoxLayer(),this.m_bgBoxLayer.ignoreAnchorPointForPosition(!1),this.m_bgBoxLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bgBoxLayer.setPosition(ccCenter(this).x,0),this.addChild(this.m_bgBoxLayer),this.help_btn=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_help_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_help_on.png"),this.help_btn.setAnchorPoint(ZERO()),this.help_btn.setPosition(786,21),this.addChild(this.help_btn),this.help_btn.addClickEventListener(function(float){this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_AchievementScene],achive_btn_show_help)},0,"achive_btn_show_help")}.bind(this))},getAchieveBoxLayer:function(){var layer=new cc.Layer,tap_index=GameContext.getInstance().getAchievementTap(),pos_x=22,all_btn_rect=cc.Rect(16,16,18,18),offset=cc.p(0,-5);this.m_tap_day=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_4_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_4_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_3_off.png"),this.m_tap_day.setAnchorPoint(ZERO()),this.m_tap_day.setPosition(pos_x,520),this.m_tap_day.setContentSize(152,50),this.m_tap_day.setTitleFont(all_btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color.WHITE,cc.color(128,128,128,255),offset),this.m_tap_day.setTitleText(res_str("btn_label_day_achievement")),this.m_tap_day.setBright(!0),this.m_tap_day.setEnabled(!1),this.m_tap_day.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],ACHIEVEMENT_DAY)}.bind(this)),layer.addChild(this.m_tap_day),pos_x+=ccWidth(this.m_tap_day)+10,this.m_tap_week=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_4_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_4_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_3_off.png"),this.m_tap_week.setContentSize(152,50),this.m_tap_week.setTitleFont(all_btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color.WHITE,cc.color(128,128,128,255),offset),this.m_tap_week.setTitleText(res_str("btn_label_week_achievement")),this.m_tap_week.setBright(!0),this.m_tap_week.setAnchorPoint(ZERO()),this.m_tap_week.setPosition(pos_x,ccPosY(this.m_tap_day)),this.m_tap_week.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],ACHIEVEMENT_WEEK)}.bind(this)),layer.addChild(this.m_tap_week),pos_x+=ccWidth(this.m_tap_week)+10,this.m_tap_seq=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_4_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_4_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_3_off.png"),this.m_tap_seq.setContentSize(152,50),this.m_tap_seq.setTitleFont(all_btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color.WHITE,cc.color(128,128,128,255),offset),this.m_tap_seq.setTitleText(res_str("btn_label_sequence_achievement")),this.m_tap_seq.setBright(!0),this.m_tap_seq.setAnchorPoint(ZERO()),this.m_tap_seq.setPosition(pos_x,ccPosY(this.m_tap_day)),this.m_tap_seq.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],ACHIEVEMENT_SEQ)}.bind(this)),layer.addChild(this.m_tap_seq),pos_x+=ccWidth(this.m_tap_seq)+10,this.m_tap_beginner=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_4_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_4_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_3_off.png"),this.m_tap_beginner.setContentSize(152,50),this.m_tap_beginner.setTitleFont(all_btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color.WHITE,cc.color(128,128,128,255),offset),this.m_tap_beginner.setTitleText(res_str("btn_label_beginner_achievement")),this.m_tap_beginner.setBright(!0),this.m_tap_beginner.setAnchorPoint(ZERO()),this.m_tap_beginner.setPosition(pos_x,ccPosY(this.m_tap_day)),this.m_tap_beginner.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],ACHIEVEMENT_BEGINNER)}.bind(this)),layer.addChild(this.m_tap_beginner),pos_x+=ccWidth(this.m_tap_beginner)+10,1==USE_COLLABO_ACHIEVEMENT&&AchievementService.getInstance().checkAchievementPeriod(ACHIEVEMENT_COLLABO)&&(this.m_tap_collabo=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_4_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_4_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_3_off.png"),this.m_tap_collabo.setContentSize(152,50),this.m_tap_collabo.setTitleFont(all_btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color.WHITE,cc.color(128,128,128,255),offset),this.m_tap_collabo.setTitleText(res_str("btn_label_collabo_achievement")),this.m_tap_collabo.setBright(!0),this.m_tap_collabo.setAnchorPoint(ZERO()),this.m_tap_collabo.setPosition(pos_x,ccPosY(this.m_tap_day)),this.m_tap_collabo.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],ACHIEVEMENT_COLLABO)}.bind(this)),layer.addChild(this.m_tap_collabo),pos_x+=ccWidth(this.m_tap_collabo)+10),this.m_tap_naming=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_4_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_4_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_3_off.png"),this.m_tap_naming.setContentSize(152,50),this.m_tap_naming.setTitleFont(all_btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color.WHITE,cc.color(128,128,128,255),offset),this.m_tap_naming.setTitleText(res_str("btn_label_naming_achievement")),this.m_tap_naming.setBright(!0),this.m_tap_naming.setAnchorPoint(ZERO()),this.m_tap_naming.setPosition(pos_x,ccPosY(this.m_tap_day)),this.m_tap_naming.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],ACHIEVEMENT_NAMING)}.bind(this)),layer.addChild(this.m_tap_naming),pos_x+=ccWidth(this.m_tap_naming)+10,AchievementService.getInstance().checkAchievementPeriod(ACHIEVEMENT_RAID_BOSS)&&(this.m_tap_raid_boss=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_4_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_4_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_3_off.png"),this.m_tap_raid_boss.setContentSize(152,50),this.m_tap_raid_boss.setTitleFont(all_btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color.WHITE,cc.color(128,128,128,255),offset),this.m_tap_raid_boss.setTitleText(res_str("btn_label_raid_boss_achievement")),this.m_tap_raid_boss.setBright(!0),this.m_tap_raid_boss.setAnchorPoint(ZERO()),this.m_tap_raid_boss.setPosition(pos_x,ccPosY(this.m_tap_day)),this.m_tap_raid_boss.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],ACHIEVEMENT_RAID_BOSS)}.bind(this)),layer.addChild(this.m_tap_raid_boss),pos_x+=ccWidth(this.m_tap_raid_boss)+10),btn_name_list=null,this.m_day_new=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_new.png"),this.m_day_new.setAnchorPoint(.5,.5),this.m_day_new.setPosition(this.m_tap_day.width-10,this.m_tap_day.height-10),this.m_day_new.setVisible(!1),this.m_tap_day.addChild(this.m_day_new),this.m_week_new=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_new.png"),this.m_week_new.setAnchorPoint(.5,.5),this.m_week_new.setPosition(this.m_tap_week.width-10,this.m_tap_week.height-10),this.m_week_new.setVisible(!1),this.m_tap_week.addChild(this.m_week_new),this.m_seq_new=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_new.png"),this.m_seq_new.setAnchorPoint(.5,.5),this.m_seq_new.setPosition(this.m_tap_seq.width-10,this.m_tap_seq.height-10),this.m_seq_new.setVisible(!1),this.m_tap_seq.addChild(this.m_seq_new),this.m_beginner_new=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_new.png"),this.m_beginner_new.setAnchorPoint(ANCHOR_MIDDLE()),this.m_beginner_new.setPosition(ccWidth(this.m_tap_beginner)-10,ccHeight(this.m_tap_beginner)-10),this.m_tap_beginner.addChild(this.m_beginner_new),1==USE_COLLABO_ACHIEVEMENT&&null!=this.m_tap_collabo&&(this.m_collabo_new=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_new.png"),this.m_collabo_new.setAnchorPoint(ANCHOR_MIDDLE()),this.m_collabo_new.setPosition(ccWidth(this.m_tap_collabo)-10,ccHeight(this.m_tap_collabo)-10),this.m_tap_collabo.addChild(this.m_collabo_new)),this.m_naming_new=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_new.png"),this.m_naming_new.setAnchorPoint(ANCHOR_MIDDLE()),this.m_naming_new.setPosition(ccWidth(this.m_tap_naming)-10,ccHeight(this.m_tap_naming)-10),this.m_tap_naming.addChild(this.m_naming_new),null!=this.m_tap_raid_boss&&(this.m_raid_boss_new=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_new.png"),this.m_raid_boss_new.setAnchorPoint(ANCHOR_MIDDLE()),this.m_raid_boss_new.setPosition(ccWidth(this.m_tap_raid_boss)-10,ccHeight(this.m_tap_raid_boss)-10),this.m_tap_raid_boss.addChild(this.m_raid_boss_new)),tap_index==ACHIEVEMENT_DAY?this.m_tap_day.setEnabled(!1):tap_index==ACHIEVEMENT_WEEK?this.m_tap_week.setEnabled(!1):tap_index==ACHIEVEMENT_SEQ?this.m_tap_seq.setEnabled(!1):tap_index==ACHIEVEMENT_BEGINNER?this.m_tap_beginner.setEnabled(!1):tap_index==ACHIEVEMENT_COLLABO?null!=this.m_tap_collabo&&this.m_tap_collabo.setEnabled(!1):tap_index==ACHIEVEMENT_NAMING?this.m_tap_naming.setEnabled(!1):tap_index==ACHIEVEMENT_RAID_BOSS&&null!=this.m_tap_raid_boss&&this.m_tap_raid_boss.setEnabled(!1),tap_index==ACHIEVEMENT_SEQ||tap_index==ACHIEVEMENT_NAMING||tap_index==ACHIEVEMENT_BEGINNER||tap_index==ACHIEVEMENT_COLLABO?this.m_useShortcut=!0:this.m_useShortcut=!1;var bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_base.png",cc.Rect(40,40,10,10));bg_box.setContentSize(1e3,520),bg_box.setAnchorPoint(ZERO()),bg_box.setPosition(0,0),layer.addChild(bg_box),layer.setContentSize(bg_box.getContentSize()),this.m_tableView=new cc.TableView(this,cc.size(960,414)),this.m_tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_tableView.scrollBarEnable(!0),this.m_tableView.setPosition(17,79),layer.addChild(this.m_tableView),this.m_tableView.setDelegate(this),this.m_tableView.reloadData();var bg_box_bottom=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_bottom.png",cc.Rect(40,40,10,10));if(bg_box_bottom.setContentSize(1e3,72),bg_box_bottom.setAnchorPoint(ZERO()),bg_box_bottom.setPosition(ZERO()),layer.addChild(bg_box_bottom),this.setTapNewIcon(),this.m_info_icon=new cc.Sprite(RES_CDN_DEFULT+"new_common/img_mark.png"),this.m_info_icon.setAnchorPoint(0,0),this.m_info_icon.setPosition(30,25),layer.addChild(this.m_info_icon),this.m_info_text=cmLabelEx.getLabel(res_str("label_mail_info_text"),LABEL_FONT_INDEX.FONT_2076),this.m_info_text.enableOutline(new cc.c4b(0,0,0,255),2),this.m_info_text.setAnchorPoint(ZERO()),this.m_info_text.setPosition(ccPosX(this.m_info_icon)+ccWidth(this.m_info_icon)+4,29),layer.addChild(this.m_info_text),tap_index==ACHIEVEMENT_SEQ||tap_index==ACHIEVEMENT_NAMING||tap_index==ACHIEVEMENT_BEGINNER)this.m_info_icon.setVisible(!1),this.m_info_text.setVisible(!1);else if(tap_index==ACHIEVEMENT_WEEK)this.m_info_text.setString(res_str("label_achievement_info_text_week"));else if(tap_index==ACHIEVEMENT_COLLABO)this.m_info_text.setString(res_str("label_achievement_info_text_collabo"));else if(tap_index==ACHIEVEMENT_RAID_BOSS){var info_text=this.getAchvPeriodString(ACHIEVEMENT_RAID_BOSS);this.m_info_text.setString(info_text)}cc.p(0,0);return this.m_all_bonus_btn=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_5_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_5_on.png"),this.m_all_bonus_btn.setContentSize(146,42),this.m_all_bonus_btn.setTitleFont(all_btn_rect,LABEL_FONT_INDEX.FONT_2072,!0,2,cc.color.WHITE,cc.color(128,128,128,255)),this.m_all_bonus_btn.setTitleText(res_str("btn_label_all_accept")),this.m_all_bonus_btn.setBright(!0),this.m_all_bonus_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_all_bonus_btn.setPosition(ccWidth(bg_box)-34,18),this.m_all_bonus_btn.ignoreContentAdaptWithSize(!1),this.m_all_bonus_btn.addClickEventListener(function(){this.sendRewardAllAchievement()}.bind(this)),this.m_all_bonus_btn.setEnabled(this.m_all_achv_reward),layer.addChild(this.m_all_bonus_btn),pos_x=tap_index=null,btn_name_list=[],layer},scrollViewDidScroll:function(view){},scrollViewDidZoom:function(view){},tableCellTouched:function(table,cell){cc.log("cell touched at index: "+cell.getIdx());null!=cell&&cell.touchPosInCell(cell.getTouchPos())},tableCellUnhighlight:function(table,cell){null!=cell&&cell.unhighlightPosInCell(cell.getTouchPos())},tableCellEnded:function(){},tableCellHighlight:function(table,cell){null!=cell&&cell.highlightPosInCell(cell.getTouchPos())},tableCellSizeForIndex:function(table,idx){return cc.size(960,108)},cellSizeForTable:function(table){return cc.size(960,108)},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;cell=null!=c?c:new AchieveListItemCell(this.sendRewardAchievement.bind(this),this.moveAchievementShortcuts.bind(this));var achv_data=this.m_user_achv_list[idx];return cell.setUserAchievement(achv_data,this.m_useShortcut),this.m_achive_cell_list.push(cell),achv_data=null,cell},numberOfCellsInTableView:function(table){return this.m_user_achv_list.length},sendRewardAchievement:function(user_achiv,idx){AudioEngine.getInstance().playNormaButtonSound(),GameContext.getInstance().setSelectAchv(user_achiv),cc.log("RewardAchievement"),this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],NOTIFY_ACHIEVEMENT_RECIEVE)},sendRewardAllAchievement:function(){var audio=AudioEngine.getInstance();audio.stopVoice();var path=RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3";audio.playEffect(path),GameContext.getInstance().setAllAchv(this.m_user_achv_list),MainObserver.getInstance().postNotification(NOTIFY_ACHIEVEMENT_ALL_RECIEVE)},moveAchievementShortcuts:function(user_achiv,idx){if(0<user_achiv.shortcuts_id){var shortcut_info=MasterManager.getInstance().get_AchievementShortcuts(user_achiv.shortcuts_id);if(shortcut_info.shortcuts_type>SHORTCUTS_TYPE_NONE){var is_open=!0;if(shortcut_info.shortcuts_type==SHORTCUTS_TYPE_MISSION&&0<shortcut_info.dungeon_id&&(is_open=MissionService.getInstance().IsOpenMainMission(shortcut_info.dungeon_id)),1==is_open)switch(shortcut_info.shortcuts_type){case SHORTCUTS_TYPE_MISSION:if(SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene),0<shortcut_info.dungeon_id){var context=BattleContext._getInstance();context.setGameType(db.BattleGameType.Mission),context.setMissionID(shortcut_info.dungeon_id),context.showNextMissionPopup(!0)}SceneManager.getInstance().getRunningScene().initLayoutProgress(),(scene=new StorySceneV2).get_story_deferred().done(function(){this.scheduleOnce(function(dt){SceneManager.getInstance().replaceScene(scene,!0),scene=null},1.5,"main_layer_ready")}.bind(this));break;case SHORTCUTS_TYPE_WEEK:SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene),SceneManager.getInstance().getRunningScene().initLayoutProgress(),(scene=new WeeklyEntryScene).get_story_deferred().done(function(){this.scheduleOnce(function(dt){SceneManager.getInstance().replaceScene(scene,!0),scene=null},1.5,"main_layer_ready")}.bind(this));break;case SHORTCUTS_TYPE_EVENT_DUNGEON_1:if(SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene),0==(event_dungeon_period_idx=(e_service=EventDungeonService.getInstance()).getFirstEventDungeonPeriodIdx()))return;BattleContext._getInstance().setEventDungeonPeriodIdX(event_dungeon_period_idx),this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],NOTIFY_MENU_EVENT_DUNGEON_ENTRANCE);break;case SHORTCUTS_TYPE_SHOP:SceneManager.getInstance().getRunningScene().initLayoutProgress(),SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene);var scene=new GachaScene_WebV2(!1,GACHA_TAB_TYPE_HEART);SceneManager.getInstance().replaceScene(scene),scene=null;break;case SHORTCUTS_TYPE_EVENT_DUNGEON_2:SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene);var e_service,event_dungeon_period_idx=(e_service=EventDungeonService.getInstance()).getFirstEventDungeonPeriodIdx();e_service.getSecondEventDungeonPeriodIdx();if(0==event_dungeon_period_idx)return;BattleContext._getInstance().setEventDungeonPeriodIdX(event_dungeon_period_idx),this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],NOTIFY_MENU_EVENT_DUNGEON_ENTRANCE);break;case SHORTCUTS_TYPE_MUSSANG_ROAD:SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene);var req={};req.opcode=net.OP.op_get_user_mussang;var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent,mainScene);break;case SHORTCUTS_TYPE_DAILY_DUNGEON:SceneManager.getInstance().getRunningScene().initLayoutProgress(),SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene);var d_period=MasterTable.getInstance().get_DailyDungeonMaxPeriod();BattleContext._getInstance().setDailyDungeonPeriodIdx(d_period.daily_dungeon_period_idx);scene=new DailyDungeonListScene;SceneManager.getInstance().replaceScene(scene),scene=null;break;case SHORTCUTS_TYPE_YUNHEE_SCENE:SceneManager.getInstance().getRunningScene().initLayoutProgress(),SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene),GameContext.getInstance().setElementTypeFilter(100),GameContext.getInstance().setYunheeTypeFilter(100),GameContext.getInstance().setYunheeTabType(1),GameContext.getInstance().setYunheePrevSceneId(scene_MainHomeScene);scene=new YunheeScene;SceneManager.getInstance().replaceScene(scene),scene=null;break;case SHORTCUTS_TYPE_BATTLE_FORMATION:SceneManager.getInstance().getRunningScene().initLayoutProgress(),SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene);scene=new BattleFormationScene;SceneManager.getInstance().replaceScene(scene),scene=null;break;case SHORTCUTS_TYPE_CAMP_MAGIC_KEY_EXCHANGE:SceneManager.getInstance().getRunningScene().initLayoutProgress(),SceneManager.getInstance().reservedHistoryClearToScene(scene_MainHomeScene);scene=new CampFactoryScene;SceneManager.getInstance().replaceScene(scene),scene=null}else this.m_gameObserver.postNotification(sceneStr[scene_AchievementScene],notification_not_open_mission)}}},chageTapMenu:function(index,reload){switch(this.m_tap_day.setEnabled(!0),this.m_tap_week.setEnabled(!0),this.m_tap_seq.setEnabled(!0),this.m_tap_beginner.setEnabled(!0),1==USE_COLLABO_ACHIEVEMENT&&null!=this.m_tap_collabo&&this.m_tap_collabo.setEnabled(!0),this.m_tap_naming.setEnabled(!0),null!=this.m_tap_raid_boss&&this.m_tap_raid_boss.setEnabled(!0),this.m_info_icon.setPosition(30,25),this.m_info_text.setPosition(ccPosX(this.m_info_icon)+ccWidth(this.m_info_icon)+4,29),index){case ACHIEVEMENT_DAY:this.m_tap_day.setEnabled(!1),this.m_info_icon.setVisible(!0),this.m_info_text.setVisible(!0),this.m_info_text.setString(res_str("label_achievement_info_text_day"));break;case ACHIEVEMENT_WEEK:this.m_tap_week.setEnabled(!1),this.m_info_icon.setVisible(!0),this.m_info_text.setVisible(!0),this.m_info_text.setString(res_str("label_achievement_info_text_week"));break;case ACHIEVEMENT_SEQ:this.m_tap_seq.setEnabled(!1),this.m_info_icon.setVisible(!1),this.m_info_text.setVisible(!1),this.m_info_text.setString(res_str("label_achievement_info_text_seq"));break;case ACHIEVEMENT_BEGINNER:this.m_tap_beginner.setEnabled(!1),this.m_info_icon.setVisible(!1),this.m_info_text.setVisible(!1),this.m_info_text.setString(res_str("label_achievement_info_text_beginner"));break;case ACHIEVEMENT_COLLABO:1==USE_COLLABO_ACHIEVEMENT&&null!=this.m_tap_collabo&&(this.m_tap_collabo.setEnabled(!1),this.m_info_icon.setVisible(!0),this.m_info_text.setVisible(!0),this.m_info_text.setString(res_str("label_achievement_info_text_collabo")));break;case ACHIEVEMENT_NAMING:this.m_tap_naming.setEnabled(!1),this.m_info_icon.setVisible(!1),this.m_info_text.setVisible(!1),this.m_info_text.setString(res_str("label_achievement_info_text_naming"));break;case ACHIEVEMENT_RAID_BOSS:if(null!=this.m_tap_raid_boss){var info_text=this.getAchvPeriodString(ACHIEVEMENT_RAID_BOSS);this.m_tap_raid_boss.setEnabled(!1),this.m_info_icon.setVisible(!0),this.m_info_text.setVisible(!0),this.m_info_text.setString(info_text)}}index==ACHIEVEMENT_BEGINNER||index==ACHIEVEMENT_COLLABO?this.m_useShortcut=!0:this.m_useShortcut=!1,this.m_tableView.setPosition(17,79),this.m_tableView.setViewSize(cc.size(960,414)),this.m_tableView.reloadData(),this.setTapNewIcon(),this.m_all_bonus_btn.setEnabled(this.m_all_achv_reward)},setTapNewIcon:function(){var achv_service=AchievementService.getInstance(),day_count=achv_service.getUserAchievementCompleteCount(ACHIEVEMENT_DAY);this.m_day_new.setVisible(day_count);var week_count=achv_service.getUserAchievementCompleteCount(ACHIEVEMENT_WEEK);this.m_week_new.setVisible(week_count);var seq_count=achv_service.getUserAchievementCompleteCount(ACHIEVEMENT_SEQ);this.m_seq_new.setVisible(seq_count);var beginner_count=achv_service.getUserAchievementCompleteCount(ACHIEVEMENT_BEGINNER);null!=this.m_beginner_new&&this.m_beginner_new.setVisible(beginner_count);var collabo_count=achv_service.getUserAchievementCompleteCount(ACHIEVEMENT_COLLABO);null!=this.m_collabo_new&&this.m_collabo_new.setVisible(collabo_count);var naming_count=achv_service.getUserAchievementCompleteCount(ACHIEVEMENT_NAMING);null!=this.m_naming_new&&this.m_naming_new.setVisible(naming_count);var raid_boss_count=achv_service.getUserAchievementCompleteCount(ACHIEVEMENT_RAID_BOSS);null!=this.m_raid_boss_new&&this.m_raid_boss_new.setVisible(raid_boss_count)},setUserAchivList:function(){var pre_offset=cc.p(this.m_tableView.getContentOffset().x,this.m_tableView.getContentOffset().y);this.m_tableView.reloadData(),pre_offset.y>this.m_tableView.minContainerOffset().y&&this.m_tableView.setContentOffset(pre_offset,!1),this.m_all_bonus_btn.setEnabled(this.m_all_achv_reward),this.setTapNewIcon()},getAchvPeriodString:function(achv_type){var achv_period,date_str="";if(0<(achv_period=MasterTable.getInstance().get_AchievementPeriodByType(achv_type)).period_id){var end_dt=moment(achv_period.end_dt).valueOf(),e=moment(end_dt);date_str=cmString(cmString(res_str("label_achievement_info_text_raid_boss"),e.get("month")+1,e.get("date"),e.month(),e.date()))}else date_str=res_str("label_achievement_info_text_seq");return date_str},onExit:function(){this._super(),1!=PREV_MISSION&&(this.m_tap_day=null,this.m_tap_week=null,this.m_tap_seq=null,this.m_beginner_new=null,this.m_collabo_new=null,this.m_day_new=null,this.m_week_new=null,this.m_seq_new=null,this.m_tap_beginner=null,this.m_tap_collabo=null,this.m_tableView=null,this.m_info_icon=null,this.m_info_text=null,this.m_useShortcut=null,this.m_user_achv_list=null,this.m_bgBoxLayer=null,this.help_btn=null,this.m_gameObserver=null,this.m_tap_naming=null,this.m_naming_new=null,this.m_achive_cell_list.forEach(function(t){t.removeAllChildrenWithCleanup(!0)}),this.m_achive_cell_list=[])}}),BookGeneralEnum={btn_character_change:100,btn_voice:101,btn_yunhee_love_show:102,btn_character_love_level:103,btn_show_love_cg:104,btn_show_resistance_help:105,btn_show_standing_detail_view:106},BooksGeneralLayer=cc.Layer.extend({m_skeleton_action_index:null,m_scrollContentLayer:null,m_skeletonNode:null,m_resistanceLayer:null,m_scrollLayer:null,m_info_btn:null,m_resistance_btn:null,m_title_label:null,m_voiceScrollLayer:null,ctor:function(){this._super(),this.m_skeleton_action_index=0,this.m_scrollContentLayer=null,this.m_skeletonNode=null,this.m_resistanceLayer=null,this.m_scrollLayer=null,this.m_info_btn=null,this.m_resistance_btn=null,this.m_title_label=null,this.m_bookGeneral=null,this.m_voiceScrollLayer=null},initLayout:function(){var leftBottomLayer=this.getLeftBottomLayer();leftBottomLayer.setPosition(cc.p(0,0)),this.addChild(leftBottomLayer);var rightBoxLayer=this.getRightBoxLayer();rightBoxLayer.ignoreAnchorPointForPosition(!1),rightBoxLayer.setAnchorPoint(cc.p(1,0)),rightBoxLayer.setPosition(this.width,0),this.addChild(rightBoxLayer)},setBookGeneralInfo:function(bookGeneral){this.m_bookGeneral=bookGeneral},getLeftBottomLayer:function(){var layer=new cc.Layer;layer.setContentSize(this.width-478,320);var name_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_namebox.png");name_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),name_box.setPosition(layer.width/2,0),layer.addChild(name_box);var gnrl_name=cmLabel.getLabel(this.m_bookGeneral.name,LABEL_FONT_INDEX.FONT_261);gnrl_name.setAnchorPoint(ANCHOR_MIDDLE()),gnrl_name.setPosition(ccCenter(name_box)),name_box.addChild(gnrl_name),cmLabel.autoSizeFit(gnrl_name,186,26);var rare_type_sprite=this.getRareTypeSprite();rare_type_sprite.setAnchorPoint(cc.p(.5,0)),rare_type_sprite.setPosition(layer.width/2,84),layer.addChild(rare_type_sprite);var cgOnOffBtn=new ccui.Button;cgOnOffBtn.loadTextures("btn_purple_circle_cg_off.png","btn_purple_circle_cg_on.png","",ccui.Widget.PLIST_TEXTURE),cgOnOffBtn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),cgOnOffBtn.setPosition(cc.p(ccWidth(layer)-6,9)),layer.addChild(cgOnOffBtn),cgOnOffBtn.addClickEventListener(function(target){var g=MasterManager.getInstance().get_General(this.m_bookGeneral.gnrl_id);this.getParent().m_bookGeneral.is_max_love_level&&99999!=g.love_cg_num&&19!=g.gnrl_group&&0<g.love_cg_num&&(GameContext.getInstance().setLoveCgGnrlId(g.gnrl_id),MainObserver.getInstance().postNotification(sceneStr[scene_BooksGeneralScene],btn_yunhee_love_show))}.bind(this)),this.m_bookGeneral.gender_type==GENDER_TYPE_M&&cgOnOffBtn.loadTextures("btn_purple_circle_cgman_off.png","btn_purple_circle_cgman_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_bookGeneral.is_max_love_level&&this.m_bookGeneral.gnrl_type!=GENERAL_TYPE_SOLDIER||(cgOnOffBtn.loadTextures("btn_gray_circle_cg_off.png","btn_gray_circle_cg_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_bookGeneral.gender_type!=GENDER_TYPE_M&&this.m_bookGeneral.gnrl_type!=GENERAL_TYPE_SOLDIER||cgOnOffBtn.loadTextures("btn_gray_circle_cgman_off.png","btn_gray_circle_cgman_on.png","",ccui.Widget.PLIST_TEXTURE)),19==this.m_bookGeneral.gnrl_group&&cgOnOffBtn.loadTextures("btn_gray_circle_cgman_off.png","btn_gray_circle_cgman_on.png","",ccui.Widget.PLIST_TEXTURE);var characterChangeBtn=new ccui.Button;characterChangeBtn.loadTextures("btn_purple_circle_change_off.png","btn_purple_circle_change_on.png","",ccui.Widget.PLIST_TEXTURE),characterChangeBtn.setAnchorPoint(cc.p(0,0)),characterChangeBtn.setPosition(cc.p(6,9)),layer.addChild(characterChangeBtn),characterChangeBtn.addClickEventListener(function(){MainObserver.getInstance().postNotification(sceneStr[scene_BooksGeneralScene],BookGeneralEnum.btn_character_change)}.bind(this)),453==this.m_bookGeneral.gnrl_group&&(cgOnOffBtn.loadTextures("btn_purple_circle_cgman_off.png","btn_purple_circle_cgman_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_bookGeneral.is_max_love_level&&this.m_bookGeneral.gnrl_type!=GENERAL_TYPE_SOLDIER||cgOnOffBtn.loadTextures("btn_gray_circle_cgman_off.png","btn_gray_circle_cgman_on.png","",ccui.Widget.PLIST_TEXTURE),characterChangeBtn.loadTextures("btn_purple_circle_change_off.png","btn_purple_circle_change_on.png","",ccui.Widget.PLIST_TEXTURE));var standingDisplayBtn=new ccui.Button;return standingDisplayBtn.loadTextures("btn_purple_circle_zoom_off.png","btn_purple_circle_zoom_on.png","",ccui.Widget.PLIST_TEXTURE),standingDisplayBtn.setAnchorPoint(ZERO),standingDisplayBtn.setPosition(6,79),layer.addChild(standingDisplayBtn),standingDisplayBtn.addClickEventListener(function(sender){var detail_gnrl={};detail_gnrl.gnrl_id=this.m_bookGeneral.gnrl_id,detail_gnrl.gnrl_num=0,detail_gnrl.display_class=this.m_bookGeneral.gnrl_class,GameContext.getInstance().setDetailStandingGnrlId(detail_gnrl),MainObserver.getInstance().postNotification(sceneStr[scene_BooksGeneralScene],BookGeneralEnum.btn_show_standing_detail_view)}.bind(this)),layer},getRightBoxLayer:function(){var layer=new cc.Layer,right_bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));right_bg_box.setContentSize(478,568),right_bg_box.setAnchorPoint(ZERO()),right_bg_box.setPosition(ZERO()),layer.addChild(right_bg_box),layer.setContentSize(right_bg_box.getContentSize()),this.m_bookGeneral.gnrl_type!=GENERAL_TYPE_EVOLVE_MATERIAL&&this.m_bookGeneral.gnrl_type!=GENERAL_TYPE_MATERIAL&&this.m_bookGeneral.gnrl_type!=GENERAL_TYPE_LIMIT_OVER&&(this.m_info_btn=new LabelButton("btn_09_none.png","btn_10_on.png","btn_10_off.png",ccui.Widget.PLIST_TEXTURE),this.m_info_btn.setAnchorPoint(cc.p(1,0)),this.m_info_btn.setFont(LABEL_FONT_INDEX.FONT_221),this.m_info_btn.setString(""),this.m_info_btn.setPosition(cc.p(5,464)),right_bg_box.addChild(this.m_info_btn),this.m_info_btn.setEnabled(!1),this.m_info_btn.addClickEventListener(function(){this.m_resistance_btn.setEnabled(!0),this.m_info_btn.setEnabled(!1),1==USE_BOOK_DETAIL_VOICE&&this.m_voice_btn.setEnabled(!0),this.m_scrollLayer.setVisible(!0),this.m_scrollLayer.setContentOffset(OffsetType.jumpToTop),this.m_resistanceLayer.setVisible(!1),1==USE_BOOK_DETAIL_VOICE&&this.m_voiceScrollLayer.setVisible(!1),this.m_title_label.setString("")}.bind(this)),this.m_resistance_btn=new LabelButton("btn_09_none.png","btn_10_on.png","btn_10_off.png",ccui.Widget.PLIST_TEXTURE),this.m_resistance_btn.setAnchorPoint(cc.p(1,0)),this.m_resistance_btn.setFont(LABEL_FONT_INDEX.FONT_221),this.m_resistance_btn.setString(""),this.m_resistance_btn.setPosition(cc.p(5,394)),right_bg_box.addChild(this.m_resistance_btn),this.m_resistance_btn.addClickEventListener(function(){this.m_resistance_btn.setEnabled(!1),this.m_info_btn.setEnabled(!0),1==USE_BOOK_DETAIL_VOICE&&this.m_voice_btn.setEnabled(!0),this.m_scrollLayer.setVisible(!1),this.m_resistanceLayer.setVisible(!0),1==USE_BOOK_DETAIL_VOICE&&this.m_voiceScrollLayer.setVisible(!1),this.m_title_label.setString("")}.bind(this)),1==USE_BOOK_DETAIL_VOICE&&(this.m_voice_btn=new LabelButton("btn_09_none.png","btn_10_on.png","btn_10_off.png",ccui.Widget.PLIST_TEXTURE),this.m_voice_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_voice_btn.setFont(LABEL_FONT_INDEX.FONT_161),this.m_voice_btn.setString(res_str("btn_label_voice")),this.m_voice_btn.setPosition(5,324),right_bg_box.addChild(this.m_voice_btn),this.m_voice_btn.addClickEventListener(function(sender){this.m_resistance_btn.setEnabled(!0),this.m_info_btn.setEnabled(!0),this.m_voice_btn.setEnabled(!1),this.m_scrollLayer.setVisible(!1),this.m_resistanceLayer.setVisible(!1),this.m_voiceScrollLayer.setVisible(!0),this.m_title_label.setString(res_str("voice_list_title"))}.bind(this))));var left_navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");return left_navi.setAnchorPoint(cc.p(0,0)),left_navi.setPosition(8,509),right_bg_box.addChild(left_navi),this.m_title_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_261),this.m_title_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_title_label.setPosition(ccCenter(left_navi)),left_navi.addChild(this.m_title_label),this.m_scrollLayer=new ScrollLayer,this.m_scrollLayer.setContentSize(447,487),this.m_scrollLayer.getItemNode=function(contentSize,m){return this.m_scrollContentLayer=this.getDetailContentLayer(),this.m_scrollContentLayer}.bind(this),this.m_scrollLayer.initLayout(),this.m_scrollLayer.setPosition(17,15),right_bg_box.addChild(this.m_scrollLayer),this.m_resistanceLayer=this.getResistanceLayer(),this.m_resistanceLayer.ignoreAnchorPointForPosition(!1),this.m_resistanceLayer.setAnchorPoint(cc.p(.5,1)),this.m_resistanceLayer.setPosition(right_bg_box.width/2,right_bg_box.height-61),right_bg_box.addChild(this.m_resistanceLayer),cc.log(right_bg_box.getContentSize()),this.m_resistanceLayer.setVisible(!1),1==USE_BOOK_DETAIL_VOICE&&(this.m_voiceScrollLayer=this.getVoiceListLayer(),this.m_voiceScrollLayer.setPosition(17,23),right_bg_box.addChild(this.m_voiceScrollLayer),this.m_voiceScrollLayer.setVisible(!1)),layer},getResistanceLayer:function(){var layer=new cc.Layer,bg_box=new cc.Scale9Sprite(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",cc.Rect(20,20,20,20));bg_box.setContentSize(444,362),bg_box.setAnchorPoint(cc.p(0,0)),bg_box.setPosition(cc.p(0,0)),layer.addChild(bg_box);var tableLayer=this.getTableLayer();tableLayer.setEnableMouseScroll(!1),tableLayer.setPosition(5,20),layer.addChild(tableLayer),layer.setContentSize(ccSize(bg_box));var btn=new LabelButton("btn_21_off.png","btn_21_on.png","",ccui.Widget.PLIST_TEXTURE);return btn.setAnchorPoint(cc.p(1,1)),btn.setFont(LABEL_FONT_INDEX.FONT_221),btn.setString(""),btn.setPosition(cc.p(bg_box.width,0)),bg_box.addChild(btn),btn.addClickEventListener(function(){MainObserver.getInstance().postNotification(sceneStr[scene_BooksGeneralScene],BookGeneralEnum.btn_show_resistance_help)}),layer},getVoiceListLayer:function(){MasterTable.getInstance();var listLayer=new ScrollLayer;return listLayer.setContentSize(447,487),listLayer.getItemNode=function(contentSize,m){var height=0,scrollLayer=new ScrollLayer,list=MasterTable.getInstance().get_Voice_List();list.reverse();for(var i=0;i<list.length;i++){var l=list[i],layer=this.getVoiceContentLayer(l);null!=layer&&(layer.setPosition(0,height),scrollLayer.addChild(layer),height+=ccHeight(layer))}if(scrollLayer.setContentSize(444,height),height<487){var y=487-height;scrollLayer.setPosition(0,y)}return scrollLayer}.bind(this),listLayer.initLayout(),listLayer},getVoiceContentLayer:function(list){var layer=new cc.Layer,bg_box=(MasterTable.getInstance(),cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_5.png",cc.Rect(20,20,20,20)));bg_box.setAnchorPoint(ZERO()),bg_box.setContentSize(444,76),bg_box.setPosition(ZERO()),bg_box.setName("bg_box"),layer.addChild(bg_box);var circle=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_white.png");circle.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),circle.setPosition(15,ccCenter(bg_box).y),bg_box.addChild(circle);var voice_name=cmLabel.getLabel(list.list_name,LABEL_FONT_INDEX.FONT_201);voice_name.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),voice_name.setPosition(30,ccCenter(bg_box).y),bg_box.addChild(voice_name);var voice_btn=new ccui.Button;return voice_btn.loadTextures("btn_voice_off.png","btn_voice_on.png","",ccui.Widget.PLIST_TEXTURE),voice_btn.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),voice_btn.setPosition(ccWidth(bg_box)-12,ccCenter(bg_box).y),bg_box.addChild(voice_btn),voice_btn.addClickEventListener(function(sender){this.play_voice(list.list_type,list.list_division)}.bind(this)),layer.setContentSize(ccSize(bg_box)),this.scheduleUpdate(),layer},play_voice:function(voice_type,division){var m=MasterTable.getInstance(),audio=AudioEngine.getInstance(),voice=m.get_Voice_V2(this.m_bookGeneral.gnrl_id,voice_type,division,0);if(""!=voice&&null!=voice){var path=RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3";audio.playVoice(path,!1)}},update:function(dt){},getTableLayer:function(){var tableLayer=new TableViewLayer;return tableLayer.setAnchorPoint(ZERO()),tableLayer.setContentSize(434,324),tableLayer.setColumnCount(1),tableLayer.setItemCount(8),tableLayer.getItemNode=function(index,contentSize,margin){return new YunheeResistanceItemLayer(index,this.m_bookGeneral.gnrl_id)}.bind(this),tableLayer.initLayout(),tableLayer.setTouchScrollEnabled(!1),tableLayer.onItemTouchBegin=function(index){return!0},tableLayer.onItemTouchMoved=function(index){return!0},tableLayer.onItemTouchEnd=function(index){return!0},tableLayer.onMouseScroll=function(){return!0},tableLayer},getDetailContentLayer:function(){var layer=new cc.Layer,offset_y=0,voiceActorLayer=this.getVoiceActorLayer();voiceActorLayer.setPosition(0,offset_y),layer.addChild(voiceActorLayer),offset_y+=ccHeight(voiceActorLayer);var explanationLayer=this.getExplanationLayer();explanationLayer.setPosition(0,offset_y),layer.addChild(explanationLayer),offset_y+=ccHeight(explanationLayer);var leaderSkillLayer=this.getLeaderSkillLayer();leaderSkillLayer.setPosition(0,offset_y),layer.addChild(leaderSkillLayer),offset_y+=ccHeight(leaderSkillLayer);var passiveSkillLayer=this.getPassiveSkillLayer();passiveSkillLayer.setPosition(0,offset_y),layer.addChild(passiveSkillLayer),offset_y+=ccHeight(passiveSkillLayer);var activeSkillLayer=this.getActiveSkillLayer();activeSkillLayer.setPosition(0,offset_y),layer.addChild(activeSkillLayer),offset_y+=ccHeight(activeSkillLayer);var statLayer=this.getStatLayer();statLayer.setPosition(0,offset_y),layer.addChild(statLayer),offset_y+=ccHeight(statLayer);var levelGaugeLayer=this.getLevelGaugeLayer();return levelGaugeLayer.setPosition(0,offset_y),layer.addChild(levelGaugeLayer),offset_y+=ccHeight(levelGaugeLayer),layer.setContentSize(explanationLayer.width,offset_y),layer},getVoiceActorLayer:function(){var layer=new cc.Layer,boxSize=cc.size(444,76),info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());info_box.setPreferredSize(boxSize),info_box.setAnchorPoint(cc.p(0,0)),info_box.setPosition(cc.p(0,0)),layer.addChild(info_box);var cv_title=cmLabel.getLabel("CV ",LABEL_FONT_INDEX.FONT_201);cv_title.setPosition(26,ccCenter(info_box).y),info_box.addChild(cv_title);var actor=MasterTable.getInstance().getMasterTable().get_VoiceActor(this.m_bookGeneral.gnrl_id),offset_x=cv_title.x+cv_title.width+5,actor_label=cmLabel.getLabel(actor.name,LABEL_FONT_INDEX.FONT_201);info_box.addChild(actor_label);var actSize=actor_label.getContentSize();return boxSize.height=Math.max(boxSize.height,actSize.height+30),76==boxSize.height?(cv_title.setAnchorPoint(cc.p(0,.5)),actor_label.setAnchorPoint(cc.p(0,.5)),cv_title.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),actor_label.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),cv_title.setPosition(26,.5*boxSize.height),actor_label.setPosition(offset_x,.5*boxSize.height)):(cv_title.setAnchorPoint(cc.p(0,1)),actor_label.setAnchorPoint(cc.p(0,1)),cv_title.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),actor_label.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),cv_title.setPosition(26,boxSize.height-15),actor_label.setPosition(offset_x,boxSize.height-15)),info_box.setPreferredSize(boxSize),layer.setContentSize(boxSize),layer},getExplanationLayer:function(){var layer=new cc.Layer,info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());info_box.setContentSize(444,106),info_box.setInsetBottom(13),info_box.setInsetLeft(13),info_box.setInsetRight(13),info_box.setInsetTop(13),info_box.setAnchorPoint(cc.p(0,0)),info_box.setPosition(cc.p(0,0)),layer.addChild(info_box);var label=cmLabel.getLabel(this.m_bookGeneral.content,LABEL_FONT_INDEX.FONT_161);return label.setAnchorPoint(cc.p(0,1)),label.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),label.setTextAreaSize(cc.size(400,0)),label.ignoreContentAdaptWithSize(!1),label.setPosition(18,info_box.height-20),info_box.addChild(label),info_box.setContentSize(444,label.height+40),label.setPosition(18,info_box.height-20),layer.setContentSize(info_box.getContentSize()),layer},getLeaderSkillLayer:function(){var layer=new cc.Layer,m=MasterTable.getInstance().getMasterTable(),bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());bg_box.setPreferredSize(cc.size(444,132)),bg_box.setAnchorPoint(cc.p(0,0)),bg_box.setPosition(cc.p(0,0)),layer.addChild(bg_box),layer.setContentSize(bg_box.getContentSize());var frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");frame.setAnchorPoint(cc.p(0,0)),frame.setPosition(14,23),bg_box.addChild(frame);var is_exist_leader_skill=!1,icon=cc.Sprite.create();icon.setAnchorPoint(cc.p(.5,.5)),icon.setPosition(frame.width/2,frame.height/2),frame.addChild(icon);var name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812);name.setAnchorPoint(cc.p(0,0)),name.setPosition(91,73),bg_box.addChild(name);var box_height=132,desc_height=64,desc=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_144);desc.setAnchorPoint(cc.p(0,1)),desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),desc.setTextAreaSize(cc.size(320,desc_height)),desc.ignoreContentAdaptWithSize(!1),desc.setPosition(91,73),bg_box.addChild(desc);is_exist_leader_skill=!1;for(var idx=0;idx<this.m_bookGeneral.leader_skill.length;idx++)if(0!=this.m_bookGeneral.leader_skill[idx]&&99999!=this.m_bookGeneral.leader_skill[idx]){var skill=m.get_LeaderSkill(this.m_bookGeneral.leader_skill[idx]);icon.setTexture(RES_CDN_DEFULT+"icon/leader/leader_"+skill.skill_icon+".png");frame.getContentSize;name.setString(skill.name),desc.setString(skill.content),is_exist_leader_skill=!0;break}if(!is_exist_leader_skill)for(idx=0;idx<this.m_bookGeneral.special_leader_skill.length;idx++)if(0!=this.m_bookGeneral.special_leader_skill[idx]&&99999!=this.m_bookGeneral.special_leader_skill[idx]){skill=m.get_SpecialLeaderSkill(this.m_bookGeneral.special_leader_skill[idx]);icon.setTexture(RES_CDN_DEFULT+"icon/leader/leader_"+skill.skill_icon+".png"),name.setString(skill.name),desc.setString(skill.content);break}var f_size=desc.getFontSize(),s_lengh=desc.getString().length;desc_height=Math.ceil((s_lengh*f_size+320)/320)*(f_size+2),64<ccHeight(desc)&&(box_height+=ccHeight(desc)-64),desc_height=Math.max(64,desc_height),desc.setTextAreaSize(cc.size(320,desc_height)),bg_box.setContentSize(444,box_height),layer.setContentSize(ccSize(bg_box)),frame.setPosition(14,ccHeight(bg_box)-109);var circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_leader.png");circle_point.setAnchorPoint(cc.p(0,0)),circle_point.setPosition(17,ccHeight(bg_box)-28),bg_box.addChild(circle_point);var title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2037);return title.setAnchorPoint(cc.p(0,0)),title.setPosition(30,ccHeight(bg_box)-34),bg_box.addChild(title),name.setPosition(91,ccHeight(bg_box)-59),desc.setPosition(91,ccHeight(bg_box)-59),layer},getPassiveSkillLayer:function(){var layer=new cc.Layer,m=MasterTable.getInstance().getMasterTable(),bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());bg_box.setAnchorPoint(cc.p(0,0)),bg_box.setPosition(cc.p(0,0)),layer.addChild(bg_box);var frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");frame.setAnchorPoint(cc.p(0,0)),bg_box.addChild(frame);var name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812);name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bg_box.addChild(name);var desc=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_144);desc.setAnchorPoint(ANCHOR_TOP_LEFT()),desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),desc.setTextAreaSize(cc.size(320,64)),desc.ignoreContentAdaptWithSize(!1),bg_box.addChild(desc);var icon=cc.Sprite.create();icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(frame)),frame.addChild(icon);for(var box_height=132,desc_height=64,is_exist_passive=!1,idx=0;idx<this.m_bookGeneral.passive_skill.length;idx++)if(99999!=this.m_bookGeneral.passive_skill[idx]&&0!=this.m_bookGeneral.passive_skill[idx]){if(0!=(skill=m.get_PassiveSkillV2(this.m_bookGeneral.passive_skill[idx])).skill_icon&&null!=skill.skill_icon&&null!=skill.skill_icon)if(USE_ACTIVE_PASSIVE_ICON)icon.setTexture(RES_CDN_DEFULT+"icon/passive/passive_"+skill.skill_icon+".png");else{var icon_name="passive_"+skill.skill_icon+".png",icon_tex=cc.spriteFrameCache.getSpriteFrame(icon_name);icon.setSpriteFrame(icon_tex)}name.setString(skill.name),desc.setString(skill.content);var f_size=desc.getFontSize(),s_lengh=desc.getString().length,line_length=320;desc_height=Math.ceil((s_lengh*f_size+line_length)/line_length)*(f_size+2),is_exist_passive=!0}if(!is_exist_passive&&1!=this.m_bookGeneral.gnrl_class)for(idx=0;idx<this.m_bookGeneral.trans_passive_skill.length;idx++)if(99999!=this.m_bookGeneral.trans_passive_skill[idx]&&0!=this.m_bookGeneral.trans_passive_skill[idx]){var skill=m.get_TransPassiveSkill(this.m_bookGeneral.trans_passive_skill[idx]);if(USE_ACTIVE_PASSIVE_ICON)icon.setTexture(RES_CDN_DEFULT+"icon/passive/passive_"+skill.skill_icon+".png");else{icon_name="passive_"+skill.skill_icon+".png",icon_tex=cc.spriteFrameCache.getSpriteFrame(icon_name);icon.setSpriteFrame(icon_tex)}name.setString(skill.name),desc.setString(skill.content);f_size=desc.getFontSize(),s_lengh=desc.getString().length,line_length=320;desc_height=Math.ceil((s_lengh*f_size+line_length)/line_length)*(f_size+2)}desc_height=Math.max(64,desc_height),desc.setTextAreaSize(cc.size(320,desc_height)),64<ccHeight(desc)&&(box_height+=ccHeight(desc)-64),bg_box.setContentSize(444,box_height),layer.setContentSize(ccSize(bg_box)),frame.setPosition(14,ccHeight(bg_box)-109);var circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_passive.png");circle_point.setAnchorPoint(cc.p(0,0)),circle_point.setPosition(17,ccHeight(bg_box)-28),bg_box.addChild(circle_point);var title=cmLabel.getLabel(res_str("label_info_skill_passive"),LABEL_FONT_INDEX.FONT_2036);return title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(30,ccHeight(bg_box)-34),bg_box.addChild(title),name.setPosition(91,ccHeight(bg_box)-59),desc.setPosition(91,ccHeight(bg_box)-59),layer},getActiveSkillLayer:function(){var layer=new cc.Layer,m=MasterManager.getInstance(),bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());bg_box.setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),layer.addChild(bg_box);var frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");frame.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),frame.setPosition(14,23),bg_box.addChild(frame);var box_height=132,name=null,desc=null;if(0!=this.m_bookGeneral.active_skill){var icon,skill=m.get_ActiveSkill(this.m_bookGeneral.active_skill);if(USE_ACTIVE_PASSIVE_ICON)(icon=cc.Sprite.create(RES_CDN_DEFULT+"icon/active/active_"+skill.skill_group+".png")).setContentSize(60,60),icon.setAnchorPoint(cc.p(.5,.5)),icon.setPosition(frame.width/2,frame.height/2),frame.addChild(icon);else(icon=cc.Sprite.create("#active_"+skill.skill_group+".png")).setAnchorPoint(cc.p(.5,.5)),icon.setPosition(frame.width/2,frame.height/2),frame.addChild(icon);(name=cmLabel.getLabel(skill.name,LABEL_FONT_INDEX.FONT_1812)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),name.setPosition(91,73),bg_box.addChild(name);var line=SKILLLINECOUNT(skill,27);(desc=cmLabel.getLabel(skill.content,LABEL_FONT_INDEX.FONT_144)).setAnchorPoint(ANCHOR_TOP_LEFT()),desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),desc.setTextAreaSize(cc.size(320,17*line)),desc.ignoreContentAdaptWithSize(!1),desc.setPosition(91,73),bg_box.addChild(desc),64<ccHeight(desc)&&(box_height+=ccHeight(desc)-64)}bg_box.setContentSize(444,box_height),layer.setContentSize(ccSize(bg_box)),frame.setPosition(14,ccHeight(bg_box)-109),0!=this.m_bookGeneral.active_skill&&(name.setPosition(91,ccHeight(bg_box)-59),desc.setPosition(91,ccHeight(bg_box)-59));var circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_active.png");circle_point.setAnchorPoint(cc.p(0,0)),circle_point.setPosition(17,ccHeight(bg_box)-28),bg_box.addChild(circle_point);var title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2035);return title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(30,ccHeight(bg_box)-34),bg_box.addChild(title),layer},getStatLayer:function(){var layer=new cc.Layer,info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());info_box.setContentSize(444,238),info_box.setInsetBottom(13),info_box.setInsetLeft(13),info_box.setInsetRight(13),info_box.setInsetTop(13),info_box.setAnchorPoint(cc.p(0,0)),info_box.setPosition(cc.p(0,0)),layer.addChild(info_box);for(var i=0;i<10;++i){var box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero());box.setContentSize(208,38),box.setAnchorPoint(cc.p(0,0)),info_box.addChild(box);var label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812);label.setAnchorPoint(cc.p(0,.5)),label.setPosition(8,box.height/2),box.addChild(label),0==i?(box.setPosition(11,182),label.setString("")):1==i?(box.setPosition(11,141),label.setString("")):2==i?(box.setPosition(11,100),label.setString("")):3==i?(box.setPosition(11,59),label.setString("")):4==i?(box.setPosition(11,18),label.setString("")):5==i?(box.setPosition(225,182),label.setString("")):6==i?(box.setPosition(225,141),label.setString("")):7==i?(box.setPosition(225,100),label.setString("")):8==i?(box.setPosition(225,59),label.setString("")):9==i&&(box.setPosition(225,18),label.setString(""))}var atk_label=cmLabel.getLabel(this.m_bookGeneral.attk.toLocaleString("en"),LABEL_FONT_INDEX.FONT_201);atk_label.setAnchorPoint(cc.p(1,.5)),atk_label.setPosition(212,202),info_box.addChild(atk_label);var def_label=cmLabel.getLabel(this.m_bookGeneral.def.toLocaleString("en"),LABEL_FONT_INDEX.FONT_201);def_label.setAnchorPoint(cc.p(1,.5)),def_label.setPosition(426,202),info_box.addChild(def_label);var hp_label=cmLabel.getLabel(this.m_bookGeneral.hp.toLocaleString("en"),LABEL_FONT_INDEX.FONT_201);hp_label.setAnchorPoint(cc.p(1,.5)),hp_label.setPosition(212,161),info_box.addChild(hp_label);var sp_label=cmLabel.getLabel(this.m_bookGeneral.sp.toLocaleString("en"),LABEL_FONT_INDEX.FONT_201);sp_label.setAnchorPoint(cc.p(1,.5)),sp_label.setPosition(426,161),info_box.addChild(sp_label);var cri_prcnt_label=cmLabel.getLabel(this.m_bookGeneral.cri_prcnt.toFixed(1)+"%",LABEL_FONT_INDEX.FONT_201);cri_prcnt_label.setAnchorPoint(cc.p(1,.5)),cri_prcnt_label.setPosition(212,119),info_box.addChild(cri_prcnt_label);var cri_dmg_label=cmLabel.getLabel(this.m_bookGeneral.cri_ratio.toFixed(1)+"%",LABEL_FONT_INDEX.FONT_201);cri_dmg_label.setAnchorPoint(cc.p(1,.5)),cri_dmg_label.setPosition(427,119),info_box.addChild(cri_dmg_label);var def_prcnt_label=cmLabel.getLabel(this.m_bookGeneral.guard_rate.toFixed(1)+"%",LABEL_FONT_INDEX.FONT_201);def_prcnt_label.setAnchorPoint(cc.p(1,.5)),def_prcnt_label.setPosition(212,78),info_box.addChild(def_prcnt_label);var def_decrease_label=cmLabel.getLabel(this.m_bookGeneral.guard_decrease.toFixed(1)+"%",LABEL_FONT_INDEX.FONT_201);def_decrease_label.setAnchorPoint(cc.p(1,.5)),def_decrease_label.setPosition(427,78),info_box.addChild(def_decrease_label);var generalService=GeneralService.getInstance(),arm_service_type_name=generalService.getGeneralArmpServiceType(this.m_bookGeneral.arm_service_type),arm_service_type_label=cmLabel.getLabel(arm_service_type_name,LABEL_FONT_INDEX.FONT_201);arm_service_type_label.setAnchorPoint(cc.p(1,.5)),arm_service_type_label.setPosition(212,37),info_box.addChild(arm_service_type_label);var state_type_name=generalService.getGeneralStateType(this.m_bookGeneral.state_type),state_type_label=cmLabel.getLabel(state_type_name,LABEL_FONT_INDEX.FONT_201);return state_type_label.setAnchorPoint(cc.p(1,.5)),state_type_label.setPosition(426,37),info_box.addChild(state_type_label),layer.setContentSize(info_box.getContentSize()),layer},getLevelGaugeLayer:function(){var layer=new cc.Layer,info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());info_box.setContentSize(444,56),info_box.setInsetBottom(13),info_box.setInsetLeft(13),info_box.setInsetRight(13),info_box.setInsetTop(13),info_box.setAnchorPoint(cc.p(0,0)),info_box.setPosition(cc.p(0,0)),layer.addChild(info_box),layer.setContentSize(info_box.getContentSize());var cost_label=cmLabel.getLabel("COST",LABEL_FONT_INDEX.FONT_201);cost_label.setAnchorPoint(cc.p(0,.5)),cost_label.setPosition(27,info_box.height/2),info_box.addChild(cost_label);var user_cost_label=cmLabel.getLabel(this.m_bookGeneral.cost,LABEL_FONT_INDEX.FONT_261);return user_cost_label.setAnchorPoint(cc.p(0,.5)),user_cost_label.setPosition(94,layer.height/2),layer.addChild(user_cost_label),layer},getRareTypeSprite:function(){var rare_type_mark=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_unique_"+leadingZeros(this.m_bookGeneral.rare_type,2)+".png");if(this.m_bookGeneral.gnrl_type!=GENERAL_TYPE_MATERIAL){var class_type_star_path;this.m_bookGeneral.rare_type==RARE_TYPE_N||this.m_bookGeneral.rare_type==RARE_TYPE_HN?class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_n.png":this.m_bookGeneral.rare_type==RARE_TYPE_R?class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_r.png":this.m_bookGeneral.rare_type==RARE_TYPE_HR?class_type_star_path=RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_hr.png":this.m_bookGeneral.rare_type==RARE_TYPE_SR?class_type_star_path=3<this.m_bookGeneral.gnrl_class?RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_ss_2.png":RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_s.png":this.m_bookGeneral.rare_type==RARE_TYPE_SSR&&(class_type_star_path=3<this.m_bookGeneral.gnrl_class?RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_ss_2.png":RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_ss.png");for(var class_star_layer=new cc.Layer,i=1;i<this.m_bookGeneral.gnrl_class;++i){var class_type_star=cc.Sprite.create(class_type_star_path);class_type_star.setAnchorPoint(cc.p(0,0)),class_type_star.setPosition(28*(i-1),0),class_star_layer.addChild(class_type_star)}class_star_layer.setContentSize(28*(this.m_bookGeneral.gnrl_class-1),29),class_star_layer.ignoreAnchorPointForPosition(!1),class_star_layer.setAnchorPoint(cc.p(.5,0)),class_star_layer.setPosition(rare_type_mark.width/2,67),rare_type_mark.addChild(class_star_layer)}else{-1!=res_img_yh_exp.indexOf(this.m_bookGeneral.rare_type)&&rare_type_mark.setTexture(RES_CDN_DEFULT+"menu_yh/img_yh_exp_"+leadingZeros(this.m_bookGeneral.rare_type,2)+".png")}return rare_type_mark}}),GL_ONE=1,GL_ONE_MINUS_SRC_COLOR=769,btn_yunhee_love_show=102,btn_character_love_level=203,btn_character_change=200,BooksGeneralScene=GameScene.extend({m_isSpineMode:!1,m_voice_index:1,m_skeleton_action_index:0,m_character_skeleton:null,m_characterImg:null,m_bookGeneralLayer:null,m_downerror:0,m_res_download_count:0,m_totalzipcount:0,m_curzipcount:0,m_is_voice_playing:!1,m_voice_playing_delta:0,m_morph:null,m_sceneLayer:null,m_img_scale:1,m_deferred:null,m_gnrl_img:null,m_standing_view_modal_layer:null,m_resources:[],ctor:function(){this.m_isSpineMode=!1,this.m_voice_index=1,this.m_skeleton_action_index=0,this.m_character_skeleton=null,this.m_characterImg=null,this.m_characterLayer=null,this.m_bookGeneralLayer=null,this.m_downerror=0,this.m_res_download_count=0,this.m_totalzipcount=0,this.m_curzipcount=0,this.m_is_voice_playing=!1,this.m_voice_playing_delta=0,this.m_sceneLayer=null,this.m_morph=null,this.m_gnrl_img=null,this.m_resources=null,this.m_deferred=$.Deferred(),this._super(scene_BooksGeneralScene)},get_story_deferred:function(){return this.m_deferred},init:function(){this.m_resources=[],this.m_resources.push(RES_CDN_DEFULT+"common/bg_sub_4.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_mask.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_n.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_r.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_hr.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_s.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_star_ss.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_01.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_02.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_03.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_04.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_05.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_unique_06.png"),resourceLoader(this.m_resources,function(){this.m_sceneLayer=new BooksGeneralSceneLayer(this.back.bind(this),this.m_deferred),this.addChild(this.m_sceneLayer),this.m_standing_view_modal_layer=new GameModalLayer,this.addChild(this.m_standing_view_modal_layer,100)}.bind(this))},back:function(){this.m_isPushScene?SceneManager.getInstance().popScene():this.onKeyBack()},onNotification:function(msg){switch(this._super(msg),msg){case btn_yunhee_love_show:this.showYunheeLoveCGMsgBox();break;case BookGeneralEnum.btn_character_change:this.m_sceneLayer.changeCharacter();break;case BookGeneralEnum.btn_show_resistance_help:GameContext.getInstance().setHelpInfoIndexByCallIndex(11);var scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null;break;case BookGeneralEnum.btn_show_standing_detail_view:var standing_gnrl=GameContext.getInstance().getDetailStandingGnrl();0!=standing_gnrl.gnrl_id&&this.showStandingDetailViewPopup(standing_gnrl)}},showStandingDetailViewPopup:function(detail_gnrl){this.m_standing_view_modal_layer.setContentSize(ccSize(this)),this.m_standing_view_modal_layer._contentNode=function(contentSize,m){var layer=new cc.Layer,viewer=new YunheeStandingViewLayer(detail_gnrl,this.hideStandingDetailViewPopup.bind(this));return layer.addChild(viewer),layer.setContentSize(ccSize(viewer)),layer.setPosition(568,320),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),viewer.setPosition(ccCenter(layer)),layer}.bind(this),this.m_standing_view_modal_layer.is_show()&&this.m_standing_view_modal_layer.hide(),this.m_standing_view_modal_layer.show()},hideStandingDetailViewPopup:function(){this.m_standing_view_modal_layer.is_show()&&this.m_standing_view_modal_layer.hide()},showYunheeLoveCGMsgBox:function(){this.m_box.is_show()&&this.m_box.hide(!1),this.m_box.setTitle(""),this.m_box.setText(""),this.m_box.setText("\n"),this.m_box.setText(""),this.m_box.addButtonInfo(new MessageButtonInfo("",MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo("",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(),this.showCheckLoveCG()}.bind(this))),this.m_box.show()},showCheckLoveCG:function(){this.m_box.is_show()&&this.m_box.hide(!1);var love_cg_gnrl_id=GameContext.getInstance().getLoveCgGnrlId(),scene=new LoveContentsCGScene(love_cg_gnrl_id);SceneManager.getInstance().pushScene(scene),scene=null},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_BooksGeneralScene])},onExit:function(){if(this._super(),MainObserver.getInstance().removeObserver(sceneStr[scene_BooksGeneralScene]),!this.m_isPushScene){if(null!=this.m_resources){for(var idx=0;idx<this.m_resources.length;idx++)cc.loader.release(this.m_resources[idx]);this.m_resources=null}this.m_sceneLayer.clearResource(),this.removeAllChildrenWithCleanup(!0),this.m_sceneLayer=null}}}),BooksGeneralSceneLayer=cc.Layer.extend({callback:null,m_skeletonNode:null,m_character_skeleton:null,m_characterLayer:null,m_touchEventLayer:null,m_sceneId:null,m_skeleton_action_index:null,m_deferred:null,m_standing_gnrl_id:null,m_skin_id:null,m_bg:null,ctor:function(_callback,m_deferred){this._super(),this.m_deferred=m_deferred,this.m_skeletonNode=null,this.m_character_skeleton=null,this.m_sceneId=scene_BooksGeneralScene,this.callback=_callback,this.m_bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub_4.png"),this.m_bg.setPosition(cc.p(this.width/2,this.height/2)),USE_SP_COMMON_SUB_BG_SCALE&&this.m_bg.setScale(2),this.addChild(this.m_bg);var book_general_num=GameContext.getInstance().getBookGeneral().book_num;this.m_bookGeneral=new db.UserBookGeneral,GeneralService.getInstance().getBookGeneralInfo(book_general_num,this.m_bookGeneral),this.m_skeleton_action_index=0,this.m_standing_gnrl_id=this.m_bookGeneral.gnrl_id,3<this.m_bookGeneral.gnrl_class&&(this.m_standing_gnrl_id-=1e3),this.m_skin_id=0,this.m_bookGeneral.bone_id!=this.m_bookGeneral.skin_id?this.m_skin_id=this.m_standing_gnrl_id:this.m_skin_id=this.m_bookGeneral.skin_id,this.m_morph=MasterTable.getInstance().get_MorphData(this.m_standing_gnrl_id);var gg=MasterManager.getInstance().get_General(this.m_bookGeneral.bone_id);if("y"==this.m_morph.is_morph){var gnrl=MasterManager.getInstance().get_General(this.m_morph.gnrl_id);if(this.m_gnrl_img=[],USE_PARTNER_GNRL_LOADING){if(SAVE_NOW_PARTNER_GNRL.gnrl_id!=this.m_morph.gnrl_id){if(null==(stading_files=StandingMultiplePngList[this.m_morph.gnrl_id]))this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+this.m_morph.gnrl_id+".png");else for(var idx=0;idx<stading_files.length;idx++)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+stading_files[idx]+".png");this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".atlas"),this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".json")}}else{var stading_files;if(null==(stading_files=StandingMultiplePngList[this.m_morph.gnrl_id]))this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+this.m_morph.gnrl_id+".png");else for(idx=0;idx<stading_files.length;idx++)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+stading_files[idx]+".png");this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".atlas"),this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".json")}this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gg.gnrl_group,3)+"/sd/"+this.m_bookGeneral.skin_id+".atlas"),this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gg.gnrl_group,3)+"/sd/"+this.m_bookGeneral.skin_id+".json");var sd_files=SDGeneralName[gg.gnrl_group];for(idx=0;idx<sd_files.length;idx++)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gg.gnrl_group,3)+"/sd/"+sd_files[idx]+".png");resourceLoader(this.m_gnrl_img,function(){this.initGeneral()}.bind(this))}else{var general=MasterManager.getInstance().get_General(this.m_bookGeneral.gnrl_id);if(this.m_gnrl_img=[],USE_PARTNER_GNRL_LOADING){if(SAVE_NOW_PARTNER_GNRL.gnrl_id!=this.m_bookGeneral.gnrl_id)if(general.gnrl_type==GENERAL_TYPE_YUNHEE){if(MasterManager.getInstance().get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var str=getCardBody_ImageStr(general.gnrl_id);this.m_gnrl_img.push(str)}else{str=getCardBody_ImageStr(general.gnrl_id);this.m_gnrl_img.push(str)}}else{str=getCardBody_ImageStr(this.m_bookGeneral.gnrl_id);this.m_gnrl_img.push(str)}}else if(general.gnrl_type==GENERAL_TYPE_YUNHEE){if(MasterManager.getInstance().get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){str=getCardBody_ImageStr(general.gnrl_id);this.m_gnrl_img.push(str)}else{str=getCardBody_ImageStr(general.gnrl_id);this.m_gnrl_img.push(str)}}else{str=getCardBody_ImageStr(this.m_bookGeneral.gnrl_id);this.m_gnrl_img.push(str)}this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gg.gnrl_group,3)+"/sd/"+this.m_bookGeneral.skin_id+".atlas"),this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gg.gnrl_group,3)+"/sd/"+this.m_bookGeneral.skin_id+".json");for(sd_files=SDGeneralName[gg.gnrl_group],idx=0;idx<sd_files.length;idx++)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gg.gnrl_group,3)+"/sd/"+sd_files[idx]+".png");cc.loader.load(this.m_gnrl_img,function(err,results){err?cc.log("Failed to load %s.",this.m_gnrl_img):this.initGeneral()}.bind(this))}var listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(touch,event){var rect=cc.rect(this.m_touchEventLayer.getPosition().x,this.m_touchEventLayer.getPosition().y,this.m_touchEventLayer.getContentSize().width,this.m_touchEventLayer.getContentSize().height),pos=touch.getLocation();return!!cc.rectContainsPoint(rect,pos)}.bind(this),onTouchEnded:function(touch,event){var m=MasterTable.getInstance();if(this.m_isSpineMode){2<this.m_skeleton_action_index&&(this.m_skeleton_action_index=1),0==this.m_skeleton_action_index?(this.m_skeletonNode.setAnimation(0,"prepare",!1),this.m_skeletonNode.addAnimation(0,"idle",!0)):1==this.m_skeleton_action_index?(this.m_skeletonNode.setAnimation(0,"attack1",!1),this.m_skeletonNode.addAnimation(0,"idle",!0)):2==this.m_skeleton_action_index&&(this.m_skeletonNode.setAnimation(0,"attack2",!1),this.m_skeletonNode.addAnimation(0,"idle",!0)),this.m_skeleton_action_index++;var duration=0,ref={},voice=(voice_list=m.get_Voice(this.m_bookGeneral.gnrl_id,voice_detail_sd_touch,ref)).voice;if(duration=voice_list.duration,!this.m_is_voice_playing)if(voice&&""!=voice)AudioEngine.getInstance().playVoice(RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3",!1),this.m_is_voice_playing=!0,this.m_voice_playing_delta=duration}else{var voice_list,is_voice_play=!1;duration=0,ref={},voice=(voice_list=m.get_Voice(this.m_bookGeneral.gnrl_id,voice_books_body_touch,ref)).voice;if(duration=voice_list.duration,null!=this.m_characterImg){this.m_characterImg.stopAllActions();var s1=new cc.ScaleTo(.1,this.m_img_scale+.03,this.m_img_scale-.03),s2=new cc.ScaleTo(.2,this.m_img_scale-.03,this.m_img_scale+.03),s3=new cc.ScaleTo(.15,this.m_img_scale+.02,this.m_img_scale-.02),s4=new cc.ScaleTo(.8,this.m_img_scale,this.m_img_scale),callback=new cc.CallFunc(this.characterIdelAction,this),e4=new cc.EaseElasticOut(s4),seq=new cc.Sequence(s1,s2,s3,e4,callback);this.m_characterImg.runAction(seq),is_voice_play=!0}else this.m_character_skeleton.setAnimation(0,"active",!1),this.m_character_skeleton.addAnimation(0,"basic",!0),is_voice_play=!0;if(is_voice_play)if(!this.m_is_voice_playing)if(voice&&""!=voice)AudioEngine.getInstance().playVoice(RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3",!1),this.m_is_voice_playing=!0,this.m_voice_playing_delta=duration}}.bind(this)});cc.eventManager.addListener(listener,this),this.scheduleUpdate()},onExit:function(){this._super()},clearResource:function(){if(1!=this.getParent().m_isPopupShow){if(null!=this.m_gnrl_img)if(1==USE_PARTNER_GNRL_LOADING)if(0<SAVE_NOW_PARTNER_GNRL.res_img.length)for(var idx=0;idx<this.m_gnrl_img.length;idx++){for(var check_release=!1,jdx=0;jdx<SAVE_NOW_PARTNER_GNRL.res_img.length;jdx++)SAVE_NOW_PARTNER_GNRL.res_img[jdx]==this.m_gnrl_img[idx]&&(check_release=!0);0==check_release&&cc.loader.release(this.m_gnrl_img[idx])}else for(idx=0;idx<this.m_gnrl_img.length;idx++)cc.loader.release(this.m_gnrl_img[idx]);else{for(idx=0;idx<this.m_gnrl_img.length;idx++)cc.loader.release(this.m_gnrl_img[idx]);this.m_gnrl_img=null}null!=this.m_skeletonNode&&(this.removeChild(this.m_skeletonNode),this.m_skeletonNode._skeleton.data.animations=[],this.m_skeletonNode._skeleton.data.bones=[],this.m_skeletonNode._skeleton.data.events=[],this.m_skeletonNode._skeleton.data.slots=[],this.m_skeletonNode._skeleton.data.skins=[],this.m_skeletonNode._skeleton.slots=[],this.m_skeletonNode._spineComplete=null,this.m_skeletonNode._skeleton=null,this.m_skeletonNode=null),null!=this.m_character_skeleton&&(this.removeChild(this.m_character_skeleton),this.m_character_skeleton._skeleton.data.animations=[],this.m_character_skeleton._skeleton.data.bones=[],this.m_character_skeleton._skeleton.data.events=[],this.m_character_skeleton._skeleton.data.slots=[],this.m_character_skeleton._skeleton.data.skins=[],this.m_character_skeleton._skeleton.slots=[],this.m_character_skeleton._spineComplete=null,this.m_character_skeleton._skeleton=null,this.m_character_skeleton=null),null!=this.m_bg&&(this.removeChild(this.m_bg),this.m_bg=null)}},update:function(dt){this.m_is_voice_playing&&(this.m_voice_playing_delta-=dt,this.m_voice_playing_delta<0&&(this.m_is_voice_playing=!1,this.m_voice_playing_delta=0))},initGeneral:function(){var win_size=cc.director.getWinSize();this.m_characterLayer=this.getCharacterLayer(),this.m_characterLayer.ignoreAnchorPointForPosition(!1),this.m_characterLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_characterLayer.setPosition(cc.p((this.width-478)/2,0)),this.addChild(this.m_characterLayer);var bg_mask=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_mask.png");bg_mask.setAnchorPoint(cc.p(.5,0)),bg_mask.setPosition(this.width/2,0),this.addChild(bg_mask),this.m_bookGeneralLayer=new BooksGeneralLayer,this.m_bookGeneralLayer.setBookGeneralInfo(this.m_bookGeneral),this.m_bookGeneralLayer.initLayout(),this.m_bookGeneralLayer.setPosition(cc.p(0,0)),this.addChild(this.m_bookGeneralLayer),this.m_touchEventLayer=new cc.Layer,this.m_touchEventLayer.ignoreAnchorPointForPosition(!1),this.m_touchEventLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_touchEventLayer.setContentSize(cc.size(400,520)),this.m_touchEventLayer.setPosition(ccCenter(this.m_characterLayer).x,0),this.m_characterLayer.addChild(this.m_touchEventLayer);var statusLayer=new StatusLayer(INVOKER_TYPE.normal);statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(cc.p(win_size.width,win_size.height)),this.addChild(statusLayer);var back_btn=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png","");back_btn.setAnchorPoint(cc.p(0,0)),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(this.callback),this.addChild(back_btn);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_book.png");title.setAnchorPoint(cc.p(0,0)),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title)},changeCharacter:function(){var mt=MasterManager.getInstance(),standing_gnrl_id=this.m_bookGeneral.gnrl_id;3<this.m_bookGeneral.gnrl_class&&(standing_gnrl_id-=1e3);var pos=mt.get_BodyPosition(standing_gnrl_id);if("y"==MasterTable.getInstance().get_MorphData(standing_gnrl_id).is_morph)this.m_character_skeleton.stopAllActions(),this.m_skeletonNode.stopAllActions(),this.m_isSpineMode?(this.m_skeletonNode.runAction(new cc.Sequence(new cc.MoveTo(.18,cc.p(-2048,120)),new cc.FadeOut(0))),this.m_character_skeleton.runAction(new cc.MoveTo(.2,Detail_pos(pos.posx,pos.posy))),this.m_isSpineMode=!1,this.m_character_skeleton.setAnimation(0,"active",!1),this.m_character_skeleton.addAnimation(0,"basic",!0),this.m_character_skeleton.addAnimation(1,"loop",!0)):(this.m_character_skeleton.runAction(new cc.MoveTo(.2,Detail_pos(-2048,pos.posy))),this.m_skeletonNode.runAction(new cc.Sequence(new cc.FadeIn(0),new cc.MoveTo(.18,cc.p(243,120)))),this.m_isSpineMode=!0);else if(this.m_skeletonNode.stopAllActions(),this.m_characterImg.stopAllActions(),this.m_isSpineMode){this.m_skeletonNode.runAction(new cc.Sequence(new cc.MoveTo(.18,cc.p(-ccWidth(this.m_characterImg)*this.m_img_scale-100,120)),new cc.FadeOut(0)));var callback=new cc.CallFunc(this.characterIdelAction,this);this.m_characterImg.runAction(new cc.Sequence(new cc.MoveTo(.2,Detail_pos(pos.posx+ccWidth(this.m_characterImg)*this.m_img_scale/2,pos.posy+ccHeight(this.m_characterImg)*this.m_img_scale/2)),callback)),this.m_isSpineMode=!1}else this.m_characterImg.runAction(new cc.MoveTo(.2,Detail_pos(-ccWidth(this.m_characterImg)*this.m_img_scale*2-150,pos.posy+ccHeight(this.m_characterImg)*this.m_img_scale/2))),this.m_skeletonNode.runAction(new cc.Sequence(new cc.FadeIn(0),new cc.MoveTo(.18,cc.p(243,120)))),this.m_isSpineMode=!0;this.m_is_voice_playing=!1,this.m_voice_playing_delta=0},getCharacterLayer:function(){var layer=new cc.Layer;layer.setContentSize(480,640);var state_type=this.m_bookGeneral.state_type,state_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_state_"+state_type+".png");state_img.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),state_img.setPosition(layer.width/2,112),USE_SP_MENU_YH_SCALE&&state_img.setScale(2),layer.addChild(state_img),state_img.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR);var mt=MasterManager.getInstance(),pos=mt.get_BodyPosition(this.m_standing_gnrl_id);if(cc.log(pos),"y"==this.m_morph.is_morph){var gnrl=mt.get_General(this.m_morph.gnrl_id),gnrl_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".json",gnrl_atals=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".atlas";(img_list=[]).push(gnrl_json),img_list.push(gnrl_atals),resourceLoader(img_list,function(){this.m_character_skeleton=new sp.SkeletonAnimation(gnrl_json,gnrl_atals,.1),this.m_character_skeleton.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_character_skeleton.setPosition(Detail_pos(pos.posx,pos.posy)),cc.log("pos m_character_skeleton"+pos.posx,pos.posy),layer.addChild(this.m_character_skeleton),this.m_character_skeleton.setMix("basic","active",.1),this.m_character_skeleton.setMix("active","basic",.1),this.m_character_skeleton.setAnimation(0,"active",!1),this.m_character_skeleton.addAnimation(0,"basic",!0),this.m_deferred.resolve(!0)}.bind(this))}else{var img_list,general=mt.get_General(this.m_bookGeneral.gnrl_id);if(this.m_img_scale=1,general.gnrl_type==GENERAL_TYPE_YUNHEE){if(mt.get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id)}else{img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id)}}else{img_str=getCardBody_ImageStr(this.m_bookGeneral.gnrl_id);this.m_img_scale=getCardBody_Scale(this.m_bookGeneral.gnrl_id)}(img_list=[]).push(img_str),resourceLoader(img_list,function(){this.m_characterImg=cc.Sprite.create(img_str),this.m_characterImg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_characterImg.setScale(this.m_img_scale),this.m_characterImg.setPosition(Detail_pos(pos.posx+this.m_characterImg.width*this.m_img_scale/2,pos.posy+this.m_characterImg.height*this.m_img_scale/2)),layer.addChild(this.m_characterImg);var callback=new cc.CallFunc(this.characterIdelAction,this);this.m_characterImg.runAction(callback),this.m_deferred.resolve(!0)}.bind(this))}var gg=mt.get_General(this.m_bookGeneral.bone_id),sd_atlas=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gg.gnrl_group,3)+"/sd/"+this.m_bookGeneral.skin_id+".atlas",sd_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gg.gnrl_group,3)+"/sd/"+this.m_bookGeneral.skin_id+".json";this.m_skeletonNode=new sp.SkeletonAnimation(sd_json,sd_atlas),this.m_skeletonNode.setScale(.55),null!=this.m_characterImg||null!=this.m_characterImg?this.m_skeletonNode.setPosition(-this.m_characterImg.width*this.m_img_scale,120):this.m_skeletonNode.setPosition(-2048,120),layer.addChild(this.m_skeletonNode);try{var display_class=this.m_bookGeneral.gnrl_class;3<display_class&&(display_class=3),this.m_skeletonNode.setSkin(cmString("%d",display_class))}catch(e){this.m_skeletonNode.setSkin("default")}return this.m_skeletonNode.setAnimation(0,"basic",!0),this.m_skeletonNode.setMix("basic","prepare",.1),this.m_skeletonNode.setMix("prepare","basic",.1),this.m_skeletonNode.setMix("attack1","prepare",.1),this.m_skeletonNode.setMix("prepare","attack1",.1),this.m_skeletonNode.setMix("attack2","prepare",.1),this.m_skeletonNode.setMix("prepare","attack2",.1),this.m_skeletonNode.setMix("attack1","basic",.1),this.m_skeletonNode.setMix("basic","attack1",.1),this.m_skeletonNode.setMix("attack2","basic",.1),this.m_skeletonNode.setMix("basic","attack2",.1),this.m_skeletonNode.setMix("attack1","attack2",.1),this.m_skeletonNode.setMix("attack2","attack1",.1),this.m_skeletonNode.setOpacity(0),this.m_skeletonNode.setEventListener(this.spineEventListener.bind(this)),layer},spineEventListener:function(entry,evt){entry&&entry.animation&&entry.animation.name;var event_name=evt.data.name.toLowerCase();"loop_show"==event_name?this.m_skeletonNode.setAnimation(2,"loop",!0):"loop_hide"==event_name&&this.m_skeletonNode.setAnimation(2,"loop_off",!0)},characterIdelAction:function(){var scaleTo_1=new cc.ScaleTo(.7,this.m_img_scale,this.m_img_scale+.01),scaleTo_2=new cc.ScaleTo(.7,this.m_img_scale,this.m_img_scale-.01),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);this.m_characterImg.runAction(repeat)}});STATE_TYPE={DONG:1,WIE:2,CHOCK:3,OH:4,WON:5,JAE:6};var BOOKS_TAB_SIZE=9,BookGeneralItemLayer=cc.Layer.extend({m_info:null,layer:null,ctor:function(general){return this._super(),this.layer=null,this.initLayout(general),this},initLayout:function(general){var cardInfo=db.CardInfo;cardInfo.gnrl_id=general.gnrl_id,cardInfo.love_level=general.love_level,cardInfo.gender_type=general.gender_type,cardInfo.love_level=1==general.is_max_love_level?YUNHEE_MAX_LOVE_LEVEL:0;var gnrl_gender_type=MasterManager.getInstance().get_GeneralDivision(general.gnrl_group);cardInfo.gender_type=gnrl_gender_type.general_gender_type,this.layer=new cc.Layer;var card_sprite=(new Card).createCard(cardInfo,CARD_TYPE.type_card_book);return card_sprite.setAnchorPoint(cc.p(0,0)),card_sprite.setPosition(cc.p(0,0)),this.layer.addChild(card_sprite),general.is_gain||(this.m_mask=new cc.LayerColor(cc.color.BLACK),this.m_mask.setContentSize(cc.size(98,98)),this.m_mask.setAnchorPoint(cc.p(0,0)),this.m_mask.setOpacity(230),this.m_mask.setPosition(cc.p(0,0)),IS_SP_BROWSER&&this.m_mask.setScale(.5),card_sprite.addChild(this.m_mask)),this.layer.setContentSize(card_sprite.width+6,card_sprite.height+6),this.m_info=general,this.setContentSize(card_sprite.width+6,card_sprite.height+6),this.addChild(this.layer),!0},getGnrlInfo:function(){return this.m_info},onEnter:function(){this._super()},onExit:function(){this._super()}}),BookIllustItemLayer=cc.Layer.extend({layer:null,ctor:function(illust_idx){this._super(),this.initLayout(illust_idx)},initLayout:function(illust_idx){var n=new NetService,layer=new cc.Layer,box=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_special/i_%d.png",illust_idx));if(box.setAnchorPoint(ZERO()),box.setPosition(ZERO()),box.setContentSize(98,98),layer.addChild(box),n.getUserIllust(illust_idx)){var box_frame=cc.Sprite.create(RES_CDN_DEFULT+"menu_special/img_card_frame_special.png");box_frame.setAnchorPoint(ANCHOR_MIDDLE()),box_frame.setPosition(ccCenter(box)),box.addChild(box_frame)}else{var mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal_2.png",RectZero());mask.setContentSize(ccSize(box)),mask.setAnchorPoint(ZERO()),mask.setPosition(ZERO()),box.addChild(mask)}return layer.setContentSize(ccWidth(box)+6,ccHeight(box)+6),this.setContentSize(ccSize(layer)),this.addChild(layer),!0}}),NOTIFICATION_SELECT_BOOKS_GENERAL="notifictaion_select_books_general",NOTIFICATION_SELECT_BOOKS_ILLUST="notification_select_books_illust",BooksLayer=cc.Layer.extend({m_bookLayer:null,m_generalTableLayer:null,m_wie_tap:null,m_chock_tap:null,m_o_tap:null,m_won_tap:null,m_dong_tap:null,m_jae_tap:null,m_wae_tap:null,m_etc_tap:null,m_illust_tap:null,m_bookGenerals:null,m_bookGeneralItemLayers:null,m_tap_index:0,m_offsetVerticalPercent:0,m_stateGenrals:null,m_gameObserver:null,m_tab_scrollview:null,m_illust_List:[],m_tab_btns:[],ctor:function(){this._super(),this.m_illust_List=[],this.m_tab_btns=[]},getBookLayer:function(){var layer=new cc.Layer;if(layer.setContentSize(960,488),this.m_gameObserver=MainObserver.getInstance(),USE_STATE_TYPE_ETC){this.m_wie_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_wie_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_wie_tap.setString(""),this.m_wie_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_wie_tap.setPosition(17,488),this.m_wie_tap.setSwallowTouches(!0),layer.addChild(this.m_wie_tap,10),this.m_wie_tap.addClickEventListener(function(sender){this.setTabButtonV2(STATE_TYPE_WIE)}.bind(this)),this.m_chock_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_chock_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_chock_tap.setString(""),this.m_chock_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_chock_tap.setPosition(ccPosX(this.m_wie_tap)+ccWidth(this.m_wie_tap),488),this.m_chock_tap.setSwallowTouches(!0),layer.addChild(this.m_chock_tap,10),this.m_chock_tap.addClickEventListener(function(sender){this.setTabButtonV2(STATE_TYPE_CHOCK)}.bind(this)),this.m_o_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_o_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_o_tap.setString(""),this.m_o_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_o_tap.setPosition(ccPosX(this.m_chock_tap)+ccWidth(this.m_wie_tap),488),this.m_o_tap.setSwallowTouches(!0),layer.addChild(this.m_o_tap,10),this.m_o_tap.addClickEventListener(function(sender){this.setTabButtonV2(STATE_TYPE_O)}.bind(this)),this.m_won_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_won_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_won_tap.setString(""),this.m_won_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_won_tap.setPosition(ccPosX(this.m_o_tap)+ccWidth(this.m_wie_tap),488),this.m_won_tap.setSwallowTouches(!0),layer.addChild(this.m_won_tap,10),this.m_won_tap.addClickEventListener(function(sender){this.setTabButtonV2(STATE_TYPE_WON)}.bind(this)),this.m_dong_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_dong_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_dong_tap.setString(""),this.m_dong_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_dong_tap.setPosition(ccPosX(this.m_won_tap)+ccWidth(this.m_wie_tap),488),this.m_dong_tap.setSwallowTouches(!0),layer.addChild(this.m_dong_tap,10),this.m_dong_tap.addClickEventListener(function(sender){this.setTabButtonV2(STATE_TYPE_DONG)}.bind(this)),this.m_jae_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_jae_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_jae_tap.setString(""),this.m_jae_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_jae_tap.setPosition(ccPosX(this.m_dong_tap)+ccWidth(this.m_wie_tap),488),this.m_jae_tap.setSwallowTouches(!0),layer.addChild(this.m_jae_tap,10),this.m_jae_tap.addClickEventListener(function(sender){this.setTabButtonV2(STATE_TYPE_JAE)}.bind(this)),this.m_wae_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_wae_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_wae_tap.setString(res_str("btn_label_wae")),this.m_wae_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_wae_tap.setPosition(ccPosX(this.m_jae_tap)+ccWidth(this.m_wie_tap),488),this.m_wae_tap.setSwallowTouches(!0),layer.addChild(this.m_wae_tap,10),this.m_wae_tap.addClickEventListener(function(sender){this.setTabButtonV2(STATE_TYPE_WAE)}.bind(this)),this.m_etc_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_etc_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_etc_tap.setString(res_str("label_country_name_8")),this.m_etc_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_etc_tap.setPosition(ccPosX(this.m_wae_tap)+ccWidth(this.m_wie_tap),488),this.m_etc_tap.setSwallowTouches(!0),layer.addChild(this.m_etc_tap,10),this.m_etc_tap.addClickEventListener(function(sender){this.setTabButtonV2(STATE_TYPE_ETC)}.bind(this)),USE_3RD_ANNIVERSARY_CARD&&(this.m_illust_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_illust_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_illust_tap.setString(res_str("illust_book_tap_button_text")),this.m_illust_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_illust_tap.setPosition(ccPosX(this.m_etc_tap)+ccWidth(this.m_wie_tap),488),this.m_illust_tap.setSwallowTouches(!0),layer.addChild(this.m_illust_tap,10),this.m_illust_tap.addClickEventListener(function(sender){this.setTabButtonV2(STATE_TYPE_ILLUST)}.bind(this)));var tab_names=[];tab_names.push(res_str("btn_label_wie")),tab_names.push(res_str("btn_label_chock")),tab_names.push(res_str("btn_label_o")),tab_names.push(res_str("btn_label_won")),tab_names.push(res_str("btn_label_dong")),tab_names.push(res_str("btn_label_jae")),tab_names.push(res_str("btn_label_wae")),tab_names.push(res_str("label_country_name_8")),tab_names.push(res_str("illust_book_tap_button_text"));var is_over_scroll=tab_names.length>BOOKS_TAB_SIZE,viewSize=cc.size(106*BOOKS_TAB_SIZE,60),scroll_conatiner=new cc.Layer;if(scroll_conatiner.ignoreAnchorPointForPosition(!1),scroll_conatiner.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),scroll_conatiner.setPosition(ZERO()),this.m_tab_scrollview=new cc.ScrollView(viewSize,scroll_conatiner),this.m_tab_scrollview.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_tab_scrollview.setPosition(cc.p(5,488)),this.m_tab_scrollview.setDirection(cc.SCROLLVIEW_DIRECTION_HORIZONTAL),this.m_tab_scrollview.setTouchEnabled(!1),layer.addChild(this.m_tab_scrollview),is_over_scroll){var tab_left_arrow=new ccui.Button;tab_left_arrow.loadTextures("btn_32_off.png","btn_32_on.png","",ccui.Widget.PLIST_TEXTURE),tab_left_arrow.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),tab_left_arrow.setPosition(cc.p(0,488)),layer.addChild(tab_left_arrow,100),tab_left_arrow.addClickEventListener(function(sender){this.tabMoveLeftPage()}.bind(this));var tab_right_arrow=new ccui.Button;tab_right_arrow.loadTextures("btn_32_off.png","btn_32_on.png","btn_32_on",ccui.Widget.PLIST_TEXTURE),tab_right_arrow.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),tab_right_arrow.setFlippedX(!0),tab_right_arrow.setPosition(cc.p(0+viewSize.width+30,488)),layer.addChild(tab_right_arrow),tab_right_arrow.addClickEventListener(function(sender){this.tabMoveRightPage()}.bind(this))}}else this.m_wie_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_wie_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_wie_tap.setString(""),this.m_wie_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_wie_tap.setPosition(17,488),this.m_wie_tap.setSwallowTouches(!0),layer.addChild(this.m_wie_tap,10),this.m_wie_tap.addClickEventListener(function(sender){this.setTapButton(STATE_TYPE_WIE)}.bind(this)),this.m_chock_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_chock_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_chock_tap.setString(""),this.m_chock_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_chock_tap.setPosition(ccPosX(this.m_wie_tap)+ccWidth(this.m_wie_tap),488),this.m_chock_tap.setSwallowTouches(!0),layer.addChild(this.m_chock_tap,10),this.m_chock_tap.addClickEventListener(function(sender){this.setTapButton(STATE_TYPE_CHOCK)}.bind(this)),this.m_o_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_o_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_o_tap.setString(""),this.m_o_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_o_tap.setPosition(ccPosX(this.m_chock_tap)+ccWidth(this.m_wie_tap),488),this.m_o_tap.setSwallowTouches(!0),layer.addChild(this.m_o_tap,10),this.m_o_tap.addClickEventListener(function(sender){this.setTapButton(STATE_TYPE_O)}.bind(this)),this.m_won_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_won_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_won_tap.setString(""),this.m_won_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_won_tap.setPosition(ccPosX(this.m_o_tap)+ccWidth(this.m_wie_tap),488),this.m_won_tap.setSwallowTouches(!0),layer.addChild(this.m_won_tap,10),this.m_won_tap.addClickEventListener(function(sender){this.setTapButton(STATE_TYPE_WON)}.bind(this)),this.m_dong_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_dong_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_dong_tap.setString(""),this.m_dong_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_dong_tap.setPosition(ccPosX(this.m_won_tap)+ccWidth(this.m_wie_tap),488),this.m_dong_tap.setSwallowTouches(!0),layer.addChild(this.m_dong_tap,10),this.m_dong_tap.addClickEventListener(function(sender){this.setTapButton(STATE_TYPE_DONG)}.bind(this)),this.m_jae_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_jae_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_jae_tap.setString(""),this.m_jae_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_jae_tap.setPosition(ccPosX(this.m_dong_tap)+ccWidth(this.m_wie_tap),488),this.m_jae_tap.setSwallowTouches(!0),layer.addChild(this.m_jae_tap,10),this.m_jae_tap.addClickEventListener(function(sender){this.setTapButton(STATE_TYPE_JAE)}.bind(this)),this.m_wae_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_wae_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_wae_tap.setString(res_str("btn_label_wae")),this.m_wae_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_wae_tap.setPosition(ccPosX(this.m_jae_tap)+ccWidth(this.m_wie_tap),488),this.m_wae_tap.setSwallowTouches(!0),layer.addChild(this.m_wae_tap,10),this.m_wae_tap.addClickEventListener(function(sender){this.setTapButton(STATE_TYPE_WAE)}.bind(this)),USE_3RD_ANNIVERSARY_CARD&&(this.m_illust_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_illust_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_illust_tap.setString(res_str("illust_book_tap_button_text")),this.m_illust_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_illust_tap.setPosition(ccPosX(this.m_wae_tap)+ccWidth(this.m_wie_tap),488),this.m_illust_tap.setSwallowTouches(!0),layer.addChild(this.m_illust_tap,10),this.m_illust_tap.addClickEventListener(function(sender){this.setTapButton(STATE_TYPE_ILLUST)}.bind(this)));return layer},initLayout:function(){var book_tap_index=GameContext.getInstance().getBookTap();this.m_bookLayer=this.getBookLayer(),this.m_bookLayer.ignoreAnchorPointForPosition(!1),this.m_bookLayer.setAnchorPoint(cc.p(.5,0)),this.m_bookLayer.setPosition(cc.p(this.width/2,0)),this.addChild(this.m_bookLayer),USE_STATE_TYPE_ETC?this.setTabButtonV2(book_tap_index):this.setTapButton(book_tap_index)},getBookGeneralTableLayer:function(){this.m_bookGeneralItemLayers=[];var tableLayer=new TableViewLayer;return tableLayer.setAnchorPoint(cc.p(0,0)),tableLayer.setContentSize(937,488),tableLayer.setItemCount(this.m_stateGenrals.length),tableLayer.setColumnCount(9),tableLayer.getItemNode=function(index,contentSize,margin){var general=this.m_stateGenrals[index],gnrlLayer=new BookGeneralItemLayer(general);return general=null,gnrlLayer}.bind(this),tableLayer.initLayout(),tableLayer.onItemTouchBegin=function(index){var general=this.m_stateGenrals[index];return general.is_gain?!(general=null):(general=null,!1)}.bind(this),tableLayer.onItemTouchMoved=function(isScroll){}.bind(this),tableLayer.onItemTouchCancel=function(index){return!0}.bind(this),tableLayer.onItemTouchEnd=function(index){AudioEngine.getInstance().playNormaButtonSound();var general=this.m_stateGenrals[index],gnrl_id=general.gnrl_id,num=general.book_num;return GameContext.getInstance().setBookGeneral(num,gnrl_id),general=null,this.m_gameObserver.postNotification(sceneStr[scene_BooksScene],"NOTIFICATION_SELECT_BOOKS_GENERAL"),!0}.bind(this),tableLayer},getBookIllustTableLayer:function(){this.m_bookGeneralItemLayers=[];var m=MasterTable.getInstance();this.m_illust_List=m.get_IllustList();var n=new NetService,tableLayer=new TableViewLayer;return tableLayer.setAnchorPoint(ZERO()),tableLayer.setContentSize(937,488),tableLayer.setItemCount(this.m_illust_List.length),tableLayer.setColumnCount(9),tableLayer.getItemNode=function(index,contentSize,m){var illust=this.m_illust_List[index];return new BookIllustItemLayer(illust.illust_idx)}.bind(this),tableLayer.initLayout(),tableLayer.onItemTouchBegin=function(index){return!!n.getUserIllust(this.m_illust_List.at(index).illust_idx)}.bind(this),tableLayer.onItemTouchMoved=function(isScroll){}.bind(this),tableLayer.onItemTouchCancel=function(index){return!0}.bind(this),tableLayer.onItemTouchEnd=function(index){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3";audio.playEffect(path);var illust_Idx=this.m_illust_List.at(index).illust_idx;MainObserver.getInstance().postNotification(NOTIFICATION_SELECT_BOOKS_ILLUST,illust_Idx)}.bind(this),tableLayer},setVerticalPercent:function(){this.m_offsetVerticalPercent=this.m_generalTableLayer.getOffsetVerticalPercent()},setOffsetY:function(){this.m_generalTableLayer.setOffsetVertical(this.m_offsetVerticalPercent)},tabMoveLeftPage:function(){var cnt=this.m_tab_btns.length,max_page=cnt/BOOKS_TAB_SIZE;0<cnt%BOOKS_TAB_SIZE&&(max_page+=1);for(var cur_tab_index=0,i=0;i<this.m_tab_btns.length;i++)if(!this.m_tab_btns[i].isEnabled()){cur_tab_index=i;break}var tab=cur_tab_index/BOOKS_TAB_SIZE;(tab-=1)<0&&(tab=max_page-1);var index=tab*BOOKS_TAB_SIZE,tab_tag=this.m_tab_btns.at(index).getTag();this.setTabButtonV2(tab_tag);this.m_tab_scrollview.getContainer().getContentSize();var offset_x=tab*(ccWidth(this.m_tab_btns[0])*BOOKS_TAB_SIZE),offset=cc.p(-offset_x,0);this.m_tab_scrollview.setContentOffset(offset,!1)},tabMoveRightPage:function(){var cnt=this.m_tab_btns.length,max_page=cnt/BOOKS_TAB_SIZE;0<cnt%BOOKS_TAB_SIZE&&(max_page+=1);for(var cur_tab_index=0,i=0;i<this.m_tab_btns.length;i++)if(!this.m_tab_btns[i].isEnabled()){cur_tab_index=i;break}var tab=cur_tab_index/BOOKS_TAB_SIZE;max_page-1<(tab+=1)&&(tab=0);var index=tab*BOOKS_TAB_SIZE,tab_tag=this.m_tab_btns.at(index).getTag();this.setTabButtonV2(tab_tag);this.m_tab_scrollview.getContainer().getContentSize();var offset_x=tab*(ccWidth(this.m_tab_btns[0])*BOOKS_TAB_SIZE),offset=cc.p(-offset_x,0);this.m_tab_scrollview.setContentOffset(offset,!1)},setTabButtonV2:function(index){for(var i=0;i<this.m_tab_btns.length;i++){var btn=this.m_tab_btns[i],tag=btn.getTag();btn.setEnabled(tag!=index)}this.m_offsetVerticalPercent=0,(this.m_tap_index=index)==STATE_TYPE_ILLUST?this.setTapIllustBook(index):this.setTapBook(index),this.m_wie_tap.setEnabled(!0),this.m_chock_tap.setEnabled(!0),this.m_o_tap.setEnabled(!0),this.m_won_tap.setEnabled(!0),this.m_dong_tap.setEnabled(!0),this.m_jae_tap.setEnabled(!0),this.m_wae_tap.setEnabled(!0),this.m_etc_tap.setEnabled(!0),USE_3RD_ANNIVERSARY_CARD&&this.m_illust_tap.setEnabled(!0),this.m_wie_tap.setBright(!0),this.m_chock_tap.setBright(!0),this.m_o_tap.setBright(!0),this.m_won_tap.setBright(!0),this.m_dong_tap.setBright(!0),this.m_jae_tap.setBright(!0),this.m_wae_tap.setBright(!0),this.m_etc_tap.setBright(!0),USE_3RD_ANNIVERSARY_CARD&&this.m_illust_tap.setBright(!0),index==STATE_TYPE.WIE?(this.m_wie_tap.setEnabled(!1),this.m_wie_tap.setBright(!1)):index==STATE_TYPE.CHOCK?(this.m_chock_tap.setEnabled(!1),this.m_chock_tap.setBright(!1)):index==STATE_TYPE.OH?(this.m_o_tap.setEnabled(!1),this.m_o_tap.setBright(!1)):index==STATE_TYPE.WON?(this.m_won_tap.setEnabled(!1),this.m_won_tap.setBright(!1)):index==STATE_TYPE.DONG?(this.m_dong_tap.setEnabled(!1),this.m_dong_tap.setBright(!1)):index==STATE_TYPE.JAE?(this.m_jae_tap.setEnabled(!1),this.m_jae_tap.setBright(!1)):index==STATE_TYPE_WAE?(this.m_wae_tap.setEnabled(!1),this.m_wae_tap.setBright(!1)):index==STATE_TYPE_ETC?(this.m_etc_tap.setEnabled(!1),this.m_etc_tap.setBright(!1)):index==STATE_TYPE_ILLUST?USE_3RD_ANNIVERSARY_CARD&&(this.m_illust_tap.setEnabled(!1),this.m_illust_tap.setBright(!1)):cc.log("error"),this.m_offsetVerticalPercent=0,this.m_tap_index=index,this.scheduleOnce(function(){this.m_gameObserver.postNotification(sceneStr[scene_BooksScene],this.m_tap_index)}.bind(this),0,"setTapButton")},setTapButton:function(index){this.m_wie_tap.setEnabled(!0),this.m_chock_tap.setEnabled(!0),this.m_o_tap.setEnabled(!0),this.m_won_tap.setEnabled(!0),this.m_dong_tap.setEnabled(!0),this.m_jae_tap.setEnabled(!0),this.m_wae_tap.setEnabled(!0),USE_3RD_ANNIVERSARY_CARD&&this.m_illust_tap.setEnabled(!0),this.m_wie_tap.setBright(!0),this.m_chock_tap.setBright(!0),this.m_o_tap.setBright(!0),this.m_won_tap.setBright(!0),this.m_dong_tap.setBright(!0),this.m_jae_tap.setBright(!0),this.m_wae_tap.setBright(!0),USE_3RD_ANNIVERSARY_CARD&&this.m_illust_tap.setBright(!0),index==STATE_TYPE.WIE?(this.m_wie_tap.setEnabled(!1),this.m_wie_tap.setBright(!1)):index==STATE_TYPE.CHOCK?(this.m_chock_tap.setEnabled(!1),this.m_chock_tap.setBright(!1)):index==STATE_TYPE.OH?(this.m_o_tap.setEnabled(!1),this.m_o_tap.setBright(!1)):index==STATE_TYPE.WON?(this.m_won_tap.setEnabled(!1),this.m_won_tap.setBright(!1)):index==STATE_TYPE.DONG?(this.m_dong_tap.setEnabled(!1),this.m_dong_tap.setBright(!1)):index==STATE_TYPE.JAE?(this.m_jae_tap.setEnabled(!1),this.m_jae_tap.setBright(!1)):index==STATE_TYPE_WAE?(this.m_wae_tap.setEnabled(!1),this.m_wae_tap.setBright(!1)):index==STATE_TYPE_ILLUST?USE_3RD_ANNIVERSARY_CARD&&(this.m_illust_tap.setEnabled(!1),this.m_illust_tap.setBright(!1)):cc.log("error"),this.m_offsetVerticalPercent=0,this.m_tap_index=index,this.scheduleOnce(function(){this.m_gameObserver.postNotification(sceneStr[scene_BooksScene],this.m_tap_index)}.bind(this),0,"setTapButton")},setTapBook:function(index){null!=this.m_generalTableLayer&&(this.removeChild(this.m_generalTableLayer),this.m_generalTableLayer.removeAllChildren(),this.m_generalTableLayer=null),this.m_stateGenrals=[],this.m_stateGenrals=this.getBookGeneralList(index,this.m_stateGenrals),0!=this.m_stateGenrals.length&&(this.m_stateGenrals=stable(this.m_stateGenrals,function(l,r){return l.gnrl_class>r.gnrl_class?1:l.gnrl_class<r.gnrl_class?-1:0}),this.m_stateGenrals=stable(this.m_stateGenrals,function(l,r){return l.name<r.name?1:l.name>r.name?-1:0}),this.m_stateGenrals=stable(this.m_stateGenrals,function(l,r){return l.rare_type<r.rare_type?1:l.rare_type>r.rare_type?-1:0}),this.m_stateGenrals=stable(this.m_stateGenrals,function(l,r){return l.element_type>r.element_type?1:l.element_type<r.element_type?-1:0}),this.m_generalTableLayer=this.getBookGeneralTableLayer(),this.m_generalTableLayer.setPosition(cc.p(100,0)),this.m_generalTableLayer.setAnchorPoint(cc.p(0,0)),this.addChild(this.m_generalTableLayer),this.setOffsetY()),GameContext.getInstance().setBookTap(index)},getBookGeneralList:function(index,generals){for(var idx=0;idx<this.m_bookGenerals.length;idx++)this.m_bookGenerals[idx].state_type==index&&generals.push(this.m_bookGenerals[idx]);return generals},setBookGeneralList:function(generals){this.m_bookGenerals=generals,this.initLayout()},setTapIllustBook:function(index){null!=this.m_generalTableLayer&&(this.m_generalTableLayer.removeFromParent(),this.m_generalTableLayer=null),this.m_stateGenrals=[],this.m_generalTableLayer=this.getBookIllustTableLayer(),this.m_generalTableLayer.setAnchorPoint(ZERO()),this.m_generalTableLayer.setPosition(17,0),this.m_bookLayer.addChild(this.m_generalTableLayer),this.setOffsetY()},onEnter:function(){this._super(),this.m_generalTableLayer&&this.setOffsetY()},onExit:function(){this._super(),1!=this.getParent().m_isPushScene&&(this.m_bookGenerals=[],null!=this.m_generalTableLayer&&(this.m_generalTableLayer.removeAllChildren(),this.m_generalTableLayer=null))}}),BooksScene=GameScene.extend({m_bookLayer:null,m_itemModalLayer:null,m_illustInfoModalLayer:null,m_resources:[],ctor:function(){this._super(scene_BooksScene)},init:function(){this.m_bookLayer=null,this.m_itemModalLayer=null,this.m_illustInfoModalLayer=null,this.m_notification_id="notification_BooksScene";var win_size=cc.director.getWinSize();this.initLayoutProgress2(0),this.m_resources=[],this.m_resources.push(RES_CDN_DEFULT+"common/bg_sub_4.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/bg_special.jpg");for(var idx=1001;idx<MAX_MENU_SPECIAL_NUM;idx++)this.m_resources.push(RES_CDN_DEFULT+"menu_special/im_"+idx+".jpg"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/i_"+idx+".png");this.m_resources.push(RES_CDN_DEFULT+"menu_special/btn_special_zoomin_off.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/btn_special_zoomin_on.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/btn_special_zoomout_off.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/btn_special_zoomout_on.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_zoom_gauge.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_zoom_gauge_mint.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/img_card_frame_special.png"),resourceLoader(this.m_resources,function(){var bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub_4.png");bg.setPosition(cc.p(this.width/2,this.height/2)),USE_SP_COMMON_SUB_BG_SCALE&&bg.setScale(2),this.addChild(bg);var statusLayer=new StatusLayer(INVOKER_TYPE.normal);statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(cc.p(win_size.width,win_size.height)),this.addChild(statusLayer,99);var generals=GeneralService.getInstance().getBookGeneralList();this.m_bookLayer=new BooksLayer,this.m_bookLayer.setBookGeneralList(generals),this.addChild(this.m_bookLayer);var back_btn=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png","");back_btn.setAnchorPoint(cc.p(0,0)),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(this.back.bind(this)),this.addChild(back_btn,100);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_book.png");title.setAnchorPoint(cc.p(0,0)),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title,100);var messBox=new GameInputMessageBox(!1,!1);return this.addChild(messBox),USE_3RD_ANNIVERSARY_CARD&&(this.m_illustInfoModalLayer=new GameModalLayer,this.addChild(this.m_illustInfoModalLayer,100)),this.removeLayerProgress2(),!0}.bind(this))},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_BooksScene]),MainObserver.getInstance().addObserver(this.onNotifyBooksIllust,this,NOTIFICATION_SELECT_BOOKS_ILLUST)},onExit:function(){if(this._super(),MainObserver.getInstance().removeObserver(sceneStr[scene_BooksScene]),MainObserver.getInstance().removeObserver(NOTIFICATION_SELECT_BOOKS_ILLUST),null!=this.m_resources){for(var idx=0;idx<this.m_resources.length;idx++)cc.loader.release(this.m_resources[idx]);this.m_resources=[]}},back:function(){GameContext.getInstance().setBookTap(STATE_TYPE_WIE),this.onKeyBack(!0,!1)},onNotification:function(msg){if(this._super(msg),"NOTIFICATION_SELECT_BOOKS_GENERAL"==msg){this.initLayoutProgress(),this.m_bookLayer.setVerticalPercent();var scene=new BooksGeneralScene;scene.get_story_deferred().done(function(){this.scheduleOnce(function(){var sceneManager=SceneManager.getInstance();this.m_isPushScene=!0,sceneManager.pushScene(scene),scene=null},1.5)}.bind(this))}switch(msg){case STATE_TYPE_WIE:case STATE_TYPE_CHOCK:case STATE_TYPE_O:case STATE_TYPE_WON:case STATE_TYPE_DONG:case STATE_TYPE_JAE:case STATE_TYPE_WAE:return this.m_bookLayer.setTapBook(msg),!0;case STATE_TYPE_ILLUST:return this.m_bookLayer.setTapIllustBook(msg),!0}return!0},showIllustInfoLayer:function(illust_idx){this.m_illustInfoModalLayer.setContentSize(ccSize(this)),this.m_illustInfoModalLayer._contentNode=function(contentSize,m){var illust_Layer=new YunheeIllustInfoLayer(illust_idx),back_btn=new ccui.Button;back_btn.loadTextures("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE),back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(this)-10,ccHeight(this)-10),back_btn.addClickEventListener(function(){return this.scheduleOnce(function(float){this.m_illustInfoModalLayer.hide()},0,"m_illustInfoModalLayer"),illust_Layer.addChild(back_btn),illust_Layer}.bind(this)),this.m_illustInfoModalLayer.show()}.bind(this)},onNotifyBooksGeneral:function(sender){this.m_bookLayer.getOffsetVerticalPercent();var list=this.m_bookLayer.getBookGeneralList();GameContext.getInstance().setBookGeneralList(list);var scene=new BooksGeneralScene;SceneManager.getInstance().pushScene(scene),scene=null},onNotifyBooksIllust:function(sender){var illust_idx=sender;this.m_illustInfoModalLayer.setContentSize(ccSize(this)),this.m_illustInfoModalLayer._contentNode=function(contentSize,m){var illust_Layer=new YunheeIllustInfoLayer(illust_idx),back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);return back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(this)-10,ccHeight(this)-10),back_btn.addClickEventListener(function(){this.scheduleOnce(function(float){this.m_illustInfoModalLayer.hide()},0,"m_illustInfoModalLayer")}.bind(this)),illust_Layer.addChild(back_btn),illust_Layer}.bind(this),this.m_illustInfoModalLayer.show()}}),BookEnum={btn_character_change:100,btn_voice:101,btn_yunhee_love_show:102,btn_character_love_level:103,btn_show_love_cg:104,btn_show_resistance_help:105,btn_standing_detail_view:106},BooksGeneralLayerV2=cc.Layer.extend({m_skeleton_action_index:0,m_scrollContentLayer:null,m_skeletonNode:null,m_resistanceLayer:null,m_scrollLayer:null,m_info_btn:null,m_resistance_btn:null,m_title_label:null,m_voiceScrollLayer:null,ctor:function(){this._super(),this.m_skeleton_action_index=0,this.m_scrollContentLayer=null,this.m_skeletonNode=null,this.m_resistanceLayer=null,this.m_scrollLayer=null,this.m_info_btn=null,this.m_resistance_btn=null,this.m_title_label=null,this.m_bookGeneral=null,this.m_voiceScrollLayer=null},setBookGeneralInfo:function(bookGeneral){this.m_bookGeneral=bookGeneral},initLayout:function(){var leftBottomLayer=this.getLeftBottomLayer();leftBottomLayer.setPosition(ZERO()),this.addChild(leftBottomLayer);var rightBoxLayer=this.getRightBoxLayer();rightBoxLayer.ignoreAnchorPointForPosition(!1),rightBoxLayer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),rightBoxLayer.setPosition(ccWidth(this),0),this.addChild(rightBoxLayer)},onExit:function(){this._super()},getLeftBottomLayer:function(){var layer=new cc.Layer;layer.setContentSize(ccWidth(this)-478,320);var bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_8.png",RectZero());bg_box.setContentSize(658,105),bg_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bg_box.setPosition(0,0),layer.addChild(bg_box,1),layer.setContentSize(ccSize(bg_box));var name_box=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_blank_2.png");name_box.setAnchorPoint(ZERO()),name_box.setPosition(ZERO()),bg_box.addChild(name_box);var rare_type_sprite=this.getRareTypeSprite();rare_type_sprite.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),rare_type_sprite.setPosition(0,.5*ccHeight(name_box)),name_box.addChild(rare_type_sprite);var ic_mark=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_txtmark.png");ic_mark.setAnchorPoint(ZERO()),ic_mark.setPosition(117,62),bg_box.addChild(ic_mark);var gnrl_name=cmLabelEx.getLabel(this.m_bookGeneral.name,LABEL_FONT_INDEX.FONT_2671,!1,!0,2,cc.color(0,0,0,255));gnrl_name.setAnchorPoint(ZERO()),gnrl_name.setPosition(141,56),bg_box.addChild(gnrl_name);var cost_label=cmLabelEx.getLabel("Cost",LABEL_FONT_INDEX.FONT_2071,!1,!0,2,cc.color(0,0,0,255));cost_label.setAnchorPoint(ZERO()),cost_label.setPosition(117,17),bg_box.addChild(cost_label);var user_cost_label=cmLabelEx.getLabel(this.m_bookGeneral.cost,LABEL_FONT_INDEX.FONT_2275,!1,!0,2,cc.color(0,0,0,255));user_cost_label.setAnchorPoint(ZERO()),user_cost_label.setPosition(168,15),bg_box.addChild(user_cost_label);var new_icon=cc.size(56,58),icon_xPos=ccWidth(bg_box)-new_icon.width-6,icon_yPos=ccHeight(bg_box)-new_icon.height-5,state_type_spr=cc.Sprite.create(RES_CDN_DEFULT+cmString("new_menu_yh/img_country_%d.png",this.m_bookGeneral.state_type));state_type_spr.setAnchorPoint(ZERO()),state_type_spr.setPosition(icon_xPos,icon_yPos),bg_box.addChild(state_type_spr),icon_xPos-=new_icon.width;var arm_service_type_spr=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_yh/img_yh_detail_ic_battletech_"+this.m_bookGeneral.arm_service_type+".png");arm_service_type_spr.setAnchorPoint(ZERO()),arm_service_type_spr.setPosition(icon_xPos,icon_yPos),bg_box.addChild(arm_service_type_spr),icon_xPos-=new_icon.width;var element_type_spr=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_yh/img_yh_detail_ic_attribute_"+this.m_bookGeneral.element_type+".png");element_type_spr.setAnchorPoint(ZERO()),element_type_spr.setPosition(icon_xPos,icon_yPos),bg_box.addChild(element_type_spr);var cgOnOffBtn=new ccui.Button;cgOnOffBtn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_sub_love_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_sub_love_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_sub_love_none.png"),cgOnOffBtn.setAnchorPoint(ZERO()),cgOnOffBtn.setPosition(15,120),layer.addChild(cgOnOffBtn),cgOnOffBtn.addClickEventListener(function(sender){var g=MasterManager.getInstance().get_General(this.m_bookGeneral.gnrl_id);this.m_bookGeneral.is_max_love_level&&99999!=g.love_cg_num&&0<g.love_cg_num&&(GameContext.getInstance().setLoveCgGnrlId(g.gnrl_id),MainObserver.getInstance().postNotification(sceneStr[scene_BooksGeneralSceneV2],btn_yunhee_love_show))}.bind(this)),this.m_bookGeneral.gender_type!=GENDER_TYPE_M&&this.m_bookGeneral.gnrl_type!=GENERAL_TYPE_SOLDIER&&19!=this.m_bookGeneral.gnrl_group&&453!=this.m_bookGeneral.gnrl_group||(cgOnOffBtn.loadTextureNormal(RES_CDN_DEFULT+"new_common/btn/ori/btn_sub_loveman_off.png"),cgOnOffBtn.loadTexturePressed(RES_CDN_DEFULT+"new_common/btn/ori/btn_sub_loveman_on.png"),cgOnOffBtn.loadTextureDisabled(RES_CDN_DEFULT+"new_common/btn/ori/btn_sub_loveman_none.png")),this.m_bookGeneral.is_max_love_level&&19!=this.m_bookGeneral.gnrl_group||cgOnOffBtn.setEnabled(!1);var btn_y=199,standingViewBtn=new ccui.Button;standingViewBtn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_sub_zoom_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_sub_zoom_on.png",""),standingViewBtn.setAnchorPoint(ZERO()),standingViewBtn.setPosition(15,btn_y),layer.addChild(standingViewBtn),standingViewBtn.addClickEventListener(function(sender){var detail_gnrl={};detail_gnrl.gnrl_id=this.m_bookGeneral.gnrl_id,detail_gnrl.gnrl_num=0,detail_gnrl.display_class=this.m_bookGeneral.gnrl_class,GameContext.getInstance().setDetailStandingGnrlId(detail_gnrl),MainObserver.getInstance().postNotification(sceneStr[scene_BooksGeneralSceneV2],BookEnum.btn_standing_detail_view)}.bind(this)),btn_y+=79;var characterChangeBtn=new ccui.Button;return characterChangeBtn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_sub_change_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_sub_change_on.png",""),characterChangeBtn.setAnchorPoint(ZERO()),characterChangeBtn.setPosition(15,btn_y),layer.addChild(characterChangeBtn),characterChangeBtn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_BooksGeneralSceneV2],BookEnum.btn_character_change)}.bind(this)),layer},getRareTypeSprite:function(){var rare_type_mark=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_yh/img_yh_unique_"+leadingZeros(this.m_bookGeneral.rare_type,2)+".png");if(this.m_bookGeneral.gnrl_type!=GENERAL_TYPE_MATERIAL){var class_type_star_path="";this.m_bookGeneral.rare_type==RARE_TYPE_N||this.m_bookGeneral.rare_type==RARE_TYPE_HN?class_type_star_path=RES_CDN_DEFULT+"new_menu_yh/img_yh_unique_star_n.png":this.m_bookGeneral.rare_type==RARE_TYPE_R?class_type_star_path=RES_CDN_DEFULT+"new_menu_yh/img_yh_unique_star_r.png":this.m_bookGeneral.rare_type==RARE_TYPE_HR?class_type_star_path=RES_CDN_DEFULT+"new_menu_yh/img_yh_unique_star_hr.png":this.m_bookGeneral.rare_type==RARE_TYPE_SR?class_type_star_path=this.m_bookGeneral.gnrl_class>YUNHEE_MAX_CLASS_TYPE?RES_CDN_DEFULT+"new_menu_yh/img_yh_unique_star_ss_2.png":RES_CDN_DEFULT+"new_menu_yh/img_yh_unique_star_s.png":this.m_bookGeneral.rare_type==RARE_TYPE_SSR&&(class_type_star_path=this.m_bookGeneral.gnrl_class>YUNHEE_MAX_CLASS_TYPE?RES_CDN_DEFULT+"new_menu_yh/img_yh_unique_star_ss_2.png":RES_CDN_DEFULT+"new_menu_yh/img_yh_unique_star_ss.png");for(var class_star_layer=new cc.Layer,i=1;i<this.m_bookGeneral.gnrl_class;++i){var class_type_star=cc.Sprite.create(class_type_star_path);class_type_star.setAnchorPoint(ZERO()),class_type_star.setPosition(17*(i-1),0),class_star_layer.addChild(class_type_star)}class_star_layer.setContentSize(17*(this.m_bookGeneral.gnrl_class-1),16),class_star_layer.ignoreAnchorPointForPosition(!1),class_star_layer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),class_star_layer.setPosition(52.5,50),rare_type_mark.addChild(class_star_layer)}else{-1!=res_img_yh_exp.indexOf(this.m_bookGeneral.rare_type)&&rare_type_mark.setTexture(RES_CDN_DEFULT+"new_menu_yh/img_yh_exp_"+leadingZeros(this.m_bookGeneral.rare_type,2)+".png")}return rare_type_mark},getRightBoxLayer:function(){var layer=new cc.Layer,right_bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_base.png",RectZero());right_bg_box.setContentSize(480,574),right_bg_box.setAnchorPoint(ZERO()),right_bg_box.setPosition(ZERO()),layer.addChild(right_bg_box);var right_bg_box_top=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_top.png",RectZero());if(right_bg_box_top.setContentSize(480,53),right_bg_box_top.setAnchorPoint(ZERO()),right_bg_box_top.setPosition(0,521),right_bg_box.addChild(right_bg_box_top),layer.setContentSize(ccSize(right_bg_box)),this.m_bookGeneral.gnrl_type!=GENERAL_TYPE_EVOLVE_MATERIAL&&this.m_bookGeneral.gnrl_type!=GENERAL_TYPE_MATERIAL&&this.m_bookGeneral.gnrl_type!=GENERAL_TYPE_LIMIT_OVER){this.m_info_btn=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_7_none.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_7_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_7_off.png");var m_info_btn_rect=cc.Rect(16,16,14,14),offset=cc.p(0,0);this.m_info_btn.setTitleFont(m_info_btn_rect,LABEL_FONT_INDEX.FONT_2071,!0,2,cc.color(0,0,0,255),cc.color(128,128,128,255),offset),this.m_info_btn.setTitleText(res_str("btn_label_books_general_detail")),this.m_info_btn.setBright(!0),this.m_info_btn.setContentSize(110,46),this.m_info_btn.setAnchorPoint(ZERO()),this.m_info_btn.setPosition(20,460),right_bg_box.addChild(this.m_info_btn),this.m_info_btn.setEnabled(!1),this.m_info_btn.addClickEventListener(function(sender){this.m_resistance_btn.setEnabled(!0),this.m_info_btn.setEnabled(!1),1==USE_BOOK_DETAIL_VOICE&&this.m_voice_btn.setEnabled(!0),this.m_scrollLayer.setVisible(!0),this.m_scrollLayer.setContentOffset(OffsetType.jumpToTop),this.m_resistanceLayer.setVisible(!1),1==USE_BOOK_DETAIL_VOICE&&this.m_voiceScrollLayer.setVisible(!1)}.bind(this)),this.m_resistance_btn=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_7_none.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_7_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_7_off.png"),this.m_resistance_btn.setTitleFont(m_info_btn_rect,LABEL_FONT_INDEX.FONT_2071,!0,2,cc.color(0,0,0,255),cc.color(128,128,128,255),offset),this.m_resistance_btn.setTitleText(res_str("btn_label_resistance")),this.m_resistance_btn.setBright(!0),this.m_resistance_btn.setContentSize(110,46),this.m_resistance_btn.setAnchorPoint(ZERO()),this.m_resistance_btn.setPosition(130,460),right_bg_box.addChild(this.m_resistance_btn),this.m_resistance_btn.addClickEventListener(function(sender){this.m_resistance_btn.setEnabled(!1),this.m_info_btn.setEnabled(!0),1==USE_BOOK_DETAIL_VOICE&&this.m_voice_btn.setEnabled(!0),this.m_scrollLayer.setVisible(!1),this.m_resistanceLayer.setVisible(!0),1==USE_BOOK_DETAIL_VOICE&&this.m_voiceScrollLayer.setVisible(!1)}.bind(this)),1==USE_BOOK_DETAIL_VOICE&&(this.m_voice_btn=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_7_none.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_7_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_7_off.png"),this.m_voice_btn.setTitleFont(m_info_btn_rect,LABEL_FONT_INDEX.FONT_2071,!0,2,cc.color(0,0,0,255),cc.color(128,128,128,255),offset),this.m_voice_btn.setTitleText(res_str("btn_label_voice")),this.m_voice_btn.setBright(!0),this.m_voice_btn.setContentSize(110,46),this.m_voice_btn.setAnchorPoint(ZERO()),this.m_voice_btn.setPosition(240,460),right_bg_box.addChild(this.m_voice_btn),this.m_voice_btn.addClickEventListener(function(sender){this.m_resistance_btn.setEnabled(!0),this.m_info_btn.setEnabled(!0),this.m_voice_btn.setEnabled(!1),this.m_scrollLayer.setVisible(!1),this.m_resistanceLayer.setVisible(!1),this.m_voiceScrollLayer.setVisible(!0)}.bind(this)))}return this.m_title_label=cmLabelEx.getLabel(res_str("label_yunhee_detail"),LABEL_FONT_INDEX.FONT_2471,!1,!0,2,cc.color(0,0,0,255)),this.m_title_label.setString(res_str("label_books_general_title")),this.m_title_label.setAnchorPoint(ZERO()),this.m_title_label.setPosition(28,11),right_bg_box_top.addChild(this.m_title_label),this.m_scrollLayer=new ScrollLayer,this.m_scrollLayer.setContentSize(447,430),this.m_scrollLayer.getItemNode=function(contentSize,m){return this.m_scrollContentLayer=this.getDetailContentLayer(),this.m_scrollContentLayer}.bind(this),this.m_scrollLayer.initLayout(),this.m_scrollLayer.setPosition(20,20),right_bg_box.addChild(this.m_scrollLayer),this.m_resistanceLayer=this.getResistanceLayer(),this.m_resistanceLayer.ignoreAnchorPointForPosition(!1),this.m_resistanceLayer.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_resistanceLayer.setPosition(0,ccHeight(right_bg_box)-124),right_bg_box.addChild(this.m_resistanceLayer),this.m_resistanceLayer.setVisible(!1),1==USE_BOOK_DETAIL_VOICE&&(this.m_voiceScrollLayer=this.getVoiceListLayer(),this.m_voiceScrollLayer.setPosition(20,20),right_bg_box.addChild(this.m_voiceScrollLayer),this.m_voiceScrollLayer.setVisible(!1)),layer},getResistanceLayer:function(){var layer=new cc.Layer,bottom_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_bottom.png",RectZero());bottom_bg.setContentSize(480,72),bottom_bg.setAnchorPoint(ZERO()),bottom_bg.setPosition(0,0),layer.addChild(bottom_bg);var tableLayer=this.getTableLayer();tableLayer.setPosition(15,78),layer.addChild(tableLayer),layer.setContentSize(480,449);var btn=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_5_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_5_on.png",""),btn_rect=cc.Rect(20,20,20,2);return btn.setTitleFont(btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255)),btn.setTitleText(res_str("btn_label_resistance_info")),btn.setContentSize(176,42),btn.setAnchorPoint(ZERO()),btn.setPosition(ccWidth(bottom_bg)-176-32,17),bottom_bg.addChild(btn),btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_BooksGeneralSceneV2],BookEnum.btn_show_resistance_help)}.bind(this)),layer},getTableLayer:function(){var tableLayer=new TableViewLayer;return tableLayer.setAnchorPoint(ZERO()),tableLayer.setContentSize(452,380),tableLayer.setColumnCount(1),tableLayer.setItemCount(8),tableLayer.getItemNode=function(index,contentSize,margin){return new YunheeResistanceItemLayerV2(index,this.m_bookGeneral.gnrl_id)}.bind(this),tableLayer.initLayout(),tableLayer.setTouchScrollEnabled(!1),tableLayer.setEnableMouseScroll(!1),tableLayer.onItemTouchBegin=function(index){return!0},tableLayer.onItemTouchMoved=function(isScroll){},tableLayer.onItemTouchCancel=function(index){return!0},tableLayer.onMouseScroll=function(){return!0},tableLayer},getVoiceListLayer:function(){var listLayer=new ScrollLayer;return listLayer.setContentSize(447,430),listLayer.getItemNode=function(contentSize,m){var height=0,scrollLayer=new cc.Layer,list=MasterTable.getInstance().get_Voice_List();list.reverse();for(var i=0;i<list.length;i++){var l=list[i],layer=this.getVoiceContentLayer(l);null!=layer&&(layer.setPosition(0,height),scrollLayer.addChild(layer),height+=ccHeight(layer)+10)}if(height-=10,scrollLayer.setContentSize(444,height),height<487){var y=487-height;scrollLayer.setPosition(0,y)}return scrollLayer}.bind(this),listLayer.initLayout(),listLayer},getVoiceContentLayer:function(list){var layer=new cc.Layer,bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_1.png",cc.Rect(6,6,8,8));bg_box.setAnchorPoint(ZERO()),bg_box.setContentSize(440,78),bg_box.setPosition(ZERO()),bg_box.setName("bg_box"),layer.addChild(bg_box);var voice_name=cmLabelEx.getLabel(list.list_name,LABEL_FONT_INDEX.FONT_1871,!1,!0,2,cc.color(0,0,0,255));voice_name.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),voice_name.setPosition(20,ccCenter(bg_box).y),bg_box.addChild(voice_name);var voice_btn=new ccui.Button;return voice_btn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_voice_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_voice_on.png",""),voice_btn.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),voice_btn.setPosition(ccWidth(bg_box)-12,ccCenter(bg_box).y),bg_box.addChild(voice_btn),voice_btn.addClickEventListener(function(sender){this.play_voice(list.list_type,list.list_division)}.bind(this)),layer.setContentSize(ccSize(bg_box)),this.scheduleUpdate(),layer},play_voice:function(voice_type,division){var m=MasterTable.getInstance(),audio=AudioEngine.getInstance(),voice=m.get_Voice_V2(this.m_bookGeneral.gnrl_id,voice_type,division,0);if(""!=voice&&null!=voice){var path=RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3";audio.playVoice(path,!1)}},getDetailContentLayer:function(){var layer=new cc.Layer,offset_y=0,voiceActorLayer=this.getVoiceActorLayer();voiceActorLayer.setPosition(0,offset_y),layer.addChild(voiceActorLayer),offset_y+=ccHeight(voiceActorLayer)+10;var explanationLayer=this.getExplanationLayer();explanationLayer.setPosition(0,offset_y),layer.addChild(explanationLayer),offset_y+=ccHeight(explanationLayer)+10;var leaderSkillLayer=this.getLeaderSkillLayer();leaderSkillLayer.setPosition(0,offset_y),layer.addChild(leaderSkillLayer),offset_y+=ccHeight(leaderSkillLayer)+10;var passiveSkillLayer=this.getPassiveSkillLayer();passiveSkillLayer.setPosition(0,offset_y),layer.addChild(passiveSkillLayer),offset_y+=ccHeight(passiveSkillLayer)+10;var activeSkillLayer=this.getActiveSkillLayer();activeSkillLayer.setPosition(0,offset_y),layer.addChild(activeSkillLayer),offset_y+=ccHeight(activeSkillLayer)+10;var statLayer=this.getStatLayer();return statLayer.setPosition(0,offset_y),layer.addChild(statLayer),offset_y+=ccHeight(statLayer),layer.setContentSize(ccWidth(explanationLayer),offset_y),layer},getVoiceActorLayer:function(){var layer=new cc.Layer,boxSize=cc.size(440,95),boxTopSize=cc.size(440,47),info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_1.png",cc.Rect(6,6,8,8));info_box.setPreferredSize(boxSize),info_box.setAnchorPoint(ZERO()),info_box.setPosition(ZERO()),layer.addChild(info_box);var info_box_top=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_6.png",RectZero());info_box_top.setPreferredSize(boxTopSize),info_box_top.setAnchorPoint(ZERO()),info_box_top.setPosition(0,47),info_box.addChild(info_box_top);var ic_mark=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_txtmark.png");ic_mark.setAnchorPoint(ZERO()),ic_mark.setPosition(12,ccCenter(info_box_top).y-7),info_box_top.addChild(ic_mark);var cv_title=cmLabelEx.getLabel("CV ",LABEL_FONT_INDEX.FONT_2071,!1,!0,2,cc.color(0,0,0,255));cv_title.setAnchorPoint(ZERO()),cv_title.setPosition(35,ccCenter(info_box_top).y-15),info_box_top.addChild(cv_title);var actor=MasterManager.getInstance().get_VoiceActor(this.m_bookGeneral.gnrl_id),actor_label=cmLabelEx.getLabel(actor.name,LABEL_FONT_INDEX.FONT_1871,!1,!0,2,cc.color(0,0,0,255));return actor_label.setAnchorPoint(ZERO()),actor_label.setPosition(13,15),info_box.addChild(actor_label),info_box.setPreferredSize(boxSize),layer.setContentSize(boxSize),layer},getExplanationLayer:function(){var layer=new cc.Layer,boxSize=cc.size(440,106),info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_1.png",cc.Rect(6,6,8,8));info_box.setAnchorPoint(ZERO()),info_box.setPosition(ZERO()),layer.addChild(info_box);var label=cmLabelEx.getLabel(this.m_bookGeneral.content,LABEL_FONT_INDEX.FONT_1871,!1,!0,2,cc.color(0,0,0,255));return label.setAnchorPoint(ANCHOR_TOP_LEFT()),label.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),label.setTextAreaSize(cc.size(400,0)),label.ignoreContentAdaptWithSize(!1),label.setPosition(13,ccHeight(info_box)-15),info_box.addChild(label),info_box.setContentSize(boxSize.width,ccHeight(label)+30),label.setPosition(13,ccHeight(info_box)-15),layer.setContentSize(ccSize(info_box)),layer},showLeaderSkillInfoPopupLayer:function(){cc.log("Leader Skill Info Popup3"),this.getParent().getParent().showLeaderSkillExplainPopup()},showPassiveSkillInfoPopupLayer:function(){cc.log("Passive Skill Info Popup3"),this.getParent().getParent().showPassiveSkillExplainPopup()},showActiveSkillInfoPopupLayer:function(){cc.log("Active Skill Info Popup3"),this.getParent().getParent().showActiveSkillExplainPopup()},getLeaderSkillLayer:function(){var layer=new cc.Layer,m=MasterManager.getInstance(),boxSize=cc.size(440,132),boxTopSize=cc.size(440,47),info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_1.png",cc.Rect(6,6,8,8));info_box.setPreferredSize(boxSize),info_box.setAnchorPoint(ZERO()),info_box.setPosition(ZERO()),layer.addChild(info_box),layer.setContentSize(ccSize(info_box));var frame=cc.Sprite.create(RES_CDN_DEFULT+"new_icon/img_icon_frame.png");frame.setAnchorPoint(ZERO()),frame.setPosition(14,ccHeight(info_box)-boxTopSize.height),info_box.addChild(frame);var icon=new cc.Sprite;icon.setScale(1.2),icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(frame)),frame.addChild(icon);var name=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_2075,!1,!0,2,cc.color(0,0,0,255));name.setAnchorPoint(ZERO()),name.setPosition(112,62),info_box.addChild(name);var desc=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_1671,!1,!0,2,cc.color(0,0,0,255));desc.setAnchorPoint(ANCHOR_TOP_LEFT()),desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),desc.ignoreContentAdaptWithSize(!1),desc.setPosition(112,62),info_box.addChild(desc);for(var is_exist_leader_skill=!1,box_height=152,idx=0;idx<this.m_bookGeneral.leader_skill.length;idx++)if(0!=this.m_bookGeneral.leader_skill[idx]&&99999!=this.m_bookGeneral.leader_skill[idx]){var skill=m.get_LeaderSkill(this.m_bookGeneral.leader_skill[idx]);icon.setTexture(RES_CDN_DEFULT+"icon/leader/leader_"+skill.skill_icon+".png");frame.getContentSize;var line=SKILLLINECOUNT(skill,21);desc.setTextAreaSize(cc.size(320,25*line)),name.setString(skill.name),desc.setString(skill.content),is_exist_leader_skill=!0;break}if(!is_exist_leader_skill)for(var jdx=0;jdx<this.m_bookGeneral.special_leader_skill.length;jdx++)if(0!=this.m_bookGeneral.special_leader_skill[jdx]&&99999!=this.m_bookGeneral.special_leader_skill[jdx]){skill=m.get_SpecialLeaderSkill(this.m_bookGeneral.special_leader_skill[jdx]);icon.setTexture(RES_CDN_DEFULT+"icon/leader/leader_"+skill.skill_icon+".png");line=SKILLLINECOUNT(skill,21);desc.setTextAreaSize(cc.size(320,25*line)),name.setString(skill.name),desc.setString(skill.content);break}cmLabelEx.getFontSize(LABEL_FONT_INDEX.FONT_1671);64<ccHeight(desc)&&(box_height+=ccHeight(desc)-25),info_box.setContentSize(boxSize.width,box_height),layer.setContentSize(ccSize(info_box)),frame.setPosition(14,ccHeight(info_box)-140);var info_box_top=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_6.png",RectZero());info_box_top.setPreferredSize(boxTopSize),info_box_top.setAnchorPoint(ZERO()),info_box_top.setPosition(0,ccHeight(info_box)-ccHeight(info_box_top)),info_box.addChild(info_box_top);var ic_mark=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_txtmark.png");ic_mark.setAnchorPoint(ZERO()),ic_mark.setPosition(12,ccCenter(info_box_top).y-7),info_box_top.addChild(ic_mark);var title=cmLabelEx.getLabel(res_str("label_info_skill_leader"),LABEL_FONT_INDEX.FONT_2071,!1,!0,2,cc.color(0,0,0,255));if(title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(30,ccHeight(info_box)-34),info_box.addChild(title),name.setPosition(112,ccHeight(info_box)-82),desc.setPosition(112,ccHeight(info_box)-82-5),USE_SKILL_INFO_POPUP){var bg_clear_botton=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png");bg_clear_botton.setAnchorPoint(ANCHOR_TOP_LEFT()),bg_clear_botton.setPosition(112,ccHeight(info_box)-82-5),bg_clear_botton.setContentSize(ccWidth(desc),ccHeight(desc)-22.5),bg_clear_botton.setScale9Enabled(!0),bg_clear_botton.addClickEventListener(function(sender){this.showLeaderSkillInfoPopupLayer()}.bind(this)),layer.addChild(bg_clear_botton)}return layer},getPassiveSkillLayer:function(){var layer=new cc.Layer,m=MasterManager.getInstance(),boxSize=cc.size(440,132),boxTopSize=cc.size(440,47),info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_1.png",cc.Rect(6,6,8,8));info_box.setPreferredSize(boxSize),info_box.setAnchorPoint(ZERO()),info_box.setPosition(ZERO()),layer.addChild(info_box),layer.setContentSize(ccSize(info_box));var frame=cc.Sprite.create(RES_CDN_DEFULT+"new_icon/img_icon_frame.png");frame.setAnchorPoint(ZERO()),frame.setPosition(14,ccHeight(info_box)-boxTopSize.height),info_box.addChild(frame);var icon=cc.Sprite.create();icon.setScale(1.2),icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(frame)),frame.addChild(icon);var name=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_2075,!1,!0,2,cc.color(0,0,0,255));name.setAnchorPoint(ZERO()),name.setPosition(112,62),info_box.addChild(name);var desc=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_1671,!1,!0,2,cc.color(0,0,0,255));desc.setAnchorPoint(ANCHOR_TOP_LEFT()),desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),desc.ignoreContentAdaptWithSize(!1),desc.setPosition(112,62),info_box.addChild(desc);for(var is_exist_passive=!1,box_height=152,idx=0;idx<this.m_bookGeneral.passive_skill.length;idx++)if(99999!=this.m_bookGeneral.passive_skill[idx]&&0!=this.m_bookGeneral.passive_skill[idx]){if(0!=(skill=m.get_PassiveSkillV2(this.m_bookGeneral.passive_skill[idx])).skill_icon&&null!=skill.skill_icon&&null!=skill.skill_icon){var icon_name="passive_"+skill.skill_icon+".png",icon_tex=cc.spriteFrameCache.getSpriteFrame(icon_name);icon.setSpriteFrame(icon_tex)}var line=SKILLLINECOUNT(skill,21);name.setString(skill.name),desc.setString(skill.content),desc.setTextAreaSize(cc.size(320,25*line)),is_exist_passive=!0}if(!is_exist_passive&&1!=this.m_bookGeneral.gnrl_class)for(idx=0;idx<this.m_bookGeneral.trans_passive_skill.length;idx++)if(99999!=this.m_bookGeneral.trans_passive_skill[idx]&&0!=this.m_bookGeneral.trans_passive_skill[idx]){var skill;icon_name="passive_"+(skill=m.get_TransPassiveSkill(this.m_bookGeneral.trans_passive_skill[idx])).skill_icon+".png",icon_tex=cc.spriteFrameCache.getSpriteFrame(icon_name);icon.setSpriteFrame(icon_tex),name.setString(skill.name),desc.setString(skill.content);line=SKILLLINECOUNT(skill,21);desc.setTextAreaSize(cc.size(320,25*line))}cmLabelEx.getFontSize(LABEL_FONT_INDEX.FONT_1671);64<ccHeight(desc)&&(box_height+=ccHeight(desc)-25),info_box.setContentSize(boxSize.width,box_height),layer.setContentSize(ccSize(info_box)),frame.setPosition(14,ccHeight(info_box)-140);var info_box_top=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_6.png",RectZero());info_box_top.setPreferredSize(boxTopSize),info_box_top.setAnchorPoint(ZERO()),info_box_top.setPosition(0,ccHeight(info_box)-ccHeight(info_box_top)),info_box.addChild(info_box_top);var ic_mark=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_txtmark.png");ic_mark.setAnchorPoint(ZERO()),ic_mark.setPosition(12,ccCenter(info_box_top).y-7),info_box_top.addChild(ic_mark);var title=cmLabelEx.getLabel(res_str("label_info_skill_passive"),LABEL_FONT_INDEX.FONT_2071,!1,!0,2,cc.color(0,0,0,255));if(title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(30,ccHeight(info_box)-34),info_box.addChild(title),name.setPosition(112,ccHeight(info_box)-82),desc.setPosition(112,ccHeight(info_box)-82-5),USE_SKILL_INFO_POPUP){var bg_clear_botton=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png");bg_clear_botton.setAnchorPoint(ANCHOR_TOP_LEFT()),bg_clear_botton.setPosition(112,ccHeight(info_box)-82-5),bg_clear_botton.setContentSize(ccWidth(desc),ccHeight(desc)-22.5),bg_clear_botton.setScale9Enabled(!0),bg_clear_botton.addClickEventListener(function(sender){this.showPassiveSkillInfoPopupLayer()}.bind(this)),layer.addChild(bg_clear_botton)}return layer},getActiveSkillLayer:function(){var layer=new cc.Layer,m=MasterManager.getInstance(),boxSize=cc.size(440,132),boxTopSize=cc.size(440,47),info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_1.png",cc.Rect(6,6,8,8));info_box.setPreferredSize(boxSize),info_box.setAnchorPoint(ZERO()),info_box.setPosition(ZERO()),layer.addChild(info_box),layer.setContentSize(ccSize(info_box));var frame=cc.Sprite.create(RES_CDN_DEFULT+"new_icon/img_icon_frame.png");frame.setAnchorPoint(ZERO()),frame.setPosition(14,ccHeight(info_box)-boxTopSize.height),info_box.addChild(frame);var box_height=152,name=null,desc=null;if(0!=this.m_bookGeneral.active_skill){var skill=m.get_ActiveSkill(this.m_bookGeneral.active_skill),icon=cc.Sprite.create("#active_"+skill.skill_group+".png");icon.setScale(1.2),icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(frame)),frame.addChild(icon),(name=cmLabelEx.getLabel(skill.name,LABEL_FONT_INDEX.FONT_2075,!1,!0,2,cc.color(0,0,0,255))).setAnchorPoint(ZERO()),name.setPosition(112,62),info_box.addChild(name);var line=SKILLLINECOUNT(skill,21);(desc=cmLabelEx.getLabel(skill.content,LABEL_FONT_INDEX.FONT_1671,!1,!0,2,cc.color(0,0,0,255))).setAnchorPoint(ANCHOR_TOP_LEFT()),desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),desc.setTextAreaSize(cc.size(320,25*line)),desc.ignoreContentAdaptWithSize(!1),desc.setPosition(112,62),info_box.addChild(desc);cmLabelEx.getFontSize(LABEL_FONT_INDEX.FONT_1671);64<ccHeight(desc)&&(box_height+=ccHeight(desc)-25)}info_box.setContentSize(boxSize.width,box_height),layer.setContentSize(ccSize(info_box)),frame.setPosition(14,ccHeight(info_box)-140);var info_box_top=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_6.png",RectZero());info_box_top.setPreferredSize(boxTopSize),info_box_top.setAnchorPoint(ZERO()),info_box_top.setPosition(0,ccHeight(info_box)-ccHeight(info_box_top)),info_box.addChild(info_box_top);var ic_mark=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_txtmark.png");ic_mark.setAnchorPoint(ZERO()),ic_mark.setPosition(12,ccCenter(info_box_top).y-7),info_box_top.addChild(ic_mark);var title=cmLabelEx.getLabel(res_str("label_info_skill_active"),LABEL_FONT_INDEX.FONT_2071,!1,!0,2,cc.color(0,0,0,255));if(title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(30,ccHeight(info_box)-34),info_box.addChild(title),0!=this.m_bookGeneral.active_skill&&(name.setPosition(112,ccHeight(info_box)-82),desc.setPosition(112,ccHeight(info_box)-82-5)),USE_SKILL_INFO_POPUP){var bg_clear_botton=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png");bg_clear_botton.setAnchorPoint(ANCHOR_TOP_LEFT()),bg_clear_botton.setPosition(112,ccHeight(info_box)-82-5),bg_clear_botton.setContentSize(ccWidth(desc),ccHeight(desc)-22.5),bg_clear_botton.setScale9Enabled(!0),bg_clear_botton.addClickEventListener(function(sender){this.showActiveSkillInfoPopupLayer()}.bind(this)),layer.addChild(bg_clear_botton)}return layer},getStatLayer:function(){var layer=new cc.Layer,boxSize=cc.size(440,238),boxTopSize=cc.size(440,47),info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_1.png",cc.Rect(6,6,8,8));info_box.setPreferredSize(boxSize),info_box.setAnchorPoint(ZERO()),info_box.setPosition(ZERO()),layer.addChild(info_box),layer.setContentSize(ccSize(info_box)),info_box.setContentSize(boxSize.width,boxSize.height+47),layer.setContentSize(ccSize(info_box));var info_box_top=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_6.png",RectZero());info_box_top.setPreferredSize(boxTopSize),info_box_top.setAnchorPoint(ZERO()),info_box_top.setPosition(0,ccHeight(info_box)-ccHeight(info_box_top)),info_box.addChild(info_box_top);var ic_mark=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_txtmark.png");ic_mark.setAnchorPoint(ZERO()),ic_mark.setPosition(12,ccCenter(info_box_top).y-7),info_box_top.addChild(ic_mark);var title=cmLabelEx.getLabel(res_str("label_info_skill_stat"),LABEL_FONT_INDEX.FONT_2071,!1,!0,2,cc.color(0,0,0,255));title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(30,ccHeight(info_box)-34),info_box.addChild(title);for(var i=0;i<12;++i){var box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_txtbox_2.png",cc.Rect(6,6,8,8));box.setContentSize(206,30),box.setAnchorPoint(ZERO()),info_box.addChild(box);var label=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_1671,!1,!0,2,cc.color(64,64,64,255));label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),label.setPosition(8,ccCenter(box).y),box.addChild(label);if(0==i){box.setPosition(11,190),label.setString(res_str("label_attk"));var atk_label=cmLabelEx.getLabel(Number(this.m_bookGeneral.attk).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1671,!1,!0,2,cc.color(64,64,64,255));atk_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),atk_label.setPosition(212,205),info_box.addChild(atk_label)}else if(1==i){box.setPosition(11,155),label.setString(res_str("label_hp"));var hp_label=cmLabelEx.getLabel(Number(this.m_bookGeneral.hp).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1671,!1,!0,2,cc.color(64,64,64,255));hp_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),hp_label.setPosition(212,170),info_box.addChild(hp_label)}else if(2==i){box.setPosition(11,120),label.setString(res_str("label_critical_prcnt"));var cri_prcnt_label=cmLabelEx.getLabel(cmString("%.1f%%",this.m_bookGeneral.cri_prcnt),LABEL_FONT_INDEX.FONT_1671,!1,!0,2,cc.color(64,64,64,255));cri_prcnt_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),cri_prcnt_label.setPosition(212,135),info_box.addChild(cri_prcnt_label)}else if(3==i){box.setPosition(11,85),label.setString(res_str("label_defense_prcnt"));var def_prcnt_label=cmLabelEx.getLabel(cmString("%.1f%%",this.m_bookGeneral.guard_rate),LABEL_FONT_INDEX.FONT_1671,!1,!0,2,cc.color(64,64,64,255));def_prcnt_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),def_prcnt_label.setPosition(212,100),info_box.addChild(def_prcnt_label)}else if(4==i){box.setPosition(11,50),label.setString(res_str("label_element_type"));var et=MasterManager.getInstance().get_ElementType(this.m_bookGeneral.element_type),element_type_label=cmLabelEx.getLabel(et.name,LABEL_FONT_INDEX.FONT_1671,!1,!0,2,cc.color(64,64,64,255));element_type_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),element_type_label.setPosition(212,65),info_box.addChild(element_type_label)}else if(5==i){box.setPosition(11,15),label.setString(res_str("label_fight_type"));var ft=MasterManager.getInstance().get_FightType(this.m_bookGeneral.fight_type),fight_type_label=cmLabelEx.getLabel(ft.name,LABEL_FONT_INDEX.FONT_1671,!1,!0,2,cc.color(64,64,64,255));fight_type_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),fight_type_label.setPosition(212,30),info_box.addChild(fight_type_label)}else if(6==i){box.setPosition(227,190),label.setString(res_str("label_def"));var def_label=cmLabelEx.getLabel(Number(this.m_bookGeneral.def).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1671,!1,!0,2,cc.color(64,64,64,255));def_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),def_label.setPosition(426,205),info_box.addChild(def_label)}else if(7==i){box.setPosition(227,155),label.setString(res_str("label_sp"));var sp_label=cmLabelEx.getLabel(Number(this.m_bookGeneral.sp).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1671,!1,!0,2,cc.color(64,64,64,255));sp_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),sp_label.setPosition(426,170),info_box.addChild(sp_label)}else if(8==i){box.setPosition(227,120),label.setString(res_str("label_critical_damage"));var cri_dmg_label=cmLabelEx.getLabel(cmString("%.1f%%",this.m_bookGeneral.cri_ratio),LABEL_FONT_INDEX.FONT_1671,!1,!0,2,cc.color(64,64,64,255));cri_dmg_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),cri_dmg_label.setPosition(427,135),info_box.addChild(cri_dmg_label)}else if(9==i){box.setPosition(227,85),label.setString(res_str("label_defense_dicrease"));var def_decrease_label=cmLabelEx.getLabel(cmString("%.1f%%",this.m_bookGeneral.guard_decrease),LABEL_FONT_INDEX.FONT_1671,!1,!0,2,cc.color(64,64,64,255));def_decrease_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),def_decrease_label.setPosition(427,100),info_box.addChild(def_decrease_label)}else if(10==i){box.setPosition(227,50),label.setString(res_str("label_arm_service_type"));var arm_service_type_name=GeneralService.getInstance().getGeneralArmpServiceType(this.m_bookGeneral.arm_service_type),arm_service_type_label=cmLabelEx.getLabel(arm_service_type_name,LABEL_FONT_INDEX.FONT_1671,!1,!0,2,cc.color(64,64,64,255));arm_service_type_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),arm_service_type_label.setPosition(426,65),info_box.addChild(arm_service_type_label)}else if(11==i){box.setPosition(227,15),label.setString(res_str("label_state_type"));var state_type_name=GeneralService.getInstance().getGeneralStateType(this.m_bookGeneral.state_type),state_type_label=cmLabelEx.getLabel(state_type_name,LABEL_FONT_INDEX.FONT_1671,!1,!0,2,cc.color(64,64,64,255));state_type_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),state_type_label.setPosition(426,30),info_box.addChild(state_type_label)}}return layer.setContentSize(ccSize(info_box)),layer},getLevelGaugeLayer:function(){var layer=new cc.Layer,info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());info_box.setContentSize(444,56),info_box.setInsetBottom(13),info_box.setInsetLeft(13),info_box.setInsetRight(13),info_box.setInsetTop(13),info_box.setAnchorPoint(ZERO()),info_box.setPosition(ZERO()),layer.addChild(info_box),layer.setContentSize(ccSize(info_box));var cost_label=cmLabel.getLabel(res_str("label_cost"),LABEL_FONT_INDEX.FONT_201);cost_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),cost_label.setPosition(27,ccCenter(info_box).y),info_box.addChild(cost_label);var user_cost_label=cmLabel.getLabel(this.m_bookGeneral.cost,LABEL_FONT_INDEX.FONT_261);return user_cost_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),user_cost_label.setPosition(94,ccCenter(layer).y),layer.addChild(user_cost_label),layer}}),BooksGeneralSceneV2=(btn_yunhee_love_show=102,btn_character_love_level=203,btn_character_change=200,GameScene.extend({m_isSpineMode:!1,m_voice_index:1,m_skeleton_action_index:0,m_character_skeleton:null,m_characterImg:null,m_bookGeneralLayer:null,m_downerror:0,m_res_download_count:0,m_totalzipcount:0,m_curzipcount:0,m_is_voice_playing:!1,m_voice_playing_delta:0,m_morph:null,m_sceneLayer:null,m_img_scale:1,m_deferred:null,m_gnrl_img:null,m_standing_view_modal_layer:null,m_skillExplainPopup:null,m_passiveExplainPopup:null,m_LeaderSkillExplainPopup:null,m_resources:[],ctor:function(){this.m_isSpineMode=!1,this.m_voice_index=1,this.m_skeleton_action_index=0,this.m_character_skeleton=null,this.m_characterImg=null,this.m_characterLayer=null,this.m_bookGeneralLayer=null,this.m_downerror=0,this.m_res_download_count=0,this.m_totalzipcount=0,this.m_curzipcount=0,this.m_is_voice_playing=!1,this.m_voice_playing_delta=0,this.m_sceneLayer=null,this.m_morph=null,this.m_gnrl_img=null,this.m_resources=null,this.m_deferred=$.Deferred(),this._super(scene_BooksGeneralSceneV2)},get_story_deferred:function(){return this.m_deferred},init:function(){this.m_resources=[],this.m_resources.push(RES_CDN_DEFULT+"common/bg_sub_4.png"),this.m_resources.push(RES_CDN_DEFULT+"new_menu_yh/img_yh_unique_star_n.png"),this.m_resources.push(RES_CDN_DEFULT+"new_menu_yh/img_yh_unique_star_r.png"),this.m_resources.push(RES_CDN_DEFULT+"new_menu_yh/img_yh_unique_star_hr.png"),this.m_resources.push(RES_CDN_DEFULT+"new_menu_yh/img_yh_unique_star_s.png"),this.m_resources.push(RES_CDN_DEFULT+"new_menu_yh/img_yh_unique_star_ss.png"),this.m_resources.push(RES_CDN_DEFULT+"new_menu_yh/img_yh_unique_01.png"),this.m_resources.push(RES_CDN_DEFULT+"new_menu_yh/img_yh_unique_02.png"),this.m_resources.push(RES_CDN_DEFULT+"new_menu_yh/img_yh_unique_03.png"),this.m_resources.push(RES_CDN_DEFULT+"new_menu_yh/img_yh_unique_04.png"),this.m_resources.push(RES_CDN_DEFULT+"new_menu_yh/img_yh_unique_05.png"),this.m_resources.push(RES_CDN_DEFULT+"new_menu_yh/img_yh_unique_06.png"),resourceLoader(this.m_resources,function(){this.m_sceneLayer=new BooksGeneralSceneLayerV2(this.back.bind(this),this.m_deferred),this.addChild(this.m_sceneLayer),this.m_standing_view_modal_layer=new GameModalLayer,this.addChild(this.m_standing_view_modal_layer,100),USE_SKILL_INFO_POPUP&&(this.m_skillExplainPopup=new GameModalLayer,this.addChild(this.m_skillExplainPopup,100),this.m_passiveExplainPopup=new GameModalLayer,this.addChild(this.m_passiveExplainPopup,100),this.m_LeaderSkillExplainPopup=new GameModalLayer,this.addChild(this.m_LeaderSkillExplainPopup,100))}.bind(this))},back:function(){this.m_isPushScene?SceneManager.getInstance().popScene():this.onKeyBack()},showLeaderSkillExplainPopup:function(){this.m_LeaderSkillExplainPopup.setContentSize(ccSize(this)),this.m_LeaderSkillExplainPopup._contentNode=function(contentSize,m){return this.getLeaderSkillPopupLayer()}.bind(this),this.m_LeaderSkillExplainPopup.show()},hideLeaderSkillExplainPopup:function(){this.m_LeaderSkillExplainPopup.is_show()&&this.m_LeaderSkillExplainPopup.hide()},showPassiveSkillExplainPopup:function(){this.m_passiveExplainPopup.setContentSize(ccSize(this)),this.m_passiveExplainPopup._contentNode=function(contentSize,m){return this.getPassiveSkillPopupLayer()}.bind(this),this.m_passiveExplainPopup.show()},hidePassiveSkillExplainPopup:function(){this.m_passiveExplainPopup.is_show()&&this.m_passiveExplainPopup.hide()},showActiveSkillExplainPopup:function(){this.m_skillExplainPopup.setContentSize(ccSize(this)),this.m_skillExplainPopup._contentNode=function(contentSize,m){return this.getActiveSkillPopupLayer()}.bind(this),this.m_skillExplainPopup.show()},hideActiveSkillExplainPopup:function(){this.m_skillExplainPopup.is_show()&&this.m_skillExplainPopup.hide()},getActiveSkillPopupLayer:function(){var win_size=cc.director.getWinSize(),layer=new cc.Layer,m=MasterManager.getInstance(),boxTopSize=(cc.size(440,132),cc.size(ccWidth(this),58)),info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_1.png",cc.Rect(6,6,8,8));info_box.setAnchorPoint(ANCHOR_MIDDLE()),info_box.setPosition(ccCenter(this)),layer.addChild(info_box),layer.setContentSize(ccSize(info_box));var frame=cc.Sprite.create(RES_CDN_DEFULT+"new_icon/img_icon_frame.png");frame.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),frame.setPosition(14,ccHeight(info_box)-boxTopSize.height-42),info_box.addChild(frame);var name=null,desc=null,box_height=152;if(0!=this.m_sceneLayer.m_bookGeneral.active_skill){var skill=m.get_ActiveSkill(this.m_sceneLayer.m_bookGeneral.active_skill),icon=cc.Sprite.create("#active_"+skill.skill_group+".png");icon.setScale(1.2),icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(frame)),frame.addChild(icon),(name=cmLabelEx.getLabel(skill.name,LABEL_FONT_INDEX.FONT_4545,!1,!0,2,cc.color(0,0,0,255))).setAnchorPoint(ZERO()),name.setPosition(112,20),info_box.addChild(name);var line=SKILLLINECOUNT(skill,19);if((desc=cmLabelEx.getLabel(skill.content,LABEL_FONT_INDEX.FONT_4546,!1,!0,2,cc.color(0,0,0,255))).setAnchorPoint(ANCHOR_TOP_LEFT()),desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),desc.setTextAreaSize(cc.size(winSize.width-150,50*line+45)),desc.ignoreContentAdaptWithSize(!1),desc.setPosition(112,20),info_box.addChild(desc),400<ccHeight(desc)){var line2=SKILLLINECOUNT(skill,21);desc.setFontSize(36),desc.setTextAreaSize(cc.size(winSize.width-150,36*line2+36)),64<ccHeight(desc)?box_height+=ccHeight(desc)-45+84:box_height+=148}else 64<ccHeight(desc)?box_height+=ccHeight(desc)-45+84:box_height+=148}info_box.setContentSize(ccWidth(this),box_height),layer.setContentSize(ccSize(info_box)),frame.setPosition(14,ccHeight(info_box)-140-42);var info_box_top=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_6.png",RectZero());info_box_top.setPreferredSize(boxTopSize),info_box_top.setAnchorPoint(ZERO()),info_box_top.setPosition(0,ccHeight(info_box)-ccHeight(info_box_top)),info_box.addChild(info_box_top);var ic_mark=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_txtmark.png");ic_mark.setAnchorPoint(ZERO()),ic_mark.setPosition(12,ccCenter(info_box_top).y-7),info_box_top.addChild(ic_mark);var title=cmLabelEx.getLabel(res_str("label_info_skill_active"),LABEL_FONT_INDEX.FONT_4546,!1,!0,2,cc.color(0,0,0,255));title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(30,ccHeight(info_box)-34-32),info_box.addChild(title),0!=this.m_sceneLayer.m_bookGeneral.active_skill&&(name.setPosition(112,ccHeight(info_box)-82-42),desc.setPosition(112,ccHeight(info_box)-82-5-42));var bg_clear_botton=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png");bg_clear_botton.setAnchorPoint(ZERO()),bg_clear_botton.setPosition(ZERO()),bg_clear_botton.setContentSize(ccWidth(win_size),ccHeight(win_size)),bg_clear_botton.setScale9Enabled(!0),bg_clear_botton.addClickEventListener(function(sender){this.hideActiveSkillExplainPopup()}.bind(this)),layer.addChild(bg_clear_botton);var back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);return back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(info_box)-10-3,ccHeight(info_box)-34+18+9),back_btn.addClickEventListener(function(sender){this.hideActiveSkillExplainPopup()}.bind(this)),info_box.addChild(back_btn),layer},getPassiveSkillPopupLayer:function(){var win_size=cc.director.getWinSize(),layer=new cc.Layer,m=MasterManager.getInstance(),boxTopSize=(cc.size(440,132),cc.size(ccWidth(this),58)),info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_1.png",cc.Rect(6,6,8,8));info_box.setAnchorPoint(ANCHOR_MIDDLE()),info_box.setPosition(ccCenter(this)),layer.addChild(info_box),layer.setContentSize(ccSize(info_box));var frame=cc.Sprite.create(RES_CDN_DEFULT+"new_icon/img_icon_frame.png");frame.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),frame.setPosition(14,ccHeight(info_box)-boxTopSize.height-42),info_box.addChild(frame);var icon=new cc.Sprite;icon.setScale(1.2),icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(frame)),frame.addChild(icon);var name=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_4545,!1,!0,2,cc.color(0,0,0,255));name.setAnchorPoint(ZERO()),name.setPosition(112,20),info_box.addChild(name);var desc=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_4546,!1,!0,2,cc.color(0,0,0,255));desc.setAnchorPoint(ANCHOR_TOP_LEFT()),desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),desc.ignoreContentAdaptWithSize(!1),desc.setPosition(112,20),info_box.addChild(desc);for(var is_exist_passive=!1,box_height=152,idx=0;idx<this.m_sceneLayer.m_bookGeneral.passive_skill.length;idx++)if(99999!=this.m_sceneLayer.m_bookGeneral.passive_skill[idx]&&0!=this.m_sceneLayer.m_bookGeneral.passive_skill[idx]){if(0!=(skill=m.get_PassiveSkillV2(this.m_sceneLayer.m_bookGeneral.passive_skill[idx])).skill_icon&&null!=skill.skill_icon&&null!=skill.skill_icon){var icon_name="passive_"+skill.skill_icon+".png",icon_tex=cc.spriteFrameCache.getSpriteFrame(icon_name);icon.setSpriteFrame(icon_tex)}var line=SKILLLINECOUNT(skill,19);name.setString(skill.name),desc.setString(skill.content),desc.setTextAreaSize(cc.size(winSize.width-150,50*line+45)),is_exist_passive=!0}if(!is_exist_passive&&1!=this.m_sceneLayer.m_bookGeneral.gnrl_class)for(idx=0;idx<this.m_sceneLayer.m_bookGeneral.trans_passive_skill.length;idx++)if(99999!=this.m_sceneLayer.m_bookGeneral.trans_passive_skill[idx]&&0!=this.m_sceneLayer.m_bookGeneral.trans_passive_skill[idx]){var skill;icon_name="passive_"+(skill=m.get_TransPassiveSkill(this.m_sceneLayer.m_bookGeneral.trans_passive_skill[idx])).skill_icon+".png",icon_tex=cc.spriteFrameCache.getSpriteFrame(icon_name);icon.setSpriteFrame(icon_tex),name.setString(skill.name),desc.setString(skill.content);line=SKILLLINECOUNT(skill,19);desc.setTextAreaSize(cc.size(winSize.width-150,50*line+45))}if(400<ccHeight(desc)){var line2=SKILLLINECOUNT(skill,21);desc.setFontSize(36),desc.setTextAreaSize(cc.size(winSize.width-150,36*line2+36)),64<ccHeight(desc)?box_height+=ccHeight(desc)-45+84:box_height+=148}else 64<ccHeight(desc)?box_height+=ccHeight(desc)-45+84:box_height+=148;info_box.setContentSize(ccWidth(this),box_height),layer.setContentSize(ccSize(info_box)),frame.setPosition(14,ccHeight(info_box)-140-42);var info_box_top=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_6.png",RectZero());info_box_top.setPreferredSize(boxTopSize),info_box_top.setAnchorPoint(ZERO()),info_box_top.setPosition(0,ccHeight(info_box)-ccHeight(info_box_top)),info_box.addChild(info_box_top);var ic_mark=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_txtmark.png");ic_mark.setAnchorPoint(ZERO()),ic_mark.setPosition(12,ccCenter(info_box_top).y-7),info_box_top.addChild(ic_mark);var title=cmLabelEx.getLabel(res_str("label_info_skill_passive"),LABEL_FONT_INDEX.FONT_4546,!1,!0,2,cc.color(0,0,0,255));title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(30,ccHeight(info_box)-34-32),info_box.addChild(title),name.setPosition(112,ccHeight(info_box)-82-42),desc.setPosition(112,ccHeight(info_box)-82-5-42);var bg_clear_botton=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png");bg_clear_botton.setAnchorPoint(ZERO()),bg_clear_botton.setPosition(ZERO()),bg_clear_botton.setContentSize(ccWidth(win_size),ccHeight(win_size)),bg_clear_botton.setScale9Enabled(!0),bg_clear_botton.addClickEventListener(function(sender){this.hidePassiveSkillExplainPopup()}.bind(this)),layer.addChild(bg_clear_botton);var back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);return back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(info_box)-10-3,ccHeight(info_box)-34+18+9),back_btn.addClickEventListener(function(sender){this.hidePassiveSkillExplainPopup()}.bind(this)),info_box.addChild(back_btn),layer},getLeaderSkillPopupLayer:function(){var win_size=cc.director.getWinSize(),layer=new cc.Layer,m=MasterManager.getInstance(),boxTopSize=(cc.size(440,132),cc.size(ccWidth(this),58)),info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_1.png",cc.Rect(6,6,8,8));info_box.setAnchorPoint(ANCHOR_MIDDLE()),info_box.setPosition(ccCenter(this)),layer.addChild(info_box),layer.setContentSize(ccSize(info_box));var frame=cc.Sprite.create(RES_CDN_DEFULT+"new_icon/img_icon_frame.png");frame.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),frame.setPosition(14,ccHeight(info_box)-boxTopSize.height-42),info_box.addChild(frame);var icon=new cc.Sprite;icon.setScale(1.2),icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(frame)),frame.addChild(icon);var name=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_4545,!1,!0,2,cc.color(0,0,0,255));name.setAnchorPoint(ZERO()),name.setPosition(112,20),info_box.addChild(name);var desc=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_4546,!1,!0,2,cc.color(0,0,0,255));desc.setAnchorPoint(ANCHOR_TOP_LEFT()),desc.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),desc.ignoreContentAdaptWithSize(!1),desc.setPosition(112,20),info_box.addChild(desc);for(var is_exist_leader_skill=!1,box_height=152,idx=0;idx<this.m_sceneLayer.m_bookGeneral.leader_skill.length;idx++)if(0!=this.m_sceneLayer.m_bookGeneral.leader_skill[idx]&&99999!=this.m_sceneLayer.m_bookGeneral.leader_skill[idx]){var skill=m.get_LeaderSkill(this.m_sceneLayer.m_bookGeneral.leader_skill[idx]);icon.setTexture(RES_CDN_DEFULT+"icon/leader/leader_"+skill.skill_icon+".png");frame.getContentSize;var line=SKILLLINECOUNT(skill,19);desc.setTextAreaSize(cc.size(winSize.width-150,50*line+45)),name.setString(skill.name),desc.setString(skill.content),is_exist_leader_skill=!0;break}if(!is_exist_leader_skill)for(var jdx=0;jdx<this.m_sceneLayer.m_bookGeneral.special_leader_skill.length;jdx++)if(0!=this.m_sceneLayer.m_bookGeneral.special_leader_skill[jdx]&&99999!=this.m_sceneLayer.m_bookGeneral.special_leader_skill[jdx]){skill=m.get_SpecialLeaderSkill(this.m_sceneLayer.m_bookGeneral.special_leader_skill[jdx]);icon.setTexture(RES_CDN_DEFULT+"icon/leader/leader_"+skill.skill_icon+".png");line=SKILLLINECOUNT(skill,19);desc.setTextAreaSize(cc.size(winSize.width-150,50*line+45)),name.setString(skill.name),desc.setString(skill.content);break}cmLabelEx.getFontSize(LABEL_FONT_INDEX.FONT_1671);64<ccHeight(desc)?box_height+=ccHeight(desc)-25+84:box_height+=148,info_box.setContentSize(ccWidth(this),box_height),layer.setContentSize(ccSize(info_box)),frame.setPosition(14,ccHeight(info_box)-140-42);var info_box_top=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_in_6.png",RectZero());info_box_top.setPreferredSize(boxTopSize),info_box_top.setAnchorPoint(ZERO()),info_box_top.setPosition(0,ccHeight(info_box)-ccHeight(info_box_top)),info_box.addChild(info_box_top);var ic_mark=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_txtmark.png");ic_mark.setAnchorPoint(ZERO()),ic_mark.setPosition(12,ccCenter(info_box_top).y-7),info_box_top.addChild(ic_mark);var title=cmLabelEx.getLabel(res_str("label_info_skill_leader"),LABEL_FONT_INDEX.FONT_4546,!1,!0,2,cc.color(0,0,0,255));title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(30,ccHeight(info_box)-34-32),info_box.addChild(title),name.setPosition(112,ccHeight(info_box)-82-42),desc.setPosition(112,ccHeight(info_box)-82-5-42);var bg_clear_botton=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_clear_on.png");bg_clear_botton.setAnchorPoint(ZERO()),bg_clear_botton.setPosition(ZERO()),bg_clear_botton.setContentSize(ccWidth(win_size),ccHeight(win_size)),bg_clear_botton.setScale9Enabled(!0),bg_clear_botton.addClickEventListener(function(sender){this.hideLeaderSkillExplainPopup()}.bind(this)),layer.addChild(bg_clear_botton);var back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);return back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(info_box)-10-3,ccHeight(info_box)-34+18+9),back_btn.addClickEventListener(function(sender){this.hideLeaderSkillExplainPopup()}.bind(this)),info_box.addChild(back_btn),layer},onNotification:function(msg){switch(this._super(msg),msg){case btn_yunhee_love_show:this.showYunheeLoveCGMsgBox();break;case BookEnum.btn_character_change:this.m_sceneLayer.changeCharacter();break;case BookEnum.btn_show_resistance_help:GameContext.getInstance().setHelpInfoIndexByCallIndex(11);var scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null;break;case BookEnum.btn_standing_detail_view:var standing_gnrl=GameContext.getInstance().getDetailStandingGnrl();0!=standing_gnrl.gnrl_id&&this.showStandingDetailViewPopup(standing_gnrl)}},showStandingDetailViewPopup:function(detail_gnrl){this.m_standing_view_modal_layer.setContentSize(ccSize(this)),this.m_standing_view_modal_layer._contentNode=function(contentSize,m){var layer=new cc.Layer,viewer=new YunheeStandingViewLayer(detail_gnrl,this.hideStandingDetailViewPopup.bind(this));return layer.addChild(viewer),layer.setContentSize(ccSize(viewer)),layer.setPosition(568,320),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),viewer.setPosition(ccCenter(layer)),layer}.bind(this),this.m_standing_view_modal_layer.is_show()&&this.m_standing_view_modal_layer.hide(),this.m_standing_view_modal_layer.show()},hideStandingDetailViewPopup:function(){this.m_standing_view_modal_layer.is_show()&&this.m_standing_view_modal_layer.hide()},showYunheeLoveCGMsgBox:function(){this.m_box.is_show()&&this.m_box.hide(!1),this.m_box.setTitle(""),this.m_box.setText(""),this.m_box.setText("\n"),this.m_box.setText(""),this.m_box.addButtonInfo(new MessageButtonInfo("",MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo("",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(),this.showCheckLoveCG()}.bind(this))),this.m_box.show()},showCheckLoveCG:function(){this.m_box.is_show()&&this.m_box.hide(!1);var love_cg_gnrl_id=GameContext.getInstance().getLoveCgGnrlId(),scene=new LoveContentsCGScene(love_cg_gnrl_id);SceneManager.getInstance().pushScene(scene),scene=null},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_BooksGeneralSceneV2])},onExit:function(){if(this._super(),MainObserver.getInstance().removeObserver(sceneStr[scene_BooksGeneralSceneV2]),!this.m_isPushScene){if(null!=this.m_resources){for(var idx=0;idx<this.m_resources.length;idx++)cc.loader.release(this.m_resources[idx]);this.m_resources=null}this.m_sceneLayer.clearResource(),this.removeAllChildrenWithCleanup(!0),this.m_sceneLayer=null}}})),BooksGeneralSceneLayerV2=cc.Layer.extend({callback:null,m_skeletonNode:null,m_character_skeleton:null,m_characterLayer:null,m_touchEventLayer:null,m_sceneId:null,m_skeleton_action_index:null,m_deferred:null,m_standing_gnrl_id:null,m_skin_id:null,m_bg:null,ctor:function(_callback,m_deferred){this._super(),this.m_deferred=m_deferred,this.m_skeletonNode=null,this.m_character_skeleton=null,this.m_sceneId=scene_BooksGeneralSceneV2,this.callback=_callback,this.m_bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub_4.png"),this.m_bg.setPosition(cc.p(this.width/2,this.height/2)),USE_SP_COMMON_SUB_BG_SCALE&&this.m_bg.setScale(2),this.addChild(this.m_bg);var book_general_num=GameContext.getInstance().getBookGeneral().book_num;this.m_bookGeneral=new db.UserBookGeneral,GeneralService.getInstance().getBookGeneralInfo(book_general_num,this.m_bookGeneral),this.m_skeleton_action_index=0,this.m_standing_gnrl_id=this.m_bookGeneral.gnrl_id,3<this.m_bookGeneral.gnrl_class&&(this.m_standing_gnrl_id-=1e3),this.m_skin_id=0,this.m_bookGeneral.bone_id!=this.m_bookGeneral.skin_id?this.m_skin_id=this.m_standing_gnrl_id:this.m_skin_id=this.m_bookGeneral.skin_id,this.m_morph=MasterTable.getInstance().get_MorphData(this.m_standing_gnrl_id);var gg=MasterManager.getInstance().get_General(this.m_bookGeneral.bone_id);if("y"==this.m_morph.is_morph){var gnrl=MasterManager.getInstance().get_General(this.m_morph.gnrl_id);if(this.m_gnrl_img=[],USE_PARTNER_GNRL_LOADING){if(SAVE_NOW_PARTNER_GNRL.gnrl_id!=this.m_morph.gnrl_id){if(null==(stading_files=StandingMultiplePngList[this.m_morph.gnrl_id]))this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+this.m_morph.gnrl_id+".png");else for(var idx=0;idx<stading_files.length;idx++)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+stading_files[idx]+".png");this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".atlas"),this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".json")}}else{var stading_files;if(null==(stading_files=StandingMultiplePngList[this.m_morph.gnrl_id]))this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+this.m_morph.gnrl_id+".png");else for(idx=0;idx<stading_files.length;idx++)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+stading_files[idx]+".png");this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".atlas"),this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".json")}this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gg.gnrl_group,3)+"/sd/"+this.m_bookGeneral.skin_id+".atlas"),this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gg.gnrl_group,3)+"/sd/"+this.m_bookGeneral.skin_id+".json");var sd_files=SDGeneralName[gg.gnrl_group];for(idx=0;idx<sd_files.length;idx++)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gg.gnrl_group,3)+"/sd/"+sd_files[idx]+".png");resourceLoader(this.m_gnrl_img,function(){this.initGeneral()}.bind(this))}else{var general=MasterManager.getInstance().get_General(this.m_bookGeneral.gnrl_id);if(this.m_gnrl_img=[],USE_PARTNER_GNRL_LOADING){if(SAVE_NOW_PARTNER_GNRL.gnrl_id!=this.m_bookGeneral.gnrl_id)if(general.gnrl_type==GENERAL_TYPE_YUNHEE){if(MasterManager.getInstance().get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var str=getCardBody_ImageStr(general.gnrl_id);this.m_gnrl_img.push(str)}else{str=getCardBody_ImageStr(general.gnrl_id);this.m_gnrl_img.push(str)}}else{str=getCardBody_ImageStr(this.m_bookGeneral.gnrl_id);this.m_gnrl_img.push(str)}}else if(general.gnrl_type==GENERAL_TYPE_YUNHEE){if(MasterManager.getInstance().get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){str=getCardBody_ImageStr(general.gnrl_id);this.m_gnrl_img.push(str)}else{str=getCardBody_ImageStr(general.gnrl_id);this.m_gnrl_img.push(str)}}else{str=getCardBody_ImageStr(this.m_bookGeneral.gnrl_id);this.m_gnrl_img.push(str)}this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gg.gnrl_group,3)+"/sd/"+this.m_bookGeneral.skin_id+".atlas"),this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gg.gnrl_group,3)+"/sd/"+this.m_bookGeneral.skin_id+".json");for(sd_files=SDGeneralName[gg.gnrl_group],idx=0;idx<sd_files.length;idx++)this.m_gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gg.gnrl_group,3)+"/sd/"+sd_files[idx]+".png");cc.loader.load(this.m_gnrl_img,function(err,results){err?cc.log("Failed to load %s.",this.m_gnrl_img):this.initGeneral()}.bind(this))}var listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(touch,event){var rect=cc.rect(this.m_touchEventLayer.getPosition().x,this.m_touchEventLayer.getPosition().y,this.m_touchEventLayer.getContentSize().width,this.m_touchEventLayer.getContentSize().height),pos=touch.getLocation();return!!cc.rectContainsPoint(rect,pos)}.bind(this),onTouchEnded:function(touch,event){var m=MasterTable.getInstance();if(this.m_isSpineMode){2<this.m_skeleton_action_index&&(this.m_skeleton_action_index=1),0==this.m_skeleton_action_index?(this.m_skeletonNode.setAnimation(0,"prepare",!1),this.m_skeletonNode.addAnimation(0,"idle",!0)):1==this.m_skeleton_action_index?(this.m_skeletonNode.setAnimation(0,"attack1",!1),this.m_skeletonNode.addAnimation(0,"idle",!0)):2==this.m_skeleton_action_index&&(this.m_skeletonNode.setAnimation(0,"attack2",!1),this.m_skeletonNode.addAnimation(0,"idle",!0)),this.m_skeleton_action_index++;var duration=0,ref={},voice=(voice_list=m.get_Voice(this.m_bookGeneral.gnrl_id,voice_detail_sd_touch,ref)).voice;if(duration=voice_list.duration,!this.m_is_voice_playing)if(voice&&""!=voice)AudioEngine.getInstance().playVoice(RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3",!1),this.m_is_voice_playing=!0,this.m_voice_playing_delta=duration}else{var voice_list,is_voice_play=!1;duration=0,ref={},voice=(voice_list=m.get_Voice(this.m_bookGeneral.gnrl_id,voice_books_body_touch,ref)).voice;if(duration=voice_list.duration,null!=this.m_characterImg){this.m_characterImg.stopAllActions();var s1=new cc.ScaleTo(.1,this.m_img_scale+.03,this.m_img_scale-.03),s2=new cc.ScaleTo(.2,this.m_img_scale-.03,this.m_img_scale+.03),s3=new cc.ScaleTo(.15,this.m_img_scale+.02,this.m_img_scale-.02),s4=new cc.ScaleTo(.8,this.m_img_scale,this.m_img_scale),callback=new cc.CallFunc(this.characterIdelAction,this),e4=new cc.EaseElasticOut(s4),seq=new cc.Sequence(s1,s2,s3,e4,callback);this.m_characterImg.runAction(seq),is_voice_play=!0}else this.m_character_skeleton.setAnimation(0,"active",!1),this.m_character_skeleton.addAnimation(0,"basic",!0),is_voice_play=!0;if(is_voice_play)if(!this.m_is_voice_playing)if(voice&&""!=voice)AudioEngine.getInstance().playVoice(RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3",!1),this.m_is_voice_playing=!0,this.m_voice_playing_delta=duration}}.bind(this)});cc.eventManager.addListener(listener,this),this.scheduleUpdate()},onExit:function(){this._super()},clearResource:function(){if(1!=this.getParent().m_isPopupShow){if(null!=this.m_gnrl_img)if(1==USE_PARTNER_GNRL_LOADING)if(0<SAVE_NOW_PARTNER_GNRL.res_img.length)for(var idx=0;idx<this.m_gnrl_img.length;idx++){for(var check_release=!1,jdx=0;jdx<SAVE_NOW_PARTNER_GNRL.res_img.length;jdx++)SAVE_NOW_PARTNER_GNRL.res_img[jdx]==this.m_gnrl_img[idx]&&(check_release=!0);0==check_release&&cc.loader.release(this.m_gnrl_img[idx])}else for(idx=0;idx<this.m_gnrl_img.length;idx++)cc.loader.release(this.m_gnrl_img[idx]);else{for(idx=0;idx<this.m_gnrl_img.length;idx++)cc.loader.release(this.m_gnrl_img[idx]);this.m_gnrl_img=null}null!=this.m_skeletonNode&&(this.removeChild(this.m_skeletonNode),this.m_skeletonNode._skeleton.data.animations=[],this.m_skeletonNode._skeleton.data.bones=[],this.m_skeletonNode._skeleton.data.events=[],this.m_skeletonNode._skeleton.data.slots=[],this.m_skeletonNode._skeleton.data.skins=[],this.m_skeletonNode._skeleton.slots=[],this.m_skeletonNode._spineComplete=null,this.m_skeletonNode._skeleton=null,this.m_skeletonNode=null),null!=this.m_character_skeleton&&(this.removeChild(this.m_character_skeleton),this.m_character_skeleton._skeleton.data.animations=[],this.m_character_skeleton._skeleton.data.bones=[],this.m_character_skeleton._skeleton.data.events=[],this.m_character_skeleton._skeleton.data.slots=[],this.m_character_skeleton._skeleton.data.skins=[],this.m_character_skeleton._skeleton.slots=[],this.m_character_skeleton._spineComplete=null,this.m_character_skeleton._skeleton=null,this.m_character_skeleton=null),null!=this.m_bg&&(this.removeChild(this.m_bg),this.m_bg=null)}},update:function(dt){this.m_is_voice_playing&&(this.m_voice_playing_delta-=dt,this.m_voice_playing_delta<0&&(this.m_is_voice_playing=!1,this.m_voice_playing_delta=0))},initGeneral:function(){var win_size=cc.director.getWinSize();this.m_characterLayer=this.getCharacterLayer(),this.m_characterLayer.ignoreAnchorPointForPosition(!1),this.m_characterLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_characterLayer.setPosition(cc.p((this.width-478)/2,0)),this.addChild(this.m_characterLayer);var bg_mask=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_mask.png");bg_mask.setAnchorPoint(cc.p(.5,0)),bg_mask.setPosition(this.width/2,0),this.addChild(bg_mask),this.m_bookGeneralLayer=new BooksGeneralLayerV2,this.m_bookGeneralLayer.setBookGeneralInfo(this.m_bookGeneral),this.m_bookGeneralLayer.initLayout(),this.m_bookGeneralLayer.setPosition(cc.p(0,0)),this.addChild(this.m_bookGeneralLayer),this.m_touchEventLayer=new cc.Layer,this.m_touchEventLayer.ignoreAnchorPointForPosition(!1),this.m_touchEventLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_touchEventLayer.setContentSize(cc.size(400,520)),this.m_touchEventLayer.setPosition(ccCenter(this.m_characterLayer).x,0),this.m_characterLayer.addChild(this.m_touchEventLayer);var statusLayer=new StatusLayer(INVOKER_TYPE.normal);statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(cc.p(win_size.width,win_size.height)),this.addChild(statusLayer);var back_btn=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png","");back_btn.setAnchorPoint(cc.p(0,0)),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(this.callback),this.addChild(back_btn);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_book.png");title.setAnchorPoint(cc.p(0,0)),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title)},changeCharacter:function(){var mt=MasterManager.getInstance(),standing_gnrl_id=this.m_bookGeneral.gnrl_id;3<this.m_bookGeneral.gnrl_class&&(standing_gnrl_id-=1e3);var pos=mt.get_BodyPosition(standing_gnrl_id);if("y"==MasterTable.getInstance().get_MorphData(standing_gnrl_id).is_morph)this.m_character_skeleton.stopAllActions(),this.m_skeletonNode.stopAllActions(),this.m_isSpineMode?(this.m_skeletonNode.runAction(new cc.Sequence(new cc.MoveTo(.18,cc.p(-2048,120)),new cc.FadeOut(0))),this.m_character_skeleton.runAction(new cc.MoveTo(.2,Detail_pos(pos.posx,pos.posy))),this.m_isSpineMode=!1,this.m_character_skeleton.setAnimation(0,"active",!1),this.m_character_skeleton.addAnimation(0,"basic",!0),this.m_character_skeleton.addAnimation(1,"loop",!0)):(this.m_character_skeleton.runAction(new cc.MoveTo(.2,Detail_pos(-2048,pos.posy))),this.m_skeletonNode.runAction(new cc.Sequence(new cc.FadeIn(0),new cc.MoveTo(.18,cc.p(243,120)))),this.m_isSpineMode=!0);else if(this.m_skeletonNode.stopAllActions(),this.m_characterImg.stopAllActions(),this.m_isSpineMode){this.m_skeletonNode.runAction(new cc.Sequence(new cc.MoveTo(.18,cc.p(-ccWidth(this.m_characterImg)*this.m_img_scale-100,120)),new cc.FadeOut(0)));var callback=new cc.CallFunc(this.characterIdelAction,this);this.m_characterImg.runAction(new cc.Sequence(new cc.MoveTo(.2,Detail_pos(pos.posx+ccWidth(this.m_characterImg)*this.m_img_scale/2,pos.posy+ccHeight(this.m_characterImg)*this.m_img_scale/2)),callback)),this.m_isSpineMode=!1}else this.m_characterImg.runAction(new cc.MoveTo(.2,Detail_pos(-ccWidth(this.m_characterImg)*this.m_img_scale*2-150,pos.posy+ccHeight(this.m_characterImg)*this.m_img_scale/2))),this.m_skeletonNode.runAction(new cc.Sequence(new cc.FadeIn(0),new cc.MoveTo(.18,cc.p(243,120)))),this.m_isSpineMode=!0;this.m_is_voice_playing=!1,this.m_voice_playing_delta=0},getCharacterLayer:function(){var layer=new cc.Layer;layer.setContentSize(480,640);var mt=MasterManager.getInstance(),pos=mt.get_BodyPosition(this.m_standing_gnrl_id);if(cc.log(pos),"y"==this.m_morph.is_morph){var gnrl=mt.get_General(this.m_morph.gnrl_id),gnrl_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".json",gnrl_atals=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".atlas";(img_list=[]).push(gnrl_json),img_list.push(gnrl_atals),resourceLoader(img_list,function(){this.m_character_skeleton=new sp.SkeletonAnimation(gnrl_json,gnrl_atals,.1),this.m_character_skeleton.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_character_skeleton.setPosition(Detail_pos(pos.posx,pos.posy)),cc.log("pos m_character_skeleton"+pos.posx,pos.posy),layer.addChild(this.m_character_skeleton),this.m_character_skeleton.setMix("basic","active",.1),this.m_character_skeleton.setMix("active","basic",.1),this.m_character_skeleton.setAnimation(0,"active",!1),this.m_character_skeleton.addAnimation(0,"basic",!0),this.m_deferred.resolve(!0)}.bind(this))}else{var img_list,general=mt.get_General(this.m_bookGeneral.gnrl_id);if(this.m_img_scale=1,general.gnrl_type==GENERAL_TYPE_YUNHEE){if(mt.get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id)}else{img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id)}}else{img_str=getCardBody_ImageStr(this.m_bookGeneral.gnrl_id);this.m_img_scale=getCardBody_Scale(this.m_bookGeneral.gnrl_id)}(img_list=[]).push(img_str),resourceLoader(img_list,function(){this.m_characterImg=cc.Sprite.create(img_str),this.m_characterImg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_characterImg.setScale(this.m_img_scale),this.m_characterImg.setPosition(Detail_pos(pos.posx+this.m_characterImg.width*this.m_img_scale/2,pos.posy+this.m_characterImg.height*this.m_img_scale/2)),layer.addChild(this.m_characterImg);var callback=new cc.CallFunc(this.characterIdelAction,this);this.m_characterImg.runAction(callback),this.m_deferred.resolve(!0)}.bind(this))}var gg=mt.get_General(this.m_bookGeneral.bone_id),sd_atlas=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gg.gnrl_group,3)+"/sd/"+this.m_bookGeneral.skin_id+".atlas",sd_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gg.gnrl_group,3)+"/sd/"+this.m_bookGeneral.skin_id+".json";this.m_skeletonNode=new sp.SkeletonAnimation(sd_json,sd_atlas),this.m_skeletonNode.setScale(.55),null!=this.m_characterImg||null!=this.m_characterImg?this.m_skeletonNode.setPosition(-this.m_characterImg.width*this.m_img_scale,120):this.m_skeletonNode.setPosition(-2048,120),layer.addChild(this.m_skeletonNode);try{var display_class=this.m_bookGeneral.gnrl_class;3<display_class&&(display_class=3),this.m_skeletonNode.setSkin(cmString("%d",display_class))}catch(e){this.m_skeletonNode.setSkin("default")}return this.m_skeletonNode.setAnimation(0,"basic",!0),this.m_skeletonNode.setMix("basic","prepare",.1),this.m_skeletonNode.setMix("prepare","basic",.1),this.m_skeletonNode.setMix("attack1","prepare",.1),this.m_skeletonNode.setMix("prepare","attack1",.1),this.m_skeletonNode.setMix("attack2","prepare",.1),this.m_skeletonNode.setMix("prepare","attack2",.1),this.m_skeletonNode.setMix("attack1","basic",.1),this.m_skeletonNode.setMix("basic","attack1",.1),this.m_skeletonNode.setMix("attack2","basic",.1),this.m_skeletonNode.setMix("basic","attack2",.1),this.m_skeletonNode.setMix("attack1","attack2",.1),this.m_skeletonNode.setMix("attack2","attack1",.1),this.m_skeletonNode.setOpacity(0),this.m_skeletonNode.setEventListener(this.spineEventListener.bind(this)),layer},spineEventListener:function(entry,evt){entry&&entry.animation&&entry.animation.name;var event_name=evt.data.name.toLowerCase();"loop_show"==event_name?this.m_skeletonNode.setAnimation(2,"loop",!0):"loop_hide"==event_name&&this.m_skeletonNode.setAnimation(2,"loop_off",!0)},characterIdelAction:function(){var scaleTo_1=new cc.ScaleTo(.7,this.m_img_scale,this.m_img_scale+.01),scaleTo_2=new cc.ScaleTo(.7,this.m_img_scale,this.m_img_scale-.01),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);this.m_characterImg.runAction(repeat)}}),BookGeneralItemLayerV2=(BOOKS_TAB_SIZE=9,cc.Layer.extend({m_info:null,layer:null,ctor:function(general){return this._super(),this.layer=null,this.initLayout(general),this},initLayout:function(general){var cardInfo=db.CardInfo;cardInfo.gnrl_id=general.gnrl_id,cardInfo.love_level=general.love_level,cardInfo.gender_type=general.gender_type,cardInfo.love_level=1==general.is_max_love_level?YUNHEE_MAX_LOVE_LEVEL:0;var gnrl_gender_type=MasterManager.getInstance().get_GeneralDivision(general.gnrl_group);cardInfo.gender_type=gnrl_gender_type.general_gender_type,this.layer=new cc.Layer;var card_sprite=(new Card).createCard(cardInfo,CARD_TYPE.type_card_book);return card_sprite.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),card_sprite.setPosition(0,0),card_sprite.setContentSize(cc.size(97,97)),this.layer.addChild(card_sprite),general.is_gain||(this.m_mask=new cc.LayerColor(cc.color.BLACK),this.m_mask.setContentSize(cc.size(98,98)),this.m_mask.setAnchorPoint(cc.p(0,0)),this.m_mask.setOpacity(230),this.m_mask.setPosition(cc.p(0,0)),IS_SP_BROWSER&&this.m_mask.setScale(.5),card_sprite.addChild(this.m_mask)),this.layer.setContentSize(ccWidth(card_sprite)+10,ccHeight(card_sprite)+10),this.m_info=general,this.setContentSize(ccWidth(card_sprite)+10,ccHeight(card_sprite)+10),this.addChild(this.layer),!0},getGnrlInfo:function(){return this.m_info},onEnter:function(){this._super()},onExit:function(){this._super()}})),BookIllustItemLayerV2=cc.Layer.extend({layer:null,ctor:function(illust_idx){this._super(),this.initLayout(illust_idx)},initLayout:function(illust_idx){var n=new NetService,layer=new cc.Layer,box=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_special/i_%d.png",illust_idx));if(box.setAnchorPoint(ZERO()),box.setPosition(ZERO()),box.setContentSize(98,98),layer.addChild(box),n.getUserIllust(illust_idx)){var box_frame=cc.Sprite.create(RES_CDN_DEFULT+"menu_special/img_card_frame_special.png");box_frame.setAnchorPoint(ANCHOR_MIDDLE()),box_frame.setPosition(ccCenter(box)),box.addChild(box_frame)}else{var mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal_2.png",RectZero());mask.setContentSize(ccSize(box)),mask.setAnchorPoint(ZERO()),mask.setPosition(ZERO()),box.addChild(mask)}return layer.setContentSize(ccWidth(box)+6,ccHeight(box)+6),this.setContentSize(ccSize(layer)),this.addChild(layer),!0}}),BooksLayerV2=(NOTIFICATION_SELECT_BOOKS_GENERAL="notifictaion_select_books_general",NOTIFICATION_SELECT_BOOKS_ILLUST="notification_select_books_illust",cc.Layer.extend({m_bookLayer:null,m_generalTableLayer:null,m_wie_tap:null,m_chock_tap:null,m_o_tap:null,m_won_tap:null,m_dong_tap:null,m_jae_tap:null,m_wae_tap:null,m_etc_tap:null,m_illust_tap:null,m_bookGenerals:null,m_bookGeneralItemLayers:null,m_tap_index:0,m_offsetVerticalPercent:0,m_stateGenrals:null,m_gameObserver:null,m_tab_scrollview:null,m_illust_List:[],m_tab_btns:[],ctor:function(){this._super(),this.m_illust_List=[],this.m_tab_btns=[]},getBookLayer:function(){var winSize=cc.director.getWinSize(),layer=new cc.Layer;this.m_tab_btns=[];var bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_frame_base.png");if(bg_box.setContentSize(1e3,520),bg_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bg_box.setPosition(ccCenter(this).x-(winSize.width-1e3)/2,0),layer.addChild(bg_box),layer.setContentSize(ccSize(bg_box)),this.m_gameObserver=MainObserver.getInstance(),USE_STATE_TYPE_ETC){var all_btn_rect=cc.Rect(16,16,18,18),offset=cc.p(0,-5);this.m_wie_tap=new NPButton(res.btn_4_off,res.btn_4_on,res.btn_3_off),this.m_wie_tap.setTitleFont(all_btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255),offset),this.m_wie_tap.setTitleText(""),this.m_wie_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_wie_tap.setPosition(28,518),this.m_wie_tap.setBright(!0),this.m_wie_tap.setContentSize(100,50),this.m_wie_tap.setSwallowTouches(!0),layer.addChild(this.m_wie_tap,10),this.m_wie_tap.addClickEventListener(function(sender){this.setTabButtonV2(STATE_TYPE_WIE)}.bind(this)),this.m_chock_tap=new NPButton(res.btn_4_off,res.btn_4_on,res.btn_3_off),this.m_chock_tap.setTitleFont(all_btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255),offset),this.m_chock_tap.setTitleText(""),this.m_chock_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_chock_tap.setPosition(ccPosX(this.m_wie_tap)+ccWidth(this.m_wie_tap)+6,518),this.m_chock_tap.setBright(!0),this.m_chock_tap.setContentSize(100,50),this.m_chock_tap.setSwallowTouches(!0),layer.addChild(this.m_chock_tap,10),this.m_chock_tap.addClickEventListener(function(sender){this.setTabButtonV2(STATE_TYPE_CHOCK)}.bind(this)),this.m_o_tap=new NPButton(res.btn_4_off,res.btn_4_on,res.btn_3_off),this.m_o_tap.setTitleFont(all_btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255),offset),this.m_o_tap.setTitleText(""),this.m_o_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_o_tap.setPosition(ccPosX(this.m_chock_tap)+ccWidth(this.m_wie_tap)+6,518),this.m_o_tap.setBright(!0),this.m_o_tap.setContentSize(100,50),this.m_o_tap.setSwallowTouches(!0),layer.addChild(this.m_o_tap,10),this.m_o_tap.addClickEventListener(function(sender){this.setTabButtonV2(STATE_TYPE_O)}.bind(this)),this.m_won_tap=new NPButton(res.btn_4_off,res.btn_4_on,res.btn_3_off),this.m_won_tap.setTitleFont(all_btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255),offset),this.m_won_tap.setTitleText(""),this.m_won_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_won_tap.setPosition(ccPosX(this.m_o_tap)+ccWidth(this.m_wie_tap)+6,518),this.m_won_tap.setBright(!0),this.m_won_tap.setContentSize(100,50),this.m_won_tap.setSwallowTouches(!0),layer.addChild(this.m_won_tap,10),this.m_won_tap.addClickEventListener(function(sender){this.setTabButtonV2(STATE_TYPE_WON)}.bind(this)),this.m_dong_tap=new NPButton(res.btn_4_off,res.btn_4_on,res.btn_3_off),this.m_dong_tap.setTitleFont(all_btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255),offset),this.m_dong_tap.setTitleText(""),this.m_dong_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_dong_tap.setPosition(ccPosX(this.m_won_tap)+ccWidth(this.m_wie_tap)+6,518),this.m_dong_tap.setBright(!0),this.m_dong_tap.setContentSize(100,50),this.m_dong_tap.setSwallowTouches(!0),layer.addChild(this.m_dong_tap,10),this.m_dong_tap.addClickEventListener(function(sender){this.setTabButtonV2(STATE_TYPE_DONG)}.bind(this)),this.m_jae_tap=new NPButton(res.btn_4_off,res.btn_4_on,res.btn_3_off),this.m_jae_tap.setTitleFont(all_btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255),offset),this.m_jae_tap.setTitleText(""),this.m_jae_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_jae_tap.setPosition(ccPosX(this.m_dong_tap)+ccWidth(this.m_wie_tap)+6,518),this.m_jae_tap.setBright(!0),this.m_jae_tap.setContentSize(100,50),this.m_jae_tap.setSwallowTouches(!0),layer.addChild(this.m_jae_tap,10),this.m_jae_tap.addClickEventListener(function(sender){this.setTabButtonV2(STATE_TYPE_JAE)}.bind(this)),this.m_wae_tap=new NPButton(res.btn_4_off,res.btn_4_on,res.btn_3_off),this.m_wae_tap.setTitleFont(all_btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255),offset),this.m_wae_tap.setTitleText(res_str("btn_label_wae")),this.m_wae_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_wae_tap.setPosition(ccPosX(this.m_jae_tap)+ccWidth(this.m_wie_tap)+6,518),this.m_wae_tap.setBright(!0),this.m_wae_tap.setContentSize(100,50),this.m_wae_tap.setSwallowTouches(!0),layer.addChild(this.m_wae_tap,10),this.m_wae_tap.addClickEventListener(function(sender){this.setTabButtonV2(STATE_TYPE_WAE)}.bind(this)),this.m_etc_tap=new NPButton(res.btn_4_off,res.btn_4_on,res.btn_3_off),this.m_etc_tap.setTitleFont(all_btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255),offset),this.m_etc_tap.setTitleText(res_str("label_country_name_8")),this.m_etc_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_etc_tap.setPosition(ccPosX(this.m_wae_tap)+ccWidth(this.m_wie_tap)+6,518),this.m_etc_tap.setBright(!0),this.m_etc_tap.setContentSize(100,50),this.m_etc_tap.setSwallowTouches(!0),layer.addChild(this.m_etc_tap,10),this.m_etc_tap.addClickEventListener(function(sender){this.setTabButtonV2(STATE_TYPE_ETC)}.bind(this)),USE_3RD_ANNIVERSARY_CARD&&(this.m_illust_tap=new NPButton(res.btn_4_off,res.btn_4_on,res.btn_3_off),this.m_illust_tap.setTitleFont(all_btn_rect,LABEL_FONT_INDEX.FONT_2272,!0,2,cc.color(255,255,255,255),cc.color(128,128,128,255),offset),this.m_illust_tap.setTitleText(res_str("illust_book_tap_button_text")),this.m_illust_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_illust_tap.setPosition(ccPosX(this.m_etc_tap)+ccWidth(this.m_wie_tap)+6,518),this.m_illust_tap.setBright(!0),this.m_illust_tap.setContentSize(100,50),this.m_illust_tap.setSwallowTouches(!0),layer.addChild(this.m_illust_tap,10),this.m_illust_tap.addClickEventListener(function(sender){this.setTabButtonV2(STATE_TYPE_ILLUST)}.bind(this)));var tab_names=[];tab_names.push(res_str("btn_label_wie")),tab_names.push(res_str("btn_label_chock")),tab_names.push(res_str("btn_label_o")),tab_names.push(res_str("btn_label_won")),tab_names.push(res_str("btn_label_dong")),tab_names.push(res_str("btn_label_jae")),tab_names.push(res_str("btn_label_wae")),tab_names.push(res_str("label_country_name_8")),tab_names.push(res_str("illust_book_tap_button_text"));var state_types=[];state_types.push(STATE_TYPE_WIE),state_types.push(STATE_TYPE_CHOCK),state_types.push(STATE_TYPE_O),state_types.push(STATE_TYPE_WON),state_types.push(STATE_TYPE_DONG),state_types.push(STATE_TYPE_JAE),state_types.push(STATE_TYPE_WAE),state_types.push(STATE_TYPE_ETC),state_types.push(STATE_TYPE_ILLUST);var is_over_scroll=tab_names.length>BOOKS_TAB_SIZE,viewSize=cc.size(106*BOOKS_TAB_SIZE,60),scroll_conatiner=new cc.Layer;scroll_conatiner.ignoreAnchorPointForPosition(!1),scroll_conatiner.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),scroll_conatiner.setPosition(19,20),this.m_tab_scrollview=new cc.ScrollView(viewSize,scroll_conatiner),this.m_tab_scrollview.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_tab_scrollview.setPosition(cc.p(26,520)),this.m_tab_scrollview.setDirection(cc.SCROLLVIEW_DIRECTION_HORIZONTAL),this.m_tab_scrollview.setTouchEnabled(!1),layer.addChild(this.m_tab_scrollview);if(is_over_scroll){var tab_left_arrow=new ccui.Button;tab_left_arrow.loadTextures("btn_32_off.png","btn_32_on.png","",ccui.Widget.PLIST_TEXTURE),tab_left_arrow.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),tab_left_arrow.setPosition(cc.p(0,488)),layer.addChild(tab_left_arrow,100),tab_left_arrow.addClickEventListener(function(sender){this.tabMoveLeftPage()}.bind(this));var tab_right_arrow=new ccui.Button;tab_right_arrow.loadTextures("btn_32_off.png","btn_32_on.png","btn_32_on",ccui.Widget.PLIST_TEXTURE),tab_right_arrow.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),tab_right_arrow.setFlippedX(!0),tab_right_arrow.setPosition(cc.p(0+viewSize.width+30,488)),layer.addChild(tab_right_arrow),tab_right_arrow.addClickEventListener(function(sender){this.tabMoveRightPage()}.bind(this))}}else this.m_wie_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_wie_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_wie_tap.setString(""),this.m_wie_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_wie_tap.setPosition(17,488),this.m_wie_tap.setSwallowTouches(!0),layer.addChild(this.m_wie_tap,10),this.m_wie_tap.addClickEventListener(function(sender){this.setTapButton(STATE_TYPE_WIE)}.bind(this)),this.m_chock_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_chock_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_chock_tap.setString(""),this.m_chock_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_chock_tap.setPosition(ccPosX(this.m_wie_tap)+ccWidth(this.m_wie_tap),488),this.m_chock_tap.setSwallowTouches(!0),layer.addChild(this.m_chock_tap,10),this.m_chock_tap.addClickEventListener(function(sender){this.setTapButton(STATE_TYPE_CHOCK)}.bind(this)),this.m_o_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_o_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_o_tap.setString(""),this.m_o_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_o_tap.setPosition(ccPosX(this.m_chock_tap)+ccWidth(this.m_wie_tap),488),this.m_o_tap.setSwallowTouches(!0),layer.addChild(this.m_o_tap,10),this.m_o_tap.addClickEventListener(function(sender){this.setTapButton(STATE_TYPE_O)}.bind(this)),this.m_won_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_won_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_won_tap.setString(""),this.m_won_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_won_tap.setPosition(ccPosX(this.m_o_tap)+ccWidth(this.m_wie_tap),488),this.m_won_tap.setSwallowTouches(!0),layer.addChild(this.m_won_tap,10),this.m_won_tap.addClickEventListener(function(sender){this.setTapButton(STATE_TYPE_WON)}.bind(this)),this.m_dong_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_dong_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_dong_tap.setString(""),this.m_dong_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_dong_tap.setPosition(ccPosX(this.m_won_tap)+ccWidth(this.m_wie_tap),488),this.m_dong_tap.setSwallowTouches(!0),layer.addChild(this.m_dong_tap,10),this.m_dong_tap.addClickEventListener(function(sender){this.setTapButton(STATE_TYPE_DONG)}.bind(this)),this.m_jae_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_jae_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_jae_tap.setString(""),this.m_jae_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_jae_tap.setPosition(ccPosX(this.m_dong_tap)+ccWidth(this.m_wie_tap),488),this.m_jae_tap.setSwallowTouches(!0),layer.addChild(this.m_jae_tap,10),this.m_jae_tap.addClickEventListener(function(sender){this.setTapButton(STATE_TYPE_JAE)}.bind(this)),this.m_wae_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_wae_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_wae_tap.setString(res_str("btn_label_wae")),this.m_wae_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_wae_tap.setPosition(ccPosX(this.m_jae_tap)+ccWidth(this.m_wie_tap),488),this.m_wae_tap.setSwallowTouches(!0),layer.addChild(this.m_wae_tap,10),this.m_wae_tap.addClickEventListener(function(sender){this.setTapButton(STATE_TYPE_WAE)}.bind(this)),USE_3RD_ANNIVERSARY_CARD&&(this.m_illust_tap=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_illust_tap.setFont(LABEL_FONT_INDEX.FONT_241),this.m_illust_tap.setString(res_str("illust_book_tap_button_text")),this.m_illust_tap.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_illust_tap.setPosition(ccPosX(this.m_wae_tap)+ccWidth(this.m_wie_tap),488),this.m_illust_tap.setSwallowTouches(!0),layer.addChild(this.m_illust_tap,10),this.m_illust_tap.addClickEventListener(function(sender){this.setTapButton(STATE_TYPE_ILLUST)}.bind(this)));return layer},initLayout:function(){var book_tap_index=GameContext.getInstance().getBookTap();this.m_bookLayer=this.getBookLayer(),this.m_bookLayer.ignoreAnchorPointForPosition(!1),this.m_bookLayer.setAnchorPoint(cc.p(.5,0)),this.m_bookLayer.setPosition(cc.p(this.width/2,0)),this.addChild(this.m_bookLayer),USE_STATE_TYPE_ETC?this.setTabButtonV2(book_tap_index):this.setTapButton(book_tap_index)},getBookGeneralTableLayer:function(){this.m_bookGeneralItemLayersV2=[];var tableLayer=new TableViewLayer;return tableLayer.setAnchorPoint(cc.p(0,0)),tableLayer.setContentSize(962,480),tableLayer.setItemCount(this.m_stateGenrals.length),tableLayer.setColumnCount(9),tableLayer.getItemNode=function(index,contentSize,margin){var general=this.m_stateGenrals[index],gnrlLayer=new BookGeneralItemLayerV2(general);return general=null,gnrlLayer}.bind(this),tableLayer.initLayout(),tableLayer.onItemTouchBegin=function(index){var general=this.m_stateGenrals[index];return general.is_gain?!(general=null):(general=null,!1)}.bind(this),tableLayer.onItemTouchMoved=function(isScroll){}.bind(this),tableLayer.onItemTouchCancel=function(index){return!0}.bind(this),tableLayer.onItemTouchEnd=function(index){AudioEngine.getInstance().playNormaButtonSound();var general=this.m_stateGenrals[index],gnrl_id=general.gnrl_id,num=general.book_num;return GameContext.getInstance().setBookGeneral(num,gnrl_id),general=null,this.m_gameObserver.postNotification(sceneStr[scene_BooksSceneV2],"NOTIFICATION_SELECT_BOOKS_GENERAL"),!0}.bind(this),tableLayer},getBookIllustTableLayer:function(){this.m_BookGeneralItemLayersV2=[];var m=MasterTable.getInstance();this.m_illust_List=m.get_IllustList();var n=new NetService,tableLayer=new TableViewLayer;return tableLayer.setAnchorPoint(ZERO()),tableLayer.setContentSize(962,480),tableLayer.setItemCount(this.m_illust_List.length),tableLayer.setColumnCount(9),tableLayer.getItemNode=function(index,contentSize,m){var illust=this.m_illust_List[index];return new BookIllustItemLayerV2(illust.illust_idx)}.bind(this),tableLayer.initLayout(),tableLayer.onItemTouchBegin=function(index){return!!n.getUserIllust(this.m_illust_List.at(index).illust_idx)}.bind(this),tableLayer.onItemTouchMoved=function(isScroll){}.bind(this),tableLayer.onItemTouchCancel=function(index){return!0}.bind(this),tableLayer.onItemTouchEnd=function(index){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3";audio.playEffect(path);var illust_Idx=this.m_illust_List.at(index).illust_idx;MainObserver.getInstance().postNotification(NOTIFICATION_SELECT_BOOKS_ILLUST,illust_Idx)}.bind(this),tableLayer},setVerticalPercent:function(){this.m_offsetVerticalPercent=this.m_generalTableLayer.getOffsetVerticalPercent()},setOffsetY:function(){this.m_generalTableLayer.setOffsetVertical(this.m_offsetVerticalPercent)},tabMoveLeftPage:function(){var cnt=this.m_tab_btns.length,max_page=cnt/BOOKS_TAB_SIZE;0<cnt%BOOKS_TAB_SIZE&&(max_page+=1);for(var cur_tab_index=0,i=0;i<this.m_tab_btns.length;i++)if(!this.m_tab_btns[i].isEnabled()){cur_tab_index=i;break}var tab=cur_tab_index/BOOKS_TAB_SIZE;(tab-=1)<0&&(tab=max_page-1);var index=tab*BOOKS_TAB_SIZE,tab_tag=this.m_tab_btns.at(index).getTag();this.setTabButtonV2(tab_tag);this.m_tab_scrollview.getContainer().getContentSize();var offset_x=tab*(ccWidth(this.m_tab_btns[0])*BOOKS_TAB_SIZE),offset=cc.p(-offset_x,0);this.m_tab_scrollview.setContentOffset(offset,!1)},tabMoveRightPage:function(){var cnt=this.m_tab_btns.length,max_page=cnt/BOOKS_TAB_SIZE;0<cnt%BOOKS_TAB_SIZE&&(max_page+=1);for(var cur_tab_index=0,i=0;i<this.m_tab_btns.length;i++)if(!this.m_tab_btns[i].isEnabled()){cur_tab_index=i;break}var tab=cur_tab_index/BOOKS_TAB_SIZE;max_page-1<(tab+=1)&&(tab=0);var index=tab*BOOKS_TAB_SIZE,tab_tag=this.m_tab_btns.at(index).getTag();this.setTabButtonV2(tab_tag);this.m_tab_scrollview.getContainer().getContentSize();var offset_x=tab*(ccWidth(this.m_tab_btns[0])*BOOKS_TAB_SIZE),offset=cc.p(-offset_x,0);this.m_tab_scrollview.setContentOffset(offset,!1)},setTabButtonV2:function(index){for(var i=0;i<this.m_tab_btns.length;i++){var btn=this.m_tab_btns[i],tag=btn.getTag();btn.setEnabled(tag!=index)}this.m_offsetVerticalPercent=0,(this.m_tap_index=index)==STATE_TYPE_ILLUST?this.setTapIllustBook(index):this.setTapBook(index),this.m_wie_tap.setEnabled(!0),this.m_chock_tap.setEnabled(!0),this.m_o_tap.setEnabled(!0),this.m_won_tap.setEnabled(!0),this.m_dong_tap.setEnabled(!0),this.m_jae_tap.setEnabled(!0),this.m_wae_tap.setEnabled(!0),this.m_etc_tap.setEnabled(!0),USE_3RD_ANNIVERSARY_CARD&&this.m_illust_tap.setEnabled(!0),this.m_wie_tap.setBright(!0),this.m_chock_tap.setBright(!0),this.m_o_tap.setBright(!0),this.m_won_tap.setBright(!0),this.m_dong_tap.setBright(!0),this.m_jae_tap.setBright(!0),this.m_wae_tap.setBright(!0),this.m_etc_tap.setBright(!0),USE_3RD_ANNIVERSARY_CARD&&this.m_illust_tap.setBright(!0),index==STATE_TYPE.WIE?(this.m_wie_tap.setEnabled(!1),this.m_wie_tap.setBright(!1)):index==STATE_TYPE.CHOCK?(this.m_chock_tap.setEnabled(!1),this.m_chock_tap.setBright(!1)):index==STATE_TYPE.OH?(this.m_o_tap.setEnabled(!1),this.m_o_tap.setBright(!1)):index==STATE_TYPE.WON?(this.m_won_tap.setEnabled(!1),this.m_won_tap.setBright(!1)):index==STATE_TYPE.DONG?(this.m_dong_tap.setEnabled(!1),this.m_dong_tap.setBright(!1)):index==STATE_TYPE.JAE?(this.m_jae_tap.setEnabled(!1),this.m_jae_tap.setBright(!1)):index==STATE_TYPE_WAE?(this.m_wae_tap.setEnabled(!1),this.m_wae_tap.setBright(!1)):index==STATE_TYPE_ETC?(this.m_etc_tap.setEnabled(!1),this.m_etc_tap.setBright(!1)):index==STATE_TYPE_ILLUST?USE_3RD_ANNIVERSARY_CARD&&(this.m_illust_tap.setEnabled(!1),this.m_illust_tap.setBright(!1)):cc.log("error"),this.m_offsetVerticalPercent=0,this.m_tap_index=index,this.scheduleOnce(function(){this.m_gameObserver.postNotification(sceneStr[scene_BooksSceneV2],this.m_tap_index)}.bind(this),0,"setTapButton")},setTapButton:function(index){this.m_wie_tap.setEnabled(!0),this.m_chock_tap.setEnabled(!0),this.m_o_tap.setEnabled(!0),this.m_won_tap.setEnabled(!0),this.m_dong_tap.setEnabled(!0),this.m_jae_tap.setEnabled(!0),this.m_wae_tap.setEnabled(!0),USE_3RD_ANNIVERSARY_CARD&&this.m_illust_tap.setEnabled(!0),this.m_wie_tap.setBright(!0),this.m_chock_tap.setBright(!0),this.m_o_tap.setBright(!0),this.m_won_tap.setBright(!0),this.m_dong_tap.setBright(!0),this.m_jae_tap.setBright(!0),this.m_wae_tap.setBright(!0),USE_3RD_ANNIVERSARY_CARD&&this.m_illust_tap.setBright(!0),index==STATE_TYPE.WIE?(this.m_wie_tap.setEnabled(!1),this.m_wie_tap.setBright(!1)):index==STATE_TYPE.CHOCK?(this.m_chock_tap.setEnabled(!1),this.m_chock_tap.setBright(!1)):index==STATE_TYPE.OH?(this.m_o_tap.setEnabled(!1),this.m_o_tap.setBright(!1)):index==STATE_TYPE.WON?(this.m_won_tap.setEnabled(!1),this.m_won_tap.setBright(!1)):index==STATE_TYPE.DONG?(this.m_dong_tap.setEnabled(!1),this.m_dong_tap.setBright(!1)):index==STATE_TYPE.JAE?(this.m_jae_tap.setEnabled(!1),this.m_jae_tap.setBright(!1)):index==STATE_TYPE_WAE?(this.m_wae_tap.setEnabled(!1),this.m_wae_tap.setBright(!1)):index==STATE_TYPE_ILLUST?USE_3RD_ANNIVERSARY_CARD&&(this.m_illust_tap.setEnabled(!1),this.m_illust_tap.setBright(!1)):cc.log("error"),this.m_offsetVerticalPercent=0,this.m_tap_index=index,this.scheduleOnce(function(){this.m_gameObserver.postNotification(sceneStr[scene_BooksSceneV2],this.m_tap_index)}.bind(this),0,"setTapButton")},setTapBook:function(index){null!=this.m_generalTableLayer&&(this.removeChild(this.m_generalTableLayer),this.m_generalTableLayer.removeAllChildren(),this.m_generalTableLayer=null),this.m_stateGenrals=[],this.m_stateGenrals=this.getBookGeneralList(index,this.m_stateGenrals),0!=this.m_stateGenrals.length&&(this.m_stateGenrals=stable(this.m_stateGenrals,function(l,r){return l.gnrl_class>r.gnrl_class?1:l.gnrl_class<r.gnrl_class?-1:0}),this.m_stateGenrals=stable(this.m_stateGenrals,function(l,r){return l.name<r.name?1:l.name>r.name?-1:0}),this.m_stateGenrals=stable(this.m_stateGenrals,function(l,r){return l.rare_type<r.rare_type?1:l.rare_type>r.rare_type?-1:0}),this.m_stateGenrals=stable(this.m_stateGenrals,function(l,r){return l.element_type>r.element_type?1:l.element_type<r.element_type?-1:0}),this.m_generalTableLayer=this.getBookGeneralTableLayer(),this.m_generalTableLayer.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_generalTableLayer.setPosition(16,20),this.m_bookLayer.addChild(this.m_generalTableLayer),this.setOffsetY()),GameContext.getInstance().setBookTap(index)},getBookGeneralList:function(index,generals){for(var idx=0;idx<this.m_bookGenerals.length;idx++)this.m_bookGenerals[idx].state_type==index&&generals.push(this.m_bookGenerals[idx]);return generals},setBookGeneralList:function(generals){this.m_bookGenerals=generals,this.initLayout()},setTapIllustBook:function(index){null!=this.m_generalTableLayer&&(this.m_generalTableLayer.removeFromParent(),this.m_generalTableLayer=null),this.m_stateGenrals=[],this.m_generalTableLayer=this.getBookIllustTableLayer(),this.m_generalTableLayer.setAnchorPoint(ZERO()),this.m_generalTableLayer.setPosition(17,0),this.m_bookLayer.addChild(this.m_generalTableLayer),this.setOffsetY()},onEnter:function(){this._super(),this.m_generalTableLayer&&this.setOffsetY()},onExit:function(){this._super(),1!=this.getParent().m_isPushScene&&(this.m_bookGenerals=[],null!=this.m_generalTableLayer&&(this.m_generalTableLayer.removeAllChildren(),this.m_generalTableLayer=null))}})),BooksSceneV2=GameScene.extend({m_bookLayer:null,m_itemModalLayer:null,m_illustInfoModalLayer:null,m_resources:[],ctor:function(){this._super(scene_BooksSceneV2)},init:function(){this.m_bookLayer=null,this.m_itemModalLayer=null,this.m_illustInfoModalLayer=null;var win_size=cc.director.getWinSize();this.initLayoutProgress2(0),this.m_resources=[],this.m_resources.push(RES_CDN_DEFULT+"common/bg_sub_4.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/bg_special.jpg");for(var idx=1001;idx<MAX_MENU_SPECIAL_NUM;idx++)this.m_resources.push(RES_CDN_DEFULT+"menu_special/im_"+idx+".jpg"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/i_"+idx+".png");this.m_resources.push(RES_CDN_DEFULT+"menu_special/btn_special_zoomin_off.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/btn_special_zoomin_on.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/btn_special_zoomout_off.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/btn_special_zoomout_on.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_zoom_gauge.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_yh/img_yh_zoom_gauge_mint.png"),this.m_resources.push(RES_CDN_DEFULT+"menu_special/img_card_frame_special.png"),resourceLoader(this.m_resources,function(){var bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub_4.png");bg.setPosition(cc.p(this.width/2,this.height/2)),USE_SP_COMMON_SUB_BG_SCALE&&bg.setScale(2),this.addChild(bg);var statusLayer=new StatusLayer(INVOKER_TYPE.normal);statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(cc.p(win_size.width,win_size.height)),this.addChild(statusLayer,99);var generals=GeneralService.getInstance().getBookGeneralList();this.m_bookLayer=new BooksLayerV2,this.m_bookLayer.setBookGeneralList(generals),this.addChild(this.m_bookLayer);var back_btn=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png","");back_btn.setAnchorPoint(cc.p(0,0)),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(this.back.bind(this)),this.addChild(back_btn,100);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_book.png");title.setAnchorPoint(cc.p(0,0)),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title,100);var messBox=new GameInputMessageBox(!1,!1);return this.addChild(messBox),USE_3RD_ANNIVERSARY_CARD&&(this.m_illustInfoModalLayer=new GameModalLayer,this.addChild(this.m_illustInfoModalLayer,100)),this.removeLayerProgress2(),!0}.bind(this))},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_BooksSceneV2]),MainObserver.getInstance().addObserver(this.onNotifyBooksIllust,this,NOTIFICATION_SELECT_BOOKS_ILLUST)},onExit:function(){if(this._super(),MainObserver.getInstance().removeObserver(sceneStr[scene_BooksSceneV2]),MainObserver.getInstance().removeObserver(NOTIFICATION_SELECT_BOOKS_ILLUST),null!=this.m_resources){for(var idx=0;idx<this.m_resources.length;idx++)cc.loader.release(this.m_resources[idx]);this.m_resources=[]}},back:function(){GameContext.getInstance().setBookTap(STATE_TYPE_WIE),this.onKeyBack(!0,!1)},onNotification:function(msg){if(this._super(msg),"NOTIFICATION_SELECT_BOOKS_GENERAL"==msg){this.initLayoutProgress(),this.m_bookLayer.setVerticalPercent();var scene=new BooksGeneralSceneV2;scene.get_story_deferred().done(function(){this.scheduleOnce(function(){var sceneManager=SceneManager.getInstance();this.m_isPushScene=!0,sceneManager.pushScene(scene),scene=null},1.5)}.bind(this))}switch(msg){case STATE_TYPE_WIE:case STATE_TYPE_CHOCK:case STATE_TYPE_O:case STATE_TYPE_WON:case STATE_TYPE_DONG:case STATE_TYPE_JAE:case STATE_TYPE_WAE:return this.m_bookLayer.setTapBook(msg),!0;case STATE_TYPE_ILLUST:return this.m_bookLayer.setTapIllustBook(msg),!0}return!0},showIllustInfoLayer:function(illust_idx){this.m_illustInfoModalLayer.setContentSize(ccSize(this)),this.m_illustInfoModalLayer._contentNode=function(contentSize,m){var illust_Layer=new YunheeIllustInfoLayer(illust_idx),back_btn=new ccui.Button;back_btn.loadTextures("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE),back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(this)-10,ccHeight(this)-10),back_btn.addClickEventListener(function(){return this.scheduleOnce(function(float){this.m_illustInfoModalLayer.hide()},0,"m_illustInfoModalLayer"),illust_Layer.addChild(back_btn),illust_Layer}.bind(this)),this.m_illustInfoModalLayer.show()}.bind(this)},onNotifyBooksGeneral:function(sender){this.m_bookLayer.getOffsetVerticalPercent();var list=this.m_bookLayer.getBookGeneralList();GameContext.getInstance().setBookGeneralList(list);var scene=new BooksGeneralSceneV2;SceneManager.getInstance().pushScene(scene),scene=null},onNotifyBooksIllust:function(sender){var illust_idx=sender;this.m_illustInfoModalLayer.setContentSize(ccSize(this)),this.m_illustInfoModalLayer._contentNode=function(contentSize,m){var illust_Layer=new YunheeIllustInfoLayer(illust_idx),back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);return back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(this)-10,ccHeight(this)-10),back_btn.addClickEventListener(function(){this.scheduleOnce(function(float){this.m_illustInfoModalLayer.hide()},0,"m_illustInfoModalLayer")}.bind(this)),illust_Layer.addChild(back_btn),illust_Layer}.bind(this),this.m_illustInfoModalLayer.show()}}),LoveContentLoadingLayer=GameModalLayer.extend({m_bar:null,m_label:null,total_resource_count:0,current_loaded_count:0,m_is_update:!1,ctor:function(){this._super(),this.initLayout()},initLayout:function(){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var loadingLayer=new LoadingLayerV2(7);loadingLayer.setPosition(ccCenter(this)),this.addChild(loadingLayer);var bar_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero());bar_bg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bar_bg.setPosition(ccCenter(this).x,80),bar_bg.setContentSize(480,16),this.addChild(bar_bg),this.m_bar=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green.png",RectZero()),this.m_bar.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_bar.setPosition(3,ccCenter(bar_bg).y),bar_bg.addChild(this.m_bar),this.m_label=cmLabel.getLabel("0%",LABEL_FONT_INDEX.FONT_143),this.m_label.enableOutline(cc.color.BLACK,1),this.m_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_label.setPosition(ccCenter(bar_bg)),bar_bg.addChild(this.m_label);var loading=cc.Sprite.create(res.s_cm_img_text_loading);loading.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),loading.setPosition(ccCenter(this).x,106),this.addChild(loading),this.scheduleUpdate(),this.m_is_update=!0},update:function(dt){if(0<this.total_resource_count&&null!=this.m_bar){var per=this.current_loaded_count/this.total_resource_count,_per=474*per;this.m_bar.setScaleX(_per),this.m_label.setString(parseInt(100*per)+"%"),this.current_loaded_count>=this.total_resource_count&&(this.m_is_update&&(this.unscheduleUpdate(),this.m_is_update=!1),this.m_bar.setScaleX(474),this.m_label.setString("100%"))}},hide:function(){this.m_is_update&&(this.unscheduleUpdate(),this.m_is_update=!1),this._super()},setTotalResourceCount:function(total_count){this.total_resource_count=total_count,this.current_loaded_count=0},addCompleteLoadedResource:function(){this.current_loaded_count+=1,this.current_loaded_count>this.total_resource_count&&(this.current_loaded_count=this.total_resource_count)}}),LoveContentsCGScene=GameScene.extend({m_script_layer:null,m_worker:null,m_audio:null,m_gameObserver:null,ctor:function(gnrl_id){this._super(scene_LoveContentsCGScene),this.m_worker=null,this.m_audio=null,this.m_script_layer=null,this.m_gameObserver=null,this.initLayout(gnrl_id)},initLayout:function(gnrl_id){this.initLayoutProgress2(255),this.m_worker=new Worker(WEB_WORKER);var _startTime=(new Date).getTime(),cg=MasterTable.getInstance().get_LoveCgByGnrlId(gnrl_id),file_name="",cg_type=0;cg_type="y"==cg.animation_yn?(cg.love_cg_story_num<=116e3?file_name="love_cg_animation_story_1":116e3<cg.love_cg_story_num&&cg.love_cg_story_num<116021?file_name="love_cg_animation_story_2":116020<cg.love_cg_story_num&&cg.love_cg_story_num<116041?file_name="love_cg_animation_story_3":116040<cg.love_cg_story_num&&cg.love_cg_story_num<116201?file_name="love_cg_animation_story_4":116200<cg.love_cg_story_num&&cg.love_cg_story_num<116221?file_name="love_cg_animation_story_5":116220<cg.love_cg_story_num&&cg.love_cg_story_num<116241?file_name="love_cg_animation_story_6":116240<cg.love_cg_story_num&&cg.love_cg_story_num<116261?file_name="love_cg_animation_story_7":116260<cg.love_cg_story_num&&cg.love_cg_story_num<116281?file_name="love_cg_animation_story_8":116280<cg.love_cg_story_num&&cg.love_cg_story_num<116301?file_name="love_cg_animation_story_9":116300<cg.love_cg_story_num&&cg.love_cg_story_num<116321?file_name="love_cg_animation_story_10":116320<cg.love_cg_story_num&&cg.love_cg_story_num<116341?file_name="love_cg_animation_story_11":116340<cg.love_cg_story_num&&cg.love_cg_story_num<116361?file_name="love_cg_animation_story_12":116360<cg.love_cg_story_num&&cg.love_cg_story_num<116381?file_name="love_cg_animation_story_13":116380<cg.love_cg_story_num&&cg.love_cg_story_num<116401?file_name="love_cg_animation_story_14":116400<cg.love_cg_story_num&&cg.love_cg_story_num<116421?file_name="love_cg_animation_story_15":116420<cg.love_cg_story_num&&cg.love_cg_story_num<116441?file_name="love_cg_animation_story_16":116440<cg.love_cg_story_num&&cg.love_cg_story_num<116461?file_name="love_cg_animation_story_17":116460<cg.love_cg_story_num&&cg.love_cg_story_num<116481?file_name="love_cg_animation_story_18":116480<cg.love_cg_story_num&&cg.love_cg_story_num<116501?file_name="love_cg_animation_story_19":116500<cg.love_cg_story_num&&cg.love_cg_story_num<116521?file_name="love_cg_animation_story_20":116520<cg.love_cg_story_num&&cg.love_cg_story_num<116541?file_name="love_cg_animation_story_21":116540<cg.love_cg_story_num&&cg.love_cg_story_num<116561?file_name="love_cg_animation_story_22":116560<cg.love_cg_story_num&&cg.love_cg_story_num<116581?file_name="love_cg_animation_story_23":116580<cg.love_cg_story_num&&cg.love_cg_story_num<116601&&(file_name="love_cg_animation_story_24"),1):(cg.love_cg_story_num<=115e3?file_name="love_cg_story_1":115001<=cg.love_cg_story_num&&cg.love_cg_story_num<=116e3?file_name="love_cg_story_2":116001<=cg.love_cg_story_num&&cg.love_cg_story_num<=116030?file_name="love_cg_story_3":116031<=cg.love_cg_story_num&&cg.love_cg_story_num<=116040?file_name="love_cg_story_4":116041<=cg.love_cg_story_num&&cg.love_cg_story_num<=116050?file_name="love_cg_story_5":116051<=cg.love_cg_story_num&&(file_name="love_cg_story_6"),2),this.m_worker.postMessage({cmd:"loveCgStory",url:master_json+file_name+".jbin",key:cg.love_cg_story_num}),this.m_worker.onmessage=function(evt){var now=(new Date).getTime(),elapsed=now-_startTime;cc.log("load finish loveCg_time ======== "+elapsed),0==evt.data.length&&MainObserver.getInstance().postNotification(NOTIFY_NETWORK_ERROR),1==cg_type?MasterManager.getInstance().set_LoveCgAnimationStory(evt.data):MasterManager.getInstance().set_LoveCgStory(evt.data),evt.data=null,elapsed=now=_startTime=cg=null,this.removeLayerProgress2(),TUTO_LOAD_CHECK=!0,1!=USE_POLYGON_MOSAIC&&1!=USE_HSCENE_WATCH_MODE||(USE_UI_3RD_SCRIPT?this.m_script_layer=new LoveContentsScriptLayer_V3(gnrl_id):this.m_script_layer=new LoveContentsScriptLayer_V2(gnrl_id)),this.addChild(this.m_script_layer)}.bind(this)},onEnter:function(){this._super(),MasterManager.getInstance().reset_LoveCgStory(),MasterManager.getInstance().reset_LoveCgAnimationStory(),this.m_gameObserver=MainObserver.getInstance(),this.m_gameObserver.addObserver(this.onNotification,this,sceneStr[scene_LoveContentsCGScene]),this.m_audio=AudioEngine.getInstance()},onExit:function(){this._super(),this.m_worker=null,delete this.m_worker,null!=this.m_gameObserver&&(this.m_gameObserver.removeObserver(sceneStr[scene_LoveContentsCGScene]),this.m_gameObserver=null),MasterManager.getInstance().reset_LoveCgStory(),MasterManager.getInstance().reset_LoveCgAnimationStory(),null!=this.m_audio&&(this.m_audio.stopVoiceAll(),this.m_audio.releaseResourceEffects(),this.m_audio=null),this.playMainBGM(),null!=this.m_script_layer&&null!=this.m_script_layer&&(this.removeChild(this.m_script_layer),this.m_script_layer=null),this.removeAllChildrenWithCleanup(!0)},back:function(){this.m_script_layer.stopUpdate(),this.scheduleOnce(function(float){this.m_audio.stopVoiceAll(),this.m_isPushScene?SceneManager.getInstance().popScene():this.onKeyBack(!0,!1)}.bind(this),0,"pop_scene")},onNotification:function(msg){switch(msg){case Contents_Skip:this.back();break;case Hide_Script_Log:this.m_script_layer.showScriptLog(!1);break;case NOTIFY_MENU_OPTION:case NOTIFY_NETWORK_ERROR:this._super(msg)}},onTutorialEnter:function(step){this.setTutorialStep(step),step.tutorial_page==TUTORIAL_PAGE_4_LOVE_CG&&step.tutorial_step==TUTO_STEP_P4_WAITING&&this.popTutorialLayer()}}),LoveContentCGLogLayerV2=cc.Layer.extend({m_is_voice_playing:!1,m_tableView:null,m_voice_playing_delta:0,m_cur_animation_script:0,m_cur_script:0,m_cur_prologue_script:0,m_cur_mission_script:0,m_cur_event_script:0,m_script_type:null,m_script_list:[],m_animation_script_list:[],m_prologue_script_list:[],m_mission_script_list:[],m_event_script_list:[],ctor:function(){this._super(),this.m_script_list=[],this.m_animation_script_list=[],this.m_prologue_script_list=[],this.m_mission_script_list=[],this.m_event_script_list=[],this.init()},onExit:function(){this._super(),this.m_prologue_script_list=null,this.m_mission_script_list=null,this.m_event_script_list=null},init:function(){var winSize=cc.director.getWinSize(),mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_alpha_1.png",cc.Rect(1,1,1,1));mask.setAnchorPoint(ANCHOR_MIDDLE()),mask.setPreferredSize(winSize),mask.setPosition(ccCenter(winSize)),this.addChild(mask);var size=cc.size(winSize.width,winSize.height);this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE()),this.setContentSize(size);var navi=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_blank_4.png");navi.setAnchorPoint(ANCHOR_TOP_RIGHT()),navi.setPosition(winSize.width,winSize.height),this.addChild(navi);var btn=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_x_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_x_on.png","");btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),btn.setPosition(80,68),btn.addClickEventListener(function(){MainObserver.getInstance().postNotification(Hide_Script_Log)}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||btn.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),navi.addChild(btn);var tSize=cc.size(920,535);return this.m_tableView=new cc.TableView(this,tSize),this.m_tableView.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_tableView.setPosition(88,28),this.m_tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_tableView.setVerticalFillOrder(0),this.addChild(this.m_tableView),this.scheduleUpdate(),!0},tableCellSizeForIndex:function(){return cc.size(920,100)},setScriptData:function(scripts,type){type==SCRIPT_TYPE.ANIMATION?(this.m_script_type=SCRIPT_TYPE.ANIMATION,this.m_animation_script_list=scripts,this.m_tableView.reloadData(),this.m_tableView.setContentOffset(ZERO())):type==SCRIPT_TYPE.PROLOGUE?(this.m_script_type=SCRIPT_TYPE.PROLOGUE,this.m_prologue_script_list=scripts,this.m_tableView.reloadData(),this.m_tableView.setContentOffset(ZERO())):type==SCRIPT_TYPE.SCRIPT?(this.m_script_type=SCRIPT_TYPE.SCRIPT,this.m_script_list=scripts,this.m_tableView.reloadData(),this.m_tableView.setContentOffset(ZERO())):type==SCRIPT_TYPE.MISSION?(this.m_script_type=SCRIPT_TYPE.MISSION,this.m_mission_script_list=scripts,this.m_tableView.reloadData(),this.m_tableView.setContentOffset(ZERO())):type==SCRIPT_TYPE.EVENT&&(this.m_script_type=SCRIPT_TYPE.EVENT,this.m_event_script_list=scripts,this.m_tableView.reloadData(),this.m_tableView.setContentOffset(ZERO()))},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;if(cell=null==c?new LoveContentLogCellV2(this):c,this.m_script_type==SCRIPT_TYPE.ANIMATION){var script=this.m_animation_script_list[idx];cell.setScriptData(script,this.m_script_type)}else if(this.m_script_type==SCRIPT_TYPE.SCRIPT){script=this.m_script_list[idx];cell.setScriptData(script,this.m_script_type)}else if(this.m_script_type==SCRIPT_TYPE.PROLOGUE){script=this.m_prologue_script_list[idx];cell.setScriptData(script,this.m_script_type)}else if(this.m_script_type==SCRIPT_TYPE.MISSION){script=this.m_mission_script_list[idx];cell.setScriptData(script,this.m_script_type)}else if(this.m_script_type==SCRIPT_TYPE.EVENT){script=this.m_event_script_list[idx];cell.setScriptData(script,this.m_script_type)}return cell},numberOfCellsInTableView:function(table){return this.m_script_type==SCRIPT_TYPE.ANIMATION?this.m_animation_script_list.length:this.m_script_type==SCRIPT_TYPE.PROLOGUE?this.m_prologue_script_list.length:this.m_script_type==SCRIPT_TYPE.MISSION?this.m_mission_script_list.length:this.m_script_type==SCRIPT_TYPE.EVENT?this.m_event_script_list.length:this.m_script_list.length},voicePlayAnimation:function(script){var audio=AudioEngine.getInstance();audio.stopEffectsAll(),this.m_cur_animation_script=script;var path=RES_CDN_SOUND+SND_TYPE+"voice_love/"+this.m_cur_animation_script.voice+".mp3";audio.playVoice(path),this.m_is_voice_playing=!0,this.m_voice_playing_delta=0},voicePlay:function(script){var audio=AudioEngine.getInstance();audio.stopEffectsAll(),this.m_cur_script=script;var path=RES_CDN_SOUND+SND_TYPE+"voice_love/"+this.m_cur_script.voice+".mp3";audio.playVoice(path),this.m_is_voice_playing=!0,this.m_voice_playing_delta=0},voicePlayPrologue:function(script){if(!this.m_is_voice_playing){this.m_cur_prologue_script=script;var audio=AudioEngine.getInstance();if("0"!=this.m_cur_prologue_script.sound){var path=RES_CDN_SOUND+SND_TYPE+"voice_etc/"+this.m_cur_prologue_script.sound+".mp3";audio.playVoice(path),this.m_is_voice_playing=!0,this.m_voice_playing_delta=0}}},voicePlayMission:function(script){if(!this.m_is_voice_playing){this.m_cur_mission_script=script;var audio=AudioEngine.getInstance();if("0"!=this.m_cur_mission_script.sound){var path=RES_CDN_SOUND+SND_TYPE+"voice_etc/"+this.m_cur_mission_script.sound+".mp3";audio.playVoice(path),this.m_is_voice_playing=!0,this.m_voice_playing_delta=0}}},voicePlayEvent:function(script){if(!this.m_is_voice_playing){this.m_cur_event_script=script;var audio=AudioEngine.getInstance();if("0"!=this.m_cur_event_script.sound){var path=RES_CDN_SOUND+SND_TYPE+"voice_etc/"+this.m_cur_event_script.sound+".mp3";audio.playVoice(path),this.m_is_voice_playing=!0,this.m_voice_playing_delta=0}}},update:function(dt){this.m_is_voice_playing&&(this.m_voice_playing_delta+=dt,this.m_script_type==SCRIPT_TYPE.ANIMATION?this.m_voice_playing_delta>this.m_cur_animation_script.voice_duration&&(this.m_is_voice_playing=!1,this.m_voice_playing_delta=0):this.m_script_type==SCRIPT_TYPE.SCRIPT?this.m_voice_playing_delta>this.m_cur_script.voice_duration&&(this.m_is_voice_playing=!1,this.m_voice_playing_delta=0):this.m_script_type==SCRIPT_TYPE.PROLOGUE?1<this.m_voice_playing_delta&&(this.m_is_voice_playing=!1,this.m_voice_playing_delta=0):this.m_script_type==SCRIPT_TYPE.MISSION?1<this.m_voice_playing_delta&&(this.m_is_voice_playing=!1,this.m_voice_playing_delta=0):this.m_script_type==SCRIPT_TYPE.EVENT&&1<this.m_voice_playing_delta&&(this.m_is_voice_playing=!1,this.m_voice_playing_delta=0))}}),LoveContentLogCellV2=cc.TableViewCell.extend({m_logLayer:null,m_cell_bg:null,m_voice_btn:null,m_script:null,m_prologue_script:null,m_mission_script:null,m_event_script:null,m_voice_id:0,m_script_type:null,ctor:function(logLayer){this.m_logLayer=logLayer,this.m_script=null,this.m_prologue_script=null,this.m_mission_script=null,this.m_event_script=null,this._super(),this.init()},init:function(){this.setAnchorPoint(ANCHOR_BOTTOM_LEFT());var cellSize=cc.size(920,100);return this.m_cell_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box.png",RectZero()),this.m_cell_bg.setPreferredSize(cellSize),this.m_cell_bg.setOpacity(0),this.m_cell_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_cell_bg.setPosition(ZERO()),this.addChild(this.m_cell_bg),this.m_voice_btn=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_story_voice_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_story_voice_on.png",""),this.m_voice_btn.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_voice_btn.setPosition(6,.5*cellSize.height),this.addChild(this.m_voice_btn),this.m_voice_btn.addClickEventListener(function(sender){this.playVoice()}.bind(this)),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_voice_btn.setTutorialTag(TUTORIAL_TAG_READY_BTN_PASS),this.m_name=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_2471,!1,!0,2,cc.color(0,0,0,255)),this.m_name.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_name.setPosition(88,.5*cellSize.height),this.addChild(this.m_name),this.m_content=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_2471,!1,!0,2,cc.color(0,0,0,255)),this.m_content.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_content.setPosition(242,.5*cellSize.height),this.m_content.setTextAreaSize(cc.size(cellSize.width-250,cellSize.height-20)),this.m_content.ignoreContentAdaptWithSize(!1),this.addChild(this.m_content),!0},enter:function(){this.updateAnimationCell()},setScriptData:function(script,type){isUndefined(this.m_user_info)&&(this.m_user_info=NetService().get_User_info()),type==SCRIPT_TYPE.SCRIPT?(this.m_script_type=SCRIPT_TYPE.SCRIPT,this.m_script=script,this.m_voice_id=0,this.updateCell()):type==SCRIPT_TYPE.ANIMATION?(this.m_script_type=SCRIPT_TYPE.ANIMATION,this.m_animation_script=script,this.m_voice_id=0,this.updateAnimationCell()):type==SCRIPT_TYPE.PROLOGUE?(this.m_script_type=SCRIPT_TYPE.PROLOGUE,this.m_prologue_script=script,this.m_voice_id=0,this.updatePrologueCell()):type==SCRIPT_TYPE.MISSION?(this.m_script_type=SCRIPT_TYPE.MISSION,this.m_mission_script=script,this.m_voice_id=0,this.updateMissionCell()):type==SCRIPT_TYPE.EVENT&&(this.m_script_type=SCRIPT_TYPE.EVENT,this.m_event_script=script,this.m_voice_id=0,this.updateEventCell())},updateEventCell:function(){"0"==this.m_event_script.name||""==this.m_event_script.name?this.m_name.setString(res_str("label_love_scene_noname")):"1"==this.m_event_script.name?this.m_name.setString(this.m_user_info.nickname):this.m_name.setString(this.m_event_script.name),cmLabel.autoSizeFit(this.m_name,120,20),1==this.m_event_script.name_type?this.m_content.setString(cmString(this.m_event_script.content,this.m_user_info.nickname)):this.m_content.setString(this.m_event_script.content);var size=this.m_content.getContentSize();this.m_cell_height=size.height+20,"0"==this.m_event_script.sound?this.m_voice_btn.setVisible(!1):this.m_voice_btn.setVisible(!0)},updateMissionCell:function(){"0"==this.m_mission_script.name||""==this.m_mission_script.name?this.m_name.setString(res_str("label_love_scene_noname")):"1"==this.m_mission_script.name?this.m_name.setString(this.m_user_info.nickname):this.m_name.setString(this.m_mission_script.name),cmLabel.autoSizeFit(this.m_name,120,20),1==this.m_mission_script.name_type?this.m_content.setString(cmString(this.m_mission_script.content,this.m_user_info.nickname)):this.m_content.setString(this.m_mission_script.content);var size=this.m_content.getContentSize();this.m_cell_height=size.height+20,"0"==this.m_mission_script.sound?this.m_voice_btn.setVisible(!1):this.m_voice_btn.setVisible(!0)},updatePrologueCell:function(){"0"==this.m_prologue_script.name||""==this.m_prologue_script.name?this.m_name.setString(res_str("label_love_scene_noname")):"1"==this.m_prologue_script.name?this.m_name.setString(this.m_user_info.nickname):this.m_name.setString(this.m_prologue_script.name),cmLabel.autoSizeFit(this.m_name,120,20),1==this.m_prologue_script.name_type?this.m_content.setString(cmString(this.m_prologue_script.content,this.m_user_info.nickname)):this.m_content.setString(this.m_prologue_script.content);var size=this.m_content.getContentSize();this.m_cell_height=size.height+20,"0"==this.m_prologue_script.sound?this.m_voice_btn.setVisible(!1):this.m_voice_btn.setVisible(!0)},updateCell:function(){"0"==this.m_script.name?this.m_name.setString(""):"1"==this.m_script.name?this.m_name.setString(this.m_user_info.nickname):this.m_name.setString(this.m_script.name),1==this.m_script.name_type?this.m_content.setString(v.sprintf(this.m_script.content,this.m_user_info.nickname)):this.m_content.setString(this.m_script.content);var size=this.m_content.getContentSize();this.m_cell_height=size.height+20,"0"==this.m_script.voice?this.m_voice_btn.setVisible(!1):this.m_voice_btn.setVisible(!0)},updateAnimationCell:function(){"0"==this.m_animation_script.name?this.m_name.setString(""):"1"==this.m_animation_script.name?this.m_name.setString(this.m_user_info.nickname):this.m_name.setString(this.m_animation_script.name),1==this.m_animation_script.name_type?this.m_content.setString(v.sprintf(this.m_animation_script.content,this.m_user_info.nickname)):this.m_content.setString(this.m_animation_script.content);var size=this.m_content.getContentSize();this.m_cell_height=size.height+20,"0"==this.m_animation_script.voice?this.m_voice_btn.setVisible(!1):this.m_voice_btn.setVisible(!0)},playVoice:function(){this.m_script_type==SCRIPT_TYPE.ANIMATION?this.m_logLayer&&this.m_logLayer.voicePlayAnimation(this.m_animation_script):this.m_script_type==SCRIPT_TYPE.PROLOGUE?this.m_logLayer&&this.m_logLayer.voicePlayPrologue(this.m_prologue_script):this.m_script_type==SCRIPT_TYPE.MISSION?this.m_logLayer&&this.m_logLayer.voicePlayMission(this.m_mission_script):this.m_script_type==SCRIPT_TYPE.EVENT?this.m_logLayer&&this.m_logLayer.voicePlayEvent(this.m_event_script):this.m_logLayer&&this.m_logLayer.voicePlay(this.m_script)}}),NpcInfoItemNode=cc.Node.extend({m_icon:null,tooltip_box:null,tooltip_title:null,tooltip_content:null,tooltip_btn:null,m_card_type:0,m_boss_mark:null,m_is_boss:!1,m_life_bar:null,m_game_type:0,m_ignore_def_icon:null,m_callback:null,tooltip_title_sprite:null,ctor:function(card_type,_gt,callbock,remveTooltip){this._super(),this.init(card_type,_gt,callbock,remveTooltip)},init:function(card_type,_gt,callback,remveTooltip){if(this.m_game_type=_gt,this.m_card_type=card_type,this.m_callback=callback,this.m_cancel=remveTooltip,this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_icon=cc.Sprite.create(),this.m_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_icon.setPosition(ZERO()),this.addChild(this.m_icon),this.m_boss_mark=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_frame_small_boss.png"),this.m_boss_mark.setContentSize(39,39),this.m_boss_mark.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_boss_mark.setPosition(ZERO()),this.addChild(this.m_boss_mark,10),this.m_ignore_def_icon=cc.Sprite.create(RES_CDN_CARD_CARD_IMG_NTP+"img_card_small_drill.png"),this.m_ignore_def_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_ignore_def_icon.setPosition(ZERO()),this.addChild(this.m_ignore_def_icon,11),this.m_ignore_def_icon.setVisible(!1),this.m_game_type==db.BattleGameType.GreatWallDungeon){var bar_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero());bar_bg.setAnchorPoint(ANCHOR_TOP_LEFT()),bar_bg.setPreferredSize(cc.size(68,12)),bar_bg.setPosition(0,0),this.addChild(bar_bg,20),this.m_life_bar=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green.png",RectZero()),this.m_life_bar.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_life_bar.setPosition(3,5),bar_bg.addChild(this.m_life_bar)}return this.tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.tooltip_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.tooltip_box.setPosition(ZERO()),this.tooltip_box.setVisible(!1),this.addChild(this.tooltip_box,1e6),this.tooltip_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1810),this.tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_box.addChild(this.tooltip_title),this.tooltip_title_sprite=cc.Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png"),this.tooltip_title_sprite.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_title_sprite.setVisible(!1),this.tooltip_box.addChild(this.tooltip_title_sprite),this.tooltip_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.tooltip_content.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_box.addChild(this.tooltip_content),this.tooltip_btn=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(20,20,20,20))),this.tooltip_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.tooltip_btn.setPreferredSize(cc.size(0,0)),this.tooltip_btn.setPosition(ZERO()),this.addChild(this.tooltip_btn),this.tooltip_btn.addTargetWithActionForControlEvents(this,this.onTouchIcon,cc.CONTROL_EVENT_TOUCH_DOWN),this.tooltip_btn.addTargetWithActionForControlEvents(this,this.onTouchIcon,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),this.tooltip_btn.addTargetWithActionForControlEvents(this,this.onTouchIcon,cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE),this.tooltip_btn.addTargetWithActionForControlEvents(this,this.onTouchIcon,cc.CONTROL_EVENT_TOUCH_CANCEL),!0},onTouchIcon:function(sender,_event){_event==cc.CONTROL_EVENT_TOUCH_DOWN?this.showTooltip():this.hideTooltip()},convertCardGeneral:function(gnrl,card){card.gnrl_id=gnrl.gnrl_id,card.level=1},showTooltip:function(){this.tooltip_box.setVisible(!0),this.tooltip_box.setLocalZOrder(1e4),this.setLocalZOrder(100001);var tooltip=MasterTable.getInstance().get_TooltipGeneral(this.m_general.gnrl_id);if(111002!=this.m_general.gnrl_id){this.tooltip_title.setString(this.m_general.name),this.tooltip_content.setString(tooltip.content);var tSize=ccSize(this.tooltip_title),cSize=ccSize(this.tooltip_content);if((bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(tSize.width+20,cSize.width+20),bSize.height=Math.max(64,bSize.height+cSize.height+5),this.tooltip_box.setContentSize(bSize),this.tooltip_box.setContentSize(bSize),this.tooltip_title.setPosition(10,bSize.height-10),this.tooltip_content.setPosition(10,bSize.height-15-tSize.height),this.tooltip_box){var world_pos=this.tooltip_box.getParent().getParent().getParent().convertToWorldSpace(this.getPosition()),container_pos=this.tooltip_box.getParent().getParent().getPosition();world_pos.x=world_pos.x+this.tooltip_box.x+container_pos.x,world_pos.y=world_pos.y+this.tooltip_box.y+container_pos.y,null!=this.m_callback&&this.m_callback(world_pos,Object.assign({},this.tooltip_box),this.tooltip_title.getString(),this.tooltip_content.getString())}}else{var path=RES_CDN_DEFULT+"common/font_1810.png",frame_texture=cc.textureCache.addImage(path),frame=new cc.SpriteFrame(frame_texture,cc.rect(0,0,frame_texture.getContentSize().width,frame_texture.getContentSize().height));this.tooltip_title_sprite.setSpriteFrame(frame),this.tooltip_title_sprite.setOpacity(255),this.tooltip_title_sprite.setVisible(!0),this.tooltip_content.setString(tooltip.content);var bSize;tSize=ccSize(this.tooltip_title_sprite),cSize=ccSize(this.tooltip_content);if((bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(tSize.width+20,cSize.width+20),bSize.height=Math.max(64,bSize.height+cSize.height+5),this.tooltip_box.setContentSize(bSize),this.tooltip_box.setContentSize(bSize),this.tooltip_title_sprite.setPosition(10,bSize.height-10),this.tooltip_content.setPosition(10,bSize.height-15-tSize.height),this.tooltip_box){world_pos=this.tooltip_box.getParent().getParent().getParent().convertToWorldSpace(this.getPosition()),container_pos=this.tooltip_box.getParent().getParent().getPosition();world_pos.x=world_pos.x+this.tooltip_box.x+container_pos.x,world_pos.y=world_pos.y+this.tooltip_box.y+container_pos.y,null!=this.m_callback&&this.m_callback(world_pos,Object.assign({},this.tooltip_box),"",this.tooltip_content.getString())}}},hideTooltip:function(){this.tooltip_box.setVisible(!1),this.tooltip_title_sprite.setVisible(!1),this.setLocalZOrder(0),null!=this.m_cancel&&this.m_cancel()},setNpcData:function(npc,is_boss){var m=MasterTable.getInstance().getMasterTable();this.m_general=m.get_General(npc.gnrl_id),this.m_is_boss=is_boss,this.updateIcon()},setGeneralData:function(gnrl,is_boss){this.m_general=gnrl,this.m_is_boss=is_boss,this.updateIcon()},setBattleGeneralData:function(gnrl,is_boss){this.m_battle_general=gnrl,this.m_is_boss=is_boss,this.m_general=this.m_battle_general.general,this.updateIcon()},updateIcon:function(){null!=this.m_icon&&null!=this.m_icon.getParent()&&this.m_icon.removeFromParent();var card=db.CardInfo;this.convertCardGeneral(this.m_general,card),this.m_icon=(new Card).createCard(card,this.m_card_type),this.m_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_icon.setPosition(ZERO()),this.addChild(this.m_icon,0);var iconSize=ccSize(this.m_icon);if(this.setContentSize(iconSize),this.tooltip_btn.setPreferredSize(iconSize),this.tooltip_box.setPosition(.5*iconSize.width,iconSize.height+5),this.m_boss_mark.setPosition(65,65),this.m_boss_mark.setVisible(this.m_is_boss),this.m_game_type==db.BattleGameType.GreatWallDungeon&&(this.m_ignore_def_icon.setVisible(1==this.m_battle_general.npc_attk_dmg_type),null!=this.m_life_bar)){var max_hp=this.m_battle_general.general.hp,cur_life=max_hp*this.m_battle_general.remain_hp_rate/1e4;this.m_battle_general.is_dead?cur_life=0:cur_life<0&&(cur_life=1);var per=cc.clampf(cur_life/max_hp*62,0,62);this.m_life_bar.setPreferredSize(cc.size(per,6))}},setGlobalZOrderTooltip:function(is_zorder){null!=this.tooltip_box&&is_zorder&&(this.tooltip_box.setGlobalZOrder(1e6),this.tooltip_title.setGlobalZOrder(1000001),this.tooltip_content.setGlobalZOrder(1000002),this.tooltip_title_sprite.setGlobalZOrder(1000001))}}),WeeklyDeckReadyLeaderNode=cc.Node.extend({m_leader_placehold:null,m_leader_icon:null,m_leader_title:null,m_leader_content:null,m_leader_content_v2:null,ctor:function(){this._super(),this.init()},init:function(){this.m_leader_data={leader_skill_id:0},this.m_Sleader_data={special_leader_skill_id:0};var size=cc.size(409,68);this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(size);var box_frame=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");box_frame.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box_frame.setPosition(ZERO()),this.addChild(box_frame);var none=cc.Sprite.create(RES_CDN_DEFULT+"icon/leader/leader_none.png");return none.setAnchorPoint(ANCHOR_MIDDLE()),none.setPosition(ccCenter(box_frame)),box_frame.addChild(none),this.m_leader_icon=cc.Sprite.create(RES_CDN_DEFULT+"icon/leader/leader_30001.png"),this.m_leader_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_leader_icon.setPosition(ccCenter(box_frame)),box_frame.addChild(this.m_leader_icon),this.m_leader_icon.setVisible(!1),this.m_leader_placehold=cmLabel.getLabel("\n",LABEL_FONT_INDEX.FONT_166),this.m_leader_placehold.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_leader_placehold.setPosition(75,.5*size.height),this.m_leader_placehold.setTextAreaSize(cc.size(size.width-75,0)),this.addChild(this.m_leader_placehold),this.m_leader_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812),this.m_leader_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_leader_title.setPosition(75,size.height),this.addChild(this.m_leader_title),this.m_leader_title.setVisible(!1),USE_LEADERSKILL_SCROLL?(this.m_leader_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_144),this.m_leader_content.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_leader_content.setTextAreaSize(cc.size(310,50)),this.m_leader_content.ignoreContentAdaptWithSize(!1),this.m_leader_content.setVisible(!1),this.m_leader_content_v2=new cc.ScrollView(cc.size(310,45),this.m_leader_content),this.m_leader_content_v2.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_leader_content_v2.setContentSize(this.m_leader_content.getContentSize()),this.m_leader_content_v2.setPosition(75,0),this.m_leader_content_v2.setContentOffset(cc.p(0,45-1*this.m_leader_content.getContentSize().height),!1),this.addChild(this.m_leader_content_v2)):(this.m_leader_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_144),this.m_leader_content.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_leader_content.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this.m_leader_content.setTextAreaSize(cc.size(310,80)),this.m_leader_content.ignoreContentAdaptWithSize(!1),this.m_leader_content.setPosition(75,.5*(size.height-50)),this.addChild(this.m_leader_content),this.m_leader_content.setVisible(!1)),!0},setLeaderSkillId:function(leader_id){if(0==leader_id||99999==leader_id)this.m_leader_data=null,this.clear();else{var m=MasterManager.getInstance();this.m_leader_data=m.get_LeaderSkill(leader_id)}this.updateLeaderSlot()},setSLeaderSkillId:function(leader_id){if(0==leader_id||99999==leader_id)this.m_leader_data=null,this.clear();else{var m=MasterManager.getInstance();this.m_leader_data=m.get_SpecialLeaderSkill(leader_id)}this.updateLeaderSlot()},updateLeaderSlot:function(){if(null==this.m_leader_data)this.m_leader_icon.setVisible(!1),this.m_leader_placehold.setVisible(!0),this.m_leader_title.setVisible(!1),this.m_leader_content.setVisible(!1);else{var ani_img=RES_CDN_DEFULT+"icon/leader/leader_"+this.m_leader_data.skill_icon+".png",frame_texture=cc.textureCache.addImage(ani_img),frame=new cc.SpriteFrame(frame_texture,cc.rect(0,0,frame_texture.getContentSize().width,frame_texture.getContentSize().height));this.m_leader_icon.setSpriteFrame(frame),this.m_leader_icon.setVisible(!0),this.m_leader_placehold.setVisible(!1),this.m_leader_title.setString(this.m_leader_data.name),this.m_leader_title.setVisible(!0),this.m_leader_content.setString(this.m_leader_data.content),this.m_leader_content.setVisible(!0),USE_LEADERSKILL_SCROLL&&(this.m_leader_content_v2.setContentSize(this.m_leader_content.getContentSize()),this.m_leader_content_v2.setContentOffset(cc.p(0,45-1*this.m_leader_content.getContentSize().height),!1))}},clear:function(){null!=this.m_leader_data&&(this.m_leader_data.leader_skill_id=0,this.m_Sleader_data.special_leader_skill_id=0)},scrollViewDidScroll:function(view){},scrollViewDidZoom:function(view){}}),WeeklyEntryBgLayer=cc.Layer.extend({ctor:function(){this._super()},back:function(){cc.log("back click")}}),weekly_dungeon_show_help_v2=89898,weekly_dungeon_open=89899,weekly_dungeon_begin=89900,jade_lack=89901,UPDATE_INTERVAL_TIME=1,WeeklyEntryLayer=cc.Layer.extend({m_bg:null,m_base_layer:null,m_tableView:null,m_choice_week_day:0,m_right_layer:null,m_dungeon_name:null,m_choice_difficulty_type:-1,m_boss_img:null,m_dungeon_open_time:null,m_start_key_btn:null,m_need_key:null,m_boss_container:null,m_start_jade_btn:null,m_need_jade:null,m_message_box:null,m_update_min_delta:0,m_weekly_btns:[],m_difficulty_btns:[],m_npc_list:[],m_reward_list:[],m_week_day_dungeon_list:[],m_total_dungeon_list:[],m_gnrl_img:null,m_boyd_img_num:0,m_deferred:null,m_choice_stage_count:0,m_help_check:!1,m_mission_task_modal_layer:null,m_task_list:[],m_jade_btn_open:!1,ctor:function(deferred,choice_week_day,choice_difficulty_type,choice_stage_count){this._super(),this.m_npc_list=[],this.m_reward_list=[],this.m_week_day_dungeon_list=[],this.m_total_dungeon_list=[],this.m_weekly_btns=[],this.m_difficulty_btns=[],this.m_task_list=[],this.m_deferred=deferred,this.m_jade_btn_open=!1,WEEKLY_DUNGEON_NOW=!1,this.init(choice_week_day,choice_difficulty_type,choice_stage_count)},onExit:function(){if(this._super(),1!=PREV_MISSION&&1!=PREV_ACHIVE_WEEKLY)if(1!=WEEKLY_DUNGEON_NOW)if(1!=this.m_help_check){if(null!=this.m_gnrl_img){for(var idx=0;idx<this.m_gnrl_img.length;idx++)cc.loader.release(this.m_gnrl_img[idx]);this.m_gnrl_img=[]}this.m_npc_list=[],this.m_reward_list=[],this.m_week_day_dungeon_list=[],this.m_total_dungeon_list=[],this.m_weekly_btns=[],this.m_difficulty_btns=[],null!=this.m_boss_container&&this.m_boss_container.removeChild(this.m_boss_img),null!=this.m_right_layer&&(this.m_right_layer.removeChild(this.m_dungeon_name),this.m_right_layer.removeChild(this.m_start_key_btn),this.m_right_layer.removeChild(this.m_start_jade_btn),this.m_right_layer.removeAllChildrenWithCleanup(!0)),null!=this.m_base_layer&&(this.m_base_layer.removeChild(this.m_boss_container),this.m_base_layer.removeChild(this.m_tableView),this.m_base_layer.removeChild(this.m_right_layer),this.m_base_layer.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_base_layer)),null!=this.m_bg&&this.removeChild(this.m_bg),null!=this.m_message_box&&this.removeChild(this.m_message_box),this.removeAllChildrenWithCleanup(!0)}else this.m_help_check=!1;else WEEKLY_DUNGEON_NOW=!1},init:function(choice_week_day,choice_difficulty_type,choice_stage_count){this.m_gnrl_img=[],this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var winSize=ccSize(this),service=BattleService.getInstance();this.m_total_dungeon_list=[],service.getMasterWeeklyDungeon(this.m_total_dungeon_list),this.m_bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub.png"),this.m_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bg.setPosition(ccCenter(winSize)),USE_SP_COMMON_SUB_BG_SCALE&&this.m_bg.setScale(2),this.addChild(this.m_bg),this.m_base_layer=new cc.Layer,this.m_base_layer.ignoreAnchorPointForPosition(!1),this.m_base_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_base_layer.setPosition(ccCenter(winSize)),this.addChild(this.m_base_layer),this.createDungeonBoss(),this.createLeftBox(),this.createRightBox(),choice_week_day<0||6<choice_week_day?this.m_choice_week_day=this.checkTodayWeekDay():(this.m_choice_week_day=choice_week_day,this.m_choice_difficulty_type=choice_difficulty_type,this.m_choice_stage_count=choice_stage_count),this.choiceWeeklyDay(this.m_choice_week_day),this.choiceDifficultyType(this.m_choice_difficulty_type),this.choiceStage(this.m_choice_stage_count),this.updateRightInfo(),this.m_message_box=new CTGameMessageBox,this.addChild(this.m_message_box,11e4);var modalSize=cc.size(winSize.width,640);return this.m_mission_task_modal_layer=new GameModalLayer,this.m_mission_task_modal_layer.setContentSize(modalSize),this.addChild(this.m_mission_task_modal_layer,99998),this.scheduleUpdateWithPriority(1),this.m_tableView.reloadData(),this.m_deferred.resolve(!0),!0},getWeeklyDungeonOpenInfo:function(weekly_idx,week_type,opentime){var dungeon=this.getSelectedDungeon();return{idx:dungeon.weekly_dungeon.weekly_idx,type:this.m_choice_week_day+1,time:dungeon.weekly_dungeon.open_time}},createDungeonBoss:function(){var winSize=ccSize(this);this.m_boss_container=new cc.Node,this.m_boss_container.setPosition(winSize.width,0),this.m_base_layer.addChild(this.m_boss_container),this.m_boss_img=cc.Sprite.create(),this.m_boss_img.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_boss_img.setPosition(ZERO()),this.m_boss_img.setScale(2),this.m_boss_container.addChild(this.m_boss_img);var scaleTo_1=new cc.ScaleTo(.7,2,2.01),scaleTo_2=new cc.ScaleTo(.7,2,1.99),seq=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(seq);this.m_boss_img.runAction(repeat);var dark_mask=cc.Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal_4.png");dark_mask.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),dark_mask.setPosition(LP(this,300,0)),dark_mask.setScaleY(640),this.m_base_layer.addChild(dark_mask);var help=new ccui.Button;help.loadTextures("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE),help.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),help.setPosition(winSize.width-10,539),this.m_base_layer.addChild(help),help.addClickEventListener(function(float){this.scheduleOnce(function(float){this.m_help_check=!0,MainObserver.getInstance().postNotification(sceneStr[scene_WeeklyEntryScene],weekly_dungeon_show_help_v2)},0,"weekly_dungeon_show_help")}.bind(this))},createLeftBox:function(){var tSize=cc.size(476,488);this.m_tableView=new cc.TableView(this,tSize),this.m_tableView.ignoreAnchorPointForPosition(!1),this.m_tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_tableView.setVerticalFillOrder(0),this.m_tableView.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_tableView.setPosition(LP(this,0,10)),this.m_tableView.setDelegate(this),this.m_base_layer.addChild(this.m_tableView),this.m_tableView.scrollBarEnable(!0),this.m_tableView.reloadData();var weekly_title=[];weekly_title.push(""),weekly_title.push(""),weekly_title.push(""),weekly_title.push(""),weekly_title.push(""),weekly_title.push(""),weekly_title.push("");for(var offset_x=0,i=0;i<weekly_title.length;i++){var btn=new LabelButton("btn_19_none.png","btn_19_on.png","btn_19_off.png",ccui.Widget.PLIST_TEXTURE);btn.setFont(LABEL_FONT_INDEX.FONT_241),btn.setString(weekly_title[i]),btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn.setPosition(LP(this,offset_x,508)),this.m_base_layer.addChild(btn),btn.setTag(i),btn.addClickEventListener(function(sender){this.choiceWeeklyDay(sender.getTag()),this.choiceDifficultyType(-1),this.updateRightInfo()}.bind(this)),this.m_weekly_btns.push(btn),offset_x+=ccWidth(btn)}},createRightBox:function(){var winSize=ccSize(this),boxSize=cc.size(481,568);this.m_right_layer=new cc.Layer,this.m_right_layer.ignoreAnchorPointForPosition(!1),this.m_right_layer.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_right_layer.setContentSize(boxSize),this.m_right_layer.setPosition(.5*winSize.width+1,0),this.m_base_layer.addChild(this.m_right_layer),this.m_dungeon_name=cc.Sprite.create("#img_vs_day_text_title_01.png"),this.m_dungeon_name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_dungeon_name.setPosition(19,525),this.m_right_layer.addChild(this.m_dungeon_name);var diff_types=[];diff_types.push(res_str("label_weekly_easy")),diff_types.push(res_str("label_weekly_easy_2x")),diff_types.push(res_str("label_weekly_normal")),diff_types.push(res_str("label_weekly_normal_2x")),diff_types.push(res_str("label_weekly_hard")),diff_types.push(res_str("label_weekly_hard_2x")),diff_types.push(res_str("label_weekly_super_easy")),diff_types.push(res_str("label_weekly_super_easy_2x"));for(var offset_x_diff=19,offset_y_diff=472,i=0;i<diff_types.length;i++){offset_y_diff=i%2==0?472:427;var btn=new LabelButton("btn_20_none.png","btn_20_on.png","btn_20_off.png",ccui.Widget.PLIST_TEXTURE);btn.setFont(LABEL_FONT_INDEX.FONT_201),btn.setString(diff_types[i]),btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn.setPosition(offset_x_diff,offset_y_diff),this.m_right_layer.addChild(btn),btn.setTag(i),btn.addClickEventListener(function(sender){this.choiceDifficultyType(sender.getTag()),this.updateRightInfo()}.bind(this)),this.m_difficulty_btns.push(btn),i%2==1&&(offset_x_diff+=ccWidth(btn)),cc.log("diff_types[i] = "+diff_types[i])}(dot=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),dot.setPosition(19,395),this.m_right_layer.addChild(dot),(title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_248)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(35,388),this.m_right_layer.addChild(title);var npc_pos=[];npc_pos.push(cc.p(19,269)),npc_pos.push(cc.p(91,305)),npc_pos.push(cc.p(91,233)),npc_pos.push(cc.p(163,305)),npc_pos.push(cc.p(163,233));for(i=0;i<npc_pos.length;i++){var npc=new NpcInfoItemNode(CARD_TYPE.type_card_thumb);npc.setPosition(npc_pos[i]),this.m_right_layer.addChild(npc),this.m_npc_list.push(npc),npc=null}(line=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),line.setPosition(19,197),this.m_right_layer.addChild(line),npc_pos=line=title=dot=null,(dot=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),dot.setPosition(19,172),this.m_right_layer.addChild(dot),(title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_248)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(35,164),this.m_right_layer.addChild(title);var line,dot,title,campaign=MasterTable.getInstance().get_RewardCampaignUi(CAMPAIGN_DUNGEON_TYPE_WEEKLY,CAMPAIGN_POSITION_TYPE_ENTERANCE_BOTTOM_REWARD_);null!=campaign.dugeon_type&&0!=campaign.dugeon_type&&((icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("common/%s",campaign.image_name))).setAnchorPoint(ZERO()),icon.setPosition(127,161),this.m_right_layer.addChild(icon),icon=null);var offset_x=19;for(i=0;i<6;i++){var bonus=new MissionPreviewBonusItemCell;bonus.setEnableToolTip(!0),bonus.setPosition(offset_x,86),this.m_right_layer.addChild(bonus),offset_x+=72,this.m_reward_list.push(bonus),bonus=null}title=dot=null,(line=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),line.setPosition(19,70),this.m_right_layer.addChild(line),(dot=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),dot.setPosition(19,40),this.m_right_layer.addChild(dot),(title=cmLabel.getLabel(res_str("label_task_title"),LABEL_FONT_INDEX.FONT_248)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(35,32),this.m_right_layer.addChild(title);for(var task_offset_x=140,j=0;j<3;j++){var task=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_off.png");task.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),task.setPosition(task_offset_x,28),this.m_right_layer.addChild(task),this.m_task_list.push_back(task),task_offset_x+=36}var help=new ccui.Button("btn_help_small_off.png","btn_help_small_on.png","",ccui.Widget.PLIST_TEXTURE);help.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),help.setPosition(task_offset_x,42),this.m_right_layer.addChild(help),help.addClickEventListener(function(sender){this.showMissionTaskModalLayer()}.bind(this)),this.m_start_key_btn=new LabelButton("btn_07_off.png","btn_07_on.png","btn_07_none.png",ccui.Widget.PLIST_TEXTURE),this.m_start_key_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_start_key_btn.setPosition(LP(this,ccWidth(this.m_right_layer)-10,10)),this.m_start_key_btn.setPosition(320,10),this.m_start_key_btn.setFont(LABEL_FONT_INDEX.FONT_241),this.m_start_key_btn.setString(""),this.m_start_key_btn.setOffsetX(-50);ccSize(this.m_start_key_btn);(icon_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero())).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),icon_box.setPosition(.5*ccWidth(this.m_start_key_btn)+18,.5*ccHeight(this.m_start_key_btn)),icon_box.setPreferredSize(cc.size(66,38)),this.m_start_key_btn.addChild(icon_box);var iconBoxSize=ccSize(icon_box);(icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_ic_key.png")).setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(0,.5*iconBoxSize.height),icon_box.addChild(icon),this.m_need_key=cmLabel.getLabel("3",LABEL_FONT_INDEX.FONT_2011),this.m_need_key.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_need_key.setPosition(iconBoxSize.width-10,.5*iconBoxSize.height),icon_box.addChild(this.m_need_key),this.m_right_layer.addChild(this.m_start_key_btn),this.m_start_key_btn.addClickEventListener(function(sender){this.startBattleReady()}.bind(this)),this.m_start_key_btn.setVisible(!1);var icon_box,twice_event=cc.Sprite.create(RES_CDN_DEFULT+"menu_vs/img_vs_day_event_text_2.png");twice_event.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),twice_event.setPosition(ccWidth(this.m_start_key_btn),44),this.m_start_key_btn.addChild(twice_event),this.m_start_jade_btn=new LabelButton("btn_07_off.png","btn_07_on.png","btn_07_none.png",ccui.Widget.PLIST_TEXTURE),this.m_start_jade_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_start_jade_btn.setPosition(320,10),this.m_start_jade_btn.setFont(LABEL_FONT_INDEX.FONT_201),this.m_start_jade_btn.setString("3",30),this.m_start_jade_btn.setOffsetX(-35),(icon_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero())).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),icon_box.setPosition(.5*ccWidth(this.m_start_key_btn)+36,.5*ccHeight(this.m_start_key_btn)),icon_box.setPreferredSize(cc.size(66,38)),this.m_start_jade_btn.addChild(icon_box);var icon;iconBoxSize=ccSize(icon_box);(icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_jade.png")).setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(0,.5*iconBoxSize.height),icon_box.addChild(icon),this.m_need_jade=cmLabel.getLabel("3",LABEL_FONT_INDEX.FONT_2011),this.m_need_jade.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_need_jade.setPosition(iconBoxSize.width-10,.5*iconBoxSize.height),icon_box.addChild(this.m_need_jade),this.m_right_layer.addChild(this.m_start_jade_btn),this.m_start_jade_btn.addClickEventListener(function(sender){this.startBattleReady()}.bind(this))},startBattleReady:function(){if(this.IsEnableDungeonOpenTime())if(IS_SP_BROWSER)this.getParent().initLayoutProgress_Raid(0),this.scheduleOnce(function(dt){var dungeon=this.getSelectedDungeon(),difficulty=this.getSelectedDifficulty();BattleService.getInstance().getMasterWeeklyDungeonStageNpc(difficulty);var context=BattleContext._getInstance();context.setGameType(db.BattleGameType.WeeklyDungeon),context.setWeeklyDungeonData(dungeon),context.setWeeklyDungeonDifficulty(difficulty),MainObserver.getInstance().postNotification(sceneStr[scene_WeeklyEntryScene],weekly_dungeon_begin),this.getParent().removeLayerProgress_Raid()},.5,"WeeklyEntryLayerBattle");else{var dungeon=this.getSelectedDungeon(),difficulty=this.getSelectedDifficulty();BattleService.getInstance().getMasterWeeklyDungeonStageNpc(difficulty);var context=BattleContext._getInstance();context.setGameType(db.BattleGameType.WeeklyDungeon),context.setWeeklyDungeonData(dungeon),context.setWeeklyDungeonDifficulty(difficulty),MainObserver.getInstance().postNotification(sceneStr[scene_WeeklyEntryScene],weekly_dungeon_begin)}else this.buyDungeonTime();this.m_update_min_delta=UPDATE_INTERVAL_TIME},buyDungeonTime:function(){var dungeon=this.getSelectedDungeon(),userItemInfo=NetService().get_UserItemInfo_V2();if(userItemInfo.jade_cnt<dungeon.weekly_dungeon.cost)return this.m_help_check=!0,cc.log("weekly_dungeon - buyDungeonTime() have_jade_cnt:"+userItemInfo.jade_cnt+", need cost:"+dungeon.weekly_dungeon.cost),void MainObserver.getInstance().postNotification(sceneStr[scene_WeeklyEntryScene],jade_lack);this.showBuyOpenDungeon()},showBuyOpenDungeon:function(res){var dungeon=this.getSelectedDungeon();this.m_message_box.setTitle("");var min=(dungeon.weekly_dungeon.open_time/60).toFixed(0);this.m_message_box.setText("",LABEL_FONT_INDEX.FONT_261),this.m_message_box.setText(dungeon.weekly_dungeon.cost+"",LABEL_FONT_INDEX.FONT_262),this.m_message_box.setText("",LABEL_FONT_INDEX.FONT_261),this.m_message_box.setText(dungeon.weekly_dungeon.name,LABEL_FONT_INDEX.FONT_262),this.m_message_box.setText("",LABEL_FONT_INDEX.FONT_261),this.m_message_box.setText("\n"),this.m_message_box.setText(min+"",LABEL_FONT_INDEX.FONT_262),this.m_message_box.setText("",LABEL_FONT_INDEX.FONT_261),this.m_message_box.addButtonInfo(new MessageButtonInfo("",MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_message_box.hide()}.bind(this))),this.m_message_box.addButtonInfo(new MessageButtonInfo("",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_start_jade_btn.setEnabled(!1),this.scheduleOnce(function(){this.reqBuyOpenDungeon()},.2,"showBuyOpenDungeon"),this.m_message_box.hide()}.bind(this))),this.m_message_box.show()},reqBuyOpenDungeon:function(){this.IsEnableDungeonOpenTime()?this.showNotBuyOpenDundeon():MainObserver.getInstance().postNotification(sceneStr[scene_WeeklyEntryScene],weekly_dungeon_open)},showNotBuyOpenDundeon:function(){this.m_message_box.is_show()&&this.m_message_box.hide(),this.m_message_box.setTitle(""),this.m_message_box.setText(""),this.m_message_box.setText("\n"),this.m_message_box.addButtonInfo(new MessageButtonInfo("",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(){this.updateRightInfo(),this.m_update_min_delta=UPDATE_INTERVAL_TIME},.2,"showNotBuyOpenDundeon"),this.m_message_box.hide()}.bind(this))),this.m_message_box.show()},checkTodayWeekDay:function(){var now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME);return moment(now).days()},choiceWeeklyDay:function(week_day){this.m_choice_week_day=week_day;for(var i=0;i<this.m_weekly_btns.length;i++)this.m_weekly_btns[i].setEnabled(this.m_choice_week_day!=i);this.checkUserOpenDungeonTime()?this.getUpdateDungeonList():this.filterWeekDayDataList(this.m_choice_week_day),this.m_tableView.reloadData()},choiceDifficultyType:function(btn_index){var dungeon=this.getSelectedDungeon();if(-1==btn_index){for(var is_first_diff=!1,i=0;i<dungeon.weekly_difficulty.length;i++){var d=dungeon.weekly_difficulty[i];if(is_first_diff)d.is_selected=!1;else{var twice="y"==d.weekly_difficulty.two_times_yn?1:0,index=2*(d.weekly_difficulty.difficulty_type-1)+twice;this.m_choice_difficulty_type=index,is_first_diff=d.is_selected=!0}}for(i=0;i<this.m_difficulty_btns.length;i++)this.m_difficulty_btns[i].setEnabled(this.m_choice_difficulty_type!=i)}else{this.m_choice_difficulty_type=btn_index;var diff=parseInt(btn_index/2+1),is_twice=0<btn_index%2?"y":"n";for(i=0;i<this.m_difficulty_btns.length;i++)this.m_difficulty_btns[i].setEnabled(this.m_choice_difficulty_type!=i);for(var j=0;j<this.m_week_day_dungeon_list.length;j++){if((d=this.m_week_day_dungeon_list[j]).is_selected)for(var k=0;k<d.weekly_difficulty.length;k++)d.weekly_difficulty[k].weekly_difficulty.difficulty_type==diff&&d.weekly_difficulty[k].weekly_difficulty.two_times_yn==is_twice?d.weekly_difficulty[k].is_selected=!0:d.weekly_difficulty[k].is_selected=!1}}},getUpdateDungeonList:function(){var dungeon=this.getSelectedDungeon(),service=BattleService.getInstance();this.m_total_dungeon_list=[],service.getMasterWeeklyDungeon(this.m_total_dungeon_list),this.filterWeekDayDataList(this.m_choice_week_day);for(var i=0;i<this.m_week_day_dungeon_list.length;i++)this.m_week_day_dungeon_list[i].is_selected=this.m_week_day_dungeon_list[i].weekly_dungeon.weekly_idx==dungeon.weekly_dungeon.weekly_idx},checkUserOpenDungeonTime:function(){if(0==this.m_week_day_dungeon_list.length)return!1;for(var dungeon=this.getSelectedDungeon(),now=(this.getSelectedDifficulty(),TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)),n=moment(now).valueOf(),is_user_close_time=!1,idx=0;idx<this.m_week_day_dungeon_list.length;idx++){if(null==(dungeon=this.m_week_day_dungeon_list[idx]).weekly_period)break;for(var jdx=0;jdx<dungeon.weekly_period.length;jdx++){var period=dungeon.weekly_period[jdx];if(null!=period){if(null==period.is_user_period)break;if(period.is_user_period)if(period.end_date.valueOf()<n){is_user_close_time=!0;break}}}}return is_user_close_time},filterWeekDayDataList:function(week_day){this.m_week_day_dungeon_list=[];for(var idx=0;idx<this.m_total_dungeon_list.length;idx++)for(var jdx=0;jdx<this.m_total_dungeon_list[idx].weekly_period.length;jdx++)if(this.m_total_dungeon_list[idx].weekly_period[jdx].week_day==week_day+1||8==this.m_total_dungeon_list[idx].weekly_period[jdx].week_day){this.m_total_dungeon_list[idx].is_selected=!1,this.m_week_day_dungeon_list.push($.extend({},this.m_total_dungeon_list[idx]));break}0<this.m_week_day_dungeon_list.length&&(this.m_week_day_dungeon_list[0].is_selected=!0)},tableCellSizeForIndex:function(table,idx){return cc.size(130,140)},tableCellEnded:function(){},tableCellHighlight:function(){},tableCellUnhighlight:function(){return!1},scrollViewDidScroll:function(){},scrollViewDidZoom:function(){},tableCellTouched:function(table,cell){AudioEngine.getInstance().playNormaButtonSound();for(var idx=cell.getIdx(),i=0;i<this.m_week_day_dungeon_list.length;i++)this.m_week_day_dungeon_list[i].is_selected=idx==i;var offset=table.getContentOffset();table.reloadData(),table.setContentOffset(offset),this.m_choice_stage_count=idx,this.choiceDifficultyType(-1),this.updateRightInfo(),this.m_update_min_delta=UPDATE_INTERVAL_TIME},updateRightInfo:function(){var dungeon=this.getSelectedDungeon(),difficulty=this.getSelectedDifficulty(),winSize=ccSize(this),service=BattleService.getInstance(),frame1=(MasterTable.getInstance(),cc.spriteFrameCache.getSpriteFrame("img_vs_day_text_title_"+leadingZeros(dungeon.weekly_dungeon.img_num,2)+".png"));this.m_dungeon_name.setSpriteFrame(frame1);for(var i=0;i<this.m_difficulty_btns.length;i++)this.m_difficulty_btns[i].setVisible(!1);var count=0,count_2x=0;for(i=0;i<dungeon.weekly_difficulty.length;i++){var dun=dungeon.weekly_difficulty[i],diff=dun.weekly_difficulty.difficulty_type,doubles="y"==dun.weekly_difficulty.two_times_yn?1:0,index=2*(diff-1)+doubles;if(index<this.m_difficulty_btns.length)if(this.m_difficulty_btns[index].setVisible(!0),0==doubles){var offset_x=19+count*ccWidth(this.m_difficulty_btns[index]);this.m_difficulty_btns[index].setPositionX(offset_x),count++}else{offset_x=19+count_2x*ccWidth(this.m_difficulty_btns[index]);this.m_difficulty_btns[index].setPositionX(offset_x),count_2x++}}this.m_boss_container.isRunning()&&this.m_boss_container.stopAllActions();for(var idx=0;idx<this.m_npc_list.length;idx++)this.m_npc_list[idx].setVisible(!1);for(idx=0;idx<difficulty.stage_npc.at(difficulty.stage_count).length;idx++){var n=MasterManager.getInstance().get_NpcGeneral(difficulty.stage_npc.at(difficulty.stage_count)[idx].npc_id);if(difficulty.stage_npc.at(difficulty.stage_count)[idx].is_zoom){var img_num=n.gnrl_group,found=-1;found=img_num<100?this.m_gnrl_img.indexOf(RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(img_num,2)+".png"):this.m_gnrl_img.indexOf(RES_CDN_DEFULT+"card_war_boss/"+img_num+".png");var is_load=!1;if(-1==found)img_num<100?this.m_gnrl_img.push(RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(img_num,2)+".png"):this.m_gnrl_img.push(RES_CDN_DEFULT+"card_war_boss/"+img_num+".png"),is_load=!0,cc.loader.load(this.m_gnrl_img,function(err,results){if(!err){var loading_group_img="";loading_group_img=img_num<100?RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(img_num,2)+".png":RES_CDN_DEFULT+"card_war_boss/"+img_num+".png";var frame1_texture=cc.textureCache.getTextureForKey(loading_group_img),frame1=new cc.SpriteFrame(frame1_texture,cc.rect(0,0,frame1_texture.getContentSize().width,frame1_texture.getContentSize().height));this.m_boss_img.setScale(2),this.m_boss_img.setSpriteFrame(frame1),this.m_boss_container.setPosition(winSize.width+this.m_boss_img.width,0);var move=new cc.MoveTo(.2,cc.p(winSize.width,0));this.m_boss_container.runAction(move),is_load=!1}}.bind(this));else if(0==is_load){var loading_group_img="";loading_group_img=img_num<100?RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(img_num,2)+".png":RES_CDN_DEFULT+"card_war_boss/"+img_num+".png";var frame1_texture=cc.textureCache.getTextureForKey(loading_group_img);frame1=new cc.SpriteFrame(frame1_texture,cc.rect(0,0,frame1_texture.getContentSize().width,frame1_texture.getContentSize().height));this.m_boss_img.setScale(2),this.m_boss_img.setSpriteFrame(frame1),this.m_boss_container.setPosition(winSize.width+this.m_boss_img.width,0);var move=new cc.MoveTo(.2,cc.p(winSize.width,0));this.m_boss_container.runAction(move)}}var p=difficulty.stage_npc.at(difficulty.stage_count)[idx].position-1,npc_icon=this.m_npc_list[p];npc_icon.setVisible(!0),npc_icon.setNpcData(n,difficulty.stage_npc.at(difficulty.stage_count)[idx].is_zoom),npc_icon.setGlobalZOrderTooltip(!0)}for(idx=0;idx<this.m_reward_list.length;idx++)this.m_reward_list[idx].setVisible(!1);var reward_index=0,weekly_bonus=[];for(idx=0;idx<difficulty.weekly_bonus.length;idx++){var b=difficulty.weekly_bonus[idx];if(-1==(found=weekly_bonus.findIndex(function(it){return it.bonus_type==b.bonus_type})))weekly_bonus.push_back(b);else if(b.bonus_type==BONUS_TYPE_YUNHEE_FIX)weekly_bonus.push_back(b);else{var sum=weekly_bonus[found].min_value+b.min_value;weekly_bonus[found].min_value=sum}}for(idx=0;idx<weekly_bonus.length;idx++){var item={};service.convertBonusInfo(weekly_bonus[idx],item);var reward=this.m_reward_list[reward_index];reward.setVisible(!0),reward.setEnableItemCount(!1),reward.setGainItem(item),reward_index++}for(var complete_task=0,j=0;j<difficulty.task_list.length;j++){difficulty.task_list[j].is_complete&&(complete_task+=1)}for(var k=0;k<this.m_task_list.length;k++){var task=this.m_task_list[k];if(k<complete_task){var frame=RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_on.png",frame2_texture=cc.textureCache.addImage(frame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));task.setSpriteFrame(frame2)}else{frame=RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_off.png",frame2_texture=cc.textureCache.addImage(frame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));task.setSpriteFrame(frame2)}}this.updateStartBtnInfo()},IsEnableDungeonOpenTime:function(){for(var dungeon=this.getSelectedDungeon(),now=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)),is_enable=!1,idx=0;idx<dungeon.weekly_period.length;idx++){var p=dungeon.weekly_period[idx];if(p.week_day==this.m_choice_week_day+1||8==p.week_day){var n=now.valueOf(),b=moment(p.begin_date).valueOf(),e=moment(p.end_date).valueOf();if(e<n)continue;if(b-1e3*(p.is_user_period?5:1)<=n&&n<=e+1){is_enable=!0,this.m_jade_btn_open=!1;break}}}return is_enable},setWeeklyDungeonOpen:function(res){var period={};period.weekly_idx=res.weekly_idx,period.week_day=res.week_type,period.begin_date=moment(res.begin_time),period.end_date=moment(res.end_time),period.is_user_period=!0;for(var i=0;i<this.m_total_dungeon_list.length;i++){if(this.m_total_dungeon_list[i].weekly_idx==res.weekly_idx)-1!=(found=this.m_total_dungeon_list[i].weekly_period.findIndex(function(p){return p.weekly_idx==period.weekly_idx&&p.week_day==period.week_day&&p.is_user_period}))&&this.m_total_dungeon_list[i].weekly_period.splice(found,1),this.m_total_dungeon_list[i].weekly_period.unshift(period),this.m_total_dungeon_list[i].weekly_period.sort(function(l,r){return l.begin_date.valueOf()>r.begin_date.valueOf()?1:l.begin_date.valueOf()<r.begin_date.valueOf()?-1:0})}for(i=0;i<this.m_week_day_dungeon_list.length;i++){var found;if(this.m_week_day_dungeon_list[i].weekly_idx==res.weekly_idx)-1!=(found=this.m_week_day_dungeon_list[i].weekly_period.findIndex(function(p){return p.weekly_idx==period.weekly_idx&&p.week_day==period.week_day&&p.is_user_period}))&&this.m_week_day_dungeon_list[i].weekly_period.splice(found,1),this.m_week_day_dungeon_list[i].weekly_period.unshift(period),this.m_week_day_dungeon_list[i].weekly_period.sort(function(l,r){return l.begin_date.valueOf()>r.begin_date.valueOf()?1:l.begin_date.valueOf()<r.begin_date.valueOf()?-1:0})}var offset=this.m_tableView.getContentOffset();this.m_tableView.reloadData(),this.m_tableView.setContentOffset(offset),this.updateStartBtnInfo()},getSelectedDungeon:function(){for(var idx=0;idx<this.m_week_day_dungeon_list.length;idx++)if(this.m_week_day_dungeon_list[idx].is_selected)return this.m_week_day_dungeon_list[idx];return this.m_week_day_dungeon_list[0]},updateStartBtnInfo:function(){var dungeon=this.getSelectedDungeon();this.getSelectedDifficulty();if(this.IsEnableDungeonOpenTime()){this.m_jade_btn_open=!1,this.m_start_jade_btn.setEnabled(!0),this.m_start_key_btn.setVisible(!0),this.m_start_jade_btn.setVisible(!1);var need_key=this.checkWeeklyNeedKey();this.m_need_key.setString(need_key)}else{this.m_start_key_btn.setVisible(!1),1==this.m_jade_btn_open&&this.m_start_jade_btn.setEnabled(!1),this.m_start_jade_btn.setVisible(!0),this.m_need_jade.setString(dungeon.weekly_dungeon.cost);var open_time=(dungeon.weekly_dungeon.open_time/60).toFixed(0);this.m_start_jade_btn.setString(""+open_time+"")}},checkWeeklyNeedKey:function(){var need_key=0,dungeon=this.getSelectedDungeon(),difficulty=this.getSelectedDifficulty(),is_expense_dec=!1,nn=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),list_Global_Booster_Event_V2=NetService().get_Global_Booster_Event();for(var idx in list_Global_Booster_Event_V2){var b=list_Global_Booster_Event_V2[idx],bt=moment(b.begin_dt),et=moment(b.end_dt),bb=bt.valueOf(),ee=et.valueOf();if(bb<=nn&&nn<=ee&&b.booster_type==BOOSTER_TYPE_V2_WEEKLY_DUNGEON&&b.variation_type==BOOSTER_VARIATION_TYPE_V2_EXPENSE_DEC&&b.item_type==BOOSTER_ITEM_TYPE_V2_ENTRANCE_TICKET){if(0==b.value_1){need_key=difficulty.weekly_difficulty.need_key-difficulty.weekly_difficulty.need_key*b.variation_value/100,is_expense_dec=!0;break}if(b.value_1==dungeon.weekly_idx){need_key=difficulty.weekly_difficulty.need_key-difficulty.weekly_difficulty.need_key*b.variation_value/100,is_expense_dec=!0;break}}}return is_expense_dec&&(need_key=Math.max(need_key,1)),0==need_key&&(need_key=difficulty.weekly_difficulty.need_key),need_key},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;(cell=null!=c?c:new WeeklyEntryListCell).unSelected();var data=this.m_week_day_dungeon_list[idx];return cell.setData(this.m_choice_week_day+1,data),cell},numberOfCellsInTableView:function(table){return this.m_week_day_dungeon_list.length},getSelectedDifficulty:function(){for(var idx=0;idx<this.m_week_day_dungeon_list.length;idx++)if(this.m_week_day_dungeon_list[idx].is_selected)for(var jdx=0;jdx<this.m_week_day_dungeon_list[idx].weekly_difficulty.length;jdx++)if(this.m_week_day_dungeon_list[idx].weekly_difficulty[jdx].is_selected)return this.m_week_day_dungeon_list[idx].weekly_difficulty[jdx];return this.m_week_day_dungeon_list[0].weekly_difficulty[0]},update:function(dt){if(this.m_update_min_delta-=dt,this.m_update_min_delta<0){this.m_update_min_delta=UPDATE_INTERVAL_TIME,this.checkUserOpenDungeonTime()&&(this.getUpdateDungeonList(),this.choiceDifficultyType(this.m_choice_difficulty_type),this.updateRightInfo());var offset=this.m_tableView.getContentOffset();this.m_tableView.reloadData(),this.m_tableView.setContentOffset(offset),this.updateStartBtnInfo()}},getChoiceWeekDay:function(){return this.m_choice_week_day},getChoiceDifficultyType:function(){return this.m_choice_difficulty_type},getChoiceStageCount:function(){return this.m_choice_stage_count},cellSizeForTable:function(table){return cc.size(130,140)},choiceStage:function(stage_count){for(var idx=stage_count,diff=parseInt(this.m_choice_difficulty_type/2)+1,is_twice=0<this.m_choice_difficulty_type%2?"y":"n",index=0,i=0;i<this.m_week_day_dungeon_list.size();i++){if(this.m_week_day_dungeon_list.at(i).is_selected=idx==index,this.m_week_day_dungeon_list.at(i).is_selected)for(var j=0;j<this.m_week_day_dungeon_list.at(i).weekly_difficulty.length;j++)this.m_week_day_dungeon_list.at(i).weekly_difficulty[j].weekly_difficulty.difficulty_type==diff&&this.m_week_day_dungeon_list.at(i).weekly_difficulty[j].weekly_difficulty.two_times_yn==is_twice?this.m_week_day_dungeon_list.at(i).weekly_difficulty[j].is_selected=!0:this.m_week_day_dungeon_list.at(i).weekly_difficulty[j].is_selected=!1;index++}this.m_tableView.reloadData();var offset=this.m_tableView.getContentOffset(),cSize=this.m_tableView.getContainer().getContentSize(),tSize=this.m_tableView.getViewSize(),cellSize=this.cellSizeForTable(this.m_tableView),min_offset_y=tSize.height-cSize.height,cell_height=idx*cellSize.height;offset.y=min_offset_y+cell_height,offset.y<min_offset_y?offset.y=min_offset_y:0<offset.y&&(offset.y=0),this.m_tableView.setContentOffset(offset)},showMissionTaskModalLayer:function(){this.m_mission_task_modal_layer._contentNode=function(contentSize,m){var taskList=this.getSelectedDifficulty().task_list,layer=new MissionTaskPopup(taskList,eDungeonTaskType.weekly_dungeon);return layer._callback_close_popup=this.hideMissionTaskModalLayer.bind(this),layer}.bind(this),this.m_mission_task_modal_layer.is_show()||this.m_mission_task_modal_layer.show()},hideMissionTaskModalLayer:function(){this.m_mission_task_modal_layer.is_show()&&this.m_mission_task_modal_layer.hide()}}),WeeklyEntryListCell=cc.TableViewCell.extend({m_bg_box:null,m_bg_box_list:null,m_select_box:null,m_highlight:null,m_remain_time:null,m_gauge_bg:null,m_gauge:null,m_dungeon_name:null,m_dungeon_open_comment:null,m_disable_dim_cover:null,m_disable_cover:null,m_week_day:0,ctor:function(){this._super(),this.init()},init:function(){var cellSize=cc.size(476,140);return this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(cellSize),USE_SP_WEEKLY_SCALE?(this.m_bg_box=cc.Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal_3.png"),this.m_bg_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_bg_box.setPosition(ZERO()),this.m_bg_box.setContentSize(476,140),this.addChild(this.m_bg_box),this.m_bg_box_list=cc.Sprite.create("#img_vs_day_list_01.png"),this.m_bg_box_list.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_bg_box_list.setPosition(ZERO()),this.m_bg_box_list.setScale(2),this.m_bg_box.addChild(this.m_bg_box_list)):(this.m_bg_box=cc.Sprite.create("#img_vs_day_list_01.png"),this.m_bg_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_bg_box.setPosition(ZERO()),this.addChild(this.m_bg_box)),this.m_dungeon_name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2615),this.m_dungeon_name.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_dungeon_name.setPosition(cellSize.width-10,30),this.m_bg_box.addChild(this.m_dungeon_name),this.m_dungeon_open_comment=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.m_dungeon_open_comment.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_dungeon_open_comment.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM),this.m_dungeon_open_comment.setPosition(cellSize.width-10,59),this.m_bg_box.addChild(this.m_dungeon_open_comment),this.m_gauge_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",cc.rect(4,4,4,4)),this.m_gauge_bg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_gauge_bg.setPosition(.5*cellSize.width,5),this.m_gauge_bg.setContentSize(cellSize.width-8,16),this.m_bg_box.addChild(this.m_gauge_bg),this.m_gauge=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green.png",RectZero()),this.m_gauge.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_gauge.setPosition(3,ccCenter(this.m_gauge_bg).y),this.m_gauge_bg.addChild(this.m_gauge),this.m_remain_time=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161,!1),this.m_remain_time.setAnchorPoint(ANCHOR_MIDDLE()),this.m_remain_time.setPosition(ccCenter(this.m_gauge_bg)),this.m_remain_time.enableOutline(cc.color.BLACK,1),this.m_gauge_bg.addChild(this.m_remain_time),this.m_disable_dim_cover=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero()),this.m_disable_dim_cover.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_disable_dim_cover.setPosition(ZERO()),this.m_disable_dim_cover.setPreferredSize(cellSize),this.addChild(this.m_disable_dim_cover),this.m_disable_dim_cover.setVisible(!1),this.m_disable_cover=cc.Sprite.create(RES_CDN_DEFULT+"common/img_list_lock.png"),IS_SP_BROWSER&&this.m_disable_cover.setScale(2),this.m_disable_cover.setAnchorPoint(ANCHOR_MIDDLE()),this.m_disable_cover.setPosition(ccCenter(this.m_disable_dim_cover)),this.m_disable_dim_cover.addChild(this.m_disable_cover),this.m_highlight=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_1.png",cc.Rect(20,20,20,20)),this.m_highlight.setAnchorPoint(ANCHOR_MIDDLE()),this.m_highlight.setPosition(ccCenter(cellSize)),this.m_highlight.setPreferredSize(cellSize),this.m_highlight.setVisible(!1),this.addChild(this.m_highlight),this.m_select_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_2.png",cc.Rect(20,20,20,20)),this.m_select_box.setAnchorPoint(ANCHOR_MIDDLE()),this.m_select_box.setPosition(ccCenter(cellSize)),this.m_select_box.setPreferredSize(cellSize),this.m_select_box.setVisible(!1),this.addChild(this.m_select_box),!0},unSelected:function(){this.m_select_box.setVisible(!1),this.m_highlight.setVisible(!1)},selectedAnimation:function(){this.m_select_box.isRunning()&&this.m_select_box.stopAllActions();var fadeout=new cc.FadeOut(1),fadein=new cc.FadeIn(1),seq=new cc.Sequence(fadeout,fadein),repeat=new cc.RepeatForever(seq);this.m_select_box.runAction(repeat)},updateCell:function(){var frame1=cc.spriteFrameCache.getSpriteFrame("img_vs_day_list_"+leadingZeros(this.m_data.weekly_dungeon.img_num,2)+".png");USE_SP_WEEKLY_SCALE?this.m_bg_box_list.setSpriteFrame(frame1):this.m_bg_box.setSpriteFrame(frame1),this.m_dungeon_name.setString(this.m_data.weekly_dungeon.name);for(var open_info="",count=0,i=0;i<this.m_data.weekly_period.length;i++){null!=(p=this.m_data.weekly_period[i])&&(p.week_day!=this.m_week_day&&8!=p.week_day||(0<count&&(open_info+="\n"),open_info+="["+leadingZeros(moment(p.begin_date).get("hour"),2)+":"+leadingZeros(moment(p.begin_date).get("minute"),2)+"~"+leadingZeros(moment(p.end_date).get("hour"),2)+":"+leadingZeros(moment(p.end_date).get("minute"),2)+"]",count++))}this.m_dungeon_open_comment.setString(open_info),this.m_select_box.setVisible(this.m_data.is_selected),this.m_data.is_selected&&this.selectedAnimation(),this.m_highlight.setVisible(this.m_data.is_selected),this.m_remain_time.setString(""),this.m_data.is_enable=!1;for(var idx=this.m_data.weekly_period.length-1;0<=idx;idx--){var p;if(null!=(p=this.m_data.weekly_period[idx])&&(p.week_day==this.m_week_day||8==p.week_day)){var n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),b=p.begin_date.valueOf(),e=p.end_date.valueOf(),is_next_week=!1;if(e<n&&(b+=6048e5,e+=6048e5,is_next_week=!0),p.is_user_period,b-1e3*(p.is_user_period?5:1)<=n){if(n<=e+1){this.m_data.is_enable=!0;var diff=e-n;0<(d=moment.duration(diff)).days()?this.m_remain_time.setString("    "+leadingZeros(d.days(),2)+" "+leadingZeros(d.hours(),2)+":"+leadingZeros(d.minutes(),2)):0<d.hours()||0<d.minutes()?this.m_remain_time.setString("    "+leadingZeros(d.hours(),2)+":"+leadingZeros(d.minutes(),2)):this.m_remain_time.setString("    "+leadingZeros(d.seconds(),2)+"");var per=1-(n-b)/(e-b),gauge_size=ccSize(this.m_gauge_bg);this.m_gauge.setVisible(!0),this.m_gauge.setPreferredSize(cc.size((gauge_size.width-6)*per,10));break}}else{this.m_data.is_enable=!1;var d;diff=b-n;if(0<(d=moment.duration(diff)).days()?this.m_remain_time.setString("    "+leadingZeros(d.days(),2)+" "+leadingZeros(d.hours(),2)+":"+leadingZeros(d.minutes(),2)+"  "):0<d.hours()||0<d.minutes()?this.m_remain_time.setString("    "+leadingZeros(d.hours(),2)+":"+leadingZeros(d.minutes(),2)+"  "):this.m_remain_time.setString("    "+leadingZeros(d.seconds(),2)+""),this.m_gauge.setVisible(!1),!is_next_week)continue}}}this.m_disable_dim_cover.setVisible(!this.m_data.is_enable)},setData:function(week_day,data){this.m_data=data,this.m_week_day=week_day,this.updateCell()}}),PREV_MISSION=(weekly_dungeon_begin=89100,!1),PREV_ACHIVE_WEEKLY=!1,PREV_HELP_WEEKLY=!1,WeeklyEntryScene=GameScene.extend({m_deferred:$.Deferred(),m_resource:[],m_progres_bar_weekly:null,ctor:function(){this._super(scene_WeeklyEntryScene),PREV_HELP_WEEKLY=PREV_ACHIVE_WEEKLY=!1},get_story_deferred:function(){return this.m_deferred},removeLayerProgress_Raid:function(){null!=this.m_progres_bar_weekly&&(this.removeChild(this.m_progres_bar_weekly),this.m_progres_bar_weekly=null)},initLayoutProgress_Raid:function(alpha){if(!IS_NET_ERROR){this.m_progres_bar_weekly=new cc.LayerColor(cc.color.BLACK),this.m_progres_bar_weekly.setOpacity(alpha),this.m_progres_bar_weekly.setContentSize(ccSize(this));var bg=cc.Sprite.create(RES_CM+"img_progress_bg.png");bg.setPosition(ccCenter(this));var bar=cc.Sprite.create(RES_CM+"img_progress_arrow.png");bar.setPosition(ccCenter(bg)),bg.addChild(bar,1000001),this.m_progres_bar_weekly.addChild(bg),this.addChild(this.m_progres_bar_weekly,1000001);var loading=new cc.Sprite(res.s_cm_img_text_loading);loading.setAnchorPoint(.5,0),loading.setPosition(ccCenter(bg).x,ccCenter(bg).y-100),loading.setOpacity(255),bg.addChild(loading,1000001);var mu=new cc.RotateBy(.1,30),seq=new cc.Sequence(mu),repeat=new cc.RepeatForever(seq);bar.runAction(repeat);var listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE});listener.onTouchBegan=function(touch,event){event.stopPropagation()}.bind(this),cc.eventManager.addListener(listener,this.m_progres_bar_weekly)}},init:function(){this.m_gameObserver=MainObserver.getInstance(),this.m_resource=[],this.m_resource.push(RES_CDN_DEFULT+"menu_vs/"+MENU_VS_WEEKLY_ENTER_TEXTURE+".plist"),this.m_resource.push(RES_CDN_DEFULT+"menu_vs/"+MENU_VS_WEEKLY_ENTER_TEXTURE+".png"),this.m_resource.push(RES_CDN_DEFULT+"common/bg_sub.png"),this.m_resource.push(RES_CDN_DEFULT+"common/img_circle.png"),this.m_resource.push(RES_CDN_DEFULT+"common/img_line.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_on.png"),USE_SP_WEEKLY_SCALE?(this.m_resource.push(RES_CDN_DEFULT+"menu_vs/menu_vs_day_list_sp.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_vs/menu_vs_day_list_sp.plist")):(this.m_resource.push(RES_CDN_DEFULT+"menu_vs/menu_vs_day_list.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_vs/menu_vs_day_list.plist")),resourceLoader(this.m_resource,function(){cc.spriteFrameCache.addSpriteFrames(RES_CDN_DEFULT+"menu_vs/"+MENU_VS_WEEKLY_ENTER_TEXTURE+".plist"),USE_SP_WEEKLY_SCALE?cc.spriteFrameCache.addSpriteFrames(RES_CDN_DEFULT+"menu_vs/menu_vs_day_list_sp.plist"):cc.spriteFrameCache.addSpriteFrames(RES_CDN_DEFULT+"menu_vs/menu_vs_day_list.plist");var winSize=ccSize(this);this.m_entry_layer=new WeeklyEntryLayer(this.m_deferred,GameContext.getInstance().getChoiceWeekDayIdx(),GameContext.getInstance().getChoiceDifficultyType(),GameContext.getInstance().getChoiceStageCount()),this.m_entry_layer.setPosition(ccCenter(winSize)),this.addChild(this.m_entry_layer);var statusLayer=new StatusLayer(INVOKER_TYPE.normal);statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer);var back_btn=new ccui.Button;back_btn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png",""),back_btn.setAnchorPoint(cc.p(0,0)),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(){this.back()}.bind(this)),this.addChild(back_btn);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_day.png");return title.setAnchorPoint(cc.p(0,0)),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title),!0}.bind(this))},back:function(){1==YUNHEE_PREV_SCENE?this.onKeyBack3():this.onKeyBack(!0,!1)},onNotification:function(msg){switch(this._super(msg),msg){case weekly_dungeon_show_help_v2:GameContext.getInstance().setHelpInfoIndexByCallIndex(1);var scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),PREV_HELP_WEEKLY=!(scene=null);break;case weekly_dungeon_open:(req={}).opcode=net.OP.op_get_server_time_check,this.network_write(req),this.scheduleOnce(function(float){this.reqWeeklyDungeonOpen()}.bind(this),.1,"weekly_Open");break;case jade_lack:this.showNotEnoughJade(!0);break;case weekly_dungeon_begin:var req;this.initLayoutProgress_weekly(),(req={}).opcode=net.OP.op_get_server_time_check,this.network_write(req),this.scheduleOnce(function(float){GameContext.getInstance().setChoiceWeekDayInfo(this.m_entry_layer.getChoiceWeekDay(),this.m_entry_layer.getChoiceDifficultyType(),this.m_entry_layer.getChoiceStageCount());var scene=new FriendSelectScene;SceneManager.getInstance().replaceScene(scene),this.removeLayerProgress_weekly(),scene=null}.bind(this),.1,"weekly_begin")}return!0},onNetworkEvent:function(opcode,state,body){if(this._super(opcode,state,body),opcode==net.OP.op_weekly_dungeon_open&&(this.removeLayerProgress_weekly(),body.error==net.ERROR.NET_E_LACK_JADE?(this.m_entry_layer.m_jade_btn_open=!1,this.showNotEnoughJade()):this.scheduleOnce(function(float){this.m_entry_layer.setWeeklyDungeonOpen(body)},.1,"dungeon_refresh")),opcode==net.OP.op_mission_battle_friend_list){BattleContext._getInstance().setFriendList(body.frnd_list);var scene=new FriendSelectScene;SceneManager.getInstance().replaceScene(scene),scene=null}},reqWeeklyDungeonOpen:function(){this.initLayoutProgress_weekly();var weekly=this.m_entry_layer.getWeeklyDungeonOpenInfo(0,0,0),register={};register.opcode=net.OP.op_weekly_dungeon_open,register.weekly_idx=weekly.idx,register.week_type=weekly.type,register.open_time=weekly.time,this.network_write(register)},onExit:function(){this._super(),1!=PREV_MISSION&&(1!=WEEKLY_DUNGEON_NOW?1!=PREV_ACHIVE_WEEKLY&&1!=PREV_HELP_WEEKLY&&(this.m_gameObserver.removeObserver(sceneStr[scene_WeeklyEntryScene]),cc.spriteFrameCache.removeSpriteFramesFromFile(RES_CDN_DEFULT+"menu_vs/"+MENU_VS_WEEKLY_ENTER_TEXTURE+".plist"),delete cc.spriteFrameCache._frameConfigCache[RES_CDN_DEFULT+"menu_vs/"+MENU_VS_WEEKLY_ENTER_TEXTURE+".plist"],USE_SP_WEEKLY_SCALE?(cc.spriteFrameCache.removeSpriteFramesFromFile(RES_CDN_DEFULT+"menu_vs/menu_vs_day_list_sp.plist"),delete cc.spriteFrameCache._frameConfigCache[RES_CDN_DEFULT+"menu_vs/menu_vs_day_list_sp.plist"]):(cc.spriteFrameCache.removeSpriteFramesFromFile(RES_CDN_DEFULT+"menu_vs/menu_vs_day_list.plist"),delete cc.spriteFrameCache._frameConfigCache[RES_CDN_DEFULT+"menu_vs/menu_vs_day_list.plist"]),null!=this.m_resource&&(this.m_resource.forEach(function(url){cc.loader.release(url)}),this.m_resource=null)):WEEKLY_DUNGEON_NOW=!1)},onEnter:function(){this._super(),this.playMainBGM(),this.m_gameObserver.addObserver(this.onNotification,this,sceneStr[scene_WeeklyEntryScene]),PREV_HELP_WEEKLY=PREV_ACHIVE_WEEKLY=!1}}),WeeklyTaskNode=cc.Node.extend({m_task:null,ctor:function(task){this._super(),this.m_task=task,this.init()},init:function(){return this.setContentSize(444,78),this.createTask(),!0},createTask:function(){var size=ccSize(this),box=new cc.Scale9Sprite(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",cc.Rect(16,16,16,16));box.setPosition(ZERO()),box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box.setPreferredSize(size),this.addChild(box);var task_title=cmLabel.getLabel(this.m_task.task_define.name,LABEL_FONT_INDEX.FONT_2013);task_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),task_title.setPosition(58,43),this.addChild(task_title);var content="";if(this.m_task.task_define.task_type==TaskActionType.Mission_Clear_Count){var clear_count=this.m_task.clear_count;clear_count>this.m_task.task_define.value1&&(clear_count=this.m_task.task_define.value1),content=cmString(res_str("label_battle_task_content_win_count"),this.m_task.task_define.content,clear_count,this.m_task.task_define.value1)}else content=this.m_task.task_define.content;var task_content=cmLabel.getLabel(content,LABEL_FONT_INDEX.FONT_161);task_content.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),task_content.setPosition(58,16),this.addChild(task_content);var icon_box=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");icon_box.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),icon_box.setPosition(size.width-4,.5*size.height),this.addChild(icon_box);var icon_name="";if(this.m_task.task.bonus_type==BONUS_TYPE_LOVE_ITEM)icon_name="#img_reward_love_item_"+leadingZeros(this.m_task.min_value,2)+".png";else if(this.m_task.task.bonus_type==BONUS_TYPE_YUNHEE_FIX||this.m_task.task.bonus_type==BONUS_TYPE_JIN_FIX){var gnrl=MasterManager.getInstance().get_General(this.m_task.task.min_value);icon_name=gnrl.gnrl_type==GENERAL_TYPE_MATERIAL||gnrl.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL?"#"+gnrl.bone_id+".png":"#"+gnrl.gnrl_id+".png"}else icon_name=this.m_task.task.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||this.m_task.task.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT?"#img_reward_yh.png":"#img_reward_"+leadingZeros(this.m_task.task.bonus_type,2)+".png";if(""!=icon_name){var reward_icon=cc.Sprite.create(icon_name);reward_icon.setAnchorPoint(ANCHOR_MIDDLE()),reward_icon.setPosition(ccCenter(icon_box)),icon_box.addChild(reward_icon);var count_bg=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_valuebox.png");count_bg.setAnchorPoint(ANCHOR_MIDDLE()),count_bg.setPosition(.5*ccWidth(reward_icon),2),reward_icon.addChild(count_bg);var count=0;count=this.m_task.task.bonus_type==BONUS_TYPE_LOVE_ITEM?1:this.m_task.task.bonus_type==BONUS_TYPE_YUNHEE_FIX||this.m_task.task.bonus_type==BONUS_TYPE_JIN_FIX?1:this.m_task.task.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||this.m_task.task.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT?1:this.m_task.task.min_value;var reward_count=cmLabel.getLabel("x"+Number(count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_143);reward_count.setAnchorPoint(ANCHOR_MIDDLE()),reward_count.setPosition(ccCenter(count_bg)),count_bg.addChild(reward_count)}if(this.m_task.is_complete){var cover=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",cc.Rect(1,1,1,1));cover.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),cover.setPosition(ZERO()),cover.setPreferredSize(size),this.addChild(cover),(flower=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_on.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),flower.setPosition(14,39),this.addChild(flower);var complete=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_complete.png");complete.setAnchorPoint(ANCHOR_MIDDLE()),complete.setPosition(ccCenter(size)),IS_SP_BROWSER&&complete.setScale(2),this.addChild(complete)}else{var flower;(flower=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_3_off.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),flower.setPosition(14,39),this.addChild(flower)}}}),StoryHardModeFootBoardNode=cc.Layer.extend({m_foot_board_btn:null,m_mission_name:null,m_lotus_icon:null,m_jade_charge_btn:null,m_jade_need_count:null,m_jade_charge_count:null,m_key_box:null,m_key_need_count:null,m_daily_try_count:null,m_focus_skeleton:null,m_skeleton_node:null,m_skeleton_list:[],m_boss_list:[],m_normal_img:null,m_press_img:null,m_disable_img:null,m_charge_try_count_callback:null,m_round_box:null,m_mission_data:null,sd_img:[],gnrl_img:[],m_boss_gnrl_id:0,m_scene:null,ctor:function(callback,target){this._super(),this.m_foot_board_btn=null,this.m_mission_name=null,this.m_lotus_icon=null,this.m_jade_charge_btn=null,this.m_jade_need_count=null,this.m_jade_charge_count=null,this.m_key_box=null,this.m_key_need_count=null,this.m_daily_try_count=null,this.m_focus_skeleton=null,this.m_skeleton_node=null,this.m_skeleton_list=[],this.m_boss_list=[],this.m_normal_img=null,this.m_press_img=null,this.m_disable_img=null,this.m_charge_try_count_callback=callback.bind(target),this.m_mission_data=null,this.sd_img=[],this.gnrl_img=[],this.m_boss_gnrl_id=0,this.m_scene=target.m_scene,this.init()},init:function(){this.m_foot_board_btn=new ccui.Button(RES_CDN_DEFULT+"new_menu_quest/img_story_hard_off.png",RES_CDN_DEFULT+"new_menu_quest/img_story_hard_on.png",""),this.m_foot_board_btn.setAnchorPoint(ANCHOR_MIDDLE()),this.m_foot_board_btn.setPosition(ZERO()),IS_SP_BROWSER&&this.m_foot_board_btn.setScale(2),this.addChild(this.m_foot_board_btn),this.m_foot_board_btn.addClickEventListener(function(){this.clickFootBoard()}.bind(this));var btnSize=ccSize(this.m_foot_board_btn);this.setContentSize(btnSize),this.setAnchorPoint(ANCHOR_MIDDLE()),this.m_round_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_txtbox_4.png",RectZero()),this.m_round_box.setAnchorPoint(ANCHOR_MIDDLE()),this.m_round_box.setContentSize(80,35),this.m_round_box.setPosition(0,-21),this.addChild(this.m_round_box);var lotus_icon_bg=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_quest/img_story_hard_star_none.png");lotus_icon_bg.setAnchorPoint(ANCHOR_MIDDLE()),lotus_icon_bg.setPosition(0,ccCenter(this.m_round_box).y),this.m_round_box.addChild(lotus_icon_bg),this.m_lotus_icon=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_quest/img_story_hard_star_none.png"),this.m_lotus_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_lotus_icon.setPosition(0,ccCenter(this.m_round_box).y),IS_SP_BROWSER&&this.m_lotus_icon.setScale(2),this.m_round_box.addChild(this.m_lotus_icon),this.m_mission_name=cmLabelEx.getLabel("",LABEL_FONT_INDEX.FONT_1871,!1,!0,2,cc.color.BLACK),this.m_mission_name.setAnchorPoint(ANCHOR_MIDDLE()),this.m_mission_name.setPosition(ccCenter(this.m_round_box)),this.m_round_box.addChild(this.m_mission_name),this.m_jade_charge_btn=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_9_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_9_on.png",""),this.m_jade_charge_btn.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_jade_charge_btn.setScale9Enabled(!0),this.m_jade_charge_btn.setCapInsets(cc.Rect(15,15,15,2)),this.m_jade_charge_btn.setContentSize(176,42),this.m_jade_charge_btn.setPosition(0,-38),this.addChild(this.m_jade_charge_btn),this.m_jade_charge_btn.addClickEventListener(function(){this.clickChargeJadeTryCount()}.bind(this)),this.m_jade_charge_count=cmLabelEx.getLabel("0/3",LABEL_FONT_INDEX.FONT_1877,!1,!0,2,cc.color.WHITE),this.m_jade_charge_count.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_jade_charge_count.setPosition(ccWidth(this.m_jade_charge_btn)-15,.5*ccHeight(this.m_jade_charge_btn)),this.m_jade_charge_btn.addChild(this.m_jade_charge_count);var jade_icon_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_txtbox_6.png",RectZero());jade_icon_box.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),jade_icon_box.setContentSize(52,28),jade_icon_box.setPosition(28,.5*ccHeight(this.m_jade_charge_btn)),this.m_jade_charge_btn.addChild(jade_icon_box);var jade_icon=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_jade.png");jade_icon.setAnchorPoint(ANCHOR_MIDDLE()),jade_icon.setPosition(-2,.5*ccHeight(jade_icon_box)),jade_icon_box.addChild(jade_icon),this.m_jade_need_count=cmLabelEx.getLabel("10",LABEL_FONT_INDEX.FONT_1875,!1,!0,2,cc.color.BLACK),this.m_jade_need_count.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_jade_need_count.setPosition(ccWidth(jade_icon_box)-10,.5*ccHeight(jade_icon_box)),jade_icon_box.addChild(this.m_jade_need_count),this.m_key_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_common/img_9p_txtbox_4.png",RectZero()),this.m_key_box.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_key_box.setPosition(0,-38),this.m_key_box.setContentSize(158,35),this.addChild(this.m_key_box);var key_icon=cc.Sprite.create(RES_CDN_DEFULT+"new_common/img_ic_key.png");return key_icon.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),key_icon.setPosition(14,.5*ccHeight(this.m_key_box)),this.m_key_box.addChild(key_icon),this.m_key_need_count=cmLabelEx.getLabel("20",LABEL_FONT_INDEX.FONT_1871,!1,!0,2,cc.color.BLACK),this.m_key_need_count.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_key_need_count.setPosition(36,.5*ccHeight(this.m_key_box)),this.m_key_box.addChild(this.m_key_need_count),this.m_daily_try_count=cmLabelEx.getLabel("0/3",LABEL_FONT_INDEX.FONT_1871,!1,!0,2,cc.color.BLACK),this.m_daily_try_count.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_daily_try_count.setPosition(ccWidth(this.m_key_box)-13,.5*ccHeight(this.m_key_box)),this.m_key_box.addChild(this.m_daily_try_count),!0},setStoryHardModeMissionData:function(mission){this.m_mission_data=mission,this.updateFootBoard()},updateBtn:function(){0==this.m_mission_data.mission.npc_mark?this.m_normal_img!=RES_CDN_DEFULT+"new_menu_quest/img_story_hard_off.png"&&(this.m_normal_img=RES_CDN_DEFULT+"new_menu_quest/img_story_hard_off.png",this.m_press_img=RES_CDN_DEFULT+"new_menu_quest/img_story_hard_on.png",this.m_disable_img=RES_CDN_DEFULT+"new_menu_quest/img_story_hard_off.png",this.m_foot_board_btn.loadTextureNormal(this.m_normal_img),this.m_foot_board_btn.loadTexturePressed(this.m_press_img),this.m_foot_board_btn.loadTextureDisabled(this.m_disable_img)):(this.m_normal_img!=RES_CDN_DEFULT+"new_menu_quest/img_story_hard_boss_off.png"&&(this.m_normal_img=RES_CDN_DEFULT+"new_menu_quest/img_story_hard_boss_off.png",this.m_press_img=RES_CDN_DEFULT+"new_menu_quest/img_story_hard_boss_on.png",this.m_disable_img=RES_CDN_DEFULT+"new_menu_quest/img_story_hard_boss_off.png",this.m_foot_board_btn.loadTextureNormal(this.m_normal_img),this.m_foot_board_btn.loadTexturePressed(this.m_press_img),this.m_foot_board_btn.loadTextureDisabled(this.m_disable_img)),this.m_mission_data.is_new||this.createBoss(this.m_mission_data.is_complete)),null!=this.m_foot_board_btn&&this.m_foot_board_btn.setEnabled(this.m_mission_data.is_complete||this.m_mission_data.is_new)},updateFootBoard:function(){MasterTable.getInstance();if(null!=this.m_skeleton_node&&this.m_skeleton_node.setVisible(!1),this.hideSkeletonBoss(),this.hideSpriteBoss(),this.setPosition(this.m_mission_data.mission.x,this.m_mission_data.mission.y),this.updateBtn(),this.m_mission_data.is_complete||this.m_mission_data.is_new){this.m_round_box.setVisible(!0);for(var complete_task_count=0,i=0;i<this.m_mission_data.task_list.length;i++)this.m_mission_data.task_list[i].is_cleared&&(complete_task_count+=1);3==complete_task_count?this.m_lotus_icon.setTexture(RES_CDN_DEFULT+"new_menu_quest/img_story_star_on_2.png"):this.m_lotus_icon.setTexture(RES_CDN_DEFULT+"new_menu_quest/img_story_hard_star_none.png"),this.m_mission_name.setString(cmString(res_str("label_story_stage"),this.m_mission_data.mission.mission_num)),this.m_key_need_count.setString(this.m_mission_data.mission.need_key);var remain_try_count=this.m_mission_data.mission.daily_try_max_count-this.m_mission_data.try_count;if(0==remain_try_count?this.m_daily_try_count.setColor(cc.color.RED):this.m_daily_try_count.setColor(cc.color.WHITE),this.m_daily_try_count.setString(cmString(res_str("story_hard_enter_count"),remain_try_count,this.m_mission_data.mission.daily_try_max_count)),this.m_jade_charge_count.setString(cmString(res_str("story_hard_enter_count"),remain_try_count,this.m_mission_data.mission.daily_try_max_count)),this.m_mission_data.is_complete||this.m_mission_data.is_new)if(0==remain_try_count){var is_enable_charge=!0;if(0==this.m_mission_data.mission.enter_charge_group_idx)is_enable_charge=!1;else if(100==this.m_mission_data.mission.enter_charge_group_idx)this.m_jade_need_count.setString(this.m_mission_data.charge_info[0].need_count);else if(this.m_mission_data.charge_count<this.m_mission_data.mission.enter_charge_count){var next_charge_count=this.m_mission_data.charge_count+1,found=this.m_mission_data.charge_info.findIndex(function(info){return info.charge_count==next_charge_count}.bind(this));if(-1!=found){var charge_info=this.m_mission_data.charge_info[found];this.m_jade_need_count.setString(charge_info.need_count)}}else is_enable_charge=!1;is_enable_charge?(this.m_jade_charge_btn.setVisible(!0),this.m_key_box.setVisible(!1)):(this.m_jade_charge_btn.setVisible(!1),this.m_key_box.setVisible(!0))}else this.m_jade_charge_btn.setVisible(!1),this.m_key_box.setVisible(!0);else this.m_jade_charge_btn.setVisible(!1),this.m_key_box.setVisible(!0)}else this.m_jade_charge_btn.setVisible(!1),this.m_key_box.setVisible(!1),this.m_round_box.setVisible(!1);this.m_mission_data.is_new&&this.createPartner(),this.showBtnFocusEffect(this.m_mission_data.is_new)},clickFootBoard:function(){BattleContext._getInstance().setStoryHardModeMissionId(this.m_mission_data.mission.main_story_hard_mode_mission_idx),MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_hard_mode_mission_preview_show)},clickChargeJadeTryCount:function(){null!=this.m_charge_try_count_callback&&this.m_charge_try_count_callback(this.m_mission_data)},createBoss:function(is_complete){var m=MasterManager.getInstance();this.m_boss_gnrl_id=0;for(var npc_list=this.m_mission_data.stage_npc[3],i=0;i<npc_list.length;i++)if(npc_list[i].is_zoom){var boss_general=npc_list[i],npc=m.get_NpcGeneral(boss_general.npc_id);m.get_General(npc.gnrl_id);this.m_boss_gnrl_id=npc.gnrl_id;break}if(is_complete){var found_boss=!1;for(var idx in this.m_boss_list)if(idx==this.m_boss_gnrl_id){found_boss=!0,this.m_boss_list[idx].setVisible(!0);break}if(!found_boss){(boss=cc.Sprite.create(RES_CDN_DEFULT+"menu_boss/"+this.m_boss_gnrl_id+".png")).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),boss.setPosition(ZERO()),this.addChild(boss),this.m_boss_list[this.m_boss_gnrl_id]=boss;var scaleTo_1=new cc.ScaleTo(1.2,1,1.03),scaleTo_2=new cc.ScaleTo(1.2,1,.97),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);boss.runAction(repeat)}}else{found_boss=!1;for(var idx in this.m_skeleton_list)if(idx==this.m_boss_gnrl_id){found_boss=!0,this.m_skeleton_list[idx].setVisible(!0);break}if(!found_boss){var gnrl=MasterManager.getInstance().get_General(this.m_boss_gnrl_id);if(IS_SP_BROWSER){var boss;(boss=cc.Sprite.create(RES_CDN_DEFULT+"menu_boss/"+this.m_boss_gnrl_id+".png")).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),boss.setPosition(ZERO(0)),this.addChild(boss),this.m_boss_list[this.m_boss_gnrl_id]=boss;scaleTo_1=new cc.ScaleTo(1.2,1,1.03),scaleTo_2=new cc.ScaleTo(1.2,1,.97),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);boss.runAction(repeat)}else{this.sd_img=[];var sd_list=SDGeneralName[gnrl.gnrl_group];for(idx=0;idx<sd_list.length;idx++)this.sd_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+sd_list[idx]+".png");this.sd_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+gnrl.skin_id+".atlas"),this.sd_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+gnrl.skin_id+".json"),resourceLoader(this.sd_img,this.loadBoss.bind(this))}}}},loadBoss:function(){var gnrl=MasterManager.getInstance().get_General(this.m_boss_gnrl_id),sd_atlas=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+gnrl.gnrl_id+".atlas",sd_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+gnrl.gnrl_id+".json",skeleton=new sp.SkeletonAnimation(sd_json,sd_atlas,.23);skeleton.setPosition(ZERO()),this.addChild(skeleton);try{skeleton.setSkin(gnrl.gnrl_class)}catch(e){}skeleton.setAnimation(0,"idle",!0),skeleton.setAnimation(1,"shadow_off",!0),skeleton._skeleton.data.findAnimation("loop")&&skeleton.setAnimation(1,"loop",!0),this.m_skeleton_list[this.m_boss_gnrl_id]=skeleton},createPartner:function(){if(null==this.m_skeleton_node){var m=MasterManager.getInstance(),partner_gnrl_id=GeneralService.getInstance().getUserTroopsPartnerId();if(0!=partner_gnrl_id){var partner_gnrl=new db.UserGeneralInfo,troops_partner=GameContext.getInstance().getUserGeneralPartner(),main_gnrl_key=new net.User_General_Key;main_gnrl_key.gnrl_id=troops_partner.gnrl_id,main_gnrl_key.gnrl_num=troops_partner.gnrl_num,GeneralService.getInstance().getUserGnrlDisplayClassInfo(main_gnrl_key,partner_gnrl);var partner_id=0;partner_id=partner_gnrl.class_type>=AVAIL_EVOLUTION_CLASS_TYPE_LIMIT&&0!=partner_gnrl.display_class&&partner_gnrl.class_type!=partner_gnrl.display_class?partner_gnrl.gnrl_id-1e3*(partner_gnrl.class_type-partner_gnrl.display_class):partner_gnrl.gnrl_id;var gnrl=m.get_General(partner_gnrl_id),skin_id=gnrl.bone_id!=gnrl.skin_id?partner_id:gnrl.skin_id;if(IS_SP_BROWSER)skin_id=gnrl.gnrl_group,this.gnrl_img=[],this.gnrl_img.push(RES_CDN_DEFULT+cmString("card_body_sp/%03d.png",skin_id)),resourceLoader(this.gnrl_img,function(){this.m_skeleton_node=cc.Sprite.create(RES_CDN_DEFULT+cmString("card_body_sp/%03d.png",skin_id)),this.m_skeleton_node.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_skeleton_node.setPosition(ZERO()),this.m_skeleton_node.setFlippedX(!0),this.m_skeleton_node.setScale(.7),this.addChild(this.m_skeleton_node);var scaleTo_1=new cc.ScaleTo(.6,.7,.72),scaleTo_2=new cc.ScaleTo(.6,.7,.68),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);this.m_skeleton_node.runAction(repeat),MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],already_tutorial)}.bind(this));else{this.gnrl_img=[];for(var sd_list=SDGeneralName[gnrl.gnrl_group],idx=0;idx<sd_list.length;idx++)this.gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+sd_list[idx]+".png");this.gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+skin_id+".atlas"),this.gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+skin_id+".json"),resourceLoader(this.gnrl_img,function(){var sd_atlas=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+skin_id+".atlas",sd_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+skin_id+".json";if(this.m_skeleton_node=new sp.SkeletonAnimation(sd_json,sd_atlas,.2),this.m_skeleton_node._skeleton.flipX=!0,this.m_skeleton_node.setPosition(ZERO()),this.m_skeleton_node.setEventListener(this.spineEventListener.bind(this)),this.addChild(this.m_skeleton_node),partner_id!=partner_gnrl_id)try{this.m_skeleton_node.setSkin(partner_gnrl.display_class)}catch(e){}else try{this.m_skeleton_node.setSkin(gnrl.gnrl_class)}catch(e){}this.m_skeleton_node.setAnimation(0,"run",!0),this.m_skeleton_node.setAnimation(1,"shadow_off",!0),MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],already_tutorial)}.bind(this))}}}null!=this.m_skeleton_node&&this.m_skeleton_node.setVisible(!0)},spineEventListener:function(entry,evt){var event_name=evt.data.name.toLowerCase();"loop_show"==event_name?this.m_skeleton_node.setAnimation(2,"loop",!0):"loop_hide"==event_name&&this.m_skeleton_node.setAnimation(2,"loop_off",!0)},showBtnFocusEffect:function(is_show){is_show&&null==this.m_focus_skeleton&&(this.m_focus_skeleton=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Story.json",RES_CDN_DEFULT+"effect/Story.atlas",1),this.m_focus_skeleton.setPosition(ZERO()),this.addChild(this.m_focus_skeleton),this.m_focus_skeleton.setAnimation(0,"fx_1",!0),this.m_focus_skeleton.setVisible(!1)),null!=this.m_focus_skeleton&&this.m_focus_skeleton.setVisible(is_show)},hideSkeletonBoss:function(){this.m_skeleton_list.forEach(function(s){null==s&&null==s||s.setVisible(!1)}.bind(this))},hideSpriteBoss:function(){this.m_boss_list.forEach(function(s){null==s&&null==s||s.setVisible(!1)}.bind(this))},onExit:function(){this._super()}}),StoryHardModeLayer=cc.Layer.extend({change_mode_callback:null,m_base_layer:null,m_cloud_layer:null,m_ui_layer:null,m_normal_mode_btn:null,m_bg:null,m_story_title:null,m_arrow_left:null,m_arrow_right:null,m_story_idx:0,m_difficult_type:0,m_story_list:[],m_used_foot_board_list:[],m_lotus_box:null,m_lotus_total_count:null,m_lotus_box_btns:[],m_lotus_reward_labels:[],m_lotus_box_light:[],m_message_box:null,m_scene:null,ctor:function(scene){this._super(),this.change_mode_callback=null,this.m_base_layer=null,this.m_cloud_layer=null,this.m_ui_layer=null,this.m_normal_mode_btn=null,this.m_bg=null,this.m_story_title=null,this.m_arrow_left=null,this.m_arrow_right=null,this.m_story_idx=0,this.m_difficult_type=0,this.m_story_list=[],this.m_used_foot_board_list=[],this.m_lotus_box=null,this.m_lotus_total_count=null,this.m_lotus_box_btns=[],this.m_lotus_reward_labels=[],this.m_lotus_box_light=[],this.m_message_box=null,this.m_scene=scene,this.init()},init:function(){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var winSize=cc.size(this);return this.m_base_layer=new cc.Layer,this.m_base_layer.ignoreAnchorPointForPosition(!1),this.m_base_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_base_layer.setPosition(ccCenter(winSize)),this.addChild(this.m_base_layer,0),this.m_cloud_layer=new cc.Layer,this.m_cloud_layer.ignoreAnchorPointForPosition(!1),this.m_cloud_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_cloud_layer.setPosition(ccCenter(winSize)),this.addChild(this.m_cloud_layer,100),this.m_ui_layer=new cc.Layer,this.m_ui_layer.ignoreAnchorPointForPosition(!1),this.m_ui_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_ui_layer.setPosition(ccCenter(winSize)),this.addChild(this.m_ui_layer,200),this.m_bg=cc.Sprite.create(RES_CDN_DEFULT+"new_menu_quest/bg_story_hard_1.jpg"),this.m_bg.setPosition(ccCenter(winSize)),this.m_bg.setAnchorPoint(ANCHOR_MIDDLE()),IS_SP_BROWSER&&this.m_bg.setScale(2),this.m_base_layer.addChild(this.m_bg),this.createUILayer(),this.m_message_box=new CTGameMessageBox,this.m_message_box.setContentSize(winSize),this.addChild(this.m_message_box,99999),!0},onEnter:function(){this._super();var context=BattleContext._getInstance();context.IsNextMissionPopup()&&context.getGameType()==db.BattleGameType.StoryHardMode&&(context.showNextMissionPopup(!1),this.scheduleOnce(function(){MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_hard_mode_mission_preview_show)},.1,"story_hard_mode_mission_preview_show"))},onExit:function(){this._super()},playBGM:function(){var bgm_list=[];bgm_list=MasterTable.getInstance().get_Bgm(BGM_TYPE_STORY_HARD_MODE_STAGE_BGM,bgm_list);var audio=AudioEngine.getInstance();if(0!=bgm_list.length&&null!=bgm_list&&null!=bgm_list){var path=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm_list[0].sound_file_name;audio.m_bgmPath!=path&&audio.playBackgroundMusic(path,!0)}},createUILayer:function(){var winSize=cc.size(this);this.m_story_title=cmLabelEx.getLabel("1.Story Title",LABEL_FONT_INDEX.FONT_2271,!1,!0,2,cc.color.BLACK),this.m_story_title.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_story_title.setPosition(.5*winSize.width,winSize.height-65),this.m_ui_layer.addChild(this.m_story_title),this.m_arrow_left=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_arrow_2_left_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_arrow_2_left_on.png",""),this.m_arrow_left.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_arrow_left.setPosition(15,.5*winSize.height),this.m_ui_layer.addChild(this.m_arrow_left),this.m_arrow_left.addClickEventListener(function(){this.leftStory()}.bind(this)),this.m_arrow_right=new ccui.Button(RES_CDN_DEFULT+"new_common/btn/ori/btn_arrow_2_right_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_arrow_2_right_on.png",""),this.m_arrow_right.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_arrow_right.setPosition(winSize.width-15,.5*winSize.height),this.m_ui_layer.addChild(this.m_arrow_right),this.m_arrow_right.addClickEventListener(function(){this.rightStory()}.bind(this)),this.createNormalModeBtn()},createLotusBox:function(){var offset_x;this.m_lotus_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_input_box.png"),this.m_lotus_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_lotus_box.setPosition(10,0),IS_SP_BROWSER&&this.m_lotus_box.setScale(2),this.m_ui_layer.addChild(this.m_lotus_box),this.m_lotus_total_count=cmLabel.getLabel("0/30",LABEL_FONT_INDEX.FONT_181),this.m_lotus_total_count.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),IS_SP_BROWSER?(this.m_lotus_total_count.setPosition(80,43),this.m_lotus_total_count.setScale(.6)):this.m_lotus_total_count.setPosition(164,90),this.m_lotus_box.addChild(this.m_lotus_total_count),offset_x=IS_SP_BROWSER?13:26;for(var i=0;i<this.m_story_list[this.m_story_idx].lotus_rewards.length;i++){var icon_name,icon_light_name,lotus=this.m_story_list[this.m_story_idx].lotus_rewards[i];lotus.lotus_reward.bonus_type==BONUS_TYPE_GOLD?(icon_name=RES_CDN_DEFULT+"new_menu_quest/img_story_reward_gold_lock.png",icon_light_name=IS_SP_BROWSER?RES_CDN_DEFULT+"uieffect_2/effect_light_ori/effect_light_3.png":"#effect_light_3.png"):lotus.lotus_reward.bonus_type==BONUS_TYPE_JADE?(icon_name=RES_CDN_DEFULT+"new_menu_quest/img_story_reward_jade_lock.png",icon_light_name=IS_SP_BROWSER?RES_CDN_DEFULT+"uieffect_2/effect_light_ori/effect_light_2.png":"#effect_light_2.png"):lotus.lotus_reward.bonus_type==BONUS_TYPE_SKIP_TICKET&&(icon_name=RES_CDN_DEFULT+"new_menu_quest/img_story_reward_skip_lock.png",icon_light_name=IS_SP_BROWSER?RES_CDN_DEFULT+"uieffect_2/effect_light_ori/effect_light_2.png":"#effect_light_2.png");cc.Sprite.create(icon_name),cc.Sprite.create(icon_name);var box_btn=new ccui.Button;box_btn.setTag(i),box_btn.loadTextures(icon_name,icon_name),box_btn.setPressedActionEnabled(!0),box_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),IS_SP_BROWSER?box_btn.setPosition(offset_x,20.5):box_btn.setPosition(offset_x,41),box_btn.addClickEventListener(function(sender){this.getLotusReward(sender.getTag())}.bind(this)),this.m_lotus_box.addChild(box_btn);var light=cc.Sprite.create(icon_light_name);light.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),IS_SP_BROWSER?(light.setScale(.5),light.setPosition(offset_x-8,12)):light.setPosition(offset_x-14,18),light.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR),this.m_lotus_box.addChild(light);var fadeout=cc.fadeOut(1),fadein=cc.fadeIn(1),seq=cc.sequence(fadeout,fadein),repeat=cc.repeatForever(seq);light.runAction(repeat);var reward_label=cmLabel.getLabel(lotus.lotus_reward.lotus_count,LABEL_FONT_INDEX.FONT_181);reward_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),IS_SP_BROWSER?(reward_label.setPosition(offset_x+7+10,9),reward_label.setScale(.6)):reward_label.setPosition(offset_x+36,22),this.m_lotus_box.addChild(reward_label),IS_SP_BROWSER?offset_x+=31.5:offset_x+=63,this.m_lotus_box_btns.push(box_btn),this.m_lotus_box_light.push(light),this.m_lotus_reward_labels.push(reward_label),icon_light_name=icon_name=lotus=null}var box_size=ccSize(this.m_lotus_box),help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE);help_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),IS_SP_BROWSER?(help_btn.setPosition(box_size.width,box_size.height),help_btn.setScale(.5)):help_btn.setPosition(box_size.width,box_size.height),this.m_lotus_box.addChild(help_btn),help_btn.addClickEventListener(function(){this.scheduleOnce(function(){MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_hard_mode_lotus_help_show)},0,"btn_show_help")}.bind(this))},changeNormalMode:function(){if(null!=this.change_mode_callback){BattleContext._getInstance().setStoryHardModeMissionId(0);this.change_mode_callback(1,this.m_story_idx,!1)&&(GameDefault.getInstance().setStoryMode(1),BattleContext._getInstance().setGameType(db.BattleGameType.Mission))}},setChangeModeCallback:function(cb){this.change_mode_callback=cb},createNormalModeBtn:function(){var winSize=cc.size(this);this.m_normal_mode_btn=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_6_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_6_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_6_none.png"),this.m_normal_mode_btn.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_normal_mode_btn.setPosition(17,winSize.height-75),this.m_normal_mode_btn.setTitleFont(cc.Rect(15,15,15,2),LABEL_FONT_INDEX.FONT_1672,!0,2,cc.color.WHITE,cc.color(128,128,128),cc.p(0,0)),this.m_normal_mode_btn.setTitleText("NORMAL"),this.m_normal_mode_btn.setBright(!0),this.m_normal_mode_btn.setContentSize(110,32),this.m_ui_layer.addChild(this.m_normal_mode_btn),this.m_normal_mode_btn.addClickEventListener(function(){this.changeNormalMode()}.bind(this));var help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE);help_btn.setAnchorPoint(ANCHOR_TOP_LEFT()),help_btn.setPosition(17+ccWidth(this.m_normal_mode_btn)+15,winSize.height-73),this.m_ui_layer.addChild(help_btn),help_btn.addClickEventListener(function(){this.scheduleOnce(function(){MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],main_story_hard_mode_help_show)},0,"main_story_hard_mode_help_show")}.bind(this))},checkArrow:function(){if(null!=this.m_arrow_left&&this.m_arrow_left.setVisible(0<this.m_story_idx),null!=this.m_arrow_right)if(this.getCurrentStory().is_complete){var next_idx=this.m_story_idx+1;if(next_idx>this.m_story_list.length-1&&(next_idx=this.m_story_list.length-1),next_idx!=this.m_story_idx){var next_story=this.m_story_list[next_idx],is_show=next_story.is_new||next_story.is_complete;this.m_arrow_right.setVisible(is_show)}else this.m_arrow_right.setVisible(this.m_story_idx<this.m_story_list.length-1)}else this.m_arrow_right.setVisible(!1);this.playBGM()},leftStory:function(){this.m_story_idx-=1,this.m_story_idx<0&&(this.m_story_idx=0),this.updateBackground(),this.updateFootBoardList(),this.updateLotusBox(),this.checkArrow()},rightStory:function(){var idx=this.m_story_idx+1;idx>this.m_story_list.length-1&&(idx=this.m_story_list.length-1);var cur_story=this.getCurrentStory(),next_story=this.m_story_list[idx];cur_story.is_complete&&(next_story.is_complete||next_story.is_new)&&(this.m_story_idx=idx,this.updateBackground(),this.updateFootBoardList(),this.updateLotusBox(),this.checkArrow())},setMissionChargeResult:function(res){var mission=this.m_story_list[this.m_story_idx].mission_list.findIndex(function(mi){return mi.mission.main_story_hard_mode_mission_idx==res.main_story_hard_mode_mission_idx}.bind(this));-1!=mission&&(this.m_story_list[this.m_story_idx].mission_list[mission].try_count=res.daily_try_count,this.m_story_list[this.m_story_idx].mission_list[mission].charge_count=res.daily_charge_count,this.updateFootBoardList())},refreshStoryHardModeMissionData:function(){this.m_story_list=[],this.setChangeModeData(this.m_difficult_type,this.m_story_idx),this.updateFootBoardList()},setChangeModeData:function(difficult,story_idx){var context=BattleContext._getInstance(),m=MasterManager.getInstance();story_idx=story_idx;0<(main_story_hard_mode_mission_idx=context.getStoryHardModeMissionId())&&(story_idx=(mission=m.get_MainStoryHardModeMission(main_story_hard_mode_mission_idx)).main_story_id-1);if(this.m_difficult_type=difficult,0==this.m_story_list.length){var service=MissionService.getInstance();this.m_story_list=service.getUserMainStoryHardMode(this.m_difficult_type)}var open_story_idx=0;if(-1!=this.m_story_list.findIndex(function(s){return!s.is_complete}.bind(this))){for(var i=0;i<this.m_story_list.length;i++){var story=this.m_story_list[i];(story.is_complete||story.is_new)&&(open_story_idx=i)}var main_story_hard_mode_mission_idx;if(context.IsNextMissionPopup())if(0!=(main_story_hard_mode_mission_idx=context.getStoryHardModeMissionId())){var mission,next_story_idx=(mission=m.get_MainStoryHardModeMission(main_story_hard_mode_mission_idx)).main_story_id-1;next_story_idx>this.m_story_list.length-1&&(next_story_idx=this.m_story_list.length-1);var next_story=this.m_story_list[next_story_idx];next_story.is_new||next_story.is_complete?this.m_story_idx=mission.main_story_id-1:(this.m_story_idx=open_story_idx,context.showNextMissionPopup(!1))}else this.m_story_idx=-1==story_idx?story_idx<open_story_idx?open_story_idx:story_idx=0:(story_idx<open_story_idx||(story_idx=open_story_idx),story_idx);else this.m_story_idx=-1==story_idx?story_idx<open_story_idx?open_story_idx:story_idx=0:(story_idx<open_story_idx||(story_idx=open_story_idx),story_idx)}else this.m_story_idx=(0==story_idx?0<main_story_hard_mode_mission_idx&&story_idx<this.m_story_list.length||(story_idx=this.m_story_list.length-1):story_idx<this.m_story_list.length&&-1<story_idx||(story_idx=this.m_story_list.length-1),story_idx);this.m_story_idx>=this.m_story_list.length&&(this.m_story_idx=0),null==this.m_lotus_box&&this.createLotusBox(),this.updateBackground(),this.updateFootBoardList(),this.updateLotusBox(),this.checkArrow()},showLotusRewardPopup:function(reward){null!=this.m_scene&&this.m_scene.showPurchaseLotusBoxInfoPopup(reward)},getLotusReward:function(reward_num){var reward=this.m_story_list[this.m_story_idx].lotus_rewards[reward_num];if(reward.is_complete)MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_scene_already_lotus_bonus_get);else{for(var gain_lotus=0,i=0;i<this.m_story_list[this.m_story_idx].mission_list.length;i++){for(var mission=this.m_story_list[this.m_story_idx].mission_list[i],count=0,idx=0;idx<mission.task_list.length;idx++)mission.task_list[idx].is_cleared&&(count+=1);3==count&&(gain_lotus+=1)}if(gain_lotus>=reward.lotus_reward.lotus_count){var req={};req.opcode=net.OP.op_main_story_hard_mode_lotus_reward_get,req.main_story_hard_mode_lotus_reward_idx=reward.lotus_reward.main_story_hard_mode_lotus_reward_idx,req.difficult=reward.lotus_reward.difficult,req.main_story_id=reward.lotus_reward.main_story_id,req.lotus_count=reward.lotus_reward.lotus_count,SceneManager.getInstance().getRunningScene().network_write(req)}else this.showLotusRewardPopup(reward)}},setLotusGetResult:function(res){for(var lotus_reward=this.m_story_list[this.m_story_idx].lotus_rewards,i=0;i<lotus_reward.length;i++)lotus_reward[i].lotus_reward.main_story_hard_mode_lotus_reward_idx==res.lotus_reward_log.main_story_hard_mode_lotus_reward_idx&&lotus_reward[i].lotus_reward.main_story_id==res.lotus_reward_log.main_story_id&&lotus_reward[i].lotus_reward.difficult==res.lotus_reward_log.difficult&&lotus_reward[i].lotus_reward.lotus_count==res.lotus_reward_log.lotus_count&&(lotus_reward[i].is_complete="y"==res.lotus_reward_log.complete_yn,lotus_reward[i].is_new="y"==res.lotus_reward_log.new_yn);this.updateLotusBox()},updateLotusBox:function(){var gain_lotus=0;this.m_story_list[this.m_story_idx].mission_list.forEach(function(mission){if(null!=mission||null!=mission){for(var task_complete_count=0,i=0;i<mission.task_list.length;i++)mission.task_list[i].is_cleared&&(task_complete_count+=1);3==task_complete_count&&(gain_lotus+=1)}}.bind(this));var max_lotus_count=0;this.m_story_list[this.m_story_idx].lotus_rewards.forEach(function(lotus){max_lotus_count<lotus.lotus_reward.lotus_count&&(max_lotus_count=lotus.lotus_reward.lotus_count)}.bind(this)),this.m_lotus_total_count.setString(cmString(res_str("story_hard_younwhoa_get_count"),gain_lotus,max_lotus_count));for(var icon_name="",lotus_reward_list=this.m_story_list[this.m_story_idx].lotus_rewards,i=0;i<lotus_reward_list.length;i++){var reward=lotus_reward_list[i];reward.is_complete?reward.lotus_reward.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"new_menu_quest/img_story_reward_gold_unlock.png":reward.lotus_reward.bonus_type==BONUS_TYPE_JADE?icon_name=RES_CDN_DEFULT+"new_menu_quest/img_story_reward_jade_unlock.png":reward.lotus_reward.bonus_type==BONUS_TYPE_SKIP_TICKET&&(icon_name=RES_CDN_DEFULT+"new_menu_quest/img_story_reward_skip_unlock.png"):reward.is_new?reward.lotus_reward.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"new_menu_quest/img_story_reward_gold_ready.png":reward.lotus_reward.bonus_type==BONUS_TYPE_JADE?icon_name=RES_CDN_DEFULT+"new_menu_quest/img_story_reward_jade_ready.png":reward.lotus_reward.bonus_type==BONUS_TYPE_SKIP_TICKET&&(icon_name=RES_CDN_DEFULT+"new_menu_quest/img_story_reward_skip_ready.png"):reward.lotus_reward.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"new_menu_quest/img_story_reward_gold_lock.png":reward.lotus_reward.bonus_type==BONUS_TYPE_JADE?icon_name=RES_CDN_DEFULT+"new_menu_quest/img_story_reward_jade_lock.png":reward.lotus_reward.bonus_type==BONUS_TYPE_SKIP_TICKET&&(icon_name=RES_CDN_DEFULT+"new_menu_quest/img_story_reward_skip_lock.png");var off=icon_name,on=icon_name,btn=this.m_lotus_box_btns[i];btn.loadTextureNormal(off),btn.loadTexturePressed(on);var label=this.m_lotus_reward_labels[i];label.setString(reward.lotus_reward.lotus_count),gain_lotus<reward.lotus_reward.lotus_count?label.setColor(cc.color.RED):label.setColor(cc.color.WHITE),this.m_lotus_box_light[i].setVisible(!reward.is_complete&&reward.is_new)}},updateBackground:function(){var story=this.getCurrentStory(),bg_img=RES_CDN_DEFULT+"new_menu_quest/bg_story_hard_"+story.main_story.main_story_id+".jpg",frame_texture=cc.textureCache.addImage(bg_img),frame=new cc.SpriteFrame(frame_texture,cc.rect(0,0,frame_texture.getContentSize().width,frame_texture.getContentSize().height));null!=frame&&this.m_bg.setSpriteFrame(frame);var page=cmString(res_str("label_story_page_title"),story.main_story.main_story_id);this.m_story_title.setString(cmString("%s  %s",page,story.main_story.name))},updateFootBoardList:function(){for(var story=this.getCurrentStory(),i=0;i<story.mission_list.length;i++){var mission=story.mission_list[i],item=null;i<this.m_used_foot_board_list.length?item=this.m_used_foot_board_list[i]:(item=new StoryHardModeFootBoardNode(this.showChargeTryCountPopup,this),this.m_base_layer.addChild(item),this.m_used_foot_board_list.push(item)),null!=item&&item.setStoryHardModeMissionData(mission)}},getCurrentStory:function(){return this.m_story_list[this.m_story_idx]},showChargeTryCountPopup:function(mission){if(0<mission.mission.daily_try_max_count-mission.try_count){var scene=SceneManager.getInstance().getRunningScene(),title=res_str("label_information_title");return(msg=[]).push(res_str("story_hard_enter_charge_cannot_popup_text")),msg.push(res_str("story_hard_enter_deny_popup_text_3")),void scene.showMsgBox(title,msg)}if(0==mission.mission.enter_charge_group_idx){var msg;scene=SceneManager.getInstance().getRunningScene(),title=res_str("story_hard_enter_deny_popup_title");return(msg=[]).push(res_str("story_hard_enter_deny_popup_text_1")),msg.push(res_str("story_hard_enter_deny_popup_text_3")),void scene.showMsgBox(title,msg)}var is_enable_charge=!0,need_count=0;if(100==mission.mission.enter_charge_group_idx)need_count=mission.charge_info[0].need_count;else if(mission.charge_count<mission.mission.enter_charge_count){var next_charge_count=mission.charge_count+1,found=mission.charge_info.findIndex(function(info){return info.charge_count==next_charge_count}.bind(this));-1!=found&&(need_count=mission.charge_info[found].need_count)}else is_enable_charge=!1;if(is_enable_charge)if(NetService().get_UserItemInfo_V2().jade_cnt<need_count){(scene=SceneManager.getInstance().getRunningScene()).showNotEnoughJade(!0)}else{this.m_message_box.setTitle(res_str("story_hard_enter_deny_popup_title"));var remain_charge_count=mission.mission.enter_charge_count-mission.charge_count;this.m_message_box.setText(res_str("story_hard_enter_deny_popup_text_1"),LABEL_FONT_INDEX.FONT_261),this.m_message_box.setText("\n"),this.m_message_box.setText(" 04:00",LABEL_FONT_INDEX.FONT_247),this.m_message_box.setText("\n"),this.m_message_box.setText(" "),this.m_message_box.setText("\n"),this.m_message_box.setText(" "),this.m_message_box.setText("\n"),this.m_message_box.setText(" "),this.m_message_box.setText("\n"),this.m_message_box.setText(""+need_count+"",LABEL_FONT_INDEX.FONT_247),this.m_message_box.setText("",LABEL_FONT_INDEX.FONT_261),this.m_message_box.setText("\n"),this.m_message_box.setText("",LABEL_FONT_INDEX.FONT_261),this.m_message_box.setText(mission.mission.daily_try_max_count+"",LABEL_FONT_INDEX.FONT_247),this.m_message_box.setText("",LABEL_FONT_INDEX.FONT_261),this.m_message_box.setText("\n"),this.m_message_box.setText(" : "+remain_charge_count+"/"+mission.mission.enter_charge_count+"",LABEL_FONT_INDEX.FONT_245),this.m_message_box.setText("\n");var btnNo=new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0);btnNo.click=function(){this.m_message_box.hide(!1)}.bind(this);var btnYes=new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0);btnYes.click=function(){this.scheduleOnce(function(float){var req={};req.opcode=net.OP.op_main_story_hard_mode_mission_charge,req.main_story_hard_mode_mission_idx=mission.mission.main_story_hard_mode_mission_idx,this.getParent().network_write(req)},0,"charge_try_count_confirm"),this.m_message_box.hide(!1)}.bind(this),this.m_message_box.addButtonInfo(btnNo),this.m_message_box.addButtonInfo(btnYes),this.m_message_box.is_show()&&this.m_message_box.hide(!1),this.m_message_box.show()}}}),StoryHardModeLotusBoxPopup=GameModalLayer.extend({_close_callback:null,m_lotus:null,m_load_img:[],ctor:function(lotus,callback){this._super(),this._close_callback=null,this.m_lotus=null,this.m_load_img=[],this.init(lotus,callback)},init:function(lotus,callback){return this.m_lotus=lotus,this._close_callback=callback,this.m_load_img.push(RES_CDN_DEFULT+"common/img_9p_script_box_2.png"),!0},initLayout:function(){resourceLoader(this.m_load_img,function(){var winSize=ccSize(this),boxSize=cc.size(630,370),m=MasterManager.getInstance(),mask_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());mask_bg.setPosition(ccCenter(this)),mask_bg.setContentSize(winSize),this.addChild(mask_bg);var box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",RectZero());box.setPreferredSize(boxSize),box.setAnchorPoint(ANCHOR_MIDDLE()),box.setPosition(.5*ccWidth(this),.5*ccHeight(this)),this.addChild(box);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_3.png");navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(.5*boxSize.width,boxSize.height-11),box.addChild(navi);var nSize=ccSize(navi),title=cmLabel.getLabel(res_str("label_lotus_bonus_title"),LABEL_FONT_INDEX.FONT_301);title.setAnchorPoint(ANCHOR_MIDDLE()),title.setPosition(.5*nSize.width,.5*nSize.height+2),navi.addChild(title);var icon_name,icon_box=cc.Sprite.create(RES_CDN_DEFULT+"new_icon/img_icon_frame.png");icon_box.setAnchorPoint(ANCHOR_MIDDLE()),icon_box.setPosition(.5*boxSize.width,250),box.addChild(icon_box);var bonus_type=this.m_lotus.lotus_reward.bonus_type;switch(bonus_type){case BONUS_TYPE_GOLD:case BONUS_TYPE_KEY:case BONUS_TYPE_HEART:case BONUS_TYPE_JADE:case BONUS_TYPE_SKIP_TICKET:icon_name="#img_reward_"+leadingZeros(bonus_type,2)+"_n.png";break;case BONUS_TYPE_HN_RARE_TYPE_ENGAGE:icon_name="#img_reward_yh_n.png";break;case BONUS_TYPE_YUNHEE_FIX:case BONUS_TYPE_JIN_FIX:case BONUS_TYPE_WIE_CHOCK_OH_SELECT:icon_name="#img_reward_yh_n.png";break;case BONUS_TYPE_HWANDAN_1:case BONUS_TYPE_HWANDAN_2:case BONUS_TYPE_HWANDAN_3:case BONUS_TYPE_HWANDAN_4:case BONUS_TYPE_HWANDAN_5:icon_name="#img_reward_"+leadingZeros(bonus_type,2)+"_n.png";break;case BONUS_TYPE_LOVE_ITEM:icon_name="#img_reward_love_item_"+leadingZeros(this.m_lotus.lotus_reward.min_value,2)+"_n.png"}var icon=cc.Sprite.create(icon_name);icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(icon_box)),icon.setScale(.428),icon_box.addChild(icon);var btype=m.get_BonusType(bonus_type),bonus_str="";if(btype.bonus_type==BONUS_TYPE_LOVE_ITEM||btype.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||btype.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT)bonus_str=btype.name+" x"+this.m_lotus.lotus_reward.max_value;else if(btype.bonus_type==BONUS_TYPE_YUNHEE_FIX){bonus_str=m.get_General(this.m_lotus.lotus_reward.min_value).name+" x"+this.m_lotus.lotus_reward.max_value}else bonus_str=btype.name+" x"+this.m_lotus.lotus_reward.min_value;var bonus_label=cmLabel.getLabel(bonus_str,LABEL_FONT_INDEX.FONT_262);bonus_label.setAnchorPoint(ANCHOR_MIDDLE()),bonus_label.setPosition(.5*boxSize.width,190),box.addChild(bonus_label);var comment=cmLabel.getLabel(cmString(res_str("label_lotus_bonus_comment"),this.m_lotus.lotus_reward.lotus_count),LABEL_FONT_INDEX.FONT_241);comment.setAnchorPoint(ANCHOR_MIDDLE()),comment.setPosition(.5*boxSize.width,135),box.addChild(comment);var close=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);close.setFont(LABEL_FONT_INDEX.FONT_241),close.setString(res_str("label_confirm")),close.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),close.setPosition(.5*boxSize.width,16),box.addChild(close),close.addClickEventListener(function(){null!=this._close_callback&&this._close_callback()}.bind(this))}.bind(this)),this._super()},setLotus:function(lotus){this.m_lotus=lotus},show:function(){this._super()},hide:function(){this._super()},onEnter:function(){this._super()},onExit:function(){this._super()}}),StoryHardModeMissionPreviewPopup=cc.Layer.extend({m_main_story_hard_mode_mission_idx:0,m_gain_item_list:[],m_story_hard_mode_mission:null,ctor:function(main_story_hard_mode_mission_idx){this._super(),this.m_main_story_hard_mode_mission_idx=0,this.m_story_hard_mode_mission={main_story_hard_mode_mission_idx:0,stage_count:0,current_stage:1,victory_count:0,is_complete:!1,is_new:!1,try_count:0,charge_count:0,is_try_complete:!1,mission:{},task_list:[],charge_info:{},stage_npc:null,drop_gnrl_list:[]},this.init(main_story_hard_mode_mission_idx)},init:function(main_story_hard_mode_mission_idx){this.m_main_story_hard_mode_mission_idx=main_story_hard_mode_mission_idx;var service=BattleService.getInstance(),winSize=(MasterTable.getInstance(),ccSize(this)),rect=RectZero(),bg_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",rect);bg_mask.setPosition(ccCenter(winSize)),bg_mask.setContentSize(winSize),this.addChild(bg_mask),this.m_gain_item_list=[],service.getMasterStoryHardModeMissionBonusList(this.m_main_story_hard_mode_mission_idx,this.m_gain_item_list),service.getStoryHardModeMissionAndNpc(this.m_main_story_hard_mode_mission_idx,this.m_story_hard_mode_mission);for(var npc_list=this.m_story_hard_mode_mission.stage_npc[3],i=0;i<npc_list.length;i++)if(npc_list[i].is_zoom){var npc=npc_list[i],path="";path=npc.general.gnrl_group<100?RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(npc.general.gnrl_group,2)+".png":RES_CDN_DEFULT+"card_war_boss/"+npc.general.gnrl_group+".png";var card_body=cc.Sprite.create(path);card_body.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),card_body.setPosition(winSize.width+ccWidth(card_body),0),card_body.setScale(2),this.addChild(card_body);var scaleTo_1=new cc.ScaleTo(.7,2,2.01),scaleTo_2=new cc.ScaleTo(.7,2,1.99),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);card_body.runAction(repeat);var move=new cc.MoveTo(.2,cc.p(1136,0));card_body.runAction(move);break}var mask_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal_4.png",rect);mask_bg.setContentSize(644,640),mask_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),mask_bg.setPosition(LP(this,300,0)),this.addChild(mask_bg);var left_box_layer=this.getLeftBoxLayer();left_box_layer.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),left_box_layer.setPosition(LP(this,1,0)),this.addChild(left_box_layer);var right_box_layer=this.getRightBoxLayer();right_box_layer.setPosition(LP(this,479,0)),this.addChild(right_box_layer);var cloud_img=cc.Sprite.create(RES_CDN_DEFULT+"common/img_state_cloud.png");cloud_img.setAnchorPoint(ANCHOR_TOP_RIGHT()),cloud_img.setPosition(ccWidth(this),ccHeight(this)),this.addChild(cloud_img);var back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);return back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(this)-10,ccHeight(this)-10),back_btn.addClickEventListener(function(){var context=BattleContext._getInstance();context.clear(),context.setStoryHardModeMissionId(0),MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_hard_mode_mission_preview_hide)}.bind(this)),this.addChild(back_btn),!0},getLeftBoxLayer:function(){var layer=new cc.Layer,bg_box=cc.Sprite.create(RES_CDN_DEFULT+"common/img_box_center_2.png");bg_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bg_box.setPosition(ZERO()),layer.addChild(bg_box),layer.setContentSize(ccSize(bg_box));var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");navi.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),navi.setPosition(8,509),bg_box.addChild(navi);var task_title=cmLabel.getLabel(res_str("label_task_title"),LABEL_FONT_INDEX.FONT_261);task_title.setPosition(ccCenter(navi).x,16),task_title.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),navi.addChild(task_title);for(var offset_y=418,i=0;i<this.m_story_hard_mode_mission.task_list.length;i++){var user_task=this.m_story_hard_mode_mission.task_list[i];user_task.mission_clear_count=this.m_story_hard_mode_mission.victory_count;var task_node=new StoryHardModeMissionPreviewTask(user_task);task_node.setAnchorPoint(ANCHOR_BOTTOM_LEFT),task_node.setPosition(17,offset_y),offset_y-=ccHeight(task_node),bg_box.addChild(task_node)}return layer},getRightBoxLayer:function(){var layer=new cc.Layer;layer.setContentSize(481,568);BattleService.getInstance();var m=MasterManager.getInstance(),story=m.get_MainStoryHardMode(1,this.m_story_hard_mode_mission.mission.difficult,this.m_story_hard_mode_mission.mission.main_story_id);(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(circle_point),circle_point.setPosition(19,533);var page=cmString(res_str("label_story_page_title"),story.main_story_id),stage=cmString(res_str("label_story_stage"),this.m_story_hard_mode_mission.mission.mission_num),mission_name=cmLabelEx.getLabel(cmString("%s %s %s",page,story.name,stage),LABEL_FONT_INDEX.FONT_2271,!1,!0,2,cc.color.BLACK);mission_name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),mission_name.setPosition(35,525),layer.addChild(mission_name);var offset_y=482;offset_y-=53,(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(circle_point),circle_point.setPosition(19,offset_y+8);var exp_title=cmLabel.getLabel(res_str("label_user_gain_exp"),LABEL_FONT_INDEX.FONT_248);exp_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),exp_title.setPosition(35,offset_y),layer.addChild(exp_title);var gain_user_exp=m.get_MainStoryHardModeMissionReward(this.m_story_hard_mode_mission.main_story_hard_mode_mission_idx).gain_user_exp,str_exp=""+Number(gain_user_exp).toLocaleString("en"),gain_exp=cmLabel.getLabel(str_exp,LABEL_FONT_INDEX.FONT_2423);gain_exp.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),gain_exp.setPosition(257,offset_y),layer.addChild(gain_exp),(line=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(line),line.setPosition(19,offset_y-10),offset_y-=53,(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(circle_point),circle_point.setPosition(19,offset_y+8);var line,appear_gnrl_title=cmLabel.getLabel(res_str("label_weekly_dungeon_boss_stage_npc_title"),LABEL_FONT_INDEX.FONT_248);appear_gnrl_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),appear_gnrl_title.setPosition(35,offset_y),layer.addChild(appear_gnrl_title),(line=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(line),line.setPosition(19,197);var circle_point,gnrl_layer=this.getAppearGeneralLayer();gnrl_layer.setPosition(19,212),layer.addChild(gnrl_layer),offset_y=162,(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(circle_point),circle_point.setPosition(19,offset_y+8);var bonus_title=cmLabel.getLabel(res_str("label_reward_bonus"),LABEL_FONT_INDEX.FONT_248);bonus_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bonus_title.setPosition(35,offset_y),layer.addChild(bonus_title);var reward_layer=this.getRewardBonusLayer();reward_layer.setPosition(19,86),layer.addChild(reward_layer);var btn=new LabelButton("btn_03_off.png","btn_03_on.png","",ccui.Widget.PLIST_TEXTURE);btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn.setFont(LABEL_FONT_INDEX.FONT_241),btn.setString(res_str("label_ready_mission")),btn.setPosition(19,16),layer.addChild(btn),btn.addClickEventListener(function(sender){BattleContext._getInstance().setStoryHardModeMissionId(this.m_story_hard_mode_mission.main_story_hard_mode_mission_idx),MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_friend_select)}.bind(this));var campaign=MasterTable.getInstance().get_RewardCampaignUi(CAMPAIGN_DUNGEON_TYPE_STORY_HARD_MODE,CAMPAIGN_POSITION_TYPE_ENTERANCE_TOP_TEXT);if(0!=campaign.dugeon_type&&null!=campaign.dugeon_type&&(campaign.value>=this.m_story_hard_mode_mission.mission.main_story_id||0==campaign.value)){var icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("new_common/%s",campaign.image_name));icon.setAnchorPoint(ZERO()),icon.setPosition(27,451),layer.addChild(icon)}return layer},getAppearGeneralLayer:function(){var layer=new cc.Layer,npc_list=this.m_story_hard_mode_mission.stage_npc[3],pos=[];pos.push(cc.p(0,41)),pos.push(cc.p(72,77)),pos.push(cc.p(72,5)),pos.push(cc.p(144,77)),pos.push(cc.p(144,5));for(var idx=0;idx<npc_list.length;idx++){var npc=new NpcInfoItemNode(CARD_TYPE.type_card_thumb);npc.setGeneralData(npc_list[idx].general,npc_list[idx].is_zoom);var p=npc_list[idx].position-1;npc.setPosition(pos[p]),npc.setGlobalZOrderTooltip(!0),layer.addChild(npc)}return layer},getRewardBonusLayer:function(){for(var layer=new cc.Layer,index=0,width=0,dup_remove_item_list=[],idx=0;idx<this.m_gain_item_list.length;idx++){-1==dup_remove_item_list.findIndex(function(it){return it.item_type==this.m_gain_item_list[idx].item_type&&(it.item_id==this.m_gain_item_list[idx].item_id&&it.gnrl_group==this.m_gain_item_list[idx].gnrl_group)}.bind(this))&&dup_remove_item_list.push(this.m_gain_item_list[idx])}for(var i=0;i<dup_remove_item_list.length;i++){var item_layer=new MissionPreviewBonusItemCell;item_layer.setGainItem(dup_remove_item_list[i]),item_layer.setEnableToolTip(!0),layer.addChild(item_layer),item_layer.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),item_layer.setPosition(index*(ccWidth(item_layer)+4),0),index++,width+=ccWidth(item_layer)}return layer.setContentSize(width,68),layer}}),StoryHardModeMissionPreviewTask=cc.Node.extend({m_task:null,ctor:function(task){this._super(),this.m_task=null,this.init(task)},init:function(task){this.m_task=task;var size=cc.size(444,78);this.setContentSize(size);var box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",cc.Rect(16,16,16,16));box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box.setPosition(ZERO()),box.setPreferredSize(size),this.addChild(box);var content,task_title=cmLabel.getLabel(this.m_task.task.name,LABEL_FONT_INDEX.FONT_2013);if(task_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),task_title.setPosition(58,43),this.addChild(task_title),this.m_task.task_type.task_type==TaskActionType.Mission_Clear_Count){var clear_count=this.m_task.mission_clear_count;clear_count>this.m_task.task.accum_win_count&&(clear_count=this.m_task.task.accum_win_count),content=this.m_task.task.content+"  ("+clear_count+"/"+this.m_task.task.accum_win_count+")"}else content=this.m_task.task.content;var task_content=cmLabel.getLabel(content,LABEL_FONT_INDEX.FONT_161);task_content.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),task_content.setPosition(58,16),this.addChild(task_content);var icon_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"new_icon/img_icon_frame.png",RectZero());icon_box.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),icon_box.setPosition(size.width-4,.5*size.height),icon_box.setPreferredSize(cc.size(68,68)),this.addChild(icon_box);var icon_name="";if(this.m_task.mission_task.bonus_type==BONUS_TYPE_LOVE_ITEM){var gnrl=MasterManager.getInstance().get_General(this.m_task.mission_task.min_value);gnrl.gnrl_type==GENERAL_TYPE_MATERIAL||gnrl.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL?USE_SP_TUMB_SCALE&&(icon_name=this.m_task.mission_task.bonus_type==BONUS_TYPE_YUNHEE_FIX?RES_CDN_CARD_MEDIUM_NTP+"m_"+gnrl.bone_id+".png":RES_CDN_CARD_MEDIUM_NTP+gnrl.bone_id+".png"):USE_SP_TUMB_SCALE&&(icon_name=this.m_task.mission_task.bonus_type==BONUS_TYPE_YUNHEE_FIX?RES_CDN_CARD_MEDIUM_NTP+"m_"+gnrl.gnrl_id+".png":RES_CDN_CARD_MEDIUM_NTP+gnrl.gnrl_id+".png")}else icon_name=this.m_task.mission_task.bonus_type==BONUS_TYPE_YUNHEE_FIX?"#img_reward_yh_n.png":"#img_reward_"+leadingZeros(this.m_task.mission_task.bonus_type,2)+"_n.png";if(""!=icon_name){var reward_icon=cc.Sprite.create(icon_name);reward_icon.setAnchorPoint(ANCHOR_MIDDLE()),reward_icon.setPosition(ccCenter(icon_box)),reward_icon.setScale(.428),icon_box.addChild(reward_icon);var count_bg=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_valuebox.png");count_bg.setAnchorPoint(ANCHOR_MIDDLE()),count_bg.setPosition(.5*ccWidth(icon_box),7),this.m_task.mission_task.bonus_type==BONUS_TYPE_YUNHEE_FIX&&count_bg.setScale(IS_SP_BROWSER?.77:1.5),icon_box.addChild(count_bg);var count=0;count=this.m_task.mission_task.bonus_type==BONUS_TYPE_LOVE_ITEM?1:this.m_task.mission_task.bonus_type==BONUS_TYPE_YUNHEE_FIX?1:this.m_task.mission_task.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||this.m_task.mission_task.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT?1:this.m_task.mission_task.min_value;var reward_count=cmLabel.getLabel("x"+Number(count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_143);reward_count.setAnchorPoint(ANCHOR_MIDDLE()),reward_count.setPosition(ccCenter(count_bg)),count_bg.addChild(reward_count)}if(this.m_task.is_cleared){var cover=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",cc.Rect(1,1,1,1));cover.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),cover.setPosition(ZERO()),cover.setPreferredSize(size),this.addChild(cover),(flower=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_on.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),flower.setPosition(14,39),this.addChild(flower);var complete=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_complete.png");complete.setAnchorPoint(ANCHOR_MIDDLE()),complete.setPosition(ccCenter(size)),IS_SP_BROWSER&&complete.setScale(2),this.addChild(complete)}else{var flower;(flower=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_off.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),flower.setPosition(14,39),this.addChild(flower)}return!0}}),FriendListCell=cc.TableViewCell.extend({m_box:null,m_select_cover:null,m_join_btn:null,m_release_btn:null,m_is_join:!1,m_gnrl_icon:null,m_frnd_name:null,m_heart_count_label:null,m_gnrl_name:null,m_namingLabel:null,_callback_choice_friend:null,m_helper_type_icon:null,m_heart_icon:null,m_release_sprite:[],m_join_sprite:[],m_game_type:null,m_event_dungeon:null,m_buff_frame:null,m_bg_box:null,m_buff_sprite:null,m_icon_touch:null,reward_effect_label_0:null,reward_effect_label_1:null,reward_effect_label_2:null,reward_effect_label_3:null,reward_effect_label_4:null,m_reward_effect_label_0:null,m_reward_effect_label_1:null,m_reward_effect_label_2:null,m_reward_effect_label_3:null,m_reward_effect_label_4:null,m_reward_effect_label_5:null,m_ablility_effect_label:null,ctor:function(){this._super(),this.m_box=null,this.m_join_btn=null,this.m_release_btn=null,this.m_is_join=null,this._callback_choice_friend=null,this.m_release_sprite=[],this.m_join_sprite=[],this.m_game_type=db.BattleGameType.Mission,this.m_buff_frame=null,this.m_bg_box=null,this.m_buff_sprite=null,this.init()},init:function(){var nor,nor_label,on,on_label,cellSize=cc.size(444,124);this.setContentSize(cellSize),this.m_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero()),this.m_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_box.setPosition(ZERO()),this.m_box.setContentSize(cellSize),this.addChild(this.m_box),this.m_frnd_name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1812),this.m_frnd_name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_frnd_name.setPosition(221,89),this.m_box.addChild(this.m_frnd_name),this.m_helper_type_icon=cc.Sprite.create(),this.m_helper_type_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_helper_type_icon.setPosition(115,88),this.m_box.addChild(this.m_helper_type_icon),this.m_heart_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_heart_small.png"),this.m_heart_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_heart_icon.setPosition(119,61),this.m_box.addChild(this.m_heart_icon),this.m_heart_count_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2011),this.m_heart_count_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_heart_count_label.setPosition(147,62),this.m_box.addChild(this.m_heart_count_label),this.m_gnrl_name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2011),this.m_gnrl_name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_gnrl_name.setPosition(119,39),this.m_box.addChild(this.m_gnrl_name),this.m_namingLabel=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2011),this.m_namingLabel.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_namingLabel.setPosition(119,16),this.m_box.addChild(this.m_namingLabel),(nor=cc.Sprite.create("#btn_05_off.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),nor.setPosition(cellSize.width-13,.5*cellSize.height),(nor_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_MIDDLE()),nor_label.setPosition(ccCenter(nor)),nor.addChild(nor_label),this.m_box.addChild(nor),this.m_join_sprite.push(nor),(on=new cc.Sprite("#btn_05_on.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),on.setPosition(cellSize.width-13,.5*cellSize.height),(on_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_242)).setAnchorPoint(ANCHOR_MIDDLE()),on_label.setPosition(ccCenter(on)),on.addChild(on_label),this.m_box.addChild(on),on.setVisible(!1),this.m_join_sprite.push(on),(nor=cc.Sprite.create("#btn_04_off.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),nor.setPosition(cellSize.width-13,.5*cellSize.height),(nor_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_MIDDLE()),nor_label.setPosition(ccCenter(nor)),nor.addChild(nor_label),this.m_box.addChild(nor),this.m_release_sprite.push(nor),nor.setVisible(!1),(on=cc.Sprite.create("#btn_04_on.png")).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),on.setPosition(cellSize.width-13,.5*cellSize.height),(on_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_242)).setAnchorPoint(ANCHOR_MIDDLE()),on_label.setPosition(ccCenter(on)),on.addChild(on_label),this.m_box.addChild(on),this.m_release_sprite.push(on),on.setVisible(!1),this.m_select_cover=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_2.png",RectZero()),this.m_select_cover.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_select_cover.setPosition(ZERO()),this.m_select_cover.setPreferredSize(cellSize),this.addChild(this.m_select_cover),this.m_select_cover.setVisible(!1);var fadeIn=new cc.FadeIn(1),fadeOut=new cc.FadeOut(1),seq=new cc.Sequence(fadeIn,fadeOut),repeat=new cc.RepeatForever(seq);return this.m_select_cover.runAction(repeat),!0},setGameType:function(_type){this.m_game_type=_type},setEventDungeon:function(_eventduneon){this.m_event_dungeon=_eventduneon},setFriendData:function(frnd,is_join){this.m_is_join=is_join,this.m_frnd_data=frnd,this.updateCellLayout()},updateCellLayout:function(){var m=MasterManager.getInstance(),mt=MasterTable.getInstance(),gnrl_buffs=[],gnrl_buffs_check_period=[],gnrl_reward_buffs=[],gnrl_reward_buffs_period=[],dungeon_list=[],dungeon_ids=[];null!=this.m_gnrl_icon&&this.m_gnrl_icon.removeFromParent(),null!=this.m_bg_box&&(this.m_bg_box.removeAllChildren(),this.removeChild(this.m_bg_box),this.m_bg_box=null),this.m_bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",cc.Rect(20,20,20,20)),this.m_bg_box.setContentSize(200,0),this.m_bg_box.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_bg_box.setPosition(120,this.m_box.getContentSize().height),this.addChild(this.m_bg_box),this.m_bg_box.setVisible(!1),this.reward_effect_label_0=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2028),this.reward_effect_label_0.setAnchorPoint(ZERO()),this.m_bg_box.addChild(this.reward_effect_label_0),this.reward_effect_label_1=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2028),this.reward_effect_label_1.setAnchorPoint(ZERO()),this.m_bg_box.addChild(this.reward_effect_label_1),this.reward_effect_label_2=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2028),this.reward_effect_label_2.setAnchorPoint(ZERO()),this.m_bg_box.addChild(this.reward_effect_label_2),this.reward_effect_label_3=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2028),this.reward_effect_label_3.setAnchorPoint(ZERO()),this.m_bg_box.addChild(this.reward_effect_label_3),this.reward_effect_label_4=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2011),this.reward_effect_label_4.setAnchorPoint(ZERO()),this.m_bg_box.addChild(this.reward_effect_label_4),this.m_reward_effect_label_0=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2028),this.m_reward_effect_label_0.setAnchorPoint(ZERO()),this.m_reward_effect_label_0.setTag(99),this.m_bg_box.addChild(this.m_reward_effect_label_0),this.m_reward_effect_label_1=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2028),this.m_reward_effect_label_1.setAnchorPoint(ZERO()),this.m_reward_effect_label_1.setTag(99),this.m_bg_box.addChild(this.m_reward_effect_label_1),this.m_reward_effect_label_2=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2028),this.m_reward_effect_label_2.setAnchorPoint(ZERO()),this.m_reward_effect_label_2.setTag(99),this.m_bg_box.addChild(this.m_reward_effect_label_2),this.m_reward_effect_label_3=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2028),this.m_reward_effect_label_3.setAnchorPoint(ZERO()),this.m_reward_effect_label_3.setTag(99),this.m_bg_box.addChild(this.m_reward_effect_label_3),this.m_reward_effect_label_4=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2028),this.m_reward_effect_label_4.setAnchorPoint(ZERO()),this.m_reward_effect_label_4.setTag(99),this.m_bg_box.addChild(this.m_reward_effect_label_4),this.m_reward_effect_label_5=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2028),this.m_reward_effect_label_5.setAnchorPoint(ZERO()),this.m_reward_effect_label_5.setTag(99),this.m_bg_box.addChild(this.m_reward_effect_label_5),this.m_ablility_effect_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2011),this.m_ablility_effect_label.setAnchorPoint(ZERO()),this.m_ablility_effect_label.setTag(99),this.m_bg_box.addChild(this.m_ablility_effect_label);var card={},g=m.get_General(this.m_frnd_data.partner_gnrl_id);if(this.convertCardInfo(g,card),this.m_gnrl_icon=(new Card).createCard(card,CARD_TYPE.type_common_card),this.m_gnrl_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_gnrl_icon.setPosition(12,13),this.m_box.addChild(this.m_gnrl_icon),this.m_frnd_name.setString(this.m_frnd_data.nickname),this.m_frnd_data.helper_type==HELPTER_TYPE_FRIEND){var goods_func=m.get_GoodsFunction(GOODS_FUNCTION_BRING_FRND);this.m_heart_count_label.setString(goods_func.value),this.m_helper_type_icon.setTexture(RES_CDN_DEFULT+"menu_friend/img_friend_text_2.png"),this.m_heart_icon.setVisible(!0)}else this.m_heart_count_label.setString(""),this.m_helper_type_icon.setTexture(RES_CDN_DEFULT+"menu_friend/img_friend_text_1.png"),this.m_heart_icon.setVisible(!1);if(this.m_gnrl_name.setString(g.name),cmLabel.autoSizeFit(this.m_gnrl_name,200,20),null!=this.m_namingLabel&&(null!=this.m_frnd_data.naming&&null!=this.m_frnd_data.naming?this.m_namingLabel.setString(this.m_frnd_data.naming):this.m_namingLabel.setString("")),this.m_is_join?(this.m_release_sprite[0].setVisible(!0),this.m_release_sprite[1].setVisible(!1),this.m_join_sprite[0].setVisible(!1),this.m_join_sprite[1].setVisible(!1)):(this.m_join_sprite[0].setVisible(!0),this.m_join_sprite[1].setVisible(!1),this.m_release_sprite[0].setVisible(!1),this.m_release_sprite[1].setVisible(!1)),this.m_select_cover.setVisible(this.m_is_join),USE_FRIEND_SPEICAL_EFFECT&&this.m_game_type==db.BattleGameType.EventDungeon){dungeon_list=mt.get_EventDungeonList(this.m_event_dungeon.event_dungeon_period.event_dungeon_period_idx);dungeon_ids=[];for(var i=0;i<dungeon_list.length;i++)dungeon_ids.push(dungeon_list[i].event_dungeon_idx);this.m_buff_sprite=cc.Sprite.create(),this.m_buff_sprite.setAnchorPoint(ANCHOR_MIDDLE()),this.m_buff_sprite.setPosition(cc.p(this.m_gnrl_icon.width/2,this.m_gnrl_icon.height/2)),this.m_gnrl_icon.addChild(this.m_buff_sprite),this.m_buff_sprite.setVisible(!1);var animateBuff=MainAnimation.getInstance().getAnimation(MAIN_ANI_TYPE.CardSpecialEff);if(NOT_USE_SP_MAIN_ANIMATION){this.m_buff_sprite.setScale(2),this.m_buff_sprite.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_card_special_07.png");var fadeIn=new cc.FadeOut(.7),fadeOut=new cc.FadeIn(.7,90);seq=new cc.Sequence(fadeIn,fadeOut),repeat=new cc.RepeatForever(seq);this.m_buff_sprite.runAction(repeat),repeat=seq=fadeOut=fadeIn=null}else try{var seq=new cc.Sequence(animateBuff,new cc.DelayTime(.1)),repeat=new cc.RepeatForever(seq);this.m_buff_sprite.runAction(repeat)}catch(e){}}if(this.m_game_type==db.BattleGameType.EventDungeon){gnrl_buffs_check_period=mt.get_EventDungeonGeneralBuf(g.gnrl_group,dungeon_ids);for(i=0;i<gnrl_buffs_check_period.length;i++)EventDungeonService.getInstance().IsOpenEventDungeonBuff(gnrl_buffs_check_period[i].buff_period_idx)&&gnrl_buffs.push(gnrl_buffs_check_period[i]);gnrl_reward_buffs_period=mt.get_DungeonRewardBufGeneral(g.gnrl_group,dungeon_ids);for(i=0;i<gnrl_reward_buffs_period.length;i++)EventDungeonService.getInstance().IsOpenEventDungeonBuff(gnrl_reward_buffs_period[i].buff_period_idx)&&gnrl_reward_buffs.push(gnrl_reward_buffs_period[i])}if(0<gnrl_buffs.length||0<gnrl_reward_buffs.length){var is_visivle=!1;for(i=0;i<gnrl_buffs.length;i++)gnrl_buffs[i].dungeon_idx==this.m_event_dungeon.event_dungeon_idx&&(is_visivle=!0);for(i=0;i<gnrl_reward_buffs.length;i++)gnrl_reward_buffs[i].dungeon_idx==this.m_event_dungeon.event_dungeon_idx&&(is_visivle=!0);USE_FRIEND_SPEICAL_EFFECT&&null!=this.m_buff_sprite&&this.m_buff_sprite.setVisible(is_visivle)}var gnrlbuff={event_idx:0,dungeon_type:0,dungeon_idx:0,gnrl_group:0,buff_type:0,buff_value:0,trans_type:0,trans_resist_value:0,onoff:"n",special_buf_idx:0,buff_period_idx:0},gnrl_buff_stat=[];for(i=0;i<6;i++)gnrl_buff_stat.push($.extend({},gnrlbuff));for(var j=0;j<gnrl_buffs.length;j++)this.m_event_dungeon.event_dungeon_idx==gnrl_buffs[j].dungeon_idx&&(gnrl_buff_stat[gnrl_buffs[j].buff_type-1]=$.extend({},gnrl_buffs[j]));var offset_y=-10;if(0<gnrl_reward_buffs.length){for(i=0;i<gnrl_reward_buffs.length;i++)if(1==this.m_event_dungeon.event_dungeon.event_dungeon_type&&gnrl_reward_buffs[i].dungeon_idx==this.m_event_dungeon.event_dungeon_idx)switch(g.rare_type){case 5:this.reward_effect_label_0.setPosition(10,0-offset_y),this.reward_effect_label_0.setString(cmString("%s",res_str("friend_dungeon_reward_buff_rinrin"))),offset_y-=30;break;case 6:this.reward_effect_label_1.setPosition(10,0-offset_y),this.reward_effect_label_1.setString(cmString("%s",res_str("friend_dungeon_reward_buff_rinrin"))),offset_y-=30}else if(1!=gnrl_reward_buffs[i].dungeon_type&&gnrl_reward_buffs[i].dungeon_idx==this.m_event_dungeon.event_dungeon_idx)switch(g.rare_type){case 5:this.reward_effect_label_2.setPosition(10,0-offset_y),this.reward_effect_label_2.setString(cmString("%s",res_str("friend_dungeon_reward_buff_sr"))),offset_y-=30;break;case 6:this.reward_effect_label_3.setPosition(10,0-offset_y),this.reward_effect_label_3.setString(cmString("%s",res_str("friend_dungeon_reward_buff_ssr"))),offset_y-=30}this.reward_effect_label_4.setPosition(10,0-offset_y),this.reward_effect_label_4.setString(cmString("%s",res_str("friend_dungeon_reward_buff_text"))),offset_y-=30}if(0<gnrl_buffs.length){for(var idx=5;0<=idx;idx--){var found=!1,reward_effect_label="",buff=gnrl_buff_stat[idx];if(0!=buff.buff_value&&buff.dungeon_idx==this.m_event_dungeon.event_dungeon_idx)switch(buff.buff_type){case COMBO_STAT_ATTK_PLUS:reward_effect_label=cmString(res_str("friend_dungeon_battle_buff_attack"),Math.floor(buff.buff_value/1e4)),found=!0;break;case COMBO_STAT_ATTK:reward_effect_label=cmString(res_str("friend_dungeon_battle_buff_attack"),Math.floor(buff.buff_value+1e4)/1e4),found=!0;break;case COMBO_STAT_DEF_PLUS:reward_effect_label=cmString(res_str("friend_dungeon_battle_buff_defence"),Math.floor(buff.buff_value/1e4)),found=!0;break;case COMBO_STAT_DEF:reward_effect_label=cmString(res_str("friend_dungeon_battle_buff_defence"),Math.floor(buff.buff_value+1e4)/1e4),found=!0;break;case COMBO_STAT_HP_PLUS:reward_effect_label=cmString(res_str("friend_dungeon_battle_buff_health"),Math.floor(buff.buff_value/1e4)),found=!0;break;case COMBO_STAT_HP:reward_effect_label=cmString(res_str("friend_dungeon_battle_buff_health"),Math.floor(buff.buff_value+1e4)/1e4),found=!0}found&&(5==idx?(this.m_reward_effect_label_5.setPosition(10,0-offset_y),this.m_reward_effect_label_5.setString(reward_effect_label)):4==idx?(this.m_reward_effect_label_4.setPosition(10,0-offset_y),this.m_reward_effect_label_4.setString(reward_effect_label)):3==idx?(this.m_reward_effect_label_3.setPosition(10,0-offset_y),this.m_reward_effect_label_3.setString(reward_effect_label)):2==idx?(this.m_reward_effect_label_2.setPosition(10,0-offset_y),this.m_reward_effect_label_2.setString(reward_effect_label)):1==idx?(this.m_reward_effect_label_1.setPosition(10,0-offset_y),this.m_reward_effect_label_1.setString(reward_effect_label)):0==idx&&(this.m_reward_effect_label_0.setPosition(10,0-offset_y),this.m_reward_effect_label_0.setString(reward_effect_label)),offset_y-=30)}this.m_ablility_effect_label.setPosition(10,0-offset_y),this.m_ablility_effect_label.setString(cmString("%s",res_str("friend_dungeon_battle_buff_text"))),offset_y-=30}this.m_bg_box.setContentSize(200,0-offset_y)},convertCardInfo:function(g,card){card.gnrl_id=this.m_frnd_data.partner_gnrl_id,card.level=this.m_frnd_data.partner_gnrl_lv,card.limit_step_id=this.m_frnd_data.partner_gnrl_limit_step_id},highlightPosInCell:function(pos){var r=this.m_join_sprite[0].getBoundingBox();if(cc.rectContainsPoint(r,pos)&&(this.m_is_join?(this.m_release_sprite[0].setVisible(!1),this.m_release_sprite[1].setVisible(!0)):(this.m_join_sprite[0].setVisible(!1),this.m_join_sprite[1].setVisible(!0))),USE_FRIEND_SPEICAL_EFFECT){r=this.m_gnrl_icon.getBoundingBox();cc.rectContainsPoint(r,pos)&&null!=this.m_buff_sprite&&this.m_buff_sprite.isVisible()&&this.m_bg_box.setVisible(!0)}},unhighlightPosInCell:function(pos){var r=this.m_join_sprite[0].getBoundingBox();if(cc.rectContainsPoint(r,pos)&&(this.m_is_join?(this.m_release_sprite[0].setVisible(!0),this.m_release_sprite[1].setVisible(!1)):(this.m_join_sprite[0].setVisible(!0),this.m_join_sprite[1].setVisible(!1))),USE_FRIEND_SPEICAL_EFFECT){r=this.m_gnrl_icon.getBoundingBox();cc.rectContainsPoint(r,pos)&&null!=this.m_buff_sprite&&this.m_buff_sprite.isVisible()&&1==this.m_bg_box.isVisible()&&this.m_bg_box.setVisible(!1)}},touchPosCell:function(pos,world_pos){if(USE_FRIEND_SPEICAL_EFFECT){var r=this.m_gnrl_icon.getBoundingBox();cc.rectContainsPoint(r,pos)&&null!=this.m_buff_sprite&&this.m_bg_box.setVisible(!0)}},touchPosInCell:function(pos){var tutorial=TutorialContextV2.getInstance(),r=this.m_join_sprite[0].getBoundingBox();if(cc.rectContainsPoint(r,pos)){if(AudioEngine.getInstance().playNormaButtonSound(),this.m_is_join)tutorial.IsCompleteAllTutorial()&&(this.m_release_sprite[0].setVisible(!0),this.m_release_sprite[1].setVisible(!1)),null!=this._callback_choice_friend&&tutorial.IsCompleteAllTutorial()&&this._callback_choice_friend(-1);else if(tutorial.IsCompleteAllTutorial()&&(this.m_join_sprite[0].setVisible(!0),this.m_join_sprite[0].setVisible(!1)),null!=this._callback_choice_friend&&tutorial.IsCompleteAllTutorial()){var idx=this.getIdx();this._callback_choice_friend(idx)}AudioEngine.getInstance().playEffect(RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3")}},HidePopUp:function(){USE_FRIEND_SPEICAL_EFFECT&&null!=this.m_buff_sprite&&this.m_buff_sprite.isVisible()&&this.m_bg_box.setVisible(!1)}}),SkipTicketInfo=cc.Class.extend({spend_ticket_count:0,spend_key_count:0,amount_skip_count:0,ctor:function(){this.spend_ticket_count=0,this.spend_key_count=0,this.amount_skip_count=0}}),LONG_CLICK="logn_click",GetFontSize=function(font){var rVal=12;return(rVal=1e3<=font?Math.floor(font/100):Math.floor(font/10))<12?rVal=12:80<rVal&&(rVal=80),rVal},FriendSelectLayer_V2=cc.Layer.extend({m_sort:null,m_isSortBtnVisible:!1,m_isSortDesc:!0,m_friend_select_idx:0,m_leader_node:null,m_layer:null,m_deckBoxLayer:null,m_npcdeckBoxLayer:null,m_leftLayer:null,m_rightLayer:null,m_sortLayer:null,m_user_cost_label:null,m_sort_label_on:null,m_sort_label_off:null,m_btn_battle_formation:null,m_btn_arrow_off:null,m_btn_arrow_on:null,m_btn_sort:null,m_btn_sort_2:null,m_btn_sort_2_off:null,m_btn_sort_2_on:null,m_key_ani_img:null,m_friend_select_tv:null,m_message_box:null,m_friend_select_scene:null,tooltip_box:null,tooltip_content:null,m_wp_tooltip_box:null,m_wp_tooltip_content:null,m_troops_btns:[],m_mussang:null,m_start_btn:null,m_tower_dungeon:null,m_weekly_dungeon:null,m_weekly_difficulty:null,m_mission:null,m_event_dungeon:null,m_daily_dungeon:null,m_great_wall_dungeon:null,m_once_a_day_dungeon:null,m_gnrl_body:null,m_boss_container:null,m_btn_battle_1:null,m_btn_battle_2:null,m_btn_battle_3:null,m_skip_ticket_count:1,m_skip_ticket_default:1,m_have_skip_ticket_count:0,m_boss_Damage:0,m_taskSakuraSprList:[],m_skipTicketCountLabel:null,m_haveSkipTicketCountLabel:null,m_haveSkipTicketLabel:null,m_startSkipTicketModalLayer:null,m_itemMinusBtn:null,m_itemPlusBtn:null,m_startBtn:null,m_task:null,m_long_touch_cell:null,m_isLongTouch:!1,m_story_hard_mode_mission:null,m_story_hard_mode_try_count:null,m_story_hard_mode_charge_count:null,m_message_box2:null,ctor:function(){this.m_troops_btns=[],this.m_task=null,this.m_mission=$.extend({},database.BattleMainMission),this.m_mussang=$.extend({},database.BattleMussang),this.m_weekly_difficulty=$.extend({},database.BattleWeeklyDungeonDifficulty),this.m_event_dungeon=$.extend({},database.BattleEventDungeon),this.m_story_hard_mode_mission=$.extend({},database.BattleStoryHardModeMission),this.m_story_hard_mode_try_count=null,this.m_story_hard_mode_charge_count=null,this.m_message_box2=null,this._super()},initLayout:function(scene){this.m_friend_select_scene=scene;var tutorial=TutorialContextV2.getInstance(),is_auto_friend_select=0!=GameDefault.getInstance().getOptionFriend();is_auto_friend_select&&tutorial.IsCompleteAllTutorial()||(this.m_friend_select_idx=-1),this.m_layer=new cc.Layer,this.addChild(this.m_layer),this.m_game_type=BattleContext._getInstance().getGameType();var context=BattleContext._getInstance(),service=BattleService.getInstance(),troops_num=this.getCurrentTroopsNum();if(this.m_game_type==db.BattleGameType.Mission){var mission_id=context.getMissionID();service.getMainMissionAndNpc(mission_id,this.m_mission)}else if(this.m_game_type==db.BattleGameType.StoryHardMode){var main_story_hard_mode_mission_idx=context.getStoryHardModeMissionId();cc.log("########  BattleContext.getStoryHardModeMissionId == ",main_story_hard_mode_mission_idx),service.getStoryHardModeMissionAndNpc(main_story_hard_mode_mission_idx,this.m_story_hard_mode_mission)}else if(this.m_game_type==db.BattleGameType.WeeklyDungeon)this.m_weekly_difficulty=context.getWeeklyDungeonDifficulty(),this.m_weekly_dungeon=context.getWeeklyDungeonData();else if(this.m_game_type==db.BattleGameType.Mussang){var mussang_id=context.getMussangId();service.getMasterMussangStepStageNpc(mussang_id,this.m_mussang)}else if(this.m_game_type==db.BattleGameType.EventDungeon)this.m_event_dungeon=context.getEventDungeonData();else if(this.m_game_type==db.BattleGameType.DailyDungeon)this.m_daily_dungeon=context.getDailyDungeonData();else if(this.m_game_type==db.BattleGameType.GreatWallDungeon)this.m_great_wall_dungeon=context.getGreatWallDungeonData();else if(this.m_game_type==db.BattleGameType.TowerDungeon);else if(this.m_game_type==db.BattleGameType.OnceADayDungeon)this.m_once_a_day_dungeon=context.getEventOnceADayDungeonData();else if(this.m_game_type==db.BattleGameType.EventRaidDungeon){var winSize=ccSize(this);this.m_boss_container=new cc.Node,this.m_boss_container.setPosition(winSize.width,0),this.m_layer.addChild(this.m_boss_container),this.m_gnrl_body=cc.Sprite.create(),this.m_gnrl_body.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_gnrl_body.setScale(2),this.m_boss_container.addChild(this.m_gnrl_body);var scaleTo_1=cc.scaleTo(.7,2,2.01),scaleTo_2=cc.scaleTo(.7,2,1.99),sequence=cc.sequence(scaleTo_1,scaleTo_2),repeat=cc.repeatForever(sequence);this.m_gnrl_body.runAction(repeat);var mask_bg=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_normal_4.png",cc.rect());mask_bg.setContentSize(644,640),mask_bg.setAnchorPoint(ZERO()),mask_bg.setPosition(LP(this,300,0)),this.m_layer.addChild(mask_bg)}this.m_leftLayer=this.getLeftBoxLayer(),this.m_leftLayer.setAnchorPoint(ZERO()),this.m_leftLayer.setPosition((ccWidth(this)-533)/2-ccWidth(this.m_leftLayer)/2,0),this.m_layer.addChild(this.m_leftLayer,2),this.updateLeaderSkill(troops_num),this.m_game_type==db.BattleGameType.GreatWallDungeon?(this.m_rightLayer=this.getGreatWallRightBoxLayer(),this.m_rightLayer.ignoreAnchorPointForPosition(!1),this.m_rightLayer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_rightLayer.setPosition(ccWidth(this),0)):this.m_game_type==db.BattleGameType.EventRaidDungeon?(this.updateRightBoxBG(),USE_SP_EVENT_SCALE?this.m_rightLayer=this.getEventRaidRightBoxLayer_SP():this.m_rightLayer=this.getEventRaidRightBoxLayer(),this.m_rightLayer.ignoreAnchorPointForPosition(!1),this.m_rightLayer.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_rightLayer.setPosition(LP(this,479,0))):(this.m_rightLayer=this.getRightBoxLayer(),this.m_rightLayer.ignoreAnchorPointForPosition(!1),this.m_rightLayer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_rightLayer.setPosition(ccWidth(this),0)),this.m_layer.addChild(this.m_rightLayer),this.m_game_type!=db.BattleGameType.Mission&&this.m_game_type!=db.BattleGameType.EventDungeon&&this.m_game_type!=db.BattleGameType.StoryHardMode||is_auto_friend_select&&0<this.m_frnd_list.length&&tutorial.IsCompleteAllTutorial()&&this.choiceFriend(0),this.m_message_box=new GameMessageBox,this.addChild(this.m_message_box,11e4),this.m_message_box2=new CTGameMessageBox,this.addChild(this.m_message_box2,110002),this.m_startSkipTicketModalLayer=new GameMessageBox,this.addChild(this.m_startSkipTicketModalLayer,1e3)},getGreatWallRightBoxLayer:function(){MasterManager.getInstance();var service=BattleService.getInstance(),layer=new cc.Layer;layer.setContentSize(481,568),layer.setPosition(LP(this,479,0));for(var layerSize=ccSize(layer),dungeon=BattleContext._getInstance().getGreatWallDungeonData(),npc_list=dungeon.stage_npc[1],gnrl_group=0,idx=0;idx<npc_list.length;idx++){var n=npc_list[idx];if(n.is_zoom){gnrl_group=n.general.gnrl_group;break}}var warboss="";warboss=gnrl_group<100?RES_CDN_DEFULT+cmString("card_war_boss/%02d.png",gnrl_group):RES_CDN_DEFULT+"card_war_boss/"+gnrl_group+".png",resourceLoader(warboss,function(){var gnrl_body=cc.Sprite.create(warboss);gnrl_body.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),gnrl_body.setScaleX(2),gnrl_body.setScaleY(2),gnrl_body.setPosition(layerSize.width,0),gnrl_body.zIndex=-10,layer.addChild(gnrl_body);var scaleTo_1=cc.scaleTo(.7,2,2.01),scaleTo_2=cc.scaleTo(.7,2,1.99),sequence=cc.sequence(scaleTo_1,scaleTo_2),repeat=cc.repeatForever(sequence);gnrl_body.runAction(repeat)}.bind(this));var mask_bg=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_normal_4.png",RectZero());mask_bg.setContentSize(644,640),mask_bg.setAnchorPoint(ZERO()),mask_bg.setPosition(-200,0),layer.addChild(mask_bg);var dungeon_name=cc.Sprite.create(RES_CDN_DEFULT+"menu_great_wall/img_great_wall_text_2.png");if(dungeon_name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),dungeon_name.setPosition(19,525),layer.addChild(dungeon_name),this.m_great_wall_dungeon.is_complete){var complete=cc.Sprite.create(RES_CDN_DEFULT+"menu_great_wall/img_great_wall_complete_2.png");complete.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),complete.setPosition(207,493),USE_SP_GREATWALL_SCALE&&complete.setScale(2),layer.addChild(complete)}(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(circle_point),circle_point.setPosition(19,487);var step_title=cmLabel.getLabel(res_str("label_great_wall_stage_title"),LABEL_FONT_INDEX.FONT_248);step_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),step_title.setPosition(35,479),layer.addChild(step_title);var dungeon_step=cmLabel.getLabel(cmString(res_str("label_great_wall_stage_step"),dungeon.great_wall_dungeon_step),LABEL_FONT_INDEX.FONT_241);dungeon_step.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),dungeon_step.setPosition(108,479),layer.addChild(dungeon_step),(line=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(line),line.setPosition(19,465),(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(circle_point),circle_point.setPosition(19,436);var appear_gnrl_title=cmLabel.getLabel(res_str("label_mussang_enemy_title"),LABEL_FONT_INDEX.FONT_248);appear_gnrl_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),appear_gnrl_title.setPosition(35,428),layer.addChild(appear_gnrl_title);var npc_pos=[];npc_pos.push_back(cc.p(19,314)),npc_pos.push_back(cc.p(91,350)),npc_pos.push_back(cc.p(91,268)),npc_pos.push_back(cc.p(163,350)),npc_pos.push_back(cc.p(163,268));MasterManager.getInstance();for(var i=0;i<npc_pos.length;i++){var npc=new NpcInfoItemNode(CARD_TYPE.type_card_thumb,this.m_game_type);npc.setPosition(npc_pos.at(i)),npc.setGlobalZOrderTooltip(!0),layer.addChild(npc);var battle_position=i+1;if(i<npc_list.length){var isPosition=!0;npc.setVisible(!0);for(idx=0;idx<npc_list.length;idx++){isPosition=battle_position==npc_list[i].position}if(isPosition!=npc_list.end()){var g=npc_list[i];npc.setBattleGeneralData(g,g.is_zoom),npc.setVisible(!0)}else npc.setVisible(!1)}else npc.setVisible(!1)}var weak_point_tag=cc.Sprite.create("#btn_tip_off.png");weak_point_tag.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),weak_point_tag.setPosition(19,220),layer.addChild(weak_point_tag,99999);var tooltip_btn=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(1,1,1,1)));tooltip_btn.setAnchorPoint(ANCHOR_MIDDLE()),tooltip_btn.setPreferredSize(ccSize(weak_point_tag)),tooltip_btn.setPosition(ccCenter(weak_point_tag)),weak_point_tag.addChild(tooltip_btn),tooltip_btn.addTargetWithActionForControlEvents(this,this.onTouchWeakPointTooltip,cc.CONTROL_EVENT_TOUCH_DOWN),tooltip_btn.addTargetWithActionForControlEvents(this,this.onTouchWeakPointTooltip,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onTouchWeakPointTooltip,cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onTouchWeakPointTooltip,cc.CONTROL_EVENT_TOUCH_CANCEL);var boxSize=ccSize(weak_point_tag);if(null==this.m_wp_tooltip_box){this.m_wp_tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.m_wp_tooltip_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM());var world_pos=layer.convertToWorldSpace(weak_point_tag.getPosition());world_pos.x=world_pos.x+2*boxSize.width,world_pos.y=world_pos.y+boxSize.height+5,this.m_wp_tooltip_box.setPosition(world_pos),this.m_wp_tooltip_box.setVisible(!1),this.getParent().addChild(this.m_wp_tooltip_box)}null==this.m_wp_tooltip_content&&(this.m_wp_tooltip_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.m_wp_tooltip_content.setAnchorPoint(ANCHOR_MIDDLE()),this.m_wp_tooltip_box.addChild(this.m_wp_tooltip_content));var line,circle_point,boss_weak_point=cmLabel.getLabel(cmString(res_str("label_great_wall_dungeon_boss_weak_point"),dungeon.great_wall_dungeon.boss_weak_point),LABEL_FONT_INDEX.FONT_2014);boss_weak_point.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),boss_weak_point.setPosition(100,220),layer.addChild(boss_weak_point),(line=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ZERO()),layer.addChild(line),line.setPosition(19,212),(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(circle_point),circle_point.setPosition(19,182);var bonus_title=cmLabel.getLabel(res_str("label_reward_bonus"),LABEL_FONT_INDEX.FONT_248);if(bonus_title.setAnchorPoint(ZERO()),bonus_title.setPosition(35,174),layer.addChild(bonus_title),dungeon.is_first_clear){var replace_reward_list=MasterTable.getInstance().get_GreatWallDungeonReplaceBonusItemList(dungeon.great_wall_dungeon.great_wall_dungeon_replace_bonus_idx),offset_x=19;for(i=0;i<replace_reward_list.length;i++){var reward=replace_reward_list.at(i),item={};service.convertBonusInfo3(reward,item),(bonus=new MissionPreviewBonusItemCell).setEnableToolTip(!0),bonus.setEnableItemCount(!1),bonus.setEnableItemCount(1e4==reward.bonus_gain_rate&&reward.min_value==reward.max_value),bonus.setPosition(offset_x,96),bonus.setGainItem(item),layer.addChild(bonus,999991),offset_x+=72}}else{var reward_list=MasterTable.getInstance().get_GreatWallDungeonBonusItemList(dungeon.great_wall_dungeon.great_wall_dungeon_bonus_idx);for(offset_x=19,i=0;i<reward_list.length;i++){var bonus;reward=reward_list.at(i),item={};service.convertBonusInfo3(reward,item),(bonus=new MissionPreviewBonusItemCell).setEnableToolTip(!0),bonus.setEnableItemCount(1e4==reward.bonus_gain_rate&&reward.min_value==reward.max_value),bonus.setPosition(offset_x,96),bonus.setGainItem(item),layer.addChild(bonus,999991),offset_x+=72}}this.checkNeedKeyGreatWallDungeon();var start_btn=new LabelButton("btn_03_off.png","btn_03_on.png","",ccui.Widget.PLIST_TEXTURE);return start_btn.setFont(LABEL_FONT_INDEX.FONT_241),start_btn.setString(res_str("label_start_mission")),start_btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),start_btn.setPosition(.5*layerSize.width,16),start_btn.setSoundPath("SE_button_key.mp3"),start_btn.addClickEventListener(function(sender){this.battleStart()}.bind(this),.4,"battle_begin"),start_btn.setEnabled(!this.m_great_wall_dungeon.is_complete),layer.addChild(start_btn),layer},updateRightBoxBG:function(){var winSize=ccSize(this);this.m_boss_container.isRunning()&&this.m_boss_container.stopAllActions();var m=MasterManager.getInstance(),npc=m.get_EventRaidDungeonNpc(NetService().get_Event_Raid_Dungeon_idx(),1),n=m.get_NpcGeneral(npc.npc1_idx),boss_image=(m.get_General(n.gnrl_id),"");boss_image=n.gnrl_group<100?RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(n.gnrl_group,2)+".png":RES_CDN_DEFULT+"card_war_boss/"+n.gnrl_group+".png",resourceLoader(boss_image,function(){var frame_texture=cc.textureCache.addImage(boss_image),frame=new cc.SpriteFrame(frame_texture,cc.rect(0,0,frame_texture.getContentSize().width,frame_texture.getContentSize().height));this.m_gnrl_body.setSpriteFrame(frame),this.m_boss_container.setPosition(winSize.width+ccWidth(this.m_gnrl_body),0);var pos=cc.p(winSize.width,0),move=new cc.MoveTo(.2,pos);this.m_boss_container.runAction(move)}.bind(this))},getEventRaidRightBoxLayer:function(){var layer=new cc.Layer;layer.setContentSize(481,568);MasterTable.getInstance();var nService=NetService(),service=EventDungeonService.getInstance(),event_raid_info=nService.get_Event_Raid_Dungeon_Info(),period=(nService.get_Event_Raid_Dungeon_User_Info(),MasterManager.getInstance().get_EventDungeonPeriod(event_raid_info.event_dungeon_period_idx)),e_service=EventDungeonService.getInstance(),first_idx=e_service.getEventDungeonFirstHalfPeriodIdx(period.event_dungeon_group_idx),second_idx=e_service.getEventDungeonSecondHalfPeriodIdx(period.event_dungeon_group_idx),is_second=!1,event_dungeon_point=(nService.get_User_Event_Raid_ConquestCount(first_idx),nService.get_User_Event_Raid_AccumDamage(first_idx),{});service.getUserEventDungeonPoint(first_idx,event_dungeon_point);var point_count=event_dungeon_point.accum_event_point-event_dungeon_point.event_point;event_raid_info.event_dungeon_period_idx==second_idx&&(is_second=!0,nService.get_User_Event_Raid_ConquestCount(second_idx),nService.get_User_Event_Raid_AccumDamage(second_idx),service.getUserEventDungeonPoint(second_idx,event_dungeon_point),point_count=event_dungeon_point.accum_event_point-event_dungeon_point.event_point);var label="",eventvs_banner=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_banner_raid.png",event_raid_info.event_dungeon_period_idx));eventvs_banner.setAnchorPoint(ANCHOR_TOP_LEFT()),eventvs_banner.setPosition(0,ccHeight(layer)),layer.addChild(eventvs_banner);var circle_white_1=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_white.png");circle_white_1.setAnchorPoint(ZERO()),circle_white_1.setPosition(19,267),layer.addChild(circle_white_1),label="[]",is_second&&(label="[]");var boss_count_label=new cmMultiLabel;boss_count_label.addLabel(label,LABEL_FONT_INDEX.FONT_241),boss_count_label.addLabel(" ("+Number(event_raid_info.event_raid_boss_info.boss_num).toLocaleString("en")+")",LABEL_FONT_INDEX.FONT_2011),boss_count_label.setLabel(),boss_count_label.enableOutline(cc.color.BLACK,1),boss_count_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),boss_count_label.setPosition(33,270),layer.addChild(boss_count_label);var circle_white_3=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_white.png");circle_white_3.setAnchorPoint(ZERO()),circle_white_3.setPosition(19,235),layer.addChild(circle_white_3);var label_1="";is_second&&(label_1="");var accum_damage_label=new cmMultiLabel;accum_damage_label.addLabel(label_1,LABEL_FONT_INDEX.FONT_241),accum_damage_label.addLabel(" ("+Number(point_count).toLocaleString("en")+")",LABEL_FONT_INDEX.FONT_2011),accum_damage_label.enableOutline(cc.color.BLACK,1),accum_damage_label.setLabel(),accum_damage_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),accum_damage_label.setPosition(33,236),layer.addChild(accum_damage_label);var offset_x=6,offset_y=16,dungeon_idx=NetService().get_Event_Raid_Dungeon_idx(),base_point=MasterManager.getInstance().get_EventRaidDungeon(dungeon_idx).base_need_point,ticket_count_1=MasterManager.getInstance().get_EventRaidDungeon(dungeon_idx).multiple_1,ticket_count_2=MasterManager.getInstance().get_EventRaidDungeon(dungeon_idx).multiple_2,ticket_count_3=MasterManager.getInstance().get_EventRaidDungeon(dungeon_idx).multiple_3,btn_string_1=res_str("event_raid_start_1"),btn_string_2=cmString(res_str("event_raid_start_2"),ticket_count_2),btn_string_3=cmString(res_str("event_raid_start_2"),ticket_count_3),on=RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_raid_on.png",event_raid_info.event_dungeon_period_idx),off=RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_raid_off.png",event_raid_info.event_dungeon_period_idx),none=RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_raid_none.png",event_raid_info.event_dungeon_period_idx),btnSize=cc.size(156,78);this.m_btn_battle_1=new ccui.Button(off,on,none),this.m_btn_battle_1.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_btn_battle_1.setPosition(offset_x,16),this.m_btn_battle_1.addClickEventListener(function(sender){this.EventRaidBattleStart(ticket_count_1)}.bind(this)),layer.addChild(this.m_btn_battle_1);var btn_info_box_1=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());btn_info_box_1.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn_info_box_1.setPosition(.5*btnSize.width,9),btn_info_box_1.setContentSize(104,26),this.m_btn_battle_1.addChild(btn_info_box_1);var point_label_1=cmLabel.getLabel(Number(base_point*ticket_count_1).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810);point_label_1.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),point_label_1.setPosition(ccWidth(btn_info_box_1)-10,.5*ccHeight(btn_info_box_1)),btn_info_box_1.addChild(point_label_1);var btn_point_1=cc.Sprite.create(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_point.png",event_raid_info.event_dungeon_period_idx));btn_point_1.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn_point_1.setPosition(17,9),this.m_btn_battle_1.addChild(btn_point_1);var btn_label_1=cmLabel.getLabel(btn_string_1,LABEL_FONT_INDEX.FONT_221);btn_label_1.enableOutline(cc.color.BLACK,2),btn_label_1.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn_label_1.setPosition(.5*btnSize.width,45),this.m_btn_battle_1.addChild(btn_label_1),offset_x+=btnSize.width,this.m_btn_battle_2=new ccui.Button(off,on,none),this.m_btn_battle_2.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_btn_battle_2.setPosition(offset_x,16),this.m_btn_battle_2.addClickEventListener(function(sender){this.EventRaidBattleStart(ticket_count_2)}.bind(this)),layer.addChild(this.m_btn_battle_2);var btn_info_box_2=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());btn_info_box_2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn_info_box_2.setPosition(.5*btnSize.width,9),btn_info_box_2.setContentSize(104,26),this.m_btn_battle_2.addChild(btn_info_box_2);var point_label_2=cmLabel.getLabel(Number(base_point*ticket_count_2).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810);point_label_2.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),point_label_2.setPosition(ccWidth(btn_info_box_2)-10,.5*ccHeight(btn_info_box_2)),btn_info_box_2.addChild(point_label_2);var btn_point_2=cc.Sprite.create(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_point.png",event_raid_info.event_dungeon_period_idx));btn_point_2.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn_point_2.setPosition(17,9),this.m_btn_battle_2.addChild(btn_point_2);var btn_label_2=cmLabel.getLabel(btn_string_2,LABEL_FONT_INDEX.FONT_221);btn_label_2.enableOutline(cc.color.BLACK,2),btn_label_2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn_label_2.setPosition(.5*btnSize.width,45),this.m_btn_battle_2.addChild(btn_label_2),offset_x+=btnSize.width,this.m_btn_battle_3=new ccui.Button(off,on,none),this.m_btn_battle_3.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_btn_battle_3.setPosition(offset_x,16),this.m_btn_battle_3.addClickEventListener(function(sender){this.EventRaidBattleStart(ticket_count_3)}.bind(this)),layer.addChild(this.m_btn_battle_3);var btn_info_box_3=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());btn_info_box_3.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn_info_box_3.setPosition(.5*btnSize.width,9),btn_info_box_3.setContentSize(104,26),this.m_btn_battle_3.addChild(btn_info_box_3);var point_label_3=cmLabel.getLabel(Number(base_point*ticket_count_3).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810);point_label_3.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),point_label_3.setPosition(ccWidth(btn_info_box_3)-10,.5*ccHeight(btn_info_box_3)),btn_info_box_3.addChild(point_label_3);var btn_point_3=cc.Sprite.create(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_point.png",event_raid_info.event_dungeon_period_idx));btn_point_3.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn_point_3.setPosition(17,9),this.m_btn_battle_3.addChild(btn_point_3);var btn_label_3=cmLabel.getLabel(btn_string_3,LABEL_FONT_INDEX.FONT_221);btn_label_3.enableOutline(cc.color.BLACK,2),btn_label_3.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn_label_3.setPosition(.5*btnSize.width,45),this.m_btn_battle_3.addChild(btn_label_3),offset_x+=btnSize.width,offset_y+=btnSize.height+12;var eventvs_point=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_info_2.png",NetService().get_Event_Raid_Dungeon_Period_idx()));eventvs_point.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),eventvs_point.setPosition(19,offset_y),layer.addChild(eventvs_point);var user_point=cmLabel.getLabel(event_dungeon_point.event_point.toLocaleString("en"),LABEL_FONT_INDEX.FONT_165);user_point.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),user_point.setPosition(201,14),eventvs_point.addChild(user_point),offset_y+=ccHeight(eventvs_point)+14;var life_bar_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_gauge.png");life_bar_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),life_bar_bg.setPosition(0,150),layer.addChild(life_bar_bg,100),offset_y+=ccHeight(life_bar_bg)+10;var bar=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_gauge_red_3.png"),life_bar=new cc.ProgressTimer(bar);life_bar.setAnchorPoint(ANCHOR_MIDDLE()),life_bar.setMidpoint(ANCHOR_MIDDLE_LEFT()),life_bar.setBarChangeRate(cc.p(1,0)),life_bar.setPosition(ccCenter(life_bar_bg)),life_bar.setType(cc.ProgressTimer.TYPE_BAR),life_bar_bg.addChild(life_bar);dungeon_idx=NetService().get_Event_Raid_Dungeon_idx();var dungeon_raid_boss=MasterManager.getInstance().get_EventRaidDungeon(dungeon_idx),max_hp=dungeon_raid_boss.boss_hp;null==dungeon_raid_boss.boss_hp&&(max_hp=0);var per=Math.floor(event_raid_info.event_raid_boss_info.remain_hp/max_hp*100);life_bar.setPercentage(per);var remain_hp=cmLabel.getLabel(cmString(res_str("label_event_raid_ramain_life"),event_raid_info.event_raid_boss_info.remain_hp.toLocaleString("en"),max_hp.toLocaleString("en")),LABEL_FONT_INDEX.FONT_181);remain_hp.enableOutline(cc.color.BLACK,1),remain_hp.setAnchorPoint(ANCHOR_MIDDLE()),remain_hp.setPosition(ccCenter(life_bar_bg).x,ccCenter(life_bar_bg).y+1),life_bar_bg.addChild(remain_hp);var npc=MasterManager.getInstance().get_EventRaidDungeonNpc(nService.get_Event_Raid_Dungeon_idx(),1),n=MasterManager.getInstance().get_NpcGeneral(npc.npc1_idx),gnrl=MasterManager.getInstance().get_General(n.gnrl_id),element=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_raid/img_raid_battletech_%d.png",gnrl.element_type));element.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),element.setPosition(19,180),layer.addChild(element);var Font_Index=0;switch(gnrl.element_type){case 1:Font_Index=LABEL_FONT_INDEX.FONT_305;break;case 2:Font_Index=LABEL_FONT_INDEX.FONT_306;break;case 3:Font_Index=LABEL_FONT_INDEX.FONT_307;break;case 4:Font_Index=LABEL_FONT_INDEX.FONT_308;break;case 5:Font_Index=LABEL_FONT_INDEX.FONT_309}var boss_name_label=cmLabel.getLabel(gnrl.name,Font_Index);return boss_name_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),boss_name_label.setPosition(79,185),layer.addChild(boss_name_label),layer},getEventRaidRightBoxLayer_SP:function(){var layer=new cc.Layer;layer.setContentSize(481,568);MasterTable.getInstance();var nService=NetService(),service=EventDungeonService.getInstance(),event_raid_info=nService.get_Event_Raid_Dungeon_Info(),period=(nService.get_Event_Raid_Dungeon_User_Info(),MasterManager.getInstance().get_EventDungeonPeriod(event_raid_info.event_dungeon_period_idx)),e_service=EventDungeonService.getInstance(),first_idx=e_service.getEventDungeonFirstHalfPeriodIdx(period.event_dungeon_group_idx),second_idx=e_service.getEventDungeonSecondHalfPeriodIdx(period.event_dungeon_group_idx),is_second=!1,event_dungeon_point=(nService.get_User_Event_Raid_ConquestCount(first_idx),nService.get_User_Event_Raid_AccumDamage(first_idx),{});service.getUserEventDungeonPoint(first_idx,event_dungeon_point);var point_count=event_dungeon_point.accum_event_point-event_dungeon_point.event_point;event_raid_info.event_dungeon_period_idx==second_idx&&(is_second=!0,nService.get_User_Event_Raid_ConquestCount(second_idx),nService.get_User_Event_Raid_AccumDamage(second_idx),service.getUserEventDungeonPoint(second_idx,event_dungeon_point),point_count=event_dungeon_point.accum_event_point-event_dungeon_point.event_point);var label="",eventvs_banner=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_banner_raid.png",event_raid_info.event_dungeon_period_idx));eventvs_banner.setAnchorPoint(ANCHOR_TOP_LEFT()),eventvs_banner.setPosition(0,ccHeight(layer)),eventvs_banner.setScale(2),layer.addChild(eventvs_banner);var circle_white_1=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_white.png");circle_white_1.setAnchorPoint(ZERO()),circle_white_1.setPosition(19,267),layer.addChild(circle_white_1),label="[]",is_second&&(label="[]");var boss_count_label=new cmMultiLabel;boss_count_label.addLabel(label,LABEL_FONT_INDEX.FONT_241),boss_count_label.addLabel(" ("+Number(event_raid_info.event_raid_boss_info.boss_num).toLocaleString("en")+")",LABEL_FONT_INDEX.FONT_2011),boss_count_label.setLabel(),boss_count_label.enableOutline(cc.color.BLACK,1),boss_count_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),boss_count_label.setPosition(33,270),layer.addChild(boss_count_label);var circle_white_3=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle_white.png");circle_white_3.setAnchorPoint(ZERO()),circle_white_3.setPosition(19,235),layer.addChild(circle_white_3);var label_1="";is_second&&(label_1="");var accum_damage_label=new cmMultiLabel;accum_damage_label.addLabel(label_1,LABEL_FONT_INDEX.FONT_241),accum_damage_label.addLabel(" ("+Number(point_count).toLocaleString("en")+")",LABEL_FONT_INDEX.FONT_2011),accum_damage_label.enableOutline(cc.color.BLACK,1),accum_damage_label.setLabel(),accum_damage_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),accum_damage_label.setPosition(33,236),layer.addChild(accum_damage_label);var offset_x=6,offset_y=16,dungeon_idx=NetService().get_Event_Raid_Dungeon_idx(),base_point=MasterManager.getInstance().get_EventRaidDungeon(dungeon_idx).base_need_point,ticket_count_1=MasterManager.getInstance().get_EventRaidDungeon(dungeon_idx).multiple_1,ticket_count_2=MasterManager.getInstance().get_EventRaidDungeon(dungeon_idx).multiple_2,ticket_count_3=MasterManager.getInstance().get_EventRaidDungeon(dungeon_idx).multiple_3,btn_string_1=res_str("event_raid_start_1"),btn_string_2=cmString(res_str("event_raid_start_2"),ticket_count_2),btn_string_3=cmString(res_str("event_raid_start_2"),ticket_count_3),on=RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_raid_on.png",event_raid_info.event_dungeon_period_idx),off=RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_raid_off.png",event_raid_info.event_dungeon_period_idx),none=RES_CDN_DEFULT+cmString("menu_eventvs_%d/btn_eventvs_raid_none.png",event_raid_info.event_dungeon_period_idx),btnSize=cc.size(156,78);this.m_btn_battle_1=new ccui.Button(off,on,none),this.m_btn_battle_1.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_btn_battle_1.setPosition(offset_x,16),this.m_btn_battle_1.addClickEventListener(function(sender){this.EventRaidBattleStart(ticket_count_1)}.bind(this)),this.m_btn_battle_1.setScale(2),layer.addChild(this.m_btn_battle_1);var btn_info_box_1=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());btn_info_box_1.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn_info_box_1.setPosition(.5*btnSize.width+575,26),btn_info_box_1.setContentSize(104,26),this.addChild(btn_info_box_1);var point_label_1=cmLabel.getLabel(Number(base_point*ticket_count_1).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810);point_label_1.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),point_label_1.setPosition(ccWidth(btn_info_box_1)-10,.5*ccHeight(btn_info_box_1)),btn_info_box_1.addChild(point_label_1);var btn_point_1=cc.Sprite.create(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_point.png",event_raid_info.event_dungeon_period_idx));btn_point_1.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn_point_1.setPosition(592,25),btn_point_1.setScale(2),this.addChild(btn_point_1);var btn_label_1=cmLabel.getLabel(btn_string_1,LABEL_FONT_INDEX.FONT_221);btn_label_1.enableOutline(cc.color.BLACK,2),btn_label_1.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn_label_1.setPosition(.5*btnSize.width+575,62),this.addChild(btn_label_1),offset_x+=btnSize.width,this.m_btn_battle_2=new ccui.Button(off,on,none),this.m_btn_battle_2.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_btn_battle_2.setPosition(offset_x,16),this.m_btn_battle_2.addClickEventListener(function(sender){this.EventRaidBattleStart(ticket_count_2)}.bind(this)),this.m_btn_battle_2.setScale(2),layer.addChild(this.m_btn_battle_2);var btn_info_box_2=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());btn_info_box_2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn_info_box_2.setPosition(.5*btnSize.width+730,26),btn_info_box_2.setContentSize(104,26),this.addChild(btn_info_box_2);var point_label_2=cmLabel.getLabel(Number(base_point*ticket_count_2).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810);point_label_2.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),point_label_2.setPosition(ccWidth(btn_info_box_2)-10,.5*ccHeight(btn_info_box_2)),btn_info_box_2.addChild(point_label_2);var btn_point_2=cc.Sprite.create(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_point.png",event_raid_info.event_dungeon_period_idx));btn_point_2.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn_point_2.setPosition(747,25),btn_point_2.setScale(2),this.addChild(btn_point_2);var btn_label_2=cmLabel.getLabel(btn_string_2,LABEL_FONT_INDEX.FONT_221);btn_label_2.enableOutline(cc.color.BLACK,2),btn_label_2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn_label_2.setPosition(.5*btnSize.width+730,62),this.addChild(btn_label_2),offset_x+=btnSize.width,this.m_btn_battle_3=new ccui.Button(off,on,none),this.m_btn_battle_3.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_btn_battle_3.setPosition(offset_x,16),this.m_btn_battle_3.addClickEventListener(function(sender){this.EventRaidBattleStart(ticket_count_3)}.bind(this)),this.m_btn_battle_3.setScale(2),layer.addChild(this.m_btn_battle_3);var btn_info_box_3=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());btn_info_box_3.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn_info_box_3.setPosition(.5*btnSize.width+885,26),btn_info_box_3.setContentSize(104,26),this.addChild(btn_info_box_3);var point_label_3=cmLabel.getLabel(Number(base_point*ticket_count_3).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810);point_label_3.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),point_label_3.setPosition(ccWidth(btn_info_box_3)-10,.5*ccHeight(btn_info_box_3)),btn_info_box_3.addChild(point_label_3);var btn_point_3=cc.Sprite.create(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_point.png",event_raid_info.event_dungeon_period_idx));btn_point_3.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn_point_3.setPosition(902,25),btn_point_3.setScale(2),this.addChild(btn_point_3);var btn_label_3=cmLabel.getLabel(btn_string_3,LABEL_FONT_INDEX.FONT_221);btn_label_3.enableOutline(cc.color.BLACK,2),btn_label_3.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn_label_3.setPosition(.5*btnSize.width+885,62),this.addChild(btn_label_3),offset_x+=btnSize.width,offset_y+=btnSize.height+12;var eventvs_point=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_info_2.png",NetService().get_Event_Raid_Dungeon_Period_idx()));eventvs_point.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),eventvs_point.setPosition(19,offset_y),eventvs_point.setScale(2),layer.addChild(eventvs_point);var user_point=cmLabel.getLabel(event_dungeon_point.event_point.toLocaleString("en"),LABEL_FONT_INDEX.FONT_165);user_point.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),user_point.setPosition(796,118),this.addChild(user_point),offset_y+=ccHeight(eventvs_point)+14;var life_bar_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_gauge.png");life_bar_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),life_bar_bg.setPosition(0,150),layer.addChild(life_bar_bg,100),offset_y+=ccHeight(life_bar_bg)+10;var bar=cc.Sprite.create(RES_CDN_DEFULT+"menu_raid/img_raid_gauge_red_3.png"),life_bar=new cc.ProgressTimer(bar);life_bar.setAnchorPoint(ANCHOR_MIDDLE()),life_bar.setMidpoint(ANCHOR_MIDDLE_LEFT()),life_bar.setBarChangeRate(cc.p(1,0)),life_bar.setPosition(ccCenter(life_bar_bg)),life_bar.setType(cc.ProgressTimer.TYPE_BAR),life_bar_bg.addChild(life_bar);dungeon_idx=NetService().get_Event_Raid_Dungeon_idx();var dungeon_raid_boss=MasterManager.getInstance().get_EventRaidDungeon(dungeon_idx),max_hp=dungeon_raid_boss.boss_hp;null==dungeon_raid_boss.boss_hp&&(max_hp=0);var per=Math.floor(event_raid_info.event_raid_boss_info.remain_hp/max_hp*100);life_bar.setPercentage(per);var remain_hp=cmLabel.getLabel(cmString(res_str("label_event_raid_ramain_life"),event_raid_info.event_raid_boss_info.remain_hp.toLocaleString("en"),max_hp.toLocaleString("en")),LABEL_FONT_INDEX.FONT_181);remain_hp.enableOutline(cc.color.BLACK,1),remain_hp.setAnchorPoint(ANCHOR_MIDDLE()),remain_hp.setPosition(ccCenter(life_bar_bg).x,ccCenter(life_bar_bg).y+1),life_bar_bg.addChild(remain_hp);var npc=MasterManager.getInstance().get_EventRaidDungeonNpc(nService.get_Event_Raid_Dungeon_idx(),1),n=MasterManager.getInstance().get_NpcGeneral(npc.npc1_idx),gnrl=MasterManager.getInstance().get_General(n.gnrl_id),element=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_raid/img_raid_battletech_%d.png",gnrl.element_type));element.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),element.setPosition(19,180),layer.addChild(element);var Font_Index=0;switch(gnrl.element_type){case 1:Font_Index=LABEL_FONT_INDEX.FONT_305;break;case 2:Font_Index=LABEL_FONT_INDEX.FONT_306;break;case 3:Font_Index=LABEL_FONT_INDEX.FONT_307;break;case 4:Font_Index=LABEL_FONT_INDEX.FONT_308;break;case 5:Font_Index=LABEL_FONT_INDEX.FONT_309}var boss_name_label=cmLabel.getLabel(gnrl.name,Font_Index);return boss_name_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),boss_name_label.setPosition(79,185),layer.addChild(boss_name_label),layer},getRightBoxLayer:function(){var layer=new cc.Layer,m=MasterTable.getInstance(),gnrl_buffs=[],gnrl_reward_buffs=[],dungeon_list=[],dungeon_ids=[],gnrl_buffs_check_period=[],gnrl_reward_buffs_period=[],right_bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));right_bg_box.setContentSize(478,568),right_bg_box.setAnchorPoint(ZERO()),right_bg_box.setPosition(ZERO()),layer.addChild(right_bg_box),layer.setContentSize(ccSize(right_bg_box));var left_navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");left_navi.setAnchorPoint(ZERO()),left_navi.setPosition(8,509),layer.addChild(left_navi,1e3);var sortLayer=this.getNaviSortLayer();sortLayer.setPosition(295,7),left_navi.addChild(sortLayer);var title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_261);if(title.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),title.setPosition(12,ccCenter(left_navi).y+4),left_navi.addChild(title),this.createStartBtn(layer),this.m_game_type==db.BattleGameType.EventDungeon){if(0!=this.m_event_dungeon.task_list.length){var userInfo=NetService().get_UserItemInfo_V2();this.m_have_skip_ticket_count=userInfo.skip_ticket_count,this.createSkipTicketInfo(layer,userInfo),this.createStartSkipBtn(layer)}}else{userInfo=NetService().get_UserItemInfo_V2();this.m_have_skip_ticket_count=userInfo.skip_ticket_count,this.createSkipTicketInfo(layer,userInfo),this.createStartSkipBtn(layer)}if(this.m_frnd_list=BattleContext._getInstance().getFriendList(),this.m_game_type==db.BattleGameType.EventDungeon)for(var idx=0;idx<this.m_frnd_list.length;idx++){gnrl_buffs=[],gnrl_reward_buffs=[],dungeon_list=[],dungeon_ids=[];dungeon_list=m.get_EventDungeonList(this.m_event_dungeon.event_dungeon_period.event_dungeon_period_idx);dungeon_ids=[];for(var i=0;i<dungeon_list.length;i++)dungeon_ids.push(dungeon_list[i].event_dungeon_idx);if(this.m_game_type==db.BattleGameType.EventDungeon){gnrl_buffs_check_period=m.get_EventDungeonGeneralBuf(this.m_frnd_list[idx].partner_gnrl_id%1e3,dungeon_ids);for(i=0;i<gnrl_buffs_check_period.length;i++)EventDungeonService.getInstance().IsOpenEventDungeonBuff(gnrl_buffs_check_period[i].buff_period_idx)&&gnrl_buffs.push(gnrl_buffs_check_period[i]);gnrl_reward_buffs_period=m.get_DungeonRewardBufGeneral(this.m_frnd_list[idx].partner_gnrl_id%1e3,dungeon_ids);for(var jdx=0;jdx<gnrl_reward_buffs_period.length;jdx++)EventDungeonService.getInstance().IsOpenEventDungeonBuff(gnrl_reward_buffs_period[jdx].buff_period_idx)&&gnrl_reward_buffs.push(gnrl_buffs_check_period[jdx])}(0<gnrl_buffs.length||0<gnrl_reward_buffs.length)&&(this.m_frnd_list[idx].special_eff=1)}for(idx=0;idx<this.m_frnd_list.length;idx++)this.m_frnd_list[idx].partner_gnrl_class=GeneralService.getInstance().getGeneralClassType(this.m_frnd_list[idx].partner_gnrl_id);if(this.m_frnd_list=stable(this.m_frnd_list,function(r,l){return l.partner_gnrl_class>r.partner_gnrl_class}),this.m_frnd_list=stable(this.m_frnd_list,function(r,l){return l.helper_type<r.helper_type}),this.m_game_type==db.BattleGameType.Mission||this.m_game_type==db.BattleGameType.EventDungeon||this.m_game_type==db.BattleGameType.StoryHardMode){if(this.m_game_type==db.BattleGameType.EventDungeon&&0==this.m_event_dungeon.task_list.length){var boxSize=cc.size(458,40),frnd_info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());frnd_info_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),frnd_info_box.setPosition(10,76),frnd_info_box.setPreferredSize(boxSize),layer.addChild(frnd_info_box);var text_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_friend/img_friend_text.png");text_icon.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),text_icon.setPosition(52,.5*boxSize.height),frnd_info_box.addChild(text_icon);var info_label=cmLabel.getLabel("12",LABEL_FONT_INDEX.FONT_1613);info_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),info_label.setPosition(88,.5*boxSize.height),frnd_info_box.addChild(info_label)}var tSize=cc.size(444,376),t_pos=cc.p(17,120);this.m_game_type==db.BattleGameType.EventDungeon?0!=this.m_event_dungeon.task_list.length&&(tSize=cc.size(444,298),t_pos=cc.p(17,198)):t_pos=this.m_game_type==db.BattleGameType.StoryHardMode?(tSize=cc.size(444,376),cc.p(17,120)):(tSize=cc.size(444,298),cc.p(17,198)),this.m_friend_select_tv=new cc.TableView(this,tSize),this.m_friend_select_tv.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_friend_select_tv.scrollBarEnable(!0),this.m_friend_select_tv.setVerticalFillOrder(0),this.m_friend_select_tv.setPosition(t_pos),this.m_friend_select_tv.setDelegate(this),layer.addChild(this.m_friend_select_tv),this.m_friend_select_tv.reloadData()}else if(this.m_game_type==db.BattleGameType.EventRaidDungeon);else{var friend_off_img;if(IS_SP_BROWSER)(friend_off_img=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_201)).setAnchorPoint(ANCHOR_MIDDLE()),friend_off_img.setPosition(ccCenter(right_bg_box).x,326),right_bg_box.addChild(friend_off_img);else(friend_off_img=cc.Sprite.create(RES_CDN_DEFULT+"common/img_friend_off.png")).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),friend_off_img.setPosition(ccCenter(right_bg_box).x,76),right_bg_box.addChild(friend_off_img);this.m_btn_sort.setVisible(!1),this.m_btn_sort_2.setVisible(!1)}return this.sort(),layer},getNaviSortLayer:function(){var layer=new cc.Layer;return this.m_btn_sort=new LabelButton("btn_02_off.png","btn_02_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort.setString(""),this.m_btn_sort.setFont(LABEL_FONT_INDEX.FONT_201),this.m_sort=FriendSelectEnum.sort_class,USE_EVENT_DUNGEON_SAVE_FRIEND_SORT_INDEX&&this.m_game_type==db.BattleGameType.EventDungeon&&(this.m_sort=GameDefault.getInstance().GetEventDungeonFriendSortIdx()),this.initSort(this.m_sort),this.m_btn_sort.setAnchorPoint(ZERO()),this.m_btn_sort.setPosition(ZERO()),this.m_btn_sort.addClickEventListener(function(sender){this.runActionSortButton()}.bind(this)),layer.addChild(this.m_btn_sort),this.m_btn_sort_2_off="btn_align_bottom_off.png",this.m_btn_sort_2_on="btn_align_bottom_on.png",this.m_btn_sort_2=new ccui.Button,this.m_btn_sort_2.loadTextures(this.m_btn_sort_2_off,this.m_btn_sort_2_on,"",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_2.setAnchorPoint(ZERO()),this.m_btn_sort_2.setPosition(ccWidth(this.m_btn_sort),0),this.m_btn_sort_2.addClickEventListener(function(sender){this.m_friend_select_idx=-1,this.setDesc()}.bind(this)),layer.addChild(this.m_btn_sort_2),this.m_sortLayer=this.getSortLayer(),this.m_sortLayer.ignoreAnchorPointForPosition(!1),this.m_sortLayer.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_sortLayer.setPosition(ZERO()),this.m_sortLayer.setVisible(!1),layer.addChild(this.m_sortLayer,100),layer.setContentSize(ccSize(this.m_btn_sort)),layer},cellSizeForTable:function(table){var visibleSize=cc.size(444,124);return cc.p(visibleSize.width,visibleSize.height)},onExit:function(){BATTLE_TO_SHOP||BATTLE_TO_MISSION||SceneManager.getInstance().getRunningScene().m_isPushScene||(null!=this.m_rightLayer&&this.m_rightLayer.removeAllChildrenWithCleanup(!0),null!=this.m_leftLayer&&this.m_leftLayer.removeAllChildrenWithCleanup(!0),this.removeAllChildrenWithCleanup(!0),this.m_troops_btns=null,this.m_rightLayer=null,this.m_leftLayer=null)},tableCellSizeForIndex:function(table,idx){return cc.size(444,124)},tableCellEnded:function(table,cell){return this.m_isLongTouch&&(this.m_isLongTouch=!1,null!=this.m_long_touch_cell&&null!=cell&&cell.HidePopUp()),!0},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;null!=c?cell=c:((cell=new FriendListCell)._callback_choice_friend=this.choiceFriend.bind(this),cell.setGameType(this.m_game_type),this.m_game_type==db.BattleGameType.EventDungeon&&cell.setEventDungeon(this.m_event_dungeon));var frnd=this.m_frnd_list[idx];return cell.setFriendData(frnd,idx==this.m_friend_select_idx),cell},numberOfCellsInTableView:function(table){return this.m_frnd_list.length},choiceFriend:function(idx){this.m_friend_select_idx=idx;var used=this.m_friend_select_tv.getCellsUsed();for(idx=0;idx<used.length;idx++){var uc=used[idx];try{this.m_friend_select_tv.updateCellAtIndex(uc.getIdx())}catch(e){}}var gnrl_key={},helper_type=0;if(-1==this.m_friend_select_idx)gnrl_key.gnrl_id=0,gnrl_key.gnrl_num=0,BattleContext._getInstance().setFriendInfo("",gnrl_key,helper_type);else if(this.m_frnd_list.length>this.m_friend_select_idx){var frnd=this.m_frnd_list[this.m_friend_select_idx];gnrl_key.gnrl_id=frnd.partner_gnrl_id,gnrl_key.gnrl_num=frnd.partner_gnrl_num,helper_type=frnd.helper_type,BattleContext._getInstance().setFriendInfo(frnd.user_id,gnrl_key,helper_type),helper_type==HELPTER_TYPE_SUPPORTER&&BattleContext._getInstance().setBattleHelperInfo(frnd)}},tableCellTouched:function(table,cell){this.m_game_type!=db.BattleGameType.Mission&&this.m_game_type!=db.BattleGameType.EventDungeon&&this.m_game_type!=db.BattleGameType.StoryHardMode||null!=cell&&(cell.touchPosInCell(cell.getTouchPos()),cell.HidePopUp())},tableCellHighlight:function(table,cell){if(this.m_game_type==db.BattleGameType.Mission||this.m_game_type==db.BattleGameType.EventDungeon||this.m_game_type==db.BattleGameType.StoryHardMode){if(this.m_isLongTouch)return;this.m_long_touch_cell=cell,this.scheduleOnce(function(float){if(this.m_isLongTouch=!0,null!=cell&&(cell.highlightPosInCell(cell.getTouchPos()),null!=this.m_friend_select_tv.getDataSource()))for(var used=this.m_friend_select_tv.getCellsUsed(),jdx=0;jdx<used.length;jdx++)this.m_long_touch_cell==used[jdx]?used[jdx].setLocalZOrder(100):used[jdx].setLocalZOrder(0)}.bind(this),.4,LONG_CLICK)}},tableCellUnhighlight:function(table,cell){this.m_game_type!=db.BattleGameType.Mission&&this.m_game_type!=db.BattleGameType.EventDungeon&&this.m_game_type!=db.BattleGameType.StoryHardMode||(this.unschedule(LONG_CLICK),null!=cell&&(cell.unhighlightPosInCell(cell.getTouchPos()),cell.HidePopUp()))},initSort:function(sort_index){switch(sort_index){case FriendSelectEnum.sort_class:this.m_btn_sort.setString("");break;case FriendSelectEnum.sort_lv:this.m_btn_sort.setString("");break;case FriendSelectEnum.sort_special_effect:this.m_game_type==db.BattleGameType.EventDungeon&&this.m_btn_sort.setString(res_str("btn_sort_dungeon_buff"))}},getLeftBoxLayer:function(){var layer=new cc.Layer;layer.setContentSize(427,640);var generalService=GeneralService.getInstance(),gw_service=GreatWallService.getInstance(),battle_form={},troops_num=this.getCurrentTroopsNum(),labelLayer=new cc.Layer;labelLayer.ignoreAnchorPointForPosition(!1),labelLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),labelLayer.setPosition(293,156),layer.addChild(labelLayer,100);var offset_x=0,btn_name=[];btn_name.push("1"),btn_name.push("2"),btn_name.push("3"),btn_name.push("4"),btn_name.push("5"),btn_name.push("6"),btn_name.push("7");for(var i=0;i<MAX_TROOPS_NUM;i++){(troops_btn=new LabelButton("btn_31_none.png","btn_31_on.png","btn_31_off.png",ccui.Widget.PLIST_TEXTURE)).setFont(LABEL_FONT_INDEX.FONT_241);var troops_btn=null;this.m_game_type==db.BattleGameType.GreatWallDungeon?(troops_btn=new LabelButton("btn_31_none.png","btn_31_on.png","btn_34_off.png",ccui.Widget.PLIST_TEXTURE)).setFont(LABEL_FONT_INDEX.FONT_221):(troops_btn=new LabelButton("btn_31_none.png","btn_31_on.png","btn_31_off.png",ccui.Widget.PLIST_TEXTURE)).setFont(LABEL_FONT_INDEX.FONT_241),troops_btn.setString(btn_name[i]),troops_btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),troops_btn.setPosition(offset_x,508),troops_btn.setTag(NOTIFY_MENU_PARTY_1+i),troops_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],sender.getTag())}.bind(this)),layer.addChild(troops_btn),offset_x+=ccWidth(troops_btn),this.m_troops_btns.push(troops_btn)}this.m_game_type!=db.BattleGameType.GreatWallDungeon&&this.m_troops_btns.at(6).setVisible(!1),this.updateTroopsBtns();var troops_cost=0,user_cost_bnd=0;user_cost_bnd=this.m_game_type==db.BattleGameType.GreatWallDungeon?(gw_service.getGreatWallTroopsFormationInfo(troops_num,battle_form),troops_cost=gw_service.getGreatWallTroopsCost(troops_num),gw_service.getGreatWallTroopsTotalCost(troops_num)):(generalService.getUserBattleFormationInfo(troops_num,battle_form),troops_cost=GeneralService.getInstance().getTroopsCost(troops_num),GeneralService.getInstance().getUserTotalCost(troops_num)),this.m_user_cost_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_301),this.m_user_cost_label.setAnchorPoint(ZERO()),this.m_user_cost_label.setPosition(17,470),layer.addChild(this.m_user_cost_label),this.m_deckBoxLayer=this.getDeckLayer(),this.m_deckBoxLayer.setAnchorPoint(cc.p(0,0)),this.m_deckBoxLayer.setPosition(55,224),this.m_game_type==db.BattleGameType.GreatWallDungeon&&this.m_deckBoxLayer.setPosition(55,191),layer.addChild(this.m_deckBoxLayer),generalService.getUserBattleFormationInfo(troops_num,battle_form),this.m_user_cost_label.setString("cost "+troops_cost+"/"+user_cost_bnd.cost);var leader_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2615);if(leader_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),leader_title.setPosition(17,172),layer.addChild(leader_title),this.m_game_type==db.BattleGameType.GreatWallDungeon){var warning_tag=cc.Sprite.create("#btn_warning_off.png");warning_tag.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),warning_tag.setPosition(372,160),layer.addChild(warning_tag,999999);var tooltip_btn=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png",cc.Rect(1,1,1,1)));tooltip_btn.setAnchorPoint(ANCHOR_MIDDLE()),tooltip_btn.setPreferredSize(ccSize(warning_tag)),tooltip_btn.setPosition(ccCenter(warning_tag)),warning_tag.addChild(tooltip_btn),tooltip_btn.addTargetWithActionForControlEvents(this,this.onTouchWarningTooltip,cc.CONTROL_EVENT_TOUCH_DOWN),tooltip_btn.addTargetWithActionForControlEvents(this,this.onTouchWarningTooltip,cc.CONTROL_EVENT_TOUCH_UP_INSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onTouchWarningTooltip,cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE),tooltip_btn.addTargetWithActionForControlEvents(this,this.onTouchWarningTooltip,cc.CONTROL_EVENT_TOUCH_CANCEL);var boxSize=ccSize(warning_tag);null==this.tooltip_box&&(this.tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.tooltip_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.tooltip_box.setPosition(.5*boxSize.width,boxSize.height+5),this.tooltip_box.setVisible(!1),this.tooltip_box.setGlobalZOrder(1e6),warning_tag.addChild(this.tooltip_box)),null==this.tooltip_content&&(this.tooltip_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.tooltip_content.setAnchorPoint(ANCHOR_MIDDLE()),this.tooltip_box.addChild(this.tooltip_content),this.tooltip_content.setGlobalZOrder(1000002))}this.m_leader_node=new WeeklyDeckReadyLeaderNode,this.m_leader_node.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_leader_node.setPosition(17,98),layer.addChild(this.m_leader_node),this.m_game_type==db.BattleGameType.GreatWallDungeon&&(leader_title.setPosition(17,162),this.m_leader_node.setPosition(17,88));var btn_battle_formation=new LabelButton("btn_16_off.png","btn_16_on.png","",ccui.Widget.PLIST_TEXTURE);btn_battle_formation.setFont(LABEL_FONT_INDEX.FONT_241),btn_battle_formation.setString(""),btn_battle_formation.setAnchorPoint(cc.p(0,0)),btn_battle_formation.setPosition(0,16),layer.addChild(btn_battle_formation),btn_battle_formation.addClickEventListener(function(sender){TutorialContextV2.getInstance().IsCompleteAllTutorial()&&MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],NOTIFY_MENU_BATTLE_FORM)}.bind(this));var btn_yunhee_set=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);btn_yunhee_set.setFont(LABEL_FONT_INDEX.FONT_241),this.m_game_type==db.BattleGameType.GreatWallDungeon?btn_yunhee_set.setString(res_str("label_great_wall_dungeon_arrangement")):btn_yunhee_set.setString(res_str("btn_label_arrangement")),btn_yunhee_set.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn_yunhee_set.setPosition(ccWidth(btn_battle_formation),16),btn_yunhee_set.addClickEventListener(function(sender){TutorialContextV2.getInstance().IsCompleteAllTutorial()&&MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],NOTIFY_MENU_YUNHEE_SET)}.bind(this)),layer.addChild(btn_yunhee_set);var leftArrowBtn=new ccui.Button("btn_main_banner_arrow_off.png","btn_main_banner_arrow_on.png","",ccui.Widget.PLIST_TEXTURE);leftArrowBtn.setAnchorPoint(ZERO()),leftArrowBtn.setPosition(0,300),layer.addChild(leftArrowBtn),leftArrowBtn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],btn_left_arrow)}.bind(this));var rightArrowBtn=new ccui.Button("btn_main_banner_arrow_off.png","btn_main_banner_arrow_on.png","",ccui.Widget.PLIST_TEXTURE);rightArrowBtn.setRotation(180),rightArrowBtn.setAnchorPoint(ZERO()),rightArrowBtn.setPosition(ccPosX(this.m_deckBoxLayer)+ccWidth(this.m_deckBoxLayer)+ccWidth(rightArrowBtn)+7,300+ccHeight(rightArrowBtn)),layer.addChild(rightArrowBtn,99999999999),rightArrowBtn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],btn_right_arrow)}.bind(this));var battle_tech=cc.Sprite.create("#img_battletech.png");return battle_tech.setAnchorPoint(ZERO()),battle_tech.setPosition(343,402),layer.addChild(battle_tech),layer},getDeckLayer:function(){var layer=new cc.Layer,troops_num=this.getCurrentTroopsNum(),partyContainer=new YunheeTroopsItemContainer;layer.addChild(partyContainer);var gnrl_list=[];GeneralService.getInstance().getUserGeneralInfoList(gnrl_list),this.m_game_type==db.BattleGameType.GreatWallDungeon&&GreatWallService.getInstance().checkGreatWallDungeonPartInGenerals(gnrl_list);for(var idx=0;idx<this.m_userTroopsList.length;idx++)if(this.m_userTroopsList[idx].troops_num==troops_num)for(var jdx=0;jdx<gnrl_list.length;jdx++)this.m_userTroopsList[idx].gnrl_num==gnrl_list[jdx].gnrl_num&&partyContainer.addPartyItem(this.m_userTroopsList[idx],gnrl_list[jdx],this.m_game_type);return layer.setContentSize(ccSize(partyContainer)),layer},getNpcDeckLayer:function(){var layer=new cc.Layer,m=MasterManager.getInstance(),npc=m.get_EventRaidDungeonNpc(NetService().get_Event_Raid_Dungeon_idx(),1),n=m.get_NpcGeneral(npc.npc1_idx),boss_image="";return boss_image=n.gnrl_group<100?RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(n.gnrl_group,2)+".png":RES_CDN_DEFULT+"card_war_boss/"+n.gnrl_group+".png",resourceLoader(boss_image,function(){var m_boss_image=cc.Sprite.create(boss_image);m_boss_image.setAnchorPoint(ANCHOR_TOP_RIGHT()),m_boss_image.setPosition(ccWidth(layer),ccHeight(layer)),layer.addChild(m_boss_image)}.bind(this)),layer},setUserGeneralTroopsInfo:function(list){this.m_userTroopsList=list},changeYhTeam:function(team_index){var gameDefault=GameDefault.getInstance(),troops_num=team_index;this.m_game_type==db.BattleGameType.Mission?gameDefault.setUserTroopsNum(troops_num):this.m_game_type==db.BattleGameType.WeeklyDungeon?gameDefault.setUserWeeklyTroopsNum(troops_num):this.m_game_type==db.BattleGameType.Mussang?gameDefault.setUserMussangTroopsNum(troops_num):this.m_game_type==db.BattleGameType.EventDungeon?gameDefault.setUserEventDungeonTroopsNum(troops_num):this.m_game_type==db.BattleGameType.DailyDungeon?gameDefault.setUserDailyDungeonTroopsNum(troops_num):this.m_game_type==db.BattleGameType.RaidDungeon?gameDefault.setUserRaidBossTroopsNum(troops_num):this.m_game_type==db.BattleGameType.GreatWallDungeon?gameDefault.setUserGreatWallTroopsNum(troops_num):this.m_game_type==db.BattleGameType.TowerDungeon?gameDefault.setUserTowerDungeonTroopsNum(troops_num):this.m_game_type==db.BattleGameType.OnceADayDungeon?gameDefault.setUserOnceADayDungeonTroopsNum(troops_num):this.m_game_type==db.BattleGameType.EventRaidDungeon?gameDefault.setUserEventRaidDungeonTroopsNum(troops_num):this.m_game_type==db.BattleGameType.StoryHardMode?gameDefault.setUserTroopsNum(troops_num):this.m_game_type==db.BattleGameType.NewRaidBossDungeon&&gameDefault.setUserTroopsNum(troops_num),this.updateTroopsBtns();var troops_cost=0,user_cost_bnd={};user_cost_bnd=this.m_game_type==db.BattleGameType.GreatWallDungeon?(troops_cost=GreatWallService.getInstance().getGreatWallTroopsCost(troops_num),GreatWallService.getInstance().getGreatWallTroopsTotalCost(troops_num)):(troops_cost=GeneralService.getInstance().getTroopsCost(troops_num),GeneralService.getInstance().getUserTotalCost(troops_num)),this.m_user_cost_label.setString("cost "+troops_cost+"/"+user_cost_bnd.cost),this.m_deckBoxLayer.removeFromParent(),this.m_deckBoxLayer=this.getDeckLayer(),this.m_deckBoxLayer.setAnchorPoint(ZERO()),this.m_deckBoxLayer.setPosition(55,224),this.m_game_type==db.BattleGameType.GreatWallDungeon&&this.m_deckBoxLayer.setPosition(55,191),this.m_leftLayer.addChild(this.m_deckBoxLayer),this.updateLeaderSkill(troops_num)},updateLeaderSkill:function(troops_num){for(var gnrl_id=0,idx=0;idx<this.m_userTroopsList.length;idx++)if(this.m_userTroopsList[idx].troops_num==troops_num&&this.m_userTroopsList[idx].is_leader){gnrl_id=this.m_userTroopsList[idx].gnrl_id;break}if(0==gnrl_id)this.m_leader_node.setLeaderSkillId(0);else{var gnrl=MasterManager.getInstance().get_General(gnrl_id);if(0==gnrl.leader_skill_id||99999==gnrl.leader_skill_id){gnrl.special_leader_skill_id=gnrl.special_leader_skill_id+"";var leader_skill_list=gnrl.special_leader_skill_id.split(",");if(0<leader_skill_list.size()){var leader_skill_id=1*leader_skill_list.at(0);this.m_leader_node.setSLeaderSkillId(leader_skill_id)}}else this.m_leader_node.setLeaderSkillId(gnrl.leader_skill_id)}},getSortLayer:function(){var layer=new cc.Layer,btn_class_sort=new LabelButton("btn_02_off.png","btn_02_on.png","",ccui.Widget.PLIST_TEXTURE);btn_class_sort.setFont(LABEL_FONT_INDEX.FONT_201),btn_class_sort.setString(""),btn_class_sort.setAnchorPoint(ZERO()),btn_class_sort.setPosition(ZERO()),btn_class_sort.addClickEventListener(function(sender){this.m_friend_select_idx=-1,this.setSort(FriendSelectEnum.sort_class)}.bind(this)),layer.addChild(btn_class_sort);var btn_lv_sort=new LabelButton("btn_02_off.png","btn_02_on.png","",ccui.Widget.PLIST_TEXTURE);if(btn_lv_sort.setFont(LABEL_FONT_INDEX.FONT_201),btn_lv_sort.setFont(LABEL_FONT_INDEX.FONT_202),btn_lv_sort.setString(""),btn_lv_sort.setAnchorPoint(ZERO()),btn_lv_sort.setPosition(0,btn_class_sort.y+ccHeight(btn_class_sort)),btn_lv_sort.addClickEventListener(function(sender){this.m_friend_select_idx=-1,this.setSort(FriendSelectEnum.sort_lv)}.bind(this)),layer.addChild(btn_lv_sort),USE_FRIEND_SPEICAL_EFFECT&&this.m_game_type==db.BattleGameType.EventDungeon){var btn_special_effect=new LabelButton("btn_02_off.png","btn_02_on.png","",ccui.Widget.PLIST_TEXTURE);btn_special_effect.setFont(LABEL_FONT_INDEX.FONT_201),btn_special_effect.setString(res_str("btn_sort_dungeon_buff")),btn_special_effect.setAnchorPoint(ZERO()),btn_special_effect.setPosition(0,ccPosY(btn_lv_sort)+ccHeight(btn_lv_sort)),btn_special_effect.addClickEventListener(function(sender){this.m_friend_select_idx=-1,this.setSort(FriendSelectEnum.sort_special_effect)}.bind(this)),layer.addChild(btn_special_effect)}return this.m_game_type==db.BattleGameType.EventDungeon?layer.setContentSize(111,120):layer.setContentSize(111,80),layer},runActionSortButton:function(){this.m_isSortBtnVisible?(this.m_sortLayer.setVisible(!1),this.m_isSortBtnVisible=!1):(this.m_sortLayer.setVisible(!0),this.m_isSortBtnVisible=!0)},setSort:function(sort_index){if(this.m_sort!=sort_index){switch(sort_index){case FriendSelectEnum.sort_class:this.m_btn_sort.setString("");break;case FriendSelectEnum.sort_lv:this.m_btn_sort.setString("");break;case FriendSelectEnum.sort_special_effect:this.m_game_type==db.BattleGameType.EventDungeon&&this.m_btn_sort.setString(res_str("btn_sort_dungeon_buff"))}this.m_sort=sort_index,USE_EVENT_DUNGEON_SAVE_FRIEND_SORT_INDEX&&GameDefault.getInstance().SetEventDungeonFriendSortIdx(this.m_sort),this.sort()}this.runActionSortButton()},setDesc:function(){this.m_isSortDesc?(this.m_isSortDesc=!1,this.m_btn_sort_2.loadTexturePressed("btn_align_top_on.png",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_2.loadTextureNormal("btn_align_top_off.png",ccui.Widget.PLIST_TEXTURE)):(this.m_isSortDesc=!0,this.m_btn_sort_2.loadTexturePressed("btn_align_bottom_on.png",ccui.Widget.PLIST_TEXTURE),this.m_btn_sort_2.loadTextureNormal("btn_align_bottom_off.png",ccui.Widget.PLIST_TEXTURE)),this.sort()},sort:function(){0==this.m_isSortDesc?this.m_sort==FriendSelectEnum.sort_lv?(this.m_frnd_list=stable(this.m_frnd_list,function(l,r){return l.partner_gnrl_lv>r.partner_gnrl_lv}),this.m_frnd_list=stable(this.m_frnd_list,function(l,r){return l.helper_type>r.helper_type})):this.m_sort==FriendSelectEnum.sort_special_effect?this.m_frnd_list=stable(this.m_frnd_list,function(l,r){return null==l.special_eff&&(l.special_eff=0),null==r.special_eff&&(r.special_eff=0),l.special_eff>r.special_eff}):(this.m_frnd_list=stable(this.m_frnd_list,function(l,r){return l.partner_gnrl_class>r.partner_gnrl_class}),this.m_frnd_list=stable(this.m_frnd_list,function(l,r){return l.helper_type>r.helper_type})):this.m_sort==FriendSelectEnum.sort_lv?(this.m_frnd_list=stable(this.m_frnd_list,function(l,r){return l.partner_gnrl_lv<r.partner_gnrl_lv}),this.m_frnd_list=stable(this.m_frnd_list,function(l,r){return l.helper_type>r.helper_type})):this.m_sort==FriendSelectEnum.sort_special_effect?this.m_frnd_list=stable(this.m_frnd_list,function(l,r){return null==l.special_eff&&(l.special_eff=0),null==r.special_eff&&(r.special_eff=0),l.special_eff<r.special_eff}):(this.m_frnd_list=stable(this.m_frnd_list,function(l,r){return l.partner_gnrl_class<r.partner_gnrl_class}),this.m_frnd_list=stable(this.m_frnd_list,function(l,r){return l.helper_type>r.helper_type})),null!=this.m_friend_select_tv&&this.m_friend_select_tv.reloadData()},checkNeedKeyWeeklyDungeon:function(_need_key){var need_key=_need_key,is_expense_dec=!1,now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),nn=moment(now).valueOf();for(var b in list_Global_Booster_Event_V2){var bt=moment(b.begin_dt),et=moment(b.end_dt),bb=bt.valueOf(),ee=et.valueOf();if(bb<=nn&&nn<=ee&&b.booster_type==BOOSTER_TYPE_V2_WEEKLY_DUNGEON&&b.variation_type==BOOSTER_VARIATION_TYPE_V2_EXPENSE_DEC&&b.item_type==BOOSTER_ITEM_TYPE_V2_ENTRANCE_TICKET){if(0==b.value_1){need_key=this.m_weekly_difficulty.weekly_difficulty.need_key-this.m_weekly_difficulty.weekly_difficulty.need_key*b.variation_value/100,is_expense_dec=!0;break}if(b.value_1==this.m_weekly_difficulty.weekly_difficulty.weekly_idx){need_key=this.m_weekly_difficulty.weekly_difficulty.need_key-this.m_weekly_difficulty.weekly_difficulty.need_key*b.variation_value/100,is_expense_dec=!0;break}}}return is_expense_dec&&(need_key=Math.max(need_key,1)),0==need_key&&(need_key=this.m_weekly_difficulty.weekly_difficulty.need_key),need_key},checkNeedKeyGreatWallDungeon:function(){var need_key=0;return this.IsOpenGreatWallDungeon()&&(need_key=this.m_great_wall_dungeon.great_wall_dungeon.need_key),need_key},checkNeedKeyTicketMussang:function(){var need_key=0,need_ticket=0,is_expense_dec=!1,now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),nn=moment(now).valueOf(),list_Global_Booster_Event_V2=(new NetService).get_Global_Booster_Event();if(0!=list_Global_Booster_Event_V2.size())for(var b in list_Global_Booster_Event_V2){var bt=moment(b.begin_dt),et=moment(b.end_dt),bb=bt.valueOf(),ee=et.valueOf();if(bb<=nn&&nn<=ee&&b.booster_type==BOOSTER_TYPE_V2_MUSSANG&&b.variation_type==BOOSTER_VARIATION_TYPE_V2_EXPENSE_DEC&&b.item_type==BOOSTER_ITEM_TYPE_V2_ENTRANCE_TICKET){if(0==b.value_1){need_key=this.m_mussang.mussang.need_key-this.m_mussang.mussang.need_key*b.variation_value/100,need_ticket=this.m_mussang.mussang.need_ticket-this.m_mussang.mussang.need_ticket*b.variation_value/100,is_expense_dec=!0;break}if(b.value_1==this.m_mussang.mussang_step){need_key=this.m_mussang.mussang.need_key-this.m_mussang.mussang.need_key*b.variation_value/100,need_ticket=this.m_mussang.mussang.need_ticket-this.m_mussang.mussang.need_ticket*b.variation_value/100,is_expense_dec=!0;break}}}return is_expense_dec&&(need_key=Math.max(need_key,1),need_ticket=Math.max(need_ticket,1)),0==need_key&&(need_key=this.m_mussang.mussang.need_key),0==need_ticket&&(need_ticket=this.m_mussang.mussang.need_ticket),[need_key,need_ticket]},checkNeedKeyEventOnceADayDungeon:function(_need_key){var need_key=0,is_expense_dec=!1,user_service=UserService.getInstance();if(user_service.isBeginnerBooster()){var mt_booster=user_service.getMtBeginnerBooster(BEGINNER_BOOSTER_TYPE_CONSUME_DECREASE,0,CONSUME_DECREASE_KEY);0<mt_booster.value&&(mt_booster.battle_type==BATTLE_DUNGEON_TYPE_ONCE_A_DAY_DUNGEON||mt_booster.battle_type==BATTLE_DUNGEON_TYPE_ALL)&&(need_key=Math.floor(this.m_once_a_day_dungeon.dungeon.need_key-this.m_once_a_day_dungeon.dungeon.need_key*mt_booster.value/1e4),is_expense_dec=!0)}is_expense_dec&&(need_key=Math.max(need_key,0)),0==need_key&&(need_key=this.m_once_a_day_dungeon.dungeon.need_key)},checkNeedKeyEventDungeon:function(_need_key){var need_key=_need_key,is_expense_dec=!1,now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),nn=moment(now).valueOf();for(var b in list_Global_Booster_Event_V2){var bt=moment(b.begin_dt),et=moment(b.end_dt),bb=bt.valueOf(),ee=et.valueOf();if(bb<=nn&&nn<=ee&&b.booster_type==BOOSTER_TYPE_V2_MARATHON_DUNGEON&&b.variation_type==BOOSTER_VARIATION_TYPE_V2_EXPENSE_DEC&&b.item_type==BOOSTER_ITEM_TYPE_V2_ENTRANCE_TICKET){if(0==b.value_1){need_key=this.m_event_dungeon.event_dungeon.need_key-this.m_event_dungeon.event_dungeon.need_key*b.variation_value/100,is_expense_dec=!0;break}if(b.value_1==this.m_event_dungeon.event_dungeon.event_dungeon_idx){need_key=this.m_event_dungeon.event_dungeon.need_key-this.m_event_dungeon.event_dungeon.need_key*b.variation_value/100,is_expense_dec=!0;break}}}var user_service=UserService.getInstance();if(user_service.isBeginnerBooster()){var mt_booster=[];0<(mt_booster=user_service.getMtBeginnerBooster(BEGINNER_BOOSTER_TYPE_CONSUME_DECREASE,0,CONSUME_DECREASE_KEY,mt_booster)).value&&(mt_booster.battle_type==BATTLE_DUNGEON_TYPE_EVENT_DUNGEON||mt_booster.battle_type==BATTLE_DUNGEON_TYPE_ALL)&&(need_key=Math.floor(this.m_event_dungeon.event_dungeon.need_key-this.m_event_dungeon.event_dungeon.need_key*mt_booster.value/1e4),is_expense_dec=!0)}return is_expense_dec&&(need_key=Math.max(need_key,0)),0==need_key&&(need_key=this.m_event_dungeon.event_dungeon.need_key),need_key},checkNeedKeyStoryHardModeMission:function(){return this.m_story_hard_mode_mission.mission.need_key},checkNeedKeyMission:function(_need_key){var need_key=_need_key,is_expense_dec=!1;if(TutorialContextV2.getInstance().IsCompleteAllTutorial()){var now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),nn=moment(now).valueOf(),list_Global_Booster_Event_V2=(new NetService).get_Global_Booster_Event();if(0!=list_Global_Booster_Event_V2.size())for(var b in list_Global_Booster_Event_V2){var bt=moment(b.begin_dt),et=moment(b.end_dt),bb=bt.valueOf(),ee=et.valueOf();if(bb<=nn&&nn<=ee&&b.booster_type==BOOSTER_TYPE_V2_STORY&&b.variation_type==BOOSTER_VARIATION_TYPE_V2_EXPENSE_DEC&&b.item_type==BOOSTER_ITEM_TYPE_V2_ENTRANCE_TICKET){if(0==b.value_1){need_key=this.m_mission.mission.need_key-this.m_mission.mission.need_key*b.variation_value/100,is_expense_dec=!0;break}if(0==b.value_2){if(b.value_1==this.m_mission.mission.main_story_id){need_key=this.m_mission.mission.need_key-this.m_mission.mission.need_key*b.variation_value/100,is_expense_dec=!0;break}}else if(b.value_1==this.m_mission.mission.main_story_id&&b.value_2==this.m_mission.mission.main_mission_num){need_key=this.m_mission.mission.need_key-this.m_mission.mission.need_key*b.variation_value/100,is_expense_dec=!0;break}}}is_expense_dec&&(need_key=Math.max(need_key,1))}if(0==MasterManager.getInstance().get_TimeFunction(9).value){var user_service=UserService.getInstance();if(user_service.isBeginnerBooster()){var mt_booster=[];0<(mt_booster=user_service.getMtBeginnerBooster(BEGINNER_BOOSTER_TYPE_CONSUME_DECREASE,0,CONSUME_DECREASE_KEY,mt_booster)).value&&(mt_booster.battle_type==BATTLE_DUNGEON_TYPE_STORY||mt_booster.battle_type==BATTLE_DUNGEON_TYPE_ALL)&&(need_key=Math.floor(this.m_mission.mission.need_key-this.m_mission.mission.need_key*mt_booster.value/1e4),need_key=Math.max(need_key,1))}}return 0==need_key&&(need_key=this.m_mission.mission.need_key),need_key},reqStoryHardModeMissionBegin:function(){var context=BattleContext._getInstance(),main_story_hard_mode_mission_idx=context.getStoryHardModeMissionId();if(0==main_story_hard_mode_mission_idx)return this.m_message_box.setTitle(res_str("label_mission_id_invalid_title")),this.m_message_box.setText(res_str("label_mission_id_invalid_text_1")),this.m_message_box.setText("\n"),this.m_message_box.setText(res_str("label_mission_id_invalid_text_2")),this.m_message_box.addButtonInfo(new MessageButtonInfo(res_str("label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(){MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.back_scene)},0,"mission_id_invalid"),this.m_message_box.hide(!1)}.bind(this))),this.m_message_box.is_show()&&this.m_message_box.hide(!1),void this.m_message_box.show();context.setMissionID(0);var req={};req.opcode=net.OP.op_main_story_hard_mode_mission_battle_begin,req.main_story_hard_mode_mission_idx=main_story_hard_mode_mission_idx,req.troops_num=this.getCurrentTroopsNum(),req.frnd_user_id=context.getFriendID(),req.helper_type=context.getHelperType(),this.getParent().network_write(req),this.m_friend_select_scene.setEnableBackBtn(!1)},reqMissionBegin:function(){var context=BattleContext._getInstance(),mission_id=context.getMissionID();if(0==mission_id)return this.m_message_box.setText("ID"),this.m_message_box.setText("\n"),this.m_message_box.setText(""),this.m_message_box.addButtonInfo(new MessageButtonInfo("",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.schedule(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.back_scene)},0,0,0,"mission_id_invalid"),this.m_message_box.hide(!1)}.bind(this))),this.m_message_box.is_show()&&this.m_message_box.hide(!1),void this.m_message_box.show();context.setStoryHardModeMissionId(0);var frnd_user_id="";frnd_user_id=""==context.getFriendID()?"":context.getFriendID();var req={};req.opcode=net.OP.op_main_mission_battle_begin_v2,req.troops_num=this.getCurrentTroopsNum(),req.mission_id=mission_id,req.frnd_user_id=frnd_user_id,req.helper_type=context.getHelperType(),this.getParent().network_write(req),this.m_friend_select_scene.setEnableBackBtn(!1)},reqWeeklyDungeonBegin:function(){var troops_num=this.getCurrentTroopsNum();if(0<this.m_weekly_difficulty.weekly_difficulty.weekly_idx){var req={};req.opcode=net.OP.op_weekly_dungeon_battle_begin,req.weekly_idx=this.m_weekly_difficulty.weekly_difficulty.weekly_idx,req.weekly_difficulty_id=this.m_weekly_difficulty.weekly_difficulty.dungeon_idx,req.troops_num=troops_num,SceneManager.getInstance().getRunningScene().network_write(req),this.m_friend_select_scene.setEnableBackBtn(!1)}},reqTowerDungeonBegin:function(){},reqMussangStepBegin:function(){var context=BattleContext._getInstance(),troops_num=this.getCurrentTroopsNum(),req={};(req.opcode=net.OP.op_mussang_step_battle_begin,req.mussang_id=context.getMussangId(),req.period_group_idx=context.getMussangPeriodGroupIdx(),req.period_idx=context.getMussangPeriodIdx(),req.troops_num=troops_num,0<req.mussang_id)&&(SceneManager.getInstance().getRunningScene().network_write(req),this.m_friend_select_scene.setEnableBackBtn(!1))},reqEventOnceADayDungeonBegin:function(){var context=BattleContext._getInstance(),troops_num=this.getCurrentTroopsNum(),dungeon=context.getEventOnceADayDungeonData(),req={};(req.opcode=net.OP.op_event_once_a_day_dungeon_battle_begin,req.event_dungeon_period_idx=dungeon.period.event_dungeon_period_idx,req.event_dungeon_once_a_day_idx=dungeon.dungeon.event_dungeon_once_a_day_idx,req.troops_num=troops_num,0!=req.event_dungeon_once_a_day_idx)&&(SceneManager.getInstance().getRunningScene().network_write(req),this.m_friend_select_scene.setEnableBackBtn(!1))},reqEventDungeonBegin:function(){var context=BattleContext._getInstance(),troops_num=this.getCurrentTroopsNum(),dungeon=context.getEventDungeonData();if(0<dungeon.event_dungeon_idx){if(EventDungeonService.getInstance().checkEventDungeonBattleGeneralInSearchTroops(dungeon.event_dungeon_period.event_dungeon_period_idx,troops_num))return void MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.troops_in_search_troops_general);var req={};req.opcode=net.OP.op_event_dungeon_battle_begin,req.event_dungeon_idx=dungeon.event_dungeon.event_dungeon_idx,req.event_dungeon_period_idx=dungeon.event_dungeon_period.event_dungeon_period_idx,req.frnd_user_id=context.getFriendID(),req.helper_type=context.getHelperType(),req.troops_num=troops_num,SceneManager.getInstance().getRunningScene().network_write(req),this.m_friend_select_scene.setEnableBackBtn(!1)}},reqGreatWallDungeonBegin:function(){var context=BattleContext._getInstance(),troops_num=this.getCurrentTroopsNum(),dungeon=context.getGreatWallDungeonData(),great_wall_dungeon_period_idx=GreatWallService.getInstance().getCurrentGreatWallPeriodIdx();if(0<great_wall_dungeon_period_idx){var req={};req.opcode=net.OP.op_great_wall_dungeon_battle_begin,req.great_wall_dungeon_period_idx=great_wall_dungeon_period_idx,req.great_wall_dungeon_group_idx=dungeon.great_wall_dungeon_group_idx,req.great_wall_dungeon_idx=dungeon.great_wall_dungeon_idx,req.troops_num=troops_num,SceneManager.getInstance().getRunningScene().network_write(req),this.m_friend_select_scene.setEnableBackBtn(!1)}},reqDailyDungeonBegin:function(){var context=BattleContext._getInstance(),troops_num=this.getCurrentTroopsNum(),dungeon=context.getDailyDungeonData();if(0<dungeon.daily_dungeon_idx){var req={};req.opcode=net.OP.op_daily_dungeon_battle_begin,req.daily_dungeon_idx=dungeon.daily_dungeon.daily_dungeon_idx,req.daily_dungeon_period_idx=dungeon.daily_dungeon_period.daily_dungeon_period_idx,req.troops_num=troops_num,req.cost_func=BONUS_TYPE_KEY;var now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),today=moment(now).format("YYYY-MM-DD");req.today=today;var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent,mainScene),this.m_friend_select_scene.setEnableBackBtn(!1)}},battleStart:function(){var info=NetService().get_UserItemInfo_V2(),troops_num=this.getCurrentTroopsNum();return this.IsEmptyTroops(troops_num)?(this.m_friend_select_scene.setEnableBackBtn(!0),void MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.popup_empty_troops)):UserService.getInstance().isEnoughYunheeBound()||UserService.getInstance().isEnoughMaterialBound()?UserService.getInstance().isEnoughYunheeBound()?UserService.getInstance().isEnoughMaterialBound()?this.IsEnoughtEquipmentBound()?void this.IsEnoughtYunheeBound(this.send_battle.bind(this),info):(this.m_friend_select_scene.setEnableBackBtn(!0),void MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.over_equipment_bound)):(this.m_friend_select_scene.setEnableBackBtn(!0),void MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.over_general_material_bound)):(this.m_friend_select_scene.setEnableBackBtn(!0),void MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.over_yunhee_bound)):(this.m_friend_select_scene.setEnableBackBtn(!0),void MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.over_all_bound))},send_battle:function(info){var need_key=0,need_ticket=0,troops_num=this.getCurrentTroopsNum(),scene=SceneManager.getInstance().getRunningScene();if(this.m_game_type==db.BattleGameType.Mission){if(need_key=this.checkNeedKeyMission(0),info.key_cnt<need_key)return this.m_start_btn.setEnabled(!0),this.m_friend_select_scene.setEnableBackBtn(!0),void scene.showNotEnoughKey(need_key);this.reqMissionBegin()}else if(this.m_game_type==db.BattleGameType.StoryHardMode){if(need_key=this.checkNeedKeyStoryHardModeMission(),info.key_cnt<need_key)return this.m_start_btn.setEnabled(!0),this.m_friend_select_scene.setEnableBackBtn(!0),void(scene=SceneManager.getInstance().getRunningScene()).showNotEnoughKey(need_key);var remain_try_count=this.m_story_hard_mode_mission.mission.daily_try_max_count-this.m_story_hard_mode_mission.try_count;if(remain_try_count<0&&(remain_try_count=0),0==remain_try_count){if(0==this.m_story_hard_mode_mission.mission.enter_charge_group_idx){scene=SceneManager.getInstance().getRunningScene();var title=res_str("story_hard_enter_deny_popup_title");(msg=[]).push(res_str("story_hard_enter_deny_popup_text_1")),msg.push(res_str("story_hard_enter_deny_popup_text_3")),scene.showMsgBox(title,msg)}else if(100==this.m_story_hard_mode_mission.mission.enter_charge_group_idx)this.showStoryHardModeChargeTryCountPopup(this.m_story_hard_mode_mission);else{var remain_charge_count=this.m_story_hard_mode_mission.mission.enter_charge_count-this.m_story_hard_mode_mission.charge_count;if(remain_charge_count<0&&(remain_charge_count=0),0==remain_charge_count){var msg;title=res_str("story_hard_enter_deny_popup_title");return(msg=[]).push(res_str("story_hard_enter_deny_popup_text_1")),msg.push(res_str("story_hard_enter_deny_popup_text_2")),msg.push(res_str("story_hard_enter_deny_popup_text_3")),scene.showMsgBox(title,msg),this.m_start_btn.setEnabled(!0),void this.m_friend_select_scene.setEnableBackBtn(!0)}this.showStoryHardModeChargeTryCountPopup(this.m_story_hard_mode_mission)}return}this.reqStoryHardModeMissionBegin()}else if(this.m_game_type==db.BattleGameType.WeeklyDungeon)if(this.IsOpenWeeklyDungeon()){if(need_key=this.checkNeedKeyWeeklyDungeon(need_key),info.key_cnt<need_key)return this.m_start_btn.setEnabled(!0),this.m_friend_select_scene.setEnableBackBtn(!0),void(scene=SceneManager.getInstance().getRunningScene()).showNotEnoughKey(need_key);this.reqWeeklyDungeonBegin()}else this.m_start_btn.setEnabled(!0),this.m_friend_select_scene.setEnableBackBtn(!0),this.showNotOpenWeeklyDungeon();else if(this.m_game_type==db.BattleGameType.Mussang){var rVal=this.checkNeedKeyTicketMussang();if(need_key=rVal[0],need_ticket=rVal[1],info.key_cnt<need_key)return this.m_start_btn.setEnabled(!0),this.m_friend_select_scene.setEnableBackBtn(!0),void(scene=SceneManager.getInstance().getRunningScene()).showNotEnoughKey(need_key);if(info.ticket_cnt<need_ticket)return this.m_start_btn.setEnabled(!0),this.m_friend_select_scene.setEnableBackBtn(!0),void(scene=SceneManager.getInstance().getRunningScene()).showNotEnoughTicket(need_ticket);this.reqMussangStepBegin()}else if(this.m_game_type==db.BattleGameType.TowerDungeon)this.reqTowerDungeonBegin();else if(this.m_game_type==db.BattleGameType.EventDungeon)if(this.IsOpenEventDungeon()){if(need_key=this.checkNeedKeyEventDungeon(need_key),info.key_cnt<need_key)return this.m_start_btn.setEnabled(!0),this.m_friend_select_scene.setEnableBackBtn(!0),void(scene=SceneManager.getInstance().getRunningScene()).showNotEnoughKey(need_key);this.reqEventDungeonBegin()}else this.m_start_btn.setEnabled(!0),this.m_friend_select_scene.setEnableBackBtn(!0),MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.invalid_entrance_running_time);else if(this.m_game_type==db.BattleGameType.OnceADayDungeon)if(this.IsOpenOnceADayDungeon()){if(this.checkNeedKeyEventOnceADayDungeon(need_key),info.key_cnt<need_key)return this.m_friend_select_scene.setEnableBackBtn(!0),this.m_start_btn.setEnabled(!0),void(scene=SceneManager.getInstance().getRunningScene()).showNotEnoughKey(need_key);this.reqEventOnceADayDungeonBegin()}else this.m_friend_select_scene.setEnableBackBtn(!0),this.m_start_btn.setEnabled(!0),MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.invalid_entrance_running_time);else if(this.m_game_type==db.BattleGameType.DailyDungeon)if(this.IsOpenDailyDungeon()){var period=MasterManager.getInstance().get_DailyDungeonPeriod(this.m_daily_dungeon.daily_dungeon_period.daily_dungeon_period_idx);if(this.getTodayDailyDungeonPeriod(this.m_daily_dungeon.daily_dungeon_period.daily_dungeon_period_idx).key_cost_challenge_count>=period.enable_key_entrance_count)return this.m_friend_select_scene.setEnableBackBtn(!0),this.m_start_btn.setEnabled(!0),void MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.invalid_entrance_limit_over);this.reqDailyDungeonBegin()}else this.m_friend_select_scene.setEnableBackBtn(!0),this.m_start_btn.setEnabled(!0),MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.invalid_entrance_running_time);else if(this.m_game_type==db.BattleGameType.GreatWallDungeon&&this.IsOpenGreatWallDungeon()){for(var troops_list=GreatWallService.getInstance().getGreatWallTroopsGeneralList(troops_num),partin_generals=NetService().get_great_wall_troops_info().partin_generals,is_first_battle_partin=!1,idx=0;idx<troops_list.length;idx++){var g=troops_list[idx],found=0,found_is=!1;for(var p in partin_generals)if(partin_generals[p].gnrl_id==g.gnrl_id&&partin_generals[p].gnrl_num==g.gnrl_num){found_is=!0,found=p;break}if(0!=found_is&&"n"==partin_generals[found].battle_start_yn){is_first_battle_partin=!0;break}}if(is_first_battle_partin)return void MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.great_wall_first_partin_battle);this.reqGreatWallDungeonBegin()}},battleSkipStart:function(){var info=NetService().get_UserItemInfo_V2(),troops_num=this.getCurrentTroopsNum(),need_key=0;if(this.IsEmptyTroops(troops_num))MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.popup_empty_troops);else if(UserService.getInstance().isEnoughYunheeBound()||UserService.getInstance().isEnoughMaterialBound())if(UserService.getInstance().isEnoughYunheeBound())if(UserService.getInstance().isEnoughMaterialBound())if(this.IsEnoughtEquipmentBound()){if(this.m_game_type==db.BattleGameType.Mission){need_key=this.checkNeedKeyMission(0);var calc_need_key=this.m_skip_ticket_count*need_key;if(info.key_cnt<calc_need_key)return void SceneManager.getInstance().getRunningScene().showNotEnoughKey(calc_need_key);this.showDungeonSkipMsgBox(need_key)}else if(this.m_game_type==db.BattleGameType.WeeklyDungeon)if(this.IsOpenWeeklyDungeon()){need_key=this.checkNeedKeyWeeklyDungeon(need_key);calc_need_key=this.m_skip_ticket_count*need_key;if(info.key_cnt<calc_need_key)return void SceneManager.getInstance().getRunningScene().showNotEnoughKey(calc_need_key);this.showDungeonSkipMsgBox(need_key)}else this.showNotOpenWeeklyDungeon();else if(this.m_game_type==db.BattleGameType.EventDungeon)if(this.IsOpenEventDungeon()){need_key=this.checkNeedKeyEventDungeon(need_key);calc_need_key=this.m_skip_ticket_count*need_key;if(info.key_cnt<calc_need_key)return void SceneManager.getInstance().getRunningScene().showNotEnoughKey(calc_need_key);this.showDungeonSkipMsgBox(need_key)}else MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.invalid_entrance_running_time)}else MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.over_equipment_bound);else MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.over_general_material_bound);else MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.over_yunhee_bound);else MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.over_all_bound)},createStartBtn:function(base){var m=MasterTable.getInstance(),need_key=0,need_ticket=0;if(this.m_game_type==db.BattleGameType.Mission)need_key=this.checkNeedKeyMission(0);else if(this.m_game_type==db.BattleGameType.StoryHardMode)need_key=this.checkNeedKeyStoryHardModeMission();else if(this.m_game_type==db.BattleGameType.WeeklyDungeon)need_key=this.checkNeedKeyWeeklyDungeon(need_key);else if(this.m_game_type==db.BattleGameType.Mussang){var rVal=this.checkNeedKeyTicketMussang();need_key=rVal[0],need_ticket=rVal[1]}else this.m_game_type==db.BattleGameType.EventDungeon?need_key=this.checkNeedKeyEventDungeon(need_key):this.m_game_type==db.BattleGameType.DailyDungeon||this.m_game_type==db.BattleGameType.GreatWallDungeon||this.m_game_type==db.BattleGameType.TowerDungeon||this.m_game_type==db.BattleGameType.OnceADayDungeon&&this.checkNeedKeyEventOnceADayDungeon(need_key);var mission_start_btn_off=cc.Sprite.create("#btn_03_off.png");this.m_game_type==db.BattleGameType.EventDungeon?0!=this.m_event_dungeon.task_list.length?this.m_start_btn=new LabelButton("btn_45_off.png","btn_45_on.png","btn_45_none.png",ccui.Widget.PLIST_TEXTURE):this.m_start_btn=new LabelButton("btn_03_off.png","btn_03_on.png","",ccui.Widget.PLIST_TEXTURE):this.m_game_type==db.BattleGameType.WeeklyDungeon?0!=this.m_weekly_difficulty.task_list.length?this.m_start_btn=new LabelButton("btn_45_off.png","btn_45_on.png","btn_45_none.png",ccui.Widget.PLIST_TEXTURE):this.m_start_btn=new LabelButton("btn_03_off.png","btn_03_on.png","",ccui.Widget.PLIST_TEXTURE):this.m_game_type==db.BattleGameType.Mission&&0!=this.m_mission.task_list.length?this.m_start_btn=new LabelButton("btn_45_off.png","btn_45_on.png","btn_45_none.png",ccui.Widget.PLIST_TEXTURE):this.m_start_btn=new LabelButton("btn_03_off.png","btn_03_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_start_btn.setFont(LABEL_FONT_INDEX.FONT_241),this.m_start_btn.setString(""),this.m_start_btn.setOffsetX(-50),this.m_start_btn.setAnchorPoint(ZERO()),this.m_start_btn.setPosition(17,16),this.m_start_btn.setSoundPath("SE_button_key.mp3"),this.m_start_btn.addClickEventListener(function(sender){this.m_friend_select_scene.m_is_battle_start=!0,this.m_start_btn.setEnabled(!1),this.scheduleOnce(function(float){this.battleStart()},.4,"battle_begin")}.bind(this)),base.addChild(this.m_start_btn,2);var campaign={};if(campaign=m.get_RewardCampaignUi(CAMPAIGN_DUNGEON_TYPE_STORY,CAMPAIGN_POSITION_TYPE_BATTLE_ENTERANCE_BTN,campaign),this.m_game_type==db.BattleGameType.Mission)1011==this.m_mission.mission.main_mission_id&&this.m_start_btn.setTutorialTag(TUTORIAL_TAG_PAGE_1_BATTLE_START),null!=campaign.dugeon_type&&0!=campaign.dugeon_type&&(campaign.value>=this.m_mission.mission.main_story_id||0==campaign.value)&&((icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("common/%s",campaign.image_name))).setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(this.m_start_btn).x,ccHeight(this.m_start_btn)),this.m_start_btn.addChild(icon,2));else if(this.m_game_type==db.BattleGameType.StoryHardMode){var icon;campaign={};if(0!=(campaign=m.get_RewardCampaignUi(CAMPAIGN_DUNGEON_TYPE_STORY_HARD_MODE,CAMPAIGN_POSITION_TYPE_BATTLE_ENTERANCE_BTN)).dugeon_type)if(campaign.value>=this.m_story_hard_mode_mission.mission.main_story_id||0==campaign.value)(icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("new_common/%s",campaign.image_name))).setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(this.m_start_btn).x,ccHeight(this.m_start_btn)),this.m_start_btn.addChild(icon,2);var count_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",cc.rect(10,10,10,10));count_box.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),count_box.setPreferredSize(cc.size(106,30)),count_box.setPosition(ccWidth(mission_start_btn_off)-20,.5*ccHeight(mission_start_btn_off)),this.m_start_btn.addChild(count_box);var remain_entrance_count=this.m_story_hard_mode_mission.mission.daily_try_max_count-this.m_story_hard_mode_mission.try_count,remain_count=cmString(res_str("story_hard_enter_count"),remain_entrance_count,this.m_story_hard_mode_mission.mission.daily_try_max_count);this.m_story_hard_mode_try_count=cmLabelEx.getLabel(remain_count,LABEL_FONT_INDEX.FONT_1871,!1,!0,2,cc.color.BLACK),this.m_story_hard_mode_try_count.setAnchorPoint(ANCHOR_MIDDLE()),this.m_story_hard_mode_try_count.setPosition(ccCenter(count_box)),count_box.addChild(this.m_story_hard_mode_try_count);var charge_box=cc.Sprite.create(RES_CDN_DEFULT+"common/img_speech_black.png");charge_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),charge_box.setPosition(.5*ccWidth(count_box),ccHeight(count_box)+2),count_box.addChild(charge_box);var remain_charge_count=this.m_story_hard_mode_mission.mission.enter_charge_count-this.m_story_hard_mode_mission.charge_count;remain_charge_count<0&&(remain_charge_count=0);var remain_charge="";remain_charge=0==this.m_story_hard_mode_mission.mission.enter_charge_group_idx?res_str("story_hard_unable_enter_charge_count"):100==this.m_story_hard_mode_mission.mission.enter_charge_group_idx?res_str("story_hard_nolimit_enter_charge_count"):cmString(res_str("story_hard_remain_enter_charge_count"),remain_charge_count,this.m_story_hard_mode_mission.mission.enter_charge_count),this.m_story_hard_mode_charge_count=cmLabelEx.getLabel(remain_charge,LABEL_FONT_INDEX.FONT_1471,!1,!0,2,cc.color.BLACK),this.m_story_hard_mode_charge_count.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_story_hard_mode_charge_count.setPosition(65,14),charge_box.addChild(this.m_story_hard_mode_charge_count)}if(this.m_game_type==db.BattleGameType.Mussang){this.m_start_btn.setOffsetX(-100),(icon_box=new cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",cc.Rect(10,10,10,10))).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),icon_box.setPreferredSize(cc.size(66,38)),icon_box.setPosition(.5*ccWidth(mission_start_btn_off)+50,.5*ccHeight(mission_start_btn_off)),this.m_start_btn.addChild(icon_box),(key_label=cmLabel.getLabel(need_key,LABEL_FONT_INDEX.FONT_247)).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),key_label.setPosition(ccWidth(icon_box)-10,.5*ccHeight(icon_box)),icon_box.addChild(key_label);var icon_box,key_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_ic_key.png");key_icon.setAnchorPoint(ANCHOR_MIDDLE()),key_icon.setPosition(0,.5*ccHeight(icon_box)),icon_box.addChild(key_icon),(icon_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",cc.Rect(10,10,10,10))).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),icon_box.setPreferredSize(cc.size(66,38)),icon_box.setPosition(.5*ccWidth(mission_start_btn_off)+70,.5*ccHeight(mission_start_btn_off)),this.m_start_btn.addChild(icon_box);var ticket=cmLabel.getLabel(need_ticket,LABEL_FONT_INDEX.FONT_247);ticket.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),ticket.setPosition(ccWidth(icon_box)-10,.5*ccHeight(icon_box)),icon_box.addChild(ticket);var ticket_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_vs/img_vs_ic_key.png");ticket_icon.setAnchorPoint(ANCHOR_MIDDLE()),ticket_icon.setPosition(0,.5*ccHeight(icon_box)),icon_box.addChild(ticket_icon)}else if(this.m_game_type==db.BattleGameType.OnceADayDungeon){(key_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero())).setContentSize(66,38),key_bg.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),key_bg.setPosition(240,ccCenter(this.m_start_btn).y),this.m_start_btn.addChild(key_bg),(key_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_ic_key.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),key_img.setPosition(225,ccCenter(this.m_start_btn).y),this.m_start_btn.addChild(key_img),(key_label=cmLabel.getLabel(need_key,LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),key_label.setPosition(ccWidth(key_bg)-10,ccCenter(key_bg).y),key_bg.addChild(key_label)}else if(this.m_game_type==db.BattleGameType.Mission||this.m_game_type==db.BattleGameType.WeeklyDungeon||this.m_game_type==db.BattleGameType.EventDungeon||this.m_game_type==db.BattleGameType.StoryHardMode){var key_img;(key_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",cc.Rect(10,10,10,10))).setContentSize(66,38),key_bg.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),key_bg.setPosition(240,ccCenter(this.m_start_btn).y),this.m_start_btn.addChild(key_bg),(key_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_ic_key.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),key_img.setPosition(225,ccCenter(this.m_start_btn).y),this.m_start_btn.addChild(key_img),(key_label=cmLabel.getLabel(need_key,LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),key_label.setPosition(ccWidth(key_bg)-10,ccCenter(key_bg).y),key_bg.addChild(key_label)}else if(this.m_game_type==db.BattleGameType.DailyDungeon){var key_bg;(key_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",cc.Rect(10,10,10,10))).setContentSize(66,38),key_bg.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),key_bg.setPosition(240,ccCenter(this.m_start_btn).y),this.m_start_btn.addChild(key_bg);var key_label,period=MasterManager.getInstance().get_DailyDungeonPeriod(this.m_daily_dungeon.daily_dungeon_period.daily_dungeon_period_idx),challenge_log=this.getTodayDailyDungeonPeriod(this.m_daily_dungeon.daily_dungeon_period.daily_dungeon_period_idx),remain_try_count=period.enable_key_entrance_count-challenge_log.key_cost_challenge_count;remain_try_count<0&&(remain_try_count=0),(key_label=cmLabel.getLabel(remain_try_count+"/"+period.enable_key_entrance_count,LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),key_label.setPosition(ccWidth(key_bg)-10,ccCenter(key_bg).y),key_bg.addChild(key_label)}else this.m_game_type==db.BattleGameType.TowerDungeon&&this.m_start_btn.setOffsetX(0)},createSkipTicketInfo:function(base,userInfo){if(this.m_game_type==db.BattleGameType.Mission||this.m_game_type==db.BattleGameType.WeeklyDungeon||this.m_game_type==db.BattleGameType.EventDungeon){var boxSize=cc.size(458,66),task_info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());if(task_info_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),task_info_box.setPosition(10,126),task_info_box.setPreferredSize(boxSize),base.addChild(task_info_box),this.m_game_type!=db.BattleGameType.WeeklyDungeon){var text_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_friend/img_friend_text.png");text_icon.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),text_icon.setScale(.6),text_icon.setPosition(52,ccCenter(task_info_box).y+23),task_info_box.addChild(text_icon);var info_label=cmLabel.getLabel(res_str("label_friend_helper_info_text"),LABEL_FONT_INDEX.FONT_1613);info_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),info_label.setPosition(88,ccCenter(task_info_box).y+23),task_info_box.addChild(info_label)}var title=cmLabel.getLabel(res_str("label_task_title"),LABEL_FONT_INDEX.FONT_201);title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(46,16),task_info_box.addChild(title);var complete_task=this.getCompleteTaskCount(),task_offset_x=133,sakura_name="";sakura_name=this.m_game_type==db.BattleGameType.Mission?"sakura":"sakura_3",this.m_taskSakuraSprList.clear();for(var i=0;i<3;i++){var task=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_"+sakura_name+"_off.png");if(i<complete_task){var frame=RES_CDN_DEFULT+"menu_quest/img_story_"+sakura_name+"_on.png",frame2_texture=cc.textureCache.addImage(frame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));task.setSpriteFrame(frame2)}else{frame=RES_CDN_DEFULT+"menu_quest/img_story_"+sakura_name+"_off.png",frame2_texture=cc.textureCache.addImage(frame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));task.setSpriteFrame(frame2)}task.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),task.setPosition(task_offset_x,13),task.setScale(.8),task_info_box.addChild(task),task_offset_x+=36,this.m_taskSakuraSprList.push(task)}this.m_have_skip_ticket_count=userInfo.skip_ticket_count;var ticket_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_ic_skipticket.png");ticket_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),ticket_icon.setPosition(269,6),ticket_icon.setScale(.8),task_info_box.addChild(ticket_icon),this.m_haveSkipTicketLabel=cmLabel.getLabel(cmString(res_str("label_task_skip_ticket_quantity")," "),LABEL_FONT_INDEX.FONT_201),this.m_haveSkipTicketLabel.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_haveSkipTicketLabel.setPosition(302,16),task_info_box.addChild(this.m_haveSkipTicketLabel),this.m_haveSkipTicketCountLabel=cmLabel.getLabel(Number(this.m_have_skip_ticket_count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_2011),this.m_haveSkipTicketCountLabel.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_haveSkipTicketCountLabel.setPosition(372,16),task_info_box.addChild(this.m_haveSkipTicketCountLabel)}},refrashSkipBtn:function(count){null!=this.m_rightLayer&&(this.m_have_skip_ticket_count=count,null!=this.m_haveSkipTicketCountLabel&&null!=this.m_haveSkipTicketCountLabel&&this.m_haveSkipTicketCountLabel.setString(Number(this.m_have_skip_ticket_count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_2011),this.createStartSkipBtn())},createStartSkipBtn:function(base){if(null!=base){if(this.m_game_type==db.BattleGameType.Mission||this.m_game_type==db.BattleGameType.WeeklyDungeon||this.m_game_type==db.BattleGameType.EventDungeon){this.m_itemMinusBtn=new ccui.Button("btn_spinner_minus_2_off.png","btn_spinner_minus_2_on.png","btn_spinner_minus_2_none.png",ccui.Widget.PLIST_TEXTURE),this.m_itemMinusBtn.setAnchorPoint(ZERO()),this.m_itemMinusBtn.setPosition(17,81),this.m_itemMinusBtn.addClickEventListener(function(sender){this.onSkipTicketMinus()}.bind(this)),base.addChild(this.m_itemMinusBtn),this.m_itemPlusBtn=new ccui.Button("btn_spinner_plus_2_off.png","btn_spinner_plus_2_on.png","btn_spinner_plus_2_none.png",ccui.Widget.PLIST_TEXTURE),this.m_itemPlusBtn.setAnchorPoint(ZERO()),this.m_itemPlusBtn.setPosition(416,81),this.m_itemPlusBtn.addClickEventListener(function(sender){this.onSkipTicketPlus()}.bind(this)),base.addChild(this.m_itemPlusBtn);var need_ticket=1;null!=this.m_weekly_difficulty&&(this.m_game_type==db.BattleGameType.EventDungeon?need_ticket="y"==this.m_event_dungeon.event_dungeon.two_times_yn?2:1:this.m_game_type==db.BattleGameType.WeeklyDungeon&&(need_ticket="y"==this.m_weekly_difficulty.weekly_difficulty.two_times_yn?2:1)),this.m_startBtn=new LabelButton("btn_46_off.png","btn_46_on.png","btn_46_none.png",ccui.Widget.PLIST_TEXTURE),this.m_startBtn.setFont(LABEL_FONT_INDEX.FONT_201),this.m_startBtn.setString(res_str("btn_label_skip")),this.m_startBtn.setOffsetX(-50),this.m_startBtn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_startBtn.setPosition(72,76),this.m_startBtn.setSoundPath("SE_button_key.mp3"),this.m_startBtn.addClickEventListener(function(sender){this.scheduleOnce(function(float){this.battleSkipStart()}.bind(this),.4,"battle_begin")}.bind(this)),base.addChild(this.m_startBtn);var key_bg=new cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero());key_bg.setContentSize(cc.size(66,30)),key_bg.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),key_bg.setPosition(186,ccCenter(this.m_startBtn).y),this.m_startBtn.addChild(key_bg);var key_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_ic_skipticket.png");key_img.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),key_img.setPosition(174,ccCenter(this.m_startBtn).y),this.m_startBtn.addChild(key_img),this.m_skipTicketCountLabel=cmLabel.getLabel(cmString("%d",need_ticket),LABEL_FONT_INDEX.FONT_2011),this.m_skipTicketCountLabel.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_skipTicketCountLabel.setPosition(ccWidth(key_bg)-10,ccCenter(key_bg).y),key_bg.addChild(this.m_skipTicketCountLabel),(3!=this.getCompleteTaskCount()||this.getAmountSkipTicket(this.m_skip_ticket_count)>this.m_have_skip_ticket_count)&&(this.m_startBtn.setEnabled(!1),this.m_itemMinusBtn.setEnabled(!1),this.m_itemPlusBtn.setEnabled(!1))}}else(3!=this.getCompleteTaskCount()||this.getAmountSkipTicket(this.m_skip_ticket_count)>this.m_have_skip_ticket_count)&&(this.m_startBtn.setEnabled(!1),this.m_itemMinusBtn.setEnabled(!1),this.m_itemPlusBtn.setEnabled(!1))},createEventDungeonRaidStartBtn:function(base){var start_btn=new LabelButton("btn_03_off.png","btn_03_on.png","",ccui.Widget.PLIST_TEXTURE);start_btn.setFont(LABEL_FONT_INDEX.FONT_241),start_btn.setString(res_str("label_start_mission")),start_btn.setOffsetX(-50),start_btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),start_btn.setPosition(17,16),start_btn.setSoundPath("SE_button_key.mp3"),start_btn.addClickEventListener(function(sender){this.battleStart()}.bind(this),.4,"battle_begin"),base.addChild(start_btn,2)},initStartBtn:function(){null!=this.m_start_btn&&this.m_start_btn.setEnabled(!0)},updateTroopsBtns:function(){for(var troops_num=this.getCurrentTroopsNum(),i=0;i<this.m_troops_btns.length;i++){var t=i+1;this.m_troops_btns[i].setEnabled(!(t==troops_num))}},getCurrentTroopsNum:function(){var troops_num=0,gd=GameDefault.getInstance();return this.m_game_type==db.BattleGameType.WeeklyDungeon?gd.getUserWeeklyTroopsNum().done(function(rVal){troops_num=rVal}):this.m_game_type==db.BattleGameType.Mussang?gd.getUserMussangTroopsNum().done(function(rVal){troops_num=rVal}):this.m_game_type==db.BattleGameType.Mission?1==USE_LOCAL_STORAGE_TROOPS_OFF?troops_num=gd.getUserTroopsNum():gd.getUserTroopsNum().done(function(rVal){troops_num=rVal}):this.m_game_type==db.BattleGameType.EventDungeon?gd.getUserEventDungeonTroopsNum().done(function(rVal){troops_num=rVal}):this.m_game_type==db.BattleGameType.DailyDungeon?gd.getUserDailyDungeonTroopsNum().done(function(rVal){troops_num=rVal}):this.m_game_type==db.BattleGameType.RaidDungeon?gd.getUserRaidBossTroopsNum().done(function(rVal){troops_num=rVal}):this.m_game_type==db.BattleGameType.GreatWallDungeon?gd.getUserGreatWallTroopsNum().done(function(rVal){troops_num=rVal}):this.m_game_type==db.BattleGameType.TowerDungeon?gd.getUserTowerDungeonTroopsNum().done(function(rVal){troops_num=rVal}):this.m_game_type==db.BattleGameType.OnceADayDungeon?gd.getUserOnceADayDungeonTroopsNum().done(function(rVal){troops_num=rVal}):this.m_game_type==db.BattleGameType.EventRaidDungeon?gd.getUserEventRaidDungeonTroopsNum().done(function(rVal){troops_num=rVal}):this.m_game_type==db.BattleGameType.StoryHardMode?gd.getUserTroopsNum().done(function(rVal){troops_num=rVal}):this.m_game_type==db.BattleGameType.NewRaidBossDungeon&&gd.getUserTroopsNum().done(function(rVal){troops_num=rVal}),troops_num},IsEmptyTroops:function(troops_num){return 0==this.m_userTroopsList.filter(function(l){return l.troops_num==troops_num}).length},IsOpenGreatWallDungeon:function(){var m=MasterManager.getInstance(),great_wall_dungeon_period_idx=GreatWallService.getInstance().getCurrentGreatWallPeriodIdx(),period=m.get_GreatWallDungeonPeriod(great_wall_dungeon_period_idx),now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),b=moment(period.begin_dt).valueOf(),e=moment(period.end_dt).valueOf();return b<=n&&n<=e},IsOpenDailyDungeon:function(){var now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),b=this.m_daily_dungeon.daily_dungeon_period.begin_date,e=this.m_daily_dungeon.daily_dungeon_period.end_date;return b<=n&&n<=e},IsOpenOnceADayDungeon:function(){var now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),b=moment(this.m_once_a_day_dungeon.dungeon.begin_dt,["YYYY-MM-DD hh:mm:ss"]).valueOf(),e=moment(this.m_once_a_day_dungeon.dungeon.end_dt,["YYYY-MM-DD hh:mm:ss"]).valueOf();return b<=n&&n<=e},IsOpenEventDungeon:function(){var now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),b=this.m_event_dungeon.event_dungeon_period.begin_date.valueOf(),e=this.m_event_dungeon.event_dungeon_period.end_date.valueOf();return b<=n&&n<=e},IsOpenWeeklyDungeon:function(){for(var is_open=!1,idx=0;idx<this.m_weekly_dungeon.weekly_period.length;idx++){var d=this.m_weekly_dungeon.weekly_period[idx],now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),n=moment(now).valueOf(),b=d.begin_date,e=d.end_date;if(!(n>e.valueOf())&&(b-(d.is_user_period?5:1)<=n&&n<=e+1)){is_open=!0;break}}return is_open},showNotOpenWeeklyDungeon:function(){var mt=MasterManager.getInstance();this.m_message_box.setTitle(mt.get_LanguageData("label_weekly_dungeon_open_title")),this.m_message_box.setText(mt.get_LanguageData("label_weekly_dungeon_not_open")),this.m_message_box.setText("\n"),this.m_message_box.addButtonInfo(new MessageButtonInfo(res_str("label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){var runScene=SceneManager.getInstance().getRunningScene();runScene.initLayoutProgress(),runScene.back()},.1,"weekly_dungeon_cannot_buy_open"),this.m_message_box.hide()}.bind(this))),this.m_message_box.show()},IsEnoughtYunheeBound:function(callback,info){UserService.getInstance().isEnoughYunheeBound()||UserService.getInstance().isEnoughMaterialBound()?callback(info):(this.m_friend_select_scene.setEnableBackBtn(!0),MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.over_yunhee_bound))},IsEnoughtEquipmentBound:function(){return!EquipmentService.getInstance().isOverUserEquipmentBound()},getTodayDailyDungeonPeriod:function(daily_dungeon_period_idx){for(var now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),ts=moment(now).format("YYYY-MM-DD"),log={},open_priod=NetService().get_daily_dungeon_open_period_info().daily_dungeon_open_period,is_exist=!1,idx=0;idx<open_priod.length;idx++){var p=open_priod[idx];if(p.daily_dungeon_period_idx==daily_dungeon_period_idx&&p.challenge_dt==ts){log=p,is_exist=!0;break}}return is_exist||(log.daily_dungeon_period_idx=daily_dungeon_period_idx,log.challenge_dt=ts,log.key_cost_challenge_count=0,log.jade_cost_challenge_count=0),log},onTouchWarningTooltip:function(sender,_event){_event==cc.CONTROL_EVENT_TOUCH_DOWN?this.showGreatWallWarningTooltip():this.hideGreatWallWarningTooltip()},showGreatWallWarningTooltip:function(){var tip=cmString("%s\n%s\n%s\n%s",res_str("label_great_wall_leader_skill_warning_1"),res_str("label_great_wall_leader_skill_warning_2"),res_str("label_great_wall_leader_skill_warning_3"),res_str("label_great_wall_leader_skill_warning_4"));this.tooltip_content.setString(tip);var tSize=ccSize(this.tooltip_content),bSize=cc.size(tSize.width+40,tSize.height+20);bSize.width=MAX(64,tSize.width+40),bSize.height=MAX(54,tSize.height+20),this.tooltip_box.setPreferredSize(bSize),this.tooltip_content.setPosition(ccCenter(bSize)),this.tooltip_box.setVisible(!0)},hideGreatWallWarningTooltip:function(){this.tooltip_box.setVisible(!1)},onTouchWeakPointTooltip:function(sender,_event){_event==cc.CONTROL_EVENT_TOUCH_DOWN?this.showGreatWallWeakPointTooltip():this.hideGreatWallWeakPointTooltip()},showGreatWallWeakPointTooltip:function(){this.m_wp_tooltip_content.setString(this.m_great_wall_dungeon.great_wall_dungeon.stage_tip);var tSize=ccSize(this.m_wp_tooltip_content),bSize=cc.size(tSize.width+40,tSize.height+20);bSize.width=MAX(64,tSize.width+40),bSize.height=MAX(54,tSize.height+20),this.m_wp_tooltip_box.setPreferredSize(bSize),this.m_wp_tooltip_content.setPosition(ccCenter(bSize)),this.m_wp_tooltip_box.setVisible(!0)},hideGreatWallWeakPointTooltip:function(){this.m_wp_tooltip_box.setVisible(!1)},initLayoutProgress:function(alpa){if(!IS_NET_ERROR&&null==this.m_progres_bar){this.m_progres_bar=new cc.LayerColor(cc.color.BLACK),null==alpa&&(alpa=255),this.m_progres_bar.setOpacity(alpa),this.m_progres_bar.setContentSize(ccSize(this));var bg=cc.Sprite.create(RES_CM+"img_progress_bg.png");bg.setPosition(ccCenter(this));var bar=cc.Sprite.create(RES_CM+"img_progress_arrow.png");bar.setPosition(ccCenter(bg)),bg.addChild(bar,1000001),this.m_progres_bar.addChild(bg),this.addChild(this.m_progres_bar,1000001);var loading=new cc.Sprite(res.s_cm_img_text_loading);loading.setAnchorPoint(.5,0),loading.setPosition(ccCenter(bg).x,ccCenter(bg).y-100),loading.setOpacity(alpa),bg.addChild(loading,1000001);var mu=new cc.RotateBy(.1,30),seq=new cc.Sequence(mu),repeat=new cc.RepeatForever(seq);bar.runAction(repeat);var listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE});listener.onTouchBegan=function(touch,event){event.stopPropagation()}.bind(this);var mouse_listener=cc.EventListener.create({event:cc.EventListener.MOUSE,onMouseScroll:function(event){event.stopPropagation()}.bind(this)});cc.eventManager.addListener(mouse_listener,this.m_progres_bar),cc.eventManager.addListener(listener,this.m_progres_bar)}},removeLayerProgress:function(){null!=this.m_progres_bar&&(cc.eventManager.removeListeners(this.m_progres_bar),this.removeChild(this.m_progres_bar),this.m_progres_bar=null)},reqEventDungeonRaidBegin:function(){MasterManager.getInstance();var nService=NetService(),context=BattleContext._getInstance(),event_raid_info=nService.get_Event_Raid_Dungeon_Info(),req={};req.opcode=net.OP.op_event_raid_dungeon_battle_begin,req.boss_num=event_raid_info.event_raid_boss_info.boss_num,req.event_dungeon_period_idx=event_raid_info.event_dungeon_period_idx,req.event_raid_dungeon_idx=event_raid_info.event_raid_boss_info.event_raid_dungeon_idx,req.multiple_type=context.getEventRaidDungeonBattleTicket(),req.troops_num=this.getCurrentTroopsNum();var info={event_raid_dungeon_idx:event_raid_info.event_raid_boss_info.event_raid_dungeon_idx,boss_num:0,remain_hp:0,die_yn:!1};BattleContext._getInstance().setEventRaidDungeonData(info);var mainScene=SceneManager.getInstance().getMainScene(),client=GameClient(),troopNum=this.getCurrentTroopsNum();return BattleContext._getInstance().setBeforeBattleUserInfoByTroops(troopNum),client.write(req,mainScene.onNetworkEvent,mainScene),!0},EventRaidBattleStart:function(ticketcount){var m=MasterManager.getInstance(),nService=new NetService,service=EventDungeonService.getInstance(),context=BattleContext._getInstance(),troops_num=this.getCurrentTroopsNum(),base_need_point=m.get_EventRaidDungeon(nService.get_Event_Raid_Dungeon_idx()),event_dungeon_point={};if(service.getUserEventDungeonPoint(m.get_EventRaidDungeon(nService.get_Event_Raid_Dungeon_idx()).event_dungeon_period_idx,event_dungeon_point),this.IsEmptyTroops(troops_num))MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.popup_empty_troops);else if(event_dungeon_point.event_point<base_need_point*ticketcount)MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.popup_lack_event_point);else{context.setEventRaidDungeonBattleTicket(ticketcount);for(var event_raid_info=nService.get_Event_Raid_Dungeon_Info(),i=0;i<event_raid_info.event_raid_boss_info.boss_damage.length;i++){var Type=event_raid_info.event_raid_boss_info.boss_damage[i];Type.multiple_type==ticketcount&&(0==Type.damage?MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.event_raid_battle_start):(this.m_boss_Damage=Type.damage,MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectEnum.event_raid_select_battle)))}}},getAmountSkipTicket:function(ticket_count){var twice=1;return this.m_game_type==db.BattleGameType.EventDungeon?twice="y"==this.m_event_dungeon.event_dungeon.two_times_yn?2:1:this.m_game_type==db.BattleGameType.WeeklyDungeon&&(twice="y"==this.m_weekly_difficulty.weekly_difficulty.two_times_yn?2:1),ticket_count*twice*this.m_skip_ticket_default},showDungeonSkipMsgBox:function(needKey){var userInfo=NetService().get_UserItemInfo_V2(),skipTicketInfo={};skipTicketInfo.amount_skip_count=this.m_skip_ticket_count,skipTicketInfo.spend_ticket_count=this.getAmountSkipTicket(this.m_skip_ticket_count),skipTicketInfo.spend_key_count=needKey*this.m_skip_ticket_count,this.m_startSkipTicketModalLayer._contentNode=function(contentSize,m){return this.getStartSkipTicketLayer(skipTicketInfo,userInfo)}.bind(this),this.m_startSkipTicketModalLayer.show()},getCompleteTaskCount:function(){var bs=BattleService.getInstance(),context=BattleContext._getInstance(),complete_task=0;if(this.m_game_type==db.BattleGameType.EventDungeon){var event_dungeon_list=[],service=BattleService.getInstance(),event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();event_dungeon_list=service.getUserEventDungeonList(event_dungeon_period_idx,event_dungeon_list);for(var i=0;i<event_dungeon_list.length;i++)event_dungeon_list[i].event_dungeon_idx==this.m_event_dungeon.event_dungeon_idx&&(bs.getMasterEventDungeonNpcInfo(event_dungeon_list[i]),context.setEventDungeonData(event_dungeon_list[i]));this.m_event_dungeon=context.getEventDungeonData();for(i=0;i<this.m_event_dungeon.task_list.length;i++)this.m_event_dungeon.task_list[i].is_complete&&(complete_task+=1)}else if(this.m_game_type==db.BattleGameType.WeeklyDungeon){var dungeon_list=[];BattleService.getInstance().getMasterWeeklyDungeon(dungeon_list);for(var is_exist=!1,j=0;j<dungeon_list.length;j++){var w=dungeon_list[j];if(w.weekly_idx==this.m_weekly_difficulty.weekly_idx)for(var k=0;k<w.weekly_difficulty.length;k++){var d=w.weekly_difficulty[k];if(d.weekly_difficulty.dungeon_idx==this.m_weekly_difficulty.weekly_difficulty.dungeon_idx){context.setWeeklyDungeonData(w);var dungeon=d;BattleService.getInstance().getMasterWeeklyDungeonStageNpc(dungeon),context.setWeeklyDungeonDifficulty(dungeon),is_exist=!0;break}}}is_exist&&(this.m_weekly_dungeon=context.getWeeklyDungeonData(),this.m_weekly_difficulty=context.getWeeklyDungeonDifficulty());for(i=0;i<this.m_weekly_difficulty.task_list.length;i++)this.m_weekly_difficulty.task_list[i].is_complete&&(complete_task+=1)}else if(this.m_game_type==db.BattleGameType.Mission){var mission_id=context.getMissionID();this.m_mission={},(service=BattleService.getInstance()).getMainMissionAndNpc(mission_id,this.m_mission);for(i=0;i<this.m_mission.task_list.length;i++)this.m_mission.task_list[i].is_cleared&&(complete_task+=1)}return complete_task},onSkipTicketPlus:function(){var info=NetService().get_UserItemInfo_V2(),ticket_count=this.m_skip_ticket_count+1,need_key=0;this.m_game_type==db.BattleGameType.Mission?need_key=this.checkNeedKeyMission(0):this.m_game_type==db.BattleGameType.EventDungeon?need_key=this.checkNeedKeyEventDungeon(0):this.m_game_type==db.BattleGameType.WeeklyDungeon&&(need_key=this.checkNeedKeyWeeklyDungeon(0)),this.getAmountSkipTicket(ticket_count)>this.m_have_skip_ticket_count?MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectSkipEnum.battle_skip_lack_ticket):info.key_cnt<need_key*ticket_count?info.key_cnt>info.key_bound?MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectSkipEnum.battle_skip_lack_key2):MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectSkipEnum.battle_skip_lack_key1):(this.m_skip_ticket_count++,this.m_skipTicketCountLabel.setString(cmString("%d",this.getAmountSkipTicket(this.m_skip_ticket_count))))},onSkipTicketMinus:function(){this.m_skip_ticket_count<=1?(this.m_skip_ticket_count=1,MainObserver.getInstance().postNotification(sceneStr[scene_FriendSelectScene],FriendSelectSkipEnum.battle_skip_zero_ticket)):this.m_skip_ticket_count-=1,this.m_skipTicketCountLabel.setString(cmString("%d",this.getAmountSkipTicket(this.m_skip_ticket_count)))},updateSkipTicketCount:function(){if(!(this.m_game_type!=db.BattleGameType.Mission&&this.m_game_type!=db.BattleGameType.WeeklyDungeon&&this.m_game_type!=db.BattleGameType.EventDungeon||this.m_game_type==db.BattleGameType.Mission&&0==this.m_mission.task_list.length||this.m_game_type==db.BattleGameType.EventDungeon&&0==this.m_event_dungeon.task_list.length||this.m_game_type==db.BattleGameType.WeeklyDungeon&&0==this.m_weekly_difficulty.task_list.length||3!=this.m_taskSakuraSprList.length)){var userInfo=NetService().get_UserItemInfo_V2();this.m_have_skip_ticket_count=userInfo.skip_ticket_count,null!=this.m_haveSkipTicketCountLabel&&null!=this.m_haveSkipTicketCountLabel&&this.m_haveSkipTicketCountLabel.setString(Number(this.m_have_skip_ticket_count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_2011),this.m_skip_ticket_count=1;var complete_task=this.getCompleteTaskCount();3!=complete_task||this.getAmountSkipTicket(this.m_skip_ticket_count)>this.m_have_skip_ticket_count?(this.m_itemMinusBtn.setEnabled(!1),this.m_itemPlusBtn.setEnabled(!1),this.m_startBtn.setEnabled(!1)):(this.m_itemMinusBtn.setEnabled(!0),this.m_itemPlusBtn.setEnabled(!0),this.m_startBtn.setEnabled(!0)),null!=this.m_skipTicketCountLabel&&this.m_skipTicketCountLabel.setString(cmString("%d",this.getAmountSkipTicket(this.m_skip_ticket_count)));var sakura_name="";if(sakura_name=this.m_game_type==db.BattleGameType.Mission?"sakura":"sakura_3",this.m_taskSakuraSprList.clear(),3==this.m_taskSakuraSprList.length)for(var i=0;i<3;i++){var spr=this.m_taskSakuraSprList[i];if(i<complete_task){var frame=RES_CDN_DEFULT+"menu_quest/img_story_"+sakura_name+"_on.png",frame2_texture=cc.textureCache.addImage(frame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));spr.setSpriteFrame(frame2)}else{frame=RES_CDN_DEFULT+"menu_quest/img_story_"+sakura_name+"_off.png",frame2_texture=cc.textureCache.addImage(frame),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));spr.setSpriteFrame(frame2)}}}},sendPacketStorySkip:function(){var mission_id=BattleContext._getInstance().getMissionID(),req={};req.opcode=net.OP.op_story_dungeon_battle_skip,req.troops_num=this.getCurrentTroopsNum(),req.mission_id=mission_id,req.skip_ticket=this.getAmountSkipTicket(this.m_skip_ticket_count),SceneManager.getInstance().getRunningScene().network_write(req),this.m_friend_select_scene.setEnableBackBtn(!1),this.choiceFriend(-1)},sendPacketEventSkip:function(){var context=BattleContext._getInstance(),troops_num=this.getCurrentTroopsNum(),dungeon=context.getEventDungeonData(),req={};req.opcode=net.OP.op_event_dungeon_battle_skip,req.event_dungeon_idx=dungeon.event_dungeon.event_dungeon_idx,req.event_dungeon_period_idx=dungeon.event_dungeon_period.event_dungeon_period_idx,req.troops_num=troops_num,req.skip_ticket=this.getAmountSkipTicket(this.m_skip_ticket_count),SceneManager.getInstance().getRunningScene().network_write(req),this.m_friend_select_scene.setEnableBackBtn(!1),this.choiceFriend(-1)},sendPacketWeeklySkip:function(){var troops_num=this.getCurrentTroopsNum();if(0<this.m_weekly_difficulty.weekly_difficulty.weekly_idx){var req={};req.opcode=net.OP.op_weekly_dungeon_battle_skip,req.weekly_idx=this.m_weekly_difficulty.weekly_difficulty.weekly_idx,req.weekly_difficulty_id=this.m_weekly_difficulty.weekly_difficulty.dungeon_idx,req.troops_num=troops_num,req.skip_ticket=this.getAmountSkipTicket(this.m_skip_ticket_count),SceneManager.getInstance().getRunningScene().network_write(req),this.m_friend_select_scene.setEnableBackBtn(!1)}},sendPacketSkipTicket:function(){this.m_game_type==db.BattleGameType.Mission?this.sendPacketStorySkip():this.m_game_type==db.BattleGameType.WeeklyDungeon?this.sendPacketWeeklySkip():this.m_game_type==db.BattleGameType.EventDungeon&&this.sendPacketEventSkip()},getStartSkipTicketLayer:function(skipTicketInfo,userInfo){var layer=new cc.Layer,info=userInfo,remain_ticket=info.skip_ticket_count-skipTicketInfo.spend_ticket_count,remain_key=info.key_cnt-skipTicketInfo.spend_key_count,rect=cc.Rect(40,40,10,10),bg=new cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",rect),friend_noti_offset=cc.p(0,0);USE_FRIEND_SPEICAL_EFFECT&&this.m_game_type==db.BattleGameType.EventDungeon?bg.setPreferredSize(cc.size(630,400)):(bg.setPreferredSize(cc.size(630,370)),friend_noti_offset=cc.p(0,-30)),bg.setPosition(ccCenter(layer)),layer.addChild(bg);var navi=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_navi.png",RectZero());navi.setInsetLeft(46),navi.setInsetRight(46),navi.setPreferredSize(cc.size(614,48)),navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(bg).x,ccHeight(bg)-11),bg.addChild(navi);var title_label=cmLabel.getLabel(res_str("label_task_skip_use_confirm_popup_title"),LABEL_FONT_INDEX.FONT_261);title_label.setAnchorPoint(ANCHOR_MIDDLE()),title_label.setPosition(ccCenter(navi).x,ccCenter(navi).y+3),navi.addChild(title_label);var explanation_1=new cmMultiLabel;explanation_1.addLabel("",LABEL_FONT_INDEX.FONT_221),explanation_1.addLabel(skipTicketInfo.spend_ticket_count,LABEL_FONT_INDEX.FONT_227),explanation_1.addLabel("",LABEL_FONT_INDEX.FONT_221),explanation_1.addLabel(skipTicketInfo.spend_key_count,LABEL_FONT_INDEX.FONT_227),explanation_1.addLabel("",LABEL_FONT_INDEX.FONT_221),explanation_1.setLabel(),explanation_1.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),explanation_1.setPosition(ccCenter(bg).x-180,217+GetFontSize(LABEL_FONT_INDEX.FONT_221)+friend_noti_offset.y+60),bg.addChild(explanation_1);var explanation_2=new cmMultiLabel;explanation_2.addLabel("",LABEL_FONT_INDEX.FONT_221),explanation_2.addLabel(skipTicketInfo.amount_skip_count,LABEL_FONT_INDEX.FONT_227),explanation_2.addLabel("",LABEL_FONT_INDEX.FONT_221),explanation_2.setLabel(),explanation_2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),explanation_2.setPosition(ccCenter(bg).x-180,217+GetFontSize(LABEL_FONT_INDEX.FONT_221)+friend_noti_offset.y+40),bg.addChild(explanation_2);var explanation_3=new cmMultiLabel;explanation_3.addLabel("",LABEL_FONT_INDEX.FONT_221),explanation_3.setLabel(),explanation_3.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),explanation_3.setPosition(ccCenter(bg).x-180,217+GetFontSize(LABEL_FONT_INDEX.FONT_221)+friend_noti_offset.y+20),bg.addChild(explanation_3);var ticket_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_ic_skipticket.png");ticket_img.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),ticket_img.setPosition(222,157+GetFontSize(LABEL_FONT_INDEX.FONT_241)+friend_noti_offset.y),bg.addChild(ticket_img);var spendTicketCountLabel=new cmMultiLabel;if(spendTicketCountLabel.addLabel(info.skip_ticket_count+" > ",LABEL_FONT_INDEX.FONT_241),spendTicketCountLabel.addLabel(remain_ticket,LABEL_FONT_INDEX.FONT_247),spendTicketCountLabel.setLabel(),spendTicketCountLabel.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),spendTicketCountLabel.setPosition(273,179+GetFontSize(LABEL_FONT_INDEX.FONT_241)+friend_noti_offset.y),bg.addChild(spendTicketCountLabel),USE_FRIEND_SPEICAL_EFFECT&&this.m_game_type==db.BattleGameType.EventDungeon){var friend_noti=cmLabel.getLabel(res_str("skip_friend_buff_guide"),LABEL_FONT_INDEX.FONT_1821);friend_noti.setAnchorPoint(ANCHOR_MIDDLE()),friend_noti.setPosition(ccCenter(bg).x,82+GetFontSize(LABEL_FONT_INDEX.FONT_1821)),bg.addChild(friend_noti)}var key_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_ic_key.png");key_img.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),key_img.setPosition(218,97+GetFontSize(LABEL_FONT_INDEX.FONT_241)+friend_noti_offset.y),bg.addChild(key_img);var spendKeyCountLabel=new cmMultiLabel;spendKeyCountLabel.addLabel(info.key_cnt+" > ",LABEL_FONT_INDEX.FONT_241),spendKeyCountLabel.addLabel(remain_key,LABEL_FONT_INDEX.FONT_247),spendKeyCountLabel.setLabel(),spendKeyCountLabel.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),spendKeyCountLabel.setPosition(273,120+GetFontSize(LABEL_FONT_INDEX.FONT_241)+friend_noti_offset.y),bg.addChild(spendKeyCountLabel);var btn_no=new LabelButton("btn_08_off.png","btn_08_on.png","",ccui.Widget.PLIST_TEXTURE);btn_no.setFont(LABEL_FONT_INDEX.FONT_241),btn_no.setString(res_str("btn_label_cancel")),btn_no.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),btn_no.setPosition(ccCenter(bg).x-5,16),btn_no.addClickEventListener(function(sender){this.m_startSkipTicketModalLayer.hide()}.bind(this)),bg.addChild(btn_no);var btn_yes=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);return btn_yes.setFont(LABEL_FONT_INDEX.FONT_241),btn_yes.setString(res_str("btn_label_confirm")),btn_yes.setAnchorPoint(ZERO()),btn_yes.setPosition(ccCenter(bg).x+5,16),bg.addChild(btn_yes),btn_yes.addClickEventListener(function(sender){this.scheduleOnce(function(float){this.sendPacketSkipTicket()},0,"getStartSkipTicketLayer"),this.m_startSkipTicketModalLayer.hide()}.bind(this)),layer},onTouchBegan:function(pTouch,pEvent){return!0},onTouchMoved:function(pTouch,pEvent){},onTouchEnded:function(pTouch,pEvent){},onTouchCancelled:function(pTouch,pEvent){},showStoryHardModeChargeTryCountPopup:function(mission){if(0<mission.mission.daily_try_max_count-mission.try_count){var scene=SceneManager.getInstance().getRunningScene(),title=res_str("label_information_title"),msg=[];return msg.push(res_str("story_hard_enter_charge_cannot_popup_text")),msg.push(res_str("story_hard_enter_deny_popup_text_3")),void scene.showMsgBox(title,msg)}if(0!=mission.mission.enter_charge_group_idx){var is_enable_charge=!0,need_count=0,charge_info=[];if(charge_info=MasterTable.getInstance().get_MainStoryHardModeEnterChargeInfoList(mission.mission.enter_charge_group_idx),100==mission.mission.enter_charge_group_idx)need_count=charge_info[0].need_count;else if(mission.charge_count<mission.mission.enter_charge_count){var next_charge_count=mission.charge_count+1,found=charge_info.findIndex(function(info){return info.charge_count==next_charge_count}.bind(this));-1!=found&&(need_count=charge_info[found].need_count)}else is_enable_charge=!1;if(is_enable_charge)if(NetService().get_UserItemInfo_V2().jade_cnt<need_count){(scene=SceneManager.getInstance().getRunningScene()).showNotEnoughJade(!0)}else{this.m_message_box2.setTitle(res_str("story_hard_enter_deny_popup_title"));var remain_charge_count=mission.mission.enter_charge_count-mission.charge_count;this.m_message_box2.setText(res_str("story_hard_enter_deny_popup_text_1"),LABEL_FONT_INDEX.FONT_261),this.m_message_box2.setText("\n"),this.m_message_box2.setText(" 04:00",LABEL_FONT_INDEX.FONT_247),this.m_message_box2.setText("\n"),this.m_message_box2.setText(" "),this.m_message_box2.setText("\n"),this.m_message_box2.setText(" "),this.m_message_box2.setText("\n"),this.m_message_box2.setText(" "),this.m_message_box2.setText("\n"),this.m_message_box2.setText(""+need_count+"",LABEL_FONT_INDEX.FONT_247),this.m_message_box2.setText("",LABEL_FONT_INDEX.FONT_261),this.m_message_box2.setText("\n"),this.m_message_box2.setText("",LABEL_FONT_INDEX.FONT_261),this.m_message_box2.setText(mission.mission.daily_try_max_count+"",LABEL_FONT_INDEX.FONT_247),this.m_message_box2.setText("",LABEL_FONT_INDEX.FONT_261),this.m_message_box2.setText("\n"),100!=mission.mission.enter_charge_group_idx&&(this.m_message_box2.setText(" : "+remain_charge_count+"/"+mission.mission.enter_charge_count+"",LABEL_FONT_INDEX.FONT_245),this.m_message_box2.setText("\n"));var btnNo=new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0);btnNo.click=function(){this.m_message_box2.hide(!1),this.m_start_btn.setEnabled(!0),this.m_friend_select_scene.setEnableBackBtn(!0)}.bind(this);var btnYes=new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0);btnYes.click=function(){this.scheduleOnce(function(float){var req={};req.opcode=net.OP.op_main_story_hard_mode_mission_charge,req.main_story_hard_mode_mission_idx=mission.mission.main_story_hard_mode_mission_idx,this.getParent().network_write(req)},0,"charge_try_count_confirm"),this.m_message_box2.hide(!1)}.bind(this),this.m_message_box2.addButtonInfo(btnNo),this.m_message_box2.addButtonInfo(btnYes),this.m_message_box2.is_show()&&this.m_message_box2.hide(!1),this.m_message_box2.show()}}},setStoryHardModeMissionChargeResult:function(req){var user_missions=NetService().get_user_main_story_hard_mode_missions().user_missions,found_mission=user_missions.findIndex(function(mi){return mi.main_story_hard_mode_mission_idx==this.m_story_hard_mode_mission.main_story_hard_mode_mission_idx}.bind(this));-1!=found_mission&&(this.m_story_hard_mode_mission.try_count=user_missions[found_mission].daily_try_count,this.m_story_hard_mode_mission.charge_count=user_missions[found_mission].daily_charge_count);var remain_entrance_count=this.m_story_hard_mode_mission.mission.daily_try_max_count-this.m_story_hard_mode_mission.try_count,remain_count=cmString(res_str("story_hard_enter_count"),remain_entrance_count,this.m_story_hard_mode_mission.mission.daily_try_max_count);this.m_story_hard_mode_try_count.setString(remain_count);var remain_charge_count=this.m_story_hard_mode_mission.mission.enter_charge_count-this.m_story_hard_mode_mission.charge_count;remain_charge_count<0&&(remain_charge_count=0);var remain_charge=cmString(res_str("story_hard_remain_enter_charge_count"),remain_charge_count,this.m_story_hard_mode_mission.mission.enter_charge_count);remain_charge=0==this.m_story_hard_mode_mission.mission.enter_charge_group_idx?res_str("story_hard_unable_enter_charge_count"):100==this.m_story_hard_mode_mission.mission.enter_charge_group_idx?res_str("story_hard_nolimit_enter_charge_count"):cmString(res_str("story_hard_remain_enter_charge_count"),remain_charge_count,this.m_story_hard_mode_mission.mission.enter_charge_count),this.m_story_hard_mode_charge_count.setString(remain_charge),this.m_start_btn.setEnabled(!0),this.m_friend_select_scene.setEnableBackBtn(!0)}}),FRIEND_TO_FRIEND=!1,FriendSelectEnum={sort_class:1,sort_lv:2,sort_desc:3,sort_asc:4,sort_special_effect:5,menu_select_join:100,menu_select_release:101,popup_cancel:102,popup_buy_key:103,popup_empty_troops:104,back_scene:105,over_yunhee_bound:106,over_general_material_bound:107,over_all_bound:108,over_equipment_bound:109,invalid_entrance_running_time:110,invalid_entrance_limit_over:111,great_wall_first_partin_battle:112,troops_in_search_troops_general:113,popup_lack_event_point:114,event_raid_battle_start:115,event_raid_select_battle:116,event_raid_skip_battle_start:117},FriendSelectSkipEnum={battle_skip_retry:3e5,battle_skip_confirm:300001,battle_skip_story_map:300002,battle_skip_next_mission:300003,battle_skip_lack_key1:300101,battle_skip_lack_key2:300102,battle_skip_lack_ticket:300103,battle_skip_zero_ticket:300104},FriendSelectScene=GameScene.extend({m_isYunheeOverDisregar:!1,m_autoPlayModalLayer:null,m_FriendSelectLayer_V2:null,m_btn_back:null,m_need_equipment_bound_jade:0,m_deferred:$.Deferred(),m_is_battle_start:!1,m_mission_skip_game_result_modal_layer:null,m_selectBattleModalLayer:null,ctor:function(){this._super(scene_FriendSelectScene)},get_story_deferred:function(){return this.m_deferred},init:function(){this._super(),this.initLayoutProgress2(),this.scheduleOnce(function(dt){this.m_game_type=BattleContext._getInstance().getGameType();var troops_num=this.getCurrentTroopsNum(),generalService=GeneralService.getInstance(),bg=null;if(USE_SP_EVENT_SCALE)if(this.m_game_type==db.BattleGameType.EventRaidDungeon){var nService=NetService();(bg=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/bg_eventvs_sub.jpg",nService.get_Event_Raid_Dungeon_Period_idx()))).setScale(2)}else bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub.png");else if(this.m_game_type==db.BattleGameType.EventRaidDungeon){nService=NetService();bg=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/bg_eventvs_sub.jpg",nService.get_Event_Raid_Dungeon_Period_idx()))}else bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub.png");1==USE_SP_COMMON_SUB_BG_SCALE&&this.m_game_type!=db.BattleGameType.EventRaidDungeon&&bg.setScale(2),bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(this)),this.addChild(bg),this.m_FriendSelectLayer_V2=new FriendSelectLayer_V2,this.addChild(this.m_FriendSelectLayer_V2);var title_img,gw_service=GreatWallService.getInstance(),troops_list=(NetService().Load_User_Troops_General(),[]);if(troops_list=this.m_game_type==db.BattleGameType.GreatWallDungeon?gw_service.getGreatWallTroopsGeneralList(troops_num):generalService.getUserTroopsGeneralList(troops_num),this.m_FriendSelectLayer_V2.setUserGeneralTroopsInfo(troops_list),this.m_FriendSelectLayer_V2.initLayout(this),this.m_game_type==db.BattleGameType.Mussang)var statusLayer=new StatusLayer(INVOKER_TYPE.mussang);else if(this.m_game_type==db.BattleGameType.GreatWallDungeon)statusLayer=new StatusLayer(INVOKER_TYPE.great_wall);else if(this.m_game_type==db.BattleGameType.TowerDungeon)statusLayer=new StatusLayer(INVOKER_TYPE.mussang);else if(this.m_game_type==db.BattleGameType.EventRaidDungeon)statusLayer=new StatusLayer(INVOKER_TYPE.normal);else statusLayer=new StatusLayer(INVOKER_TYPE.normal);statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer),this.m_game_type==db.BattleGameType.WeeklyDungeon?title_img=RES_CDN_DEFULT+"new_img_txt/img_menu_day.png":this.m_game_type==db.BattleGameType.Mussang?title_img=RES_CDN_DEFULT+"new_img_txt/img_menu_road.png":this.m_game_type==db.BattleGameType.Mission?title_img=RES_CDN_DEFULT+"new_img_txt/img_menu_story.png":this.m_game_type==db.BattleGameType.StoryHardMode?title_img=RES_CDN_DEFULT+"new_img_txt/img_menu_story.png":this.m_game_type==db.BattleGameType.EventDungeon||this.m_game_type==db.BattleGameType.OnceADayDungeon?title_img=RES_CDN_DEFULT+"new_img_txt/img_menu_eventvs.png":this.m_game_type==db.BattleGameType.DailyDungeon?title_img=RES_CDN_DEFULT+"new_img_txt/img_menu_daily.png":this.m_game_type==db.BattleGameType.GreatWallDungeon?title_img=RES_CDN_DEFULT+"menu_great_wall/img_great_wall_status_title.png":this.m_game_type==db.BattleGameType.TowerDungeon?title_img=RES_CDN_DEFULT+"new_img_txt/img_menu_tower.png":this.m_game_type==db.BattleGameType.EventRaidDungeon&&(title_img=RES_CDN_DEFULT+"new_img_txt/img_menu_eventvs.png"),this.m_btn_back=new ccui.Button,this.m_btn_back.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png",""),this.m_btn_back.setAnchorPoint(ZERO()),this.m_btn_back.setPosition(0,ccHeight(this)-ccHeight(this.m_btn_back)),this.m_btn_back.addClickEventListener(function(sender){this.initLayoutProgress(),this.back()}.bind(this)),this.addChild(this.m_btn_back);var title=cc.Sprite.create(title_img);title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(cc.p(ccWidth(this.m_btn_back),ccHeight(this)-ccHeight(this.m_btn_back))),this.addChild(title,2);var wSize=ccSize(this);this.m_mission_skip_game_result_modal_layer=new GameModalLayer,this.m_mission_skip_game_result_modal_layer.setContentSize(wSize),this.m_mission_skip_game_result_modal_layer.ignoreAnchorPointForPosition(!1),this.m_mission_skip_game_result_modal_layer.setPosition(ccCenter(wSize)),this.addChild(this.m_mission_skip_game_result_modal_layer,99998),this.m_selectBattleModalLayer=new GameModalLayer,this.m_selectBattleModalLayer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_selectBattleModalLayer.setPosition(ccCenter(wSize).x,ccCenter(wSize).y+13),this.addChild(this.m_selectBattleModalLayer,99e3)},.5,"FriendSelectScene"),this.scheduleOnce(this.removeProgressEnd,1)},removeProgressEnd:function(){this.removeLayerProgress2()},back:function(release,second){null==release&&(release=!0),null==second&&(second=!1),this.scheduleOnce(function(float){var context=BattleContext._getInstance();if(this.m_game_type==db.BattleGameType.EventDungeon){var dungeon=context.getEventDungeonData();context.setEventDungeonPeriodIdX(dungeon.event_dungeon_period.event_dungeon_period_idx)}if(this.m_game_type==db.BattleGameType.EventRaidDungeon)if(context.setGameType(db.BattleGameType.EventDungeon),context.getExitEventRaidDungeonDouble()){SceneManager.getInstance().reservedHistoryClearToScene(scene_EventDungeonEntranceScene);var scene=new EventDungeonRaidEntranceScene;SceneManager.getInstance().replaceScene(scene),scene=null}else this.onKeyBack(!0);else this.m_game_type==db.BattleGameType.Mission||this.m_game_type==db.BattleGameType.StoryHardMode?(cc.director.isPaused()&&cc.director.resume(),this.onKeyBack(release,second)):(this.onKeyBack(!0),this.removeLayerProgress3())}.bind(this),0,"back_scene")},setEnableBackBtn:function(isEnable){this.m_btn_back.setEnabled(isEnable),this.m_is_battle_start=!isEnable},onTutorialEnter:function(step){this.setTutorialStep(step),step.tutorial_page,TUTORIAL_PAGE_1_STORY},onEnter:function(){this._super();var audio=AudioEngine.getInstance(),master=(BattleContext._getInstance(),MasterTable.getInstance());if(this.m_is_battle_start=!1,MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_FriendSelectScene]),this.m_game_type=BattleContext._getInstance().getGameType(),this.m_game_type==db.BattleGameType.Mission){var bgm_list=[],bgm_ref_idx=BattleContext._getInstance().getMissionStage();bgm_list=master.get_Bgm(BGM_TYPE_CHANGE_STORY_STAGE_BGM,bgm_list,bgm_ref_idx);audio=AudioEngine.getInstance();var path=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm_list[0].sound_file_name;audio.m_bgmPath!=path&&(audio.stopBackgroundMusic(),audio.playBackgroundMusic(path,!0)),this.hideBattleMissionSkipResultModalLayer()}else if(this.m_game_type==db.BattleGameType.StoryHardMode){bgm_list=[];bgm_list=master.get_Bgm(BGM_TYPE_STORY_HARD_MODE_STAGE_BGM,bgm_list);audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm_list[0].sound_file_name;audio.m_bgmPath!=path&&(audio.stopBackgroundMusic(),audio.playBackgroundMusic(path,!0))}else this.m_game_type==db.BattleGameType.EventDungeon?(this.getEventSound(),this.hideBattleMissionSkipResultModalLayer()):this.m_game_type==db.BattleGameType.DailyDungeon?this.playMainBGM():this.m_game_type==db.BattleGameType.EventRaidDungeon?this.getEventSound():(this.m_game_type==db.BattleGameType.WeeklyDungeon&&this.hideBattleMissionSkipResultModalLayer(),this.playMainBGM())},getEventSound:function(){var audio=AudioEngine.getInstance();if(USE_EVENT_BGM){var m=MasterTable.getInstance();if(BattleContext._getInstance().getIsPrvEventDungeon())var bgm=m.get_Bgm_v2(BGM_TYPE_PRV_EVENT_MAIN_BGM);else{var period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();bgm=m.get_EventDungeonFromEventDungeonPeriodIdx(period_idx).event_dungeon_type==EVENT_DUNGEON_TYPE_LINLIN?m.get_Bgm_v2(BGM_TYPE_CRAFT_EVENT_MAIN_BGM):m.get_Bgm_v2(BGM_TYPE_EVENT_MAIN_BGM)}var main_bgm=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm.sound_file_name;audio.m_bgmPath!=main_bgm&&(audio.stopBackgroundMusic(),audio.m_bgmPath="",audio.playBackgroundMusic(main_bgm,!0))}else{var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx),b_path=RES_CDN_SOUND+SND_TYPE+"sound/"+cmString("BGM_marathon_loop_%d.mp3",period.event_dungeon_point_period_idx);audio.m_bgmPath!=b_path&&(audio.stopBackgroundMusic(),audio.m_bgmPath="",audio.playBackgroundMusic(b_path,!0))}},onExit:function(){(this._super(),BATTLE_TO_SHOP)?BATTLE_TO_SHOP=!1:(cc.log("=== FriendSelectTest ===="),BATTLE_TO_MISSION?BATTLE_TO_MISSION=!1:(cc.log("=== FriendSelectTest OK  ===="),1!=this.m_isPopupShow?FRIEND_TO_FRIEND?FRIEND_TO_FRIEND=!1:(MainObserver.getInstance().removeObserver(sceneStr[scene_FriendSelectScene]),this.removeAllChildrenWithCleanup(!0)):this.m_isPopupShow=!1))},onNotification:function(msg){if(this._super(msg),this.m_is_battle_start)return!1;BattleContext._getInstance();var generalService=GeneralService.getInstance(),gw_service=GreatWallService.getInstance(),troops_list=[];switch(this.removeLayerProgress(),this.m_FriendSelectLayer_V2.initStartBtn(),msg){case FriendSelectEnum.popup_empty_troops:this.showNoGeneralInTroops();break;case FriendSelectEnum.back_scene:this.back();break;case FriendSelectEnum.over_yunhee_bound:this.showYunheeOverBound(GENERAL_TYPE_YUNHEE);break;case FriendSelectEnum.over_all_bound:this.showYunheeOverBound(0);break;case FriendSelectEnum.over_general_material_bound:this.showYunheeOverBound(GENERAL_TYPE_MATERIAL);break;case FriendSelectEnum.over_equipment_bound:this.showEquipmentOverBound();break;case FriendSelectEnum.invalid_entrance_running_time:USE_POPUP_INTERGRATION?this.showFriendSelectPopup(res_str("label_weekly_invalid_entrance"),res_str("label_weekly_invalid_entrance_time")):this.showInvalidEntranceTime();break;case FriendSelectEnum.invalid_entrance_limit_over:USE_POPUP_INTERGRATION?this.showFriendSelectPopup(res_str("label_weekly_invalid_entrance"),res_str("label_daily_dungeon_entrance_limit_over")):this.showEntranceLimitOver();break;case FriendSelectEnum.menu_select_join:case FriendSelectEnum.menu_select_release:break;case FriendSelectEnum.great_wall_first_partin_battle:this.showGreatWallFirstPartinGnrl();break;case FriendSelectEnum.troops_in_search_troops_general:USE_POPUP_INTERGRATION?this.showFriendSelectPopup(res_str("label_shop_buy_jade_omission_title"),res_str("label_event_dungeon_troops_in_search_troops_general_text_1"),res_str("label_event_dungeon_troops_in_search_troops_general_text_2"),res_str("label_event_dungeon_troops_in_search_troops_general_text_3")):this.showTroopsInSearchTroopsGeneral();break;case FriendSelectEnum.popup_cancel:this.m_box.is_show()&&this.m_box.hide(!1);break;case FriendSelectEnum.popup_buy_key:MainObserver.getInstance().postNotification(NOTIFY_MENU_SHOP_JADE,1),this.m_box.is_show()&&this.m_box.hide(!1);break;case FriendSelectEnum.popup_lack_event_point:this.showLackEventDungeonPoint();break;case FriendSelectEnum.event_raid_battle_start:BattleContext._getInstance().setEventRaidDungeonBattleSkip(!1),this.m_FriendSelectLayer_V2.reqEventDungeonRaidBegin();break;case FriendSelectEnum.event_raid_select_battle:this.showEventRaidDungeonBattleSelect();break;case FriendSelectEnum.event_raid_skip_battle_start:BattleContext._getInstance().setEventRaidDungeonBattleSkip(!0),this.m_FriendSelectLayer_V2.reqEventDungeonRaidBegin();break;case NOTIFY_MENU_PARTY_1:troops_list=this.m_game_type!=db.BattleGameType.GreatWallDungeon?generalService.getUserTroopsGeneralList(TROOPS_ENUM.troops_num_1):gw_service.getGreatWallTroopsGeneralList(TROOPS_ENUM.troops_num_1),this.m_FriendSelectLayer_V2.setUserGeneralTroopsInfo(troops_list),this.m_FriendSelectLayer_V2.changeYhTeam(TROOPS_ENUM.troops_num_1);break;case NOTIFY_MENU_PARTY_2:troops_list=this.m_game_type!=db.BattleGameType.GreatWallDungeon?generalService.getUserTroopsGeneralList(TROOPS_ENUM.troops_num_2):gw_service.getGreatWallTroopsGeneralList(TROOPS_ENUM.troops_num_2),this.m_FriendSelectLayer_V2.setUserGeneralTroopsInfo(troops_list),this.m_FriendSelectLayer_V2.changeYhTeam(TROOPS_ENUM.troops_num_2);break;case NOTIFY_MENU_PARTY_3:troops_list=this.m_game_type!=db.BattleGameType.GreatWallDungeon?generalService.getUserTroopsGeneralList(TROOPS_ENUM.troops_num_3):gw_service.getGreatWallTroopsGeneralList(TROOPS_ENUM.troops_num_3),this.m_FriendSelectLayer_V2.setUserGeneralTroopsInfo(troops_list),this.m_FriendSelectLayer_V2.changeYhTeam(TROOPS_ENUM.troops_num_3);break;case NOTIFY_MENU_PARTY_4:troops_list=this.m_game_type!=db.BattleGameType.GreatWallDungeon?generalService.getUserTroopsGeneralList(TROOPS_ENUM.troops_num_4):gw_service.getGreatWallTroopsGeneralList(TROOPS_ENUM.troops_num_4),this.m_FriendSelectLayer_V2.setUserGeneralTroopsInfo(troops_list),this.m_FriendSelectLayer_V2.changeYhTeam(TROOPS_ENUM.troops_num_4);break;case NOTIFY_MENU_PARTY_5:troops_list=this.m_game_type!=db.BattleGameType.GreatWallDungeon?generalService.getUserTroopsGeneralList(TROOPS_ENUM.troops_num_5):gw_service.getGreatWallTroopsGeneralList(TROOPS_ENUM.troops_num_5),this.m_FriendSelectLayer_V2.setUserGeneralTroopsInfo(troops_list),this.m_FriendSelectLayer_V2.changeYhTeam(TROOPS_ENUM.troops_num_5);break;case NOTIFY_MENU_PARTY_6:troops_list=this.m_game_type!=db.BattleGameType.GreatWallDungeon?generalService.getUserTroopsGeneralList(TROOPS_ENUM.troops_num_6):gw_service.getGreatWallTroopsGeneralList(TROOPS_ENUM.troops_num_6),this.m_FriendSelectLayer_V2.setUserGeneralTroopsInfo(troops_list),this.m_FriendSelectLayer_V2.changeYhTeam(TROOPS_ENUM.troops_num_6);break;case NOTIFY_MENU_PARTY_7:troops_list=this.m_game_type!=db.BattleGameType.GreatWallDungeon?generalService.getUserTroopsGeneralList(TROOPS_ENUM.troops_num_7):gw_service.getGreatWallTroopsGeneralList(TROOPS_ENUM.troops_num_7),this.m_FriendSelectLayer_V2.setUserGeneralTroopsInfo(troops_list),this.m_FriendSelectLayer_V2.changeYhTeam(TROOPS_ENUM.troops_num_7);break;case btn_left_arrow:var currTroops=this.getCurrentTroopsNum(),max_troops_num=MAX_TROOPS_NUM;this.m_game_type!=db.BattleGameType.GreatWallDungeon&&(max_troops_num=MAX_TROOPS_NUM-1),1==currTroops?currTroops=max_troops_num:currTroops--,troops_list=this.m_game_type==db.BattleGameType.GreatWallDungeon?gw_service.getGreatWallTroopsGeneralList(currTroops):GeneralService.getInstance().getUserTroopsGeneralList(currTroops),this.m_FriendSelectLayer_V2.setUserGeneralTroopsInfo(troops_list),this.m_FriendSelectLayer_V2.changeYhTeam(TROOPS_ENUM.troops_num_1+currTroops-1);break;case btn_right_arrow:currTroops=this.getCurrentTroopsNum(),max_troops_num=MAX_TROOPS_NUM;this.m_game_type!=db.BattleGameType.GreatWallDungeon&&(max_troops_num=MAX_TROOPS_NUM-1),currTroops==max_troops_num?currTroops=1:currTroops++,troops_list=this.m_game_type==db.BattleGameType.GreatWallDungeon?gw_service.getGreatWallTroopsGeneralList(currTroops):GeneralService.getInstance().getUserTroopsGeneralList(currTroops),this.m_FriendSelectLayer_V2.setUserGeneralTroopsInfo(troops_list),this.m_FriendSelectLayer_V2.changeYhTeam(TROOPS_ENUM.troops_num_1+currTroops-1);break;case NOTIFY_MENU_BATTLE_FORM:this.removeLayerProgress(),BattleContext._getInstance().setGameType(this.m_game_type);var scene=new BattleFormationScene;SceneManager.getInstance().replaceScene(scene),scene=null;break;case NOTIFY_MENU_YUNHEE_SET:this.initLayoutProgress(),GameContext.getInstance().setYunheePrevSceneId(scene_FriendSelectScene);var req={};req.opcode=net.OP.op_get_user_general,this.network_write(req);break;case NOTIFY_BTN_COMBO:break;case BattleSceneFlag.weekly_result_ok:case BattleSceneFlag.menu_result_weekly_retry:case FriendSelectSkipEnum.battle_skip_retry:this.hideBattleMissionSkipResultModalLayer();break;case FriendSelectSkipEnum.battle_skip_confirm:case FriendSelectSkipEnum.battle_skip_story_map:case FriendSelectSkipEnum.battle_skip_next_mission:this.initLayoutProgress3(),this.hideBattleMissionSkipResultModalLayer(),this.back();break;case FriendSelectSkipEnum.battle_skip_lack_key1:this.showToastBox("",res_str("label_task_skip_use_lack_key_message_1"),2,ToastEnum.CENTER);break;case FriendSelectSkipEnum.battle_skip_lack_key2:this.showToastBox("",res_str("label_task_skip_use_lack_key_message_2"),2,ToastEnum.CENTER);break;case FriendSelectSkipEnum.battle_skip_lack_ticket:this.showToastBox("",res_str("label_task_skip_use_lack_ticket_message"),2,ToastEnum.CENTER);break;case FriendSelectSkipEnum.battle_skip_zero_ticket:this.showToastBox("",res_str("label_task_skip_use_cannot_zero_message"),2,ToastEnum.CENTER)}return!0},onNetworkEvent:function(opcode,state,body){if(this._super(opcode,state,body),body.error==net.ERROR.NET_E_INVALID_ENTRANCE_TIME)return this.m_game_type==db.BattleGameType.DailyDungeon?USE_POPUP_INTERGRATION?this.showFriendSelectPopup(res_str("label_weekly_invalid_entrance"),res_str("label_daily_dungeon_invalid_entrance_time_1"),res_str("label_daily_dungeon_invalid_entrance_time_2")):this.showDailyDungeonInvalidEntranceTime():USE_POPUP_INTERGRATION?this.showFriendSelectPopup(res_str("label_weekly_invalid_entrance"),res_str("label_weekly_invalid_entrance_time")):this.showInvalidEntranceTime(),void this.m_btn_back.setEnabled(!0);if(body.error!=net.ERROR.NET_E_LACK_EVENT_DUNGEON_POINT)if(body.error!=net.ERROR.NET_E_ALREADY_RETREAT){if(body.error==net.ERROR.NET_E_ENTRANCE_LIMIT_OVER)return USE_POPUP_INTERGRATION?this.showFriendSelectPopup(res_str("label_weekly_invalid_entrance"),res_str("label_daily_dungeon_entrance_limit_over")):this.showEntranceLimitOver(),void this.m_btn_back.setEnabled(!0);if(null!=this.m_btn_back&&this.m_btn_back.setEnabled(!0),opcode==net.OP.op_main_mission_battle_begin_v2){var context=BattleContext._getInstance();if(0<body.frnd_gnrl.gnrl_id){var friend_general=$.extend({},database.BattleGeneral);(service=BattleService.getInstance()).getFriendGeneral(body.frnd_gnrl,friend_general),context.setFriendPartnerGeneral(friend_general)}else context.clearFriendInfo();context.setBeforeBattleUserInfo(),cc.log("body.drop_items[0]",body.drop_items[0]),cc.log("body.drop_items[1]",body.drop_items[1]),cc.log("body.drop_items[2]",body.drop_items[2]),context.setDungeonDropItemCount(body.drop_items);var scene=new BattleSceneLayer;SceneManager.getInstance().replaceScene(scene),scene=null}else if(opcode==net.OP.op_daily_dungeon_battle_begin){(context=BattleContext._getInstance()).setGameType(this.m_game_type),GameDefault.getInstance().getUserDailyDungeonTroopsNum().done(function(rVal){var troops_num=rVal;context.setBeforeBattleUserInfoByTroops(troops_num);var scene=new BattleSceneLayer;SceneManager.getInstance().replaceScene(scene),scene=null})}else if(opcode==net.OP.op_great_wall_dungeon_battle_begin){if(body.error==net.ERROR.NET_E_SUCCESS){for(var dungeon=(context=BattleContext._getInstance()).getGreatWallDungeonData(),npc_list=dungeon.stage_npc.at(1),idx=0;idx<npc_list.length;idx++){var npc=npc_list[idx],found=body.npc_list.findIndex(function(n){return npc.position==n.position});-1!=found&&(npc.remain_hp_rate=body.npc_list[found].remain_hp_rate,npc.is_dead="y"==body.npc_list[found].dead_yn)}dungeon.stage_npc.insert(1,npc_list),context.setGreatWallDungeonData(dungeon),context.setBeforeGreatWallDungeonUserInfoByTroops(GameDefault.getInstance().getUserGreatWallTroopsNum());scene=new BattleSceneLayer;SceneManager.getInstance().replaceScene(scene),scene=null}}else if(opcode==net.OP.op_get_user_general){this.m_game_type!=db.BattleGameType.None&&(GameContext.getInstance().setYunheeArrangeMode(!0),GameContext.getInstance().setYunheeTabType(YunheeLevelUpTapTypeEnum.tab_type_yunhee)),GameContext.getInstance().setOffsetVerticalPercent(null),BattleContext._getInstance().setGameType(this.m_game_type),(scene=new YunheeScene).get_story_deferred().done(function(){this.scheduleOnce(function(dt){SceneManager.getInstance().replaceScene(scene,!0),scene=null},YUNHEE_DELAY_TIME,"main_layer_ready")}.bind(this))}else if(opcode==net.OP.op_weekly_dungeon_battle_begin){(context=BattleContext._getInstance()).setGameType(this.m_game_type),GameDefault.getInstance().getUserWeeklyTroopsNum().done(function(rVal){var troops_num=rVal;context.setBeforeBattleUserInfoByTroops(troops_num),context.setDungeonDropItemCount(body.drop_items);var scene=new BattleSceneLayer;SceneManager.getInstance().replaceScene(scene),scene=null})}else if(opcode==net.OP.op_mussang_step_battle_begin){(context=BattleContext._getInstance()).setGameType(this.m_game_type),context.setMussangId(body.mussang_id),GameDefault.getInstance().getUserMussangTroopsNum().done(function(rVal){var troops_num=rVal;context.setBeforeBattleUserInfoByTroops(troops_num);var scene=new BattleSceneLayer;SceneManager.getInstance().replaceScene(scene),scene=null})}else if(opcode==net.OP.op_event_once_a_day_dungeon_battle_begin){if(body.error==net.ERROR.NET_E_SUCCESS){context=BattleContext._getInstance();GameDefault.getInstance().getUserOnceADayDungeonTroopsNum().done(function(rVal){var troops_num=rVal;context.setBeforeBattleUserInfoByTroops(troops_num);var scene=new BattleSceneLayer;SceneManager.getInstance().replaceScene(scene),scene=null})}}else if(opcode==net.OP.op_story_dungeon_battle_skip){if(body.error==net.ERROR.NET_E_SUCCESS)(req={}).opcode=net.OP.op_get_user_item,this.network_write(req),(context=BattleContext._getInstance()).clearFriendInfo(),context.setBeforeBattleUserInfo_V2().done(function(info){1==info&&this.showBattleMissionSkipResultModalLayer(body,opcode)}.bind(this)),this.setEnableBackBtn(!0),this.m_is_battle_start=!1,this.m_FriendSelectLayer_V2.refrashSkipBtn(body.user_skip_ticket);else if(body.error==net.ERROR.NET_E_NOT_COMPLETE_TASKS){(msg={}).push_back(res_str("label_task_skip_error_task_popup_text")),this.showMsgBox(msg),msg=null,this.setEnableBackBtn(!0),this.m_is_battle_start=!1}else if(body.error==net.ERROR.NET_E_LACK_SKIP_TICKET){(msg={}).push_back(res_str("label_task_skip_error_ticket_popup_title")),this.showMsgBox(msg),msg=null,this.setEnableBackBtn(!0),this.m_is_battle_start=!1}}else if(opcode==net.OP.op_weekly_dungeon_battle_skip){if(body.error==net.ERROR.NET_E_SUCCESS)(req={}).opcode=net.OP.op_get_user_item,this.network_write(req),(context=BattleContext._getInstance()).setGameType(this.m_game_type),context.setBeforeBattleUserInfoByTroops_V2(body.troops_num).done(function(info){1==info&&this.showBattleMissionSkipResultModalLayer(body,opcode)}.bind(this)),this.setEnableBackBtn(!0),this.m_is_battle_start=!1,this.m_FriendSelectLayer_V2.refrashSkipBtn(body.user_skip_ticket);else if(body.error==net.ERROR.NET_E_NOT_COMPLETE_TASKS){(msg={}).push_back(res_str("label_task_skip_error_task_popup_text")),this.showMsgBox(msg),msg=null,this.setEnableBackBtn(!0),this.m_is_battle_start=!1}else if(body.error==net.ERROR.NET_E_LACK_SKIP_TICKET){(msg={}).push_back(res_str("label_task_skip_error_ticket_popup_title")),this.showMsgBox(msg),msg=null,this.setEnableBackBtn(!0),this.m_is_battle_start=!1}}else if(opcode==net.OP.op_event_dungeon_battle_skip){if(body.error==net.ERROR.NET_E_SUCCESS)(req={}).opcode=net.OP.op_get_user_item,this.network_write(req),(context=BattleContext._getInstance()).setGameType(this.m_game_type),context.setBeforeBattleUserInfoByTroops_V2(body.troops_num).done(function(info){1==info&&this.showBattleMissionSkipResultModalLayer(body,opcode)}.bind(this)),this.setEnableBackBtn(!0),this.m_is_battle_start=!1,this.m_FriendSelectLayer_V2.refrashSkipBtn(body.user_skip_ticket);else if(body.error==net.ERROR.NET_E_NOT_COMPLETE_TASKS){(msg={}).push_back(res_str("label_task_skip_error_task_popup_text")),this.showMsgBox(msg),msg=null,this.setEnableBackBtn(!0),this.m_is_battle_start=!1}else if(body.error==net.ERROR.NET_E_LACK_SKIP_TICKET){(msg={}).push_back(res_str("label_task_skip_error_ticket_popup_title")),this.showMsgBox(msg),msg=null,this.setEnableBackBtn(!0),this.m_is_battle_start=!1}}else if(opcode==net.OP.op_event_dungeon_battle_begin){context=BattleContext._getInstance();var service=BattleService.getInstance();if(context.setGameType(this.m_game_type),0<body.frnd_gnrl.gnrl_id){friend_general=$.extend({},database.BattleGeneral);service.getFriendGeneral(body.frnd_gnrl,friend_general),context.setFriendPartnerGeneral(friend_general)}else context.clearFriendInfo();GameDefault.getInstance().getUserEventDungeonTroopsNum().done(function(rVal){var troops_num=rVal;if(context.setBeforeBattleUserInfoByTroops(troops_num),context.setEventDungeonCutinStage(body.cutin_stage),0!=body.cutin_stage){var dungeon=context.getEventDungeonData();BattleService.getInstance().getMasterEventDungeonNpcInfo(dungeon),dungeon.cutin_stage=body.cutin_stage,dungeon.event_dungeon_cutin_info_idx=body.event_dungeon_cutin_info_idx;var cutin_info=MasterTable.getInstance().getMasterTable().get_EventDungeonCutinInfo(dungeon.event_dungeon_cutin_info_idx);dungeon.cutin_info=cutin_info,service.changeEventDungeonCutinStage(body.cutin_stage,body.event_dungeon_cutin_info_idx,dungeon.stage_npc),context.setEventDungeonData(dungeon),context.setEventDungeonCutinComplete(!1);var drop_items=[];drop_items.push(1),drop_items.push(0),drop_items.push(0),context.setDungeonDropItemCount(drop_items)}else{(dungeon=context.getEventDungeonData()).cutin_stage=body.cutin_stage,dungeon.event_dungeon_cutin_info_idx=0,dungeon.cutin_info={},dungeon.cutin_info.event_dungeon_cutin_info_idx=0,service.getMasterEventDungeonStageNpc(dungeon.event_dungeon.event_dungeon_idx,dungeon),service.getMasterEventDungeonNpcInfo(dungeon),context.setEventDungeonData(dungeon),context.setEventDungeonCutinComplete(!1)}var scene=new BattleSceneLayer;SceneManager.getInstance().replaceScene(scene),scene=null})}else if(opcode==net.OP.op_yunhee_inventory_increase)this.showInventoryIncreaseConfirm(body.user_yunhee_bound);else if(opcode==net.OP.op_equipment_inventory_increase)this.showEquipmentInventoryIncreaseConfirm(body.user_equip_bound);else if(opcode==net.OP.op_event_raid_dungeon_battle_begin){context=BattleContext._getInstance(),scene=new BattleSceneLayer;SceneManager.getInstance().replaceScene(scene),scene=null}else if(opcode==net.OP.op_weekly_dungeon_battle_skip||res.opcode==net.OP.op_event_dungeon_battle_skip||res.opcode==net.OP.op_story_dungeon_battle_skip)if(body.error==net.ERROR.NET_E_SUCCESS)this.setEnableBackBtn(!0),this.m_is_battle_start=!1;else if(body.error==net.ERROR.NET_E_NOT_COMPLETE_TASKS){(msg={}).push_back(res_str("label_task_skip_error_task_popup_text")),this.showMsgBox(msg),msg=null,this.setEnableBackBtn(!0),this.m_is_battle_start=!1}else if(body.error==net.ERROR.NET_E_LACK_SKIP_TICKET){(msg={}).push_back(res_str("label_task_skip_error_ticket_popup_title")),this.showMsgBox(msg),msg=null,this.setEnableBackBtn(!0),this.m_is_battle_start=!1}else body.error==net.ERROR.NET_E_LACK_KEY&&(this.showNotEnoughKey(!0),this.setEnableBackBtn(!0),this.m_is_battle_start=!1);else if(opcode==net.OP.op_event_raid_dungeon_boss_info){(context=BattleContext._getInstance()).setExitEventRaidDungeonDouble(!0),SceneManager.getInstance().reservedHistoryClearToScene(scene_EventDungeonRaidEntranceScene),SceneManager.getInstance().getRunningScene().m_sceneId==scene_FriendSelectScene&&(FRIEND_TO_FRIEND=!0);scene=new FriendSelectScene;SceneManager.getInstance().replaceScene(scene),scene=null}else if(opcode==net.OP.op_main_story_hard_mode_mission_charge)if(body.error!=net.ERROR.NET_E_SUCCESS){if(body.error==net.ERROR.NET_E_DAILY_TRY_COUNT_REMAIN){var title=res_str("label_information_title");(msg=[]).push(res_str("story_hard_enter_charge_cannot_popup_text")),msg.push(res_str("story_hard_enter_deny_popup_text_3")),this.showMsgBox(title,msg),(req={}).opcode=net.OP.op_get_user_main_story_hard_mode_mission,this.network_write(req)}else if(body.error==net.ERROR.NET_E_CAN_NOT_CHARGE){title=res_str("story_hard_enter_deny_popup_title");(msg=[]).push(res_str("story_hard_enter_deny_popup_text_1")),msg.push(res_str("story_hard_enter_deny_popup_text_3")),this.showMsgBox(title,msg)}else if(body.error==net.ERROR.NET_E_DAILY_CHARGE_COUNT_OVER){title=res_str("story_hard_enter_deny_popup_title");(msg=[]).push(res_str("story_hard_enter_deny_popup_text_1")),msg.push(res_str("story_hard_enter_deny_popup_text_2")),msg.push(res_str("story_hard_enter_deny_popup_text_3")),this.showMsgBox(title,msg)}}else{null!=this.m_FriendSelectLayer_V2&&this.m_FriendSelectLayer_V2.setStoryHardModeMissionChargeResult();var msg;title=res_str("story_hard_enter_charge_complete_popup_title");(msg=[]).push(res_str("story_hard_enter_charge_complete_popup_text")),this.showMsgBox(title,msg)}else if(opcode==net.OP.op_get_user_main_story_hard_mode_mission)null!=this.m_FriendSelectLayer_V2&&this.m_FriendSelectLayer_V2.setStoryHardModeMissionChargeResult();else if(opcode==net.OP.op_main_story_hard_mode_mission_battle_begin)if(body.error==net.ERROR.NET_E_PREV_MISSION_NOT_COMPLETE);else if(body.error==net.ERROR.NET_E_PREV_DIFFICULT_MISSION_NOT_COMPLETE);else if(body.error==net.ERROR.NET_E_DAILY_TRY_COUNT_OVER);else{var req;(req={}).opcode=net.OP.op_get_user_main_story_hard_mode_mission,this.network_write(req);context=BattleContext._getInstance();if(0<body.frnd_gnrl.gnrl_id){friend_general=$.extend({},database.BattleGeneral);(service=BattleService.getInstance()).getFriendGeneral(body.frnd_gnrl,friend_general),context.setFriendPartnerGeneral(friend_general)}else context.clearFriendInfo();context.setBeforeBattleUserInfo(),context.setDungeonDropItemCount(body.drop_items);scene=new BattleSceneLayer;SceneManager.getInstance().replaceScene(scene),scene=null}}else opcode==net.OP.op_event_raid_dungeon_battle_begin&&this.showEventRaidDungeonClear();else opcode==net.OP.op_event_raid_dungeon_battle_begin&&((msg=[]).push_back(""),this.showMsgBox(msg),msg=null)},showEquipmentOverBound:function(){var count_function=MasterManager.getInstance().get_CountFunction(COUNT_FUNCTION_EQUIPMENT_SLOT_BOUND);this.m_ctbox.setTitle("");var obj={need_jade:0,bonus_type_name:""},equip_service=EquipmentService.getInstance();if(equip_service.getEquipmentInventoryInfo(obj),this.m_need_equipment_bound_jade=obj.need_jade,equip_service.getUserEquipmentBound()>=count_function.value)this.m_ctbox.setText("",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.addButtonInfo(new MessageButtonInfo("",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_ctbox.hide()}.bind(this)));else{count_function=MasterManager.getInstance().get_CountFunction(COUNT_FUNCTION_EQUIPMENT_INVENTORY_INCREASE_SIZE);var is_over_equip_nomal=equip_service.isOverUserEquipmentBound(EQUIP_BOUND_CHECK_NORMAL),is_over_equip_exp=equip_service.isOverUserEquipmentBound(EQUIP_BOUND_CHECK_EXP);1==is_over_equip_nomal&&1==is_over_equip_exp?this.m_ctbox.setText(res_str("label_equipment_bound_over_all_text_1"),LABEL_FONT_INDEX.FONT_261):1==is_over_equip_nomal?this.m_ctbox.setText(res_str("label_equipment_bound_over_normal_text_1"),LABEL_FONT_INDEX.FONT_261):this.m_ctbox.setText(res_str("label_equipment_bound_over_exp_text_1"),LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(res_str("label_raid_gacha_inventory_over_text_8"),LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(res_str("label_raid_gacha_inventory_over_text_12"),LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(obj.bonus_type_name+this.m_need_equipment_bound_jade,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("("+count_function.value+")",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.addButtonInfo(new MessageButtonInfo("",MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_ctbox.hide()}.bind(this))),this.m_ctbox.addButtonInfo(new MessageButtonInfo("",MessageBoxButtonType.ButtonTypeNormal,0,function(){NetService().get_UserItemInfo_V2().jade_cnt<this.m_need_equipment_bound_jade?this.scheduleOnce(function(float){this.showNotEnoughJade()},0,"showNotEnoughJade"):(this.scheduleOnce(function(float){var req={};req.opcode=net.OP.op_equipment_inventory_increase,this.network_write(req)},0,"Req_Equipment_Inventory_Increase"),this.m_ctbox.hide(!1))}.bind(this)))}this.m_ctbox.show()},getCurrentTroopsNum:function(){var gd=GameDefault.getInstance(),context=BattleContext._getInstance();this.m_game_type=context.getGameType();var troops_num=1;if(this.m_game_type==db.BattleGameType.WeeklyDungeon)this.m_weekly_difficulty=context.getWeeklyDungeonDifficulty(),gd.getUserWeeklyTroopsNum().done(function(rVal){troops_num=rVal});else if(this.m_game_type==db.BattleGameType.Mussang){context.getMussangId();gd.getUserMussangTroopsNum().done(function(rVal){troops_num=rVal})}else if(this.m_game_type==db.BattleGameType.Mission){if(1==USE_LOCAL_STORAGE_TROOPS_OFF)troops_num=gd.getUserTroopsNum();else gd.getUserTroopsNum().done(function(data){troops_num=data})}else if(this.m_game_type==db.BattleGameType.EventDungeon){context.getEventDungeonId();this.m_event_dungeon=context.getEventDungeonData(),gd.getUserEventDungeonTroopsNum().done(function(data){troops_num=data})}else if(this.m_game_type==db.BattleGameType.DailyDungeon)this.m_daily_dungeon=context.getDailyDungeonData(),gd.getUserDailyDungeonTroopsNum().done(function(data){troops_num=data});else if(this.m_game_type==db.BattleGameType.RaidDungeon){gd.getUserRaidBossTroopsNum().done(function(data){troops_num=data})}else if(this.m_game_type==db.BattleGameType.GreatWallDungeon){gd.getUserGreatWallTroopsNum().done(function(data){troops_num=data})}else if(this.m_game_type==db.BattleGameType.TowerDungeon){gd.getUserTowerDungeonTroopsNum().done(function(data){troops_num=data})}else if(this.m_game_type==db.BattleGameType.OnceADayDungeon){gd.getUserOnceADayDungeonTroopsNum().done(function(data){troops_num=data})}else if(this.m_game_type==db.BattleGameType.EventRaidDungeon){gd.getUserEventRaidDungeonTroopsNum().done(function(data){troops_num=data})}else if(this.m_game_type==db.BattleGameType.StoryHardMode){gd.getUserTroopsNum().done(function(data){troops_num=data})}return troops_num},showGreatWallFirstPartinGnrl:function(){this.m_box.setTitle(res_str("label_information_title")),this.m_box.setText(res_str("label_great_wall_first_partin_msg_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_great_wall_first_partin_msg_2")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_great_wall_first_partin_msg_3")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_great_wall_first_partin_msg_4")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_cancel"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(){this.m_FriendSelectLayer_V2.reqGreatWallDungeonBegin()},0,"reqGreatWallDungeonBegin"),this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showEventRaidDungeonClear:function(){this.m_box.setTitle(res_str("label_common_information")),this.m_box.setText(res_str("event_raid_start_error_1")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide();var req={};req.opcode=net.OP.op_event_raid_dungeon_boss_info,req.event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),this.network_write(req)}.bind(this))),this.m_box.show()},showBattleMissionSkipResultModalLayer:function(res,opcode){this.m_mission_skip_game_result_modal_layer._contentNode=function(contentSize,m){var result_layer=new BattleMissionResultLayer_V2;return result_layer.ignoreAnchorPointForPosition(!1),result_layer.setAnchorPoint(ANCHOR_MIDDLE()),result_layer.setGameScene(this),result_layer.setPosition(ccCenter(this)),opcode==net.OP.op_weekly_dungeon_battle_skip?result_layer.resultDataWeekly_Dungeon_Battle_Skip(res):opcode==net.OP.op_event_dungeon_battle_skip?result_layer.resultDataEvent_Dungeon_Battle_Skip(res):opcode==net.OP.op_story_dungeon_battle_skip&&result_layer.resultDataStory_Dungeon_Battle_Skip(res),result_layer}.bind(this),this.m_mission_skip_game_result_modal_layer.show()},hideBattleMissionSkipResultModalLayer:function(){null!=this.m_FriendSelectLayer_V2&&(this.m_FriendSelectLayer_V2.updateSkipTicketCount(),this.refreshBgmSound(),this.skipAfterRefreshDeckInfo(),this.m_mission_skip_game_result_modal_layer.is_show()&&this.m_mission_skip_game_result_modal_layer.hide())},refreshBgmSound:function(){var audio=AudioEngine.getInstance(),master=MasterTable.getInstance();if(this.m_game_type==db.BattleGameType.Mission){var bgm_list=[],bgm_ref_idx=BattleContext._getInstance().getMissionStage();bgm_list=master.get_Bgm(BGM_TYPE_CHANGE_STORY_STAGE_BGM,bgm_list,bgm_ref_idx);var b_path=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm_list[0].sound_file_name;audio.m_bgmPath!=b_path&&(audio.stopBackgroundMusic(),audio.playBackgroundMusic(b_path,!0))}else if(this.m_game_type==db.BattleGameType.StoryHardMode){bgm_list=[],bgm_ref_idx=BattleContext._getInstance().getMissionStage();bgm_list=master.get_Bgm(BGM_TYPE_CHANGE_STORY_STAGE_BGM,bgm_list,bgm_ref_idx);b_path=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm_list[0].sound_file_name;audio.m_bgmPath!=b_path&&(audio.stopBackgroundMusic(),audio.playBackgroundMusic(b_path,!0))}else if(this.m_game_type==db.BattleGameType.EventDungeon)if(USE_EVENT_BGM){var m=MasterTable.getInstance();if(BattleContext._getInstance().getIsPrvEventDungeon())var bgm=m.get_Bgm_v2(BGM_TYPE_PRV_EVENT_MAIN_BGM);else{var period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx();bgm=m.get_EventDungeonFromEventDungeonPeriodIdx(period_idx).event_dungeon_type==EVENT_DUNGEON_TYPE_LINLIN?m.get_Bgm_v2(BGM_TYPE_CRAFT_EVENT_MAIN_BGM):m.get_Bgm_v2(BGM_TYPE_EVENT_MAIN_BGM)}var main_bgm=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm.sound_file_name;audio.m_bgmPath!=main_bgm&&(audio.stopBackgroundMusic(),audio.playBackgroundMusic(main_bgm,!0))}else{var event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),period=MasterManager.getInstance().get_EventDungeonPeriod(event_dungeon_period_idx);b_path=RES_CDN_SOUND+SND_TYPE+"sound/"+cmString("BGM_marathon_loop_%d.mp3",period.event_dungeon_point_period_idx);audio.m_bgmPath!=b_path&&(audio.stopBackgroundMusic(),audio.playBackgroundMusic(b_path,!0))}else this.m_game_type==db.BattleGameType.WeeklyDungeon&&this.playMainBGM()},showEventRaidDungeonBattleSelect:function(){this.m_selectBattleModalLayer._contentNode=function(contentSize,m){return this.getSelectBattleLayer()}.bind(this),this.m_selectBattleModalLayer.show()},getSelectBattleLayer:function(){var layer=new cc.Layer,m=MasterManager.getInstance(),nService=new NetService,context=BattleContext._getInstance(),win_size=cc.director.getWinSize(),bg=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",RectZero());bg.setInsetLeft(44),bg.setInsetRight(44),bg.setInsetTop(44),bg.setInsetBottom(44),bg.setPreferredSize(cc.size(680,405)),bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(win_size)),layer.addChild(bg);var navi=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_navi.png",RectZero());navi.setInsetLeft(46),navi.setInsetRight(46),navi.setPreferredSize(cc.size(664,48)),navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(bg).x,ccHeight(bg)-11),bg.addChild(navi);var title=cmLabel.getLabel(res_str("event_raid_start_skip_popup_title"),LABEL_FONT_INDEX.FONT_241);title.setAnchorPoint(ANCHOR_MIDDLE()),title.setPosition(ccCenter(navi)),navi.addChild(title);var back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);back_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),back_btn.setPosition(ccWidth(navi)-11,7),back_btn.addClickEventListener(function(sender){this.m_selectBattleModalLayer.hide()}.bind(this)),navi.addChild(back_btn);var beforeDamage=this.m_FriendSelectLayer_V2.m_boss_Damage,damage_text=new cmMultiLabel;damage_text.addLabel("[ ",LABEL_FONT_INDEX.FONT_201),damage_text.addLabel(Number(parseInt(beforeDamage)).toLocaleString("en"),LABEL_FONT_INDEX.FONT_247),damage_text.addLabel("]",LABEL_FONT_INDEX.FONT_201),damage_text.setLabel(),damage_text.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),damage_text.setPosition(250,314),bg.addChild(damage_text);var type=context.getEventRaidDungeonBattleTicket(),need_ticket=m.get_EventRaidDungeon(nService.get_Event_Raid_Dungeon_idx()).base_need_point*type,not_skip_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());not_skip_bg.setPreferredSize(cc.size(312,173)),not_skip_bg.setAnchorPoint(ZERO()),not_skip_bg.setPosition(21,117),bg.addChild(not_skip_bg);var not_skip_text_1=cmLabel.getLabel(res_str("event_raid_start_skip_popup_text_1"),LABEL_FONT_INDEX.FONT_181);not_skip_text_1.setAnchorPoint(ANCHOR_MIDDLE()),not_skip_text_1.setPosition(ccCenter(not_skip_bg).x,ccCenter(not_skip_bg).y),not_skip_bg.addChild(not_skip_text_1);var not_skip_btn=new ccui.Button("btn_38_off.png","btn_38_on.png","btn_38_none.png",ccui.Widget.PLIST_TEXTURE);not_skip_btn.setAnchorPoint(ZERO()),not_skip_btn.setPosition(28,35),not_skip_btn.addClickEventListener(function(sender){this.m_selectBattleModalLayer.hide(),this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(FriendSelectEnum.event_raid_battle_start)},0,"event_raid_battle_start")}.bind(this)),bg.addChild(not_skip_btn);var no_skip_label=cmLabel.getLabel(res_str("event_raid_start_skip_popup_button_1"),LABEL_FONT_INDEX.FONT_181);no_skip_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),no_skip_label.setPosition(38,.5*ccHeight(not_skip_btn)),not_skip_btn.addChild(no_skip_label),(btn_info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box.png",RectZero())).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),btn_info_box.setPosition(156,.5*ccHeight(not_skip_btn)),btn_info_box.setContentSize(76,28),not_skip_btn.addChild(btn_info_box),(point_img=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_point.png",nService.get_Event_Raid_Dungeon_Period_idx()))).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),point_img.setPosition(144,17),not_skip_btn.addChild(point_img);var not_skip_ticket_label=cmLabel.getLabel(cmString("%d",need_ticket),LABEL_FONT_INDEX.FONT_1810);not_skip_ticket_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),not_skip_ticket_label.setPosition(ccWidth(btn_info_box)-10,.5*ccHeight(btn_info_box)),btn_info_box.addChild(not_skip_ticket_label);var skip_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());skip_bg.setPreferredSize(cc.size(312,173)),skip_bg.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),skip_bg.setPosition(ccWidth(bg)-21,117),bg.addChild(skip_bg);var skip_text_1=cmLabel.getLabel(res_str("event_raid_start_skip_popup_text_2"),LABEL_FONT_INDEX.FONT_181);skip_text_1.setAnchorPoint(ANCHOR_MIDDLE()),skip_text_1.setPosition(ccCenter(skip_bg).x,ccCenter(skip_bg).y),skip_bg.addChild(skip_text_1);var skip_btn=new ccui.Button("btn_38_off.png","btn_38_on.png","btn_38_none.png",ccui.Widget.PLIST_TEXTURE);skip_btn.setAnchorPoint(ZERO()),skip_btn.setPosition(380,35),skip_btn.addClickEventListener(function(sender){this.m_selectBattleModalLayer.hide(),this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(FriendSelectEnum.event_raid_skip_battle_start)},0,"event_raid_skip_battle_start")}.bind(this)),bg.addChild(skip_btn);var btn_info_box,point_img,skip_label=cmLabel.getLabel(res_str("event_raid_start_skip_popup_button_2"),LABEL_FONT_INDEX.FONT_181);skip_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),skip_label.setPosition(18,.5*ccHeight(skip_btn)),skip_btn.addChild(skip_label),(btn_info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box.png",RectZero())).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),btn_info_box.setPosition(156,.5*ccHeight(skip_btn)),btn_info_box.setContentSize(76,28),skip_btn.addChild(btn_info_box),(point_img=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_point.png",nService.get_Event_Raid_Dungeon_Period_idx()))).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),point_img.setPosition(144,17),skip_btn.addChild(point_img);var skip_ticket_label=cmLabel.getLabel(cmString("%d",need_ticket),LABEL_FONT_INDEX.FONT_1810);return skip_ticket_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),skip_ticket_label.setPosition(ccWidth(btn_info_box)-10,.5*ccHeight(btn_info_box)),btn_info_box.addChild(skip_ticket_label),layer},skipAfterRefreshDeckInfo:function(){var troops_num=this.getCurrentTroopsNum();MainObserver.getInstance().postNotification(NOTIFY_MENU_PARTY_1+(troops_num-1))},showFriendSelectPopup:function(){this.m_box.is_show()&&this.m_box.hide();for(var val=arguments,msg=[],i=1;i<val.length;i++)msg.push(val[i]);this.showMsgBox(val[0],msg),msg=null},showDailyDungeonInvalidEntranceTime:function(){this.m_box.setTitle(res_str("label_weekly_invalid_entrance")),this.m_box.setText(res_str("label_daily_dungeon_invalid_entrance_time_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_daily_dungeon_invalid_entrance_time_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showInvalidEntranceTime:function(){this.m_box.setTitle(res_str("label_weekly_invalid_entrance")),this.m_box.setText(res_str("label_weekly_invalid_entrance_time")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showTroopsInSearchTroopsGeneral:function(){this.m_box.setTitle(res_str("label_shop_buy_jade_omission_title")),this.m_box.setText(res_str("label_event_dungeon_troops_in_search_troops_general_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_event_dungeon_troops_in_search_troops_general_text_2")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_event_dungeon_troops_in_search_troops_general_text_3")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showEntranceLimitOver:function(){this.m_box.setTitle(res_str("label_weekly_invalid_entrance")),this.m_box.setText(res_str("label_daily_dungeon_entrance_limit_over")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},network_write:function(req){var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent,mainScene)}}),StoryItemNodeV2=cc.Layer.extend({m_story_num_bg:null,m_lotus_bg:null,m_item_btn:null,m_story_num_label:null,m_focus_skeleteon:null,m_skeleton_node:null,m_boss_gnrl_id:0,m_touch_button:null,m_is_voice_playing:!1,m_voice_playing_delta:0,m_normal_img:null,m_press_img:null,m_disable_img:null,m_lotus_list:[],m_boss_list:[],m_skeleton_list:[],gnrl_img:[],sd_img:[],m_scene:null,ctor:function(scene){this._super(),this.m_lotus_list=[],this.m_skeleton_list=[],this.m_boss_list=[],this.gnrl_img=[],this.sd_img=[],this.m_scene=scene,this.m_voice_playing_delta=[],this.init()},init:function(){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE()),this.setContentSize(ZERO()),this.m_normal_img=RES_CDN_DEFULT+"menu_quest/img_story_normal_off.png",this.m_press_img=RES_CDN_DEFULT+"menu_quest/img_story_normal_on.png",this.m_disable_img=RES_CDN_DEFULT+"menu_quest/img_story_normal_off.png",this.m_item_btn=new ccui.Button,this.m_item_btn.loadTextures(RES_CDN_DEFULT+"menu_quest/img_story_normal_off.png",RES_CDN_DEFULT+"menu_quest/img_story_normal_on.png",RES_CDN_DEFULT+"menu_quest/img_story_normal_off.png"),this.m_item_btn.setAnchorPoint(ANCHOR_MIDDLE()),USE_SP_STORY_SCALE&&this.m_item_btn.setScale(2),this.m_item_btn.setPosition(ZERO()),this.m_item_btn.addClickEventListener(function(sender){BattleContext._getInstance().setMainMissionV2(this.m_mission),MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_choice_difficulty_type_show)}.bind(this)),this.addChild(this.m_item_btn);var btnSize=ccSize(this.m_item_btn);this.setContentSize(btnSize),this.m_story_num_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_number.png"),this.m_story_num_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_story_num_bg.setPosition(0,-25),USE_SP_STORY_SCALE&&this.m_story_num_bg.setScale(2),this.addChild(this.m_story_num_bg),this.m_story_num_label=cmLabel.createWithTTF("",FONT_NAME_NOTOSANS_MEDIUM,20),this.m_story_num_label.setColor(cc.color(238,238,238)),this.m_story_num_label.setAnchorPoint(ANCHOR_MIDDLE()),USE_SP_STORY_SCALE?(this.m_story_num_label.setPosition(ccCenter(this.m_story_num_bg).x,ccCenter(this.m_story_num_bg).y+1),this.m_story_num_label.setScale(.5)):this.m_story_num_label.setPosition(ccCenter(this.m_story_num_bg).x,ccCenter(this.m_story_num_bg).y+3),this.m_story_num_bg.addChild(this.m_story_num_label),this.m_lotus_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_star_none.png"),this.m_lotus_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_lotus_bg.setPositionY(-50),this.addChild(this.m_lotus_bg);for(var _pos=[cc.p(7,13),cc.p(36,2),cc.p(64,13)],i=0;i<3;i++){var star=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_star_on_2.png");star.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),star.setPosition(_pos[i]),this.m_lotus_bg.addChild(star),this.m_lotus_list.push(star)}return this.scheduleUpdate(),!0},setMissionData:function(m){this.m_mission=m,this.showBtnEffect(!1),this.updateLayout();for(var idx=0;idx<this.m_mission.difficulty_mission.length;idx++){1011==(m=this.m_mission.difficulty_mission[idx]).mission.main_mission_id&&this.m_item_btn.setTutorialTag(TUTORIAL_TAG_PAGE_1_STAGE_1_1)}this.m_is_voice_playing=!1,this.m_voice_playing_delta=0},updateStarPoint:function(){for(var lotus_count=0,clear_count=0,idx=0;idx<this.m_mission.difficulty_mission.length;idx++){var m=this.m_mission.difficulty_mission[idx];"y"==m.complete_yn&&(clear_count+=1);for(var complete_task_count=0,jdx=0;jdx<m.task_list.length;jdx++){m.task_list[jdx].is_cleared&&(complete_task_count+=1)}3==complete_task_count&&(lotus_count+=1)}0==lotus_count?0<clear_count?this.m_lotus_bg.setVisible(!0):this.m_lotus_bg.setVisible(!1):this.m_lotus_bg.setVisible(!0);for(var i=0;i<this.m_lotus_list.length;i++)i<lotus_count?this.m_lotus_list[i].setVisible(!0):this.m_lotus_list[i].setVisible(!1)},showBtnEffect:function(isShow){isShow&&null==this.m_focus_skeleteon&&(this.m_focus_skeleteon=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Story.json",RES_CDN_DEFULT+"effect/Story.atlas",1),this.m_focus_skeleteon.setPosition(ZERO()),this.addChild(this.m_focus_skeleteon),this.m_focus_skeleteon.setAnimation(0,"fx_1",!0),this.m_focus_skeleteon.setVisible(!1)),null!=this.m_focus_skeleteon&&this.m_focus_skeleteon.setVisible(isShow)},updateLayout:function(){var stage_title=this.m_mission.num+"";if(this.m_story_num_label.setString(stage_title),null!=this.m_skeleton_node&&(this.m_skeleton_node.setVisible(!1),this.removeChild(this.m_skeleton_node),this.m_skeleton_node=null),this.hideSkeletonBoss(),this.hideSpriteBoss(),"y"==this.m_mission.complete_yn?(this.m_story_num_label.setColor(cc.color(238,238,238)),this.m_story_num_bg.setVisible(!0),this.m_item_btn.setEnabled(!0),this.m_mission.is_current?this.createPartner():5!=this.m_mission.num&&10!=this.m_mission.num||this.createBoss("y"==this.m_mission.complete_yn)):"y"==this.m_mission.new_yn?(this.createPartner(),this.m_story_num_label.setColor(cc.color(238,238,238)),this.m_story_num_bg.setVisible(!0),this.m_item_btn.setEnabled(!0),this.showBtnEffect(!0)):(5==this.m_mission.num||10==this.m_mission.num?this.createBoss("y"==this.m_mission.complete_yn):null!=this.m_skeleton_node&&this.m_skeleton_node.setVisible(!1),this.m_story_num_label.setColor(cc.color(129,129,129)),this.m_story_num_bg.setVisible(!1),this.m_item_btn.setEnabled(!1)),5==this.m_mission.num||10==this.m_mission.num)this.m_normal_img!=RES_CDN_DEFULT+"menu_quest/img_story_boss_off.png"&&(this.m_normal_img=RES_CDN_DEFULT+"menu_quest/img_story_boss_off.png",this.m_press_img=RES_CDN_DEFULT+"menu_quest/img_story_boss_on.png",this.m_disable_img=RES_CDN_DEFULT+"menu_quest/img_story_boss_off.png",this.m_item_btn.loadTextureNormal(this.m_normal_img),this.m_item_btn.loadTexturePressed(this.m_press_img),this.m_item_btn.loadTextureDisabled(this.m_disable_img));else if(this.m_normal_img!=RES_CDN_DEFULT+"menu_quest/img_story_normal_off.png"){this.m_normal_img=RES_CDN_DEFULT+"menu_quest/img_story_normal_off.png",this.m_press_img=RES_CDN_DEFULT+"menu_quest/img_story_normal_on.png",this.m_disable_img=RES_CDN_DEFULT+"menu_quest/img_story_normal_off.png";var off=cc.Sprite.create(this.m_normal_img),on=cc.Sprite.create(this.m_press_img),dis=cc.Sprite.create(this.m_disable_img);this.m_item_btn.loadTextureNormal(off),this.m_item_btn.loadTexturePressed(on),this.m_item_btn.loadTextureDisabled(dis)}this.updateStarPoint()},createPartner:function(){if(null==this.m_skeleton_node){MasterTable.getInstance().getMasterTable();var partner_gnrl_id=GeneralService.getInstance().getUserTroopsPartnerId();if(0!=partner_gnrl_id){var troops_partner=GameContext.getInstance().getUserGeneralPartner(),main_gnrl_key=new net.User_General_Key;main_gnrl_key.gnrl_id=troops_partner.gnrl_id,main_gnrl_key.gnrl_num=troops_partner.gnrl_num;var partner_id,partner_gnrl=new db.UserGeneralInfo;GeneralService.getInstance().getUserGnrlDisplayClassInfo(main_gnrl_key,partner_gnrl),partner_id=partner_gnrl.class_type>=AVAIL_EVOLUTION_CLASS_TYPE_LIMIT&&0!=partner_gnrl.display_class&&partner_gnrl.class_type!=partner_gnrl.display_class?partner_gnrl.gnrl_id-1e3*(partner_gnrl.class_type-partner_gnrl.display_class):partner_gnrl.gnrl_id;var gnrl=MasterManager.getInstance().get_General(partner_gnrl_id),skin_id=gnrl.bone_id!=gnrl.skin_id?partner_id:gnrl.skin_id;if(USE_SP_SD_STORY)skin_id=USE_SP_SD_DUMMY?9999999:gnrl.gnrl_group,this.gnrl_img=[],this.gnrl_img.push(RES_CDN_DEFULT+cmString("card_body_sp/%03d.png",skin_id)),resourceLoader(this.gnrl_img,function(){this.m_skeleton_node=cc.Sprite.create(RES_CDN_DEFULT+cmString("card_body_sp/%03d.png",skin_id)),this.m_skeleton_node.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_skeleton_node.setPosition(ZERO()),this.m_skeleton_node.setFlippedX(!0),this.m_skeleton_node.setScale(.7),this.addChild(this.m_skeleton_node);var scaleTo_1=new cc.ScaleTo(.6,.7,.72),scaleTo_2=new cc.ScaleTo(.6,.7,.68),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);this.m_skeleton_node.runAction(repeat),MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],already_tutorial)}.bind(this));else{this.gnrl_img=[];for(var sd_list=SDGeneralName[gnrl.gnrl_group],idx=0;idx<sd_list.length;idx++)this.gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+sd_list[idx]+".png");this.gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+skin_id+".atlas"),this.gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+skin_id+".json"),resourceLoader(this.gnrl_img,function(){var sd_atlas=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+skin_id+".atlas",sd_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+skin_id+".json";if(this.m_skeleton_node=new sp.SkeletonAnimation(sd_json,sd_atlas,.2),this.m_skeleton_node._skeleton.flipX=!0,this.m_skeleton_node.setPosition(ZERO()),this.m_skeleton_node.setEventListener(this.spineEventListener.bind(this)),this.addChild(this.m_skeleton_node),partner_id!=partner_gnrl_id)try{this.m_skeleton_node.setSkin(partner_gnrl.display_class)}catch(e){}else try{this.m_skeleton_node.setSkin(gnrl.gnrl_class)}catch(e){}this.m_skeleton_node.setAnimation(0,"run",!0),this.m_skeleton_node.setAnimation(1,"shadow_off",!0),MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],already_tutorial)}.bind(this))}}}null!=this.m_skeleton_node&&this.m_skeleton_node.setVisible(!0)},spineEventListener:function(entry,evt){var event_name=evt.data.name.toLowerCase();"loop_show"==event_name?this.m_skeleton_node.setAnimation(2,"loop",!0):"loop_hide"==event_name&&this.m_skeleton_node.setAnimation(2,"loop_off",!0)},createBoss:function(isComplete){var m=MasterManager.getInstance();this.m_boss_gnrl_id=0;for(var cnt=this.m_mission.difficulty_mission.length,npc_list=this.m_mission.difficulty_mission[cnt-1].stage_npc[3],idx=0;idx<npc_list.length;idx++)if(npc_list[idx].is_zoom){var npc=m.get_NpcGeneral(npc_list[idx].npc_id);this.m_boss_gnrl_id=npc.gnrl_id;break}if(isComplete){var is_exist=!1;for(var idx in this.m_boss_list)if(idx==this.m_boss_gnrl_id){is_exist=!0,this.m_boss_list[idx].setVisible(!0);break}if(!is_exist){(boss=cc.Sprite.create(RES_CDN_DEFULT+"menu_boss/"+this.m_boss_gnrl_id+".png")).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),boss.setPosition(ZERO(0)),this.addChild(boss),this.m_boss_list[this.m_boss_gnrl_id]=boss;var scaleTo_1=new cc.ScaleTo(1.2,1,1.03),scaleTo_2=new cc.ScaleTo(1.2,1,.97),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);boss.runAction(repeat)}}else if(0!=this.m_boss_gnrl_id){is_exist=!1;for(var idx in this.m_skeleton_list)if(idx==this.m_boss_gnrl_id){is_exist=!0,this.m_skeleton_list[idx].setVisible(!0);break}if(!is_exist){var gnrl=MasterManager.getInstance().get_General(this.m_boss_gnrl_id);if(USE_SP_SD_STORY_BOSS){var boss;(boss=cc.Sprite.create(RES_CDN_DEFULT+"menu_boss/"+this.m_boss_gnrl_id+".png")).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),boss.setPosition(ZERO(0)),this.addChild(boss),this.m_boss_list[this.m_boss_gnrl_id]=boss;scaleTo_1=new cc.ScaleTo(1.2,1,1.03),scaleTo_2=new cc.ScaleTo(1.2,1,.97),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);boss.runAction(repeat)}else{this.sd_img=[];var sd_list=SDGeneralName[gnrl.gnrl_group];for(idx=0;idx<sd_list.length;idx++)this.sd_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+sd_list[idx]+".png");this.sd_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+gnrl.skin_id+".atlas"),this.sd_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+gnrl.skin_id+".json"),resourceLoader(this.sd_img,this.loadBoss.bind(this))}}}this.createTouchButton()},loadBoss:function(){var gnrl=MasterManager.getInstance().get_General(this.m_boss_gnrl_id),sd_atlas=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+gnrl.gnrl_id+".atlas",sd_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+gnrl.gnrl_id+".json",skeleton=new sp.SkeletonAnimation(sd_json,sd_atlas,.23);skeleton.setPosition(ZERO()),this.addChild(skeleton);try{skeleton.setSkin(gnrl.gnrl_class)}catch(e){}skeleton.setAnimation(0,"idle",!0),skeleton.setAnimation(1,"shadow_off",!0),skeleton._skeleton.data.findAnimation("loop")&&skeleton.setAnimation(1,"loop",!0),this.m_skeleton_list[this.m_boss_gnrl_id]=skeleton},hideSkeletonBoss:function(){for(var idx in this.m_skeleton_list)this.m_skeleton_list.hasOwnProperty(idx)&&this.m_skeleton_list[idx].setVisible(!1)},hideSpriteBoss:function(){for(var idx in this.m_boss_list)this.m_boss_list.hasOwnProperty(idx)&&this.m_boss_list[idx].setVisible(!1)},createTouchButton:function(){null==this.m_touch_button&&(this.m_touch_button=new cc.ControlButton(cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_transbox.png"),cc.Rect(1,1,1,1)),this.m_touch_button.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_touch_button.setPreferredSize(cc.size(78,110)),this.m_touch_button.setPosition(0,30),this.addChild(this.m_touch_button),this.m_touch_button.addTargetWithActionForControlEvents(this,this.onTouchBoss,cc.CONTROL_EVENT_TOUCH_UP_INSIDE))},onTouchBoss:function(sender,_event){if(!this.m_is_voice_playing&&0<this.m_boss_gnrl_id){var duration=0,voice_list=MasterTable.getInstance().get_Voice(this.m_boss_gnrl_id,voice_main_body_touch,0,duration),voice=voice_list.voice;duration=voice_list.duration;var audio=AudioEngine.getInstance();""!=voice&&null!=voice&&(audio.playVoice(RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3",!1),this.m_is_voice_playing=!0,this.m_voice_playing_delta=duration)}},update:function(dt){this.m_is_voice_playing&&(this.m_voice_playing_delta-=dt,this.m_voice_playing_delta<0&&(this.m_is_voice_playing=!1,this.m_voice_playing_delta=0))},onExit:function(){if(this._super(),1!=this.m_scene.m_isPopupShow){if(null!=this.gnrl_img){for(var idx=0;idx<this.gnrl_img.length;idx++)cc.loader.release(this.gnrl_img[idx]);this.gnrl_img=null}for(var i=0;i<this.sd_img.length;i++)cc.loader.release(this.sd_img[i]);this.sd_img=[],this.m_scene=null,this.removeChild(this.m_skeleton_node),this.m_skeleton_node=null,this.m_skeleton_list=null,this.m_lotus_bg=null,this.m_mission=null,this.removeAllChildrenWithCleanup(!0)}}}),story_choice_difficulty_type_show=100,story_choice_difficulty_type_hide=101,story_preview_mission_show=102,story_preview_mission_hide=103,story_hard_mode_mission_preview_show=104,story_hard_mode_mission_preview_hide=105,story_friend_select=106,story_scene_req_lotus_bonus=300,story_scene_already_lotus_bonus_get=301,story_scene_lack_lotus_bonus_get=302,story_plologue_show=303,story_lotus_help_show=304,story_hard_mode_lotus_help_show=305,main_story_hard_mode_help_show=306,story_change=500,message_ok=1e3,already_tutorial=220,StorySceneV2=GameScene.extend({m_story_layer:null,m_mission_choice_modal_layer:null,m_mission_ready_modal_layer:null,m_is_tuto_ready:!1,m_progres_bar:null,m_deferred:null,m_statusLayer:null,m_storyScene_res:[],m_resArray:[],m_progres_bar_mission:null,m_prologue_btn:null,m_hard_layer:null,m_lotus_box_info_modal_layer:null,ctor:function(){this._super(scene_StorySceneV2),this.m_prologue_btn=null,this.m_hard_layer=null,this.m_lotus_box_info_modal_layer=null,this.m_deferred=$.Deferred(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_StorySceneV2])},finish_tutorial:function(){this.scheduleOnce(function(){this.m_is_tuto_ready=!0,this.removeChild(this.m_progres_bar)}.bind(this),1,"tutorial_ready")},init:function(){this.m_storyScene_res=[],this.m_storyScene_res.push(RES_CDN_DEFULT+"effect/Story.atlas"),this.m_storyScene_res.push(RES_CDN_DEFULT+"effect/Story.json"),this.m_storyScene_res.push(RES_CDN_DEFULT+"effect/Story.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_dailyvs/bg_daily_dungeon.png"),0==USE_SP_STORY_CLOUD&&(this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/bg_story_1_cloud.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/effect_cloud_2.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/effect_cloud_1.png")),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_reward_unlock.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_unlock.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_unlock.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_ready.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_ready.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_lock.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_lock.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_input_box.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_reward_box.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_boss_off.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_boss_on.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_normal_off.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_normal_on.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_number.png"),this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_star_on_2.png");for(var idx=1;idx<11;idx++)this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_stage_text_door_"+idx+".png");for(idx=1;idx<10;idx++)this.m_storyScene_res.push(RES_CDN_DEFULT+"menu_quest/img_story_stage_text_"+idx+".png");return NOT_USE_SP_MAIN_ANIMATION&&this.m_storyScene_res.push(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_new_01.png"),resourceLoader(this.m_storyScene_res,function(){this.m_story_layer=new StoryLayerV2(this),this.m_story_layer.setChangeModeCallback(this.changeModeCallback.bind(this)),this.m_story_layer.setPosition(ccCenter(this)),this.addChild(this.m_story_layer,0),USE_STORY_HARD_MODE&&(this.m_hard_layer=new StoryHardModeLayer(this),this.m_hard_layer.setChangeModeCallback(this.changeModeCallback.bind(this)),this.m_hard_layer.setPosition(ccCenter(this)),this.m_hard_layer.setVisible(!1),this.addChild(this.m_hard_layer));var win_size=cc.director.getWinSize();this.m_statusLayer=new StatusLayer(INVOKER_TYPE.normal),this.m_statusLayer.initLayout(),this.m_statusLayer.ignoreAnchorPointForPosition(!1),this.m_statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_statusLayer.setPosition(cc.p(win_size.width,win_size.height)),this.addChild(this.m_statusLayer,1);var back_btn=new ccui.Button;back_btn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png",""),back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(sender){1!=this.m_statusLayer.m_is_touch_disable&&this.back()}.bind(this)),this.addChild(back_btn,3);var title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_story.png");title.setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title,2);var modalSize=cc.size(win_size.width,640);this.m_mission_choice_modal_layer=new GameModalLayer,this.m_mission_choice_modal_layer.setContentSize(modalSize),this.addChild(this.m_mission_choice_modal_layer,99997),this.m_mission_ready_modal_layer=new GameModalLayer,this.m_mission_ready_modal_layer.setContentSize(modalSize),this.addChild(this.m_mission_ready_modal_layer,99997);var context=BattleContext._getInstance();if(USE_STORY_HARD_MODE){var story_mode=GameDefault.getInstance().getStoryMode();context.getGameType()==db.BattleGameType.None&&(1==story_mode?context.setGameType(db.BattleGameType.Mission):2==story_mode&&context.setGameType(db.BattleGameType.StoryHardMode))}else context.getGameType()==db.BattleGameType.None&&context.setGameType(db.BattleGameType.Mission);if(USE_UI_3RD_SCRIPT){this.m_prologue_btn=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_5_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_5_on.png",""),this.m_prologue_btn.setPosition(ccWidth(this)-171,ccHeight(this)-112),this.m_prologue_btn.ignoreContentAdaptWithSize(!1);var prologue_btn_rect=cc.Rect(20,20,20,2);this.m_prologue_btn.setTitleFont(prologue_btn_rect,LABEL_FONT_INDEX.FONT_2072,!0,2,cc.color(255,255,255),cc.color(128,128,128),cc.p(0,0)),this.m_prologue_btn.setTitleText(""),this.m_prologue_btn.setBright(!0),this.m_prologue_btn.setContentSize(156,42),this.m_prologue_btn.setAnchorPoint(ZERO()),this.m_prologue_btn.addClickEventListener(function(){MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_plologue_show)}.bind(this)),this.addChild(this.m_prologue_btn),this.onNotifySelectStory(this.m_story_layer.m_story_index+1),TutorialContextV2.getInstance().IsCompleteAllTutorial()||this.m_prologue_btn.setVisible(!1)}if(USE_STORY_HARD_MODE){story_mode=GameDefault.getInstance().getStoryMode();this.changeModeCallback(story_mode,-1,!0)}}.bind(this)),!0},removeLayerProgress_Raid:function(){null!=this.m_progres_bar_mission&&(this.removeChild(this.m_progres_bar_mission),this.m_progres_bar_mission=null)},initLayoutProgress_Raid:function(alpha){if(!IS_NET_ERROR){this.m_progres_bar_mission=new cc.LayerColor(cc.color.BLACK),this.m_progres_bar_mission.setOpacity(alpha),this.m_progres_bar_mission.setContentSize(ccSize(this));var bg=cc.Sprite.create(RES_CM+"img_progress_bg.png");bg.setPosition(ccCenter(this));var bar=cc.Sprite.create(RES_CM+"img_progress_arrow.png");bar.setPosition(ccCenter(bg)),bg.addChild(bar,1000001),this.m_progres_bar_mission.addChild(bg),this.addChild(this.m_progres_bar_mission,1000001);var loading=new cc.Sprite(res.s_cm_img_text_loading);loading.setAnchorPoint(.5,0),loading.setPosition(ccCenter(bg).x,ccCenter(bg).y-100),loading.setOpacity(255),bg.addChild(loading,1000001);var mu=new cc.RotateBy(.1,30),seq=new cc.Sequence(mu),repeat=new cc.RepeatForever(seq);bar.runAction(repeat);var listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE});listener.onTouchBegan=function(touch,event){event.stopPropagation()}.bind(this),cc.eventManager.addListener(listener,this.m_progres_bar_mission)}},onEnter:function(){USE_UI_3RD_SCRIPT&&MainObserver.getInstance().addObserver(this.onNotifySelectStory,this,NOTIFICATION_SELECT_STORY),this._super()},get_story_deferred:function(){return this.m_deferred},onExit:function(){if(this._super(),1!=this.m_isPopupShow){if(null!=this.m_story_layer&&(this.m_story_layer.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_story_layer),this.m_story_layer=null),null!=this.m_mission_choice_modal_layer&&(this.m_mission_choice_modal_layer.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_mission_choice_modal_layer),this.m_mission_choice_modal_layer=null),null!=this.m_mission_ready_modal_layer&&(this.m_mission_ready_modal_layer.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_mission_ready_modal_layer),this.m_mission_ready_modal_layer=null),null!=this.m_storyScene_res){for(var i=0;i<this.m_storyScene_res.length;i++)cc.loader.release(this.m_storyScene_res[i]);this.m_storyScene_res=null}if(null!=this.m_resArray){for(var idx=0;idx<this.m_resArray.length;idx++)cc.loader.release(this.m_resArray[idx]);this.m_resArray=null}this.m_deferred=null,this.m_prologue_btn=null,this.removeAllChildrenWithCleanup(!0);var gameObserver=MainObserver.getInstance();gameObserver.removeObserver(sceneStr[scene_StorySceneV2]),USE_UI_3RD_SCRIPT&&gameObserver.removeObserver(NOTIFICATION_SELECT_STORY)}else this.m_isPopupShow=!1},onEnterTransitionDidFinish:function(){this._super();var context=BattleContext._getInstance();context.IsNextMissionPopup()&&(0<context.getMissionID()?this.m_isShowAchivLayer?context.showNextMissionPopup(!1):this.scheduleOnce(function(float){this.m_isShowAchivLayer||MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_choice_difficulty_type_show)},.1,"next_mission_popup"):context.showNextMissionPopup(!1))},onNotification:function(msg,state,body){if(!this._super(msg)){switch(msg){case story_choice_difficulty_type_show:this.initLayoutProgress2(0);for(var mainMission=BattleContext._getInstance().getMainMissionV2(),idx=0;idx<this.m_resArray.length;idx++)cc.loader.release(this.m_resArray[idx]);this.m_resArray=[];for(var i=0;i<mainMission.difficulty_mission.length;i++){var mission=mainMission.difficulty_mission[i];for(var npc in mission.stage_npc)if(3==npc){var npc_list=mission.stage_npc[npc];for(var g in npc_list)if(npc_list[g].is_zoom){npc=MasterManager.getInstance().get_NpcGeneral(npc_list[g].npc_id);var general=MasterManager.getInstance().get_General(npc.gnrl_id);this.m_resArray.push(RES_CDN_DEFULT+"card_story_boss/"+leadingZeros(general.gnrl_group,2)+".png"),general=npc=null}npc_list=null}mission=null}this.m_resArray.push(RES_CDN_DEFULT+"common/img_cloud_top.png"),this.m_resArray.push(RES_CDN_DEFULT+"common/img_cloud_bottom.png"),this.m_resArray.push(RES_CDN_DEFULT+"menu_quest/img_story_normal_large_off.png"),this.m_resArray.push(RES_CDN_DEFULT+"menu_quest/img_story_normal_large_off.png"),this.m_resArray.push(RES_CDN_DEFULT+"menu_quest/img_story_sakura_2_off.png"),this.m_resArray.push(RES_CDN_DEFULT+"menu_quest/img_story_door_1.png"),this.m_resArray.push(RES_CDN_DEFULT+"menu_quest/img_story_door_2.png"),this.m_resArray.push(RES_CDN_DEFULT+"menu_quest/img_story_door_3.png"),this.m_resArray.push(RES_CDN_DEFULT+"menu_quest/img_story_sakura_2_on.png"),this.m_resArray.push(RES_CDN_DEFULT+"menu_quest/img_story_normal_large_black.png"),this.m_resArray.push(RES_CDN_DEFULT+"menu_quest/img_story_reward_box_black.png"),this.m_resArray.push(RES_CDN_DEFULT+"menu_quest/img_story_lock.png"),resourceLoader(this.m_resArray,function(){this.showMainMIssionChoicePopup(),this.removeLayerProgress2()}.bind(this));break;case story_choice_difficulty_type_hide:this.hideMainMissionChoicePopup();break;case story_preview_mission_show:this.showMissionReadyModalLayer();break;case story_preview_mission_hide:this.hideMissionReadyModalLayer();break;case story_hard_mode_mission_preview_show:this.showStoryHardModeMissionPreviewPopup();break;case story_hard_mode_mission_preview_hide:this.hideStoryHardModeMissionPreviewPopup();break;case story_friend_select:this.initLayoutProgress3();var req={};req.opcode=net.OP.op_mission_battle_friend_list,this.network_write(req);break;case story_scene_req_lotus_bonus:this.reqLotusBonus();break;case story_scene_already_lotus_bonus_get:this.showToastBox("","",2);break;case story_scene_lack_lotus_bonus_get:this.showToastBox("","",2);break;case message_ok:this.m_box.is_show()&&this.m_box.hide();break;case story_lotus_help_show:case story_hard_mode_lotus_help_show:this.m_isPopupShow=!0,GameContext.getInstance().setHelpInfoIndexByCallIndex(3);scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null;break;case main_story_hard_mode_help_show:this.m_isPopupShow=!0,GameContext.getInstance().setHelpInfoIndexByCallIndex(78);scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null;break;case already_tutorial:this.m_deferred.resolve(!0),this.finish_tutorial();break;case story_plologue_show:if(USE_UI_3RD_SCRIPT){var scene=new PrologueSceneV2;this.m_isPopupShow=!0,this.m_isPushScene=!0,STORY_PROLOGUE_SAW=!0,SceneManager.getInstance().pushScene(scene),scene=null;break}}return!0}},onNetworkEvent:function(opcode,state,body){var m=MasterManager.getInstance();if(opcode==net.OP.op_mission_battle_friend_list){this.removeLayerProgress3(),BattleContext._getInstance().setFriendList(body.frnd_list);var scene=new FriendSelectScene;SceneManager.getInstance().replaceScene(scene),scene=null}else if(opcode==net.OP.op_main_story_lotus_bonus_get_v2){var lotus_bonus=m.get_MainStoryLotusBonus(body.lotus_bonus_log.main_scene_id,body.lotus_bonus_log.main_story_id,body.lotus_bonus_log.difficulty_type,body.lotus_bonus_log.lotus_count),bonus=m.get_BonusType(lotus_bonus.bonus_type),msg=[];if(lotus_bonus.bonus_type==BONUS_TYPE_LOVE_ITEM||lotus_bonus.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||lotus_bonus.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT)msg.push(""+bonus.name+"1\n");else if(lotus_bonus.bonus_type==BONUS_TYPE_JIN_FIX||lotus_bonus.bonus_type==BONUS_TYPE_YUNHEE_FIX){var gnrl=m.get_General(lotus_bonus.bonus_count);msg.push(""+gnrl.name+"1\n")}else msg.push(""+bonus.name+lotus_bonus.bonus_count+"\n");this.showMsgBox(res_str("label_lotus_bonus_title"),msg),this.m_story_layer.setLotusBonusResult(body)}else if(opcode==net.OP.op_main_story_hard_mode_lotus_reward_get){lotus_bonus=MasterTable.getInstance().get_MainStoryHardModeLotusReward(body.lotus_reward_log.difficult,body.lotus_reward_log.main_story_id,body.lotus_reward_log.lotus_count);var bonus_type=m.get_BonusType(lotus_bonus.bonus_type);msg=[];if(lotus_bonus.bonus_type==BONUS_TYPE_LOVE_ITEM||lotus_bonus.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||lotus_bonus.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT)msg.push(cmString(res_str("label_lotus_bonus_success_msg"),bonus_type.name,1));else if(lotus_bonus.bonus_type==BONUS_TYPE_JIN_FIX||lotus_bonus.bonus_type==BONUS_TYPE_YUNHEE_FIX){gnrl=m.get_General(lotus_bonus.max_value);msg.push(cmString(res_str("label_lotus_bonus_success_msg"),gnrl.name,1))}else msg.push(cmString(res_str("label_lotus_bonus_success_msg"),bonus_type.name,lotus_bonus.min_value));this.showMsgBox(res_str("label_lotus_bonus_title"),msg),null!=this.m_hard_layer&&this.m_hard_layer.setLotusGetResult(body)}else if(opcode==net.OP.op_get_user_main_story_hard_mode_mission)null!=this.m_hard_layer&&this.m_hard_layer.refreshStoryHardModeMissionData();else if(opcode==net.OP.op_main_story_hard_mode_mission_charge)if(body.error!=net.ERROR.NET_E_SUCCESS){if(body.error==net.ERROR.NET_E_DAILY_TRY_COUNT_REMAIN){var title=res_str("label_information_title");(msg=[]).push(res_str("story_hard_enter_charge_cannot_popup_text")),msg.push(res_str("story_hard_enter_deny_popup_text_3")),this.showMsgBox(title,msg);var req={};req.opcode=net.OP.op_get_user_main_story_hard_mode_mission,this.network_write(req)}else if(body.error==net.ERROR.NET_E_CAN_NOT_CHARGE){title=res_str("story_hard_enter_deny_popup_title");(msg=[]).push(res_str("story_hard_enter_deny_popup_text_1")),msg.push(res_str("story_hard_enter_deny_popup_text_3")),this.showMsgBox(title,msg)}else if(body.error==net.ERROR.NET_E_DAILY_CHARGE_COUNT_OVER){title=res_str("story_hard_enter_deny_popup_title");(msg=[]).push(res_str("story_hard_enter_deny_popup_text_1")),msg.push(res_str("story_hard_enter_deny_popup_text_2")),msg.push(res_str("story_hard_enter_deny_popup_text_3")),this.showMsgBox(title,msg)}}else{null!=this.m_hard_layer&&this.m_hard_layer.setMissionChargeResult(body);title=res_str("story_hard_enter_charge_complete_popup_title");(msg=[]).push(res_str("story_hard_enter_charge_complete_popup_text")),this.showMsgBox(title,msg),body.error==net.ERROR.NET_E_SUCCESS||body.error==net.ERROR.NET_E_ALERAY_GET_LOTUS_BONUS_GET&&(this.m_box.setTitle(res_str("label_lotus_bonus_title")),this.m_box.setText(res_str("btn_label_confirm")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show())}},back:function(){STORY_PROLOGUE_SAW?(STORY_PROLOGUE_SAW=!1,this.onKeyBack3()):this.onKeyBack(!0,!1)},onTutorialEnter:function(step){TutorialContextV2.getInstance();this.setTutorialStep(step),step.tutorial_page==TUTORIAL_PAGE_1_STORY&&(3==step.tutorial_step&&this.initLayoutProgress(),5==step.tutorial_step?(this.popTutorialLayer(),this.scheduleOnce(function(float){this.setTutorialStep(step)}.bind(this),.1,"tutorial_layer")):7==step.tutorial_step?(this.popTutorialLayer(),this.scheduleOnce(function(float){this.setTutorialStep(step)}.bind(this),.1,"tutorial_layer")):9==step.tutorial_step&&this.popTutorialLayer())},hideMainMissionChoicePopup:function(){this.m_mission_choice_modal_layer.is_show()&&this.m_mission_choice_modal_layer.hide()},showMainMIssionChoicePopup:function(){this.m_mission_choice_modal_layer._contentNode=function(contentSize,m){var layer=new cc.Layer,mainMission=BattleContext._getInstance().getMainMissionV2(),popup=new StorySelectionPopup(mainMission);return layer.setContentSize(popup.getContentSize()),layer.setPosition(.5*this.getContentSize()),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE()),layer.addChild(popup),popup.setPosition(ccCenter(layer)),this.m_mission_choice_modal_layer.setContentSize(layer.getContentSize()),layer}.bind(this),this.m_mission_choice_modal_layer.is_show()||this.m_mission_choice_modal_layer.show()},showStoryHardModeMissionPreviewPopup:function(){this.m_mission_ready_modal_layer._contentNode=function(contentSize,m){var story_hard_mode_mission_idx=BattleContext._getInstance().getStoryHardModeMissionId();return new StoryHardModeMissionPreviewPopup(story_hard_mode_mission_idx)}.bind(this),this.m_mission_ready_modal_layer.is_show()||this.m_mission_ready_modal_layer.show()},hideStoryHardModeMissionPreviewPopup:function(){this.m_mission_ready_modal_layer.is_show()&&this.m_mission_ready_modal_layer.hide()},showMissionReadyModalLayer:function(){this.initLayoutProgress_Raid(0),this.scheduleOnce(function(dt){this.m_mission_ready_modal_layer._contentNode=function(contentSize,m){var mission_id=BattleContext._getInstance().getMissionID(),layer=new MissionPreviewPopup(mission_id);return this.removeLayerProgress_Raid(),layer}.bind(this),this.m_mission_ready_modal_layer.is_show()||this.m_mission_ready_modal_layer.show()}.bind(this),.5,"MissionPreviewPopup")},hideMissionReadyModalLayer:function(){this.m_mission_ready_modal_layer.is_show()&&this.m_mission_ready_modal_layer.hide()},reqLotusBonus:function(){var context=BattleContext._getInstance(),req={};req.opcode=net.OP.op_main_story_lotus_bonus_get_v2,req.main_scene_id=context.getLotusBonusMainSceneID(),req.main_story_id=context.getLotusBonusMainStoryID(),req.difficulty_type=context.getLotusBonusDifficultyType(),req.lotus_count=context.getLotusBonusLotusCount(),this.network_write(req)},onNotifySelectStory:function(sender){if(USE_UI_3RD_SCRIPT&&TutorialContextV2.getInstance().IsCompleteAllTutorial()&&BattleContext._getInstance().getGameType()==db.BattleGameType.Mission){1==sender||0==sender?null!=this.m_prologue_btn&&this.m_prologue_btn.setVisible(!0):null!=this.m_prologue_btn&&this.m_prologue_btn.setVisible(!1)}},network_write:function(req){var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent,mainScene)},changeModeCallback:function(difficult,story_idx,is_init){return 1==difficult?(this.m_story_layer.setVisible(!0),null!=this.m_hard_layer&&this.m_hard_layer.setVisible(!1),this.m_story_layer.setChangeModeData(difficult,story_idx,is_init),-1==story_idx&&(story_idx=0),this.m_story_layer.m_story_index<1?this.m_prologue_btn.setVisible(!0):this.m_prologue_btn.setVisible(!1),!0):2==difficult&&(!!this.IsOpenStoryHardMode(difficult,is_init)&&(this.m_prologue_btn.setVisible(!1),this.m_story_layer.setVisible(!1),null!=this.m_hard_layer&&this.m_hard_layer.setVisible(!0),this.m_hard_layer.setChangeModeData(difficult,story_idx),!0))},IsOpenStoryHardMode:function(difficult,is_init){var open_cond_list,service=MissionService.getInstance(),m=MasterTable.getInstance(),is_open=!0,first_story=service.getUserMainStoryHardMode(difficult)[0];open_cond_list=m.get_MainStoryHardModeOpenCondList(first_story.difficult,first_story.main_story.main_story_id);for(var i=0;i<open_cond_list.length;i++){var cond=open_cond_list[i];1==cond.open_cond_type&&(service.IsOpenMainMission(cond.value2)||(is_open=!1))}if(!is_open&&!is_init){var title=res_str("label_information_title"),msg=[];msg.push(res_str("story_hard_open_condition_popup_text_1")),msg.push(res_str("story_hard_open_condition_popup_text_2")),this.showMsgBox(title,msg)}return is_open},showPurchaseLotusBoxInfoPopup:function(reward){null!=this.m_lotus_box_info_modal_layer?(this.m_lotus_box_info_modal_layer.setLotus(reward),this.m_lotus_box_info_modal_layer.show()):(this.m_lotus_box_info_modal_layer=new StoryHardModeLotusBoxPopup(reward,this.hideLotusRewardPopup.bind(this)),this.m_lotus_box_info_modal_layer.setContentSize(ccSize(this)),this.m_lotus_box_info_modal_layer.show(),this.addChild(this.m_lotus_box_info_modal_layer,999))},hideLotusRewardPopup:function(){null!=this.m_lotus_box_info_modal_layer&&this.m_lotus_box_info_modal_layer.hide()}}),StoryLayerV2=cc.Layer.extend({m_base_layer:null,m_cloud_layer:null,m_ui_layer:null,m_bg:null,m_story_title:null,m_cloud:null,m_main_scene_id:0,m_story_index:0,m_max_story_index:0,m_arrow_left:null,m_arrow_right:null,m_lotus_box_info_modal_layer:null,m_lotus_bonus_box:null,m_lotus_total_point:null,m_beginner_hint_box:null,m_lotus_box_light:[],m_story_item_list:[],m_lotus_box_btns:[],m_lotus_bonus_labels:[],m_story_list:[],m_scene:null,m_is_partner_load:!1,m_stroy_text:null,m_hard_mode_btn:null,change_mode_callback:null,ctor:function(scene){this._super(),this.m_lotus_box_light=[],this.m_lotus_box_btns=[],this.m_lotus_bonus_labels=[],this.m_story_list=[],this.m_story_item_list=[],this.m_scene=scene,this.m_is_partner_load=!1,this.m_arrow_right=null,this.m_arrow_left=null,this.m_stroy_text=null,this.initLayout()},initLayout:function(){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var mission_id,winSize=cc.size(this),context=BattleContext._getInstance();context.IsNextMissionPopup()?0!=(mission_id=context.getMissionID())?this.getMainStoryListByMissionId(mission_id):this.getMainStoryList():0<(mission_id=context.getMissionID())?this.getMainStoryListByMissionId(mission_id):this.getMainStoryList();if(this.m_base_layer=new cc.Layer,this.m_base_layer.ignoreAnchorPointForPosition(!1),this.m_base_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_base_layer.setPosition(ccCenter(winSize)),this.addChild(this.m_base_layer,0),this.m_cloud_layer=new cc.Layer,this.m_cloud_layer.ignoreAnchorPointForPosition(!1),this.m_cloud_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_cloud_layer.setPosition(ccCenter(winSize)),this.addChild(this.m_cloud_layer,100),this.m_ui_layer=new cc.Layer,this.m_ui_layer.ignoreAnchorPointForPosition(!1),this.m_ui_layer.setAnchorPoint(ANCHOR_MIDDLE()),this.m_ui_layer.setPosition(ccCenter(winSize)),this.addChild(this.m_ui_layer,200),USE_STORY_HARD_MODE)var bg_img=RES_CDN_DEFULT+"new_menu_quest/bg_story_"+(this.m_story_index+1)+".jpg";else bg_img=RES_CDN_DEFULT+"menu_quest/bg_story_"+(this.m_story_index+1)+".jpg";this.m_bg=cc.Sprite.create(bg_img),this.m_bg.setPosition(ccCenter(this.m_base_layer)),this.m_bg.setAnchorPoint(ANCHOR_MIDDLE()),USE_SP_STORY_SCALE&&this.m_bg.setScale(2),this.m_base_layer.addChild(this.m_bg);for(var pos_list=MasterTable.getInstance().get_MainMissionStagePosList(this.m_main_scene_id,this.m_story_index+1),i=0;i<this.m_story_list[this.m_story_index].mission_list.length;i++){var pos=pos_list[i],item=new StoryItemNodeV2(this.m_scene);item.setPosition(pos.x,pos.y),USE_SP_STORY_SCALE?this.m_base_layer.addChild(item):this.m_bg.addChild(item),item.setMissionData(this.m_story_list[this.m_story_index].mission_list[i]),"y"==this.m_story_list[this.m_story_index].mission_list[i].new_yn&&(this.m_is_partner_load=!0),this.m_story_item_list.push(item),item=pos=null}pos_list=null,0==USE_SP_STORY_CLOUD&&this.createCloudScroll();var quest_title=RES_CDN_DEFULT+"menu_quest/img_story_stage_text_"+(this.m_story_index+1)+".png";this.m_story_title=cc.Sprite.create(quest_title),this.m_story_title.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_story_title.setPosition(.5*winSize.width,544),USE_SP_STORY_SCALE&&this.m_story_title.setScale(2),this.m_ui_layer.addChild(this.m_story_title),quest_title=null,this.m_arrow_left=new ccui.Button("btn_castle_arrow_off.png","btn_castle_arrow_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_arrow_left.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_arrow_left.setFlippedX(!0),this.m_arrow_left.setPosition(10,.5*winSize.height),this.m_arrow_left.addClickEventListener(function(sender){this.m_story_index--,this.m_story_index=Math.max(this.m_story_index,0),this.getParent().initLayoutProgress2(0),this.updateStoryLayout().done(function(val){1==val&&this.getParent().removeLayerProgress2()}.bind(this))}.bind(this)),this.m_arrow_left.setTag(this.m_story_index),this.m_ui_layer.addChild(this.m_arrow_left),this.m_arrow_right=new ccui.Button("btn_castle_arrow_off.png","btn_castle_arrow_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_arrow_right.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_arrow_right.setPosition(winSize.width-10,.5*winSize.height),this.m_arrow_right.addClickEventListener(function(sender){this.m_story_index++,this.m_story_index=Math.min(this.m_story_index,this.m_max_story_index),this.getParent().initLayoutProgress2(0),this.updateStoryLayout().done(function(val){1==val&&this.getParent().removeLayerProgress2()}.bind(this))}.bind(this)),this.m_arrow_right.setTag(this.m_story_index),this.m_ui_layer.addChild(this.m_arrow_right),USE_SP_STORY_SCALE?this.createLotusBox_SP():this.createLotusBox(),this.updateLotusBox(),this.m_beginner_hint_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_banner_1.png"),this.m_beginner_hint_box.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_beginner_hint_box.setPosition(winSize.width-10,0),USE_SP_STORY_SCALE&&this.m_beginner_hint_box.setScale(2),this.m_ui_layer.addChild(this.m_beginner_hint_box),this.checkArrow(),this.m_lotus_box_info_modal_layer=new GameModalLayer,this.m_lotus_box_info_modal_layer.setContentSize(winSize),this.addChild(this.m_lotus_box_info_modal_layer,99999);var bgm_ref_idx=this.m_story_index+1;BattleContext._getInstance().setMissionStage(bgm_ref_idx),0==this.m_is_partner_load&&MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],already_tutorial),USE_STORY_HARD_MODE&&this.createHardModeBtns()},playBGM:function(){var bgm_ref_idx=this.m_story_index+1,bgm_list=[];bgm_list=MasterTable.getInstance().get_Bgm(BGM_TYPE_CHANGE_STORY_STAGE_BGM,bgm_list,bgm_ref_idx);var audio=AudioEngine.getInstance();if(0!=bgm_list.length&&null!=bgm_list&&null!=bgm_list){var path=RES_CDN_SOUND+SND_TYPE+"sound/"+bgm_list[0].sound_file_name;audio.m_bgmPath!=path&&audio.playBackgroundMusic(path,!0)}},onEnter:function(){this._super(),USE_UI_3RD_SCRIPT&&(this.isVisible()&&this.playBGM(),MainObserver.getInstance().postNotification(NOTIFICATION_SELECT_STORY,this.m_story_index)),this.scheduleOnce(function(){this.checkLotusBonus()},1,"checkLotusBonus")},onExit:function(){this._super(),1!=this.m_scene.m_isPopupShow&&(null!=this.m_bg&&(this.m_bg.removeAllChildrenWithCleanup(!0),this.m_bg=null),null!=this.m_base_layer&&(this.m_base_layer.removeChild(this.m_bg),this.m_base_layer.removeAllChildrenWithCleanup(!0),this.m_base_layer=null,this.removeChild(this.m_base_layer)),null!=this.m_cloud&&(this.m_cloud.removeAllChildrenWithCleanup(!0),this.m_cloud_layer.removeChild(this.m_cloud),this.m_cloud=null),null!=this.m_cloud_layer&&(this.m_cloud_layer.removeAllChildrenWithCleanup(!0),this.removeChild(this.m_cloud_layer),this.m_cloud_layer=null),null!=this.m_lotus_bonus_box&&(this.m_lotus_bonus_box.removeChild(this.m_lotus_total_point),this.m_lotus_bonus_box.removeAllChildrenWithCleanup(!0)),null!=this.m_ui_layer&&(this.m_ui_layer.removeChild(this.m_story_title),this.m_ui_layer.removeChild(this.m_arrow_left),this.m_ui_layer.removeChild(this.m_arrow_right),this.m_ui_layer.removeChild(this.m_stroy_text),this.m_ui_layer.removeChild(this.m_beginner_hint_box),this.m_ui_layer.removeChild(this.m_beginner_lotus_info),this.m_ui_layer.removeChild(this.m_lotus_bonus_box),this.m_ui_layer.removeAllChildrenWithCleanup(!0)),this.removeChild(this.m_ui_layer),this.m_ui_layer=null,this.removeChild(this.m_lotus_box_info_modal_layer),this.m_lotus_box_info_modal_layer=null,this.m_story_list=null,this.m_story_title=null,this.m_arrow_left=null,this.m_arrow_right=null,this.m_stroy_text=null,this.m_beginner_hint_box=null,this.m_beginner_lotus_info=null,this.m_lotus_bonus_box=null,this.m_lotus_total_point=null,this.m_lotus_box_light=null,this.m_lotus_bonus_labels=null,this.m_lotus_box_btns=null,this.m_story_item_list=null,this.removeAllChildrenWithCleanup(!0))},checkArrow:function(){null!=this.m_arrow_left&&(0==this.m_story_index?this.m_arrow_left.setVisible(!1):this.m_arrow_left.setVisible(!0)),null!=this.m_arrow_right&&(this.m_story_index>=this.m_max_story_index?this.m_arrow_right.setVisible(!1):this.m_arrow_right.setVisible(!0)),null!=this.m_beginner_hint_box&&this.m_beginner_hint_box.setVisible(0==this.m_story_index),null!=this.m_beginner_lotus_info&&this.m_beginner_lotus_info.setVisible(0==this.m_story_index)},getLotusBonus:function(bonus_num,btn){var bonus=this.m_story_list[this.m_story_index].bonus[bonus_num];if("y"!=bonus.complete_yn){for(var gain_lotus=0,i=0;i<this.m_story_list[this.m_story_index].mission_list.length;i++)for(var mission=this.m_story_list[this.m_story_index].mission_list[i],mdx=0;mdx<mission.difficulty_mission.length;mdx++){for(var m=mission.difficulty_mission[mdx],complete_task_count=0,tdx=0;tdx<m.task_list.length;tdx++){m.task_list[tdx].is_cleared&&complete_task_count++}3==complete_task_count&&(gain_lotus+=1)}if(gain_lotus>=bonus.main_story_lotus.lotus_count){var context=BattleContext._getInstance();context.setLotusBonusMainSceneID(bonus.main_story_lotus.main_scene_id),context.setLotusBonusMainStoryID(bonus.main_story_lotus.main_story_id),context.setLotusBonusDifficultyType(bonus.main_story_lotus.difficulty_type),context.setLotusBonusLotusCount(bonus.main_story_lotus.lotus_count),MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_scene_req_lotus_bonus),btn.loadTextureNormal(RES_CDN_DEFULT+"menu_quest/img_story_reward_unlock.png"),btn.loadTexturePressed(RES_CDN_DEFULT+"menu_quest/img_story_reward_unlock.png")}else this.showLotusBoxModalLayer(bonus);bonus=null}else MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_scene_already_lotus_bonus_get)},createLotusBox:function(){this.m_beginner_lotus_info=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_banner_2.png"),this.m_beginner_lotus_info.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_beginner_lotus_info.setPosition(10,130),this.m_ui_layer.addChild(this.m_beginner_lotus_info),this.m_lotus_bonus_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_input_box.png"),this.m_lotus_bonus_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_lotus_bonus_box.setPosition(10,0),this.m_ui_layer.addChild(this.m_lotus_bonus_box),this.m_lotus_total_point=cmLabel.getLabel("0/30",LABEL_FONT_INDEX.FONT_181),this.m_lotus_total_point.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_lotus_total_point.setPosition(164,90),this.m_lotus_bonus_box.addChild(this.m_lotus_total_point);var icon_name="";"y"==(bonus=this.m_story_list[this.m_story_index].bonus[0]).complete_yn?bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_unlock.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_unlock.png"):"y"==bonus.new_yn?bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_ready.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_ready.png"):bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_lock.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_lock.png"),cc.Sprite.create(icon_name).setScale(1.1),(box=new ccui.Button).loadTextures(icon_name,icon_name),box.setPressedActionEnabled(!0),box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box.setPosition(26,41),box.addClickEventListener(function(sender){this.getLotusBonus(0,sender)}.bind(this)),this.m_lotus_bonus_box.addChild(box);var light_icon_name="";bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?light_icon_name=IS_SP_BROWSER?RES_CDN_DEFULT+"uieffect_2/effect_light_ori/effect_light_3.png":"#effect_light_3.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(light_icon_name=IS_SP_BROWSER?RES_CDN_DEFULT+"uieffect_2/effect_light_ori/effect_light_2.png":"#effect_light_2.png"),(light=cc.Sprite.create(light_icon_name)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),light.setPosition(10,29),light.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR),this.m_lotus_bonus_box.addChild(light),this.m_lotus_box_light.push(light);var fadeout=cc.fadeOut(1),fadein=cc.fadeIn(1),seq=cc.sequence(fadeout,fadein),repeat=cc.repeatForever(seq);light.runAction(repeat),(bonus_label=cmLabel.getLabel("10",LABEL_FONT_INDEX.FONT_181)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bonus_label.setPosition(62,22),this.m_lotus_bonus_box.addChild(bonus_label),this.m_lotus_box_btns.push(box),this.m_lotus_bonus_labels.push(bonus_label),bonus=null;icon_name="";"y"==(bonus=this.m_story_list[this.m_story_index].bonus[1]).complete_yn?bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_unlock.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_unlock.png"):"y"==bonus.new_yn?bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_ready.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_ready.png"):bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_lock.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_lock.png"),(box=new ccui.Button).loadTextures(icon_name,icon_name),box.setPressedActionEnabled(!0),box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box.setPosition(89,41),box.addClickEventListener(function(sender){this.getLotusBonus(1,sender)}.bind(this)),this.m_lotus_bonus_box.addChild(box);light_icon_name="";bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?light_icon_name=IS_SP_BROWSER?RES_CDN_DEFULT+"uieffect_2/effect_light_ori/effect_light_3.png":"#effect_light_3.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(light_icon_name=IS_SP_BROWSER?RES_CDN_DEFULT+"uieffect_2/effect_light_ori/effect_light_2.png":"#effect_light_2.png"),(light=cc.Sprite.create(light_icon_name)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),light.setPosition(73,29),light.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR),this.m_lotus_bonus_box.addChild(light),this.m_lotus_box_light.push(light);fadeout=cc.fadeOut(1),fadein=cc.fadeIn(1),seq=cc.sequence(fadeout,fadein),repeat=cc.repeatForever(seq);light.runAction(repeat),(bonus_label=cmLabel.getLabel("20",LABEL_FONT_INDEX.FONT_181)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bonus_label.setPosition(124,22),this.m_lotus_bonus_box.addChild(bonus_label),this.m_lotus_box_btns.push(box),this.m_lotus_bonus_labels.push(bonus_label),light_icon_name=bonus=null;var bonus,box;icon_name="";"y"==(bonus=this.m_story_list[this.m_story_index].bonus[2]).complete_yn?bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_unlock.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_unlock.png"):"y"==bonus.new_yn?bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_ready.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_ready.png"):bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_lock.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_lock.png"),(box=new ccui.Button).loadTextures(icon_name,icon_name),box.setPressedActionEnabled(!0),box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box.setPosition(152,41),box.addClickEventListener(function(sender){this.getLotusBonus(2,sender)}.bind(this)),this.m_lotus_bonus_box.addChild(box);var light;light_icon_name="";bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?light_icon_name=IS_SP_BROWSER?RES_CDN_DEFULT+"uieffect_2/effect_light_ori/effect_light_3.png":"#effect_light_3.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(light_icon_name=IS_SP_BROWSER?RES_CDN_DEFULT+"uieffect_2/effect_light_ori/effect_light_2.png":"#effect_light_2.png"),(light=cc.Sprite.create(light_icon_name)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),light.setPosition(136,29),light.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR),this.m_lotus_bonus_box.addChild(light),this.m_lotus_box_light.push(light);var bonus_label;fadeout=cc.fadeOut(1),fadein=cc.fadeIn(1),seq=cc.sequence(fadeout,fadein),repeat=cc.repeatForever(seq);light.runAction(repeat),(bonus_label=cmLabel.getLabel("30",LABEL_FONT_INDEX.FONT_181)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bonus_label.setPosition(187,22),this.m_lotus_bonus_box.addChild(bonus_label),this.m_lotus_box_btns.push(box),this.m_lotus_bonus_labels.push(bonus_label),light_icon_name=icon_name=bonus=null;var help_btn=new ccui.Button;help_btn.loadTextures("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE),help_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),help_btn.setPosition(ccWidth(this.m_lotus_bonus_box),ccHeight(this.m_lotus_bonus_box)),this.m_lotus_bonus_box.addChild(help_btn),help_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_lotus_help_show)},this)},createLotusBox_SP:function(){this.m_beginner_lotus_info=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_banner_2.png"),this.m_beginner_lotus_info.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_beginner_lotus_info.setPosition(10,130),this.m_beginner_lotus_info.setScale(2),this.m_ui_layer.addChild(this.m_beginner_lotus_info),this.m_lotus_bonus_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_input_box.png"),this.m_lotus_bonus_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_lotus_bonus_box.setScale(2),this.m_lotus_bonus_box.setPosition(10,0),this.m_ui_layer.addChild(this.m_lotus_bonus_box),this.m_lotus_total_point=cmLabel.getLabel("0/30",LABEL_FONT_INDEX.FONT_181),this.m_lotus_total_point.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_lotus_total_point.setPosition(174,90),this.m_ui_layer.addChild(this.m_lotus_total_point);var icon_name="";"y"==(bonus=this.m_story_list[this.m_story_index].bonus[0]).complete_yn?bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_unlock.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_unlock.png"):"y"==bonus.new_yn?bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_ready.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_ready.png"):bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_lock.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_lock.png"),cc.Sprite.create(icon_name).setScale(1.1),(box=new ccui.Button).loadTextures(icon_name,icon_name),box.setPressedActionEnabled(!0),box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box.setPosition(36,41),USE_SP_STORY_SCALE&&box.setScale(2),box.addClickEventListener(function(sender){this.getLotusBonus(0,sender)}.bind(this)),this.m_ui_layer.addChild(box);var light_icon_name="";bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?light_icon_name=IS_SP_BROWSER?RES_CDN_DEFULT+"uieffect_2/effect_light_ori/effect_light_3.png":"#effect_light_3.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(light_icon_name=IS_SP_BROWSER?RES_CDN_DEFULT+"uieffect_2/effect_light_ori/effect_light_2.png":"#effect_light_2.png"),(light=cc.Sprite.create(light_icon_name)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),light.setPosition(20,29),light.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR),this.m_ui_layer.addChild(light),this.m_lotus_box_light.push(light);var fadeout=cc.fadeOut(1),fadein=cc.fadeIn(1),seq=cc.sequence(fadeout,fadein),repeat=cc.repeatForever(seq);light.runAction(repeat),(bonus_label=cmLabel.getLabel("10",LABEL_FONT_INDEX.FONT_181)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bonus_label.setPosition(72,22),this.m_ui_layer.addChild(bonus_label),this.m_lotus_box_btns.push(box),this.m_lotus_bonus_labels.push(bonus_label),bonus=null;icon_name="";"y"==(bonus=this.m_story_list[this.m_story_index].bonus[1]).complete_yn?bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_unlock.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_unlock.png"):"y"==bonus.new_yn?bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_ready.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_ready.png"):bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_lock.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_lock.png"),(box=new ccui.Button).loadTextures(icon_name,icon_name),box.setPressedActionEnabled(!0),box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box.setPosition(99,41),USE_SP_STORY_SCALE&&box.setScale(2),box.addClickEventListener(function(sender){this.getLotusBonus(1,sender)}.bind(this)),this.m_ui_layer.addChild(box);light_icon_name="";bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?light_icon_name=IS_SP_BROWSER?RES_CDN_DEFULT+"uieffect_2/effect_light_ori/effect_light_3.png":"#effect_light_3.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(light_icon_name=IS_SP_BROWSER?RES_CDN_DEFULT+"uieffect_2/effect_light_ori/effect_light_2.png":"#effect_light_2.png"),(light=cc.Sprite.create(light_icon_name)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),light.setPosition(83,29),light.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR),this.m_ui_layer.addChild(light),this.m_lotus_box_light.push(light);fadeout=cc.fadeOut(1),fadein=cc.fadeIn(1),seq=cc.sequence(fadeout,fadein),repeat=cc.repeatForever(seq);light.runAction(repeat),(bonus_label=cmLabel.getLabel("20",LABEL_FONT_INDEX.FONT_181)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bonus_label.setPosition(134,22),this.m_ui_layer.addChild(bonus_label),this.m_lotus_box_btns.push(box),this.m_lotus_bonus_labels.push(bonus_label),light_icon_name=bonus=null;var bonus,box;icon_name="";"y"==(bonus=this.m_story_list[this.m_story_index].bonus[2]).complete_yn?bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_unlock.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_unlock.png"):"y"==bonus.new_yn?bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_ready.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_ready.png"):bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_lock.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_lock.png"),(box=new ccui.Button).loadTextures(icon_name,icon_name),box.setPressedActionEnabled(!0),box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box.setPosition(162,41),USE_SP_STORY_SCALE&&box.setScale(2),box.addClickEventListener(function(sender){this.getLotusBonus(2,sender)}.bind(this)),this.m_ui_layer.addChild(box);var light;light_icon_name="";bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?light_icon_name=IS_SP_BROWSER?RES_CDN_DEFULT+"uieffect_2/effect_light_ori/effect_light_3.png":"#effect_light_3.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(light_icon_name=IS_SP_BROWSER?RES_CDN_DEFULT+"uieffect_2/effect_light_ori/effect_light_2.png":"#effect_light_2.png"),(light=cc.Sprite.create(light_icon_name)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),light.setPosition(146,29),light.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR),this.m_ui_layer.addChild(light),this.m_lotus_box_light.push(light);var bonus_label;fadeout=cc.fadeOut(1),fadein=cc.fadeIn(1),seq=cc.sequence(fadeout,fadein),repeat=cc.repeatForever(seq);light.runAction(repeat),(bonus_label=cmLabel.getLabel("30",LABEL_FONT_INDEX.FONT_181)).setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bonus_label.setPosition(197,22),this.m_ui_layer.addChild(bonus_label),this.m_lotus_box_btns.push(box),this.m_lotus_bonus_labels.push(bonus_label),light_icon_name=icon_name=bonus=null;var help_btn=new ccui.Button;help_btn.loadTextures("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE),help_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),help_btn.setPosition(2*ccWidth(this.m_lotus_bonus_box)+10,2*ccHeight(this.m_lotus_bonus_box)),this.m_ui_layer.addChild(help_btn),help_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_lotus_help_show)},this)},updateStoryLayout:function(){var deferred=$.Deferred();this.playBGM();var bg_img=RES_CDN_DEFULT+"menu_quest/bg_story_"+(this.m_story_index+1)+".jpg",frame2_texture=cc.textureCache.addImage(bg_img),frame2=new cc.SpriteFrame(frame2_texture,cc.rect(0,0,frame2_texture.getContentSize().width,frame2_texture.getContentSize().height));null!=frame2&&(this.m_bg.setSpriteFrame(frame2),USE_SP_STORY_SCALE&&this.m_bg.setScale(2)),this.m_story_title.removeFromParent(),this.m_story_title=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_stage_text_"+(this.m_story_index+1)+".png"),this.m_story_title.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_story_title.setPosition(.5*winSize.width,544),USE_SP_STORY_SCALE&&this.m_story_title.setScale(2),this.m_ui_layer.addChild(this.m_story_title);for(var resArray=[],resArraySpine=[],i=0;i<this.m_story_list[this.m_story_index].mission_list.length;i++){var mission=$.extend({},this.m_story_list[this.m_story_index].mission_list[i]);if(5==mission.num||10==mission.num)for(var cnt=mission.difficulty_mission.length,npc_list=mission.difficulty_mission[cnt-1].stage_npc[3],idx=0;idx<npc_list.length;idx++)if(npc_list[idx].is_zoom){var npc=MasterManager.getInstance().get_NpcGeneral(npc_list[idx].npc_id);if(!mission.is_current)if(USE_SP_SD_STORY_BOSS)resArray.push(RES_CDN_DEFULT+"menu_boss/"+npc.gnrl_id+".png");else if("y"==mission.complete_yn)resArray.push(RES_CDN_DEFULT+"menu_boss/"+npc.gnrl_id+".png");else{var gnrl=MasterManager.getInstance().get_General(npc.gnrl_id),sd_list=SDGeneralName[gnrl.gnrl_group];for(idx=0;idx<sd_list.length;idx++)resArraySpine.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+sd_list[idx]+".png");resArraySpine.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+gnrl.skin_id+".atlas"),resArraySpine.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/sd/"+gnrl.skin_id+".json")}break}}var m_sd=[];for(i=0;i<resArray.length;i++)m_sd.push(resArray[i]);resArray=null;for(i=0;i<resArraySpine.length;i++)m_sd.push(resArraySpine[i]);return resArraySpine=null,resourceLoader(m_sd,function(){for(var pos_list=MasterTable.getInstance().get_MainMissionStagePos(this.m_main_scene_id,this.m_story_index+1),is_curent=!1,i=0;i<this.m_story_list[this.m_story_index].mission_list.length;i++){var mission=$.extend({},this.m_story_list[this.m_story_index].mission_list[i]);is_curent||"y"==mission.complete_yn||("y"==mission.new_yn?is_curent=!0:""==mission.complete_yn&&""==mission.new_yn&&(mission.new_yn="y",is_curent=!0));var item=this.m_story_item_list[i];item.setMissionData(mission);var pos=pos_list[i];item.setPosition(pos.x,pos.y),mission=pos=item=null}var bgm_ref_idx=this.m_story_index+1;USE_UI_3RD_SCRIPT&&MainObserver.getInstance().postNotification(NOTIFICATION_SELECT_STORY,bgm_ref_idx),BattleContext._getInstance().setMissionStage(bgm_ref_idx),this.updateLotusBox(),this.checkArrow(),USE_STORY_HARD_MODE&&this.checkHardModeBtn(),pos_list=null,deferred.resolve(!0)}.bind(this)),deferred},updateLotusBox:function(){for(var gain_lotus=0,i=0;i<this.m_story_list[this.m_story_index].mission_list.length;i++){for(var mission=this.m_story_list[this.m_story_index].mission_list[i],k=0;k<mission.difficulty_mission.length;k++){for(var m=mission.difficulty_mission[k],complete_task_count=0,idx=0;idx<m.task_list.length;idx++){m.task_list[idx].is_cleared&&(complete_task_count+=1)}3==complete_task_count&&(gain_lotus+=1)}mission=null}this.m_lotus_total_point.setString(gain_lotus+"/30");var icon_name="";for(i=0;i<this.m_story_list[this.m_story_index].bonus.length;i++){var bonus=this.m_story_list[this.m_story_index].bonus[i];"y"==bonus.complete_yn?bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_unlock.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_unlock.png"):"y"==bonus.new_yn?bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_ready.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_ready.png"):bonus.main_story_lotus.bonus_type==BONUS_TYPE_GOLD?icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_gold_lock.png":bonus.main_story_lotus.bonus_type==BONUS_TYPE_JADE&&(icon_name=RES_CDN_DEFULT+"menu_quest/img_story_reward_jade_lock.png");var off=icon_name,on=icon_name;this.m_lotus_bonus_labels[i].setString(bonus.main_story_lotus.lotus_count),gain_lotus<bonus.main_story_lotus.lotus_count?this.m_lotus_bonus_labels[i].setColor(cc.color.RED):this.m_lotus_bonus_labels[i].setColor(cc.color.WHITE),this.m_lotus_box_btns[i].loadTextureNormal(off),this.m_lotus_box_btns[i].loadTexturePressed(on),"n"==bonus.complete_yn&&"y"==bonus.new_yn?this.m_lotus_box_light[i].setVisible(!0):this.m_lotus_box_light[i].setVisible(!1)}},createCloudScroll:function(){var s,winSize=cc.director.getWinSize();this.m_cloud=new ParallaxNode,this.m_cloud_layer.addChild(this.m_cloud),(s=new ScrollableNode).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),USE_SP_STORY_SCALE?(s.setRatio(cc.p(0,0)),s.setScale(2)):s.setRatio(cc.p(0,0)),s.setPosition(0,0),null!=(cloud=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/bg_story_1_cloud.png"))&&(cloud.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),cloud.getTexture().setAliasTexParameters(),s.addScrollableObject(cloud)),0<s.getScrollableObjectsLength()&&(this.m_cloud_layer.addChild(s,0),this.m_cloud.addParallaxObject(s)),(s=new ScrollableNode).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),USE_SP_STORY_SCALE?(s.setRatio(cc.p(-10,0)),s.setScale(2)):s.setRatio(cc.p(-20,0)),s.setPosition(0,0);for(var i=1;i<=2;i++){var cloud=null;null!=(cloud=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/effect_cloud_2.png"))&&(cloud.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),cloud.getTexture().setAliasTexParameters(),s.addScrollableObject(cloud))}0<s.getScrollableObjectsLength()&&(this.m_cloud_layer.addChild(s,5),this.m_cloud.addParallaxObject(s)),(s=new ScrollableNode).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),USE_SP_STORY_SCALE?(s.setRatio(cc.p(25,0)),s.setScale(2)):s.setRatio(cc.p(25,0)),s.setPosition(0,winSize.height-287);for(i=1;i<=2;i++){cloud=null;null!=(cloud=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/effect_cloud_1.png"))&&(cloud.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),cloud.getTexture().setAliasTexParameters(),s.addScrollableObject(cloud))}0<s.getScrollableObjectsLength()&&(this.m_cloud_layer.addChild(s,10),this.m_cloud.addParallaxObject(s)),this.m_cloud.startParallax(1)},getMainStoryListByMissionId:function(mission_id){var context=BattleContext._getInstance(),mission=MasterManager.getInstance().get_MainMission(mission_id);this.m_main_scene_id=mission.main_scene_id,this.m_story_index=Math.max(mission.main_story_id-1,0),this.m_story_list=MissionService.getInstance().getUserMainStory(this.m_main_scene_id),this.m_max_story_index=-1;for(var i=0;i<this.m_story_list.length;i++)if("n"==this.m_story_list[i].complete_yn||""==this.m_story_list[i].complete_yn){this.m_max_story_index=i;break}if(-1==this.m_max_story_index&&(this.m_max_story_index=this.m_story_list.length-1),context.IsNextMissionPopup())for(var idx=0;idx<this.m_story_list[this.m_story_index].mission_list.length;idx++){mission=this.m_story_list[this.m_story_index].mission_list[idx];for(var jdx=0;jdx<mission.difficulty_mission.length;jdx++){if(mission.difficulty_mission[jdx].main_mission_id==mission_id){context.setMainMissionV2(mission);break}}}var is_current=!1;for(i=0;i<this.m_story_list[this.m_story_index].mission_list.length;i++){mission=this.m_story_list[this.m_story_index].mission_list[i];if(!is_current&&"y"!=mission.complete_yn){if("y"==mission.new_yn){is_current=!0;break}if(""==mission.new_yn){this.m_story_list[this.m_story_index].mission_list[i].new_yn="y",is_current=!0;break}}}},getMainStoryList:function(){this.m_main_scene_id=1,this.m_story_list=MissionService.getInstance().getUserMainStory(this.m_main_scene_id);for(var is_current=!(this.m_max_story_index=-1),i=0;i<this.m_story_list.length;i++)if("n"==this.m_story_list[i].complete_yn||""==this.m_story_list[i].complete_yn){this.m_story_index=i,this.m_max_story_index=i;for(var k=0;k<this.m_story_list[i].mission_list.length;k++){var mission=this.m_story_list[i].mission_list[k];if(!is_current&&"y"!=mission.complete_yn){if("y"==mission.new_yn){is_current=!0;break}if(""==mission.new_yn){this.m_story_list[i].mission_list[k].new_yn="y",is_current=!0;break}}}break}-1==this.m_max_story_index&&(this.m_story_index=this.m_story_list.length-1,this.m_max_story_index=this.m_story_list.length-1)},showLotusBoxModalLayer:function(bonus){this.m_lotus_box_info_modal_layer._contentNode=function(contentSize,m,parentSize){var layer=new LotusBonusBox(bonus,this.hideLotusBoxModalLayer,this);return this.setContentSize(layer.getContentSize()),this.getParent().m_statusLayer.setStatusDisable(!0),layer}.bind(this),this.m_lotus_box_info_modal_layer.initLayout()},hideLotusBoxModalLayer:function(){this.m_lotus_box_info_modal_layer.is_show()&&(this.m_lotus_box_info_modal_layer.hide(),this.getParent().m_statusLayer.setStatusDisable(!1))},setLotusBonusResult:function(res){for(var idx=0;idx<this.m_story_list[this.m_story_index].bonus.length;idx++){var bonus=this.m_story_list[this.m_story_index].bonus[idx];if(null==bonus.main_story_lotus.main_scene_id)break;if(bonus.main_story_lotus.main_scene_id==res.lotus_bonus_log.main_scene_id&&bonus.main_story_lotus.main_story_id==res.lotus_bonus_log.main_story_id&&bonus.main_story_lotus.difficulty_type==res.lotus_bonus_log.difficulty_type&&bonus.main_story_lotus.lotus_count==res.lotus_bonus_log.lotus_count){bonus.complete_yn=res.lotus_bonus_log.complete_yn,bonus.new_yn=res.lotus_bonus_log.new_yn;break}}this.updateLotusBox()},checkLotusBonus:function(){for(var enable_bonus_story_ids=[],idx=0;idx<this.m_story_list.length;idx++){for(var gain_lotus=0,story=this.m_story_list[idx],jdx=0;jdx<story.mission_list.length;jdx++)for(var mission=story.mission_list[jdx],kdx=0;kdx<mission.difficulty_mission.length;kdx++){for(var m=mission.difficulty_mission[kdx],complete_task_count=0,mdx=0;mdx<m.task_list.length;mdx++){m.task_list[mdx].is_cleared&&complete_task_count++}3==complete_task_count&&(gain_lotus+=1)}for(var bdx=0;bdx<story.bonus.length;bdx++){var bonus=story.bonus[bdx];if(("n"==bonus.complete_yn||""==bonus.complete_yn)&&gain_lotus>=bonus.main_story_lotus.lotus_count){enable_bonus_story_ids.push(story.main_story_id);break}}}if(0<enable_bonus_story_ids.length){for(var join="",i=0;i<enable_bonus_story_ids.length;i++)join+=enable_bonus_story_ids[i]+"",i<enable_bonus_story_ids.length-1&&(join+=", ");var scene=SceneManager.getInstance().getRunningScene();if(null!=scene)try{scene.showToastBox("",join+"\n",7)}catch(e){}}},createHardModeBtns:function(){var winSize=cc.size(this);this.m_hard_mode_btn=new NPButton(RES_CDN_DEFULT+"new_common/btn/ori/btn_6_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_6_on.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_6_none.png"),this.m_hard_mode_btn.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_hard_mode_btn.setPosition(17,winSize.height-75),this.m_hard_mode_btn.setTitleFont(cc.Rect(15,15,15,2),LABEL_FONT_INDEX.FONT_1672,!0,2,cc.color.WHITE,cc.color(128,128,128),cc.p(0,0)),this.m_hard_mode_btn.setTitleText("HARD"),this.m_hard_mode_btn.setBright(!0),this.m_hard_mode_btn.setContentSize(110,32),this.m_ui_layer.addChild(this.m_hard_mode_btn),this.m_hard_mode_btn.addClickEventListener(function(){this.changeHardMode()}.bind(this));var help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE);help_btn.setAnchorPoint(ANCHOR_TOP_LEFT()),help_btn.setPosition(17+ccWidth(this.m_hard_mode_btn)+15,winSize.height-73),this.m_ui_layer.addChild(help_btn),help_btn.addClickEventListener(function(){this.scheduleOnce(function(){MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],main_story_hard_mode_help_show)},0,"main_story_hard_mode_help_show")}.bind(this))},checkHardModeBtn:function(){},changeHardMode:function(){if(null!=this.change_mode_callback){this.change_mode_callback(2,this.m_story_index,!1)&&(GameDefault.getInstance().setStoryMode(2),BattleContext._getInstance().setGameType(db.BattleGameType.StoryHardMode))}},setChangeModeCallback:function(cb){this.change_mode_callback=cb},setChangeModeData:function(difficult,story_id,is_init){if(is_init)this.playBGM();else{var s_id=story_id;s_id=Math.max(s_id,0),s_id=Math.min(s_id,this.m_max_story_index),this.m_story_index=s_id,this.updateStoryLayout()}}}),MissionPreviewBonusItemCell=cc.TableViewCell.extend({m_item_icon:null,m_is_enable_tooltip:!1,tooltip_box:null,tooltip_title:null,tooltip_content:null,tooltip_btn:null,m_is_enable_item_count:!1,m_value_box:null,m_item_count:null,m_callbock:null,m_cancel:null,is_revision_y:!1,ctor:function(callbock,cancel){this._super(),this.m_callbock=callbock,this.m_cancel=cancel,this.initLayout()},initLayout:function(){this.setAnchorPoint(ANCHOR_BOTTOM_LEFT());var box,size=cc.size(68,68);(this.setContentSize(size),IS_SP_BROWSER)?((box=new ccui.Button(RES_CDN_DEFULT+"icon/img_icon_frame.png",RES_CDN_DEFULT+"icon/img_icon_frame.png")).setAnchorPoint(ANCHOR_MIDDLE()),box.setPosition(ccCenter(this)),box.setScale(1.1),this.addChild(box,0),box.setSwallowTouches(!1),box.addTouchEventListener(this.onToolTipTouch,this),this.m_item_icon=cc.Sprite.create("#img_reward_01.png"),this.m_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_icon.setPosition(ccCenter(this)),this.addChild(this.m_item_icon,1)):((box=new ccui.Button(RES_CDN_DEFULT+"icon/img_icon_frame.png",RES_CDN_DEFULT+"icon/img_icon_frame.png")).setAnchorPoint(ANCHOR_MIDDLE()),box.setPosition(ccCenter(this)),this.addChild(box,0),box.setSwallowTouches(!1),box.addTouchEventListener(this.onToolTipTouch,this),this.m_item_icon=cc.Sprite.create("#img_reward_01.png"),this.m_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_icon.setPosition(ccCenter(this)),this.addChild(this.m_item_icon,1))},setGainItem:function(_item){switch(this.m_item=_item,this.m_item.item_type){case database.BattleGainItemType.General:this.getGeneralCard();break;case database.BattleGainItemType.LoveItem:case database.BattleGainItemType.Hwandan:case database.BattleGainItemType.Jade:case database.BattleGainItemType.Gold:this.getGainItem();break;case database.BattleGainItemType.EventPoint:this.getEventPointItem();break;case database.BattleGainItemType.EvolveStone:case database.BattleGainItemType.EvolveOrb:case database.BattleGainItemType.ForceTypeEvolveMtrl:case database.BattleGainItemType.FormationPropertyPoint:case database.BattleGainItemType.Heart:case database.BattleGainItemType.RandomBox:this.getGainItem();break;case database.BattleGainItemType.SpecialPoint:this.getSpecialPointItem();break;case database.BattleGainItemType.UserExp:case database.BattleGainItemType.LimitOverMtrl:case database.BattleGainItemType.GachaTicket:case database.BattleGainItemType.MagicKeyPiece:case database.BattleGainItemType.CraftMtrl:this.getGainItem();break;case database.BattleGainItemType.Equipment:this.getEquipmentItem();break;case database.BattleGainItemType.KeyRefill:case database.BattleGainItemType.HeroNaming:case database.BattleGainItemType.RebirthMtrl:case database.BattleGainItemType.GreatWallTicket:case database.BattleGainItemType.ETC:case database.BattleGainItemType.JadePiece:case database.BattleGainItemType.SkipTicket:this.getGainItem();break;case database.BattleGainItemType.GnrlPiece:this.getGnrlPieceItem();break;default:this.getGainItem()}this.m_is_enable_item_count&&this.updateItemCount()},updateItemCount:function(){null!=this.m_value_box&&this.m_value_box.setVisible(!1),this.m_is_enable_item_count&&0<this.m_item.item_count&&(this.m_value_box.setVisible(!0),this.m_item_count.setString(Number(this.m_item.item_count).toLocaleString("en")))},getSpecialPointItem:function(){null!=this.m_item_icon&&null!=this.m_item_icon.getParent()&&this.m_item_icon.removeFromParent(),this.m_item_icon=cc.Sprite.create("#img_reward_"+this.m_item.item_level+"_"+leadingZeros(this.m_item.item_id,2)+".png"),this.m_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_icon.setPosition(ccCenter(this)),this.addChild(this.m_item_icon)},getEventPointItem:function(){null!=this.m_item_icon&&null!=this.m_item_icon.getParent()&&this.m_item_icon.removeFromParent(),this.m_item_icon=cc.Sprite.create("#img_reward_"+this.m_item.item_level+"_"+leadingZeros(this.m_item.item_id,2)+".png"),this.m_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_icon.setPosition(ccCenter(this)),this.addChild(this.m_item_icon)},getGnrlPieceItem:function(){null!=this.m_item_icon&&null!=this.m_item_icon.getParent()&&this.m_item_icon.removeFromParent(),this.m_item_icon=cc.Sprite.create("#img_reward_"+this.m_item.item_id+"_"+leadingZeros(this.m_item.gnrl_group,2)+"_n.png"),this.m_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_icon.setPosition(ccCenter(this)),this.m_item_icon.setScale(.428),this.addChild(this.m_item_icon)},getGainItem:function(){null!=this.m_item_icon&&null!=this.m_item_icon.getParent()&&this.m_item_icon.removeFromParent(),this.m_item_icon=cc.Sprite.create("#img_reward_"+leadingZeros(this.m_item.item_id,2)+".png"),this.m_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_icon.setPosition(ccCenter(this)),this.addChild(this.m_item_icon)},getEquipmentItem:function(){this.m_item_icon&&this.m_item_icon.getParent()&&this.m_item_icon.removeFromParent();var equip=MasterTable.getInstance().getMasterTable().get_EquipmentItem(this.m_item.item_id);DISABLE_SPB_TP?this.m_item_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_equip/"+equip.reward_img+".png"):(this.m_item_icon=cc.Sprite.create("#"+equip.reward_img+".png"),USE_SP_EQUIPMENT_ICON_SCALE&&this.m_item_icon.setScale(2)),this.m_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_icon.setPosition(ccCenter(this)),this.addChild(this.m_item_icon)},getGeneralCard:function(){var info={};info.gnrl_id=this.m_item.item_id,null!=this.m_item_icon&&null!=this.m_item_icon.getParent()&&this.m_item_icon.removeFromParent(),this.m_item_icon=(new Card).createCard(info,CARD_TYPE.type_card_thumb),this.m_item_icon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_icon.setPosition(25,25),this.addChild(this.m_item_icon,1)},initTooltipBox:function(is_use_zOrder){var thisSize=ccSize(this);null==this.tooltip_box&&(this.tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.tooltip_box.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.tooltip_box.setPosition(.5*thisSize.width,thisSize.height+5),this.tooltip_box.setVisible(!1),this.addChild(this.tooltip_box),is_use_zOrder&&this.tooltip_box.setGlobalZOrder(1e6)),null==this.tooltip_title&&(this.tooltip_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1810),this.tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_box.addChild(this.tooltip_title),is_use_zOrder&&this.tooltip_title.setGlobalZOrder(1000001)),null==this.tooltip_content&&(this.tooltip_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.tooltip_content.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_box.addChild(this.tooltip_content),is_use_zOrder&&this.tooltip_content.setGlobalZOrder(1000002))},setEnableToolTip:function(is_enable,is_global_zorder){this.m_is_enable_tooltip=is_enable,void 0===is_global_zorder&&(is_global_zorder=!0),this.m_is_enable_tooltip&&this.initTooltipBox(is_global_zorder)},onToolTipTouch:function(sender,_type){this.m_is_enable_tooltip&&(_type==ccui.Widget.TOUCH_BEGAN?this.showTooltip():_type==ccui.Widget.TOUCH_MOVED||this.hideTooltip())},showTooltip:function(){if(this.m_is_enable_tooltip){this.tooltip_box.setVisible(!0);var m=MasterTable.getInstance().getMasterTable();if(this.m_item.item_type==database.BattleGainItemType.General){var gnrl=m.get_General(this.m_item.item_id);if((tooltip=MasterTable.getInstance().get_TooltipGeneral(this.m_item.item_id)).content){this.tooltip_title.setString(gnrl.name),this.tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_content.setString(tooltip.content);tSize=ccSize(this.tooltip_title);var cSize=ccSize(this.tooltip_content);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(tSize.width+20,cSize.width+20),bSize.height=Math.max(64,bSize.height+cSize.height+5),this.tooltip_box.setPreferredSize(bSize),this.tooltip_title.setPosition(10,bSize.height-10),this.tooltip_content.setPosition(10,bSize.height-15-tSize.height)}else{this.tooltip_title.setString(gnrl.name),this.tooltip_title.setAnchorPoint(ANCHOR_MIDDLE()),this.tooltip_content.setString("");var tSize=ccSize(this.tooltip_title);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(64,tSize.width+20),bSize.height=Math.max(54,bSize.height+10),this.tooltip_box.setPreferredSize(bSize),this.tooltip_title.setPosition(ccCenter(bSize))}}else if(this.m_item.item_type==database.BattleGainItemType.Equipment){var equip=m.get_EquipmentItem(this.m_item.item_id);if((tooltip=MasterTable.getInstance().get_TooltipInfo(4,this.m_item.item_id)).content){this.tooltip_title.setString(equip.name),this.tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_content.setString(tooltip.content);tSize=ccSize(this.tooltip_title),cSize=ccSize(this.tooltip_content);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=MAX(tSize.width+20,cSize.width+20),bSize.height=MAX(64,bSize.height+cSize.height+5),this.tooltip_box.setContentSize(bSize),this.tooltip_title.setPosition(10,bSize.height-10),this.tooltip_content.setPosition(10,bSize.height-15-tSize.height)}else{this.tooltip_title.setString(equip.name),this.tooltip_title.setAnchorPoint(ANCHOR_MIDDLE()),this.tooltip_content.setString("");var tSize=ccSize(this.tooltip_title);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=MAX(64,tSize.width+20),bSize.height=MAX(54,bSize.height+10),this.tooltip_box.setContentSize(bSize),this.tooltip_title.setPosition(ccCenter(bSize))}}else if(this.m_item.item_type==database.BattleGainItemType.EventPoint){var service=EventDungeonService.getInstance(),period=m.get_EventDungeonPeriod(this.m_item.item_level),unit=m.get_EventPointUnitType(period.event_point_unit_type),first_period_idx=service.getEventDungeonFirstHalfPeriodIdx(period.event_dungeon_group_idx),second_period_idx=service.getEventDungeonSecondHalfPeriodIdx(period.event_dungeon_group_idx),middle_period_idx=service.getEventDungeonMiddleHalfPeriodIdx(period.event_dungeon_group_idx);null==period.event_dungeon_group_idx&&(middle_period_idx=second_period_idx=first_period_idx=0);var period_type=0;this.m_item.item_level==first_period_idx?period_type=1:this.m_item.item_level==second_period_idx?period_type=3:this.m_item.item_level==middle_period_idx&&(period_type=2);var tooltip=MasterTable.getInstance().get_TooltipInfo(1,period_type);if(null!=unit.name?this.tooltip_title.setString(unit.name):this.tooltip_title.setString(""),tooltip.content){this.tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_content.setString(tooltip.content);tSize=ccSize(this.tooltip_title),cSize=ccSize(this.tooltip_content);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=MAX(tSize.width+20,cSize.width+20),bSize.height=MAX(64,bSize.height+cSize.height+5),this.tooltip_box.setPreferredSize(bSize),this.tooltip_title.setPosition(10,bSize.height-10),this.tooltip_content.setPosition(10,bSize.height-15-tSize.height)}else{this.tooltip_title.setAnchorPoint(ANCHOR_MIDDLE()),this.tooltip_content.setString("");tSize=ccSize(this.tooltip_title);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=MAX(64,tSize.width+20),bSize.height=MAX(54,bSize.height+10),this.tooltip_box.setPreferredSize(bSize),this.tooltip_title.setPosition(ccCenter(bSize))}}else{var bonus=m.get_BonusType(this.m_item.item_id);tooltip=MasterTable.getInstance().get_TooltipItem(this.m_item.item_id);if(this.m_item.item_type==database.BattleGainItemType.HeroNaming&&(tooltip=MasterTable.getInstance().get_TooltipNaming(this.m_item.item_level)),tooltip.content){this.tooltip_title.setString(bonus.name),this.tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.tooltip_content.setString(tooltip.content);tSize=ccSize(this.tooltip_title),cSize=ccSize(this.tooltip_content);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(tSize.width+20,cSize.width+20),bSize.height=Math.max(64,bSize.height+cSize.height+5),this.tooltip_box.setPreferredSize(bSize),this.tooltip_title.setPosition(10,bSize.height-10),this.tooltip_content.setPosition(10,bSize.height-15-tSize.height)}else{this.tooltip_title.setString(bonus.name),this.tooltip_title.setAnchorPoint(ANCHOR_MIDDLE()),this.tooltip_content.setString("");var bSize;tSize=ccSize(this.tooltip_title);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(64,tSize.width+20),bSize.height=Math.max(54,bSize.height+10),this.tooltip_box.setPreferredSize(bSize),this.tooltip_title.setPosition(ccCenter(bSize))}}if(this.tooltip_box){var winSize=cc.director.getVisibleSize(),pos=this.tooltip_box.getPosition(),r=this.tooltip_box.getBoundingBox(),w_pos=this.convertToWorldSpace(r);if(w_pos.x<0)return this.tooltip_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),void this.tooltip_box.setPosition(0,pos.y);var o={x:r.x+r.width,y:r.y+r.height};(w_pos=this.convertToWorldSpace(o)).x>winSize.width&&(this.tooltip_box.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.tooltip_box.setPosition(this.getContentSize().width,pos.y));var world_pos=this.tooltip_box.getParent().getParent().getParent().convertToWorldSpace(this.getPosition()),container_pos=this.tooltip_box.getParent().getParent().getPosition();world_pos.x=world_pos.x+this.tooltip_box.x+container_pos.x,world_pos.y=world_pos.y+this.tooltip_box.y+container_pos.y,null!=this.m_callbock&&this.m_callbock(world_pos,Object.assign({},this.tooltip_box),this.tooltip_title.getString(),this.tooltip_content.getString())}}},hideTooltip:function(){this.m_is_enable_tooltip&&(null!=this.tooltip_box&&this.tooltip_box.setVisible(!1),null!=this.m_cancel&&this.m_cancel())},setEnableItemCount:function(is_enable){this.m_is_enable_item_count=is_enable,this.m_is_enable_item_count?this.createValueBox():null!=this.m_value_box&&this.m_value_box.setVisible(!1)},createValueBox:function(){if(null==this.m_value_box){var size=ccSize(this);this.m_value_box=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_valuebox.png");var offset_y=0;this.is_revision_y&&(offset_y=5),this.m_value_box.setPosition(ccCenter(size).x,offset_y),this.addChild(this.m_value_box,5),this.m_value_box.setVisible(!1),IS_SP_BROWSER?(this.m_item_count=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.m_item_count.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_count.setPosition(ccCenter(this.m_value_box)),this.m_item_count.enableOutline(cc.color.BLACK,2)):(this.m_item_count=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_143),this.m_item_count.setAnchorPoint(ANCHOR_MIDDLE()),this.m_item_count.setPosition(ccCenter(this.m_value_box))),this.m_value_box.addChild(this.m_item_count)}},setRevisionY:function(is_revision){this.is_revision_y=is_revision}}),TaskActionType={Mission_Clear_Count:10},MissionPreviewTask=cc.Node.extend({m_main_task:null,ctor:function(task){this._super(),this.m_main_task=task,this.init()},init:function(){this.setContentSize(444,78),this.createMainStoryTask()},createMainStoryTask:function(){var size=ccSize(this),box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",cc.Rect(16,16,16,16));box.setPosition(ZERO()),box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box.setPreferredSize(size),this.addChild(box);var content,task_title=cmLabel.getLabel(this.m_main_task.task.name,LABEL_FONT_INDEX.FONT_2013);if(task_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),task_title.setPosition(58,43),this.addChild(task_title),this.m_main_task.task_type.task_type==TaskActionType.Mission_Clear_Count){var clear_count=this.m_main_task.mission_clear_count;clear_count>this.m_main_task.task.accum_win_count&&(clear_count=this.m_main_task.task.accum_win_count),content=this.m_main_task.task.content+"  ("+clear_count+"/"+this.m_main_task.task.accum_win_count+")"}else content=this.m_main_task.task.content;var task_content=cmLabel.getLabel(content,LABEL_FONT_INDEX.FONT_161);task_content.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),task_content.setPosition(58,16),this.addChild(task_content);var icon_box=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");icon_box.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),icon_box.setPosition(size.width-4,.5*size.height),this.addChild(icon_box);var icon_name="";if(this.m_main_task.bonus_type==BONUS_TYPE_YUNHEE_FIX||this.m_main_task.bonus_type==BONUS_TYPE_JIN_FIX){var gnrl=MasterManager.getInstance().get_General(this.m_main_task.bonus_value);gnrl.gnrl_type==GENERAL_TYPE_MATERIAL||gnrl.gnrl_type==GENERAL_TYPE_EVOLVE_MATERIAL?USE_SP_TUMB_SCALE&&(icon_name=this.m_main_task.bonus_type==BONUS_TYPE_YUNHEE_FIX?RES_CDN_CARD_MEDIUM_NTP+"m_"+gnrl.bone_id+".png":RES_CDN_CARD_MEDIUM_NTP+gnrl.bone_id+".png"):USE_SP_TUMB_SCALE&&(icon_name=this.m_main_task.bonus_type==BONUS_TYPE_YUNHEE_FIX?RES_CDN_CARD_MEDIUM_NTP+"m_"+gnrl.gnrl_id+".png":RES_CDN_CARD_MEDIUM_NTP+gnrl.gnrl_id+".png")}else icon_name=this.m_main_task.bonus_type==BONUS_TYPE_LOVE_ITEM?"#img_reward_love_item_"+leadingZeros(this.m_main_task.bonus_value,2)+".png":this.m_main_task.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||this.m_main_task.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT?"#img_reward_yh.png":"#img_reward_"+leadingZeros(this.m_main_task.bonus_type,2)+".png";if(""!=icon_name){var reward_icon=cc.Sprite.create(icon_name);reward_icon.setAnchorPoint(ANCHOR_MIDDLE()),reward_icon.setPosition(ccCenter(icon_box)),this.m_main_task.bonus_type==BONUS_TYPE_YUNHEE_FIX&&(DISABLE_SPB_TP&&reward_icon.setContentSize(49,49),reward_icon.setScale(DEF_TUMB_SCALE)),icon_box.addChild(reward_icon),cc.log("ccWidth(reward_icon)"+ccWidth(reward_icon));var count_bg=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_valuebox.png");count_bg.setAnchorPoint(ANCHOR_MIDDLE()),count_bg.setPosition(.5*ccWidth(reward_icon),2),this.m_main_task.bonus_type==BONUS_TYPE_YUNHEE_FIX&&count_bg.setScale(IS_SP_BROWSER?.77:1.5),reward_icon.addChild(count_bg);var count=0;count=this.m_main_task.bonus_type==BONUS_TYPE_LOVE_ITEM?1:this.m_main_task.bonus_type==BONUS_TYPE_YUNHEE_FIX||this.m_main_task.bonus_type==BONUS_TYPE_JIN_FIX?1:this.m_main_task.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||this.m_main_task.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT?1:this.m_main_task.bonus_value;var reward_count=cmLabel.getLabel("x"+Number(count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_143);reward_count.setAnchorPoint(ANCHOR_MIDDLE()),reward_count.setPosition(ccCenter(count_bg)),count_bg.addChild(reward_count)}if(this.m_main_task.is_cleared){var cover=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",cc.Rect(1,1,1,1));cover.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),cover.setPosition(ZERO()),cover.setPreferredSize(size),this.addChild(cover),(flower=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_on.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),flower.setPosition(14,39),this.addChild(flower);var complete=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_complete.png");complete.setAnchorPoint(ANCHOR_MIDDLE()),complete.setPosition(ccCenter(size)),USE_SP_STORY_SCALE&&complete.setScale(2),this.addChild(complete)}else{var flower;(flower=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_off.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),flower.setPosition(14,39),this.addChild(flower)}}}),MissionPreviewPopup=cc.Layer.extend({m_main_mission:null,m_main_mission_id:0,ctor:function(main_mission_id){this._super(),this.m_main_mission={main_mission_id:0,stage_count:0,current_stage:1,victory_count:0,complete_yn:"n",new_yn:"y",mission:{},task_list:[],stage_npc:Map,drop_gnrl_list:[]},this.m_main_mission.task_list=[],this.m_main_mission_id=main_mission_id,this.initLayout()},initLayout:function(){var bg_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());bg_mask.setPosition(ccCenter(this)),bg_mask.setContentSize(ccSize(this)),this.addChild(bg_mask);var service=BattleService.getInstance();MasterTable.getInstance();this.m_gain_item_list=[],this.m_gain_item_list=service.getMasterMissionBonusList(this.m_main_mission_id),service.getMainMissionAndNpc(this.m_main_mission_id,this.m_main_mission);for(var list=this.m_main_mission.stage_npc.at(3),idx=0;idx<list.length;idx++)if(list[idx].is_zoom){var path="";path=list[idx].general.gnrl_group<100?RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(list[idx].general.gnrl_group,2)+".png":RES_CDN_DEFULT+"card_war_boss/"+list[idx].general.gnrl_group+".png";var card_body=cc.Sprite.create(path);card_body.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),card_body.setPosition(ccWidth(this)+ccWidth(card_body),0),card_body.setScale(2),this.addChild(card_body);var scaleTo_1=new cc.ScaleTo(.7,2,2.01),scaleTo_2=new cc.ScaleTo(.7,2,1.99),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);card_body.runAction(repeat);var move=new cc.MoveTo(.2,cc.p(1136,0));card_body.runAction(move);break}var mask_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal_4.png",RectZero());mask_bg.setContentSize(644,640),mask_bg.setAnchorPoint(ZERO()),mask_bg.setPosition(LP(this,300,0)),this.addChild(mask_bg);var left_box_layer=this.getLeftBoxLayer();left_box_layer.setPosition(LP(this,1,0)),this.addChild(left_box_layer);var right_box_layer=this.getRightBoxLayer();right_box_layer.setPosition(LP(this,479,0)),this.addChild(right_box_layer);var cloud_img=cc.Sprite.create(RES_CDN_DEFULT+"common/img_state_cloud.png");cloud_img.setAnchorPoint(ANCHOR_TOP_RIGHT()),cloud_img.setPosition(ccWidth(this),ccHeight(this)),this.addChild(cloud_img);var back_btn=new ccui.Button;back_btn.loadTextures("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE),back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(this)-10,ccHeight(this)-10),back_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_preview_mission_hide)}),this.addChild(back_btn)},getLeftBoxLayer:function(){var layer=new cc.Layer,bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));bg_box.setContentSize(478,568),bg_box.setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),layer.addChild(bg_box),layer.setContentSize(ccSize(bg_box));var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");navi.setAnchorPoint(ZERO()),navi.setPosition(8,509),bg_box.addChild(navi);var task_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_261);task_title.setPosition(ccCenter(navi).x,16),task_title.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),navi.addChild(task_title);for(var i=0;i<this.m_main_mission.task_list.length;i++){var task_data=this.m_main_mission.task_list[i];task_data.mission_clear_count=this.m_main_mission.victory_count;var task=new MissionPreviewTask(task_data);task.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),task.setPosition(17,418-i*ccHeight(task)),bg_box.addChild(task)}var lotus_info=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_text.png");lotus_info.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),lotus_info.setPosition(22,80),USE_SP_STORY_SCALE&&lotus_info.setScale(2),bg_box.addChild(lotus_info);var task_info=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_text_2.png");return task_info.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),task_info.setPosition(11,27),USE_SP_STORY_SCALE&&task_info.setScale(2),bg_box.addChild(task_info),layer},getRightBoxLayer:function(){var layer=new cc.Layer;layer.setContentSize(481,568);BattleService.getInstance();var m=MasterTable.getInstance().getMasterTable(),story_name=(m.get_MainStory(this.m_main_mission.mission.main_scene_id,this.m_main_mission.mission.main_story_id),cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_stage_text_"+this.m_main_mission.mission.main_story_id+".png"));story_name.setAnchorPoint(ZERO()),USE_SP_STORY_SCALE&&story_name.setScale(2),story_name.setPosition(19,525),layer.addChild(story_name),this.scheduleOnce(function(float){var mission_name=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_stage_text_door_"+this.m_main_mission.mission.main_mission_num+".png");mission_name.setAnchorPoint(ZERO()),USE_SP_STORY_SCALE?(mission_name.setPosition(story_name.x+2*ccWidth(story_name),story_name.y),mission_name.setScale(2)):mission_name.setPosition(story_name.x+ccWidth(story_name),story_name.y),layer.addChild(mission_name)},.1,"mission_name");var offset_y=482;(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(circle_point),circle_point.setPosition(19,offset_y+8);var diff_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_248);diff_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),diff_title.setPosition(35,offset_y),layer.addChild(diff_title);var diff_info=cmLabel.getLabel(""+this.m_main_mission.mission.difficulty_type+"",LABEL_FONT_INDEX.FONT_241);diff_info.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),diff_info.setPosition(257,offset_y),layer.addChild(diff_info),(line=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT),layer.addChild(line),line.setPosition(19,offset_y-10),offset_y-=53,(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(circle_point),circle_point.setPosition(19,offset_y+8);var exp_title=cmLabel.getLabel(" Exp",LABEL_FONT_INDEX.FONT_248);exp_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),exp_title.setPosition(35,offset_y),layer.addChild(exp_title);var bonus=m.get_MainMissionBonus(this.m_main_mission_id),gain_user_exp=0;if(TutorialContextV2.getInstance().IsCompleteAllTutorial()){var now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),nn=moment(now).valueOf();for(var b in list_Global_Booster_Event_V2){var bt,et;bt=moment(b.begin_dt),et=moment(b.end_dt);var bb=bt.valueOf(),ee=et.valueOf();if(bb<=nn&&nn<=ee&&b.booster_type==BOOSTER_TYPE_V2_STORY&&b.variation_type==BOOSTER_VARIATION_TYPE_V2_GAIN_INC&&(b.item_type==BOOSTER_ITEM_TYPE_V2_USER_EXP||b.item_type==BOOSTER_ITEM_TYPE_V2_REWARD_BONUS_ITEM))if(0==b.value_1){if(0==b.value_2||b.value_2==this.m_main_mission.mission.main_mission_num){gain_user_exp+=bonus.gain_user_exp*b.variation_value/100;break}}else if(0==b.value_2){if(b.value_1==this.m_main_mission.mission.main_story_id){gain_user_exp+=bonus.gain_user_exp*b.variation_value/100;break}}else if(b.value_1==this.m_main_mission.mission.main_story_id&&b.value_2==this.m_main_mission.mission.main_mission_num){gain_user_exp+=bonus.gain_user_exp*b.variation_value/100;break}}}0==gain_user_exp&&(gain_user_exp=bonus.gain_user_exp);var str_exp=""+Number(gain_user_exp).toLocaleString("en"),gain_exp=cmLabel.getLabel(str_exp,LABEL_FONT_INDEX.FONT_2423);gain_exp.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),gain_exp.setPosition(257,offset_y),layer.addChild(gain_exp),(line=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(line),line.setPosition(19,offset_y-10),offset_y-=53,(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(circle_point),circle_point.setPosition(19,offset_y+8);var line,circle_point,appear_gnrl_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_248);appear_gnrl_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),appear_gnrl_title.setPosition(35,offset_y),layer.addChild(appear_gnrl_title),(line=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(line),line.setPosition(19,197),offset_y=162,(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(circle_point),circle_point.setPosition(19,offset_y+8);var bonus_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_248);bonus_title.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bonus_title.setPosition(35,offset_y),layer.addChild(bonus_title);var btn=new LabelButton("btn_03_off.png","btn_03_on.png","",ccui.Widget.PLIST_TEXTURE);btn.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn.setFont(LABEL_FONT_INDEX.FONT_241),btn.setString(""),btn.setPosition(19,16),layer.addChild(btn),btn.addClickEventListener(function(sender){BattleContext._getInstance().setMissionID(this.m_main_mission.mission.main_mission_id),MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_friend_select)}.bind(this)),1011==this.m_main_mission.main_mission_id&&btn.setTutorialTag(TUTORIAL_TAG_PAGE_1_BATTLE_READY);var gnrl_layer=this.getAppearGeneralLayer();gnrl_layer.setPosition(19,212),layer.addChild(gnrl_layer);var reward_bonus_layer=this.getRewardBonusLayer();reward_bonus_layer.setPosition(19,86),layer.addChild(reward_bonus_layer);var campaign=MasterTable.getInstance().get_RewardCampaignUi(CAMPAIGN_DUNGEON_TYPE_STORY,CAMPAIGN_POSITION_TYPE_ENTERANCE_TOP_TEXT);if(null!=campaign.dugeon_type&&0!=campaign.dugeon_type&&(campaign.value>=this.m_main_mission.mission.main_story_id||0==campaign.value)){var icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("common/%s",campaign.image_name));icon.setAnchorPoint(ZERO()),icon.setPosition(27,451),layer.addChild(icon)}return layer},getAppearGeneralLayer:function(){var layer=new cc.Layer,list=this.m_main_mission.stage_npc.at(3),pos=[];pos.push(cc.p(0,41)),pos.push(cc.p(72,77)),pos.push(cc.p(72,5)),pos.push(cc.p(144,77)),pos.push(cc.p(144,5));for(var idx=0;idx<list.length;idx++){var npc=new NpcInfoItemNode(CARD_TYPE.type_card_thumb);npc.setGeneralData(list[idx].general,list[idx].is_zoom);var p=list[idx].position-1;npc.setPosition(pos[p]),npc.setGlobalZOrderTooltip(!0),layer.addChild(npc)}return layer},getRewardBonusLayer:function(){for(var layer=new cc.Layer,index=0,width=0,idx=0;idx<this.m_gain_item_list.length;idx++){var item_layer=new MissionPreviewBonusItemCell;item_layer.setGainItem(this.m_gain_item_list[idx]),item_layer.setEnableToolTip(!0),layer.addChild(item_layer),cc.log(ccWidth(item_layer)),item_layer.setAnchorPoint(ZERO()),item_layer.setPosition(index*(ccWidth(item_layer)+4),0),index++,width+=ccWidth(item_layer)}return layer.setContentSize(width,68),layer}}),StorySelectionItemNode=cc.Layer.extend({m_lotus_imgs:null,m_gain_item_list:null,_callback:null,m_mission:null,m_gnrl_body:null,m_title_img:null,m_bottom_img:null,m_focus_skeleteon:null,m_bonus_box_layer:null,m_btn_entrance:null,ctor:function(mission,callback){this._super(mission),this.m_mission=$.extend({},mission),this._callback=callback,this.init()},init:function(){this.setContentSize(320,585),this.m_gain_item_list=BattleService.getInstance().getMasterMissionBonusList(this.m_mission.mission.main_mission_id),this.m_bottom_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_normal_large_off.png"),this.m_bottom_img.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bottom_img.setPosition(ccCenter(this).x,193),USE_SP_STORY_SCALE&&this.m_bottom_img.setScale(2),this.addChild(this.m_bottom_img),this.m_focus_skeleteon=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Story.json",RES_CDN_DEFULT+"effect/Story.atlas",1.9),this.m_focus_skeleteon.setPosition(161,237),this.addChild(this.m_focus_skeleteon),this.m_focus_skeleteon.setAnimation(0,"fx_1",!0),this.m_focus_skeleteon.setVisible(!1),this.m_gnrl_body=this.getGeneralBody(),this.m_gnrl_body.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_gnrl_body.setPosition(ccCenter(this).x,229),this.addChild(this.m_gnrl_body);var scaleTo_1=new cc.ScaleTo(.7,1,1.01),scaleTo_2=new cc.ScaleTo(.7,1,.99),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);this.m_gnrl_body.runAction(repeat),this.m_title_img=cc.Sprite.create(),this.m_title_img.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_title_img.setPosition(ccCenter(this).x,495),USE_SP_STORY_SCALE&&this.m_title_img.setScale(2),this.addChild(this.m_title_img),1==this.m_mission.mission.difficulty_type&&this.m_title_img.setTexture(RES_CDN_DEFULT+"menu_quest/img_story_door_1.png"),2==this.m_mission.mission.difficulty_type&&this.m_title_img.setTexture(RES_CDN_DEFULT+"menu_quest/img_story_door_2.png"),3==this.m_mission.mission.difficulty_type&&this.m_title_img.setTexture(RES_CDN_DEFULT+"menu_quest/img_story_door_3.png"),this.m_lotus_imgs=[];for(var i=0;i<3;++i){var lotus_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_2_off.png");lotus_bg.setAnchorPoint(ZERO()),USE_SP_STORY_SCALE&&lotus_bg.setScale(2),this.addChild(lotus_bg),this.m_lotus_imgs[i]=lotus_bg,0==i&&lotus_bg.setPosition(79,189),1==i&&lotus_bg.setPosition(133,179),2==i&&lotus_bg.setPosition(187,189)}var index=0;for(i=0;i<this.m_mission.task_list.length;i++){this.m_mission.task_list[i].is_cleared&&(this.m_lotus_imgs[index].setTexture(RES_CDN_DEFULT+"menu_quest/img_story_sakura_2_on.png"),index++)}this.m_bonus_box_layer=this.getBonusBoxLayer(),this.m_bonus_box_layer.ignoreAnchorPointForPosition(!1),this.m_bonus_box_layer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),USE_SP_STORY_SCALE?this.m_bonus_box_layer.setPosition(ccCenter(this).x-80,55):this.m_bonus_box_layer.setPosition(ccCenter(this).x,55),this.addChild(this.m_bonus_box_layer),this.m_btn_entrance=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_btn_entrance.setFont(LABEL_FONT_INDEX.FONT_241),this.m_btn_entrance.setString(""),this.m_btn_entrance.setOffsetX(-50),this.m_btn_entrance.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_btn_entrance.setPosition(ccCenter(this).x,0),this.addChild(this.m_btn_entrance),this.m_btn_entrance.addClickEventListener(function(sender){null!=this._callback&&this._callback(this.m_mission)}.bind(this));var campaign=MasterTable.getInstance().get_RewardCampaignUi(CAMPAIGN_DUNGEON_TYPE_STORY,CAMPAIGN_POSITION_TYPE_STORY_MISSION_PREVIEW);if(null!=campaign.dugeon_type&&0!=campaign.dugeon_type&&(campaign.value>=this.m_mission.mission.main_story_id||0==campaign.value)){var icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("common/%s",campaign.image_name));icon.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),icon.setPosition(ccCenter(this.m_btn_entrance).x,43),this.m_btn_entrance.addChild(icon,1)}1011==this.m_mission.main_mission_id&&this.m_btn_entrance.setTutorialTag(TUTORIAL_TAG_PAGE_1_CHOIDE_DIFFICULTY_TYPE);var key_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero());key_box.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),key_box.setContentSize(66,38),key_box.setPosition(119,ccCenter(this.m_btn_entrance).y),this.m_btn_entrance.addChild(key_box);var key_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_ic_key.png");key_icon.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),key_icon.setPosition(104,ccCenter(this.m_btn_entrance).y),this.m_btn_entrance.addChild(key_icon);var need_key=this.checkNeedKeyMission(0),need_key_label=cmLabel.getLabel(need_key,LABEL_FONT_INDEX.FONT_2011);return need_key_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),need_key_label.setPosition(ccWidth(key_box)-10,ccCenter(key_box).y),key_box.addChild(need_key_label),!0},setDifficultyEnable:function(is_enable){if(!is_enable){this.m_gnrl_body.setColor(cc.color(50,50,50));var btn_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());btn_mask.setContentSize(ccSize(this.m_btn_entrance)),btn_mask.setAnchorPoint(ZERO()),btn_mask.setPosition(ZERO()),this.m_btn_entrance.addChild(btn_mask),this.m_btn_entrance.setEnabled(!1);for(var idx=0;idx<this.m_lotus_imgs.length;idx++);1==this.m_mission.mission.difficulty_type&&this.m_title_img.setTexture(RES_CDN_DEFULT+"menu_quest/img_story_door_1_black.png"),2==this.m_mission.mission.difficulty_type&&this.m_title_img.setTexture(RES_CDN_DEFULT+"menu_quest/img_story_door_2_black.png"),3==this.m_mission.mission.difficulty_type&&this.m_title_img.setTexture(RES_CDN_DEFULT+"menu_quest/img_story_door_3_black.png"),this.m_bottom_img.setTexture(RES_CDN_DEFULT+"menu_quest/img_story_normal_large_black.png");var bonus_mask=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_reward_box_black.png");bonus_mask.setAnchorPoint(ZERO()),bonus_mask.setPosition(ZERO()),USE_SP_STORY_SCALE&&bonus_mask.setScale(2),this.m_bonus_box_layer.addChild(bonus_mask);var lock_img=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_lock.png");lock_img.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),lock_img.setPosition(ccCenter(this).x,250),USE_SP_STORY_SCALE&&lock_img.setScale(2),this.addChild(lock_img)}},setIsClear:function(){},setIsNew:function(){var newIcon=cc.Sprite.create();if(newIcon.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),newIcon.setPosition(ccCenter(this).x,460),this.addChild(newIcon),NOT_USE_SP_MAIN_ANIMATION){newIcon.setScale(2),newIcon.setTexture(RES_CDN_DEFULT+"uieffect_2/uieffect_sprite/effect_new_01.png");var scaleTo_1=new cc.ScaleTo(.3,2,2.03),scaleTo_2=new cc.ScaleTo(.3,2,1.97),sequence=new cc.Sequence(scaleTo_1,scaleTo_2);repeat=new cc.RepeatForever(sequence);newIcon.runAction(repeat),repeat=sequence=scaleTo_2=scaleTo_1=null}else{var animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.StoryNewIcon),repeat=new cc.RepeatForever(animate);newIcon.runAction(repeat)}this.m_focus_skeleteon.setVisible(!0)},checkNeedKeyMission:function(need_key){need_key=0;var is_expense_dec=!1;if(TutorialContextV2.getInstance().IsCompleteAllTutorial()){var nn=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf();for(var b in NetService().list_Global_Booster_Event_V2){var bt=moment(b.begin_dt),et=moment(b.end_dt),bb=bt.valueOf(),ee=et.valueOf();if(bb<=nn&&nn<=ee&&b.booster_type==BOOSTER_TYPE_V2_STORY&&b.variation_type==BOOSTER_VARIATION_TYPE_V2_EXPENSE_DEC&&b.item_type==BOOSTER_ITEM_TYPE_V2_ENTRANCE_TICKET){if(0==b.value_1){need_key=this.m_mission.mission.need_key-this.m_mission.mission.need_key*b.variation_value/100,is_expense_dec=!0;break}if(0==b.value_2){if(b.value_1==this.m_mission.mission.main_story_id){need_key=this.m_mission.mission.need_key-this.m_mission.mission.need_key*b.variation_value/100,is_expense_dec=!0;break}}else if(b.value_1==this.m_mission.mission.main_story_id&&b.value_2==this.m_mission.mission.main_mission_num){need_key=this.m_mission.mission.need_key-this.m_mission.mission.need_key*b.variation_value/100,is_expense_dec=!0;break}}}is_expense_dec&&(need_key=Math.max(need_key,1))}if(0==MasterManager.getInstance().get_TimeFunction(9).value){var user_service=UserService.getInstance();if(user_service.isBeginnerBooster()){var mt_booster=[];0<(mt_booster=user_service.getMtBeginnerBooster(BEGINNER_BOOSTER_TYPE_CONSUME_DECREASE,0,CONSUME_DECREASE_KEY,mt_booster)).value&&(mt_booster.battle_type==BATTLE_DUNGEON_TYPE_STORY||mt_booster.battle_type==BATTLE_DUNGEON_TYPE_ALL)&&(need_key=Math.floor(this.m_mission.mission.need_key-this.m_mission.mission.need_key*mt_booster.value/1e4),need_key=Math.max(need_key,1))}}return 0==need_key&&(need_key=this.m_mission.mission.need_key),need_key},getBonusBoxLayer:function(){var layer=new cc.Layer,bg_box=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_reward_box.png");bg_box.setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),USE_SP_STORY_SCALE&&bg_box.setScale(2),layer.addChild(bg_box),layer.setContentSize(ccSize(bg_box));for(var index=0,idx=0;idx<this.m_gain_item_list.length;idx++){var item_layer=new MissionPreviewBonusItemCell;item_layer.setGainItem(this.m_gain_item_list[idx]),item_layer.setEnableToolTip(!0,!0),layer.addChild(item_layer),item_layer.setAnchorPoint(ZERO()),item_layer.setPosition(24+index*ccWidth(item_layer),18),index++}return layer},getGeneralBody:function(){var mt=MasterManager.getInstance();for(var npc in this.m_mission.stage_npc)if(3==npc){var npc_list=this.m_mission.stage_npc[npc];for(var g in npc_list)if(npc_list[g].is_zoom){npc=mt.get_NpcGeneral(npc_list[g].npc_id);var general=mt.get_General(npc.gnrl_id);return cc.Sprite.create(RES_CDN_DEFULT+"card_story_boss/"+leadingZeros(general.gnrl_group,2)+".png")}}return null}}),StorySelectionPopup=cc.Layer.extend({m_gameObserver:null,ctor:function(mission){this._super(),this.init(mission)},init:function(mission){this.m_gameObserver=MainObserver.getInstance(),this.m_mission=mission;var mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());mask.setAnchorPoint(ZERO()),mask.setPosition(ZERO()),mask.setContentSize(ccSize(this)),this.addChild(mask),this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var left_top_cloud=cc.Sprite.create(RES_CDN_DEFULT+"common/img_cloud_top.png");left_top_cloud.setAnchorPoint(ANCHOR_TOP_LEFT()),left_top_cloud.setPosition(0,ccHeight(this)),this.addChild(left_top_cloud);var left_bottom_cloud=cc.Sprite.create(RES_CDN_DEFULT+"common/img_cloud_bottom.png");left_bottom_cloud.setAnchorPoint(ZERO()),left_bottom_cloud.setPosition(ZERO()),this.addChild(left_bottom_cloud);var right_top_cloud=cc.Sprite.create(RES_CDN_DEFULT+"common/img_cloud_top.png");right_top_cloud.setAnchorPoint(ANCHOR_TOP_RIGHT()),right_top_cloud.setPosition(ccWidth(this),ccHeight(this)),this.addChild(right_top_cloud),right_top_cloud.setFlippedX(!0);var right_bottom_cloud=cc.Sprite.create(RES_CDN_DEFULT+"common/img_cloud_bottom.png");right_bottom_cloud.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),right_bottom_cloud.setPosition(ccWidth(this),0),this.addChild(right_bottom_cloud),right_bottom_cloud.setFlippedX(!0),USE_SP_STORY_SCALE&&(left_top_cloud.setScale(2),left_bottom_cloud.setScale(2),right_top_cloud.setScale(2),right_bottom_cloud.setScale(2));var cloud_img=cc.Sprite.create(RES_CDN_DEFULT+"common/img_state_cloud.png");cloud_img.setAnchorPoint(ANCHOR_TOP_RIGHT()),cloud_img.setPosition(ccWidth(this),ccHeight(this)),this.addChild(cloud_img);var back_btn=new ccui.Button;back_btn.loadTextures("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE),back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(this)-10,ccHeight(this)-10),back_btn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_StorySceneV2],story_choice_difficulty_type_hide)}.bind(this)),this.addChild(back_btn);for(var i=0;i<this.m_mission.difficulty_mission.length;i++){var m=this.m_mission.difficulty_mission[i],item=new StorySelectionItemNode(m,this.choiceMissionStage);if(item.setPosition(LP(this,i*ccWidth(item),27.5)),this.addChild(item),0<i)"y"==this.m_mission.difficulty_mission[i-1].complete_yn?(item.setDifficultyEnable(!0),"y"!=m.complete_yn&&item.setIsNew()):item.setDifficultyEnable(!1);else 0==i&&(item.setDifficultyEnable(!0),"y"!=m.complete_yn&&item.setIsNew());item=null}return!0},onEnter:function(){this._super();var context=BattleContext._getInstance();context.IsNextMissionPopup()&&(context.showNextMissionPopup(!1),MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_preview_mission_show))},onExit:function(){this.m_mission=null},choiceMissionStage:function(mission){var context=BattleContext._getInstance();context.setGameType(db.BattleGameType.Mission),context.setMissionID(mission.main_mission_id),MainObserver.getInstance().postNotification(sceneStr[scene_StorySceneV2],story_preview_mission_show)}}),LotusBonusBox=cc.Layer.extend({m_bonus:null,_close_callback:null,ctor:function(bonus,callback,target){this._super(),this.m_bonus=bonus,this._close_callback=callback.bind(target),this.initLayout(bonus,callback)},initLayout:function(){var winSize=cc.director.getWinSize(),boxSize=cc.size(630,370),box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",RectZero());box.setAnchorPoint(ANCHOR_MIDDLE()),box.setPreferredSize(boxSize),box.setPosition(ccCenter(winSize)),this.addChild(box);var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_3.png");navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(.5*boxSize.width,boxSize.height-11),box.addChild(navi);var nSize=ccSize(navi),title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_301);title.setAnchorPoint(ANCHOR_MIDDLE()),title.setPosition(.5*nSize.width,.5*nSize.height+2),navi.addChild(title);var icon_name,icon_box=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");switch(icon_box.setAnchorPoint(ANCHOR_MIDDLE()),icon_box.setPosition(.5*boxSize.width,250),box.addChild(icon_box),this.m_bonus.main_story_lotus.bonus_type){case BONUS_TYPE_GOLD:case BONUS_TYPE_KEY:case BONUS_TYPE_HEART:case BONUS_TYPE_JADE:icon_name="#img_reward_"+leadingZeros(this.m_bonus.main_story_lotus.bonus_type,2)+".png";break;case BONUS_TYPE_HN_RARE_TYPE_ENGAGE:icon_name="#img_reward_yh.png";break;case BONUS_TYPE_YUNHEE_FIX:case BONUS_TYPE_JIN_FIX:case BONUS_TYPE_WIE_CHOCK_OH_SELECT:icon_name="#img_reward_yh.png";break;case BONUS_TYPE_HWANDAN_1:case BONUS_TYPE_HWANDAN_2:case BONUS_TYPE_HWANDAN_3:case BONUS_TYPE_HWANDAN_4:case BONUS_TYPE_HWANDAN_5:icon_name="#img_reward_"+leadingZeros(this.m_bonus.main_story_lotus.bonus_type,2)+".png";break;case BONUS_TYPE_LOVE_ITEM:icon_name="#img_reward_love_item_"+leadingZeros(this.m_bonus.main_story_lotus.bonus_type,2)+".png"}var icon=cc.Sprite.create(icon_name);icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition(ccCenter(icon_box)),icon_box.addChild(icon);var t=MasterManager.getInstance().get_BonusType(this.m_bonus.main_story_lotus.bonus_type),bonus_str="";if(t.bonus_type==BONUS_TYPE_LOVE_ITEM||t.bonus_type==BONUS_TYPE_HN_RARE_TYPE_ENGAGE||t.bonus_type==BONUS_TYPE_WIE_CHOCK_OH_SELECT)bonus_str=t.name+" x1";else if(t.bonus_type==BONUS_TYPE_JIN_FIX||t.bonus_type==BONUS_TYPE_YUNHEE_FIX){bonus_str=MasterManager.getInstance().get_General(this.m_bonus.main_story_lotus.bonus_count).name+" x1"}else bonus_str=t.name+" x"+this.m_bonus.main_story_lotus.bonus_count;var bonus_name=cmLabel.getLabel(bonus_str,LABEL_FONT_INDEX.FONT_262);bonus_name.setAnchorPoint(ANCHOR_MIDDLE()),bonus_name.setPosition(.5*boxSize.width,190),box.addChild(bonus_name);var comment=cmLabel.getLabel(" "+this.m_bonus.main_story_lotus.lotus_count+"\n",LABEL_FONT_INDEX.FONT_241);comment.setAnchorPoint(ANCHOR_MIDDLE()),comment.setPosition(.5*boxSize.width,135),box.addChild(comment);var close=new LabelButton("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);close.setFont(LABEL_FONT_INDEX.FONT_241),close.setString(""),close.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),close.setPosition(.5*boxSize.width,16),box.addChild(close),close.addClickEventListener(function(sender){null!=this._close_callback&&this._close_callback()}.bind(this))}}),eDungeonTaskType={none:0,weekly_dungeon:1,event_dungeon:2},MissionTaskPopup=cc.Layer.extend({m_mission_id:0,_callback_close_popup:null,m_task_type:eDungeonTaskType.none,m_gain_item_list:[],m_weekly_dungeon_task_list:[],m_event_dungeon_task_list:[],ctor:function(task_list,task_type){this._super(),task_type==eDungeonTaskType.weekly_dungeon?this.init_WeeklyDungeonTask(task_list,task_type):task_type==eDungeonTaskType.event_dungeon&&this.init_EventDungeonTask(task_list,task_type)},init_WeeklyDungeonTask:function(task_list,task_type){return this.m_weekly_dungeon_task_list.clear(),this.m_weekly_dungeon_task_list=task_list,this.m_task_type=task_type,this.initLayout(),!0},init_EventDungeonTask:function(task_list,task_type){return this.m_event_dungeon_task_list.clear(),this.m_event_dungeon_task_list=task_list,this.m_task_type=task_type,this.initLayout(),!0},initLayout:function(){var bg_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());bg_mask.setPosition(ccCenter(this)),bg_mask.setContentSize(ccSize(this)),this.addChild(bg_mask),this.m_gain_item_list.clear();var mask_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal_4.png",RectZero());mask_bg.setContentSize(644,640),mask_bg.setAnchorPoint(ZERO()),mask_bg.setPosition(LP(this,300,0)),this.addChild(mask_bg);var left_box_layer=this.getLeftBoxLayer();left_box_layer.ignoreAnchorPointForPosition(!1),left_box_layer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),left_box_layer.setPosition(ccCenter(this).x,0),this.addChild(left_box_layer)},getLeftBoxLayer:function(){var layer=new cc.Layer,bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));bg_box.setContentSize(478,568),bg_box.setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),layer.addChild(bg_box),layer.setContentSize(ccSize(bg_box));var navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");navi.setAnchorPoint(ZERO()),navi.setPosition(8,509),bg_box.addChild(navi);var task_title=cmLabel.getLabel(res_str("label_task_title"),LABEL_FONT_INDEX.FONT_261);if(task_title.setPosition(ccCenter(navi).x,16),task_title.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),navi.addChild(task_title),this.m_task_type==eDungeonTaskType.weekly_dungeon)for(var i=0;i<this.m_weekly_dungeon_task_list.length;i++){var task_data=this.m_weekly_dungeon_task_list[i];(task=new WeeklyTaskNode(task_data)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),task.setPosition(17,418-i*ccHeight(task)),bg_box.addChild(task)}else if(this.m_task_type==eDungeonTaskType.event_dungeon)for(i=0;i<this.m_event_dungeon_task_list.size();i++){var task;task_data=this.m_event_dungeon_task_list[i];(task=new EventDungeonTaskNode(task_data)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),task.setPosition(17,418-i*ccHeight(task)),bg_box.addChild(task)}var lotus_info=cc.Sprite.create(RES_CDN_DEFULT+"menu_quest/img_story_sakura_text_2.png");lotus_info.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),lotus_info.setPosition(ccCenter(bg_box).x,20),USE_SP_STORY_SCALE&&lotus_info.setScale(2),bg_box.addChild(lotus_info);var close_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);return close_btn.setAnchorPoint(ZERO()),close_btn.setPosition(ccWidth(navi)-ccWidth(close_btn)-11,7),close_btn.addClickEventListener(function(sender){null!=this._callback_close_popup&&this._callback_close_popup()}.bind(this)),navi.addChild(close_btn),layer},onEnter:function(){this._super()},onExit:function(){this._super()}}),DailyDungeonListCell=cc.TableViewCell.extend({m_select_box:null,m_highlight:null,m_disable_cover:null,m_dungeon_name:null,m_cell_bg:null,ctor:function(){this._super(),this.init()},init:function(){var cellSize=cc.size(444,140);this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(cellSize),USE_SP_DAILY_SCALE?(this.m_cell_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_01.png"),this.m_cell_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_cell_bg.setPosition(ccCenter(cellSize)),this.m_cell_bg.setContentSize(444,140),this.m_cell_bg.setScale(2),this.addChild(this.m_cell_bg),this.m_dungeon_name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2615),this.m_dungeon_name.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_dungeon_name.setPosition(cellSize.width-10,20),this.addChild(this.m_dungeon_name)):(this.m_cell_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_01.png"),this.m_cell_bg.setAnchorPoint(ANCHOR_MIDDLE()),this.m_cell_bg.setPosition(ccCenter(cellSize)),this.addChild(this.m_cell_bg),this.m_dungeon_name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2615),this.m_dungeon_name.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_dungeon_name.setPosition(cellSize.width-10,20),this.m_cell_bg.addChild(this.m_dungeon_name)),this.m_disable_cover=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero()),this.m_disable_cover.setAnchorPoint(ANCHOR_MIDDLE()),this.m_disable_cover.setPosition(ccCenter(cellSize)),this.m_disable_cover.setPreferredSize(cellSize),this.addChild(this.m_disable_cover),this.m_disable_cover.setVisible(!1);var lock=cc.Sprite.create(RES_CDN_DEFULT+"common/img_list_lock.png");return IS_SP_BROWSER&&lock.setScale(2),lock.setAnchorPoint(ANCHOR_MIDDLE()),lock.setPosition(ccCenter(this.m_disable_cover)),this.m_disable_cover.addChild(lock),this.m_highlight=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_1.png",cc.Rect(20,20,20,20)),this.m_highlight.setAnchorPoint(ANCHOR_MIDDLE()),this.m_highlight.setPosition(ccCenter(cellSize)),this.m_highlight.setPreferredSize(ccSize(this.m_cell_bg)),this.m_highlight.setVisible(!1),this.addChild(this.m_highlight),this.m_select_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_2.png",cc.rect(20,20,20,20)),this.m_select_box.setAnchorPoint(ANCHOR_MIDDLE()),this.m_select_box.setPosition(ccCenter(cellSize)),this.m_select_box.setPreferredSize(ccSize(this.m_cell_bg)),this.m_select_box.setVisible(!1),this.addChild(this.m_select_box),!0},setData:function(data){this.m_data=data,this.updateCell()},updateCell:function(){ccSize(this);var sd_img=RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_"+leadingZeros(this.m_data.daily_dungeon.bg_type,2)+".png",frame3_texture=cc.textureCache.addImage(sd_img),frame3=new cc.SpriteFrame(frame3_texture,cc.rect(0,0,frame3_texture.getContentSize().width,frame3_texture.getContentSize().height));if(this.m_cell_bg.setSpriteFrame(frame3),this.m_dungeon_name.setString(this.m_data.daily_dungeon.name),this.m_select_box.setVisible(this.m_data.is_selected),this.m_highlight.setVisible(this.m_data.is_selected),this.m_data.is_selected&&this.selectedAnimation(),this.m_data.is_open_pre_daily_dungeon){var n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),b=moment(this.m_data.daily_dungeon_period.begin_date).valueOf(),e=moment(this.m_data.daily_dungeon_period.end_date).valueOf();b<=n?n<=e&&(this.m_data.is_enable=!0):this.m_data.is_enable=!1,this.m_disable_cover.setVisible(!this.m_data.is_enable)}else this.m_disable_cover.setVisible(!0)},selectedAnimation:function(){this.m_select_box.isRunning()&&this.m_select_box.stopAllActions();var fadeout=new cc.FadeOut(1),fadein=new cc.FadeIn(1),seq=new cc.Sequence(fadeout,fadein),repeat=new cc.RepeatForever(seq);this.m_select_box.runAction(repeat)},unSelected:function(){this.m_select_box.setVisible(!1),this.m_highlight.setVisible(!1)}}),daily_dungeon_battle_ready=8e4,daily_dungeon_invalid_entrance_time=80001,daily_dungeon_disable_pre_open_dungeon=80002,daily_dungeon_entrance_limit_over=80003,DailyDungeonListLayer=cc.Layer.extend({m_table_view:null,m_gnrl_body:null,m_content_label:null,m_boss_container:null,m_left_layer:null,m_right_layer:null,m_difficulty_name:null,m_spend_label:null,m_reward_item:null,m_daily_dungeon_list:[],m_gnrl_img:null,m_boyd_img_num:42,m_deferred:null,m_multiple_icon:null,ctor:function(deferred){this._super(),this.m_deferred=deferred,this.m_daily_dungeon_list=[],this.init()},onExit:function(){if(this._super(),null!=this.m_gnrl_img){for(var idx=0;idx<this.m_gnrl_img.length;idx++)cc.loader.release(this.m_gnrl_img[idx]);this.m_gnrl_img=null}},init:function(){this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var winSize=ccSize(this);this.m_boss_container=new cc.Node,this.m_boss_container.setPosition(winSize.width,0),this.addChild(this.m_boss_container);var m=MasterTable.getInstance().getMasterTable(),context=BattleContext._getInstance();DailyDungeonTable.getInstance().load_user_daily_dungeon();var daily_dungeon_period_idx=context.getDailyDungeonPeriodIdx();this.m_period=m.get_DailyDungeonPeriod(daily_dungeon_period_idx);var service=DailyDungeonService.getInstance();this.m_daily_dungeon_list=service.getUserDailyDungeonList(daily_dungeon_period_idx);var last_daily_dungeon_idx=context.getLastDailyDungeonId(),last_open_dungeon_idx=0;if(0==last_daily_dungeon_idx){if(0<this.m_daily_dungeon_list.length){for(var i=0;i<this.m_daily_dungeon_list.length;i++){this.m_daily_dungeon_list[i].is_open_pre_daily_dungeon&&(last_open_dungeon_idx=Math.max(i,0))}this.m_daily_dungeon_list[last_open_dungeon_idx].is_selected=!0}}else if(0<this.m_daily_dungeon_list.length){for(i=0;i<this.m_daily_dungeon_list.length;i++){this.m_daily_dungeon_list[i].daily_dungeon.daily_dungeon_idx==last_daily_dungeon_idx&&(last_open_dungeon_idx=Math.max(i,0))}this.m_daily_dungeon_list[last_open_dungeon_idx].is_selected=!0}this.m_gnrl_img=[],this.m_gnrl_img.push(RES_CDN_DEFULT+"card_war_boss/42.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_text_title_01.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"common/img_circle.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"common/img_line.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_text_sub.png");for(var idx=1;idx<6;idx++)this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_text_title_0"+idx+".png");var dungeon=this.getSelectedDungeon();if(0!=dungeon.stage_npc.size())for(idx=0;idx<dungeon.stage_npc.at(1).length;idx++){var npc_list=dungeon.stage_npc.at(1);npc_list[idx].is_zoom&&(npc_list[idx].general.gnrl_group<100?this.m_gnrl_img.push(RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(npc_list[idx].general.gnrl_group,2)+".png"):this.m_gnrl_img.push(RES_CDN_DEFULT+"card_war_boss/"+npc_list[idx].general.gnrl_group+".png"),this.m_boyd_img_num=npc_list[idx].general.gnrl_group)}return cc.loader.load(this.m_gnrl_img,function(err,results){err||this.start_init()}.bind(this)),!0},start_init:function(){this.m_boyd_img_num<100?this.m_gnrl_body=cc.Sprite.create(RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(this.m_boyd_img_num,2)+".png"):this.m_gnrl_body=cc.Sprite.create(RES_CDN_DEFULT+"card_war_boss/"+this.m_boyd_img_num+".png"),this.m_gnrl_body.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_gnrl_body.setPosition(ZERO()),this.m_gnrl_body.setVisible(!0),this.m_gnrl_body.setScale(2),this.m_boss_container.addChild(this.m_gnrl_body);var scaleTo_1=new cc.ScaleTo(.7,2,2.01),scaleTo_2=new cc.ScaleTo(.7,2,1.99),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);this.m_gnrl_body.runAction(repeat);var mask_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal_4.png",RectZero());mask_bg.setContentSize(644,640),mask_bg.setAnchorPoint(ZERO()),mask_bg.setPosition(LP(this,300,0)),this.addChild(mask_bg);var leftBoxSize=cc.size(478,468);this.m_left_layer=new cc.Layer,this.m_left_layer.ignoreAnchorPointForPosition(!1),this.m_left_layer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_left_layer.setContentSize(leftBoxSize),this.m_left_layer.setPosition(.5*winSize.width-1,0),this.addChild(this.m_left_layer),this.createLeftBoxLayer(),this.m_right_layer=new cc.Layer,this.m_right_layer.ignoreAnchorPointForPosition(!1),this.m_right_layer.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_right_layer.setPosition(ZERO()),this.addChild(this.m_right_layer),this.createRightBoxLayer(),this.m_table_view.reloadData(),this.updateRightInfo(),this.m_deferred.resolve(!0)},cellSizeForTable:function(table){return cc.size(400,140)},tableCellEnded:function(table){return!0},tableCellHighlight:function(){return!0},tableCellUnhighlight:function(){return!1},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;(cell=null!=c?c:new DailyDungeonListCell).unSelected();var data=this.m_daily_dungeon_list[idx];return cell.setData(data),cell},numberOfCellsInTableView:function(table){return this.m_daily_dungeon_list.length},tableCellTouched:function(table,cell){AudioEngine.getInstance().playNormaButtonSound();for(var idx=cell.getIdx(),i=0;i<this.m_daily_dungeon_list.length;i++)this.m_daily_dungeon_list[i].is_selected=idx==i;var offset=table.getContentOffset();table.reloadData(),table.setContentOffset(offset),this.updateRightInfo()},tableCellSizeForIndex:function(){return cc.size(400,140)},createLeftBoxLayer:function(){var table_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));table_bg.setContentSize(478,568),table_bg.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),table_bg.setPosition(ZERO()),this.m_left_layer.addChild(table_bg);var bgSize=ccSize(table_bg),left_navi=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");left_navi.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),left_navi.setPosition(.5*bgSize.width,509),this.m_left_layer.addChild(left_navi);var naviSize=ccSize(left_navi),navi_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_261);navi_title.setAnchorPoint(ANCHOR_MIDDLE()),navi_title.setPosition(.5*naviSize.width,.5*naviSize.height+3),left_navi.addChild(navi_title);var tableSize=cc.size(444,532-naviSize.height);this.m_table_view=new cc.TableView(this,tableSize),this.m_table_view.ignoreAnchorPointForPosition(!1),this.m_table_view.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_table_view.setVerticalFillOrder(0),this.m_table_view.scrollBarEnable(!0),this.m_table_view.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_table_view.setPosition(17,18),this.m_table_view.setDelegate(this),this.m_left_layer.addChild(this.m_table_view),this.m_table_view.reloadData()},createRightBoxLayer:function(){var layer=new cc.Layer;layer.setContentSize(481,568),layer.setPosition(LP(this,479,0)),this.m_right_layer.addChild(layer);var desc_sprite,line,circle_point,title;this.getSelectedDungeon();(USE_SP_DAILY_SCALE?(this.m_difficulty_name=cc.Sprite.create(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_text_title_01.png"),this.m_difficulty_name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_difficulty_name.setPosition(19,525),this.m_difficulty_name.setScale(2)):(this.m_difficulty_name=cc.Sprite.create(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_text_title_01.png"),this.m_difficulty_name.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_difficulty_name.setPosition(19,525)),layer.addChild(this.m_difficulty_name),(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(circle_point),circle_point.setPosition(19,490),(title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_248)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(35,482),layer.addChild(title),this.m_content_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_201),this.m_content_label.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_content_label.setPosition(35,453),layer.addChild(this.m_content_label),(line=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),line.setPosition(19,443),layer.addChild(line),(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(circle_point),circle_point.setPosition(19,408),(title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_248)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(35,400),layer.addChild(title),USE_SP_DAILY_SCALE)?((desc_sprite=cc.Sprite.create(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_text_sub.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),desc_sprite.setPosition(19,218),desc_sprite.setScale(2),layer.addChild(desc_sprite)):((desc_sprite=cc.Sprite.create(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_text_sub.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),desc_sprite.setPosition(19,218),layer.addChild(desc_sprite));(line=cc.Sprite.create(RES_CDN_DEFULT+"common/img_line.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),line.setPosition(19,197),layer.addChild(line),(circle_point=cc.Sprite.create(RES_CDN_DEFULT+"common/img_circle.png")).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.addChild(circle_point),circle_point.setPosition(19,172),(title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_248)).setAnchorPoint(ANCHOR_BOTTOM_LEFT()),title.setPosition(35,164),layer.addChild(title),this.m_reward_item=new MissionPreviewBonusItemCell,this.m_reward_item.setEnableToolTip(!0),this.m_reward_item.setPosition(19,86),this.m_reward_item.setLocalZOrder(1),layer.addChild(this.m_reward_item),this.m_multiple_icon=cc.Sprite.create(),this.m_multiple_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_multiple_icon.setPosition(111,161),layer.addChild(this.m_multiple_icon),this.m_multiple_icon.setVisible(!1);var s=ccSize(layer),btn=new ccui.Button;btn.loadTextures("btn_03_off.png","btn_03_on.png","btn_03_none.png",ccui.Widget.PLIST_TEXTURE),btn.addClickEventListener(function(sender){this.battleReady()}.bind(this));var start_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_241);start_label.setAnchorPoint(ANCHOR_MIDDLE()),start_label.setPosition(ccCenter(btn).x-50,ccCenter(btn).y),btn.addChild(start_label),btn.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),btn.setPosition(.5*s.width,16),layer.addChild(btn);var icon_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",cc.Rect(10,10,10,10));icon_box.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),icon_box.setPreferredSize(cc.size(66,38)),icon_box.setPosition(.5*btn.width+16,.5*btn.height),btn.addChild(icon_box),cc.log(btn.width),this.m_spend_label=cmLabel.getLabel("0",LABEL_FONT_INDEX.FONT_247),this.m_spend_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_spend_label.setPosition(icon_box.width-10,.5*icon_box.height),icon_box.addChild(this.m_spend_label)},updateRightInfo:function(){MasterTable.getInstance().getMasterTable();var dungeon=this.getSelectedDungeon(),winSize=ccSize(this);if(this.m_difficulty_name.setTexture(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_text_title_"+leadingZeros(dungeon.daily_dungeon.bg_type,2)+".png"),this.m_content_label.setString(dungeon.daily_dungeon.content),this.m_boss_container.isRunning()&&this.m_boss_container.stopAllActions(),0!=dungeon.stage_npc.size())for(var idx=0;idx<dungeon.stage_npc.at(1).length;idx++){var npc_list=dungeon.stage_npc.at(1);if(npc_list[idx].is_zoom){if(npc_list[idx].general.gnrl_group<100){var frame1=new cc.SpriteFrame(RES_CDN_DEFULT+"card_war_boss/"+leadingZeros(npc_list[idx].general.gnrl_group,2)+".png");this.m_gnrl_body.setScale(2),this.m_gnrl_body.setSpriteFrame(frame1)}else{frame1=new cc.SpriteFrame(RES_CDN_DEFULT+"card_war_boss/"+npc_list[idx].general.gnrl_group+".png");this.m_gnrl_body.setScale(2),this.m_gnrl_body.setSpriteFrame(frame1)}this.m_boss_container.setPosition(winSize.width+this.m_gnrl_body.width,0);var move=new cc.MoveTo(.2,cc.p(winSize.width,0));this.m_boss_container.runAction(move);break}}var reward_list=MasterTable.getInstance().get_DailyDungeonBonusItemList(dungeon.daily_dungeon.daily_dungeon_bonus_idx,1),reward_bonus_type=0;if(0<reward_list.length){var bonus=reward_list[0],item={};DailyDungeonService.getInstance().convertBonusInfo(bonus,item),this.m_reward_item.setGainItem(item),reward_bonus_type=bonus.bonus_type}var campaign_list=MasterTable.getInstance().get_RewardCampaignUiList(CAMPAIGN_DUNGEON_TYPE_DAILY);if(0<campaign_list.length){this.m_multiple_icon.setVisible(!1);for(var i=0;i<campaign_list.length;i++){var campaign=campaign_list.at(i);if(0!=campaign.event_type&&campaign.position_type==CAMPAIGN_POSITION_TYPE_ENTERANCE_BOTTOM_REWARD_)if(campaign.event_type==CAMPAIGN_EVENT_TYPE_ALL_GAIN_REWARD_DOUBLE){var img=RES_CDN_DEFULT+cmString("common/%s",campaign.image_name),frame_texture=cc.textureCache.addImage(img);null!=(frame=new cc.SpriteFrame(frame_texture,cc.rect(0,0,frame_texture.getContentSize().width,frame_texture.getContentSize().height)))&&(this.m_multiple_icon.setSpriteFrame(frame),this.m_multiple_icon.setVisible(!0))}else if(campaign.event_type==CAMPAIGN_EVENT_TYPE_DAILY_DUNGEON_ONLY_GOLD){if(reward_bonus_type==BONUS_TYPE_GOLD){img=RES_CDN_DEFULT+cmString("common/%s",campaign.image_name),frame_texture=cc.textureCache.addImage(img);null!=(frame=new cc.SpriteFrame(frame_texture,cc.rect(0,0,frame_texture.getContentSize().width,frame_texture.getContentSize().height)))&&(this.m_multiple_icon.setSpriteFrame(frame),this.m_multiple_icon.setVisible(!0))}}else if(campaign.event_type==CAMPAIGN_EVENT_TYPE_HEART_DOUBLE){if(reward_bonus_type==BONUS_TYPE_HEART){img=RES_CDN_DEFULT+cmString("common/%s",campaign.image_name),frame_texture=cc.textureCache.addImage(img);null!=(frame=new cc.SpriteFrame(frame_texture,cc.rect(0,0,frame_texture.getContentSize().width,frame_texture.getContentSize().height)))&&(this.m_multiple_icon.setSpriteFrame(frame),this.m_multiple_icon.setVisible(!0))}}else if(campaign.event_type==CAMPAIGN_EVENT_TYPE_USER_EXP_DOUBLE&&reward_bonus_type==BONUS_TYPE_USER_EXP){var frame;img=RES_CDN_DEFULT+cmString("common/%s",campaign.image_name),frame_texture=cc.textureCache.addImage(img);null!=(frame=new cc.SpriteFrame(frame_texture,cc.rect(0,0,frame_texture.getContentSize().width,frame_texture.getContentSize().height)))&&(this.m_multiple_icon.setSpriteFrame(frame),this.m_multiple_icon.setVisible(!0))}}}else this.m_multiple_icon.setVisible(!1);var challenge_log={};this.getTodayDailyDungeonPeriod(dungeon.daily_dungeon_period.daily_dungeon_period_idx,challenge_log);var remain_try_count=this.m_period.enable_key_entrance_count-challenge_log.key_cost_challenge_count;remain_try_count<0&&(remain_try_count=0),this.m_spend_label.setString(remain_try_count+"/"+this.m_period.enable_key_entrance_count)},getTodayDailyDungeonPeriod:function(daily_dungeon_period_idx,log){for(var now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),ts=moment(now).format("YYYY-MM-DD"),is_exist=!1,daily_dungeon_open_period=NetService().get_daily_dungeon_open_period_info(),idx=0;idx<daily_dungeon_open_period.daily_dungeon_open_period.length;idx++){var p=daily_dungeon_open_period.daily_dungeon_open_period[idx];if(p.daily_dungeon_period_idx==daily_dungeon_period_idx&&p.challenge_dt==ts){log.daily_dungeon_period_idx=p.daily_dungeon_period_idx,log.challenge_dt=p.challenge_dt,log.key_cost_challenge_count=p.key_cost_challenge_count,log.jade_cost_challenge_count=p.jade_cost_challenge_count,is_exist=!0;break}}is_exist||(log.daily_dungeon_period_idx=daily_dungeon_period_idx,log.challenge_dt=ts,log.key_cost_challenge_count=0,log.jade_cost_challenge_count=0)},battleReady:function(){var dungeon=this.getSelectedDungeon(),challenge_log={};if(this.getTodayDailyDungeonPeriod(dungeon.daily_dungeon_period.daily_dungeon_period_idx,challenge_log),challenge_log.key_cost_challenge_count>=this.m_period.enable_key_entrance_count)MainObserver.getInstance().postNotification(sceneStr[scene_DailyDungeonListScene],daily_dungeon_entrance_limit_over);else{var message=this.IsEnableEntrance();if(message!=daily_dungeon_disable_pre_open_dungeon){var context=BattleContext._getInstance();context.setGameType(db.BattleGameType.DailyDungeon),context.setDailyDungeonData(dungeon),context.setDailyDungeonPeriodIdx(this.m_period.daily_dungeon_period_idx),context.setLastDailyDungeonId(dungeon.daily_dungeon.daily_dungeon_idx),MainObserver.getInstance().postNotification(sceneStr[scene_DailyDungeonListScene],daily_dungeon_battle_ready)}else MainObserver.getInstance().postNotification(sceneStr[scene_DailyDungeonListScene],message)}},IsEnableEntrance:function(){var dungeon=this.getSelectedDungeon();if(dungeon.is_open_pre_daily_dungeon){var n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),b=moment(dungeon.daily_dungeon_period.begin_date).valueOf(),e=moment(dungeon.daily_dungeon_period.end_date).valueOf();return b<=n&&n<=e?daily_dungeon_battle_ready:daily_dungeon_invalid_entrance_time}return daily_dungeon_disable_pre_open_dungeon},checkNeedKeyDailyDungeon:function(need_key){need_key=0;var dungeon=this.getSelectedDungeon(),is_expense_dec=!1,nn=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).time();for(var idx in list_Global_Booster_Event_V2){var b=list_Global_Booster_Event_V2[idx];if(null==b.begin_dt)break;var bt=moment(b.begin_dt).format("YYYY-MM-DD"),et=moment(b.end_dt).format("YYYY-MM-DD"),bb=bt.valueOf(),ee=et.valueOf();if(bb<=nn&&nn<=ee&&b.booster_type==BOOSTER_TYPE_V2_DAILY_DUNGEON&&b.variation_type==BOOSTER_VARIATION_TYPE_V2_EXPENSE_DEC&&b.item_type==BOOSTER_ITEM_TYPE_V2_ENTRANCE_TICKET){if(0==b.value_1){need_key=dungeon.daily_dungeon.need_key-dungeon.daily_dungeon.need_key*b.variation_value/100,is_expense_dec=!0;break}if(b.value_1==dungeon.daily_dungeon.daily_dungeon_idx){need_key=dungeon.daily_dungeon.need_key-dungeon.daily_dungeon.need_key*b.variation_value/100,is_expense_dec=!0;break}}}is_expense_dec&&(need_key=Math.min(need_key,dungeon.daily_dungeon.need_key)),0==need_key&&(need_key=dungeon.daily_dungeon.need_key)},getSelectedDungeon:function(){for(var idx=0;idx<this.m_daily_dungeon_list.length;idx++)if(this.m_daily_dungeon_list[idx].is_selected)return this.m_daily_dungeon_list[idx];return this.m_daily_dungeon_list[0]}}),DailyDungeonListScene=GameScene.extend({m_deferred:$.Deferred(),m_gameObserver:null,m_resource:[],ctor:function(){this._super(scene_DailyDungeonListScene),cc.log("CHECK DailyDungeonListScene")},get_story_deferred:function(){return this.m_deferred},init:function(){this.m_gameObserver=MainObserver.getInstance(),this.m_gameObserver.addObserver(this.onNotification,this,sceneStr[scene_DailyDungeonListScene]),this.m_resource=[],this.m_resource.push(RES_CDN_DEFULT+"common/bg_sub.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_01.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_02.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_03.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_04.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_05.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_11.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_12.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_13.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_31.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_32.png"),this.m_resource.push(RES_CDN_DEFULT+"menu_dailyvs/img_dailyvs_list_33.png"),resourceLoader(this.m_resource,function(){var win_size=cc.director.getWinSize(),bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub.png");bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(win_size)),USE_SP_COMMON_SUB_BG_SCALE&&bg.setScale(2),this.addChild(bg),this.m_dungeon_list_layer=new DailyDungeonListLayer(this.m_deferred),this.m_dungeon_list_layer.setPosition(ccCenter(win_size)),this.addChild(this.m_dungeon_list_layer);var statusLayer=new StatusLayer(INVOKER_TYPE.normal);statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer);var title,back_btn=new ccui.Button;(back_btn.loadTextures(RES_CDN_DEFULT+"new_common/btn/ori/btn_back_off.png",RES_CDN_DEFULT+"new_common/btn/ori/btn_back_on.png",""),back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(0,ccHeight(this)-ccHeight(back_btn)),back_btn.addClickEventListener(function(sender){this.back()}.bind(this)),this.addChild(back_btn),USE_SP_DAILY_SCALE)?((title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_daily.png")).setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title)):((title=cc.Sprite.create(RES_CDN_DEFULT+"new_img_txt/img_menu_daily.png")).setAnchorPoint(ZERO()),title.setPosition(cc.p(ccWidth(back_btn),ccHeight(this)-ccHeight(back_btn))),this.addChild(title));return!0}.bind(this)),cc.log("CHECK DailyDungeonListScene Init")},onEnter:function(){this._super(),this.playMainBGM()},back:function(){this.onKeyBack(!0)},onExit:function(){if(this._super(),cc.log("CHECK DailyDungeonListScene Exit"),this.m_gameObserver.removeObserver(sceneStr[scene_DailyDungeonListScene]),null!=this.m_resource){for(var idx=0;idx<this.m_resource.length;idx++)cc.loader.release(this.m_resource[idx]);this.m_resource=null}},onNotification:function(msg){switch(this._super(msg),msg){case daily_dungeon_battle_ready:var scene=new FriendSelectScene;SceneManager.getInstance().replaceScene(scene),scene=null;break;case daily_dungeon_invalid_entrance_time:this.showInvalidEntranceTime();break;case daily_dungeon_disable_pre_open_dungeon:this.showInvalidEntrancePreOpen();break;case daily_dungeon_entrance_limit_over:this.showEntranceLimitOver()}return!0},showInvalidEntranceTime:function(){this.m_box.show()},showEntranceLimitOver:function(){var mt=MasterManager.getInstance();this.m_box.setTitle(mt.get_LanguageData("label_weekly_invalid_entrance")),this.m_box.setText(mt.get_LanguageData("label_daily_dungeon_entrance_limit_over")),this.m_box.addButtonInfo(new MessageButtonInfo(mt.get_LanguageData("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showInvalidEntrancePreOpen:function(){var mt=MasterManager.getInstance();this.m_box.setTitle(mt.get_LanguageData("label_weekly_invalid_entrance")),this.m_box.setText(mt.get_LanguageData("label_weekly_invalid_entrance_pre_open")),this.m_box.addButtonInfo(new MessageButtonInfo(mt.get_LanguageData("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()}});