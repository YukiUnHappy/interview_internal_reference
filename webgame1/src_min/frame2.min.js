var BRANCH_ABILITY_MAX,sort_desc=1,sort_asc=2,COST_DESELECT_YUNHEE=401,COST_SELECT_YUNHEE=402,COST_TAB_1=403,COST_TAB_2=404,COST_TAB_3=405,COST_START=406,COST_RELEASE_SLOT=407,COST_RELEASE_FRONT_SLOT=408,COST_SLOT_LACK=409,COST_NEED_USER_LEVEL=410,COST_SHOW_HELP=411,CampMaterialYunheeLayer=cc.Layer.extend({m_isSelect:!1,m_isDisabled:!1,m_isLockRareType:!1,m_isNotUsePartner:!1,m_isNotUseLockYunhee:!1,m_validRareType:0,m_cardIcon:null,m_cardScreen:null,m_checkImg:null,m_usingCamp:null,m_usingTroops:null,m_selectedCardNum:null,ctor:function(info){this._super(),this.initLayout(info)},initLayout:function(info){var cardInfo={},key={gnrl_id:0,gnrl_num:0};if(key.gnrl_id=info.gnrl_id,key.gnrl_num=info.gnrl_num,cardInfo.gnrl_id=info.gnrl_id,cardInfo.level=info.gnrl_level,cardInfo.limit_step_id=info.limit_step_id,cardInfo.love_level=info.love_level,cardInfo.gender_type=info.gender_type,cardInfo.material_cost=info.cost,cardInfo.use_material_cost=!0,cardInfo.is_lock=info.is_lock,this.m_cardIcon=(new Card).createCard(cardInfo,CARD_TYPE.type_common_card),this.m_cardIcon.setAnchorPoint(ZERO()),this.m_cardIcon.setPosition(0,17),this.addChild(this.m_cardIcon),this.m_cardScreen=new cc.LayerColor(cc.color.BLACK),this.m_cardScreen.setContentSize(98,98),this.m_cardScreen.setAnchorPoint(ZERO()),this.m_cardScreen.setPosition(0,0),this.m_cardScreen.setOpacity(150),this.m_cardIcon.addChild(this.m_cardScreen,9999),this.m_checkImg=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_check.png"),this.m_checkImg.setAnchorPoint(ZERO()),this.m_checkImg.setPosition(ZERO()),this.m_cardIcon.addChild(this.m_checkImg),this.m_checkImg.setVisible(!1),this.m_usingCamp=cc.Sprite.create("#img_card_equip_3.png"),this.m_usingCamp.setAnchorPoint(ANCHOR_MIDDLE()),this.m_usingCamp.setPosition(ccCenter(this.m_cardIcon).x,ccCenter(this.m_cardIcon).y),this.m_cardIcon.addChild(this.m_usingCamp,99999999),1==info.using_in_camp?(this.m_usingCamp.setVisible(!0),this.m_isDisabled=!0):this.m_usingCamp.setVisible(!1),this.m_usingTroops=cc.Sprite.create("#img_card_equip_2.png"),this.m_usingTroops.setAnchorPoint(ANCHOR_MIDDLE()),this.m_usingTroops.setPosition(ccCenter(this.m_cardIcon).x,ccCenter(this.m_cardIcon).y),this.m_cardIcon.addChild(this.m_usingTroops,99999999),1==info.using_in_troops?(this.m_usingTroops.setVisible(!0),this.m_isDisabled=!0):this.m_usingTroops.setVisible(!1),0==info.using_in_troops&&info.using_in_great_wall_troops){var using_great_wall_troops=cc.Sprite.create("#img_card_equip_10.png");using_great_wall_troops.setAnchorPoint(ANCHOR_MIDDLE()),using_great_wall_troops.setPosition(ccCenter(this.m_cardIcon).x,ccCenter(this.m_cardIcon).y),this.m_cardIcon.addChild(using_great_wall_troops,99999999),this.m_isDisabled=!0}if(!info.using_in_troops&&info.using_in_world_war_troops){var using_world_war=cc.Sprite.create("#img_card_equip_6.png");using_world_war.setAnchorPoint(ANCHOR_MIDDLE()),using_world_war.setPosition(ccCenter(this.m_cardIcon).x,ccCenter(this.m_cardIcon).y),this.m_cardIcon.addChild(using_world_war,99999999),this.m_isDisabled=!0}var y=78;if(info.isPartner){var partner_icon=cc.Sprite.create("#img_card_leader.png");partner_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),partner_icon.setPosition(95,y),this.m_cardIcon.addChild(partner_icon),y-=ccHeight(partner_icon)}if(info.is_friend_partner){var friend_partner_icon=cc.Sprite.create("#img_card_friend_partner.png");friend_partner_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),friend_partner_icon.setPosition(95,y),this.m_cardIcon.addChild(friend_partner_icon)}return this.m_info=info,this.setContentSize(ccWidth(this.m_cardIcon)+17,ccHeight(this.m_cardIcon)+17),cardInfo={},key={},!0},selectCard:function(selectCardNum){0==this.m_isDisabled&&(this.m_isSelect?(null!=this.m_selectedCardNum&&this.m_selectedCardNum.removeFromParent(),this.m_checkImg.setVisible(!1),this.m_isSelect=!1):(this.m_checkImg.setVisible(!0),this.m_isSelect=!0,0<selectCardNum&&(this.m_selectedCardNum=cc.Sprite.create("#img_card_number_0"+selectCardNum+".png"),this.m_selectedCardNum.setAnchorPoint(ANCHOR_MIDDLE()),this.m_selectedCardNum.setPosition(ccCenter(this.m_cardIcon).x,ccCenter(this.m_cardIcon).y),this.m_cardIcon.addChild(this.m_selectedCardNum))))},getGnrlInfo:function(){return this.m_info},getGnrlKey:function(){var key={};return key.gnrl_id=this.m_info.gnrl_id,key.gnrl_num=this.m_info.gnrl_num,key},isSelectCard:function(){return this.m_isSelect},setUseCardScreen:function(setUse){0==this.m_isSelect&&0==this.m_isDisabled&&0==this.m_isLockRareType&&0==this.m_isNotUsePartner&&0==this.m_isNotUseLockYunhee&&this.m_cardScreen.setVisible(setUse)},isSelectable:function(){return 1!=this.m_isDisabled},setUsingCard:function(){this.m_checkImg.setVisible(!1),this.m_isSelect=!1,this.m_cardScreen.setVisible(!0),this.m_usingCamp.setVisible(!0),this.m_isDisabled=!0},setCancelUsingCard:function(remainUse){remainUse&&this.m_cardScreen.setVisible(!1),this.m_usingCamp.setVisible(!1),this.m_isDisabled=!1},setValidRareType:function(rare_type){this.m_validRareType=rare_type,this.m_info.rare_type!=rare_type?this.m_isLockRareType=!0:this.m_isLockRareType=!1},setNotUsePartner:function(){this.m_cardScreen.setVisible(!0),this.m_isNotUsePartner=!0},setNotUseLockYunhee:function(){this.m_cardScreen.setVisible(!0),this.m_isNotUseLockYunhee=!0},onExit:function(){this._super(),1!=PREV_HELP&&(this.m_cardScreen=null,this.m_checkImg=null,this.m_usingCamp=null,this.m_usingTroops=null,(this.m_selectedCardNum=null)!=this.m_cardIcon&&(this.m_cardIcon.removeAllChildrenWithCleanup(!0),this.m_cardIcon=null))}}),CampCommonLayer=cc.Layer.extend({m_selectedIndex:-1,m_useCostInfo:!1,m_useBranchAbilityInfo:!1,m_notUsePartner:!1,m_notUseLockYunhee:!1,m_rareType:0,m_sort:sort_desc,m_tableLayer:null,m_layer:null,m_commonLayer:null,m_sortBtn:null,m_yunheeTableLayers:[],m_selectedYunhee:null,m_gameObserver:null,m_materialList:[],m_itemLayers:[],ctor:function(){this.m_yunheeTableLayers=[],this.m_selectedYunhee={gnrl_key:{gnrl_id:0,gnrl_num:0},class_type:0,gnrl_level:0,rare_type:0,love_level:0,limit_step_id:0,is_partner:0,is_lock:0,is_friend_partner:0},this._super()},initLayout:function(){this.m_gameObserver=MainObserver.getInstance(),this.m_layer=new cc.Layer,this.addChild(this.m_layer),this.m_commonLayer=this.getMaterialLayer(),this.m_commonLayer.setAnchorPoint(ZERO()),this.m_commonLayer.setPosition(ZERO()),this.m_layer.addChild(this.m_commonLayer)},onEnter:function(){this._super()},onExit:function(){if(this._super(),1!=PREV_HELP){for(var count=this.m_tableLayer.getItemCount(),i=0;i<count;i++)this.m_tableLayer.m_itemNodes[i].removeAllChildrenWithCleanup(!0),this.m_tableLayer.m_itemNodes[i]=null,this.m_tableLayer.m_items[i]={},this.m_tableLayer.m_items[i]=null;this.m_tableLayer.m_itemNodes=null,this.m_tableLayer.m_items=null,this.m_tableLayer.removeAllChildrenWithCleanup(!0),this.m_tableLayer=null,this.m_layer=null,this.m_commonLayer=null,(this.m_sortBtn=null)!=this.m_selectedYunhee.gnrl_key&&(this.m_selectedYunhee.gnrl_key={},this.m_selectedYunhee.gnrl_key=null),this.m_selectedYunhee={},this.m_gameObserver=null,this.m_yunheeTableLayers=[],this.m_materialList=[],this.m_itemLayers=[],delete this.m_yunheeTableLayers,delete this.m_materialList,delete this.m_itemLayers}},setUserGeneralInfo:function(gnrl_list){this.m_materialList=gnrl_list,GreatWallService.getInstance().checkGreatWallDungeonPartInGenerals(this.m_materialList),WorldWarService.getInstance().checkWorldWarPartInGenerals(this.m_materialList),this.m_rareType=0,this.sortYunheeList()},setCampSubLayer:function(subLayerType){this.m_subLayerType=subLayerType},setUseCostInfo:function(){this.m_useCostInfo=!0},setUseBranchAbilityInfo:function(){this.m_useBranchAbilityInfo=!0},setNotUsePartner:function(){this.m_notUsePartner=!0},setNotUseLockYunhee:function(){this.m_notUseLockYunhee=!0},setUseRareType:function(rare_type){this.m_rareType=rare_type;for(var idx=0;idx<this.m_yunheeTableLayers.length;idx++)this.m_yunheeTableLayers[idx].setValidRareType(rare_type)},getMaterialLayer:function(){var layer=new cc.Layer,bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));bg_box.setContentSize(478,568),bg_box.setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),layer.addChild(bg_box),layer.setContentSize(ccSize(bg_box));var title_bg=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");title_bg.setAnchorPoint(ZERO()),title_bg.setPosition(8,509),layer.addChild(title_bg);var title_label=cmLabel.getLabel("情報",LABEL_FONT_INDEX.FONT_261);if(title_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),title_label.setPosition(20,ccCenter(title_bg).y+3),title_bg.addChild(title_label),1==this.m_useCostInfo){(warning_mark=cc.Sprite.create(RES_CDN_DEFULT+"menu_friend/img_friend_text.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),warning_mark.setPosition(title_label.getPosition().x+ccWidth(title_label)+10,ccCenter(title_bg).y+3),title_bg.addChild(warning_mark);var title_cost_label=cmLabel.getLabel("実の配置COSTとは異なります。",LABEL_FONT_INDEX.FONT_1613);title_cost_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),title_cost_label.setPosition(warning_mark.getPosition().x+ccWidth(warning_mark)+5,ccCenter(title_bg).y+3),title_bg.addChild(title_cost_label)}else if(1==this.m_useBranchAbilityInfo){var warning_mark;(warning_mark=cc.Sprite.create(RES_CDN_DEFULT+"menu_friend/img_friend_text.png")).setAnchorPoint(ANCHOR_MIDDLE_LEFT()),warning_mark.setPosition(ccPos(title_label).x+ccWidth(title_label)+6,ccCenter(title_bg).y+3),title_bg.addChild(warning_mark);var title_warning_label=cmLabel.getLabel(res_str("label_camp_not_use_equipped_general_info"),LABEL_FONT_INDEX.FONT_1414);title_warning_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),title_warning_label.setPosition(ccPos(warning_mark).x+ccWidth(warning_mark)+3,ccCenter(title_bg).y+3),title_bg.addChild(title_warning_label)}if(this.m_sortBtn=new ccui.Button("btn_align_top_off.png","btn_align_top_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_sortBtn.setAnchorPoint(ZERO()),this.m_sortBtn.setPosition(406,7),this.m_sortBtn.addClickEventListener(function(sender){}),title_bg.addChild(this.m_sortBtn,10),this.m_sortBtn.setVisible(!1),!this.m_materialList.length<=0)this.m_tableLayer=this.getMaterialTableLayer(),this.m_tableLayer.setPosition(17,18),layer.addChild(this.m_tableLayer);else{var info_label=cmLabel.getLabel("配置できる恋姫がいません。",LABEL_FONT_INDEX.FONT_261);info_label.setAnchorPoint(ANCHOR_MIDDLE()),info_label.setPosition(ccCenter(layer).x,ccCenter(layer).y+100),layer.addChild(info_label)}return this.sortMaterialLayer(),layer},getMaterialTableLayer:function(){var tableLayer=new TableViewLayer;return tableLayer.setContentSize(444,479),tableLayer.setItemCount(this.m_materialList.length),tableLayer.setColumnCount(4),tableLayer.getItemNode=function(index,contentSize,m){var materialItem=this.m_materialList[index];if(1==this.m_useCostInfo){var gc=MasterManager.getInstance().get_GeneralCost(materialItem.gnrl_id);materialItem.cost=gc.cost}var layer=new CampMaterialYunheeLayer(materialItem);return 1==this.m_notUsePartner&&(materialItem.isPartner||materialItem.is_friend_partner)&&layer.setNotUsePartner(),1==this.m_notUseLockYunhee&&(materialItem.is_lock||materialItem.using_in_world_war_troops)&&layer.setNotUseLockYunhee(),this.m_yunheeTableLayers.push(layer),materialItem=null,layer}.bind(this),tableLayer.initLayout(),tableLayer.onItemTouchBegin=function(index){return!0},tableLayer.onItemTouchMoved=function(isScroll){},tableLayer.onItemTouchCancel=function(index){return!0},tableLayer.onItemTouchEnd=function(index){var audio=AudioEngine.getInstance(),snd=RES_CDN_SOUND+SND_TYPE+"sound/SE_card_touch.mp3";audio.playEffect(snd);var layer=this.m_yunheeTableLayers[index];if(this.m_selectedIndex=index,0==layer.isSelectable())return!0;var gnrlInfo=layer.getGnrlInfo();switch(this.m_selectedYunhee.gnrl_key.gnrl_id=gnrlInfo.gnrl_id,this.m_selectedYunhee.gnrl_key.gnrl_num=gnrlInfo.gnrl_num,this.m_selectedYunhee.class_type=gnrlInfo.class_type,this.m_selectedYunhee.gnrl_level=gnrlInfo.gnrl_level,this.m_selectedYunhee.rare_type=gnrlInfo.rare_type,this.m_selectedYunhee.love_level=gnrlInfo.love_level,this.m_selectedYunhee.limit_step_id=gnrlInfo.limit_step_id,this.m_selectedYunhee.is_partner=gnrlInfo.isPartner,this.m_selectedYunhee.is_lock=gnrlInfo.is_lock||gnrlInfo.using_in_world_war_troops,this.m_selectedYunhee.is_friend_partner=gnrlInfo.is_friend_partner,gnrlInfo={},this.m_subLayerType){case SUB_LAYER_BRANCH_ABILITY:this.scheduleOnce(function(float){this.m_gameObserver.postNotification(sceneStr[this.getParent().getParent().getParent().m_sceneId],BRANCH_ABILITY_SELECT_YUNHEE)}.bind(this),0,"BRANCH_ABILITY_SELECT_YUNHEE");break;case SUB_LAYER_COST:this.scheduleOnce(function(float){this.m_gameObserver.postNotification(sceneStr[this.getParent().getParent().getParent().m_sceneId],COST_SELECT_YUNHEE)}.bind(this),0,"COST_SELECT_YUNHEE");break;case SUB_LAYER_ARBEIT:this.scheduleOnce(function(float){this.m_gameObserver.postNotification(sceneStr[this.getParent().getParent().getParent().m_sceneId],ARBEIT_SELECT_YUNHEE)}.bind(this),0,"ARBEIT_SELECT_YUNHEE")}return!0}.bind(this),tableLayer},setYunheeInMaterial:function(position){-1<this.m_selectedIndex&&this.m_yunheeTableLayers[this.m_selectedIndex].selectCard(position+1)},deselectYunhee:function(deselectedYunhee){for(var idx=0;idx<this.m_yunheeTableLayers.length;idx++){var yunheeInfo=this.m_yunheeTableLayers[idx].getGnrlInfo();if(deselectedYunhee.gnrl_id==yunheeInfo.gnrl_id&&deselectedYunhee.gnrl_num==yunheeInfo.gnrl_num){this.m_yunheeTableLayers[idx].selectCard(0);break}yunheeInfo=null}},deselectAllYunhee:function(){for(var idx=0;idx<this.m_yunheeTableLayers.length;idx++)this.m_yunheeTableLayers[idx].isSelectCard()&&this.m_yunheeTableLayers[idx].selectCard(0)},getSelectedYunhee:function(gnrlInfo){gnrlInfo.gnrl_key.gnrl_id=this.m_selectedYunhee.gnrl_key.gnrl_id,gnrlInfo.gnrl_key.gnrl_num=this.m_selectedYunhee.gnrl_key.gnrl_num,gnrlInfo.class_type=this.m_selectedYunhee.class_type,gnrlInfo.gnrl_level=this.m_selectedYunhee.gnrl_level,gnrlInfo.rare_type=this.m_selectedYunhee.rare_type,gnrlInfo.love_level=this.m_selectedYunhee.love_level,gnrlInfo.limit_step_id=this.m_selectedYunhee.limit_step_id,gnrlInfo.is_partner=this.m_selectedYunhee.is_partner,gnrlInfo.is_lock=this.m_selectedYunhee.is_lock,gnrlInfo.is_friend_partner=this.m_selectedYunhee.is_friend_partner},setUseCardScreen:function(setUse){for(var idx=0;idx<this.m_yunheeTableLayers.length;idx++)this.m_yunheeTableLayers[idx].setUseCardScreen(setUse);this.clearSelectedIndex()},isSelectable:function(){return-1<this.m_selectedIndex&&this.m_yunheeTableLayers[this.m_selectedIndex].isSelectable()},clearSelectedIndex:function(){this.m_selectedIndex=-1,this.m_selectedYunhee={gnrl_key:{gnrl_id:0,gnrl_num:0},class_type:0,gnrl_level:0,rare_type:0,love_level:0,limit_step_id:0,is_partner:0,is_lock:0,is_friend_partner:0}},setUsingYunhee:function(gnrl_id,gnrl_num){if(-1<this.m_selectedIndex)this.m_yunheeTableLayers[this.m_selectedIndex].setUsingCard();else for(var idx=0;idx<this.m_yunheeTableLayers.length;idx++)this.m_yunheeTableLayers[idx].getGnrlInfo().gnrl_id==gnrl_id&&this.m_yunheeTableLayers[idx].getGnrlInfo().gnrl_num==gnrl_num&&this.m_yunheeTableLayers[idx].setUsingCard()},setCancelYunhee:function(gnrl_id,gnrl_num,remainUse){if(-1<this.m_selectedIndex)this.m_yunheeTableLayers[this.m_selectedIndex].setCancelUsingCard(remainUse);else for(var idx=0;idx<this.m_yunheeTableLayers.length;idx++)this.m_yunheeTableLayers[idx].getGnrlInfo().gnrl_id==gnrl_id&&this.m_yunheeTableLayers[idx].getGnrlInfo().gnrl_num==gnrl_num&&this.m_yunheeTableLayers[idx].setCancelUsingCard(remainUse)},sortMaterialLayer:function(){if(0<this.m_yunheeTableLayers.length){this.m_sort==sort_desc?(this.m_sortBtn.loadTextures("btn_align_top_off.png","btn_align_top_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_yunheeTableLayers=stable(this.m_yunheeTableLayers,function(l,r){return l.getGnrlInfo().gnrl_level>r.getGnrlInfo().gnrl_level}),this.m_yunheeTableLayers=stable(this.m_yunheeTableLayers,function(l,r){return l.getGnrlInfo().class_type>r.getGnrlInfo().class_type}),1==this.m_useCostInfo&&(this.m_yunheeTableLayers=stable(this.m_yunheeTableLayers,function(l,r){return l.getGnrlInfo().cost>r.getGnrlInfo().cost})),this.m_yunheeTableLayers=stable(this.m_yunheeTableLayers,function(l,r){return l.getGnrlInfo().using_in_camp>r.getGnrlInfo().using_in_camp}),this.m_yunheeTableLayers=stable(this.m_yunheeTableLayers,function(l,r){return l.getGnrlInfo().using_in_great_wall_troops>r.getGnrlInfo().using_in_great_wall_troops}),this.m_yunheeTableLayers=stable(this.m_yunheeTableLayers,function(l,r){return l.getGnrlInfo().using_in_troops>r.getGnrlInfo().using_in_troops})):this.m_sort==sort_asc&&(this.m_sort=sort_desc,this.m_sortBtn.loadTextures("btn_align_bottom_off.png","btn_align_bottom_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_yunheeTableLayers=stable(this.m_yunheeTableLayers,function(l,r){return l.getGnrlInfo().gnrl_level<r.getGnrlInfo().gnrl_level}),this.m_yunheeTableLayers=stable(this.m_yunheeTableLayers,function(l,r){return l.getGnrlInfo().class_type<r.getGnrlInfo().class_type}),1==this.m_useCostInfo&&(this.m_yunheeTableLayers=stable(this.m_yunheeTableLayers,function(l,r){return l.getGnrlInfo().cost<r.getGnrlInfo().cost})),this.m_yunheeTableLayers=stable(this.m_yunheeTableLayers,function(l,r){return l.getGnrlInfo().using_in_camp>r.getGnrlInfo().using_in_camp}),this.m_yunheeTableLayers=stable(this.m_yunheeTableLayers,function(l,r){return l.getGnrlInfo().using_in_great_wall_troops>r.getGnrlInfo().using_in_great_wall_troops}),this.m_yunheeTableLayers=stable(this.m_yunheeTableLayers,function(l,r){return l.getGnrlInfo().using_in_troops>r.getGnrlInfo().using_in_troops})),this.sortYunheeList(),this.m_itemLayers=[];for(var idx=0;idx<this.m_yunheeTableLayers.length;idx++)this.m_itemLayers.push(this.m_yunheeTableLayers[idx]);null!=this.m_yunheeTableLayers&&(this.m_tableLayer.setItemContentNode(this.m_itemLayers),this.m_tableLayer.sortAnimation(!1))}cc.log(moment().valueOf())},sortYunheeList:function(){0<this.m_materialList.length&&(this.m_sort==sort_desc?(this.m_materialList=stable(this.m_materialList,function(l,r){return l.gnrl_level>r.gnrl_level}),this.m_materialList=stable(this.m_materialList,function(l,r){return l.class_type>r.class_type}),1==this.m_useCostInfo&&(this.m_materialList=stable(this.m_materialList,function(l,r){return l.cost>r.cost})),this.m_materialList=stable(this.m_materialList,function(l,r){return l.using_in_camp>r.using_in_camp}),this.m_materialList=stable(this.m_materialList,function(l,r){return l.using_in_great_wall_troops>r.using_in_great_wall_troops}),this.m_materialList=stable(this.m_materialList,function(l,r){return l.using_in_troops>r.using_in_troops}),this.m_materialList=stable(this.m_materialList,function(l,r){return l.gnrl_id>r.gnrl_id})):this.m_sort==sort_asc&&(this.m_materialList=stable(this.m_materialList,function(l,r){return l.gnrl_level<r.gnrl_level}),this.m_materialList=stable(this.m_materialList,function(l,r){return l.class_type<r.class_type}),1==this.m_useCostInfo&&(this.m_materialList=stable(this.m_materialList,function(l,r){return l.cost<r.cost})),this.m_materialList=stable(this.m_materialList,function(l,r){return l.using_in_camp>r.using_in_camp}),this.m_materialList=stable(this.m_materialList,function(l,r){return l.using_in_great_wall_troops>r.using_in_great_wall_troops}),this.m_materialList=stable(this.m_materialList,function(l,r){return l.using_in_troops>r.using_in_troops}),this.m_materialList=stable(this.m_materialList,function(l,r){return l.gnrl_id>r.gnrl_id})))}}),CampCommonyEnum={COMMON_BTN_SORT:701},CampBranchYunheeListItemEnum={BRANCH_ABILITY_DESELECT_YUNHEE:310},CampBranchAbilityEnum={BRANCH_ABILITY_CHANGED:(BRANCH_ABILITY_MAX=310)+1,BRANCH_ABILITY_RELEASED:BRANCH_ABILITY_MAX+2,BRANCH_ABILITY_CONFIRM_UPGRADE:BRANCH_ABILITY_MAX+3,BRANCH_ABILITY_CONFIRM_CANCEL:BRANCH_ABILITY_MAX+4,BRANCH_ABILITY_TAB_1:BRANCH_ABILITY_MAX+5,BRANCH_ABILITY_TAB_2:BRANCH_ABILITY_MAX+6,BRANCH_ABILITY_TAB_3:BRANCH_ABILITY_MAX+7,BRANCH_ABILITY_SELECT_YUNHEE:BRANCH_ABILITY_MAX+8,BRANCH_ABILITY_SLOT_LACK:BRANCH_ABILITY_MAX+9,BRANCH_ABILITY_SHOTEN_TIME:BRANCH_ABILITY_MAX+10,BRANCH_ABILITY_NOT_EQUAL_RARE_TYPE:BRANCH_ABILITY_MAX+11,BRANCH_ABILITY_SHOW_HELP:BRANCH_ABILITY_MAX+12,BRANCH_ABILITY_CANNOT_USE_PARTNER:BRANCH_ABILITY_MAX+13,BRANCH_ABILITY_CANNOT_USE_LOCK_YUNHEE:BRANCH_ABILITY_MAX+14},CAMP_BRANCH_GET_ITEM_INFO=!1,CAMP_BRANCH_GET_SERVERTIME_INFO=!1,CampBranchAbilityScene=GameScene.extend({m_campBranchAbilityLayer:null,m_layer:null,m_isUpgrade:!1,ctor:function(){this._super(scene_CampBranchAbilityScene),CAMP_BRANCH_GET_SERVERTIME_INFO=CAMP_BRANCH_GET_ITEM_INFO=PREV_HELP=!1,this.m_isUpgrade=!1},init:function(){var bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub_2.png");bg.setPosition(ccCenter(this)),USE_SP_COMMON_SUB_BG_SCALE&&bg.setScale(2),this.addChild(bg),this.m_campBranchAbilityLayer=new CampBranchAbilityLayer,this.m_campBranchAbilityLayer.ignoreAnchorPointForPosition(!1),this.m_campBranchAbilityLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_campBranchAbilityLayer.setPosition(ccWidth(this)/2,0),this.addChild(this.m_campBranchAbilityLayer),this.m_campBranchAbilityLayer.initLayout();var title,statusLayer=new StatusLayer(INVOKER_TYPE.normal);(statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer),USE_SP_CAMP_SCALE)?((title=cc.Sprite.create(RES_CDN_DEFULT+"menu_camp/img_camp_text_camp.png")).setAnchorPoint(ZERO()),title.setPosition(90,585),title.setScale(2),this.addChild(title)):((title=cc.Sprite.create(RES_CDN_DEFULT+"menu_camp/img_camp_text_camp.png")).setAnchorPoint(ZERO()),title.setPosition(90,585),this.addChild(title));var back_btn=new ccui.Button("btn_home_off.png","btn_home_on.png","",ccui.Widget.PLIST_TEXTURE);return back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(10,559),back_btn.addClickEventListener(function(sender){this.back()}.bind(this)),this.addChild(back_btn),!0},back:function(){this.onKeyBack(!0)},onNotification:function(msg){if(this._super(msg))return!1;switch(msg){case BRANCH_ABILITY_SELECT_YUNHEE:this.m_campBranchAbilityLayer.setYunheeInBranch();break;case BRANCH_ABILITY_TAB_1:case BRANCH_ABILITY_TAB_2:case BRANCH_ABILITY_TAB_3:CAMP_BRANCH_GET_SERVERTIME_INFO=!0;var req={};req.opcode=net.OP.op_get_server_time_check,this.network_write(req),this.m_campBranchAbilityLayer.setTabIndex(msg);break;case BRANCH_ABILITY_CHANGED:this.m_campBranchAbilityLayer.setLoveStatIndex();break;case BRANCH_ABILITY_RELEASED:this.m_campBranchAbilityLayer.releaseLoveStatIndex();break;case BRANCH_ABILITY_CONFIRM_UPGRADE:this.showConfirmUpgradeMsgBox();break;case CampBranchAbilityEnum.BRANCH_ABILITY_CONFIRM_CANCEL:this.showConfirmCancelMsgBox();break;case COMMON_BTN_SORT:this.m_campBranchAbilityLayer.sortMaterialYunhee();break;case CampBranchYunheeListItemEnum.BRANCH_ABILITY_DESELECT_YUNHEE:this.m_campBranchAbilityLayer.deselectYunhee();break;case BRANCH_ABILITY_SLOT_LACK:this.showLackSlotMsgBox();break;case BRANCH_ABILITY_SHOTEN_TIME:this.showConfirmShotenBranchAbilityTime();break;case BRANCH_ABILITY_NOT_EQUAL_RARE_TYPE:this.showNotEqualRareTypeMsgBox();break;case BRANCH_ABILITY_SHOW_HELP:PREV_HELP=!0,GameContext.getInstance().setHelpInfoIndexByCallIndex(22);var scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null;break;case BRANCH_ABILITY_CANNOT_USE_PARTNER:this.showCanNotUsePartnerMsgBox();break;case BRANCH_ABILITY_CANNOT_USE_FRIEND_PARTNER:USE_POPUP_INTERGRATION?this.showBranchAbilityPopup(res_str("label_camp_branch_ability_error_title"),res_str("label_camp_branch_ability_cannot_use_friend_partner_text_1"),res_str("label_camp_branch_ability_cannot_use_friend_partner_text_3")):this.showCanNotUseFriendPartnerMsgBox();break;case BRANCH_ABILITY_CANNOT_USE_LOCK_YUNHEE:this.showCanNotUseLockYunheeMsgBox();break;case BRANCH_ABILITY_COMPLETE:this.m_campBranchAbilityLayer.upgradeCompleteBranchAbility(),this.m_box.is_show()&&this.m_box.hide()}return!0},onNetworkEvent:function(opcode,state,body){CampService.getInstance();if(body.error==net.ERROR.NET_E_SUCCESS)if(opcode==net.OP.op_set_user_camp_branch_ability){CAMP_BRANCH_GET_ITEM_INFO=!0,this.m_isUpgrade=!0;var req={};req.opcode=net.OP.op_get_user_item,this.network_write(req)}else opcode==net.OP.op_get_user_item?this.m_isUpgrade&&(this.m_isUpgrade=!1,this.m_campBranchAbilityLayer.startBranchAbility()):opcode==net.OP.op_cancel_user_camp_branch_ability?(USE_POPUP_INTERGRATION?this.showBranchAbilityPopup(res_str("label_camp_cancel_title"),res_str("label_camp_branch_ability_cancel_text")):this.showCancelMsgBox(),this.m_campBranchAbilityLayer.cancelBranchAbility()):opcode==net.OP.op_check_upgrade_user_camp_branch_ability?0==body.branch_ability_id||(this.m_campBranchAbilityLayer.upgradeCompleteBranchAbility(),this.m_box.is_show()&&this.m_box.hide()):opcode==net.OP.op_shoten_time_user_camp_branch_ability&&(this.m_campBranchAbilityLayer.shotenBranchAbilityTime(body.complete_yn),this.m_campBranchAbilityLayer.releaseShotenTimeBtn());body.error==net.ERROR.NET_E_CAMP_ALREADY_USED_YUNHEE?USE_POPUP_INTERGRATION?this.showBranchAbilityPopup(res_str("label_camp_branch_ability_upgrade_error_title"),res_str("label_camp_upgrade_error_already_used")):this.showAlreadyUsedYunheeMsgBox():body.error==net.ERROR.NET_E_NOT_FOUND_GENERAL?USE_POPUP_INTERGRATION?this.showBranchAbilityPopup(res_str("label_camp_branch_ability_upgrade_error_title"),res_str("label_camp_upgrade_error_not_exist_yunhee")):this.showNotExistYunheeMsgBox():body.error==net.ERROR.NET_E_CAMP_USING_IN_TROOPS?USE_POPUP_INTERGRATION?this.showGameScenePopup(res_str("label_preparation_title"),res_str("label_camp_upgrade_error_in_troops")):this.showUsingInTroopsMsgBox():body.error==net.ERROR.NET_E_CAMP_UPGRADE_UNDERWAY?USE_POPUP_INTERGRATION?this.showBranchAbilityPopup(res_str("label_camp_branch_ability_upgrade_error_title"),res_str("label_camp_upgrade_error_underway")):this.showUpgradeUnderwayMsgBox():body.error==net.ERROR.NET_E_LACK_GOLD?USE_POPUP_INTERGRATION?this.showBranchAbilityPopup(res_str("label_camp_branch_ability_upgrade_error_title"),res_str("label_camp_upgrade_error_lack_gold")):this.showLackGoldMsgBox():body.error==net.ERROR.NET_E_CAMP_NOT_EXIST_UPGRADE_ID?USE_POPUP_INTERGRATION?this.showBranchAbilityPopup(res_str("label_camp_branch_ability_upgrade_error_title"),res_str("label_camp_upgrade_error_lack_camp_level_1"),res_str("label_camp_upgrade_error_lack_camp_level_2"),res_str("label_camp_upgrade_error_lack_camp_level_3")):this.showLackCampLevelMsgBox():body.error==net.ERROR.NET_E_CAMP_USING_IN_GREAT_WALL_TROOPS?USE_POPUP_INTERGRATION?this.showGameScenePopup(res_str("label_preparation_title"),res_str("label_camp_upgrade_error_in_great_wall_troops")):this.showUsingInGreatWallTroopsMsgBox():body.error==net.OP.NET_E_CAMP_NO_CANCEL_UPGRADE?USE_POPUP_INTERGRATION?this.showBranchAbilityPopup(res_str("label_camp_cancel_title"),res_str("label_camp_cancel_no_upgrade")):this.showNoCancelUpgrade():body.error==net.ERROR.NET_E_LACK_JADE?USE_POPUP_INTERGRATION?this.showBranchAbilityPopup(res_str("label_camp_branch_ability_error_title"),res_str("label_camp_upgrade_error_lack_jade")):this.showLackJadeMsgBox():body.error==net.OP.NET_E_CAMP_NOT_EXIST_UPGRADE_ID&&(USE_POPUP_INTERGRATION?this.showBranchAbilityPopup(res_str("label_camp_branch_ability_upgrade_error_title"),res_str("label_camp_upgrade_error_not_exist_branch_ability_id")):this.showNotExistBranchAbilityIdMsgBox())},processCancelBranchAbility:function(){this.m_campBranchAbilityLayer=this.cancelBranchAbility()},onTimeEventNotification:function(sender){sender>=TIME_EVENT_CAMP_BRANCH_ABILITY_1&&TIME_EVENT_CAMP_BRANCH_ABILITY_9},showCanNotUseLockYunheeMsgBox:function(){this.m_box.setTitle("兵科能力エラー");var info={};info.color=cmLabel.getColor(LABEL_FONT_INDEX.FONT_248),info.text="ロック恋姫は ",info.text="\n",info.text="兵科能力の素材として使用できません。 ",this.m_box.setText(info.text),this.m_box.addButtonInfo(new MessageButtonInfo("確認",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showCanNotUsePartnerMsgBox:function(){this.m_box.setTitle("兵科能力エラー");var info={};info.color=cmLabel.getColor(LABEL_FONT_INDEX.FONT_248),info.text="パートナーは ",info.text="\n",info.text="兵科能力の素材として使用できません。 ",this.m_box.setText(info.text),this.m_box.addButtonInfo(new MessageButtonInfo("確認",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show(),info={}},showNotEqualRareTypeMsgBox:function(){this.m_box.setTitle("兵科管理");var info={};info.color=cmLabel.getColor(LABEL_FONT_INDEX.FONT_248),info.text="当該レアリティの恋姫は選択できません。",this.m_box.setText(info.text),this.m_box.addButtonInfo(new MessageButtonInfo("確認",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show(),info={}},showLackSlotMsgBox:function(){this.m_box.setTitle("兵科管理");var info={};info.color=cmLabel.getColor(LABEL_FONT_INDEX.FONT_248),info.text="これ以上恋姫を追加できません。",this.m_box.setText(info.text),this.m_box.addButtonInfo(new MessageButtonInfo("確認",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show(),info={}},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_CampBranchAbilityScene])},onExit:function(){this._super(),MainObserver.getInstance().removeObserver(sceneStr[scene_CampBranchAbilityScene]),1!=PREV_HELP&&(null!=this.m_layer&&(this.m_layer.removeAllChildrenWithCleanup(!0),this.m_layer=null),null!=this.m_campBranchAbilityLayer&&(this.m_campBranchAbilityLayer.removeAllChildrenWithCleanup(!0),this.m_campBranchAbilityLayer=null))},showConfirmShotenBranchAbilityTime:function(){this.m_campBranchAbilityLayer.getNeededAssetAmount();this.m_ctbox.setTitle("兵科管理"),this.m_ctbox.setText("翡翠 1",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("個を使用し、",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("兵科能力時間",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText(" 1時間 ",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("を短縮しますか。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.addButtonInfo(new MessageButtonInfo("いいえ",MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_campBranchAbilityLayer.releaseShotenTimeBtn(),this.m_ctbox.hide()}.bind(this))),this.m_ctbox.addButtonInfo(new MessageButtonInfo("はい",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.sendPacketShotenTimeBranchAbility()},0,"btnYes"),this.m_ctbox.hide(!1)}.bind(this))),this.m_ctbox.show()},sendPacketShotenTimeBranchAbility:function(){var branchType=this.m_campBranchAbilityLayer.getTabIndex(),loveStatType=this.m_campBranchAbilityLayer.getLoveStatIndex(),fResetLoveStatType=!1;loveStatType<1&&(loveStatType=this.m_campBranchAbilityLayer.getPressedShotenTimeBtn(),fResetLoveStatType=!0);var req={};req.opcode=net.OP.op_shoten_time_user_camp_branch_ability,req.branch_type=branchType,req.love_stat_type=loveStatType;var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent,mainScene),1==fResetLoveStatType&&this.m_campBranchAbilityLayer.releaseLoveStatIndex(),req={}},showConfirmUpgradeMsgBox:function(){var amount=this.m_campBranchAbilityLayer.getNeededAssetAmount();this.m_ctbox.setTitle(res_str("label_camp_upgrade_title")),this.m_ctbox.setText(res_str("label_camp_upgrade_branch_ability_text_1"),LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(res_str("label_camp_upgrade_branch_ability_text_2"),LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("金貨 "+amount,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText(" を使用して",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(res_str("label_camp_upgrade_branch_ability_text_3"),LABEL_FONT_INDEX.FONT_261),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_ctbox.hide()}.bind(this))),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.sendPacketUpgradeBranchAbility()},0,"btnYes"),this.m_ctbox.hide(!1)}.bind(this))),this.m_ctbox.show()},showConfirmCancelMsgBox:function(){this.m_box.setTitle(res_str("label_camp_cancel_title")),this.m_box.setText(res_str("label_camp_branch_ability_cancel_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_camp_branch_ability_cancel_text_2")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_camp_branch_ability_cancel_text_3")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.sendPacketCancelBranchAbility()},0,"btnYes"),this.m_box.hide(!1)}.bind(this))),this.m_box.show()},sendPacketUpgradeBranchAbility:function(){var branchType=this.m_campBranchAbilityLayer.getTabIndex(),loveStatType=this.m_campBranchAbilityLayer.getLoveStatIndex();if(0!=branchType&&0!=loveStatType){var abilityYunhee=this.m_campBranchAbilityLayer.getBranchAbilityYunhees();if(0==abilityYunhee.size())return void(USE_POPUP_INTERGRATION?this.showBranchAbilityPopup(res_str("label_camp_branch_ability_upgrade_error_title"),res_str("label_camp_upgrade_error_not_exist_yunhee")):this.showNotExistYunheeMsgBox());var req={};req.opcode=net.OP.op_set_user_camp_branch_ability,req.branch_yunhee={},req.branch_yunhee.branch_type=branchType,req.branch_yunhee.love_stat_type=loveStatType,req.branch_yunhee.gnrl_keys=[];for(var keys=abilityYunhee.keys(),idx=0;idx<keys.length;idx++){var branchYunhee=abilityYunhee.at(keys[idx]);(gnrl_key={}).gnrl_id=branchYunhee.gnrl_key.gnrl_id,gnrl_key.gnrl_num=branchYunhee.gnrl_key.gnrl_num,req.branch_yunhee.gnrl_keys.push(gnrl_key),gnrl_key={}}for(var i=0;i<MAX_BRANCH_ABILITY_YUNHEE_NUM-abilityYunhee.length;i++){var gnrl_key={gnrl_id:0,gnrl_num:0};req.branch_yunhee.gnrl_keys.push(gnrl_key),gnrl_key={}}this.network_write(req),req={},keys=null}},sendPacketCancelBranchAbility:function(){var branchType=this.m_campBranchAbilityLayer.getTabIndex(),loveStatType=this.m_campBranchAbilityLayer.getLoveStatIndex(),req={};req.opcode=net.OP.op_cancel_user_camp_branch_ability,req.branch_type=branchType,req.love_stat_type=loveStatType,this.network_write(req),req={}},showBranchAbilityPopup:function(){this.m_box.is_show()&&this.m_box.hide();for(var val=arguments,msg=[],i=1;i<val.length;i++)msg.push(val[i]);this.showMsgBox(val[0],msg),msg=null},showLackCampLevelMsgBox:function(){this.m_box.setTitle(res_str("label_camp_branch_ability_upgrade_error_title")),this.m_box.setText(res_str("label_camp_upgrade_error_lack_camp_level_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_camp_upgrade_error_lack_camp_level_2")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_camp_upgrade_error_lack_camp_level_3")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showLackGoldMsgBox:function(){this.m_box.setTitle(res_str("label_camp_branch_ability_upgrade_error_title")),this.m_box.setText(res_str("label_camp_upgrade_error_lack_gold")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showCancelMsgBox:function(){this.m_box.setTitle(res_str("label_camp_cancel_title")),this.m_box.setText(res_str("label_camp_branch_ability_cancel_text")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showLackJadeMsgBox:function(){this.m_box.setTitle(res_str("label_camp_branch_ability_error_title")),this.m_box.setText(res_str("label_camp_upgrade_error_lack_jade")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showNotExistBranchAbilityIdMsgBox:function(){this.m_box.setTitle(res_str("label_camp_branch_ability_upgrade_error_title")),this.m_box.setText(res_str("label_camp_upgrade_error_not_exist_branch_ability_id")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showCanNotUseFriendPartnerMsgBox:function(){this.m_box.setTitle(res_str("label_camp_branch_ability_error_title")),this.m_box.setText(res_str("label_camp_branch_ability_cannot_use_friend_partner_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_camp_branch_ability_cannot_use_friend_partner_text_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showAlreadyUsedYunheeMsgBox:function(){this.m_box.setTitle(res_str("label_camp_branch_ability_upgrade_error_title")),this.m_box.setText(res_str("label_camp_upgrade_error_already_used")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showNotExistYunheeMsgBox:function(){this.m_box.setTitle(res_str("label_camp_branch_ability_upgrade_error_title")),this.m_box.setText(res_str("label_camp_upgrade_error_not_exist_yunhee")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showUpgradeUnderwayMsgBox:function(){this.m_box.setTitle(res_str("label_camp_branch_ability_upgrade_error_title")),this.m_box.setText(res_str("label_camp_upgrade_error_underway")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showNoCancelUpgrade:function(){this.m_box.setTitle(res_str("label_camp_cancel_title")),this.m_box.setText(res_str("label_camp_cancel_no_upgrade")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()}}),MAX_BRANCH_ABILITY_NUM=3,BRANCH_ABILITY_CHANGED=(BRANCH_ABILITY_MAX=310)+1,BRANCH_ABILITY_RELEASED=BRANCH_ABILITY_MAX+2,BRANCH_ABILITY_CONFIRM_UPGRADE=BRANCH_ABILITY_MAX+3,BRANCH_ABILITY_CONFIRM_CANCEL=BRANCH_ABILITY_MAX+4,BRANCH_ABILITY_TAB_1=BRANCH_ABILITY_MAX+5,BRANCH_ABILITY_TAB_2=BRANCH_ABILITY_MAX+6,BRANCH_ABILITY_TAB_3=BRANCH_ABILITY_MAX+7,BRANCH_ABILITY_SELECT_YUNHEE=BRANCH_ABILITY_MAX+8,BRANCH_ABILITY_SLOT_LACK=BRANCH_ABILITY_MAX+9,BRANCH_ABILITY_SHOTEN_TIME=BRANCH_ABILITY_MAX+10,BRANCH_ABILITY_NOT_EQUAL_RARE_TYPE=BRANCH_ABILITY_MAX+11,BRANCH_ABILITY_SHOW_HELP=BRANCH_ABILITY_MAX+12,BRANCH_ABILITY_CANNOT_USE_PARTNER=BRANCH_ABILITY_MAX+13,BRANCH_ABILITY_CANNOT_USE_LOCK_YUNHEE=BRANCH_ABILITY_MAX+14,BRANCH_ABILITY_CANNOT_USE_FRIEND_PARTNER=BRANCH_ABILITY_MAX+15,BRANCH_ABILITY_TYPE_ATTACK_PERCENT=1,BRANCH_ABILITY_TYPE_ATTACK=2,BRANCH_ABILITY_TYPE_DEFENSE_PERCENT=3,BRANCH_ABILITY_TYPE_DEFENSE=4,BRANCH_ABILITY_TYPE_HEALTH_PERCENT=5,BRANCH_ABILITY_TYPE_HEALTH=6,BRANCH_ABILITY_COMPLETE=BRANCH_ABILITY_MAX+99,MAX_BRANCH_ABILITY_YUNHEE_NUM=(MAX_BRANCH_ABILITY_NUM=3,4),PERCENT=100,COMMON_BTN_SORT=701,CampBranchListItemLayer=cc.Layer.extend({m_selected:!1,m_released:!1,m_shotenTimePressed:null,m_upgradeSecond:0,m_btnDisabled:!1,m_basicValueLabel:null,m_arrow1:null,m_arrow2:null,m_addedValueLabel:null,m_basicLevelLabel:null,m_addedLevelLabel:null,m_selectBtn:null,m_releaseBtn:null,m_shotenTimeBtn:null,m_branchScreen:null,m_bgSelected:null,m_bgSelected2:null,m_bgOnUpgrade:null,m_bgOnUpgrade2:null,m_elapsedGauge:null,m_timeLabel:null,ctor:function(index,branchAbility){this.m_shotenTimePressed=!1,this._super(),this.initLayout(index,branchAbility)},init:function(){},initLayout:function(index,branchAbility){return this.m_selected=!1,this.m_released=!1,this.m_shotenTimePressed=!1,this.m_upgradeSecond=0,this.m_btnDisabled=!1,this.m_basicValueLabel=null,this.m_arrow1=null,this.m_arrow2=null,this.m_addedValueLabel=null,this.m_basicLevelLabel=null,this.m_addedLevelLabel=null,this.m_selectBtn=null,this.m_releaseBtn=null,this.m_shotenTimeBtn=null,this.m_branchScreen=null,this.m_bgSelected=null,this.m_bgSelected2=null,this.m_bgOnUpgrade=null,this.m_bgOnUpgrade2=null,this.m_elapsedGauge=null,this.m_timeLabel=null,this.getBranchFrame(index,branchAbility.love_stat_added,branchAbility.prev_love_stat,branchAbility.upgrade_level,branchAbility.is_max_level),!0},getBranchFrame:function(index,addedStat,prevAddedStat,upgradeLevel,isMaxLevel){var bgBox=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",cc.rect(0,0,0,0));bgBox.setContentSize(444,94),bgBox.setInsetBottom(13),bgBox.setInsetLeft(13),bgBox.setInsetRight(13),bgBox.setInsetTop(13),bgBox.setAnchorPoint(ZERO()),bgBox.setPosition(ZERO()),this.addChild(bgBox),this.setContentSize(444,94);var icon_bg=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame.png");icon_bg.setAnchorPoint(ZERO()),icon_bg.setPosition(4,21),bgBox.addChild(icon_bg);var icon_img=cc.Sprite.create(RES_CDN_DEFULT+"icon/Status/Status_0"+(index+1)+".png");icon_img.setAnchorPoint(ZERO()),USE_SP_CAMP_SCALE&&icon_img.setScale(2),icon_img.setPosition(4,4),icon_bg.addChild(icon_img);var branchLabel="";switch((index+1)*CAMP_LOVE_STAT_GAP-CAMP_LOVE_STAT_TYPE){case BRANCH_ABILITY_TYPE_ATTACK_PERCENT:case BRANCH_ABILITY_TYPE_ATTACK:branchLabel="攻撃力";break;case BRANCH_ABILITY_TYPE_DEFENSE_PERCENT:case BRANCH_ABILITY_TYPE_DEFENSE:branchLabel="防御力";break;case BRANCH_ABILITY_TYPE_HEALTH_PERCENT:case BRANCH_ABILITY_TYPE_HEALTH:branchLabel="体力"}var level_title,branch_label=cmLabel.getLabel(branchLabel,LABEL_FONT_INDEX.FONT_2013);(branch_label.setAnchorPoint(ZERO()),branch_label.setPosition(80,59),bgBox.addChild(branch_label),0==isMaxLevel)?(1==CAMP_LOVE_STAT_TYPE?this.m_basicValueLabel=cmLabel.getLabel((prevAddedStat/PERCENT).toFixed(1)+" %",LABEL_FONT_INDEX.FONT_201):this.m_basicValueLabel=cmLabel.getLabel(prevAddedStat.toFixed(1)+" %",LABEL_FONT_INDEX.FONT_201),this.m_basicValueLabel.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_basicValueLabel.setPosition(180,59),bgBox.addChild(this.m_basicValueLabel),this.m_arrow1=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_arrow_3.png"),this.m_arrow1.setAnchorPoint(ZERO()),this.m_arrow1.setPosition(219,63),bgBox.addChild(this.m_arrow1),1==CAMP_LOVE_STAT_TYPE?this.m_addedValueLabel=cmLabel.getLabel((addedStat/PERCENT).toFixed(1)+" %",LABEL_FONT_INDEX.FONT_2031):this.m_addedValueLabel=cmLabel.getLabel(addedStat.toFixed(1)+" %",LABEL_FONT_INDEX.FONT_2031),this.m_addedValueLabel.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_addedValueLabel.setPosition(274,59),bgBox.addChild(this.m_addedValueLabel),(level_title=cmLabel.getLabel("Lv",LABEL_FONT_INDEX.FONT_2013)).setAnchorPoint(ZERO()),level_title.setPosition(80,33),bgBox.addChild(level_title),this.m_basicLevelLabel=cmLabel.getLabel(upgradeLevel-1,LABEL_FONT_INDEX.FONT_201),this.m_basicLevelLabel.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_basicLevelLabel.setPosition(180,33),bgBox.addChild(this.m_basicLevelLabel),this.m_arrow2=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_arrow_3.png"),this.m_arrow2.setAnchorPoint(ZERO()),this.m_arrow2.setPosition(219,34),bgBox.addChild(this.m_arrow2),this.m_addedLevelLabel=cmLabel.getLabel(upgradeLevel,LABEL_FONT_INDEX.FONT_2031),this.m_addedLevelLabel.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_addedLevelLabel.setPosition(274,33),bgBox.addChild(this.m_addedLevelLabel)):(this.m_btnDisabled=!0,1==CAMP_LOVE_STAT_TYPE?this.m_basicValueLabel=cmLabel.getLabel((addedStat/PERCENT).toFixed(1)+" %",LABEL_FONT_INDEX.FONT_201):this.m_basicValueLabel=cmLabel.getLabel(addedStat.toFixed(1)+" %",LABEL_FONT_INDEX.FONT_201),this.m_basicValueLabel.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_basicValueLabel.setPosition(180,59),bgBox.addChild(this.m_basicValueLabel),this.m_addedValueLabel=null,(level_title=cmLabel.getLabel("Lv",LABEL_FONT_INDEX.FONT_2013)).setAnchorPoint(ZERO()),level_title.setPosition(80,33),bgBox.addChild(level_title),this.m_basicLevelLabel=cmLabel.getLabel(upgradeLevel,LABEL_FONT_INDEX.FONT_201),this.m_basicLevelLabel.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_basicLevelLabel.setPosition(180,33),bgBox.addChild(this.m_basicLevelLabel),this.m_addedLevelLabel=null);this.m_selectBtn=new ccui.Button,this.m_selectBtn.loadTextures("btn_14_off.png","btn_14_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_selectBtn.setAnchorPoint(ZERO()),this.m_selectBtn.setPosition(321,30),this.m_selectBtn.addClickEventListener(function(){0==this.m_selected&&(this.m_selected=!0,MainObserver.getInstance().postNotification(sceneStr[scene_CampBranchAbilityScene],BRANCH_ABILITY_CHANGED))}.bind(this)),bgBox.addChild(this.m_selectBtn);var select_label=cmLabel.getLabel("選択",LABEL_FONT_INDEX.FONT_181);if(select_label.setAnchorPoint(ANCHOR_MIDDLE()),select_label.setPosition(ccCenter(this.m_selectBtn)),this.m_selectBtn.addChild(select_label),1==this.m_btnDisabled){this.m_selectBtn.setEnabled(!1);var btn_screen=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",cc.rect(0,0,0,0));btn_screen.setContentSize(ccSize(this.m_selectBtn)),btn_screen.setAnchorPoint(ANCHOR_MIDDLE()),btn_screen.setPosition(ccCenter(this.m_selectBtn).x,ccCenter(this.m_selectBtn).y),this.m_selectBtn.addChild(btn_screen)}this.m_releaseBtn=new ccui.Button,this.m_releaseBtn.loadTextures("btn_15_off.png","btn_15_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_releaseBtn.setAnchorPoint(ZERO()),this.m_releaseBtn.setPosition(this.m_selectBtn.getPosition()),this.m_releaseBtn.addClickEventListener(function(){0==this.m_shotenTimePressed&&(this.m_released=!0,MainObserver.getInstance().postNotification(sceneStr[scene_CampBranchAbilityScene],BRANCH_ABILITY_RELEASED))}.bind(this)),bgBox.addChild(this.m_releaseBtn),this.m_releaseBtn.setVisible(!1);var release_label=cmLabel.getLabel("解除",LABEL_FONT_INDEX.FONT_181);release_label.setAnchorPoint(ANCHOR_MIDDLE()),release_label.setPosition(ccCenter(this.m_releaseBtn)),this.m_releaseBtn.addChild(release_label),1==this.m_btnDisabled&&this.m_releaseBtn.setEnabled(!1),this.m_shotenTimeBtn=new ccui.Button,this.m_shotenTimeBtn.loadTextures("btn_14_off.png","btn_14_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_shotenTimeBtn.setAnchorPoint(ZERO()),this.m_shotenTimeBtn.setEnabled(!1),this.m_shotenTimeBtn.setPosition(cc.p(this.m_selectBtn.getPosition().x+ccWidth(this.m_selectBtn),this.m_selectBtn.getPosition().y)),this.m_shotenTimeBtn.addClickEventListener(function(){0==this.m_shotenTimePressed&&(this.m_shotenTimePressed=!0,MainObserver.getInstance().postNotification(sceneStr[scene_CampBranchAbilityScene],BRANCH_ABILITY_SHOTEN_TIME))}.bind(this)),bgBox.addChild(this.m_shotenTimeBtn);var shoten_time_label1=cmLabel.getLabel("時間",LABEL_FONT_INDEX.FONT_181);shoten_time_label1.setAnchorPoint(ANCHOR_MIDDLE()),shoten_time_label1.setPosition(ccCenter(this.m_shotenTimeBtn).x,ccCenter(this.m_shotenTimeBtn).y+9),this.m_shotenTimeBtn.addChild(shoten_time_label1);var shoten_time_label2=cmLabel.getLabel("短縮",LABEL_FONT_INDEX.FONT_181);shoten_time_label2.setAnchorPoint(ANCHOR_MIDDLE()),shoten_time_label2.setPosition(ccCenter(this.m_shotenTimeBtn).x,ccCenter(this.m_shotenTimeBtn).y-9),this.m_shotenTimeBtn.addChild(shoten_time_label2);var timeLayer=this.getProgressLayer();timeLayer.setAnchorPoint(ZERO()),timeLayer.setPosition(4,5),bgBox.addChild(timeLayer),this.m_branchScreen=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",cc.rect(0,0,0,0)),this.m_branchScreen.setContentSize(ccSize(bgBox)),this.m_branchScreen.setAnchorPoint(ANCHOR_MIDDLE()),this.m_branchScreen.setPosition(ccCenter(bgBox)),bgBox.addChild(this.m_branchScreen),this.m_branchScreen.setVisible(!1),this.m_bgSelected=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_1.png",cc.rect(0,0,0,0)),this.m_bgSelected.setContentSize(ccWidth(bgBox)-2,ccHeight(bgBox)-2),this.m_bgSelected.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bgSelected.setPosition(ccCenter(bgBox).x,ccCenter(bgBox).y),this.m_bgSelected.setOpacity(0),this.addChild(this.m_bgSelected),this.m_bgSelected.setVisible(!1),this.m_bgSelected2=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_2.png",cc.rect(0,0,0,0)),this.m_bgSelected2.setContentSize(ccWidth(bgBox)-2,ccHeight(bgBox)-2),this.m_bgSelected2.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bgSelected2.setPosition(ccCenter(bgBox).x,ccCenter(bgBox).y),this.m_bgSelected2.setOpacity(0),this.addChild(this.m_bgSelected2),this.m_bgSelected2.setVisible(!1),this.m_bgOnUpgrade=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_3.png",cc.rect(0,0,0,0)),this.m_bgOnUpgrade.setContentSize(ccWidth(bgBox)-2,ccHeight(bgBox)-2),this.m_bgOnUpgrade.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bgOnUpgrade.setPosition(ccCenter(bgBox).x,ccCenter(bgBox).y),this.m_bgOnUpgrade.setOpacity(0),this.addChild(this.m_bgOnUpgrade),this.m_bgOnUpgrade.setVisible(!1),this.m_bgOnUpgrade2=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_4.png",cc.rect(0,0,0,0)),this.m_bgOnUpgrade2.setContentSize(ccWidth(bgBox)-2,ccHeight(bgBox)-2),this.m_bgOnUpgrade2.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bgOnUpgrade2.setPosition(ccCenter(bgBox).x,ccCenter(bgBox).y),this.m_bgOnUpgrade2.setOpacity(0),this.addChild(this.m_bgOnUpgrade2),this.m_bgOnUpgrade2.setVisible(!1)},getProgressLayer:function(){var layer=new cc.Layer,progressBg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_gauge_frame_01.png",RectZero());return progressBg.setAnchorPoint(ZERO()),progressBg.setPosition(0,0),layer.addChild(progressBg),this.m_elapsedGauge=cc.Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_pink.png"),this.m_elapsedGauge.setAnchorPoint(ZERO()),this.m_elapsedGauge.setPosition(3,3),this.m_elapsedGauge.setVisible(!1),this.m_elapsedGauge.setScaleX(0),progressBg.addChild(this.m_elapsedGauge),this.m_timeLabel=cmLabel.getLabel(this.m_upgradeSecond+"時間",LABEL_FONT_INDEX.FONT_161),this.m_timeLabel.setAnchorPoint(ANCHOR_MIDDLE()),this.m_timeLabel.setPosition(ccWidth(progressBg)/2,ccHeight(progressBg)/2),this.m_timeLabel.setVisible(!1),progressBg.addChild(this.m_timeLabel),layer.setContentSize(ccSize(progressBg)),layer},create:function(index,branchAbility){var node=new CampBranchListItemLayer;return node&&node.initLayout(index,branchAbility)?node:null},isSelected:function(){return this.m_selected},isReleased:function(){return this.m_released},setLabelValue:function(addedStat,prevAddedStat,upgradeLevel,isMaxLevel,gapId){if(0==isMaxLevel)1==CAMP_LOVE_STAT_TYPE?(this.m_basicValueLabel.setString((prevAddedStat/PERCENT).toFixed(1)+" %"),null!=this.m_addedValueLabel&&this.m_addedValueLabel.setString((addedStat/PERCENT).toFixed(1)+" %")):(this.m_basicValueLabel.setString(prevAddedStat.toFixed(1)+" %"),null!=this.m_addedValueLabel&&this.m_addedValueLabel.setString(addedStat.toFixed(1)+" %")),this.m_basicLevelLabel.setString(upgradeLevel-1),null!=this.m_addedLevelLabel&&this.m_addedLevelLabel.setString(upgradeLevel);else{this.m_btnDisabled=!0,this.m_selectBtn.setEnabled(!1),this.m_releaseBtn.setEnabled(!1),this.m_shotenTimeBtn.setEnabled(!1),this.m_shotenTimePressed=!1,1==CAMP_LOVE_STAT_TYPE?this.m_basicValueLabel.setString((addedStat/PERCENT).toFixed(1)+" %"):this.m_basicValueLabel.setString(addedStat.toFixed(1)+" %"),this.m_basicLevelLabel.setString(upgradeLevel),this.m_arrow1.setVisible(!1),this.m_addedValueLabel.setVisible(!1),this.m_arrow2.setVisible(!1),this.m_addedLevelLabel.setVisible(!1);var rect=cc.rect(0,0,0,0),btn_screen=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",rect);btn_screen.setContentSize(ccSize(this.m_selectBtn)),btn_screen.setAnchorPoint(ANCHOR_MIDDLE()),btn_screen.setPosition(ccCenter(this.m_selectBtn).x,ccCenter(this.m_selectBtn).y),this.m_selectBtn.addChild(btn_screen),this.m_selectBtn.setVisible(!0),this.m_releaseBtn.setVisible(!1)}},setBtnMode:function(isSelectedBtn){0==this.m_btnDisabled&&(this.m_selected=!1,this.m_released=!1,this.m_shotenTimePressed=!1,this.m_selectBtn.setVisible(!isSelectedBtn),this.m_releaseBtn.setVisible(isSelectedBtn),this.isProgressEnabled()==isSelectedBtn&&this.m_shotenTimeBtn.setEnabled(isSelectedBtn))},setBranchScreen:function(isSet){isSet?(this.m_branchScreen.setVisible(!0),0==this.m_btnDisabled&&(this.m_selectBtn.setEnabled(!1),this.m_releaseBtn.setEnabled(!1),this.m_shotenTimeBtn.setEnabled(!1),this.m_selected=!1,this.m_released=!1,this.m_shotenTimePressed=!1)):(this.m_branchScreen.setVisible(!1),0==this.m_btnDisabled&&(this.m_selectBtn.setEnabled(!0),this.m_releaseBtn.setEnabled(!0),this.m_selected=!1,this.m_released=!1,1==this.isProgressEnabled()&&(this.m_shotenTimeBtn.setEnabled(!0),this.m_shotenTimePressed=!1)))},setProgressEnabled:function(isSet){this.m_elapsedGauge.setVisible(isSet),this.m_timeLabel.setVisible(isSet),this.m_shotenTimeBtn.setEnabled(isSet)},isProgressEnabled:function(){return this.m_elapsedGauge.isVisible()},setProgressValue:function(value){if(this.m_elapsedGauge.isVisible()){if(3600<value){var remainHour=Math.ceil(value/3600);this.m_timeLabel.setString(remainHour+"時間"),remainHour=null}else if(60<value){var remainMinute=Math.ceil(value/60);this.m_timeLabel.setString(remainMinute+"分"),remainMinute=null}else this.m_timeLabel.setString(Math.ceil(value)+"秒");var progress_prnct=(this.m_upgradeSecond-value)/this.m_upgradeSecond;progress_prnct*=470,this.m_elapsedGauge.setScaleX(progress_prnct)}},setProgressBound:function(second){this.m_upgradeSecond=second},getProgressBound:function(){return this.m_upgradeSecond},isShotenTimePressed:function(){return this.m_shotenTimePressed},setShotenTimePressed:function(isSet){this.m_shotenTimePressed=isSet},runListActionSelected:function(enable){if(!this.m_bgOnUpgrade.isVisible())if(enable){this.m_bgSelected.setVisible(!0),this.m_bgSelected.setOpacity(255),this.m_bgSelected2.setVisible(!0),this.m_bgSelected2.setOpacity(255);var fadeIn=cc.fadeIn(.5),fadeOut=cc.fadeOut(.5),seq=cc.sequence(fadeIn,fadeOut),repeat=cc.repeatForever(seq);this.m_bgSelected2.runAction(repeat)}else this.m_bgSelected.setOpacity(0),this.m_bgSelected.setVisible(!1),this.m_bgSelected2.stopAllActions(),this.m_bgSelected2.setOpacity(0),this.m_bgSelected2.setVisible(!1)},runListActionOnUpgrade:function(enable){if(this.m_bgSelected.isVisible()&&this.runListActionSelected(!1),enable){this.m_bgOnUpgrade.setVisible(!0),this.m_bgOnUpgrade.setOpacity(255),this.m_bgOnUpgrade2.setVisible(!0),this.m_bgOnUpgrade2.setOpacity(255);var fadeIn=cc.fadeIn(.5),fadeOut=cc.fadeOut(.5),seq=cc.sequence(fadeIn,fadeOut),repeat=cc.repeatForever(seq);this.m_bgOnUpgrade2.runAction(repeat)}else this.m_bgOnUpgrade.setOpacity(0),this.m_bgOnUpgrade.setVisible(!1),this.m_bgOnUpgrade2.stopAllActions(),this.m_bgOnUpgrade2.setOpacity(0),this.m_bgOnUpgrade2.setVisible(!1)}}),CampBranchYunheeListItemLayer=cc.Layer.extend({m_disabled:!1,m_yunheeSelectLabel:null,m_rareTypeIcon:null,m_yunheeIcon:null,m_slotLock:null,m_cardScreen:null,ctor:function(index,rare_type,user_yunhee){return this._super(),this.initLayout(index,rare_type,user_yunhee),!0},initLayout:function(index,rare_type,user_yunhee){return void 0===user_yunhee?this.getYunheeFrame(index,rare_type):this.getYunheeIcon(index,rare_type,user_yunhee),this.setContentSize(ccWidth(this.m_yunheeIcon)+17,ccHeight(this.m_yunheeIcon)),!0},getYunheeIcon:function(index,rare_type,user_yunhee){var cardInfo={gnrl_id:0,level:0};cardInfo.gnrl_id=user_yunhee.gnrl_id,cardInfo.level=user_yunhee.level,this.m_yunheeIcon=(new Card).createCard(cardInfo,CARD_TYPE.type_common_card),this.m_yunheeIcon.setAnchorPoint(ZERO()),this.m_yunheeIcon.setPosition(0,0),this.addChild(this.m_yunheeIcon);var rect=cc.Rect(0,0,0,0);this.m_cardScreen=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",rect),this.m_cardScreen.setContentSize(98,98),this.m_cardScreen.setAnchorPoint(ANCHOR_MIDDLE()),this.m_cardScreen.setPosition(ccCenter(this.m_yunheeIcon).x,ccCenter(this.m_yunheeIcon).y),this.m_yunheeIcon.addChild(this.m_cardScreen),cardInfo={}},getYunheeFrame:function(index,rare_type){this.m_yunheeIcon=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame_2.png"),this.m_yunheeIcon.setAnchorPoint(ZERO()),this.m_yunheeIcon.setPosition(0,0),this.addChild(this.m_yunheeIcon),0!=rare_type&&(this.m_rareTypeIcon=cc.Sprite.create("#img_card_rare_"+rare_type+".png"),this.m_rareTypeIcon.setAnchorPoint(ANCHOR_MIDDLE()),this.m_rareTypeIcon.setPosition(ccCenter(this.m_yunheeIcon).x,ccCenter(this.m_yunheeIcon).y),this.m_yunheeIcon.addChild(this.m_rareTypeIcon));var rect=cc.Rect(0,0,0,0);this.m_cardScreen=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",rect),this.m_cardScreen.setContentSize(98,98),this.m_cardScreen.setAnchorPoint(ANCHOR_MIDDLE()),this.m_cardScreen.setPosition(ccCenter(this.m_yunheeIcon).x,ccCenter(this.m_yunheeIcon).y),this.m_yunheeIcon.addChild(this.m_cardScreen),this.m_slotLock=cc.Sprite.create(RES_CDN_DEFULT+"common/img_list_lock_3.png"),this.m_slotLock.setAnchorPoint(ANCHOR_MIDDLE()),this.m_slotLock.setPosition(ccCenter(this.m_yunheeIcon).x,ccCenter(this.m_yunheeIcon).y),this.m_yunheeIcon.addChild(this.m_slotLock),this.m_slotLock.setVisible(!1)},setYunheeIcon:function(selectedYunhee,index,rare_type){this.m_yunheeIcon.removeFromParent(),0==selectedYunhee.gnrl_id?this.getYunheeFrame(index,rare_type):this.getYunheeIcon(index,rare_type,selectedYunhee),this.m_cardScreen.setVisible(!1),this.setContentSize(ccWidth(this.m_yunheeIcon)+17,ccHeight(this.m_yunheeIcon)+17)},setCardScreen:function(isSet){isSet?this.m_cardScreen.setVisible(!1):this.m_cardScreen.setVisible(!0)},setDisabled:function(fDisabled){this.m_disabled=fDisabled},isDisabled:function(){return this.m_disabled},setSlotLock:function(fSet){this.m_slotLock.setVisible(fSet),null!=this.m_rareTypeIcon&&this.m_rareTypeIcon.setVisible(!fSet)},onExit:function(){this._super(),1!=PREV_HELP&&(null!=this.m_yunheeIcon&&this.m_yunheeIcon.removeAllChildrenWithCleanup(!0),this.m_rareTypeIcon=null,this.m_yunheeIcon=null,this.m_slotLock=null,this.m_cardScreen=null,delete this.m_slotLock,delete this.m_cardScreen,delete this.m_yunheeIcon,this.removeAllChildrenWithCleanup(!0))}}),CampBranchAbilityLayer=cc.Layer.extend({m_campLevel:0,m_selectedIndex:-1,m_isArrangeMode:!1,m_branchIndex:0,m_loveStatIndex:0,m_materialYunheeSize:0,m_maxMaterialYunheeSize:0,m_rareType:0,m_layer:null,m_leftLayer:null,m_tabLayer:null,m_contentLayer:null,m_tableBranchLayer:null,m_tableYunheeLayer:null,m_yunheeScreenLayer:null,m_warningLayer:null,m_upgradeBtn:null,m_upgradeBtnLayer:null,m_upgradeBtnScreen:null,m_cancelBtn:null,m_assetLabel:null,m_materialLayer:null,m_tabBtn1:null,m_tabBtn2:null,m_tabBtn3:null,m_branchYunheeList:null,m_branchListItemLayers:[],m_branchYunheeItemLayers:[],m_userBranchAbilityList:[],m_userBranchYunheeList:[],m_selectedYunhee:{},ctor:function(){this.m_branchListItemLayers=[],this.m_userBranchAbilityList=[],this.m_userBranchYunheeList=[],this.m_selectedYunhee={},this._super(),this.init()},init:function(){return!0},initLayout:function(){var gameContext=GameContext.getInstance();this.m_campLevel=gameContext.getCampArbeitLevel(),this.m_layer=new cc.Layer,this.addChild(this.m_layer),this.m_leftLayer=this.getLeftBoxLayer(),this.m_leftLayer.setAnchorPoint(ZERO()),this.m_leftLayer.setPosition(LP(this,0,0)),this.m_layer.addChild(this.m_leftLayer,2),this.setMaterialInfo()},setMaterialInfo:function(){this.m_materialLayer=new CampCommonLayer,this.m_materialLayer.setAnchorPoint(ZERO()),this.m_materialLayer.setPosition(LP(this,479,0)),this.m_layer.addChild(this.m_materialLayer);var gnrl_list=[];CampService.getInstance().getUserCampMaterialList(gnrl_list,0),this.m_materialYunheeSize=gnrl_list.length,this.m_materialLayer.setUserGeneralInfo(gnrl_list),this.m_materialLayer.setNotUsePartner(),this.m_materialLayer.setNotUseLockYunhee(),this.m_materialLayer.setUseBranchAbilityInfo(),this.m_materialLayer.setCampSubLayer(SUB_LAYER_BRANCH_ABILITY),this.m_materialLayer.initLayout()},onEnter:function(){this._super()},onExit:function(){this._super(),1!=PREV_HELP&&(this.m_layer=null,this.m_leftLayer=null,this.m_tabLayer=null,this.m_contentLayer=null,this.m_tableBranchLayer=null,this.m_tableYunheeLayer=null,this.m_yunheeScreenLayer=null,this.m_warningLayer=null,this.m_upgradeBtn=null,this.m_upgradeBtnLayer=null,this.m_upgradeBtnScreen=null,this.m_cancelBtn=null,this.m_assetLabel=null,this.m_materialLayer=null,this.m_tabBtn1=null,this.m_tabBtn2=null,this.m_tabBtn3=null,this.m_branchYunheeList=null,this.m_branchListItemLayers=[],this.m_branchYunheeItemLayers=[],this.m_userBranchAbilityList=[],this.m_userBranchYunheeList=[],this.m_selectedYunhee={},delete this.m_tableYunheeLayer,delete this.m_branchYunheeList,this.removeAllChildrenWithCleanup(!0))},setCampBranchYunheeList:function(list){this.m_userBranchYunheeList=list},setCampBranchDataList:function(list){this.m_userBranchAbilityList=list},getLeftBoxLayer:function(){var layer=new cc.Layer;return this.m_tabLayer=this.getTabLayer(),this.m_tabLayer.setAnchorPoint(ZERO()),this.m_tabLayer.setPosition(ZERO()),layer.addChild(this.m_tabLayer,2),this.m_tabLayer.setLocalZOrder(0),this.setTabIndex(BRANCH_ABILITY_TAB_1),layer.addChild(this.m_contentLayer),layer.setContentSize(ccSize(this.m_contentLayer)),layer},getTabLayer:function(){var layer=new cc.Layer;this.m_tabBtn1=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_tabBtn1.setAnchorPoint(ZERO()),this.m_tabBtn1.setFont(LABEL_FONT_INDEX.FONT_241),this.m_tabBtn1.setPosition(17,508),this.m_tabBtn1.setString("剣兵"),this.m_tabBtn1.addClickEventListener(function(){MainObserver.getInstance().postNotification(sceneStr[scene_CampBranchAbilityScene],BRANCH_ABILITY_TAB_1)}),layer.addChild(this.m_tabBtn1),this.m_tabBtn2=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_tabBtn2.setAnchorPoint(ZERO()),this.m_tabBtn2.setFont(LABEL_FONT_INDEX.FONT_241),this.m_tabBtn2.setPosition(this.m_tabBtn1.getPosition().x+ccWidth(this.m_tabBtn1),this.m_tabBtn1.getPosition().y),this.m_tabBtn2.setString("槍兵"),this.m_tabBtn2.addClickEventListener(function(){MainObserver.getInstance().postNotification(sceneStr[scene_CampBranchAbilityScene],BRANCH_ABILITY_TAB_2)}),layer.addChild(this.m_tabBtn2),this.m_tabBtn3=new LabelButton("btn_01_none.png","btn_01_on.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_tabBtn3.setAnchorPoint(ZERO()),this.m_tabBtn3.setFont(LABEL_FONT_INDEX.FONT_241),this.m_tabBtn3.setPosition(this.m_tabBtn2.getPosition().x+ccWidth(this.m_tabBtn2),this.m_tabBtn2.getPosition().y),this.m_tabBtn3.setString("弓兵"),this.m_tabBtn3.addClickEventListener(function(){MainObserver.getInstance().postNotification(sceneStr[scene_CampBranchAbilityScene],BRANCH_ABILITY_TAB_3)}),layer.addChild(this.m_tabBtn3);var help_btn=new ccui.Button;return help_btn.loadTextures("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE),help_btn.setAnchorPoint(ZERO()),help_btn.setPosition(this.m_tabBtn3.getPosition().x+ccWidth(this.m_tabBtn3)+90,this.m_tabBtn3.getPosition().y+15),this.addChild(help_btn),help_btn.addClickEventListener(function(){this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_CampBranchAbilityScene],BRANCH_ABILITY_SHOW_HELP)},0,"BRANCH_ABILITY_SHOW_HELP")}),layer},getContentLayer:function(){var layer=new cc.Layer,bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));return bg_box.setPreferredSize(cc.size(478,515)),bg_box.setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),layer.addChild(bg_box),layer.setContentSize(ccSize(bg_box)),this.m_tableBranchLayer=this.getTableBranchLayer(),this.m_tableBranchLayer.setEnableMouseScroll(!1),this.m_tableBranchLayer.setAnchorPoint(ZERO()),this.m_tableBranchLayer.setPosition(17,214),layer.addChild(this.m_tableBranchLayer),this.m_tableYunheeLayer=this.getTableYunheeLayer(),this.m_tableYunheeLayer.setAnchorPoint(ZERO()),this.m_tableYunheeLayer.setPosition(17,99),layer.addChild(this.m_tableYunheeLayer),this.m_tableYunheeLayer.setVisible(!1),this.m_warningLayer=this.getWarningLayer(),this.m_warningLayer.setAnchorPoint(ZERO()),this.m_warningLayer.setPosition(105,77),layer.addChild(this.m_warningLayer),this.m_warningLayer.setVisible(!1),this.m_upgradeBtnLayer=this.getUpgradeBtnLayer(0),this.m_upgradeBtnLayer.setAnchorPoint(ZERO()),this.m_upgradeBtnLayer.setPosition(17,16),layer.addChild(this.m_upgradeBtnLayer),this.m_upgradeBtnLayer.setVisible(!1),layer},getTableBranchLayer:function(){var tableLayer=new TableViewLayer;return tableLayer.setContentSize(444,282),tableLayer.setItemCount(MAX_BRANCH_ABILITY_NUM),tableLayer.setColumnCount(1),this.m_branchListItemLayers=[],tableLayer.getItemNode=function(index,contentSize,m){for(var idx=0;idx<this.m_userBranchAbilityList.length;idx++){var love_type=(index+1)*CAMP_LOVE_STAT_GAP-CAMP_LOVE_STAT_TYPE;if(this.m_userBranchAbilityList[idx].branch_type==this.m_branchIndex&&this.m_userBranchAbilityList[idx].love_stat_type==love_type){var layer=new CampBranchListItemLayer(index,this.m_userBranchAbilityList[idx]);return"n"==this.m_userBranchAbilityList[idx].complete_yn&&"n"==this.m_userBranchAbilityList[idx].cancel_yn&&(layer.setProgressBound(this.m_userBranchAbilityList[idx].needed_second),layer.setProgressEnabled(!0),layer.runListActionOnUpgrade(!0)),this.m_branchListItemLayers.push(layer),layer}}var abilityId=CampService.getInstance().getNextUserCampBranchAbility(this.m_branchIndex,(index+1)*CAMP_LOVE_STAT_GAP-CAMP_LOVE_STAT_TYPE),abilityData=MasterManager.getInstance().get_CampBranchAbility(abilityId),branchAbility={};branchAbility.love_stat_added=abilityData.love_stat_added,branchAbility.prev_love_stat=0,branchAbility.upgrade_level=1,branchAbility.is_max_level=!1;layer=new CampBranchListItemLayer(index,branchAbility);return this.m_branchListItemLayers.push(layer),layer}.bind(this),tableLayer.initLayout(),tableLayer.setTouchScrollEnabled(!1),tableLayer.onItemTouchBegin=function(index){return!0},tableLayer.onItemTouchMoved=function(isScroll){},tableLayer.onItemTouchCancel=function(index){return!0},tableLayer.onItemTouchEnd=function(index){},tableLayer},getTableYunheeLayer:function(){var tableLayer=new TableViewLayer;return tableLayer.setContentSize(444,110),tableLayer.setEnableMouseScroll(!1),tableLayer.setItemCount(MAX_BRANCH_ABILITY_YUNHEE_NUM),tableLayer.setColumnCount(4),this.m_branchYunheeItemLayers=[],tableLayer.getItemNode=function(index,contentSize,m){if(this.m_userBranchYunheeList.length>index){var userBranchYunhee=this.m_userBranchYunheeList[index];(layer=new CampBranchYunheeListItemLayer(index,this.m_rareType,userBranchYunhee)).setDisabled(!0),this.m_branchYunheeItemLayers.push(layer);var branchYunhee={gnrl_key:{gnrl_id:0,gnrl_num:0}};return branchYunhee.gnrl_key.gnrl_id=userBranchYunhee.gnrl_id,branchYunhee.gnrl_key.gnrl_num=userBranchYunhee.gnrl_num,this.m_branchYunheeList.insert(index,branchYunhee),layer}var layer=new CampBranchYunheeListItemLayer(index,this.m_rareType);return index>=this.m_maxMaterialYunheeSize&&layer.setSlotLock(!0),this.m_branchYunheeItemLayers.push(layer),layer}.bind(this),tableLayer.initLayout(),tableLayer.setTouchScrollEnabled(!1),tableLayer.onItemTouchBegin=function(index){return!0},tableLayer.onItemTouchMoved=function(isScroll){},tableLayer.onItemTouchCancel=function(index){return!0},tableLayer.onItemTouchEnd=function(index){if(0==this.m_branchYunheeItemLayers[index].isDisabled()){if(null==this.m_branchYunheeList)return;var found=this.m_branchYunheeList.at(index);if(null!=found)0!=found.gnrl_key.gnrl_id&&(this.m_selectedIndex=index,this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_CampBranchAbilityScene],CampBranchYunheeListItemEnum.BRANCH_ABILITY_DESELECT_YUNHEE)},0,"BRANCH_ABILITY_DESELECT_YUNHEE"))}return!0}.bind(this),tableLayer},getYunheeScreenLayer:function(){var layer=new cc.Layer,rect=cc.Rect(0,0,0,0),screenImage=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",rect);return screenImage.setContentSize(443,98),screenImage.setAnchorPoint(ZERO()),screenImage.setPosition(ZERO()),layer.addChild(screenImage),layer},getWarningLayer:function(){var layer=new cc.Layer,warning_mark=cc.Sprite.create(RES_CDN_DEFULT+"menu_friend/img_friend_text.png");warning_mark.setAnchorPoint(ZERO()),warning_mark.setPosition(0,0),layer.addChild(warning_mark);var warning_label1=cmLabel.getLabel("スロットに恋姫を入れてください。",LABEL_FONT_INDEX.FONT_1613);return warning_label1.setAnchorPoint(ZERO()),warning_label1.setPosition(36,7),layer.addChild(warning_label1),layer},getUpgradeBtnLayer:function(neededAmount){var layer=new cc.Layer;this.m_upgradeBtn=new ccui.Button,this.m_upgradeBtn.loadTextures("btn_03_off.png","btn_03_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_upgradeBtn.setAnchorPoint(ZERO()),this.m_upgradeBtn.setPosition(0,0),this.m_upgradeBtn.addClickEventListener(function(){MainObserver.getInstance().postNotification(sceneStr[scene_CampBranchAbilityScene],BRANCH_ABILITY_CONFIRM_UPGRADE)}),layer.addChild(this.m_upgradeBtn),this.m_upgradeBtn.setEnabled(!1);var upgrade_label=cmLabel.getLabel("アップグレード",LABEL_FONT_INDEX.FONT_241);upgrade_label.setAnchorPoint(ANCHOR_MIDDLE()),upgrade_label.setPosition(126,ccCenter(this.m_upgradeBtn).y),this.m_upgradeBtn.addChild(upgrade_label);var rect=new cc.Rect(0,0,0,0),input_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",rect);input_bg.setContentSize(130,38),input_bg.setInsetBottom(13),input_bg.setInsetLeft(13),input_bg.setInsetRight(13),input_bg.setInsetTop(13),input_bg.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),input_bg.setPosition(234,ccCenter(this.m_upgradeBtn).y),this.m_upgradeBtn.addChild(input_bg);var gold_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_sell_gold.png");return gold_bg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),gold_bg.setPosition(0,0),input_bg.addChild(gold_bg),NetService().get_UserItemInfo_V2().gold_cnt>=neededAmount?this.m_assetLabel=cmLabel.getLabel(neededAmount,LABEL_FONT_INDEX.FONT_2011):this.m_assetLabel=cmLabel.getLabel(neededAmount,LABEL_FONT_INDEX.FONT_2017),this.m_assetLabel.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_assetLabel.setPosition(ccWidth(input_bg)-10,ccCenter(input_bg).y),gold_bg.addChild(this.m_assetLabel),this.m_cancelBtn=new LabelButton("btn_03_red_off.png","btn_03_red_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_cancelBtn.setFont(LABEL_FONT_INDEX.FONT_241),this.m_cancelBtn.setString("取消"),this.m_cancelBtn.setAnchorPoint(ZERO()),this.m_cancelBtn.setPosition(0,0),this.m_cancelBtn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_CampBranchAbilityScene],BRANCH_ABILITY_CONFIRM_CANCEL)}),this.m_cancelBtn.setVisible(!1),layer.addChild(this.m_cancelBtn),this.m_upgradeBtnScreen=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",rect),this.m_upgradeBtnScreen.setContentSize(ccSize(this.m_upgradeBtn)),this.m_upgradeBtnScreen.setAnchorPoint(ANCHOR_MIDDLE()),this.m_upgradeBtnScreen.setVisible(!1),this.m_upgradeBtnScreen.setPosition(ccCenter(this.m_upgradeBtn).x,ccCenter(this.m_upgradeBtn).y),layer.addChild(this.m_upgradeBtnScreen),layer},setArrangeMode:function(){this.m_isArrangeMode?this.m_isArrangeMode=!1:this.m_isArrangeMode=!0},getArrangeMode:function(){return this.m_isArrangeMode},setYunheeInBranch:function(){var isDeselected=!1;if(this.m_isArrangeMode&&0==this.m_userBranchYunheeList.length){var usedPos=[!1,!1,!1,!1],materialYunhee={gnrl_key:{}};if(this.m_materialLayer.getSelectedYunhee(materialYunhee),this.m_rareType!=materialYunhee.rare_type)return void this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_CampBranchAbilityScene],BRANCH_ABILITY_NOT_EQUAL_RARE_TYPE)},0,"BRANCH_ABILITY_NOT_EQUAL_RARE_TYPE");if(materialYunhee.is_partner)return void this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_CampBranchAbilityScene],BRANCH_ABILITY_NOT_EQUAL_RARE_TYPE)},0,"BRANCH_ABILITY_NOT_EQUAL_RARE_TYPE");if(materialYunhee.is_friend_partner)return void this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_CampBranchAbilityScene],BRANCH_ABILITY_CANNOT_USE_FRIEND_PARTNER)},0,"BRANCH_ABILITY_CANNOT_USE_MAIN_GENERAL");if(materialYunhee.is_lock)return void this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_CampBranchAbilityScene],BRANCH_ABILITY_CANNOT_USE_PARTNER)},0,"BRANCH_ABILITY_CANNOT_USE_PARTNER");for(var keys=this.m_branchYunheeList.keys(),idx=0;idx<keys.length;idx++){var branchYunhee;if(null!=(branchYunhee=this.m_branchYunheeList.at(keys[idx]))){if(branchYunhee.gnrl_key.gnrl_id==materialYunhee.gnrl_key.gnrl_id&&branchYunhee.gnrl_key.gnrl_num==materialYunhee.gnrl_key.gnrl_num){isDeselected=!0,this.m_selectedIndex=keys[idx];break}usedPos[keys[idx]]=!0}}if(0==isDeselected){if(this.m_branchYunheeList.size()>=this.m_maxMaterialYunheeSize)return void this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_CampBranchAbilityScene],BRANCH_ABILITY_SLOT_LACK)},0,"BRANCH_ABILITY_SLOT_LACK");for(var i=0;i<MAX_BRANCH_ABILITY_YUNHEE_NUM;i++)if(0==usedPos[i]){this.m_selectedIndex=i;break}}for(idx=0;idx<this.m_branchYunheeItemLayers.length;idx++)if(this.m_branchYunheeItemLayers[idx].isDisabled())return;if(this.m_selectedYunhee.gnrl_id=materialYunhee.gnrl_key.gnrl_id,this.m_selectedYunhee.gnrl_num=materialYunhee.gnrl_key.gnrl_num,this.m_selectedYunhee.class_type=materialYunhee.class_type,this.m_selectedYunhee.level=materialYunhee.gnrl_level,isDeselected)this.m_materialLayer.deselectYunhee(this.m_selectedYunhee),this.m_selectedYunhee.gnrl_id=0,this.m_selectedYunhee.gnrl_num=0,this.m_selectedYunhee.class_type=0,this.m_branchYunheeList.remove(this.m_selectedIndex);else this.m_materialLayer.setYunheeInMaterial(this.m_selectedIndex),(branchYunhee={gnrl_key:{}}).gnrl_key.gnrl_id=materialYunhee.gnrl_key.gnrl_id,branchYunhee.gnrl_key.gnrl_num=materialYunhee.gnrl_key.gnrl_num,this.m_branchYunheeList[this.m_selectedIndex]=branchYunhee;this.setYunheeIcon(this.m_selectedYunhee,this.m_selectedIndex,!1),this.m_branchYunheeList.size()>=this.m_maxMaterialYunheeSize?this.setEnableUpgradeBtn(!0):this.setEnableUpgradeBtn(!1)}},isEmptyBranchYunees:function(){for(var found in this.m_branchYunheeList){if(0!=found.second.gnrl_key.gnrl_id)return!1}return!0},setYunheeIcon:function(yunhee,index,set_screen){var g=MasterManager.getInstance().get_General(yunhee.gnrl_id);null==g.gnrl_id?(yunhee.name="",yunhee.cost=0,yunhee.fight_type=0,yunhee.state_type=0,yunhee.force_type=0,yunhee.max_class_type=0,yunhee.rare_type=0):(yunhee.name=g.name,yunhee.cost=g.cost,yunhee.fight_type=g.fight_type,yunhee.state_type=g.state_type,yunhee.force_type=g.arm_service_type,yunhee.max_class_type=g.evolution_max_class_type,yunhee.rare_type=g.rare_type);var layer=this.m_branchYunheeItemLayers[index];layer.setYunheeIcon(yunhee,index,this.m_rareType),1==set_screen&&layer.setSlotLock(!0)},getBranchAbilityYunhees:function(){return this.m_branchYunheeList},setTabIndex:function(index){var fIsFirst=!0;switch(0!=this.m_branchIndex&&(fIsFirst=!1,this.m_selectedIndex=-1,this.m_isArrangeMode=!1,this.m_loveStatIndex=-1,this.m_maxMaterialYunheeSize=0,this.m_branchYunheeList=new Map,this.m_materialLayer.removeFromParent(),this.m_contentLayer.removeFromParent(),this.unscheduleAllCallbacks()),this.m_branchIndex=index-BRANCH_ABILITY_TAB_1+1,this.m_tabBtn1.setEnabled(!0),this.m_tabBtn2.setEnabled(!0),this.m_tabBtn3.setEnabled(!0),index){case BRANCH_ABILITY_TAB_1:this.m_tabBtn1.setEnabled(!1);break;case BRANCH_ABILITY_TAB_2:this.m_tabBtn2.setEnabled(!1);break;case BRANCH_ABILITY_TAB_3:this.m_tabBtn3.setEnabled(!1)}var branch_ability_list=[];CampService.getInstance().getRunningUserCampBranchAbility(branch_ability_list,this.m_branchIndex),this.setCampBranchDataList(branch_ability_list),this.m_userBranchYunheeList=[],this.m_contentLayer=this.getContentLayer(),this.m_contentLayer.setAnchorPoint(ZERO()),this.m_contentLayer.setPosition(ZERO()),0==fIsFirst&&(this.m_leftLayer.addChild(this.m_contentLayer),this.setMaterialInfo()),this.updateProgress();for(var i=0;i<this.m_branchListItemLayers.length;i++){this.m_branchListItemLayers[i].isProgressEnabled()&&this.schedule(function(float){this.updateProgress()}.bind(this),1,""+this.m_branchIndex*MAX_BRANCH_ABILITY_NUM+i)}},getTabIndex:function(){return this.m_branchIndex},getLoveStatIndex:function(){return this.m_loveStatIndex},getPressedShotenTimeBtn:function(){for(var i=0;i<MAX_BRANCH_ABILITY_NUM;i++){if(this.m_branchListItemLayers[i].isShotenTimePressed())return(i+1)*CAMP_LOVE_STAT_GAP-CAMP_LOVE_STAT_TYPE}return-1},setLoveStatIndex:function(){if(0<this.m_materialYunheeSize){for(var love_stat_type,index=-1,i=0;i<MAX_BRANCH_ABILITY_NUM;i++){var branchItemLayer=this.m_branchListItemLayers[i];branchItemLayer.isSelected()?(branchItemLayer.setBtnMode(!0),index=i,branchItemLayer.runListActionSelected(!0)):(branchItemLayer.setBranchScreen(!0),branchItemLayer.runListActionSelected(!1))}love_stat_type=(index+1)*CAMP_LOVE_STAT_GAP-CAMP_LOVE_STAT_TYPE;var branch_ability_yunhee_list=[],campService=CampService.getInstance();campService.getUserCampBranchAbilityYunheeList(branch_ability_yunhee_list,this.m_branchIndex,love_stat_type),this.setCampBranchYunheeList(branch_ability_yunhee_list),this.m_isArrangeMode=!0,this.m_selectedIndex=-1;var abilityId=campService.getNextUserCampBranchAbility(this.m_branchIndex,love_stat_type),abilityData=MasterManager.getInstance().get_CampBranchAbility(abilityId);this.m_maxMaterialYunheeSize=abilityData.yunhee_bound,this.m_rareType=abilityData.rare_type,this.m_materialLayer.setUseRareType(this.m_rareType),this.m_loveStatIndex!=love_stat_type?(this.m_loveStatIndex=love_stat_type,this.m_branchYunheeList=new Map,this.m_tableYunheeLayer.removeFromParent(),this.m_tableYunheeLayer=this.getTableYunheeLayer(),this.m_tableYunheeLayer.setAnchorPoint(ZERO()),this.m_tableYunheeLayer.setPosition(17,99),this.m_contentLayer.addChild(this.m_tableYunheeLayer),this.m_warningLayer.removeFromParent(),this.m_warningLayer=this.getWarningLayer(),this.m_warningLayer.setAnchorPoint(ZERO()),this.m_warningLayer.setPosition(105,77),this.m_contentLayer.addChild(this.m_warningLayer),this.m_upgradeBtnLayer.removeFromParent(),this.m_upgradeBtnLayer=this.getUpgradeBtnLayer(abilityData.needed_amount),this.m_upgradeBtnLayer.setAnchorPoint(ZERO()),this.m_upgradeBtnLayer.setPosition(17,16),this.m_contentLayer.addChild(this.m_upgradeBtnLayer),this.m_branchListItemLayers[index].setProgressBound(abilityData.needed_second),0<this.m_userBranchYunheeList.length?(this.m_upgradeBtn.setEnabled(!1),this.m_upgradeBtn.setVisible(!1),this.m_cancelBtn.setEnabled(!0),this.m_cancelBtn.setVisible(!0),this.m_upgradeBtnScreen.setVisible(!1),this.m_warningLayer.setVisible(!1),this.m_branchListItemLayers[index].setProgressEnabled(!0),this.m_branchListItemLayers[index].runListActionOnUpgrade(!0),this.updateProgress(),this.schedule(function(float){this.updateProgress()},1,""+this.m_branchIndex*MAX_BRANCH_ABILITY_NUM+(this.m_loveStatIndex+CAMP_LOVE_STAT_TYPE)/CAMP_LOVE_STAT_GAP)):(this.m_upgradeBtn.setEnabled(!1),this.m_cancelBtn.setEnabled(!1),this.m_upgradeBtnScreen.setVisible(!0),this.m_warningLayer.setVisible(!0))):0==this.isEmptyBranchYunees()?0<this.m_userBranchYunheeList.length?(this.m_upgradeBtn.setEnabled(!1),this.m_upgradeBtn.setVisible(!1),this.m_cancelBtn.setEnabled(!0),this.m_cancelBtn.setVisible(!0),this.m_upgradeBtnScreen.setVisible(!1),this.m_branchListItemLayers[index].setProgressEnabled(!0),this.m_branchListItemLayers[index].runListActionOnUpgrade(!0),this.updateProgress(),this.schedule(function(float){this.updateProgress()},1,""+this.m_branchIndex*MAX_BRANCH_ABILITY_NUM+(this.m_loveStatIndex+CAMP_LOVE_STAT_TYPE)/CAMP_LOVE_STAT_GAP)):this.m_branchYunheeList.size()>=this.m_maxMaterialYunheeSize?(this.m_upgradeBtn.setEnabled(!0),this.m_upgradeBtnScreen.setVisible(!1)):(this.m_upgradeBtn.setEnabled(!1),this.m_upgradeBtnScreen.setVisible(!0)):(this.m_upgradeBtn.setEnabled(!1),this.m_cancelBtn.setEnabled(!1),this.m_upgradeBtnScreen.setVisible(!0));for(var idx=0;idx<this.m_branchYunheeItemLayers.length;idx++)this.m_branchYunheeItemLayers[idx].setCardScreen(!0);0==this.m_userBranchYunheeList.length&&this.m_materialLayer.setUseCardScreen(!1),this.m_upgradeBtnLayer.setVisible(!0),this.m_tableYunheeLayer.setVisible(!0),this.m_warningLayer.setVisible(!0)}},releaseLoveStatIndex:function(){this.m_isArrangeMode=!1,this.m_selectedIndex=-1,this.m_loveStatIndex=-1;for(var idx=0;idx<this.m_branchListItemLayers.length;idx++){var branchItemLayer=this.m_branchListItemLayers[idx];branchItemLayer.setBtnMode(!1),branchItemLayer.setBranchScreen(!1),branchItemLayer.runListActionSelected(!1)}for(idx=0;idx<this.m_branchYunheeItemLayers.length;idx++)this.m_branchYunheeItemLayers[idx].setCardScreen(!1);this.m_materialLayer.deselectAllYunhee(),this.m_materialLayer.setUseCardScreen(!0),this.m_upgradeBtn.setEnabled(!1),this.m_cancelBtn.setEnabled(!1),this.m_upgradeBtnScreen.setVisible(!0),this.m_warningLayer.setVisible(!1),this.m_upgradeBtnLayer.setVisible(!1),this.m_tableYunheeLayer.setVisible(!1)},setEnableUpgradeBtn:function(enabled){enabled?(this.m_upgradeBtn.setEnabled(!0),this.m_upgradeBtnScreen.setVisible(!1)):(this.m_upgradeBtn.setEnabled(!1),this.m_upgradeBtnScreen.setVisible(!0))},startBranchAbility:function(){this.m_upgradeBtn.setEnabled(!1),this.m_upgradeBtn.setVisible(!1),this.m_cancelBtn.setEnabled(!0),this.m_cancelBtn.setVisible(!0);for(var idx=0;idx<this.m_branchYunheeItemLayers.length;idx++)this.m_branchYunheeItemLayers[idx].setDisabled(!0);this.m_branchListItemLayers[(this.m_loveStatIndex+CAMP_LOVE_STAT_TYPE)/CAMP_LOVE_STAT_GAP-1].setProgressEnabled(!0),this.m_branchListItemLayers[(this.m_loveStatIndex+CAMP_LOVE_STAT_TYPE)/CAMP_LOVE_STAT_GAP-1].runListActionOnUpgrade(!0),this.updateProgress(),this.schedule(function(float){this.updateProgress()},1,""+this.m_branchIndex*MAX_BRANCH_ABILITY_NUM+(this.m_loveStatIndex+CAMP_LOVE_STAT_TYPE)/CAMP_LOVE_STAT_GAP),this.m_materialLayer.deselectAllYunhee(),this.m_materialLayer.clearSelectedIndex();for(var keys=this.m_branchYunheeList.keys(),found=0;found<keys.length;found++){var branchYunhee=this.m_branchYunheeList.at(keys[found]);0!=branchYunhee.gnrl_key.gnrl_id&&0!=branchYunhee.gnrl_key.gnrl_num&&this.m_materialLayer.setUsingYunhee(branchYunhee.gnrl_key.gnrl_id,branchYunhee.gnrl_key.gnrl_num)}this.releaseLoveStatIndex(),this.m_loveStatIndex=-1},cancelBranchAbility:function(){this.m_assetLabel.setString("0"),this.m_upgradeBtn.setEnabled(!1),this.m_upgradeBtn.setVisible(!0),this.m_cancelBtn.setEnabled(!1),this.m_cancelBtn.setVisible(!1);for(var layer=0;layer<this.m_branchYunheeItemLayers.length;layer++)this.m_branchYunheeItemLayers[layer].setDisabled(!1);this.m_branchListItemLayers[(this.m_loveStatIndex+CAMP_LOVE_STAT_TYPE)/CAMP_LOVE_STAT_GAP-1].setProgressEnabled(!1),this.m_branchListItemLayers[(this.m_loveStatIndex+CAMP_LOVE_STAT_TYPE)/CAMP_LOVE_STAT_GAP-1].runListActionOnUpgrade(!1),this.m_selectedYunhee.gnrl_id=0,this.m_selectedYunhee.gnrl_num=0;for(var i=this.m_selectedYunhee.class_type=0;i<MAX_BRANCH_ABILITY_YUNHEE_NUM;i++)this.setYunheeIcon(this.m_selectedYunhee,i,!0);this.unschedule(this.m_branchIndex*MAX_BRANCH_ABILITY_NUM+(this.m_loveStatIndex+CAMP_LOVE_STAT_TYPE)/CAMP_LOVE_STAT_GAP),this.m_materialLayer.clearSelectedIndex();for(var keys=this.m_branchYunheeList.keys(),found=0;found<keys.length;found++){var branchYunhee=this.m_branchYunheeList.at(keys[found]);0!=branchYunhee.gnrl_key.gnrl_id&&0!=branchYunhee.gnrl_key.gnrl_num&&this.m_materialLayer.setCancelYunhee(branchYunhee.gnrl_key.gnrl_id,branchYunhee.gnrl_key.gnrl_num,!0)}keys=null,this.m_branchYunheeList=new Map,this.releaseLoveStatIndex(),this.m_loveStatIndex=-1},deselectYunhee:function(){if(-1<this.m_selectedIndex){var found=this.m_branchYunheeList.at(this.m_selectedIndex);if(null!=found){var branchYunhee=found;this.m_selectedYunhee.gnrl_id=branchYunhee.gnrl_key.gnrl_id,this.m_selectedYunhee.gnrl_num=branchYunhee.gnrl_key.gnrl_num,this.m_materialLayer.deselectYunhee(this.m_selectedYunhee),this.m_branchYunheeList.remove(this.m_selectedIndex),this.m_selectedYunhee.gnrl_id=0,this.m_selectedYunhee.gnrl_num=0,this.m_selectedYunhee.class_type=0,this.setYunheeIcon(this.m_selectedYunhee,this.m_selectedIndex,!1),this.m_branchYunheeList.size()>=this.m_maxMaterialYunheeSize?this.setEnableUpgradeBtn(!0):this.setEnableUpgradeBtn(!1)}}},upgradeCompleteBranchAbility:function(){for(var i=0;i<this.m_branchListItemLayers.length;i++){var layer=this.m_branchListItemLayers[i];if(layer.isProgressEnabled()){var timeEngine=TimeEventEngine.getInstance(),remain_second=0;if(timeEngine.existTimeEvent(TIME_EVENT_CAMP_BRANCH_ABILITY_1+(this.m_branchIndex-1)*MAX_BRANCH_ABILITY_NUM+i)&&(remain_second=timeEngine.getSecond(TIME_EVENT_CAMP_BRANCH_ABILITY_1+(this.m_branchIndex-1)*MAX_BRANCH_ABILITY_NUM+i)),remain_second<=0){this.unschedule(this.m_branchIndex*MAX_BRANCH_ABILITY_NUM+i+1),this.m_assetLabel.setString("0"),this.m_upgradeBtn.setEnabled(!1),this.m_upgradeBtn.setVisible(!0),this.m_cancelBtn.setEnabled(!1),this.m_cancelBtn.setVisible(!1),layer.setProgressEnabled(!1),layer.runListActionOnUpgrade(!1),this.m_selectedYunhee.gnrl_id=0,this.m_selectedYunhee.gnrl_num=0;for(var j=this.m_selectedYunhee.class_type=0;j<MAX_BRANCH_ABILITY_YUNHEE_NUM;j++)this.setYunheeIcon(this.m_selectedYunhee,j,!0);var campService=CampService.getInstance(),abilityId=campService.getNextUserCampBranchAbility(this.m_branchIndex,(i+1)*CAMP_LOVE_STAT_GAP-CAMP_LOVE_STAT_TYPE);if(cc.log("abilityId ============== "+abilityId),0!=abilityId){var abilityData=(m=MasterManager.getInstance()).get_CampBranchAbility(abilityId),prev_abilityId=campService.getPrevUserCampBranchAbility(this.m_branchIndex,(i+1)*CAMP_LOVE_STAT_GAP-CAMP_LOVE_STAT_TYPE),prevAbilityData=m.get_CampBranchAbility(prev_abilityId);cc.log("prev_abilityId ============== "+prev_abilityId),cc.log("====="+abilityData.love_stat_added+"======="+prevAbilityData.love_stat_added+"=========="+abilityData.upgrade_level),layer.setLabelValue(abilityData.love_stat_added,prevAbilityData.love_stat_added,abilityData.upgrade_level,!1,i)}else{var m,maxLevel=campService.getMaxCampBranchAbilityLevel(this.m_branchIndex,(i+1)*CAMP_LOVE_STAT_GAP-CAMP_LOVE_STAT_TYPE);abilityId=campService.getPrevUserCampBranchAbility(this.m_branchIndex,(i+1)*CAMP_LOVE_STAT_GAP-CAMP_LOVE_STAT_TYPE),maxLevel==(abilityData=(m=MasterManager.getInstance()).get_CampBranchAbility(abilityId)).upgrade_level?layer.setLabelValue(abilityData.love_stat_added,abilityData.love_stat_added,abilityData.upgrade_level,!0,i):layer.setLabelValue(0,0,0,!0,i)}}}}this.releaseLoveStatIndex(),this.m_loveStatIndex=-1,this.m_materialLayer.removeFromParent(),this.setMaterialInfo()},getNeededAssetAmount:function(){return this.m_assetLabel.getString()},updateProgress:function(){for(var i=0;i<this.m_branchListItemLayers.length;i++){var layer=this.m_branchListItemLayers[i];if(layer.isProgressEnabled()){var timeEngine=TimeEventEngine.getInstance(),remain_second=0;timeEngine.existTimeEvent(TIME_EVENT_CAMP_BRANCH_ABILITY_1+(this.m_branchIndex-1)*MAX_BRANCH_ABILITY_NUM+i)&&(remain_second=timeEngine.getSecond(TIME_EVENT_CAMP_BRANCH_ABILITY_1+(this.m_branchIndex-1)*MAX_BRANCH_ABILITY_NUM+i)),remain_second<=0&&this.unschedule(this.m_branchIndex*MAX_BRANCH_ABILITY_NUM+i+1),layer.setProgressValue(remain_second)}}},sortMaterialYunhee:function(){this.m_materialLayer.sortMaterialLayer()},shotenBranchAbilityTime:function(complete_yn){this.updateProgress(),"y"==complete_yn&&this.upgradeCompleteBranchAbility()},releaseShotenTimeBtn:function(){if(0<this.m_loveStatIndex)this.m_branchListItemLayers[(this.m_loveStatIndex+CAMP_LOVE_STAT_TYPE)/CAMP_LOVE_STAT_GAP-1].setShotenTimePressed(!1);else for(var i=0;i<MAX_BRANCH_ABILITY_NUM;i++){var branchItemLayer=this.m_branchListItemLayers[i];branchItemLayer.isShotenTimePressed()&&branchItemLayer.setShotenTimePressed(!1)}}}),TAB_TYPE_LIMIT_OVER_CARD=1,TAB_TYPE_MAGIC_KEY=2,TAB_TYPE_JADE_PIECE=3,CRAFT_SHOP_SHOW_HELP=100,CampFactory=cc.Class.extend({factory_id:0,camp_type:0,camp_appearance:0,tab_type:0,factory_mtrl_type:0,need_mtrl_type:0,need_mtrl_cnt:0,cmplt_item_type:0,min_value:0,max_value:0,m_count_background:null,m_exchangecount:null,ctor:function(){this.factory_id=0,this.camp_type=0,this.camp_appearance=0,this.tab_type=0,this.factory_mtrl_type=0,this.need_mtrl_type=0,this.need_mtrl_cnt=0,this.cmplt_item_type=0,this.min_value=0,this.max_value=0}}),CampFactoryLayer=cc.Layer.extend({m_item_idx:-1,m_tab_idx:1,m_bonus_type:0,m_leftBoxLayer:null,m_user_make_count_label:null,m_tab_limit_over_card:null,m_tab_magic_key:null,m_tab_jade_piece:null,m_tableview_mask:null,m_tableView:null,m_factory_tab_list:[],m_factory_all_list:[],m_prev_dt:null,m_item_frame:null,m_item_plus_btn:null,m_item_minus_btn:null,m_max_btn:null,m_min_btn:null,m_exchange_btn:null,m_buy_count:0,m_count_background:null,m_exchangecount:null,m_mtrlCellList:[],m_rightBoxLayer:null,ctor:function(){this._super(),this.m_factory_tab_list=[],this.m_factory_all_list=[],this.m_mtrlCellList=[]},onExit:function(){this._super(),1!=PREV_HELP&&(this.m_exchange_btn=null,this.m_max_btn=null,this.m_min_btn=null,this.m_item_plus_btn=null,this.m_item_minus_btn=null,this.m_exchangecount=null,this.m_count_background=null,this.m_item_frame=null,this.m_tab_limit_over_card=null,this.m_tab_magic_key=null,this.m_tab_jade_piece=null,this.m_factory_tab_list=[],this.m_factory_tab_list=null,delete this.m_factory_tab_list,this.m_factory_all_list=[],this.m_factory_all_list=null,delete this.m_factory_all_list,this.m_mtrlCellList.forEach(function(t){t.removeAllChildrenWithCleanup(!0)}),this.m_mtrlCellList=[],null!=this.m_leftBoxLayer&&(this.m_leftBoxLayer.removeAllChildrenWithCleanup(!0),this.m_leftBoxLayer=null,delete this.m_leftBoxLayer),null!=this.m_rightBoxLayer&&(this.m_rightBoxLayer.removeAllChildrenWithCleanup(!0),this.m_rightBoxLayer=null,delete this.m_rightBoxLayer),this.removeAllChildrenWithCleanup(!0))},setCampFactoryList:function(factory_list){this.m_factory_all_list=factory_list},initLayout:function(){var bg=new cc.Sprite(RES_CDN_DEFULT+"common/bg_sub_2.png");bg.setPosition(ccCenter(this)),USE_SP_COMMON_SUB_BG_SCALE&&bg.setScale(2),this.addChild(bg);var btn_name_list=[];btn_name_list.push("btn_17_on.png"),btn_name_list.push("btn_17_none.png"),btn_name_list.push("btn_17_off.png");var x=ccWidth(this)-574;this.m_tab_limit_over_card=new LabelButton(btn_name_list[1],btn_name_list[0],btn_name_list[2],ccui.Widget.PLIST_TEXTURE),this.m_tab_limit_over_card.setFont(LABEL_FONT_INDEX.FONT_201),this.m_tab_limit_over_card.setString(res_str("label_factory_tab_limit_over_ticket")),this.m_tab_limit_over_card.setAnchorPoint(ZERO()),this.m_tab_limit_over_card.setPosition(x,508),this.m_tab_limit_over_card.addClickEventListener(function(sender){this.setTab(TAB_TYPE_LIMIT_OVER_CARD),this.m_item_plus_btn.setVisible(!1),this.m_max_btn.setVisible(!1),this.m_item_minus_btn.setVisible(!1),this.m_min_btn.setVisible(!1),this.m_count_background.setVisible(!1)}.bind(this)),this.addChild(this.m_tab_limit_over_card,1),this.m_tab_limit_over_card.setEnabled(!1),x+=ccWidth(this.m_tab_limit_over_card),this.m_tab_magic_key=new LabelButton(btn_name_list[1],btn_name_list[0],btn_name_list[2],ccui.Widget.PLIST_TEXTURE),this.m_tab_magic_key.setFont(LABEL_FONT_INDEX.FONT_201),this.m_tab_magic_key.setString(res_str("label_factory_tab_magic_key")),this.m_tab_magic_key.setAnchorPoint(ZERO()),this.m_tab_magic_key.setPosition(x,508),this.m_tab_magic_key.addClickEventListener(function(sender){this.setTab(TAB_TYPE_MAGIC_KEY),this.m_item_plus_btn.setVisible(!1),this.m_max_btn.setVisible(!1),this.m_item_minus_btn.setVisible(!1),this.m_min_btn.setVisible(!1),this.m_count_background.setVisible(!1)}.bind(this)),this.addChild(this.m_tab_magic_key,1),x+=ccWidth(this.m_tab_magic_key),this.m_tab_jade_piece=new LabelButton(btn_name_list[1],btn_name_list[0],btn_name_list[2],ccui.Widget.PLIST_TEXTURE),this.m_tab_jade_piece.setFont(LABEL_FONT_INDEX.FONT_201),this.m_tab_jade_piece.setString(res_str("label_factory_tab_jade_piece")),this.m_tab_jade_piece.setAnchorPoint(ZERO()),this.m_tab_jade_piece.setPosition(x,508),this.m_tab_jade_piece.addClickEventListener(function(sender){this.setTab(TAB_TYPE_JADE_PIECE),this.m_item_plus_btn.setVisible(!1),this.m_max_btn.setVisible(!1),this.m_item_minus_btn.setVisible(!1),this.m_min_btn.setVisible(!1),this.m_count_background.setVisible(!1)}.bind(this)),this.addChild(this.m_tab_jade_piece,1),btn_name_list=null,this.setTabFactoryList(),this.m_rightBoxLayer=this.getRightBoxLayer(),this.m_rightBoxLayer.ignoreAnchorPointForPosition(!1),this.m_rightBoxLayer.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_rightBoxLayer.setPosition(ccWidth(this),0),this.addChild(this.m_rightBoxLayer,100),this.m_exchange_btn=new LabelButton("btn_24_off.png","btn_24_on.png","btn_24_none.png",ccui.Widget.PLIST_TEXTURE),this.m_exchange_btn.setFont(LABEL_FONT_INDEX.FONT_241,!1),this.m_exchange_btn.setString(res_str("btn_bonus_change")),this.m_exchange_btn.setAnchorPoint(ZERO()),this.m_exchange_btn.setPosition((ccWidth(this)-600)/2-ccWidth(this.m_exchange_btn)/2,16),this.m_exchange_btn.setEnabled(!1),this.m_exchange_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(MENU_NOTIFY_FACTORY_EXCHANGE)}),this.addChild(this.m_exchange_btn,1),this.m_max_btn=new LabelButton("btn_eventvs_green_off.png","btn_eventvs_green_on.png","btn_eventvs_green_none.png",ccui.Widget.PLIST_TEXTURE),this.m_max_btn.setFont(LABEL_FONT_INDEX.FONT_201),this.m_max_btn.setString(res_str("btn_label_max_value")),this.m_max_btn.setAnchorPoint(ZERO()),this.m_max_btn.setPosition((ccWidth(this)-600)/2+77,105),this.addChild(this.m_max_btn,1),this.m_max_btn.addClickEventListener(function(){this.onItemMax()}.bind(this)),this.m_max_btn.setEnabled(!1),this.m_item_plus_btn=new ccui.Button,this.m_item_plus_btn.loadTextures("btn_spinner_plus_off.png","btn_spinner_plus_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_item_plus_btn.setAnchorPoint(ZERO()),this.m_item_plus_btn.setPosition((ccWidth(this)-600)/2+32,105),this.addChild(this.m_item_plus_btn,1),this.m_item_plus_btn.addClickEventListener(function(){this.onItemPlus()}.bind(this)),this.m_item_plus_btn.setEnabled(!1),this.m_min_btn=new LabelButton("btn_eventvs_green_off.png","btn_eventvs_green_on.png","btn_eventvs_green_none.png",ccui.Widget.PLIST_TEXTURE),this.m_min_btn.setFont(LABEL_FONT_INDEX.FONT_201),this.m_min_btn.setString(res_str("btn_label_min_value")),this.m_min_btn.setAnchorPoint(ZERO()),this.m_min_btn.setPosition((ccWidth(this)-600)/2-153,105),this.addChild(this.m_min_btn,1),this.m_min_btn.addClickEventListener(function(){this.onItemMin()}.bind(this)),this.m_min_btn.setEnabled(!1),this.m_item_minus_btn=new ccui.Button,this.m_item_minus_btn.loadTextures("btn_spinner_minus_off.png","btn_spinner_minus_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_item_minus_btn.setAnchorPoint(ZERO()),this.m_item_minus_btn.setPosition((ccWidth(this)-600)/2-78,105),this.addChild(this.m_item_minus_btn,1),this.m_item_minus_btn.addClickEventListener(function(){this.onItemMinus()}.bind(this)),this.m_item_minus_btn.setEnabled(!1),this.m_count_background=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",cc.Rect(3,3,22,22)),this.m_count_background.setAnchorPoint(ZERO()),this.m_count_background.setPreferredSize(cc.size(57,38)),this.m_count_background.setPosition((ccWidth(this)-600)/2-ccWidth(this.m_count_background)/2,105),this.addChild(this.m_count_background,1),this.m_exchangecount=cmLabel.getLabel(cmString("%s",Number(Math.floor(this.m_buy_count)).toLocaleString("en")),LABEL_FONT_INDEX.FONT_207),this.m_exchangecount.setAnchorPoint(ANCHOR_MIDDLE()),this.m_exchangecount.setPosition(ccCenter(this.m_count_background)),this.m_count_background.addChild(this.m_exchangecount),this.m_item_plus_btn.setVisible(!1),this.m_max_btn.setVisible(!1),this.m_item_minus_btn.setVisible(!1),this.m_min_btn.setVisible(!1),this.m_count_background.setVisible(!1);var help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE);help_btn.setAnchorPoint(ZERO()),help_btn.setPosition(ccPos(this.m_tab_limit_over_card).x-ccWidth(help_btn)-10,520),this.addChild(help_btn),help_btn.addClickEventListener(function(sender){this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_CampFactoryScene],CRAFT_SHOP_SHOW_HELP)},0,"COST_SHOW_HELP")}),USE_SP_CAMP_SCALE?(this.m_item_frame=new cc.Sprite(RES_CDN_DEFULT+"menu_camp/img_camp_item_frame.png"),this.m_item_frame.setAnchorPoint(ZERO()),this.m_item_frame.setPosition((ccWidth(this)-600)/2-ccWidth(this.m_item_frame)/2,309),this.m_item_frame.setScale(2)):(this.m_item_frame=new cc.Sprite(RES_CDN_DEFULT+"menu_camp/img_camp_item_frame.png"),this.m_item_frame.setAnchorPoint(ZERO()),this.m_item_frame.setPosition((ccWidth(this)-600)/2-ccWidth(this.m_item_frame)/2,309)),this.addChild(this.m_item_frame),this.m_item_frame.setVisible(!1)},setTab:function(idx){if(this.m_item_idx=-1,this.m_tab_idx=idx,this.m_select_item=null,this.m_select_item=new CampFactory,this.setTabFactoryList(),this.m_tab_limit_over_card.setEnabled(!0),this.m_tab_magic_key.setEnabled(!0),null!=this.m_tab_jade_piece&&this.m_tab_jade_piece.setEnabled(!0),this.m_tableview_mask.setVisible(!1),this.m_tableView.setTouchEnabled(!0),null!=this.m_user_make_count_label&&(this.m_user_make_count_label.removeFromParent(),this.m_user_make_count_label=null),idx==TAB_TYPE_LIMIT_OVER_CARD)this.m_item_frame.setVisible(!1),this.m_tab_limit_over_card.setEnabled(!1);else if(idx==TAB_TYPE_MAGIC_KEY){this.m_item_frame.setVisible(!0);var level=CampService.getInstance().getUserCampFactoryLevel();this.m_tab_magic_key.setEnabled(!1),level<2&&(this.m_tableview_mask.setVisible(!0),this.m_tableView.setTouchEnabled(!1))}else idx==TAB_TYPE_JADE_PIECE&&(this.m_item_frame.setVisible(!0),null!=this.m_tab_jade_piece&&this.m_tab_jade_piece.setEnabled(!1));null!=this.m_leftBoxLayer&&(this.m_leftBoxLayer.removeFromParent(),this.m_leftBoxLayer=null),null!=this.m_item_plus_btn&&this.m_item_plus_btn.setEnabled(!1),null!=this.m_max_btn&&this.m_max_btn.setEnabled(!1),null!=this.m_item_minus_btn&&this.m_item_minus_btn.setEnabled(!1),null!=this.m_min_btn&&this.m_min_btn.setEnabled(!1),null!=this.m_exchange_btn&&(this.m_exchange_btn.setString(res_str("btn_style_bonus_change")),this.m_exchange_btn.setEnabled(!1)),this.m_tableView.reloadData()},getFactoryItem:function(){return this.m_select_item},getFactoryBuyCount:function(){return this.m_buy_count},getRightBoxLayer:function(){var layer=new cc.Layer,mt=MasterManager.getInstance(),box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));box.setAnchorPoint(ZERO()),box.setPosition(ZERO()),box.setContentSize(cc.size(592,515)),layer.addChild(box),layer.setContentSize(ccSize(box)),this.m_tableView=new cc.TableView(this,cc.size(592,479)),this.m_tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_tableView.setVerticalFillOrder(0),this.m_tableView.setPosition(17,18),this.m_tableView.setDelegate(this),layer.addChild(this.m_tableView),this.m_tableView.reloadData(),this.m_tableview_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero()),this.m_tableview_mask.setPreferredSize(cc.size(557,480)),this.m_tableview_mask.setPosition(17,18),this.m_tableview_mask.setAnchorPoint(ZERO()),layer.addChild(this.m_tableview_mask),this.m_tableview_mask.setVisible(!1);var tableview_info_label=cmLabel.getLabel(mt.get_LanguageData("label_not_enough_factory_level"),LABEL_FONT_INDEX.FONT_261);return tableview_info_label.setPosition(ccCenter(this.m_tableview_mask).x,ccCenter(this.m_tableview_mask).y-30),tableview_info_label.enableOutline(cc.color.BLACK,2),this.m_tableview_mask.addChild(tableview_info_label),layer},tableCellEnded:function(){return!0},setTabFactoryList:function(){this.m_factory_tab_list=[];for(var idx=0;idx<this.m_factory_all_list.length;idx++){var i=this.m_factory_all_list[idx];i.tab_type==this.m_tab_idx&&this.m_factory_tab_list.push(i)}},isSelectedLimitOverBtn:function(){return!this.m_tab_limit_over_card.isEnabled()},cellSizeForTable:function(table){var visibleSize=cc.size(444,124);return cc.size(visibleSize.width,visibleSize.height)},tableCellSizeForIndex:function(){return cc.size(444,124)},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;null!=c?cell=c:((cell=new LimitOverMtrlListCell)._callback_choice_item=this.choiceItem.bind(this),cell._callback_shortcuts_item=this.shortcutsItem.bind(this));var factory=this.m_factory_tab_list[idx];return cell.setFactoryData(factory,idx==this.m_item_idx),this.m_mtrlCellList.push(cell),cell},numberOfCellsInTableView:function(){return this.m_factory_tab_list.length},shortcutsItem:function(idx){var factory=this.m_factory_tab_list[idx],bonut_type=0;factory.factory_mtrl_type==CAMP_FACTORY_MTRL_LIMIT_OVER?bonut_type=GeneralService.getInstance().getLimitOverMtrlTypeToBonusType(factory.need_mtrl_type):factory.factory_mtrl_type==CAMP_FACTORY_MTRL_MAGIC_KEY?bonut_type=BONUS_TYPE_MAGIC_KEY_MTRL:factory.factory_mtrl_type==CAMP_FACTORY_MTRL_JADE_PIECE&&(bonut_type=BONUS_TYPE_JADE_PIECE),MainObserver.getInstance().postNotification(NOTIFICATION_EVOLUTION_MTRL_SHORTCUTS,bonut_type),factory=null},choiceItem:function(idx){this.m_item_idx=idx;for(var used=this.m_tableView.getCellsUsed(),jdx=0;jdx<used.length;jdx++){var uc=used[jdx];this.m_tableView.updateCellAtIndex(uc.getIdx())}this.m_factory_tab_list.length>this.m_item_idx&&(this.setSelectFactoryItem(),this.m_select_item=this.m_factory_tab_list[idx])},setSelectFactoryItem:function(){null!=this.m_user_make_count_label&&(this.m_user_make_count_label.removeFromParent(),this.m_user_make_count_label=null),null!=this.m_leftBoxLayer&&(this.m_leftBoxLayer.removeFromParent(),this.m_leftBoxLayer=null);var item=this.m_factory_tab_list[this.m_item_idx];if(item.tab_type==TAB_TYPE_LIMIT_OVER_CARD)if(item.cmplt_item_type==BONUS_TYPE_YUNHEE_FIX)this.m_leftBoxLayer=this.getLimitOverCardLayer(item.min_value),this.addChild(this.m_leftBoxLayer);else{var limit_over_mtrl_type=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(item.cmplt_item_type);this.m_leftBoxLayer=this.getLimitOverMtrlLayer(limit_over_mtrl_type),this.addChild(this.m_leftBoxLayer)}else this.m_leftBoxLayer=this.getLeftLayer(item.cmplt_item_type),this.addChild(this.m_leftBoxLayer);var user_count=CampService.getInstance().getUserCampFactoryMtrlCount(item.factory_mtrl_type,item.need_mtrl_type);if(this.m_buy_count=0,user_count>=item.need_mtrl_cnt&&(this.m_buy_count=1),item.tab_type==TAB_TYPE_MAGIC_KEY&&item.cmplt_item_type==BONUS_TYPE_MAGIC_KEY){null!=this.m_item_plus_btn&&this.m_item_plus_btn.setVisible(!1),null!=this.m_max_btn&&this.m_max_btn.setVisible(!1),null!=this.m_item_minus_btn&&this.m_item_minus_btn.setVisible(!1),null!=this.m_min_btn&&this.m_min_btn.setVisible(!1),null!=this.m_exchange_btn&&this.m_exchange_btn.setString(res_str("btn_style_bonus_change")),null!=this.m_count_background&&this.m_count_background.setVisible(!1);var count_function=MasterManager.getInstance().get_CountFunction(COUNT_FUNCTION_MAGIC_KEY_MAX_COUNT);NetService().get_User_Plus_Key_Bound()>=count_function.value?this.m_exchange_btn.setEnabled(!1):this.m_exchange_btn.setEnabled(!0)}else{null!=this.m_exchange_btn&&this.m_exchange_btn.setEnabled(!0);var is_enable=0<user_count&&user_count>=item.need_mtrl_cnt*(this.m_buy_count+1);if(item.cmplt_item_type==BONUS_TYPE_KEY_REFILL)is_enable=!(NetService().getUserKeyRecoveryMakeCount()>=(count_function=MasterManager.getInstance().get_CountFunction(COUNT_FUNCTION_CAMP_MAKE_KEY_RECOVERY_MAX_COUNT)).value),this.m_exchange_btn.setEnabled(is_enable);null!=this.m_item_plus_btn&&(this.m_item_plus_btn.setVisible(!0),this.m_item_plus_btn.setEnabled(is_enable)),null!=this.m_max_btn&&(this.m_max_btn.setVisible(!0),this.m_max_btn.setEnabled(is_enable)),null!=this.m_item_minus_btn&&(this.m_item_minus_btn.setVisible(!0),this.m_item_minus_btn.setEnabled(!1)),null!=this.m_min_btn&&(this.m_min_btn.setVisible(!0),this.m_min_btn.setEnabled(!1)),null!=this.m_exchange_btn&&this.m_exchange_btn.setString(res_str("btn_style_bonus_change")),null!=this.m_count_background&&(this.m_count_background.setVisible(!0),this.m_exchangecount.setString(cmString("%s",Number(Math.floor(this.m_buy_count)).toLocaleString("en"))))}user_count=CampService.getInstance().getUserCampFactoryMtrlCount(item.factory_mtrl_type,item.need_mtrl_type);Math.floor(user_count/item.need_mtrl_cnt)<=0?(this.m_exchange_btn.setEnabled(!1),this.m_min_btn.setEnabled(!1),this.m_max_btn.setEnabled(!1),this.m_item_minus_btn.setEnabled(!1),this.m_item_plus_btn.setEnabled(!1)):Math.floor(user_count/item.need_mtrl_cnt)<=1&&(this.m_min_btn.setEnabled(!1),this.m_max_btn.setEnabled(!1),this.m_item_minus_btn.setEnabled(!1),this.m_item_plus_btn.setEnabled(!1)),item=null},getLimitOverCardLayer:function(gnrl_id){var layer=new cc.Layer,m=MasterManager.getInstance(),card=cc.Sprite.create(),general=m.get_General(gnrl_id),img_scale=1;if(general.gnrl_type==GENERAL_TYPE_YUNHEE){if(m.get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var img_str=getCardBody_ImageStr(general.gnrl_id);img_scale=getCardBody_Scale(general.gnrl_id),card.setTexture(img_str)}else card.setTexture(RES_CDN_DEFULT+"card_standing_body/"+general.gnrl_group+".png")}else{img_str=getCardBody_ImageStr(general.gnrl_id);img_scale=getCardBody_Scale(general.gnrl_id),card.setTexture(img_str)}card.setAnchorPoint(ZERO()),card.setScale(img_scale),card.setPosition(ZERO()),layer.addChild(card);var name_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_3.png",cc.Rect(15,15,10,10));name_box.setContentSize(cc.size(221,31)),name_box.setAnchorPoint(ZERO()),name_box.setPosition((ccWidth(this)-600)/2-ccWidth(name_box)/2,235),layer.addChild(name_box,99);var gnrl_name=cmLabel.getLabel(general.name,LABEL_FONT_INDEX.FONT_227);gnrl_name.setAnchorPoint(ANCHOR_MIDDLE()),gnrl_name.setPosition(ccCenter(name_box)),gnrl_name.enableOutline(cc.color.BLACK,1),name_box.addChild(gnrl_name,2);var info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_2.png",cc.Rect(15,16,30,28));info_box.setContentSize(cc.size(323,177)),info_box.setAnchorPoint(ZERO()),info_box.setPosition((ccWidth(this)-600)/2-ccWidth(info_box)/2,76),layer.addChild(info_box);var info_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181);info_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),info_label.enableOutline(cc.color.BLACK,1),layer.addChild(info_label,1);var info_label_2=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181);return info_label_2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),info_label_2.enableOutline(cc.color.BLACK,1),layer.addChild(info_label_2,1),66666==gnrl_id?(info_label.setString(res_str("label_camp_make_ssr_limit_msg_1")),info_label.setPosition((ccWidth(this)-600)/2,184),info_label_2.setString(res_str("label_camp_make_ssr_limit_msg_2")),info_label_2.setPosition((ccWidth(this)-600)/2,164)):55555==gnrl_id&&(info_label.setString(res_str("label_camp_make_sr_limit_msg_1")),info_label.setPosition((ccWidth(this)-600)/2,184),info_label_2.setString(res_str("label_camp_make_sr_limit_msg_2")),info_label_2.setPosition((ccWidth(this)-600)/2,164)),layer},itemExchangeComplete:function(factory_list){this.m_factory_all_list=factory_list,this.setTabFactoryList();for(var idx=0;idx<this.m_factory_tab_list.length;idx++){var i=this.m_factory_tab_list[idx];if(i.factory_id==this.m_select_item.factory_id){this.m_select_item=i;break}}if(this.m_tableView.reloadData(),null!=this.m_user_make_count_label){var mt=MasterManager.getInstance();if(this.m_bonus_type==BONUS_TYPE_MAGIC_KEY){var count_function=mt.get_CountFunction(COUNT_FUNCTION_MAGIC_KEY_MAX_COUNT),user_plus_key_bound=NetService().get_User_Plus_Key_Bound();this.m_user_make_count_label.setString(user_plus_key_bound+"/"+count_function.value)}else this.m_bonus_type==BONUS_TYPE_KEY_REFILL&&this.updateUserKeyRecoveryCount()}},getLimitOverMtrlLayer:function(limit_over_mtrl_type){var layer=new cc.Layer,l=MasterManager.getInstance().get_LimitOverMtrlType(limit_over_mtrl_type),bonus_type=GeneralService.getInstance().getLimitOverMtrlTypeToBonusType(limit_over_mtrl_type),icon=cc.Sprite.create("#img_reward_"+leadingZeros(bonus_type,2)+"_d.png");icon.setAnchorPoint(ZERO()),icon.setPosition((ccWidth(this)-600)/2-ccWidth(icon)/2,177),layer.addChild(icon);var name_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_3.png",RectZero());name_box.setAnchorPoint(ZERO()),name_box.setPosition((ccWidth(this)-600)/2-ccWidth(name_box)/2,160),layer.addChild(name_box);var name=cmLabel.getLabel(l.name,LABEL_FONT_INDEX.FONT_221);return name.setAnchorPoint(ANCHOR_MIDDLE()),name.setPosition(ccCenter(name_box)),name.enableOutline(cc.color.BLACK,1),name_box.addChild(name),layer},getLeftLayer:function(bonus_type){this.unscheduleUpdate();var layer=new cc.Layer;this.m_bonus_type=bonus_type;var item_frame,m=MasterManager.getInstance(),b=m.get_BonusType(bonus_type);USE_SP_CAMP_SCALE?((item_frame=cc.Sprite.create(RES_CDN_DEFULT+"menu_camp/img_camp_item_frame.png")).setAnchorPoint(ZERO()),item_frame.setPosition((ccWidth(this)-600)/2-ccWidth(item_frame)/2,309),item_frame.setScale(2),layer.addChild(item_frame)):((item_frame=cc.Sprite.create(RES_CDN_DEFULT+"menu_camp/img_camp_item_frame.png")).setAnchorPoint(ZERO()),item_frame.setPosition((ccWidth(this)-600)/2-ccWidth(item_frame)/2,309),layer.addChild(item_frame));var icon=cc.Sprite.create("#img_reward_"+leadingZeros(bonus_type,2)+"_d.png");if(icon.setAnchorPoint(ANCHOR_MIDDLE()),icon.setPosition((ccWidth(this)-600)/2-ccWidth(icon)/2,309),item_frame.addChild(icon,1),USE_SP_CAMP_SCALE){bonus_type==BONUS_TYPE_MAGIC_KEY?(icon.setTexture(RES_CDN_DEFULT+"menu_camp/img_camp_key_2.png"),icon.setPosition(29,34)):bonus_type==BONUS_TYPE_KEY_REFILL?(icon.setTexture(RES_CDN_DEFULT+"menu_camp/img_camp_key.png"),icon.setPosition(ccCenter(item_frame))):bonus_type==BONUS_TYPE_JADE&&(icon.setTexture(RES_CDN_DEFULT+"menu_camp/img_camp_jade.png"),icon.setPosition(ccCenter(item_frame)));var info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_2.png",RectZero());bonus_type==BONUS_TYPE_MAGIC_KEY?info_box.setPreferredSize(cc.size(323,104)):info_box.setPreferredSize(cc.size(323,177)),info_box.setAnchorPoint(ZERO()),info_box.setPosition((ccWidth(this)-600)/2-ccWidth(info_box)/2,76),layer.addChild(info_box)}else{bonus_type==BONUS_TYPE_MAGIC_KEY?(icon.setTexture(RES_CDN_DEFULT+"menu_camp/img_camp_key_2.png"),icon.setPosition(64,70)):bonus_type==BONUS_TYPE_KEY_REFILL?(icon.setTexture(RES_CDN_DEFULT+"menu_camp/img_camp_key.png"),icon.setPosition(69,72)):bonus_type==BONUS_TYPE_JADE&&(icon.setTexture(RES_CDN_DEFULT+"menu_camp/img_camp_jade.png"),icon.setPosition(ccCenter(item_frame)));info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_2.png",RectZero());bonus_type==BONUS_TYPE_MAGIC_KEY?info_box.setPreferredSize(cc.size(323,104)):info_box.setPreferredSize(cc.size(323,177)),info_box.setAnchorPoint(ZERO()),info_box.setPosition((ccWidth(this)-600)/2-ccWidth(info_box)/2,76),layer.addChild(info_box)}var name_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_3.png",RectZero());name_box.setPreferredSize(cc.size(221,31)),name_box.setAnchorPoint(ZERO()),bonus_type==BONUS_TYPE_MAGIC_KEY?name_box.setPosition((ccWidth(this)-600)/2-ccWidth(name_box)/2,162):name_box.setPosition((ccWidth(this)-600)/2-ccWidth(name_box)/2,235),layer.addChild(name_box);var name=cmLabel.getLabel(b.name,LABEL_FONT_INDEX.FONT_221);name.setAnchorPoint(ANCHOR_MIDDLE()),name.setPosition(ccCenter(name_box)),name.enableOutline(cc.color.BLACK,1),name_box.addChild(name),name.setColor(cc.color(255,181,84)),this.m_user_make_count_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.m_user_make_count_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bonus_type==BONUS_TYPE_MAGIC_KEY?this.m_user_make_count_label.setPosition((ccWidth(this)-600)/2,141):this.m_user_make_count_label.setPosition((ccWidth(this)-600)/2,204),this.m_user_make_count_label.enableOutline(cc.color.BLACK,1),layer.addChild(this.m_user_make_count_label);var info_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181);info_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),info_label.enableOutline(cc.color.BLACK,1),layer.addChild(info_label);var info_label_2=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181);info_label_2.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),info_label_2.enableOutline(cc.color.BLACK,1),layer.addChild(info_label_2);var mt=MasterManager.getInstance();if(bonus_type==BONUS_TYPE_MAGIC_KEY){var count_function=mt.get_CountFunction(COUNT_FUNCTION_MAGIC_KEY_MAX_COUNT),user_plus_key_bound=NetService().get_User_Plus_Key_Bound();this.m_user_make_count_label.setString(cmString("%d/%d",user_plus_key_bound,count_function.value)),this.m_user_make_count_label.setColor(cc.color(255,181,84)),info_label.setString(cmString(m.get_LanguageData("label_magic_key_make_max_count_info_label"),count_function.value)),info_label.setPosition((ccWidth(this)-600)/2,115)}else if(bonus_type==BONUS_TYPE_KEY_REFILL){var now=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME);this.m_prev_dt=moment(now),this.scheduleUpdate(),this.updateUserKeyRecoveryCount(),this.m_user_make_count_label.setColor(cc.color(255,181,84)),info_label.setString(res_str("label_camp_recovery_key_info_msg_1")),info_label.setPosition((ccWidth(this)-600)/2,184),info_label_2.setString(res_str("label_camp_recovery_key_info_msg_2")),info_label_2.setPosition((ccWidth(this)-600)/2,164),now=null}else bonus_type==BONUS_TYPE_JADE&&(info_label.setString(res_str("label_camp_make_jude")),info_label.setPosition((ccWidth(this)-600)/2,184));return layer},update:function(dt){var now_dt=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME),now=moment(now_dt);now.date();if(now.date()!=this.m_prev_dt.date()){var req={};req.opcode=net.OP.op_get_user_magic_key_mtrl;var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent),this.unscheduleUpdate()}this.m_prev_dt=moment(now)},updateUserKeyRecoveryCount:function(){var mt=MasterManager.getInstance(),user_key_recovery_make_count=NetService().getUserKeyRecoveryMakeCount(),count_function=mt.get_CountFunction(COUNT_FUNCTION_CAMP_MAKE_KEY_RECOVERY_MAX_COUNT);this.m_user_make_count_label.setString(cmString("%d/%d",user_key_recovery_make_count,count_function.value))},tableCellTouched:function(table,cell){null!=cell&&cell.touchPosInCell(cell.getTouchPos())},tableCellHighlight:function(table,cell){null!=cell&&cell.highlightPosInCell(cell.getTouchPos())},tableCellUnhighlight:function(table,cell){null!=cell&&cell.unhighlightPosInCell(cell.getTouchPos())},onItemPlus:function(){var item=this.m_factory_tab_list.at(this.m_item_idx),user_count=CampService.getInstance().getUserCampFactoryMtrlCount(item.factory_mtrl_type,item.need_mtrl_type);0<user_count&&user_count>=item.need_mtrl_cnt*(this.m_buy_count+1)&&(this.m_buy_count++,999<this.m_buy_count&&(this.m_buy_count=999));var is_enable=0<user_count&&user_count>=item.need_mtrl_cnt*(this.m_buy_count+1),mt=MasterManager.getInstance();if(item.tab_type==TAB_TYPE_MAGIC_KEY)if(this.m_bonus_type==BONUS_TYPE_MAGIC_KEY){var count_function=mt.get_CountFunction(COUNT_FUNCTION_MAGIC_KEY_MAX_COUNT),user_plus_key_bound=NetService().get_User_Plus_Key_Bound();this.m_buy_count>count_function.value-user_plus_key_bound&&(is_enable=!1,this.m_buy_count=count_function.value-user_plus_key_bound)}else if(this.m_bonus_type==BONUS_TYPE_KEY_REFILL){count_function=mt.get_CountFunction(COUNT_FUNCTION_CAMP_MAKE_KEY_RECOVERY_MAX_COUNT);var user_key_recovery_make_count=NetService().getUserKeyRecoveryMakeCount();this.m_buy_count>count_function.value-user_key_recovery_make_count&&(is_enable=!1,this.m_buy_count=count_function.value-user_key_recovery_make_count)}null!=this.m_item_plus_btn&&this.m_item_plus_btn.setEnabled(is_enable),null!=this.m_max_btn&&this.m_max_btn.setEnabled(is_enable),null!=this.m_item_minus_btn&&this.m_item_minus_btn.setEnabled(!0),null!=this.m_min_btn&&this.m_min_btn.setEnabled(!0),null!=this.m_exchange_btn&&this.m_exchange_btn.setString(res_str("btn_style_bonus_change")),null!=this.m_count_background&&(this.m_count_background.setVisible(!0),this.m_exchangecount.setString(cmString("%s",Number(Math.floor(this.m_buy_count)).toLocaleString("en"))))},onItemMinus:function(){var item=this.m_factory_tab_list.at(this.m_item_idx);CampService.getInstance().getUserCampFactoryMtrlCount(item.factory_mtrl_type,item.need_mtrl_type);1<this.m_buy_count&&this.m_buy_count--;var is_enable=1<this.m_buy_count;null!=this.m_item_plus_btn&&this.m_item_plus_btn.setEnabled(!0),null!=this.m_max_btn&&this.m_max_btn.setEnabled(!0),null!=this.m_item_minus_btn&&this.m_item_minus_btn.setEnabled(is_enable),null!=this.m_min_btn&&this.m_min_btn.setEnabled(is_enable),null!=this.m_exchange_btn&&this.m_exchange_btn.setString(res_str("btn_style_bonus_change")),null!=this.m_count_background&&(this.m_count_background.setVisible(!0),this.m_exchangecount.setString(cmString("%s",Number(Math.floor(this.m_buy_count)).toLocaleString("en"))))},onItemMax:function(){var item=this.m_factory_tab_list.at(this.m_item_idx),user_count=CampService.getInstance().getUserCampFactoryMtrlCount(item.factory_mtrl_type,item.need_mtrl_type);this.m_buy_count=Math.floor(user_count/item.need_mtrl_cnt),999<this.m_buy_count&&(this.m_buy_count=999);var mt=MasterManager.getInstance();if(item.tab_type==TAB_TYPE_MAGIC_KEY)if(this.m_bonus_type==BONUS_TYPE_MAGIC_KEY){var count_function=mt.get_CountFunction(COUNT_FUNCTION_MAGIC_KEY_MAX_COUNT),user_plus_key_bound=NetService().get_User_Plus_Key_Bound();this.m_buy_count>count_function.value-user_plus_key_bound&&(this.m_buy_count=count_function.value-user_plus_key_bound)}else if(this.m_bonus_type==BONUS_TYPE_KEY_REFILL){count_function=mt.get_CountFunction(COUNT_FUNCTION_CAMP_MAKE_KEY_RECOVERY_MAX_COUNT);var user_key_recovery_make_count=NetService().getUserKeyRecoveryMakeCount();this.m_buy_count>count_function.value-user_key_recovery_make_count&&(this.m_buy_count=count_function.value-user_key_recovery_make_count)}null!=this.m_item_plus_btn&&this.m_item_plus_btn.setEnabled(!1),null!=this.m_max_btn&&this.m_max_btn.setEnabled(!1),null!=this.m_item_minus_btn&&this.m_item_minus_btn.setEnabled(!0),null!=this.m_min_btn&&this.m_min_btn.setEnabled(!0),null!=this.m_exchange_btn&&this.m_exchange_btn.setString(res_str("btn_style_bonus_change")),null!=this.m_count_background&&(this.m_count_background.setVisible(!0),this.m_exchangecount.setString(cmString("%s",Number(Math.floor(this.m_buy_count)).toLocaleString("en"))))},onItemMin:function(){var item=this.m_factory_tab_list.at(this.m_item_idx);CampService.getInstance().getUserCampFactoryMtrlCount(item.factory_mtrl_type,item.need_mtrl_type);this.m_buy_count=1,null!=this.m_item_plus_btn&&this.m_item_plus_btn.setEnabled(!0),null!=this.m_max_btn&&this.m_max_btn.setEnabled(!0),null!=this.m_item_minus_btn&&this.m_item_minus_btn.setEnabled(!1),null!=this.m_min_btn&&this.m_min_btn.setEnabled(!1),null!=this.m_exchange_btn&&this.m_exchange_btn.setString(res_str("btn_style_bonus_change")),null!=this.m_count_background&&(this.m_count_background.setVisible(!0),this.m_exchangecount.setString(cmString("%s",Number(Math.floor(this.m_buy_count)).toLocaleString("en"))))},initFactoryBuyCount:function(){var item=this.m_factory_tab_list.at(this.m_item_idx),user_count=CampService.getInstance().getUserCampFactoryMtrlCount(item.factory_mtrl_type,item.need_mtrl_type);this.m_buy_count=0,user_count>=item.need_mtrl_cnt&&(this.m_buy_count=1)}}),CAMP_FACTORY_GET_MAIL_INFO=!1,CAMP_FACTORY_GET_ITEM_INFO=!1,CampFactoryScene=GameScene.extend({m_isEnalbleTouch:!1,m_factoryLayer:null,m_exchangeEffectLayer:null,m_complteModalLayer:null,m_skeletonEffectNode:null,m_mtrlShortcutsModalLayer:null,m_gameObserver:null,m_resources:[],m_isExchangeItem:!1,m_isMailing:!1,ctor:function(){this._super(scene_CampFactoryScene),CAMP_FACTORY_GET_ITEM_INFO=CAMP_FACTORY_GET_MAIL_INFO=PREV_HELP=!1,this.m_isExchangeItem=!1,this.m_isMailing=!1},init:function(){this.m_resources=[],this.m_resources.push(RES_CDN_DEFULT+"menu_camp/img_camp_item_frame.png"),USE_SHORTCUT_EVOLUTION_ICON?(this.m_resources.push(RES_CDN_DEFULT+"icon/shortcut_evolution/"+SHORTCUT_EVOLUTION_TEXTURE+".plist"),this.m_resources.push(RES_CDN_DEFULT+"icon/shortcut_evolution/"+SHORTCUT_EVOLUTION_TEXTURE+".png")):(this.m_resources.push(RES_CDN_DEFULT+"icon/evolve_small/"+ICON_EVOLVE_SMALL_TEXTURE+".plist"),this.m_resources.push(RES_CDN_DEFULT+"icon/evolve_small/"+ICON_EVOLVE_SMALL_TEXTURE+".png"),this.m_resources.push(RES_CDN_DEFULT+"icon/formation/"+FORMATION_TEXTURE+".plist"),this.m_resources.push(RES_CDN_DEFULT+"icon/formation/"+FORMATION_TEXTURE+".png")),resourceLoader(this.m_resources,function(){USE_SHORTCUT_EVOLUTION_ICON?cc.spriteFrameCache.addSpriteFrames(RES_CDN_DEFULT+"icon/shortcut_evolution/"+SHORTCUT_EVOLUTION_TEXTURE+".plist"):(cc.spriteFrameCache.addSpriteFrames(RES_CDN_DEFULT+"icon/evolve_small/"+ICON_EVOLVE_SMALL_TEXTURE+".plist"),cc.spriteFrameCache.addSpriteFrames(RES_CDN_DEFULT+"icon/formation/"+FORMATION_TEXTURE+".plist"));var factory_list=CampService.getInstance().getCampFactoryList();this.m_factoryLayer=new CampFactoryLayer,this.m_factoryLayer.setCampFactoryList(factory_list),this.m_factoryLayer.initLayout(),this.addChild(this.m_factoryLayer);var title,statusLayer=new StatusLayer;(statusLayer.initLayout(),statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer),USE_SP_CAMP_SCALE)?((title=cc.Sprite.create(RES_CDN_DEFULT+"menu_camp/img_camp_text_camp.png")).setAnchorPoint(ZERO()),title.setPosition(90,585),title.setScale(2),this.addChild(title)):((title=cc.Sprite.create(RES_CDN_DEFULT+"menu_camp/img_camp_text_camp.png")).setAnchorPoint(ZERO()),title.setPosition(90,585),this.addChild(title));var back_btn=new ccui.Button;back_btn.loadTextures("btn_home_off.png","btn_home_on.png","",ccui.Widget.PLIST_TEXTURE),back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(10,559),back_btn.addClickEventListener(function(sender){this.back()}.bind(this)),this.addChild(back_btn),this.m_exchangeEffectLayer=new GameModalLayer,this.addChild(this.m_exchangeEffectLayer,99999),this.m_mtrlShortcutsModalLayer=new ShortcutsLayer,this.addChild(this.m_mtrlShortcutsModalLayer,9999),this.m_complteModalLayer=new GameModalLayer,this.addChild(this.m_complteModalLayer)}.bind(this))},onNotification:function(msg){if(this._super(msg))return!1;if(msg==MENU_NOTIFY_FACTORY_EXCHANGE){var item=this.m_factoryLayer.getFactoryItem();if(null!=item&&0!=item.factory_id){if(item.factory_mtrl_type==CAMP_FACTORY_MTRL_MAGIC_KEY){if(!CampService.getInstance().isEnableCampFactoryLevelCheck(item.factory_mtrl_type))return USE_POPUP_INTERGRATION?this.showCampFactoryPopup(res_str("label_shop_buy_jade_omission_title"),res_str("label_not_enough_factory_level")):this.showNotEnoughFactoryLevel(),!0;var mt=MasterManager.getInstance();if(item.cmplt_item_type==BONUS_TYPE_MAGIC_KEY){var count_function=mt.get_CountFunction(COUNT_FUNCTION_MAGIC_KEY_MAX_COUNT);if(NetService().get_User_Plus_Key_Bound()>=count_function.value)return USE_POPUP_INTERGRATION?this.showCampFactoryPopup(res_str("label_magic_key_make_max_count_title"),res_str("label_magic_key_make_max_count_text_1")):this.showIsMaxMakeMagicKey(),!0}else if(item.cmplt_item_type==BONUS_TYPE_KEY_REFILL){if(NetService().getUserKeyRecoveryMakeCount()>=(count_function=mt.get_CountFunction(COUNT_FUNCTION_CAMP_MAKE_KEY_RECOVERY_MAX_COUNT)).value)return USE_POPUP_INTERGRATION?this.showCampFactoryPopup(res_str("label_magic_key_make_max_count_title"),res_str("label_not_make_key_recovery_text_1")):this.showIsMaxKeyRecoveryCount(),!0}}Math.floor(this.m_factoryLayer.getFactoryBuyCount());CampService.getInstance().isEnableCampFactoryExchage(item.factory_mtrl_type,item.need_mtrl_type,item.need_mtrl_cnt)?this.showItemExchange():USE_POPUP_INTERGRATION?this.showCampFactoryPopup(res_str("label_factory_item_exchange_not_enough_mtrl_title"),res_str("label_factory_item_exchange_not_enough_mtrl_text_1")):this.showNotEnoughMaterial()}else USE_POPUP_INTERGRATION?this.showCampFactoryPopup(res_str("label_event_dungeon_reward_complete_title"),res_str("label_factory_item_not_select")):this.showNotSelectItem();item=null}else if(msg==CRAFT_SHOP_SHOW_HELP){var help_call_index=0;help_call_index=this.m_factoryLayer.isSelectedLimitOverBtn()?200:201,PREV_HELP=!0,GameContext.getInstance().setHelpInfoIndexByCallIndex(help_call_index);var scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null}else msg==NOT_OPEN_WORLD_WAR?USE_POPUP_INTERGRATION?this.showCampFactoryPopup(res_str("world_war_season_over_title_1"),res_str("world_war_season_over_text_1")):this.showNotOpenWorldWarPopup():msg==NOT_OPEN_RAID_BOSS&&(USE_POPUP_INTERGRATION?this.showCampFactoryPopup(res_str("label_camp_not_open_raid_boss_title"),res_str("label_camp_not_open_raid_boss")):this.showNotOpenRaidBossPopup());return!0},showExchangeEffect:function(){this.m_exchangeEffectLayer.setContentSize(ccSize(this)),this.m_exchangeEffectLayer._contentNode=function(contentSize,m){var layer=new cc.Layer;layer.setContentSize(ccSize(this));var ani_img_1=cc.Sprite.create();ani_img_1.setAnchorPoint(ANCHOR_MIDDLE()),ani_img_1.setPosition(LP(240,403)),layer.addChild(ani_img_1);var callBack=cc.callFunc(this.spineEffectStart,this);ani_img_1.runAction(callBack);var spineBackground=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Fade.json",RES_CDN_DEFULT+"effect/Fade.atlas",1);return spineBackground.setPosition(ccCenter(layer)),spineBackground.setAnimation(0,"fx_1",!1),layer.addChild(spineBackground),this.m_skeletonEffectNode=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Enchant.json",RES_CDN_DEFULT+"effect/Enchant.atlas",.33),this.m_skeletonEffectNode.setPosition((ccWidth(layer)-600)/2,ccCenter(layer).y),this.m_skeletonEffectNode.setOpacity(0),layer.addChild(this.m_skeletonEffectNode),layer}.bind(this),this.m_exchangeEffectLayer.show();var path=RES_CDN_SOUND+SND_TYPE+"sound/SE_growth.mp3";AudioEngine.getInstance().playEffect(path)},spineEffectStart:function(){var ani_img_1=new cc.Sprite;ani_img_1.setAnchorPoint(ANCHOR_MIDDLE()),ani_img_1.setPosition(LP(this,240,403)),this.addChild(ani_img_1);var callBack=cc.callFunc(this.effectComplete,this);ani_img_1.runAction(cc.sequence(cc.delayTime(1.8),callBack)),this.m_skeletonEffectNode.setOpacity(255),this.m_skeletonEffectNode.setAnimation(0,"fx_1",!0)},onNotificationShortcuts:function(sender){var tag=sender,shortcuts=GeneralService.getInstance().getShortcutList(tag);0!=shortcuts.length&&(this.m_mtrlShortcutsModalLayer.setShortcutsInfo(shortcuts),this.m_mtrlShortcutsModalLayer.show())},effectComplete:function(){var factory_list=CampService.getInstance().getCampFactoryList();this.m_exchangeEffectLayer.hide(),this.m_factoryLayer.itemExchangeComplete(factory_list),this.showExchangeComplete(),factory_list=null},showExchangeComplete:function(){this.m_isEnalbleTouch=!1;var item=this.m_factoryLayer.getFactoryItem(),mt=MasterManager.getInstance();this.m_complteModalLayer.setContentSize(ccSize(this)),this.m_complteModalLayer._contentNode=function(contentSize,m){var layer=new cc.Layer;layer.setContentSize(ccSize(this));var back_effect=cc.Sprite.create("#img_attend_effect.png");back_effect.setPosition((ccWidth(layer)-600)/2,ccCenter(layer).y),layer.addChild(back_effect);var action=cc.rotateBy(1,180),repeat=cc.repeatForever(action);back_effect.runAction(repeat);var bonus_icon=new cc.Sprite;if(item.cmplt_item_type==BONUS_TYPE_YUNHEE_FIX){var frame=cc.spriteFrameCache.getSpriteFrame("img_reward_"+leadingZeros(item.min_value,2)+"_d.png");bonus_icon.setSpriteFrame(frame)}else if(item.cmplt_item_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL){var limit_over_mtrl_type=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(item.cmplt_item_type);mt.get_LimitOverMtrlType(limit_over_mtrl_type);bonus_icon.setTexture(RES_CDN_DEFULT+"menu_camp/img_ic_limit_"+limit_over_mtrl_type+".png")}else{frame=cc.spriteFrameCache.getSpriteFrame("img_reward_"+leadingZeros(item.cmplt_item_type,2)+"_d.png");bonus_icon.setSpriteFrame(frame)}bonus_icon.setAnchorPoint(ZERO()),bonus_icon.setPosition((ccWidth(layer)-600)/2-ccSize(bonus_icon).width/2,269),layer.addChild(bonus_icon);var bonus_count_label=null;if(item.cmplt_item_type==BONUS_TYPE_MAGIC_KEY)(bonus_count_label=cmLabel.getLabel("魔法の鍵を使用しました。\n鍵の上限数が1UP！",LABEL_FONT_INDEX.FONT_241)).setTextHorizontalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER);else{var count=Math.floor(this.m_factoryLayer.getFactoryBuyCount());bonus_count_label=cmLabel.getLabel("x "+count,LABEL_FONT_INDEX.FONT_503),this.m_factoryLayer.initFactoryBuyCount(),this.m_factoryLayer.setSelectFactoryItem()}bonus_count_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bonus_count_label.enableOutline(cc.color.BLACK,3),bonus_count_label.setPosition((ccWidth(layer)-600)/2,220),layer.addChild(bonus_count_label);var audio=AudioEngine.getInstance();return audio.stopEffectsAll(),audio.playEffect(RES_CDN_SOUND+SND_TYPE+"sound/SE_all_win_popularity.mp3",!1),audio.playEffect(RES_CDN_SOUND+SND_TYPE+"sound/SE_gacha_back.mp3",!1),item=null,layer}.bind(this),this.m_complteModalLayer.show(),this.m_complteModalLayer.onItemTouchBegin=function(){return!0},this.m_complteModalLayer.onItemTouchEnd=function(){this.m_isEnalbleTouch&&(AudioEngine.getInstance().stopEffectsAll(),this.m_complteModalLayer.hide())}.bind(this),this.scheduleOnce(function(float){this.m_isEnalbleTouch=!0}.bind(this),1,"m_isEnalbleTouch"),MainObserver.getInstance().postNotification(NOTIFICATION_STATUS_LAYER,message_update_status_animation)},showItemExchange:function(){var buy_count=Math.floor(this.m_factoryLayer.getFactoryBuyCount()),item=this.m_factoryLayer.getFactoryItem(),m=MasterManager.getInstance(),reward_bonus=m.get_BonusType(item.cmplt_item_type);if(this.m_ctbox.setTitle(res_str("label_factory_item_exchange_title")),item.factory_mtrl_type==CAMP_FACTORY_MTRL_LIMIT_OVER){var mtrl_bonus=m.get_LimitOverMtrlType(item.need_mtrl_type);this.m_ctbox.setText(mtrl_bonus.name+" "+Number(item.need_mtrl_cnt*buy_count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("個を消費し、",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),mtrl_bonus=null}else if(item.factory_mtrl_type==CAMP_FACTORY_MTRL_MAGIC_KEY){mtrl_bonus=m.get_BonusType(BONUS_TYPE_MAGIC_KEY_MTRL);this.m_ctbox.setText(mtrl_bonus.name+" "+Number(item.need_mtrl_cnt*buy_count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("個を消費し、",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),mtrl_bonus=null}else if(item.factory_mtrl_type==CAMP_FACTORY_MTRL_JADE_PIECE){mtrl_bonus=m.get_BonusType(BONUS_TYPE_JADE_PIECE);this.m_ctbox.setText(mtrl_bonus.name+" "+Number(item.need_mtrl_cnt*buy_count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("個を消費し、",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),mtrl_bonus=null}var get_count=item.max_value;if(get_count=buy_count,reward_bonus.bonus_type==BONUS_TYPE_YUNHEE_FIX){var g=m.get_General(item.min_value);this.m_ctbox.setText(g.name+" "+get_count.toLocaleString("en"),LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("個に合成しますか。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n")}else this.m_ctbox.setText(reward_bonus.name+" "+get_count.toLocaleString("en"),LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("個に合成しますか。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n");this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_no"),MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_ctbox.hide()}.bind(this))),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_yes"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.m_isExchangeItem=!1,CAMP_FACTORY_GET_ITEM_INFO=!1,this.sendPacketFactoryItemExchange()},0,"sendPacketFactoryItemExchange"),this.m_ctbox.hide(!1)}.bind(this))),this.m_ctbox.show(),reward_bonus=item=null},sendPacketFactoryItemExchange_Ready:function(){CAMP_FACTORY_GET_ITEM_INFO=!0;var req={};req.opcode=net.OP.op_get_user_item,this.network_write(req)},sendPacketFactoryItemExchange:function(){this.m_isExchangeItem=!0;var item=this.m_factoryLayer.getFactoryItem(),buy_count=Math.floor(this.m_factoryLayer.getFactoryBuyCount()),req={};req.opcode=net.OP.op_camp_factory_exchange_item,req.factory_id=item.factory_id,req.buy_count=buy_count,this.network_write(req),req={},item=null},onNetworkEvent:function(opcode,state,body){if(this._super(opcode,state,body),body.error==net.ERROR.NET_E_CAMP_FACTORY_MAKE_MAGIC_KEY_COUNT_OVER)USE_POPUP_INTERGRATION?this.showCampFactoryPopup(res_str("label_magic_key_make_max_count_title"),res_str("label_magic_key_make_max_count_text_1")):this.showIsMaxMakeMagicKey();else if(body.error==net.ERROR.NET_E_CAMP_KEY_RECOVERY_MAKE_COUNT_OVER)USE_POPUP_INTERGRATION?this.showCampFactoryPopup(res_str("label_magic_key_make_max_count_title"),res_str("label_not_make_key_recovery_text_1")):this.showIsMaxKeyRecoveryCount();else if(body.error==net.ERROR.NET_E_LACK_MATERIAL);else if(opcode==net.OP.op_get_user_mail)this.m_isMailing&&(this.m_isMailing=!1,this.showExchangeEffect());else if(opcode==net.OP.op_get_user_item){if(this.m_isExchangeItem){CAMP_FACTORY_GET_MAIL_INFO=!0,this.m_isExchangeItem=!1,this.m_isMailing=!0;var req={};req.opcode=net.OP.op_get_user_mail,this.network_write(req)}}else if(opcode==net.OP.op_camp_factory_exchange_item)this.sendPacketFactoryItemExchange_Ready();else if(opcode==net.OP.op_get_user_magic_key_mtrl)this.m_factoryLayer.updateUserKeyRecoveryCount();else if(opcode==net.OP.op_get_user_mussang){SceneManager.getInstance().getRunningScene().initLayoutProgress();var scene=new MussangRoadScene;SceneManager.getInstance().replaceScene(scene),scene=null}else if(opcode==net.OP.op_get_world_war_season_info){SceneManager.getInstance().getRunningScene().initLayoutProgress();scene=new WorldWarMainScene;SceneManager.getInstance().replaceScene(scene),scene=null}},onEnter:function(){this._super(),this.m_gameObserver=MainObserver.getInstance(),this.m_gameObserver.addObserver(this.onNotification,this,sceneStr[scene_CampFactoryScene]),this.m_gameObserver.addObserver(this.onNotificationShortcuts,this,NOTIFICATION_EVOLUTION_MTRL_SHORTCUTS)},onExit:function(){if(this._super(),1!=PREV_HELP){if(this.m_factoryLayer=null,this.m_exchangeEffectLayer=null,(this.m_complteModalLayer=null)!=this.m_skeletonEffectNode&&(this.removeChild(this.m_skeletonEffectNode),this.m_skeletonEffectNode._skeleton.data.animations=[],this.m_skeletonEffectNode._skeleton.data.bones=[],this.m_skeletonEffectNode._skeleton.data.events=[],this.m_skeletonEffectNode._skeleton.data.slots=[],this.m_skeletonEffectNode._skeleton.data.skins=[],this.m_skeletonEffectNode._skeleton.slots=[],this.m_skeletonEffectNode._skeleton.drawOrder=[],this.m_skeletonEffectNode._skeleton.bones=[],this.m_skeletonEffectNode._skeleton=null,this.m_skeletonEffectNode=null),this.m_mtrlShortcutsModalLayer=null,USE_SHORTCUT_EVOLUTION_ICON?(cc.spriteFrameCache.removeSpriteFramesFromFile(RES_CDN_DEFULT+"icon/shortcut_evolution/"+SHORTCUT_EVOLUTION_TEXTURE+".plist"),delete cc.spriteFrameCache._frameConfigCache[RES_CDN_DEFULT+"icon/shortcut_evolution/"+SHORTCUT_EVOLUTION_TEXTURE+".plist"]):(cc.spriteFrameCache.removeSpriteFramesFromFile(RES_CDN_DEFULT+"icon/evolve_small/"+ICON_EVOLVE_SMALL_TEXTURE+".plist"),delete cc.spriteFrameCache._frameConfigCache[RES_CDN_DEFULT+"icon/evolve_small/"+ICON_EVOLVE_SMALL_TEXTURE+".plist"],cc.spriteFrameCache.removeSpriteFramesFromFile(RES_CDN_DEFULT+"icon/formation/"+FORMATION_TEXTURE+".plist"),delete cc.spriteFrameCache._frameConfigCache[RES_CDN_DEFULT+"icon/formation/"+FORMATION_TEXTURE+".plist"]),null!=this.m_resources){for(var i=0;i<this.m_resources.length;i++)cc.loader.release(this.m_resources[i]);this.m_resources=null}this.m_gameObserver.removeObserver(sceneStr[scene_CampFactoryScene]),this.m_gameObserver.removeObserver(NOTIFICATION_EVOLUTION_MTRL_SHORTCUTS)}},back:function(){this.onKeyBack(!0)},showCampFactoryPopup:function(){this.m_box.is_show()&&this.m_box.hide();for(var val=arguments,msg=[],i=1;i<val.length;i++)msg.push(val[i]);this.showMsgBox(val[0],msg),msg=null},showNotOpenWorldWarPopup:function(){this.m_box.setTitle(res_str("world_war_season_over_title_1")),this.m_box.setText(res_str("world_war_season_over_text_1")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showNotOpenRaidBossPopup:function(){this.m_box.setTitle(res_str("label_camp_not_open_raid_boss_title")),this.m_box.setText(res_str("label_camp_not_open_raid_boss")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show(),this.m_box.show()},showNotEnoughMaterial:function(){this.m_box.setTitle(res_str("label_factory_item_exchange_not_enough_mtrl_title")),this.m_box.setText(res_str("label_factory_item_exchange_not_enough_mtrl_text_1")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showIsMaxMakeMagicKey:function(){this.m_box.setTitle(res_str("label_magic_key_make_max_count_title")),this.m_box.setText(res_str("label_magic_key_make_max_count_text_1")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showIsMaxKeyRecoveryCount:function(){this.m_box.setTitle(res_str("label_magic_key_make_max_count_title")),this.m_box.setText(res_str("label_not_make_key_recovery_text_1")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showNotEnoughFactoryLevel:function(){this.m_box.setTitle(res_str("label_shop_buy_jade_omission_title")),this.m_box.setText(res_str("label_not_enough_factory_level")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showNotSelectItem:function(){this.m_box.setTitle(res_str("label_event_dungeon_reward_complete_title")),this.m_box.setText(res_str("label_factory_item_not_select")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()}}),LimitOverMtrlListCell=cc.TableViewCell.extend({m_box:null,m_select_cover:null,m_is_select:!1,m_item_icon:null,m_item_name:null,_callback_choice_item:null,m_gauge:null,m_mtrl_icon:null,m_mtrl_count_label:null,m_shortcuts_sprite:[],m_select_sprite:[],m_info_label:null,m_is_magic_key_max:!1,ctor:function(){this.m_shortcuts_sprite=[],this.m_select_sprite=[],this.m_box=null,this._super(),this.init()},init:function(){var cellSize=cc.size(557,124);this.setContentSize(cellSize),this.m_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero()),this.m_box.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_box.setPosition(ZERO()),this.m_box.setContentSize(cellSize),this.addChild(this.m_box),this.m_item_name=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2029),this.m_item_name.setAnchorPoint(ZERO()),this.m_item_name.setPosition(119,74),this.m_box.addChild(this.m_item_name);var gauge_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_frame.png",RectZero());gauge_box.setAnchorPoint(ZERO()),gauge_box.setPosition(136,41),gauge_box.setPreferredSize(cc.size(275,16)),this.m_box.addChild(gauge_box),this.m_gauge=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_gauge_green.png",RectZero()),this.m_gauge.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_gauge.setPosition(3,ccCenter(gauge_box).y),this.m_gauge.setPreferredSize(cc.size(269,10)),gauge_box.addChild(this.m_gauge),this.m_mtrl_count_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_161),this.m_mtrl_count_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_mtrl_count_label.setPosition(ccCenter(gauge_box).x,ccHeight(gauge_box)),this.m_mtrl_count_label.enableOutline(cc.color.BLACK,1),gauge_box.addChild(this.m_mtrl_count_label),this.m_mtrl_icon=new cc.Sprite,this.m_mtrl_icon.setAnchorPoint(ZERO()),this.m_mtrl_icon.setPosition(126,36),this.m_box.addChild(this.m_mtrl_icon),(nor=new cc.Sprite("#btn_05_off.png")).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),nor.setPosition(cellSize.width-13,.5*cellSize.height+5),(nor_label=cmLabel.getLabel("選択",LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_MIDDLE()),nor_label.setPosition(ccCenter(nor)),nor.addChild(nor_label),this.m_box.addChild(nor),this.m_select_sprite.push(nor),(on=new cc.Sprite("#btn_05_on.png")).setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),on.setPosition(cellSize.width-13,.5*cellSize.height+5),(on_label=cmLabel.getLabel("選択",LABEL_FONT_INDEX.FONT_242)).setAnchorPoint(ANCHOR_MIDDLE()),on_label.setPosition(ccCenter(on)),on.addChild(on_label),this.m_box.addChild(on),on.setVisible(!1),this.m_select_sprite.push(on);var none=new cc.Sprite("#btn_04_none.png");none.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),none.setPosition(cellSize.width-13,62);var nor,nor_label,on,on_label,none_label=cmLabel.getLabel(res_str("btn_label_select"),LABEL_FONT_INDEX.FONT_201);none_label.setAnchorPoint(ANCHOR_MIDDLE()),none_label.setPosition(ccCenter(on)),none.addChild(none_label),this.m_box.addChild(none),none.setVisible(!1),this.m_select_sprite.push(none),(nor=new cc.Sprite("#btn_05_off.png")).setAnchorPoint(ANCHOR_TOP_RIGHT()),nor.setPosition(cellSize.width-13,.5*cellSize.height-5),(nor_label=cmLabel.getLabel("獲得情報",LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_MIDDLE()),nor_label.setPosition(ccCenter(nor)),nor.addChild(nor_label),this.m_box.addChild(nor),this.m_shortcuts_sprite.push(nor),(on=new cc.Sprite("#btn_05_on.png")).setAnchorPoint(ANCHOR_TOP_RIGHT()),on.setPosition(cellSize.width-13,.5*cellSize.height-5),(on_label=cmLabel.getLabel("獲得情報",LABEL_FONT_INDEX.FONT_242)).setAnchorPoint(ANCHOR_MIDDLE()),on_label.setPosition(ccCenter(on)),on.addChild(on_label),this.m_box.addChild(on),this.m_shortcuts_sprite.push(on),on.setVisible(!1),this.m_select_cover=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_select_2.png",RectZero()),this.m_select_cover.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_select_cover.setPosition(ZERO()),this.m_select_cover.setPreferredSize(cellSize),this.addChild(this.m_select_cover),this.m_select_cover.setVisible(!1);var fadeIn=cc.fadeIn(1),fadeOut=cc.fadeOut(1),seq=cc.sequence(fadeIn,fadeOut),repeat=cc.repeatForever(seq);return this.m_select_cover.runAction(repeat),!0},setFactoryData:function(factory,is_select){this.m_is_select=is_select,this.m_factory_data=factory,USE_SP_CAMP_SCALE?this.updateCellLayout_SP():this.updateCellLayout()},updateCellLayout:function(){this.m_is_magic_key_max=!1,null!=this.m_info_label&&this.m_info_label.setString("");var m=MasterManager.getInstance();if(null!=this.m_item_icon&&this.m_item_icon.removeFromParent(),this.m_factory_data.cmplt_item_type==BONUS_TYPE_YUNHEE_FIX){var card={},g=m.get_General(this.m_factory_data.min_value);this.convertCardInfo(g,card),55555==card.gnrl_id?this.m_item_icon=new cc.Sprite(RES_CDN_DEFULT+"menu_camp/img_camp_sr.png"):66666==card.gnrl_id&&(this.m_item_icon=new cc.Sprite(RES_CDN_DEFULT+"menu_camp/img_camp_ssr.png")),this.m_item_name.setString(g.name),null!=this.m_info_label&&this.m_info_label.setString("")}else if(this.m_factory_data.cmplt_item_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL){var limit_over_mtrl_type=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(this.m_factory_data.cmplt_item_type),l=m.get_LimitOverMtrlType(limit_over_mtrl_type);this.m_item_icon=new cc.Sprite(RES_CDN_DEFULT+"menu_camp/img_ic_limit_"+limit_over_mtrl_type+".png"),this.m_item_name.setString(l.name)}else if(this.m_factory_data.cmplt_item_type==BONUS_TYPE_MAGIC_KEY){this.m_item_icon=new cc.Sprite(RES_CDN_DEFULT+"menu_camp/img_camp_key_2.png");var b=m.get_BonusType(this.m_factory_data.cmplt_item_type);this.m_item_name.setString(b.name),null!=this.m_info_label&&this.m_info_label.setString("")}else if(this.m_factory_data.cmplt_item_type==BONUS_TYPE_KEY_REFILL){this.m_item_icon=new cc.Sprite(RES_CDN_DEFULT+"menu_camp/img_camp_key.png");b=m.get_BonusType(this.m_factory_data.cmplt_item_type);this.m_item_name.setString(b.name),this.m_info_label=cmLabel.getLabel("毎週50個まで合成可能です。",LABEL_FONT_INDEX.FONT_1414),this.m_info_label.setAnchorPoint(ZERO()),this.m_info_label.setPosition(119,8),this.m_box.addChild(this.m_info_label)}else if(this.m_factory_data.cmplt_item_type==BONUS_TYPE_JADE){this.m_item_icon=new cc.Sprite(RES_CDN_DEFULT+"menu_camp/img_camp_jade.png");b=m.get_BonusType(this.m_factory_data.cmplt_item_type);this.m_item_name.setString(b.name)}else{this.m_item_icon=new cc.Sprite("#img_reward_"+leadingZeros(this.m_factory_data.cmplt_item_type,2)+".png");b=m.get_BonusType(this.m_factory_data.cmplt_item_type);this.m_item_name.setString(b.name)}1==this.m_factory_data.tab_type?this.m_factory_data.factory_mtrl_type==CAMP_FACTORY_MTRL_LIMIT_OVER&&this.m_mtrl_icon.setTexture(RES_CDN_DEFULT+"menu_camp/img_limit_mtrl_"+this.m_factory_data.need_mtrl_type+".png"):2==this.m_factory_data.tab_type?this.m_factory_data.factory_mtrl_type==CAMP_FACTORY_MTRL_MAGIC_KEY&&this.m_mtrl_icon.setTexture(RES_CDN_DEFULT+"menu_camp/img_key_mtrl_"+this.m_factory_data.need_mtrl_type+".png"):3==this.m_factory_data.tab_type&&this.m_factory_data.factory_mtrl_type==CAMP_FACTORY_MTRL_JADE_PIECE&&this.m_mtrl_icon.setTexture(RES_CDN_DEFULT+"menu_camp/img_camp_jade_mtrl_2.png");var need_count=this.m_factory_data.need_mtrl_cnt,user_count=CampService.getInstance().getUserCampFactoryMtrlCount(this.m_factory_data.factory_mtrl_type,this.m_factory_data.need_mtrl_type);if(this.m_mtrl_count_label.setString(Number(user_count).toLocaleString("en")+"/"+need_count),this.m_factory_data.cmplt_item_type==BONUS_TYPE_MAGIC_KEY){var count_function=MasterManager.getInstance().get_CountFunction(COUNT_FUNCTION_MAGIC_KEY_MAX_COUNT);NetService().get_User_Plus_Key_Bound()>=count_function.value&&(this.m_mtrl_count_label.setString("MAX"),this.m_select_sprite[0].setVisible(!1),this.m_select_sprite[1].setVisible(!1),this.m_select_sprite[2].setVisible(!0),this.m_is_magic_key_max=!0)}else this.m_select_sprite[0].setVisible(!0),this.m_select_sprite[1].setVisible(!1),this.m_select_sprite[2].setVisible(!1);var prcnt=user_count/need_count;1<prcnt&&(prcnt=1);var gauge_value=269*prcnt;this.m_gauge.setPreferredSize(cc.size(gauge_value,10)),this.m_item_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),2==this.m_factory_data.tab_type||3==this.m_factory_data.tab_type?this.m_item_icon.setPosition(4,5):1==this.m_factory_data.tab_type&&this.m_item_icon.setPosition(4,5),this.m_box.addChild(this.m_item_icon),this.m_select_cover.setVisible(this.m_is_select)},updateCellLayout_SP:function(){this.m_is_magic_key_max=!1,null!=this.m_info_label&&this.m_info_label.setString("");var m=MasterManager.getInstance();if(null!=this.m_item_icon&&this.m_item_icon.removeFromParent(),this.m_factory_data.cmplt_item_type==BONUS_TYPE_YUNHEE_FIX){var card={},g=m.get_General(this.m_factory_data.min_value);this.convertCardInfo(g,card),55555==card.gnrl_id?this.m_item_icon=new cc.Sprite(RES_CDN_DEFULT+"menu_camp/img_camp_sr.png"):66666==card.gnrl_id&&(this.m_item_icon=new cc.Sprite(RES_CDN_DEFULT+"menu_camp/img_camp_ssr.png")),this.m_item_name.setString(g.name),null!=this.m_info_label&&this.m_info_label.setString("")}else if(this.m_factory_data.cmplt_item_type==BONUS_TYPE_SSR_LIMIT_OVER_MTRL){var limit_over_mtrl_type=GeneralService.getInstance().getBonusTypeToLimitOverMtrlType(this.m_factory_data.cmplt_item_type),l=m.get_LimitOverMtrlType(limit_over_mtrl_type);this.m_item_icon=new cc.Sprite(RES_CDN_DEFULT+"menu_camp/img_ic_limit_"+limit_over_mtrl_type+".png"),this.m_item_name.setString(l.name)}else if(this.m_factory_data.cmplt_item_type==BONUS_TYPE_MAGIC_KEY){this.m_item_icon=new cc.Sprite(RES_CDN_DEFULT+"menu_camp/img_camp_key_2.png");var b=m.get_BonusType(this.m_factory_data.cmplt_item_type);this.m_item_name.setString(b.name),null!=this.m_info_label&&this.m_info_label.setString("")}else if(this.m_factory_data.cmplt_item_type==BONUS_TYPE_KEY_REFILL){this.m_item_icon=new cc.Sprite(RES_CDN_DEFULT+"menu_camp/img_camp_key.png");b=m.get_BonusType(this.m_factory_data.cmplt_item_type);this.m_item_name.setString(b.name),this.m_info_label=cmLabel.getLabel("毎週50個まで合成可能です。",LABEL_FONT_INDEX.FONT_1414),this.m_info_label.setAnchorPoint(ZERO()),this.m_info_label.setPosition(119,8),this.m_box.addChild(this.m_info_label)}else if(this.m_factory_data.cmplt_item_type==BONUS_TYPE_JADE){this.m_item_icon=new cc.Sprite(RES_CDN_DEFULT+"menu_camp/img_camp_jade.png");b=m.get_BonusType(this.m_factory_data.cmplt_item_type);this.m_item_name.setString(b.name)}else{this.m_item_icon=new cc.Sprite("#img_reward_"+leadingZeros(this.m_factory_data.cmplt_item_type,2)+".png");b=m.get_BonusType(this.m_factory_data.cmplt_item_type);this.m_item_name.setString(b.name)}1==this.m_factory_data.tab_type?this.m_factory_data.factory_mtrl_type==CAMP_FACTORY_MTRL_LIMIT_OVER&&this.m_mtrl_icon.setTexture(RES_CDN_DEFULT+"menu_camp/img_limit_mtrl_"+this.m_factory_data.need_mtrl_type+".png"):2==this.m_factory_data.tab_type?this.m_factory_data.factory_mtrl_type==CAMP_FACTORY_MTRL_MAGIC_KEY&&this.m_mtrl_icon.setTexture(RES_CDN_DEFULT+"menu_camp/img_key_mtrl_"+this.m_factory_data.need_mtrl_type+".png"):3==this.m_factory_data.tab_type&&this.m_factory_data.factory_mtrl_type==CAMP_FACTORY_MTRL_JADE_PIECE&&this.m_mtrl_icon.setTexture(RES_CDN_DEFULT+"menu_camp/img_camp_jade_mtrl_2.png");var need_count=this.m_factory_data.need_mtrl_cnt,user_count=CampService.getInstance().getUserCampFactoryMtrlCount(this.m_factory_data.factory_mtrl_type,this.m_factory_data.need_mtrl_type);if(this.m_mtrl_count_label.setString(Number(user_count).toLocaleString("en")+"/"+need_count),this.m_factory_data.cmplt_item_type==BONUS_TYPE_MAGIC_KEY){var count_function=MasterManager.getInstance().get_CountFunction(COUNT_FUNCTION_MAGIC_KEY_MAX_COUNT);NetService().get_User_Plus_Key_Bound()>=count_function.value&&(this.m_mtrl_count_label.setString("MAX"),this.m_select_sprite[0].setVisible(!1),this.m_select_sprite[1].setVisible(!1),this.m_select_sprite[2].setVisible(!0),this.m_is_magic_key_max=!0)}else this.m_select_sprite[0].setVisible(!0),this.m_select_sprite[1].setVisible(!1),this.m_select_sprite[2].setVisible(!1);var prcnt=user_count/need_count;1<prcnt&&(prcnt=1);var gauge_value=269*prcnt;this.m_gauge.setPreferredSize(cc.size(gauge_value,10)),this.m_item_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),2==this.m_factory_data.tab_type||3==this.m_factory_data.tab_type?this.m_item_icon.setPosition(4,5):1==this.m_factory_data.tab_type&&this.m_item_icon.setPosition(4,5),this.m_item_icon.setScale(2),this.m_box.addChild(this.m_item_icon),this.m_select_cover.setVisible(this.m_is_select)},convertCardInfo:function(g,card){card.gnrl_id=g.gnrl_id,card.level=1},highlightPosInCell:function(pos){var box=this.m_select_sprite[0],r=box.getBoundingBox();cc.rectContainsPoint(r,pos)&&!this.m_is_magic_key_max&&(this.m_select_sprite[0].setVisible(!1),this.m_select_sprite[1].setVisible(!0),this.m_select_sprite[2].setVisible(!1)),r=(box=this.m_shortcuts_sprite[0]).getBoundingBox(),cc.rectContainsPoint(r,pos)&&(this.m_shortcuts_sprite[0].setVisible(!1),this.m_shortcuts_sprite[1].setVisible(!0))},unhighlightPosInCell:function(pos){var box=this.m_select_sprite[0],r=box.getBoundingBox();cc.rectContainsPoint(r,pos)&&!this.m_is_magic_key_max&&(this.m_select_sprite[0].setVisible(!0),this.m_select_sprite[1].setVisible(!1),this.m_select_sprite[2].setVisible(!1)),r=(box=this.m_shortcuts_sprite[0]).getBoundingBox(),cc.rectContainsPoint(r,pos)&&(this.m_shortcuts_sprite[0].setVisible(!0),this.m_shortcuts_sprite[1].setVisible(!1))},touchPosInCell:function(pos){var box=this.m_select_sprite[0],r=box.getBoundingBox();if(cc.rectContainsPoint(r,pos)&&!this.m_is_magic_key_max){var path=RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3";if(AudioEngine.getInstance().playEffect(path),this.m_select_sprite[0].setVisible(!0),this.m_select_sprite[1].setVisible(!1),this.m_select_sprite[2].setVisible(!1),null!=this._callback_choice_item){var idx=this.getIdx();this._callback_choice_item(idx)}}if(r=(box=this.m_shortcuts_sprite[0]).getBoundingBox(),cc.rectContainsPoint(r,pos)){path=RES_CDN_SOUND+SND_TYPE+"sound/SE_button.mp3";if(AudioEngine.getInstance().playEffect(path),this.m_shortcuts_sprite[0].setVisible(!0),this.m_shortcuts_sprite[1].setVisible(!1),null!=this._callback_shortcuts_item){idx=this.getIdx();this._callback_shortcuts_item(idx)}}}}),CAMP_COST_GET_ITEM_INFO=!1,CampCostScene=GameScene.extend({m_campCostLayer:null,ctor:function(){this._super(scene_CampCostScene),CAMP_COST_GET_ITEM_INFO=PREV_HELP=!1},init:function(){var bg=cc.Sprite.create(RES_CDN_DEFULT+"common/bg_sub_2.png");bg.setPosition(ccCenter(this)),USE_SP_COMMON_SUB_BG_SCALE&&bg.setScale(2),this.addChild(bg),this.m_campCostLayer=new CampCostLayer,this.m_campCostLayer.ignoreAnchorPointForPosition(!1),this.m_campCostLayer.initLayout(),this.m_campCostLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_campCostLayer.setPosition(ccWidth(this)/2,0),this.addChild(this.m_campCostLayer);var title,statusLayer=new StatusLayer(INVOKER_TYPE.normal);(statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer),USE_SP_CAMP_SCALE)?((title=cc.Sprite.create(RES_CDN_DEFULT+"menu_camp/img_camp_text_camp.png")).setAnchorPoint(ZERO()),title.setPosition(90,585),title.setScale(2),this.addChild(title)):((title=cc.Sprite.create(RES_CDN_DEFULT+"menu_camp/img_camp_text_camp.png")).setAnchorPoint(ZERO()),title.setPosition(90,585),this.addChild(title));var back_btn=new ccui.Button("btn_home_off.png","btn_home_on.png","",ccui.Widget.PLIST_TEXTURE);return back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(10,559),back_btn.addClickEventListener(function(sender){this.back()}.bind(this)),this.addChild(back_btn),!0},back:function(){this.onKeyBack(!0,!1)},onNotification:function(msg){switch(this._super(msg),msg){case COST_SELECT_YUNHEE:this.m_campCostLayer.setYunheeInCost();break;case COST_START:this.showConfirmStartMsgBox();break;case COST_TAB_1:case COST_TAB_2:case COST_TAB_3:this.m_campCostLayer.setTabIndex(msg);break;case COST_DESELECT_YUNHEE:this.m_campCostLayer.isDeselectableYunhee()?this.m_campCostLayer.deselectYunhee():this.showConfirmDeselectYunhee();break;case COMMON_BTN_SORT:this.m_campCostLayer.sortMaterialYunhee();break;case COST_RELEASE_SLOT:this.showConfirmReleaseSlot();break;case COST_RELEASE_FRONT_SLOT:this.showReleaseFrontSlot();break;case COST_SLOT_LACK:USE_POPUP_INTERGRATION?this.showCampCostPopup(res_str("label_camp_cost_error_title"),res_str("label_camp_cost_slot_lack_text_1"),res_str("label_camp_cost_slot_lack_text_2")):this.showCostSlotLack();break;case COST_NEED_USER_LEVEL:USE_POPUP_INTERGRATION?this.showGameScenePopup(res_str("label_preparation_title"),res_str("label_not_enough_level_1"),res_str("label_not_enough_level_2")):this.showNotEnoughLevel();break;case COST_SHOW_HELP:PREV_HELP=!0,GameContext.getInstance().setHelpInfoIndexByCallIndex(20);var scene=new HelpContentScene;SceneManager.getInstance().pushScene(scene),scene=null;break;case COST_LACK_GOLD:this.showNotEnoughGold(!0)}return!0},onNetworkEvent:function(opcode,state,body){if(opcode==net.OP.op_get_user_camp_cost);else if(opcode==net.OP.op_set_user_camp_cost)if(body.error==net.ERROR.NET_E_CAMP_TROOPS_COST_IS_BIG)this.showTooBigTroopsCostMsgBox();else if(body.error==net.ERROR.NET_E_LACK_GOLD)this.showNotEnoughGold();else if(body.error==net.ERROR.NET_E_LACK_JADE)this.showNotEnoughJade();else if(body.error==net.ERROR.NET_E_LACK_USER_LEVEL)USE_POPUP_INTERGRATION?this.showGameScenePopup(res_str("label_preparation_title"),res_str("label_not_enough_level_1"),res_str("label_not_enough_level_2")):this.showNotEnoughLevel();else if(body.error==net.ERROR.NET_E_CAMP_USING_IN_TROOPS)USE_POPUP_INTERGRATION?this.showGameScenePopup(res_str("label_preparation_title"),res_str("label_camp_upgrade_error_in_troops")):this.showUsingInTroopsMsgBox();else if(body.error==net.ERROR.NET_E_CAMP_USING_IN_GREAT_WALL_TROOPS)USE_POPUP_INTERGRATION?this.showGameScenePopup(res_str("label_preparation_title"),res_str("label_camp_upgrade_error_in_great_wall_troops")):this.showUsingInGreatWallTroopsMsgBox();else if(body.error==net.ERROR.NET_E_CAMP_GREAT_WALL_TROOPS_COST_IS_BIG)USE_POPUP_INTERGRATION?this.showCampCostPopup(res_str("label_camp_cost_error_great_wall_text_1"),res_str("label_camp_cost_error_great_wall_text_1"),res_str("label_camp_cost_error_text_2")):this.showTooBigGreatWallTroopsCostMsgBox();else if(body.error==net.ERROR.NET_E_CAMP_WORLD_WAR_TROOPS_COST_IS_BIG)USE_POPUP_INTERGRATION?this.showCampCostPopup(res_str("label_camp_cost_error_title"),res_str("label_camp_cost_error_great_wall_world_war_text_1"),res_str("label_camp_cost_error_text_2")):this.showTooBigWorldWarTroopsCostMsgBox();else if(res.error==net.ERROR.NET_E_ALREADY_USED_WORLD_WAR){var msg=[];msg.push_back(res_str("label_camp_already_used_world_war_troops")),this.showMsgBox(msg),msg=null}else this.showChangeCostMsgBox(!1);else opcode==net.OP.op_set_user_camp_cost_slot?body.error==net.ERROR.NET_E_LACK_JADE?this.showNotEnoughJade():body.error==net.ERROR.NET_E_LACK_GOLD?this.showNotEnoughGold():body.error==net.ERROR.NET_E_LACK_USER_LEVEL?USE_POPUP_INTERGRATION?this.showGameScenePopup(res_str("label_preparation_title"),res_str("label_not_enough_level_1"),res_str("label_not_enough_level_2")):this.showNotEnoughLevel():body.error==net.ERROR.NET_E_CAMP_COST_SLOT_ALREADY_OPENED?this.showCostSlotAlreadyOpendMsgBox():this.showOpenCostSlotMsgBox():opcode==net.OP.op_remove_user_camp_cost_general?body.error==net.ERROR.NET_E_NOT_FOUND_GENERAL?this.showNotExistYunheeMsgBox():body.error==net.ERROR.NET_E_CAMP_TROOPS_COST_IS_BIG?this.showTooBigTroopsCostMsgBox():body.error==net.ERROR.NET_E_CAMP_GREAT_WALL_TROOPS_COST_IS_BIG?USE_POPUP_INTERGRATION?this.showCampCostPopup(res_str("label_camp_cost_error_great_wall_text_1"),res_str("label_camp_cost_error_great_wall_text_1"),res_str("label_camp_cost_error_text_2")):this.showTooBigGreatWallTroopsCostMsgBox():body.error==net.ERROR.NET_E_CAMP_WORLD_WAR_TROOPS_COST_IS_BIG?USE_POPUP_INTERGRATION?this.showCampCostPopup(res_str("label_camp_cost_error_title"),res_str("label_camp_cost_error_great_wall_world_war_text_1"),res_str("label_camp_cost_error_text_2")):this.showTooBigWorldWarTroopsCostMsgBox():this.showChangeCostMsgBox(!0):opcode==net.OP.op_get_user_camp_cost_slot&&(this.processCompleteOpenSlot(),this.scheduleOnce(function(float){CAMP_COST_GET_ITEM_INFO=!0;var req={};req.opcode=net.OP.op_get_user_item,this.network_write(req),req={}},0,"op_get_user_camp_cost_slot"))},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,sceneStr[scene_CampCostScene])},onExit:function(){this._super(),MainObserver.getInstance().removeObserver(sceneStr[scene_CampCostScene]),1!=PREV_HELP&&null!=this.m_campCostLayer&&(this.m_campCostLayer.removeAllChildrenWithCleanup(!0),this.m_campCostLayer=null,delete this.m_campCostLayer)},showOpenCostSlotMsgBox:function(){this.m_box.setTitle("コスト"),this.m_box.setText("コスト管理スロットを拡張しました。"),this.m_box.addButtonInfo(new MessageButtonInfo("確認",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.processCompleteOpenSlot()},0,"btnOk"),this.m_box.hide(!1)}.bind(this))),this.m_box.show()},processCompleteOpenSlot:function(){this.m_campCostLayer.completeOpenSlot()},showNotExistYunheeMsgBox:function(){this.m_box.setTitle(res_str("label_camp_cost_error_title"));var info={};info.color=cmLabel.getColor(LABEL_FONT_INDEX.FONT_248),info.text="恋姫が存在しません。",this.m_box.setText(info.text),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show(),info={}},showCostSlotAlreadyOpendMsgBox:function(){this.m_box.setTitle(res_str("label_camp_cost_title")),this.m_box.setText(res_str("label_camp_cost_already_open_slot_text")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1),this.scheduleOnce(function(float){var req={};req.opcode=net.OP.op_get_user_camp_cost_slot,this.network_write(req),req={}},0,"btnOk")}.bind(this))),this.m_box.show()},showConfirmStartMsgBox:function(){this.m_campCostLayer.getTabIndex();var changedCost=this.m_campCostLayer.getChangedCostValues(),neededAmount=this.m_campCostLayer.getNeededAmount();this.m_ctbox.setTitle("コスト"),this.m_ctbox.setText("金貨 "+neededAmount,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("個を使用して",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("コストを ",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText(changedCost+"",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("に",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("変更しますか。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.addButtonInfo(new MessageButtonInfo("いいえ",MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_ctbox.hide()}.bind(this))),this.m_ctbox.addButtonInfo(new MessageButtonInfo("はい",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.sendPacketStartCost()},0,"btnYes"),this.m_ctbox.hide(!1)}.bind(this))),this.m_ctbox.show(),neededAmount=changedCost=null},sendPacketStartCost:function(){var troop_index=this.m_campCostLayer.getTabIndex(),costYunhees=this.m_campCostLayer.getCostYunhees(),req={};req.opcode=net.OP.op_set_user_camp_cost,req.cost_yunhee={troops_num:troop_index,added_cost:0,gnrl_keys:[]};for(var i=0;i<MAX_COST_ITEM_SIZE;i++){var gnrl_key={};gnrl_key.gnrl_id=costYunhees[i].gnrl_key.gnrl_id,gnrl_key.gnrl_num=costYunhees[i].gnrl_key.gnrl_num,req.cost_yunhee.gnrl_keys.push(gnrl_key),req.cost_yunhee.added_cost+=costYunhees[i].cost,gnrl_key={}}this.network_write(req),req={}},showChangeCostMsgBox:function(fDeselect){this.m_box.setTitle("コスト");var info={};info.color=cmLabel.getColor(LABEL_FONT_INDEX.FONT_248),info.text="コストが変更されました。",this.m_box.setText(info.text),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.initLayoutProgress(0),fDeselect&&this.sendDeselectYunhee(),this.processCompleteCost()},0,"btnConfirm"),this.m_box.hide(!1)}.bind(this))),this.m_box.show(),info={}},sendDeselectYunhee:function(){this.m_campCostLayer.deselectYunhee()},processCompleteCost:function(){this.scheduleOnce(function(){this.m_campCostLayer.arrangeComplete(),this.m_campCostLayer.setTabIndex(COST_TAB_1),this.removeLayerProgress()},.1,"completeCost")},showConfirmDeselectYunhee:function(){this.m_box.setTitle("恋姫解除"),this.m_box.setText("恋姫を解除しますか。"),this.m_box.addButtonInfo(new MessageButtonInfo("いいえ",MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo("はい",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.sendPacketRemoveYunhee()},0,"btnYes"),this.m_box.hide()}.bind(this))),this.m_box.show()},showConfirmReleaseSlot:function(){this.m_ctbox.setTitle("コスト");var slot_id=this.m_campCostLayer.getSelectedCardIndex()-DEFAULT_OPEN_SLOT+1,costSlot=MasterManager.getInstance().get_CampCostSlot(slot_id);costSlot.bonus_type==BONUS_TYPE_JADE?(this.m_ctbox.setText("翡翠 "+costSlot.amount,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText(" 個を使用して",LABEL_FONT_INDEX.FONT_261)):costSlot.bonus_type==BONUS_TYPE_GOLD&&(this.m_ctbox.setText("金貨 "+costSlot.amount,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText(" 個を使用して",LABEL_FONT_INDEX.FONT_261)),this.m_ctbox.setText("\n"),this.m_ctbox.setText("コスト管理スロットを拡張しますか。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.addButtonInfo(new MessageButtonInfo("いいえ",MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_ctbox.hide()}.bind(this))),this.m_ctbox.addButtonInfo(new MessageButtonInfo("はい",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.sendPacketReleaseSlot()},0,"btnYes"),this.m_ctbox.hide()}.bind(this))),this.m_ctbox.show()},sendPacketRemoveYunhee:function(){var troop_index=this.m_campCostLayer.getTabIndex(),deletedYunhee=this.m_campCostLayer.getSelectedYunhee(),req={};req.opcode=net.OP.op_remove_user_camp_cost_general,req.troops_num=troop_index,req.gnrl_key={gnrl_id:deletedYunhee.gnrl_id,gnrl_num:deletedYunhee.gnrl_num},this.network_write(req),req={}},sendPacketReleaseSlot:function(){var troop_index=this.m_campCostLayer.getTabIndex(),slot_id=this.m_campCostLayer.getSelectedCardIndex()-DEFAULT_OPEN_SLOT+1,req={};req.opcode=net.OP.op_set_user_camp_cost_slot,req.troops_num=troop_index,req.slot_id=slot_id,this.network_write(req),req={}},showTooBigTroopsCostMsgBox:function(){var info;this.m_box.setTitle("コスト変更エラー"),(info={}).color=cmLabel.getColor(LABEL_FONT_INDEX.FONT_248),info.text="軍編成中のコストに影響が出るため",this.m_box.setText(info.text),this.m_box.setText("\n"),(info={}).color=cmLabel.getColor(LABEL_FONT_INDEX.FONT_248),info.text="配置恋姫は変更が出来ません。",this.m_box.setText(info.text),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showReleaseFrontSlot:function(){var info;this.m_box.setTitle("コスト"),(info={}).color=cmLabel.getColor(LABEL_FONT_INDEX.FONT_248),info.text="解禁は番号順に行うことが出来ます。",this.m_box.setText(info.text),this.m_box.setText("\n"),(info={}).color=cmLabel.getColor(LABEL_FONT_INDEX.FONT_248),info.text="先に前の番号のスロットを解禁してください。",this.m_box.setText(info.text),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showCampCostPopup:function(){this.m_box.is_show()&&this.m_box.hide();for(var val=arguments,msg=[],i=1;i<val.length;i++)msg.push(val[i]);this.showMsgBox(val[0],msg),msg=null},showCostSlotLack:function(){this.m_box.setTitle(res_str("label_camp_cost_error_title")),this.m_box.setText(res_str("label_camp_cost_slot_lack_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_camp_cost_slot_lack_text_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showTooBigGreatWallTroopsCostMsgBox:function(){this.m_box.setTitle(res_str("label_camp_cost_error_great_wall_text_1")),this.m_box.setText(res_str("label_camp_cost_error_great_wall_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_camp_cost_error_text_2")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()},showTooBigWorldWarTroopsCostMsgBox:function(){this.m_box.setTitle(res_str("label_camp_cost_error_title")),this.m_box.setText(res_str("label_camp_cost_error_great_wall_world_war_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_camp_cost_error_text_2")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(!1)}.bind(this))),this.m_box.show()}}),COST_LACK_GOLD=(COST_DESELECT_YUNHEE=401,COST_SELECT_YUNHEE=402,COST_TAB_1=403,COST_TAB_2=404,COST_TAB_3=405,COST_START=406,COST_RELEASE_SLOT=407,COST_RELEASE_FRONT_SLOT=408,COST_SLOT_LACK=409,COST_NEED_USER_LEVEL=410,COST_SHOW_HELP=411,412),SUB_LAYER_BRANCH_ABILITY=1,SUB_LAYER_COST=2,SUB_LAYER_ARBEIT=3,MAX_COST_ITEM_SIZE=8,DEFAULT_OPEN_SLOT=0,CampCostListItemLayer=cc.Layer.extend({fSlotLock:!1,fUserLevelBound:!1,m_slotLock:null,m_jadeIcon:null,m_iconValueBox:null,m_countLabel:null,m_levelBoundLabel:null,m_yunheeSelectLabel:null,m_yunheeIcon:null,ctor:function(index,user_cost_yunhee){this._super(),this.initLayout(index,user_cost_yunhee)},initLayout:function(index,user_cost_yunhee){"number"==typeof user_cost_yunhee?this.getYunheeFrame(index,user_cost_yunhee):this.getYunheeIcon(index,user_cost_yunhee),this.setContentSize(cc.size(ccWidth(this.m_yunheeIcon)+17,ccHeight(this.m_yunheeIcon)+17))},getYunheeIcon:function(index,user_yunhee){var cardInfo={};cardInfo.gnrl_id=user_yunhee.gnrl_id,cardInfo.level=user_yunhee.level,cardInfo.material_cost=user_yunhee.cost,cardInfo.use_material_cost=!0,this.m_yunheeIcon=(new Card).createCard(cardInfo,CARD_TYPE.type_common_card),this.m_yunheeIcon.setAnchorPoint(ZERO()),this.m_yunheeIcon.setPosition(0,0),this.addChild(this.m_yunheeIcon),cardInfo={}},getYunheeFrame:function(index,user_level){this.m_yunheeIcon=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_frame_2.png"),this.m_yunheeIcon.setAnchorPoint(ZERO()),this.m_yunheeIcon.setPosition(0,0),this.addChild(this.m_yunheeIcon),this.m_slotLock=cc.Sprite.create(RES_CDN_DEFULT+"common/img_list_lock_3.png"),this.m_slotLock.setAnchorPoint(ANCHOR_MIDDLE()),this.m_slotLock.setPosition(ccCenter(this.m_yunheeIcon)),this.m_yunheeIcon.addChild(this.m_slotLock);var costSlot=MasterManager.getInstance().get_CampCostSlot(index+1);user_level<costSlot.user_level&&(this.fUserLevelBound=!0,this.m_levelBoundLabel=cmLabel.getLabel("Lv."+costSlot.user_level,LABEL_FONT_INDEX.FONT_188),this.m_levelBoundLabel.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_levelBoundLabel.setPosition(ccCenter(this.m_yunheeIcon).x,ccHeight(this.m_yunheeIcon)-5),this.m_yunheeIcon.addChild(this.m_levelBoundLabel)),this.m_iconValueBox=cc.Sprite.create(RES_CDN_DEFULT+"icon/img_icon_valuebox_2.png"),this.m_iconValueBox.setAnchorPoint(ZERO()),this.m_iconValueBox.setPosition(22,-10),this.m_yunheeIcon.addChild(this.m_iconValueBox),this.m_countLabel=cmLabel.getLabel(costSlot.amount,LABEL_FONT_INDEX.FONT_161),this.m_countLabel.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_countLabel.setPosition(ccWidth(this.m_iconValueBox)-9,ccCenter(this.m_iconValueBox).y),this.m_iconValueBox.addChild(this.m_countLabel),this.m_jadeIcon=cc.Sprite.create("#img_shop_ic_jade.png"),this.m_jadeIcon.setAnchorPoint(ZERO()),this.m_jadeIcon.setPosition(11,-12),this.m_yunheeIcon.addChild(this.m_jadeIcon),this.fSlotLock=!(index<DEFAULT_OPEN_SLOT)||(this.m_slotLock.setVisible(!1),this.m_iconValueBox.setVisible(!1),this.m_jadeIcon.setVisible(!1),!1)},setYunheeIcon:function(selectedYunhee,index){this.m_yunheeIcon.removeFromParent(),0==selectedYunhee.gnrl_id?this.getYunheeFrame(index,0):this.getYunheeIcon(index,selectedYunhee),this.setContentSize(ccWidth(this.m_yunheeIcon)+17,ccHeight(this.m_yunheeIcon)+17)},getSlotLock:function(){return this.fSlotLock},setSlotLock:function(fSet){null!=this.m_slotLock&&(null!=this.m_iconValueBox&&this.m_iconValueBox.setVisible(fSet),null!=this.m_jadeIcon&&this.m_jadeIcon.setVisible(fSet),this.m_slotLock.setVisible(fSet),this.fSlotLock=fSet,1==this.fUserLevelBound&&null!=this.m_levelBoundLabel&&this.m_levelBoundLabel.setVisible(fSet))},getUserLevelBound:function(){return this.fUserLevelBound},onExit:function(){this._super(),1!=PREV_HELP&&(this.m_slotLock=null,this.m_jadeIcon=null,this.m_iconValueBox=null,this.m_countLabel=null,this.m_levelBoundLabel=null,(this.m_yunheeSelectLabel=null)!=this.m_yunheeIcon&&(this.m_yunheeIcon.removeAllChildrenWithCleanup(!0),this.m_yunheeIcon=null),this.removeAllChildrenWithCleanup(!0))}}),CampCostLayer=cc.Layer.extend({m_selectedIndex:-1,m_isArrangeMode:!1,m_troopIndex:0,m_currentCost:0,m_currAddedCost:0,m_chgAddedCost:0,m_userLevel:0,m_userAssetAmount:0,m_neededAmount:0,m_layer:null,m_leftLayer:null,m_comboLayer:null,m_tabLayer:null,m_contentLayer:null,m_materialLayer:null,m_tabBtn1:null,m_tabBtn2:null,m_tabBtn3:null,m_basicCost:null,m_changedCost:null,m_arrow:null,m_startBtn:null,m_startBtnScreen:null,m_assetLabel:null,m_selectedYunhee:null,m_costYunhees:[],m_costListItemLayers:[],ctor:function(){this.m_costYunhees=[{gnrl_key:{gnrl_id:0,gnrl_num:0},cost:0},{gnrl_key:{gnrl_id:0,gnrl_num:0},cost:0},{gnrl_key:{gnrl_id:0,gnrl_num:0},cost:0},{gnrl_key:{gnrl_id:0,gnrl_num:0},cost:0},{gnrl_key:{gnrl_id:0,gnrl_num:0},cost:0},{gnrl_key:{gnrl_id:0,gnrl_num:0},cost:0},{gnrl_key:{gnrl_id:0,gnrl_num:0},cost:0},{gnrl_key:{gnrl_id:0,gnrl_num:0},cost:0},{gnrl_key:{gnrl_id:0,gnrl_num:0},cost:0}],this._super()},initLayout:function(){this.m_selectedYunhee={};var data=NetService().get_User_info();this.m_userLevel=data.user_level,this.m_layer=new cc.Layer,this.addChild(this.m_layer),this.m_leftLayer=this.getLeftBoxLayer(),this.m_leftLayer.setAnchorPoint(ZERO()),this.m_leftLayer.setPosition(LP(this,0,0)),this.m_layer.addChild(this.m_leftLayer,2),this.m_leftLayerPos=this.m_leftLayer.getPosition(),this.setMaterialInfo()},setMaterialInfo:function(){var gnrl_list=[];NetService().Load_User_Troops_General();CampService.getInstance().getUserCampMaterialList(gnrl_list,0),this.m_materialLayer=new CampCommonLayer,this.m_materialLayer.setUserGeneralInfo(gnrl_list),this.m_materialLayer.setUseCostInfo(),this.m_materialLayer.setCampSubLayer(SUB_LAYER_COST),this.m_materialLayer.initLayout(),this.m_materialLayer.setAnchorPoint(ZERO()),this.m_materialLayer.setPosition(LP(this,ccWidth(this.m_leftLayer)+1,0)),this.m_layer.addChild(this.m_materialLayer),this.m_materialLayer.setUseCardScreen(!1),gnrl_list=[]},onEnter:function(){this._super()},onExit:function(){this._super(),1!=PREV_HELP&&(null!=this.m_layer&&this.m_layer.removeAllChildrenWithCleanup(!0),null!=this.m_leftLayer&&this.m_leftLayer.removeAllChildrenWithCleanup(!0),null!=this.m_comboLayer&&this.m_comboLayer.removeAllChildrenWithCleanup(!0),null!=this.m_tabLayer&&this.m_tabLayer.removeAllChildrenWithCleanup(!0),null!=this.m_contentLayer&&this.m_contentLayer.removeAllChildrenWithCleanup(!0),null!=this.m_materialLayer&&this.m_materialLayer.removeAllChildrenWithCleanup(!0),this.m_layer=null,this.m_leftLayer=null,this.m_comboLayer=null,this.m_tabLayer=null,this.m_contentLayer=null,this.m_materialLayer=null,this.m_tabBtn1=null,this.m_tabBtn2=null,this.m_tabBtn3=null,this.m_basicCost=null,this.m_changedCost=null,this.m_arrow=null,this.m_startBtn=null,this.m_startBtnScreen=null,this.m_assetLabel=null,this.m_selectedYunhee=null,this.m_costYunhees=[],this.m_costListItemLayers=[],delete this.m_costYunhees,delete this.m_costListItemLayers)},setCampCostList:function(list){this.m_userCostYunheeList=list},setCampCostSlot:function(cost_slot){this.m_userCostSlot=cost_slot},getLeftBoxLayer:function(){var layer=new cc.Layer;return this.setTabIndex(COST_TAB_1),layer.addChild(this.m_contentLayer),layer.setContentSize(ccSize(this.m_contentLayer)),layer},getTabLayer:function(){var layer=new cc.Layer;return this.m_tabBtn1=new LabelButton("btn_01_on.png","btn_01_none.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_tabBtn1.setFont(LABEL_FONT_INDEX.FONT_241),this.m_tabBtn1.setString("1軍"),this.m_tabBtn1.setAnchorPoint(ZERO()),this.m_tabBtn1.setPosition(17,508),this.m_tabBtn1.addClickEventListener(function(sender){}),layer.addChild(this.m_tabBtn1),this.m_tabBtn2=new LabelButton("btn_01_on.png","btn_01_none.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_tabBtn2.setFont(LABEL_FONT_INDEX.FONT_241),this.m_tabBtn2.setString("2軍"),this.m_tabBtn2.setAnchorPoint(ZERO()),this.m_tabBtn2.setPosition(this.m_tabBtn1.getPosition().x+ccWidth(this.m_tabBtn1),508),this.m_tabBtn2.addClickEventListener(function(sender){}),layer.addChild(this.m_tabBtn2),this.m_tabBtn3=new LabelButton("btn_01_on.png","btn_01_none.png","btn_01_off.png",ccui.Widget.PLIST_TEXTURE),this.m_tabBtn3.setFont(LABEL_FONT_INDEX.FONT_241),this.m_tabBtn3.setString("3軍"),this.m_tabBtn3.setAnchorPoint(ZERO()),this.m_tabBtn3.setPosition(this.m_tabBtn2.getPosition().x+ccWidth(this.m_tabBtn2),508),this.m_tabBtn3.addClickEventListener(function(sender){}),layer.addChild(this.m_tabBtn3),layer},getContentLayer:function(){var layer=new cc.Layer,bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));bg_box.setContentSize(478,568),bg_box.setAnchorPoint(ZERO()),bg_box.setPosition(ZERO()),layer.addChild(bg_box),layer.setContentSize(ccSize(bg_box));var title_bg=cc.Sprite.create(RES_CDN_DEFULT+"common/img_navi_center_2.png");title_bg.setAnchorPoint(ZERO()),title_bg.setPosition(8,509),layer.addChild(title_bg);var title_label=cmLabel.getLabel("コスト管理",LABEL_FONT_INDEX.FONT_261);title_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),title_label.setPosition(20,ccCenter(title_bg).y+3),title_bg.addChild(title_label);var help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE);help_btn.setAnchorPoint(ZERO()),help_btn.setPosition(416,10),title_bg.addChild(help_btn),help_btn.addClickEventListener(function(sender){this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_CampCostScene],COST_SHOW_HELP)},0,"COST_SHOW_HELP")});var cost_label=cmLabel.getLabel("cost",LABEL_FONT_INDEX.FONT_261);cost_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),cost_label.setPosition(149,458),layer.addChild(cost_label),this.m_basicCost=cmLabel.getLabel("20",LABEL_FONT_INDEX.FONT_261),this.m_basicCost.setAnchorPoint(ANCHOR_MIDDLE()),this.m_basicCost.setPosition(236,cost_label.getPosition().y),layer.addChild(this.m_basicCost),this.m_arrow=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_arrow_2.png"),this.m_arrow.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_arrow.setPosition(270,cost_label.getPosition().y),layer.addChild(this.m_arrow),this.m_changedCost=cmLabel.getLabel("0",LABEL_FONT_INDEX.FONT_2612),this.m_changedCost.setAnchorPoint(ANCHOR_MIDDLE()),this.m_changedCost.setPosition(315,cost_label.getPosition().y),layer.addChild(this.m_changedCost);var tableLayer=this.getTableLayer();tableLayer.setEnableMouseScroll(!1),tableLayer.setAnchorPoint(ZERO()),tableLayer.setPosition(17,90),layer.addChild(tableLayer);var warning_mark=cc.Sprite.create(RES_CDN_DEFULT+"menu_friend/img_friend_text.png");warning_mark.setAnchorPoint(ZERO()),warning_mark.setPosition(32,146),layer.addChild(warning_mark);var warning_label1=cmLabel.getLabel("スロットに恋姫を配置してCOSTを上げてください。",LABEL_FONT_INDEX.FONT_1613);warning_label1.setAnchorPoint(ZERO()),warning_label1.setPosition(69,163),layer.addChild(warning_label1);var warning_label2=cmLabel.getLabel("COSTスロットに配置された恋姫は軍に編成できません。",LABEL_FONT_INDEX.FONT_1613);warning_label2.setAnchorPoint(ZERO()),warning_label2.setPosition(69,143),layer.addChild(warning_label2);var warning_mark2=cc.Sprite.create(RES_CDN_DEFULT+"menu_friend/img_friend_text.png");warning_mark2.setAnchorPoint(ZERO()),warning_mark2.setPosition(32,86),layer.addChild(warning_mark2);var warning_label3=cmLabel.getLabel(res_str("label_camp_not_use_equipped_general_info"),LABEL_FONT_INDEX.FONT_1613);warning_label3.setAnchorPoint(ZERO()),warning_label3.setPosition(69,93),layer.addChild(warning_label3),this.m_startBtn=new ccui.Button("btn_03_off.png","btn_03_on.png","btn_03_on.png",ccui.Widget.PLIST_TEXTURE),this.m_startBtn.setAnchorPoint(ZERO()),this.m_startBtn.setPosition(17,16),this.m_startBtn.addClickEventListener(function(sender){this.m_userAssetAmount>=this.m_neededAmount?MainObserver.getInstance().postNotification(sceneStr[scene_CampCostScene],COST_START):MainObserver.getInstance().postNotification(sceneStr[scene_CampCostScene],COST_LACK_GOLD)}.bind(this)),layer.addChild(this.m_startBtn);var arrange_cmplt_label=cmLabel.getLabel("配置完了",LABEL_FONT_INDEX.FONT_241);arrange_cmplt_label.setAnchorPoint(ANCHOR_MIDDLE()),arrange_cmplt_label.setPosition(146,ccCenter(this.m_startBtn).y),this.m_startBtn.addChild(arrange_cmplt_label);var input_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_9p_yh_info_box.png",RectZero());input_bg.setContentSize(130,38),input_bg.setInsetBottom(13),input_bg.setInsetLeft(13),input_bg.setInsetRight(13),input_bg.setInsetTop(13),input_bg.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),input_bg.setPosition(214,ccCenter(this.m_startBtn).y),this.m_startBtn.addChild(input_bg);var gold_bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_sell_gold.png");return gold_bg.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),gold_bg.setPosition(0,0),input_bg.addChild(gold_bg),this.m_userAssetAmount=NetService().get_UserItemInfo_V2().gold_cnt,this.m_userAssetAmount>=this.m_neededAmount?this.m_assetLabel=cmLabel.getLabel(this.m_neededAmount,LABEL_FONT_INDEX.FONT_2011):this.m_assetLabel=cmLabel.getLabel(this.m_neededAmount,LABEL_FONT_INDEX.FONT_2017),this.m_assetLabel=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2017),this.m_assetLabel.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_assetLabel.setPosition(ccWidth(input_bg)-10,ccCenter(input_bg).y),input_bg.addChild(this.m_assetLabel),this.m_startBtnScreen=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero()),this.m_startBtnScreen.setContentSize(this.m_startBtn.getContentSize()),this.m_startBtnScreen.setAnchorPoint(ANCHOR_MIDDLE()),this.m_startBtnScreen.setPosition(ccCenter(this.m_startBtn).x,ccCenter(this.m_startBtn).y),this.m_startBtn.addChild(this.m_startBtnScreen),this.m_startBtnScreen.setVisible(!1),this.setEnabledStart(!1),layer},setAssetAmountLabel:function(amount){this.m_userAssetAmount>=amount?this.m_assetLabel.setColor(cmLabel.getColor(LABEL_FONT_INDEX.FONT_2011)):this.m_assetLabel.setColor(cmLabel.getColor(LABEL_FONT_INDEX.FONT_2017)),this.m_assetLabel.setString(amount)},getTableLayer:function(){var tableLayer=new TableViewLayer;return tableLayer.setContentSize(444,345),tableLayer.setItemCount(MAX_COST_ITEM_SIZE),tableLayer.setColumnCount(4),this.m_costListItemLayers=[],tableLayer.getItemNode=function(index,contentSize,m){if(this.m_userCostYunheeList.length>index){var userCostYunhee=this.m_userCostYunheeList[index],gc=MasterManager.getInstance().get_GeneralCost(userCostYunhee.gnrl_id);userCostYunhee.cost=gc.cost;var layer=new CampCostListItemLayer(index,userCostYunhee);return this.m_costYunhees[index].gnrl_key.gnrl_id=userCostYunhee.gnrl_id,this.m_costYunhees[index].gnrl_key.gnrl_num=userCostYunhee.gnrl_num,this.m_costYunhees[index].cost=userCostYunhee.cost,this.m_currAddedCost+=userCostYunhee.cost,this.m_chgAddedCost+=userCostYunhee.cost,this.m_costListItemLayers.push(layer),layer}layer=new CampCostListItemLayer(index,this.m_userLevel);return DEFAULT_OPEN_SLOT<=index&&0!=this.m_userCostSlot.troops_num&&this.m_userCostSlot.slots[index-DEFAULT_OPEN_SLOT]&&layer.setSlotLock(!1),this.m_costListItemLayers.push(layer),layer}.bind(this),tableLayer.initLayout(),tableLayer.setTouchScrollEnabled(!1),tableLayer.onItemTouchBegin=function(index){return!0},tableLayer.onItemTouchMoved=function(isScroll){},tableLayer.onItemTouchCancel=function(index){return!0},tableLayer.onItemTouchEnd=function(index){return AudioEngine.getInstance().playNormaButtonSound(),0!=this.m_costYunhees[index].gnrl_key.gnrl_id?(this.m_selectedIndex=index,this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_CampCostScene],COST_DESELECT_YUNHEE)},0,"COST_DESELECT_YUNHEE")):this.m_costListItemLayers[index].getSlotLock()&&(1==this.m_costListItemLayers[index].getUserLevelBound()?this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_CampCostScene],COST_NEED_USER_LEVEL)},0,"COST_NEED_USER_LEVEL"):index==DEFAULT_OPEN_SLOT||DEFAULT_OPEN_SLOT<index&&1==this.m_userCostSlot.slots[index-DEFAULT_OPEN_SLOT-1]?(this.m_selectedIndex=index,this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_CampCostScene],COST_RELEASE_SLOT)},0,"COST_RELEASE_SLOT")):this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_CampCostScene],COST_RELEASE_FRONT_SLOT)},0,"COST_RELEASE_FRONT_SLOT")),!0}.bind(this),tableLayer},setEnabledStart:function(fEnabled){this.m_startBtn.setEnabled(fEnabled),this.m_startBtnScreen.setVisible(!fEnabled)},setArrangeMode:function(){},getArrangeMode:function(){return this.m_isArrangeMode},setYunheeInCost:function(){var materialYunhee={gnrl_key:{}};if(this.m_materialLayer.getSelectedYunhee(materialYunhee),this.m_isArrangeMode&&-1<this.m_selectedIndex)if(this.m_costYunhees[this.m_selectedIndex].gnrl_key.gnrl_id==materialYunhee.gnrl_key.gnrl_id&&this.m_costYunhees[this.m_selectedIndex].gnrl_key.gnrl_num==materialYunhee.gnrl_key.gnrl_num){this.m_selectedYunhee.gnrl_id=materialYunhee.gnrl_key.gnrl_id,this.m_selectedYunhee.gnrl_num=materialYunhee.gnrl_key.gnrl_num,this.m_selectedYunhee.class_type=materialYunhee.class_type,this.m_selectedYunhee.level=materialYunhee.gnrl_level,this.m_materialLayer.deselectYunhee(this.m_selectedYunhee),this.m_costYunhees[this.m_selectedIndex].gnrl_key.gnrl_id=0,this.m_costYunhees[this.m_selectedIndex].gnrl_key.gnrl_num=0,this.m_costYunhees[this.m_selectedIndex].cost=0,this.m_selectedYunhee.gnrl_id=0,this.m_selectedYunhee.gnrl_num=0,this.m_selectedYunhee.class_type=0,this.m_selectedYunhee.level=0,this.m_selectedYunhee.name="General Name",this.m_selectedYunhee.cost=0,(layer=this.m_costListItemLayers[this.m_selectedIndex]).setYunheeIcon(this.m_selectedYunhee,this.m_selectedIndex)}else{for(var idx=0;idx<this.m_costYunhees.length;idx++)if(0!=this.m_costYunhees[idx].gnrl_key.gnrl_id&&this.m_costYunhees[idx].gnrl_key.gnrl_id==materialYunhee.gnrl_key.gnrl_id&&this.m_costYunhees[idx].gnrl_key.gnrl_num==materialYunhee.gnrl_key.gnrl_num)return;0==(layer=this.m_costListItemLayers[this.m_selectedIndex]).getSlotLock()&&(this.m_selectedYunhee.gnrl_id=this.m_costYunhees[this.m_selectedIndex].gnrl_key.gnrl_id,this.m_selectedYunhee.gnrl_num=this.m_costYunhees[this.m_selectedIndex].gnrl_key.gnrl_num,this.m_selectedYunhee.class_type=0,this.m_selectedYunhee.level=0,this.m_materialLayer.deselectYunhee(this.m_selectedYunhee),this.getYunheeInfos(this.m_selectedYunhee,materialYunhee),this.m_materialLayer.setYunheeInMaterial(this.m_selectedIndex),layer.setYunheeIcon(this.m_selectedYunhee,this.m_selectedIndex),this.m_costYunhees[this.m_selectedIndex].gnrl_key.gnrl_id=this.m_selectedYunhee.gnrl_id,this.m_costYunhees[this.m_selectedIndex].gnrl_key.gnrl_num=this.m_selectedYunhee.gnrl_num,this.m_costYunhees[this.m_selectedIndex].cost=this.m_selectedYunhee.cost)}else{var isDeselected=!1;this.m_selectedIndex=-1;for(var i=0;i<MAX_COST_ITEM_SIZE;i++){var costYunhee=this.m_costYunhees[i];if(0!=costYunhee.gnrl_key.gnrl_id){if(costYunhee.gnrl_key.gnrl_id==materialYunhee.gnrl_key.gnrl_id&&costYunhee.gnrl_key.gnrl_num==materialYunhee.gnrl_key.gnrl_num){isDeselected=!0,this.m_selectedIndex=i;break}}else-1==this.m_selectedIndex&&(this.m_selectedIndex=i)}if(-1==this.m_selectedIndex)return;if(isDeselected){this.m_selectedYunhee={},this.m_selectedYunhee.gnrl_id=materialYunhee.gnrl_key.gnrl_id,this.m_selectedYunhee.gnrl_num=materialYunhee.gnrl_key.gnrl_num,this.m_selectedYunhee.class_type=materialYunhee.class_type,this.m_selectedYunhee.level=materialYunhee.gnrl_level,this.m_materialLayer.deselectYunhee(this.m_selectedYunhee);var gc=MasterManager.getInstance().get_GeneralCost(this.m_selectedYunhee.gnrl_id);this.m_chgAddedCost-=gc.cost,this.isDeselectableYunhee()&&(this.m_neededAmount-=gc.amount,this.m_neededAmount<0&&(this.m_neededAmount=0),this.setAssetAmountLabel(this.m_neededAmount)),this.m_selectedYunhee.gnrl_id=0,this.m_selectedYunhee.gnrl_num=0,this.m_selectedYunhee.class_type=0,this.m_selectedYunhee.level=0,this.m_selectedYunhee.name="General Name",this.m_selectedYunhee.cost=0,(layer=this.m_costListItemLayers[this.m_selectedIndex]).setYunheeIcon(this.m_selectedYunhee,this.m_selectedIndex),this.m_selectedIndex>=DEFAULT_OPEN_SLOT&&0!=this.m_userCostSlot.troops_num&&this.m_userCostSlot.slots[this.m_selectedIndex-DEFAULT_OPEN_SLOT]&&layer.setSlotLock(!1),this.m_costYunhees[this.m_selectedIndex].gnrl_key.gnrl_id=0,this.m_costYunhees[this.m_selectedIndex].gnrl_key.gnrl_num=0,this.m_costYunhees[this.m_selectedIndex].cost=0}else{var layer;if(0!=(layer=this.m_costListItemLayers[this.m_selectedIndex]).getSlotLock())return void this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(COST_SLOT_LACK)},0,"COST_SLOT_LACK");this.m_selectedYunhee={},this.getYunheeInfos(this.m_selectedYunhee,materialYunhee),this.m_materialLayer.setYunheeInMaterial(this.m_selectedIndex),layer.setYunheeIcon(this.m_selectedYunhee,this.m_selectedIndex),this.m_costYunhees[this.m_selectedIndex].gnrl_key.gnrl_id=this.m_selectedYunhee.gnrl_id,this.m_costYunhees[this.m_selectedIndex].gnrl_key.gnrl_num=this.m_selectedYunhee.gnrl_num,this.m_costYunhees[this.m_selectedIndex].cost=this.m_selectedYunhee.cost,this.m_chgAddedCost+=this.m_selectedYunhee.cost}}var chgCost=this.m_currentCost-this.m_currAddedCost+this.m_chgAddedCost;this.m_changedCost.setString(chgCost),0==this.m_chgAddedCost?this.setEnabledStart(!1):this.setEnabledStart(!0)},getYunheeInfos:function(yunhee,materialYunhee){yunhee.gnrl_id=materialYunhee.gnrl_key.gnrl_id,yunhee.gnrl_num=materialYunhee.gnrl_key.gnrl_num,yunhee.class_type=materialYunhee.class_type,yunhee.level=materialYunhee.gnrl_level;var mt=MasterManager.getInstance(),g=mt.get_General(yunhee.gnrl_id),gc=mt.get_GeneralCost(yunhee.gnrl_id);yunhee.name=g.name,yunhee.cost=gc.cost,yunhee.fight_type=g.fight_type,yunhee.state_type=g.state_type,yunhee.force_type=g.arm_service_type,yunhee.max_class_type=g.evolution_max_class_type,yunhee.rare_type=g.rare_type,this.m_neededAmount+=gc.amount,this.setAssetAmountLabel(this.m_neededAmount)},getCostYunhees:function(){return this.m_costYunhees},setTabIndex:function(index){var fIsFirst=!0;if(0!=this.m_troopIndex){fIsFirst=!1,this.m_selectedIndex=-1,this.m_isArrangeMode=!1;for(var i=0;i<MAX_COST_ITEM_SIZE;i++)this.m_costYunhees[i]={gnrl_key:{gnrl_id:0,gnrl_num:0},cost:0};this.m_materialLayer.deselectAllYunhee(),this.m_contentLayer.removeFromParent()}this.m_troopIndex=index-COST_TAB_1+1;var campService=CampService.getInstance(),cost_yunhee_list=[];campService.getUserCampCostYunheeList(cost_yunhee_list,this.m_troopIndex),this.setCampCostList(cost_yunhee_list);var cost_slot={slots:[]};campService.getUserCampCostSlot(this.m_troopIndex,cost_slot),this.setCampCostSlot(cost_slot),this.m_contentLayer=this.getContentLayer(),this.m_contentLayer.setAnchorPoint(ZERO()),this.m_contentLayer.setPosition(ZERO()),0==fIsFirst&&this.m_leftLayer.addChild(this.m_contentLayer);var load_cost=GeneralService.getInstance().getUserTotalCost(this.m_troopIndex);this.m_currentCost=load_cost.cost,this.m_basicCost.setString(load_cost.cost),this.m_changedCost.setString(load_cost.cost),this.m_currAddedCost=this.m_chgAddedCost=0,this.setEnabledStart(!1)},getTabIndex:function(){return this.m_troopIndex},isDeselectableYunhee:function(){if(-1<this.m_selectedIndex)for(var gnrl_id=this.m_costYunhees[this.m_selectedIndex].gnrl_key.gnrl_id,gnrl_num=this.m_costYunhees[this.m_selectedIndex].gnrl_key.gnrl_num,idx=0;idx<this.m_userCostYunheeList.length;idx++)if(gnrl_id==this.m_userCostYunheeList[idx].gnrl_id&&gnrl_num==this.m_userCostYunheeList[idx].gnrl_num)return!1;return!0},deselectYunhee:function(){if(-1<this.m_selectedIndex){this.m_selectedYunhee.gnrl_id=this.m_costYunhees[this.m_selectedIndex].gnrl_key.gnrl_id,this.m_selectedYunhee.gnrl_num=this.m_costYunhees[this.m_selectedIndex].gnrl_key.gnrl_num,this.m_materialLayer.deselectYunhee(this.m_selectedYunhee);var gc=MasterManager.getInstance().get_GeneralCost(this.m_selectedYunhee.gnrl_id);this.m_chgAddedCost-=gc.cost;var chgCost=this.m_currentCost-this.m_currAddedCost+this.m_chgAddedCost;this.m_changedCost.setString(chgCost),this.isDeselectableYunhee()&&(this.m_neededAmount-=gc.amount,this.m_neededAmount<0&&(this.m_neededAmount=0),this.setAssetAmountLabel(this.m_neededAmount)),this.m_costYunhees[this.m_selectedIndex].gnrl_key.gnrl_id=0,this.m_costYunhees[this.m_selectedIndex].gnrl_key.gnrl_num=0,this.m_costYunhees[this.m_selectedIndex].cost=0,this.m_selectedYunhee.gnrl_id=0,this.m_selectedYunhee.gnrl_num=0,this.m_selectedYunhee.class_type=0,this.m_selectedYunhee.level=0,this.m_selectedYunhee.name="General Name",this.m_selectedYunhee.cost=0;var layer=this.m_costListItemLayers[this.m_selectedIndex];layer.setYunheeIcon(this.m_selectedYunhee,this.m_selectedIndex),this.m_selectedIndex>=DEFAULT_OPEN_SLOT&&0!=this.m_userCostSlot.troops_num&&this.m_userCostSlot.slots[this.m_selectedIndex-DEFAULT_OPEN_SLOT]&&layer.setSlotLock(!1),0==this.m_chgAddedCost&&this.setEnabledStart(!1)}},arrangeComplete:function(){this.m_currentCost=this.m_currentCost-this.m_currAddedCost+this.m_chgAddedCost,this.m_currAddedCost=this.m_chgAddedCost=0,this.m_basicCost.setString(this.m_currentCost),this.setEnabledStart(!1),this.m_materialLayer.removeFromParent(),this.setMaterialInfo(),this.m_neededAmount=0,this.setAssetAmountLabel(this.m_neededAmount);var cost_yunhee_list=[];CampService.getInstance().getUserCampCostYunheeList(cost_yunhee_list,this.m_troopIndex),this.setCampCostList(cost_yunhee_list)},sortMaterialYunhee:function(){this.m_materialLayer.sortMaterialLayer()},isEmptyYunhee:function(){for(var idx=0;idx<this.m_costYunhees.length;idx++)if(0<this.m_costYunhees[idx].gnrl_key.gnrl_id)return!1;return!0},getChangedCostValues:function(){return this.m_currentCost-this.m_currAddedCost+this.m_chgAddedCost},getNeededAmount:function(){return this.m_neededAmount},getSelectedCardIndex:function(){return this.m_selectedIndex},completeOpenSlot:function(){if(-1<this.m_selectedIndex){this.m_costListItemLayers[this.m_selectedIndex].setSlotLock(!1);var cost_slot={slots:[]};CampService.getInstance().getUserCampCostSlot(this.m_troopIndex,cost_slot),this.setCampCostSlot(cost_slot)}this.m_selectedIndex=-1},getSelectedYunhee:function(){return-1<this.m_selectedIndex&&(this.m_selectedYunhee.gnrl_id=this.m_costYunhees[this.m_selectedIndex].gnrl_key.gnrl_id,this.m_selectedYunhee.gnrl_num=this.m_costYunhees[this.m_selectedIndex].gnrl_key.gnrl_num),this.m_selectedYunhee}}),CAMP_BRANCH_ABILITY=1,CAMP_COST=2,CAMP_ARBEIT=3,CAMP_FACTORY=4,DIFFERENCE_LEVEL_JADE=2,DIFFERENCE_LEVEL_GOLD=1,PREV_HELP=!1,CampScene=GameScene.extend({m_selectedCamp:0,m_arbeitLevel:0,m_costLevel:0,m_campLayer:null,m_layer:null,m_campBranch:null,m_campCost:null,m_campArbeit:null,m_campFactory:null,m_gameObserver:null,m_gnrl_img:[],m_factoryLevel:0,ctor:function(){this.m_gnrl_img=[],this._super(scene_CampScene),PREV_HELP=!1},init:function(){this.initLayoutProgress2(),this.m_gameObserver=MainObserver.getInstance(),this.m_gameObserver.addObserver(this.onNotification,this,sceneStr[scene_CampScene]),this.m_campBranch={},this.m_campCost={},this.m_campArbeit={},this.m_campFactory={},CampService.getInstance().getUserCamp(this.m_campBranch,CAMP_BRANCH_ABILITY),CampService.getInstance().getUserCamp(this.m_campCost,CAMP_COST),CampService.getInstance().getUserCamp(this.m_campArbeit,CAMP_ARBEIT),CampService.getInstance().getUserCamp(this.m_campFactory,CAMP_FACTORY);var camp_branch_Id=CampService.getInstance().getUserCampId(this.m_campBranch.camp_type,this.m_campBranch.camp_level),camp_cost_Id=CampService.getInstance().getUserCampId(this.m_campCost.camp_type,this.m_campCost.camp_level),camp_factory_Id=CampService.getInstance().getUserCampId(this.m_campFactory.camp_type,this.m_campFactory.camp_level),mt=MasterManager.getInstance(),camp_branch=mt.get_Camp(camp_branch_Id),camp_cost=mt.get_Camp(camp_cost_Id),camp_factory=mt.get_Camp(camp_factory_Id);NOT_USE_SP_CAMP_EFFECT?this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_camp/bg_main_sky.png"):(this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_camp/bg_main_sky.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_camp/bg_main_sky_1.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_camp/bg_main_sky_2.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_camp/bg_main_sky_3.png")),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_camp/bg_main.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_camp/btn_facility_2_"+camp_cost.camp_image+"_off.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_camp/btn_facility_2_"+camp_cost.camp_image+"_on.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_camp/btn_facility_4_"+camp_branch.camp_image+"_off.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_camp/btn_facility_4_"+camp_branch.camp_image+"_on.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_camp/btn_facility_1_"+camp_factory.camp_image+"_off.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"menu_camp/btn_facility_1_"+camp_factory.camp_image+"_on.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"common/img_box_jade.png"),this.m_gnrl_img.push(RES_CDN_DEFULT+"common/img_box_gold.png"),this.initCampLayer()},initCampLayer:function(){resourceLoader(this.m_gnrl_img,function(){var bg,sun_light,win_size=cc.director.getWinSize(),main_layer=new cc.Layer;(main_layer.setContentSize(win_size),this.addChild(main_layer),NOT_USE_SP_CAMP_EFFECT?this.runMainSkyAnimation_SP(main_layer):this.runMainSkyAnimation(main_layer),USE_SP_CAMP_SCALE)?((bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_camp/bg_main.png")).setPosition(ccCenter(this)),bg.setScale(2),main_layer.addChild(bg),(sun_light=cc.Sprite.create("#effect_main_light.png")).setAnchorPoint(ANCHOR_TOP_LEFT()),sun_light.setPosition(0,ccHeight(main_layer)),main_layer.addChild(sun_light),sun_light.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR),sun_light.runAction(new cc.RepeatForever(new cc.Sequence(new cc.FadeOut(3),new cc.FadeIn(3))))):((bg=cc.Sprite.create(RES_CDN_DEFULT+"menu_camp/bg_main.png")).setPosition(ccCenter(this)),main_layer.addChild(bg),(sun_light=cc.Sprite.create("#effect_main_light.png")).setAnchorPoint(ANCHOR_TOP_LEFT()),sun_light.setPosition(0,ccHeight(main_layer)),main_layer.addChild(sun_light),sun_light.setBlendFunc(GL_ONE,GL_ONE_MINUS_SRC_COLOR),sun_light.runAction(new cc.RepeatForever(new cc.Sequence(new cc.FadeOut(3),new cc.FadeIn(3)))));NOT_USE_SP_CAMP_EFFECT?(this.runMainCataractAnimation_SP(bg),this.runMainForestAnimation_SP(bg,main_layer),this.runMainCloudAnimation_SP(main_layer)):(this.runMainCataractAnimation(bg),this.runMainForestAnimation(bg,main_layer),this.runMainCloudAnimation(main_layer));CampService.getInstance();this.m_campLayer=new CampLayer,this.m_campLayer.setPosition(ZERO()),main_layer.addChild(this.m_campLayer),this.m_arbeitLevel=this.m_campArbeit.camp_level,this.m_costLevel=this.m_campCost.camp_level,this.m_campLayer.setCampData(this.m_campBranch,CAMP_BRANCH_ABILITY),this.m_campLayer.setCampData(this.m_campCost,CAMP_COST),this.m_campLayer.setCampData(this.m_campArbeit,CAMP_ARBEIT),this.m_campLayer.setCampData(this.m_campFactory,CAMP_FACTORY),this.m_campLayer.initLayout();var title,statusLayer=new StatusLayer(INVOKER_TYPE.normal);(statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer),USE_SP_CAMP_SCALE)?((title=cc.Sprite.create(RES_CDN_DEFULT+"menu_camp/img_camp_text_camp.png")).setAnchorPoint(ZERO()),title.setPosition(90,585),title.setScale(2),this.addChild(title)):((title=cc.Sprite.create(RES_CDN_DEFULT+"menu_camp/img_camp_text_camp.png")).setAnchorPoint(ZERO()),title.setPosition(90,585),this.addChild(title));var back_btn=new ccui.Button("btn_home_off.png","btn_home_on.png","",ccui.Widget.PLIST_TEXTURE);return back_btn.setAnchorPoint(ZERO()),back_btn.setPosition(10,559),back_btn.addClickEventListener(function(sender){this.back()}.bind(this)),this.addChild(back_btn),this.scheduleOnce(this.removeProgressEnd,1),!0}.bind(this))},removeProgressEnd:function(){this.removeLayerProgress2()},back:function(){this.onKeyBack(!0)},runMainSkyAnimation:function(pLayer){var bg_main_sky=cc.Sprite.create(RES_CDN_DEFULT+"menu_camp/bg_main_sky.png");bg_main_sky.setAnchorPoint(ANCHOR_MIDDLE()),bg_main_sky.setPosition(ccCenter(this)),pLayer.addChild(bg_main_sky);var m_cloud_front_1=cc.Sprite.create(RES_CDN_DEFULT+"menu_camp/bg_main_sky_1.png");m_cloud_front_1.setAnchorPoint(ZERO()),m_cloud_front_1.setPosition(0,393),bg_main_sky.addChild(m_cloud_front_1);var m_cloud_front_2=cc.Sprite.create(RES_CDN_DEFULT+"menu_camp/bg_main_sky_1.png");m_cloud_front_2.setAnchorPoint(ZERO()),m_cloud_front_2.setPosition(-ccWidth(m_cloud_front_2),393),bg_main_sky.addChild(m_cloud_front_2);var m_cloud_middle_1=cc.Sprite.create(RES_CDN_DEFULT+"menu_camp/bg_main_sky_2.png");m_cloud_middle_1.setAnchorPoint(ZERO()),m_cloud_middle_1.setPosition(0,393),bg_main_sky.addChild(m_cloud_middle_1);var m_cloud_middle_2=cc.Sprite.create(RES_CDN_DEFULT+"menu_camp/bg_main_sky_2.png");m_cloud_middle_2.setAnchorPoint(ZERO()),m_cloud_middle_2.setPosition(-ccWidth(m_cloud_middle_2),393),bg_main_sky.addChild(m_cloud_middle_2);var m_cloud_back_1=cc.Sprite.create(RES_CDN_DEFULT+"menu_camp/bg_main_sky_3.png");m_cloud_back_1.setAnchorPoint(ZERO()),m_cloud_back_1.setPosition(0,393),bg_main_sky.addChild(m_cloud_back_1);var m_cloud_back_2=cc.Sprite.create(RES_CDN_DEFULT+"menu_camp/bg_main_sky_3.png");m_cloud_back_2.setAnchorPoint(ZERO()),m_cloud_back_2.setPosition(-ccWidth(m_cloud_back_2),393),bg_main_sky.addChild(m_cloud_back_2);var front_1_move=new cc.MoveTo(20,cc.p(ccWidth(m_cloud_front_1),m_cloud_front_1.y)),front_1_place=new cc.Place(cc.p(0,m_cloud_front_1.y)),front_1_repeat=new cc.RepeatForever(new cc.Sequence(front_1_move,front_1_place));m_cloud_front_1.runAction(front_1_repeat);var front_2_move=new cc.MoveTo(20,cc.p(0,m_cloud_front_1.y)),front_2_place=new cc.Place(cc.p(-ccWidth(m_cloud_front_2),m_cloud_front_2.y)),front_2_repeat=new cc.RepeatForever(new cc.Sequence(front_2_move,front_2_place));m_cloud_front_2.runAction(front_2_repeat);var middle_1_move=new cc.MoveTo(30,cc.p(ccWidth(m_cloud_middle_1),m_cloud_middle_1.y)),middle_1_place=new cc.Place(cc.p(0,m_cloud_middle_1.y)),middle_1_repeat=new cc.RepeatForever(new cc.Sequence(middle_1_move,middle_1_place));m_cloud_middle_1.runAction(middle_1_repeat);var middle_2_move=new cc.MoveTo(30,cc.p(0,m_cloud_middle_2.y)),middle_2_place=new cc.Place(cc.p(-ccWidth(m_cloud_middle_2),m_cloud_middle_2.y)),middle_2_repeat=new cc.RepeatForever(new cc.Sequence(middle_2_move,middle_2_place));m_cloud_middle_2.runAction(middle_2_repeat);var back_1_move=new cc.MoveTo(40,cc.p(ccWidth(m_cloud_back_1),m_cloud_back_1.y)),back_1_place=new cc.Place(cc.p(0,m_cloud_back_1.y)),back_1_repeat=new cc.RepeatForever(new cc.Sequence(back_1_move,back_1_place));m_cloud_back_1.runAction(back_1_repeat);var back_2_move=new cc.MoveTo(40,cc.p(0,m_cloud_back_2.y)),back_2_place=new cc.Place(cc.p(-ccWidth(m_cloud_back_2),m_cloud_back_2.y)),back_2_repeat=new cc.RepeatForever(new cc.Sequence(back_2_move,back_2_place));m_cloud_back_2.runAction(back_2_repeat),back_2_repeat=back_2_place=back_2_move=back_1_repeat=back_1_place=back_1_move=middle_2_repeat=middle_2_place=middle_2_move=middle_1_repeat=middle_1_place=middle_1_move=front_2_repeat=front_2_place=front_2_move=front_1_repeat=front_1_place=front_1_move=null},runMainSkyAnimation_SP:function(pLayer){if(USE_SP_CAMP_SCALE){var bg_main_sky=cc.Sprite.create(RES_CDN_DEFULT+"menu_camp/bg_main_sky.png");bg_main_sky.setAnchorPoint(ANCHOR_MIDDLE()),bg_main_sky.setPosition(ccCenter(this)),bg_main_sky.setScale(2),pLayer.addChild(bg_main_sky)}},runMainCataractAnimation:function(pBg){var cataract_01=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");cataract_01.setAnchorPoint(ZERO()),cataract_01.setPosition(69,180),pBg.addChild(cataract_01);var cataract_02=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");cataract_02.setAnchorPoint(ZERO()),cataract_02.setPosition(241,214),pBg.addChild(cataract_02);var cataract_03=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");cataract_03.setAnchorPoint(ZERO()),cataract_03.setPosition(417,2),pBg.addChild(cataract_03);var cataract_04=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");cataract_04.setAnchorPoint(ZERO()),cataract_04.setPosition(624,3),pBg.addChild(cataract_04);var cataract_05=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");cataract_05.setAnchorPoint(ZERO()),cataract_05.setPosition(733,0),pBg.addChild(cataract_05);var cataract_06=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");cataract_06.setAnchorPoint(ZERO()),cataract_06.setPosition(624,326),pBg.addChild(cataract_06);var cataract_01_animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.MainCatatact_01),repeat_01=new cc.RepeatForever(cataract_01_animate);cataract_01.runAction(repeat_01);var cataract_02_animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.MainCatatact_02),repeat_02=new cc.RepeatForever(cataract_02_animate);cataract_02.runAction(repeat_02);var cataract_03_animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.MainCatatact_03),repeat_03=new cc.RepeatForever(cataract_03_animate);cataract_03.runAction(repeat_03);var cataract_04_animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.MainCatatact_04),repeat_04=new cc.RepeatForever(cataract_04_animate);cataract_04.runAction(repeat_04);var cataract_05_animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.MainCatatact_05),repeat_05=new cc.RepeatForever(cataract_05_animate);cataract_05.runAction(repeat_05);var cataract_06_animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.MainCatatact_06),repeat_06=new cc.RepeatForever(cataract_06_animate);cataract_06.runAction(repeat_06),cataract_06_animate=cataract_05_animate=cataract_04_animate=cataract_03_animate=cataract_02_animate=cataract_01_animate=null},runMainCataractAnimation_SP:function(pBg){var cataract_01=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");cataract_01.setAnchorPoint(ZERO()),cataract_01.setPosition(69,180),pBg.addChild(cataract_01);var cataract_02=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");cataract_02.setAnchorPoint(ZERO()),cataract_02.setPosition(241,214),pBg.addChild(cataract_02);var cataract_03=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");cataract_03.setAnchorPoint(ZERO()),cataract_03.setPosition(417,2),pBg.addChild(cataract_03);var cataract_04=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");cataract_04.setAnchorPoint(ZERO()),cataract_04.setPosition(624,3),pBg.addChild(cataract_04);var cataract_05=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");cataract_05.setAnchorPoint(ZERO()),cataract_05.setPosition(733,0),pBg.addChild(cataract_05);var cataract_06=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");cataract_06.setAnchorPoint(ZERO()),cataract_06.setPosition(624,326),pBg.addChild(cataract_06)},runMainForestAnimation:function(pBg,pLayer){var forest_01=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");forest_01.setAnchorPoint(ZERO()),forest_01.setPosition(0,93),pBg.addChild(forest_01);var forest_02=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");forest_02.setAnchorPoint(ZERO()),forest_02.setPosition(57,0),pBg.addChild(forest_02);var forest_03=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");forest_03.setAnchorPoint(ZERO()),forest_03.setPosition(323,27),pBg.addChild(forest_03);var forest_04=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");forest_04.setAnchorPoint(ZERO()),forest_04.setPosition(443,10),pBg.addChild(forest_04);var forest_05=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");forest_05.setAnchorPoint(ZERO()),forest_05.setPosition(611,0),pBg.addChild(forest_05);var forest_06=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");forest_06.setAnchorPoint(ZERO()),forest_06.setPosition(703,0),pBg.addChild(forest_06);var forest_07=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");forest_07.setAnchorPoint(ZERO()),forest_07.setPosition(894,0),pBg.addChild(forest_07);var forest_08=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");forest_08.setAnchorPoint(ZERO()),forest_08.setPosition(405,157),pBg.addChild(forest_08);var forest_09=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");forest_09.setAnchorPoint(ZERO()),forest_09.setPosition(552,122),pBg.addChild(forest_09);var forest_10=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");forest_10.setAnchorPoint(ZERO()),forest_10.setPosition(629,156),pBg.addChild(forest_10);var forest_11=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");forest_11.setAnchorPoint(ZERO()),forest_11.setPosition(554,268),pBg.addChild(forest_11);var forest_12=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");forest_12.setAnchorPoint(ZERO()),forest_12.setPosition(439,269),pBg.addChild(forest_12);var forest_01_animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.MainForest_01),forest_repeat_01=new cc.RepeatForever(forest_01_animate);forest_01.runAction(forest_repeat_01);var forest_02_animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.MainForest_02),forest_repeat_02=new cc.RepeatForever(forest_02_animate);forest_02.runAction(forest_repeat_02);var forest_03_animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.MainForest_03),forest_repeat_03=new cc.RepeatForever(forest_03_animate);forest_03.runAction(forest_repeat_03);var forest_04_animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.MainForest_04),forest_repeat_04=new cc.RepeatForever(forest_04_animate);forest_04.runAction(forest_repeat_04);var forest_05_animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.MainForest_05),forest_repeat_05=new cc.RepeatForever(forest_05_animate);forest_05.runAction(forest_repeat_05);var forest_06_animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.MainForest_06),forest_repeat_06=new cc.RepeatForever(forest_06_animate);forest_06.runAction(forest_repeat_06);var forest_07_animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.MainForest_07),forest_repeat_07=new cc.RepeatForever(forest_07_animate);forest_07.runAction(forest_repeat_07);var forest_08_animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.MainForest_08),forest_repeat_08=new cc.RepeatForever(forest_08_animate);forest_08.runAction(forest_repeat_08);var forest_09_animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.MainForest_09),forest_repeat_09=new cc.RepeatForever(forest_09_animate);forest_09.runAction(forest_repeat_09);var forest_10_animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.MainForest_10),forest_repeat_10=new cc.RepeatForever(forest_10_animate);forest_10.runAction(forest_repeat_10);var forest_11_animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.MainForest_11),forest_repeat_11=new cc.RepeatForever(forest_11_animate);forest_11.runAction(forest_repeat_11);var forest_12_animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.MainForest_12),forest_repeat_12=new cc.RepeatForever(forest_12_animate);forest_12.runAction(forest_repeat_12);var tree_01=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");tree_01.setAnchorPoint(ZERO()),tree_01.setPosition(LP(this,-89,0)),pLayer.addChild(tree_01);var tree_02=cc.Sprite.create(RES_CDN_DEFULT+"common/img_point.png");tree_02.setAnchorPoint(ZERO()),tree_02.setPosition(LP(this,731,0)),pLayer.addChild(tree_02);var tree_01_animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.MainTree_01),tree_02_animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.MainTree_02),tree_repeat_01=new cc.RepeatForever(tree_01_animate);tree_01.runAction(tree_repeat_01);var tree_repeat_02=new cc.RepeatForever(tree_02_animate);tree_02.runAction(tree_repeat_02),tree_02_animate=tree_01_animate=forest_12_animate=forest_11_animate=forest_10_animate=forest_09_animate=forest_08_animate=forest_07_animate=forest_06_animate=forest_05_animate=forest_04_animate=forest_03_animate=forest_02_animate=forest_01_animate=null},runMainForestAnimation_SP:function(pBg,pLayer){},runMainCloudAnimation:function(pLayer){var m_cloud_01=cc.Sprite.create("#effect_main_cloud_01.png");m_cloud_01.setAnchorPoint(ZERO()),m_cloud_01.setPosition(ccWidth(this),240),pLayer.addChild(m_cloud_01);var m_cloud_01_pos=m_cloud_01.getPosition(),m_cloud_02=cc.Sprite.create("#effect_main_cloud_02.png");m_cloud_02.setAnchorPoint(ZERO()),m_cloud_02.setPosition(-ccWidth(m_cloud_02),320),pLayer.addChild(m_cloud_02);var m_cloud_02_pos=m_cloud_02.getPosition(),m_cloud_03=cc.Sprite.create("#effect_main_cloud_03.png");m_cloud_03.setAnchorPoint(ZERO()),m_cloud_03.setPosition(200-ccWidth(m_cloud_03),-ccHeight(m_cloud_03)/2+50),pLayer.addChild(m_cloud_03);var m_cloud_03_pos=cc.p(-ccWidth(m_cloud_03),m_cloud_03.y),m_cloud_04=cc.Sprite.create("#effect_main_cloud_04.png");m_cloud_04.setAnchorPoint(ZERO()),m_cloud_04.setPosition(ccWidth(this)-150,-ccHeight(m_cloud_04)/2+60),pLayer.addChild(m_cloud_04);var m_cloud_04_pos=cc.p(ccWidth(this),m_cloud_04.y),m_cloud_01_action=new cc.Spawn(new cc.MoveTo(25,cc.p(ccWidth(this)/2-ccWidth(m_cloud_01),m_cloud_01.y)),new cc.Sequence(new cc.DelayTime(20),new cc.FadeOut(5),new cc.Place(m_cloud_01_pos),new cc.FadeIn(0)));m_cloud_01.runAction(new cc.RepeatForever(m_cloud_01_action));var m_cloud_02_action=new cc.Spawn(new cc.MoveTo(20,cc.p(ccWidth(this)/2,m_cloud_02.y)),new cc.Sequence(new cc.DelayTime(5),new cc.FadeOut(15),new cc.Place(m_cloud_02_pos),new cc.FadeIn(0)));m_cloud_02.runAction(new cc.RepeatForever(m_cloud_02_action));var m_cloud_03_action=new cc.Sequence(new cc.MoveTo(34,cc.p(ccWidth(this),m_cloud_03.y)),new cc.Place(m_cloud_03_pos));m_cloud_03.runAction(new cc.RepeatForever(m_cloud_03_action));var m_cloud_04_action=new cc.Sequence(new cc.MoveTo(36,cc.p(-ccWidth(m_cloud_04),m_cloud_04.y)),new cc.Place(m_cloud_04_pos));m_cloud_04.runAction(new cc.RepeatForever(m_cloud_04_action)),m_cloud_04_action=m_cloud_03_action=m_cloud_02_action=m_cloud_01_action=null},runMainCloudAnimation_SP:function(pLayer){},onNotification:function(msg){if(this._super(msg))return!1;switch(msg){case NOTIFY_MENU_CAMP_COST:var cf=MasterManager.getInstance().get_CountFunction(2);if(this.m_costLevel>=cf.value){var scene=new CampCostScene;SceneManager.getInstance().replaceScene(scene),scene=null}else this.showShouldUpgradeCostMsgBox(cf.value);break;case NOTIFY_MENU_CAMP_BRANCH_ABILITY:NetService().Load_User_Troops_General();(req={}).opcode=net.OP.op_get_server_time_check,this.network_write(req);scene=new CampBranchAbilityScene;SceneManager.getInstance().replaceScene(scene),scene=null;break;case NOTIFY_MENU_CAMP_ARBEIT:if(0<this.m_arbeitLevel){scene=new CampArbeitScene_V2;SceneManager.getInstance().replaceScene(scene),scene=null}else USE_POPUP_INTERGRATION?this.showCampPopup(res_str("label_camp_arbeit_error_title"),res_str("label_camp_lack_arbeit_level_text_1"),res_str("label_camp_lack_arbeit_level_text_2")):this.showShouldUpgradeArbeitMsgBox();break;case NOTIFY_MENU_CAMP_FACTORY:var req;(req={}).opcode=net.OP.op_get_user_magic_key_mtrl,this.network_write(req),req={};break;case CAMP_UPGRADE_COST:this.m_selectedCamp=CAMP_COST,this.showConfirmUpgradeMsgBox(CAMP_COST);break;case CAMP_UPGRADE_LACK_LEVEL:USE_POPUP_INTERGRATION?this.showGameScenePopup(res_str("label_preparation_title"),res_str("label_not_enough_level_1"),res_str("label_not_enough_level_2")):this.showNotEnoughLevel();break;case CAMP_UPGRADE_BRANCH_ABILITY:this.m_selectedCamp=CAMP_BRANCH_ABILITY,this.showConfirmUpgradeMsgBox(CAMP_BRANCH_ABILITY);break;case CAMP_UPGRADE_ARBEIT:this.m_selectedCamp=CAMP_ARBEIT,this.showConfirmUpgradeMsgBox(CAMP_ARBEIT);break;case CAMP_UPGRADE_FACTORY:this.m_selectedCamp=CAMP_FACTORY,this.showConfirmUpgradeMsgBox(CAMP_FACTORY);break;case CAMP_UPGRADE_LACK_JADE:this.showNotEnoughJade();break;case CAMP_UPGRADE_LACK_GOLD:this.showNotEnoughGold();break;case CAMP_UPGRADE_MAX_LEVEL:USE_POPUP_INTERGRATION?this.showCampPopup(res_str("label_camp_upgrade_title"),res_str("label_camp_upgrade_error_not_exist_upgrade_level")):this.showNotExistUpgradeLevelMsgBox();break;default:return!1}return!0},onNetworkEvent:function(opcode,state,body){this._super(opcode,state,body);try{if(this.m_campLayer.update_user_info(),opcode==net.OP.op_upgrade_user_camp)body.error==net.ERROR.NET_E_LACK_GOLD?this.showLackItemMsgBox(BONUS_TYPE_GOLD):body.error==net.ERROR.NET_E_LACK_JADE?this.showLackItemMsgBox(BONUS_TYPE_JADE):body.error==net.ERROR.NET_E_LACK_USER_LEVEL?USE_POPUP_INTERGRATION?this.showCampPopup(res_str("label_camp_upgrade_error_title"),res_str("label_camp_upgrade_error_lack_user_level")):this.showLackUserLevelMsgBox():body.error==net.ERROR.NET_E_CAMP_NOT_EXIST_UPGRADE_ID?USE_POPUP_INTERGRATION?this.showCampPopup(res_str("label_camp_upgrade_title"),res_str("label_camp_upgrade_error_not_exist_upgrade_level")):this.showNotExistUpgradeLevelMsgBox():body.error==net.ERROR.NET_E_CAMP_ALREADY_REACHED_LEVEL?this.showAlreadyReachedCampLevelMsgBox():(this.showUpgradeCompleteMsgBox(body.camp_type,body.camp_level,body.added_cost),body.camp_type==CAMP_ARBEIT?this.m_arbeitLevel=body.camp_level:body.camp_type==CAMP_COST?this.m_costLevel=body.camp_level:body.camp_type==CAMP_FACTORY&&(this.m_factoryLevel=body.camp_level));else if(opcode==net.OP.op_get_user_camp)this.updateCampData(),this.scheduleOnce(function(float){var req={};req.opcode=net.OP.op_get_user_item,this.network_write(req)},0,"op_get_user_camp");else if(opcode==net.OP.op_get_user_magic_key_mtrl){var scene=new CampFactoryScene;SceneManager.getInstance().replaceScene(scene),scene=null}}catch(e){}},onEnter:function(){this._super(),this.m_gameObserver=MainObserver.getInstance(),this.m_gameObserver.addObserver(this.onNotification,this,sceneStr[scene_CampScene])},onExit:function(){if(this._super(),MainObserver.getInstance().removeObserver(sceneStr[scene_CampScene]),1!=PREV_HELP){if((this.m_campLayer=null)!=this.m_gnrl_img){for(var i=0;i<this.m_gnrl_img.length;i++)cc.loader.release(this.m_gnrl_img[i]);this.m_gnrl_img=null}delete this.m_gnrl_img}},showCurrentCampAbilityMsgBox:function(campType){if(this.m_box.setTitle("コスト管理"),campType==CAMP_COST){var curr_cost=this.m_campLayer.getCurrentCost();this.m_box.setText("現在コストは"+curr_cost+"です。"),this.m_box.setText("\n")}this.m_box.addButtonInfo(new MessageButtonInfo("確認",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},showConfirmUpgradeMsgBox:function(campType){this.m_box.is_show()&&this.m_box.hide(!1),this.m_ctbox.is_show()&&this.m_ctbox.hide(!1);var amount=this.m_campLayer.getUpgradeAmount(),bonus_type=this.m_campLayer.getUpgradeMaterial(),upgrade_cost=0;if(this.m_ctbox.setTitle("増築"),bonus_type==BONUS_TYPE_JADE?(upgrade_cost+=DIFFERENCE_LEVEL_JADE,this.m_ctbox.setText("翡翠"+amount,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText(" を使用して",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n")):bonus_type==BONUS_TYPE_GOLD&&(upgrade_cost+=DIFFERENCE_LEVEL_GOLD,this.m_ctbox.setText("金貨"+amount,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText(" を使用して",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n")),this.m_ctbox.setText("増築しますか。",LABEL_FONT_INDEX.FONT_261),campType==CAMP_COST){var curr_level=this.m_campLayer.getCurrentLevel(),curr_cost=this.m_campLayer.getCurrentCost();upgrade_cost+=curr_cost,this.m_ctbox.setText("\n"),this.m_ctbox.setText("コスト管理Lv "+curr_level+" → ",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText(curr_level+1,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("\n"),this.m_ctbox.setText("建物コスト "+curr_cost+" → ",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText(upgrade_cost,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("\n")}this.m_ctbox.addButtonInfo(new MessageButtonInfo("いいえ",MessageBoxButtonType.ButtonTypeRed,0,function(){this.m_ctbox.hide()}.bind(this))),this.m_ctbox.addButtonInfo(new MessageButtonInfo("はい",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.sendPacketCampUpgrade()},0,"btnYes"),this.m_ctbox.hide()}.bind(this))),this.m_ctbox.show()},sendPacketCampUpgrade:function(){var req={};req.opcode=net.OP.op_upgrade_user_camp,req.camp_type=this.m_selectedCamp,req.camp_level=this.m_campLayer.getCurrentLevel(),this.network_write(req),req={}},showUpgradeCompleteMsgBox:function(campType,campLevel,addedCost){if(this.m_ctbox.hide(),this.m_ctbox.setTitle("増築完了"),campType==CAMP_BRANCH_ABILITY)this.m_ctbox.setText("兵科能力",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("Lvが ",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText(campLevel,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("に、",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),GameContext.getInstance().setCampBranchLevel(campLevel);else if(campType==CAMP_COST){var curr_cost=this.m_campLayer.getCurrentCost();this.m_ctbox.setText("コスト管理",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("Lvが ",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText(campLevel,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("に、",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("コスト",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("が ",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText(curr_cost+addedCost,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("に",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),GameContext.getInstance().setCampCostLevel(campLevel)}else campType==CAMP_ARBEIT&&(this.m_ctbox.setText("アルバイト",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("Lvが ",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText(campLevel,LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("に",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),GameContext.getInstance().setCampArbeitLevel(campLevel));this.m_ctbox.setText("増築されました。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.addButtonInfo(new MessageButtonInfo("確認",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.updateCampData()},0,"btnOk"),this.m_ctbox.hide(!1)}.bind(this))),this.m_ctbox.show()},updateCampData:function(){this.m_campLayer.upgradeComplete(this.m_selectedCamp),this.m_selectedCamp=0},showLackItemMsgBox:function(bonusType){this.m_box.hide(),this.m_box.setTitle("増築エラー"),bonusType==BONUS_TYPE_JADE?this.m_box.setText("翡翠が足りません。"):bonusType==BONUS_TYPE_GOLD&&this.m_box.setText("金貨が足りません。"),this.m_box.addButtonInfo(new MessageButtonInfo("確認",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.m_selectedCamp=0,this.m_box.hide(!1)},0,"btnOk")}.bind(this))),this.m_box.show()},showAlreadyReachedCampLevelMsgBox:function(){this.m_box.hide(),this.m_box.setTitle(res_str("label_camp_upgrade_complete_title")),this.m_box.setText(res_str("label_camp_upgrade_already_complete_text_2")),this.m_box.addButtonInfo(new MessageButtonInfo("確認",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){var req={};req.opcode=net.OP.op_get_user_camp,this.network_write(req),this.m_box.hide(!1)},0,"btnOk")}.bind(this))),this.m_box.show()},showShouldUpgradeCostMsgBox:function(cost_level_bound){this.m_box.is_show()&&this.m_box.hide(!1),this.m_ctbox.is_show()&&this.m_ctbox.hide(!1),this.m_ctbox.setTitle("コスト変更エラー"),this.m_ctbox.setText("コスト管理のレベル ",LABEL_FONT_INDEX.FONT_241),this.m_ctbox.setText(cost_level_bound+"",LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText(" 達成時、",LABEL_FONT_INDEX.FONT_241),this.m_ctbox.setText("\n"),this.m_ctbox.setText("翡翠を使用して追加でCOSTを上げることができます。",LABEL_FONT_INDEX.FONT_241),this.m_ctbox.addButtonInfo(new MessageButtonInfo("確認",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.m_selectedCamp=0,this.m_ctbox.hide(!1)},0,"btnOk")}.bind(this))),this.m_ctbox.show()},showCampPopup:function(){this.m_box.is_show()&&this.m_box.hide();for(var val=arguments,msg=[],i=1;i<val.length;i++)msg.push(val[i]);this.showMsgBox(val[0],msg),msg=null},showLackUserLevelMsgBox:function(){this.m_box.hide(),this.m_box.setTitle(res_str("label_camp_upgrade_error_title")),this.m_box.setText(res_str("label_camp_upgrade_error_lack_user_level")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.m_selectedCamp=0,this.m_box.hide(!1)},0,"btnOk")}.bind(this))),this.m_box.show()},showNotExistUpgradeLevelMsgBox:function(){this.m_box.hide(),this.m_box.setTitle(res_str("label_camp_upgrade_title")),this.m_box.setText(res_str("label_camp_upgrade_error_not_exist_upgrade_level")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.m_selectedCamp=0,this.m_box.hide(!1)},0,"btnOk")}.bind(this))),this.m_box.show()},showShouldUpgradeArbeitMsgBox:function(){this.m_box.hide(),this.m_box.setTitle(res_str("label_camp_arbeit_error_title")),this.m_box.setText(res_str("label_camp_lack_arbeit_level_text_1")),this.m_box.setText("\n"),this.m_box.setText(res_str("label_camp_lack_arbeit_level_text_2")),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.m_selectedCamp=0,this.m_box.hide(!1)},0,"btnOk")}.bind(this))),this.m_box.show()}}),CAMP_UPGRADE_BRANCH_ABILITY=601,CAMP_UPGRADE_COST=602,CAMP_UPGRADE_ARBEIT=603,CAMP_UPGRADE_FACTORY=604,CAMP_UPGRADE_LACK_LEVEL=605,CAMP_UPGRADE_LACK_JADE=606,CAMP_UPGRADE_LACK_GOLD=607,CAMP_UPGRADE_MAX_LEVEL=608,CampLayer=cc.Layer.extend({m_neededAmount:0,m_neededBonusType:0,m_campLevel:0,m_isShowBranchHelpLabel:!1,m_isShowCostHelpLabel:!1,m_isShowArbeitHelpLabel:!1,m_branchHelpLabel:null,m_costHelpLabel:null,m_arbeitHelpLabel:null,m_costLayer:null,m_factoryLayer:null,m_branchLayer:null,m_arbeitLayer:null,m_campLayer:null,m_userCampList:[],m_user_info:null,m_user_item:null,m_campBranchAbility:null,m_campCost:null,m_campArbeit:null,m_campFactory:null,ctor:function(){this.m_userCampList=[],this._super()},initLayout:function(){this.m_campLayer=new cc.Layer,this.addChild(this.m_campLayer);var win_Size=cc.director.getWinSize();this.m_campLayer.setContentSize(win_Size),this.m_user_info={},this.m_user_item={},this.m_user_info=NetService().get_User_info(),this.m_user_item=NetService().get_UserItemInfo_V2(),this.m_costLayer=this.getCostLayer(),this.m_costLayer.setAnchorPoint(ZERO()),this.m_costLayer.setPosition(354,85),this.m_campLayer.addChild(this.m_costLayer),this.m_branchLayer=this.getBranchAbilityLayer(),this.m_branchLayer.setAnchorPoint(ZERO()),this.m_branchLayer.setPosition(628,168),this.m_campLayer.addChild(this.m_branchLayer),this.m_factoryLayer=this.getFactoryLayer(),this.m_factoryLayer.setAnchorPoint(ZERO()),this.m_factoryLayer.setPosition(680,398),this.m_campLayer.addChild(this.m_factoryLayer)},update_user_info:function(){this.m_user_info=NetService().get_User_info(),this.m_user_item=NetService().get_UserItemInfo_V2()},onEnter:function(){this._super()},onExit:function(){this._super(),this.m_branchHelpLabel=null,this.m_costHelpLabel=null,(this.m_arbeitHelpLabel=null)!=this.m_costLayer&&this.m_costLayer.removeAllChildrenWithCleanup(!0),(this.m_costLayer=null)!=this.m_factoryLayer&&this.m_factoryLayer.removeAllChildrenWithCleanup(!0),(this.m_factoryLayer=null)!=this.m_branchLayer&&this.m_branchLayer.removeAllChildrenWithCleanup(!0),(this.m_branchLayer=null)!=this.m_arbeitLayer&&this.m_arbeitLayer.removeAllChildrenWithCleanup(!0),(this.m_arbeitLayer=null)!=this.m_campLayer&&(this.m_campLayer.removeAllChildrenWithCleanup(!0),this.m_campLayer=null),this.m_userCampList=[],this.m_user_info={},this.m_user_item={},this.m_gameObserver=null,this.m_campBranchAbility=null,this.m_campCost=null,this.m_campArbeit=null,this.m_campFactory=null,delete this.m_userCampList,delete this.m_user_info,delete this.m_user_item,delete this.m_costLayer,delete this.m_factoryLayer,delete this.m_branchLayer,delete this.m_arbeitLayer,delete this.m_campLayer,delete this.m_branchHelpLabel,delete this.m_costHelpLabel,delete this.m_arbeitHelpLabel},getCostLayer:function(){var layer=new cc.Layer;layer.setContentSize(LP(this,235,298));var cost_btn,campId=CampService.getInstance().getUserCampId(this.m_campCost.camp_type,this.m_campCost.camp_level),camp=MasterManager.getInstance().get_Camp(campId);USE_SP_CAMP_SCALE?((cost_btn=new ccui.Button(RES_CDN_DEFULT+"menu_camp/btn_facility_2_"+camp.camp_image+"_off.png",RES_CDN_DEFULT+"menu_camp/btn_facility_2_"+camp.camp_image+"_on.png")).setAnchorPoint(ZERO()),cost_btn.setPosition(90,79),cost_btn.setScale(2),cost_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_CampScene],NOTIFY_MENU_CAMP_COST)}.bind(this)),layer.addChild(cost_btn)):((cost_btn=new ccui.Button(RES_CDN_DEFULT+"menu_camp/btn_facility_2_"+camp.camp_image+"_off.png",RES_CDN_DEFULT+"menu_camp/btn_facility_2_"+camp.camp_image+"_on.png")).setAnchorPoint(ZERO()),cost_btn.setPosition(90,79),cost_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_CampScene],NOTIFY_MENU_CAMP_COST)}.bind(this)),layer.addChild(cost_btn));var camp_name_label=cmLabel.getLabel("コスト管理",LABEL_FONT_INDEX.FONT_2615);camp_name_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),camp_name_label.setPosition(LP(this,209,60)),camp_name_label.enableOutline(cc.color.BLACK,2),layer.addChild(camp_name_label);var level_label=cmLabel.getLabel("Lv "+this.m_campCost.camp_level,LABEL_FONT_INDEX.FONT_261);(level_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),level_label.setPosition(camp_name_label.x-ccWidth(camp_name_label)-10,camp_name_label.y),level_label.enableOutline(cc.color.BLACK,2),layer.addChild(level_label),this.m_campCost.is_max_upgrade)?this.getUpgradeCompleteButton(layer):this.getUpgradeButton(layer,camp.user_level_bound,camp.needed_asset,camp.needed_amount).addClickEventListener(function(sender){var campId=CampService.getInstance().getUserCampId(this.m_campCost.camp_type,this.m_campCost.camp_level),camp=MasterManager.getInstance().get_Camp(campId);this.checkUpgradePossible(camp)&&(this.setUpgradeAmount(camp.needed_amount),this.setUpgradeMaterial(camp.needed_asset),this.setCurrentLevel(camp.camp_level),this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_CampScene],CAMP_UPGRADE_COST)}.bind(this),0,"CAMP_UPGRADE_COST"))}.bind(this));var help_btn=this.getHelpButton(layer,199,97);help_btn.addClickEventListener(function(sender){null!=this.m_costHelpLabel&&(this.m_isShowCostHelpLabel?(this.m_costHelpLabel.setVisible(!1),this.m_isShowCostHelpLabel=!1):(this.m_costHelpLabel.setVisible(!0),this.m_isShowCostHelpLabel=!0))}.bind(this));var help_text={0:"軍のコストを増加させることができます。"};return this.m_costHelpLabel=this.getHelpTextLabel(layer,help_btn,cc.size(345,50),help_text,1),help_text={},layer},getBranchAbilityLayer:function(){var layer=new cc.Layer;layer.setContentSize(LP(this,241,259));var branch_btn,campId=CampService.getInstance().getUserCampId(this.m_campBranchAbility.camp_type,this.m_campBranchAbility.camp_level),camp=MasterManager.getInstance().get_Camp(campId);USE_SP_CAMP_SCALE?((branch_btn=new ccui.Button(RES_CDN_DEFULT+"menu_camp/btn_facility_4_"+camp.camp_image+"_off.png",RES_CDN_DEFULT+"menu_camp/btn_facility_4_"+camp.camp_image+"_on.png")).setAnchorPoint(ZERO()),branch_btn.setPosition(126,69),branch_btn.setScale(2),branch_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_CampScene],NOTIFY_MENU_CAMP_BRANCH_ABILITY)}.bind(this)),layer.addChild(branch_btn)):((branch_btn=new ccui.Button(RES_CDN_DEFULT+"menu_camp/btn_facility_4_"+camp.camp_image+"_off.png",RES_CDN_DEFULT+"menu_camp/btn_facility_4_"+camp.camp_image+"_on.png")).setAnchorPoint(ZERO()),branch_btn.setPosition(126,69),branch_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_CampScene],NOTIFY_MENU_CAMP_BRANCH_ABILITY)}.bind(this)),layer.addChild(branch_btn));(this.getLevelLabel(layer,this.m_campBranchAbility.camp_level,this.m_campBranchAbility.max_camp_level,"兵科能力",!0),this.m_campBranchAbility.is_max_upgrade)?this.getUpgradeCompleteButton(layer):this.getUpgradeButton(layer,camp.user_level_bound,camp.needed_asset,camp.needed_amount).addClickEventListener(function(sender){var campId=CampService.getInstance().getUserCampId(this.m_campBranchAbility.camp_type,this.m_campBranchAbility.camp_level),camp=MasterManager.getInstance().get_Camp(campId);this.checkUpgradePossible(camp)&&(this.setUpgradeAmount(camp.needed_amount),this.setUpgradeMaterial(camp.needed_asset),this.setCurrentLevel(camp.camp_level),this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_CampScene],CAMP_UPGRADE_BRANCH_ABILITY)}.bind(this),0,"CAMP_UPGRADE_BRANCH_ABILITY"))}.bind(this));var help_btn=this.getHelpButton(layer,205,95);help_btn.addClickEventListener(function(sender){null!=this.m_branchHelpLabel&&(this.m_isShowBranchHelpLabel?(this.m_branchHelpLabel.setVisible(!1),this.m_isShowBranchHelpLabel=!1):(this.m_branchHelpLabel.setVisible(!0),this.m_isShowBranchHelpLabel=!0))}.bind(this));var help_text={0:"兵科ごとに攻撃力・防御力・体力の",1:"ステータスを上げられます。"};return this.m_branchHelpLabel=this.getHelpTextLabel(layer,help_btn,cc.size(310,70),help_text,2),help_text={},layer},getFactoryLayer:function(){var layer=new cc.Layer;layer.setContentSize(LP(this,239,173));var factory_btn,campId=CampService.getInstance().getUserCampId(this.m_campFactory.camp_type,this.m_campFactory.camp_level),camp=MasterManager.getInstance().get_Camp(campId);USE_SP_CAMP_SCALE?((factory_btn=new ccui.Button(RES_CDN_DEFULT+"menu_camp/btn_facility_1_"+camp.camp_image+"_off.png",RES_CDN_DEFULT+"menu_camp/btn_facility_1_"+camp.camp_image+"_on.png")).setAnchorPoint(ZERO()),factory_btn.setPosition(109,65),factory_btn.setScale(2),factory_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_CampScene],NOTIFY_MENU_CAMP_FACTORY)}.bind(this)),layer.addChild(factory_btn)):((factory_btn=new ccui.Button(RES_CDN_DEFULT+"menu_camp/btn_facility_1_"+camp.camp_image+"_off.png",RES_CDN_DEFULT+"menu_camp/btn_facility_1_"+camp.camp_image+"_on.png")).setAnchorPoint(ZERO()),factory_btn.setPosition(109,65),factory_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_CampScene],NOTIFY_MENU_CAMP_FACTORY)}.bind(this)),layer.addChild(factory_btn));(this.getLevelLabel(layer,this.m_campFactory.camp_level,this.m_campFactory.max_camp_level,"合成所",!1),this.m_campFactory.is_max_upgrade)?this.getUpgradeCompleteButton(layer):this.getUpgradeButton(layer,camp.user_level_bound,camp.needed_asset,camp.needed_amount).addClickEventListener(function(sender){var campId=CampService.getInstance().getUserCampId(this.m_campFactory.camp_type,this.m_campFactory.camp_level),camp=MasterManager.getInstance().get_Camp(campId);this.checkUpgradePossible(camp)&&(this.setUpgradeAmount(camp.needed_amount),this.setUpgradeMaterial(camp.needed_asset),this.setCurrentLevel(camp.camp_level)),this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_CampScene],CAMP_UPGRADE_FACTORY)}.bind(this),0,"CAMP_UPGRADE_FACTORY")}.bind(this));var help_btn=this.getHelpButton(layer,203,89);help_btn.addClickEventListener(function(sender){null!=this.m_arbeitHelpLabel&&(this.m_isShowArbeitHelpLabel?(this.m_arbeitHelpLabel.setVisible(!1),this.m_isShowArbeitHelpLabel=!1):(this.m_arbeitHelpLabel.setVisible(!0),this.m_isShowArbeitHelpLabel=!0))}.bind(this));var help_text={0:"様々なアイテムを合成できます。"};return this.m_arbeitHelpLabel=this.getHelpTextLabel(layer,help_btn,cc.size(330,50),help_text,1),help_text={},layer},getLevelLabel:function(pLayer,level,max_level,label_name,fLeftAlign){var camp_name_label=cmLabel.getLabel(label_name,LABEL_FONT_INDEX.FONT_2615);camp_name_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),camp_name_label.setPosition(LP(this,209,60)),camp_name_label.enableOutline(cc.color.BLACK,2),pLayer.addChild(camp_name_label);var level_label=cmLabel.getLabel("Lv "+level,LABEL_FONT_INDEX.FONT_261);level_label.enableOutline(cc.color.BLACK,2),pLayer.addChild(level_label);var max_level_label=cmLabel.getLabel("/"+max_level,LABEL_FONT_INDEX.FONT_201);max_level_label.enableOutline(cc.color.BLACK,2),pLayer.addChild(max_level_label),1==fLeftAlign?(level_label.setAnchorPoint(ZERO()),level_label.setPosition(LP(this,13,60)),max_level_label.setAnchorPoint(ZERO()),max_level_label.setPosition(level_label.x+ccWidth(level_label),level_label.y+3)):(max_level_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),max_level_label.setPosition(camp_name_label.x-ccWidth(camp_name_label)-10,camp_name_label.y+3),level_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),level_label.setPosition(camp_name_label.x-ccWidth(camp_name_label)-ccWidth(max_level_label)-10,camp_name_label.y))},getUpgradeCompleteButton:function(pLayer){var no_upgrade_btn=new LabelButton("btn_07_none.png","btn_07_none.png","",ccui.Widget.PLIST_TEXTURE);no_upgrade_btn.setFont(LABEL_FONT_INDEX.FONT_241),no_upgrade_btn.setString("増築完了"),no_upgrade_btn.setAnchorPoint(ZERO()),no_upgrade_btn.setPosition(LP(this,0,0)),pLayer.addChild(no_upgrade_btn),no_upgrade_btn.addClickEventListener(function(sender){this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_CampScene],CAMP_UPGRADE_MAX_LEVEL)},0,"CAMP_UPGRADE_MAX_LEVEL")})},getUpgradeButton:function(pLayer,campLabel,bonusType,neededAmount){var upgrade_label,upgrade_btn=new ccui.Button("btn_07_off.png","btn_07_on.png","",ccui.Widget.PLIST_TEXTURE);(upgrade_btn.setAnchorPoint(ZERO()),upgrade_btn.setPosition(LP(this,0,0)),pLayer.addChild(upgrade_btn),this.m_user_info.user_level>=campLabel)?((upgrade_label=cmLabel.getLabel("増築",LABEL_FONT_INDEX.FONT_241)).setAnchorPoint(ANCHOR_MIDDLE()),upgrade_label.setPosition(38,ccCenter(upgrade_btn).y),upgrade_btn.addChild(upgrade_label)):((upgrade_label=cmLabel.getLabel("Lv "+campLabel,LABEL_FONT_INDEX.FONT_2017)).setAnchorPoint(ANCHOR_MIDDLE()),upgrade_label.setPosition(38,ccCenter(upgrade_btn).y),upgrade_btn.addChild(upgrade_label));return this.getAssetData(upgrade_btn,bonusType,neededAmount),upgrade_btn},getAssetData:function(pLayer,bonusType,neededAmount){var asset_label,user_item_count=0,asset_bg=null;(bonusType==BONUS_TYPE_JADE?(user_item_count=this.m_user_item.jade_cnt,asset_bg=cc.Sprite.create(RES_CDN_DEFULT+"common/img_box_jade.png")):bonusType==BONUS_TYPE_GOLD&&(user_item_count=this.m_user_item.gold_cnt,asset_bg=cc.Sprite.create(RES_CDN_DEFULT+"common/img_box_gold.png")),asset_bg.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),asset_bg.setPosition(81,ccCenter(pLayer).y),pLayer.addChild(asset_bg),neededAmount<=user_item_count)?((asset_label=cmLabel.getLabel(Number(neededAmount).toLocaleString("en"),LABEL_FONT_INDEX.FONT_2011)).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),asset_label.setPosition(124,ccCenter(asset_bg).y),asset_bg.addChild(asset_label)):((asset_label=cmLabel.getLabel(Number(neededAmount).toLocaleString("en"),LABEL_FONT_INDEX.FONT_2017)).setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),asset_label.setPosition(124,ccCenter(asset_bg).y),asset_bg.addChild(asset_label))},getHelpButton:function(pLayer,posX,posY){var help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE);return help_btn.setAnchorPoint(ZERO()),help_btn.setPosition(LP(this,posX,posY)),pLayer.addChild(help_btn),help_btn},getHelpTextLabel:function(pLayer,pBtn,textSize,text_label,lineNum){var help_text_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());if(help_text_bg.setContentSize(textSize),help_text_bg.setInsetBottom(13),help_text_bg.setInsetLeft(13),help_text_bg.setInsetRight(13),help_text_bg.setInsetTop(13),help_text_bg.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),help_text_bg.setPosition(pBtn.getPosition().x,pBtn.getPosition().y+ccHeight(pBtn)),pLayer.addChild(help_text_bg),1==lineNum)(help_text=cmLabel.getLabel(text_label[0],LABEL_FONT_INDEX.FONT_181)).setContentSize(ccWidth(textSize)-30,ccHeight(textSize)-30),help_text.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),help_text.setPosition(13,ccCenter(help_text_bg).y),help_text_bg.addChild(help_text);else if(2==lineNum){var help_text;(help_text=cmLabel.getLabel(text_label[0],LABEL_FONT_INDEX.FONT_181)).setContentSize(ccWidth(textSize)-30,ccHeight(textSize)-30),help_text.setAnchorPoint(ANCHOR_TOP_LEFT()),help_text.setPosition(13,help_text_bg.getPosition().y-ccHeight(textSize)-8),help_text_bg.addChild(help_text);var help_text2=cmLabel.getLabel(text_label[1],LABEL_FONT_INDEX.FONT_181);help_text2.setContentSize(ccWidth(textSize)-30,ccHeight(textSize)-30),help_text2.setAnchorPoint(ANCHOR_TOP_LEFT()),help_text2.setPosition(13,help_text.getPosition().y-ccHeight(help_text)),help_text_bg.addChild(help_text2)}return help_text_bg.setVisible(!1),help_text_bg},checkUpgradePossible:function(campInfo){if(this.m_user_info.user_level<campInfo.user_level_bound)return this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_CampScene],CAMP_UPGRADE_LACK_LEVEL)}.bind(this),0,"CAMP_UPGRADE_LACK_LEVEL"),!1;if(campInfo.needed_asset==BONUS_TYPE_JADE){if(this.m_user_item.jade_cnt<campInfo.needed_amount)return this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_CampScene],CAMP_UPGRADE_LACK_JADE)}.bind(this),0,"CAMP_UPGRADE_LACK_JADE"),!1}else if(campInfo.needed_asset==BONUS_TYPE_GOLD&&this.m_user_item.gold_cnt<campInfo.needed_amount)return this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_CampScene],CAMP_UPGRADE_LACK_GOLD)}.bind(this),0,"CAMP_UPGRADE_LACK_GOLD"),!1;return!0},setCampData:function(userCampList,campType){if(void 0!==campType)switch(campType){case CAMP_BRANCH_ABILITY:this.m_campBranchAbility=userCampList;break;case CAMP_COST:this.m_campCost=userCampList;break;case CAMP_ARBEIT:this.m_campArbeit=userCampList;break;case CAMP_FACTORY:this.m_campFactory=userCampList}else this.m_userCampList=userCampList},setUpgradeAmount:function(amount){this.m_neededAmount=amount},getUpgradeAmount:function(){return this.m_neededAmount},setUpgradeMaterial:function(bonus_type){this.m_neededBonusType=bonus_type},getUpgradeMaterial:function(){return this.m_neededBonusType},setCurrentLevel:function(level){this.m_campLevel=level},getCurrentLevel:function(){return this.m_campLevel},getCurrentCost:function(){var campId=CampService.getInstance().getUserCampId(this.m_campCost.camp_type,this.m_campCost.camp_level);return MasterManager.getInstance().get_Camp(campId).ability},upgradeComplete:function(campType){var campService=CampService.getInstance();switch(campType){case CAMP_BRANCH_ABILITY:this.m_branchLayer.removeFromParent(),campService.getUserCamp(this.m_campBranchAbility,CAMP_BRANCH_ABILITY),this.m_branchLayer=this.getBranchAbilityLayer(),this.m_branchLayer.setAnchorPoint(ZERO()),this.m_branchLayer.setPosition(628,168),this.m_campLayer.addChild(this.m_branchLayer);break;case CAMP_COST:this.m_costLayer.removeFromParent(),campService.getUserCamp(this.m_campCost,CAMP_COST),this.m_costLayer=this.getCostLayer(),this.m_costLayer.setAnchorPoint(ZERO()),this.m_costLayer.setPosition(354,85),this.m_campLayer.addChild(this.m_costLayer);break;case CAMP_ARBEIT:break;case CAMP_FACTORY:this.m_factoryLayer.removeFromParent(),campService.getUserCamp(this.m_campFactory,CAMP_FACTORY),this.m_factoryLayer=this.getFactoryLayer(),this.m_factoryLayer.setAnchorPoint(ZERO()),this.m_factoryLayer.setPosition(680,398),this.m_campLayer.addChild(this.m_factoryLayer)}}}),MAIN_ANI_TYPE={MainCatatact_01:1,MainCatatact_02:2,MainCatatact_03:3,MainCatatact_04:4,MainCatatact_05:5,MainCatatact_06:6,MainForest_01:7,MainForest_02:8,MainForest_03:9,MainForest_04:10,MainForest_05:11,MainForest_06:12,MainForest_07:13,MainForest_08:14,MainForest_09:15,MainForest_10:16,MainForest_11:17,MainForest_12:18,MainTree_01:19,MainTree_02:20,MainTreeNight_01:21,MainTreeNight_02:22,GachaAniRareType_01:23,GachaAniRareType_02:24,GachaAniRareType_03:25,GachaAniRareType_04:26,GachaAniRareType_05:27,GachaAniRareType_06:28,GachaAniRareTypeIn_01:29,GachaAniRareTypeIn_02:30,GachaAniRareTypeIn_03:31,GachaAniRareTypeIn_04:32,GachaAniRareTypeIn_05:33,GachaAniRareTypeIn_06:34,AchievementComplete:35,GachaNewGeneral:36,GachaSSRFrame:37,CardRareTypeSR_1:38,CardRareTypeSR_2:39,CardRareTypeSR_3:40,CardRareTypeSSR_1:41,CardRareTypeSSR_2:42,CardRareTypeSSR_3:43,LevelUpEffect:44,EvolutionEffect:45,EvolutionClassType_N:46,EvolutionClassType_HR:47,EvolutionClassType_SR:48,EvolutionClassType_SSR:49,RebirthClassType_SSR:50,LimitOverEffect:51,LimitOverStep_1:52,LimitOverStep_2:53,LimitOverStep_3:54,LimitOverStep_4:55,LimitOverStep_5:56,StoryNewIcon:57,EventDungeonBoxGachaMainItem:58,EventDungeonBoxGachaCurrentBox:59,EventDungeonBoxGachaCompleteBox:60,EventDungeonExtraBoxGachaCurrentBox:61,EventDungeonBoxGachaOpenEffect:62,StoryEntrance:63,RaidGacahNewEquipment:64,RebirthEffect:65,CardRareTypeSR_4:66,CardRareTypeSSR_4:67,MainFireEffect:68,LeftXMasTree:69,RightXMasTree:70,CeilingGachaGeneral:71,CardSpecialEff:1e3},MainAnimation=function(){var instance,m_aniList=[];function MainAni(){NOT_USE_SP_CAMP_EFFECT||(this.loadAnimate(MAIN_ANI_TYPE.MainCatatact_01,this.getMainCatatact_01),this.loadAnimate(MAIN_ANI_TYPE.MainCatatact_02,this.getMainCatatact_02),this.loadAnimate(MAIN_ANI_TYPE.MainCatatact_03,this.getMainCatatact_03),this.loadAnimate(MAIN_ANI_TYPE.MainCatatact_04,this.getMainCatatact_04),this.loadAnimate(MAIN_ANI_TYPE.MainCatatact_05,this.getMainCatatact_05),this.loadAnimate(MAIN_ANI_TYPE.MainCatatact_06,this.getMainCatatact_06),this.loadAnimate(MAIN_ANI_TYPE.MainForest_01,this.getMainForest_01),this.loadAnimate(MAIN_ANI_TYPE.MainForest_02,this.getMainForest_02),this.loadAnimate(MAIN_ANI_TYPE.MainForest_03,this.getMainForest_03),this.loadAnimate(MAIN_ANI_TYPE.MainForest_04,this.getMainForest_04),this.loadAnimate(MAIN_ANI_TYPE.MainForest_05,this.getMainForest_05),this.loadAnimate(MAIN_ANI_TYPE.MainForest_06,this.getMainForest_06),this.loadAnimate(MAIN_ANI_TYPE.MainForest_07,this.getMainForest_07),this.loadAnimate(MAIN_ANI_TYPE.MainForest_08,this.getMainForest_08),this.loadAnimate(MAIN_ANI_TYPE.MainForest_09,this.getMainForest_09),this.loadAnimate(MAIN_ANI_TYPE.MainForest_10,this.getMainForest_10),this.loadAnimate(MAIN_ANI_TYPE.MainForest_11,this.getMainForest_11),this.loadAnimate(MAIN_ANI_TYPE.MainForest_12,this.getMainForest_12),this.loadAnimate(MAIN_ANI_TYPE.MainTree_01,this.getMainTree_01),this.loadAnimate(MAIN_ANI_TYPE.MainTree_02,this.getMainTree_02)),NOT_USE_SP_MAIN_ANIMATION||(this.loadAnimate(MAIN_ANI_TYPE.CardRareTypeSR_1,this.getCardRareTypeSR_1),this.loadAnimate(MAIN_ANI_TYPE.CardRareTypeSR_2,this.getCardRareTypeSR_2),this.loadAnimate(MAIN_ANI_TYPE.CardRareTypeSR_3,this.getCardRareTypeSR_3),this.loadAnimate(MAIN_ANI_TYPE.CardRareTypeSR_4,this.getCardRareTypeSR_4),this.loadAnimate(MAIN_ANI_TYPE.CardRareTypeSSR_1,this.getCardRareTypeSSR_1),this.loadAnimate(MAIN_ANI_TYPE.CardRareTypeSSR_2,this.getCardRareTypeSSR_2),this.loadAnimate(MAIN_ANI_TYPE.CardRareTypeSSR_3,this.getCardRareTypeSSR_3),this.loadAnimate(MAIN_ANI_TYPE.CardRareTypeSSR_4,this.getCardRareTypeSSR_4),this.loadAnimate(MAIN_ANI_TYPE.LevelUpEffect,this.getLevelUpEffect),this.loadAnimate(MAIN_ANI_TYPE.EvolutionEffect,this.getEvolutionEffect),this.loadAnimate(MAIN_ANI_TYPE.AchievementComplete,this.getAchievementComplete),this.loadAnimate(MAIN_ANI_TYPE.LimitOverEffect,this.getLimitOverEffect),this.loadAnimate(MAIN_ANI_TYPE.LimitOverStep_1,this.getLimitOverStep_1),this.loadAnimate(MAIN_ANI_TYPE.LimitOverStep_2,this.getLimitOverStep_2),this.loadAnimate(MAIN_ANI_TYPE.LimitOverStep_3,this.getLimitOverStep_3),this.loadAnimate(MAIN_ANI_TYPE.LimitOverStep_4,this.getLimitOverStep_4),this.loadAnimate(MAIN_ANI_TYPE.LimitOverStep_5,this.getLimitOverStep_5),this.loadAnimate(MAIN_ANI_TYPE.StoryNewIcon,this.getStoryNewIcon),this.loadAnimate(MAIN_ANI_TYPE.RebirthEffect,this.getRebirthEffect),this.loadAnimate(MAIN_ANI_TYPE.GachaNewGeneral,this.getGachaNewGeneral),this.loadAnimate(MAIN_ANI_TYPE.CeilingGachaGeneral,this.getCeilingGachaGeneral),this.loadAnimate(MAIN_ANI_TYPE.GachaSSRFrame,this.getGachaSSRFrame),this.loadAnimate(MAIN_ANI_TYPE.RaidGacahNewEquipment,this.getRaidGacahNewEquipment),this.loadAnimate(MAIN_ANI_TYPE.CardSpecialEff,this.getCardSpecialEff),this.loadAnimate(MAIN_ANI_TYPE.GachaAniRareType_01,this.getGachaAniRareType_01),this.loadAnimate(MAIN_ANI_TYPE.GachaAniRareType_02,this.getGachaAniRareType_02),this.loadAnimate(MAIN_ANI_TYPE.GachaAniRareType_03,this.getGachaAniRareType_03),this.loadAnimate(MAIN_ANI_TYPE.GachaAniRareType_04,this.getGachaAniRareType_04),this.loadAnimate(MAIN_ANI_TYPE.GachaAniRareType_05,this.getGachaAniRareType_05),this.loadAnimate(MAIN_ANI_TYPE.GachaAniRareType_06,this.getGachaAniRareType_06),this.loadAnimate(MAIN_ANI_TYPE.GachaAniRareTypeIn_01,this.getGachaAniRareTypeIn_01),this.loadAnimate(MAIN_ANI_TYPE.GachaAniRareTypeIn_02,this.getGachaAniRareTypeIn_02),this.loadAnimate(MAIN_ANI_TYPE.GachaAniRareTypeIn_03,this.getGachaAniRareTypeIn_03),this.loadAnimate(MAIN_ANI_TYPE.GachaAniRareTypeIn_04,this.getGachaAniRareTypeIn_04),this.loadAnimate(MAIN_ANI_TYPE.GachaAniRareTypeIn_05,this.getGachaAniRareTypeIn_05),this.loadAnimate(MAIN_ANI_TYPE.GachaAniRareTypeIn_06,this.getGachaAniRareTypeIn_06),this.loadAnimate(MAIN_ANI_TYPE.EvolutionClassType_N,this.getEvolutionClassType_N),this.loadAnimate(MAIN_ANI_TYPE.EvolutionClassType_HR,this.getEvolutionClassType_HR),this.loadAnimate(MAIN_ANI_TYPE.EvolutionClassType_SR,this.getEvolutionClassType_SR),this.loadAnimate(MAIN_ANI_TYPE.EvolutionClassType_SSR,this.getEvolutionClassType_SSR),this.loadAnimate(MAIN_ANI_TYPE.RebirthClassType_SSR,this.getRebirthClassType_SSR)),USE_UIEFFECT_OPTION_01&&(this.loadAnimate(MAIN_ANI_TYPE.MainFireEffect,this.getMainFireEffect),this.loadAnimate(MAIN_ANI_TYPE.LeftXMasTree,this.getLeftXMasTree),this.loadAnimate(MAIN_ANI_TYPE.RightXMasTree,this.getRightXMasTree)),USE_UIEFFECT_OPTION_02&&(this.loadAnimate(MAIN_ANI_TYPE.EventDungeonBoxGachaCurrentBox,this.getEventDungeonBoxGachaCurrentBox),this.loadAnimate(MAIN_ANI_TYPE.EventDungeonBoxGachaCompleteBox,this.getEventDungeonBoxGachaCompleteBox),this.loadAnimate(MAIN_ANI_TYPE.EventDungeonExtraBoxGachaCurrentBox,this.getEventDungeonExtraBoxGachaCurrentBox)),USE_UIEFFECT_OPTION_09&&this.loadAnimate(MAIN_ANI_TYPE.EventDungeonBoxGachaMainItem,this.getEventDungeonBoxGachaMainItem),USE_UIEFFECT_OPTION_10&&this.loadAnimate(MAIN_ANI_TYPE.EventDungeonBoxGachaOpenEffect,this.getEventDungeonBoxGachaOpenEffect)}return MainAni.prototype.getEvolutionClassType_N=function(){for(var animation=cc.Animation.create(),i=1;i<=6;i++)animation.addSpriteFrameWithFile("#effect_star_n_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.08),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getEvolutionClassType_HR=function(){for(var animation=cc.Animation.create(),i=1;i<=6;i++)animation.addSpriteFrameWithFile("#effect_star_hr_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.08),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getEvolutionClassType_SR=function(){for(var animation=cc.Animation.create(),i=1;i<=6;i++)animation.addSpriteFrameWithFile("#effect_star_sr_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.08),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getEvolutionClassType_SSR=function(){for(var animation=cc.Animation.create(),i=1;i<=6;i++)animation.addSpriteFrameWithFile("#effect_star_ssr_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.08),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getRebirthClassType_SSR=function(){for(var animation=cc.Animation.create(),i=1;i<=6;i++)animation.addSpriteFrameWithFile("#effect_star_ssr_rebirth_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.08),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getLimitOverEffect=function(){for(var animation=cc.Animation.create(),i=1;i<=16;i++)animation.addSpriteFrameWithFile("#effect_limit_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.07),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getLimitOverStep_1=function(){for(var animation=cc.Animation.create(),i=1;i<=6;i++)animation.addSpriteFrameWithFile("#effect_limit_lv_53_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.08),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getLimitOverStep_2=function(){for(var animation=cc.Animation.create(),i=1;i<=6;i++)animation.addSpriteFrameWithFile("#effect_limit_lv_56_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.08),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getLimitOverStep_3=function(){for(var animation=cc.Animation.create(),i=1;i<=6;i++)animation.addSpriteFrameWithFile("#effect_limit_lv_59_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.08),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getLimitOverStep_4=function(){for(var animation=cc.Animation.create(),i=1;i<=6;i++)animation.addSpriteFrameWithFile("#effect_limit_lv_62_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.08),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getLimitOverStep_5=function(){for(var animation=cc.Animation.create(),i=1;i<=6;i++)animation.addSpriteFrameWithFile("#effect_limit_lv_65_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.08),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getCardRareTypeSR_1=function(){for(var animation=cc.Animation.create(),i=1;i<=5;i++)animation.addSpriteFrameWithFile(RES_CDN_DEFULT+"card_animation/thumb_5_1_"+i+".png");return animation.setDelayPerUnit(.1),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getCardRareTypeSR_2=function(){for(var animation=cc.Animation.create(),i=1;i<=5;i++)animation.addSpriteFrameWithFile(RES_CDN_DEFULT+"card_animation/thumb_5_2_"+i+".png");return animation.setDelayPerUnit(.1),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getCardRareTypeSR_3=function(){for(var animation=cc.Animation.create(),i=1;i<=5;i++)animation.addSpriteFrameWithFile(RES_CDN_DEFULT+"card_animation/thumb_5_3_"+i+".png");return animation.setDelayPerUnit(.1),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getCardRareTypeSR_4=function(){for(var animation=cc.Animation.create(),i=1;i<=5;i++)animation.addSpriteFrameWithFile(RES_CDN_DEFULT+"card_animation/thumb_5_4_"+i+".png");return animation.setDelayPerUnit(.1),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getCardRareTypeSSR_1=function(){for(var animation=cc.Animation.create(),i=1;i<=5;i++)animation.addSpriteFrameWithFile(RES_CDN_DEFULT+"card_animation/thumb_6_1_"+i+".png");return animation.setDelayPerUnit(.1),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getCardRareTypeSSR_2=function(){for(var animation=cc.Animation.create(),i=1;i<=5;i++)animation.addSpriteFrameWithFile(RES_CDN_DEFULT+"card_animation/thumb_6_2_"+i+".png");return animation.setDelayPerUnit(.1),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getCardRareTypeSSR_3=function(){for(var animation=cc.Animation.create(),i=1;i<=5;i++)animation.addSpriteFrameWithFile(RES_CDN_DEFULT+"card_animation/thumb_6_3_"+i+".png");return animation.setDelayPerUnit(.1),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getCardRareTypeSSR_4=function(){for(var animation=cc.Animation.create(),i=1;i<=5;i++)animation.addSpriteFrameWithFile(RES_CDN_DEFULT+"card_animation/thumb_6_4_"+i+".png");return animation.setDelayPerUnit(.1),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getMainCatatact_01=function(){if(!NOT_USE_SP_CAMP_EFFECT){for(var animation=cc.Animation.create(),i=1;i<=10;i++)animation.addSpriteFrameWithFile("#effect_main_cataract_01_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.05),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)}},MainAni.prototype.getMainCatatact_02=function(){if(!NOT_USE_SP_CAMP_EFFECT){for(var animation=cc.Animation.create(),i=1;i<=10;i++)animation.addSpriteFrameWithFile("#effect_main_cataract_02_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.05),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)}},MainAni.prototype.getMainCatatact_03=function(){if(!NOT_USE_SP_CAMP_EFFECT){for(var animation=cc.Animation.create(),i=1;i<=10;i++)animation.addSpriteFrameWithFile("#effect_main_cataract_03_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.05),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)}},MainAni.prototype.getMainCatatact_04=function(){if(!NOT_USE_SP_CAMP_EFFECT){for(var animation=cc.Animation.create(),i=1;i<=10;i++)animation.addSpriteFrameWithFile("#effect_main_cataract_04_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.05),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)}},MainAni.prototype.getMainCatatact_05=function(){if(!NOT_USE_SP_CAMP_EFFECT){for(var animation=cc.Animation.create(),i=1;i<=10;i++)animation.addSpriteFrameWithFile("#effect_main_cataract_05_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.05),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)}},MainAni.prototype.getMainCatatact_06=function(){if(!NOT_USE_SP_CAMP_EFFECT){for(var animation=cc.Animation.create(),i=1;i<=10;i++)animation.addSpriteFrameWithFile("#effect_main_cataract_06_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.05),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)}},MainAni.prototype.getMainForest_01=function(){if(!NOT_USE_SP_CAMP_EFFECT){for(var animation=cc.Animation.create(),i=1;i<=4;i++)animation.addSpriteFrameWithFile("#effect_main_forest_01_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.2),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)}},MainAni.prototype.getMainForest_02=function(){if(!NOT_USE_SP_CAMP_EFFECT){for(var animation=cc.Animation.create(),i=1;i<=4;i++)animation.addSpriteFrameWithFile("#effect_main_forest_02_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.2),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)}},MainAni.prototype.getMainForest_03=function(){if(!NOT_USE_SP_CAMP_EFFECT){for(var animation=cc.Animation.create(),i=1;i<=4;i++)animation.addSpriteFrameWithFile("#effect_main_forest_03_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.2),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)}},MainAni.prototype.getMainForest_04=function(){if(!NOT_USE_SP_CAMP_EFFECT){for(var animation=cc.Animation.create(),i=1;i<=4;i++)animation.addSpriteFrameWithFile("#effect_main_forest_04_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.2),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)}},MainAni.prototype.getMainForest_05=function(){if(!NOT_USE_SP_CAMP_EFFECT){for(var animation=cc.Animation.create(),i=1;i<=4;i++)animation.addSpriteFrameWithFile("#effect_main_forest_05_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.2),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)}},MainAni.prototype.getMainForest_06=function(){if(!NOT_USE_SP_CAMP_EFFECT){for(var animation=cc.Animation.create(),i=1;i<=4;i++)animation.addSpriteFrameWithFile("#effect_main_forest_06_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.2),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)}},MainAni.prototype.getMainForest_07=function(){if(!NOT_USE_SP_CAMP_EFFECT){for(var animation=cc.Animation.create(),i=1;i<=4;i++)animation.addSpriteFrameWithFile("#effect_main_forest_07_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.2),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)}},MainAni.prototype.getMainForest_08=function(){if(!NOT_USE_SP_CAMP_EFFECT){for(var animation=cc.Animation.create(),i=1;i<=4;i++)animation.addSpriteFrameWithFile("#effect_main_forest_08_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.2),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)}},MainAni.prototype.getMainForest_09=function(){if(!NOT_USE_SP_CAMP_EFFECT){for(var animation=cc.Animation.create(),i=1;i<=4;i++)animation.addSpriteFrameWithFile("#effect_main_forest_09_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.2),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)}},MainAni.prototype.getMainForest_10=function(){if(!NOT_USE_SP_CAMP_EFFECT){for(var animation=cc.Animation.create(),i=1;i<=4;i++)animation.addSpriteFrameWithFile("#effect_main_forest_10_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.2),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)}},MainAni.prototype.getMainForest_11=function(){if(!NOT_USE_SP_CAMP_EFFECT){for(var animation=cc.Animation.create(),i=1;i<=4;i++)animation.addSpriteFrameWithFile("#effect_main_forest_11_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.2),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)}},MainAni.prototype.getMainForest_12=function(){if(!NOT_USE_SP_CAMP_EFFECT){for(var animation=cc.Animation.create(),i=1;i<=4;i++)animation.addSpriteFrameWithFile("#effect_main_forest_12_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.2),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)}},MainAni.prototype.getMainTree_01=function(){if(!NOT_USE_SP_CAMP_EFFECT){for(var animation=cc.Animation.create(),i=1;i<=4;i++)animation.addSpriteFrameWithFile("#effect_main_tree_01_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.2),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)}},MainAni.prototype.getMainTree_02=function(){if(!NOT_USE_SP_CAMP_EFFECT){for(var animation=cc.Animation.create(),i=1;i<=4;i++)animation.addSpriteFrameWithFile("#effect_main_tree_02_"+leadingZeros(i,2)+".png");return animation.setDelayPerUnit(.2),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)}},MainAni.prototype.getLevelUpEffect=function(){for(var animation=cc.Animation.create(),i=1;i<=9;i++){var frameName="#effect_yh_lvup_"+leadingZeros(i,2)+".png";animation.addSpriteFrameWithFile(frameName)}return animation.setDelayPerUnit(.07),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getEvolutionEffect=function(){for(var animation=cc.Animation.create(),i=1;i<=12;i++){var frameName="#effect_evolve_"+leadingZeros(i,2)+".png";animation.addSpriteFrameWithFile(frameName)}return animation.setDelayPerUnit(.07),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getRebirthEffect=function(){for(var animation=cc.Animation.create(),i=1;i<=12;i++){var frameName="#effect_rebirth_"+leadingZeros(i,2)+".png";animation.addSpriteFrameWithFile(frameName)}return animation.setDelayPerUnit(.07),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getGachaNewGeneral=function(){for(var animation=cc.Animation.create(),i=1;i<=4;i++){var frameName="#result_new_"+i+".png";animation.addSpriteFrameWithFile(frameName)}return animation.setDelayPerUnit(.1),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getCeilingGachaGeneral=function(){for(var animation=cc.Animation.create(),i=1;i<=4;i++){var frameName="#gacha_ceiling_ic_"+i+".png";animation.addSpriteFrameWithFile(frameName)}return animation.setDelayPerUnit(.1),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getGachaSSRFrame=function(){for(var animation=cc.Animation.create(),i=1;i<=5;i++){var frameName="#result_thumb_6_"+i+".png";animation.addSpriteFrameWithFile(frameName)}return animation.setDelayPerUnit(.1),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getGachaAniRareType_01=function(){for(var animation=cc.Animation.create(),i=1;i<=9;i++){var index=i;8<index&&(index=1),animation.addSpriteFrameWithFile("#rare_type_01_loop_"+leadingZeros(index,2)+".png")}return animation.setDelayPerUnit(.1),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getGachaAniRareType_02=function(){for(var animation=cc.Animation.create(),i=1;i<=9;i++){var index=i;8<index&&(index=1),animation.addSpriteFrameWithFile("#rare_type_02_loop_"+leadingZeros(index,2)+".png")}return animation.setDelayPerUnit(.1),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getGachaAniRareType_03=function(){for(var animation=cc.Animation.create(),i=1;i<=9;i++){var index=i;8<index&&(index=1),animation.addSpriteFrameWithFile("#rare_type_03_loop_"+leadingZeros(index,2)+".png")}return animation.setDelayPerUnit(.1),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getGachaAniRareType_04=function(){for(var animation=cc.Animation.create(),i=1;i<=9;i++){var index=i;8<index&&(index=1),animation.addSpriteFrameWithFile("#rare_type_04_loop_"+leadingZeros(index,2)+".png")}return animation.setDelayPerUnit(.1),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getGachaAniRareType_05=function(){for(var animation=cc.Animation.create(),i=1;i<=9;i++){var index=i;8<index&&(index=1),animation.addSpriteFrameWithFile("#rare_type_05_loop_"+leadingZeros(index,2)+".png")}return animation.setDelayPerUnit(.1),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getGachaAniRareType_06=function(){for(var animation=cc.Animation.create(),i=1;i<=9;i++){var index=i;8<index&&(index=1),animation.addSpriteFrameWithFile("#rare_type_06_loop_"+leadingZeros(index,2)+".png")}return animation.setDelayPerUnit(.1),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getGachaAniRareTypeIn_01=function(){for(var animation=cc.Animation.create(),i=1;i<=8;i++){var frame=cc.spriteFrameCache.getSpriteFrame("rare_type_01_in_"+leadingZeros(i,2)+".png");animation.addSpriteFrame(frame)}return animation.setDelayPerUnit(.05),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getGachaAniRareTypeIn_02=function(){for(var animation=cc.Animation.create(),i=1;i<=8;i++){var frame=cc.spriteFrameCache.getSpriteFrame("rare_type_02_in_"+leadingZeros(i,2)+".png");animation.addSpriteFrame(frame)}return animation.setDelayPerUnit(.05),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getGachaAniRareTypeIn_03=function(){for(var animation=cc.Animation.create(),i=1;i<=8;i++){var frame=cc.spriteFrameCache.getSpriteFrame("rare_type_03_in_"+leadingZeros(i,2)+".png");animation.addSpriteFrame(frame)}return animation.setDelayPerUnit(.05),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getGachaAniRareTypeIn_04=function(){for(var animation=cc.Animation.create(),i=1;i<=8;i++){var frame=cc.spriteFrameCache.getSpriteFrame("rare_type_04_in_"+leadingZeros(i,2)+".png");animation.addSpriteFrame(frame)}return animation.setDelayPerUnit(.05),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getGachaAniRareTypeIn_05=function(){for(var animation=cc.Animation.create(),i=1;i<=8;i++){var frame=cc.spriteFrameCache.getSpriteFrame("rare_type_05_in_"+leadingZeros(i,2)+".png");animation.addSpriteFrame(frame)}return animation.setDelayPerUnit(.05),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getGachaAniRareTypeIn_06=function(){for(var animation=cc.Animation.create(),i=1;i<=8;i++){var frame=cc.spriteFrameCache.getSpriteFrame("rare_type_06_in_"+leadingZeros(i,2)+".png");animation.addSpriteFrame(frame)}return animation.setDelayPerUnit(.05),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getStoryNewIcon=function(){for(var animation=cc.Animation.create(),i=1;i<=6;i++){var ani_img="#effect_new_"+leadingZeros(i,2)+".png";animation.addSpriteFrameWithFile(ani_img)}return animation.setDelayPerUnit(.05),animation.setRestoreOriginalFrame(!0),new cc.Animate(animation)},MainAni.prototype.getAchievementComplete=function(){for(var animation=cc.Animation.create(),i=1;i<=9;i++){var ani_img="#effect_complete_"+leadingZeros(i,2)+".png";animation.addSpriteFrameWithFile(ani_img)}return animation.setDelayPerUnit(.05),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getEventDungeonBoxGachaMainItem=function(){for(var animation=cc.Animation.create(),i=1;i<=8;i++){var ani_img="#effect_boxgacha_"+leadingZeros(i,2)+".png";animation.addSpriteFrameWithFile(ani_img)}return animation.setDelayPerUnit(.05),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getEventDungeonBoxGachaCurrentBox=function(){for(var animation=cc.Animation.create(),i=1;i<=4;i++){var ani_img="#btn_eventvs_box_1_off_"+leadingZeros(i,2)+".png";animation.addSpriteFrameWithFile(ani_img)}return animation.setDelayPerUnit(.05),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getEventDungeonBoxGachaCompleteBox=function(){for(var animation=cc.Animation.create(),i=1;i<=4;i++){var ani_img="#btn_eventvs_box_1_finish_"+leadingZeros(i,2)+".png";animation.addSpriteFrameWithFile(ani_img)}return animation.setDelayPerUnit(.08),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getEventDungeonExtraBoxGachaCurrentBox=function(){for(var animation=cc.Animation.create(),i=1;i<=4;i++){var ani_img="#btn_eventvs_extra_box_1_off_"+leadingZeros(i,2)+".png";animation.addSpriteFrameWithFile(ani_img)}return animation.setDelayPerUnit(.08),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getEventDungeonBoxGachaOpenEffect=function(){for(var animation=cc.Animation.create(),i=1;i<=12;i++){var ani_img="#effect_boxgacha_panel_"+leadingZeros(i,2)+".png";animation.addSpriteFrameWithFile(ani_img)}return animation.setDelayPerUnit(.02),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getStoryEntrance=function(){for(var animation=cc.Animation.create(),i=1;i<=4;i++){var ani_img="#effect_mark_"+leadingZeros(i,2)+".png";animation.addSpriteFrameWithFile(ani_img)}return animation.setDelayPerUnit(.05),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getRaidGacahNewEquipment=function(){for(var animation=cc.Animation.create(),i=1;i<=4;i++){var frame=cc.spriteFrameCache.getSpriteFrame("raid_gacha_result_new_"+i+".png");animation.addSpriteFrame(frame)}return animation.setDelayPerUnit(.05),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getMainFireEffect=function(){for(var animation=cc.Animation.create(),i=1;i<=12;i++){var frameName="#effect_xmas_fire_"+(i<10?"0"+i:i)+".png";animation.addSpriteFrameWithFile(frameName)}return animation.setDelayPerUnit(.1),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getLeftXMasTree=function(){for(var animation=cc.Animation.create(),i=1;i<=2;i++){var frameName="#effect_xmas_tree_2_"+i+".png";animation.addSpriteFrameWithFile(frameName)}return animation.setDelayPerUnit(.7),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getRightXMasTree=function(){for(var animation=cc.Animation.create(),i=1;i<=2;i++){var frameName="#effect_xmas_tree_1_"+i+".png";animation.addSpriteFrameWithFile(frameName)}return animation.setDelayPerUnit(.7),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.getCardSpecialEff=function(){for(var animation=cc.Animation.create(),i=1;i<=14;i++){var frameName=cmString("#effect_card_special_%02d.png",i);animation.addSpriteFrameWithFile(frameName)}return animation.setDelayPerUnit(.1),animation.setRestoreOriginalFrame(!1),new cc.Animate(animation)},MainAni.prototype.loadAnimate=function(id,func){var ani=func();m_aniList.push({id:id,ani:ani})},MainAni.prototype.getAnimate=function(id){for(var i=0;i<m_aniList.length;++i)if(m_aniList[i].id==id)return m_aniList[i].ani.clone()},MainAni.prototype.getAnimation=function(id){return this.getAnimate(id)},{getInstance:function(){return void 0===instance&&(instance=new MainAni),instance}}}(),STATUS={NONE:0,CHECKING:1,READY:2,SHOW:3,SHOWING:4,END:5},ANNOUNCE_ENUM={ANNOUNCE_ACTION_TYPE_MARQUEE:1,ANNOUNCE_ACTION_TYPE_COUNTDOWN:2},MARQUEE_VELOCITY=20,AnnounceLayer=cc.Layer.extend({m_is_show:!1,m_marquee_layer:null,m_marquee_label:null,m_cliper:null,m_stencil:null,m_marquee_box:null,m_countdown_layer:null,m_countdown_box:null,m_countdown_label:null,m_status:STATUS.NONE,m_announce:null,ctor:function(){this._super(),this.init()},init:function(){this._super(),this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_MIDDLE());var winSize=ccSize(this);this.m_marquee_layer=new cc.Layer,this.m_marquee_layer.ignoreAnchorPointForPosition(!1),this.m_marquee_layer.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_marquee_layer.setPosition(ZERO()),this.addChild(this.m_marquee_layer),this.m_marquee_layer.setVisible(!1),this.m_cliper=new cc.ClippingNode,this.m_cliper.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_cliper.setAlphaThreshold(.5),this.m_cliper.setPosition(ZERO()),this.m_marquee_layer.addChild(this.m_cliper),this.m_marquee_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box.png",cc.Rect(10,10,10,10)),this.m_marquee_box.setPreferredSize(cc.size(winSize.width,30)),this.m_marquee_box.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_marquee_box.setPosition(.5*winSize.width,winSize.height-56),this.m_marquee_box.setOpacity(180),this.m_cliper.addChild(this.m_marquee_box),this.m_stencil=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box.png",cc.Rect(10,10,10,10)),this.m_stencil.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_stencil.setPreferredSize(ccSize(this.m_marquee_box)),this.m_stencil.setPosition(.5*winSize.width,winSize.height-56),this.m_cliper.setStencil(this.m_stencil);var marqueeBoxSize=ccSize(this.m_marquee_box);return this.m_marquee_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_201),this.m_marquee_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_marquee_label.setPosition(marqueeBoxSize.width,.5*marqueeBoxSize.height),this.m_marquee_box.addChild(this.m_marquee_label),this.m_countdown_layer=new cc.Layer,this.m_countdown_layer.ignoreAnchorPointForPosition(!1),this.m_countdown_layer.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_countdown_layer.setPosition(ZERO()),this.addChild(this.m_countdown_layer),this.m_countdown_layer.setVisible(!1),this.m_countdown_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box.png",cc.Rect(10,10,10,10)),this.m_countdown_box.setPreferredSize(cc.size(300,40)),this.m_countdown_box.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_countdown_box.setPosition(.5*winSize.width,winSize.height-100),this.m_countdown_box.setOpacity(180),this.m_countdown_layer.addChild(this.m_countdown_box),this.m_countdown_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_201),this.m_countdown_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_countdown_label.setPosition(ccCenter(this.m_countdown_box)),this.m_countdown_box.addChild(this.m_countdown_label),this.m_status=STATUS.CHECKING,this.schedule(this.update,.5),!0},onEnter:function(){this._super()},hideAnnouceMsg:function(){this.m_marquee_label.isRunning()&&this.m_marquee_label.stopAllActions(),this.m_countdown_box.isRunning()&&this.m_countdown_box.stopAllActions(),this.m_marquee_layer.setVisible(!1),this.m_countdown_layer.setVisible(!1)},showAnnounceMsg:function(){this.setStatus(STATUS.CHECKING);ccSize(this);var msg=this.m_announce.message;msg.replace("\r\n","  "),this.m_marquee_label.setString(msg);var size=ccSize(this.m_marquee_label),mSize=ccSize(this.m_marquee_box);this.m_marquee_label.isRunning()&&(this.m_marquee_label.stopAllActions(),this.m_marquee_label.setPositionX(mSize.width+10)),this.m_marquee_label.setPositionX(mSize.width+10);var duration=size.width/mSize.width*MARQUEE_VELOCITY;duration<MARQUEE_VELOCITY&&(duration=MARQUEE_VELOCITY);var move=new cc.MoveTo(duration,cc.p(-size.width-10,.5*mSize.height)),cb=new cc.CallFunc(this.cbMarqueeEnd.bind(this)),seq=new cc.Sequence(move,cb);this.m_marquee_label.runAction(seq),this.m_announce.action_type==ANNOUNCE_ENUM.ANNOUNCE_ACTION_TYPE_MARQUEE?(this.m_marquee_layer.setVisible(!0),this.m_countdown_layer.setVisible(!1)):this.m_announce.action_type==ANNOUNCE_ENUM.ANNOUNCE_ACTION_TYPE_COUNTDOWN&&(this.m_marquee_layer.setVisible(!0),this.m_countdown_layer.setVisible(!0),this.countdown(new cc.CallFunc(this.cbCountdownEnd.bind(this))))},cbMarqueeEnd:function(){var now=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)),et=moment(this.m_announce.end_dt);now.valueOf()<et.valueOf()?this.showAnnounceMsg():this.m_status!=STATUS.NONE&&this.setStatus(STATUS.END)},countdown:function(_callback){var now=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)),diff=moment(this.m_announce.end_dt).valueOf()-now.valueOf(),d=moment.duration(diff);0<d.hours()?this.m_countdown_label.setString(cmString(res_str("label_app_end_remain_time_hour_min_sec"),d.hours(),d.minutes(),d.seconds())):0<d.minutes()?this.m_countdown_label.setString(cmString(res_str("label_app_end_remain_time_min_sec"),d.minutes(),d.seconds())):this.m_countdown_label.setString(cmString(res_str("label_app_end_remain_time_sec"),Math.max(d.seconds(),0))),this.m_countdown_box.isRunning()&&this.m_countdown_box.stopAllActions();var delay=new cc.DelayTime(1),seq=new cc.Sequence(delay,_callback);this.m_countdown_box.runAction(seq)},cbCountdownEnd:function(){var now=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)),end=moment(this.m_announce.end_dt);now.valueOf()<end.valueOf()?this.countdown(new cc.CallFunc(this.cbCountdownEnd.bind(this))):this.countdown(new cc.CallFunc(this.cbCountdownZeroEnd.bind(this)))},cbCountdownZeroEnd:function(){this.m_status!=STATUS.NONE&&this.setStatus(STATUS.END)},checkAnnounceMsg:function(){var list=(new NetService).get_Announce_List();0<list.length&&(this.m_announce=list[0],this.setStatus(STATUS.READY))},clear:function(){this.m_announce.num=0},setStatus:function(_s){this.m_status=_s},update:function(dt){if(this.m_status!=STATUS.NONE)if(this.m_status==STATUS.CHECKING)this.checkAnnounceMsg();else if(this.m_status==STATUS.READY){var now=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME));""==this.m_announce.begin_dt&&this.setStatus(STATUS.CHECKING);var bt=moment(this.m_announce.begin_dt),n=now.valueOf();bt.valueOf()<n&&this.setStatus(STATUS.SHOW)}else if(this.m_status==STATUS.SHOW)this.showAnnounceMsg(this),this.setStatus(STATUS.SHOWING);else if(this.m_status==STATUS.SHOWING);else if(this.m_status==STATUS.END){this.hideAnnouceMsg();var _NetService=new NetService,list=_NetService.get_Announce_List();0<list.length&&list[0].action_type!=ANNOUNCE_ENUM.ANNOUNCE_ACTION_TYPE_COUNTDOWN&&_NetService.clear_Announce_List(),this.m_announce.action_type==ANNOUNCE_ENUM.ANNOUNCE_ACTION_TYPE_COUNTDOWN?(MainObserver.getInstance().postNotification(NOTIFICATION_ANNOUNCE_MESSAGE,message_announce_application_end_popup),_NetService.clear_Announce_List(),this.clear(),this.setStatus(STATUS.NONE)):(this.clear(),this.setStatus(STATUS.CHECKING),this.unschedule("announceLayer")),this.setStatus(STATUS.CHECKING)}}}),ChangeNicknameLayer=cc.Layer.extend({m_newNickname:"",m_inputBox:null,m_backBtn:null,ctor:function(){this._super(),this.createUserNickname()},onEnter:function(){this._super()},createUserNickname:function(){this.m_inputBox=new GameInputMessageBox(!1,!0),MainObserver.getInstance().addObserver(this.checkInputNickname,this,NOTIFICATION_NICKNAME_CHK),this.addChild(this.m_inputBox,99999),this.showChangeNickname()},showChangeNickname:function(){cc.log("##########################"),this.m_inputBox.setTitle("ニックネーム変更");var info={};info.color=cmLabel.getColor(LABEL_FONT_INDEX.FONT_248),info.text="新しいニックネームを入力してください。",this.m_inputBox.setText(info.text),this.m_inputBox.setTextAlignment(MessgeBoxTextAlignment.TextAlignmentCenter),this.m_inputBox.setBelowText("(全角8文字以内、半角12文字以内)"),this.m_inputBox.addButtonInfo(new MessageButtonInfo("変更",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.schedule(function(float){this.m_inputBox.hide(),this.m_newNickname=this.m_inputBox.getText(),window.parent.msgadd(this.m_newNickname+"")}.bind(this),0,0,0,"1")}.bind(this))),this.m_inputBox.show()},checkInputNickname:function(result){if(3==result)return this.schedule(function(float){},0,0,0,"NOTIFY_NICKNAME_BAD_CHARACTER"),MainObserver.getInstance().postNotification(NOTIFY_NICKNAME_BAD_CHARACTER),void MainObserver.getInstance().removeObserver(NOTIFICATION_NICKNAME_CHK);if(""==this.m_newNickname)return this.schedule(function(float){},0,0,0,"NOTIFY_NICKNAME_EMPTY"),MainObserver.getInstance().postNotification(NOTIFY_NICKNAME_EMPTY),void MainObserver.getInstance().removeObserver(NOTIFICATION_NICKNAME_CHK);var validate=this.checkValidNickname(this.m_newNickname);return validate.has_special?MainObserver.getInstance().postNotification(NOTIFY_NICKNAME_BAD_CHARACTER):validate.exceed_length?MainObserver.getInstance().postNotification(NOTIFY_NICKNAME_EXCEED_LENGTH):this.isBadName()?(this.schedule(function(float){},0,0,0,"NOTIFY_NICKNAME_BAD_CHARACTER"),MainObserver.getInstance().postNotification(NOTIFY_NICKNAME_BAD_CHARACTER)):(GameContext.getInstance().setNewNickname(this.m_newNickname),this.schedule(function(float){},0,0,0,"NOTIFY_NICKNAME_REQ_CHANGE"),MainObserver.getInstance().postNotification(NOTIFY_NICKNAME_REQ_CHANGE),this.m_newNickname=""),void MainObserver.getInstance().removeObserver(NOTIFICATION_NICKNAME_CHK)},isBadName:function(){for(var tokens=toUTF8Array(this.m_newNickname),i=0;i<tokens.length;++i){var token=tokens[i];if(1==token.length){var ch=token[0];"A"<=ch&&ch<="Z"&&(ch="a"+(ch-"A")),ch}else token}return!1},checkValidNickname:function(nickname){var validate={has_special:!1,exceed_length:0};if(""==nickname)return validate;var utf8_count=0,alnum_count=0,tokens=[],stringUtil=new StringUtil;if(stringUtil.utf8_tokens(nickname,tokens),0==stringUtil.isalpha(nickname))return validate.has_special=!0,validate;if(tokens.length==nickname.length){for(var i=0;i<tokens.length;++i){if(1==(str=tokens[i]).length){var ch=str[0];if(!stringUtil.isalpha(ch)&&!stringUtil.isalnum(ch))return validate.has_special=!0,validate;++alnum_count}else++utf8_count}var total_count=2*utf8_count+alnum_count;validate.exceed_length=total_count>MAX_NICKNAME_ASCII_LENGTH}else{for(i=0;i<tokens.length;++i){var str;if(1==(str=tokens[i]).length){ch=str[0];if(!stringUtil.isalpha(ch)&&!stringUtil.isalnum(ch))return validate.has_special=!0,validate;++alnum_count}else utf8_count+=str.length}total_count=2*utf8_count+alnum_count;validate.exceed_length=total_count>MAX_NICKNAME_LENGTH}return validate}}),SPEC_LOGIN_BONUS_NEWYEAR=1,SPEC_LOGIN_BONUS_XMAS=2,EVENT_DUNGEON_PERIOD_ID=116001,SpecialLoginBonusAnimationLayer=cc.Layer.extend({m_login_id:0,m_partner_gnrl:null,m_partner_skeleton:null,m_gnrlName:"",m_touch_screen_label:null,m_special_animation_end:!0,m_login_bonus_type:SPEC_LOGIN_BONUS_XMAS,ctor:function(login_id){this._super(),this.init(login_id)},init:function(login_id){},initLayout:function(login_id){var winSize=ccSize(this);this.m_login_id=login_id;var event_dungeon_period_idx=EVENT_DUNGEON_PERIOD_ID,m=MasterManager.getInstance(),bg=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/bg_eventvs_sub_2.jpg",event_dungeon_period_idx));if(bg.setContentSize(1136,640),bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(this)),this.addChild(bg),this.m_login_bonus_type==SPEC_LOGIN_BONUS_XMAS){(gnrl_layer=this.getPartnerGeneralLayer()).ignoreAnchorPointForPosition(!1),gnrl_layer.setAnchorPoint(ANCHOR_MIDDLE()),gnrl_layer.setPosition(ccCenter(bg)),bg.addChild(gnrl_layer);var upper_bg=cc.Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/bg_eventvs_gift_2.png",event_dungeon_period_idx));if(upper_bg.setAnchorPoint(ANCHOR_MIDDLE()),upper_bg.setPosition(ccCenter(bg)),bg.addChild(upper_bg),""!=this.m_gnrlName){var content_label=cmLabel.getLabel(cmString(res_str("label_special_event_login_text"),this.m_gnrlName),LABEL_FONT_INDEX.FONT_281);content_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),content_label.enableOutline(cc.color.BLACK,3),content_label.setPosition(568,76),upper_bg.addChild(content_label)}var mail_comment_label=cmLabel.getLabel(res_str("label_special_mail_comment_text"),LABEL_FONT_INDEX.FONT_201);mail_comment_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),mail_comment_label.enableOutline(cc.color.BLACK,3),mail_comment_label.setPosition(568,46),upper_bg.addChild(mail_comment_label)}else if(this.m_login_bonus_type==SPEC_LOGIN_BONUS_NEWYEAR){var gnrl_layer;(gnrl_layer=this.getPartnerGeneralLayer()).ignoreAnchorPointForPosition(!1),gnrl_layer.setAnchorPoint(ANCHOR_MIDDLE()),gnrl_layer.setPosition(winSize.width-250,.5*winSize.height),bg.addChild(gnrl_layer);var partner_key=GameContext.getInstance().getUserGeneralPartner(),light=cc.Sprite.create("#img_attend_effect.png");light.setAnchorPoint(ANCHOR_MIDDLE()),light.setPosition(386,340),bg.addChild(light);var rotate=new cc.RotateBy(2,360),repeat=new cc.RepeatForever(rotate);light.runAction(repeat);var card_bg=new cc.Sprite(cmString(RES_CDN_DEFULT+"menu_eventvs_%d/img_eventvs_reward_frame.png",event_dungeon_period_idx));card_bg.setAnchorPoint(ANCHOR_MIDDLE()),card_bg.setPosition(386,340),bg.addChild(card_bg);var card=new cc.Sprite,frameName=cmString("m_%d.png",partner_key.gnrl_id),card_frame=cc.spriteFrameCache.getSpriteFrame(frameName);card.setSpriteFrame(card_frame),card.setAnchorPoint(ANCHOR_MIDDLE()),card.setPosition(126,123.5),card_bg.addChild(card);var frame=new cc.Sprite("#img_card_frame_vd.png");frame.setAnchorPoint(ANCHOR_MIDDLE()),frame.setPosition(ccCenter(card)),card.addChild(frame);var happy_vd=new cc.Sprite(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_happyvd.png",event_dungeon_period_idx));happy_vd.setAnchorPoint(ANCHOR_TOP_LEFT()),happy_vd.setPosition(88,ccHeight(bg)),bg.addChild(happy_vd);var box_frame=cc.Scale9Sprite.create(RES_CDN_DEFULT+cmString("menu_eventvs_%d/img_eventvs_9p_vd.png",event_dungeon_period_idx),RectZero());box_frame.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),box_frame.setPosition(0,0),box_frame.setPreferredSize(cc.size(winSize.width,170)),bg.addChild(box_frame);var gnrl=m.get_General(partner_key.gnrl_id),bonus_type=m.get_BonusType(BONUS_TYPE_LOVE_ITEM_PARTNER_COCHOLATE),msg=[];msg.push_back(res_str("label_event_VD_partner_love_item_text_1")),msg.push_back(cmString(res_str("label_event_VD_partner_love_item_text_2"),gnrl.name,bonus_type.name)),msg.push_back(res_str("label_event_VD_partner_love_item_text_3"));for(var off_y=140,i=0;i<msg.length;i++){var label=cmLabel.getLabel(msg[i],LABEL_FONT_INDEX.FONT_281);label.setAnchorPoint(ANCHOR_MIDDLE()),label.setPosition(.5*ccWidth(box_frame),off_y),box_frame.addChild(label),off_y-=36}}this.m_touch_screen_label=cmLabel.getLabel(res_str("label_special_touch_screen"),LABEL_FONT_INDEX.FONT_181),this.m_touch_screen_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_touch_screen_label.enableOutline(cc.color.BLACK,2),this.m_touch_screen_label.setPosition(ccCenter(bg).x,10),this.m_touch_screen_label.setVisible(!1),this.m_touch_screen_label.setOpacity(255),bg.addChild(this.m_touch_screen_label);var touch_callback=new cc.CallFunc(this.touchEnableCallback,this);bg.runAction(new cc.Sequence(new cc.DelayTime(2),touch_callback))},getPartnerGeneralLayer:function(){var layer=new cc.Layer;layer.setContentSize(ccSize(this));var generalService=GeneralService.getInstance(),partner_gnrl=new db.UserGeneralInfo,partner_key=GameContext.getInstance().getUserGeneralPartner(),gnrl_key=new net.User_General_Key;gnrl_key.gnrl_id=partner_key.gnrl_id,gnrl_key.gnrl_num=partner_key.gnrl_num,generalService.getUserGnrlDisplayClassInfo(gnrl_key,partner_gnrl);var partner_id=0;partner_id=partner_gnrl.class_type>=AVAIL_EVOLUTION_CLASS_TYPE_LIMIT&&0!=partner_gnrl.display_class&&partner_gnrl.class_type!=partner_gnrl.display_class?partner_gnrl.gnrl_id-1e3*(partner_gnrl.class_type-partner_gnrl.display_class):partner_gnrl.gnrl_id;var mt=MasterManager.getInstance(),pos=mt.get_BodyPosition(partner_id),morph=MasterTable.getInstance().get_MorphData(partner_id),touch_callback=new cc.CallFunc(this.touchEnableCallback,this);if("y"==morph.is_morph){var gnrl=mt.get_General(morph.gnrl_id);gnrl.gnrl_group;var gnrl_img=[],stading_files=StandingMultiplePngList[morph.gnrl_id];if(null==stading_files)gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".png");else for(var idx=0;idx<stading_files.length;idx++)gnrl_img.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+stading_files[idx]+".png");gnrl_img.push(RES_CDN_DEFULT+cmString("gnrl_%03d/standing/%d.json",gnrl.gnrl_group,morph.gnrl_id)),gnrl_img.push(RES_CDN_DEFULT+cmString("gnrl_%03d/standing/%d.atlas",gnrl.gnrl_group,morph.gnrl_id)),resourceLoader(gnrl_img,function(){this.m_partner_skeleton=new sp.SkeletonAnimation(RES_CDN_DEFULT+cmString("gnrl_%03d/standing/%d.json",gnrl.gnrl_group,morph.gnrl_id),RES_CDN_DEFULT+cmString("gnrl_%03d/standing/%d.atlas",gnrl.gnrl_group,morph.gnrl_id),.1),this.m_partner_skeleton.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_partner_skeleton.setPosition(ccWidth(this)-1458+pos.posx,-726+pos.posy),layer.addChild(this.m_partner_skeleton),this.m_partner_skeleton.setMix("basic","active",.1),this.m_partner_skeleton.setMix("active","basic",.1),this.m_partner_skeleton.setAnimation(0,"active",!1),this.m_partner_skeleton.addAnimation(0,"basic",!0),this.m_gnrlName=gnrl.name,this.m_partner_skeleton.runAction(new cc.Sequence(new cc.DelayTime(2),touch_callback))}.bind(this))}else{var general=MasterManager.getInstance().get_General(partner_id);general.gnrl_group;var card_img="";if(general.gnrl_type==GENERAL_TYPE_YUNHEE)card_img=mt.get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M?getCardBody_ImageStr(general.gnrl_id):getCardBody_ImageStr(general.gnrl_group);else card_img=getCardBody_ImageStr(partner_id);resourceLoader(card_img,function(){if(this.m_partner_gnrl=cc.Sprite.create(),general.gnrl_type==GENERAL_TYPE_YUNHEE){if(mt.get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id),this.m_partner_gnrl.setTexture(img_str)}else{img_str=getCardBody_ImageStr(general.gnrl_group);this.m_img_scale=getCardBody_Scale(general.gnrl_group),this.m_partner_gnrl.setTexture(img_str)}}else{img_str=getCardBody_ImageStr(partner_id);this.m_img_scale=getCardBody_Scale(partner_id),this.m_partner_gnrl.setTexture(img_str)}this.m_partner_gnrl.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_partner_gnrl.setScale(this.m_img_scale),this.m_partner_gnrl.setPosition(ccWidth(this)-1458+pos.posx,-726*this.m_img_scale+pos.posy*this.m_img_scale/2+ccHeight(this.m_partner_gnrl)/2),layer.addChild(this.m_partner_gnrl);var scaleTo_1=new cc.ScaleTo(.1,this.m_img_scale+.03,this.m_img_scale-.03),scaleTo_2=new cc.ScaleTo(.125,this.m_img_scale-.03,this.m_img_scale+.03),scaleTo_3=new cc.ScaleTo(.1,this.m_img_scale+.02,this.m_img_scale-.02),scaleTo_4=new cc.ScaleTo(.1,this.m_img_scale,this.m_img_scale),callback=new cc.CallFunc(this.characterIdelAction,this);this.m_partner_gnrl.runAction(new cc.Sequence(scaleTo_1,scaleTo_2,scaleTo_3,scaleTo_4,callback,new cc.DelayTime(2),touch_callback)),this.m_gnrlName=general.name}.bind(this))}var voice=MasterTable.getInstance().get_Voice(partner_id,voice_main_body_touch,0,0).voice;if(""!=voice){var audio=AudioEngine.getInstance(),sndpath=RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3";audio.playVoice(sndpath)}return layer},characterIdelAction:function(){var scaleTo_1=new cc.ScaleTo(1.2,this.m_img_scale,this.m_img_scale+.01),scaleTo_2=new cc.ScaleTo(1.2,this.m_img_scale,this.m_img_scale-.01),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);this.m_partner_gnrl.runAction(repeat)},touchEnableCallback:function(){null!=this.m_touch_screen_label&&(this.m_touch_screen_label.setVisible(!0),this.m_touch_screen_label.setOpacity(0),this.m_touch_screen_label.runAction(new cc.FadeIn(.5))),this.m_special_animation_end=!1},onEnter:function(){this._super()},onExit:function(){AudioEngine.getInstance().stopEffectsAll(),this._super();var scene=SceneManager.getInstance().getRunningScene();null!=scene&&scene.playMainBGM()},isTodayEnd:function(){return!1},isAnimationEnd:function(){return this.m_special_animation_end}}),tab_evolve=1,tab_rebirth=2,EvolutionMtrlBoxLayer=cc.Layer.extend({m_helpLabelBox:null,m_isShowHelpLabelBox:null,m_tab_evolve:null,m_tab_rebirth:null,m_evolve_layer:null,m_rebirth_layer:null,ctor:function(){this._super(),this.init()},init:function(){var bg_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",RectZero());bg_box.setAnchorPoint(ANCHOR_MIDDLE()),bg_box.setPreferredSize(cc.size(958,555)),bg_box.setInsetLeft(44),bg_box.setInsetRight(44),bg_box.setInsetTop(44),bg_box.setInsetBottom(44),bg_box.setPosition(ccCenter(this)),this.addChild(bg_box,1);var navi=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_navi.png",RectZero());navi.setPreferredSize(cc.size(942,48)),navi.setAnchorPoint(ANCHOR_TOP_LEFT()),navi.setPosition(8,ccHeight(bg_box)-11),bg_box.addChild(navi);var title=cmLabel.getLabel(res_str("label_evolve_mtrl_box"),LABEL_FONT_INDEX.FONT_261);title.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),title.setPosition(ccCenter(navi).x,16),navi.addChild(title),this.m_tab_evolve=new LabelButton("btn_11_none.png","btn_11_on.png","btn_11_off.png",ccui.Widget.PLIST_TEXTURE),this.m_tab_evolve.setFont(LABEL_FONT_INDEX.FONT_201),this.m_tab_evolve.setOffFont(LABEL_FONT_INDEX.FONT_202),this.m_tab_evolve.setString(res_str("label_evolve_mtrl")),this.m_tab_evolve.setAnchorPoint(ZERO()),this.m_tab_evolve.setPosition(17,455),bg_box.addChild(this.m_tab_evolve),this.m_tab_evolve.setEnabled(!1),this.m_tab_evolve.addClickEventListener(function(sender){this.setTab(tab_evolve)}.bind(this)),this.m_tab_rebirth=new LabelButton("btn_11_none.png","btn_11_on.png","btn_11_off.png",ccui.Widget.PLIST_TEXTURE),this.m_tab_rebirth.setFont(LABEL_FONT_INDEX.FONT_201),this.m_tab_rebirth.setOffFont(LABEL_FONT_INDEX.FONT_202),this.m_tab_rebirth.setString(res_str("label_rebirth_mtrl")),this.m_tab_rebirth.setAnchorPoint(ZERO()),this.m_tab_rebirth.setPosition(17+ccWidth(this.m_tab_evolve),455),bg_box.addChild(this.m_tab_rebirth),this.m_tab_rebirth.addClickEventListener(function(sender){this.setTab(tab_rebirth)}.bind(this));var help_btn=new ccui.Button("btn_help_off.png","btn_help_on.png","",ccui.Widget.PLIST_TEXTURE);return help_btn.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),help_btn.setPosition(840,ccCenter(navi).y+4),navi.addChild(help_btn),help_btn.addClickEventListener(function(sender){null!=this.m_helpLabelBox&&(this.m_isShowHelpLabelBox?(this.m_helpLabelBox.setVisible(!1),this.m_isShowHelpLabelBox=!1):(this.m_helpLabelBox.setVisible(!0),this.m_isShowHelpLabelBox=!0))}.bind(this)),this.m_evolve_layer=this.getEvolveLayer(),this.m_evolve_layer.setPosition(ZERO()),bg_box.addChild(this.m_evolve_layer),this.m_rebirth_layer=this.getRebirthLayer(),this.m_rebirth_layer.setPosition(ZERO()),bg_box.addChild(this.m_rebirth_layer),this.m_rebirth_layer.setVisible(!1),this.m_helpLabelBox=this.getHelpTextLabel(bg_box,navi,cc.size(425,50)),!0},getEvolveLayer:function(){var layer=new cc.Layer,evolve_layer_width=0,rare_type_layer=this.getRareTypeOrbLayer();rare_type_layer.setPosition(17,18),layer.addChild(rare_type_layer),evolve_layer_width+=ccWidth(rare_type_layer);var gs=GeneralService.getInstance(),melee_infos=[gs.getUserEvolveArmServiceMtrlInfo(EVOLVE_MTRL_TYPE_MELEE_LOW),gs.getUserEvolveArmServiceMtrlInfo(EVOLVE_MTRL_TYPE_MELEE_MIDDLE),gs.getUserEvolveArmServiceMtrlInfo(EVOLVE_MTRL_TYPE_MELEE)],lancer_infos=[gs.getUserEvolveArmServiceMtrlInfo(EVOLVE_MTRL_TYPE_LANCER_LOW),gs.getUserEvolveArmServiceMtrlInfo(EVOLVE_MTRL_TYPE_LANCER_MIDDLE),gs.getUserEvolveArmServiceMtrlInfo(EVOLVE_MTRL_TYPE_LANCER)],archer_infos=[gs.getUserEvolveArmServiceMtrlInfo(EVOLVE_MTRL_TYPE_ARCHER_LOW),gs.getUserEvolveArmServiceMtrlInfo(EVOLVE_MTRL_TYPE_ARCHER_MIDDLE),gs.getUserEvolveArmServiceMtrlInfo(EVOLVE_MTRL_TYPE_ARCHER)],melee_layer=this.getArmServiceTypeOrbLayer(ARMSERVICETYPE_INFANTRY,melee_infos);melee_layer.setPosition(ccPosX(rare_type_layer)+ccWidth(rare_type_layer),18),layer.addChild(melee_layer),evolve_layer_width+=ccWidth(melee_layer);var lancer_layer=this.getArmServiceTypeOrbLayer(ARMSERVICETYPE_SPEAR,lancer_infos);lancer_layer.setPosition(ccPosX(melee_layer)+ccWidth(melee_layer),18),layer.addChild(lancer_layer),evolve_layer_width+=ccWidth(lancer_layer);var archer_layer=this.getArmServiceTypeOrbLayer(ARMSERVICETYPE_ARCHER,archer_infos);archer_layer.setPosition(ccPosX(lancer_layer)+ccWidth(lancer_layer),18),layer.addChild(archer_layer),evolve_layer_width+=ccWidth(archer_layer);var rainbow_layer=this.getRainbowOrbLayer();return rainbow_layer.setPosition(ccPosX(archer_layer)+ccWidth(archer_layer),18),layer.addChild(rainbow_layer),evolve_layer_width+=ccWidth(rainbow_layer),layer.setContentSize(evolve_layer_width,ccHeight(rare_type_layer)),layer},getRebirthLayer:function(){var layer=new cc.Layer,rebirth_layer_width=0,rebirth_main_mtrl_layer=this.getRebirthMainMtrlLayer();rebirth_main_mtrl_layer.setPosition(17,18),layer.addChild(rebirth_main_mtrl_layer),rebirth_layer_width+=ccWidth(rebirth_main_mtrl_layer);var rebirth_property_layer=this.getRebirthPropertyMtrlLayer();rebirth_property_layer.setPosition(ccPosX(rebirth_main_mtrl_layer)+ccWidth(rebirth_main_mtrl_layer),18),layer.addChild(rebirth_property_layer),rebirth_layer_width+=ccWidth(rebirth_property_layer);var rebirth_common_layer=this.getRebirthCommonMtrlLayer();rebirth_common_layer.setPosition(ccPosX(rebirth_property_layer)+ccWidth(rebirth_property_layer),18),layer.addChild(rebirth_common_layer),rebirth_layer_width+=ccWidth(rebirth_common_layer);var rebirth_event_property_evnet_layer=this.getRebirthEventPropertyMtrlLayer();rebirth_event_property_evnet_layer.setPosition(ccPosX(rebirth_common_layer)+ccWidth(rebirth_common_layer),18),layer.addChild(rebirth_event_property_evnet_layer),rebirth_layer_width+=ccWidth(rebirth_event_property_evnet_layer);var rebirth_event_common_event_layer=this.getRebirthEventCommonMtrlLayer();return rebirth_event_common_event_layer.setPosition(ccPosX(rebirth_event_property_evnet_layer)+ccWidth(rebirth_event_property_evnet_layer),18),layer.addChild(rebirth_event_common_event_layer),rebirth_layer_width+=ccWidth(rebirth_event_common_event_layer),layer.setContentSize(rebirth_layer_width,ccHeight(rebirth_main_mtrl_layer)),layer},setTab:function(tab_type){switch(this.m_tab_evolve.setEnabled(!0),this.m_tab_rebirth.setEnabled(!0),this.m_evolve_layer.setVisible(!1),this.m_rebirth_layer.setVisible(!1),tab_type){case tab_evolve:this.m_tab_evolve.setEnabled(!1),this.m_evolve_layer.setVisible(!0);break;case tab_rebirth:this.m_tab_rebirth.setEnabled(!1),this.m_rebirth_layer.setVisible(!0)}},getHelpTextLabel:function(pLayer,pBaseNode,textSize){var help_text_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());help_text_bg.setContentSize(textSize),help_text_bg.setInsetBottom(13),help_text_bg.setInsetLeft(13),help_text_bg.setInsetRight(13),help_text_bg.setInsetTop(13),help_text_bg.setAnchorPoint(ANCHOR_TOP_LEFT()),help_text_bg.setPosition(ccPosX(pBaseNode)+300,ccPosY(pBaseNode)),pLayer.addChild(help_text_bg);var help_text=cmLabel.getLabel("保有している進化素材、転生素材を確認できます。",LABEL_FONT_INDEX.FONT_181);return help_text.setContentSize(ccWidth(textSize)-30,ccHeight(textSize)-30),help_text.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),help_text.setPosition(13,ccCenter(help_text_bg).y),help_text_bg.addChild(help_text),help_text_bg.setVisible(!1),help_text_bg},initLayout:function(){},onNotification:function(sender){},getRareTypeOrbLayer:function(){var layer=new cc.Layer;layer.setContentSize(185,425);var list_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());list_bg.setAnchorPoint(ZERO()),list_bg.setPosition(ZERO()),list_bg.setContentSize(ccSize(layer)),layer.addChild(list_bg);var title_label=cmLabel.getLabel("レアリティ宝珠",LABEL_FONT_INDEX.FONT_2485);title_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),title_label.setPosition(ccCenter(layer).x,381),layer.addChild(title_label);for(var i=0;i<6;++i){var class_type=6-i,icon=cc.Sprite.create("#img_hwandan_"+class_type+".png");icon.setAnchorPoint(ZERO()),icon.setPosition(16,7+i*(ccHeight(icon)-20)),layer.addChild(icon);var point_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2425);point_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),point_label.setPosition(95,ccPosY(icon)+ccCenter(icon).y),layer.addChild(point_label);var hwandan_info=GeneralService.getInstance().getUserHwandanInfo(HWANDAN_CLASS_6-i,{});point_label.setString(Number(hwandan_info.hwandan_count).toLocaleString("en"))}return layer},getArmServiceTypeOrbLayer:function(arm_service_type,infos){var layer=new cc.Layer;layer.setContentSize(185,425);var list_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());list_bg.setAnchorPoint(ZERO()),list_bg.setPosition(ZERO()),list_bg.setContentSize(ccSize(layer)),layer.addChild(list_bg);var title_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2615);title_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),title_label.setPosition(ccCenter(layer).x,381),layer.addChild(title_label),arm_service_type==ARMSERVICETYPE_INFANTRY?title_label.setString("剣兵宝珠"):arm_service_type==ARMSERVICETYPE_SPEAR?title_label.setString("槍兵宝珠"):arm_service_type==ARMSERVICETYPE_ARCHER&&title_label.setString("弓兵宝珠");for(var i=0;i<3;++i){var class_type=i+1,icon=cc.Sprite.create("#img_evolve_"+arm_service_type+"_"+class_type+".png");icon.setContentSize(78,78),icon.setAnchorPoint(ZERO()),icon.setPosition(16,123+i*(ccHeight(icon)-20)),layer.addChild(icon);var point_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2425);for(var info in point_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),point_label.setPosition(95,ccPosY(icon)+ccCenter(icon).y),layer.addChild(point_label),infos)if(class_type==infos[info].class_type){point_label.setString(Number(infos[info].mtrl_count).toLocaleString("en"));break}}return layer},getRainbowOrbLayer:function(){var layer=new cc.Layer;layer.setContentSize(185,425);var list_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());list_bg.setAnchorPoint(ZERO()),list_bg.setPosition(ZERO()),list_bg.setContentSize(ccSize(layer)),layer.addChild(list_bg);var title_label=cmLabel.getLabel("虹の宝珠",LABEL_FONT_INDEX.FONT_2615);title_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),title_label.setPosition(ccCenter(layer).x,381),layer.addChild(title_label);var user_orb=NetService().get_User_Evolve_Orb(),icon=cc.Sprite.create("#img_orb.png");icon.setAnchorPoint(ZERO()),icon.setPosition(16,181),layer.addChild(icon);var point_label=cmLabel.getLabel(user_orb,LABEL_FONT_INDEX.FONT_2425);return point_label.setString(Number(user_orb).toLocaleString("en")),point_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),point_label.setPosition(95,ccPosY(icon)+ccCenter(icon).y),layer.addChild(point_label),layer},getRebirthMainMtrlLayer:function(){var layer=new cc.Layer;layer.setContentSize(185,425);var mtrl_type=REBIRTH_MTRL_TYPE_6,rebirth=MasterManager.getInstance().get_RebirthMtrlType(mtrl_type),list_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());list_bg.setAnchorPoint(ZERO()),list_bg.setPosition(ZERO()),list_bg.setContentSize(ccSize(layer)),layer.addChild(list_bg);var title_label=cmLabel.getLabel(rebirth.name,LABEL_FONT_INDEX.FONT_2615);title_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),title_label.setPosition(ccCenter(layer).x,381),layer.addChild(title_label);var iconName="";iconName=USE_SHORTCUT_EVOLUTION_ICON?cmString("#rebirth_small_%d.png",mtrl_type):RES_CDN_DEFULT+cmString("icon/rebirth_small/%d.png",mtrl_type);var icon=cc.Sprite.create(iconName);icon.setContentSize(78,78),icon.setAnchorPoint(ZERO()),icon.setPosition(16,181),layer.addChild(icon);var user_rebirth_mtrl_info=NetService().get_User_Rebirth_Mtrl_Info(mtrl_type);null!=user_rebirth_mtrl_info.mtrl_count&&null!=user_rebirth_mtrl_info.mtrl_count||(user_rebirth_mtrl_info.mtrl_count=0);var point_label=cmLabel.getLabel(user_rebirth_mtrl_info.mtrl_count,LABEL_FONT_INDEX.FONT_2425);return point_label.setString(Number(user_rebirth_mtrl_info.mtrl_count).toLocaleString("en")),point_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),point_label.setPosition(95,ccPosY(icon)+ccCenter(icon).y),layer.addChild(point_label),user_rebirth_mtrl_info=null,layer},getRebirthCommonMtrlLayer:function(){var layer=new cc.Layer;layer.setContentSize(185,425);var list_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());list_bg.setAnchorPoint(ZERO()),list_bg.setPosition(ZERO()),list_bg.setContentSize(ccSize(layer)),layer.addChild(list_bg);GeneralService.getInstance();var mtrl_type=REBIRTH_MTRL_TYPE_7,rebirth=MasterManager.getInstance().get_RebirthMtrlType(mtrl_type),title_label=cmLabel.getLabel(rebirth.name,LABEL_FONT_INDEX.FONT_2615);title_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),title_label.setPosition(ccCenter(layer).x,381),layer.addChild(title_label);var iconName="";iconName=USE_SHORTCUT_EVOLUTION_ICON?cmString("#rebirth_small_%d.png",mtrl_type):RES_CDN_DEFULT+cmString("icon/rebirth_small/%d.png",mtrl_type);var icon=cc.Sprite.create(iconName);icon.setContentSize(75,75),icon.setAnchorPoint(ZERO()),icon.setPosition(16,181),layer.addChild(icon);var user_rebirth_mtrl_info=NetService().get_User_Rebirth_Mtrl_Info(mtrl_type);null!=user_rebirth_mtrl_info.mtrl_count&&null!=user_rebirth_mtrl_info.mtrl_count||(user_rebirth_mtrl_info.mtrl_count=0);var point_label=cmLabel.getLabel(user_rebirth_mtrl_info.mtrl_count,LABEL_FONT_INDEX.FONT_2425);return point_label.setString(Number(user_rebirth_mtrl_info.mtrl_count).toLocaleString("en")),point_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),point_label.setPosition(95,ccPosY(icon)+ccCenter(icon).y),layer.addChild(point_label),user_rebirth_mtrl_info=null,layer},getRebirthPropertyMtrlLayer:function(){var layer=new cc.Layer;layer.setContentSize(185,425);var list_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());list_bg.setAnchorPoint(ZERO()),list_bg.setPosition(ZERO()),list_bg.setContentSize(ccSize(layer)),layer.addChild(list_bg);var title_label=cmLabel.getLabel(res_str("label_rebirth_property_mtrl"),LABEL_FONT_INDEX.FONT_2615);title_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),title_label.setPosition(ccCenter(layer).x,381),layer.addChild(title_label);for(var i=0;i<5;++i){var mtrl_type=5-i,iconName="";iconName=USE_SHORTCUT_EVOLUTION_ICON?cmString("#rebirth_small_%d.png",mtrl_type):RES_CDN_DEFULT+cmString("icon/rebirth_small/%d.png",mtrl_type);var icon=cc.Sprite.create(iconName);icon.setContentSize(75,75),icon.setAnchorPoint(ZERO()),icon.setPosition(16,20+i*(ccHeight(icon)-12)),layer.addChild(icon);var user_rebirth_mtrl_info=NetService().get_User_Rebirth_Mtrl_Info(mtrl_type);null!=user_rebirth_mtrl_info.mtrl_count&&null!=user_rebirth_mtrl_info.mtrl_count||(user_rebirth_mtrl_info.mtrl_count=0);var point_label=cmLabel.getLabel(user_rebirth_mtrl_info.mtrl_count,LABEL_FONT_INDEX.FONT_2425);point_label.setString(Number(user_rebirth_mtrl_info.mtrl_count).toLocaleString("en")),point_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),point_label.setPosition(95,ccPosY(icon)+ccCenter(icon).y),layer.addChild(point_label),user_rebirth_mtrl_info=null}return layer},getRebirthEventCommonMtrlLayer:function(){var layer=new cc.Layer;layer.setContentSize(185,425);var list_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());list_bg.setAnchorPoint(ZERO()),list_bg.setPosition(ZERO()),list_bg.setContentSize(ccSize(layer)),layer.addChild(list_bg);var mtrl_type=REBIRTH_MTRL_TYPE_EVENT_6,title_label=cmLabel.getLabel(res_str("label_rebirth_event_common_mtrl"),LABEL_FONT_INDEX.FONT_2013);title_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),title_label.setPosition(ccCenter(layer).x,375),layer.addChild(title_label);var iconName="";iconName=USE_SHORTCUT_EVOLUTION_ICON?cmString("#rebirth_small_%d.png",mtrl_type):RES_CDN_DEFULT+cmString("icon/rebirth_small/%d.png",mtrl_type);var icon=cc.Sprite.create(iconName);icon.setContentSize(75,75),icon.setAnchorPoint(ZERO()),icon.setPosition(16,181),layer.addChild(icon);var user_rebirth_mtrl_info=NetService().get_User_Rebirth_Mtrl_Info(mtrl_type);null!=user_rebirth_mtrl_info.mtrl_count&&null!=user_rebirth_mtrl_info.mtrl_count||(user_rebirth_mtrl_info.mtrl_count=0);var point_label=cmLabel.getLabel(user_rebirth_mtrl_info.mtrl_count,LABEL_FONT_INDEX.FONT_2425);return point_label.setString(Number(user_rebirth_mtrl_info.mtrl_count).toLocaleString("en")),point_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),point_label.setPosition(95,ccPosY(icon)+ccCenter(icon).y),layer.addChild(point_label),user_rebirth_mtrl_info=null,layer},getRebirthEventPropertyMtrlLayer:function(){var layer=new cc.Layer;layer.setContentSize(185,425);var list_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"menu_yh/img_yh_info_box.png",RectZero());list_bg.setAnchorPoint(ZERO()),list_bg.setPosition(ZERO()),list_bg.setContentSize(ccSize(layer)),layer.addChild(list_bg);var title_label=cmLabel.getLabel(res_str("label_rebirth_event_property_mtrl"),LABEL_FONT_INDEX.FONT_2013);title_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),title_label.setPosition(ccCenter(layer).x,375),layer.addChild(title_label);for(var i=0;i<5;++i){var mtrl_type=12-i,iconName="";iconName=USE_SHORTCUT_EVOLUTION_ICON?cmString("#rebirth_small_%d.png",mtrl_type):RES_CDN_DEFULT+cmString("icon/rebirth_small/%d.png",mtrl_type);var icon=cc.Sprite.create(iconName);icon.setContentSize(75,75),icon.setAnchorPoint(ZERO()),icon.setPosition(16,20+i*(ccHeight(icon)-12)),layer.addChild(icon);var user_rebirth_mtrl_info=NetService().get_User_Rebirth_Mtrl_Info(mtrl_type);null!=user_rebirth_mtrl_info.mtrl_count&&null!=user_rebirth_mtrl_info.mtrl_count||(user_rebirth_mtrl_info.mtrl_count=0);var point_label=cmLabel.getLabel(user_rebirth_mtrl_info.mtrl_count,LABEL_FONT_INDEX.FONT_2425);point_label.setString(Number(user_rebirth_mtrl_info.mtrl_count).toLocaleString("en")),point_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),point_label.setPosition(95,ccPosY(icon)+ccCenter(icon).y),layer.addChild(point_label)}return user_rebirth_mtrl_info=null,layer}}),NOTIFICATION_LOGIN_ANI_END="notification_login_ani_end",JOIN_USER_COUNT_14=1,JoinBonusLayer=cc.Layer.extend({m_login_bonus_list:[],m_useBackKey:!1,m_tm_bonus_item_list:[],m_back_btn_visible:null,m_is_ani_layer:!1,m_icon_pos:[],m_bg_box:null,m_bg_img:null,m_bg_label:null,m_bg_text_icon:null,ctor:function(){this.m_login_bonus_list=[],this._super(),this.init()},init:function(){return UserService.getInstance().getLoginBonusInfo(LOGIN_BONUS_TYPE_JOIN,this.m_login_bonus_list),this.m_login_bonus_list.sort(function(l,r){return l.login_count>r.login_count?1:l.login_count<r.login_count?-1:0}),this.initIconPos(),!0},initIconPos:function(){this.m_icon_pos.clear();var pos=[];pos.push(cc.p(84,400)),pos.push(cc.p(194,400)),pos.push(cc.p(304,400)),pos.push(cc.p(414,400)),pos.push(cc.p(84,290)),pos.push(cc.p(194,290)),pos.push(cc.p(304,290)),pos.push(cc.p(414,290)),pos.push(cc.p(84,180)),pos.push(cc.p(194,180)),pos.push(cc.p(304,180)),pos.push(cc.p(414,180)),pos.push(cc.p(84,70)),pos.push(cc.p(194,70)),this.m_icon_pos[JOIN_USER_COUNT_14]=pos},initLayout:function(is_banner_click){this.m_is_banner_click=is_banner_click,USE_SP_MAIN_BANNER?(this.m_bg_box=cc.Sprite.create(RES_CDN_DEFULT+"temp_img.png"),this.m_bg_box.setContentSize(960,567),this.m_bg_box.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bg_box.setPosition(ccCenter(this)),this.addChild(this.m_bg_box),this.m_bg_img=cc.Sprite.create(RES_CDN_DEFULT+"banner/img_event_frame_first_2.png"),this.m_bg_img.setScale(2),this.m_bg_img.setPosition(ccCenter(this.m_bg_box)),this.m_bg_box.addChild(this.m_bg_img)):(this.m_bg_box=cc.Sprite.create(RES_CDN_DEFULT+"banner/img_event_frame_first_2.png"),this.m_bg_box.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bg_box.setPosition(ccCenter(this)),this.addChild(this.m_bg_box));MasterManager.getInstance().get_LoginBonusType(LOGIN_BONUS_TYPE_JOIN);this.m_bg_label=cmLabel.getLabel("出席報酬はメールで支給され、毎日午前４時に更新されます",LABEL_FONT_INDEX.FONT_1614),this.m_bg_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_bg_label.setPosition(ccWidth(this.m_bg_box)-75,42),this.m_bg_box.addChild(this.m_bg_label),this.m_back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_back_btn.setPosition(ccWidth(this.m_bg_box)-9,ccHeight(this.m_bg_box)-26),this.m_back_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],NOTIFY_JOIN_BONUS_HIDE)}.bind(this)),this.m_bg_box.addChild(this.m_back_btn),this.m_useBackKey=!1,this.m_back_btn.setEnabled(!1),this.m_back_btn_visible=cc.Sprite.create("#btn_cancel_off.png"),this.m_back_btn_visible.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_back_btn_visible.setPosition(ccWidth(this.m_bg_box)-9,ccHeight(this.m_bg_box)-26),this.m_bg_box.addChild(this.m_back_btn_visible),this.createRewardItemLayer(this.m_bg_box),this.m_bg_text_icon=cc.Sprite.create("#img_attend_text.png"),this.m_bg_text_icon.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_bg_text_icon.setPosition(ccPosX(this.m_bg_label)-ccWidth(this.m_bg_label)-10,34),this.m_bg_box.addChild(this.m_bg_text_icon)},createRewardItemLayer:function(parent){var user_login_bonus=GameContext.getInstance().getLoginBonus(),layer=new cc.Layer;layer.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.ignoreAnchorPointForPosition(!1),layer.setPosition(ZERO());var size=ccSize(parent);layer.setContentSize(size),parent.addChild(layer);var pos_list=[];14==this.m_login_bonus_list.length&&(pos_list=this.m_icon_pos[JOIN_USER_COUNT_14]);for(var i=0;i<this.m_login_bonus_list.length;i++){var bonus=this.m_login_bonus_list[i];if(i<pos_list.length){var p=pos_list[i];if(bonus.login_count<=user_login_bonus.login_count){var confirm_sprite=cc.Sprite.create("#img_attend_finish.png"),s_w=.5*confirm_sprite.getContentSize().width,s_h=.5*confirm_sprite.getContentSize().height;confirm_sprite.setAnchorPoint(ANCHOR_MIDDLE());var pos_x=p.x+s_w,pos_y=p.y+s_h;if(confirm_sprite.setPosition(pos_x,pos_y),layer.addChild(confirm_sprite),bonus.login_count==user_login_bonus.login_count)if(this.m_is_banner_click)confirm_sprite.setOpacity(255),this.m_back_btn.setEnabled(!0),this.m_useBackKey=!0;else{this.m_is_ani_layer=!0,this.m_today_login_bonus=bonus,confirm_sprite.setOpacity(0),confirm_sprite.setScale(2),user_login_bonus.login_count<this.m_login_bonus_list.length?this.m_tm_bonus_item_list=this.m_login_bonus_list[user_login_bonus.login_count].login_bonus_items:this.m_tm_bonus_item_list.clear();var callbackSound=cc.callFunc(this.confirmEffectSound.bind(this)),callbackEnd=cc.callFunc(this.effectEnd.bind(this));confirm_sprite.runAction(cc.sequence(cc.delayTime(.4),cc.spawn(callbackSound,cc.fadeIn(.3),cc.scaleTo(.3,1)),cc.delayTime(.2),callbackEnd)),this.m_useBackKey=!0}}}}return layer},confirmEffectSound:function(){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_attendance.mp3";audio.playEffect(path)},effectEnd:function(){this.m_animationLayer=new LoginBonusAnimationLayer,this.m_animationLayer.setItemInfo(this.m_today_login_bonus,this.m_tm_bonus_item_list),this.m_animationLayer.initLayout(LOGIN_BONUS_TYPE_JOIN),this.addChild(this.m_animationLayer)},onNotification:function(sender){this.m_back_btn.setEnabled(!0),this.m_useBackKey=!0,this.m_is_ani_layer=!1},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,NOTIFICATION_LOGIN_ANI_END)},onExit:function(){this._super(),MainObserver.getInstance().removeObserver(NOTIFICATION_LOGIN_ANI_END),null!=this.m_bg_img&&(this.m_bg_box.removeChild(this.m_bg_img),this.m_bg_img=null),null!=this.m_bg_label&&(this.m_bg_box.removeChild(this.m_bg_label),this.m_bg_label=null),null!=this.m_back_btn&&(this.m_bg_box.removeChild(this.m_back_btn),this.m_back_btn=null),null!=this.m_back_btn_visible&&(this.m_bg_box.removeChild(this.m_back_btn_visible),this.m_back_btn_visible=null),null!=this.m_bg_text_icon&&(this.m_bg_box.removeChild(this.m_bg_text_icon),this.m_bg_text_icon=null),null!=this.m_bg_box&&(this.removeChild(this.m_bg_box),this.m_bg_box=null)},isAnimationEnd:function(){return null!=this.m_animationLayer&&this.m_animationLayer.isAnimationEnd()},isTodayEnd:function(){return null!=this.m_animationLayer&&this.m_animationLayer.isTodayEnd()},runTomorrowBonus:function(){this.m_animationLayer.runTomorrowBonus()},removeAnimationLayer:function(){null!=this.m_animationLayer&&(this.m_animationLayer.removeFromParent(),this.m_animationLayer=null)}}),NoticeListItem=cc.Layer.extend({click_sprite:null,ctor:function(item){this._super(item),this.initLayout(item)},initLayout:function(item){cc.size(824,78),cc.Rect(13,13,10,10);var bg_list=cc.Sprite.create(RES_CDN_DEFULT+"menu_notice/img_listbar.png");bg_list.setAnchorPoint(ZERO()),bg_list.setPosition(ZERO()),this.addChild(bg_list);var icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_notice/img_notice_"+item.icon_type+".png");icon.setAnchorPoint(ZERO()),icon.setPosition(4,5),bg_list.addChild(icon);var subject_label=cmLabel.getLabel(item.subject,LABEL_FONT_INDEX.FONT_2423+item.subject_color);subject_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),subject_label.enableOutline(cc.color.BLACK,1),subject_label.setPosition(78,ccCenter(bg_list).y),bg_list.addChild(subject_label);var remove_year_dt=moment(item.begin_dt).format("MM/DD HH:mm"),date_label=cmLabel.getLabel(remove_year_dt,LABEL_FONT_INDEX.FONT_2038+item.subject_color);date_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),date_label.enableOutline(cc.color.BLACK,1),date_label.setPosition(ccWidth(bg_list)-10,ccCenter(bg_list).y),bg_list.addChild(date_label);var size2=cc.size(820,78);return this.click_sprite=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero()),this.click_sprite.setPreferredSize(size2),this.click_sprite.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.click_sprite.setPosition(5,ccPosY(subject_label)),this.addChild(this.click_sprite),this.click_sprite.setVisible(!1),this.m_item=item,this.setContentSize(ccSize(bg_list)),!0},onClickItem:function(){this.click_sprite.setVisible(!0)},offClickItem:function(){this.click_sprite.setVisible(!1)},getNoticeItemNum:function(){return this.m_item.num}}),NoticeLayer=cc.Layer.extend({m_notice_list:null,listItemLayers:null,m_bg_box:null,m_listLayer:null,m_bg_img:null,m_bg_title:null,ctor:function(){this._super(),this.m_notice_list=[],this.listItemLayers=[],this.init()},init:function(){return UserService.getInstance().getNoticeList(this.m_notice_list),this.m_notice_list=stable(this.m_notice_list,function(l,r){return moment(r.display_order).valueOf()<moment(l.display_order).valueOf()}),this.initLayout(),!0},initLayout:function(){USE_SP_MAIN_BANNER?(this.m_bg_box=cc.Sprite.create(RES_CDN_DEFULT+"temp_img.png"),this.m_bg_box.setContentSize(960,567),this.m_bg_box.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bg_box.setPosition(ccCenter(this)),this.addChild(this.m_bg_box),this.m_bg_img=cc.Sprite.create(RES_CDN_DEFULT+"banner/img_event_frame_normal.png"),this.m_bg_img.setScale(2),this.m_bg_img.setPosition(ccCenter(this.m_bg_box)),this.m_bg_box.addChild(this.m_bg_img)):(this.m_bg_box=cc.Sprite.create(RES_CDN_DEFULT+"banner/img_event_frame_normal.png"),this.m_bg_box.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bg_box.setPosition(ccCenter(this)),this.addChild(this.m_bg_box)),this.m_bg_title=cmLabel.getLabel("お知らせ",LABEL_FONT_INDEX.FONT_261),this.m_bg_title.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bg_title.setPosition(ccCenter(this.m_bg_box).x,507),this.m_bg_box.addChild(this.m_bg_title),this.m_listLayer=this.getNoticeListLayer(),this.m_listLayer.setPosition(68,66),this.m_bg_box.addChild(this.m_listLayer)},getNoticeListLayer:function(){var listLayer=new VListLayer;return listLayer.setContentSize(824,435),listLayer.setItemCount(this.m_notice_list.length),listLayer.getItemNode=function(index,contentSize,m){var item=this.m_notice_list[index],layer=new cc.Layer,list_item=new NoticeListItem(item);return list_item.setPosition(ZERO()),layer.addChild(list_item),layer.setContentSize(ccSize(list_item)),this.listItemLayers.push(list_item),layer}.bind(this),listLayer.initLayout(),listLayer.onItemTouchBegin=function(index){return this.listItemLayers[index].onClickItem(),!0}.bind(this),listLayer.onItemTouchScrollEnd=function(index){this.listItemLayers[index].offClickItem()}.bind(this),listLayer.onItemTouchMoved=function(){},listLayer.onItemTouchCancel=function(index){this.listItemLayers[index].offClickItem()}.bind(this),listLayer.onItemTouchEnd=function(index){AudioEngine.getInstance().playNormaButtonSound();var layer=this.listItemLayers[index];layer.offClickItem();var req={};req.opcode=net.OP.op_get_notice,req.num=layer.getNoticeItemNum();var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent)}.bind(this),listLayer},onExit:function(){this._super(),this.listItemLayers=[],this.m_notice_list=[],null!=this.m_bg_title&&(this.m_bg_box.removeChild(this.m_bg_title),this.m_bg_title=null),null!=this.m_listLayer&&(this.m_bg_box.removeChild(this.m_listLayer),this.m_listLayer=null),null!=this.m_bg_img&&(this.m_bg_box.removeChild(this.m_bg_img),this.m_bg_img=null),null!=this.m_bg_box&&(this.removeChild(this.m_bg_box),this.m_bg_box=null)}}),NoticeDetailLayer=cc.Layer.extend({m_subject_color:0,m_subject:"",m_content:"",m_banner_type:0,m_webview_layer:null,m_bg_box:null,m_bg_title:null,m_bg_img:null,ctor:function(){this._super()},initLayout:function(num){USE_SP_MAIN_BANNER?(this.m_bg_box=cc.Sprite.create(RES_CDN_DEFULT+"temp_img.png"),this.m_bg_box.setContentSize(960,567),this.m_bg_box.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bg_box.setPosition(ccCenter(this)),this.addChild(this.m_bg_box),this.m_bg_img=cc.Sprite.create(RES_CDN_DEFULT+"banner/img_event_frame_normal.png"),this.m_bg_img.setScale(2),this.m_bg_img.setPosition(ccCenter(this.m_bg_box)),this.m_bg_box.addChild(this.m_bg_img)):(this.m_bg_box=cc.Sprite.create(RES_CDN_DEFULT+"banner/img_event_frame_normal.png"),this.m_bg_box.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bg_box.setPosition(ccCenter(this)),this.addChild(this.m_bg_box)),this.m_bg_title=cmLabel.getLabel("お知らせ",LABEL_FONT_INDEX.FONT_261),this.m_bg_title.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bg_title.setPosition(ccCenter(this.m_bg_box).x,507),this.m_bg_box.addChild(this.m_bg_title);cc.Rect(13,13,13,13);switch(this.m_banner_type){case MAIN_BANNER_JOIN_BONUS:1==GameContext.getInstance().getJoinBonusComlete()&&(this.m_banner_type=0);break;case MAIN_BANNER_RETURN_USER_BONUS:1==GameContext.getInstance().getReturnUserInfo().is_complete&&(this.m_banner_type=0);break;case MAIN_BANNER_EVENT_LOGIN_BONUS:1==GameContext.getInstance().isEventLoginClose(1)&&(this.m_banner_type=0);break;case MAIN_BANNER_WEEK_EVENT_LOGIN_2:1==GameContext.getInstance().isEventLoginClose(2)&&(this.m_banner_type=0);break;case MAIN_BANNER_JADE_SHOP:1==UserService.getInstance().isCompleteJadeFirstBuyAll()&&(this.m_banner_type=0);break;case MAIN_BANNER_NEW_USER_SUPPORT:0!=GameContext.getInstance().getCompleteEvoultionEvent()&&(this.m_banner_type=0);break;case MAIN_BANNER_TYPE_NOTICE:case MAIN_BANNER_GACHA:}this.showWebView(URL_NOTICE+"/notice.aspx?num="+num)},setContents:function(num){this.initLayout(num)},onAnchorClick:function(param1,param2){this.showWebView(param1)},showWebView:function(url){this.m_webview_layer=new cc.LayerColor(cc.color(33,26,33,255)),this.m_webview_layer.setContentSize(810,420),this.m_webview_layer.setPosition(163,110);var webView=new ccui.WebView(url);webView.setAnchorPoint(cc.p(.5,0)),webView.setContentSize(this.m_webview_layer.getContentSize().width,this.m_webview_layer.getContentSize().height),webView.setPosition(cc.p(this.m_webview_layer.getContentSize().width/2,0)),this.m_webview_layer.addChild(webView,1),this.addChild(this.m_webview_layer,1e4)},closeWebView:function(pSender){this.m_webview_layer&&(this.m_webview_layer.getParent().removeChild(this.m_webview_layer),this.m_webview_layer=null)},onExit:function(){this._super(),null!=this.m_bg_title&&(this.m_bg_box.removeChild(this.m_bg_title),this.m_bg_title=null),null!=this.m_bg_img&&(this.m_bg_box.removeChild(this.m_bg_img),this.m_bg_img=null),null!=this.m_bg_box&&(this.removeChild(this.m_bg_box),this.m_bg_box=null),null!=this.m_webview_layer&&(this.m_webview_layer.removeAllChildrenWithCleanup(!0),this.m_webview_layer=null)}}),SPECIAL_VOICE_LOGIN_EVENT_ID=212,LoginBonusAnimationLayer=cc.Layer.extend({m_animation_end:!1,m_is_today_end:!1,m_bonus_icon:null,m_bonus_count_label:null,m_talk_box_label:null,m_talk_box:null,m_login_id:0,m_tm_bonus_item_list:[],m_jegalryang_gacha_res:[],m_bonus_icon_layer:null,m_login_bonus:null,m_jegalryang_sp:null,ctor:function(){this._super()},setItemInfo:function(loginBonus,tm_bonus_item_list){this.m_login_bonus=loginBonus,this.m_tm_bonus_item_list=tm_bonus_item_list},initLayout:function(login_id){this.m_login_id=login_id;var bg_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",RectZero());if(bg_mask.setAnchorPoint(ZERO()),bg_mask.setPosition(ZERO()),bg_mask.setContentSize(ccSize(this)),this.addChild(bg_mask),6==this.m_login_id){var background=cc.Sprite.create(RES_CDN_DEFULT+"menu_attend/bg_attend_back.png");background.setAnchorPoint(ANCHOR_MIDDLE()),background.setPosition(ccCenter(this)),this.addChild(background);var front=cc.Sprite.create(RES_CDN_DEFULT+"menu_attend/bg_attend_front.png");front.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),front.setPosition(ccCenter(this).x,0),this.addChild(front,1e3)}this.m_bonus_icon_layer=this.getIconEffectLayer(this.m_login_bonus.login_bonus_items),this.m_bonus_icon_layer.setAnchorPoint(ZERO()),this.m_bonus_icon_layer.setPosition(LP(this,190,-33)),this.addChild(this.m_bonus_icon_layer),IS_SP_BROWSER?login_id==SPECIAL_VOICE_LOGIN_EVENT_ID?(this.m_jegalryang_gacha_res.push(RES_CDN_DEFULT+"standing/Jowoon_gacha.json"),this.m_jegalryang_gacha_res.push(RES_CDN_DEFULT+"standing/Jowoon_gacha.atlas"),this.m_jegalryang_gacha_res.push(RES_CDN_DEFULT+"standing/Jowoon_gacha.png"),this.m_jegalryang_gacha_res.push(RES_CDN_DEFULT+"standing/Jowoon_gacha2.png")):this.m_jegalryang_gacha_res.push(RES_CDN_DEFULT+"standing/img_attend_Jegalryang.png"):login_id==SPECIAL_VOICE_LOGIN_EVENT_ID?(this.m_jegalryang_gacha_res.push(RES_CDN_DEFULT+"standing/Jowoon_gacha.json"),this.m_jegalryang_gacha_res.push(RES_CDN_DEFULT+"standing/Jowoon_gacha.atlas"),this.m_jegalryang_gacha_res.push(RES_CDN_DEFULT+"standing/Jowoon_gacha.png"),this.m_jegalryang_gacha_res.push(RES_CDN_DEFULT+"standing/Jowoon_gacha2.png")):(this.m_jegalryang_gacha_res.push(RES_CDN_DEFULT+"standing/Jegalryang_guide.json"),this.m_jegalryang_gacha_res.push(RES_CDN_DEFULT+"standing/Jegalryang_guide.atlas"),this.m_jegalryang_gacha_res.push(RES_CDN_DEFULT+"standing/Jegalryang_guide.png")),resourceLoader(this.m_jegalryang_gacha_res,function(){if(IS_SP_BROWSER)if(login_id==SPECIAL_VOICE_LOGIN_EVENT_ID){this.m_jegalryang_sp=new sp.SkeletonAnimation(RES_CDN_DEFULT+"standing/Jowoon_gacha.json",RES_CDN_DEFULT+"standing/Jowoon_gacha.atlas",.1),this.m_jegalryang_sp.setAnchorPoint(ZERO()),this.m_jegalryang_sp.setPosition(-443,-80),this.addChild(this.m_jegalryang_sp),this.m_jegalryang_sp.setMix("basic","active",.3),this.m_jegalryang_sp.setMix("active","basic",.3),this.m_jegalryang_sp.setAnimation(0,"active",!1),this.m_jegalryang_sp.addAnimation(0,"basic",!0);var move=new cc.MoveTo(.2,LP(this,-88,-80)),delay=new cc.DelayTime(.2),callback=new cc.CallFunc(this.runActionTalkBox,this),seq=new cc.Sequence(move,delay,callback);this.m_jegalryang_sp.runAction(seq)}else{this.m_jegalryang_sp=cc.Sprite.create(RES_CDN_DEFULT+"standing/img_attend_Jegalryang.png"),this.m_jegalryang_sp.setAnchorPoint(ZERO()),this.m_jegalryang_sp.setScale(2),this.m_jegalryang_sp.setAnchorPoint(ZERO()),this.m_jegalryang_sp.setPosition(-443,-2),this.addChild(this.m_jegalryang_sp);move=new cc.MoveTo(.2,LP(this,-88,-2)),delay=new cc.DelayTime(.2),callback=new cc.CallFunc(this.runActionTalkBox,this),seq=new cc.Sequence(move,delay,callback);this.m_jegalryang_sp.runAction(seq)}else if(login_id==SPECIAL_VOICE_LOGIN_EVENT_ID){this.m_jegalryang_sp=new sp.SkeletonAnimation(RES_CDN_DEFULT+"standing/Jowoon_gacha.json",RES_CDN_DEFULT+"standing/Jowoon_gacha.atlas",.1),this.m_jegalryang_sp.setAnchorPoint(ZERO()),this.m_jegalryang_sp.setPosition(-443,-80),this.addChild(this.m_jegalryang_sp),this.m_jegalryang_sp.setMix("basic","active",.3),this.m_jegalryang_sp.setMix("active","basic",.3),this.m_jegalryang_sp.setAnimation(0,"active",!1),this.m_jegalryang_sp.addAnimation(0,"basic",!0);move=new cc.MoveTo(.2,LP(this,-88,-80)),delay=new cc.DelayTime(.2),callback=new cc.CallFunc(this.runActionTalkBox,this),seq=new cc.Sequence(move,delay,callback);this.m_jegalryang_sp.runAction(seq)}else{this.m_jegalryang_sp=new sp.SkeletonAnimation(RES_CDN_DEFULT+"standing/Jegalryang_guide.json",RES_CDN_DEFULT+"standing/Jegalryang_guide.atlas",.1),this.m_jegalryang_sp.setAnchorPoint(ZERO()),this.m_jegalryang_sp.setPosition(-443,-80),this.addChild(this.m_jegalryang_sp),this.m_jegalryang_sp.setMix("basic","active",.3),this.m_jegalryang_sp.setMix("active","basic",.3),this.m_jegalryang_sp.setAnimation(0,"active",!1),this.m_jegalryang_sp.addAnimation(0,"basic",!0);move=new cc.MoveTo(.2,LP(this,-88,-80)),delay=new cc.DelayTime(.2),callback=new cc.CallFunc(this.runActionTalkBox,this),seq=new cc.Sequence(move,delay,callback);this.m_jegalryang_sp.runAction(seq)}}.bind(this));var audio=AudioEngine.getInstance();audio.stopEffectsAll(),audio.playEffect(RES_CDN_SOUND+SND_TYPE+"sound/SE_all_win_popularity.mp3",!1),audio.playEffect(RES_CDN_SOUND+SND_TYPE+"sound/SE_gacha_back.mp3",!1)},getIconEffectLayer:function(bonus_item_list){var layer=new cc.Layer;layer.setContentSize(804,573);for(var list_size=bonus_item_list.size(),i=0;i<bonus_item_list.length;++i){var bonus=bonus_item_list.at(i),back_effect=cc.Sprite.create("#img_attend_effect.png");layer.addChild(back_effect);var pos,action=new cc.RotateBy(1,180),repeat=new cc.RepeatForever(action);if(back_effect.runAction(repeat),bonus.bonus_type==BONUS_TYPE_YUNHEE_FIX)var bonus_icon=new cc.Sprite("#img_reward_"+leadingZeros(bonus.item_id,2)+"_d.png");else bonus_icon=new cc.Sprite("#img_reward_"+leadingZeros(bonus.bonus_type,2)+"_d.png");layer.addChild(bonus_icon),list_size<3?(0==i&&(pos=cc.p(290,352)),1==i&&(pos=cc.p(515,352))):(0==i&&(pos=cc.p(290,398)),1==i&&(pos=cc.p(515,398)),3==list_size?2==i&&(pos=cc.p(403,174)):4==list_size?(2==i&&(pos=cc.p(290,174)),3==i&&(pos=cc.p(515,174))):5==list_size&&(2==i&&(pos=cc.p(290,174)),3==i&&(pos=cc.p(515,174)),4==i&&(pos=cc.p(627,174)))),back_effect.setPosition(pos),bonus_icon.setPosition(pos);var bonus_count_label=cmLabel.getLabel("x "+Number(bonus.bonus_count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_503);bonus_count_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),bonus_count_label.enableOutline(cc.color.BLACK,3),bonus_count_label.setPosition(pos.x,pos.y-120),layer.addChild(bonus_count_label)}return layer},isTodayEnd:function(){return this.m_is_today_end},isAnimationEnd:function(){return this.m_animation_end},runTomorrowBonus:function(){this.m_bonus_icon_layer.removeFromParent(),this.m_bonus_icon_layer=this.getIconEffectLayer(this.m_tm_bonus_item_list),this.m_bonus_icon_layer.setAnchorPoint(cc.p()),this.m_bonus_icon_layer.setPosition(LP(this,190,-33)),this.addChild(this.m_bonus_icon_layer);for(var bonus_names=[],i=0;i<this.m_tm_bonus_item_list.length;i++){var bonus=this.m_tm_bonus_item_list[i],mt_bonsu_type=MasterManager.getInstance().get_BonusType(bonus.bonus_type);if(bonus.bonus_type==BONUS_TYPE_YUNHEE_FIX){var general=MasterManager.getInstance().get_General(bonus.item_id);bonus_names.push_back(general.name)}else bonus_names.push_back(mt_bonsu_type.name)}var bonus_names_size=bonus_names.size();1==bonus_names_size?this.m_talk_box_label.setString(cmString(this.m_login_bonus.tomorrow_text,bonus_names[0])):2==bonus_names_size?this.m_talk_box_label.setString(cmString(this.m_login_bonus.tomorrow_text,bonus_names[0],bonus_names[1])):3==bonus_names_size?this.m_talk_box_label.setString(cmString(this.m_login_bonus.tomorrow_text,bonus_names[0],bonus_names[1],bonus_names[2])):4==bonus_names_size?this.m_talk_box_label.setString(cmString(this.m_login_bonus.tomorrow_text,bonus_names[0],bonus_names[1],bonus_names[2],bonus_names[3])):5==bonus_names_size&&this.m_talk_box_label.setString(cmString(this.m_login_bonus.tomorrow_text,bonus_names[0],bonus_names[1],bonus_names[2],bonus_names[3],bonus_names[4])),cmLabel.autoSizeFit(this.m_talk_box_label,480,24),MainObserver.getInstance().postNotification(NOTIFICATION_LOGIN_ANI_END,0),this.m_animation_end=!0;var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_all_win_popularity.mp3";if(audio.playEffect(path),this.m_login_id==SPECIAL_VOICE_LOGIN_EVENT_ID){var sndpath=RES_CDN_SOUND+SND_TYPE+"voice_etc/ruo_vd_0065.mp3";audio.playVoice(sndpath)}},runActionTalkBox:function(){cc.Rect(32,32,48,64);var boxSize=cc.size(506,138);this.m_talk_box=cc.Scale9Sprite.create("img_attend_talkbox.png",RectZero()),this.m_talk_box.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_talk_box.setPosition(LP(this,273,594)),this.addChild(this.m_talk_box),null!=this.m_tm_bonus_item_list.length&&0!=this.m_tm_bonus_item_list.length||(MainObserver.getInstance().postNotification(NOTIFICATION_LOGIN_ANI_END,0),this.m_animation_end=!0);for(var bonus_names=[],i=0;i<this.m_login_bonus.login_bonus_items.length;i++){var bonus=this.m_login_bonus.login_bonus_items[i],mt_bonsu_type=MasterManager.getInstance().get_BonusType(bonus.bonus_type);if(bonus.bonus_type==BONUS_TYPE_YUNHEE_FIX){var general=MasterManager.getInstance().get_General(bonus.item_id);bonus_names.push_back(general.name)}else bonus_names.push_back(mt_bonsu_type.name)}var bonus_names_size=bonus_names.size();this.m_talk_box_label=null,this.m_talk_box_label=2<bonus_names_size?cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2051):cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2422),1==bonus_names_size?this.m_talk_box_label.setString(cmString(this.m_login_bonus.today_text,bonus_names[0])):2==bonus_names_size?this.m_talk_box_label.setString(cmString(this.m_login_bonus.today_text,bonus_names[0],bonus_names[1])):3==bonus_names_size?this.m_talk_box_label.setString(cmString(this.m_login_bonus.today_text,bonus_names[0],bonus_names[1],bonus_names[2])):4==bonus_names_size?this.m_talk_box_label.setString(cmString(this.m_login_bonus.today_text,bonus_names[0],bonus_names[1],bonus_names[2],bonus_names[3])):5==bonus_names_size&&this.m_talk_box_label.setString(cmString(this.m_login_bonus.today_text,bonus_names[0],bonus_names[1],bonus_names[2],bonus_names[3],bonus_names[4]));var lSize=ccSize(this.m_talk_box_label);if(lSize.width+40>boxSize.width&&(boxSize.width=lSize.width+40),lSize.height+40>boxSize.height&&(boxSize.height=lSize.height+40),this.m_talk_box.setPreferredSize(boxSize),this.m_talk_box_label.setAnchorPoint(ANCHOR_MIDDLE()),this.m_talk_box_label.setPosition(ccCenter(this.m_talk_box).x,ccCenter(this.m_talk_box).y+7),this.m_talk_box.addChild(this.m_talk_box_label),this.m_is_today_end=!0,this.m_login_id==SPECIAL_VOICE_LOGIN_EVENT_ID){var sndpath=RES_CDN_SOUND+SND_TYPE+"voice_etc/ruo_vd_0070.mp3";AudioEngine.getInstance().playVoice(sndpath)}},onExit:function(){this._super(),null!=this.m_jegalryang_sp&&(this.removeChild(this.m_jegalryang_sp),IS_SP_BROWSER||(this.m_jegalryang_sp._skeleton.data.animations=[],this.m_jegalryang_sp._skeleton.data.bones=[],this.m_jegalryang_sp._skeleton.data.events=[],this.m_jegalryang_sp._skeleton.data.slots=[],this.m_jegalryang_sp._skeleton.data.skins=[],this.m_jegalryang_sp._skeleton.slots=[],this.m_jegalryang_sp._spineComplete=null,this.m_jegalryang_sp._skeleton=null),this.m_jegalryang_sp=null),this.m_jegalryang_gacha_res.forEach(function(url){cc.loader.release(url)}),this.m_bonus_icon_layer.removeAllChildrenWithCleanup(!0)}}),LoginBonusLayer=cc.Layer.extend({m_is_ani_layer:!1,m_is_banner_click:!1,m_useBackKey:!1,m_tmrr_bonus_type:0,m_tmrr_bonus_cnt:0,m_tmrr_item_id:0,m_animationLayer:null,m_tableLayer:null,m_back_btn:null,m_back_btn_visible:null,m_login_bonus_list:[],m_bg_box:null,m_bg_title:null,m_bg_label:null,m_bg_text_icon:null,m_bg_img:null,ctor:function(){this.init(),this._super()},init:function(){return this.m_login_bonus_list=[],UserService.getInstance().getLoginBonusInfo(LOGIN_BONUS_TYPE_NORMAL,this.m_login_bonus_list),this.m_gameObserver=MainObserver.getInstance(),this.m_login_bonus_list.sort(function(l,r){return l.login_count>r.login_count?1:l.login_count<r.login_count?-1:0}),!0},initLayout:function(is_banner_click){this.m_is_banner_click=is_banner_click;GameContext.getInstance().getLoginBonus({}),USE_SP_MAIN_BANNER?(this.m_bg_box=cc.Sprite.create(RES_CDN_DEFULT+"temp_img.png"),this.m_bg_box.setContentSize(960,567),this.m_bg_box.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bg_box.setPosition(ccCenter(this)),this.addChild(this.m_bg_box),this.m_bg_img=cc.Sprite.create(RES_CDN_DEFULT+"banner/img_event_frame_normal.png"),this.m_bg_img.setScale(2),this.m_bg_img.setPosition(ccCenter(this.m_bg_box)),this.m_bg_box.addChild(this.m_bg_img)):(this.m_bg_box=cc.Sprite.create(RES_CDN_DEFULT+"banner/img_event_frame_normal.png"),this.m_bg_box.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bg_box.setPosition(ccCenter(this)),this.addChild(this.m_bg_box)),this.m_bg_title=cmLabel.getLabel("出席チェック",LABEL_FONT_INDEX.FONT_261),this.m_bg_title.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),this.m_bg_title.setPosition(ccCenter(this.m_bg_box).x,507),this.m_bg_box.addChild(this.m_bg_title),this.m_back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_back_btn.setPosition(ccWidth(this.m_bg_box)-9,ccHeight(this.m_bg_box)-26),this.m_back_btn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_MainHomeScene],NOTIFY_LOGIN_BONUS_HIDE)}.bind(this)),this.m_bg_box.addChild(this.m_back_btn),this.m_useBackKey=!1,this.m_back_btn.setEnabled(!1),this.m_back_btn_visible=cc.Sprite.create("#btn_cancel_off.png"),this.m_back_btn_visible.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_back_btn_visible.setPosition(ccWidth(this.m_bg_box)-9,ccHeight(this.m_bg_box)-26),this.m_bg_box.addChild(this.m_back_btn_visible),this.m_tableLayer=this.getTableLayer(),this.m_tableLayer.setEnableMouseScroll(!1),this.m_tableLayer.setPosition(64,74),this.m_bg_box.addChild(this.m_tableLayer),this.m_bg_label=cmLabel.getLabel("出席報酬はメールで支給され、毎日午前４時に更新されます",LABEL_FONT_INDEX.FONT_1614),this.m_bg_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_bg_label.setPosition(ccWidth(this.m_bg_box)-75,42),this.m_bg_box.addChild(this.m_bg_label),this.m_bg_text_icon=cc.Sprite.create("#img_attend_text.png"),this.m_bg_text_icon.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_bg_text_icon.setPosition(ccPosX(this.m_bg_label)-ccWidth(this.m_bg_label)-10,34),this.m_bg_box.addChild(this.m_bg_text_icon)},getTableLayer:function(){var tableLayer=new TableViewLayer;return tableLayer.setContentSize(826,419),tableLayer.setColumnCount(7),tableLayer.setItemCount(this.m_login_bonus_list.length),tableLayer.getItemNode=function(index,contentSize,m){var bonus=this.m_login_bonus_list[index];return this.getBonusItemLayer(bonus)}.bind(this),tableLayer.initLayout(),tableLayer.setTouchScrollEnabled(!1),tableLayer.onItemTouchBegin=function(index){return!0},tableLayer.onItemTouchMoved=function(){},tableLayer.onItemTouchEnd=function(index){return!0},tableLayer},getBonusItemLayer:function(bonus){var user_login_bonus=GameContext.getInstance().getLoginBonus(),layer=new cc.Layer,icon=cc.Sprite.create("#img_attend_"+bonus.bonus_type+".png");icon.setAnchorPoint(ZERO()),icon.setPosition(0,9),layer.addChild(icon);for(var i=0;i<bonus.login_bonus_items.length;i++){var item=bonus.login_bonus_items[i],frame=cc.spriteFrameCache.getSpriteFrame(cmString("img_attend_%d.png",item.bonus_type));icon.setSpriteFrame(frame);var login_count_label=cmLabel.getLabel(bonus.login_count,LABEL_FONT_INDEX.FONT_161);login_count_label.setAnchorPoint(ANCHOR_TOP_LEFT()),login_count_label.setPosition(10,ccHeight(icon)-10),icon.addChild(login_count_label);var count_label=cmLabel.getLabel("x"+Number(bonus.bonus_count).toLocaleString("en"),LABEL_FONT_INDEX.FONT_1810);count_label.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),count_label.setPosition(ccCenter(icon).x,10),icon.addChild(count_label)}if(layer.setContentSize(ccWidth(icon)+23,ccHeight(icon)+9),bonus.login_count<=user_login_bonus.login_count){var confirm_sprite=cc.Sprite.create("#img_attend_finish.png");if(confirm_sprite.setAnchorPoint(ANCHOR_MIDDLE()),confirm_sprite.setPosition(ccCenter(icon)),icon.addChild(confirm_sprite),bonus.login_count==user_login_bonus.login_count)if(this.m_is_banner_click)this.m_back_btn.setEnabled(!0),this.m_useBackKey=!0;else{this.m_is_ani_layer=!0,this.m_today_login_bonus=bonus,confirm_sprite.setOpacity(0),confirm_sprite.setScale(2),user_login_bonus.login_count<this.m_login_bonus_list.length?this.m_tm_bonus_item_list=this.m_login_bonus_list[user_login_bonus.login_count].login_bonus_items:this.m_tm_bonus_item_list=this.m_login_bonus_list[0].login_bonus_items;var callbackSound=new cc.CallFunc(this.confirmEffectSound,this),callbackEnd=new cc.CallFunc(this.effectEnd,this);confirm_sprite.runAction(new cc.Sequence(new cc.DelayTime(.4),new cc.Spawn(callbackSound,new cc.FadeIn(.3),new cc.ScaleTo(.3,1)),new cc.DelayTime(.2),callbackEnd)),this.m_useBackKey=!0}}return layer},effectEnd:function(){this.m_animationLayer=new LoginBonusAnimationLayer,this.m_animationLayer.setItemInfo(this.m_today_login_bonus,this.m_tm_bonus_item_list),this.m_animationLayer.initLayout(LOGIN_BONUS_TYPE_NORMAL),this.addChild(this.m_animationLayer)},confirmEffectSound:function(){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_attendance.mp3";audio.playEffect(path)},onNotification:function(){this.m_back_btn.setEnabled(!0),this.m_useBackKey=!0,this.m_is_ani_layer=!1},isAnimationEnd:function(){return null!=this.m_animationLayer&&this.m_animationLayer.isAnimationEnd()},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,NOTIFICATION_LOGIN_ANI_END)},onExit:function(){MainObserver.getInstance().removeObserver(NOTIFICATION_LOGIN_ANI_END),this._super(),null!=this.m_bg_img&&(this.m_bg_box.removeChild(this.m_bg_img),this.m_bg_img=null),null!=this.m_bg_title&&(this.m_bg_box.removeChild(this.m_bg_title),this.m_bg_title=null),null!=this.m_back_btn&&(this.m_bg_box.removeChild(this.m_back_btn),this.m_back_btn=null),null!=this.m_back_btn_visible&&(this.m_bg_box.removeChild(this.m_back_btn_visible),this.m_back_btn_visible=null),null!=this.m_tableLayer&&(this.m_bg_box.removeChild(this.m_tableLayer),this.m_tableLayer=null),null!=this.m_bg_label&&(this.m_bg_box.removeChild(this.m_bg_label),this.m_bg_label=null),null!=this.m_bg_text_icon&&(this.m_bg_box.removeChild(this.m_bg_text_icon),this.m_bg_text_icon=null),null!=this.m_bg_box&&(this.removeChild(this.m_bg_box),this.m_bg_box=null)},isTodayEnd:function(){return null!=this.m_animationLayer&&this.m_animationLayer.isTodayEnd()},runTomorrowBonus:function(){this.m_animationLayer.runTomorrowBonus()},removeAnimationLayer:function(){null!=this.m_animationLayer&&(this.m_animationLayer.removeFromParent(),this.m_animationLayer=null)}}),message_item_info_popup_hide=2200,battle_dungeon_continue_show_popup=2201,battle_dungeon_continue_show_popup_raid=2202,battle_dungeon_continue_cancel=2203,battle_dungeon_continue_confirm=2204,btn_premium_login_info=2206,TAG_BEGINNER_BOOSTER_BTN=101,MainHomeScene=GameScene.extend({m_mainLayer:null,m_itemBoxModalLayer:null,m_notify_index:0,m_main_home_box:null,m_is_shop_click:!1,m_premiumLoginBonusInfoModalLayer:null,m_gameObserver:null,m_progres_bar:null,m_gachaResultModalLayer:null,m_is_check_reward_mail:!1,m_banner_type:0,m_premium_login_bonus:{},m_new_user_generals:null,m_beginnerBoosterInfoModalLayer:null,m_raid_boss_btn:null,m_new_raid_icon:null,m_period:null,m_first_period_idx:0,m_second_period_idx:0,m_is_prv_event_dungeon:!1,m_resources_ItemBox:null,m_resources_beginnerBooster:null,ctor:function(){if(this.m_new_user_generals=[],this._super(scene_MainHomeScene),null!=R_WorldWarCharResource){for(var idx=0;idx<R_WorldWarCharResource.length;idx++)cc.loader.release(R_WorldWarCharResource[idx]);R_WorldWarCharResource=[]}if(null!=R_WorldWarMainResource){for(idx=0;idx<R_WorldWarMainResource.length;idx++)cc.loader.release(R_WorldWarMainResource[idx]);R_WorldWarMainResource=[]}},init:function(){this.m_sceneId=scene_MainHomeScene,this.initLayoutProgress2(),this._super(),YUNHEE_PREV_SCENE=!1,SHORTCUT_PREV_SCENE=!1,PREV_MISSION=!1,GameContext.getInstance().setAchvReceived(!1),this.m_gameObserver=MainObserver.getInstance(),this.m_mainLayer=new MainLayer(this),this.m_mainLayer.initLayout(),this.addChild(this.m_mainLayer);var service=EventDungeonService.getInstance(),m=MasterManager.getInstance(),event_dungeon_period_idx=0;this.m_is_prv_event_dungeon=BattleContext._getInstance().getIsPrvEventDungeon(),event_dungeon_period_idx=this.m_is_prv_event_dungeon?BattleContext._getInstance().getPrvEventDungeonPeriodIdx():BattleContext._getInstance().getEventDungeonPeriodIdx(),this.m_period=m.get_EventDungeonPeriod(event_dungeon_period_idx),this.m_first_period_idx=service.getEventDungeonFirstHalfPeriodIdx(this.m_period.event_dungeon_group_idx),this.m_second_period_idx=service.getEventDungeonSecondHalfPeriodIdx(this.m_period.event_dungeon_group_idx);var statusLayer=new StatusLayer(INVOKER_TYPE.home);statusLayer.ignoreAnchorPointForPosition(!1),statusLayer.setAnchorPoint(ANCHOR_TOP_RIGHT()),statusLayer.setPosition(ccWidth(this),ccHeight(this)),this.addChild(statusLayer,100);var title=cc.Sprite.create(RES_CDN_DEFULT+"menu_main/img_main_text.png");title.setAnchorPoint(ZERO()),title.setPosition(30,578),this.addChild(title,100);for(var mt=MasterManager.getInstance(),btn_y=(m=MasterTable.getInstance(),10),user_infos=(new NetService).get_user_shop_buy_info().user_shop_buy_info,shop_list=(mt=MasterManager.getInstance(),ShopService.getInstance().getShopList()),is_luck_btn=!0,idx=0;idx<shop_list.length;idx++)if(shop_list[idx].shop_type==SHOP_TYPE_EVENT){if("Y"==shop_list[idx].display_yn){var shop_period={};ShopService.getInstance().getShopPeriod(shop_list[idx].sell_period_group,shop_period);var nn=TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME).valueOf(),bt=moment(shop_period.beg_dt),et=moment(shop_period.end_dt),bb=bt.valueOf(),ee=et.valueOf();if(nn<bb||ee<nn){is_luck_btn=!1;break}if(0==user_infos.length){is_luck_btn=!0;break}for(var id=0;id<user_infos.length;id++)if(user_infos[id].shop_id==shop_list[idx].shop_id){if("n"==user_infos[id].buy_enable_yn){is_luck_btn=!1;break}if(user_infos[id].buy_count<shop_list[idx].max_buy_count){is_luck_btn=!0;break}}else is_luck_btn=!0;break}is_luck_btn=!1}if(1==is_luck_btn){var off="",on="";on=LUCKY_BOX_GNRL_CHOICE_TICKET?(off="btn_shop_luck_off.png","btn_shop_luck_on.png"):(off="btn_shop_luck_2_off.png","btn_shop_luck_2_on.png");var luck_btn=new ccui.Button(off,on,"",ccui.Widget.PLIST_TEXTURE);luck_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),luck_btn.setPosition(ccWidth(this),btn_y),this.addChild(luck_btn),luck_btn.addClickEventListener(function(sender){var scene=new ShopSceneV2;scene.setShopScene(NOTIFY_MENU_SHOP_EVENT),this.initLayoutProgress(),SceneManager.getInstance().replaceScene(scene)}.bind(this)),btn_y+=ccHeight(luck_btn)}var is_premium_login=!1,is_premium_complete=!1,pl_list=m.get_PremiumLoginBonusList([]);for(idx=0;idx<pl_list.length;idx++){for(var pl=pl_list[idx],lb=GameContext.getInstance().getLoginBonus(),jdx=0;jdx<lb.event_login_list.length;jdx++){var l=lb.event_login_list[jdx],n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),login_mng=mt.get_LoginBonusManagement(l.event_login_id,LOGIN_BONUS_TYPE_EVENT);bt=moment(login_mng.beg_dt),et=moment(login_mng.end_dt),bb=bt.valueOf(),ee=et.valueOf();if(bb<=n&&n<=ee&&l.event_login_id==pl.login_id){var max_count=UserService.getInstance().getEventLoginBonusMaxCount(l.event_login_id);if(l.event_login_count<max_count){is_premium_login=!0,this.m_premium_login_bonus=pl;break}is_premium_complete=!0;break}}if(is_premium_login||is_premium_complete);else{n=moment(TimeEventEngine.getInstance().getTime(TIME_EVENT_SERVER_TIME)).valueOf(),bb=moment(pl.beg_dt).valueOf(),ee=moment(pl.end_dt).valueOf();if(bb<=n){if(n<=ee){is_premium_login=!0,this.m_premium_login_bonus=pl;break}continue}}}if(is_premium_login){var premium_login_btn=new ccui.Button("btn_main_premium_off.png","btn_main_premium_on.png","",ccui.Widget.PLIST_TEXTURE);premium_login_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),premium_login_btn.setPosition(ccWidth(this),btn_y),this.addChild(premium_login_btn),premium_login_btn.addClickEventListener(function(sender){var lb=GameContext.getInstance().getLoginBonus(),info={event_login_id:0,event_login_count:0,event_bonus_yn:!1,sort_num:0};info.event_login_id=this.m_premium_login_bonus.login_id;for(var idx=0;idx<lb.event_login_list.length;idx++){var l=lb.event_login_list[idx];if(l.event_login_id==this.m_premium_login_bonus.login_id){info=l;break}}this.showEventLoginBonus(info,!0)}.bind(this)),btn_y+=ccHeight(premium_login_btn)}var btn_y_pos=ccHeight(this)-55;if(RaidBossService.getInstance().IsOpenRaidBoss()){this.m_raid_boss_btn=new ccui.Button,this.m_raid_boss_btn.loadTextures("btn_raid_off.png","btn_raid_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_raid_boss_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_raid_boss_btn.setPosition(ccWidth(this),btn_y_pos),this.addChild(this.m_raid_boss_btn),this.m_raid_boss_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_RAID_BOSS_ENTRANCE)}.bind(this));var fire=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/ui_fx_raid_fire.json",RES_CDN_DEFULT+"effect/ui_fx_raid_fire.atlas",1);fire.setAnchorPoint(ANCHOR_MIDDLE()),fire.setPosition(ccWidth(this.m_raid_boss_btn)/2+fire._contentSize.width/2,ccHeight(this.m_raid_boss_btn)/2+fire._contentSize.height/2),fire.setAnimation(0,"fx_1",!0),this.m_raid_boss_btn.addChild(fire),this.m_new_raid_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_raid.png"),this.m_new_raid_icon.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_new_raid_icon.setPosition(10,ccHeight(this.m_raid_boss_btn)-10),this.m_raid_boss_btn.addChild(this.m_new_raid_icon);var is_new=!1;"y"==NetService()._event_dungeon_open_period_info.raid_boss_exist_yn&&(is_new=!0),this.m_new_raid_icon.setVisible(is_new),btn_y_pos-=108}if(UserService.getInstance().isBeginnerBooster()){var beginner_booster_btn=new ccui.Button("btn_buff_off.png","btn_buff_on.png","",ccui.Widget.PLIST_TEXTURE);beginner_booster_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),beginner_booster_btn.setTag(TAG_BEGINNER_BOOSTER_BTN),beginner_booster_btn.setPosition(ccWidth(this),btn_y_pos),this.addChild(beginner_booster_btn),beginner_booster_btn.addClickEventListener(function(sender){var req={};req.opcode=net.OP.op_user_check_beginner_booster,this.network_write(req)}.bind(this)),btn_y_pos-=108}this.checkCampUpgrade();var gameObserver=MainObserver.getInstance();return gameObserver.addObserver(this.onNotifyConsumeGoods,this,NOTIFICATION_CONSUME_GOODS),gameObserver.addObserver(this.notifyMainNoticeCheck,this,NOTIFICATION_MAIN_NOTICE_LIST),gameObserver.addObserver(this.onNotifyConsumeGoods,this,NOTIFICATION_BUY_GOODS),this.m_itemBoxModalLayer=new GameModalLayer,this.addChild(this.m_itemBoxModalLayer,1e3),BattleContext._getInstance().setGameType(db.BattleGameType.None),this.m_main_home_box=new GameMessageBox,this.addChild(this.m_main_home_box,110001),this.m_gachaResultModalLayer=new GameModalLayer,this.addChild(this.m_gachaResultModalLayer,1e4),this.m_premiumLoginBonusInfoModalLayer=new GameModalLayer,this.addChild(this.m_premiumLoginBonusInfoModalLayer,1e5),this.m_beginnerBoosterInfoModalLayer=new GameModalLayer,this.addChild(this.m_beginnerBoosterInfoModalLayer,1e5),this.scheduleOnce(this.removeProgressEnd,.5),!0},removeProgressEnd:function(){this.removeLayerProgress2()},onKeyBack:function(released){},onNotification:function(msg){switch(this._super(msg),msg){case NOTIFY_MENU_YUNHEE:this.initLayoutProgress2(),(req={}).opcode=net.OP.op_get_user_general,this.network_write(req);break;case NOTIFY_MENU_BOOKS:this.initLayoutProgress2(),(req={}).opcode=net.OP.op_get_user_book,this.network_write(req);break;case NOTIFY_MENU_ACHIEV:this.initLayoutProgress2(),(req={}).opcode=net.OP.op_get_user_achievement,this.network_write(req);break;case NOTIFY_MENU_ACHIEV_LOAD:this.onShowTestScene(scene_AchievementScene);break;case NOTIFY_MENU_MAIL_LOAD:this.onShowTestScene(scene_MailScene_V2);break;case NOTIFY_MENU_FRIEND:this.initLayoutProgress2(),(req={}).opcode=net.OP.op_get_user_game_friends,this.network_write(req);break;case NOTIFY_MENU_STORY:this.initLayoutProgress2();var scene=new StorySceneV2,sceneManager=SceneManager.getInstance();scene.get_story_deferred().done(function(){this.scheduleOnce(function(dt){sceneManager.replaceScene(scene,!0)},1.5,"main_layer_ready")}.bind(this));break;case NOTIFY_MENU_WORLD_WAR:this.initLayoutProgress2(),this.goWorldWar();break;case NOTIFY_MENU_MAIL:this.initLayoutProgress2(),(req={}).opcode=net.OP.op_get_user_mail,this.network_write(req);break;case NOTIFY_MENU_HOME_SHOP:this.initLayoutProgress2(),this.m_is_shop_click=!0,(req={}).opcode=net.OP.op_get_user_shop_jade_first_buy_info,this.network_write(req);break;case NOTIFY_MENU_LOGIN_BONUS:this.showLoginBonusLayer(!0);break;case NOTIFY_MENU_NOTICE:this.initLayoutProgress_circle(),(req={}).opcode=net.OP.op_get_notice_list,this.network_write(req);break;case NOTIFY_MENU_HELP:scene=new HelpScene;(sceneManager=SceneManager.getInstance()).replaceScene(scene,!0);break;case NOTIFY_MENU_CAMP:this.initLayoutProgress();scene=new CampScene;(sceneManager=SceneManager.getInstance()).replaceScene(scene,!0);break;case NOTIFY_MENU_MUSSANG:this.initLayoutProgress();scene=new MussangEntryScene;(sceneManager=SceneManager.getInstance()).replaceScene(scene,!0);break;case NOTIFY_MENU_QUEST:this.initLayoutProgress2(),(req={}).opcode=net.OP.op_get_user_mussang,this.network_write(req);break;case NOTIFY_MENU_ITEM_BOX:this.initLayoutProgress2(0),this.m_resources_ItemBox=[],USE_SHORTCUT_EVOLUTION_ICON?(this.m_resources_ItemBox.push(RES_CDN_DEFULT+"icon/shortcut_evolution/"+SHORTCUT_EVOLUTION_TEXTURE+".plist"),this.m_resources_ItemBox.push(RES_CDN_DEFULT+"icon/shortcut_evolution/"+SHORTCUT_EVOLUTION_TEXTURE+".png")):(this.m_resources_ItemBox.push(RES_CDN_DEFULT+"icon/evolve_small/"+ICON_EVOLVE_SMALL_TEXTURE+".plist"),this.m_resources_ItemBox.push(RES_CDN_DEFULT+"icon/evolve_small/"+ICON_EVOLVE_SMALL_TEXTURE+".png"),this.m_resources_ItemBox.push(RES_CDN_DEFULT+"icon/formation/"+FORMATION_TEXTURE+".plist"),this.m_resources_ItemBox.push(RES_CDN_DEFULT+"icon/formation/"+FORMATION_TEXTURE+".png")),resourceLoader(this.m_resources_ItemBox,function(){USE_SHORTCUT_EVOLUTION_ICON?cc.spriteFrameCache.addSpriteFrames(RES_CDN_DEFULT+"icon/shortcut_evolution/"+SHORTCUT_EVOLUTION_TEXTURE+".plist"):(cc.spriteFrameCache.addSpriteFrames(RES_CDN_DEFULT+"icon/evolve_small/"+ICON_EVOLVE_SMALL_TEXTURE+".plist"),cc.spriteFrameCache.addSpriteFrames(RES_CDN_DEFULT+"icon/formation/"+FORMATION_TEXTURE+".plist")),this.showItemBox(),this.removeLayerProgress2()}.bind(this));break;case already_tutorial:break;case battle_dungeon_continue_show_popup:this.showBattleDungeonContinue();break;case battle_dungeon_continue_show_popup_raid:NetService().Load_User_Troops_General();this.showBattleDungeonContinue(!1);break;case battle_dungeon_continue_cancel:this.reqBattleDungeonCancel();break;case battle_dungeon_continue_confirm:NetService().Load_User_Troops_General();this.confirmBattleDungeonContinue();break;case btn_premium_login_info:var gnrl_img=[];gnrl_img.push(cmString(RES_CDN_DEFULT+"banner/img_premium_help_text_%d.png",this.m_premium_login_bonus.login_bonus_idx));var sptest=cc.Sprite.create(cmString(RES_CDN_DEFULT+"banner/img_premium_help_text_%d.png",this.m_premium_login_bonus.login_bonus_idx));sptest.setVisible(!1),this.addChild(sptest),cc.loader.load(gnrl_img,function(err,results){cc.log("btn_premum_login_info ??????"),err?cc.log("Failed to load %s.",this.m_gnrl_img):this.showPremiumLoginBonusInfo()}.bind(this));break;case NOTIFY_MENU_DAILY_BONUS:break;case NOTIFY_MENU_GACHA:var req;this.initLayoutProgress2(),(req={}).opcode=net.OP.op_get_user_gacha_ticket,this.network_write(req);case message_new_raid_boss:var is_new=!1;"y"==(new NetService)._event_dungeon_open_period_info.raid_boss_exist_yn&&(is_new=!0),null!=this.m_new_raid_icon&&this.m_new_raid_icon.setVisible(is_new)}return!0},onShowTestScene:function(scene_id){var scene=this.replace_scene(scene_id,scene_id);SceneManager.getInstance().replaceScene(scene,!0)},reqBattleDungeonCancel:function(){var req={};req.opcode=net.OP.op_cancel_battle_dungeon_continue,this.network_write(req)},confirmBattleDungeonContinue:function(){var battle_dungeon_type=(netService=new NetService).get_battle_dungeon_continue().battle_dungeon_type,context=BattleContext._getInstance(),gameDefault=GameDefault.getInstance();if(context.setBattleDungeonContinue(!0),battle_dungeon_type==BATTLE_DUNGEON_TYPE_STORY){if(context.setGameType(db.BattleGameType.Mission),context.setMissionID(netService.get_battle_dungeon_continue().value1),context.setBeforeBattleUserInfo(),context.setDungeonDropItemCount(netService.get_battle_dungeon_continue().drop_items),0<netService.get_battle_dungeon_continue().frnd_gnrl.gnrl_id){var friend_general=$.extend({},database.BattleGeneral);(service=BattleService.getInstance()).getFriendGeneral(netService.get_battle_dungeon_continue().frnd_gnrl,friend_general),context.setFriendPartnerGeneral(friend_general);var gnrl_keys={gnrl_id:netService.get_battle_dungeon_continue().frnd_gnrl.gnrl_id,gnrl_num:netService.get_battle_dungeon_continue().frnd_gnrl.gnrl_level};context.setFriendInfo(netService.get_battle_dungeon_continue().frnd_id,gnrl_keys)}GameDefault.getInstance().setUserTroopsNum(NetService().get_battle_dungeon_continue().troops_num);var scene=new BattleSceneLayer;SceneManager.getInstance().replaceScene(scene)}else if(battle_dungeon_type==BATTLE_DUNGEON_TYPE_WEEKLY){context.setGameType(db.BattleGameType.WeeklyDungeon);var dungeon_list=[];BattleService.getInstance().getMasterWeeklyDungeon(dungeon_list);for(var is_exist=!1,idx=0;idx<dungeon_list.length;idx++){var w=dungeon_list[idx];if(w.weekly_idx==netService.get_battle_dungeon_continue().value1)for(var jdx=0;jdx<w.weekly_difficulty.length;jdx++){if((d=w.weekly_difficulty[jdx]).weekly_difficulty.dungeon_idx==netService.get_battle_dungeon_continue().value2){context.setWeeklyDungeonData(w);var dungeon=d;BattleService.getInstance().getMasterWeeklyDungeonStageNpc(dungeon),context.setWeeklyDungeonDifficulty(dungeon),is_exist=!0;break}}}if(is_exist){GameDefault.getInstance().setUserWeeklyTroopsNum(netService.get_battle_dungeon_continue().troops_num),context.setBeforeBattleUserInfoByTroops(netService.get_battle_dungeon_continue().troops_num),context.setDungeonDropItemCount(netService.get_battle_dungeon_continue().drop_items);scene=new BattleSceneLayer;SceneManager.getInstance().replaceScene(scene)}}else if(battle_dungeon_type==BATTLE_DUNGEON_TYPE_MUSSANG){context.setGameType(db.BattleGameType.Mussang),context.setMussangId(netService.get_battle_dungeon_continue().value1),context.setMussangPeriodGroupIdx(netService.get_battle_dungeon_continue().value2),gameDefault.setUserMussangTroopsNum(netService.get_battle_dungeon_continue().troops_num),context.setBeforeBattleUserInfoByTroops(netService.get_battle_dungeon_continue().troops_num);scene=new BattleSceneLayer;SceneManager.getInstance().replaceScene(scene)}else if(battle_dungeon_type==BATTLE_DUNGEON_TYPE_EVENT_DUNGEON){context.setGameType(db.BattleGameType.EventDungeon);var service=BattleService.getInstance(),list=[],event_dungeon_open_period=(is_exist=!1,netService._event_dungeon_open_period_info.event_dungeon_open_period);for(idx=0;idx<event_dungeon_open_period.length;idx++){if((event_dungeon_period_idx=event_dungeon_open_period[idx].event_dungeon_period_idx)==NetService().get_battle_dungeon_continue().value2&&EventDungeonService.getInstance().IsOpenDungeon(NetService().get_battle_dungeon_continue().value2)){GameDefault.getInstance().setUserEventDungeonTroopsNum(NetService().get_battle_dungeon_continue().troops_num),context.setEventDungeonPeriodIdX(event_dungeon_period_idx);dungeon=new database.BattleEventDungeon;if(service.getUserEventDungeon(NetService().get_battle_dungeon_continue().value2,NetService().get_battle_dungeon_continue().value1,dungeon),service.getMasterEventDungeonNpcInfo(dungeon),dungeon.cutin_stage=NetService().get_battle_dungeon_continue().value3,dungeon.event_dungeon_cutin_info_idx=NetService().get_battle_dungeon_continue().value4,0!=dungeon.cutin_stage){dungeon.cutin_info=MasterManager.getInstance().get_EventDungeonCutinInfo(dungeon.event_dungeon_cutin_info_idx),service.changeEventDungeonCutinStage(dungeon.cutin_stage,dungeon.event_dungeon_cutin_info_idx,dungeon.stage_npc),context.setEventDungeonCutinStage(dungeon.cutin_stage),context.setEVentDungeonCutinComplete(!1);var drop_items=[];drop_items.push_back(1),drop_items.push_back(0),drop_items.push_back(0),context.setDungeonDropItemCount(drop_items)}if(context.setEventDungeonData(dungeon),context.setBeforeBattleUserInfoByTroops(NetService().get_battle_dungeon_continue().troops_num),context.setLastEventDungeonId(dungeon.event_dungeon.event_dungeon_idx),0<NetService().get_battle_dungeon_continue().frnd_gnrl.gnrl_id){friend_general=$.extend({},database.BattleGeneral);(service=BattleService.getInstance()).getFriendGeneral(NetService().get_battle_dungeon_continue().frnd_gnrl,friend_general),context.setFriendPartnerGeneral(friend_general);var gnrl_key={};gnrl_key.gnrl_id=NetService().get_battle_dungeon_continue().frnd_gnrl.gnrl_id,gnrl_key.gnrl_num=NetService().get_battle_dungeon_continue().frnd_gnrl.gnrl_level,context.setFriendInfo(NetService().get_battle_dungeon_continue().frnd_id,gnrl_key)}is_exist=!0;break}}if(is_exist){scene=new BattleSceneLayer;SceneManager.getInstance().replaceScene(scene)}else NetService().clearBattleDungeonContinue(),MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],battle_dungeon_continue_cancel),this.scheduleOnce(function(){this.showErrorMessage(MasterManager.getInstance().get_LanguageData("label_already_finished_event_dungeon"))}.bind(this),0,"showErrorMessage")}else if(battle_dungeon_type==BATTLE_DUNGEON_TYPE_ONCE_A_DAY_DUNGEON){context.setGameType(db.BattleGameType.OnceADayDungeon);for(is_exist=!1,service=BattleService.getInstance(),event_dungeon_open_period=netService._event_dungeon_open_period_info.event_dungeon_open_period,idx=0;idx<event_dungeon_open_period.length;idx++){var event_dungeon_period_idx;if((event_dungeon_period_idx=event_dungeon_open_period[idx].event_dungeon_period_idx)==NetService().get_battle_dungeon_continue().value2&&EventDungeonService.getInstance().IsOpenDungeon(NetService().get_battle_dungeon_continue().value2)){GameDefault.getInstance().setUserOnceADayDungeonTroopsNum(NetService().get_battle_dungeon_continue().troops_num);dungeon=new database.BattleEventOnceADayDungeon;service.getUserEventDungeonOnceADay(NetService().get_battle_dungeon_continue().value2,NetService().get_battle_dungeon_continue().value1,dungeon),service.getMasterEventDungeonOnceADayNpcInfo(dungeon),context.setEventOnceADayDungeonData(dungeon),context.setBeforeBattleUserInfoByTroops(NetService().get_battle_dungeon_continue().troops_num),is_exist=!0,GameContext.getInstance().setSubDungeonType(NetService().get_battle_dungeon_continue().value3);break}}if(is_exist){scene=new BattleSceneLayer;SceneManager.getInstance().replaceScene(scene)}else NetService().clearBattleDungeonContinue(),MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],battle_dungeon_continue_cancel),this.scheduleOnce(function(){this.showErrorMessage(MasterManager.getInstance().get_LanguageData("label_already_finished_event_dungeon"))}.bind(this),0,"showErrorMessage")}else if(battle_dungeon_type==BATTLE_DUNGEON_TYPE_DAILY_DUNGEON){context.setGameType(db.BattleGameType.DailyDungeon);for(service=DailyDungeonService.getInstance(),list=[],is_exist=!1,idx=0;idx<netService.get_daily_dungeon_open_period_info().daily_dungeon_open_period.length;idx++){var daily_dungeon_period_idx=netService.get_daily_dungeon_open_period_info().daily_dungeon_open_period[idx].daily_dungeon_period_idx;list=service.getUserDailyDungeonList(daily_dungeon_period_idx);for(jdx=0;jdx<list.length;jdx++){var d;if((d=list[jdx]).daily_dungeon.daily_dungeon_idx==netService.get_battle_dungeon_continue().value1&&d.daily_dungeon.daily_dungeon_period_idx==netService.get_battle_dungeon_continue().value2){gameDefault.setUserDailyDungeonTroopsNum(netService.get_battle_dungeon_continue().troops_num),context.setDailyDungeonPeriodIdx(daily_dungeon_period_idx),context.setDailyDungeonData(d),context.setBeforeBattleUserInfoByTroops(netService.get_battle_dungeon_continue().troops_num),context.setLastDailyDungeonId(d.daily_dungeon.daily_dungeon_idx),is_exist=!0;break}}if(is_exist)break}if(is_exist){scene=new BattleSceneLayer;SceneManager.getInstance().replaceScene(scene)}}else if(battle_dungeon_type==BATTLE_DUNGEON_TYPE_RAID_BOSS){(req={}).opcode=net.OP.op_raid_boss_battle_check,req.discovered_user_id=NetService().get_battle_dungeon_continue().frnd_id,req.raid_boss_period_idx=NetService().get_battle_dungeon_continue().value1,req.raid_boss_num=NetService().get_battle_dungeon_continue().value2,req.troops_num=GameDefault.getInstance().getUserRaidBossTroopsNum(),this.network_write(req)}else if(battle_dungeon_type==BATTLE_DUNGEON_TYPE_GREAT_WALL){var netService=new NetService;(req={}).opcode=net.OP.op_great_wall_dungeon_continue_check,req.great_wall_dungeon_period_idx=netService.get_battle_dungeon_continue().value3,req.great_wall_dungeon_group_idx=netService.get_battle_dungeon_continue().value2,req.great_wall_dungeon_idx=netService.get_battle_dungeon_continue().value1,req.troops_num=netService.get_battle_dungeon_continue().troops_num,this.network_write(req)}else if(battle_dungeon_type==BATTLE_DUNGEON_TYPE_EVENT_MUSSANG_BOSS){netService=new NetService;(req={}).opcode=net.OP.op_event_dungeon_mussang_boss_continue_check,req.boss_dungeon_idx=netService.get_battle_dungeon_continue().value1,req.event_dungeon_period_idx=netService.get_battle_dungeon_continue().value2,this.network_write(req)}else if(battle_dungeon_type==BATTLE_DUNGEON_TYPE_EVENT_RAID){var req;(req={}).opcode=net.OP.op_event_raid_continue_check,req.event_dungeon_period_idx=NetService().get_battle_dungeon_continue().value2,req.event_raid_dungeon_idx=NetService().get_battle_dungeon_continue().value1,req.boss_num=NetService().get_battle_dungeon_continue().value3,req.multiple_type=NetService().get_battle_dungeon_continue().value5,req.troops_num=NetService().get_battle_dungeon_continue().troops_num,this.network_write(req)}},showBattleDungeonContinue:function(is_use_cancel){this.m_box.setTitle("戦闘再開"),this.m_box.setText("中断された戦闘があります。"),this.m_box.setText("\n"),this.m_box.setText("戦闘を再開しますか。"),null==is_use_cancel&&(is_use_cancel=!0),is_use_cancel&&this.m_box.addButtonInfo(new MessageButtonInfo("いいえ",MessageBoxButtonType.ButtonTypeRed,0,function(){this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(battle_dungeon_continue_cancel)},0,"battle_dungeon_continue_cancel"),this.m_box.hide()}.bind(this))),this.m_box.addButtonInfo(new MessageButtonInfo("はい",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.initLayoutProgress2(),MainObserver.getInstance().postNotification(battle_dungeon_continue_confirm)},0,"battle_dungeon_continue_confirm"),this.m_box.hide()}.bind(this))),this.m_box.show()},showBuyJadeOmission:function(count){m_main_home_box.is_show()&&m_main_home_box.hide(!1),m_main_home_box.setTitle(res_str(label_shop_buy_jade_omission_title));m_main_home_box.getFormater();m_main_home_box.setNotification(this.getNotification()),btnOK.click=function(info){this.scheduleOnce(function(float){postNotification(NOTIFY_MENU_MAIL)},0,"go_to_mail"),m_main_home_box.hide()},m_main_home_box.addButtonInfo(btnOK),m_main_home_box.show()},showItemBox:function(){this.m_itemBoxModalLayer.setContentSize(ccSize(this)),this.m_itemBoxModalLayer._contentNode=function(contentsSize,m){var layer=new EvolutionMtrlBoxLayer,back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);return back_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),back_btn.setPosition(ccCenter(layer).x+465,550),back_btn.addClickEventListener(function(sender){this.scheduleOnce(function(float){this.m_itemBoxModalLayer.hide(),this.releaseItemBoxRes()}.bind(this),0,"back_btn")}.bind(this)),layer.addChild(back_btn,100),layer}.bind(this),this.m_itemBoxModalLayer.show()},releaseItemBoxRes:function(){if(USE_SHORTCUT_EVOLUTION_ICON?(cc.spriteFrameCache.removeSpriteFramesFromFile(RES_CDN_DEFULT+"icon/shortcut_evolution/"+SHORTCUT_EVOLUTION_TEXTURE+".plist"),delete cc.spriteFrameCache._frameConfigCache[RES_CDN_DEFULT+"icon/shortcut_evolution/"+SHORTCUT_EVOLUTION_TEXTURE+".plist"]):(cc.spriteFrameCache.removeSpriteFramesFromFile(RES_CDN_DEFULT+"icon/evolve_small/"+ICON_EVOLVE_SMALL_TEXTURE+".plist"),delete cc.spriteFrameCache._frameConfigCache[RES_CDN_DEFULT+"icon/evolve_small/"+ICON_EVOLVE_SMALL_TEXTURE+".plist"],cc.spriteFrameCache.removeSpriteFramesFromFile(RES_CDN_DEFULT+"icon/formation/"+FORMATION_TEXTURE+".plist"),delete cc.spriteFrameCache._frameConfigCache[RES_CDN_DEFULT+"icon/formation/"+FORMATION_TEXTURE+".plist"]),null!=this.m_resources_ItemBox){for(var i=0;i<this.m_resources_ItemBox.length;i++)cc.loader.release(this.m_resources_ItemBox[i]);this.m_resources_ItemBox=null}},onNetworkEvent:function(opcode,state,body){switch(cc.log("MainHomeScene::onNetworkEvent - opcode is "+opcode),cc.log("MainHomeScene::onNetworkEvent - body "+body.toString()),opcode){case net.OP.op_unification_all_check:break;case net.OP.op_get_user_game_friends:GameContext.getInstance().setFriendSceneTap(GameContext.tap_game_friend);var scene=new MyFriendScene;SceneManager.getInstance().replaceScene(scene);break;case net.OP.op_relogin:break;case net.OP.op_get_notice_list:this.removeLayerProgress_circle(),0!=this.m_new_user_generals.length?this.scheduleOnce(function(float){this.showGachaResultLayer()},.1,"showGachaResultLayer"):this.showNoticeLayer();break;case net.OP.op_get_notice:case net.OP.op_get_notice_v2:this.showNoticeDetailLayer(body.notice.num);break;case net.OP.op_get_user_general:TutorialContextV2.getInstance().IsCompleteAllTutorial()||GameDefault.getInstance().setUserTroopsNum(1),GameContext.getInstance().setElementTypeFilter(100),GameContext.getInstance().setYunheeTypeFilter(100),GameContext.getInstance().setYunheeTabType(1),GameContext.getInstance().setYunheePrevSceneId(scene_MainHomeScene),(scene=new YunheeScene).get_story_deferred().done(function(){this.scheduleOnce(function(dt){YUNHEE_PREV_SCENE=!0,SceneManager.getInstance().replaceScene(scene)},YUNHEE_DELAY_TIME,"main_layer_ready")}.bind(this));break;case net.OP.op_get_user_event_dungeon_satisfaction_info:(req={}).opcode=net.OP.op_event_dungeon_search_area_info,req.event_dungeon_period_idx=BattleContext._getInstance().getEventDungeonPeriodIdx(),this.network_write(req);break;case net.OP.op_event_dungeon_search_area_info:scene=new EventDungeonSatisfactionEntranceScene;SceneManager.getInstance().replaceScene(scene,!0);break;case net.OP.op_get_user_achievement:var achv_id=GameContext.getInstance().getSelectAchvIndex(),achv_type=AchievementService.getInstance().getAchvType(achv_id);if(GameContext.getInstance().setSelectAchvIndex(101001),achv_type==ACHIEVEMENT_EVENTDUNGEON||achv_type==ACHIEVEMENT_EVENTDUNGEON_2ND||achv_type==ACHIEVEMENT_EVENTDUNGEON_3RD||achv_type==ACHIEVEMENT_EVENTDUNGEON_DAILY){if(0==BattleContext._getInstance().getEventDungeonPeriodIdx()){var event_dungeon_period_idx=AchievementService.getInstance().getValidAchvEventDungeonInfo(achv_id);0!=event_dungeon_period_idx&&BattleContext._getInstance().setEventDungeonPeriodIdX(event_dungeon_period_idx)}scene=new EventDungeonAchievementScene;SceneManager.getInstance().replaceScene(scene)}else if(GameContext.getInstance().getAchievementTap()==ACHIEVEMENT_EVENTDUNGEON||GameContext.getInstance().getAchievementTap()==ACHIEVEMENT_EVENTDUNGEON_2ND||GameContext.getInstance().getAchievementTap()==ACHIEVEMENT_EVENTDUNGEON_3RD||GameContext.getInstance().getAchievementTap()==ACHIEVEMENT_EVENTDUNGEON_DAILY){scene=new EventDungeonAchievementScene;SceneManager.getInstance().replaceScene(scene)}else{AchievementService.getInstance().loadUserAchievement(1),MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_ACHIEV_LOAD)}break;case net.OP.op_get_user_mail:MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_MAIL_LOAD);break;case net.OP.op_get_add_user_mail:if(!this.m_is_check_reward_mail){scene=new MailScene_V2;SceneManager.getInstance().replaceScene(scene)}this.m_is_check_reward_mail=!1;break;case net.OP.op_get_user_mussang:scene=new QuestEntryScene;SceneManager.getInstance().replaceScene(scene);break;case net.OP.op_update_social_friend:case net.OP.op_is_social_user:case net.OP.op_complete_tutorial:break;case net.OP.op_get_user_book:scene=new BooksScene;SceneManager.getInstance().replaceScene(scene,!0);break;case net.OP.op_update_user_config_v2:break;case net.OP.op_raid_boss_battle_check:if("y"==body.battle_continue_clear_yn)(msg=[]).push(res_str("label_raid_boss_already_anybody_cleared_msg_1")),msg.push(res_str("label_raid_boss_already_anybody_cleared_msg_2")),this.showMsgBox(msg),msg=null,NetService().clearBattleDungeonContinue();else 0!=NetService().get_battle_dungeon_continue().troops_num&&GameDefault.getInstance().setUserRaidBossTroopsNum(NetService().get_battle_dungeon_continue().troops_num),GameDefault.getInstance().getUserRaidBossTroopsNum().done(function(num){var service=BattleService.getInstance(),context=BattleContext._getInstance(),dungeon=context.getRaidDungeonData();dungeon.data=body.raid_boss_info,context.setRaidBossData(body.raid_boss_info),context.setBeforeBattleUserInfo(),context.setGameType(db.BattleGameType.RaidDungeon),context.setBeforeBattleUserInfoByTroops(num),service.getRaidDungeonStageNpc(0,dungeon),context.setRaidDungeonData(dungeon),context.setBattleDungeonContinue(!1);var scene=new BattleSceneLayer;SceneManager.getInstance().replaceScene(scene)});break;case net.OP.op_event_dungeon_mussang_boss_continue_check:if("y"==body.battle_yn){var service=BattleService.getInstance(),mussang_boss=(context=BattleContext._getInstance()).getEventMussangBossData();(m=MasterManager.getInstance()).get_EventDungeonMussangBossNpcInfo(mussang_boss.boss_dungeon_idx,0);(dungeon=context.getEventMussangBossDungeonData()).data.event_dungeon_period_idx=body.event_dungeon_period_idx,dungeon.data.boss_dungeon_idx=body.boss_dungeon_idx,dungeon.current_stage=1,dungeon.data.remain_hp=body.remain_hp,context.setGameType(db.BattleGameType.EventMussangBossDungeon),context.setBeforeBattleUserInfoByTroops(body.troops_num),service.getEventMussangBossStageNpc(0,dungeon),context.setEventMussangBossDungeonData(dungeon);scene=new BattleSceneLayer;SceneManager.getInstance().replaceScene(scene)}break;case net.OP.op_great_wall_dungeon_continue_check:if("y"==body.battle_continue_yn){var s=GreatWallService.getInstance();if(0==(great_wall_dungeon_period_idx=body.great_wall_dungeon_period_idx))return void this.reqBattleDungeonCancel();(context=BattleContext._getInstance()).setGameType(db.BattleGameType.GreatWallDungeon);var dungeon=new database.BattleGreatWallDungeon;if(s.getGreatWallDungeon(great_wall_dungeon_period_idx,body.great_wall_dungeon_group_idx,body.great_wall_dungeon_idx,dungeon),0==dungeon.great_wall_dungeon_idx)return void this.reqBattleDungeonCancel();context.setGreatWallDungeonData(dungeon),context.setBeforeGreatWallDungeonUserInfoByTroops(body.troops_num),GameDefault.getInstance().setUserGreatWallTroopsNum(body.troops_num);scene=new BattleSceneLayer;SceneManager.getInstance().replaceScene(scene)}else{(msg=[]).push(MasterManager.getInstance().get_LanguageData("label_great_wall_invalid_entrance_msg")),this.showMsgBox(msg),msg=null,NetService().clearBattleDungeonContinue(),BattleContext._getInstance().setBattleDungeonContinue(!1)}break;case net.OP.op_great_wall_dungeon_info:break;case net.OP.op_great_wall_troops_info:s=GreatWallService.getInstance();var great_wall_dungeon_period_idx,m=MasterManager.getInstance(),netService=new NetService;if(0==(great_wall_dungeon_period_idx=netService.get_battle_dungeon_continue().value3))return void this.reqBattleDungeonCancel();var period=m.get_GreatWallDungeonPeriod(great_wall_dungeon_period_idx),dungeon_list=[];s.getGreatWallDungeonList(period.great_wall_dungeon_period_idx,period.great_wall_dungeon_group_idx,dungeon_list),(context=BattleContext._getInstance()).setGameType(db.BattleGameType.GreatWallDungeon);for(var is_exist=!1,i=0;i<dungeon_list.size();i++){var d=dungeon_list[i];if(d.is_enable&&d.great_wall_dungeon_idx==netService.get_battle_dungeon_continue().value1&&d.great_wall_dungeon_group_idx==netService.get_battle_dungeon_continue().value2){context.setGreatWallDungeonData(d),is_exist=!0;break}}if(is_exist){context.setBeforeGreatWallDungeonUserInfoByTroops(netService.get_battle_dungeon_continue().troops_num);scene=new BattleSceneLayer;SceneManager.getInstance().getRunningScene().m_isPopupShow=!0,SceneManager.getInstance().pushScene(scene)}break;case net.OP.op_user_check_beginner_booster:if("y"==body.complete_yn){var btn=this.getChildByTag(TAG_BEGINNER_BOOSTER_BTN);null!=btn&&(btn.setVisible(!1),GameContext.getInstance().setCompleteBeginnerBooster(-1),USE_POPUP_INTERGRATION?this.showGameScenePopup(res_str("label_beginner_booster_title"),res_str("label_beginner_booster_complete_text_1")):this.showBeginnerBoosterCompleteMsgBox())}else this.initLayoutProgress2(0),this.m_resources_beginnerBooster=[],this.m_resources_beginnerBooster.push(RES_CDN_DEFULT+"icon/begin/"+ICON_BEGIN_TEXTURE+".plist"),this.m_resources_beginnerBooster.push(RES_CDN_DEFULT+"icon/begin/"+ICON_BEGIN_TEXTURE+".png"),resourceLoader(this.m_resources_beginnerBooster,function(){cc.spriteFrameCache.addSpriteFrames(RES_CDN_DEFULT+"icon/begin/"+ICON_BEGIN_TEXTURE+".plist"),this.showBeginnerBoosterInfo(),this.removeLayerProgress2()}.bind(this));break;case net.OP.op_event_raid_continue_check:BattleContext._getInstance().setEventDungeonPeriodIdX(body.event_dungeon_period_idx),(info={}).event_raid_dungeon_idx=body.event_raid_dungeon_idx,BattleContext._getInstance().setEventRaidDungeonData(info),BattleContext._getInstance().setBeforeBattleUserInfoByTroops(body.troops_num),GameDefault.getInstance().setUserEventRaidDungeonTroopsNum(body.troops_num),(_NetService=new NetService).clearBattleDungeonContinue();scene=new BattleSceneLayer;SceneManager.getInstance().replaceScene(scene);break;case net.OP.op_great_wall_dungeon_continue_check:var _NetService;(context=BattleContext._getInstance()).setBattleDungeonContinue(!1),(_NetService=new NetService).getInstance().clearBattleDungeonContinue();break;case net.OP.op_shop_buy_jade_omission:case net.OP.op_shop_buy_jade_complete:break;case net.OP.op_shop_buy_gacha_ticket_omission:"y"==res.success_yn&&this.showGachaTicketBuyComplete(g_buyResult.goods_id);break;case net.OP.op_shop_buy_gacha_ticket_complete:break;case net.OP.op_shop_buy_general:this.m_new_user_generals=res.new_user_generals;break;case net.OP.op_shop_buy_gacha_ticket_omission:case net.OP.op_shop_buy_gacha_11_omission:case net.OP.op_shop_buy_gacha_11_complete:break;case net.OP.op_coupon_reward_receive:this.showCouponError(body.coupon_status);break;case net.OP.op_current_booster_event:case net.OP.op_auto_play_mission_info_v2:case net.OP.op_auto_play_mission_continue:case net.OP.op_check_upgrade_user_camp_branch_ability:case net.OP.op_check_upgrade_user_camp_arbeit_v2:case net.OP.op_get_user_camp_branch_ability:case net.OP.op_change_nickname:break;case net.OP.op_cancel_battle_dungeon_continue:var context;(context=GameContext.getInstance()).getNoticeEnabled()&&this.scheduleOnce(function(float){this.showNoticeLayer()},.1,"showNoticeLayer___");break;case net.OP.op_purchase_proc_error_log:break;case net.OP.op_event_dungeon_open_period_info:if("y"==body.raid_boss_reward_mail_yn){var max_num=NetService().getUserMailMaxNum();if(0==max_num)(req={}).opcode=net.OP.op_get_add_user_mail,req.user_mail_max_num=max_num,this.network_write(req),this.m_is_check_reward_mail=!0}if(RaidBossService.getInstance().IsOpenRaidBoss()){var is_new=!1;"y"==NetService()._event_dungeon_open_period_info.raid_boss_exist_yn&&(is_new=!0),this.m_new_raid_icon.setVisible(is_new)}break;case net.OP.op_get_user_shop_jade_first_buy_info:scene=new ShopSceneV2;var isExistShopEvent=ShopService.getInstance().isExsitShopEvent(),shopList=(m=MasterTable.getInstance()).get_Shops(),event_shop_id=0;if(isExistShopEvent){for(var shop in shopList)if(shopList[shop].shop_type==SHOP_TYPE_EVENT&&"Y"==shopList[shop].display_yn){event_shop_id=shopList[shop].shop_id;break}if(this.m_is_shop_click)if(NOT_USE_SHOP_BUY_LOG_PARSING){for(var is_buy=!0,user_infos=_NetService.get_user_shop_buy_info().user_shop_buy_info,idx=0;idx<user_infos.length;idx++)if(event_shop_id==user_infos[idx].shop_id&&"n"==user_infos[idx].buy_enable_yn){is_buy=!1;break}is_buy?scene.setShopScene(NOTIFY_MENU_SHOP_EVENT):scene.setShopScene(NOTIFY_MENU_SHOP)}else{var info;(info=GameDefault.getInstance().getUserBuy_Key(event_shop_id)).is_buy?scene.setShopScene(NOTIFY_MENU_SHOP):scene.setShopScene(NOTIFY_MENU_SHOP_EVENT)}else scene.setShopScene(NOTIFY_MENU_SHOP)}else scene.setShopScene(NOTIFY_MENU_SHOP);SceneManager.getInstance().replaceScene(scene);break;case net.OP.op_get_user_daily_bonus:break;case net.OP.op_get_world_war_season_info:if(WorldWarService.getInstance().getCurrentPeriodType()==WORLD_WAR_PERIOD_NONE){var msg;(msg=[]).push_back(res_str("world_war_home_warning_btn")),this.showMsgBox(res_str("label_preparation_title"),msg),msg=null}else{this.m_mainLayer.refreshWorldWarButton();scene=new WorldWarMainScene;SceneManager.getInstance().replaceScene(scene)}break;case net.OP.op_get_user_gacha_ticket:if(0==NOT_USE_SHOP_BUY_LOG_PARSING){var infos=NetService().get_user_shop_buy_info();GameDefault.getInstance().setUserBuyInit(infos)}var req;(req={}).opcode=net.OP.op_get_shop_gacha_period_info,this.network_write(req);break;case net.OP.op_get_shop_gacha_period_info:scene=new GachaScene_WebV2(!0,this.m_banner_type);SceneManager.getInstance().replaceScene(scene),scene=null}},showGachaResultLayer:function(){this.m_gachaResultModalLayer.setContentSize(ccSize(this)),this.m_gachaResultModalLayer._contentNode=function(contentSize,m){return this.getGachaResultLayer()},this.m_gachaResultModalLayer.show()},showPremiumLoginBonusInfo:function(){this.m_premiumLoginBonusInfoModalLayer.setContentSize(ccSize(this)),this.m_premiumLoginBonusInfoModalLayer._contentNode=function(contentSize,m){return this.getPremiumLoginBonusInfoLayer()}.bind(this),this.m_premiumLoginBonusInfoModalLayer.show()},getPremiumLoginBonusInfoLayer:function(){var layer=new cc.Layer,bg_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",cc.rect(0,0,0,0));bg_mask.setPosition(ccCenter(this)),bg_mask.setContentSize(ccSize(this)),layer.addChild(bg_mask);var bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",RectZero());bg.setInsetLeft(44),bg.setInsetRight(44),bg.setInsetTop(44),bg.setInsetBottom(44),bg.setPreferredSize(cc.size(958,555)),bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(this)),layer.addChild(bg);var navi=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_navi.png",RectZero());navi.setInsetLeft(46),navi.setInsetRight(46),navi.setPreferredSize(cc.size(942,48)),navi.setAnchorPoint(ANCHOR_MIDDLE_TOP()),navi.setPosition(ccCenter(bg).x,ccHeight(bg)-11),bg.addChild(navi);var title_label=cmLabel.getLabel(res_str("label_premium_login_bonus_info_detail_title"),LABEL_FONT_INDEX.FONT_241);title_label.setAnchorPoint(ANCHOR_MIDDLE()),title_label.setPosition(ccCenter(navi)),navi.addChild(title_label);var back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE);back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),back_btn.setPosition(ccWidth(bg)-10,ccHeight(bg)-10),back_btn.addClickEventListener(function(sender){this.m_premiumLoginBonusInfoModalLayer.hide()}.bind(this)),bg.addChild(back_btn);var scrollLayer=new ScrollLayer;return scrollLayer.setContentSize(918,474),scrollLayer.setPosition(21,16),scrollLayer.getItemNode=function(contentSize,m){var img=cc.Sprite.create(cmString(RES_CDN_DEFULT+"banner/img_premium_help_text_%d.png",this.m_premium_login_bonus.login_bonus_idx));return USE_SP_MAIN_BANNER&&(img.setScale(2),img.setContentSize(918,874)),img}.bind(this),scrollLayer.initLayout(),bg.addChild(scrollLayer),layer},getGachaResultCardLayer:function(){var layer=new cc.Layer;layer.setContentSize(cc.size(688,260));for(var index=0,idx=0;idx<this.m_new_user_generals.length;idx++){var gnrl=this.m_new_user_generals[idx],isNew="y"==gnrl.is_new_yn,general=GeneralService.getInstance().getGeneral(gnrl.gnrl_id,general),cardInfo={};cardInfo.gnrl_id=gnrl.gnrl_id,cardInfo.level=1;var card_sprite=this.getResultThumb(cardInfo,isNew);card_sprite.setAnchorPoint(ZERO()),layer.addChild(card_sprite,10),index<6?card_sprite.setPosition(index*(ccWidth(card_sprite)+20),0):card_sprite.setPosition(59+(index-6)*(ccWidth(card_sprite)+20),162),index++}var callback=new cc.CallFunc(this.newSpriteEffectCallback,this);return this.runAction(cc.sequence(cc.delayTime(.5),callback)),layer},getGachaResultLayer:function(){var layer=new cc.Layer,bg=cc.Sprite.create("gacha_effect/gacha_bg_ready.png");bg.setAnchorPoint(ANCHOR_MIDDLE()),bg.setPosition(ccCenter(this)),USE_SP_YUNHEE_SCALE&&bg.setScale(2),layer.addChild(bg),this.m_new_sprites=[];var result_title=cc.Sprite.create(RES_CDN_DEFULT+"menu_main/bg_state_title.png");result_title.setAnchorPoint(ANCHOR_TOP_LEFT()),result_title.setPosition(0,ccHeight(this)),layer.addChild(result_title);var result_text=cc.Sprite.create("#img_gacha_text_result.png");result_text.setAnchorPoint(ZERO()),result_text.setPosition(30,66),USE_SP_YUNHEE_SCALE&&result_text.setScale(2),result_title.addChild(result_text);var resultCardLayer=this.getGachaResultCardLayer();resultCardLayer.ignoreAnchorPointForPosition(!1),resultCardLayer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),resultCardLayer.setPosition(ccCenter(this).x,220),layer.addChild(resultCardLayer);var end_btn=new ccui.Button("btn_purple_circle_ok_off.png","btn_purple_circle_ok_on.png","",ccui.Widget.PLIST_TEXTURE);return end_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),end_btn.setPosition(ccWidth(this)-10,10),end_btn.addClickEventListener(function(sender){this.scheduleOnce(function(float){this.showNoticeLayer()},.1,"show_notice_layer_"),this.m_new_user_generals=[],this.m_gachaResultModalLayer.hide()}.bind(this)),layer.addChild(end_btn),layer},getResultThumb:function(card_info,isNew){var sprite=(new Card).createCard(card_info,CARD_TYPE.type_common_card);if(isNew){var new_sprite=cc.Sprite.create();new_sprite.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),new_sprite.setPosition(ccCenter(sprite).x,ccHeight(sprite)),sprite.addChild(new_sprite),this.m_new_sprites.push(new_sprite)}return sprite},newSpriteEffectCallback:function(){for(var idx=0;idx<this.m_new_sprites.length;idx++){var sprite=this.m_new_sprites[idx];if(NOT_USE_SP_MAIN_ANIMATION){sprite.setScale(2),sprite.setTexture(RES_CDN_DEFULT+"gacha_effect/gacha_effect_sprite/result_new_1.png");var fadeIn=new cc.FadeOut(.7),fadeOut=new cc.FadeIn(.7,90),seq=new cc.Sequence(fadeIn,fadeOut);repeat=new cc.RepeatForever(seq);sprite.runAction(repeat),repeat=seq=fadeOut=fadeIn=null}else{var animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.GachaNewGeneral),repeat=cc.repeatForever(animate);sprite.runAction(repeat)}}},showBeginnerBoosterInfo:function(){this.m_beginnerBoosterInfoModalLayer.setContentSize(ccSize(this)),this.m_beginnerBoosterInfoModalLayer._contentNode=function(contentSize,m){return this.getBeginnerBoosterInfoLayer()}.bind(this),this.m_beginnerBoosterInfoModalLayer.onItemTouchBegin=function(){return!0}.bind(this),this.m_beginnerBoosterInfoModalLayer.onItemTouchEnd=function(){if(null!=this.m_beginnerBoosterInfoModalLayer&&(this.m_beginnerBoosterInfoModalLayer.hide(),cc.spriteFrameCache.removeSpriteFramesFromFile(RES_CDN_DEFULT+"icon/begin/"+ICON_BEGIN_TEXTURE+".plist"),delete cc.spriteFrameCache._frameConfigCache[RES_CDN_DEFULT+"icon/begin/"+ICON_BEGIN_TEXTURE+".plist"],null!=this.m_resources_beginnerBooster)){for(var i=0;i<this.m_resources_beginnerBooster.length;i++)cc.loader.release(this.m_resources_beginnerBooster[i]);this.m_resources_beginnerBooster=null}}.bind(this),this.m_beginnerBoosterInfoModalLayer.show()},getBeginnerBoosterInfoLayer:function(){var layer=new cc.Layer,bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_13.png",RectZero());bg.setContentSize(cc.size(460,245)),bg.setInsetBottom(25),bg.setInsetLeft(25),bg.setInsetRight(25),bg.setInsetTop(25),bg.setAnchorPoint(ANCHOR_TOP_RIGHT()),bg.setPosition(ccWidth(this)-81,ccHeight(this)-55-108-44),layer.addChild(bg);var beginner_booster={};if(beginner_booster=UserService.getInstance().getUserBeginnerBooster(beginner_booster),UserService.getInstance().getUserBeginnerBooster()){MasterTable.getInstance().getMasterTable();for(var booster_infos=MasterTable.getInstance().get_BeginnerBoosters(),y_pos=41,idx=(booster_infos.keys(),0);idx<booster_infos.length;idx++){var booster=booster_infos.at(idx),booster_detail_layer=new cc.Layer;booster_detail_layer.setAnchorPoint(ANCHOR_TOP_LEFT()),booster_detail_layer.setPosition(12,ccHeight(bg)-y_pos);var icon=cc.Sprite.create("#begin_0"+booster.image+".png");icon.setAnchorPoint(ZERO()),icon.setPosition(ZERO()),booster_detail_layer.addChild(icon);var info_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());info_bg.setInsetLeft(13),info_bg.setInsetRight(13),info_bg.setInsetTop(13),info_bg.setInsetBottom(13),info_bg.setPreferredSize(cc.size(408,28)),info_bg.setAnchorPoint(ZERO),info_bg.setPosition(ccWidth(icon),0),booster_detail_layer.addChild(info_bg);var booster_text=cmLabel.getLabel(booster.content,LABEL_FONT_INDEX.FONT_165);booster_text.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),booster_text.setPosition(8,ccCenter(info_bg).y),info_bg.addChild(booster_text),bg.addChild(booster_detail_layer),y_pos+=33}var until_text_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box_9.png",RectZero());until_text_bg.setInsetLeft(13),until_text_bg.setInsetRight(13),until_text_bg.setInsetTop(13),until_text_bg.setInsetBottom(13),until_text_bg.setPreferredSize(cc.size(436,54)),until_text_bg.setAnchorPoint(ZERO()),until_text_bg.setPosition(12,13),bg.addChild(until_text_bg);MasterManager.getInstance().get_CountFunction(26);var deadline_dt=beginner_booster.deadline_dt.replace(/\-/g,".");deadline_dt=deadline_dt.trim();var until_label_2=cmLabel.getLabel(deadline_dt+"まで利用可能",LABEL_FONT_INDEX.FONT_161);until_label_2.setAnchorPoint(ZERO()),until_label_2.setPosition(13,20),until_text_bg.addChild(until_label_2)}return layer},onNetworkConnect:function(){},onNetworkShutdown:function(){},checkCampUpgrade:function(){var campService=CampService.getInstance(),campBranch={},campCost={},campArbeit={};campService.getUserCamp(campBranch,1),campService.getUserCamp(campCost,2),campService.getUserCamp(campArbeit,3);var gameContext=GameContext.getInstance();gameContext.setCampBranchLevel(campBranch.camp_level),gameContext.setCampCostLevel(campCost.camp_level),gameContext.setCampArbeitLevel(campArbeit.camp_level)},notifyMainBanner:function(sender){var banner_index=sender,banner=MasterTable.getInstance().getMasterTable().get_Banner(banner_index);this.m_banner_type=banner.banner_type;var notice=UserService.getInstance().getNoticeByBanner(banner.banner_type);if(0!=notice.num&&0!=banner.banner_type)return(req={}).opcode=net.OP.op_get_notice,req.num=notice.num,void this.network_write(req);if(banner.rolling_banner_move_type==ROLLING_BANNER_TYPE_NEW_USER_LOGIN)this.showJoinBonusLayer(!0);else if(banner.rolling_banner_move_type==ROLLING_BANNER_TYPE_RETURN_USER_LOGIN)this.showReturnUserBonusLayer(!0);else if(banner.rolling_banner_move_type==ROLLING_BANNER_TYPE_EVENT_LOGIN){for(var lb=GameContext.getInstance().getLoginBonus(),info={},idx=0;idx<lb.event_login_list.length;idx++){var l=lb.event_login_list[idx];if(info=$.extend({},l),l.event_login_id==banner.rolling_banner_move_path){this.showEventLoginBonus(info,!0);break}}if(banner.rolling_banner_move_path==this.m_premium_login_bonus.login_id)(info={event_login_id:0,event_login_count:0,sort_num:0}).event_login_id=this.m_premium_login_bonus.login_id,this.showEventLoginBonus(info,!0)}else if(banner.rolling_banner_move_type==ROLLING_BANNER_TYPE_POPUP_BANNER){var bi={},banner_info=NetService().get_Popup_Banner_Info().banner_info;for(idx=0;idx<banner_info.length;idx++){var b=banner_info[idx];if(b.banner_idx==banner.rolling_banner_move_path){bi.img_path=b.img_path,bi.banner_idx=b.banner_idx,bi.banner_type=b.banner_type;break}}this.showPopupBanner(bi,!0)}else if(banner.rolling_banner_move_type==ROLLING_BANNER_TYPE_NOTICE_DETAIL){if(0!=banner.rolling_banner_move_path)(req={}).opcode=net.OP.op_get_notice_v2,req.display_order=banner.rolling_banner_move_path,this.network_write(req)}else if(banner.banner_type==MAIN_BANNER_MUSSANG_TOWER){var scene=new TowerEntranceScene;SceneManager.getInstance().replaceScene(scene,!0)}else if(banner.banner_type==MAIN_BANNER_GREAT_WALL_DUNGEON)MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_GREAT_WALL_DUNGEON_ENTRANCE);else if(banner.banner_type==MAIN_BANNER_EVENT_DUNGEON){if(0!=banner.rolling_banner_move_path){if(this.m_period=MasterManager.getInstance().get_EventDungeonPeriod(banner.rolling_banner_move_path),0==this.m_period.event_dungeon_period_idx)return;BattleContext._getInstance().setEventDungeonPeriodIdX(banner.rolling_banner_move_path),MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_EVENT_DUNGEON_ENTRANCE)}}else if(banner.banner_type==MAIN_BANNER_TYPE_MARATHON){(req={}).opcode=net.OP.op_event_dungeon_open_period_info,this.network_write(req)}else if(banner.banner_type==MAIN_BANNER_TYPE_NOTICE)MainObserver.getInstance().postNotification(NOTIFY_MENU_NOTICE);else if(banner.banner_type==MAIN_BANNER_GACHA)this.initLayoutProgress(),MainObserver.getInstance().postNotification(NOTIFY_MENU_GACHA_JADE);else if(banner.banner_type==MAIN_BANNER_JADE_SHOP){this.initLayoutProgress(),this.m_is_shop_click=!1,(req={}).opcode=net.OP.op_get_user_shop_jade_first_buy_info,this.network_write(req)}else if(banner.banner_type==MAIN_BANNER_NEW_YEAR_LUCKY_BOX)this.initLayoutProgress(),MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_HOME_SHOP);else if(banner.banner_type==MAIN_BANNER_EVENT_MISSION)GameContext.getInstance().setAchievementTap(ACHIEVEMENT_EVENTDUNGEON),MainObserver.getInstance().postNotification(NOTIFY_MENU_ACHIEV);else if(banner.banner_type==MAIN_BANNER_DAILY_DUNGEON){var d_period=MasterTable.getInstance().get_DailyDungeonMaxPeriod();BattleContext._getInstance().setDailyDungeonPeriodIdx(d_period.daily_dungeon_period_idx),this.initLayoutProgress(),(scene=new DailyDungeonListScene).get_story_deferred().done(function(){this.scheduleOnce(function(dt){SceneManager.getInstance().replaceScene(scene,!0)},1.5,"main_layer_ready")}.bind(this))}else if(banner.banner_type==MAIN_BANNER_EVENT_SECOND_HALF_GACHA||banner.banner_type==MAIN_BANNER_EVENT_ELEMENT_1_GACHA||banner.banner_type==MAIN_BANNER_EVENT_ELEMENT_2_GACHA||banner.banner_type==MAIN_BANNER_EVENT_ELEMENT_4_GACHA||banner.banner_type==MAIN_BANNER_EVENT_ELEMENT_5_GACHA||banner.banner_type==MAIN_BANNER_DMM_POINT_GACHA||banner.banner_type==MAIN_BANNER_DMM_POINT_GACHA_SECOND||banner.banner_type==MAIN_BANNER_STANDARD_GACHA||banner.banner_type==MAIN_BANNER_DMM_POINT_16_GACHA||banner.banner_type==MAIN_BANNER_JADE_16_GACHA||banner.banner_type==MAIN_BANNER_DMM_POINT_GACHA_THIRD||banner.banner_type==MAIN_BANNER_DMM_POINT_FOURTH||banner.banner_type==MAIN_BANNER_DMM_POINT_FIFTH||banner.banner_type==MAIN_BANNER_STEP_UP_GACHA_DMM_POINT_FIRST||banner.banner_type==MAIN_BANNER_STEP_UP_GACHA_DMM_POINT_SECOND||banner.banner_type==MAIN_BANNER_EXCHANGE_TICKET||banner.banner_type==MAIN_BANNER_SPECIAL_TICKET_GACHA||banner.banner_type==MAIN_BANNER_1_DAY_1_TIME_FREE_GACHA||banner.banner_type==MAIN_BANNER_1_DAY_1_TIME_FREE_GACHA_FIRST||banner.banner_type==MAIN_BANNER_1_DAY_1_TIME_FREE_GACHA_SECOND||banner.banner_type==MAIN_BANNER_1_USER_1_TIME_FREE_GACHA||banner.banner_type==MAIN_BANNER_1_USER_1_TIME_FREE_GACHA_FIRST||banner.banner_type==MAIN_BANNER_1_USER_1_TIME_FREE_GACHA_SECOND){var req;this.initLayoutProgress2(),(req={}).opcode=net.OP.op_get_shop_gacha_period_info,this.network_write(req)}else if(banner.banner_type==MAIN_BANNER_EVENT_CAMP_FACTORY_BANNER){scene=new CampFactoryScene;SceneManager.getInstance().replaceScene(scene)}else if(banner.banner_type==MAIN_BANNER_EVENT_DAILY_DUNGEON_BANNER){(scene=new WeeklyEntryScene).get_story_deferred().done(function(){this.scheduleOnce(function(dt){SceneManager.getInstance().replaceScene(scene,!0)},1.5,"main_layer_ready")}.bind(this))}else if(banner.banner_type==MAIN_BANNER_STORY_7_BANNER||banner.banner_type==MAIN_BANNER_STORY_7_EXP_DOUBLE){scene=new StorySceneV2;this.initLayoutProgress2(0),scene.get_story_deferred().done(function(){this.scheduleOnce(function(dt){this.removeLayerProgress2(),SceneManager.getInstance().replaceScene(scene,!0)},1.5,"main_layer_ready")}.bind(this))}else if(banner.banner_type==MAIN_BANNER_RAID_GACHA)this.initLayoutProgress(),MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_GACHA_RAID);else if(banner.banner_type==MAIN_BANNER_MY_MAIN_GENERAL_INFO){var context=GameContext.getInstance(),parter=context.getUserGeneralPartner(),key={};key.gnrl_id=parter.gnrl_id,key.num=parter.gnrl_num,context.setGeneralKey(key);scene=new YunheeDetailScene;SceneManager.getInstance().replaceScene(scene,!0)}else banner.banner_type==MAIN_BANNER_RAID_DUNGEON?(this.initLayoutProgress(),MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_RAID_BOSS_ENTRANCE)):banner.banner_type==MAIN_BANNER_MUSSANG_BOSS?MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_EVENT_DUNGEON_ENTRANCE):banner.banner_type==MAIN_BANNER_WORLD_WAR&&(this.initLayoutProgress2(),this.goWorldWar())},onTimeEventNotification:function(sender){},onEnterTransitionDidFinish:function(){this._super();var tutorial=TutorialContextV2.getInstance();if(tutorial.IsCompleteAllTutorial()){GameContext.getInstance();tutorial.IsHelpShow()?(GameContext.getInstance().setHelpInfoIndex(0),this.scheduleOnce(function(float){GameContext.getInstance().setNavigationHelp(!0);var scene=new HelpContentScene;SceneManager.getInstance().replaceScene(scene)},.1,"tuto_end_help_show"),tutorial.helpShowComplete()):USE_TUTORIAL_COMPLETE_REWARD&&tutorial.isTutorialCompleteBonusRewards()?this.scheduleOnce(function(float){this.showTutorialCompleteRewardPopup();tutorial.setTutorialCompleteBonusRewards([])}.bind(this),.1,"showTutorialCompleteRewardPopup"):this.reqNoticeAndLoginCheck()}if(this.m_gameObserver.addObserver(this.notifyMainBanner,this,NOTIFICATION_MAIN_BANNER),GameContext.getInstance().setElementTypeFilter(100),GameContext.getInstance().setYunheeTypeFilter(100),GameContext.getInstance().setYunheeTabType(1),USE_HOME_VOICE&&GameContext.getInstance().IsHomeVoice()){var service=GeneralService.getInstance(),partner_gnrl=new db.UserGeneralInfo,partner_key=GameContext.getInstance().getUserGeneralPartner(),gnrl_key=new net.User_General_Key;gnrl_key.gnrl_id=partner_key.gnrl_id,gnrl_key.gnrl_num=partner_key.gnrl_num,service.getUserGnrlDisplayClassInfo(gnrl_key,partner_gnrl);var partner_id=0;partner_id=partner_gnrl.class_type>=AVAIL_EVOLUTION_CLASS_TYPE_LIMIT&&0!=partner_gnrl.display_class&&partner_gnrl.class_type!=partner_gnrl.display_class?partner_gnrl.gnrl_id-1e3*(partner_gnrl.class_type-partner_gnrl.display_class):partner_gnrl.gnrl_id;var r=parseInt(2*Math.random()),voice_type=voice_home_entry_01;1==r&&(voice_type=voice_home_entry_02);var voice=MasterTable.getInstance().get_Voice(partner_id,voice_type,0,0,0).voice;if(""!=voice&&null!=voice&&"0"!=voice){var audio=AudioEngine.getInstance(),snd=RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3";audio.playVoice(snd)}GameContext.getInstance().initHomeVoice()}WorldWarService.getInstance().IsShowNonePeriodPopup()&&this.showWorldWarNonePeriodPopup(),SceneManager.getInstance().sceneClearReplace();var req={};req.opcode=net.OP.op_get_user_join_friends,req.frnd=[],this.network_write(req)},notifyMainNoticeCheck:function(sender){sender==message_main_notice_list_check&&this.scheduleOnce(function(float){this.reqNoticeAndLoginCheck()},.1,"request_notice_and_login_check")},reqNoticeAndLoginCheck:function(){null!=NetService().get_battle_dungeon_continue().battle_dungeon_type&&0!=NetService().get_battle_dungeon_continue().battle_dungeon_type?NetService().get_battle_dungeon_continue().battle_dungeon_type==BATTLE_DUNGEON_TYPE_RAID_BOSS?this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],battle_dungeon_continue_show_popup_raid)},.1,"battle_dungeon_continue_show_popup_raid"):NetService().get_battle_dungeon_continue().battle_dungeon_type==BATTLE_DUNGEON_TYPE_MUSSANG_TOWER?this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],battle_dungeon_continue_cancel)},.1,"battle_dungeon_continue_cancel"):this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],battle_dungeon_continue_show_popup)},.1,"battle_dungeon_continue_show_popup"):GameContext.getInstance().getNoticeEnabled()?0!=this.m_new_user_generals.length?this.scheduleOnce(function(float){this.showGachaResultLayer()},.1,"showGachaResultLayer"):this.scheduleOnce(function(float){this.showNoticeLayer()},.1,"show_notice_layer_"):(this.checkLoginBonus(),this.reqEventDungeonPeriodInfo())},onTutorialEnter:function(step){this.setTutorialStep(step),step.tutorial_page==TUTORIAL_PAGE_1_STORY||step.tutorial_page==TUTORIAL_PAGE_2_LEVEL_UP||step.tutorial_page==TUTORIAL_PAGE_3_LOVE_LEVEL_UP||step.tutorial_page==TUTORIAL_PAGE_4_LOVE_CG||(step.tutorial_page,TUTORIAL_PAGE_5_TROOPS)},onEnter:function(){this._super(),this.playMainBGM(),this.m_gameObserver.addObserver(this.onNotification,this,sceneStr[scene_MainHomeScene]),this.m_gameObserver.addObserver(this.onTimeEventNotification,this,TIME_EVENT_NOTIFICATION),BattleContext._getInstance().setMainMissionV2(null),GameContext.getInstance().setShopLastTabIndex(0),WORLDWAR_SCENE_PLAY=!1},onExit:function(){1!=this.m_isPopupShow?(this.m_gameObserver.removeObserver(),this.m_gameObserver.removeObserver(sceneStr[scene_MainHomeScene]),this.m_gameObserver.removeObserver(NOTIFICATION_MAIN_BANNER),this.m_gameObserver.removeObserver(NOTIFICATION_MAIN_NOTICE_LIST),this.m_gameObserver.removeObserver(NOTIFICATION_CONSUME_GOODS),this.m_gameObserver.removeObserver(NOTIFICATION_BUY_GOODS),this.m_gameObserver.removeObserver(TIME_EVENT_NOTIFICATION),this.removeAllChildrenWithCleanup(!0),this._super(),this.m_mainLayer=null):this.m_isPopupShow=!1},checkConsumeGoods:function(){},onNotifyConsumeGoods:function(sender){this.scheduleOnce(function(float){this.reqConsumeGoods()},.3,"reqConsumeGoods")},reqConsumeGoods:function(){},showJadeBuyComplete:function(shop_id){},showGachaTicketBuyComplete:function(shop_id){},showNotValidReceipt:function(){},showFailBuyGoods:function(){},particle_snow:function(){var snow=cc.Sprite.create(RES_CDN_DEFULT+"env_effect/hscene_snow_front.png"),size=cc.director.getWinSize(),m_emitter=cc.ParticleSystem(snow);m_emitter.setTexture(snow.getTexture()),m_emitter.setAngle(120),m_emitter.setAngleVar(360),m_emitter.setDuration(-1),m_emitter.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),m_emitter.setEndColor(cc.color(255,255,255,120)),m_emitter.setEndColorVar(cc.color(0,0,0,0)),m_emitter.setEndSize(20),m_emitter.setEndSizeVar(0),m_emitter.setGravity(cc.p(0,-9)),m_emitter.setLife(6),m_emitter.setLifeVar(0),m_emitter.setRadialAccel(0),m_emitter.setRadialAccelVar(0),m_emitter.setTangentialAccel(30),m_emitter.setTangentialAccelVar(0),m_emitter.setPosition(cc.p(size.width,size.height+20)),m_emitter.setPosVar(cc.p(size.width/.1,0)),m_emitter.setSpeed(60),m_emitter.setSpeedVar(20),m_emitter.setStartSpin(30),m_emitter.setStartSpinVar(60),m_emitter.setEndSpin(60),m_emitter.setEndSpinVar(60);cc.color(.69,.8,1,.8);m_emitter.setStartColor(cc.color(176,205,255,120)),m_emitter.setStartColorVar(cc.color(0,0,0,0)),m_emitter.setStartSize(42),m_emitter.setStartSizeVar(2),m_emitter.setEmissionRate(100),this.addChild(m_emitter,10)},reqEventDungeonPeriodInfo:function(){var req={};req.opcode=net.OP.op_event_dungeon_open_period_info,this.network_write(req)},showErrorMessage:function(msg){var m=MasterManager.getInstance();this.m_box.setTitle(m.get_LanguageData("label_shop_buy_jade_omission_title")),this.m_box.setText(msg),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo("確認",MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide()}.bind(this))),this.m_box.show()},requestPremium_Login_Check:function(){var req={};req.opcode=net.OP.op_dmm_point_premium_login_check,this.network_write(req)},showWorldWarNonePeriodPopup:function(){this.m_box.setTitle(res_str("world_war_season_over_title_2")),this.m_box.setText(res_str("world_war_season_over_text_2")),this.m_box.setText("\n"),this.m_box.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.m_box.hide(),MainObserver.getInstance().postNotification(NOTIFY_MENU_NOTICE)}.bind(this))),this.m_box.show()},showTutorialCompleteRewardPopup:function(){var rewards=TutorialContextV2.getInstance().getTutorialCompleteBonusRewards(),m=MasterManager.getInstance(),first_bonus=rewards[0],first_bonus_type=m.get_BonusType(first_bonus.bonus_type),last_bonus=rewards[rewards.length-1],last_bonus_type=m.get_BonusType(last_bonus.bonus_type);this.m_ctbox.setTitle(res_str("tutorial_complete_popup_title")),this.m_ctbox.setText("チュートリアル完了報酬として",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText(cmString("%s %d個",first_bonus_type.name,first_bonus.bonus_idx),LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("\n"),this.m_ctbox.setText(cmString("%s %d個",last_bonus_type.name,last_bonus.bonus_idx),LABEL_FONT_INDEX.FONT_262),this.m_ctbox.setText("\n"),this.m_ctbox.setText("を獲得しました。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.setText("メールで受け取ってください。",LABEL_FONT_INDEX.FONT_261),this.m_ctbox.setText("\n"),this.m_ctbox.addButtonInfo(new MessageButtonInfo(res_str("btn_label_confirm"),MessageBoxButtonType.ButtonTypeNormal,0,function(){this.scheduleOnce(function(float){this.reqNoticeAndLoginCheck()},.1,"reqNoticeAndLoginCheck"),this.m_ctbox.hide()}.bind(this))),this.m_ctbox.show()},goWorldWar:function(){var req={};req.opcode=net.OP.op_get_world_war_season_info,this.network_write(req);WorldWarService.getInstance().getCurrentPeriod()[0]},finish_WW_Master_load:function(){var req={};req.opcode=net.OP.op_get_world_war_season_info,this.network_write(req);WorldWarService.getInstance().getCurrentPeriod()[0]}}),MAIN_BG_ZORDER=1,MAIN_BG_EFF_ZORDER=2,CAMP_BUTTON_ZORDER=5,ANIMATION_ZORDER=10,BG_MASK_ZORDER=15,CAMP_ANIMATION=20,PARTNER_ZORDER=30,SUNLIGHT_ZORDER=40,BUTTON_ZORDER=50,POPUP_ZORDER=60,BANNER_MAX_VIEW_COUNT=3,MainBannerImage=function(_button,_banner_num,_banner_index,_banner_list_index,_page_num){this.button=_button,this.banner_num=_banner_num,this.banner_index=_banner_index,this.banner_list_index=_banner_list_index,this.page_num=_page_num},MainBannerPosition=function(_pos,_order){this.pos=_pos,this.order=_order},MainBanner=cc.Class.extend({main_banner_image:null,parent:null,_callBack:null,pos:null,order:null,isMoveComplete:null,ctor:function(){},setPosition:function(position,animate){if(this.isMoveComplete=!1,animate){var callback=new cc.CallFunc(this.moveComplete,this);this.main_banner_image.button.setAnchorPoint(ZERO()),this.main_banner_image.button.runAction(new cc.Sequence(new cc.MoveTo(.5,position.pos),new cc.DelayTime(.1),callback))}else this.main_banner_image.button.setAnchorPoint(ZERO()),this.main_banner_image.button.setPosition(position.pos),this.isMoveComplete=!0;this.pos=position.pos,this.order=position.order,this.parent.reorderChild(this.main_banner_image.button,this.order)},moveComplete:function(){this.isMoveComplete=!0,null!=this._callBack&&this._callBack()},moveRight:function(ratio,position){var dx=(position.pos.x-this.pos.x)*ratio,dy=(position.pos.y-this.pos.y)*ratio;this.main_banner_image.button.setPosition(this.pos.x+dx,this.pos.y+dy),this.order=position.order,this.parent.reorderChild(this.main_banner_image.button,this.order)},moveLeft:function(ratio,position){var dx=(position.pos.x-this.pos.x)*ratio,dy=(position.pos.y-this.pos.y)*ratio;this.main_banner_image.button.setPosition(this.pos.x+dx,this.pos.y+dy),this.order=position.order,this.parent.reorderChild(this.main_banner_image.button,this.order)}}),MainLayer=cc.Layer.extend({m_crrnt_troops_index:null,m_partner_gnrl:null,m_isShowMainMenuItem:!0,m_isShowBmMenuItem:!1,m_partner_skeleton:null,m_banner_rolling_delta:0,m_is_voice_playing:!1,m_banner_rolling_enabled:!0,m_banner_index:0,m_voice_playing_delta:0,m_mainLayer:null,m_statusLayer:null,m_bottomLayer:null,m_configLayer:null,m_userBoxLayer:null,m_touchEventLayer:null,m_notice_btn:null,m_mail_btn:null,m_help_btn:null,m_item_box_btn:null,m_yunhee_btn:null,m_frnd_btn:null,m_books_btn:null,m_shop_btn:null,m_gacha_btn:null,m_camp_btn:null,m_unification_btn:null,m_mussang_btn:null,m_story_btn:null,m_bg_main:null,m_new_mail_icon:null,m_clipperNode:null,m_banner_count:0,m_banner_page_count:0,m_banner_index:0,m_frnd_new_icon:null,m_free_gacha_new_icon:null,m_main_banner_list:[],m_mainBannerImages:[],m_mainBannerPos:[],m_banner_page_contol_imgs:[],m_gameObserver:null,m_test_shader:[],m_test_shader_index:0,m_scene:null,m_banner_list:[],m_img_scale:1,m_partnerInfo:{},m_resources:[],ctor:function(scene){this.m_main_banner_list=[],this.m_mainBannerImages=[],this.m_mainBannerPos=[],this.m_banner_page_contol_imgs=[],this.m_scene=scene,this.m_resources=[],this._super()},initLayout:function(){var listener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan,onTouchMoved:this.onTouchMoved,onTouchEnded:this.onTouchEnded.bind(this),onTouchCancelled:this.onTouchCancelled});if(cc.eventManager.addListener(listener,this),this.m_winSize=cc.director.getWinSize(),this.m_mainLayer=new cc.Layer,this.m_mainLayer.setContentSize(this.m_winSize),this.addChild(this.m_mainLayer),this.m_bg_main=cc.Sprite.create(RES_CDN_DEFULT+"menu_main/bg_main_update.png?ver="+CASH_VER),USE_SP_MAIN_MENU&&this.m_bg_main.setScale(2),this.m_bg_main.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bg_main.setPosition(ccCenter(this)),this.m_mainLayer.addChild(this.m_bg_main,MAIN_BG_ZORDER),USE_X_MAS_EFFECT){var img=cc.Sprite.create();img.setAnchorPoint(ZERO()),img.setPosition(742,228),this.m_bg_main.addChild(img);var animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.MainFireEffect),repeat=new cc.RepeatForever(animate);img.runAction(repeat);var img_1=cc.Sprite.create();img_1.setAnchorPoint(ANCHOR_TOP_LEFT()),img_1.setPosition(0,ccHeight(this.m_bg_main)),this.m_bg_main.addChild(img_1);animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.LeftXMasTree),repeat=new cc.RepeatForever(animate);img_1.runAction(repeat);var img_2=cc.Sprite.create();img_2.setAnchorPoint(ANCHOR_TOP_RIGHT()),img_2.setPosition(ccWidth(this.m_bg_main),ccHeight(this.m_bg_main)),this.m_bg_main.addChild(img_2);animate=MainAnimation.getInstance().getAnimate(MAIN_ANI_TYPE.RightXMasTree),repeat=new cc.RepeatForever(animate);img_2.runAction(repeat)}if(USE_MAIN_EFFECT){var main_eff=new sp.SkeletonAnimation(RES_CDN_DEFULT+"effect/Main.json",RES_CDN_DEFULT+"effect/Main.atlas",1);main_eff.setPosition(ccCenter(this.m_winSize)),this.m_mainLayer.addChild(main_eff,MAIN_BG_EFF_ZORDER),main_eff.setAnimation(0,"fx_1",!0)}var generalService=GeneralService.getInstance(),partner_id=GeneralService.getInstance().getUserTroopsPartnerId(),partner_gnrl=new db.UserGeneralInfo,partner_key=GameContext.getInstance().getUserGeneralPartner(),gnrl_key=new net.User_General_Key;gnrl_key.gnrl_id=partner_key.gnrl_id,gnrl_key.gnrl_num=partner_key.gnrl_num,generalService.getUserGnrlDisplayClassInfo(gnrl_key,partner_gnrl);partner_id=0;var pos=null;if(1==USE_PARTNER_GNRL_LOADING){var partner_yunhee=GameDefault.getInstance().GetPartnerYunheeLoad();if(1==partner_yunhee.load)for(var tdx=0;tdx<partner_yunhee.gnrl_img.length;tdx++)this.m_resources.push(partner_yunhee.gnrl_img[tdx]);pos=partner_yunhee.position,partner_id=partner_yunhee.partner_id,this.m_partnerInfo=generalService.getGeneral(partner_id),1==partner_yunhee.load?resourceLoader(this.m_resources,function(){this.partner_drawing(partner_id,pos)}.bind(this)):this.partner_drawing(partner_id,pos)}else{partner_id=partner_gnrl.class_type>=AVAIL_EVOLUTION_CLASS_TYPE_LIMIT&&0!=partner_gnrl.display_class&&partner_gnrl.class_type!=partner_gnrl.display_class?partner_gnrl.gnrl_id-1e3*(partner_gnrl.class_type-partner_gnrl.display_class):partner_gnrl.gnrl_id,this.m_partnerInfo=generalService.getGeneral(partner_id);var mt=MasterManager.getInstance();pos=mt.get_BodyPosition(partner_id);var morph=MasterTable.getInstance().get_MorphData(partner_id);if("y"==morph.is_morph){var gnrl=MasterManager.getInstance().get_General(morph.gnrl_id),stading_files=StandingMultiplePngList[morph.gnrl_id];if(null==stading_files)this.m_resources.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".png");else for(var idx=0;idx<stading_files.length;idx++)this.m_resources.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+stading_files[idx]+".png");this.m_resources.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".atlas"),this.m_resources.push(RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+gnrl.gnrl_id+".json"),resourceLoader(this.m_resources,function(){this.partner_drawing(partner_id,pos)}.bind(this))}else{var general=MasterManager.getInstance().get_General(partner_id);if(general.gnrl_type==GENERAL_TYPE_YUNHEE)mt.get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M?this.m_resources.push(getCardBody_ImageStr(general.gnrl_id)):this.m_resources.push(getCardBody_ImageStr(general.gnrl_group));else this.m_resources.push(getCardBody_ImageStr(partner_id));resourceLoader(this.m_resources,function(){this.partner_drawing(partner_id,pos)}.bind(this))}}this.m_bottomLayer=this.getBottomLayer(),this.m_mainLayer.addChild(this.m_bottomLayer,BUTTON_ZORDER),this.m_bottomLayer.ignoreAnchorPointForPosition(!1),this.m_bottomLayer.setAnchorPoint(ZERO()),this.m_bottomLayer.setPosition(ZERO());var leftMenuLayer=this.getLeftMenuLayer();if(leftMenuLayer.ignoreAnchorPointForPosition(!1),leftMenuLayer.setAnchorPoint(ANCHOR_TOP_LEFT()),leftMenuLayer.setPosition(10,503),this.m_mainLayer.addChild(leftMenuLayer,POPUP_ZORDER),this.m_touchEventLayer=new cc.Layer,this.m_touchEventLayer.setContentSize(400,570),this.m_touchEventLayer.setPosition(ccWidth(this)-ccWidth(this.m_touchEventLayer),0),this.addChild(this.m_touchEventLayer),AudioEngine.getInstance().preloadEffect(RES_CDN_SOUND+SND_TYPE+"sound/1_ATK_1.mp3"),this.m_banner_list=NetService().get_RollingBannerList(),!this.m_banner_list.length<=0){this.m_main_banner_list=[];for(var banner_img=[],i=0;i<this.m_banner_list.length;++i){var banner=this.m_banner_list[i],main_banner={};main_banner.banner_idx=banner.banner_idx,main_banner.banner_type=banner.banner_type,main_banner.num=banner.num,cc.log("rolling baner img path = "+banner.img_path);var banner_num=img_popup_banner.indexOf(banner.img_path);if(-1!=banner_num){var imx_org_str=img_main_banner_imx[banner_num];if(null==imx_org_str)continue;var imx_con_str=imx_org_str.replace(RS_HEX_KEY,RS_HEX_CON);main_banner.img_path="data:image/png;base64,"+imx_con_str,main_banner.comment=banner.comment,main_banner.page_num=i+1,this.m_main_banner_list.push(main_banner)}else main_banner.banner_idx=banner.banner_idx,main_banner.banner_type=banner.banner_type,main_banner.num=banner.num,main_banner.img_path=RES_CDN_DEFULT+""+banner.img_path,main_banner.comment=banner.comment,main_banner.page_num=i+1,this.m_main_banner_list.push(main_banner),banner_img.push(RES_CDN_DEFULT+""+banner.img_path)}resourceLoader(banner_img,function(){this.completeBannerLoad()}.bind(this))}},partner_drawing:function(partner_id,pos){var morph=MasterTable.getInstance().get_MorphData(partner_id);if("y"==morph.is_morph){var gnrl=MasterManager.getInstance().get_General(morph.gnrl_id),standing_atlas=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".atlas",standing_json=RES_CDN_DEFULT+"gnrl_"+leadingZeros(gnrl.gnrl_group,3)+"/standing/"+morph.gnrl_id+".json";this.m_partner_skeleton=new sp.SkeletonAnimation(standing_json,standing_atlas,.1),this.m_partner_skeleton.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_partner_skeleton.setPosition(MAIN_POS(this,pos.posx,pos.posy)),this.m_mainLayer.addChild(this.m_partner_skeleton,PARTNER_ZORDER),this.m_partner_skeleton.setMix("basic","active",.1),this.m_partner_skeleton.setMix("active","basic",.1),this.m_partner_skeleton.setMix("active","active",.1),this.m_partner_skeleton.setAnimation(0,"active",!1),this.m_partner_skeleton.addAnimation(0,"basic",!0),MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],already_tutorial)}else{var general=MasterManager.getInstance().get_General(partner_id);if(this.m_partner_gnrl=cc.Sprite.create(),this.m_img_scale=1,general.gnrl_type==GENERAL_TYPE_YUNHEE){if(MasterManager.getInstance().get_GeneralDivision(general.gnrl_group).general_gender_type==GENDER_TYPE_M){var img_str=getCardBody_ImageStr(general.gnrl_id);this.m_img_scale=getCardBody_Scale(general.gnrl_id),this.m_partner_gnrl.setTexture(img_str)}else{img_str=getCardBody_ImageStr(general.gnrl_group);this.m_img_scale=getCardBody_Scale(general.gnrl_group),this.m_partner_gnrl.setTexture(img_str)}}else{img_str=getCardBody_ImageStr(partner_id);this.m_img_scale=getCardBody_Scale(partner_id),this.m_partner_gnrl.setTexture(img_str)}this.m_partner_gnrl.setAnchorPoint(ANCHOR_MIDDLE()),this.m_partner_gnrl.setScale(this.m_img_scale),this.m_partner_gnrl.setPosition(MAIN_POS(this,pos.posx+ccWidth(this.m_partner_gnrl)*this.m_img_scale/2,pos.posy+ccHeight(this.m_partner_gnrl)*this.m_img_scale/2)),this.m_mainLayer.addChild(this.m_partner_gnrl,PARTNER_ZORDER);var scaleTo_1=new cc.ScaleTo(.1,this.m_img_scale+.03,this.m_img_scale-.03),scaleTo_2=new cc.ScaleTo(.125,this.m_img_scale-.03,this.m_img_scale+.03),scaleTo_3=new cc.ScaleTo(.1,this.m_img_scale+.02,this.m_img_scale-.02),scaleTo_4=new cc.ScaleTo(.1,this.m_img_scale,this.m_img_scale),callback=new cc.CallFunc(this.characterIdelAction,this);this.m_partner_gnrl.runAction(new cc.Sequence(scaleTo_1,scaleTo_2,scaleTo_3,scaleTo_4,callback)),MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],already_tutorial)}},completeBannerLoad:function(){this.initLayoutMainBanner()},initLayoutMainBanner:function(){if(this.m_clipperNode=new cc.ClippingNode,this.m_clipperNode.setAnchorPoint(ZERO()),this.m_clipperNode.setAlphaThreshold(.5),this.m_clipperNode.setPosition(ZERO()),this.addChild(this.m_clipperNode),this.m_clipperNode.setVisible(!1),this.m_banner_page_count=this.m_main_banner_list.length,1==this.m_banner_page_count){var banner=this.m_main_banner_list[0];this.m_main_banner_list.push(banner),this.m_main_banner_list.push(banner)}else if(2==this.m_banner_page_count){var banner_1=this.m_main_banner_list[0],banner_2=this.m_main_banner_list[1];this.m_main_banner_list.push(banner_1),this.m_main_banner_list.push(banner_2)}var m=this.m_main_banner_list[this.m_main_banner_list.length-1];this.m_main_banner_list.unshift(m),this.m_main_banner_list.pop(),this.m_banner_count=this.m_main_banner_list.length;var stencil_node=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_info_box.png",cc.Rect(10,10,10,10));stencil_node.setPreferredSize(cc.size(360,100)),stencil_node.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),stencil_node.setPosition(LP(this,126,25)),this.m_clipperNode.setStencil(stencil_node);for(var i=0;i<BANNER_MAX_VIEW_COUNT;i++){var banner_list_index=i+1,banner_index=(banner=this.m_main_banner_list[i]).banner_idx,page_num=banner.page_num,button=this.createBannerButton(banner);button.setTag(banner.banner_idx);var mainBannerImage=new MainBannerImage(button,banner.num,banner_index,banner_list_index,page_num),mainBanner=new MainBanner;mainBanner.parent=this.m_clipperNode,mainBanner.main_banner_image=mainBannerImage,mainBanner._callBack=function(){this.setBannerLock(!1)}.bind(this),this.m_mainBannerImages.push(mainBanner),this.m_clipperNode.addChild(button),this.m_mainBannerPos[0]=new MainBannerPosition(LP(this,-234,25),1),this.m_mainBannerPos[1]=new MainBannerPosition(LP(this,126,25),100),this.m_mainBannerPos[2]=new MainBannerPosition(LP(this,486,25),1),this.m_mainBannerImages[i].setPosition(this.m_mainBannerPos[i],!1),1!=i&&button.setEnabled(!1)}var bannerLeftButton=new ccui.Button("btn_main_banner_arrow_off.png","btn_main_banner_arrow_on.png","",ccui.Widget.PLIST_TEXTURE);bannerLeftButton.setAnchorPoint(ZERO()),bannerLeftButton.setPosition(LP(this,73,43)),this.addChild(bannerLeftButton),bannerLeftButton.addClickEventListener(function(sender){1<this.m_banner_page_count&&this.setBannerRight()}.bind(this));var bannerRightButton=new ccui.Button("btn_main_banner_arrow_off.png","btn_main_banner_arrow_on.png","",ccui.Widget.PLIST_TEXTURE);bannerRightButton.setAnchorPoint(ZERO()),bannerRightButton.setPosition(LP(this,541,43)),this.addChild(bannerRightButton),bannerRightButton.addClickEventListener(function(sender){1<this.m_banner_page_count&&this.setBannerLeft()}.bind(this)),bannerRightButton.setFlippedX(!0);for(i=0;i<this.m_banner_page_count;++i){var layer=new cc.Layer;this.addChild(layer,10);var sprite=cc.Sprite.create(RES_CDN_DEFULT+"menu_main/img_main_control_off.png");sprite.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),sprite.setPosition(i*(ccWidth(sprite)+10),0),layer.addChild(sprite),this.m_banner_page_contol_imgs.push(sprite),layer.ignoreAnchorPointForPosition(!1),layer.setAnchorPoint(ANCHOR_MIDDLE_BOTTOM()),layer.setPosition(LP(this,306,5)),layer.setContentSize(14*this.m_banner_page_count+10*(this.m_banner_page_count-1),15)}var banner_page=this.m_mainBannerImages[1].main_banner_image.page_num;this.setBannerPageControl(banner_page),1<this.m_banner_page_count&&this.scheduleUpdate(),this.scheduleOnce(function(){this.m_clipperNode.setVisible(!0)},.1,"banner")},createBannerButton:function(banner){var button_img_on=banner.img_path,button_img_off=banner.img_path,button=new ccui.Button(button_img_on,button_img_off);return button.addClickEventListener(function(sender){var btn=sender;if(this.m_banner_index!=btn.getTag()){var banner_index=btn.getTag();this.m_gameObserver.postNotification(NOTIFICATION_MAIN_BANNER,banner_index)}}.bind(this)),USE_SP_MAIN_BANNER&&button.setScale(2),button},rotateLeft:function(ratio,animate){if(1<=ratio){this.m_mainBannerImages.push(this.createLeftMainBanner()),this.m_mainBannerImages[0].main_banner_image.button.removeFromParent(),this.m_mainBannerImages.shift();for(var i=0;i<BANNER_MAX_VIEW_COUNT;++i)this.m_mainBannerImages[i].setPosition(this.m_mainBannerPos[i],animate)}else for(i=0;i<BANNER_MAX_VIEW_COUNT;++i)0==i?this.m_mainBannerImages[i].moveLeft(ratio,this.m_mainBannerPos[BANNER_MAX_VIEW_COUNT-1]):this.m_mainBannerImages[i].moveLeft(ratio,this.m_mainBannerPos[i-1]);var banner_page=this.m_mainBannerImages[1].main_banner_image.page_num;this.setBannerPageControl(banner_page)},rotateRight:function(ratio,animate){if(1<=ratio){this.m_mainBannerImages.unshift(this.createRightMainBanner()),this.m_mainBannerImages[this.m_mainBannerImages.length-1].main_banner_image.button.removeFromParent(),this.m_mainBannerImages.pop();for(var i=0;i<BANNER_MAX_VIEW_COUNT;++i)this.m_mainBannerImages[i].setPosition(this.m_mainBannerPos[i],animate)}else for(i=0;i<BANNER_MAX_VIEW_COUNT;++i)i+1==BANNER_MAX_VIEW_COUNT?this.m_mainBannerImages[i].moveRight(ratio,this.m_mainBannerPos[0]):this.m_mainBannerImages[i].moveRight(ratio,this.m_mainBannerPos[i+1]);var banner_page=this.m_mainBannerImages[1].main_banner_image.page_num;this.setBannerPageControl(banner_page)},setBannerPageControl:function(banner_page){for(var index=1,idx=0;idx<this.m_banner_page_contol_imgs.length;idx++)index==banner_page?this.m_banner_page_contol_imgs[idx].setTexture(RES_CDN_DEFULT+"menu_main/img_main_control_on.png"):this.m_banner_page_contol_imgs[idx].setTexture(RES_CDN_DEFULT+"menu_main/img_main_control_off.png"),index++},setBannerLock:function(is_lock){if(is_lock)for(var idx=0;idx<this.m_mainBannerImages.length;idx++)this.m_mainBannerImages[idx].main_banner_image.button.setEnabled(!1,!0);else for(var i=0;i<this.m_mainBannerImages.length;++i){var item=this.m_mainBannerImages[i];1==i?item.main_banner_image.button.setEnabled(!0):item.main_banner_image.button.setEnabled(!1,!0)}},setBannerLeft:function(){try{if(0==this.m_mainBannerImages[0].isMoveComplete)return;this.m_banner_rolling_delta=0,this.setBannerLock(!0),this.rotateLeft(1,!0),this.m_rotate_ratio=0}catch(e){}},setBannerRight:function(){try{if(0==this.m_mainBannerImages[0].isMoveComplete)return;this.m_banner_rolling_delta=0,this.setBannerLock(!0),this.rotateRight(1,!0),this.m_rotate_ratio=0}catch(e){}},createLeftMainBanner:function(){var mainBanner=new MainBanner;if(this.m_mainBannerImages[BANNER_MAX_VIEW_COUNT-1].main_banner_image.banner_list_index==this.m_banner_count){var banner_num=(banner=this.m_main_banner_list[0]).num,banner_list_index=1,banner_index=banner.banner_idx,page_num=banner.page_num,button=this.createBannerButton(banner);USE_SP_MAIN_BANNER&&button.setScale(2),button.setAnchorPoint(ZERO()),button.setPosition(LP(this,521,25)),button.setTag(banner_index),button.setEnabled(!1);var mainBannerImage=new MainBannerImage(button,banner_num,banner_index,banner_list_index,page_num);this.m_clipperNode.addChild(button),mainBanner.main_banner_image=mainBannerImage,mainBanner.parent=this.m_clipperNode,mainBanner._callBack=function(){this.setBannerLock(!1)}.bind(this)}else{var banner;banner_list_index=this.m_mainBannerImages[BANNER_MAX_VIEW_COUNT-1].main_banner_image.banner_list_index+1,banner_num=(banner=this.m_main_banner_list[banner_list_index-1]).num,banner_index=banner.banner_idx,page_num=banner.page_num,button=this.createBannerButton(banner);USE_SP_MAIN_BANNER&&button.setScale(2),button.setAnchorPoint(ZERO()),button.setPosition(LP(this,521,25)),button.setTag(banner_index),button.setEnabled(!1);mainBannerImage=new MainBannerImage(button,banner_num,banner_index,banner_list_index,page_num);this.m_clipperNode.addChild(button),mainBanner.parent=this.m_clipperNode,mainBanner.main_banner_image=mainBannerImage,mainBanner._callBack=function(){this.setBannerLock(!1)}.bind(this)}return mainBanner},createRightMainBanner:function(){var mainBanner=new MainBanner;if(1==this.m_mainBannerImages[0].main_banner_image.banner_list_index){var banner_num=(banner=this.m_main_banner_list[this.m_banner_count-1]).num,banner_list_index=this.m_banner_count,banner_index=banner.banner_idx,page_num=banner.page_num,button=this.createBannerButton(banner);USE_SP_MAIN_BANNER&&button.setScale(2),button.setAnchorPoint(ZERO()),button.setPosition(LP(this,-329,25)),button.setTag(banner_index),button.setEnabled(!1);var mainBannerImage=new MainBannerImage(button,banner_num,banner_index,banner_list_index,page_num);this.m_clipperNode.addChild(button),mainBanner.parent=this.m_clipperNode,mainBanner.main_banner_image=mainBannerImage,mainBanner._callBack=function(){this.setBannerLock(!1)}.bind(this)}else{var banner;banner_list_index=this.m_mainBannerImages[0].main_banner_image.banner_list_index-1,banner_num=(banner=this.m_main_banner_list[banner_list_index-1]).num,banner_index=banner.banner_idx,page_num=banner.page_num,button=this.createBannerButton(banner);USE_SP_MAIN_BANNER&&button.setScale(2),button.setAnchorPoint(ZERO()),button.setPosition(LP(this,-329,25)),button.setTag(banner_index),button.setEnabled(!1);mainBannerImage=new MainBannerImage(button,banner_num,banner_index,banner_list_index,page_num);this.m_clipperNode.addChild(button),mainBanner.parent=this.m_clipperNode,mainBanner.main_banner_image=mainBannerImage,mainBanner._callBack=function(){this.setBannerLock(!1)}.bind(this)}return mainBanner},onEnter:function(){this._super(),this.m_gameObserver=MainObserver.getInstance(),MainObserver.getInstance().addObserver(this.onNotification,this,NOTIFICATION_NEW_MAIL),MainObserver.getInstance().addObserver(this.onNotifyBanner,this,NOTIFICATION_BANNER_IS_ROLLING)},onEnterTransitionDidFinish:function(){this._super(),MainObserver.getInstance().postNotification(NOTIFICATION_GAME_MAIN_SCENE,message_start_time_event_schedule)},onExit:function(){MainObserver.getInstance().removeObserver(NOTIFICATION_NEW_MAIL),MainObserver.getInstance().removeObserver(NOTIFICATION_GAME_MAIN_SCENE),MainObserver.getInstance().removeObserver(NOTIFICATION_BANNER_IS_ROLLING),1!=this.m_scene.m_isPopupShow&&(this.removeChild(this.m_clipperNode),this.m_main_banner_list=null,this.m_mainBannerImages=null,this.m_mainBannerPos=null,this.m_banner_page_contol_imgs=null,this.m_clipperNode=null,this.m_notice_btn=null,this.m_mail_btn=null,this.m_help_btn=null,this.m_item_box_btn=null,this.m_yunhee_btn=null,this.m_frnd_btn=null,this.m_books_btn=null,this.m_shop_btn=null,this.m_gacha_btn=null,this.m_camp_btn=null,this.m_gameObserver=null,(this.m_partner_gnrl=null)==this.m_partner_skeleton&&null==this.m_partner_skeleton||(this.m_partner_skeleton._skeleton.animations=[],this.m_partner_skeleton._skeleton.data=null,this.m_partner_skeleton=null),this.m_banner_list=null,this.m_test_shader=null,this.m_resources=[],this.removeAllChildrenWithCleanup(!0),this._super())},onNotifyBanner:function(sender){var msg=sender;0==msg?this.m_banner_rolling_enabled=!1:1==msg&&(this.m_banner_rolling_enabled=!0)},onNotification:function(sender){sender==message_new_mail&&(GameContext.getInstance().getUserNewMail()?0!=this.m_new_mail_icon.getOpacity()&&(this.m_new_mail_icon.setVisible(!0),this.m_new_mail_icon.setOpacity(255)):this.m_new_mail_icon.setVisible(!1))},getLeftMenuLayer:function(){var layer=new cc.Layer;layer.setContentSize(80,346),this.m_notice_btn=new ccui.Button(RES_CDN_DEFULT+"menu_main/img_menu_right_notice_off.png",RES_CDN_DEFULT+"menu_main/img_menu_right_notice_on.png"),this.m_notice_btn.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_notice_btn.setPosition(0,ccHeight(layer)),this.m_notice_btn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_NOTICE)}.bind(this)),layer.addChild(this.m_notice_btn),this.m_books_btn=new ccui.Button(RES_CDN_DEFULT+"menu_main/img_menu_right_book_off.png",RES_CDN_DEFULT+"menu_main/img_menu_right_book_on.png"),this.m_books_btn.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_books_btn.setPosition(0,ccPos(this.m_notice_btn).y-ccHeight(this.m_books_btn)-17),this.m_books_btn.addClickEventListener(function(sender){this.m_books_btn.setEnabled(!1),this.m_gameObserver.postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_BOOKS)}.bind(this)),layer.addChild(this.m_books_btn),this.m_mail_btn=new ccui.Button(RES_CDN_DEFULT+"menu_main/img_menu_right_mail_off.png",RES_CDN_DEFULT+"menu_main/img_menu_right_mail_on.png"),this.m_mail_btn.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_mail_btn.setPosition(0,ccPos(this.m_books_btn).y-ccHeight(this.m_mail_btn)-17),this.m_mail_btn.addClickEventListener(function(sender){this.getParent().initLayoutProgress(),this.m_gameObserver.postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_MAIL)}.bind(this)),layer.addChild(this.m_mail_btn),this.m_new_mail_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_new_mail_icon.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_new_mail_icon.setPosition(0,ccHeight(this.m_mail_btn)),this.m_mail_btn.addChild(this.m_new_mail_icon);var is_new=GameContext.getInstance().getUserNewMail();is_new?this.m_new_mail_icon.setVisible(!0):this.m_new_mail_icon.setVisible(!1);var achv_btn=new ccui.Button(RES_CDN_DEFULT+"menu_main/img_menu_right_quest_off.png",RES_CDN_DEFULT+"menu_main/img_menu_right_quest_on.png");achv_btn.setAnchorPoint(ANCHOR_TOP_LEFT()),achv_btn.setPosition(0,ccPos(this.m_mail_btn).y-ccHeight(achv_btn)-17),achv_btn.addClickEventListener(function(sender){this.getParent().initLayoutProgress(),GameContext.getInstance().setAchievementTap(ACHIEVEMENT_DAY),this.m_gameObserver.postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_ACHIEV)}.bind(this)),layer.addChild(achv_btn);var achv_new_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png");return achv_new_icon.setAnchorPoint(ANCHOR_TOP_LEFT()),achv_new_icon.setPosition(0,ccHeight(achv_btn)),achv_btn.addChild(achv_new_icon),(is_new=AchievementService.getInstance().isNewCompleteAchievement())||achv_new_icon.setVisible(!1),this.m_help_btn=new ccui.Button(RES_CDN_DEFULT+"menu_main/img_menu_right_info_off.png",RES_CDN_DEFULT+"menu_main/img_menu_right_info_on.png"),this.m_help_btn.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_help_btn.setPosition(0,ccPos(achv_btn).y-ccHeight(this.m_help_btn)-17),this.m_help_btn.addClickEventListener(function(sender){cc.log("call NOTIFY_MENU_HELP"),this.getParent().initLayoutProgress(),this.m_gameObserver.postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_HELP)}.bind(this)),layer.addChild(this.m_help_btn),this.m_item_box_btn=new ccui.Button(RES_CDN_DEFULT+"menu_main/img_menu_right_item_box_off.png",RES_CDN_DEFULT+"menu_main/img_menu_right_item_box_on.png"),this.m_item_box_btn.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_item_box_btn.setPosition(0,ccPos(this.m_help_btn).y-ccHeight(this.m_item_box_btn)-17),this.m_item_box_btn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_ITEM_BOX)}.bind(this)),layer.addChild(this.m_item_box_btn),layer},getBottomLayer:function(){var layer=new cc.Layer,service=(MasterTable.getInstance(),ShopService.getInstance());this.m_yunhee_btn=new ccui.Button(RES_CDN_DEFULT+"menu_main/img_menu_1_off.png",RES_CDN_DEFULT+"menu_main/img_menu_1_on.png"),this.m_yunhee_btn.setAnchorPoint(ZERO()),this.m_yunhee_btn.setPosition(LP(this,130,415)),this.m_yunhee_btn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_YUNHEE)}.bind(this)),layer.addChild(this.m_yunhee_btn),this.m_yunhee_btn.setTutorialTag(TUTORIAL_TAG_PAGE_2_YUNHEE_BTN),this.m_camp_btn=new ccui.Button(RES_CDN_DEFULT+"menu_main/img_menu_2_off.png",RES_CDN_DEFULT+"menu_main/img_menu_2_on.png"),this.m_camp_btn.setAnchorPoint(ZERO()),this.m_camp_btn.setPosition(LP(this,254,458)),this.m_camp_btn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_CAMP)}.bind(this)),layer.addChild(this.m_camp_btn);var mussang_quest_btn=new ccui.Button(RES_CDN_DEFULT+"menu_main/img_menu_7_off.png",RES_CDN_DEFULT+"menu_main/img_menu_7_on.png");mussang_quest_btn.setAnchorPoint(ZERO()),mussang_quest_btn.setPosition(LP(this,130,175)),mussang_quest_btn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_QUEST)}.bind(this)),layer.addChild(mussang_quest_btn),this.m_frnd_btn=new ccui.Button(RES_CDN_DEFULT+"menu_main/img_menu_4_off.png",RES_CDN_DEFULT+"menu_main/img_menu_4_on.png"),this.m_frnd_btn.setAnchorPoint(ZERO()),this.m_frnd_btn.setPosition(LP(this,378,415)),this.m_frnd_btn.addClickEventListener(function(sender){this.m_frnd_btn.setEnabled(!1),this.getParent().initLayoutProgress(),this.m_gameObserver.postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_FRIEND)}.bind(this)),layer.addChild(this.m_frnd_btn),this.m_frnd_new_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_frnd_new_icon.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_frnd_new_icon.setPosition(0,ccHeight(this.m_frnd_btn)),this.m_frnd_btn.addChild(this.m_frnd_new_icon),this.m_frnd_new_icon.setVisible(!1),this.m_shop_btn=new ccui.Button(RES_CDN_DEFULT+"menu_main/img_menu_5_off.png",RES_CDN_DEFULT+"menu_main/img_menu_5_on.png"),this.m_shop_btn.setAnchorPoint(ZERO()),this.m_shop_btn.setPosition(LP(this,254,132)),this.m_shop_btn.addClickEventListener(function(sender){this.m_shop_btn.setEnabled(!1),this.getParent().initLayoutProgress(),this.m_gameObserver.postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_HOME_SHOP)}.bind(this)),layer.addChild(this.m_shop_btn),this.m_gacha_btn=new ccui.Button(RES_CDN_DEFULT+"menu_main/img_menu_6_off.png",RES_CDN_DEFULT+"menu_main/img_menu_6_on.png"),this.m_gacha_btn.setAnchorPoint(ZERO()),this.m_gacha_btn.setPosition(LP(this,378,175)),this.m_gacha_btn.addClickEventListener(function(sender){this.getParent().initLayoutProgress(),this.m_gameObserver.postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_GACHA)}.bind(this)),layer.addChild(this.m_gacha_btn);var is_exist_free_gacha=!1;USE_ONE_DAY_ONE_TIME_FREE_GACHA&&(is_exist_free_gacha=service.IsEnableBuyFreeGacha(GACHA_KIND_1_DAY_1_TIME_FREE_GACHA)),USE_ONE_USER_ONE_TIME_FREE_GACHA&&(is_exist_free_gacha||(is_exist_free_gacha=service.IsEnableBuyFreeGacha(GACHA_KIND_1_USER_1_TIME_FREE_GACHA))),this.m_free_gacha_new_icon=cc.Sprite.create(RES_CDN_DEFULT+"common/ic_new.png"),this.m_free_gacha_new_icon.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_free_gacha_new_icon.setPosition(0,ccHeight(this.m_gacha_btn)),this.m_gacha_btn.addChild(this.m_free_gacha_new_icon),this.m_free_gacha_new_icon.setVisible(is_exist_free_gacha);var wwbtn_off=RES_CDN_DEFULT+"menu_main/img_menu_world_close_off.png",wwbtn_on=RES_CDN_DEFULT+"menu_main/img_menu_world_close_on.png",period_type=WorldWarService.getInstance().getCurrentPeriodType();wwbtn_on=period_type==WORLD_WAR_PERIOD_SEASON?(wwbtn_off=RES_CDN_DEFULT+"menu_main/img_menu_world_open_off.png",RES_CDN_DEFULT+"menu_main/img_menu_world_open_on.png"):period_type==WORLD_WAR_PERIOD_REWARD?(wwbtn_off=RES_CDN_DEFULT+"menu_main/img_menu_world_reward_off.png",RES_CDN_DEFULT+"menu_main/img_menu_world_reward_on.png"):(wwbtn_off=RES_CDN_DEFULT+"menu_main/img_menu_world_close_off.png",RES_CDN_DEFULT+"menu_main/img_menu_world_close_on.png"),this.m_unification_btn=new ccui.Button(wwbtn_off,wwbtn_on),this.m_unification_btn.setAnchorPoint(ZERO()),this.m_unification_btn.setPosition(LP(this,418,287)),layer.addChild(this.m_unification_btn),this.m_unification_btn.addClickEventListener(function(sender){this.getParent().initLayoutProgress(),this.m_gameObserver.postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_WORLD_WAR)}.bind(this)),this.m_mussang_btn=new ccui.Button(RES_CDN_DEFULT+"menu_main/img_menu_vs_off.png",RES_CDN_DEFULT+"menu_main/img_menu_vs_on.png"),this.m_mussang_btn.setAnchorPoint(ZERO()),this.m_mussang_btn.setPosition(LP(this,74,287)),this.m_mussang_btn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_MUSSANG)}.bind(this)),layer.addChild(this.m_mussang_btn),this.m_story_btn=new ccui.Button(RES_CDN_DEFULT+"menu_main/img_menu_story_off.png",RES_CDN_DEFULT+"menu_main/img_menu_story_on.png"),this.m_story_btn.setAnchorPoint(ZERO()),this.m_story_btn.setPosition(LP(this,214,256)),this.m_story_btn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_MainHomeScene],NOTIFY_MENU_STORY),this.m_story_btn.setEnabled(!1)}.bind(this)),this.m_story_btn.setTutorialTag(TUTORIAL_TAG_PAGE_1_STORY_BTN),layer.addChild(this.m_story_btn);for(var campaign_list=MasterTable.getInstance().get_RewardCampaignUiListFromPoistionType(CAMPAIGN_POSITION_TYPE_MAIN_ROBBY),idx=0;idx<campaign_list.length;idx++){var icon=cc.Sprite.create(RES_CDN_DEFULT+cmString("common/%s",campaign_list[idx].image_name));icon.setAnchorPoint(ANCHOR_MIDDLE_TOP()),campaign_list[idx].dugeon_type==CAMPAIGN_DUNGEON_TYPE_STORY?(icon.setPosition(ccCenter(this.m_story_btn).x,ccHeight(this.m_story_btn)),this.m_story_btn.addChild(icon)):campaign_list[idx].dugeon_type==CAMPAIGN_DUNGEON_TYPE_WEEKLY||campaign_list[idx].dugeon_type==CAMPAIGN_DUNGEON_TYPE_DAILY||campaign_list[idx].dugeon_type==CAMPAIGN_DUNGEON_TYPE_MUSSANG_ROAD||campaign_list[idx].dugeon_type==CAMPAIGN_DUNGEON_TYPE_MUSSANG_TOWER?(icon.setPosition(ccCenter(mussang_quest_btn).x,ccHeight(mussang_quest_btn)),mussang_quest_btn.addChild(icon)):campaign_list[idx].dugeon_type!=CAMPAIGN_DUNGEON_TYPE_EVENT_DUNGEON&&campaign_list[idx].dugeon_type!=CAMPAIGN_DUNGEON_TYPE_RAID_BOSS&&campaign_list[idx].dugeon_type!=CAMPAIGN_DUNGEON_TYPE_GREAT_WALL||(icon.setPosition(ccCenter(this.m_mussang_btn).x,ccHeight(this.m_mussang_btn)),this.m_mussang_btn.addChild(icon))}return layer},refreshWorldWarButton:function(){var period_type=WorldWarService.getInstance().getCurrentPeriodType();period_type==WORLD_WAR_PERIOD_SEASON?(this.m_unification_btn.loadTextureNormal(res.img_menu_worldwar_open_off),this.m_unification_btn.loadTexturePressed(res.img_menu_worldwar_open_on)):period_type==WORLD_WAR_PERIOD_REWARD?(this.m_unification_btn.loadTextureNormal(res.img_menu_worldwar_reward_off),this.m_unification_btn.loadTexturePressed(res.img_menu_worldwar_reward_on)):(this.m_unification_btn.loadTextureNormal(res.img_menu_worldwar_off),this.m_unification_btn.loadTexturePressed(res.img_menu_worldwar_on))},showItems:function(){this.m_statusLayer.setVisible(!0),this.m_bottomLayer.setVisible(!0),this.m_userBoxLayer.setVisible(!0)},hideItems:function(){this.m_statusLayer.setVisible(!1),this.m_bottomLayer.setVisible(!1),this.m_userBoxLayer.setVisible(!1)},onTouchBegan:function(touch,event){return!0},onTouchEnded:function(touch,event){var locationTouchEnded=touch.getLocation(),size=ccSize(this.m_touchEventLayer),pos=this.m_touchEventLayer.getPosition(),rect=new cc.Rect(pos.x,pos.y,size.width,size.height);if(cc.rectContainsPoint(rect,locationTouchEnded)){var duration,is_voice_play=!1,partner_id=GeneralService.getInstance().getUserTroopsPartnerId(),voice_list=MasterTable.getInstance().get_Voice(partner_id,voice_main_body_touch,{}),voice=voice_list.voice;if(duration=voice_list.duration,null!=this.m_partner_gnrl){this.m_partner_gnrl.stopAllActions();var s1=new cc.ScaleTo(.1,this.m_img_scale+.03,this.m_img_scale-.03),s2=new cc.ScaleTo(.2,this.m_img_scale-.03,this.m_img_scale+.03),s3=new cc.ScaleTo(.15,this.m_img_scale+.02,this.m_img_scale-.02),s4=new cc.ScaleTo(.8,this.m_img_scale,this.m_img_scale),callback=new cc.CallFunc(this.characterIdelAction,this),e4=new cc.EaseElasticOut(s4),seq=new cc.Sequence(s1,s2,s3,e4,callback);this.m_partner_gnrl.runAction(seq),is_voice_play=!0}if(null!=this.m_partner_skeleton&&(this.m_partner_skeleton.setAnimation(0,"active",!1),this.m_partner_skeleton.addAnimation(0,"basic",!0),is_voice_play=!0),1==is_voice_play)if(0==this.m_is_voice_playing)if(voice&&""!=voice&&null!=voice)AudioEngine.getInstance().playVoice(RES_CDN_SOUND+SND_TYPE+"voice_etc/"+voice+".mp3",!1),this.m_is_voice_playing=!0,this.m_voice_playing_delta=duration}},onTouchCancelled:function(touch,event){},onTouchMoved:function(touch,event){},characterIdelAction:function(){var scaleTo_1=new cc.ScaleTo(1.2,this.m_img_scale,this.m_img_scale+.01),scaleTo_2=new cc.ScaleTo(1.2,this.m_img_scale,this.m_img_scale-.01),sequence=new cc.Sequence(scaleTo_1,scaleTo_2),repeat=new cc.RepeatForever(sequence);this.m_partner_gnrl.runAction(repeat)},showUI:function(isShow){null!=this.m_statusLayer&&this.m_statusLayer.setVisible(isShow),null!=this.m_bottomLayer&&this.m_bottomLayer.setVisible(isShow),null!=this.m_partner_gnrl&&this.m_partner_gnrl.setVisible(isShow),null!=this.m_partner_skeleton&&this.m_partner_skeleton.setVisible(isShow),null!=this.m_userBoxLayer&&this.m_userBoxLayer.setVisible(isShow)},update:function(dt){1<=GameContext.getInstance().getAcceptFriendList().length?this.m_frnd_new_icon.setVisible(!0):this.m_frnd_new_icon.setVisible(!1),this.m_banner_rolling_enabled&&(this.m_banner_rolling_delta+=dt,5<this.m_banner_rolling_delta&&this.setBannerLeft(),this.m_is_voice_playing&&(this.m_voice_playing_delta-=dt,this.m_voice_playing_delta<0&&(this.m_is_voice_playing=!1,this.m_voice_playing_delta=0)))},particle_snow:function(){var snow=cc.Sprite.create(RES_CDN_DEFULT+"env_effect/hscene_snow_front.png"),size=cc.director.getWinSize(),m_emitter=cc.ParticleSystem(RES_CDN_DEFULT+"env_effect/hscene_snow_front.png");m_emitter.setTexture(snow.getTexture()),m_emitter.setAngle(120),m_emitter.setAngleVar(360),m_emitter.setDuration(-1),m_emitter.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),m_emitter.setEndColor(cc.color(1,1,1,.5)),m_emitter.setEndColorVar(cc.color(0,0,0,0)),m_emitter.setEndSize(20),m_emitter.setEndSizeVar(0),m_emitter.setGravity(Point(0,-9)),m_emitter.setLife(6),m_emitter.setLifeVar(0),m_emitter.setRadialAccel(0),m_emitter.setRadialAccelVar(0),m_emitter.setTangentialAccel(30),m_emitter.setTangentialAccelVar(0),m_emitter.setPosition(cc.p(size.width,size.height+20)),m_emitter.setPosVar(cc.p(size.width/.1,0)),m_emitter.setSpeed(60),m_emitter.setSpeedVar(20),m_emitter.setStartSpin(30),m_emitter.setStartSpinVar(60),m_emitter.setEndSpin(60),m_emitter.setEndSpinVar(60);cc.color(.69,.8,1,.8);return m_emitter.setStartColor(cc.color(1,1,1,1)),m_emitter.setStartColorVar(cc.color(0,0,0,0)),m_emitter.setStartSize(42),m_emitter.setStartSizeVar(2),m_emitter.setEmissionRate(100),m_emitter}}),ToastEnum={CENTER:2},ToastBoxLayer=cc.Layer.extend({m_title_label:null,m_content_label:null,m_bg:null,m_origin_pos:null,ctor:function(){this._super(),this.initLayout()},initLayout:function(){cc.log("initLayout");var size=cc.size(200,100);this.m_bg=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_massage_popup.png",cc.Rect(22,22,22,22)),this.m_bg.setPreferredSize(size),this.m_bg.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_bg.setPosition(ZERO()),this.addChild(this.m_bg,0),this.m_title_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_243),this.m_title_label.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_title_label.setPosition(ZERO()),this.m_bg.addChild(this.m_title_label),this.m_content_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_201),this.m_content_label.setAnchorPoint(ANCHOR_MIDDLE_TOP()),this.m_content_label.setPosition(ZERO()),this.m_bg.addChild(this.m_content_label)},setTitle:function(title){this.m_title=title},setContent:function(content){this.m_content=content},show:function(duration,direction){this.m_title_label.setString(this.m_title),this.m_content_label.setString(this.m_content);var t_size=ccSize(this.m_title_label),c_size=ccSize(this.m_content_label),height=0;height=""==this.m_title?15+c_size.height+15:15+t_size.height+15+c_size.height+15;var width=Math.max(t_size.width,c_size.width)+100,box_size=cc.size(width,height);this.m_bg.setPreferredSize(box_size);var offset_y=ccHeight(this.m_bg)-15;if(""==this.m_title||(this.m_title_label.setPosition(ccCenter(this.m_bg).x,offset_y),offset_y-=ccHeight(this.m_title_label)+15),this.m_content_label.setPosition(ccCenter(this.m_bg).x,offset_y),this.stopAllActions(),this.setPosition(this.m_origin_pos),direction==ToastEnum.CENTER){this.setVisible(!0),this.m_bg.setPosition(ccPosX(this.m_bg),320);var up_ease=new cc.moveBy(.3,cc.p(0,box_size.height+30)).easing(cc.easeExponentialOut()),delay=new cc.DelayTime(duration),down_ease=new cc.moveBy(.3,cc.p(0,-(box_size.height+30))).easing(cc.easeExponentialOut()),call_back=new cc.CallFunc(this.callback.bind(this)),spawn=new cc.Spawn(down_ease,call_back),seq=new cc.Sequence(up_ease,delay,spawn);this.runAction(seq)}else{up_ease=new cc.moveBy(.3,cc.p(0,box_size.height+30)).easing(cc.easeExponentialOut()),delay=new cc.DelayTime(duration),down_ease=new cc.moveBy(.3,cc.p(0,-(box_size.height+30))).easing(cc.easeExponentialOut()),seq=new cc.Sequence(up_ease,delay,down_ease);this.runAction(seq)}},callback:function(){this.setVisible(!1)},hideToastBox:function(){this.setVisible(!1)},setToastPosition:function(pos){this.m_origin_pos=pos,this.setPosition(pos)}}),RETURN_USER_COUNT_14=1,ReturnUserBonusLayer=cc.Layer.extend({m_is_ani_layer:!1,m_is_banner_click:!1,m_useBackKey:!1,m_animationLayer:null,m_back_btn:null,m_login_bonus_list:[],m_today_login_bonus:null,m_tm_bonus_item_list:[],m_gameObserver:null,m_icon_pos:[],ctor:function(){this.init(),this._super()},init:function(){return this.m_login_bonus_list=[],UserService.getInstance().getLoginBonusInfo(LOGIN_BONUS_TYPE_RETURN_USER,this.m_login_bonus_list),this.m_gameObserver=MainObserver.getInstance(),this.m_login_bonus_list.sort(function(l,r){return l.login_count>r.login_count?1:l.login_count<r.login_count?-1:0}),this.initIconPos(),!0},initIconPos:function(){this.m_icon_pos.clear();var pos=[];pos.push(cc.p(84,400)),pos.push(cc.p(194,400)),pos.push(cc.p(304,400)),pos.push(cc.p(414,400)),pos.push(cc.p(84,290)),pos.push(cc.p(194,290)),pos.push(cc.p(304,290)),pos.push(cc.p(414,290)),pos.push(cc.p(84,180)),pos.push(cc.p(194,180)),pos.push(cc.p(304,180)),pos.push(cc.p(414,180)),pos.push(cc.p(84,70)),pos.push(cc.p(194,70)),this.m_icon_pos[RETURN_USER_COUNT_14]=pos},initLayout:function(is_banner_click){this.m_is_banner_click=is_banner_click;var bg_box=cc.Sprite.create(RES_CDN_DEFULT+"banner/img_event_frame_return_1.png");bg_box.setPosition(ccCenter(this)),this.addChild(bg_box);MasterManager.getInstance().get_LoginBonusType(LOGIN_BONUS_TYPE_RETURN_USER);var label=cmLabel.getLabel(res_str("label_attendance_info"),LABEL_FONT_INDEX.FONT_1614);label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),label.setPosition(ccWidth(bg_box)-75,42),bg_box.addChild(label),this.m_back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_back_btn.setPosition(ccWidth(bg_box)-9,ccHeight(bg_box)-26),this.m_back_btn.addClickEventListener(function(sender){this.m_gameObserver.postNotification(sceneStr[scene_MainHomeScene],NOTIFY_RETURN_USER_BONUS_HIDE)}.bind(this)),bg_box.addChild(this.m_back_btn),this.m_useBackKey=!1,this.m_back_btn.setEnabled(!1),this.createRewardItemLayer(bg_box);var text_icon=cc.Sprite.create("#img_attend_text.png");text_icon.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),text_icon.setPosition(ccPosX(label)-ccWidth(label)-10,34),bg_box.addChild(text_icon)},createRewardItemLayer:function(parent){var return_user_info=GameContext.getInstance().getReturnUserInfo(),layer=new cc.Layer;layer.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),layer.ignoreAnchorPointForPosition(!1),layer.setPosition(ZERO());var size=ccSize(parent);layer.setContentSize(size),parent.addChild(layer);var pos_list=[];14==this.m_login_bonus_list.length&&(pos_list=this.m_icon_pos[RETURN_USER_COUNT_14]);for(var i=0;i<this.m_login_bonus_list.length;i++){var bonus=this.m_login_bonus_list.at(i);if(i<pos_list.length){var p=pos_list[i];if(bonus.login_count<=return_user_info.login_count){var confirm_sprite=cc.Sprite.create("#img_attend_finish.png"),s_w=.5*confirm_sprite.getContentSize().width,s_h=.5*confirm_sprite.getContentSize().height;confirm_sprite.setAnchorPoint(ANCHOR_MIDDLE());var pos_x=p.x+s_w,pos_y=p.y+s_h;if(confirm_sprite.setPosition(pos_x,pos_y),layer.addChild(confirm_sprite),bonus.login_count==return_user_info.login_count)if(this.m_is_banner_click)this.m_back_btn.setEnabled(!0),this.m_useBackKey=!0;else{this.m_is_ani_layer=!0,this.m_today_login_bonus=bonus,confirm_sprite.setOpacity(0),confirm_sprite.setScale(2),return_user_info.login_count<this.m_login_bonus_list.length?this.m_tm_bonus_item_list=this.m_login_bonus_list[return_user_info.login_count].login_bonus_items:this.m_tm_bonus_item_list.clear();var callbackSound=cc.callFunc(this.confirmEffectSound.bind(this)),callbackEnd=cc.callFunc(this.effectEnd.bind(this));confirm_sprite.runAction(cc.sequence(cc.delayTime(.4),cc.spawn(callbackSound,cc.fadeIn(.3),cc.scaleTo(.3,1)),cc.delayTime(.2),callbackEnd)),this.m_useBackKey=!0}}}}return layer},confirmEffectSound:function(){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_attendance.mp3";audio.playEffect(path)},effectEnd:function(){this.m_animationLayer=new LoginBonusAnimationLayer,this.m_animationLayer.setItemInfo(this.m_today_login_bonus,this.m_tm_bonus_item_list),this.m_animationLayer.initLayout(LOGIN_BONUS_TYPE_RETURN_USER),this.addChild(this.m_animationLayer)},onNotification:function(){this.m_back_btn.setEnabled(!0),this.m_useBackKey=!0,this.m_is_ani_layer=!1},onEnter:function(){this._super(),MainObserver.getInstance().addObserver(this.onNotification,this,NOTIFICATION_LOGIN_ANI_END)},onExit:function(){MainObserver.getInstance().removeObserver(NOTIFICATION_LOGIN_ANI_END),this._super()},isAnimationEnd:function(){return null!=this.m_animationLayer&&this.m_animationLayer.isAnimationEnd()},isTodayEnd:function(){return null!=this.m_animationLayer&&this.m_animationLayer.isTodayEnd()},runTomorrowBonus:function(){this.m_animationLayer.runTomorrowBonus()},removeAnimationLayer:function(){null!=this.m_animationLayer&&(this.m_animationLayer.removeFromParent(),this.m_animationLayer=null)}}),PopupBannerLayer=cc.Layer.extend({m_is_banner_click:null,m_gnrl_img:null,m_bg_box:null,m_bg_img:null,m_bg_back_btn:null,ctor:function(){this.m_is_banner_click=null,this.m_gnrl_img=null,this._super(),this.init()},initLayout:function(banner,is_banner_click){this.m_is_banner_click=is_banner_click,this.m_gnrl_img="";GameContext.getInstance().getLoginBonus();cc.log("banner.img_path = "+banner.img_path);var path,img_path_replace2=banner.img_path.replace(".png","").replace("banner/img_event_banner_",""),banner_num=parseInt(img_path_replace2);path="data:image/png;base64,"+img_event_banner_imx[banner_num].replace(RS_HEX_KEY,RS_HEX_CON),USE_SP_MAIN_BANNER?(this.m_bg_box=new cc.Sprite(RES_CDN_DEFULT+"temp_img.png"),this.m_bg_box.setPosition(ccCenter(this)),this.m_bg_box.setContentSize(960,567),this.addChild(this.m_bg_box),this.m_bg_img=new cc.Sprite(path),this.m_bg_img.setScale(2),this.m_bg_img.setPosition(ccCenter(this.m_bg_box)),this.m_bg_box.addChild(this.m_bg_img)):(this.m_bg_box=new cc.Sprite(path),this.m_bg_box.setPosition(ccCenter(this)),this.addChild(this.m_bg_box)),this.m_bg_back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_bg_back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_bg_back_btn.setPosition(951,541),this.m_bg_back_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],NOTIFY_POPUP_BANNER_HIDE)}),this.m_bg_box.addChild(this.m_bg_back_btn)},confirmEffectSound:function(){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_attendance.mp3";audio.playEffect(path)},onEnter:function(){this._super()},onExit:function(){this._super(),null!=this.m_gnrl_img&&""!=this.m_gnrl_img&&(cc.loader.release(this.m_gnrl_img),this.m_gnrl_img=null),null!=this.m_bg_back_btn&&(this.m_bg_box.removeChild(this.m_bg_back_btn),this.m_bg_back_btn=null),null!=this.m_bg_img&&(this.m_bg_box.removeChild(this.m_bg_img),this.m_bg_img=null),null!=this.m_bg_box&&(this.removeChild(this.m_bg_box),this.m_bg_box=null)}}),SPECIAL_LOGIN_EVENT_ID=206,CHRISTMAS_LOGIN_EVENT=1,NEW_YEAR_LOGIN_EVENT=0,BGM_EVENT_NAME="BGM_marathon_loop_20001_present.mp3",MAX_PARTICLE_MTRL_NUM=12,LOGIN_BONUS_COUNT_PREMIUM=1,LOGIN_BONUS_COUNT_28=2,LOGIN_BONUS_COUNT_20=3,LOGIN_BONUS_COUNT_14=4,LOGIN_BONUS_COUNT_12=5,LOGIN_BONUS_COUNT_10=6,LOGIN_BONUS_COUNT_8=7,LOGIN_BONUS_COUNT_7=8,LOGIN_BONUS_COUNT_5=9,EventLoginBonusLayer=cc.Layer.extend({m_is_ani_layer:!1,m_is_banner_click:!1,m_tmrr_bonus_type:0,m_tmrr_bonus_cnt:0,m_tmrr_item_id:0,m_animationLayer:null,m_tableLayer:null,m_back_btn:null,m_back_btn_visible:null,m_login_id:0,m_login_bonus_list:[],m_premium_login_bonus:null,m_is_premium_login:!1,m_tmrr_login_bonus_item_list:[],m_tooltip_box:null,m_tooltip_title:null,m_tooltip_content:null,m_mask:null,m_is_playing_special_ani:!1,m_icon_pos:[],m_bg_box:null,m_bg_img:null,m_remain_dmm_point_label:null,m_dmm_point_use_period_label:null,m_receive_period_label:null,m_premium_detail_btn:null,m_shop_btn:null,m_label:null,m_text_icon:null,ctor:function(login_id){this.m_icon_pos=[],this.m_login_bonus_list=[],this.m_tableLayer=null,this.m_tmrr_login_bonus_item_list=[],this.m_is_ani_layer=!1,this.m_animationLayer=null,MainObserver.getInstance().removeObserver(NOTIFICATION_LOGIN_ANI_END),MainObserver.getInstance().addObserver(this.onNotification,this,NOTIFICATION_LOGIN_ANI_END),this._super(),this.init(login_id)},init:function(login_id){this.m_login_id=login_id,UserService.getInstance().getLoginBonusInfo(LOGIN_BONUS_TYPE_EVENT,this.m_login_bonus_list,this.m_login_id),stable(this.m_login_bonus_list,function(l,r){return l.login_count<r.login_count});for(var pl_list=MasterTable.getInstance().get_PremiumLoginBonusList([]),i=0;i<pl_list.length;i++)if(pl_list[i].login_id==login_id){this.m_premium_login_bonus=pl_list[i],this.m_is_premium_login=!0;break}return!0},setIconPos:function(){this.m_icon_pos.clear();var pos=[];pos.push_back(cc.p(104,386)),pos.push_back(cc.p(104,310)),pos.push_back(cc.p(104,234)),pos.push_back(cc.p(104,158)),pos.push_back(cc.p(104,82)),pos.push_back(cc.p(391,386)),pos.push_back(cc.p(391,310)),pos.push_back(cc.p(391,234)),pos.push_back(cc.p(391,158)),pos.push_back(cc.p(391,82)),this.m_icon_pos[LOGIN_BONUS_COUNT_PREMIUM]=pos;var pos_1=[];pos_1.push_back(cc.p(0,110)),pos_1.push_back(cc.p(110,110)),pos_1.push_back(cc.p(220,110)),pos_1.push_back(cc.p(330,110)),pos_1.push_back(cc.p(0,0)),pos_1.push_back(cc.p(110,0)),pos_1.push_back(cc.p(220,0)),pos_1.push_back(cc.p(330,0)),this.m_icon_pos[LOGIN_BONUS_COUNT_8]=pos_1;var pos_2=[];pos_2.push_back(cc.p(0,110)),pos_2.push_back(cc.p(110,110)),pos_2.push_back(cc.p(220,110)),pos_2.push_back(cc.p(330,110)),pos_2.push_back(cc.p(440,110)),pos_2.push_back(cc.p(0,0)),pos_2.push_back(cc.p(110,0)),pos_2.push_back(cc.p(220,0)),pos_2.push_back(cc.p(330,0)),pos_2.push_back(cc.p(440,0)),this.m_icon_pos[LOGIN_BONUS_COUNT_10]=pos_2;var pos_3=[];pos_3.push_back(cc.p(0,110)),pos_3.push_back(cc.p(110,110)),pos_3.push_back(cc.p(220,110)),pos_3.push_back(cc.p(330,110)),pos_3.push_back(cc.p(440,110)),pos_3.push_back(cc.p(550,110)),pos_3.push_back(cc.p(0,0)),pos_3.push_back(cc.p(110,0)),pos_3.push_back(cc.p(220,0)),pos_3.push_back(cc.p(330,0)),pos_3.push_back(cc.p(440,0)),pos_3.push_back(cc.p(550,0)),this.m_icon_pos[LOGIN_BONUS_COUNT_12]=pos_3;var pos_4=[];pos_4.push_back(cc.p(0,0)),pos_4.push_back(cc.p(110,0)),pos_4.push_back(cc.p(220,0)),pos_4.push_back(cc.p(330,0)),pos_4.push_back(cc.p(440,0)),this.m_icon_pos[LOGIN_BONUS_COUNT_5]=pos_4},initLayout:function(is_banner_click){if(this.setIconPos(),this.m_is_banner_click=is_banner_click,this.m_login_id==SPECIAL_LOGIN_EVENT_ID){this.m_is_playing_special_ani=!0,AudioEngine.getInstance().stopEffectsAll();var win_size=cc.director.getWinSize();this.m_mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal_2.png",RectZero()),this.m_mask.setAnchorPoint(ANCHOR_MIDDLE()),this.m_mask.setPosition(ccCenter(this)),this.m_mask.setPreferredSize(win_size),this.addChild(this.m_mask),this.m_mask.setOpacity(0);var callbackPlayMusic=new cc.CallFunc(this.playSpecialMusic.bind(this)),callbackDarkFadeInEnd=new cc.CallFunc(this.darkFadeInEffectEnd.bind(this)),callbackStopMusic=new cc.CallFunc(this.stopSpecialMusic.bind(this)),seq=new cc.Sequence(new cc.DelayTime(.2),new cc.Spawn(callbackPlayMusic,new cc.FadeIn(1)),new cc.DelayTime(.2),callbackDarkFadeInEnd,new cc.DelayTime(3.5),callbackStopMusic);this.m_mask.runAction(seq);var white_bg=new cc.LayerColor(cc.color.WHITE);return white_bg.setContentSize(ccSize(this.m_mask)),white_bg.setAnchorPoint(ZERO()),white_bg.setPosition(ZERO()),white_bg.setTag(1),this.m_mask.addChild(white_bg),void white_bg.setVisible(!1)}var path;cc.log("m_login_id = ["+this.m_login_id+"]"),path="data:image/png;base64,"+img_attend_banner_imx[this.m_login_id].replace(RS_HEX_KEY,RS_HEX_CON),USE_SP_MAIN_BANNER?(this.m_bg_box=cc.Sprite.create(RES_CDN_DEFULT+"temp_img.png"),this.m_bg_box.setContentSize(960,567),this.m_bg_box.setAnchorPoint(ANCHOR_MIDDLE()),this.m_bg_box.setPosition(ccCenter(this)),this.addChild(this.m_bg_box),this.m_bg_img=new cc.Sprite(path),this.m_bg_img.setScale(2),this.m_bg_img.setPosition(ccCenter(this.m_bg_box)),this.m_bg_box.addChild(this.m_bg_img)):(this.m_bg_box=cc.Sprite.create(path),this.m_bg_box.setPosition(ccCenter(this)),this.addChild(this.m_bg_box));var mt=MasterManager.getInstance();this.m_back_btn=new ccui.Button("btn_cancel_off.png","btn_cancel_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_back_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],NOTIFY_EVENT_LOGIN_HIDE)}),is_banner_click||this.m_back_btn.setEnabled(!1),this.m_back_btn_visible=cc.Sprite.create("#btn_cancel_off.png");var x=0,y=74;if(this.m_tableLayer=this.getTableLayer(),this.m_is_premium_login){for(var user_login_bonus=GameContext.getInstance().getLoginBonus(),event_login_count=0,idx=0;idx<user_login_bonus.event_login_list.length;idx++){var i=user_login_bonus.event_login_list[idx];if(i.event_login_id==this.m_login_id){event_login_count=i.event_login_count;break}}var remain_point=this.m_premium_login_bonus.need_dmm_point,point_key=NetService().getUserPremiumDmmPointKey();null!=point_key&&null!=point_key&&(remain_point-=point_key.dmm_point_key.use_dmm_point),this.m_remain_dmm_point_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_241),this.m_remain_dmm_point_label.setAnchorPoint(ZERO()),USE_SP_MAIN_BANNER?this.m_remain_dmm_point_label.setPosition(118,482):this.m_remain_dmm_point_label.setPosition(118,518),this.m_bg_box.addChild(this.m_remain_dmm_point_label),remain_point<=0||0<event_login_count?this.m_remain_dmm_point_label.setString(mt.get_LanguageData("label_premiun_login_bonus_pregress")):this.m_remain_dmm_point_label.setString(cmString(mt.get_LanguageData("label_premium_login_bonus_remain_dmm_point"),remain_point));var moment_date_bs=moment(this.m_premium_login_bonus.beg_dt),moment_date=moment(this.m_premium_login_bonus.end_dt),begin_dt={year:moment_date_bs.year(),month:moment_date_bs.month()+1,day:moment_date_bs.date(),hour:moment_date_bs.hour(),minute:moment_date_bs.minute(),"second ":moment_date_bs.second()},end_dt={year:moment_date.year(),month:moment_date.month()+1,day:moment_date.date(),hour:moment_date.hour(),minute:moment_date.minute(),"second ":moment_date.second()};this.m_dmm_point_use_period_label=cmLabel.getLabel(cmString(res_str("label_premium_login_bonus_dmm_point_use_period"),begin_dt.month,begin_dt.day,begin_dt.hour,begin_dt.minute,end_dt.month,end_dt.day,end_dt.hour,end_dt.minute),LABEL_FONT_INDEX.FONT_161),this.m_dmm_point_use_period_label.setAnchorPoint(ZERO()),USE_SP_MAIN_BANNER?this.m_dmm_point_use_period_label.setPosition(118,458):this.m_dmm_point_use_period_label.setPosition(118,494),this.m_bg_box.addChild(this.m_dmm_point_use_period_label);var mng=mt.get_LoginBonusManagement(this.m_login_id,LOGIN_BONUS_TYPE_EVENT),moment_mng=moment(mng.end_dt),mng_dt={year:moment_mng.year(),month:moment_mng.month()+1,day:moment_mng.date(),hour:moment_mng.hour(),minute:moment_mng.minute(),"second ":moment_mng.second()};this.m_receive_period_label=cmLabel.getLabel(cmString(res_str("label_premium_login_bonus_receive_period"),mng_dt.month,mng_dt.day,mng_dt.hour,mng_dt.minute),LABEL_FONT_INDEX.FONT_161),this.m_receive_period_label.setAnchorPoint(ZERO()),USE_SP_MAIN_BANNER?this.m_receive_period_label.setPosition(118,437):this.m_receive_period_label.setPosition(118,473),this.m_bg_box.addChild(this.m_receive_period_label),this.m_back_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_back_btn.setPosition(ccWidth(this)-10,553),this.addChild(this.m_back_btn),this.m_back_btn_visible.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_back_btn_visible.setPosition(ccWidth(this)-10,553),this.addChild(this.m_back_btn_visible),this.m_tableLayer.setPosition(ZERO()),this.m_is_banner_click&&(this.m_premium_detail_btn=new ccui.Button("btn_premium_detail_off.png","btn_premium_detail_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_premium_detail_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_premium_detail_btn.setPosition(ccWidth(this)-10,144),this.addChild(this.m_premium_detail_btn),this.m_premium_detail_btn.addClickEventListener(function(sender){MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],btn_premium_login_info)}),this.m_shop_btn=new ccui.Button("btn_premium_dmm_off.png","btn_premium_dmm_on.png","",ccui.Widget.PLIST_TEXTURE),this.m_shop_btn.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_shop_btn.setPosition(ccWidth(this)-10,94),this.addChild(this.m_shop_btn),this.m_shop_btn.addClickEventListener(function(sender){var req={};req.opcode=net.OP.op_get_user_shop_jade_first_buy_info;var mainScene=SceneManager.getInstance().getMainScene();GameClient().write(req,mainScene.onNetworkEvent)}))}else this.m_bg_box.setContentSize(cc.size(960,567)),this.m_back_btn.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_back_btn.setPosition(ccWidth(this.m_bg_box)-9,ccHeight(this.m_bg_box)-26),this.m_bg_box.addChild(this.m_back_btn),this.m_back_btn_visible.setAnchorPoint(ANCHOR_TOP_RIGHT()),this.m_back_btn_visible.setPosition(ccWidth(this.m_bg_box)-9,ccHeight(this.m_bg_box)-26),this.m_bg_box.addChild(this.m_back_btn_visible),7==this.m_login_bonus_list.size()?x=67:5==this.m_login_bonus_list.size()||8==this.m_login_bonus_list.size()||10==this.m_login_bonus_list.size()||12==this.m_login_bonus_list.size()?x=84:20==this.m_login_bonus_list.size()?(x=71,y=78):14==this.m_login_bonus_list.size()&&(x=61,y=63),this.m_tableLayer.setPosition(x,y),this.m_label=cmLabel.getLabel(mt.get_LanguageData("label_attendance_info"),LABEL_FONT_INDEX.FONT_1614),this.m_label.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_label.setPosition(ccWidth(this.m_bg_box)-75,42),this.m_bg_box.addChild(this.m_label),this.m_text_icon=cc.Sprite.create("#img_attend_text.png"),this.m_text_icon.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_text_icon.setPosition(ccPosX(this.m_label)-ccWidth(this.m_label)-10,34),this.m_bg_box.addChild(this.m_text_icon);this.m_bg_box.addChild(this.m_tableLayer),this.initTooltipBox()},getTableLayer:function(){var layer=new cc.Layer,login_bonus_list_size=this.m_login_bonus_list.length;if(this.m_is_premium_login)for(var i=0;i<login_bonus_list_size;++i){var bonus=this.m_login_bonus_list[i],item_layer=this.getBonusItemLayer(bonus),pos=this.m_icon_pos[LOGIN_BONUS_COUNT_PREMIUM];item_layer.setPosition(pos.at(i)),layer.addChild(item_layer)}else if(28==login_bonus_list_size)for(var x=68,y=320,j=0;j<login_bonus_list_size;++j){bonus=this.m_login_bonus_list[j];0!=j&&j%7==0&&(x=68,y-=107),(item_layer=this.getBonusItemLayer(bonus)).setPosition(x,y),layer.addChild(item_layer),x+=121}else if(20==login_bonus_list_size)for(x=0,y=85,j=0;j<login_bonus_list_size;++j){bonus=this.m_login_bonus_list.at(j);0!=j&&j%10==0&&(x=0,y-=85),(item_layer=this.getBonusItemLayer(bonus)).setPosition(x,y),layer.addChild(item_layer),cc.log(cmString("x : %f, y : %f",x,y)),x+=82}else if(14==login_bonus_list_size)for(x=0,y=85,j=0;j<login_bonus_list_size;++j){bonus=this.m_login_bonus_list.at(j);0!=j&&j%7==0&&(x=0,y-=85),(item_layer=this.getBonusItemLayer(bonus)).setPosition(x,y),layer.addChild(item_layer),cc.log(cmString("x : %f, y : %f",x,y)),x+=82}else for(i=0;i<login_bonus_list_size;++i){bonus=this.m_login_bonus_list[i],item_layer=this.getBonusItemLayer(bonus);if(8==login_bonus_list_size){pos=this.m_icon_pos[LOGIN_BONUS_COUNT_8];item_layer.setPosition(pos.at(i))}else if(10==login_bonus_list_size){pos=this.m_icon_pos[LOGIN_BONUS_COUNT_10];item_layer.setPosition(pos.at(i))}else if(12==login_bonus_list_size){pos=this.m_icon_pos[LOGIN_BONUS_COUNT_12];item_layer.setPosition(pos.at(i))}else if(5==login_bonus_list_size){pos=this.m_icon_pos[LOGIN_BONUS_COUNT_5];item_layer.setPosition(pos.at(i))}layer.addChild(item_layer)}return layer},getBonusItemLayer:function(bonus){for(var user_login_bonus=GameContext.getInstance().getLoginBonus(),event_login_count=0,idx=0;idx<user_login_bonus.event_login_list.length;idx++){var i=user_login_bonus.event_login_list[idx];if(i.event_login_id==this.m_login_id){event_login_count=i.event_login_count;break}}var layer=new cc.Layer;if(this.m_is_premium_login){layer.setContentSize(285,74);var btn_index=0;for(idx=0;idx<bonus.login_bonus_items.length;idx++){var item=bonus.login_bonus_items[idx],btn=new ccui.Button("btn_ghost_off.png","btn_ghost_off.png","",ccui.Widget.PLIST_TEXTURE);btn.setAnchorPoint(ZERO()),btn.setPosition(85+65*btn_index,10),btn.setTag(item),btn.addTouchEventListener(function(sender,type){var btn=sender;if(type==ccui.Widget.TOUCH_BEGAN){this.showTooltip(btn.getTag().login_bonus_idx);var pos=layer.convertToWorldSpace(btn.getPosition());this.m_tooltip_box.setPosition(pos.x+ccWidth(btn)+35,pos.y)}type!=ccui.Widget.TOUCH_ENDED&&type!=ccui.Widget.TOUCH_CANCELED||this.hideTooltip()}.bind(this),this),layer.addChild(btn),btn_index++}}else 20==this.m_login_bonus_list.size()?layer.setContentSize(80,80):layer.setContentSize(98,98);if(bonus.login_count<=event_login_count){var confirm_sprite=cc.Sprite.create("#img_attend_finish.png");if(confirm_sprite.setAnchorPoint(ANCHOR_MIDDLE()),20==this.m_login_bonus_list.size()&&confirm_sprite.setScale(.8),this.m_is_premium_login){var mask=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",cc.rect(0,0,0,0));mask.setPreferredSize(cc.size(285,74)),USE_SP_MAIN_BANNER?mask.setPosition(layer.width/2-90,layer.height/2-36):mask.setPosition(ccCenter(layer)),layer.addChild(mask),confirm_sprite.setPosition(ccCenter(mask)),mask.addChild(confirm_sprite),confirm_sprite.setOpacity(0)}else confirm_sprite.setPosition(ccCenter(layer)),layer.addChild(confirm_sprite),confirm_sprite.setOpacity(0);if(bonus.login_count==event_login_count)if(this.m_is_banner_click)confirm_sprite.setOpacity(255),null!=this.m_back_btn&&this.m_back_btn.setEnabled(!0);else{if(this.m_is_ani_layer=!0,this.m_today_login_bonus=bonus,null!=this.m_back_btn&&this.m_back_btn.setEnabled(!1),confirm_sprite.setScale(2),event_login_count<this.m_login_bonus_list.length){var tmrr_login_bonus=this.m_login_bonus_list[event_login_count];this.m_tmrr_login_bonus_item_list=tmrr_login_bonus.login_bonus_items}cc.log("caaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa");var callbackSound=cc.callFunc(this.confirmEffectSound.bind(this)),callbackEnd=cc.callFunc(this.effectEnd.bind(this)),scale_action=null;scale_action=20==this.m_login_bonus_list.length?new cc.ScaleTo(.3,.8):new cc.ScaleTo(.3,1),confirm_sprite.runAction(cc.sequence(cc.delayTime(.4),cc.spawn(callbackSound,cc.fadeIn(.3),scale_action),cc.delayTime(.2),callbackEnd))}else confirm_sprite.setOpacity(255),null!=this.m_back_btn&&this.m_back_btn.setEnabled(!0)}return layer},confirmEffectSound:function(){var audio=AudioEngine.getInstance(),path=RES_CDN_SOUND+SND_TYPE+"sound/SE_attendance.mp3";audio.playEffect(path)},effectEnd:function(){this.m_login_id==SPECIAL_LOGIN_EVENT_ID?(this.m_is_playing_special_ani=!1,this.m_animationLayer=new SpecialLoginBonusAnimationLayer(this.m_login_id)):(this.m_animationLayer=new LoginBonusAnimationLayer,this.m_animationLayer.setItemInfo(this.m_today_login_bonus,this.m_tmrr_login_bonus_item_list)),this.m_animationLayer.initLayout(this.m_login_id),this.addChild(this.m_animationLayer)},darkFadeInEffectEnd:function(){if(null!=this.m_mask)for(var i=1;i<=MAX_PARTICLE_MTRL_NUM;i++)this.m_mask.addChild(this.particle_snow(i),31)},particle_snow:function(index){var size=cc.director.getWinSize(),m_emitter=null,snow="";return(m_emitter=CHRISTMAS_LOGIN_EVENT?new cc.ParticleSystem(200):NEW_YEAR_LOGIN_EVENT?new cc.ParticleSystem(900):new cc.ParticleSystem(200)).texture=CHRISTMAS_LOGIN_EVENT?(snow=index%2==0?RES_CDN_DEFULT+"env_effect/snow_particle_back.png":RES_CDN_DEFULT+"env_effect/snow_particle_front.png",cc.textureCache.addImage(snow)):NEW_YEAR_LOGIN_EVENT?(snow=RES_CDN_DEFULT+cmString("uieffect_2/img_eventvs_flowerpaper_%02d.png",index),cc.textureCache.addImage(snow)):cc.textureCache.addImage(RES_CDN_DEFULT+"env_effect/hscene_snow_front.png"),m_emitter.angle=120,m_emitter.angleVar=360,m_emitter.duration=-1,m_emitter.emitterMode=cc.ParticleSystem.MODE_GRAVITY,m_emitter.endColor=cc.color(176,205,255,255),m_emitter.endColorVar=cc.color(0,0,0,0),m_emitter.endSize=20,m_emitter.endSizeVar=0,m_emitter.gravity=cc.p(0,-9),m_emitter.life=6,m_emitter.lifeVar=0,m_emitter.radialAccel=0,m_emitter.radialAccelVar=0,m_emitter.tangentialAccel=30,m_emitter.tangentialAccelVar=0,m_emitter.x=size.width,m_emitter.y=size.height+20,m_emitter.posVar=cc.p(size.width/.1,0),m_emitter.speed=60,m_emitter.speedVar=20,m_emitter.startSpin=30,m_emitter.startSpinVar=60,m_emitter.endSpin=60,m_emitter.endSpinVar=60,m_emitter.startColor=cc.color(176,205,255,205),m_emitter.startColorVar=cc.color(0,0,0,52),m_emitter.startSize=42,m_emitter.startSizeVar=2,m_emitter.emissionRate=100,m_emitter},playSpecialMusic:function(){var audio=AudioEngine.getInstance();audio.stopBackgroundMusic()},stopSpecialMusic:function(){var audio=AudioEngine.getInstance();if(null!=this.m_mask){var color_node=this.m_mask.getChildByTag(1);if(null!=color_node){color_node.setOpacity(0),color_node.setVisible(!0);var callbackEnd=new cc.CallFunc(this.effectEnd.bind(this)),seq=new cc.Sequence(new cc.FadeIn(1),callbackEnd);color_node.runAction(seq)}}var sound_path=RES_CDN_SOUND+SND_TYPE+"sound/SE_gacha_result.mp3";audio.playEffect(sound_path)},onNotification:function(){null!=this.m_back_btn&&this.m_back_btn.setEnabled(!0),this.m_is_ani_layer=!1},onEnter:function(){this._super()},onExit:function(){this._super(),null!=this.m_tableLayer&&(this.m_bg_box.removeChild(this.m_tableLayer),this.m_tableLayer=null),null!=this.m_text_icon&&(this.m_bg_box.removeChild(this.m_text_icon),this.m_text_icon=null),null!=this.m_label&&(this.m_bg_box.removeChild(this.m_label),this.m_label=null),null!=this.m_back_btn_visible&&(this.m_bg_box.removeChild(this.m_back_btn_visible),this.m_back_btn_visible=null),null!=this.m_back_btn&&(this.m_bg_box.removeChild(this.m_back_btn),this.m_back_btn=null),null!=this.m_shop_btn&&(this.removeChild(this.m_shop_btn),this.m_shop_btn=null),null!=this.m_premium_detail_btn&&(this.removeChild(this.m_premium_detail_btn),this.m_premium_detail_btn=null),null!=this.m_back_btn_visible&&(this.removeChild(this.m_back_btn_visible),this.m_back_btn_visible=null),null!=this.m_back_btn&&(this.removeChild(this.m_back_btn),this.m_back_btn=null),null!=this.m_back_btn&&(this.removeChild(this.m_back_btn),this.m_back_btn=null),null!=this.m_receive_period_label&&(this.m_bg_box.removeChild(this.m_receive_period_label),this.m_receive_period_label=null),null!=this.m_dmm_point_use_period_label&&(this.m_bg_box.removeChild(this.m_dmm_point_use_period_label),this.m_receive_period_label=null),null!=this.m_remain_dmm_point_label&&(this.m_bg_box.removeChild(this.m_remain_dmm_point_label),this.m_remain_dmm_point_label=null),null!=this.m_bg_img&&(this.m_bg_box.removeChild(this.m_bg_img),this.m_bg_img=null),null!=this.m_bg_box&&(this.removeChild(this.m_bg_box),this.m_bg_box=null)},isAnimationEnd:function(){return null!=this.m_animationLayer&&this.m_animationLayer.isAnimationEnd()},isSpecialEvent:function(){return this.m_login_id==SPECIAL_LOGIN_EVENT_ID},isTodayEnd:function(){return this.m_login_id==SPECIAL_LOGIN_EVENT_ID?!this.m_is_playing_special_ani:null!=this.m_animationLayer&&this.m_animationLayer.isTodayEnd()},runTomorrowBonus:function(){if(this.m_login_id==SPECIAL_LOGIN_EVENT_ID){var audio=AudioEngine.getInstance();return audio.stopBackgroundMusic(),audio.stopEffectsAll(),audio.m_bgmPath="",void this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[scene_MainHomeScene],NOTIFY_EVENT_LOGIN_HIDE)},0,"NOTIFY_EVENT_LOGIN_HIDE")}this.m_animationLayer.runTomorrowBonus()},removeAnimationLayer:function(){null!=this.m_animationLayer&&(this.removeChild(this.m_animationLayer),this.m_animationLayer.removeFromParent(),this.m_animationLayer=null)},initTooltipBox:function(){null==this.m_tooltip_box&&(this.m_tooltip_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_result_box.png",cc.Rect(20,20,20,20)),this.m_tooltip_box.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_tooltip_box.setVisible(!1),this.addChild(this.m_tooltip_box)),null==this.m_tooltip_title&&(this.m_tooltip_title=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_1810),this.m_tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_tooltip_box.addChild(this.m_tooltip_title)),null==this.m_tooltip_content&&(this.m_tooltip_content=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_181),this.m_tooltip_content.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_tooltip_box.addChild(this.m_tooltip_content))},hideTooltip:function(){null!=this.m_tooltip_box&&this.m_tooltip_box.setVisible(!1)},showTooltip:function(login_bonus_idx){this.m_tooltip_box.setVisible(!0);var m=MasterManager.getInstance(),login_bonus=m.get_LoginBonus(login_bonus_idx);if(login_bonus.bonus_type==BONUS_TYPE_YUNHEE_FIX){var gnrl=m.get_General(login_bonus.item_id);if(""==(tooltip=MasterTable.getInstance().get_TooltipGeneral(gnrl.gnrl_id)).content){this.m_tooltip_title.setString(gnrl.name),this.m_tooltip_title.setAnchorPoint(ANCHOR_MIDDLE()),this.m_tooltip_content.setString(tooltip.content);var tSize=ccSize(this.m_tooltip_title);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(64,tSize.width+20),bSize.height=Math.max(54,bSize.height+10),this.m_tooltip_box.setContentSize(bSize),this.m_tooltip_title.setPosition(ccCenter(bSize))}else{this.m_tooltip_title.setString(gnrl.name),this.m_tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_tooltip_content.setString(tooltip.content);tSize=ccSize(this.m_tooltip_title);var cSize=ccSize(this.m_tooltip_content);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(tSize.width+20,cSize.width+20),bSize.height=Math.max(64,bSize.height+cSize.height+5),this.m_tooltip_box.setContentSize(bSize),this.m_tooltip_title.setPosition(10,bSize.height-10),this.m_tooltip_content.setPosition(10,bSize.height-15-tSize.height)}}else{var tooltip,bonus=m.get_BonusType(login_bonus.bonus_type);if(""==(tooltip=MasterTable.getInstance().get_TooltipItem(login_bonus.bonus_type)).content){this.m_tooltip_title.setString(bonus.name),this.m_tooltip_title.setAnchorPoint(ANCHOR_MIDDLE()),this.m_tooltip_content.setString(tooltip.content);tSize=ccSize(this.m_tooltip_title);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(64,tSize.width+20),bSize.height=Math.max(54,bSize.height+10),this.m_tooltip_box.setContentSize(bSize),this.m_tooltip_title.setPosition(ccCenter(bSize))}else{this.m_tooltip_title.setString(bonus.name),this.m_tooltip_title.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_tooltip_content.setString(tooltip.content);var bSize;tSize=ccSize(this.m_tooltip_title),cSize=ccSize(this.m_tooltip_content);(bSize=cc.size(tSize.width+20,tSize.height+20)).width=Math.max(tSize.width+20,cSize.width+20),bSize.height=Math.max(64,bSize.height+cSize.height+5),this.m_tooltip_box.setContentSize(bSize),this.m_tooltip_title.setPosition(10,bSize.height-10),this.m_tooltip_content.setPosition(10,bSize.height-15-tSize.height)}}}}),NamingListCell=cc.TableViewCell.extend({m_itemLayer:null,m_callback:null,m_btnSprite:[],m_nameLabel:[],m_data:null,ctor:function(_callback){this._super(),this.m_itemLayer=null,this.m_callback=null,this.m_btnSprite=[],this.m_nameLabel=[],this.m_data=null,this.init(_callback)},init:function(_callback){return this.m_callback=_callback,this.m_itemLayer=this.getItemLayer(),this.m_itemLayer.setAnchorPoint(ZERO()),this.m_itemLayer.setPosition(ZERO()),this.addChild(this.m_itemLayer),!0},getItemLayer:function(){var layer=new cc.Layer,size=cc.size(150,40);layer.setContentSize(size);var img_paths=[];img_paths.push("#btn_37_off.png"),img_paths.push("#btn_37_on.png");for(var i=0;i<img_paths.length;i++){var img=cc.Sprite.create(img_paths[i]);img.setAnchorPoint(ZERO()),img.setPosition(ZERO()),layer.addChild(img);var name_label=cmLabel.getLabel(res_str("label_none_text"),LABEL_FONT_INDEX.FONT_201);name_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),name_label.setPosition(12,ccCenter(img).y),img.addChild(name_label),this.m_btnSprite.push(img),this.m_nameLabel.push(name_label)}return this.m_btnSprite[1].setVisible(!1),layer},setData:function(data){this.m_data=data,this.updateCell()},updateCell:function(){for(var i=0;i<this.m_nameLabel.length;i++)this.m_nameLabel[i].setString(this.m_data.name)},touchPosCell:function(pos){var r=this.m_itemLayer.getBoundingBox();cc.rectContainsPoint(r,pos)&&null!=this.m_callback&&this.m_callback(this.m_data)},touchCellHighlight:function(pos){var r=this.m_itemLayer.getBoundingBox();cc.rectContainsPoint(r,pos)&&(this.m_btnSprite[0].setVisible(!1),this.m_btnSprite[1].setVisible(!0))},touchCellUnHighlight:function(pos){var r=this.m_itemLayer.getBoundingBox();cc.rectContainsPoint(r,pos)&&(this.m_btnSprite[0].setVisible(!0),this.m_btnSprite[1].setVisible(!1))}}),NAMING_TABLE_VIEW_WIDTH=156,NAMING_TABLE_VIEW_HEIGHT=40,NamingListLayer=cc.Layer.extend({m_isNameListVisible:!1,m_nameBtn:null,m_nameTableView:null,m_selectedId:0,m_position:0,m_callback:null,m_namingInfoList:[],ctor:function(_callback){this._super(),this.init(_callback)},init:function(_callback){return this.m_callback=_callback,!0},onEnter:function(){this._super()},onExit:function(){this._super()},setNamingData:function(naming_info,position){this.m_namingInfoList=[],this.m_selectedId=0,this.m_position=position;for(var mt=MasterManager.getInstance(),i=0;i<naming_info.length;i++){var naming_type=mt.get_NamingType(naming_info[i].naming_type);naming_type.naming_type!=position+1&&naming_type.naming_type!=NAMING_TYPE_ALL||(1==(naming_info[i].position>>position&1)&&"y"==naming_info[i].use_yn&&(this.m_selectedId=naming_info[i].naming_id),this.m_namingInfoList.push($.extend({},naming_info[i])))}var posInfo=GameContext.getInstance().getChangedNamingIdx();if(0<posInfo.length){var curSetNameing=posInfo[position];this.m_selectedId=curSetNameing}},createLayer:function(){var selected_name="";0<this.m_selectedId?selected_name=MasterManager.getInstance().get_Naming(this.m_selectedId).name:selected_name=res_str("label_none_text");this.m_nameBtn=new LabelButton("btn_37_off.png","btn_37_on.png","btn_37_off.png",ccui.Widget.PLIST_TEXTURE),this.m_nameBtn.setAnchorPoint(ZERO()),this.m_nameBtn.setPosition(ZERO()),this.m_nameBtn.setFont(LABEL_FONT_INDEX.FONT_201),this.m_nameBtn.setString(selected_name),this.addChild(this.m_nameBtn),this.m_nameBtn.addClickEventListener(function(){null!=this.m_callback&&this.m_callback(this.m_position),this.toggleDisplayNameMenu()}.bind(this));var arrow_img=cc.Sprite.create(RES_CDN_DEFULT+"common/img_btn_arrow.png");arrow_img.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),arrow_img.setPosition(ccWidth(this.m_nameBtn)-12,ccCenter(this.m_nameBtn).y),this.m_nameBtn.addChild(arrow_img);var table_view_width=ccWidth(this.m_nameBtn),table_height=40*(this.m_namingInfoList.length+1);300<table_height&&(table_height=300);var tSize=cc.size(table_view_width,table_height);this.m_nameTableView=new cc.TableView(this,tSize),this.m_nameTableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),this.m_nameTableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),this.m_nameTableView.ignoreAnchorPointForPosition(!1),this.m_nameTableView.setPosition(0,0),this.m_nameTableView.setAnchorPoint(ANCHOR_TOP_LEFT()),this.m_nameTableView.setDelegate(this),this.m_nameTableView.setVisible(!1),this.m_nameTableView.scrollBarEnable(!0),this.addChild(this.m_nameTableView),this.m_nameTableView.reloadData(),this.setContentSize(ccSize(this.m_nameBtn))},toggleDisplayNameMenu:function(){this.m_isNameListVisible?(null!=this.m_nameTableView&&this.m_nameTableView.setVisible(!1),this.m_isNameListVisible=!1):(null!=this.m_nameTableView&&this.m_nameTableView.setVisible(!0),this.m_isNameListVisible=!0)},setDisplayNameMenu:function(is_visible){this.m_isNameListVisible=is_visible,null!=this.m_nameTableView&&this.m_nameTableView.setVisible(is_visible)},isDisplayNameMenu:function(){return this.m_isNameListVisible},setSelectedName:function(str_index){},getSelectedNamingId:function(){return cc.log("$$$$$$$$$$ m_selectedId : "+this.m_selectedId),this.m_selectedId},cellSizeForTable:function(table){return cc.size(NAMING_TABLE_VIEW_WIDTH,NAMING_TABLE_VIEW_HEIGHT)},tableCellAtIndex:function(table,idx){var c=table.dequeueCell(),cell=null;cell=null!=c?c:new NamingListCell(this.tableCellSelectedCallback.bind(this));var cell_data={};return 0==idx?(cell_data.naming_id=0,cell_data.name=res_str("label_none_text")):cell_data=this.m_namingInfoList[idx-1],cell.setData(cell_data),cell},numberOfCellsInTableView:function(table){return this.m_namingInfoList.length+1},tableCellTouched:function(table,cell){null!=cell&&cell.touchPosCell(cell.getTouchPos())},tableCellEnded:function(){},tableCellSizeForIndex:function(){return cc.size(156,40)},tableCellHighlight:function(table,cell){null!=cell&&cell.touchCellHighlight(cell.getTouchPos())},tableCellUnhighlight:function(table,cell){null!=cell&&cell.touchCellUnHighlight(cell.getTouchPos())},tableCellSelectedCallback:function(cell_data){this.m_selectedId=cell_data.naming_id,null!=this.m_nameBtn&&this.m_nameBtn.setString(cell_data.name),this.scheduleOnce(function(float){var parentLayer=this.getParent();MainObserver.getInstance().postNotification(sceneStr[parentLayer.getParent().m_sceneId],NOTIFY_NAMING_SETTING_SELECTED)}.bind(this),0,"NOTIFY_NAMING_SETTING_SELECTED")}}),MAX_NAME_POSOTION=3,NamingSettingPopup=cc.Layer.extend({m_namingListLayer:null,m_btnYes:null,m_btnNo:null,ctor:function(){this._super(),this.createLayer()},createLayer:function(){this.m_namingListLayer=[];var size=cc.size(518,330),info_box=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_script_box_2.png",cc.Rect(40,40,10,10));info_box.setPreferredSize(size),info_box.setPosition(ccCenter(this)),this.addChild(info_box);var navi=new cc.Scale9Sprite(RES_CDN_DEFULT+"common/img_9p_navi.png",cc.Rect(20,20,20,20));navi.setContentSize(ccWidth(info_box)-16,ccHeight(navi)),navi.setAnchorPoint(ANCHOR_TOP_LEFT()),navi.setPosition(8,ccHeight(info_box)-10),info_box.addChild(navi);var title_label=cmLabel.getLabel(res_str("label_naming_setting_title"),LABEL_FONT_INDEX.FONT_261);title_label.setAnchorPoint(ANCHOR_MIDDLE()),title_label.setPosition(.5*ccWidth(navi),ccCenter(navi).y+3),navi.addChild(title_label);for(var naming_info_list=UserService.getInstance().getUserNamingInfo(),pos_x=17,i=0;i<MAX_NAME_POSOTION;i++){var name_list_layer=new NamingListLayer(this.comboBoxCallback.bind(this));name_list_layer.setNamingData(naming_info_list,i),name_list_layer.createLayer(),name_list_layer.setAnchorPoint(ZERO()),name_list_layer.setPosition(pos_x,172),info_box.addChild(name_list_layer,10),pos_x+=ccWidth(name_list_layer)+8,this.m_namingListLayer.push(name_list_layer)}var btn_no=new LabelButton("btn_18_off.png","btn_18_on.png","",ccui.Widget.PLIST_TEXTURE);btn_no.setFont(LABEL_FONT_INDEX.FONT_261),btn_no.setString(res_str("btn_label_cancel")),btn_no.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),btn_no.setPosition(ccCenter(info_box).x-5,16),info_box.addChild(btn_no,8),btn_no.addClickEventListener(function(sender){for(var i=0;i<this.m_namingListLayer.length;i++)if(this.m_namingListLayer[i].isDisplayNameMenu())return;this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[GameContext.getInstance().getCurrentScene()],NOTIFY_NAMING_SETTING_POPUP_HIDE)},0,"cancelNamingSetting")}.bind(this));var btn_yes=new LabelButton("btn_17_off.png","btn_17_on.png","btn_17_none.png",ccui.Widget.PLIST_TEXTURE);btn_yes.setFont(LABEL_FONT_INDEX.FONT_261),btn_yes.setString(res_str("btn_label_confirm")),btn_yes.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),btn_yes.setPosition(ccCenter(info_box).x+5,16),info_box.addChild(btn_yes,8),btn_yes.addClickEventListener(function(sender){var naming_ids=[],i=0;for(i=0;i<this.m_namingListLayer.length;i++){if(this.m_namingListLayer[i].isDisplayNameMenu())return;naming_ids[i]=this.m_namingListLayer[i].getSelectedNamingId()}GameContext.getInstance().setChangedNamingIdx(naming_ids),this.scheduleOnce(function(float){MainObserver.getInstance().postNotification(sceneStr[GameContext.getInstance().getCurrentScene()],NOTIFY_NAMING_SETTING_CHANGED)},0,"NOTIFY_NAMING_SETTING_CHANGED")}.bind(this)),this.m_btnNo=new LabelButton("btn_18_off.png","btn_18_off.png","",ccui.Widget.PLIST_TEXTURE),this.m_btnNo.setFont(LABEL_FONT_INDEX.FONT_261),this.m_btnNo.setString(res_str("btn_label_cancel")),this.m_btnNo.setAnchorPoint(ANCHOR_BOTTOM_RIGHT()),this.m_btnNo.setPosition(ccCenter(info_box).x-5,16),info_box.addChild(this.m_btnNo,8),this.m_btnNo.addClickEventListener(function(sender){}.bind(this)),this.m_btnYes=new LabelButton("btn_17_off.png","btn_17_off.png","btn_17_none.png",ccui.Widget.PLIST_TEXTURE),this.m_btnYes.setFont(LABEL_FONT_INDEX.FONT_261),this.m_btnYes.setString(res_str("btn_label_confirm")),this.m_btnYes.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_btnYes.setPosition(ccCenter(info_box).x+5,16),info_box.addChild(this.m_btnYes,9),this.m_btnYes.addClickEventListener(function(sender){}.bind(this)),this.m_btnYes.setVisible(!1),this.m_btnNo.setVisible(!1),0==naming_info_list.length&&(btn_yes.setEnabled(!1),this.m_btnYes.setEnabled(!1))},setChildNotification:function(){for(var i=0;i<this.m_namingListLayer.length;i++);},comboBoxCallback:function(position){for(var i=0;i<MAX_NAME_POSOTION;i++){var naming_layer=this.m_namingListLayer[i];i!=position&&naming_layer.setDisplayNameMenu(!1)}var opencnt=0;for(i=0;i<this.m_namingListLayer.length;i++)this.m_namingListLayer[i].isDisplayNameMenu()&&opencnt++;0<opencnt?(this.m_btnYes.setVisible(!1),this.m_btnNo.setVisible(!1)):(this.m_btnYes.setVisible(!0),this.m_btnNo.setVisible(!0))},hideListLayer:function(){for(var i=0;i<this.m_namingListLayer.length;i++)this.m_namingListLayer[i].setDisplayNameMenu(!1);this.m_btnYes.setVisible(!1),this.m_btnNo.setVisible(!1)}}),NoticeListCell=cc.TableViewCell.extend({m_click_sprite:null,m_icon:null,m_subject_label:null,m_date_label:null,m_item:{},ctor:function(){this._super(),this.m_click_sprite=null,this.m_icon=null,this.m_subject_label=null,this.m_date_label=null,this.m_item={},this.init()},init:function(){var cellSize=cc.size(824,78);this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.setContentSize(cellSize);var bg_list=cc.Sprite.create(RES_CDN_DEFULT+"menu_notice/img_listbar.png");return bg_list.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),bg_list.setPosition(ZERO()),this.addChild(bg_list),this.m_icon=cc.Sprite.create(RES_CDN_DEFULT+"menu_notice/img_notice_1.png"),this.m_icon.setAnchorPoint(ANCHOR_BOTTOM_LEFT()),this.m_icon.setPosition(4,5),bg_list.addChild(this.m_icon),this.m_subject_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2423),this.m_subject_label.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_subject_label.setPosition(ccWidth(this.m_icon)+10,ccCenter(bg_list).y),bg_list.addChild(this.m_subject_label),this.m_date_label=cmLabel.getLabel("",LABEL_FONT_INDEX.FONT_2038),this.m_date_label.setAnchorPoint(ANCHOR_MIDDLE_RIGHT()),this.m_date_label.setPosition(ccWidth(bg_list)-10,ccCenter(bg_list).y),bg_list.addChild(this.m_date_label),this.m_click_sprite=cc.Scale9Sprite.create(RES_CDN_DEFULT+"common/img_9p_normal.png",cc.Rect(13,13,10,10)),this.m_click_sprite.setPreferredSize(cc.size(820,78)),this.m_click_sprite.setAnchorPoint(ANCHOR_MIDDLE_LEFT()),this.m_click_sprite.setPosition(5,ccPosY(this.m_subject_label)),this.addChild(this.m_click_sprite),this.m_click_sprite.setVisible(!1),!0},setData:function(data){this.m_item=data,this.updateCell()},updateCell:function(){this.m_icon.setTexture(RES_CDN_DEFULT+cmString("menu_notice/img_notice_%d.png",this.m_item.icon_type)),this.m_subject_label.setString(this.m_item.subject);var sub_color=cmLabel.getColor(LABEL_FONT_INDEX.FONT_2423+this.m_item.subject_color),sub_color_R=(4278190080&sub_color._val)>>>24,sub_color_G=(16711680&sub_color._val)>>16,sub_color_B=(65280&sub_color._val)>>8;this.m_subject_label.setColor(cc.color(sub_color_R,sub_color_G,sub_color_B));var remove_year_dt=this.m_item.begin_dt.substr(5);remove_year_dt.replace(2,1,"/"),this.m_date_label.setString(remove_year_dt);var date_color=cmLabel.getColor(LABEL_FONT_INDEX.FONT_2038+this.m_item.subject_color),date_color_R=(4278190080&date_color._val)>>>24,date_color_G=(16711680&date_color._val)>>16,date_color_B=(65280&date_color._val)>>8;this.m_date_label.setColor(cc.color(date_color_R,date_color_G,date_color_B))},highlightCell:function(pos){this.m_click_sprite.setVisible(!0)},unhighlightCell:function(pos){this.m_click_sprite.setVisible(!0)}});